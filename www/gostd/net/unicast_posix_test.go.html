<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html" class="current">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7662826">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7662882">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7662936">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7662987">//&nbsp;+build&nbsp;!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7663005">package</span>&nbsp;<span class="ident" id="7663013">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7663018">import</span>&nbsp;<span class="op" id="7663025">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7663028">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7663039">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7663050">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7663060">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7663063">var</span>&nbsp;<span class="ident" id="7663067">listenerTests</span>&nbsp;<span class="op" id="7663081">=</span>&nbsp;<span class="op" id="7663083">[</span><span class="op" id="7663084">]</span><span class="keyword" id="7663085">struct</span>&nbsp;<span class="op" id="7663092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7663095">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7663104">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7663112">laddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7663121">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7663129">ipv6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7663138">bool</span>&nbsp;<span class="comment" id="7663143">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7663184">wildcard</span>&nbsp;<span class="builtintype" id="7663193">bool</span>&nbsp;<span class="comment" id="7663198">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">20</span><span class="op" id="7663228">}</span><span class="op" id="7663229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7663232">{</span><span class="ident" id="7663233">net</span><span class="op" id="7663236">:</span>&nbsp;<span class="string" id="7663238">&#34;tcp&#34;</span><span class="op" id="7663243">,</span>&nbsp;<span class="ident" id="7663245">laddr</span><span class="op" id="7663250">:</span>&nbsp;<span class="string" id="7663252">&#34;&#34;</span><span class="op" id="7663254">,</span>&nbsp;<span class="ident" id="7663256">wildcard</span><span class="op" id="7663264">:</span>&nbsp;<span class="builtintype" id="7663266">true</span><span class="op" id="7663270">}</span><span class="op" id="7663271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7663274">{</span><span class="ident" id="7663275">net</span><span class="op" id="7663278">:</span>&nbsp;<span class="string" id="7663280">&#34;tcp&#34;</span><span class="op" id="7663285">,</span>&nbsp;<span class="ident" id="7663287">laddr</span><span class="op" id="7663292">:</span>&nbsp;<span class="string" id="7663294">&#34;0.0.0.0&#34;</span><span class="op" id="7663303">,</span>&nbsp;<span class="ident" id="7663305">wildcard</span><span class="op" id="7663313">:</span>&nbsp;<span class="builtintype" id="7663315">true</span><span class="op" id="7663319">}</span><span class="op" id="7663320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7663323">{</span><span class="ident" id="7663324">net</span><span class="op" id="7663327">:</span>&nbsp;<span class="string" id="7663329">&#34;tcp&#34;</span><span class="op" id="7663334">,</span>&nbsp;<span class="ident" id="7663336">laddr</span><span class="op" id="7663341">:</span>&nbsp;<span class="string" id="7663343">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7663361">,</span>&nbsp;<span class="ident" id="7663363">wildcard</span><span class="op" id="7663371">:</span>&nbsp;<span class="builtintype" id="7663373">true</span><span class="op" id="7663377">}</span><span class="op" id="7663378">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7663381">{</span><span class="ident" id="7663382">net</span><span class="op" id="7663385">:</span>&nbsp;<span class="string" id="7663387">&#34;tcp&#34;</span><span class="op" id="7663392">,</span>&nbsp;<span class="ident" id="7663394">laddr</span><span class="op" id="7663399">:</span>&nbsp;<span class="string" id="7663401">&#34;[::]&#34;</span><span class="op" id="7663407">,</span>&nbsp;<span class="ident" id="7663409">ipv6</span><span class="op" id="7663413">:</span>&nbsp;<span class="builtintype" id="7663415">true</span><span class="op" id="7663419">,</span>&nbsp;<span class="ident" id="7663421">wildcard</span><span class="op" id="7663429">:</span>&nbsp;<span class="builtintype" id="7663431">true</span><span class="op" id="7663435">}</span><span class="op" id="7663436">,</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7663440">{</span><span class="ident" id="7663441">net</span><span class="op" id="7663444">:</span>&nbsp;<span class="string" id="7663446">&#34;tcp&#34;</span><span class="op" id="7663451">,</span>&nbsp;<span class="ident" id="7663453">laddr</span><span class="op" id="7663458">:</span>&nbsp;<span class="string" id="7663460">&#34;127.0.0.1&#34;</span><span class="op" id="7663471">}</span><span class="op" id="7663472">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7663475">{</span><span class="ident" id="7663476">net</span><span class="op" id="7663479">:</span>&nbsp;<span class="string" id="7663481">&#34;tcp&#34;</span><span class="op" id="7663486">,</span>&nbsp;<span class="ident" id="7663488">laddr</span><span class="op" id="7663493">:</span>&nbsp;<span class="string" id="7663495">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7663515">}</span><span class="op" id="7663516">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7663519">{</span><span class="ident" id="7663520">net</span><span class="op" id="7663523">:</span>&nbsp;<span class="string" id="7663525">&#34;tcp&#34;</span><span class="op" id="7663530">,</span>&nbsp;<span class="ident" id="7663532">laddr</span><span class="op" id="7663537">:</span>&nbsp;<span class="string" id="7663539">&#34;[::1]&#34;</span><span class="op" id="7663546">,</span>&nbsp;<span class="ident" id="7663548">ipv6</span><span class="op" id="7663552">:</span>&nbsp;<span class="builtintype" id="7663554">true</span><span class="op" id="7663558">}</span><span class="op" id="7663559">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7663563">{</span><span class="ident" id="7663564">net</span><span class="op" id="7663567">:</span>&nbsp;<span class="string" id="7663569">&#34;tcp4&#34;</span><span class="op" id="7663575">,</span>&nbsp;<span class="ident" id="7663577">laddr</span><span class="op" id="7663582">:</span>&nbsp;<span class="string" id="7663584">&#34;&#34;</span><span class="op" id="7663586">,</span>&nbsp;<span class="ident" id="7663588">wildcard</span><span class="op" id="7663596">:</span>&nbsp;<span class="builtintype" id="7663598">true</span><span class="op" id="7663602">}</span><span class="op" id="7663603">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7663606">{</span><span class="ident" id="7663607">net</span><span class="op" id="7663610">:</span>&nbsp;<span class="string" id="7663612">&#34;tcp4&#34;</span><span class="op" id="7663618">,</span>&nbsp;<span class="ident" id="7663620">laddr</span><span class="op" id="7663625">:</span>&nbsp;<span class="string" id="7663627">&#34;0.0.0.0&#34;</span><span class="op" id="7663636">,</span>&nbsp;<span class="ident" id="7663638">wildcard</span><span class="op" id="7663646">:</span>&nbsp;<span class="builtintype" id="7663648">true</span><span class="op" id="7663652">}</span><span class="op" id="7663653">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7663656">{</span><span class="ident" id="7663657">net</span><span class="op" id="7663660">:</span>&nbsp;<span class="string" id="7663662">&#34;tcp4&#34;</span><span class="op" id="7663668">,</span>&nbsp;<span class="ident" id="7663670">laddr</span><span class="op" id="7663675">:</span>&nbsp;<span class="string" id="7663677">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7663695">,</span>&nbsp;<span class="ident" id="7663697">wildcard</span><span class="op" id="7663705">:</span>&nbsp;<span class="builtintype" id="7663707">true</span><span class="op" id="7663711">}</span><span class="op" id="7663712">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7663716">{</span><span class="ident" id="7663717">net</span><span class="op" id="7663720">:</span>&nbsp;<span class="string" id="7663722">&#34;tcp4&#34;</span><span class="op" id="7663728">,</span>&nbsp;<span class="ident" id="7663730">laddr</span><span class="op" id="7663735">:</span>&nbsp;<span class="string" id="7663737">&#34;127.0.0.1&#34;</span><span class="op" id="7663748">}</span><span class="op" id="7663749">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7663752">{</span><span class="ident" id="7663753">net</span><span class="op" id="7663756">:</span>&nbsp;<span class="string" id="7663758">&#34;tcp4&#34;</span><span class="op" id="7663764">,</span>&nbsp;<span class="ident" id="7663766">laddr</span><span class="op" id="7663771">:</span>&nbsp;<span class="string" id="7663773">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7663793">}</span><span class="op" id="7663794">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7663798">{</span><span class="ident" id="7663799">net</span><span class="op" id="7663802">:</span>&nbsp;<span class="string" id="7663804">&#34;tcp6&#34;</span><span class="op" id="7663810">,</span>&nbsp;<span class="ident" id="7663812">laddr</span><span class="op" id="7663817">:</span>&nbsp;<span class="string" id="7663819">&#34;&#34;</span><span class="op" id="7663821">,</span>&nbsp;<span class="ident" id="7663823">ipv6</span><span class="op" id="7663827">:</span>&nbsp;<span class="builtintype" id="7663829">true</span><span class="op" id="7663833">,</span>&nbsp;<span class="ident" id="7663835">wildcard</span><span class="op" id="7663843">:</span>&nbsp;<span class="builtintype" id="7663845">true</span><span class="op" id="7663849">}</span><span class="op" id="7663850">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7663853">{</span><span class="ident" id="7663854">net</span><span class="op" id="7663857">:</span>&nbsp;<span class="string" id="7663859">&#34;tcp6&#34;</span><span class="op" id="7663865">,</span>&nbsp;<span class="ident" id="7663867">laddr</span><span class="op" id="7663872">:</span>&nbsp;<span class="string" id="7663874">&#34;[::]&#34;</span><span class="op" id="7663880">,</span>&nbsp;<span class="ident" id="7663882">ipv6</span><span class="op" id="7663886">:</span>&nbsp;<span class="builtintype" id="7663888">true</span><span class="op" id="7663892">,</span>&nbsp;<span class="ident" id="7663894">wildcard</span><span class="op" id="7663902">:</span>&nbsp;<span class="builtintype" id="7663904">true</span><span class="op" id="7663908">}</span><span class="op" id="7663909">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7663913">{</span><span class="ident" id="7663914">net</span><span class="op" id="7663917">:</span>&nbsp;<span class="string" id="7663919">&#34;tcp6&#34;</span><span class="op" id="7663925">,</span>&nbsp;<span class="ident" id="7663927">laddr</span><span class="op" id="7663932">:</span>&nbsp;<span class="string" id="7663934">&#34;[::1]&#34;</span><span class="op" id="7663941">,</span>&nbsp;<span class="ident" id="7663943">ipv6</span><span class="op" id="7663947">:</span>&nbsp;<span class="builtintype" id="7663949">true</span><span class="op" id="7663953">}</span><span class="op" id="7663954">,</span><br>
<span class="lineno"></span><span class="op" id="7663956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7663959">//&nbsp;TestTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="7664024">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno">45</span><span class="comment" id="7664089">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="7664103">func</span>&nbsp;<span class="ident" id="7664108">TestTCPListener</span><span class="op" id="7664123">(</span><span class="ident" id="7664124">t</span>&nbsp;<span class="op" id="7664126">*</span><span class="ident" id="7664127">testing</span><span class="op" id="7664134">.</span><span class="ident" id="7664135">T</span><span class="op" id="7664136">)</span>&nbsp;<span class="op" id="7664138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7664141">switch</span>&nbsp;<span class="ident" id="7664148">runtime</span><span class="op" id="7664155">.</span><span class="ident" id="7664156">GOOS</span>&nbsp;<span class="op" id="7664161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7664164">case</span>&nbsp;<span class="string" id="7664169">&#34;plan9&#34;</span><span class="op" id="7664176">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7664180">t</span><span class="op" id="7664181">.</span><span class="ident" id="7664182">Skipf</span><span class="op" id="7664187">(</span><span class="string" id="7664188">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7664209">,</span>&nbsp;<span class="ident" id="7664211">runtime</span><span class="op" id="7664218">.</span><span class="ident" id="7664219">GOOS</span><span class="op" id="7664223">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7664226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7664230">for</span>&nbsp;<span class="ident" id="7664234">_</span><span class="op" id="7664235">,</span>&nbsp;<span class="ident" id="7664237">tt</span>&nbsp;<span class="op" id="7664240">:=</span>&nbsp;<span class="keyword" id="7664243">range</span>&nbsp;<span class="ident" id="7664249">listenerTests</span>&nbsp;<span class="op" id="7664263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7664267">if</span>&nbsp;<span class="ident" id="7664270">tt</span><span class="op" id="7664272">.</span><span class="ident" id="7664273">wildcard</span>&nbsp;<span class="op" id="7664282">&amp;&amp;</span>&nbsp;<span class="op" id="7664285">(</span><span class="ident" id="7664286">testing</span><span class="op" id="7664293">.</span><span class="ident" id="7664294">Short</span><span class="op" id="7664299">(</span><span class="op" id="7664300">)</span>&nbsp;<span class="op" id="7664302">||</span>&nbsp;<span class="op" id="7664305">!</span><span class="op" id="7664306">*</span><span class="ident" id="7664307">testExternal</span><span class="op" id="7664319">)</span>&nbsp;<span class="op" id="7664321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7664326">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7664337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7664341">if</span>&nbsp;<span class="ident" id="7664344">tt</span><span class="op" id="7664346">.</span><span class="ident" id="7664347">ipv6</span>&nbsp;<span class="op" id="7664352">&amp;&amp;</span>&nbsp;<span class="op" id="7664355">!</span><span class="ident" id="7664356">supportsIPv6</span>&nbsp;<span class="op" id="7664369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7664374">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7664385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7664389">l1</span><span class="op" id="7664391">,</span>&nbsp;<span class="ident" id="7664393">port</span>&nbsp;<span class="op" id="7664398">:=</span>&nbsp;<span class="ident" id="7664401">usableListenPort</span><span class="op" id="7664417">(</span><span class="ident" id="7664418">t</span><span class="op" id="7664419">,</span>&nbsp;<span class="ident" id="7664421">tt</span><span class="op" id="7664423">.</span><span class="ident" id="7664424">net</span><span class="op" id="7664427">,</span>&nbsp;<span class="ident" id="7664429">tt</span><span class="op" id="7664431">.</span><span class="ident" id="7664432">laddr</span><span class="op" id="7664437">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7664441">checkFirstListener</span><span class="op" id="7664459">(</span><span class="ident" id="7664460">t</span><span class="op" id="7664461">,</span>&nbsp;<span class="ident" id="7664463">tt</span><span class="op" id="7664465">.</span><span class="ident" id="7664466">net</span><span class="op" id="7664469">,</span>&nbsp;<span class="ident" id="7664471">tt</span><span class="op" id="7664473">.</span><span class="ident" id="7664474">laddr</span><span class="op" id="7664479">+</span><span class="string" id="7664480">&#34;:&#34;</span><span class="op" id="7664483">+</span><span class="ident" id="7664484">port</span><span class="op" id="7664488">,</span>&nbsp;<span class="ident" id="7664490">l1</span><span class="op" id="7664492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7664496">l2</span><span class="op" id="7664498">,</span>&nbsp;<span class="ident" id="7664500">err</span>&nbsp;<span class="op" id="7664504">:=</span>&nbsp;<span class="ident" id="7664507">Listen</span><span class="op" id="7664513">(</span><span class="ident" id="7664514">tt</span><span class="op" id="7664516">.</span><span class="ident" id="7664517">net</span><span class="op" id="7664520">,</span>&nbsp;<span class="ident" id="7664522">tt</span><span class="op" id="7664524">.</span><span class="ident" id="7664525">laddr</span><span class="op" id="7664530">+</span><span class="string" id="7664531">&#34;:&#34;</span><span class="op" id="7664534">+</span><span class="ident" id="7664535">port</span><span class="op" id="7664539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7664543">checkSecondListener</span><span class="op" id="7664562">(</span><span class="ident" id="7664563">t</span><span class="op" id="7664564">,</span>&nbsp;<span class="ident" id="7664566">tt</span><span class="op" id="7664568">.</span><span class="ident" id="7664569">net</span><span class="op" id="7664572">,</span>&nbsp;<span class="ident" id="7664574">tt</span><span class="op" id="7664576">.</span><span class="ident" id="7664577">laddr</span><span class="op" id="7664582">+</span><span class="string" id="7664583">&#34;:&#34;</span><span class="op" id="7664586">+</span><span class="ident" id="7664587">port</span><span class="op" id="7664591">,</span>&nbsp;<span class="ident" id="7664593">err</span><span class="op" id="7664596">,</span>&nbsp;<span class="ident" id="7664598">l2</span><span class="op" id="7664600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7664604">l1</span><span class="op" id="7664606">.</span><span class="ident" id="7664607">Close</span><span class="op" id="7664612">(</span><span class="op" id="7664613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7664616">}</span><br>
<span class="lineno">65</span><span class="op" id="7664618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7664621">//&nbsp;TestUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="7664686">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="7664751">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno">70</span><span class="keyword" id="7664765">func</span>&nbsp;<span class="ident" id="7664770">TestUDPListener</span><span class="op" id="7664785">(</span><span class="ident" id="7664786">t</span>&nbsp;<span class="op" id="7664788">*</span><span class="ident" id="7664789">testing</span><span class="op" id="7664796">.</span><span class="ident" id="7664797">T</span><span class="op" id="7664798">)</span>&nbsp;<span class="op" id="7664800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7664803">switch</span>&nbsp;<span class="ident" id="7664810">runtime</span><span class="op" id="7664817">.</span><span class="ident" id="7664818">GOOS</span>&nbsp;<span class="op" id="7664823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7664826">case</span>&nbsp;<span class="string" id="7664831">&#34;plan9&#34;</span><span class="op" id="7664838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7664842">t</span><span class="op" id="7664843">.</span><span class="ident" id="7664844">Skipf</span><span class="op" id="7664849">(</span><span class="string" id="7664850">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7664871">,</span>&nbsp;<span class="ident" id="7664873">runtime</span><span class="op" id="7664880">.</span><span class="ident" id="7664881">GOOS</span><span class="op" id="7664885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7664888">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7664892">toudpnet</span>&nbsp;<span class="op" id="7664901">:=</span>&nbsp;<span class="keyword" id="7664904">func</span><span class="op" id="7664908">(</span><span class="ident" id="7664909">net</span>&nbsp;<span class="builtintype" id="7664913">string</span><span class="op" id="7664919">)</span>&nbsp;<span class="builtintype" id="7664921">string</span>&nbsp;<span class="op" id="7664928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7664932">switch</span>&nbsp;<span class="ident" id="7664939">net</span>&nbsp;<span class="op" id="7664943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7664947">case</span>&nbsp;<span class="string" id="7664952">&#34;tcp&#34;</span><span class="op" id="7664957">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7664962">return</span>&nbsp;<span class="string" id="7664969">&#34;udp&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7664977">case</span>&nbsp;<span class="string" id="7664982">&#34;tcp4&#34;</span><span class="op" id="7664988">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7664993">return</span>&nbsp;<span class="string" id="7665000">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7665009">case</span>&nbsp;<span class="string" id="7665014">&#34;tcp6&#34;</span><span class="op" id="7665020">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7665025">return</span>&nbsp;<span class="string" id="7665032">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7665041">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7665045">return</span>&nbsp;<span class="string" id="7665052">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7665061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7665065">for</span>&nbsp;<span class="ident" id="7665069">_</span><span class="op" id="7665070">,</span>&nbsp;<span class="ident" id="7665072">tt</span>&nbsp;<span class="op" id="7665075">:=</span>&nbsp;<span class="keyword" id="7665078">range</span>&nbsp;<span class="ident" id="7665084">listenerTests</span>&nbsp;<span class="op" id="7665098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7665102">if</span>&nbsp;<span class="ident" id="7665105">tt</span><span class="op" id="7665107">.</span><span class="ident" id="7665108">wildcard</span>&nbsp;<span class="op" id="7665117">&amp;&amp;</span>&nbsp;<span class="op" id="7665120">(</span><span class="ident" id="7665121">testing</span><span class="op" id="7665128">.</span><span class="ident" id="7665129">Short</span><span class="op" id="7665134">(</span><span class="op" id="7665135">)</span>&nbsp;<span class="op" id="7665137">||</span>&nbsp;<span class="op" id="7665140">!</span><span class="op" id="7665141">*</span><span class="ident" id="7665142">testExternal</span><span class="op" id="7665154">)</span>&nbsp;<span class="op" id="7665156">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7665161">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7665172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7665176">if</span>&nbsp;<span class="ident" id="7665179">tt</span><span class="op" id="7665181">.</span><span class="ident" id="7665182">ipv6</span>&nbsp;<span class="op" id="7665187">&amp;&amp;</span>&nbsp;<span class="op" id="7665190">!</span><span class="ident" id="7665191">supportsIPv6</span>&nbsp;<span class="op" id="7665204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7665209">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7665220">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7665224">tt</span><span class="op" id="7665226">.</span><span class="ident" id="7665227">net</span>&nbsp;<span class="op" id="7665231">=</span>&nbsp;<span class="ident" id="7665233">toudpnet</span><span class="op" id="7665241">(</span><span class="ident" id="7665242">tt</span><span class="op" id="7665244">.</span><span class="ident" id="7665245">net</span><span class="op" id="7665248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7665252">l1</span><span class="op" id="7665254">,</span>&nbsp;<span class="ident" id="7665256">port</span>&nbsp;<span class="op" id="7665261">:=</span>&nbsp;<span class="ident" id="7665264">usableListenPacketPort</span><span class="op" id="7665286">(</span><span class="ident" id="7665287">t</span><span class="op" id="7665288">,</span>&nbsp;<span class="ident" id="7665290">tt</span><span class="op" id="7665292">.</span><span class="ident" id="7665293">net</span><span class="op" id="7665296">,</span>&nbsp;<span class="ident" id="7665298">tt</span><span class="op" id="7665300">.</span><span class="ident" id="7665301">laddr</span><span class="op" id="7665306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7665310">checkFirstListener</span><span class="op" id="7665328">(</span><span class="ident" id="7665329">t</span><span class="op" id="7665330">,</span>&nbsp;<span class="ident" id="7665332">tt</span><span class="op" id="7665334">.</span><span class="ident" id="7665335">net</span><span class="op" id="7665338">,</span>&nbsp;<span class="ident" id="7665340">tt</span><span class="op" id="7665342">.</span><span class="ident" id="7665343">laddr</span><span class="op" id="7665348">+</span><span class="string" id="7665349">&#34;:&#34;</span><span class="op" id="7665352">+</span><span class="ident" id="7665353">port</span><span class="op" id="7665357">,</span>&nbsp;<span class="ident" id="7665359">l1</span><span class="op" id="7665361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7665365">l2</span><span class="op" id="7665367">,</span>&nbsp;<span class="ident" id="7665369">err</span>&nbsp;<span class="op" id="7665373">:=</span>&nbsp;<span class="ident" id="7665376">ListenPacket</span><span class="op" id="7665388">(</span><span class="ident" id="7665389">tt</span><span class="op" id="7665391">.</span><span class="ident" id="7665392">net</span><span class="op" id="7665395">,</span>&nbsp;<span class="ident" id="7665397">tt</span><span class="op" id="7665399">.</span><span class="ident" id="7665400">laddr</span><span class="op" id="7665405">+</span><span class="string" id="7665406">&#34;:&#34;</span><span class="op" id="7665409">+</span><span class="ident" id="7665410">port</span><span class="op" id="7665414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7665418">checkSecondListener</span><span class="op" id="7665437">(</span><span class="ident" id="7665438">t</span><span class="op" id="7665439">,</span>&nbsp;<span class="ident" id="7665441">tt</span><span class="op" id="7665443">.</span><span class="ident" id="7665444">net</span><span class="op" id="7665447">,</span>&nbsp;<span class="ident" id="7665449">tt</span><span class="op" id="7665451">.</span><span class="ident" id="7665452">laddr</span><span class="op" id="7665457">+</span><span class="string" id="7665458">&#34;:&#34;</span><span class="op" id="7665461">+</span><span class="ident" id="7665462">port</span><span class="op" id="7665466">,</span>&nbsp;<span class="ident" id="7665468">err</span><span class="op" id="7665471">,</span>&nbsp;<span class="ident" id="7665473">l2</span><span class="op" id="7665475">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7665479">l1</span><span class="op" id="7665481">.</span><span class="ident" id="7665482">Close</span><span class="op" id="7665487">(</span><span class="op" id="7665488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7665491">}</span><br>
<span class="lineno"></span><span class="op" id="7665493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7665496">var</span>&nbsp;<span class="ident" id="7665500">dualStackListenerTests</span>&nbsp;<span class="op" id="7665523">=</span>&nbsp;<span class="op" id="7665525">[</span><span class="op" id="7665526">]</span><span class="keyword" id="7665527">struct</span>&nbsp;<span class="op" id="7665534">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7665537">net1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7665546">string</span>&nbsp;<span class="comment" id="7665553">//&nbsp;first&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7665572">laddr1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7665581">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7665589">net2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7665598">string</span>&nbsp;<span class="comment" id="7665605">//&nbsp;second&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7665625">laddr2</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7665634">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7665642">wildcard</span>&nbsp;<span class="builtintype" id="7665651">bool</span>&nbsp;&nbsp;<span class="comment" id="7665657">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7665688">xerr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7665697">error</span>&nbsp;<span class="comment" id="7665703">//&nbsp;expected&nbsp;error&nbsp;value,&nbsp;nil&nbsp;or&nbsp;other</span><br>
<span class="lineno"></span><span class="op" id="7665741">}</span><span class="op" id="7665742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7665745">//&nbsp;Test&nbsp;cases&nbsp;and&nbsp;expected&nbsp;results&nbsp;for&nbsp;the&nbsp;attemping&nbsp;2nd&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7665827">//&nbsp;1st&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2nd&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;darwin&nbsp;&nbsp;freebsd&nbsp;&nbsp;linux&nbsp;&nbsp;openbsd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7665916">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7666005">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7666091">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7666177">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7666263">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7666352">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7666439">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7666526">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7666613">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7666700">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7666787">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7666874">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7666963">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7667050">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7667137">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7667224">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7667311">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7667400">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7667487">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7667574">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7667661">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7667748">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7667752">//&nbsp;Platform&nbsp;default&nbsp;configurations:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7667789">//&nbsp;darwin,&nbsp;kernel&nbsp;version&nbsp;11.3.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7667823">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7667896">//&nbsp;freebsd,&nbsp;kernel&nbsp;version&nbsp;8.2</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7667928">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=1&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7668001">//&nbsp;linux,&nbsp;kernel&nbsp;version&nbsp;3.0.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7668033">//&nbsp;&nbsp;&nbsp;&nbspnet.ipv6.bindv6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7668105">//&nbsp;openbsd,&nbsp;kernel&nbsp;version&nbsp;5.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7668137">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=1&nbsp;(overriding&nbsp;is&nbsp;prohibited)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7668192">{</span><span class="ident" id="7668193">net1</span><span class="op" id="7668197">:</span>&nbsp;<span class="string" id="7668199">&#34;tcp&#34;</span><span class="op" id="7668204">,</span>&nbsp;<span class="ident" id="7668206">laddr1</span><span class="op" id="7668212">:</span>&nbsp;<span class="string" id="7668214">&#34;&#34;</span><span class="op" id="7668216">,</span>&nbsp;<span class="ident" id="7668218">net2</span><span class="op" id="7668222">:</span>&nbsp;<span class="string" id="7668224">&#34;tcp&#34;</span><span class="op" id="7668229">,</span>&nbsp;<span class="ident" id="7668231">laddr2</span><span class="op" id="7668237">:</span>&nbsp;<span class="string" id="7668239">&#34;&#34;</span><span class="op" id="7668241">,</span>&nbsp;<span class="ident" id="7668243">wildcard</span><span class="op" id="7668251">:</span>&nbsp;<span class="builtintype" id="7668253">true</span><span class="op" id="7668257">,</span>&nbsp;<span class="ident" id="7668259">xerr</span><span class="op" id="7668263">:</span>&nbsp;<span class="ident" id="7668265">syscall</span><span class="op" id="7668272">.</span><span class="ident" id="7668273">EADDRINUSE</span><span class="op" id="7668283">}</span><span class="op" id="7668284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7668287">{</span><span class="ident" id="7668288">net1</span><span class="op" id="7668292">:</span>&nbsp;<span class="string" id="7668294">&#34;tcp&#34;</span><span class="op" id="7668299">,</span>&nbsp;<span class="ident" id="7668301">laddr1</span><span class="op" id="7668307">:</span>&nbsp;<span class="string" id="7668309">&#34;&#34;</span><span class="op" id="7668311">,</span>&nbsp;<span class="ident" id="7668313">net2</span><span class="op" id="7668317">:</span>&nbsp;<span class="string" id="7668319">&#34;tcp&#34;</span><span class="op" id="7668324">,</span>&nbsp;<span class="ident" id="7668326">laddr2</span><span class="op" id="7668332">:</span>&nbsp;<span class="string" id="7668334">&#34;0.0.0.0&#34;</span><span class="op" id="7668343">,</span>&nbsp;<span class="ident" id="7668345">wildcard</span><span class="op" id="7668353">:</span>&nbsp;<span class="builtintype" id="7668355">true</span><span class="op" id="7668359">,</span>&nbsp;<span class="ident" id="7668361">xerr</span><span class="op" id="7668365">:</span>&nbsp;<span class="ident" id="7668367">syscall</span><span class="op" id="7668374">.</span><span class="ident" id="7668375">EADDRINUSE</span><span class="op" id="7668385">}</span><span class="op" id="7668386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7668389">{</span><span class="ident" id="7668390">net1</span><span class="op" id="7668394">:</span>&nbsp;<span class="string" id="7668396">&#34;tcp&#34;</span><span class="op" id="7668401">,</span>&nbsp;<span class="ident" id="7668403">laddr1</span><span class="op" id="7668409">:</span>&nbsp;<span class="string" id="7668411">&#34;0.0.0.0&#34;</span><span class="op" id="7668420">,</span>&nbsp;<span class="ident" id="7668422">net2</span><span class="op" id="7668426">:</span>&nbsp;<span class="string" id="7668428">&#34;tcp&#34;</span><span class="op" id="7668433">,</span>&nbsp;<span class="ident" id="7668435">laddr2</span><span class="op" id="7668441">:</span>&nbsp;<span class="string" id="7668443">&#34;&#34;</span><span class="op" id="7668445">,</span>&nbsp;<span class="ident" id="7668447">wildcard</span><span class="op" id="7668455">:</span>&nbsp;<span class="builtintype" id="7668457">true</span><span class="op" id="7668461">,</span>&nbsp;<span class="ident" id="7668463">xerr</span><span class="op" id="7668467">:</span>&nbsp;<span class="ident" id="7668469">syscall</span><span class="op" id="7668476">.</span><span class="ident" id="7668477">EADDRINUSE</span><span class="op" id="7668487">}</span><span class="op" id="7668488">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7668492">{</span><span class="ident" id="7668493">net1</span><span class="op" id="7668497">:</span>&nbsp;<span class="string" id="7668499">&#34;tcp&#34;</span><span class="op" id="7668504">,</span>&nbsp;<span class="ident" id="7668506">laddr1</span><span class="op" id="7668512">:</span>&nbsp;<span class="string" id="7668514">&#34;&#34;</span><span class="op" id="7668516">,</span>&nbsp;<span class="ident" id="7668518">net2</span><span class="op" id="7668522">:</span>&nbsp;<span class="string" id="7668524">&#34;tcp&#34;</span><span class="op" id="7668529">,</span>&nbsp;<span class="ident" id="7668531">laddr2</span><span class="op" id="7668537">:</span>&nbsp;<span class="string" id="7668539">&#34;[::]&#34;</span><span class="op" id="7668545">,</span>&nbsp;<span class="ident" id="7668547">wildcard</span><span class="op" id="7668555">:</span>&nbsp;<span class="builtintype" id="7668557">true</span><span class="op" id="7668561">,</span>&nbsp;<span class="ident" id="7668563">xerr</span><span class="op" id="7668567">:</span>&nbsp;<span class="ident" id="7668569">syscall</span><span class="op" id="7668576">.</span><span class="ident" id="7668577">EADDRINUSE</span><span class="op" id="7668587">}</span><span class="op" id="7668588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7668591">{</span><span class="ident" id="7668592">net1</span><span class="op" id="7668596">:</span>&nbsp;<span class="string" id="7668598">&#34;tcp&#34;</span><span class="op" id="7668603">,</span>&nbsp;<span class="ident" id="7668605">laddr1</span><span class="op" id="7668611">:</span>&nbsp;<span class="string" id="7668613">&#34;[::]&#34;</span><span class="op" id="7668619">,</span>&nbsp;<span class="ident" id="7668621">net2</span><span class="op" id="7668625">:</span>&nbsp;<span class="string" id="7668627">&#34;tcp&#34;</span><span class="op" id="7668632">,</span>&nbsp;<span class="ident" id="7668634">laddr2</span><span class="op" id="7668640">:</span>&nbsp;<span class="string" id="7668642">&#34;&#34;</span><span class="op" id="7668644">,</span>&nbsp;<span class="ident" id="7668646">wildcard</span><span class="op" id="7668654">:</span>&nbsp;<span class="builtintype" id="7668656">true</span><span class="op" id="7668660">,</span>&nbsp;<span class="ident" id="7668662">xerr</span><span class="op" id="7668666">:</span>&nbsp;<span class="ident" id="7668668">syscall</span><span class="op" id="7668675">.</span><span class="ident" id="7668676">EADDRINUSE</span><span class="op" id="7668686">}</span><span class="op" id="7668687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7668690">{</span><span class="ident" id="7668691">net1</span><span class="op" id="7668695">:</span>&nbsp;<span class="string" id="7668697">&#34;tcp&#34;</span><span class="op" id="7668702">,</span>&nbsp;<span class="ident" id="7668704">laddr1</span><span class="op" id="7668710">:</span>&nbsp;<span class="string" id="7668712">&#34;0.0.0.0&#34;</span><span class="op" id="7668721">,</span>&nbsp;<span class="ident" id="7668723">net2</span><span class="op" id="7668727">:</span>&nbsp;<span class="string" id="7668729">&#34;tcp&#34;</span><span class="op" id="7668734">,</span>&nbsp;<span class="ident" id="7668736">laddr2</span><span class="op" id="7668742">:</span>&nbsp;<span class="string" id="7668744">&#34;[::]&#34;</span><span class="op" id="7668750">,</span>&nbsp;<span class="ident" id="7668752">wildcard</span><span class="op" id="7668760">:</span>&nbsp;<span class="builtintype" id="7668762">true</span><span class="op" id="7668766">,</span>&nbsp;<span class="ident" id="7668768">xerr</span><span class="op" id="7668772">:</span>&nbsp;<span class="ident" id="7668774">syscall</span><span class="op" id="7668781">.</span><span class="ident" id="7668782">EADDRINUSE</span><span class="op" id="7668792">}</span><span class="op" id="7668793">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7668796">{</span><span class="ident" id="7668797">net1</span><span class="op" id="7668801">:</span>&nbsp;<span class="string" id="7668803">&#34;tcp&#34;</span><span class="op" id="7668808">,</span>&nbsp;<span class="ident" id="7668810">laddr1</span><span class="op" id="7668816">:</span>&nbsp;<span class="string" id="7668818">&#34;[::]&#34;</span><span class="op" id="7668824">,</span>&nbsp;<span class="ident" id="7668826">net2</span><span class="op" id="7668830">:</span>&nbsp;<span class="string" id="7668832">&#34;tcp&#34;</span><span class="op" id="7668837">,</span>&nbsp;<span class="ident" id="7668839">laddr2</span><span class="op" id="7668845">:</span>&nbsp;<span class="string" id="7668847">&#34;0.0.0.0&#34;</span><span class="op" id="7668856">,</span>&nbsp;<span class="ident" id="7668858">wildcard</span><span class="op" id="7668866">:</span>&nbsp;<span class="builtintype" id="7668868">true</span><span class="op" id="7668872">,</span>&nbsp;<span class="ident" id="7668874">xerr</span><span class="op" id="7668878">:</span>&nbsp;<span class="ident" id="7668880">syscall</span><span class="op" id="7668887">.</span><span class="ident" id="7668888">EADDRINUSE</span><span class="op" id="7668898">}</span><span class="op" id="7668899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7668902">{</span><span class="ident" id="7668903">net1</span><span class="op" id="7668907">:</span>&nbsp;<span class="string" id="7668909">&#34;tcp&#34;</span><span class="op" id="7668914">,</span>&nbsp;<span class="ident" id="7668916">laddr1</span><span class="op" id="7668922">:</span>&nbsp;<span class="string" id="7668924">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7668942">,</span>&nbsp;<span class="ident" id="7668944">net2</span><span class="op" id="7668948">:</span>&nbsp;<span class="string" id="7668950">&#34;tcp&#34;</span><span class="op" id="7668955">,</span>&nbsp;<span class="ident" id="7668957">laddr2</span><span class="op" id="7668963">:</span>&nbsp;<span class="string" id="7668965">&#34;[::]&#34;</span><span class="op" id="7668971">,</span>&nbsp;<span class="ident" id="7668973">wildcard</span><span class="op" id="7668981">:</span>&nbsp;<span class="builtintype" id="7668983">true</span><span class="op" id="7668987">,</span>&nbsp;<span class="ident" id="7668989">xerr</span><span class="op" id="7668993">:</span>&nbsp;<span class="ident" id="7668995">syscall</span><span class="op" id="7669002">.</span><span class="ident" id="7669003">EADDRINUSE</span><span class="op" id="7669013">}</span><span class="op" id="7669014">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7669017">{</span><span class="ident" id="7669018">net1</span><span class="op" id="7669022">:</span>&nbsp;<span class="string" id="7669024">&#34;tcp&#34;</span><span class="op" id="7669029">,</span>&nbsp;<span class="ident" id="7669031">laddr1</span><span class="op" id="7669037">:</span>&nbsp;<span class="string" id="7669039">&#34;[::]&#34;</span><span class="op" id="7669045">,</span>&nbsp;<span class="ident" id="7669047">net2</span><span class="op" id="7669051">:</span>&nbsp;<span class="string" id="7669053">&#34;tcp&#34;</span><span class="op" id="7669058">,</span>&nbsp;<span class="ident" id="7669060">laddr2</span><span class="op" id="7669066">:</span>&nbsp;<span class="string" id="7669068">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7669086">,</span>&nbsp;<span class="ident" id="7669088">wildcard</span><span class="op" id="7669096">:</span>&nbsp;<span class="builtintype" id="7669098">true</span><span class="op" id="7669102">,</span>&nbsp;<span class="ident" id="7669104">xerr</span><span class="op" id="7669108">:</span>&nbsp;<span class="ident" id="7669110">syscall</span><span class="op" id="7669117">.</span><span class="ident" id="7669118">EADDRINUSE</span><span class="op" id="7669128">}</span><span class="op" id="7669129">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7669133">{</span><span class="ident" id="7669134">net1</span><span class="op" id="7669138">:</span>&nbsp;<span class="string" id="7669140">&#34;tcp4&#34;</span><span class="op" id="7669146">,</span>&nbsp;<span class="ident" id="7669148">laddr1</span><span class="op" id="7669154">:</span>&nbsp;<span class="string" id="7669156">&#34;&#34;</span><span class="op" id="7669158">,</span>&nbsp;<span class="ident" id="7669160">net2</span><span class="op" id="7669164">:</span>&nbsp;<span class="string" id="7669166">&#34;tcp6&#34;</span><span class="op" id="7669172">,</span>&nbsp;<span class="ident" id="7669174">laddr2</span><span class="op" id="7669180">:</span>&nbsp;<span class="string" id="7669182">&#34;&#34;</span><span class="op" id="7669184">,</span>&nbsp;<span class="ident" id="7669186">wildcard</span><span class="op" id="7669194">:</span>&nbsp;<span class="builtintype" id="7669196">true</span><span class="op" id="7669200">}</span><span class="op" id="7669201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7669204">{</span><span class="ident" id="7669205">net1</span><span class="op" id="7669209">:</span>&nbsp;<span class="string" id="7669211">&#34;tcp6&#34;</span><span class="op" id="7669217">,</span>&nbsp;<span class="ident" id="7669219">laddr1</span><span class="op" id="7669225">:</span>&nbsp;<span class="string" id="7669227">&#34;&#34;</span><span class="op" id="7669229">,</span>&nbsp;<span class="ident" id="7669231">net2</span><span class="op" id="7669235">:</span>&nbsp;<span class="string" id="7669237">&#34;tcp4&#34;</span><span class="op" id="7669243">,</span>&nbsp;<span class="ident" id="7669245">laddr2</span><span class="op" id="7669251">:</span>&nbsp;<span class="string" id="7669253">&#34;&#34;</span><span class="op" id="7669255">,</span>&nbsp;<span class="ident" id="7669257">wildcard</span><span class="op" id="7669265">:</span>&nbsp;<span class="builtintype" id="7669267">true</span><span class="op" id="7669271">}</span><span class="op" id="7669272">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7669275">{</span><span class="ident" id="7669276">net1</span><span class="op" id="7669280">:</span>&nbsp;<span class="string" id="7669282">&#34;tcp4&#34;</span><span class="op" id="7669288">,</span>&nbsp;<span class="ident" id="7669290">laddr1</span><span class="op" id="7669296">:</span>&nbsp;<span class="string" id="7669298">&#34;0.0.0.0&#34;</span><span class="op" id="7669307">,</span>&nbsp;<span class="ident" id="7669309">net2</span><span class="op" id="7669313">:</span>&nbsp;<span class="string" id="7669315">&#34;tcp6&#34;</span><span class="op" id="7669321">,</span>&nbsp;<span class="ident" id="7669323">laddr2</span><span class="op" id="7669329">:</span>&nbsp;<span class="string" id="7669331">&#34;[::]&#34;</span><span class="op" id="7669337">,</span>&nbsp;<span class="ident" id="7669339">wildcard</span><span class="op" id="7669347">:</span>&nbsp;<span class="builtintype" id="7669349">true</span><span class="op" id="7669353">}</span><span class="op" id="7669354">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7669357">{</span><span class="ident" id="7669358">net1</span><span class="op" id="7669362">:</span>&nbsp;<span class="string" id="7669364">&#34;tcp6&#34;</span><span class="op" id="7669370">,</span>&nbsp;<span class="ident" id="7669372">laddr1</span><span class="op" id="7669378">:</span>&nbsp;<span class="string" id="7669380">&#34;[::]&#34;</span><span class="op" id="7669386">,</span>&nbsp;<span class="ident" id="7669388">net2</span><span class="op" id="7669392">:</span>&nbsp;<span class="string" id="7669394">&#34;tcp4&#34;</span><span class="op" id="7669400">,</span>&nbsp;<span class="ident" id="7669402">laddr2</span><span class="op" id="7669408">:</span>&nbsp;<span class="string" id="7669410">&#34;0.0.0.0&#34;</span><span class="op" id="7669419">,</span>&nbsp;<span class="ident" id="7669421">wildcard</span><span class="op" id="7669429">:</span>&nbsp;<span class="builtintype" id="7669431">true</span><span class="op" id="7669435">}</span><span class="op" id="7669436">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7669440">{</span><span class="ident" id="7669441">net1</span><span class="op" id="7669445">:</span>&nbsp;<span class="string" id="7669447">&#34;tcp&#34;</span><span class="op" id="7669452">,</span>&nbsp;<span class="ident" id="7669454">laddr1</span><span class="op" id="7669460">:</span>&nbsp;<span class="string" id="7669462">&#34;127.0.0.1&#34;</span><span class="op" id="7669473">,</span>&nbsp;<span class="ident" id="7669475">net2</span><span class="op" id="7669479">:</span>&nbsp;<span class="string" id="7669481">&#34;tcp&#34;</span><span class="op" id="7669486">,</span>&nbsp;<span class="ident" id="7669488">laddr2</span><span class="op" id="7669494">:</span>&nbsp;<span class="string" id="7669496">&#34;[::1]&#34;</span><span class="op" id="7669503">}</span><span class="op" id="7669504">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7669507">{</span><span class="ident" id="7669508">net1</span><span class="op" id="7669512">:</span>&nbsp;<span class="string" id="7669514">&#34;tcp&#34;</span><span class="op" id="7669519">,</span>&nbsp;<span class="ident" id="7669521">laddr1</span><span class="op" id="7669527">:</span>&nbsp;<span class="string" id="7669529">&#34;[::1]&#34;</span><span class="op" id="7669536">,</span>&nbsp;<span class="ident" id="7669538">net2</span><span class="op" id="7669542">:</span>&nbsp;<span class="string" id="7669544">&#34;tcp&#34;</span><span class="op" id="7669549">,</span>&nbsp;<span class="ident" id="7669551">laddr2</span><span class="op" id="7669557">:</span>&nbsp;<span class="string" id="7669559">&#34;127.0.0.1&#34;</span><span class="op" id="7669570">}</span><span class="op" id="7669571">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7669574">{</span><span class="ident" id="7669575">net1</span><span class="op" id="7669579">:</span>&nbsp;<span class="string" id="7669581">&#34;tcp4&#34;</span><span class="op" id="7669587">,</span>&nbsp;<span class="ident" id="7669589">laddr1</span><span class="op" id="7669595">:</span>&nbsp;<span class="string" id="7669597">&#34;127.0.0.1&#34;</span><span class="op" id="7669608">,</span>&nbsp;<span class="ident" id="7669610">net2</span><span class="op" id="7669614">:</span>&nbsp;<span class="string" id="7669616">&#34;tcp6&#34;</span><span class="op" id="7669622">,</span>&nbsp;<span class="ident" id="7669624">laddr2</span><span class="op" id="7669630">:</span>&nbsp;<span class="string" id="7669632">&#34;[::1]&#34;</span><span class="op" id="7669639">}</span><span class="op" id="7669640">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7669643">{</span><span class="ident" id="7669644">net1</span><span class="op" id="7669648">:</span>&nbsp;<span class="string" id="7669650">&#34;tcp6&#34;</span><span class="op" id="7669656">,</span>&nbsp;<span class="ident" id="7669658">laddr1</span><span class="op" id="7669664">:</span>&nbsp;<span class="string" id="7669666">&#34;[::1]&#34;</span><span class="op" id="7669673">,</span>&nbsp;<span class="ident" id="7669675">net2</span><span class="op" id="7669679">:</span>&nbsp;<span class="string" id="7669681">&#34;tcp4&#34;</span><span class="op" id="7669687">,</span>&nbsp;<span class="ident" id="7669689">laddr2</span><span class="op" id="7669695">:</span>&nbsp;<span class="string" id="7669697">&#34;127.0.0.1&#34;</span><span class="op" id="7669708">}</span><span class="op" id="7669709">,</span><br>
<span class="lineno"></span><span class="op" id="7669711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7669714">//&nbsp;TestDualStackTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="7669778">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;different</span><br>
<span class="lineno">170</span><span class="comment" id="7669841">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="7669877">func</span>&nbsp;<span class="ident" id="7669882">TestDualStackTCPListener</span><span class="op" id="7669906">(</span><span class="ident" id="7669907">t</span>&nbsp;<span class="op" id="7669909">*</span><span class="ident" id="7669910">testing</span><span class="op" id="7669917">.</span><span class="ident" id="7669918">T</span><span class="op" id="7669919">)</span>&nbsp;<span class="op" id="7669921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7669924">if</span>&nbsp;<span class="ident" id="7669927">testing</span><span class="op" id="7669934">.</span><span class="ident" id="7669935">Short</span><span class="op" id="7669940">(</span><span class="op" id="7669941">)</span>&nbsp;<span class="op" id="7669943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7669947">t</span><span class="op" id="7669948">.</span><span class="ident" id="7669949">Skip</span><span class="op" id="7669953">(</span><span class="string" id="7669954">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="7669995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7669998">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7670001">switch</span>&nbsp;<span class="ident" id="7670008">runtime</span><span class="op" id="7670015">.</span><span class="ident" id="7670016">GOOS</span>&nbsp;<span class="op" id="7670021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7670024">case</span>&nbsp;<span class="string" id="7670029">&#34;plan9&#34;</span><span class="op" id="7670036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7670040">t</span><span class="op" id="7670041">.</span><span class="ident" id="7670042">Skipf</span><span class="op" id="7670047">(</span><span class="string" id="7670048">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7670069">,</span>&nbsp;<span class="ident" id="7670071">runtime</span><span class="op" id="7670078">.</span><span class="ident" id="7670079">GOOS</span><span class="op" id="7670083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7670086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7670089">if</span>&nbsp;<span class="op" id="7670092">!</span><span class="ident" id="7670093">supportsIPv6</span>&nbsp;<span class="op" id="7670106">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7670110">t</span><span class="op" id="7670111">.</span><span class="ident" id="7670112">Skip</span><span class="op" id="7670116">(</span><span class="string" id="7670117">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7670140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7670143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7670147">for</span>&nbsp;<span class="ident" id="7670151">_</span><span class="op" id="7670152">,</span>&nbsp;<span class="ident" id="7670154">tt</span>&nbsp;<span class="op" id="7670157">:=</span>&nbsp;<span class="keyword" id="7670160">range</span>&nbsp;<span class="ident" id="7670166">dualStackListenerTests</span>&nbsp;<span class="op" id="7670189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7670193">if</span>&nbsp;<span class="ident" id="7670196">tt</span><span class="op" id="7670198">.</span><span class="ident" id="7670199">wildcard</span>&nbsp;<span class="op" id="7670208">&amp;&amp;</span>&nbsp;<span class="op" id="7670211">!</span><span class="op" id="7670212">*</span><span class="ident" id="7670213">testExternal</span>&nbsp;<span class="op" id="7670226">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7670231">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7670242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7670246">switch</span>&nbsp;<span class="ident" id="7670253">runtime</span><span class="op" id="7670260">.</span><span class="ident" id="7670261">GOOS</span>&nbsp;<span class="op" id="7670266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7670270">case</span>&nbsp;<span class="string" id="7670275">&#34;openbsd&#34;</span><span class="op" id="7670284">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7670289">if</span>&nbsp;<span class="ident" id="7670292">tt</span><span class="op" id="7670294">.</span><span class="ident" id="7670295">wildcard</span>&nbsp;<span class="op" id="7670304">&amp;&amp;</span>&nbsp;<span class="ident" id="7670307">differentWildcardAddr</span><span class="op" id="7670328">(</span><span class="ident" id="7670329">tt</span><span class="op" id="7670331">.</span><span class="ident" id="7670332">laddr1</span><span class="op" id="7670338">,</span>&nbsp;<span class="ident" id="7670340">tt</span><span class="op" id="7670342">.</span><span class="ident" id="7670343">laddr2</span><span class="op" id="7670349">)</span>&nbsp;<span class="op" id="7670351">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7670357">tt</span><span class="op" id="7670359">.</span><span class="ident" id="7670360">xerr</span>&nbsp;<span class="op" id="7670365">=</span>&nbsp;<span class="ident" id="7670367">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7670374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7670378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7670382">l1</span><span class="op" id="7670384">,</span>&nbsp;<span class="ident" id="7670386">port</span>&nbsp;<span class="op" id="7670391">:=</span>&nbsp;<span class="ident" id="7670394">usableListenPort</span><span class="op" id="7670410">(</span><span class="ident" id="7670411">t</span><span class="op" id="7670412">,</span>&nbsp;<span class="ident" id="7670414">tt</span><span class="op" id="7670416">.</span><span class="ident" id="7670417">net1</span><span class="op" id="7670421">,</span>&nbsp;<span class="ident" id="7670423">tt</span><span class="op" id="7670425">.</span><span class="ident" id="7670426">laddr1</span><span class="op" id="7670432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7670436">laddr</span>&nbsp;<span class="op" id="7670442">:=</span>&nbsp;<span class="ident" id="7670445">tt</span><span class="op" id="7670447">.</span><span class="ident" id="7670448">laddr1</span>&nbsp;<span class="op" id="7670455">+</span>&nbsp;<span class="string" id="7670457">&#34;:&#34;</span>&nbsp;<span class="op" id="7670461">+</span>&nbsp;<span class="ident" id="7670463">port</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7670470">checkFirstListener</span><span class="op" id="7670488">(</span><span class="ident" id="7670489">t</span><span class="op" id="7670490">,</span>&nbsp;<span class="ident" id="7670492">tt</span><span class="op" id="7670494">.</span><span class="ident" id="7670495">net1</span><span class="op" id="7670499">,</span>&nbsp;<span class="ident" id="7670501">laddr</span><span class="op" id="7670506">,</span>&nbsp;<span class="ident" id="7670508">l1</span><span class="op" id="7670510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7670514">laddr</span>&nbsp;<span class="op" id="7670520">=</span>&nbsp;<span class="ident" id="7670522">tt</span><span class="op" id="7670524">.</span><span class="ident" id="7670525">laddr2</span>&nbsp;<span class="op" id="7670532">+</span>&nbsp;<span class="string" id="7670534">&#34;:&#34;</span>&nbsp;<span class="op" id="7670538">+</span>&nbsp;<span class="ident" id="7670540">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7670547">l2</span><span class="op" id="7670549">,</span>&nbsp;<span class="ident" id="7670551">err</span>&nbsp;<span class="op" id="7670555">:=</span>&nbsp;<span class="ident" id="7670558">Listen</span><span class="op" id="7670564">(</span><span class="ident" id="7670565">tt</span><span class="op" id="7670567">.</span><span class="ident" id="7670568">net2</span><span class="op" id="7670572">,</span>&nbsp;<span class="ident" id="7670574">laddr</span><span class="op" id="7670579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7670583">checkDualStackSecondListener</span><span class="op" id="7670611">(</span><span class="ident" id="7670612">t</span><span class="op" id="7670613">,</span>&nbsp;<span class="ident" id="7670615">tt</span><span class="op" id="7670617">.</span><span class="ident" id="7670618">net2</span><span class="op" id="7670622">,</span>&nbsp;<span class="ident" id="7670624">laddr</span><span class="op" id="7670629">,</span>&nbsp;<span class="ident" id="7670631">tt</span><span class="op" id="7670633">.</span><span class="ident" id="7670634">xerr</span><span class="op" id="7670638">,</span>&nbsp;<span class="ident" id="7670640">err</span><span class="op" id="7670643">,</span>&nbsp;<span class="ident" id="7670645">l2</span><span class="op" id="7670647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7670651">l1</span><span class="op" id="7670653">.</span><span class="ident" id="7670654">Close</span><span class="op" id="7670659">(</span><span class="op" id="7670660">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7670663">}</span><br>
<span class="lineno"></span><span class="op" id="7670665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7670668">//&nbsp;TestDualStackUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="7670732">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;differnet</span><br>
<span class="lineno">205</span><span class="comment" id="7670795">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="7670831">func</span>&nbsp;<span class="ident" id="7670836">TestDualStackUDPListener</span><span class="op" id="7670860">(</span><span class="ident" id="7670861">t</span>&nbsp;<span class="op" id="7670863">*</span><span class="ident" id="7670864">testing</span><span class="op" id="7670871">.</span><span class="ident" id="7670872">T</span><span class="op" id="7670873">)</span>&nbsp;<span class="op" id="7670875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7670878">if</span>&nbsp;<span class="ident" id="7670881">testing</span><span class="op" id="7670888">.</span><span class="ident" id="7670889">Short</span><span class="op" id="7670894">(</span><span class="op" id="7670895">)</span>&nbsp;<span class="op" id="7670897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7670901">t</span><span class="op" id="7670902">.</span><span class="ident" id="7670903">Skip</span><span class="op" id="7670907">(</span><span class="string" id="7670908">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="7670949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7670952">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7670955">switch</span>&nbsp;<span class="ident" id="7670962">runtime</span><span class="op" id="7670969">.</span><span class="ident" id="7670970">GOOS</span>&nbsp;<span class="op" id="7670975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7670978">case</span>&nbsp;<span class="string" id="7670983">&#34;plan9&#34;</span><span class="op" id="7670990">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7670994">t</span><span class="op" id="7670995">.</span><span class="ident" id="7670996">Skipf</span><span class="op" id="7671001">(</span><span class="string" id="7671002">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7671023">,</span>&nbsp;<span class="ident" id="7671025">runtime</span><span class="op" id="7671032">.</span><span class="ident" id="7671033">GOOS</span><span class="op" id="7671037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7671040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7671043">if</span>&nbsp;<span class="op" id="7671046">!</span><span class="ident" id="7671047">supportsIPv6</span>&nbsp;<span class="op" id="7671060">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7671064">t</span><span class="op" id="7671065">.</span><span class="ident" id="7671066">Skip</span><span class="op" id="7671070">(</span><span class="string" id="7671071">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7671094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7671097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7671101">toudpnet</span>&nbsp;<span class="op" id="7671110">:=</span>&nbsp;<span class="keyword" id="7671113">func</span><span class="op" id="7671117">(</span><span class="ident" id="7671118">net</span>&nbsp;<span class="builtintype" id="7671122">string</span><span class="op" id="7671128">)</span>&nbsp;<span class="builtintype" id="7671130">string</span>&nbsp;<span class="op" id="7671137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7671141">switch</span>&nbsp;<span class="ident" id="7671148">net</span>&nbsp;<span class="op" id="7671152">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7671156">case</span>&nbsp;<span class="string" id="7671161">&#34;tcp&#34;</span><span class="op" id="7671166">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7671171">return</span>&nbsp;<span class="string" id="7671178">&#34;udp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7671186">case</span>&nbsp;<span class="string" id="7671191">&#34;tcp4&#34;</span><span class="op" id="7671197">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7671202">return</span>&nbsp;<span class="string" id="7671209">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7671218">case</span>&nbsp;<span class="string" id="7671223">&#34;tcp6&#34;</span><span class="op" id="7671229">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7671234">return</span>&nbsp;<span class="string" id="7671241">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7671250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7671254">return</span>&nbsp;<span class="string" id="7671261">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7671270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7671274">for</span>&nbsp;<span class="ident" id="7671278">_</span><span class="op" id="7671279">,</span>&nbsp;<span class="ident" id="7671281">tt</span>&nbsp;<span class="op" id="7671284">:=</span>&nbsp;<span class="keyword" id="7671287">range</span>&nbsp;<span class="ident" id="7671293">dualStackListenerTests</span>&nbsp;<span class="op" id="7671316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7671320">if</span>&nbsp;<span class="ident" id="7671323">tt</span><span class="op" id="7671325">.</span><span class="ident" id="7671326">wildcard</span>&nbsp;<span class="op" id="7671335">&amp;&amp;</span>&nbsp;<span class="op" id="7671338">(</span><span class="ident" id="7671339">testing</span><span class="op" id="7671346">.</span><span class="ident" id="7671347">Short</span><span class="op" id="7671352">(</span><span class="op" id="7671353">)</span>&nbsp;<span class="op" id="7671355">||</span>&nbsp;<span class="op" id="7671358">!</span><span class="op" id="7671359">*</span><span class="ident" id="7671360">testExternal</span><span class="op" id="7671372">)</span>&nbsp;<span class="op" id="7671374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7671379">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7671390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7671394">tt</span><span class="op" id="7671396">.</span><span class="ident" id="7671397">net1</span>&nbsp;<span class="op" id="7671402">=</span>&nbsp;<span class="ident" id="7671404">toudpnet</span><span class="op" id="7671412">(</span><span class="ident" id="7671413">tt</span><span class="op" id="7671415">.</span><span class="ident" id="7671416">net1</span><span class="op" id="7671420">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7671424">tt</span><span class="op" id="7671426">.</span><span class="ident" id="7671427">net2</span>&nbsp;<span class="op" id="7671432">=</span>&nbsp;<span class="ident" id="7671434">toudpnet</span><span class="op" id="7671442">(</span><span class="ident" id="7671443">tt</span><span class="op" id="7671445">.</span><span class="ident" id="7671446">net2</span><span class="op" id="7671450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7671454">switch</span>&nbsp;<span class="ident" id="7671461">runtime</span><span class="op" id="7671468">.</span><span class="ident" id="7671469">GOOS</span>&nbsp;<span class="op" id="7671474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7671478">case</span>&nbsp;<span class="string" id="7671483">&#34;openbsd&#34;</span><span class="op" id="7671492">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7671497">if</span>&nbsp;<span class="ident" id="7671500">tt</span><span class="op" id="7671502">.</span><span class="ident" id="7671503">wildcard</span>&nbsp;<span class="op" id="7671512">&amp;&amp;</span>&nbsp;<span class="ident" id="7671515">differentWildcardAddr</span><span class="op" id="7671536">(</span><span class="ident" id="7671537">tt</span><span class="op" id="7671539">.</span><span class="ident" id="7671540">laddr1</span><span class="op" id="7671546">,</span>&nbsp;<span class="ident" id="7671548">tt</span><span class="op" id="7671550">.</span><span class="ident" id="7671551">laddr2</span><span class="op" id="7671557">)</span>&nbsp;<span class="op" id="7671559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7671565">tt</span><span class="op" id="7671567">.</span><span class="ident" id="7671568">xerr</span>&nbsp;<span class="op" id="7671573">=</span>&nbsp;<span class="ident" id="7671575">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7671582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7671586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7671590">l1</span><span class="op" id="7671592">,</span>&nbsp;<span class="ident" id="7671594">port</span>&nbsp;<span class="op" id="7671599">:=</span>&nbsp;<span class="ident" id="7671602">usableListenPacketPort</span><span class="op" id="7671624">(</span><span class="ident" id="7671625">t</span><span class="op" id="7671626">,</span>&nbsp;<span class="ident" id="7671628">tt</span><span class="op" id="7671630">.</span><span class="ident" id="7671631">net1</span><span class="op" id="7671635">,</span>&nbsp;<span class="ident" id="7671637">tt</span><span class="op" id="7671639">.</span><span class="ident" id="7671640">laddr1</span><span class="op" id="7671646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7671650">laddr</span>&nbsp;<span class="op" id="7671656">:=</span>&nbsp;<span class="ident" id="7671659">tt</span><span class="op" id="7671661">.</span><span class="ident" id="7671662">laddr1</span>&nbsp;<span class="op" id="7671669">+</span>&nbsp;<span class="string" id="7671671">&#34;:&#34;</span>&nbsp;<span class="op" id="7671675">+</span>&nbsp;<span class="ident" id="7671677">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7671684">checkFirstListener</span><span class="op" id="7671702">(</span><span class="ident" id="7671703">t</span><span class="op" id="7671704">,</span>&nbsp;<span class="ident" id="7671706">tt</span><span class="op" id="7671708">.</span><span class="ident" id="7671709">net1</span><span class="op" id="7671713">,</span>&nbsp;<span class="ident" id="7671715">laddr</span><span class="op" id="7671720">,</span>&nbsp;<span class="ident" id="7671722">l1</span><span class="op" id="7671724">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7671728">laddr</span>&nbsp;<span class="op" id="7671734">=</span>&nbsp;<span class="ident" id="7671736">tt</span><span class="op" id="7671738">.</span><span class="ident" id="7671739">laddr2</span>&nbsp;<span class="op" id="7671746">+</span>&nbsp;<span class="string" id="7671748">&#34;:&#34;</span>&nbsp;<span class="op" id="7671752">+</span>&nbsp;<span class="ident" id="7671754">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7671761">l2</span><span class="op" id="7671763">,</span>&nbsp;<span class="ident" id="7671765">err</span>&nbsp;<span class="op" id="7671769">:=</span>&nbsp;<span class="ident" id="7671772">ListenPacket</span><span class="op" id="7671784">(</span><span class="ident" id="7671785">tt</span><span class="op" id="7671787">.</span><span class="ident" id="7671788">net2</span><span class="op" id="7671792">,</span>&nbsp;<span class="ident" id="7671794">laddr</span><span class="op" id="7671799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7671803">checkDualStackSecondListener</span><span class="op" id="7671831">(</span><span class="ident" id="7671832">t</span><span class="op" id="7671833">,</span>&nbsp;<span class="ident" id="7671835">tt</span><span class="op" id="7671837">.</span><span class="ident" id="7671838">net2</span><span class="op" id="7671842">,</span>&nbsp;<span class="ident" id="7671844">laddr</span><span class="op" id="7671849">,</span>&nbsp;<span class="ident" id="7671851">tt</span><span class="op" id="7671853">.</span><span class="ident" id="7671854">xerr</span><span class="op" id="7671858">,</span>&nbsp;<span class="ident" id="7671860">err</span><span class="op" id="7671863">,</span>&nbsp;<span class="ident" id="7671865">l2</span><span class="op" id="7671867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7671871">l1</span><span class="op" id="7671873">.</span><span class="ident" id="7671874">Close</span><span class="op" id="7671879">(</span><span class="op" id="7671880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7671883">}</span><br>
<span class="lineno">250</span><span class="op" id="7671885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7671888">func</span>&nbsp;<span class="ident" id="7671893">usableListenPort</span><span class="op" id="7671909">(</span><span class="ident" id="7671910">t</span>&nbsp;<span class="op" id="7671912">*</span><span class="ident" id="7671913">testing</span><span class="op" id="7671920">.</span><span class="ident" id="7671921">T</span><span class="op" id="7671922">,</span>&nbsp;<span class="ident" id="7671924">net</span><span class="op" id="7671927">,</span>&nbsp;<span class="ident" id="7671929">laddr</span>&nbsp;<span class="builtintype" id="7671935">string</span><span class="op" id="7671941">)</span>&nbsp;<span class="op" id="7671943">(</span><span class="ident" id="7671944">l</span>&nbsp;<span class="ident" id="7671946">Listener</span><span class="op" id="7671954">,</span>&nbsp;<span class="ident" id="7671956">port</span>&nbsp;<span class="builtintype" id="7671961">string</span><span class="op" id="7671967">)</span>&nbsp;<span class="op" id="7671969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7671972">var</span>&nbsp;<span class="ident" id="7671976">nladdr</span>&nbsp;<span class="builtintype" id="7671983">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7671991">var</span>&nbsp;<span class="ident" id="7671995">err</span>&nbsp;<span class="builtintype" id="7671999">error</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7672006">switch</span>&nbsp;<span class="ident" id="7672013">net</span>&nbsp;<span class="op" id="7672017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7672020">default</span><span class="op" id="7672027">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7672031">panic</span><span class="op" id="7672036">(</span><span class="string" id="7672037">&#34;usableListenPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="7672061">+</span>&nbsp;<span class="ident" id="7672063">net</span><span class="op" id="7672066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7672069">case</span>&nbsp;<span class="string" id="7672074">&#34;tcp&#34;</span><span class="op" id="7672079">,</span>&nbsp;<span class="string" id="7672081">&#34;tcp4&#34;</span><span class="op" id="7672087">,</span>&nbsp;<span class="string" id="7672089">&#34;tcp6&#34;</span><span class="op" id="7672095">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7672099">l</span><span class="op" id="7672100">,</span>&nbsp;<span class="ident" id="7672102">err</span>&nbsp;<span class="op" id="7672106">=</span>&nbsp;<span class="ident" id="7672108">Listen</span><span class="op" id="7672114">(</span><span class="ident" id="7672115">net</span><span class="op" id="7672118">,</span>&nbsp;<span class="ident" id="7672120">laddr</span><span class="op" id="7672125">+</span><span class="string" id="7672126">&#34;:0&#34;</span><span class="op" id="7672130">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7672134">if</span>&nbsp;<span class="ident" id="7672137">err</span>&nbsp;<span class="op" id="7672141">!=</span>&nbsp;<span class="ident" id="7672144">nil</span>&nbsp;<span class="op" id="7672148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7672153">t</span><span class="op" id="7672154">.</span><span class="ident" id="7672155">Fatalf</span><span class="op" id="7672161">(</span><span class="string" id="7672162">&#34;Probe&nbsp;Listen(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7672195">,</span>&nbsp;<span class="ident" id="7672197">net</span><span class="op" id="7672200">,</span>&nbsp;<span class="ident" id="7672202">laddr</span><span class="op" id="7672207">,</span>&nbsp;<span class="ident" id="7672209">err</span><span class="op" id="7672212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7672216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7672220">nladdr</span>&nbsp;<span class="op" id="7672227">=</span>&nbsp;<span class="ident" id="7672229">l</span><span class="op" id="7672230">.</span><span class="op" id="7672231">(</span><span class="op" id="7672232">*</span><span class="ident" id="7672233">TCPListener</span><span class="op" id="7672244">)</span><span class="op" id="7672245">.</span><span class="ident" id="7672246">Addr</span><span class="op" id="7672250">(</span><span class="op" id="7672251">)</span><span class="op" id="7672252">.</span><span class="ident" id="7672253">String</span><span class="op" id="7672259">(</span><span class="op" id="7672260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7672263">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7672266">_</span><span class="op" id="7672267">,</span>&nbsp;<span class="ident" id="7672269">port</span><span class="op" id="7672273">,</span>&nbsp;<span class="ident" id="7672275">err</span>&nbsp;<span class="op" id="7672279">=</span>&nbsp;<span class="ident" id="7672281">SplitHostPort</span><span class="op" id="7672294">(</span><span class="ident" id="7672295">nladdr</span><span class="op" id="7672301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7672304">if</span>&nbsp;<span class="ident" id="7672307">err</span>&nbsp;<span class="op" id="7672311">!=</span>&nbsp;<span class="ident" id="7672314">nil</span>&nbsp;<span class="op" id="7672318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7672322">t</span><span class="op" id="7672323">.</span><span class="ident" id="7672324">Fatalf</span><span class="op" id="7672330">(</span><span class="string" id="7672331">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7672357">,</span>&nbsp;<span class="ident" id="7672359">err</span><span class="op" id="7672362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7672365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7672368">return</span>&nbsp;<span class="ident" id="7672375">l</span><span class="op" id="7672376">,</span>&nbsp;<span class="ident" id="7672378">port</span><br>
<span class="lineno">270</span><span class="op" id="7672383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7672386">func</span>&nbsp;<span class="ident" id="7672391">usableListenPacketPort</span><span class="op" id="7672413">(</span><span class="ident" id="7672414">t</span>&nbsp;<span class="op" id="7672416">*</span><span class="ident" id="7672417">testing</span><span class="op" id="7672424">.</span><span class="ident" id="7672425">T</span><span class="op" id="7672426">,</span>&nbsp;<span class="ident" id="7672428">net</span><span class="op" id="7672431">,</span>&nbsp;<span class="ident" id="7672433">laddr</span>&nbsp;<span class="builtintype" id="7672439">string</span><span class="op" id="7672445">)</span>&nbsp;<span class="op" id="7672447">(</span><span class="ident" id="7672448">l</span>&nbsp;<span class="ident" id="7672450">PacketConn</span><span class="op" id="7672460">,</span>&nbsp;<span class="ident" id="7672462">port</span>&nbsp;<span class="builtintype" id="7672467">string</span><span class="op" id="7672473">)</span>&nbsp;<span class="op" id="7672475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7672478">var</span>&nbsp;<span class="ident" id="7672482">nladdr</span>&nbsp;<span class="builtintype" id="7672489">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7672497">var</span>&nbsp;<span class="ident" id="7672501">err</span>&nbsp;<span class="builtintype" id="7672505">error</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7672512">switch</span>&nbsp;<span class="ident" id="7672519">net</span>&nbsp;<span class="op" id="7672523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7672526">default</span><span class="op" id="7672533">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7672537">panic</span><span class="op" id="7672542">(</span><span class="string" id="7672543">&#34;usableListenPacketPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="7672573">+</span>&nbsp;<span class="ident" id="7672575">net</span><span class="op" id="7672578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7672581">case</span>&nbsp;<span class="string" id="7672586">&#34;udp&#34;</span><span class="op" id="7672591">,</span>&nbsp;<span class="string" id="7672593">&#34;udp4&#34;</span><span class="op" id="7672599">,</span>&nbsp;<span class="string" id="7672601">&#34;udp6&#34;</span><span class="op" id="7672607">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7672611">l</span><span class="op" id="7672612">,</span>&nbsp;<span class="ident" id="7672614">err</span>&nbsp;<span class="op" id="7672618">=</span>&nbsp;<span class="ident" id="7672620">ListenPacket</span><span class="op" id="7672632">(</span><span class="ident" id="7672633">net</span><span class="op" id="7672636">,</span>&nbsp;<span class="ident" id="7672638">laddr</span><span class="op" id="7672643">+</span><span class="string" id="7672644">&#34;:0&#34;</span><span class="op" id="7672648">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7672652">if</span>&nbsp;<span class="ident" id="7672655">err</span>&nbsp;<span class="op" id="7672659">!=</span>&nbsp;<span class="ident" id="7672662">nil</span>&nbsp;<span class="op" id="7672666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7672671">t</span><span class="op" id="7672672">.</span><span class="ident" id="7672673">Fatalf</span><span class="op" id="7672679">(</span><span class="string" id="7672680">&#34;Probe&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7672719">,</span>&nbsp;<span class="ident" id="7672721">net</span><span class="op" id="7672724">,</span>&nbsp;<span class="ident" id="7672726">laddr</span><span class="op" id="7672731">,</span>&nbsp;<span class="ident" id="7672733">err</span><span class="op" id="7672736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7672740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7672744">nladdr</span>&nbsp;<span class="op" id="7672751">=</span>&nbsp;<span class="ident" id="7672753">l</span><span class="op" id="7672754">.</span><span class="op" id="7672755">(</span><span class="op" id="7672756">*</span><span class="ident" id="7672757">UDPConn</span><span class="op" id="7672764">)</span><span class="op" id="7672765">.</span><span class="ident" id="7672766">LocalAddr</span><span class="op" id="7672775">(</span><span class="op" id="7672776">)</span><span class="op" id="7672777">.</span><span class="ident" id="7672778">String</span><span class="op" id="7672784">(</span><span class="op" id="7672785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7672788">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7672791">_</span><span class="op" id="7672792">,</span>&nbsp;<span class="ident" id="7672794">port</span><span class="op" id="7672798">,</span>&nbsp;<span class="ident" id="7672800">err</span>&nbsp;<span class="op" id="7672804">=</span>&nbsp;<span class="ident" id="7672806">SplitHostPort</span><span class="op" id="7672819">(</span><span class="ident" id="7672820">nladdr</span><span class="op" id="7672826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7672829">if</span>&nbsp;<span class="ident" id="7672832">err</span>&nbsp;<span class="op" id="7672836">!=</span>&nbsp;<span class="ident" id="7672839">nil</span>&nbsp;<span class="op" id="7672843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7672847">t</span><span class="op" id="7672848">.</span><span class="ident" id="7672849">Fatalf</span><span class="op" id="7672855">(</span><span class="string" id="7672856">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7672882">,</span>&nbsp;<span class="ident" id="7672884">err</span><span class="op" id="7672887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7672890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7672893">return</span>&nbsp;<span class="ident" id="7672900">l</span><span class="op" id="7672901">,</span>&nbsp;<span class="ident" id="7672903">port</span><br>
<span class="lineno">290</span><span class="op" id="7672908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7672911">func</span>&nbsp;<span class="ident" id="7672916">differentWildcardAddr</span><span class="op" id="7672937">(</span><span class="ident" id="7672938">i</span><span class="op" id="7672939">,</span>&nbsp;<span class="ident" id="7672941">j</span>&nbsp;<span class="builtintype" id="7672943">string</span><span class="op" id="7672949">)</span>&nbsp;<span class="builtintype" id="7672951">bool</span>&nbsp;<span class="op" id="7672956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7672959">if</span>&nbsp;<span class="op" id="7672962">(</span><span class="ident" id="7672963">i</span>&nbsp;<span class="op" id="7672965">==</span>&nbsp;<span class="string" id="7672968">&#34;&#34;</span>&nbsp;<span class="op" id="7672971">||</span>&nbsp;<span class="ident" id="7672974">i</span>&nbsp;<span class="op" id="7672976">==</span>&nbsp;<span class="string" id="7672979">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="7672989">||</span>&nbsp;<span class="ident" id="7672992">i</span>&nbsp;<span class="op" id="7672994">==</span>&nbsp;<span class="string" id="7672997">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="7673013">)</span>&nbsp;<span class="op" id="7673015">&amp;&amp;</span>&nbsp;<span class="op" id="7673018">(</span><span class="ident" id="7673019">j</span>&nbsp;<span class="op" id="7673021">==</span>&nbsp;<span class="string" id="7673024">&#34;&#34;</span>&nbsp;<span class="op" id="7673027">||</span>&nbsp;<span class="ident" id="7673030">j</span>&nbsp;<span class="op" id="7673032">==</span>&nbsp;<span class="string" id="7673035">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="7673045">||</span>&nbsp;<span class="ident" id="7673048">j</span>&nbsp;<span class="op" id="7673050">==</span>&nbsp;<span class="string" id="7673053">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="7673069">)</span>&nbsp;<span class="op" id="7673071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7673075">return</span>&nbsp;<span class="builtintype" id="7673082">false</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7673089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7673092">if</span>&nbsp;<span class="ident" id="7673095">i</span>&nbsp;<span class="op" id="7673097">==</span>&nbsp;<span class="string" id="7673100">&#34;[::]&#34;</span>&nbsp;<span class="op" id="7673107">&amp;&amp;</span>&nbsp;<span class="ident" id="7673110">j</span>&nbsp;<span class="op" id="7673112">==</span>&nbsp;<span class="string" id="7673115">&#34;[::]&#34;</span>&nbsp;<span class="op" id="7673122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7673126">return</span>&nbsp;<span class="builtintype" id="7673133">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7673140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7673143">return</span>&nbsp;<span class="builtintype" id="7673150">true</span><br>
<span class="lineno">300</span><span class="op" id="7673155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7673158">func</span>&nbsp;<span class="ident" id="7673163">checkFirstListener</span><span class="op" id="7673181">(</span><span class="ident" id="7673182">t</span>&nbsp;<span class="op" id="7673184">*</span><span class="ident" id="7673185">testing</span><span class="op" id="7673192">.</span><span class="ident" id="7673193">T</span><span class="op" id="7673194">,</span>&nbsp;<span class="ident" id="7673196">net</span><span class="op" id="7673199">,</span>&nbsp;<span class="ident" id="7673201">laddr</span>&nbsp;<span class="builtintype" id="7673207">string</span><span class="op" id="7673213">,</span>&nbsp;<span class="ident" id="7673215">l</span>&nbsp;<span class="keyword" id="7673217">interface</span><span class="op" id="7673226">{</span><span class="op" id="7673227">}</span><span class="op" id="7673228">)</span>&nbsp;<span class="op" id="7673230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7673233">switch</span>&nbsp;<span class="ident" id="7673240">net</span>&nbsp;<span class="op" id="7673244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7673247">case</span>&nbsp;<span class="string" id="7673252">&#34;tcp&#34;</span><span class="op" id="7673257">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7673261">fd</span>&nbsp;<span class="op" id="7673264">:=</span>&nbsp;<span class="ident" id="7673267">l</span><span class="op" id="7673268">.</span><span class="op" id="7673269">(</span><span class="op" id="7673270">*</span><span class="ident" id="7673271">TCPListener</span><span class="op" id="7673282">)</span><span class="op" id="7673283">.</span><span class="ident" id="7673284">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7673289">checkDualStackAddrFamily</span><span class="op" id="7673313">(</span><span class="ident" id="7673314">t</span><span class="op" id="7673315">,</span>&nbsp;<span class="ident" id="7673317">net</span><span class="op" id="7673320">,</span>&nbsp;<span class="ident" id="7673322">laddr</span><span class="op" id="7673327">,</span>&nbsp;<span class="ident" id="7673329">fd</span><span class="op" id="7673331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7673334">case</span>&nbsp;<span class="string" id="7673339">&#34;tcp4&#34;</span><span class="op" id="7673345">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7673349">fd</span>&nbsp;<span class="op" id="7673352">:=</span>&nbsp;<span class="ident" id="7673355">l</span><span class="op" id="7673356">.</span><span class="op" id="7673357">(</span><span class="op" id="7673358">*</span><span class="ident" id="7673359">TCPListener</span><span class="op" id="7673370">)</span><span class="op" id="7673371">.</span><span class="ident" id="7673372">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7673377">if</span>&nbsp;<span class="ident" id="7673380">fd</span><span class="op" id="7673382">.</span><span class="ident" id="7673383">family</span>&nbsp;<span class="op" id="7673390">!=</span>&nbsp;<span class="ident" id="7673393">syscall</span><span class="op" id="7673400">.</span><span class="ident" id="7673401">AF_INET</span>&nbsp;<span class="op" id="7673409">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7673414">t</span><span class="op" id="7673415">.</span><span class="ident" id="7673416">Fatalf</span><span class="op" id="7673422">(</span><span class="string" id="7673423">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7673484">,</span>&nbsp;<span class="ident" id="7673486">net</span><span class="op" id="7673489">,</span>&nbsp;<span class="ident" id="7673491">laddr</span><span class="op" id="7673496">,</span>&nbsp;<span class="ident" id="7673498">fd</span><span class="op" id="7673500">.</span><span class="ident" id="7673501">family</span><span class="op" id="7673507">,</span>&nbsp;<span class="ident" id="7673509">syscall</span><span class="op" id="7673516">.</span><span class="ident" id="7673517">AF_INET</span><span class="op" id="7673524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7673528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7673531">case</span>&nbsp;<span class="string" id="7673536">&#34;tcp6&#34;</span><span class="op" id="7673542">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7673546">fd</span>&nbsp;<span class="op" id="7673549">:=</span>&nbsp;<span class="ident" id="7673552">l</span><span class="op" id="7673553">.</span><span class="op" id="7673554">(</span><span class="op" id="7673555">*</span><span class="ident" id="7673556">TCPListener</span><span class="op" id="7673567">)</span><span class="op" id="7673568">.</span><span class="ident" id="7673569">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7673574">if</span>&nbsp;<span class="ident" id="7673577">fd</span><span class="op" id="7673579">.</span><span class="ident" id="7673580">family</span>&nbsp;<span class="op" id="7673587">!=</span>&nbsp;<span class="ident" id="7673590">syscall</span><span class="op" id="7673597">.</span><span class="ident" id="7673598">AF_INET6</span>&nbsp;<span class="op" id="7673607">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7673612">t</span><span class="op" id="7673613">.</span><span class="ident" id="7673614">Fatalf</span><span class="op" id="7673620">(</span><span class="string" id="7673621">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7673682">,</span>&nbsp;<span class="ident" id="7673684">net</span><span class="op" id="7673687">,</span>&nbsp;<span class="ident" id="7673689">laddr</span><span class="op" id="7673694">,</span>&nbsp;<span class="ident" id="7673696">fd</span><span class="op" id="7673698">.</span><span class="ident" id="7673699">family</span><span class="op" id="7673705">,</span>&nbsp;<span class="ident" id="7673707">syscall</span><span class="op" id="7673714">.</span><span class="ident" id="7673715">AF_INET6</span><span class="op" id="7673723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7673727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7673730">case</span>&nbsp;<span class="string" id="7673735">&#34;udp&#34;</span><span class="op" id="7673740">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7673744">fd</span>&nbsp;<span class="op" id="7673747">:=</span>&nbsp;<span class="ident" id="7673750">l</span><span class="op" id="7673751">.</span><span class="op" id="7673752">(</span><span class="op" id="7673753">*</span><span class="ident" id="7673754">UDPConn</span><span class="op" id="7673761">)</span><span class="op" id="7673762">.</span><span class="ident" id="7673763">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7673768">checkDualStackAddrFamily</span><span class="op" id="7673792">(</span><span class="ident" id="7673793">t</span><span class="op" id="7673794">,</span>&nbsp;<span class="ident" id="7673796">net</span><span class="op" id="7673799">,</span>&nbsp;<span class="ident" id="7673801">laddr</span><span class="op" id="7673806">,</span>&nbsp;<span class="ident" id="7673808">fd</span><span class="op" id="7673810">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7673813">case</span>&nbsp;<span class="string" id="7673818">&#34;udp4&#34;</span><span class="op" id="7673824">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7673828">fd</span>&nbsp;<span class="op" id="7673831">:=</span>&nbsp;<span class="ident" id="7673834">l</span><span class="op" id="7673835">.</span><span class="op" id="7673836">(</span><span class="op" id="7673837">*</span><span class="ident" id="7673838">UDPConn</span><span class="op" id="7673845">)</span><span class="op" id="7673846">.</span><span class="ident" id="7673847">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7673852">if</span>&nbsp;<span class="ident" id="7673855">fd</span><span class="op" id="7673857">.</span><span class="ident" id="7673858">family</span>&nbsp;<span class="op" id="7673865">!=</span>&nbsp;<span class="ident" id="7673868">syscall</span><span class="op" id="7673875">.</span><span class="ident" id="7673876">AF_INET</span>&nbsp;<span class="op" id="7673884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7673889">t</span><span class="op" id="7673890">.</span><span class="ident" id="7673891">Fatalf</span><span class="op" id="7673897">(</span><span class="string" id="7673898">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7673965">,</span>&nbsp;<span class="ident" id="7673967">net</span><span class="op" id="7673970">,</span>&nbsp;<span class="ident" id="7673972">laddr</span><span class="op" id="7673977">,</span>&nbsp;<span class="ident" id="7673979">fd</span><span class="op" id="7673981">.</span><span class="ident" id="7673982">family</span><span class="op" id="7673988">,</span>&nbsp;<span class="ident" id="7673990">syscall</span><span class="op" id="7673997">.</span><span class="ident" id="7673998">AF_INET</span><span class="op" id="7674005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7674009">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7674012">case</span>&nbsp;<span class="string" id="7674017">&#34;udp6&#34;</span><span class="op" id="7674023">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7674027">fd</span>&nbsp;<span class="op" id="7674030">:=</span>&nbsp;<span class="ident" id="7674033">l</span><span class="op" id="7674034">.</span><span class="op" id="7674035">(</span><span class="op" id="7674036">*</span><span class="ident" id="7674037">UDPConn</span><span class="op" id="7674044">)</span><span class="op" id="7674045">.</span><span class="ident" id="7674046">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7674051">if</span>&nbsp;<span class="ident" id="7674054">fd</span><span class="op" id="7674056">.</span><span class="ident" id="7674057">family</span>&nbsp;<span class="op" id="7674064">!=</span>&nbsp;<span class="ident" id="7674067">syscall</span><span class="op" id="7674074">.</span><span class="ident" id="7674075">AF_INET6</span>&nbsp;<span class="op" id="7674084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7674089">t</span><span class="op" id="7674090">.</span><span class="ident" id="7674091">Fatalf</span><span class="op" id="7674097">(</span><span class="string" id="7674098">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7674165">,</span>&nbsp;<span class="ident" id="7674167">net</span><span class="op" id="7674170">,</span>&nbsp;<span class="ident" id="7674172">laddr</span><span class="op" id="7674177">,</span>&nbsp;<span class="ident" id="7674179">fd</span><span class="op" id="7674181">.</span><span class="ident" id="7674182">family</span><span class="op" id="7674188">,</span>&nbsp;<span class="ident" id="7674190">syscall</span><span class="op" id="7674197">.</span><span class="ident" id="7674198">AF_INET6</span><span class="op" id="7674206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7674210">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7674213">default</span><span class="op" id="7674220">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7674224">t</span><span class="op" id="7674225">.</span><span class="ident" id="7674226">Fatalf</span><span class="op" id="7674232">(</span><span class="string" id="7674233">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="7674257">,</span>&nbsp;<span class="ident" id="7674259">net</span><span class="op" id="7674262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7674265">}</span><br>
<span class="lineno"></span><span class="op" id="7674267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="7674270">func</span>&nbsp;<span class="ident" id="7674275">checkSecondListener</span><span class="op" id="7674294">(</span><span class="ident" id="7674295">t</span>&nbsp;<span class="op" id="7674297">*</span><span class="ident" id="7674298">testing</span><span class="op" id="7674305">.</span><span class="ident" id="7674306">T</span><span class="op" id="7674307">,</span>&nbsp;<span class="ident" id="7674309">net</span><span class="op" id="7674312">,</span>&nbsp;<span class="ident" id="7674314">laddr</span>&nbsp;<span class="builtintype" id="7674320">string</span><span class="op" id="7674326">,</span>&nbsp;<span class="ident" id="7674328">err</span>&nbsp;<span class="builtintype" id="7674332">error</span><span class="op" id="7674337">,</span>&nbsp;<span class="ident" id="7674339">l</span>&nbsp;<span class="keyword" id="7674341">interface</span><span class="op" id="7674350">{</span><span class="op" id="7674351">}</span><span class="op" id="7674352">)</span>&nbsp;<span class="op" id="7674354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7674357">switch</span>&nbsp;<span class="ident" id="7674364">net</span>&nbsp;<span class="op" id="7674368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7674371">case</span>&nbsp;<span class="string" id="7674376">&#34;tcp&#34;</span><span class="op" id="7674381">,</span>&nbsp;<span class="string" id="7674383">&#34;tcp4&#34;</span><span class="op" id="7674389">,</span>&nbsp;<span class="string" id="7674391">&#34;tcp6&#34;</span><span class="op" id="7674397">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7674401">if</span>&nbsp;<span class="ident" id="7674404">err</span>&nbsp;<span class="op" id="7674408">==</span>&nbsp;<span class="ident" id="7674411">nil</span>&nbsp;<span class="op" id="7674415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7674420">l</span><span class="op" id="7674421">.</span><span class="op" id="7674422">(</span><span class="op" id="7674423">*</span><span class="ident" id="7674424">TCPListener</span><span class="op" id="7674435">)</span><span class="op" id="7674436">.</span><span class="ident" id="7674437">Close</span><span class="op" id="7674442">(</span><span class="op" id="7674443">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7674448">t</span><span class="op" id="7674449">.</span><span class="ident" id="7674450">Fatalf</span><span class="op" id="7674456">(</span><span class="string" id="7674457">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7674492">,</span>&nbsp;<span class="ident" id="7674494">net</span><span class="op" id="7674497">,</span>&nbsp;<span class="ident" id="7674499">laddr</span><span class="op" id="7674504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7674508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7674511">case</span>&nbsp;<span class="string" id="7674516">&#34;udp&#34;</span><span class="op" id="7674521">,</span>&nbsp;<span class="string" id="7674523">&#34;udp4&#34;</span><span class="op" id="7674529">,</span>&nbsp;<span class="string" id="7674531">&#34;udp6&#34;</span><span class="op" id="7674537">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7674541">if</span>&nbsp;<span class="ident" id="7674544">err</span>&nbsp;<span class="op" id="7674548">==</span>&nbsp;<span class="ident" id="7674551">nil</span>&nbsp;<span class="op" id="7674555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7674560">l</span><span class="op" id="7674561">.</span><span class="op" id="7674562">(</span><span class="op" id="7674563">*</span><span class="ident" id="7674564">UDPConn</span><span class="op" id="7674571">)</span><span class="op" id="7674572">.</span><span class="ident" id="7674573">Close</span><span class="op" id="7674578">(</span><span class="op" id="7674579">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7674584">t</span><span class="op" id="7674585">.</span><span class="ident" id="7674586">Fatalf</span><span class="op" id="7674592">(</span><span class="string" id="7674593">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7674634">,</span>&nbsp;<span class="ident" id="7674636">net</span><span class="op" id="7674639">,</span>&nbsp;<span class="ident" id="7674641">laddr</span><span class="op" id="7674646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7674650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7674653">default</span><span class="op" id="7674660">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7674664">t</span><span class="op" id="7674665">.</span><span class="ident" id="7674666">Fatalf</span><span class="op" id="7674672">(</span><span class="string" id="7674673">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="7674697">,</span>&nbsp;<span class="ident" id="7674699">net</span><span class="op" id="7674702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7674705">}</span><br>
<span class="lineno">350</span><span class="op" id="7674707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7674710">func</span>&nbsp;<span class="ident" id="7674715">checkDualStackSecondListener</span><span class="op" id="7674743">(</span><span class="ident" id="7674744">t</span>&nbsp;<span class="op" id="7674746">*</span><span class="ident" id="7674747">testing</span><span class="op" id="7674754">.</span><span class="ident" id="7674755">T</span><span class="op" id="7674756">,</span>&nbsp;<span class="ident" id="7674758">net</span><span class="op" id="7674761">,</span>&nbsp;<span class="ident" id="7674763">laddr</span>&nbsp;<span class="builtintype" id="7674769">string</span><span class="op" id="7674775">,</span>&nbsp;<span class="ident" id="7674777">xerr</span><span class="op" id="7674781">,</span>&nbsp;<span class="ident" id="7674783">err</span>&nbsp;<span class="builtintype" id="7674787">error</span><span class="op" id="7674792">,</span>&nbsp;<span class="ident" id="7674794">l</span>&nbsp;<span class="keyword" id="7674796">interface</span><span class="op" id="7674805">{</span><span class="op" id="7674806">}</span><span class="op" id="7674807">)</span>&nbsp;<span class="op" id="7674809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7674812">switch</span>&nbsp;<span class="ident" id="7674819">net</span>&nbsp;<span class="op" id="7674823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7674826">case</span>&nbsp;<span class="string" id="7674831">&#34;tcp&#34;</span><span class="op" id="7674836">,</span>&nbsp;<span class="string" id="7674838">&#34;tcp4&#34;</span><span class="op" id="7674844">,</span>&nbsp;<span class="string" id="7674846">&#34;tcp6&#34;</span><span class="op" id="7674852">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7674856">if</span>&nbsp;<span class="ident" id="7674859">xerr</span>&nbsp;<span class="op" id="7674864">==</span>&nbsp;<span class="ident" id="7674867">nil</span>&nbsp;<span class="op" id="7674871">&amp;&amp;</span>&nbsp;<span class="ident" id="7674874">err</span>&nbsp;<span class="op" id="7674878">!=</span>&nbsp;<span class="ident" id="7674881">nil</span>&nbsp;<span class="op" id="7674885">||</span>&nbsp;<span class="ident" id="7674888">xerr</span>&nbsp;<span class="op" id="7674893">!=</span>&nbsp;<span class="ident" id="7674896">nil</span>&nbsp;<span class="op" id="7674900">&amp;&amp;</span>&nbsp;<span class="ident" id="7674903">err</span>&nbsp;<span class="op" id="7674907">==</span>&nbsp;<span class="ident" id="7674910">nil</span>&nbsp;<span class="op" id="7674914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7674919">t</span><span class="op" id="7674920">.</span><span class="ident" id="7674921">Fatalf</span><span class="op" id="7674927">(</span><span class="string" id="7674928">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7674975">,</span>&nbsp;<span class="ident" id="7674977">net</span><span class="op" id="7674980">,</span>&nbsp;<span class="ident" id="7674982">laddr</span><span class="op" id="7674987">,</span>&nbsp;<span class="ident" id="7674989">err</span><span class="op" id="7674992">,</span>&nbsp;<span class="ident" id="7674994">xerr</span><span class="op" id="7674998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7675002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7675006">if</span>&nbsp;<span class="ident" id="7675009">err</span>&nbsp;<span class="op" id="7675013">==</span>&nbsp;<span class="ident" id="7675016">nil</span>&nbsp;<span class="op" id="7675020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7675025">l</span><span class="op" id="7675026">.</span><span class="op" id="7675027">(</span><span class="op" id="7675028">*</span><span class="ident" id="7675029">TCPListener</span><span class="op" id="7675040">)</span><span class="op" id="7675041">.</span><span class="ident" id="7675042">Close</span><span class="op" id="7675047">(</span><span class="op" id="7675048">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7675052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7675055">case</span>&nbsp;<span class="string" id="7675060">&#34;udp&#34;</span><span class="op" id="7675065">,</span>&nbsp;<span class="string" id="7675067">&#34;udp4&#34;</span><span class="op" id="7675073">,</span>&nbsp;<span class="string" id="7675075">&#34;udp6&#34;</span><span class="op" id="7675081">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7675085">if</span>&nbsp;<span class="ident" id="7675088">xerr</span>&nbsp;<span class="op" id="7675093">==</span>&nbsp;<span class="ident" id="7675096">nil</span>&nbsp;<span class="op" id="7675100">&amp;&amp;</span>&nbsp;<span class="ident" id="7675103">err</span>&nbsp;<span class="op" id="7675107">!=</span>&nbsp;<span class="ident" id="7675110">nil</span>&nbsp;<span class="op" id="7675114">||</span>&nbsp;<span class="ident" id="7675117">xerr</span>&nbsp;<span class="op" id="7675122">!=</span>&nbsp;<span class="ident" id="7675125">nil</span>&nbsp;<span class="op" id="7675129">&amp;&amp;</span>&nbsp;<span class="ident" id="7675132">err</span>&nbsp;<span class="op" id="7675136">==</span>&nbsp;<span class="ident" id="7675139">nil</span>&nbsp;<span class="op" id="7675143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7675148">t</span><span class="op" id="7675149">.</span><span class="ident" id="7675150">Fatalf</span><span class="op" id="7675156">(</span><span class="string" id="7675157">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7675210">,</span>&nbsp;<span class="ident" id="7675212">net</span><span class="op" id="7675215">,</span>&nbsp;<span class="ident" id="7675217">laddr</span><span class="op" id="7675222">,</span>&nbsp;<span class="ident" id="7675224">err</span><span class="op" id="7675227">,</span>&nbsp;<span class="ident" id="7675229">xerr</span><span class="op" id="7675233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7675237">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7675241">if</span>&nbsp;<span class="ident" id="7675244">err</span>&nbsp;<span class="op" id="7675248">==</span>&nbsp;<span class="ident" id="7675251">nil</span>&nbsp;<span class="op" id="7675255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7675260">l</span><span class="op" id="7675261">.</span><span class="op" id="7675262">(</span><span class="op" id="7675263">*</span><span class="ident" id="7675264">UDPConn</span><span class="op" id="7675271">)</span><span class="op" id="7675272">.</span><span class="ident" id="7675273">Close</span><span class="op" id="7675278">(</span><span class="op" id="7675279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7675283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7675286">default</span><span class="op" id="7675293">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7675297">t</span><span class="op" id="7675298">.</span><span class="ident" id="7675299">Fatalf</span><span class="op" id="7675305">(</span><span class="string" id="7675306">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="7675330">,</span>&nbsp;<span class="ident" id="7675332">net</span><span class="op" id="7675335">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7675338">}</span><br>
<span class="lineno"></span><span class="op" id="7675340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7675343">func</span>&nbsp;<span class="ident" id="7675348">checkDualStackAddrFamily</span><span class="op" id="7675372">(</span><span class="ident" id="7675373">t</span>&nbsp;<span class="op" id="7675375">*</span><span class="ident" id="7675376">testing</span><span class="op" id="7675383">.</span><span class="ident" id="7675384">T</span><span class="op" id="7675385">,</span>&nbsp;<span class="ident" id="7675387">net</span><span class="op" id="7675390">,</span>&nbsp;<span class="ident" id="7675392">laddr</span>&nbsp;<span class="builtintype" id="7675398">string</span><span class="op" id="7675404">,</span>&nbsp;<span class="ident" id="7675406">fd</span>&nbsp;<span class="op" id="7675409">*</span><span class="ident" id="7675410">netFD</span><span class="op" id="7675415">)</span>&nbsp;<span class="op" id="7675417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7675420">switch</span>&nbsp;<span class="ident" id="7675427">a</span>&nbsp;<span class="op" id="7675429">:=</span>&nbsp;<span class="ident" id="7675432">fd</span><span class="op" id="7675434">.</span><span class="ident" id="7675435">laddr</span><span class="op" id="7675440">.</span><span class="op" id="7675441">(</span><span class="keyword" id="7675442">type</span><span class="op" id="7675446">)</span>&nbsp;<span class="op" id="7675448">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7675451">case</span>&nbsp;<span class="op" id="7675456">*</span><span class="ident" id="7675457">TCPAddr</span><span class="op" id="7675464">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7675468">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7675524">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7675577">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7675634">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7675656">if</span>&nbsp;<span class="ident" id="7675659">supportsIPv4map</span>&nbsp;<span class="op" id="7675675">&amp;&amp;</span>&nbsp;<span class="ident" id="7675678">fd</span><span class="op" id="7675680">.</span><span class="ident" id="7675681">laddr</span><span class="op" id="7675686">.</span><span class="op" id="7675687">(</span><span class="op" id="7675688">*</span><span class="ident" id="7675689">TCPAddr</span><span class="op" id="7675696">)</span><span class="op" id="7675697">.</span><span class="ident" id="7675698">isWildcard</span><span class="op" id="7675708">(</span><span class="op" id="7675709">)</span>&nbsp;<span class="op" id="7675711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7675716">if</span>&nbsp;<span class="ident" id="7675719">fd</span><span class="op" id="7675721">.</span><span class="ident" id="7675722">family</span>&nbsp;<span class="op" id="7675729">!=</span>&nbsp;<span class="ident" id="7675732">syscall</span><span class="op" id="7675739">.</span><span class="ident" id="7675740">AF_INET6</span>&nbsp;<span class="op" id="7675749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7675755">t</span><span class="op" id="7675756">.</span><span class="ident" id="7675757">Fatalf</span><span class="op" id="7675763">(</span><span class="string" id="7675764">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7675819">,</span>&nbsp;<span class="ident" id="7675821">net</span><span class="op" id="7675824">,</span>&nbsp;<span class="ident" id="7675826">laddr</span><span class="op" id="7675831">,</span>&nbsp;<span class="ident" id="7675833">fd</span><span class="op" id="7675835">.</span><span class="ident" id="7675836">family</span><span class="op" id="7675842">,</span>&nbsp;<span class="ident" id="7675844">syscall</span><span class="op" id="7675851">.</span><span class="ident" id="7675852">AF_INET6</span><span class="op" id="7675860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7675865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7675869">}</span>&nbsp;<span class="keyword" id="7675871">else</span>&nbsp;<span class="op" id="7675876">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7675881">if</span>&nbsp;<span class="ident" id="7675884">fd</span><span class="op" id="7675886">.</span><span class="ident" id="7675887">family</span>&nbsp;<span class="op" id="7675894">!=</span>&nbsp;<span class="ident" id="7675897">a</span><span class="op" id="7675898">.</span><span class="ident" id="7675899">family</span><span class="op" id="7675905">(</span><span class="op" id="7675906">)</span>&nbsp;<span class="op" id="7675908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7675914">t</span><span class="op" id="7675915">.</span><span class="ident" id="7675916">Fatalf</span><span class="op" id="7675922">(</span><span class="string" id="7675923">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7675978">,</span>&nbsp;<span class="ident" id="7675980">net</span><span class="op" id="7675983">,</span>&nbsp;<span class="ident" id="7675985">laddr</span><span class="op" id="7675990">,</span>&nbsp;<span class="ident" id="7675992">fd</span><span class="op" id="7675994">.</span><span class="ident" id="7675995">family</span><span class="op" id="7676001">,</span>&nbsp;<span class="ident" id="7676003">a</span><span class="op" id="7676004">.</span><span class="ident" id="7676005">family</span><span class="op" id="7676011">(</span><span class="op" id="7676012">)</span><span class="op" id="7676013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7676018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7676022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7676025">case</span>&nbsp;<span class="op" id="7676030">*</span><span class="ident" id="7676031">UDPAddr</span><span class="op" id="7676038">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7676042">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7676098">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7676151">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7676208">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7676230">if</span>&nbsp;<span class="ident" id="7676233">supportsIPv4map</span>&nbsp;<span class="op" id="7676249">&amp;&amp;</span>&nbsp;<span class="ident" id="7676252">fd</span><span class="op" id="7676254">.</span><span class="ident" id="7676255">laddr</span><span class="op" id="7676260">.</span><span class="op" id="7676261">(</span><span class="op" id="7676262">*</span><span class="ident" id="7676263">UDPAddr</span><span class="op" id="7676270">)</span><span class="op" id="7676271">.</span><span class="ident" id="7676272">isWildcard</span><span class="op" id="7676282">(</span><span class="op" id="7676283">)</span>&nbsp;<span class="op" id="7676285">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7676290">if</span>&nbsp;<span class="ident" id="7676293">fd</span><span class="op" id="7676295">.</span><span class="ident" id="7676296">family</span>&nbsp;<span class="op" id="7676303">!=</span>&nbsp;<span class="ident" id="7676306">syscall</span><span class="op" id="7676313">.</span><span class="ident" id="7676314">AF_INET6</span>&nbsp;<span class="op" id="7676323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7676329">t</span><span class="op" id="7676330">.</span><span class="ident" id="7676331">Fatalf</span><span class="op" id="7676337">(</span><span class="string" id="7676338">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7676399">,</span>&nbsp;<span class="ident" id="7676401">net</span><span class="op" id="7676404">,</span>&nbsp;<span class="ident" id="7676406">laddr</span><span class="op" id="7676411">,</span>&nbsp;<span class="ident" id="7676413">fd</span><span class="op" id="7676415">.</span><span class="ident" id="7676416">family</span><span class="op" id="7676422">,</span>&nbsp;<span class="ident" id="7676424">syscall</span><span class="op" id="7676431">.</span><span class="ident" id="7676432">AF_INET6</span><span class="op" id="7676440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7676445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7676449">}</span>&nbsp;<span class="keyword" id="7676451">else</span>&nbsp;<span class="op" id="7676456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7676461">if</span>&nbsp;<span class="ident" id="7676464">fd</span><span class="op" id="7676466">.</span><span class="ident" id="7676467">family</span>&nbsp;<span class="op" id="7676474">!=</span>&nbsp;<span class="ident" id="7676477">a</span><span class="op" id="7676478">.</span><span class="ident" id="7676479">family</span><span class="op" id="7676485">(</span><span class="op" id="7676486">)</span>&nbsp;<span class="op" id="7676488">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7676494">t</span><span class="op" id="7676495">.</span><span class="ident" id="7676496">Fatalf</span><span class="op" id="7676502">(</span><span class="string" id="7676503">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7676564">,</span>&nbsp;<span class="ident" id="7676566">net</span><span class="op" id="7676569">,</span>&nbsp;<span class="ident" id="7676571">laddr</span><span class="op" id="7676576">,</span>&nbsp;<span class="ident" id="7676578">fd</span><span class="op" id="7676580">.</span><span class="ident" id="7676581">family</span><span class="op" id="7676587">,</span>&nbsp;<span class="ident" id="7676589">a</span><span class="op" id="7676590">.</span><span class="ident" id="7676591">family</span><span class="op" id="7676597">(</span><span class="op" id="7676598">)</span><span class="op" id="7676599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7676604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7676608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7676611">default</span><span class="op" id="7676618">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7676622">t</span><span class="op" id="7676623">.</span><span class="ident" id="7676624">Fatalf</span><span class="op" id="7676630">(</span><span class="string" id="7676631">&#34;Unexpected&nbsp;protocol&nbsp;address&nbsp;type:&nbsp;%T&#34;</span><span class="op" id="7676669">,</span>&nbsp;<span class="ident" id="7676671">a</span><span class="op" id="7676672">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7676675">}</span><br>
<span class="lineno"></span><span class="op" id="7676677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7676680">var</span>&nbsp;<span class="ident" id="7676684">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="7676711">=</span>&nbsp;<span class="op" id="7676713">[</span><span class="op" id="7676714">]</span><span class="keyword" id="7676715">struct</span>&nbsp;<span class="op" id="7676722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7676725">net</span>&nbsp;&nbsp;<span class="builtintype" id="7676730">string</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7676738">addr</span>&nbsp;<span class="builtintype" id="7676743">string</span><br>
<span class="lineno"></span><span class="op" id="7676750">}</span><span class="op" id="7676751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7676754">{</span><span class="string" id="7676755">&#34;tcp6&#34;</span><span class="op" id="7676761">,</span>&nbsp;<span class="string" id="7676763">&#34;127.0.0.1&#34;</span><span class="op" id="7676774">}</span><span class="op" id="7676775">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7676778">{</span><span class="string" id="7676779">&#34;tcp6&#34;</span><span class="op" id="7676785">,</span>&nbsp;<span class="string" id="7676787">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7676807">}</span><span class="op" id="7676808">,</span><br>
<span class="lineno"></span><span class="op" id="7676810">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="keyword" id="7676813">func</span>&nbsp;<span class="ident" id="7676818">TestProhibitionaryDialArgs</span><span class="op" id="7676844">(</span><span class="ident" id="7676845">t</span>&nbsp;<span class="op" id="7676847">*</span><span class="ident" id="7676848">testing</span><span class="op" id="7676855">.</span><span class="ident" id="7676856">T</span><span class="op" id="7676857">)</span>&nbsp;<span class="op" id="7676859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7676862">switch</span>&nbsp;<span class="ident" id="7676869">runtime</span><span class="op" id="7676876">.</span><span class="ident" id="7676877">GOOS</span>&nbsp;<span class="op" id="7676882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7676885">case</span>&nbsp;<span class="string" id="7676890">&#34;plan9&#34;</span><span class="op" id="7676897">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7676901">t</span><span class="op" id="7676902">.</span><span class="ident" id="7676903">Skipf</span><span class="op" id="7676908">(</span><span class="string" id="7676909">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7676930">,</span>&nbsp;<span class="ident" id="7676932">runtime</span><span class="op" id="7676939">.</span><span class="ident" id="7676940">GOOS</span><span class="op" id="7676944">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7676947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7676950">//&nbsp;This&nbsp;test&nbsp;requires&nbsp;both&nbsp;IPv6&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7677020">if</span>&nbsp;<span class="op" id="7677023">!</span><span class="ident" id="7677024">supportsIPv4map</span>&nbsp;<span class="op" id="7677040">||</span>&nbsp;<span class="ident" id="7677043">testing</span><span class="op" id="7677050">.</span><span class="ident" id="7677051">Short</span><span class="op" id="7677056">(</span><span class="op" id="7677057">)</span>&nbsp;<span class="op" id="7677059">||</span>&nbsp;<span class="op" id="7677062">!</span><span class="op" id="7677063">*</span><span class="ident" id="7677064">testExternal</span>&nbsp;<span class="op" id="7677077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7677081">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7677089">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677093">l</span><span class="op" id="7677094">,</span>&nbsp;<span class="ident" id="7677096">port</span>&nbsp;<span class="op" id="7677101">:=</span>&nbsp;<span class="ident" id="7677104">usableListenPort</span><span class="op" id="7677120">(</span><span class="ident" id="7677121">t</span><span class="op" id="7677122">,</span>&nbsp;<span class="string" id="7677124">&#34;tcp&#34;</span><span class="op" id="7677129">,</span>&nbsp;<span class="string" id="7677131">&#34;[::]&#34;</span><span class="op" id="7677137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7677140">defer</span>&nbsp;<span class="ident" id="7677146">l</span><span class="op" id="7677147">.</span><span class="ident" id="7677148">Close</span><span class="op" id="7677153">(</span><span class="op" id="7677154">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7677158">for</span>&nbsp;<span class="ident" id="7677162">_</span><span class="op" id="7677163">,</span>&nbsp;<span class="ident" id="7677165">tt</span>&nbsp;<span class="op" id="7677168">:=</span>&nbsp;<span class="keyword" id="7677171">range</span>&nbsp;<span class="ident" id="7677177">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="7677204">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677208">c</span><span class="op" id="7677209">,</span>&nbsp;<span class="ident" id="7677211">err</span>&nbsp;<span class="op" id="7677215">:=</span>&nbsp;<span class="ident" id="7677218">Dial</span><span class="op" id="7677222">(</span><span class="ident" id="7677223">tt</span><span class="op" id="7677225">.</span><span class="ident" id="7677226">net</span><span class="op" id="7677229">,</span>&nbsp;<span class="ident" id="7677231">tt</span><span class="op" id="7677233">.</span><span class="ident" id="7677234">addr</span><span class="op" id="7677238">+</span><span class="string" id="7677239">&#34;:&#34;</span><span class="op" id="7677242">+</span><span class="ident" id="7677243">port</span><span class="op" id="7677247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7677251">if</span>&nbsp;<span class="ident" id="7677254">err</span>&nbsp;<span class="op" id="7677258">==</span>&nbsp;<span class="ident" id="7677261">nil</span>&nbsp;<span class="op" id="7677265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677270">c</span><span class="op" id="7677271">.</span><span class="ident" id="7677272">Close</span><span class="op" id="7677277">(</span><span class="op" id="7677278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677283">t</span><span class="op" id="7677284">.</span><span class="ident" id="7677285">Fatalf</span><span class="op" id="7677291">(</span><span class="string" id="7677292">&#34;Dial(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7677318">,</span>&nbsp;<span class="ident" id="7677320">tt</span><span class="op" id="7677322">.</span><span class="ident" id="7677323">net</span><span class="op" id="7677326">,</span>&nbsp;<span class="ident" id="7677328">tt</span><span class="op" id="7677330">.</span><span class="ident" id="7677331">addr</span><span class="op" id="7677335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7677339">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7677342">}</span><br>
<span class="lineno"></span><span class="op" id="7677344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7677347">func</span>&nbsp;<span class="ident" id="7677352">TestWildWildcardListener</span><span class="op" id="7677376">(</span><span class="ident" id="7677377">t</span>&nbsp;<span class="op" id="7677379">*</span><span class="ident" id="7677380">testing</span><span class="op" id="7677387">.</span><span class="ident" id="7677388">T</span><span class="op" id="7677389">)</span>&nbsp;<span class="op" id="7677391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7677394">switch</span>&nbsp;<span class="ident" id="7677401">runtime</span><span class="op" id="7677408">.</span><span class="ident" id="7677409">GOOS</span>&nbsp;<span class="op" id="7677414">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7677417">case</span>&nbsp;<span class="string" id="7677422">&#34;plan9&#34;</span><span class="op" id="7677429">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677433">t</span><span class="op" id="7677434">.</span><span class="ident" id="7677435">Skipf</span><span class="op" id="7677440">(</span><span class="string" id="7677441">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7677462">,</span>&nbsp;<span class="ident" id="7677464">runtime</span><span class="op" id="7677471">.</span><span class="ident" id="7677472">GOOS</span><span class="op" id="7677476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7677479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7677483">if</span>&nbsp;<span class="ident" id="7677486">testing</span><span class="op" id="7677493">.</span><span class="ident" id="7677494">Short</span><span class="op" id="7677499">(</span><span class="op" id="7677500">)</span>&nbsp;<span class="op" id="7677502">||</span>&nbsp;<span class="op" id="7677505">!</span><span class="op" id="7677506">*</span><span class="ident" id="7677507">testExternal</span>&nbsp;<span class="op" id="7677520">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677524">t</span><span class="op" id="7677525">.</span><span class="ident" id="7677526">Skip</span><span class="op" id="7677530">(</span><span class="string" id="7677531">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7677572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7677575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7677579">defer</span>&nbsp;<span class="keyword" id="7677585">func</span><span class="op" id="7677589">(</span><span class="op" id="7677590">)</span>&nbsp;<span class="op" id="7677592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7677596">if</span>&nbsp;<span class="ident" id="7677599">p</span>&nbsp;<span class="op" id="7677601">:=</span>&nbsp;<span class="builtinfunc" id="7677604">recover</span><span class="op" id="7677611">(</span><span class="op" id="7677612">)</span><span class="op" id="7677613">;</span>&nbsp;<span class="ident" id="7677615">p</span>&nbsp;<span class="op" id="7677617">!=</span>&nbsp;<span class="ident" id="7677620">nil</span>&nbsp;<span class="op" id="7677624">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677629">t</span><span class="op" id="7677630">.</span><span class="ident" id="7677631">Fatalf</span><span class="op" id="7677637">(</span><span class="string" id="7677638">&#34;Listen,&nbsp;ListenPacket&nbsp;or&nbsp;protocol-specific&nbsp;Listen&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="7677701">,</span>&nbsp;<span class="ident" id="7677703">p</span><span class="op" id="7677704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7677708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7677711">}</span><span class="op" id="7677712">(</span><span class="op" id="7677713">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7677717">if</span>&nbsp;<span class="ident" id="7677720">ln</span><span class="op" id="7677722">,</span>&nbsp;<span class="ident" id="7677724">err</span>&nbsp;<span class="op" id="7677728">:=</span>&nbsp;<span class="ident" id="7677731">Listen</span><span class="op" id="7677737">(</span><span class="string" id="7677738">&#34;tcp&#34;</span><span class="op" id="7677743">,</span>&nbsp;<span class="string" id="7677745">&#34;&#34;</span><span class="op" id="7677747">)</span><span class="op" id="7677748">;</span>&nbsp;<span class="ident" id="7677750">err</span>&nbsp;<span class="op" id="7677754">==</span>&nbsp;<span class="ident" id="7677757">nil</span>&nbsp;<span class="op" id="7677761">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677765">ln</span><span class="op" id="7677767">.</span><span class="ident" id="7677768">Close</span><span class="op" id="7677773">(</span><span class="op" id="7677774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7677777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7677780">if</span>&nbsp;<span class="ident" id="7677783">ln</span><span class="op" id="7677785">,</span>&nbsp;<span class="ident" id="7677787">err</span>&nbsp;<span class="op" id="7677791">:=</span>&nbsp;<span class="ident" id="7677794">ListenPacket</span><span class="op" id="7677806">(</span><span class="string" id="7677807">&#34;udp&#34;</span><span class="op" id="7677812">,</span>&nbsp;<span class="string" id="7677814">&#34;&#34;</span><span class="op" id="7677816">)</span><span class="op" id="7677817">;</span>&nbsp;<span class="ident" id="7677819">err</span>&nbsp;<span class="op" id="7677823">==</span>&nbsp;<span class="ident" id="7677826">nil</span>&nbsp;<span class="op" id="7677830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677834">ln</span><span class="op" id="7677836">.</span><span class="ident" id="7677837">Close</span><span class="op" id="7677842">(</span><span class="op" id="7677843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7677846">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7677849">if</span>&nbsp;<span class="ident" id="7677852">ln</span><span class="op" id="7677854">,</span>&nbsp;<span class="ident" id="7677856">err</span>&nbsp;<span class="op" id="7677860">:=</span>&nbsp;<span class="ident" id="7677863">ListenTCP</span><span class="op" id="7677872">(</span><span class="string" id="7677873">&#34;tcp&#34;</span><span class="op" id="7677878">,</span>&nbsp;<span class="ident" id="7677880">nil</span><span class="op" id="7677883">)</span><span class="op" id="7677884">;</span>&nbsp;<span class="ident" id="7677886">err</span>&nbsp;<span class="op" id="7677890">==</span>&nbsp;<span class="ident" id="7677893">nil</span>&nbsp;<span class="op" id="7677897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677901">ln</span><span class="op" id="7677903">.</span><span class="ident" id="7677904">Close</span><span class="op" id="7677909">(</span><span class="op" id="7677910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7677913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7677916">if</span>&nbsp;<span class="ident" id="7677919">ln</span><span class="op" id="7677921">,</span>&nbsp;<span class="ident" id="7677923">err</span>&nbsp;<span class="op" id="7677927">:=</span>&nbsp;<span class="ident" id="7677930">ListenUDP</span><span class="op" id="7677939">(</span><span class="string" id="7677940">&#34;udp&#34;</span><span class="op" id="7677945">,</span>&nbsp;<span class="ident" id="7677947">nil</span><span class="op" id="7677950">)</span><span class="op" id="7677951">;</span>&nbsp;<span class="ident" id="7677953">err</span>&nbsp;<span class="op" id="7677957">==</span>&nbsp;<span class="ident" id="7677960">nil</span>&nbsp;<span class="op" id="7677964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677968">ln</span><span class="op" id="7677970">.</span><span class="ident" id="7677971">Close</span><span class="op" id="7677976">(</span><span class="op" id="7677977">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7677980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7677983">if</span>&nbsp;<span class="ident" id="7677986">ln</span><span class="op" id="7677988">,</span>&nbsp;<span class="ident" id="7677990">err</span>&nbsp;<span class="op" id="7677994">:=</span>&nbsp;<span class="ident" id="7677997">ListenIP</span><span class="op" id="7678005">(</span><span class="string" id="7678006">&#34;ip:icmp&#34;</span><span class="op" id="7678015">,</span>&nbsp;<span class="ident" id="7678017">nil</span><span class="op" id="7678020">)</span><span class="op" id="7678021">;</span>&nbsp;<span class="ident" id="7678023">err</span>&nbsp;<span class="op" id="7678027">==</span>&nbsp;<span class="ident" id="7678030">nil</span>&nbsp;<span class="op" id="7678034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678038">ln</span><span class="op" id="7678040">.</span><span class="ident" id="7678041">Close</span><span class="op" id="7678046">(</span><span class="op" id="7678047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7678050">}</span><br>
<span class="lineno"></span><span class="op" id="7678052">}</span>
</div>
</body>
</html>
