<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc</h2>
<ul>
<li><a href="/gostd/net/rpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/rpc/debug.go.html">debug.go</a></li>
<li><a href="/gostd/net/rpc/server.go.html" class="current">server.go</a></li>
<li><a href="/gostd/net/rpc/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5272348">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5272403">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5272457">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5272508">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;Package&nbsp;rpc&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;exported&nbsp;methods&nbsp;of&nbsp;an&nbsp;object&nbsp;across&nbsp;a<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;network&nbsp;or&nbsp;other&nbsp;I/O&nbsp;connection.&nbsp;&nbsp;A&nbsp;server&nbsp;registers&nbsp;an&nbsp;object,&nbsp;making&nbsp;it&nbsp;visible<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;as&nbsp;a&nbsp;service&nbsp;with&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;of&nbsp;the&nbsp;object.&nbsp;&nbsp;After&nbsp;registration,&nbsp;exported<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;methods&nbsp;of&nbsp;the&nbsp;object&nbsp;will&nbsp;be&nbsp;accessible&nbsp;remotely.&nbsp;&nbsp;A&nbsp;server&nbsp;may&nbsp;register&nbsp;multiple<br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;objects&nbsp;(services)&nbsp;of&nbsp;different&nbsp;types&nbsp;but&nbsp;it&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;register&nbsp;multiple<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;objects&nbsp;of&nbsp;the&nbsp;same&nbsp;type.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;Only&nbsp;methods&nbsp;that&nbsp;satisfy&nbsp;these&nbsp;criteria&nbsp;will&nbsp;be&nbsp;made&nbsp;available&nbsp;for&nbsp;remote&nbsp;access;<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;other&nbsp;methods&nbsp;will&nbsp;be&nbsp;ignored:<br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;method&nbsp;is&nbsp;exported.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;method&nbsp;has&nbsp;two&nbsp;arguments,&nbsp;both&nbsp;exported&nbsp;(or&nbsp;builtin)&nbsp;types.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;method&#39;s&nbsp;second&nbsp;argument&nbsp;is&nbsp;a&nbsp;pointer.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;method&nbsp;has&nbsp;return&nbsp;type&nbsp;error.<br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;In&nbsp;effect,&nbsp;the&nbsp;method&nbsp;must&nbsp;look&nbsp;schematically&nbsp;like<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;(t&nbsp;*T)&nbsp;MethodName(argType&nbsp;T1,&nbsp;replyType&nbsp;*T2)&nbsp;error<br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;T,&nbsp;T1&nbsp;and&nbsp;T2&nbsp;can&nbsp;be&nbsp;marshaled&nbsp;by&nbsp;encoding/gob.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;These&nbsp;requirements&nbsp;apply&nbsp;even&nbsp;if&nbsp;a&nbsp;different&nbsp;codec&nbsp;is&nbsp;used.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;(In&nbsp;the&nbsp;future,&nbsp;these&nbsp;requirements&nbsp;may&nbsp;soften&nbsp;for&nbsp;custom&nbsp;codecs.)<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;method&#39;s&nbsp;first&nbsp;argument&nbsp;represents&nbsp;the&nbsp;arguments&nbsp;provided&nbsp;by&nbsp;the&nbsp;caller;&nbsp;the<br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;second&nbsp;argument&nbsp;represents&nbsp;the&nbsp;result&nbsp;parameters&nbsp;to&nbsp;be&nbsp;returned&nbsp;to&nbsp;the&nbsp;caller.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;method&#39;s&nbsp;return&nbsp;value,&nbsp;if&nbsp;non-nil,&nbsp;is&nbsp;passed&nbsp;back&nbsp;as&nbsp;a&nbsp;string&nbsp;that&nbsp;the&nbsp;client<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;sees&nbsp;as&nbsp;if&nbsp;created&nbsp;by&nbsp;errors.New.&nbsp;&nbsp;If&nbsp;an&nbsp;error&nbsp;is&nbsp;returned,&nbsp;the&nbsp;reply&nbsp;parameter<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;will&nbsp;not&nbsp;be&nbsp;sent&nbsp;back&nbsp;to&nbsp;the&nbsp;client.<br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;server&nbsp;may&nbsp;handle&nbsp;requests&nbsp;on&nbsp;a&nbsp;single&nbsp;connection&nbsp;by&nbsp;calling&nbsp;ServeConn.&nbsp;&nbsp;More<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;typically&nbsp;it&nbsp;will&nbsp;create&nbsp;a&nbsp;network&nbsp;listener&nbsp;and&nbsp;call&nbsp;Accept&nbsp;or,&nbsp;for&nbsp;an&nbsp;HTTP<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;listener,&nbsp;HandleHTTP&nbsp;and&nbsp;http.Serve.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;client&nbsp;wishing&nbsp;to&nbsp;use&nbsp;the&nbsp;service&nbsp;establishes&nbsp;a&nbsp;connection&nbsp;and&nbsp;then&nbsp;invokes<br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;NewClient&nbsp;on&nbsp;the&nbsp;connection.&nbsp;&nbsp;The&nbsp;convenience&nbsp;function&nbsp;Dial&nbsp;(DialHTTP)&nbsp;performs<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;both&nbsp;steps&nbsp;for&nbsp;a&nbsp;raw&nbsp;network&nbsp;connection&nbsp;(an&nbsp;HTTP&nbsp;connection).&nbsp;&nbsp;The&nbsp;resulting<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;Client&nbsp;object&nbsp;has&nbsp;two&nbsp;methods,&nbsp;Call&nbsp;and&nbsp;Go,&nbsp;that&nbsp;specify&nbsp;the&nbsp;service&nbsp;and&nbsp;method&nbsp;to<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;call,&nbsp;a&nbsp;pointer&nbsp;containing&nbsp;the&nbsp;arguments,&nbsp;and&nbsp;a&nbsp;pointer&nbsp;to&nbsp;receive&nbsp;the&nbsp;result<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;parameters.<br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;Call&nbsp;method&nbsp;waits&nbsp;for&nbsp;the&nbsp;remote&nbsp;call&nbsp;to&nbsp;complete&nbsp;while&nbsp;the&nbsp;Go&nbsp;method<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;launches&nbsp;the&nbsp;call&nbsp;asynchronously&nbsp;and&nbsp;signals&nbsp;completion&nbsp;using&nbsp;the&nbsp;Call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;structure&#39;s&nbsp;Done&nbsp;channel.<br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;Unless&nbsp;an&nbsp;explicit&nbsp;codec&nbsp;is&nbsp;set&nbsp;up,&nbsp;package&nbsp;encoding/gob&nbsp;is&nbsp;used&nbsp;to<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;transport&nbsp;the&nbsp;data.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;Here&nbsp;is&nbsp;a&nbsp;simple&nbsp;example.&nbsp;&nbsp;A&nbsp;server&nbsp;wishes&nbsp;to&nbsp;export&nbsp;an&nbsp;object&nbsp;of&nbsp;type&nbsp;Arith:<br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;server<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;Args&nbsp;struct&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A,&nbsp;B&nbsp;int<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;Quotient&nbsp;struct&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Quo,&nbsp;Rem&nbsp;int<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;Arith&nbsp;int<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;(t&nbsp;*Arith)&nbsp;Multiply(args&nbsp;*Args,&nbsp;reply&nbsp;*int)&nbsp;error&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*reply&nbsp;=&nbsp;args.A&nbsp;*&nbsp;args.B<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;nil<br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;(t&nbsp;*Arith)&nbsp;Divide(args&nbsp;*Args,&nbsp;quo&nbsp;*Quotient)&nbsp;error&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;args.B&nbsp;==&nbsp;0&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;errors.New(&#34;divide&nbsp;by&nbsp;zero&#34;)<br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quo.Quo&nbsp;=&nbsp;args.A&nbsp;/&nbsp;args.B<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quo.Rem&nbsp;=&nbsp;args.A&nbsp;%&nbsp;args.B<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;nil<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;server&nbsp;calls&nbsp;(for&nbsp;HTTP&nbsp;service):<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arith&nbsp;:=&nbsp;new(Arith)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rpc.Register(arith)<br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rpc.HandleHTTP()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l,&nbsp;e&nbsp;:=&nbsp;net.Listen(&#34;tcp&#34;,&nbsp;&#34;:1234&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;e&nbsp;!=&nbsp;nil&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.Fatal(&#34;listen&nbsp;error:&#34;,&nbsp;e)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;go&nbsp;http.Serve(l,&nbsp;nil)<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;At&nbsp;this&nbsp;point,&nbsp;clients&nbsp;can&nbsp;see&nbsp;a&nbsp;service&nbsp;&#34;Arith&#34;&nbsp;with&nbsp;methods&nbsp;&#34;Arith.Multiply&#34;&nbsp;and<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&#34;Arith.Divide&#34;.&nbsp;&nbsp;To&nbsp;invoke&nbsp;one,&nbsp;a&nbsp;client&nbsp;first&nbsp;dials&nbsp;the&nbsp;server:<br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client,&nbsp;err&nbsp;:=&nbsp;rpc.DialHTTP(&#34;tcp&#34;,&nbsp;serverAddress&nbsp;+&nbsp;&#34;:1234&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;err&nbsp;!=&nbsp;nil&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.Fatal(&#34;dialing:&#34;,&nbsp;err)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;Then&nbsp;it&nbsp;can&nbsp;make&nbsp;a&nbsp;remote&nbsp;call:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Synchronous&nbsp;call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;args&nbsp;:=&nbsp;&amp;server.Args{7,8}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;reply&nbsp;int<br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err&nbsp;=&nbsp;client.Call(&#34;Arith.Multiply&#34;,&nbsp;args,&nbsp;&amp;reply)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;err&nbsp;!=&nbsp;nil&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.Fatal(&#34;arith&nbsp;error:&#34;,&nbsp;err)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(&#34;Arith:&nbsp;%d*%d=%d&#34;,&nbsp;args.A,&nbsp;args.B,&nbsp;reply)<br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;or<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Asynchronous&nbsp;call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quotient&nbsp;:=&nbsp;new(Quotient)<br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;divCall&nbsp;:=&nbsp;client.Go(&#34;Arith.Divide&#34;,&nbsp;args,&nbsp;quotient,&nbsp;nil)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;replyCall&nbsp;:=&nbsp;&lt;-divCall.Done&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;will&nbsp;be&nbsp;equal&nbsp;to&nbsp;divCall<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;check&nbsp;errors,&nbsp;print,&nbsp;etc.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;server&nbsp;implementation&nbsp;will&nbsp;often&nbsp;provide&nbsp;a&nbsp;simple,&nbsp;type-safe&nbsp;wrapper&nbsp;for&nbsp;the<br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;client.<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="5276337">package</span>&nbsp;<span class="ident" id="5276345">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5276350">import</span>&nbsp;<span class="op" id="5276357">(</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5276360">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5276369">&#34;encoding/gob&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5276385">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5276395">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5276401">&#34;log&#34;</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5276408">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5276415">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5276427">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5276438">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5276449">&#34;sync&#34;</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5276457">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5276468">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5276483">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5276486">const</span>&nbsp;<span class="op" id="5276492">(</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5276495">//&nbsp;Defaults&nbsp;used&nbsp;by&nbsp;HandleHTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276527">DefaultRPCPath</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5276544">=</span>&nbsp;<span class="string" id="5276546">&#34;/_goRPC_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276558">DefaultDebugPath</span>&nbsp;<span class="op" id="5276575">=</span>&nbsp;<span class="string" id="5276577">&#34;/debug/rpc&#34;</span><br>
<span class="lineno"></span><span class="op" id="5276590">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="5276593">//&nbsp;Precompute&nbsp;the&nbsp;reflect&nbsp;type&nbsp;for&nbsp;error.&nbsp;&nbsp;Can&#39;t&nbsp;use&nbsp;error&nbsp;directly</span><br>
<span class="lineno"></span><span class="comment" id="5276661">//&nbsp;because&nbsp;Typeof&nbsp;takes&nbsp;an&nbsp;empty&nbsp;interface&nbsp;value.&nbsp;&nbsp;This&nbsp;is&nbsp;annoying.</span><br>
<span class="lineno"></span><span class="keyword" id="5276730">var</span>&nbsp;<span class="ident" id="5276734">typeOfError</span>&nbsp;<span class="op" id="5276746">=</span>&nbsp;<span class="ident" id="5276748"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5276755">.</span><span class="ident" id="5276756"><a href="/gostd/reflect/type.go.html#2808718">TypeOf</a></span><span class="op" id="5276762">(</span><span class="op" id="5276763">(</span><span class="op" id="5276764">*</span><span class="builtintype" id="5276765">error</span><span class="op" id="5276770">)</span><span class="op" id="5276771">(</span><span class="builtintype" id="5276772">nil</span><span class="op" id="5276775">)</span><span class="op" id="5276776">)</span><span class="op" id="5276777">.</span><span class="ident" id="5276778"><a href="/gostd/reflect/type.go.html#2785263">Elem</a></span><span class="op" id="5276782">(</span><span class="op" id="5276783">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5276786">type</span>&nbsp;<span class="ident" id="5276791">methodType</span>&nbsp;<span class="keyword" id="5276802">struct</span>&nbsp;<span class="op" id="5276809">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276812"><a href="/gostd/net/rpc/server.go.html#5276449">sync</a></span><span class="op" id="5276816">.</span><span class="ident" id="5276817"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span>&nbsp;<span class="comment" id="5276823">//&nbsp;protects&nbsp;counters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276845">method</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276856"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5276863">.</span><span class="ident" id="5276864"><a href="/gostd/reflect/type.go.html#2792957">Method</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276872">ArgType</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276883"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5276890">.</span><span class="ident" id="5276891"><a href="/gostd/reflect/type.go.html#2781467">Type</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276897">ReplyType</span>&nbsp;&nbsp;<span class="ident" id="5276908"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5276915">.</span><span class="ident" id="5276916"><a href="/gostd/reflect/type.go.html#2781467">Type</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276922">numCalls</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5276933">uint</span><br>
<span class="lineno">155</span><span class="op" id="5276938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5276941">type</span>&nbsp;<span class="ident" id="5276946">service</span>&nbsp;<span class="keyword" id="5276954">struct</span>&nbsp;<span class="op" id="5276961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276964">name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5276971">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5276994">//&nbsp;name&nbsp;of&nbsp;service</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5277014">rcvr</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5277021"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5277028">.</span><span class="ident" id="5277029"><a href="/gostd/reflect/value.go.html#2833557">Value</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5277044">//&nbsp;receiver&nbsp;of&nbsp;methods&nbsp;for&nbsp;the&nbsp;service</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5277084">typ</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5277091"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5277098">.</span><span class="ident" id="5277099"><a href="/gostd/reflect/type.go.html#2781467">Type</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5277114">//&nbsp;type&nbsp;of&nbsp;the&nbsp;receiver</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5277139">method</span>&nbsp;<span class="keyword" id="5277146">map</span><span class="op" id="5277149">[</span><span class="builtintype" id="5277150">string</span><span class="op" id="5277156">]</span><span class="op" id="5277157">*</span><span class="ident" id="5277158"><a href="/gostd/net/rpc/server.go.html#5276791">methodType</a></span>&nbsp;<span class="comment" id="5277169">//&nbsp;registered&nbsp;methods</span><br>
<span class="lineno"></span><span class="op" id="5277191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5277194">//&nbsp;Request&nbsp;is&nbsp;a&nbsp;header&nbsp;written&nbsp;before&nbsp;every&nbsp;RPC&nbsp;call.&nbsp;&nbsp;It&nbsp;is&nbsp;used&nbsp;internally</span><br>
<span class="lineno">165</span><span class="comment" id="5277271">//&nbsp;but&nbsp;documented&nbsp;here&nbsp;as&nbsp;an&nbsp;aid&nbsp;to&nbsp;debugging,&nbsp;such&nbsp;as&nbsp;when&nbsp;analyzing</span><br>
<span class="lineno"></span><span class="comment" id="5277341">//&nbsp;network&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="5277361">type</span>&nbsp;<span class="ident" id="5277366">Request</span>&nbsp;<span class="keyword" id="5277374">struct</span>&nbsp;<span class="op" id="5277381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5277384">ServiceMethod</span>&nbsp;<span class="builtintype" id="5277398">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5277407">//&nbsp;format:&nbsp;&#34;Service.Method&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5277436">Seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5277450">uint64</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5277459">//&nbsp;sequence&nbsp;number&nbsp;chosen&nbsp;by&nbsp;client</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5277496">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5277510">*</span><span class="ident" id="5277511"><a href="/gostd/net/rpc/server.go.html#5277366">Request</a></span>&nbsp;<span class="comment" id="5277519">//&nbsp;for&nbsp;free&nbsp;list&nbsp;in&nbsp;Server</span><br>
<span class="lineno"></span><span class="op" id="5277546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5277549">//&nbsp;Response&nbsp;is&nbsp;a&nbsp;header&nbsp;written&nbsp;before&nbsp;every&nbsp;RPC&nbsp;return.&nbsp;&nbsp;It&nbsp;is&nbsp;used&nbsp;internally</span><br>
<span class="lineno"></span><span class="comment" id="5277629">//&nbsp;but&nbsp;documented&nbsp;here&nbsp;as&nbsp;an&nbsp;aid&nbsp;to&nbsp;debugging,&nbsp;such&nbsp;as&nbsp;when&nbsp;analyzing</span><br>
<span class="lineno">175</span><span class="comment" id="5277699">//&nbsp;network&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="5277719">type</span>&nbsp;<span class="ident" id="5277724">Response</span>&nbsp;<span class="keyword" id="5277733">struct</span>&nbsp;<span class="op" id="5277740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5277743">ServiceMethod</span>&nbsp;<span class="builtintype" id="5277757">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5277767">//&nbsp;echoes&nbsp;that&nbsp;of&nbsp;the&nbsp;Request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5277798">Seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5277812">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5277822">//&nbsp;echoes&nbsp;that&nbsp;of&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5277853">Error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5277867">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5277877">//&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5277896">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5277910">*</span><span class="ident" id="5277911"><a href="/gostd/net/rpc/server.go.html#5277724">Response</a></span>&nbsp;<span class="comment" id="5277920">//&nbsp;for&nbsp;free&nbsp;list&nbsp;in&nbsp;Server</span><br>
<span class="lineno"></span><span class="op" id="5277947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5277950">//&nbsp;Server&nbsp;represents&nbsp;an&nbsp;RPC&nbsp;Server.</span><br>
<span class="lineno"></span><span class="keyword" id="5277986">type</span>&nbsp;<span class="ident" id="5277991">Server</span>&nbsp;<span class="keyword" id="5277998">struct</span>&nbsp;<span class="op" id="5278005">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5278008">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5278019"><a href="/gostd/net/rpc/server.go.html#5276449">sync</a></span><span class="op" id="5278023">.</span><span class="ident" id="5278024"><a href="/gostd/sync/rwmutex.go.html#1456076">RWMutex</a></span>&nbsp;<span class="comment" id="5278032">//&nbsp;protects&nbsp;the&nbsp;serviceMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5278060">serviceMap</span>&nbsp;<span class="keyword" id="5278071">map</span><span class="op" id="5278074">[</span><span class="builtintype" id="5278075">string</span><span class="op" id="5278081">]</span><span class="op" id="5278082">*</span><span class="ident" id="5278083"><a href="/gostd/net/rpc/server.go.html#5276946">service</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5278092">reqLock</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5278103"><a href="/gostd/net/rpc/server.go.html#5276449">sync</a></span><span class="op" id="5278107">.</span><span class="ident" id="5278108"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span>&nbsp;<span class="comment" id="5278114">//&nbsp;protects&nbsp;freeReq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5278135">freeReq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5278146">*</span><span class="ident" id="5278147"><a href="/gostd/net/rpc/server.go.html#5277366">Request</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5278156">respLock</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5278167"><a href="/gostd/net/rpc/server.go.html#5276449">sync</a></span><span class="op" id="5278171">.</span><span class="ident" id="5278172"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span>&nbsp;<span class="comment" id="5278178">//&nbsp;protects&nbsp;freeResp</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5278200">freeResp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5278211">*</span><span class="ident" id="5278212"><a href="/gostd/net/rpc/server.go.html#5277724">Response</a></span><br>
<span class="lineno"></span><span class="op" id="5278221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5278224">//&nbsp;NewServer&nbsp;returns&nbsp;a&nbsp;new&nbsp;Server.</span><br>
<span class="lineno"></span><span class="keyword" id="5278259">func</span>&nbsp;<span class="ident" id="5278264">NewServer</span><span class="op" id="5278273">(</span><span class="op" id="5278274">)</span>&nbsp;<span class="op" id="5278276">*</span><span class="ident" id="5278277"><a href="/gostd/net/rpc/server.go.html#5277991">Server</a></span>&nbsp;<span class="op" id="5278284">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5278287">return</span>&nbsp;<span class="op" id="5278294">&amp;</span><span class="ident" id="5278295"><a href="/gostd/net/rpc/server.go.html#5277991">Server</a></span><span class="op" id="5278301">{</span><span class="ident" id="5278302"><a href="/gostd/net/rpc/server.go.html#5278060">serviceMap</a></span><span class="op" id="5278312">:</span>&nbsp;<span class="builtinfunc" id="5278314">make</span><span class="op" id="5278318">(</span><span class="keyword" id="5278319">map</span><span class="op" id="5278322">[</span><span class="builtintype" id="5278323">string</span><span class="op" id="5278329">]</span><span class="op" id="5278330">*</span><span class="ident" id="5278331"><a href="/gostd/net/rpc/server.go.html#5276946">service</a></span><span class="op" id="5278338">)</span><span class="op" id="5278339">}</span><br>
<span class="lineno"></span><span class="op" id="5278341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5278344">//&nbsp;DefaultServer&nbsp;is&nbsp;the&nbsp;default&nbsp;instance&nbsp;of&nbsp;*Server.</span><br>
<span class="lineno"></span><span class="keyword" id="5278397">var</span>&nbsp;<span class="ident" id="5278401">DefaultServer</span>&nbsp;<span class="op" id="5278415">=</span>&nbsp;<span class="ident" id="5278417"><a href="/gostd/net/rpc/server.go.html#5278264">NewServer</a></span><span class="op" id="5278426">(</span><span class="op" id="5278427">)</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="5278430">//&nbsp;Is&nbsp;this&nbsp;an&nbsp;exported&nbsp;-&nbsp;upper&nbsp;case&nbsp;-&nbsp;name?</span><br>
<span class="lineno"></span><span class="keyword" id="5278474">func</span>&nbsp;<span class="ident" id="5278479">isExported</span><span class="op" id="5278489">(</span><span class="ident" id="5278490">name</span>&nbsp;<span class="builtintype" id="5278495">string</span><span class="op" id="5278501">)</span>&nbsp;<span class="builtintype" id="5278503">bool</span>&nbsp;<span class="op" id="5278508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5278511">rune</span><span class="op" id="5278515">,</span>&nbsp;<span class="ident" id="5278517">_</span>&nbsp;<span class="op" id="5278519">:=</span>&nbsp;<span class="ident" id="5278522"><a href="/gostd/net/rpc/server.go.html#5276468">utf8</a></span><span class="op" id="5278526">.</span><span class="ident" id="5278527"><a href="/gostd/unicode/utf8/utf8.go.html#1810428">DecodeRuneInString</a></span><span class="op" id="5278545">(</span><span class="ident" id="5278546"><a href="/gostd/net/rpc/server.go.html#5278490">name</a></span><span class="op" id="5278550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5278553">return</span>&nbsp;<span class="ident" id="5278560"><a href="/gostd/net/rpc/server.go.html#5276457">unicode</a></span><span class="op" id="5278567">.</span><span class="ident" id="5278568"><a href="/gostd/unicode/letter.go.html#1826318">IsUpper</a></span><span class="op" id="5278575">(</span><span class="builtintype" id="5278576"><a href="/gostd/net/rpc/server.go.html#5278511">rune</a></span><span class="op" id="5278580">)</span><br>
<span class="lineno">205</span><span class="op" id="5278582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5278585">//&nbsp;Is&nbsp;this&nbsp;type&nbsp;exported&nbsp;or&nbsp;a&nbsp;builtin?</span><br>
<span class="lineno"></span><span class="keyword" id="5278624">func</span>&nbsp;<span class="ident" id="5278629">isExportedOrBuiltinType</span><span class="op" id="5278652">(</span><span class="ident" id="5278653">t</span>&nbsp;<span class="ident" id="5278655"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5278662">.</span><span class="ident" id="5278663"><a href="/gostd/reflect/type.go.html#2781467">Type</a></span><span class="op" id="5278667">)</span>&nbsp;<span class="builtintype" id="5278669">bool</span>&nbsp;<span class="op" id="5278674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5278677">for</span>&nbsp;<span class="ident" id="5278681"><a href="/gostd/net/rpc/server.go.html#5278653">t</a></span><span class="op" id="5278682">.</span><span class="ident" id="5278683"><a href="/gostd/reflect/type.go.html#2783619">Kind</a></span><span class="op" id="5278687">(</span><span class="op" id="5278688">)</span>&nbsp;<span class="op" id="5278690">==</span>&nbsp;<span class="ident" id="5278693"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5278700">.</span><span class="ident" id="5278701"><a href="/gostd/reflect/type.go.html#2788057">Ptr</a></span>&nbsp;<span class="op" id="5278705">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5278709"><a href="/gostd/net/rpc/server.go.html#5278653">t</a></span>&nbsp;<span class="op" id="5278711">=</span>&nbsp;<span class="ident" id="5278713"><a href="/gostd/net/rpc/server.go.html#5278653">t</a></span><span class="op" id="5278714">.</span><span class="ident" id="5278715"><a href="/gostd/reflect/type.go.html#2785263">Elem</a></span><span class="op" id="5278719">(</span><span class="op" id="5278720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5278723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5278726">//&nbsp;PkgPath&nbsp;will&nbsp;be&nbsp;non-empty&nbsp;even&nbsp;for&nbsp;an&nbsp;exported&nbsp;type,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5278783">//&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;check&nbsp;the&nbsp;type&nbsp;name&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5278830">return</span>&nbsp;<span class="ident" id="5278837"><a href="/gostd/net/rpc/server.go.html#5278479">isExported</a></span><span class="op" id="5278847">(</span><span class="ident" id="5278848"><a href="/gostd/net/rpc/server.go.html#5278653">t</a></span><span class="op" id="5278849">.</span><span class="ident" id="5278850"><a href="/gostd/reflect/type.go.html#2782837">Name</a></span><span class="op" id="5278854">(</span><span class="op" id="5278855">)</span><span class="op" id="5278856">)</span>&nbsp;<span class="op" id="5278858">||</span>&nbsp;<span class="ident" id="5278861"><a href="/gostd/net/rpc/server.go.html#5278653">t</a></span><span class="op" id="5278862">.</span><span class="ident" id="5278863"><a href="/gostd/reflect/type.go.html#2783125">PkgPath</a></span><span class="op" id="5278870">(</span><span class="op" id="5278871">)</span>&nbsp;<span class="op" id="5278873">==</span>&nbsp;<span class="string" id="5278876">&#34;&#34;</span><br>
<span class="lineno">215</span><span class="op" id="5278879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5278882">//&nbsp;Register&nbsp;publishes&nbsp;in&nbsp;the&nbsp;server&nbsp;the&nbsp;set&nbsp;of&nbsp;methods&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5278944">//&nbsp;receiver&nbsp;value&nbsp;that&nbsp;satisfy&nbsp;the&nbsp;following&nbsp;conditions:</span><br>
<span class="lineno"></span><span class="comment" id="5279001">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;exported&nbsp;method</span><br>
<span class="lineno">220</span><span class="comment" id="5279022">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;two&nbsp;arguments,&nbsp;both&nbsp;of&nbsp;exported&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5279064">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;second&nbsp;argument&nbsp;is&nbsp;a&nbsp;pointer</span><br>
<span class="lineno"></span><span class="comment" id="5279102">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;one&nbsp;return&nbsp;value,&nbsp;of&nbsp;type&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="5279139">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;receiver&nbsp;is&nbsp;not&nbsp;an&nbsp;exported&nbsp;type&nbsp;or&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="5279209">//&nbsp;no&nbsp;suitable&nbsp;methods.&nbsp;It&nbsp;also&nbsp;logs&nbsp;the&nbsp;error&nbsp;using&nbsp;package&nbsp;log.</span><br>
<span class="lineno">225</span><span class="comment" id="5279275">//&nbsp;The&nbsp;client&nbsp;accesses&nbsp;each&nbsp;method&nbsp;using&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;Type.Method&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5279352">//&nbsp;where&nbsp;Type&nbsp;is&nbsp;the&nbsp;receiver&#39;s&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5279399">func</span>&nbsp;<span class="op" id="5279404">(</span><span class="ident" id="5279405">server</span>&nbsp;<span class="op" id="5279412">*</span><span class="ident" id="5279413"><a href="/gostd/net/rpc/server.go.html#5277991">Server</a></span><span class="op" id="5279419">)</span>&nbsp;<span class="ident" id="5279421">Register</span><span class="op" id="5279429">(</span><span class="ident" id="5279430">rcvr</span>&nbsp;<span class="keyword" id="5279435">interface</span><span class="op" id="5279444">{</span><span class="op" id="5279445">}</span><span class="op" id="5279446">)</span>&nbsp;<span class="builtintype" id="5279448">error</span>&nbsp;<span class="op" id="5279454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5279457">return</span>&nbsp;<span class="ident" id="5279464"><a href="/gostd/net/rpc/server.go.html#5279405">server</a></span><span class="op" id="5279470">.</span><span class="ident" id="5279471"><a href="/gostd/net/rpc/server.go.html#5279758">register</a></span><span class="op" id="5279479">(</span><span class="ident" id="5279480"><a href="/gostd/net/rpc/server.go.html#5279430">rcvr</a></span><span class="op" id="5279484">,</span>&nbsp;<span class="string" id="5279486">&#34;&#34;</span><span class="op" id="5279488">,</span>&nbsp;<span class="builtintype" id="5279490">false</span><span class="op" id="5279495">)</span><br>
<span class="lineno"></span><span class="op" id="5279497">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="5279500">//&nbsp;RegisterName&nbsp;is&nbsp;like&nbsp;Register&nbsp;but&nbsp;uses&nbsp;the&nbsp;provided&nbsp;name&nbsp;for&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5279573">//&nbsp;instead&nbsp;of&nbsp;the&nbsp;receiver&#39;s&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5279617">func</span>&nbsp;<span class="op" id="5279622">(</span><span class="ident" id="5279623">server</span>&nbsp;<span class="op" id="5279630">*</span><span class="ident" id="5279631"><a href="/gostd/net/rpc/server.go.html#5277991">Server</a></span><span class="op" id="5279637">)</span>&nbsp;<span class="ident" id="5279639">RegisterName</span><span class="op" id="5279651">(</span><span class="ident" id="5279652">name</span>&nbsp;<span class="builtintype" id="5279657">string</span><span class="op" id="5279663">,</span>&nbsp;<span class="ident" id="5279665">rcvr</span>&nbsp;<span class="keyword" id="5279670">interface</span><span class="op" id="5279679">{</span><span class="op" id="5279680">}</span><span class="op" id="5279681">)</span>&nbsp;<span class="builtintype" id="5279683">error</span>&nbsp;<span class="op" id="5279689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5279692">return</span>&nbsp;<span class="ident" id="5279699"><a href="/gostd/net/rpc/server.go.html#5279623">server</a></span><span class="op" id="5279705">.</span><span class="ident" id="5279706"><a href="/gostd/net/rpc/server.go.html#5279758">register</a></span><span class="op" id="5279714">(</span><span class="ident" id="5279715"><a href="/gostd/net/rpc/server.go.html#5279665">rcvr</a></span><span class="op" id="5279719">,</span>&nbsp;<span class="ident" id="5279721"><a href="/gostd/net/rpc/server.go.html#5279652">name</a></span><span class="op" id="5279725">,</span>&nbsp;<span class="builtintype" id="5279727">true</span><span class="op" id="5279731">)</span><br>
<span class="lineno">235</span><span class="op" id="5279733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5279736">func</span>&nbsp;<span class="op" id="5279741">(</span><span class="ident" id="5279742">server</span>&nbsp;<span class="op" id="5279749">*</span><span class="ident" id="5279750"><a href="/gostd/net/rpc/server.go.html#5277991">Server</a></span><span class="op" id="5279756">)</span>&nbsp;<span class="ident" id="5279758">register</span><span class="op" id="5279766">(</span><span class="ident" id="5279767">rcvr</span>&nbsp;<span class="keyword" id="5279772">interface</span><span class="op" id="5279781">{</span><span class="op" id="5279782">}</span><span class="op" id="5279783">,</span>&nbsp;<span class="ident" id="5279785">name</span>&nbsp;<span class="builtintype" id="5279790">string</span><span class="op" id="5279796">,</span>&nbsp;<span class="ident" id="5279798">useName</span>&nbsp;<span class="builtintype" id="5279806">bool</span><span class="op" id="5279810">)</span>&nbsp;<span class="builtintype" id="5279812">error</span>&nbsp;<span class="op" id="5279818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5279821"><a href="/gostd/net/rpc/server.go.html#5279742">server</a></span><span class="op" id="5279827">.</span><span class="ident" id="5279828"><a href="/gostd/net/rpc/server.go.html#5278008">mu</a></span><span class="op" id="5279830">.</span><span class="ident" id="5279831"><a href="/gostd/sync/rwmutex.go.html#1457713">Lock</a></span><span class="op" id="5279835">(</span><span class="op" id="5279836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5279839">defer</span>&nbsp;<span class="ident" id="5279845"><a href="/gostd/net/rpc/server.go.html#5279742">server</a></span><span class="op" id="5279851">.</span><span class="ident" id="5279852"><a href="/gostd/net/rpc/server.go.html#5278008">mu</a></span><span class="op" id="5279854">.</span><span class="ident" id="5279855"><a href="/gostd/sync/rwmutex.go.html#1458554">Unlock</a></span><span class="op" id="5279861">(</span><span class="op" id="5279862">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5279865">if</span>&nbsp;<span class="ident" id="5279868"><a href="/gostd/net/rpc/server.go.html#5279742">server</a></span><span class="op" id="5279874">.</span><span class="ident" id="5279875"><a href="/gostd/net/rpc/server.go.html#5278060">serviceMap</a></span>&nbsp;<span class="op" id="5279886">==</span>&nbsp;<span class="builtintype" id="5279889">nil</span>&nbsp;<span class="op" id="5279893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5279897"><a href="/gostd/net/rpc/server.go.html#5279742">server</a></span><span class="op" id="5279903">.</span><span class="ident" id="5279904"><a href="/gostd/net/rpc/server.go.html#5278060">serviceMap</a></span>&nbsp;<span class="op" id="5279915">=</span>&nbsp;<span class="builtinfunc" id="5279917">make</span><span class="op" id="5279921">(</span><span class="keyword" id="5279922">map</span><span class="op" id="5279925">[</span><span class="builtintype" id="5279926">string</span><span class="op" id="5279932">]</span><span class="op" id="5279933">*</span><span class="ident" id="5279934"><a href="/gostd/net/rpc/server.go.html#5276946">service</a></span><span class="op" id="5279941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5279944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5279947">s</span>&nbsp;<span class="op" id="5279949">:=</span>&nbsp;<span class="builtinfunc" id="5279952">new</span><span class="op" id="5279955">(</span><span class="ident" id="5279956"><a href="/gostd/net/rpc/server.go.html#5276946">service</a></span><span class="op" id="5279963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5279966"><a href="/gostd/net/rpc/server.go.html#5279947">s</a></span><span class="op" id="5279967">.</span><span class="ident" id="5279968"><a href="/gostd/net/rpc/server.go.html#5277084">typ</a></span>&nbsp;<span class="op" id="5279972">=</span>&nbsp;<span class="ident" id="5279974"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5279981">.</span><span class="ident" id="5279982"><a href="/gostd/reflect/type.go.html#2808718">TypeOf</a></span><span class="op" id="5279988">(</span><span class="ident" id="5279989"><a href="/gostd/net/rpc/server.go.html#5279767">rcvr</a></span><span class="op" id="5279993">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5279996"><a href="/gostd/net/rpc/server.go.html#5279947">s</a></span><span class="op" id="5279997">.</span><span class="ident" id="5279998"><a href="/gostd/net/rpc/server.go.html#5277014">rcvr</a></span>&nbsp;<span class="op" id="5280003">=</span>&nbsp;<span class="ident" id="5280005"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5280012">.</span><span class="ident" id="5280013"><a href="/gostd/reflect/value.go.html#2892536">ValueOf</a></span><span class="op" id="5280020">(</span><span class="ident" id="5280021"><a href="/gostd/net/rpc/server.go.html#5279767">rcvr</a></span><span class="op" id="5280025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5280028">sname</span>&nbsp;<span class="op" id="5280034">:=</span>&nbsp;<span class="ident" id="5280037"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5280044">.</span><span class="ident" id="5280045"><a href="/gostd/reflect/value.go.html#2892316">Indirect</a></span><span class="op" id="5280053">(</span><span class="ident" id="5280054"><a href="/gostd/net/rpc/server.go.html#5279947">s</a></span><span class="op" id="5280055">.</span><span class="ident" id="5280056"><a href="/gostd/net/rpc/server.go.html#5277014">rcvr</a></span><span class="op" id="5280060">)</span><span class="op" id="5280061">.</span><span class="ident" id="5280062"><a href="/gostd/reflect/value.go.html#2880910">Type</a></span><span class="op" id="5280066">(</span><span class="op" id="5280067">)</span><span class="op" id="5280068">.</span><span class="ident" id="5280069"><a href="/gostd/reflect/type.go.html#2782837">Name</a></span><span class="op" id="5280073">(</span><span class="op" id="5280074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280077">if</span>&nbsp;<span class="ident" id="5280080"><a href="/gostd/net/rpc/server.go.html#5279798">useName</a></span>&nbsp;<span class="op" id="5280088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5280092"><a href="/gostd/net/rpc/server.go.html#5280028">sname</a></span>&nbsp;<span class="op" id="5280098">=</span>&nbsp;<span class="ident" id="5280100"><a href="/gostd/net/rpc/server.go.html#5279785">name</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5280106">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280109">if</span>&nbsp;<span class="ident" id="5280112"><a href="/gostd/net/rpc/server.go.html#5280028">sname</a></span>&nbsp;<span class="op" id="5280118">==</span>&nbsp;<span class="string" id="5280121">&#34;&#34;</span>&nbsp;<span class="op" id="5280124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5280128">s</span>&nbsp;<span class="op" id="5280130">:=</span>&nbsp;<span class="string" id="5280133">&#34;rpc.Register:&nbsp;no&nbsp;service&nbsp;name&nbsp;for&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5280175">+</span>&nbsp;<span class="ident" id="5280177"><a href="/gostd/net/rpc/server.go.html#5279947">s</a></span><span class="op" id="5280178">.</span><span class="ident" id="5280179"><a href="/gostd/net/rpc/server.go.html#5277084">typ</a></span><span class="op" id="5280182">.</span><span class="ident" id="5280183"><a href="/gostd/reflect/type.go.html#2783552">String</a></span><span class="op" id="5280189">(</span><span class="op" id="5280190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5280194"><a href="/gostd/net/rpc/server.go.html#5276401">log</a></span><span class="op" id="5280197">.</span><span class="ident" id="5280198"><a href="/gostd/log/log.go.html#4078487">Print</a></span><span class="op" id="5280203">(</span><span class="ident" id="5280204"><a href="/gostd/net/rpc/server.go.html#5280128">s</a></span><span class="op" id="5280205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280209">return</span>&nbsp;<span class="ident" id="5280216"><a href="/gostd/net/rpc/server.go.html#5276385">errors</a></span><span class="op" id="5280222">.</span><span class="ident" id="5280223"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5280226">(</span><span class="ident" id="5280227"><a href="/gostd/net/rpc/server.go.html#5280128">s</a></span><span class="op" id="5280228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5280231">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280234">if</span>&nbsp;<span class="op" id="5280237">!</span><span class="ident" id="5280238"><a href="/gostd/net/rpc/server.go.html#5278479">isExported</a></span><span class="op" id="5280248">(</span><span class="ident" id="5280249"><a href="/gostd/net/rpc/server.go.html#5280028">sname</a></span><span class="op" id="5280254">)</span>&nbsp;<span class="op" id="5280256">&amp;&amp;</span>&nbsp;<span class="op" id="5280259">!</span><span class="ident" id="5280260"><a href="/gostd/net/rpc/server.go.html#5279798">useName</a></span>&nbsp;<span class="op" id="5280268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5280272">s</span>&nbsp;<span class="op" id="5280274">:=</span>&nbsp;<span class="string" id="5280277">&#34;rpc.Register:&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5280299">+</span>&nbsp;<span class="ident" id="5280301"><a href="/gostd/net/rpc/server.go.html#5280028">sname</a></span>&nbsp;<span class="op" id="5280307">+</span>&nbsp;<span class="string" id="5280309">&#34;&nbsp;is&nbsp;not&nbsp;exported&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5280330"><a href="/gostd/net/rpc/server.go.html#5276401">log</a></span><span class="op" id="5280333">.</span><span class="ident" id="5280334"><a href="/gostd/log/log.go.html#4078487">Print</a></span><span class="op" id="5280339">(</span><span class="ident" id="5280340"><a href="/gostd/net/rpc/server.go.html#5280272">s</a></span><span class="op" id="5280341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280345">return</span>&nbsp;<span class="ident" id="5280352"><a href="/gostd/net/rpc/server.go.html#5276385">errors</a></span><span class="op" id="5280358">.</span><span class="ident" id="5280359"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5280362">(</span><span class="ident" id="5280363"><a href="/gostd/net/rpc/server.go.html#5280272">s</a></span><span class="op" id="5280364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5280367">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280370">if</span>&nbsp;<span class="ident" id="5280373">_</span><span class="op" id="5280374">,</span>&nbsp;<span class="ident" id="5280376">present</span>&nbsp;<span class="op" id="5280384">:=</span>&nbsp;<span class="ident" id="5280387"><a href="/gostd/net/rpc/server.go.html#5279742">server</a></span><span class="op" id="5280393">.</span><span class="ident" id="5280394"><a href="/gostd/net/rpc/server.go.html#5278060">serviceMap</a></span><span class="op" id="5280404">[</span><span class="ident" id="5280405"><a href="/gostd/net/rpc/server.go.html#5280028">sname</a></span><span class="op" id="5280410">]</span><span class="op" id="5280411">;</span>&nbsp;<span class="ident" id="5280413"><a href="/gostd/net/rpc/server.go.html#5280376">present</a></span>&nbsp;<span class="op" id="5280421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280425">return</span>&nbsp;<span class="ident" id="5280432"><a href="/gostd/net/rpc/server.go.html#5276385">errors</a></span><span class="op" id="5280438">.</span><span class="ident" id="5280439"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5280442">(</span><span class="string" id="5280443">&#34;rpc:&nbsp;service&nbsp;already&nbsp;defined:&nbsp;&#34;</span>&nbsp;<span class="op" id="5280476">+</span>&nbsp;<span class="ident" id="5280478"><a href="/gostd/net/rpc/server.go.html#5280028">sname</a></span><span class="op" id="5280483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5280486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5280489"><a href="/gostd/net/rpc/server.go.html#5279947">s</a></span><span class="op" id="5280490">.</span><span class="ident" id="5280491"><a href="/gostd/net/rpc/server.go.html#5276964">name</a></span>&nbsp;<span class="op" id="5280496">=</span>&nbsp;<span class="ident" id="5280498"><a href="/gostd/net/rpc/server.go.html#5280028">sname</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5280506">//&nbsp;Install&nbsp;the&nbsp;methods</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5280530"><a href="/gostd/net/rpc/server.go.html#5279947">s</a></span><span class="op" id="5280531">.</span><span class="ident" id="5280532"><a href="/gostd/net/rpc/server.go.html#5277139">method</a></span>&nbsp;<span class="op" id="5280539">=</span>&nbsp;<span class="ident" id="5280541"><a href="/gostd/net/rpc/server.go.html#5281189">suitableMethods</a></span><span class="op" id="5280556">(</span><span class="ident" id="5280557"><a href="/gostd/net/rpc/server.go.html#5279947">s</a></span><span class="op" id="5280558">.</span><span class="ident" id="5280559"><a href="/gostd/net/rpc/server.go.html#5277084">typ</a></span><span class="op" id="5280562">,</span>&nbsp;<span class="builtintype" id="5280564">true</span><span class="op" id="5280568">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280572">if</span>&nbsp;<span class="builtinfunc" id="5280575">len</span><span class="op" id="5280578">(</span><span class="ident" id="5280579"><a href="/gostd/net/rpc/server.go.html#5279947">s</a></span><span class="op" id="5280580">.</span><span class="ident" id="5280581"><a href="/gostd/net/rpc/server.go.html#5277139">method</a></span><span class="op" id="5280587">)</span>&nbsp;<span class="op" id="5280589">==</span>&nbsp;<span class="num" id="5280592">0</span>&nbsp;<span class="op" id="5280594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5280598">str</span>&nbsp;<span class="op" id="5280602">:=</span>&nbsp;<span class="string" id="5280605">&#34;&#34;</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5280611">//&nbsp;To&nbsp;help&nbsp;the&nbsp;user,&nbsp;see&nbsp;if&nbsp;a&nbsp;pointer&nbsp;receiver&nbsp;would&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5280672">method</span>&nbsp;<span class="op" id="5280679">:=</span>&nbsp;<span class="ident" id="5280682"><a href="/gostd/net/rpc/server.go.html#5281189">suitableMethods</a></span><span class="op" id="5280697">(</span><span class="ident" id="5280698"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5280705">.</span><span class="ident" id="5280706"><a href="/gostd/reflect/type.go.html#2809042">PtrTo</a></span><span class="op" id="5280711">(</span><span class="ident" id="5280712"><a href="/gostd/net/rpc/server.go.html#5279947">s</a></span><span class="op" id="5280713">.</span><span class="ident" id="5280714"><a href="/gostd/net/rpc/server.go.html#5277084">typ</a></span><span class="op" id="5280717">)</span><span class="op" id="5280718">,</span>&nbsp;<span class="builtintype" id="5280720">false</span><span class="op" id="5280725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5280729">if</span>&nbsp;<span class="builtinfunc" id="5280732">len</span><span class="op" id="5280735">(</span><span class="ident" id="5280736"><a href="/gostd/net/rpc/server.go.html#5280672">method</a></span><span class="op" id="5280742">)</span>&nbsp;<span class="op" id="5280744">!=</span>&nbsp;<span class="num" id="5280747">0</span>&nbsp;<span class="op" id="5280749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5280754"><a href="/gostd/net/rpc/server.go.html#5280598">str</a></span>&nbsp;<span class="op" id="5280758">=</span>&nbsp;<span class="string" id="5280760">&#34;rpc.Register:&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5280782">+</span>&nbsp;<span class="ident" id="5280784"><a href="/gostd/net/rpc/server.go.html#5280028">sname</a></span>&nbsp;<span class="op" id="5280790">+</span>&nbsp;<span class="string" id="5280792">&#34;&nbsp;has&nbsp;no&nbsp;exported&nbsp;methods&nbsp;of&nbsp;suitable&nbsp;type&nbsp;(hint:&nbsp;pass&nbsp;a&nbsp;pointer&nbsp;to&nbsp;value&nbsp;of&nbsp;that&nbsp;type)&#34;</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5280883">}</span>&nbsp;<span class="keyword" id="5280885">else</span>&nbsp;<span class="op" id="5280890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5280895"><a href="/gostd/net/rpc/server.go.html#5280598">str</a></span>&nbsp;<span class="op" id="5280899">=</span>&nbsp;<span class="string" id="5280901">&#34;rpc.Register:&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5280923">+</span>&nbsp;<span class="ident" id="5280925"><a href="/gostd/net/rpc/server.go.html#5280028">sname</a></span>&nbsp;<span class="op" id="5280931">+</span>&nbsp;<span class="string" id="5280933">&#34;&nbsp;has&nbsp;no&nbsp;exported&nbsp;methods&nbsp;of&nbsp;suitable&nbsp;type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5280979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5280983"><a href="/gostd/net/rpc/server.go.html#5276401">log</a></span><span class="op" id="5280986">.</span><span class="ident" id="5280987"><a href="/gostd/log/log.go.html#4078487">Print</a></span><span class="op" id="5280992">(</span><span class="ident" id="5280993"><a href="/gostd/net/rpc/server.go.html#5280598">str</a></span><span class="op" id="5280996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281000">return</span>&nbsp;<span class="ident" id="5281007"><a href="/gostd/net/rpc/server.go.html#5276385">errors</a></span><span class="op" id="5281013">.</span><span class="ident" id="5281014"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5281017">(</span><span class="ident" id="5281018"><a href="/gostd/net/rpc/server.go.html#5280598">str</a></span><span class="op" id="5281021">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5281024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5281027"><a href="/gostd/net/rpc/server.go.html#5279742">server</a></span><span class="op" id="5281033">.</span><span class="ident" id="5281034"><a href="/gostd/net/rpc/server.go.html#5278060">serviceMap</a></span><span class="op" id="5281044">[</span><span class="ident" id="5281045"><a href="/gostd/net/rpc/server.go.html#5279947">s</a></span><span class="op" id="5281046">.</span><span class="ident" id="5281047"><a href="/gostd/net/rpc/server.go.html#5276964">name</a></span><span class="op" id="5281051">]</span>&nbsp;<span class="op" id="5281053">=</span>&nbsp;<span class="ident" id="5281055"><a href="/gostd/net/rpc/server.go.html#5279947">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281058">return</span>&nbsp;<span class="builtintype" id="5281065">nil</span><br>
<span class="lineno"></span><span class="op" id="5281069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="5281072">//&nbsp;suitableMethods&nbsp;returns&nbsp;suitable&nbsp;Rpc&nbsp;methods&nbsp;of&nbsp;typ,&nbsp;it&nbsp;will&nbsp;report</span><br>
<span class="lineno"></span><span class="comment" id="5281143">//&nbsp;error&nbsp;using&nbsp;log&nbsp;if&nbsp;reportErr&nbsp;is&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5281184">func</span>&nbsp;<span class="ident" id="5281189">suitableMethods</span><span class="op" id="5281204">(</span><span class="ident" id="5281205">typ</span>&nbsp;<span class="ident" id="5281209"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5281216">.</span><span class="ident" id="5281217"><a href="/gostd/reflect/type.go.html#2781467">Type</a></span><span class="op" id="5281221">,</span>&nbsp;<span class="ident" id="5281223">reportErr</span>&nbsp;<span class="builtintype" id="5281233">bool</span><span class="op" id="5281237">)</span>&nbsp;<span class="keyword" id="5281239">map</span><span class="op" id="5281242">[</span><span class="builtintype" id="5281243">string</span><span class="op" id="5281249">]</span><span class="op" id="5281250">*</span><span class="ident" id="5281251"><a href="/gostd/net/rpc/server.go.html#5276791">methodType</a></span>&nbsp;<span class="op" id="5281262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5281265">methods</span>&nbsp;<span class="op" id="5281273">:=</span>&nbsp;<span class="builtinfunc" id="5281276">make</span><span class="op" id="5281280">(</span><span class="keyword" id="5281281">map</span><span class="op" id="5281284">[</span><span class="builtintype" id="5281285">string</span><span class="op" id="5281291">]</span><span class="op" id="5281292">*</span><span class="ident" id="5281293"><a href="/gostd/net/rpc/server.go.html#5276791">methodType</a></span><span class="op" id="5281303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281306">for</span>&nbsp;<span class="ident" id="5281310">m</span>&nbsp;<span class="op" id="5281312">:=</span>&nbsp;<span class="num" id="5281315">0</span><span class="op" id="5281316">;</span>&nbsp;<span class="ident" id="5281318"><a href="/gostd/net/rpc/server.go.html#5281310">m</a></span>&nbsp;<span class="op" id="5281320">&lt;</span>&nbsp;<span class="ident" id="5281322"><a href="/gostd/net/rpc/server.go.html#5281205">typ</a></span><span class="op" id="5281325">.</span><span class="ident" id="5281326"><a href="/gostd/reflect/type.go.html#2782716">NumMethod</a></span><span class="op" id="5281335">(</span><span class="op" id="5281336">)</span><span class="op" id="5281337">;</span>&nbsp;<span class="ident" id="5281339"><a href="/gostd/net/rpc/server.go.html#5281310">m</a></span><span class="op" id="5281340">++</span>&nbsp;<span class="op" id="5281343">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5281347">method</span>&nbsp;<span class="op" id="5281354">:=</span>&nbsp;<span class="ident" id="5281357"><a href="/gostd/net/rpc/server.go.html#5281205">typ</a></span><span class="op" id="5281360">.</span><span class="ident" id="5281361"><a href="/gostd/reflect/type.go.html#2782167">Method</a></span><span class="op" id="5281367">(</span><span class="ident" id="5281368"><a href="/gostd/net/rpc/server.go.html#5281310">m</a></span><span class="op" id="5281369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5281373">mtype</span>&nbsp;<span class="op" id="5281379">:=</span>&nbsp;<span class="ident" id="5281382"><a href="/gostd/net/rpc/server.go.html#5281347">method</a></span><span class="op" id="5281388">.</span><span class="ident" id="5281389"><a href="/gostd/reflect/type.go.html#2793330">Type</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5281396">mname</span>&nbsp;<span class="op" id="5281402">:=</span>&nbsp;<span class="ident" id="5281405"><a href="/gostd/net/rpc/server.go.html#5281347">method</a></span><span class="op" id="5281411">.</span><span class="ident" id="5281412"><a href="/gostd/reflect/type.go.html#2793297">Name</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5281419">//&nbsp;Method&nbsp;must&nbsp;be&nbsp;exported.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281449">if</span>&nbsp;<span class="ident" id="5281452"><a href="/gostd/net/rpc/server.go.html#5281347">method</a></span><span class="op" id="5281458">.</span><span class="ident" id="5281459"><a href="/gostd/reflect/type.go.html#2793313">PkgPath</a></span>&nbsp;<span class="op" id="5281467">!=</span>&nbsp;<span class="string" id="5281470">&#34;&#34;</span>&nbsp;<span class="op" id="5281473">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281478">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5281489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5281493">//&nbsp;Method&nbsp;needs&nbsp;three&nbsp;ins:&nbsp;receiver,&nbsp;*args,&nbsp;*reply.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281547">if</span>&nbsp;<span class="ident" id="5281550"><a href="/gostd/net/rpc/server.go.html#5281373">mtype</a></span><span class="op" id="5281555">.</span><span class="ident" id="5281556"><a href="/gostd/reflect/type.go.html#2786672">NumIn</a></span><span class="op" id="5281561">(</span><span class="op" id="5281562">)</span>&nbsp;<span class="op" id="5281564">!=</span>&nbsp;<span class="num" id="5281567">3</span>&nbsp;<span class="op" id="5281569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281574">if</span>&nbsp;<span class="ident" id="5281577"><a href="/gostd/net/rpc/server.go.html#5281223">reportErr</a></span>&nbsp;<span class="op" id="5281587">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5281593"><a href="/gostd/net/rpc/server.go.html#5276401">log</a></span><span class="op" id="5281596">.</span><span class="ident" id="5281597"><a href="/gostd/log/log.go.html#4078868">Println</a></span><span class="op" id="5281604">(</span><span class="string" id="5281605">&#34;method&#34;</span><span class="op" id="5281613">,</span>&nbsp;<span class="ident" id="5281615"><a href="/gostd/net/rpc/server.go.html#5281396">mname</a></span><span class="op" id="5281620">,</span>&nbsp;<span class="string" id="5281622">&#34;has&nbsp;wrong&nbsp;number&nbsp;of&nbsp;ins:&#34;</span><span class="op" id="5281648">,</span>&nbsp;<span class="ident" id="5281650"><a href="/gostd/net/rpc/server.go.html#5281373">mtype</a></span><span class="op" id="5281655">.</span><span class="ident" id="5281656"><a href="/gostd/reflect/type.go.html#2786672">NumIn</a></span><span class="op" id="5281661">(</span><span class="op" id="5281662">)</span><span class="op" id="5281663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5281668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281673">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5281684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5281688">//&nbsp;First&nbsp;arg&nbsp;need&nbsp;not&nbsp;be&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5281726">argType</span>&nbsp;<span class="op" id="5281734">:=</span>&nbsp;<span class="ident" id="5281737"><a href="/gostd/net/rpc/server.go.html#5281373">mtype</a></span><span class="op" id="5281742">.</span><span class="ident" id="5281743"><a href="/gostd/reflect/type.go.html#2786239">In</a></span><span class="op" id="5281745">(</span><span class="num" id="5281746">1</span><span class="op" id="5281747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281751">if</span>&nbsp;<span class="op" id="5281754">!</span><span class="ident" id="5281755"><a href="/gostd/net/rpc/server.go.html#5278629">isExportedOrBuiltinType</a></span><span class="op" id="5281778">(</span><span class="ident" id="5281779"><a href="/gostd/net/rpc/server.go.html#5281726">argType</a></span><span class="op" id="5281786">)</span>&nbsp;<span class="op" id="5281788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281793">if</span>&nbsp;<span class="ident" id="5281796"><a href="/gostd/net/rpc/server.go.html#5281223">reportErr</a></span>&nbsp;<span class="op" id="5281806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5281812"><a href="/gostd/net/rpc/server.go.html#5276401">log</a></span><span class="op" id="5281815">.</span><span class="ident" id="5281816"><a href="/gostd/log/log.go.html#4078868">Println</a></span><span class="op" id="5281823">(</span><span class="ident" id="5281824"><a href="/gostd/net/rpc/server.go.html#5281396">mname</a></span><span class="op" id="5281829">,</span>&nbsp;<span class="string" id="5281831">&#34;argument&nbsp;type&nbsp;not&nbsp;exported:&#34;</span><span class="op" id="5281860">,</span>&nbsp;<span class="ident" id="5281862"><a href="/gostd/net/rpc/server.go.html#5281726">argType</a></span><span class="op" id="5281869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5281874">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281879">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5281890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5281894">//&nbsp;Second&nbsp;arg&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5281929">replyType</span>&nbsp;<span class="op" id="5281939">:=</span>&nbsp;<span class="ident" id="5281942"><a href="/gostd/net/rpc/server.go.html#5281373">mtype</a></span><span class="op" id="5281947">.</span><span class="ident" id="5281948"><a href="/gostd/reflect/type.go.html#2786239">In</a></span><span class="op" id="5281950">(</span><span class="num" id="5281951">2</span><span class="op" id="5281952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281956">if</span>&nbsp;<span class="ident" id="5281959"><a href="/gostd/net/rpc/server.go.html#5281929">replyType</a></span><span class="op" id="5281968">.</span><span class="ident" id="5281969"><a href="/gostd/reflect/type.go.html#2783619">Kind</a></span><span class="op" id="5281973">(</span><span class="op" id="5281974">)</span>&nbsp;<span class="op" id="5281976">!=</span>&nbsp;<span class="ident" id="5281979"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5281986">.</span><span class="ident" id="5281987"><a href="/gostd/reflect/type.go.html#2788057">Ptr</a></span>&nbsp;<span class="op" id="5281991">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5281996">if</span>&nbsp;<span class="ident" id="5281999"><a href="/gostd/net/rpc/server.go.html#5281223">reportErr</a></span>&nbsp;<span class="op" id="5282009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5282015"><a href="/gostd/net/rpc/server.go.html#5276401">log</a></span><span class="op" id="5282018">.</span><span class="ident" id="5282019"><a href="/gostd/log/log.go.html#4078868">Println</a></span><span class="op" id="5282026">(</span><span class="string" id="5282027">&#34;method&#34;</span><span class="op" id="5282035">,</span>&nbsp;<span class="ident" id="5282037"><a href="/gostd/net/rpc/server.go.html#5281396">mname</a></span><span class="op" id="5282042">,</span>&nbsp;<span class="string" id="5282044">&#34;reply&nbsp;type&nbsp;not&nbsp;a&nbsp;pointer:&#34;</span><span class="op" id="5282071">,</span>&nbsp;<span class="ident" id="5282073"><a href="/gostd/net/rpc/server.go.html#5281929">replyType</a></span><span class="op" id="5282082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5282087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5282092">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5282103">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5282107">//&nbsp;Reply&nbsp;type&nbsp;must&nbsp;be&nbsp;exported.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5282141">if</span>&nbsp;<span class="op" id="5282144">!</span><span class="ident" id="5282145"><a href="/gostd/net/rpc/server.go.html#5278629">isExportedOrBuiltinType</a></span><span class="op" id="5282168">(</span><span class="ident" id="5282169"><a href="/gostd/net/rpc/server.go.html#5281929">replyType</a></span><span class="op" id="5282178">)</span>&nbsp;<span class="op" id="5282180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5282185">if</span>&nbsp;<span class="ident" id="5282188"><a href="/gostd/net/rpc/server.go.html#5281223">reportErr</a></span>&nbsp;<span class="op" id="5282198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5282204"><a href="/gostd/net/rpc/server.go.html#5276401">log</a></span><span class="op" id="5282207">.</span><span class="ident" id="5282208"><a href="/gostd/log/log.go.html#4078868">Println</a></span><span class="op" id="5282215">(</span><span class="string" id="5282216">&#34;method&#34;</span><span class="op" id="5282224">,</span>&nbsp;<span class="ident" id="5282226"><a href="/gostd/net/rpc/server.go.html#5281396">mname</a></span><span class="op" id="5282231">,</span>&nbsp;<span class="string" id="5282233">&#34;reply&nbsp;type&nbsp;not&nbsp;exported:&#34;</span><span class="op" id="5282259">,</span>&nbsp;<span class="ident" id="5282261"><a href="/gostd/net/rpc/server.go.html#5281929">replyType</a></span><span class="op" id="5282270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5282275">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5282280">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5282291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5282295">//&nbsp;Method&nbsp;needs&nbsp;one&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5282322">if</span>&nbsp;<span class="ident" id="5282325"><a href="/gostd/net/rpc/server.go.html#5281373">mtype</a></span><span class="op" id="5282330">.</span><span class="ident" id="5282331"><a href="/gostd/reflect/type.go.html#2786793">NumOut</a></span><span class="op" id="5282337">(</span><span class="op" id="5282338">)</span>&nbsp;<span class="op" id="5282340">!=</span>&nbsp;<span class="num" id="5282343">1</span>&nbsp;<span class="op" id="5282345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5282350">if</span>&nbsp;<span class="ident" id="5282353"><a href="/gostd/net/rpc/server.go.html#5281223">reportErr</a></span>&nbsp;<span class="op" id="5282363">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5282369"><a href="/gostd/net/rpc/server.go.html#5276401">log</a></span><span class="op" id="5282372">.</span><span class="ident" id="5282373"><a href="/gostd/log/log.go.html#4078868">Println</a></span><span class="op" id="5282380">(</span><span class="string" id="5282381">&#34;method&#34;</span><span class="op" id="5282389">,</span>&nbsp;<span class="ident" id="5282391"><a href="/gostd/net/rpc/server.go.html#5281396">mname</a></span><span class="op" id="5282396">,</span>&nbsp;<span class="string" id="5282398">&#34;has&nbsp;wrong&nbsp;number&nbsp;of&nbsp;outs:&#34;</span><span class="op" id="5282425">,</span>&nbsp;<span class="ident" id="5282427"><a href="/gostd/net/rpc/server.go.html#5281373">mtype</a></span><span class="op" id="5282432">.</span><span class="ident" id="5282433"><a href="/gostd/reflect/type.go.html#2786793">NumOut</a></span><span class="op" id="5282439">(</span><span class="op" id="5282440">)</span><span class="op" id="5282441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5282446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5282451">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5282462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5282466">//&nbsp;The&nbsp;return&nbsp;type&nbsp;of&nbsp;the&nbsp;method&nbsp;must&nbsp;be&nbsp;error.</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5282516">if</span>&nbsp;<span class="ident" id="5282519">returnType</span>&nbsp;<span class="op" id="5282530">:=</span>&nbsp;<span class="ident" id="5282533"><a href="/gostd/net/rpc/server.go.html#5281373">mtype</a></span><span class="op" id="5282538">.</span><span class="ident" id="5282539"><a href="/gostd/reflect/type.go.html#2786977">Out</a></span><span class="op" id="5282542">(</span><span class="num" id="5282543">0</span><span class="op" id="5282544">)</span><span class="op" id="5282545">;</span>&nbsp;<span class="ident" id="5282547"><a href="/gostd/net/rpc/server.go.html#5282519">returnType</a></span>&nbsp;<span class="op" id="5282558">!=</span>&nbsp;<span class="ident" id="5282561"><a href="/gostd/net/rpc/server.go.html#5276734">typeOfError</a></span>&nbsp;<span class="op" id="5282573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5282578">if</span>&nbsp;<span class="ident" id="5282581"><a href="/gostd/net/rpc/server.go.html#5281223">reportErr</a></span>&nbsp;<span class="op" id="5282591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5282597"><a href="/gostd/net/rpc/server.go.html#5276401">log</a></span><span class="op" id="5282600">.</span><span class="ident" id="5282601"><a href="/gostd/log/log.go.html#4078868">Println</a></span><span class="op" id="5282608">(</span><span class="string" id="5282609">&#34;method&#34;</span><span class="op" id="5282617">,</span>&nbsp;<span class="ident" id="5282619"><a href="/gostd/net/rpc/server.go.html#5281396">mname</a></span><span class="op" id="5282624">,</span>&nbsp;<span class="string" id="5282626">&#34;returns&#34;</span><span class="op" id="5282635">,</span>&nbsp;<span class="ident" id="5282637"><a href="/gostd/net/rpc/server.go.html#5282519">returnType</a></span><span class="op" id="5282647">.</span><span class="ident" id="5282648"><a href="/gostd/reflect/type.go.html#2783552">String</a></span><span class="op" id="5282654">(</span><span class="op" id="5282655">)</span><span class="op" id="5282656">,</span>&nbsp;<span class="string" id="5282658">&#34;not&nbsp;error&#34;</span><span class="op" id="5282669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5282674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5282679">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5282690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5282694"><a href="/gostd/net/rpc/server.go.html#5281265">methods</a></span><span class="op" id="5282701">[</span><span class="ident" id="5282702"><a href="/gostd/net/rpc/server.go.html#5281396">mname</a></span><span class="op" id="5282707">]</span>&nbsp;<span class="op" id="5282709">=</span>&nbsp;<span class="op" id="5282711">&amp;</span><span class="ident" id="5282712"><a href="/gostd/net/rpc/server.go.html#5276791">methodType</a></span><span class="op" id="5282722">{</span><span class="ident" id="5282723"><a href="/gostd/net/rpc/server.go.html#5276845">method</a></span><span class="op" id="5282729">:</span>&nbsp;<span class="ident" id="5282731"><a href="/gostd/net/rpc/server.go.html#5281347">method</a></span><span class="op" id="5282737">,</span>&nbsp;<span class="ident" id="5282739"><a href="/gostd/net/rpc/server.go.html#5276872">ArgType</a></span><span class="op" id="5282746">:</span>&nbsp;<span class="ident" id="5282748"><a href="/gostd/net/rpc/server.go.html#5281726">argType</a></span><span class="op" id="5282755">,</span>&nbsp;<span class="ident" id="5282757"><a href="/gostd/net/rpc/server.go.html#5276897">ReplyType</a></span><span class="op" id="5282766">:</span>&nbsp;<span class="ident" id="5282768"><a href="/gostd/net/rpc/server.go.html#5281929">replyType</a></span><span class="op" id="5282777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5282780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5282783">return</span>&nbsp;<span class="ident" id="5282790"><a href="/gostd/net/rpc/server.go.html#5281265">methods</a></span><br>
<span class="lineno"></span><span class="op" id="5282798">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="comment" id="5282801">//&nbsp;A&nbsp;value&nbsp;sent&nbsp;as&nbsp;a&nbsp;placeholder&nbsp;for&nbsp;the&nbsp;server&#39;s&nbsp;response&nbsp;value&nbsp;when&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="5282882">//&nbsp;receives&nbsp;an&nbsp;invalid&nbsp;request.&nbsp;It&nbsp;is&nbsp;never&nbsp;decoded&nbsp;by&nbsp;the&nbsp;client&nbsp;since&nbsp;the&nbsp;Response</span><br>
<span class="lineno"></span><span class="comment" id="5282967">//&nbsp;contains&nbsp;an&nbsp;error&nbsp;when&nbsp;it&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="5283005">var</span>&nbsp;<span class="ident" id="5283009">invalidRequest</span>&nbsp;<span class="op" id="5283024">=</span>&nbsp;<span class="keyword" id="5283026">struct</span><span class="op" id="5283032">{</span><span class="op" id="5283033">}</span><span class="op" id="5283034">{</span><span class="op" id="5283035">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span><span class="keyword" id="5283038">func</span>&nbsp;<span class="op" id="5283043">(</span><span class="ident" id="5283044">server</span>&nbsp;<span class="op" id="5283051">*</span><span class="ident" id="5283052"><a href="/gostd/net/rpc/server.go.html#5277991">Server</a></span><span class="op" id="5283058">)</span>&nbsp;<span class="ident" id="5283060">sendResponse</span><span class="op" id="5283072">(</span><span class="ident" id="5283073">sending</span>&nbsp;<span class="op" id="5283081">*</span><span class="ident" id="5283082"><a href="/gostd/net/rpc/server.go.html#5276449">sync</a></span><span class="op" id="5283086">.</span><span class="ident" id="5283087"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span><span class="op" id="5283092">,</span>&nbsp;<span class="ident" id="5283094">req</span>&nbsp;<span class="op" id="5283098">*</span><span class="ident" id="5283099"><a href="/gostd/net/rpc/server.go.html#5277366">Request</a></span><span class="op" id="5283106">,</span>&nbsp;<span class="ident" id="5283108">reply</span>&nbsp;<span class="keyword" id="5283114">interface</span><span class="op" id="5283123">{</span><span class="op" id="5283124">}</span><span class="op" id="5283125">,</span>&nbsp;<span class="ident" id="5283127">codec</span>&nbsp;<span class="ident" id="5283133"><a href="/gostd/net/rpc/server.go.html#5291284">ServerCodec</a></span><span class="op" id="5283144">,</span>&nbsp;<span class="ident" id="5283146">errmsg</span>&nbsp;<span class="builtintype" id="5283153">string</span><span class="op" id="5283159">)</span>&nbsp;<span class="op" id="5283161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283164">resp</span>&nbsp;<span class="op" id="5283169">:=</span>&nbsp;<span class="ident" id="5283172"><a href="/gostd/net/rpc/server.go.html#5283044">server</a></span><span class="op" id="5283178">.</span><span class="ident" id="5283179"><a href="/gostd/net/rpc/server.go.html#5287740">getResponse</a></span><span class="op" id="5283190">(</span><span class="op" id="5283191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5283194">//&nbsp;Encode&nbsp;the&nbsp;response&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283225"><a href="/gostd/net/rpc/server.go.html#5283164">resp</a></span><span class="op" id="5283229">.</span><span class="ident" id="5283230"><a href="/gostd/net/rpc/server.go.html#5277743">ServiceMethod</a></span>&nbsp;<span class="op" id="5283244">=</span>&nbsp;<span class="ident" id="5283246"><a href="/gostd/net/rpc/server.go.html#5283094">req</a></span><span class="op" id="5283249">.</span><span class="ident" id="5283250"><a href="/gostd/net/rpc/server.go.html#5277384">ServiceMethod</a></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5283265">if</span>&nbsp;<span class="ident" id="5283268"><a href="/gostd/net/rpc/server.go.html#5283146">errmsg</a></span>&nbsp;<span class="op" id="5283275">!=</span>&nbsp;<span class="string" id="5283278">&#34;&#34;</span>&nbsp;<span class="op" id="5283281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283285"><a href="/gostd/net/rpc/server.go.html#5283164">resp</a></span><span class="op" id="5283289">.</span><span class="ident" id="5283290"><a href="/gostd/net/rpc/server.go.html#5277853">Error</a></span>&nbsp;<span class="op" id="5283296">=</span>&nbsp;<span class="ident" id="5283298"><a href="/gostd/net/rpc/server.go.html#5283146">errmsg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283307"><a href="/gostd/net/rpc/server.go.html#5283108">reply</a></span>&nbsp;<span class="op" id="5283313">=</span>&nbsp;<span class="ident" id="5283315"><a href="/gostd/net/rpc/server.go.html#5283009">invalidRequest</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5283331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283334"><a href="/gostd/net/rpc/server.go.html#5283164">resp</a></span><span class="op" id="5283338">.</span><span class="ident" id="5283339"><a href="/gostd/net/rpc/server.go.html#5277798">Seq</a></span>&nbsp;<span class="op" id="5283343">=</span>&nbsp;<span class="ident" id="5283345"><a href="/gostd/net/rpc/server.go.html#5283094">req</a></span><span class="op" id="5283348">.</span><span class="ident" id="5283349"><a href="/gostd/net/rpc/server.go.html#5277436">Seq</a></span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283354"><a href="/gostd/net/rpc/server.go.html#5283073">sending</a></span><span class="op" id="5283361">.</span><span class="ident" id="5283362"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5283366">(</span><span class="op" id="5283367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283370">err</span>&nbsp;<span class="op" id="5283374">:=</span>&nbsp;<span class="ident" id="5283377"><a href="/gostd/net/rpc/server.go.html#5283127">codec</a></span><span class="op" id="5283382">.</span><span class="ident" id="5283383"><a href="/gostd/net/rpc/server.go.html#5291454">WriteResponse</a></span><span class="op" id="5283396">(</span><span class="ident" id="5283397"><a href="/gostd/net/rpc/server.go.html#5283164">resp</a></span><span class="op" id="5283401">,</span>&nbsp;<span class="ident" id="5283403"><a href="/gostd/net/rpc/server.go.html#5283108">reply</a></span><span class="op" id="5283408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5283411">if</span>&nbsp;<span class="ident" id="5283414"><a href="/gostd/net/rpc/debug.go.html#5270990">debugLog</a></span>&nbsp;<span class="op" id="5283423">&amp;&amp;</span>&nbsp;<span class="ident" id="5283426"><a href="/gostd/net/rpc/server.go.html#5283370">err</a></span>&nbsp;<span class="op" id="5283430">!=</span>&nbsp;<span class="builtintype" id="5283433">nil</span>&nbsp;<span class="op" id="5283437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283441"><a href="/gostd/net/rpc/server.go.html#5276401">log</a></span><span class="op" id="5283444">.</span><span class="ident" id="5283445"><a href="/gostd/log/log.go.html#4078868">Println</a></span><span class="op" id="5283452">(</span><span class="string" id="5283453">&#34;rpc:&nbsp;writing&nbsp;response:&#34;</span><span class="op" id="5283477">,</span>&nbsp;<span class="ident" id="5283479"><a href="/gostd/net/rpc/server.go.html#5283370">err</a></span><span class="op" id="5283482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5283485">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283488"><a href="/gostd/net/rpc/server.go.html#5283073">sending</a></span><span class="op" id="5283495">.</span><span class="ident" id="5283496"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5283502">(</span><span class="op" id="5283503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283506"><a href="/gostd/net/rpc/server.go.html#5283044">server</a></span><span class="op" id="5283512">.</span><span class="ident" id="5283513"><a href="/gostd/net/rpc/server.go.html#5287984">freeResponse</a></span><span class="op" id="5283525">(</span><span class="ident" id="5283526"><a href="/gostd/net/rpc/server.go.html#5283164">resp</a></span><span class="op" id="5283530">)</span><br>
<span class="lineno"></span><span class="op" id="5283532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5283535">func</span>&nbsp;<span class="op" id="5283540">(</span><span class="ident" id="5283541">m</span>&nbsp;<span class="op" id="5283543">*</span><span class="ident" id="5283544"><a href="/gostd/net/rpc/server.go.html#5276791">methodType</a></span><span class="op" id="5283554">)</span>&nbsp;<span class="ident" id="5283556">NumCalls</span><span class="op" id="5283564">(</span><span class="op" id="5283565">)</span>&nbsp;<span class="op" id="5283567">(</span><span class="ident" id="5283568">n</span>&nbsp;<span class="builtintype" id="5283570">uint</span><span class="op" id="5283574">)</span>&nbsp;<span class="op" id="5283576">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283579"><a href="/gostd/net/rpc/server.go.html#5283541">m</a></span><span class="op" id="5283580">.</span><span class="ident" id="5283581"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5283585">(</span><span class="op" id="5283586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283589"><a href="/gostd/net/rpc/server.go.html#5283568">n</a></span>&nbsp;<span class="op" id="5283591">=</span>&nbsp;<span class="ident" id="5283593"><a href="/gostd/net/rpc/server.go.html#5283541">m</a></span><span class="op" id="5283594">.</span><span class="ident" id="5283595"><a href="/gostd/net/rpc/server.go.html#5276922">numCalls</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283605"><a href="/gostd/net/rpc/server.go.html#5283541">m</a></span><span class="op" id="5283606">.</span><span class="ident" id="5283607"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5283613">(</span><span class="op" id="5283614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5283617">return</span>&nbsp;<span class="ident" id="5283624"><a href="/gostd/net/rpc/server.go.html#5283568">n</a></span><br>
<span class="lineno"></span><span class="op" id="5283626">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="5283629">func</span>&nbsp;<span class="op" id="5283634">(</span><span class="ident" id="5283635">s</span>&nbsp;<span class="op" id="5283637">*</span><span class="ident" id="5283638"><a href="/gostd/net/rpc/server.go.html#5276946">service</a></span><span class="op" id="5283645">)</span>&nbsp;<span class="ident" id="5283647">call</span><span class="op" id="5283651">(</span><span class="ident" id="5283652">server</span>&nbsp;<span class="op" id="5283659">*</span><span class="ident" id="5283660"><a href="/gostd/net/rpc/server.go.html#5277991">Server</a></span><span class="op" id="5283666">,</span>&nbsp;<span class="ident" id="5283668">sending</span>&nbsp;<span class="op" id="5283676">*</span><span class="ident" id="5283677"><a href="/gostd/net/rpc/server.go.html#5276449">sync</a></span><span class="op" id="5283681">.</span><span class="ident" id="5283682"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span><span class="op" id="5283687">,</span>&nbsp;<span class="ident" id="5283689">mtype</span>&nbsp;<span class="op" id="5283695">*</span><span class="ident" id="5283696"><a href="/gostd/net/rpc/server.go.html#5276791">methodType</a></span><span class="op" id="5283706">,</span>&nbsp;<span class="ident" id="5283708">req</span>&nbsp;<span class="op" id="5283712">*</span><span class="ident" id="5283713"><a href="/gostd/net/rpc/server.go.html#5277366">Request</a></span><span class="op" id="5283720">,</span>&nbsp;<span class="ident" id="5283722">argv</span><span class="op" id="5283726">,</span>&nbsp;<span class="ident" id="5283728">replyv</span>&nbsp;<span class="ident" id="5283735"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5283742">.</span><span class="ident" id="5283743"><a href="/gostd/reflect/value.go.html#2833557">Value</a></span><span class="op" id="5283748">,</span>&nbsp;<span class="ident" id="5283750">codec</span>&nbsp;<span class="ident" id="5283756"><a href="/gostd/net/rpc/server.go.html#5291284">ServerCodec</a></span><span class="op" id="5283767">)</span>&nbsp;<span class="op" id="5283769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283772"><a href="/gostd/net/rpc/server.go.html#5283689">mtype</a></span><span class="op" id="5283777">.</span><span class="ident" id="5283778"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5283782">(</span><span class="op" id="5283783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283786"><a href="/gostd/net/rpc/server.go.html#5283689">mtype</a></span><span class="op" id="5283791">.</span><span class="ident" id="5283792"><a href="/gostd/net/rpc/server.go.html#5276922">numCalls</a></span><span class="op" id="5283800">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283804"><a href="/gostd/net/rpc/server.go.html#5283689">mtype</a></span><span class="op" id="5283809">.</span><span class="ident" id="5283810"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5283816">(</span><span class="op" id="5283817">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283820">function</span>&nbsp;<span class="op" id="5283829">:=</span>&nbsp;<span class="ident" id="5283832"><a href="/gostd/net/rpc/server.go.html#5283689">mtype</a></span><span class="op" id="5283837">.</span><span class="ident" id="5283838"><a href="/gostd/net/rpc/server.go.html#5276845">method</a></span><span class="op" id="5283844">.</span><span class="ident" id="5283845"><a href="/gostd/reflect/type.go.html#2793358">Func</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5283851">//&nbsp;Invoke&nbsp;the&nbsp;method,&nbsp;providing&nbsp;a&nbsp;new&nbsp;value&nbsp;for&nbsp;the&nbsp;reply.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283911">returnValues</span>&nbsp;<span class="op" id="5283924">:=</span>&nbsp;<span class="ident" id="5283927"><a href="/gostd/net/rpc/server.go.html#5283820">function</a></span><span class="op" id="5283935">.</span><span class="ident" id="5283936"><a href="/gostd/reflect/value.go.html#2841720">Call</a></span><span class="op" id="5283940">(</span><span class="op" id="5283941">[</span><span class="op" id="5283942">]</span><span class="ident" id="5283943"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5283950">.</span><span class="ident" id="5283951"><a href="/gostd/reflect/value.go.html#2833557">Value</a></span><span class="op" id="5283956">{</span><span class="ident" id="5283957"><a href="/gostd/net/rpc/server.go.html#5283635">s</a></span><span class="op" id="5283958">.</span><span class="ident" id="5283959"><a href="/gostd/net/rpc/server.go.html#5277014">rcvr</a></span><span class="op" id="5283963">,</span>&nbsp;<span class="ident" id="5283965"><a href="/gostd/net/rpc/server.go.html#5283722">argv</a></span><span class="op" id="5283969">,</span>&nbsp;<span class="ident" id="5283971"><a href="/gostd/net/rpc/server.go.html#5283728">replyv</a></span><span class="op" id="5283977">}</span><span class="op" id="5283978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5283981">//&nbsp;The&nbsp;return&nbsp;value&nbsp;for&nbsp;the&nbsp;method&nbsp;is&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5284030">errInter</span>&nbsp;<span class="op" id="5284039">:=</span>&nbsp;<span class="ident" id="5284042"><a href="/gostd/net/rpc/server.go.html#5283911">returnValues</a></span><span class="op" id="5284054">[</span><span class="num" id="5284055">0</span><span class="op" id="5284056">]</span><span class="op" id="5284057">.</span><span class="ident" id="5284058"><a href="/gostd/reflect/value.go.html#2858688">Interface</a></span><span class="op" id="5284067">(</span><span class="op" id="5284068">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5284071">errmsg</span>&nbsp;<span class="op" id="5284078">:=</span>&nbsp;<span class="string" id="5284081">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5284085">if</span>&nbsp;<span class="ident" id="5284088"><a href="/gostd/net/rpc/server.go.html#5284030">errInter</a></span>&nbsp;<span class="op" id="5284097">!=</span>&nbsp;<span class="builtintype" id="5284100">nil</span>&nbsp;<span class="op" id="5284104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5284108"><a href="/gostd/net/rpc/server.go.html#5284071">errmsg</a></span>&nbsp;<span class="op" id="5284115">=</span>&nbsp;<span class="ident" id="5284117"><a href="/gostd/net/rpc/server.go.html#5284030">errInter</a></span><span class="op" id="5284125">.</span><span class="op" id="5284126">(</span><span class="builtintype" id="5284127">error</span><span class="op" id="5284132">)</span><span class="op" id="5284133">.</span><span class="ident" id="5284134">Error</span><span class="op" id="5284139">(</span><span class="op" id="5284140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5284143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5284146"><a href="/gostd/net/rpc/server.go.html#5283652">server</a></span><span class="op" id="5284152">.</span><span class="ident" id="5284153"><a href="/gostd/net/rpc/server.go.html#5283060">sendResponse</a></span><span class="op" id="5284165">(</span><span class="ident" id="5284166"><a href="/gostd/net/rpc/server.go.html#5283668">sending</a></span><span class="op" id="5284173">,</span>&nbsp;<span class="ident" id="5284175"><a href="/gostd/net/rpc/server.go.html#5283708">req</a></span><span class="op" id="5284178">,</span>&nbsp;<span class="ident" id="5284180"><a href="/gostd/net/rpc/server.go.html#5283728">replyv</a></span><span class="op" id="5284186">.</span><span class="ident" id="5284187"><a href="/gostd/reflect/value.go.html#2858688">Interface</a></span><span class="op" id="5284196">(</span><span class="op" id="5284197">)</span><span class="op" id="5284198">,</span>&nbsp;<span class="ident" id="5284200"><a href="/gostd/net/rpc/server.go.html#5283750">codec</a></span><span class="op" id="5284205">,</span>&nbsp;<span class="ident" id="5284207"><a href="/gostd/net/rpc/server.go.html#5284071">errmsg</a></span><span class="op" id="5284213">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5284216"><a href="/gostd/net/rpc/server.go.html#5283652">server</a></span><span class="op" id="5284222">.</span><span class="ident" id="5284223"><a href="/gostd/net/rpc/server.go.html#5287590">freeRequest</a></span><span class="op" id="5284234">(</span><span class="ident" id="5284235"><a href="/gostd/net/rpc/server.go.html#5283708">req</a></span><span class="op" id="5284238">)</span><br>
<span class="lineno"></span><span class="op" id="5284240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5284243">type</span>&nbsp;<span class="ident" id="5284248">gobServerCodec</span>&nbsp;<span class="keyword" id="5284263">struct</span>&nbsp;<span class="op" id="5284270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5284273">rwc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5284280"><a href="/gostd/net/rpc/server.go.html#5276395">io</a></span><span class="op" id="5284282">.</span><span class="ident" id="5284283"><a href="/gostd/io/io.go.html#1423677">ReadWriteCloser</a></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5284300">dec</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5284307">*</span><span class="ident" id="5284308"><a href="/gostd/net/rpc/server.go.html#5276369">gob</a></span><span class="op" id="5284311">.</span><span class="ident" id="5284312"><a href="/gostd/encoding/gob/decoder.go.html#5346580">Decoder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5284321">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5284328">*</span><span class="ident" id="5284329"><a href="/gostd/net/rpc/server.go.html#5276369">gob</a></span><span class="op" id="5284332">.</span><span class="ident" id="5284333"><a href="/gostd/encoding/gob/encoder.go.html#5399090">Encoder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5284342">encBuf</span>&nbsp;<span class="op" id="5284349">*</span><span class="ident" id="5284350"><a href="/gostd/net/rpc/server.go.html#5276360">bufio</a></span><span class="op" id="5284355">.</span><span class="ident" id="5284356"><a href="/gostd/bufio/bufio.go.html#1366565">Writer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5284364">closed</span>&nbsp;<span class="builtintype" id="5284371">bool</span><br>
<span class="lineno"></span><span class="op" id="5284376">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="keyword" id="5284379">func</span>&nbsp;<span class="op" id="5284384">(</span><span class="ident" id="5284385">c</span>&nbsp;<span class="op" id="5284387">*</span><span class="ident" id="5284388"><a href="/gostd/net/rpc/server.go.html#5284248">gobServerCodec</a></span><span class="op" id="5284402">)</span>&nbsp;<span class="ident" id="5284404">ReadRequestHeader</span><span class="op" id="5284421">(</span><span class="ident" id="5284422">r</span>&nbsp;<span class="op" id="5284424">*</span><span class="ident" id="5284425"><a href="/gostd/net/rpc/server.go.html#5277366">Request</a></span><span class="op" id="5284432">)</span>&nbsp;<span class="builtintype" id="5284434">error</span>&nbsp;<span class="op" id="5284440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5284443">return</span>&nbsp;<span class="ident" id="5284450"><a href="/gostd/net/rpc/server.go.html#5284385">c</a></span><span class="op" id="5284451">.</span><span class="ident" id="5284452"><a href="/gostd/net/rpc/server.go.html#5284300">dec</a></span><span class="op" id="5284455">.</span><span class="ident" id="5284456"><a href="/gostd/encoding/gob/decoder.go.html#5351182">Decode</a></span><span class="op" id="5284462">(</span><span class="ident" id="5284463"><a href="/gostd/net/rpc/server.go.html#5284422">r</a></span><span class="op" id="5284464">)</span><br>
<span class="lineno"></span><span class="op" id="5284466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="keyword" id="5284469">func</span>&nbsp;<span class="op" id="5284474">(</span><span class="ident" id="5284475">c</span>&nbsp;<span class="op" id="5284477">*</span><span class="ident" id="5284478"><a href="/gostd/net/rpc/server.go.html#5284248">gobServerCodec</a></span><span class="op" id="5284492">)</span>&nbsp;<span class="ident" id="5284494">ReadRequestBody</span><span class="op" id="5284509">(</span><span class="ident" id="5284510">body</span>&nbsp;<span class="keyword" id="5284515">interface</span><span class="op" id="5284524">{</span><span class="op" id="5284525">}</span><span class="op" id="5284526">)</span>&nbsp;<span class="builtintype" id="5284528">error</span>&nbsp;<span class="op" id="5284534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5284537">return</span>&nbsp;<span class="ident" id="5284544"><a href="/gostd/net/rpc/server.go.html#5284475">c</a></span><span class="op" id="5284545">.</span><span class="ident" id="5284546"><a href="/gostd/net/rpc/server.go.html#5284300">dec</a></span><span class="op" id="5284549">.</span><span class="ident" id="5284550"><a href="/gostd/encoding/gob/decoder.go.html#5351182">Decode</a></span><span class="op" id="5284556">(</span><span class="ident" id="5284557"><a href="/gostd/net/rpc/server.go.html#5284510">body</a></span><span class="op" id="5284561">)</span><br>
<span class="lineno"></span><span class="op" id="5284563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5284566">func</span>&nbsp;<span class="op" id="5284571">(</span><span class="ident" id="5284572">c</span>&nbsp;<span class="op" id="5284574">*</span><span class="ident" id="5284575"><a href="/gostd/net/rpc/server.go.html#5284248">gobServerCodec</a></span><span class="op" id="5284589">)</span>&nbsp;<span class="ident" id="5284591">WriteResponse</span><span class="op" id="5284604">(</span><span class="ident" id="5284605">r</span>&nbsp;<span class="op" id="5284607">*</span><span class="ident" id="5284608"><a href="/gostd/net/rpc/server.go.html#5277724">Response</a></span><span class="op" id="5284616">,</span>&nbsp;<span class="ident" id="5284618">body</span>&nbsp;<span class="keyword" id="5284623">interface</span><span class="op" id="5284632">{</span><span class="op" id="5284633">}</span><span class="op" id="5284634">)</span>&nbsp;<span class="op" id="5284636">(</span><span class="ident" id="5284637">err</span>&nbsp;<span class="builtintype" id="5284641">error</span><span class="op" id="5284646">)</span>&nbsp;<span class="op" id="5284648">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5284651">if</span>&nbsp;<span class="ident" id="5284654"><a href="/gostd/net/rpc/server.go.html#5284637">err</a></span>&nbsp;<span class="op" id="5284658">=</span>&nbsp;<span class="ident" id="5284660"><a href="/gostd/net/rpc/server.go.html#5284572">c</a></span><span class="op" id="5284661">.</span><span class="ident" id="5284662"><a href="/gostd/net/rpc/server.go.html#5284321">enc</a></span><span class="op" id="5284665">.</span><span class="ident" id="5284666"><a href="/gostd/encoding/gob/encoder.go.html#5403967">Encode</a></span><span class="op" id="5284672">(</span><span class="ident" id="5284673"><a href="/gostd/net/rpc/server.go.html#5284605">r</a></span><span class="op" id="5284674">)</span><span class="op" id="5284675">;</span>&nbsp;<span class="ident" id="5284677"><a href="/gostd/net/rpc/server.go.html#5284637">err</a></span>&nbsp;<span class="op" id="5284681">!=</span>&nbsp;<span class="builtintype" id="5284684">nil</span>&nbsp;<span class="op" id="5284688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5284692">if</span>&nbsp;<span class="ident" id="5284695"><a href="/gostd/net/rpc/server.go.html#5284572">c</a></span><span class="op" id="5284696">.</span><span class="ident" id="5284697"><a href="/gostd/net/rpc/server.go.html#5284342">encBuf</a></span><span class="op" id="5284703">.</span><span class="ident" id="5284704"><a href="/gostd/bufio/bufio.go.html#1367486">Flush</a></span><span class="op" id="5284709">(</span><span class="op" id="5284710">)</span>&nbsp;<span class="op" id="5284712">==</span>&nbsp;<span class="builtintype" id="5284715">nil</span>&nbsp;<span class="op" id="5284719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5284724">//&nbsp;Gob&nbsp;couldn&#39;t&nbsp;encode&nbsp;the&nbsp;header.&nbsp;Should&nbsp;not&nbsp;happen,&nbsp;so&nbsp;if&nbsp;it&nbsp;does,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5284796">//&nbsp;shut&nbsp;down&nbsp;the&nbsp;connection&nbsp;to&nbsp;signal&nbsp;that&nbsp;the&nbsp;connection&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5284868"><a href="/gostd/net/rpc/server.go.html#5276401">log</a></span><span class="op" id="5284871">.</span><span class="ident" id="5284872"><a href="/gostd/log/log.go.html#4078868">Println</a></span><span class="op" id="5284879">(</span><span class="string" id="5284880">&#34;rpc:&nbsp;gob&nbsp;error&nbsp;encoding&nbsp;response:&#34;</span><span class="op" id="5284915">,</span>&nbsp;<span class="ident" id="5284917"><a href="/gostd/net/rpc/server.go.html#5284637">err</a></span><span class="op" id="5284920">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5284925"><a href="/gostd/net/rpc/server.go.html#5284572">c</a></span><span class="op" id="5284926">.</span><span class="ident" id="5284927"><a href="/gostd/net/rpc/server.go.html#5285307">Close</a></span><span class="op" id="5284932">(</span><span class="op" id="5284933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5284937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5284941">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5284949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5284952">if</span>&nbsp;<span class="ident" id="5284955"><a href="/gostd/net/rpc/server.go.html#5284637">err</a></span>&nbsp;<span class="op" id="5284959">=</span>&nbsp;<span class="ident" id="5284961"><a href="/gostd/net/rpc/server.go.html#5284572">c</a></span><span class="op" id="5284962">.</span><span class="ident" id="5284963"><a href="/gostd/net/rpc/server.go.html#5284321">enc</a></span><span class="op" id="5284966">.</span><span class="ident" id="5284967"><a href="/gostd/encoding/gob/encoder.go.html#5403967">Encode</a></span><span class="op" id="5284973">(</span><span class="ident" id="5284974"><a href="/gostd/net/rpc/server.go.html#5284618">body</a></span><span class="op" id="5284978">)</span><span class="op" id="5284979">;</span>&nbsp;<span class="ident" id="5284981"><a href="/gostd/net/rpc/server.go.html#5284637">err</a></span>&nbsp;<span class="op" id="5284985">!=</span>&nbsp;<span class="builtintype" id="5284988">nil</span>&nbsp;<span class="op" id="5284992">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5284996">if</span>&nbsp;<span class="ident" id="5284999"><a href="/gostd/net/rpc/server.go.html#5284572">c</a></span><span class="op" id="5285000">.</span><span class="ident" id="5285001"><a href="/gostd/net/rpc/server.go.html#5284342">encBuf</a></span><span class="op" id="5285007">.</span><span class="ident" id="5285008"><a href="/gostd/bufio/bufio.go.html#1367486">Flush</a></span><span class="op" id="5285013">(</span><span class="op" id="5285014">)</span>&nbsp;<span class="op" id="5285016">==</span>&nbsp;<span class="builtintype" id="5285019">nil</span>&nbsp;<span class="op" id="5285023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5285028">//&nbsp;Was&nbsp;a&nbsp;gob&nbsp;problem&nbsp;encoding&nbsp;the&nbsp;body&nbsp;but&nbsp;the&nbsp;header&nbsp;has&nbsp;been&nbsp;written.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5285103">//&nbsp;Shut&nbsp;down&nbsp;the&nbsp;connection&nbsp;to&nbsp;signal&nbsp;that&nbsp;the&nbsp;connection&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285175"><a href="/gostd/net/rpc/server.go.html#5276401">log</a></span><span class="op" id="5285178">.</span><span class="ident" id="5285179"><a href="/gostd/log/log.go.html#4078868">Println</a></span><span class="op" id="5285186">(</span><span class="string" id="5285187">&#34;rpc:&nbsp;gob&nbsp;error&nbsp;encoding&nbsp;body:&#34;</span><span class="op" id="5285218">,</span>&nbsp;<span class="ident" id="5285220"><a href="/gostd/net/rpc/server.go.html#5284637">err</a></span><span class="op" id="5285223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285228"><a href="/gostd/net/rpc/server.go.html#5284572">c</a></span><span class="op" id="5285229">.</span><span class="ident" id="5285230"><a href="/gostd/net/rpc/server.go.html#5285307">Close</a></span><span class="op" id="5285235">(</span><span class="op" id="5285236">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5285240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5285244">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5285252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5285255">return</span>&nbsp;<span class="ident" id="5285262"><a href="/gostd/net/rpc/server.go.html#5284572">c</a></span><span class="op" id="5285263">.</span><span class="ident" id="5285264"><a href="/gostd/net/rpc/server.go.html#5284342">encBuf</a></span><span class="op" id="5285270">.</span><span class="ident" id="5285271"><a href="/gostd/bufio/bufio.go.html#1367486">Flush</a></span><span class="op" id="5285276">(</span><span class="op" id="5285277">)</span><br>
<span class="lineno"></span><span class="op" id="5285279">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span><span class="keyword" id="5285282">func</span>&nbsp;<span class="op" id="5285287">(</span><span class="ident" id="5285288">c</span>&nbsp;<span class="op" id="5285290">*</span><span class="ident" id="5285291"><a href="/gostd/net/rpc/server.go.html#5284248">gobServerCodec</a></span><span class="op" id="5285305">)</span>&nbsp;<span class="ident" id="5285307">Close</span><span class="op" id="5285312">(</span><span class="op" id="5285313">)</span>&nbsp;<span class="builtintype" id="5285315">error</span>&nbsp;<span class="op" id="5285321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5285324">if</span>&nbsp;<span class="ident" id="5285327"><a href="/gostd/net/rpc/server.go.html#5285288">c</a></span><span class="op" id="5285328">.</span><span class="ident" id="5285329"><a href="/gostd/net/rpc/server.go.html#5284364">closed</a></span>&nbsp;<span class="op" id="5285336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5285340">//&nbsp;Only&nbsp;call&nbsp;c.rwc.Close&nbsp;once;&nbsp;otherwise&nbsp;the&nbsp;semantics&nbsp;are&nbsp;undefined.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5285412">return</span>&nbsp;<span class="builtintype" id="5285419">nil</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5285424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285427"><a href="/gostd/net/rpc/server.go.html#5285288">c</a></span><span class="op" id="5285428">.</span><span class="ident" id="5285429"><a href="/gostd/net/rpc/server.go.html#5284364">closed</a></span>&nbsp;<span class="op" id="5285436">=</span>&nbsp;<span class="builtintype" id="5285438">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5285444">return</span>&nbsp;<span class="ident" id="5285451"><a href="/gostd/net/rpc/server.go.html#5285288">c</a></span><span class="op" id="5285452">.</span><span class="ident" id="5285453"><a href="/gostd/net/rpc/server.go.html#5284273">rwc</a></span><span class="op" id="5285456">.</span><span class="ident" id="5285457"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="5285462">(</span><span class="op" id="5285463">)</span><br>
<span class="lineno"></span><span class="op" id="5285465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="comment" id="5285468">//&nbsp;ServeConn&nbsp;runs&nbsp;the&nbsp;server&nbsp;on&nbsp;a&nbsp;single&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5285521">//&nbsp;ServeConn&nbsp;blocks,&nbsp;serving&nbsp;the&nbsp;connection&nbsp;until&nbsp;the&nbsp;client&nbsp;hangs&nbsp;up.</span><br>
<span class="lineno"></span><span class="comment" id="5285592">//&nbsp;The&nbsp;caller&nbsp;typically&nbsp;invokes&nbsp;ServeConn&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="5285653">//&nbsp;ServeConn&nbsp;uses&nbsp;the&nbsp;gob&nbsp;wire&nbsp;format&nbsp;(see&nbsp;package&nbsp;gob)&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5285716">//&nbsp;connection.&nbsp;&nbsp;To&nbsp;use&nbsp;an&nbsp;alternate&nbsp;codec,&nbsp;use&nbsp;ServeCodec.</span><br>
<span class="lineno">445</span><span class="keyword" id="5285775">func</span>&nbsp;<span class="op" id="5285780">(</span><span class="ident" id="5285781">server</span>&nbsp;<span class="op" id="5285788">*</span><span class="ident" id="5285789"><a href="/gostd/net/rpc/server.go.html#5277991">Server</a></span><span class="op" id="5285795">)</span>&nbsp;<span class="ident" id="5285797">ServeConn</span><span class="op" id="5285806">(</span><span class="ident" id="5285807">conn</span>&nbsp;<span class="ident" id="5285812"><a href="/gostd/net/rpc/server.go.html#5276395">io</a></span><span class="op" id="5285814">.</span><span class="ident" id="5285815"><a href="/gostd/io/io.go.html#1423677">ReadWriteCloser</a></span><span class="op" id="5285830">)</span>&nbsp;<span class="op" id="5285832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285835">buf</span>&nbsp;<span class="op" id="5285839">:=</span>&nbsp;<span class="ident" id="5285842"><a href="/gostd/net/rpc/server.go.html#5276360">bufio</a></span><span class="op" id="5285847">.</span><span class="ident" id="5285848"><a href="/gostd/bufio/bufio.go.html#1367149">NewWriter</a></span><span class="op" id="5285857">(</span><span class="ident" id="5285858"><a href="/gostd/net/rpc/server.go.html#5285807">conn</a></span><span class="op" id="5285862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285865">srv</span>&nbsp;<span class="op" id="5285869">:=</span>&nbsp;<span class="op" id="5285872">&amp;</span><span class="ident" id="5285873"><a href="/gostd/net/rpc/server.go.html#5284248">gobServerCodec</a></span><span class="op" id="5285887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285891"><a href="/gostd/net/rpc/server.go.html#5284273">rwc</a></span><span class="op" id="5285894">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285899"><a href="/gostd/net/rpc/server.go.html#5285807">conn</a></span><span class="op" id="5285903">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285907"><a href="/gostd/net/rpc/server.go.html#5284300">dec</a></span><span class="op" id="5285910">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285915"><a href="/gostd/net/rpc/server.go.html#5276369">gob</a></span><span class="op" id="5285918">.</span><span class="ident" id="5285919"><a href="/gostd/encoding/gob/decoder.go.html#5347520">NewDecoder</a></span><span class="op" id="5285929">(</span><span class="ident" id="5285930"><a href="/gostd/net/rpc/server.go.html#5285807">conn</a></span><span class="op" id="5285934">)</span><span class="op" id="5285935">,</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285939"><a href="/gostd/net/rpc/server.go.html#5284321">enc</a></span><span class="op" id="5285942">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285947"><a href="/gostd/net/rpc/server.go.html#5276369">gob</a></span><span class="op" id="5285950">.</span><span class="ident" id="5285951"><a href="/gostd/encoding/gob/encoder.go.html#5399935">NewEncoder</a></span><span class="op" id="5285961">(</span><span class="ident" id="5285962"><a href="/gostd/net/rpc/server.go.html#5285835">buf</a></span><span class="op" id="5285965">)</span><span class="op" id="5285966">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285970"><a href="/gostd/net/rpc/server.go.html#5284342">encBuf</a></span><span class="op" id="5285976">:</span>&nbsp;<span class="ident" id="5285978"><a href="/gostd/net/rpc/server.go.html#5285835">buf</a></span><span class="op" id="5285981">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5285984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285987"><a href="/gostd/net/rpc/server.go.html#5285781">server</a></span><span class="op" id="5285993">.</span><span class="ident" id="5285994"><a href="/gostd/net/rpc/server.go.html#5286140">ServeCodec</a></span><span class="op" id="5286004">(</span><span class="ident" id="5286005"><a href="/gostd/net/rpc/server.go.html#5285865">srv</a></span><span class="op" id="5286008">)</span><br>
<span class="lineno"></span><span class="op" id="5286010">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="5286013">//&nbsp;ServeCodec&nbsp;is&nbsp;like&nbsp;ServeConn&nbsp;but&nbsp;uses&nbsp;the&nbsp;specified&nbsp;codec&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5286077">//&nbsp;decode&nbsp;requests&nbsp;and&nbsp;encode&nbsp;responses.</span><br>
<span class="lineno"></span><span class="keyword" id="5286118">func</span>&nbsp;<span class="op" id="5286123">(</span><span class="ident" id="5286124">server</span>&nbsp;<span class="op" id="5286131">*</span><span class="ident" id="5286132"><a href="/gostd/net/rpc/server.go.html#5277991">Server</a></span><span class="op" id="5286138">)</span>&nbsp;<span class="ident" id="5286140">ServeCodec</span><span class="op" id="5286150">(</span><span class="ident" id="5286151">codec</span>&nbsp;<span class="ident" id="5286157"><a href="/gostd/net/rpc/server.go.html#5291284">ServerCodec</a></span><span class="op" id="5286168">)</span>&nbsp;<span class="op" id="5286170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5286173">sending</span>&nbsp;<span class="op" id="5286181">:=</span>&nbsp;<span class="builtinfunc" id="5286184">new</span><span class="op" id="5286187">(</span><span class="ident" id="5286188"><a href="/gostd/net/rpc/server.go.html#5276449">sync</a></span><span class="op" id="5286192">.</span><span class="ident" id="5286193"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span><span class="op" id="5286198">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286201">for</span>&nbsp;<span class="op" id="5286205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5286209">service</span><span class="op" id="5286216">,</span>&nbsp;<span class="ident" id="5286218">mtype</span><span class="op" id="5286223">,</span>&nbsp;<span class="ident" id="5286225">req</span><span class="op" id="5286228">,</span>&nbsp;<span class="ident" id="5286230">argv</span><span class="op" id="5286234">,</span>&nbsp;<span class="ident" id="5286236">replyv</span><span class="op" id="5286242">,</span>&nbsp;<span class="ident" id="5286244">keepReading</span><span class="op" id="5286255">,</span>&nbsp;<span class="ident" id="5286257">err</span>&nbsp;<span class="op" id="5286261">:=</span>&nbsp;<span class="ident" id="5286264"><a href="/gostd/net/rpc/server.go.html#5286124">server</a></span><span class="op" id="5286270">.</span><span class="ident" id="5286271"><a href="/gostd/net/rpc/server.go.html#5288143">readRequest</a></span><span class="op" id="5286282">(</span><span class="ident" id="5286283"><a href="/gostd/net/rpc/server.go.html#5286151">codec</a></span><span class="op" id="5286288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286292">if</span>&nbsp;<span class="ident" id="5286295"><a href="/gostd/net/rpc/server.go.html#5286257">err</a></span>&nbsp;<span class="op" id="5286299">!=</span>&nbsp;<span class="builtintype" id="5286302">nil</span>&nbsp;<span class="op" id="5286306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286311">if</span>&nbsp;<span class="ident" id="5286314"><a href="/gostd/net/rpc/debug.go.html#5270990">debugLog</a></span>&nbsp;<span class="op" id="5286323">&amp;&amp;</span>&nbsp;<span class="ident" id="5286326"><a href="/gostd/net/rpc/server.go.html#5286257">err</a></span>&nbsp;<span class="op" id="5286330">!=</span>&nbsp;<span class="ident" id="5286333"><a href="/gostd/net/rpc/server.go.html#5276395">io</a></span><span class="op" id="5286335">.</span><span class="ident" id="5286336"><a href="/gostd/io/io.go.html#1419950">EOF</a></span>&nbsp;<span class="op" id="5286340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5286346"><a href="/gostd/net/rpc/server.go.html#5276401">log</a></span><span class="op" id="5286349">.</span><span class="ident" id="5286350"><a href="/gostd/log/log.go.html#4078868">Println</a></span><span class="op" id="5286357">(</span><span class="string" id="5286358">&#34;rpc:&#34;</span><span class="op" id="5286364">,</span>&nbsp;<span class="ident" id="5286366"><a href="/gostd/net/rpc/server.go.html#5286257">err</a></span><span class="op" id="5286369">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5286374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286379">if</span>&nbsp;<span class="op" id="5286382">!</span><span class="ident" id="5286383"><a href="/gostd/net/rpc/server.go.html#5286244">keepReading</a></span>&nbsp;<span class="op" id="5286395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286401">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5286410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5286415">//&nbsp;send&nbsp;a&nbsp;response&nbsp;if&nbsp;we&nbsp;actually&nbsp;managed&nbsp;to&nbsp;read&nbsp;a&nbsp;header.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286478">if</span>&nbsp;<span class="ident" id="5286481"><a href="/gostd/net/rpc/server.go.html#5286225">req</a></span>&nbsp;<span class="op" id="5286485">!=</span>&nbsp;<span class="builtintype" id="5286488">nil</span>&nbsp;<span class="op" id="5286492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5286498"><a href="/gostd/net/rpc/server.go.html#5286124">server</a></span><span class="op" id="5286504">.</span><span class="ident" id="5286505"><a href="/gostd/net/rpc/server.go.html#5283060">sendResponse</a></span><span class="op" id="5286517">(</span><span class="ident" id="5286518"><a href="/gostd/net/rpc/server.go.html#5286173">sending</a></span><span class="op" id="5286525">,</span>&nbsp;<span class="ident" id="5286527"><a href="/gostd/net/rpc/server.go.html#5286225">req</a></span><span class="op" id="5286530">,</span>&nbsp;<span class="ident" id="5286532"><a href="/gostd/net/rpc/server.go.html#5283009">invalidRequest</a></span><span class="op" id="5286546">,</span>&nbsp;<span class="ident" id="5286548"><a href="/gostd/net/rpc/server.go.html#5286151">codec</a></span><span class="op" id="5286553">,</span>&nbsp;<span class="ident" id="5286555"><a href="/gostd/net/rpc/server.go.html#5286257">err</a></span><span class="op" id="5286558">.</span><span class="ident" id="5286559">Error</span><span class="op" id="5286564">(</span><span class="op" id="5286565">)</span><span class="op" id="5286566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5286572"><a href="/gostd/net/rpc/server.go.html#5286124">server</a></span><span class="op" id="5286578">.</span><span class="ident" id="5286579"><a href="/gostd/net/rpc/server.go.html#5287590">freeRequest</a></span><span class="op" id="5286590">(</span><span class="ident" id="5286591"><a href="/gostd/net/rpc/server.go.html#5286225">req</a></span><span class="op" id="5286594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5286599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286604">continue</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5286615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286619">go</span>&nbsp;<span class="ident" id="5286622"><a href="/gostd/net/rpc/server.go.html#5286209">service</a></span><span class="op" id="5286629">.</span><span class="ident" id="5286630"><a href="/gostd/net/rpc/server.go.html#5283647">call</a></span><span class="op" id="5286634">(</span><span class="ident" id="5286635"><a href="/gostd/net/rpc/server.go.html#5286124">server</a></span><span class="op" id="5286641">,</span>&nbsp;<span class="ident" id="5286643"><a href="/gostd/net/rpc/server.go.html#5286173">sending</a></span><span class="op" id="5286650">,</span>&nbsp;<span class="ident" id="5286652"><a href="/gostd/net/rpc/server.go.html#5286218">mtype</a></span><span class="op" id="5286657">,</span>&nbsp;<span class="ident" id="5286659"><a href="/gostd/net/rpc/server.go.html#5286225">req</a></span><span class="op" id="5286662">,</span>&nbsp;<span class="ident" id="5286664"><a href="/gostd/net/rpc/server.go.html#5286230">argv</a></span><span class="op" id="5286668">,</span>&nbsp;<span class="ident" id="5286670"><a href="/gostd/net/rpc/server.go.html#5286236">replyv</a></span><span class="op" id="5286676">,</span>&nbsp;<span class="ident" id="5286678"><a href="/gostd/net/rpc/server.go.html#5286151">codec</a></span><span class="op" id="5286683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5286686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5286689"><a href="/gostd/net/rpc/server.go.html#5286151">codec</a></span><span class="op" id="5286694">.</span><span class="ident" id="5286695"><a href="/gostd/net/rpc/server.go.html#5291500">Close</a></span><span class="op" id="5286700">(</span><span class="op" id="5286701">)</span><br>
<span class="lineno"></span><span class="op" id="5286703">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="5286706">//&nbsp;ServeRequest&nbsp;is&nbsp;like&nbsp;ServeCodec&nbsp;but&nbsp;synchronously&nbsp;serves&nbsp;a&nbsp;single&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="5286784">//&nbsp;It&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;codec&nbsp;upon&nbsp;completion.</span><br>
<span class="lineno"></span><span class="keyword" id="5286832">func</span>&nbsp;<span class="op" id="5286837">(</span><span class="ident" id="5286838">server</span>&nbsp;<span class="op" id="5286845">*</span><span class="ident" id="5286846"><a href="/gostd/net/rpc/server.go.html#5277991">Server</a></span><span class="op" id="5286852">)</span>&nbsp;<span class="ident" id="5286854">ServeRequest</span><span class="op" id="5286866">(</span><span class="ident" id="5286867">codec</span>&nbsp;<span class="ident" id="5286873"><a href="/gostd/net/rpc/server.go.html#5291284">ServerCodec</a></span><span class="op" id="5286884">)</span>&nbsp;<span class="builtintype" id="5286886">error</span>&nbsp;<span class="op" id="5286892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5286895">sending</span>&nbsp;<span class="op" id="5286903">:=</span>&nbsp;<span class="builtinfunc" id="5286906">new</span><span class="op" id="5286909">(</span><span class="ident" id="5286910"><a href="/gostd/net/rpc/server.go.html#5276449">sync</a></span><span class="op" id="5286914">.</span><span class="ident" id="5286915"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span><span class="op" id="5286920">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5286923">service</span><span class="op" id="5286930">,</span>&nbsp;<span class="ident" id="5286932">mtype</span><span class="op" id="5286937">,</span>&nbsp;<span class="ident" id="5286939">req</span><span class="op" id="5286942">,</span>&nbsp;<span class="ident" id="5286944">argv</span><span class="op" id="5286948">,</span>&nbsp;<span class="ident" id="5286950">replyv</span><span class="op" id="5286956">,</span>&nbsp;<span class="ident" id="5286958">keepReading</span><span class="op" id="5286969">,</span>&nbsp;<span class="ident" id="5286971">err</span>&nbsp;<span class="op" id="5286975">:=</span>&nbsp;<span class="ident" id="5286978"><a href="/gostd/net/rpc/server.go.html#5286838">server</a></span><span class="op" id="5286984">.</span><span class="ident" id="5286985"><a href="/gostd/net/rpc/server.go.html#5288143">readRequest</a></span><span class="op" id="5286996">(</span><span class="ident" id="5286997"><a href="/gostd/net/rpc/server.go.html#5286867">codec</a></span><span class="op" id="5287002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5287005">if</span>&nbsp;<span class="ident" id="5287008"><a href="/gostd/net/rpc/server.go.html#5286971">err</a></span>&nbsp;<span class="op" id="5287012">!=</span>&nbsp;<span class="builtintype" id="5287015">nil</span>&nbsp;<span class="op" id="5287019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5287023">if</span>&nbsp;<span class="op" id="5287026">!</span><span class="ident" id="5287027"><a href="/gostd/net/rpc/server.go.html#5286958">keepReading</a></span>&nbsp;<span class="op" id="5287039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5287044">return</span>&nbsp;<span class="ident" id="5287051"><a href="/gostd/net/rpc/server.go.html#5286971">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5287057">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5287061">//&nbsp;send&nbsp;a&nbsp;response&nbsp;if&nbsp;we&nbsp;actually&nbsp;managed&nbsp;to&nbsp;read&nbsp;a&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5287123">if</span>&nbsp;<span class="ident" id="5287126"><a href="/gostd/net/rpc/server.go.html#5286939">req</a></span>&nbsp;<span class="op" id="5287130">!=</span>&nbsp;<span class="builtintype" id="5287133">nil</span>&nbsp;<span class="op" id="5287137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5287142"><a href="/gostd/net/rpc/server.go.html#5286838">server</a></span><span class="op" id="5287148">.</span><span class="ident" id="5287149"><a href="/gostd/net/rpc/server.go.html#5283060">sendResponse</a></span><span class="op" id="5287161">(</span><span class="ident" id="5287162"><a href="/gostd/net/rpc/server.go.html#5286895">sending</a></span><span class="op" id="5287169">,</span>&nbsp;<span class="ident" id="5287171"><a href="/gostd/net/rpc/server.go.html#5286939">req</a></span><span class="op" id="5287174">,</span>&nbsp;<span class="ident" id="5287176"><a href="/gostd/net/rpc/server.go.html#5283009">invalidRequest</a></span><span class="op" id="5287190">,</span>&nbsp;<span class="ident" id="5287192"><a href="/gostd/net/rpc/server.go.html#5286867">codec</a></span><span class="op" id="5287197">,</span>&nbsp;<span class="ident" id="5287199"><a href="/gostd/net/rpc/server.go.html#5286971">err</a></span><span class="op" id="5287202">.</span><span class="ident" id="5287203">Error</span><span class="op" id="5287208">(</span><span class="op" id="5287209">)</span><span class="op" id="5287210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5287215"><a href="/gostd/net/rpc/server.go.html#5286838">server</a></span><span class="op" id="5287221">.</span><span class="ident" id="5287222"><a href="/gostd/net/rpc/server.go.html#5287590">freeRequest</a></span><span class="op" id="5287233">(</span><span class="ident" id="5287234"><a href="/gostd/net/rpc/server.go.html#5286939">req</a></span><span class="op" id="5287237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5287241">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5287245">return</span>&nbsp;<span class="ident" id="5287252"><a href="/gostd/net/rpc/server.go.html#5286971">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5287257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5287260"><a href="/gostd/net/rpc/server.go.html#5286923">service</a></span><span class="op" id="5287267">.</span><span class="ident" id="5287268"><a href="/gostd/net/rpc/server.go.html#5283647">call</a></span><span class="op" id="5287272">(</span><span class="ident" id="5287273"><a href="/gostd/net/rpc/server.go.html#5286838">server</a></span><span class="op" id="5287279">,</span>&nbsp;<span class="ident" id="5287281"><a href="/gostd/net/rpc/server.go.html#5286895">sending</a></span><span class="op" id="5287288">,</span>&nbsp;<span class="ident" id="5287290"><a href="/gostd/net/rpc/server.go.html#5286932">mtype</a></span><span class="op" id="5287295">,</span>&nbsp;<span class="ident" id="5287297"><a href="/gostd/net/rpc/server.go.html#5286939">req</a></span><span class="op" id="5287300">,</span>&nbsp;<span class="ident" id="5287302"><a href="/gostd/net/rpc/server.go.html#5286944">argv</a></span><span class="op" id="5287306">,</span>&nbsp;<span class="ident" id="5287308"><a href="/gostd/net/rpc/server.go.html#5286950">replyv</a></span><span class="op" id="5287314">,</span>&nbsp;<span class="ident" id="5287316"><a href="/gostd/net/rpc/server.go.html#5286867">codec</a></span><span class="op" id="5287321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5287324">return</span>&nbsp;<span class="builtintype" id="5287331">nil</span><br>
<span class="lineno"></span><span class="op" id="5287335">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="5287338">func</span>&nbsp;<span class="op" id="5287343">(</span><span class="ident" id="5287344">server</span>&nbsp;<span class="op" id="5287351">*</span><span class="ident" id="5287352"><a href="/gostd/net/rpc/server.go.html#5277991">Server</a></span><span class="op" id="5287358">)</span>&nbsp;<span class="ident" id="5287360">getRequest</span><span class="op" id="5287370">(</span><span class="op" id="5287371">)</span>&nbsp;<span class="op" id="5287373">*</span><span class="ident" id="5287374"><a href="/gostd/net/rpc/server.go.html#5277366">Request</a></span>&nbsp;<span class="op" id="5287382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5287385"><a href="/gostd/net/rpc/server.go.html#5287344">server</a></span><span class="op" id="5287391">.</span><span class="ident" id="5287392"><a href="/gostd/net/rpc/server.go.html#5278092">reqLock</a></span><span class="op" id="5287399">.</span><span class="ident" id="5287400"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5287404">(</span><span class="op" id="5287405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5287408">req</span>&nbsp;<span class="op" id="5287412">:=</span>&nbsp;<span class="ident" id="5287415"><a href="/gostd/net/rpc/server.go.html#5287344">server</a></span><span class="op" id="5287421">.</span><span class="ident" id="5287422"><a href="/gostd/net/rpc/server.go.html#5278135">freeReq</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5287431">if</span>&nbsp;<span class="ident" id="5287434"><a href="/gostd/net/rpc/server.go.html#5287408">req</a></span>&nbsp;<span class="op" id="5287438">==</span>&nbsp;<span class="builtintype" id="5287441">nil</span>&nbsp;<span class="op" id="5287445">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5287449"><a href="/gostd/net/rpc/server.go.html#5287408">req</a></span>&nbsp;<span class="op" id="5287453">=</span>&nbsp;<span class="builtinfunc" id="5287455">new</span><span class="op" id="5287458">(</span><span class="ident" id="5287459"><a href="/gostd/net/rpc/server.go.html#5277366">Request</a></span><span class="op" id="5287466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5287469">}</span>&nbsp;<span class="keyword" id="5287471">else</span>&nbsp;<span class="op" id="5287476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5287480"><a href="/gostd/net/rpc/server.go.html#5287344">server</a></span><span class="op" id="5287486">.</span><span class="ident" id="5287487"><a href="/gostd/net/rpc/server.go.html#5278135">freeReq</a></span>&nbsp;<span class="op" id="5287495">=</span>&nbsp;<span class="ident" id="5287497"><a href="/gostd/net/rpc/server.go.html#5287408">req</a></span><span class="op" id="5287500">.</span><span class="ident" id="5287501"><a href="/gostd/net/rpc/server.go.html#5277496">next</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5287508">*</span><span class="ident" id="5287509"><a href="/gostd/net/rpc/server.go.html#5287408">req</a></span>&nbsp;<span class="op" id="5287513">=</span>&nbsp;<span class="ident" id="5287515"><a href="/gostd/net/rpc/server.go.html#5277366">Request</a></span><span class="op" id="5287522">{</span><span class="op" id="5287523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5287526">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5287529"><a href="/gostd/net/rpc/server.go.html#5287344">server</a></span><span class="op" id="5287535">.</span><span class="ident" id="5287536"><a href="/gostd/net/rpc/server.go.html#5278092">reqLock</a></span><span class="op" id="5287543">.</span><span class="ident" id="5287544"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5287550">(</span><span class="op" id="5287551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5287554">return</span>&nbsp;<span class="ident" id="5287561"><a href="/gostd/net/rpc/server.go.html#5287408">req</a></span><br>
<span class="lineno"></span><span class="op" id="5287565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5287568">func</span>&nbsp;<span class="op" id="5287573">(</span><span class="ident" id="5287574">server</span>&nbsp;<span class="op" id="5287581">*</span><span class="ident" id="5287582"><a href="/gostd/net/rpc/server.go.html#5277991">Server</a></span><span class="op" id="5287588">)</span>&nbsp;<span class="ident" id="5287590">freeRequest</span><span class="op" id="5287601">(</span><span class="ident" id="5287602">req</span>&nbsp;<span class="op" id="5287606">*</span><span class="ident" id="5287607"><a href="/gostd/net/rpc/server.go.html#5277366">Request</a></span><span class="op" id="5287614">)</span>&nbsp;<span class="op" id="5287616">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5287619"><a href="/gostd/net/rpc/server.go.html#5287574">server</a></span><span class="op" id="5287625">.</span><span class="ident" id="5287626"><a href="/gostd/net/rpc/server.go.html#5278092">reqLock</a></span><span class="op" id="5287633">.</span><span class="ident" id="5287634"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5287638">(</span><span class="op" id="5287639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5287642"><a href="/gostd/net/rpc/server.go.html#5287602">req</a></span><span class="op" id="5287645">.</span><span class="ident" id="5287646"><a href="/gostd/net/rpc/server.go.html#5277496">next</a></span>&nbsp;<span class="op" id="5287651">=</span>&nbsp;<span class="ident" id="5287653"><a href="/gostd/net/rpc/server.go.html#5287574">server</a></span><span class="op" id="5287659">.</span><span class="ident" id="5287660"><a href="/gostd/net/rpc/server.go.html#5278135">freeReq</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5287669"><a href="/gostd/net/rpc/server.go.html#5287574">server</a></span><span class="op" id="5287675">.</span><span class="ident" id="5287676"><a href="/gostd/net/rpc/server.go.html#5278135">freeReq</a></span>&nbsp;<span class="op" id="5287684">=</span>&nbsp;<span class="ident" id="5287686"><a href="/gostd/net/rpc/server.go.html#5287602">req</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5287691"><a href="/gostd/net/rpc/server.go.html#5287574">server</a></span><span class="op" id="5287697">.</span><span class="ident" id="5287698"><a href="/gostd/net/rpc/server.go.html#5278092">reqLock</a></span><span class="op" id="5287705">.</span><span class="ident" id="5287706"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5287712">(</span><span class="op" id="5287713">)</span><br>
<span class="lineno"></span><span class="op" id="5287715">}</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span><span class="keyword" id="5287718">func</span>&nbsp;<span class="op" id="5287723">(</span><span class="ident" id="5287724">server</span>&nbsp;<span class="op" id="5287731">*</span><span class="ident" id="5287732"><a href="/gostd/net/rpc/server.go.html#5277991">Server</a></span><span class="op" id="5287738">)</span>&nbsp;<span class="ident" id="5287740">getResponse</span><span class="op" id="5287751">(</span><span class="op" id="5287752">)</span>&nbsp;<span class="op" id="5287754">*</span><span class="ident" id="5287755"><a href="/gostd/net/rpc/server.go.html#5277724">Response</a></span>&nbsp;<span class="op" id="5287764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5287767"><a href="/gostd/net/rpc/server.go.html#5287724">server</a></span><span class="op" id="5287773">.</span><span class="ident" id="5287774"><a href="/gostd/net/rpc/server.go.html#5278156">respLock</a></span><span class="op" id="5287782">.</span><span class="ident" id="5287783"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5287787">(</span><span class="op" id="5287788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5287791">resp</span>&nbsp;<span class="op" id="5287796">:=</span>&nbsp;<span class="ident" id="5287799"><a href="/gostd/net/rpc/server.go.html#5287724">server</a></span><span class="op" id="5287805">.</span><span class="ident" id="5287806"><a href="/gostd/net/rpc/server.go.html#5278200">freeResp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5287816">if</span>&nbsp;<span class="ident" id="5287819"><a href="/gostd/net/rpc/server.go.html#5287791">resp</a></span>&nbsp;<span class="op" id="5287824">==</span>&nbsp;<span class="builtintype" id="5287827">nil</span>&nbsp;<span class="op" id="5287831">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5287835"><a href="/gostd/net/rpc/server.go.html#5287791">resp</a></span>&nbsp;<span class="op" id="5287840">=</span>&nbsp;<span class="builtinfunc" id="5287842">new</span><span class="op" id="5287845">(</span><span class="ident" id="5287846"><a href="/gostd/net/rpc/server.go.html#5277724">Response</a></span><span class="op" id="5287854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5287857">}</span>&nbsp;<span class="keyword" id="5287859">else</span>&nbsp;<span class="op" id="5287864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5287868"><a href="/gostd/net/rpc/server.go.html#5287724">server</a></span><span class="op" id="5287874">.</span><span class="ident" id="5287875"><a href="/gostd/net/rpc/server.go.html#5278200">freeResp</a></span>&nbsp;<span class="op" id="5287884">=</span>&nbsp;<span class="ident" id="5287886"><a href="/gostd/net/rpc/server.go.html#5287791">resp</a></span><span class="op" id="5287890">.</span><span class="ident" id="5287891"><a href="/gostd/net/rpc/server.go.html#5277896">next</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5287898">*</span><span class="ident" id="5287899"><a href="/gostd/net/rpc/server.go.html#5287791">resp</a></span>&nbsp;<span class="op" id="5287904">=</span>&nbsp;<span class="ident" id="5287906"><a href="/gostd/net/rpc/server.go.html#5277724">Response</a></span><span class="op" id="5287914">{</span><span class="op" id="5287915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5287918">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5287921"><a href="/gostd/net/rpc/server.go.html#5287724">server</a></span><span class="op" id="5287927">.</span><span class="ident" id="5287928"><a href="/gostd/net/rpc/server.go.html#5278156">respLock</a></span><span class="op" id="5287936">.</span><span class="ident" id="5287937"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5287943">(</span><span class="op" id="5287944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5287947">return</span>&nbsp;<span class="ident" id="5287954"><a href="/gostd/net/rpc/server.go.html#5287791">resp</a></span><br>
<span class="lineno"></span><span class="op" id="5287959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5287962">func</span>&nbsp;<span class="op" id="5287967">(</span><span class="ident" id="5287968">server</span>&nbsp;<span class="op" id="5287975">*</span><span class="ident" id="5287976"><a href="/gostd/net/rpc/server.go.html#5277991">Server</a></span><span class="op" id="5287982">)</span>&nbsp;<span class="ident" id="5287984">freeResponse</span><span class="op" id="5287996">(</span><span class="ident" id="5287997">resp</span>&nbsp;<span class="op" id="5288002">*</span><span class="ident" id="5288003"><a href="/gostd/net/rpc/server.go.html#5277724">Response</a></span><span class="op" id="5288011">)</span>&nbsp;<span class="op" id="5288013">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5288016"><a href="/gostd/net/rpc/server.go.html#5287968">server</a></span><span class="op" id="5288022">.</span><span class="ident" id="5288023"><a href="/gostd/net/rpc/server.go.html#5278156">respLock</a></span><span class="op" id="5288031">.</span><span class="ident" id="5288032"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5288036">(</span><span class="op" id="5288037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5288040"><a href="/gostd/net/rpc/server.go.html#5287997">resp</a></span><span class="op" id="5288044">.</span><span class="ident" id="5288045"><a href="/gostd/net/rpc/server.go.html#5277896">next</a></span>&nbsp;<span class="op" id="5288050">=</span>&nbsp;<span class="ident" id="5288052"><a href="/gostd/net/rpc/server.go.html#5287968">server</a></span><span class="op" id="5288058">.</span><span class="ident" id="5288059"><a href="/gostd/net/rpc/server.go.html#5278200">freeResp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5288069"><a href="/gostd/net/rpc/server.go.html#5287968">server</a></span><span class="op" id="5288075">.</span><span class="ident" id="5288076"><a href="/gostd/net/rpc/server.go.html#5278200">freeResp</a></span>&nbsp;<span class="op" id="5288085">=</span>&nbsp;<span class="ident" id="5288087"><a href="/gostd/net/rpc/server.go.html#5287997">resp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5288093"><a href="/gostd/net/rpc/server.go.html#5287968">server</a></span><span class="op" id="5288099">.</span><span class="ident" id="5288100"><a href="/gostd/net/rpc/server.go.html#5278156">respLock</a></span><span class="op" id="5288108">.</span><span class="ident" id="5288109"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5288115">(</span><span class="op" id="5288116">)</span><br>
<span class="lineno"></span><span class="op" id="5288118">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span><span class="keyword" id="5288121">func</span>&nbsp;<span class="op" id="5288126">(</span><span class="ident" id="5288127">server</span>&nbsp;<span class="op" id="5288134">*</span><span class="ident" id="5288135"><a href="/gostd/net/rpc/server.go.html#5277991">Server</a></span><span class="op" id="5288141">)</span>&nbsp;<span class="ident" id="5288143">readRequest</span><span class="op" id="5288154">(</span><span class="ident" id="5288155">codec</span>&nbsp;<span class="ident" id="5288161"><a href="/gostd/net/rpc/server.go.html#5291284">ServerCodec</a></span><span class="op" id="5288172">)</span>&nbsp;<span class="op" id="5288174">(</span><span class="ident" id="5288175">service</span>&nbsp;<span class="op" id="5288183">*</span><span class="ident" id="5288184"><a href="/gostd/net/rpc/server.go.html#5276946">service</a></span><span class="op" id="5288191">,</span>&nbsp;<span class="ident" id="5288193">mtype</span>&nbsp;<span class="op" id="5288199">*</span><span class="ident" id="5288200"><a href="/gostd/net/rpc/server.go.html#5276791">methodType</a></span><span class="op" id="5288210">,</span>&nbsp;<span class="ident" id="5288212">req</span>&nbsp;<span class="op" id="5288216">*</span><span class="ident" id="5288217"><a href="/gostd/net/rpc/server.go.html#5277366">Request</a></span><span class="op" id="5288224">,</span>&nbsp;<span class="ident" id="5288226">argv</span><span class="op" id="5288230">,</span>&nbsp;<span class="ident" id="5288232">replyv</span>&nbsp;<span class="ident" id="5288239"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5288246">.</span><span class="ident" id="5288247"><a href="/gostd/reflect/value.go.html#2833557">Value</a></span><span class="op" id="5288252">,</span>&nbsp;<span class="ident" id="5288254">keepReading</span>&nbsp;<span class="builtintype" id="5288266">bool</span><span class="op" id="5288270">,</span>&nbsp;<span class="ident" id="5288272">err</span>&nbsp;<span class="builtintype" id="5288276">error</span><span class="op" id="5288281">)</span>&nbsp;<span class="op" id="5288283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5288286"><a href="/gostd/net/rpc/server.go.html#5288175">service</a></span><span class="op" id="5288293">,</span>&nbsp;<span class="ident" id="5288295"><a href="/gostd/net/rpc/server.go.html#5288193">mtype</a></span><span class="op" id="5288300">,</span>&nbsp;<span class="ident" id="5288302"><a href="/gostd/net/rpc/server.go.html#5288212">req</a></span><span class="op" id="5288305">,</span>&nbsp;<span class="ident" id="5288307"><a href="/gostd/net/rpc/server.go.html#5288254">keepReading</a></span><span class="op" id="5288318">,</span>&nbsp;<span class="ident" id="5288320"><a href="/gostd/net/rpc/server.go.html#5288272">err</a></span>&nbsp;<span class="op" id="5288324">=</span>&nbsp;<span class="ident" id="5288326"><a href="/gostd/net/rpc/server.go.html#5288127">server</a></span><span class="op" id="5288332">.</span><span class="ident" id="5288333"><a href="/gostd/net/rpc/server.go.html#5288958">readRequestHeader</a></span><span class="op" id="5288350">(</span><span class="ident" id="5288351"><a href="/gostd/net/rpc/server.go.html#5288155">codec</a></span><span class="op" id="5288356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5288359">if</span>&nbsp;<span class="ident" id="5288362"><a href="/gostd/net/rpc/server.go.html#5288272">err</a></span>&nbsp;<span class="op" id="5288366">!=</span>&nbsp;<span class="builtintype" id="5288369">nil</span>&nbsp;<span class="op" id="5288373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5288377">if</span>&nbsp;<span class="op" id="5288380">!</span><span class="ident" id="5288381"><a href="/gostd/net/rpc/server.go.html#5288254">keepReading</a></span>&nbsp;<span class="op" id="5288393">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5288398">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5288407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5288411">//&nbsp;discard&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5288429"><a href="/gostd/net/rpc/server.go.html#5288155">codec</a></span><span class="op" id="5288434">.</span><span class="ident" id="5288435"><a href="/gostd/net/rpc/server.go.html#5291344">ReadRequestBody</a></span><span class="op" id="5288450">(</span><span class="builtintype" id="5288451">nil</span><span class="op" id="5288454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5288458">return</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5288466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5288470">//&nbsp;Decode&nbsp;the&nbsp;argument&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5288501">argIsValue</span>&nbsp;<span class="op" id="5288512">:=</span>&nbsp;<span class="builtintype" id="5288515">false</span>&nbsp;<span class="comment" id="5288521">//&nbsp;if&nbsp;true,&nbsp;need&nbsp;to&nbsp;indirect&nbsp;before&nbsp;calling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5288567">if</span>&nbsp;<span class="ident" id="5288570"><a href="/gostd/net/rpc/server.go.html#5288193">mtype</a></span><span class="op" id="5288575">.</span><span class="ident" id="5288576"><a href="/gostd/net/rpc/server.go.html#5276872">ArgType</a></span><span class="op" id="5288583">.</span><span class="ident" id="5288584"><a href="/gostd/reflect/type.go.html#2783619">Kind</a></span><span class="op" id="5288588">(</span><span class="op" id="5288589">)</span>&nbsp;<span class="op" id="5288591">==</span>&nbsp;<span class="ident" id="5288594"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5288601">.</span><span class="ident" id="5288602"><a href="/gostd/reflect/type.go.html#2788057">Ptr</a></span>&nbsp;<span class="op" id="5288606">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5288610"><a href="/gostd/net/rpc/server.go.html#5288226">argv</a></span>&nbsp;<span class="op" id="5288615">=</span>&nbsp;<span class="ident" id="5288617"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5288624">.</span><span class="ident" id="5288625"><a href="/gostd/reflect/value.go.html#2893570">New</a></span><span class="op" id="5288628">(</span><span class="ident" id="5288629"><a href="/gostd/net/rpc/server.go.html#5288193">mtype</a></span><span class="op" id="5288634">.</span><span class="ident" id="5288635"><a href="/gostd/net/rpc/server.go.html#5276872">ArgType</a></span><span class="op" id="5288642">.</span><span class="ident" id="5288643"><a href="/gostd/reflect/type.go.html#2785263">Elem</a></span><span class="op" id="5288647">(</span><span class="op" id="5288648">)</span><span class="op" id="5288649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5288652">}</span>&nbsp;<span class="keyword" id="5288654">else</span>&nbsp;<span class="op" id="5288659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5288663"><a href="/gostd/net/rpc/server.go.html#5288226">argv</a></span>&nbsp;<span class="op" id="5288668">=</span>&nbsp;<span class="ident" id="5288670"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5288677">.</span><span class="ident" id="5288678"><a href="/gostd/reflect/value.go.html#2893570">New</a></span><span class="op" id="5288681">(</span><span class="ident" id="5288682"><a href="/gostd/net/rpc/server.go.html#5288193">mtype</a></span><span class="op" id="5288687">.</span><span class="ident" id="5288688"><a href="/gostd/net/rpc/server.go.html#5276872">ArgType</a></span><span class="op" id="5288695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5288699"><a href="/gostd/net/rpc/server.go.html#5288501">argIsValue</a></span>&nbsp;<span class="op" id="5288710">=</span>&nbsp;<span class="builtintype" id="5288712">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5288718">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5288721">//&nbsp;argv&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;a&nbsp;pointer&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5288762">if</span>&nbsp;<span class="ident" id="5288765"><a href="/gostd/net/rpc/server.go.html#5288272">err</a></span>&nbsp;<span class="op" id="5288769">=</span>&nbsp;<span class="ident" id="5288771"><a href="/gostd/net/rpc/server.go.html#5288155">codec</a></span><span class="op" id="5288776">.</span><span class="ident" id="5288777"><a href="/gostd/net/rpc/server.go.html#5291344">ReadRequestBody</a></span><span class="op" id="5288792">(</span><span class="ident" id="5288793"><a href="/gostd/net/rpc/server.go.html#5288226">argv</a></span><span class="op" id="5288797">.</span><span class="ident" id="5288798"><a href="/gostd/reflect/value.go.html#2858688">Interface</a></span><span class="op" id="5288807">(</span><span class="op" id="5288808">)</span><span class="op" id="5288809">)</span><span class="op" id="5288810">;</span>&nbsp;<span class="ident" id="5288812"><a href="/gostd/net/rpc/server.go.html#5288272">err</a></span>&nbsp;<span class="op" id="5288816">!=</span>&nbsp;<span class="builtintype" id="5288819">nil</span>&nbsp;<span class="op" id="5288823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5288827">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5288835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5288838">if</span>&nbsp;<span class="ident" id="5288841"><a href="/gostd/net/rpc/server.go.html#5288501">argIsValue</a></span>&nbsp;<span class="op" id="5288852">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5288856"><a href="/gostd/net/rpc/server.go.html#5288226">argv</a></span>&nbsp;<span class="op" id="5288861">=</span>&nbsp;<span class="ident" id="5288863"><a href="/gostd/net/rpc/server.go.html#5288226">argv</a></span><span class="op" id="5288867">.</span><span class="ident" id="5288868"><a href="/gostd/reflect/value.go.html#2853087">Elem</a></span><span class="op" id="5288872">(</span><span class="op" id="5288873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5288876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5288880"><a href="/gostd/net/rpc/server.go.html#5288232">replyv</a></span>&nbsp;<span class="op" id="5288887">=</span>&nbsp;<span class="ident" id="5288889"><a href="/gostd/net/rpc/server.go.html#5276427">reflect</a></span><span class="op" id="5288896">.</span><span class="ident" id="5288897"><a href="/gostd/reflect/value.go.html#2893570">New</a></span><span class="op" id="5288900">(</span><span class="ident" id="5288901"><a href="/gostd/net/rpc/server.go.html#5288193">mtype</a></span><span class="op" id="5288906">.</span><span class="ident" id="5288907"><a href="/gostd/net/rpc/server.go.html#5276897">ReplyType</a></span><span class="op" id="5288916">.</span><span class="ident" id="5288917"><a href="/gostd/reflect/type.go.html#2785263">Elem</a></span><span class="op" id="5288921">(</span><span class="op" id="5288922">)</span><span class="op" id="5288923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5288926">return</span><br>
<span class="lineno">570</span><span class="op" id="5288933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5288936">func</span>&nbsp;<span class="op" id="5288941">(</span><span class="ident" id="5288942">server</span>&nbsp;<span class="op" id="5288949">*</span><span class="ident" id="5288950"><a href="/gostd/net/rpc/server.go.html#5277991">Server</a></span><span class="op" id="5288956">)</span>&nbsp;<span class="ident" id="5288958">readRequestHeader</span><span class="op" id="5288975">(</span><span class="ident" id="5288976">codec</span>&nbsp;<span class="ident" id="5288982"><a href="/gostd/net/rpc/server.go.html#5291284">ServerCodec</a></span><span class="op" id="5288993">)</span>&nbsp;<span class="op" id="5288995">(</span><span class="ident" id="5288996">service</span>&nbsp;<span class="op" id="5289004">*</span><span class="ident" id="5289005"><a href="/gostd/net/rpc/server.go.html#5276946">service</a></span><span class="op" id="5289012">,</span>&nbsp;<span class="ident" id="5289014">mtype</span>&nbsp;<span class="op" id="5289020">*</span><span class="ident" id="5289021"><a href="/gostd/net/rpc/server.go.html#5276791">methodType</a></span><span class="op" id="5289031">,</span>&nbsp;<span class="ident" id="5289033">req</span>&nbsp;<span class="op" id="5289037">*</span><span class="ident" id="5289038"><a href="/gostd/net/rpc/server.go.html#5277366">Request</a></span><span class="op" id="5289045">,</span>&nbsp;<span class="ident" id="5289047">keepReading</span>&nbsp;<span class="builtintype" id="5289059">bool</span><span class="op" id="5289063">,</span>&nbsp;<span class="ident" id="5289065">err</span>&nbsp;<span class="builtintype" id="5289069">error</span><span class="op" id="5289074">)</span>&nbsp;<span class="op" id="5289076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5289079">//&nbsp;Grab&nbsp;the&nbsp;request&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289108"><a href="/gostd/net/rpc/server.go.html#5289033">req</a></span>&nbsp;<span class="op" id="5289112">=</span>&nbsp;<span class="ident" id="5289114"><a href="/gostd/net/rpc/server.go.html#5288942">server</a></span><span class="op" id="5289120">.</span><span class="ident" id="5289121"><a href="/gostd/net/rpc/server.go.html#5287360">getRequest</a></span><span class="op" id="5289131">(</span><span class="op" id="5289132">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289135"><a href="/gostd/net/rpc/server.go.html#5289065">err</a></span>&nbsp;<span class="op" id="5289139">=</span>&nbsp;<span class="ident" id="5289141"><a href="/gostd/net/rpc/server.go.html#5288976">codec</a></span><span class="op" id="5289146">.</span><span class="ident" id="5289147"><a href="/gostd/net/rpc/server.go.html#5291309">ReadRequestHeader</a></span><span class="op" id="5289164">(</span><span class="ident" id="5289165"><a href="/gostd/net/rpc/server.go.html#5289033">req</a></span><span class="op" id="5289168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5289171">if</span>&nbsp;<span class="ident" id="5289174"><a href="/gostd/net/rpc/server.go.html#5289065">err</a></span>&nbsp;<span class="op" id="5289178">!=</span>&nbsp;<span class="builtintype" id="5289181">nil</span>&nbsp;<span class="op" id="5289185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289189"><a href="/gostd/net/rpc/server.go.html#5289033">req</a></span>&nbsp;<span class="op" id="5289193">=</span>&nbsp;<span class="builtintype" id="5289195">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5289201">if</span>&nbsp;<span class="ident" id="5289204"><a href="/gostd/net/rpc/server.go.html#5289065">err</a></span>&nbsp;<span class="op" id="5289208">==</span>&nbsp;<span class="ident" id="5289211"><a href="/gostd/net/rpc/server.go.html#5276395">io</a></span><span class="op" id="5289213">.</span><span class="ident" id="5289214"><a href="/gostd/io/io.go.html#1419950">EOF</a></span>&nbsp;<span class="op" id="5289218">||</span>&nbsp;<span class="ident" id="5289221"><a href="/gostd/net/rpc/server.go.html#5289065">err</a></span>&nbsp;<span class="op" id="5289225">==</span>&nbsp;<span class="ident" id="5289228"><a href="/gostd/net/rpc/server.go.html#5276395">io</a></span><span class="op" id="5289230">.</span><span class="ident" id="5289231"><a href="/gostd/io/io.go.html#1420096">ErrUnexpectedEOF</a></span>&nbsp;<span class="op" id="5289248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5289253">return</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5289262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289266"><a href="/gostd/net/rpc/server.go.html#5289065">err</a></span>&nbsp;<span class="op" id="5289270">=</span>&nbsp;<span class="ident" id="5289272"><a href="/gostd/net/rpc/server.go.html#5276385">errors</a></span><span class="op" id="5289278">.</span><span class="ident" id="5289279"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5289282">(</span><span class="string" id="5289283">&#34;rpc:&nbsp;server&nbsp;cannot&nbsp;decode&nbsp;request:&nbsp;&#34;</span>&nbsp;<span class="op" id="5289321">+</span>&nbsp;<span class="ident" id="5289323"><a href="/gostd/net/rpc/server.go.html#5289065">err</a></span><span class="op" id="5289326">.</span><span class="ident" id="5289327">Error</span><span class="op" id="5289332">(</span><span class="op" id="5289333">)</span><span class="op" id="5289334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5289338">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5289346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5289350">//&nbsp;We&nbsp;read&nbsp;the&nbsp;header&nbsp;successfully.&nbsp;&nbsp;If&nbsp;we&nbsp;see&nbsp;an&nbsp;error&nbsp;now,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5289412">//&nbsp;we&nbsp;can&nbsp;still&nbsp;recover&nbsp;and&nbsp;move&nbsp;on&nbsp;to&nbsp;the&nbsp;next&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289470"><a href="/gostd/net/rpc/server.go.html#5289047">keepReading</a></span>&nbsp;<span class="op" id="5289482">=</span>&nbsp;<span class="builtintype" id="5289484">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289491">dot</span>&nbsp;<span class="op" id="5289495">:=</span>&nbsp;<span class="ident" id="5289498"><a href="/gostd/net/rpc/server.go.html#5276438">strings</a></span><span class="op" id="5289505">.</span><span class="ident" id="5289506"><a href="/gostd/strings/strings.go.html#2969551">LastIndex</a></span><span class="op" id="5289515">(</span><span class="ident" id="5289516"><a href="/gostd/net/rpc/server.go.html#5289033">req</a></span><span class="op" id="5289519">.</span><span class="ident" id="5289520"><a href="/gostd/net/rpc/server.go.html#5277384">ServiceMethod</a></span><span class="op" id="5289533">,</span>&nbsp;<span class="string" id="5289535">&#34;.&#34;</span><span class="op" id="5289538">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5289541">if</span>&nbsp;<span class="ident" id="5289544"><a href="/gostd/net/rpc/server.go.html#5289491">dot</a></span>&nbsp;<span class="op" id="5289548">&lt;</span>&nbsp;<span class="num" id="5289550">0</span>&nbsp;<span class="op" id="5289552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289556"><a href="/gostd/net/rpc/server.go.html#5289065">err</a></span>&nbsp;<span class="op" id="5289560">=</span>&nbsp;<span class="ident" id="5289562"><a href="/gostd/net/rpc/server.go.html#5276385">errors</a></span><span class="op" id="5289568">.</span><span class="ident" id="5289569"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5289572">(</span><span class="string" id="5289573">&#34;rpc:&nbsp;service/method&nbsp;request&nbsp;ill-formed:&nbsp;&#34;</span>&nbsp;<span class="op" id="5289616">+</span>&nbsp;<span class="ident" id="5289618"><a href="/gostd/net/rpc/server.go.html#5289033">req</a></span><span class="op" id="5289621">.</span><span class="ident" id="5289622"><a href="/gostd/net/rpc/server.go.html#5277384">ServiceMethod</a></span><span class="op" id="5289635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5289639">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5289647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289650">serviceName</span>&nbsp;<span class="op" id="5289662">:=</span>&nbsp;<span class="ident" id="5289665"><a href="/gostd/net/rpc/server.go.html#5289033">req</a></span><span class="op" id="5289668">.</span><span class="ident" id="5289669"><a href="/gostd/net/rpc/server.go.html#5277384">ServiceMethod</a></span><span class="op" id="5289682">[</span><span class="op" id="5289683">:</span><span class="ident" id="5289684"><a href="/gostd/net/rpc/server.go.html#5289491">dot</a></span><span class="op" id="5289687">]</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289690">methodName</span>&nbsp;<span class="op" id="5289701">:=</span>&nbsp;<span class="ident" id="5289704"><a href="/gostd/net/rpc/server.go.html#5289033">req</a></span><span class="op" id="5289707">.</span><span class="ident" id="5289708"><a href="/gostd/net/rpc/server.go.html#5277384">ServiceMethod</a></span><span class="op" id="5289721">[</span><span class="ident" id="5289722"><a href="/gostd/net/rpc/server.go.html#5289491">dot</a></span><span class="op" id="5289725">+</span><span class="num" id="5289726">1</span><span class="op" id="5289727">:</span><span class="op" id="5289728">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5289732">//&nbsp;Look&nbsp;up&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289757"><a href="/gostd/net/rpc/server.go.html#5288942">server</a></span><span class="op" id="5289763">.</span><span class="ident" id="5289764"><a href="/gostd/net/rpc/server.go.html#5278008">mu</a></span><span class="op" id="5289766">.</span><span class="ident" id="5289767"><a href="/gostd/sync/rwmutex.go.html#1456490">RLock</a></span><span class="op" id="5289772">(</span><span class="op" id="5289773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289776"><a href="/gostd/net/rpc/server.go.html#5288996">service</a></span>&nbsp;<span class="op" id="5289784">=</span>&nbsp;<span class="ident" id="5289786"><a href="/gostd/net/rpc/server.go.html#5288942">server</a></span><span class="op" id="5289792">.</span><span class="ident" id="5289793"><a href="/gostd/net/rpc/server.go.html#5278060">serviceMap</a></span><span class="op" id="5289803">[</span><span class="ident" id="5289804"><a href="/gostd/net/rpc/server.go.html#5289650">serviceName</a></span><span class="op" id="5289815">]</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289818"><a href="/gostd/net/rpc/server.go.html#5288942">server</a></span><span class="op" id="5289824">.</span><span class="ident" id="5289825"><a href="/gostd/net/rpc/server.go.html#5278008">mu</a></span><span class="op" id="5289827">.</span><span class="ident" id="5289828"><a href="/gostd/sync/rwmutex.go.html#1456952">RUnlock</a></span><span class="op" id="5289835">(</span><span class="op" id="5289836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5289839">if</span>&nbsp;<span class="ident" id="5289842"><a href="/gostd/net/rpc/server.go.html#5288996">service</a></span>&nbsp;<span class="op" id="5289850">==</span>&nbsp;<span class="builtintype" id="5289853">nil</span>&nbsp;<span class="op" id="5289857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289861"><a href="/gostd/net/rpc/server.go.html#5289065">err</a></span>&nbsp;<span class="op" id="5289865">=</span>&nbsp;<span class="ident" id="5289867"><a href="/gostd/net/rpc/server.go.html#5276385">errors</a></span><span class="op" id="5289873">.</span><span class="ident" id="5289874"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5289877">(</span><span class="string" id="5289878">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;service&nbsp;&#34;</span>&nbsp;<span class="op" id="5289905">+</span>&nbsp;<span class="ident" id="5289907"><a href="/gostd/net/rpc/server.go.html#5289033">req</a></span><span class="op" id="5289910">.</span><span class="ident" id="5289911"><a href="/gostd/net/rpc/server.go.html#5277384">ServiceMethod</a></span><span class="op" id="5289924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5289928">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5289936">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289939"><a href="/gostd/net/rpc/server.go.html#5289014">mtype</a></span>&nbsp;<span class="op" id="5289945">=</span>&nbsp;<span class="ident" id="5289947"><a href="/gostd/net/rpc/server.go.html#5288996">service</a></span><span class="op" id="5289954">.</span><span class="ident" id="5289955"><a href="/gostd/net/rpc/server.go.html#5277139">method</a></span><span class="op" id="5289961">[</span><span class="ident" id="5289962"><a href="/gostd/net/rpc/server.go.html#5289690">methodName</a></span><span class="op" id="5289972">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5289975">if</span>&nbsp;<span class="ident" id="5289978"><a href="/gostd/net/rpc/server.go.html#5289014">mtype</a></span>&nbsp;<span class="op" id="5289984">==</span>&nbsp;<span class="builtintype" id="5289987">nil</span>&nbsp;<span class="op" id="5289991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289995"><a href="/gostd/net/rpc/server.go.html#5289065">err</a></span>&nbsp;<span class="op" id="5289999">=</span>&nbsp;<span class="ident" id="5290001"><a href="/gostd/net/rpc/server.go.html#5276385">errors</a></span><span class="op" id="5290007">.</span><span class="ident" id="5290008"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5290011">(</span><span class="string" id="5290012">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;&#34;</span>&nbsp;<span class="op" id="5290038">+</span>&nbsp;<span class="ident" id="5290040"><a href="/gostd/net/rpc/server.go.html#5289033">req</a></span><span class="op" id="5290043">.</span><span class="ident" id="5290044"><a href="/gostd/net/rpc/server.go.html#5277384">ServiceMethod</a></span><span class="op" id="5290057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5290060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5290063">return</span><br>
<span class="lineno">610</span><span class="op" id="5290070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5290073">//&nbsp;Accept&nbsp;accepts&nbsp;connections&nbsp;on&nbsp;the&nbsp;listener&nbsp;and&nbsp;serves&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="5290139">//&nbsp;for&nbsp;each&nbsp;incoming&nbsp;connection.&nbsp;&nbsp;Accept&nbsp;blocks;&nbsp;the&nbsp;caller&nbsp;typically</span><br>
<span class="lineno"></span><span class="comment" id="5290209">//&nbsp;invokes&nbsp;it&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno">615</span><span class="keyword" id="5290242">func</span>&nbsp;<span class="op" id="5290247">(</span><span class="ident" id="5290248">server</span>&nbsp;<span class="op" id="5290255">*</span><span class="ident" id="5290256"><a href="/gostd/net/rpc/server.go.html#5277991">Server</a></span><span class="op" id="5290262">)</span>&nbsp;<span class="ident" id="5290264">Accept</span><span class="op" id="5290270">(</span><span class="ident" id="5290271">lis</span>&nbsp;<span class="ident" id="5290275"><a href="/gostd/net/rpc/server.go.html#5276408">net</a></span><span class="op" id="5290278">.</span><span class="ident" id="5290279"><a href="/gostd/net/net.go.html#3340703">Listener</a></span><span class="op" id="5290287">)</span>&nbsp;<span class="op" id="5290289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5290292">for</span>&nbsp;<span class="op" id="5290296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5290300">conn</span><span class="op" id="5290304">,</span>&nbsp;<span class="ident" id="5290306">err</span>&nbsp;<span class="op" id="5290310">:=</span>&nbsp;<span class="ident" id="5290313"><a href="/gostd/net/rpc/server.go.html#5290271">lis</a></span><span class="op" id="5290316">.</span><span class="ident" id="5290317"><a href="/gostd/net/net.go.html#3340795">Accept</a></span><span class="op" id="5290323">(</span><span class="op" id="5290324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5290328">if</span>&nbsp;<span class="ident" id="5290331"><a href="/gostd/net/rpc/server.go.html#5290306">err</a></span>&nbsp;<span class="op" id="5290335">!=</span>&nbsp;<span class="builtintype" id="5290338">nil</span>&nbsp;<span class="op" id="5290342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5290347"><a href="/gostd/net/rpc/server.go.html#5276401">log</a></span><span class="op" id="5290350">.</span><span class="ident" id="5290351"><a href="/gostd/log/log.go.html#4079007">Fatal</a></span><span class="op" id="5290356">(</span><span class="string" id="5290357">&#34;rpc.Serve:&nbsp;accept:&#34;</span><span class="op" id="5290377">,</span>&nbsp;<span class="ident" id="5290379"><a href="/gostd/net/rpc/server.go.html#5290306">err</a></span><span class="op" id="5290382">.</span><span class="ident" id="5290383">Error</span><span class="op" id="5290388">(</span><span class="op" id="5290389">)</span><span class="op" id="5290390">)</span>&nbsp;<span class="comment" id="5290392">//&nbsp;TODO(r):&nbsp;exit?</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5290412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5290416">go</span>&nbsp;<span class="ident" id="5290419"><a href="/gostd/net/rpc/server.go.html#5290248">server</a></span><span class="op" id="5290425">.</span><span class="ident" id="5290426"><a href="/gostd/net/rpc/server.go.html#5285797">ServeConn</a></span><span class="op" id="5290435">(</span><span class="ident" id="5290436"><a href="/gostd/net/rpc/server.go.html#5290300">conn</a></span><span class="op" id="5290440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5290443">}</span><br>
<span class="lineno"></span><span class="op" id="5290445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="5290448">//&nbsp;Register&nbsp;publishes&nbsp;the&nbsp;receiver&#39;s&nbsp;methods&nbsp;in&nbsp;the&nbsp;DefaultServer.</span><br>
<span class="lineno"></span><span class="keyword" id="5290515">func</span>&nbsp;<span class="ident" id="5290520">Register</span><span class="op" id="5290528">(</span><span class="ident" id="5290529">rcvr</span>&nbsp;<span class="keyword" id="5290534">interface</span><span class="op" id="5290543">{</span><span class="op" id="5290544">}</span><span class="op" id="5290545">)</span>&nbsp;<span class="builtintype" id="5290547">error</span>&nbsp;<span class="op" id="5290553">{</span>&nbsp;<span class="keyword" id="5290555">return</span>&nbsp;<span class="ident" id="5290562"><a href="/gostd/net/rpc/server.go.html#5278401">DefaultServer</a></span><span class="op" id="5290575">.</span><span class="ident" id="5290576"><a href="/gostd/net/rpc/server.go.html#5279421">Register</a></span><span class="op" id="5290584">(</span><span class="ident" id="5290585"><a href="/gostd/net/rpc/server.go.html#5290529">rcvr</a></span><span class="op" id="5290589">)</span>&nbsp;<span class="op" id="5290591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5290594">//&nbsp;RegisterName&nbsp;is&nbsp;like&nbsp;Register&nbsp;but&nbsp;uses&nbsp;the&nbsp;provided&nbsp;name&nbsp;for&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5290667">//&nbsp;instead&nbsp;of&nbsp;the&nbsp;receiver&#39;s&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno">630</span><span class="keyword" id="5290711">func</span>&nbsp;<span class="ident" id="5290716">RegisterName</span><span class="op" id="5290728">(</span><span class="ident" id="5290729">name</span>&nbsp;<span class="builtintype" id="5290734">string</span><span class="op" id="5290740">,</span>&nbsp;<span class="ident" id="5290742">rcvr</span>&nbsp;<span class="keyword" id="5290747">interface</span><span class="op" id="5290756">{</span><span class="op" id="5290757">}</span><span class="op" id="5290758">)</span>&nbsp;<span class="builtintype" id="5290760">error</span>&nbsp;<span class="op" id="5290766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5290769">return</span>&nbsp;<span class="ident" id="5290776"><a href="/gostd/net/rpc/server.go.html#5278401">DefaultServer</a></span><span class="op" id="5290789">.</span><span class="ident" id="5290790"><a href="/gostd/net/rpc/server.go.html#5279639">RegisterName</a></span><span class="op" id="5290802">(</span><span class="ident" id="5290803"><a href="/gostd/net/rpc/server.go.html#5290729">name</a></span><span class="op" id="5290807">,</span>&nbsp;<span class="ident" id="5290809"><a href="/gostd/net/rpc/server.go.html#5290742">rcvr</a></span><span class="op" id="5290813">)</span><br>
<span class="lineno"></span><span class="op" id="5290815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5290818">//&nbsp;A&nbsp;ServerCodec&nbsp;implements&nbsp;reading&nbsp;of&nbsp;RPC&nbsp;requests&nbsp;and&nbsp;writing&nbsp;of</span><br>
<span class="lineno">635</span><span class="comment" id="5290885">//&nbsp;RPC&nbsp;responses&nbsp;for&nbsp;the&nbsp;server&nbsp;side&nbsp;of&nbsp;an&nbsp;RPC&nbsp;session.</span><br>
<span class="lineno"></span><span class="comment" id="5290941">//&nbsp;The&nbsp;server&nbsp;calls&nbsp;ReadRequestHeader&nbsp;and&nbsp;ReadRequestBody&nbsp;in&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="5291008">//&nbsp;to&nbsp;read&nbsp;requests&nbsp;from&nbsp;the&nbsp;connection,&nbsp;and&nbsp;it&nbsp;calls&nbsp;WriteResponse&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5291079">//&nbsp;write&nbsp;a&nbsp;response&nbsp;back.&nbsp;&nbsp;The&nbsp;server&nbsp;calls&nbsp;Close&nbsp;when&nbsp;finished&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5291152">//&nbsp;connection.&nbsp;ReadRequestBody&nbsp;may&nbsp;be&nbsp;called&nbsp;with&nbsp;a&nbsp;nil</span><br>
<span class="lineno">640</span><span class="comment" id="5291208">//&nbsp;argument&nbsp;to&nbsp;force&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;request&nbsp;to&nbsp;be&nbsp;read&nbsp;and&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="5291279">type</span>&nbsp;<span class="ident" id="5291284">ServerCodec</span>&nbsp;<span class="keyword" id="5291296">interface</span>&nbsp;<span class="op" id="5291306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5291309">ReadRequestHeader</span><span class="op" id="5291326">(</span><span class="op" id="5291327">*</span><span class="ident" id="5291328"><a href="/gostd/net/rpc/server.go.html#5277366">Request</a></span><span class="op" id="5291335">)</span>&nbsp;<span class="builtintype" id="5291337">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5291344">ReadRequestBody</span><span class="op" id="5291359">(</span><span class="keyword" id="5291360">interface</span><span class="op" id="5291369">{</span><span class="op" id="5291370">}</span><span class="op" id="5291371">)</span>&nbsp;<span class="builtintype" id="5291373">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5291380">//&nbsp;WriteResponse&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5291454">WriteResponse</span><span class="op" id="5291467">(</span><span class="op" id="5291468">*</span><span class="ident" id="5291469"><a href="/gostd/net/rpc/server.go.html#5277724">Response</a></span><span class="op" id="5291477">,</span>&nbsp;<span class="keyword" id="5291479">interface</span><span class="op" id="5291488">{</span><span class="op" id="5291489">}</span><span class="op" id="5291490">)</span>&nbsp;<span class="builtintype" id="5291492">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5291500">Close</span><span class="op" id="5291505">(</span><span class="op" id="5291506">)</span>&nbsp;<span class="builtintype" id="5291508">error</span><br>
<span class="lineno"></span><span class="op" id="5291514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">650</span><span class="comment" id="5291517">//&nbsp;ServeConn&nbsp;runs&nbsp;the&nbsp;DefaultServer&nbsp;on&nbsp;a&nbsp;single&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5291577">//&nbsp;ServeConn&nbsp;blocks,&nbsp;serving&nbsp;the&nbsp;connection&nbsp;until&nbsp;the&nbsp;client&nbsp;hangs&nbsp;up.</span><br>
<span class="lineno"></span><span class="comment" id="5291648">//&nbsp;The&nbsp;caller&nbsp;typically&nbsp;invokes&nbsp;ServeConn&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="5291709">//&nbsp;ServeConn&nbsp;uses&nbsp;the&nbsp;gob&nbsp;wire&nbsp;format&nbsp;(see&nbsp;package&nbsp;gob)&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5291772">//&nbsp;connection.&nbsp;&nbsp;To&nbsp;use&nbsp;an&nbsp;alternate&nbsp;codec,&nbsp;use&nbsp;ServeCodec.</span><br>
<span class="lineno">655</span><span class="keyword" id="5291831">func</span>&nbsp;<span class="ident" id="5291836">ServeConn</span><span class="op" id="5291845">(</span><span class="ident" id="5291846">conn</span>&nbsp;<span class="ident" id="5291851"><a href="/gostd/net/rpc/server.go.html#5276395">io</a></span><span class="op" id="5291853">.</span><span class="ident" id="5291854"><a href="/gostd/io/io.go.html#1423677">ReadWriteCloser</a></span><span class="op" id="5291869">)</span>&nbsp;<span class="op" id="5291871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5291874"><a href="/gostd/net/rpc/server.go.html#5278401">DefaultServer</a></span><span class="op" id="5291887">.</span><span class="ident" id="5291888"><a href="/gostd/net/rpc/server.go.html#5285797">ServeConn</a></span><span class="op" id="5291897">(</span><span class="ident" id="5291898"><a href="/gostd/net/rpc/server.go.html#5291846">conn</a></span><span class="op" id="5291902">)</span><br>
<span class="lineno"></span><span class="op" id="5291904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5291907">//&nbsp;ServeCodec&nbsp;is&nbsp;like&nbsp;ServeConn&nbsp;but&nbsp;uses&nbsp;the&nbsp;specified&nbsp;codec&nbsp;to</span><br>
<span class="lineno">660</span><span class="comment" id="5291971">//&nbsp;decode&nbsp;requests&nbsp;and&nbsp;encode&nbsp;responses.</span><br>
<span class="lineno"></span><span class="keyword" id="5292012">func</span>&nbsp;<span class="ident" id="5292017">ServeCodec</span><span class="op" id="5292027">(</span><span class="ident" id="5292028">codec</span>&nbsp;<span class="ident" id="5292034"><a href="/gostd/net/rpc/server.go.html#5291284">ServerCodec</a></span><span class="op" id="5292045">)</span>&nbsp;<span class="op" id="5292047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5292050"><a href="/gostd/net/rpc/server.go.html#5278401">DefaultServer</a></span><span class="op" id="5292063">.</span><span class="ident" id="5292064"><a href="/gostd/net/rpc/server.go.html#5286140">ServeCodec</a></span><span class="op" id="5292074">(</span><span class="ident" id="5292075"><a href="/gostd/net/rpc/server.go.html#5292028">codec</a></span><span class="op" id="5292080">)</span><br>
<span class="lineno"></span><span class="op" id="5292082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">665</span><span class="comment" id="5292085">//&nbsp;ServeRequest&nbsp;is&nbsp;like&nbsp;ServeCodec&nbsp;but&nbsp;synchronously&nbsp;serves&nbsp;a&nbsp;single&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="5292163">//&nbsp;It&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;codec&nbsp;upon&nbsp;completion.</span><br>
<span class="lineno"></span><span class="keyword" id="5292211">func</span>&nbsp;<span class="ident" id="5292216">ServeRequest</span><span class="op" id="5292228">(</span><span class="ident" id="5292229">codec</span>&nbsp;<span class="ident" id="5292235"><a href="/gostd/net/rpc/server.go.html#5291284">ServerCodec</a></span><span class="op" id="5292246">)</span>&nbsp;<span class="builtintype" id="5292248">error</span>&nbsp;<span class="op" id="5292254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5292257">return</span>&nbsp;<span class="ident" id="5292264"><a href="/gostd/net/rpc/server.go.html#5278401">DefaultServer</a></span><span class="op" id="5292277">.</span><span class="ident" id="5292278"><a href="/gostd/net/rpc/server.go.html#5286854">ServeRequest</a></span><span class="op" id="5292290">(</span><span class="ident" id="5292291"><a href="/gostd/net/rpc/server.go.html#5292229">codec</a></span><span class="op" id="5292296">)</span><br>
<span class="lineno"></span><span class="op" id="5292298">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="5292301">//&nbsp;Accept&nbsp;accepts&nbsp;connections&nbsp;on&nbsp;the&nbsp;listener&nbsp;and&nbsp;serves&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="5292367">//&nbsp;to&nbsp;DefaultServer&nbsp;for&nbsp;each&nbsp;incoming&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5292417">//&nbsp;Accept&nbsp;blocks;&nbsp;the&nbsp;caller&nbsp;typically&nbsp;invokes&nbsp;it&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="5292486">func</span>&nbsp;<span class="ident" id="5292491">Accept</span><span class="op" id="5292497">(</span><span class="ident" id="5292498">lis</span>&nbsp;<span class="ident" id="5292502"><a href="/gostd/net/rpc/server.go.html#5276408">net</a></span><span class="op" id="5292505">.</span><span class="ident" id="5292506"><a href="/gostd/net/net.go.html#3340703">Listener</a></span><span class="op" id="5292514">)</span>&nbsp;<span class="op" id="5292516">{</span>&nbsp;<span class="ident" id="5292518"><a href="/gostd/net/rpc/server.go.html#5278401">DefaultServer</a></span><span class="op" id="5292531">.</span><span class="ident" id="5292532"><a href="/gostd/net/rpc/server.go.html#5290264">Accept</a></span><span class="op" id="5292538">(</span><span class="ident" id="5292539"><a href="/gostd/net/rpc/server.go.html#5292498">lis</a></span><span class="op" id="5292542">)</span>&nbsp;<span class="op" id="5292544">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="comment" id="5292547">//&nbsp;Can&nbsp;connect&nbsp;to&nbsp;RPC&nbsp;service&nbsp;using&nbsp;HTTP&nbsp;CONNECT&nbsp;to&nbsp;rpcPath.</span><br>
<span class="lineno"></span><span class="keyword" id="5292608">var</span>&nbsp;<span class="ident" id="5292612">connected</span>&nbsp;<span class="op" id="5292622">=</span>&nbsp;<span class="string" id="5292624">&#34;200&nbsp;Connected&nbsp;to&nbsp;Go&nbsp;RPC&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5292651">//&nbsp;ServeHTTP&nbsp;implements&nbsp;an&nbsp;http.Handler&nbsp;that&nbsp;answers&nbsp;RPC&nbsp;requests.</span><br>
<span class="lineno">680</span><span class="keyword" id="5292718">func</span>&nbsp;<span class="op" id="5292723">(</span><span class="ident" id="5292724">server</span>&nbsp;<span class="op" id="5292731">*</span><span class="ident" id="5292732"><a href="/gostd/net/rpc/server.go.html#5277991">Server</a></span><span class="op" id="5292738">)</span>&nbsp;<span class="ident" id="5292740">ServeHTTP</span><span class="op" id="5292749">(</span><span class="ident" id="5292750">w</span>&nbsp;<span class="ident" id="5292752"><a href="/gostd/net/rpc/server.go.html#5276415">http</a></span><span class="op" id="5292756">.</span><span class="ident" id="5292757"><a href="/gostd/net/http/server.go.html#4170569">ResponseWriter</a></span><span class="op" id="5292771">,</span>&nbsp;<span class="ident" id="5292773">req</span>&nbsp;<span class="op" id="5292777">*</span><span class="ident" id="5292778"><a href="/gostd/net/rpc/server.go.html#5276415">http</a></span><span class="op" id="5292782">.</span><span class="ident" id="5292783"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="5292790">)</span>&nbsp;<span class="op" id="5292792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5292795">if</span>&nbsp;<span class="ident" id="5292798"><a href="/gostd/net/rpc/server.go.html#5292773">req</a></span><span class="op" id="5292801">.</span><span class="ident" id="5292802"><a href="/gostd/net/http/request.go.html#4136084">Method</a></span>&nbsp;<span class="op" id="5292809">!=</span>&nbsp;<span class="string" id="5292812">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="5292822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5292826"><a href="/gostd/net/rpc/server.go.html#5292750">w</a></span><span class="op" id="5292827">.</span><span class="ident" id="5292828"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="5292834">(</span><span class="op" id="5292835">)</span><span class="op" id="5292836">.</span><span class="ident" id="5292837"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="5292840">(</span><span class="string" id="5292841">&#34;Content-Type&#34;</span><span class="op" id="5292855">,</span>&nbsp;<span class="string" id="5292857">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5292884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5292888"><a href="/gostd/net/rpc/server.go.html#5292750">w</a></span><span class="op" id="5292889">.</span><span class="ident" id="5292890"><a href="/gostd/net/http/server.go.html#4171422">WriteHeader</a></span><span class="op" id="5292901">(</span><span class="ident" id="5292902"><a href="/gostd/net/rpc/server.go.html#5276415">http</a></span><span class="op" id="5292906">.</span><span class="ident" id="5292907"><a href="/gostd/net/http/status.go.html#4236877">StatusMethodNotAllowed</a></span><span class="op" id="5292929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5292933"><a href="/gostd/net/rpc/server.go.html#5276395">io</a></span><span class="op" id="5292935">.</span><span class="ident" id="5292936"><a href="/gostd/io/io.go.html#1428475">WriteString</a></span><span class="op" id="5292947">(</span><span class="ident" id="5292948"><a href="/gostd/net/rpc/server.go.html#5292750">w</a></span><span class="op" id="5292949">,</span>&nbsp;<span class="string" id="5292951">&#34;405&nbsp;must&nbsp;CONNECT\n&#34;</span><span class="op" id="5292971">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5292975">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5292983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5292986">conn</span><span class="op" id="5292990">,</span>&nbsp;<span class="ident" id="5292992">_</span><span class="op" id="5292993">,</span>&nbsp;<span class="ident" id="5292995">err</span>&nbsp;<span class="op" id="5292999">:=</span>&nbsp;<span class="ident" id="5293002"><a href="/gostd/net/rpc/server.go.html#5292750">w</a></span><span class="op" id="5293003">.</span><span class="op" id="5293004">(</span><span class="ident" id="5293005"><a href="/gostd/net/rpc/server.go.html#5276415">http</a></span><span class="op" id="5293009">.</span><span class="ident" id="5293010"><a href="/gostd/net/http/server.go.html#4171972">Hijacker</a></span><span class="op" id="5293018">)</span><span class="op" id="5293019">.</span><span class="ident" id="5293020"><a href="/gostd/net/http/server.go.html#4172235">Hijack</a></span><span class="op" id="5293026">(</span><span class="op" id="5293027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5293030">if</span>&nbsp;<span class="ident" id="5293033"><a href="/gostd/net/rpc/server.go.html#5292995">err</a></span>&nbsp;<span class="op" id="5293037">!=</span>&nbsp;<span class="builtintype" id="5293040">nil</span>&nbsp;<span class="op" id="5293044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5293048"><a href="/gostd/net/rpc/server.go.html#5276401">log</a></span><span class="op" id="5293051">.</span><span class="ident" id="5293052"><a href="/gostd/log/log.go.html#4078487">Print</a></span><span class="op" id="5293057">(</span><span class="string" id="5293058">&#34;rpc&nbsp;hijacking&nbsp;&#34;</span><span class="op" id="5293074">,</span>&nbsp;<span class="ident" id="5293076"><a href="/gostd/net/rpc/server.go.html#5292773">req</a></span><span class="op" id="5293079">.</span><span class="ident" id="5293080"><a href="/gostd/net/http/request.go.html#4141200">RemoteAddr</a></span><span class="op" id="5293090">,</span>&nbsp;<span class="string" id="5293092">&#34;:&nbsp;&#34;</span><span class="op" id="5293096">,</span>&nbsp;<span class="ident" id="5293098"><a href="/gostd/net/rpc/server.go.html#5292995">err</a></span><span class="op" id="5293101">.</span><span class="ident" id="5293102">Error</span><span class="op" id="5293107">(</span><span class="op" id="5293108">)</span><span class="op" id="5293109">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5293113">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5293121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5293124"><a href="/gostd/net/rpc/server.go.html#5276395">io</a></span><span class="op" id="5293126">.</span><span class="ident" id="5293127"><a href="/gostd/io/io.go.html#1428475">WriteString</a></span><span class="op" id="5293138">(</span><span class="ident" id="5293139"><a href="/gostd/net/rpc/server.go.html#5292986">conn</a></span><span class="op" id="5293143">,</span>&nbsp;<span class="string" id="5293145">&#34;HTTP/1.0&nbsp;&#34;</span><span class="op" id="5293156">+</span><span class="ident" id="5293157"><a href="/gostd/net/rpc/server.go.html#5292612">connected</a></span><span class="op" id="5293166">+</span><span class="string" id="5293167">&#34;\n\n&#34;</span><span class="op" id="5293173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5293176"><a href="/gostd/net/rpc/server.go.html#5292724">server</a></span><span class="op" id="5293182">.</span><span class="ident" id="5293183"><a href="/gostd/net/rpc/server.go.html#5285797">ServeConn</a></span><span class="op" id="5293192">(</span><span class="ident" id="5293193"><a href="/gostd/net/rpc/server.go.html#5292986">conn</a></span><span class="op" id="5293197">)</span><br>
<span class="lineno"></span><span class="op" id="5293199">}</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span><span class="comment" id="5293202">//&nbsp;HandleHTTP&nbsp;registers&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;for&nbsp;RPC&nbsp;messages&nbsp;on&nbsp;rpcPath,</span><br>
<span class="lineno"></span><span class="comment" id="5293271">//&nbsp;and&nbsp;a&nbsp;debugging&nbsp;handler&nbsp;on&nbsp;debugPath.</span><br>
<span class="lineno"></span><span class="comment" id="5293312">//&nbsp;It&nbsp;is&nbsp;still&nbsp;necessary&nbsp;to&nbsp;invoke&nbsp;http.Serve(),&nbsp;typically&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="5293390">func</span>&nbsp;<span class="op" id="5293395">(</span><span class="ident" id="5293396">server</span>&nbsp;<span class="op" id="5293403">*</span><span class="ident" id="5293404"><a href="/gostd/net/rpc/server.go.html#5277991">Server</a></span><span class="op" id="5293410">)</span>&nbsp;<span class="ident" id="5293412">HandleHTTP</span><span class="op" id="5293422">(</span><span class="ident" id="5293423">rpcPath</span><span class="op" id="5293430">,</span>&nbsp;<span class="ident" id="5293432">debugPath</span>&nbsp;<span class="builtintype" id="5293442">string</span><span class="op" id="5293448">)</span>&nbsp;<span class="op" id="5293450">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5293453"><a href="/gostd/net/rpc/server.go.html#5276415">http</a></span><span class="op" id="5293457">.</span><span class="ident" id="5293458"><a href="/gostd/net/http/server.go.html#4215699">Handle</a></span><span class="op" id="5293464">(</span><span class="ident" id="5293465"><a href="/gostd/net/rpc/server.go.html#5293423">rpcPath</a></span><span class="op" id="5293472">,</span>&nbsp;<span class="ident" id="5293474"><a href="/gostd/net/rpc/server.go.html#5293396">server</a></span><span class="op" id="5293480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5293483"><a href="/gostd/net/rpc/server.go.html#5276415">http</a></span><span class="op" id="5293487">.</span><span class="ident" id="5293488"><a href="/gostd/net/http/server.go.html#4215699">Handle</a></span><span class="op" id="5293494">(</span><span class="ident" id="5293495"><a href="/gostd/net/rpc/server.go.html#5293432">debugPath</a></span><span class="op" id="5293504">,</span>&nbsp;<span class="ident" id="5293506"><a href="/gostd/net/rpc/debug.go.html#5271633">debugHTTP</a></span><span class="op" id="5293515">{</span><span class="ident" id="5293516"><a href="/gostd/net/rpc/server.go.html#5293396">server</a></span><span class="op" id="5293522">}</span><span class="op" id="5293523">)</span><br>
<span class="lineno"></span><span class="op" id="5293525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5293528">//&nbsp;HandleHTTP&nbsp;registers&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;for&nbsp;RPC&nbsp;messages&nbsp;to&nbsp;DefaultServer</span><br>
<span class="lineno">705</span><span class="comment" id="5293602">//&nbsp;on&nbsp;DefaultRPCPath&nbsp;and&nbsp;a&nbsp;debugging&nbsp;handler&nbsp;on&nbsp;DefaultDebugPath.</span><br>
<span class="lineno"></span><span class="comment" id="5293668">//&nbsp;It&nbsp;is&nbsp;still&nbsp;necessary&nbsp;to&nbsp;invoke&nbsp;http.Serve(),&nbsp;typically&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="5293746">func</span>&nbsp;<span class="ident" id="5293751">HandleHTTP</span><span class="op" id="5293761">(</span><span class="op" id="5293762">)</span>&nbsp;<span class="op" id="5293764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5293767"><a href="/gostd/net/rpc/server.go.html#5278401">DefaultServer</a></span><span class="op" id="5293780">.</span><span class="ident" id="5293781"><a href="/gostd/net/rpc/server.go.html#5293412">HandleHTTP</a></span><span class="op" id="5293791">(</span><span class="ident" id="5293792"><a href="/gostd/net/rpc/server.go.html#5276527">DefaultRPCPath</a></span><span class="op" id="5293806">,</span>&nbsp;<span class="ident" id="5293808"><a href="/gostd/net/rpc/server.go.html#5276558">DefaultDebugPath</a></span><span class="op" id="5293824">)</span><br>
<span class="lineno"></span><span class="op" id="5293826">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
