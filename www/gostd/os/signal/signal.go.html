<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os/signal</h2>
<ul>
<li><a href="/gostd/os/signal/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/os/signal/signal.go.html">signal.go</a></li>
<li><a href="/gostd/os/signal/signal_test.go.html">signal_test.go</a></li>
<li><a href="/gostd/os/signal/signal_unix.go.html">signal_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6338458">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6338513">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6338567">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6338618">//&nbsp;Package&nbsp;signal&nbsp;implements&nbsp;access&nbsp;to&nbsp;incoming&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="6338675">package</span>&nbsp;<span class="ident" id="6338683">signal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6338691">//&nbsp;BUG(rsc):&nbsp;This&nbsp;package&nbsp;is&nbsp;not&nbsp;yet&nbsp;implemented&nbsp;on&nbsp;Plan&nbsp;9.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6338752">import</span>&nbsp;<span class="op" id="6338759">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6338762">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6338768">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6338775">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6338778">var</span>&nbsp;<span class="ident" id="6338782">handlers</span>&nbsp;<span class="keyword" id="6338791">struct</span>&nbsp;<span class="op" id="6338798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338801">sync</span><span class="op" id="6338805">.</span><span class="ident" id="6338806">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338813">m</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338817">map</span><span class="op" id="6338820">[</span><span class="keyword" id="6338821">chan</span><span class="op" id="6338825">&lt;-</span>&nbsp;<span class="ident" id="6338828">os</span><span class="op" id="6338830">.</span><span class="ident" id="6338831">Signal</span><span class="op" id="6338837">]</span><span class="op" id="6338838">*</span><span class="ident" id="6338839">handler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338848">ref</span>&nbsp;<span class="op" id="6338852">[</span><span class="ident" id="6338853">numSig</span><span class="op" id="6338859">]</span><span class="ident" id="6338860">int64</span><br>
<span class="lineno"></span><span class="op" id="6338866">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6338869">type</span>&nbsp;<span class="ident" id="6338874">handler</span>&nbsp;<span class="keyword" id="6338882">struct</span>&nbsp;<span class="op" id="6338889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338892">mask</span>&nbsp;<span class="op" id="6338897">[</span><span class="op" id="6338898">(</span><span class="ident" id="6338899">numSig</span>&nbsp;<span class="op" id="6338906">+</span>&nbsp;<span class="num" id="6338908">31</span><span class="op" id="6338910">)</span>&nbsp;<span class="op" id="6338912">/</span>&nbsp;<span class="num" id="6338914">32</span><span class="op" id="6338916">]</span><span class="builtintype" id="6338917">uint32</span><br>
<span class="lineno"></span><span class="op" id="6338924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6338927">func</span>&nbsp;<span class="op" id="6338932">(</span><span class="ident" id="6338933">h</span>&nbsp;<span class="op" id="6338935">*</span><span class="ident" id="6338936">handler</span><span class="op" id="6338943">)</span>&nbsp;<span class="ident" id="6338945">want</span><span class="op" id="6338949">(</span><span class="ident" id="6338950">sig</span>&nbsp;<span class="builtintype" id="6338954">int</span><span class="op" id="6338957">)</span>&nbsp;<span class="builtintype" id="6338959">bool</span>&nbsp;<span class="op" id="6338964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338967">return</span>&nbsp;<span class="op" id="6338974">(</span><span class="ident" id="6338975">h</span><span class="op" id="6338976">.</span><span class="ident" id="6338977">mask</span><span class="op" id="6338981">[</span><span class="ident" id="6338982">sig</span><span class="op" id="6338985">/</span><span class="num" id="6338986">32</span><span class="op" id="6338988">]</span><span class="op" id="6338989">&gt;&gt;</span><span class="builtintype" id="6338991">uint</span><span class="op" id="6338995">(</span><span class="ident" id="6338996">sig</span><span class="op" id="6338999">&amp;</span><span class="num" id="6339000">31</span><span class="op" id="6339002">)</span><span class="op" id="6339003">)</span><span class="op" id="6339004">&amp;</span><span class="num" id="6339005">1</span>&nbsp;<span class="op" id="6339007">!=</span>&nbsp;<span class="num" id="6339010">0</span><br>
<span class="lineno"></span><span class="op" id="6339012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6339015">func</span>&nbsp;<span class="op" id="6339020">(</span><span class="ident" id="6339021">h</span>&nbsp;<span class="op" id="6339023">*</span><span class="ident" id="6339024">handler</span><span class="op" id="6339031">)</span>&nbsp;<span class="ident" id="6339033">set</span><span class="op" id="6339036">(</span><span class="ident" id="6339037">sig</span>&nbsp;<span class="builtintype" id="6339041">int</span><span class="op" id="6339044">)</span>&nbsp;<span class="op" id="6339046">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6339049">h</span><span class="op" id="6339050">.</span><span class="ident" id="6339051">mask</span><span class="op" id="6339055">[</span><span class="ident" id="6339056">sig</span><span class="op" id="6339059">/</span><span class="num" id="6339060">32</span><span class="op" id="6339062">]</span>&nbsp;<span class="op" id="6339064">|=</span>&nbsp;<span class="num" id="6339067">1</span>&nbsp;<span class="op" id="6339069">&lt;&lt;</span>&nbsp;<span class="builtintype" id="6339072">uint</span><span class="op" id="6339076">(</span><span class="ident" id="6339077">sig</span><span class="op" id="6339080">&amp;</span><span class="num" id="6339081">31</span><span class="op" id="6339083">)</span><br>
<span class="lineno"></span><span class="op" id="6339085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6339088">//&nbsp;Notify&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;relay&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6339152">//&nbsp;If&nbsp;no&nbsp;signals&nbsp;are&nbsp;listed,&nbsp;all&nbsp;incoming&nbsp;signals&nbsp;will&nbsp;be&nbsp;relayed&nbsp;to&nbsp;c.</span><br>
<span class="lineno">35</span><span class="comment" id="6339224">//&nbsp;Otherwise,&nbsp;just&nbsp;the&nbsp;listed&nbsp;signals&nbsp;will.</span><br>
<span class="lineno"></span><span class="comment" id="6339268">//</span><br>
<span class="lineno"></span><span class="comment" id="6339271">//&nbsp;Package&nbsp;signal&nbsp;will&nbsp;not&nbsp;block&nbsp;sending&nbsp;to&nbsp;c:&nbsp;the&nbsp;caller&nbsp;must&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="6339341">//&nbsp;that&nbsp;c&nbsp;has&nbsp;sufficient&nbsp;buffer&nbsp;space&nbsp;to&nbsp;keep&nbsp;up&nbsp;with&nbsp;the&nbsp;expected</span><br>
<span class="lineno"></span><span class="comment" id="6339408">//&nbsp;signal&nbsp;rate.&nbsp;&nbsp;For&nbsp;a&nbsp;channel&nbsp;used&nbsp;for&nbsp;notification&nbsp;of&nbsp;just&nbsp;one&nbsp;signal&nbsp;value,</span><br>
<span class="lineno">40</span><span class="comment" id="6339487">//&nbsp;a&nbsp;buffer&nbsp;of&nbsp;size&nbsp;1&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="comment" id="6339524">//</span><br>
<span class="lineno"></span><span class="comment" id="6339527">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;the&nbsp;same&nbsp;channel:</span><br>
<span class="lineno"></span><span class="comment" id="6339597">//&nbsp;each&nbsp;call&nbsp;expands&nbsp;the&nbsp;set&nbsp;of&nbsp;signals&nbsp;sent&nbsp;to&nbsp;that&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="6339659">//&nbsp;The&nbsp;only&nbsp;way&nbsp;to&nbsp;remove&nbsp;signals&nbsp;from&nbsp;the&nbsp;set&nbsp;is&nbsp;to&nbsp;call&nbsp;Stop.</span><br>
<span class="lineno">45</span><span class="comment" id="6339723">//</span><br>
<span class="lineno"></span><span class="comment" id="6339726">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;different&nbsp;channels</span><br>
<span class="lineno"></span><span class="comment" id="6339797">//&nbsp;and&nbsp;the&nbsp;same&nbsp;signals:&nbsp;each&nbsp;channel&nbsp;receives&nbsp;copies&nbsp;of&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="6339863">//&nbsp;signals&nbsp;independently.</span><br>
<span class="lineno"></span><span class="keyword" id="6339889">func</span>&nbsp;<span class="ident" id="6339894">Notify</span><span class="op" id="6339900">(</span><span class="ident" id="6339901">c</span>&nbsp;<span class="keyword" id="6339903">chan</span><span class="op" id="6339907">&lt;-</span>&nbsp;<span class="ident" id="6339910">os</span><span class="op" id="6339912">.</span><span class="ident" id="6339913">Signal</span><span class="op" id="6339919">,</span>&nbsp;<span class="ident" id="6339921">sig</span>&nbsp;<span class="op" id="6339925">...</span><span class="ident" id="6339928">os</span><span class="op" id="6339930">.</span><span class="ident" id="6339931">Signal</span><span class="op" id="6339937">)</span>&nbsp;<span class="op" id="6339939">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339942">if</span>&nbsp;<span class="ident" id="6339945">c</span>&nbsp;<span class="op" id="6339947">==</span>&nbsp;<span class="ident" id="6339950">nil</span>&nbsp;<span class="op" id="6339954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6339958">panic</span><span class="op" id="6339963">(</span><span class="string" id="6339964">&#34;os/signal:&nbsp;Notify&nbsp;using&nbsp;nil&nbsp;channel&#34;</span><span class="op" id="6340001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6340004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340008">handlers</span><span class="op" id="6340016">.</span><span class="ident" id="6340017">Lock</span><span class="op" id="6340021">(</span><span class="op" id="6340022">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340025">defer</span>&nbsp;<span class="ident" id="6340031">handlers</span><span class="op" id="6340039">.</span><span class="ident" id="6340040">Unlock</span><span class="op" id="6340046">(</span><span class="op" id="6340047">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340051">h</span>&nbsp;<span class="op" id="6340053">:=</span>&nbsp;<span class="ident" id="6340056">handlers</span><span class="op" id="6340064">.</span><span class="ident" id="6340065">m</span><span class="op" id="6340066">[</span><span class="ident" id="6340067">c</span><span class="op" id="6340068">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340071">if</span>&nbsp;<span class="ident" id="6340074">h</span>&nbsp;<span class="op" id="6340076">==</span>&nbsp;<span class="ident" id="6340079">nil</span>&nbsp;<span class="op" id="6340083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340087">if</span>&nbsp;<span class="ident" id="6340090">handlers</span><span class="op" id="6340098">.</span><span class="ident" id="6340099">m</span>&nbsp;<span class="op" id="6340101">==</span>&nbsp;<span class="ident" id="6340104">nil</span>&nbsp;<span class="op" id="6340108">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340113">handlers</span><span class="op" id="6340121">.</span><span class="ident" id="6340122">m</span>&nbsp;<span class="op" id="6340124">=</span>&nbsp;<span class="builtinfunc" id="6340126">make</span><span class="op" id="6340130">(</span><span class="keyword" id="6340131">map</span><span class="op" id="6340134">[</span><span class="keyword" id="6340135">chan</span><span class="op" id="6340139">&lt;-</span>&nbsp;<span class="ident" id="6340142">os</span><span class="op" id="6340144">.</span><span class="ident" id="6340145">Signal</span><span class="op" id="6340151">]</span><span class="op" id="6340152">*</span><span class="ident" id="6340153">handler</span><span class="op" id="6340160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6340164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340168">h</span>&nbsp;<span class="op" id="6340170">=</span>&nbsp;<span class="builtinfunc" id="6340172">new</span><span class="op" id="6340175">(</span><span class="ident" id="6340176">handler</span><span class="op" id="6340183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340187">handlers</span><span class="op" id="6340195">.</span><span class="ident" id="6340196">m</span><span class="op" id="6340197">[</span><span class="ident" id="6340198">c</span><span class="op" id="6340199">]</span>&nbsp;<span class="op" id="6340201">=</span>&nbsp;<span class="ident" id="6340203">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6340206">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340210">add</span>&nbsp;<span class="op" id="6340214">:=</span>&nbsp;<span class="keyword" id="6340217">func</span><span class="op" id="6340221">(</span><span class="ident" id="6340222">n</span>&nbsp;<span class="builtintype" id="6340224">int</span><span class="op" id="6340227">)</span>&nbsp;<span class="op" id="6340229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340233">if</span>&nbsp;<span class="ident" id="6340236">n</span>&nbsp;<span class="op" id="6340238">&lt;</span>&nbsp;<span class="num" id="6340240">0</span>&nbsp;<span class="op" id="6340242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340247">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6340256">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340260">if</span>&nbsp;<span class="op" id="6340263">!</span><span class="ident" id="6340264">h</span><span class="op" id="6340265">.</span><span class="ident" id="6340266">want</span><span class="op" id="6340270">(</span><span class="ident" id="6340271">n</span><span class="op" id="6340272">)</span>&nbsp;<span class="op" id="6340274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340279">h</span><span class="op" id="6340280">.</span><span class="ident" id="6340281">set</span><span class="op" id="6340284">(</span><span class="ident" id="6340285">n</span><span class="op" id="6340286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340291">if</span>&nbsp;<span class="ident" id="6340294">handlers</span><span class="op" id="6340302">.</span><span class="ident" id="6340303">ref</span><span class="op" id="6340306">[</span><span class="ident" id="6340307">n</span><span class="op" id="6340308">]</span>&nbsp;<span class="op" id="6340310">==</span>&nbsp;<span class="num" id="6340313">0</span>&nbsp;<span class="op" id="6340315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340321">enableSignal</span><span class="op" id="6340333">(</span><span class="ident" id="6340334">n</span><span class="op" id="6340335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6340340">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340345">handlers</span><span class="op" id="6340353">.</span><span class="ident" id="6340354">ref</span><span class="op" id="6340357">[</span><span class="ident" id="6340358">n</span><span class="op" id="6340359">]</span><span class="op" id="6340360">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6340365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6340368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340372">if</span>&nbsp;<span class="builtinfunc" id="6340375">len</span><span class="op" id="6340378">(</span><span class="ident" id="6340379">sig</span><span class="op" id="6340382">)</span>&nbsp;<span class="op" id="6340384">==</span>&nbsp;<span class="num" id="6340387">0</span>&nbsp;<span class="op" id="6340389">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340393">for</span>&nbsp;<span class="ident" id="6340397">n</span>&nbsp;<span class="op" id="6340399">:=</span>&nbsp;<span class="num" id="6340402">0</span><span class="op" id="6340403">;</span>&nbsp;<span class="ident" id="6340405">n</span>&nbsp;<span class="op" id="6340407">&lt;</span>&nbsp;<span class="ident" id="6340409">numSig</span><span class="op" id="6340415">;</span>&nbsp;<span class="ident" id="6340417">n</span><span class="op" id="6340418">++</span>&nbsp;<span class="op" id="6340421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340426">add</span><span class="op" id="6340429">(</span><span class="ident" id="6340430">n</span><span class="op" id="6340431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6340435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6340438">}</span>&nbsp;<span class="keyword" id="6340440">else</span>&nbsp;<span class="op" id="6340445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340449">for</span>&nbsp;<span class="ident" id="6340453">_</span><span class="op" id="6340454">,</span>&nbsp;<span class="ident" id="6340456">s</span>&nbsp;<span class="op" id="6340458">:=</span>&nbsp;<span class="keyword" id="6340461">range</span>&nbsp;<span class="ident" id="6340467">sig</span>&nbsp;<span class="op" id="6340471">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340476">add</span><span class="op" id="6340479">(</span><span class="ident" id="6340480">signum</span><span class="op" id="6340486">(</span><span class="ident" id="6340487">s</span><span class="op" id="6340488">)</span><span class="op" id="6340489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6340493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6340496">}</span><br>
<span class="lineno"></span><span class="op" id="6340498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="6340501">//&nbsp;Stop&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;stop&nbsp;relaying&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6340571">//&nbsp;It&nbsp;undoes&nbsp;the&nbsp;effect&nbsp;of&nbsp;all&nbsp;prior&nbsp;calls&nbsp;to&nbsp;Notify&nbsp;using&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6340633">//&nbsp;When&nbsp;Stop&nbsp;returns,&nbsp;it&nbsp;is&nbsp;guaranteed&nbsp;that&nbsp;c&nbsp;will&nbsp;receive&nbsp;no&nbsp;more&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="6340709">func</span>&nbsp;<span class="ident" id="6340714">Stop</span><span class="op" id="6340718">(</span><span class="ident" id="6340719">c</span>&nbsp;<span class="keyword" id="6340721">chan</span><span class="op" id="6340725">&lt;-</span>&nbsp;<span class="ident" id="6340728">os</span><span class="op" id="6340730">.</span><span class="ident" id="6340731">Signal</span><span class="op" id="6340737">)</span>&nbsp;<span class="op" id="6340739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340742">handlers</span><span class="op" id="6340750">.</span><span class="ident" id="6340751">Lock</span><span class="op" id="6340755">(</span><span class="op" id="6340756">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340759">defer</span>&nbsp;<span class="ident" id="6340765">handlers</span><span class="op" id="6340773">.</span><span class="ident" id="6340774">Unlock</span><span class="op" id="6340780">(</span><span class="op" id="6340781">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340785">h</span>&nbsp;<span class="op" id="6340787">:=</span>&nbsp;<span class="ident" id="6340790">handlers</span><span class="op" id="6340798">.</span><span class="ident" id="6340799">m</span><span class="op" id="6340800">[</span><span class="ident" id="6340801">c</span><span class="op" id="6340802">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340805">if</span>&nbsp;<span class="ident" id="6340808">h</span>&nbsp;<span class="op" id="6340810">==</span>&nbsp;<span class="ident" id="6340813">nil</span>&nbsp;<span class="op" id="6340817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340821">return</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6340829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6340832">delete</span><span class="op" id="6340838">(</span><span class="ident" id="6340839">handlers</span><span class="op" id="6340847">.</span><span class="ident" id="6340848">m</span><span class="op" id="6340849">,</span>&nbsp;<span class="ident" id="6340851">c</span><span class="op" id="6340852">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340856">for</span>&nbsp;<span class="ident" id="6340860">n</span>&nbsp;<span class="op" id="6340862">:=</span>&nbsp;<span class="num" id="6340865">0</span><span class="op" id="6340866">;</span>&nbsp;<span class="ident" id="6340868">n</span>&nbsp;<span class="op" id="6340870">&lt;</span>&nbsp;<span class="ident" id="6340872">numSig</span><span class="op" id="6340878">;</span>&nbsp;<span class="ident" id="6340880">n</span><span class="op" id="6340881">++</span>&nbsp;<span class="op" id="6340884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340888">if</span>&nbsp;<span class="ident" id="6340891">h</span><span class="op" id="6340892">.</span><span class="ident" id="6340893">want</span><span class="op" id="6340897">(</span><span class="ident" id="6340898">n</span><span class="op" id="6340899">)</span>&nbsp;<span class="op" id="6340901">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340906">handlers</span><span class="op" id="6340914">.</span><span class="ident" id="6340915">ref</span><span class="op" id="6340918">[</span><span class="ident" id="6340919">n</span><span class="op" id="6340920">]</span><span class="op" id="6340921">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340927">if</span>&nbsp;<span class="ident" id="6340930">handlers</span><span class="op" id="6340938">.</span><span class="ident" id="6340939">ref</span><span class="op" id="6340942">[</span><span class="ident" id="6340943">n</span><span class="op" id="6340944">]</span>&nbsp;<span class="op" id="6340946">==</span>&nbsp;<span class="num" id="6340949">0</span>&nbsp;<span class="op" id="6340951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340957">disableSignal</span><span class="op" id="6340970">(</span><span class="ident" id="6340971">n</span><span class="op" id="6340972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6340977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6340981">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6340984">}</span><br>
<span class="lineno"></span><span class="op" id="6340986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6340989">func</span>&nbsp;<span class="ident" id="6340994">process</span><span class="op" id="6341001">(</span><span class="ident" id="6341002">sig</span>&nbsp;<span class="ident" id="6341006">os</span><span class="op" id="6341008">.</span><span class="ident" id="6341009">Signal</span><span class="op" id="6341015">)</span>&nbsp;<span class="op" id="6341017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341020">n</span>&nbsp;<span class="op" id="6341022">:=</span>&nbsp;<span class="ident" id="6341025">signum</span><span class="op" id="6341031">(</span><span class="ident" id="6341032">sig</span><span class="op" id="6341035">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341038">if</span>&nbsp;<span class="ident" id="6341041">n</span>&nbsp;<span class="op" id="6341043">&lt;</span>&nbsp;<span class="num" id="6341045">0</span>&nbsp;<span class="op" id="6341047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341051">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6341059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341063">handlers</span><span class="op" id="6341071">.</span><span class="ident" id="6341072">Lock</span><span class="op" id="6341076">(</span><span class="op" id="6341077">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341080">defer</span>&nbsp;<span class="ident" id="6341086">handlers</span><span class="op" id="6341094">.</span><span class="ident" id="6341095">Unlock</span><span class="op" id="6341101">(</span><span class="op" id="6341102">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341106">for</span>&nbsp;<span class="ident" id="6341110">c</span><span class="op" id="6341111">,</span>&nbsp;<span class="ident" id="6341113">h</span>&nbsp;<span class="op" id="6341115">:=</span>&nbsp;<span class="keyword" id="6341118">range</span>&nbsp;<span class="ident" id="6341124">handlers</span><span class="op" id="6341132">.</span><span class="ident" id="6341133">m</span>&nbsp;<span class="op" id="6341135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341139">if</span>&nbsp;<span class="ident" id="6341142">h</span><span class="op" id="6341143">.</span><span class="ident" id="6341144">want</span><span class="op" id="6341148">(</span><span class="ident" id="6341149">n</span><span class="op" id="6341150">)</span>&nbsp;<span class="op" id="6341152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6341157">//&nbsp;send&nbsp;but&nbsp;do&nbsp;not&nbsp;block&nbsp;for&nbsp;it</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341192">select</span>&nbsp;<span class="op" id="6341199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341204">case</span>&nbsp;<span class="ident" id="6341209">c</span>&nbsp;<span class="op" id="6341211">&lt;-</span>&nbsp;<span class="ident" id="6341214">sig</span><span class="op" id="6341217">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341222">default</span><span class="op" id="6341229">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6341234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6341238">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6341241">}</span><br>
<span class="lineno"></span><span class="op" id="6341243">}</span>
</div>
</body>
</html>
