<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5098751">package</span>&nbsp;<span class="ident" id="5098759">asm8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5098765">import</span>&nbsp;<span class="op" id="5098772">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5098775">&#34;lonnie.io/e8vm/lex8&#34;</span><br>
<span class="lineno">5</span><span class="op" id="5098797">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5098800">var</span>&nbsp;<span class="op" id="5098804">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5098807">//&nbsp;op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098814">opSysMap</span>&nbsp;<span class="op" id="5098823">=</span>&nbsp;<span class="keyword" id="5098825">map</span><span class="op" id="5098828">[</span><span class="builtintype" id="5098829">string</span><span class="op" id="5098835">]</span><span class="builtintype" id="5098836">uint32</span><span class="op" id="5098842">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5098846">&#34;halt&#34;</span><span class="op" id="5098852">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5098857">64</span><span class="op" id="5098859">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5098863">&#34;syscall&#34;</span><span class="op" id="5098872">:</span>&nbsp;<span class="num" id="5098874">65</span><span class="op" id="5098876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5098880">&#34;usermod&#34;</span><span class="op" id="5098889">:</span>&nbsp;<span class="num" id="5098891">66</span><span class="op" id="5098893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5098897">&#34;iret&#34;</span><span class="op" id="5098903">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5098908">68</span><span class="op" id="5098910">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098913">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5098917">//&nbsp;op&nbsp;reg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098928">opSys1Map</span>&nbsp;<span class="op" id="5098938">=</span>&nbsp;<span class="keyword" id="5098940">map</span><span class="op" id="5098943">[</span><span class="builtintype" id="5098944">string</span><span class="op" id="5098950">]</span><span class="builtintype" id="5098951">uint32</span><span class="op" id="5098957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5098961">&#34;vtable&#34;</span><span class="op" id="5098969">:</span>&nbsp;<span class="num" id="5098971">67</span><span class="op" id="5098973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5098977">&#34;cpuid&#34;</span><span class="op" id="5098984">:</span>&nbsp;&nbsp;<span class="num" id="5098987">69</span><span class="op" id="5098989">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098992">}</span><br>
<span class="lineno"></span><span class="op" id="5098994">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5098997">func</span>&nbsp;<span class="ident" id="5099002">makeInstSys</span><span class="op" id="5099013">(</span><span class="ident" id="5099014">op</span><span class="op" id="5099016">,</span>&nbsp;<span class="ident" id="5099018">reg</span>&nbsp;<span class="builtintype" id="5099022">uint32</span><span class="op" id="5099028">)</span>&nbsp;<span class="op" id="5099030">*</span><span class="ident" id="5099031">inst</span>&nbsp;<span class="op" id="5099036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099039">ret</span>&nbsp;<span class="op" id="5099043">:=</span>&nbsp;<span class="op" id="5099046">(</span><span class="op" id="5099047">(</span><span class="ident" id="5099048">op</span>&nbsp;<span class="op" id="5099051">&amp;</span>&nbsp;<span class="num" id="5099053">0xff</span><span class="op" id="5099057">)</span>&nbsp;<span class="op" id="5099059">&lt;&lt;</span>&nbsp;<span class="num" id="5099062">24</span><span class="op" id="5099064">)</span>&nbsp;<span class="op" id="5099066">|</span>&nbsp;<span class="op" id="5099068">(</span><span class="op" id="5099069">(</span><span class="ident" id="5099070">reg</span>&nbsp;<span class="op" id="5099074">&amp;</span>&nbsp;<span class="num" id="5099076">0x7</span><span class="op" id="5099079">)</span>&nbsp;<span class="op" id="5099081">&lt;&lt;</span>&nbsp;<span class="num" id="5099084">21</span><span class="op" id="5099086">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099089">return</span>&nbsp;<span class="op" id="5099096">&amp;</span><span class="ident" id="5099097">inst</span><span class="op" id="5099101">{</span><span class="ident" id="5099102">inst</span><span class="op" id="5099106">:</span>&nbsp;<span class="ident" id="5099108">ret</span><span class="op" id="5099111">}</span><br>
<span class="lineno"></span><span class="op" id="5099113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5099116">func</span>&nbsp;<span class="ident" id="5099121">parseInstSys</span><span class="op" id="5099133">(</span><span class="ident" id="5099134">p</span>&nbsp;<span class="op" id="5099136">*</span><span class="ident" id="5099137">parser</span><span class="op" id="5099143">,</span>&nbsp;<span class="ident" id="5099145">ops</span>&nbsp;<span class="op" id="5099149">[</span><span class="op" id="5099150">]</span><span class="op" id="5099151">*</span><span class="ident" id="5099152">lex8</span><span class="op" id="5099156">.</span><span class="ident" id="5099157">Token</span><span class="op" id="5099162">)</span>&nbsp;<span class="op" id="5099164">(</span><span class="op" id="5099165">*</span><span class="ident" id="5099166">inst</span><span class="op" id="5099170">,</span>&nbsp;<span class="builtintype" id="5099172">bool</span><span class="op" id="5099176">)</span>&nbsp;<span class="op" id="5099178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099181">op0</span>&nbsp;<span class="op" id="5099185">:=</span>&nbsp;<span class="ident" id="5099188">ops</span><span class="op" id="5099191">[</span><span class="num" id="5099192">0</span><span class="op" id="5099193">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099196">opName</span>&nbsp;<span class="op" id="5099203">:=</span>&nbsp;<span class="ident" id="5099206">op0</span><span class="op" id="5099209">.</span><span class="ident" id="5099210">Lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099215">args</span>&nbsp;<span class="op" id="5099220">:=</span>&nbsp;<span class="ident" id="5099223">ops</span><span class="op" id="5099226">[</span><span class="num" id="5099227">1</span><span class="op" id="5099228">:</span><span class="op" id="5099229">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099232">var</span>&nbsp;<span class="ident" id="5099236">op</span><span class="op" id="5099238">,</span>&nbsp;<span class="ident" id="5099240">reg</span>&nbsp;<span class="builtintype" id="5099244">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099253">argCount</span>&nbsp;<span class="op" id="5099262">:=</span>&nbsp;<span class="keyword" id="5099265">func</span><span class="op" id="5099269">(</span><span class="ident" id="5099270">n</span>&nbsp;<span class="builtintype" id="5099272">int</span><span class="op" id="5099275">)</span>&nbsp;<span class="builtintype" id="5099277">bool</span>&nbsp;<span class="op" id="5099282">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099286">if</span>&nbsp;<span class="op" id="5099289">!</span><span class="ident" id="5099290">argCount</span><span class="op" id="5099298">(</span><span class="ident" id="5099299">p</span><span class="op" id="5099300">,</span>&nbsp;<span class="ident" id="5099302">ops</span><span class="op" id="5099305">,</span>&nbsp;<span class="ident" id="5099307">n</span><span class="op" id="5099308">)</span>&nbsp;<span class="op" id="5099310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099315">return</span>&nbsp;<span class="builtintype" id="5099322">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099335">if</span>&nbsp;<span class="ident" id="5099338">n</span>&nbsp;<span class="op" id="5099340">&gt;=</span>&nbsp;<span class="num" id="5099343">1</span>&nbsp;<span class="op" id="5099345">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099350">reg</span>&nbsp;<span class="op" id="5099354">=</span>&nbsp;<span class="ident" id="5099356">parseReg</span><span class="op" id="5099364">(</span><span class="ident" id="5099365">p</span><span class="op" id="5099366">,</span>&nbsp;<span class="ident" id="5099368">args</span><span class="op" id="5099372">[</span><span class="num" id="5099373">0</span><span class="op" id="5099374">]</span><span class="op" id="5099375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099383">return</span>&nbsp;<span class="builtintype" id="5099390">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099400">var</span>&nbsp;<span class="ident" id="5099404">found</span>&nbsp;<span class="builtintype" id="5099410">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099416">if</span>&nbsp;<span class="ident" id="5099419">op</span><span class="op" id="5099421">,</span>&nbsp;<span class="ident" id="5099423">found</span>&nbsp;<span class="op" id="5099429">=</span>&nbsp;<span class="ident" id="5099431">opSysMap</span><span class="op" id="5099439">[</span><span class="ident" id="5099440">opName</span><span class="op" id="5099446">]</span><span class="op" id="5099447">;</span>&nbsp;<span class="ident" id="5099449">found</span>&nbsp;<span class="op" id="5099455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5099459">//&nbsp;op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099467">argCount</span><span class="op" id="5099475">(</span><span class="num" id="5099476">0</span><span class="op" id="5099477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099480">}</span>&nbsp;<span class="keyword" id="5099482">else</span>&nbsp;<span class="keyword" id="5099487">if</span>&nbsp;<span class="ident" id="5099490">op</span><span class="op" id="5099492">,</span>&nbsp;<span class="ident" id="5099494">found</span>&nbsp;<span class="op" id="5099500">=</span>&nbsp;<span class="ident" id="5099502">opSys1Map</span><span class="op" id="5099511">[</span><span class="ident" id="5099512">opName</span><span class="op" id="5099518">]</span><span class="op" id="5099519">;</span>&nbsp;<span class="ident" id="5099521">found</span>&nbsp;<span class="op" id="5099527">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5099531">//&nbsp;op&nbsp;reg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099543">argCount</span><span class="op" id="5099551">(</span><span class="num" id="5099552">1</span><span class="op" id="5099553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099556">}</span>&nbsp;<span class="keyword" id="5099558">else</span>&nbsp;<span class="op" id="5099563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099567">return</span>&nbsp;<span class="ident" id="5099574">nil</span><span class="op" id="5099577">,</span>&nbsp;<span class="builtintype" id="5099579">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099586">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099590">return</span>&nbsp;<span class="ident" id="5099597">makeInstSys</span><span class="op" id="5099608">(</span><span class="ident" id="5099609">op</span><span class="op" id="5099611">,</span>&nbsp;<span class="ident" id="5099613">reg</span><span class="op" id="5099616">)</span><span class="op" id="5099617">,</span>&nbsp;<span class="builtintype" id="5099619">true</span><br>
<span class="lineno"></span><span class="op" id="5099624">}</span>
</div>
</body>
</html>
