<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8006081">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8006137">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8006191">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8006242">package</span>&nbsp;<span class="ident" id="8006250">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8006256">import</span>&nbsp;<span class="op" id="8006263">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8006266">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8006275">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8006285">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8006292">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8006298">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8006311">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8006322">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8006333">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8006343">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8006346">type</span>&nbsp;<span class="ident" id="8006351">reqWriteTest</span>&nbsp;<span class="keyword" id="8006364">struct</span>&nbsp;<span class="op" id="8006371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006374">Req</span>&nbsp;&nbsp;<span class="ident" id="8006379">Request</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006388">Body</span>&nbsp;<span class="keyword" id="8006393">interface</span><span class="op" id="8006402">{</span><span class="op" id="8006403">}</span>&nbsp;<span class="comment" id="8006405">//&nbsp;optional&nbsp;[]byte&nbsp;or&nbsp;func()&nbsp;io.ReadCloser&nbsp;to&nbsp;populate&nbsp;Req.Body</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8006471">//&nbsp;Any&nbsp;of&nbsp;these&nbsp;three&nbsp;may&nbsp;be&nbsp;empty&nbsp;to&nbsp;skip&nbsp;that&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006526">WantWrite</span>&nbsp;<span class="builtintype" id="8006536">string</span>&nbsp;<span class="comment" id="8006543">//&nbsp;Request.Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006561">WantProxy</span>&nbsp;<span class="builtintype" id="8006571">string</span>&nbsp;<span class="comment" id="8006578">//&nbsp;Request.WriteProxy</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006602">WantError</span>&nbsp;<span class="builtintype" id="8006612">error</span>&nbsp;<span class="comment" id="8006618">//&nbsp;wanted&nbsp;error&nbsp;from&nbsp;Request.Write</span><br>
<span class="lineno"></span><span class="op" id="8006653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8006656">var</span>&nbsp;<span class="ident" id="8006660">reqWriteTests</span>&nbsp;<span class="op" id="8006674">=</span>&nbsp;<span class="op" id="8006676">[</span><span class="op" id="8006677">]</span><span class="ident" id="8006678">reqWriteTest</span><span class="op" id="8006690">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8006693">//&nbsp;HTTP/1.1&nbsp;=&gt;&nbsp;chunked&nbsp;coding;&nbsp;no&nbsp;body;&nbsp;no&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8006745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006749">Req</span><span class="op" id="8006752">:</span>&nbsp;<span class="ident" id="8006754">Request</span><span class="op" id="8006761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006766">Method</span><span class="op" id="8006772">:</span>&nbsp;<span class="string" id="8006774">&#34;GET&#34;</span><span class="op" id="8006779">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006784">URL</span><span class="op" id="8006787">:</span>&nbsp;<span class="op" id="8006789">&amp;</span><span class="ident" id="8006790">url</span><span class="op" id="8006793">.</span><span class="ident" id="8006794">URL</span><span class="op" id="8006797">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006803">Scheme</span><span class="op" id="8006809">:</span>&nbsp;<span class="string" id="8006811">&#34;http&#34;</span><span class="op" id="8006817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006823">Host</span><span class="op" id="8006827">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8006831">&#34;www.techcrunch.com&#34;</span><span class="op" id="8006851">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006857">Path</span><span class="op" id="8006861">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8006865">&#34;/&#34;</span><span class="op" id="8006868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8006873">}</span><span class="op" id="8006874">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006879">Proto</span><span class="op" id="8006884">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8006891">&#34;HTTP/1.1&#34;</span><span class="op" id="8006901">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006906">ProtoMajor</span><span class="op" id="8006916">:</span>&nbsp;<span class="num" id="8006918">1</span><span class="op" id="8006919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006924">ProtoMinor</span><span class="op" id="8006934">:</span>&nbsp;<span class="num" id="8006936">1</span><span class="op" id="8006937">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8006942">Header</span><span class="op" id="8006948">:</span>&nbsp;<span class="ident" id="8006950">Header</span><span class="op" id="8006956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8006962">&#34;Accept&#34;</span><span class="op" id="8006970">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8006982">{</span><span class="string" id="8006983">&#34;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&#34;</span><span class="op" id="8007048">}</span><span class="op" id="8007049">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8007055">&#34;Accept-Charset&#34;</span><span class="op" id="8007071">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="8007075">{</span><span class="string" id="8007076">&#34;ISO-8859-1,utf-8;q=0.7,*;q=0.7&#34;</span><span class="op" id="8007108">}</span><span class="op" id="8007109">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8007115">&#34;Accept-Encoding&#34;</span><span class="op" id="8007132">:</span>&nbsp;&nbsp;<span class="op" id="8007135">{</span><span class="string" id="8007136">&#34;gzip,deflate&#34;</span><span class="op" id="8007150">}</span><span class="op" id="8007151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8007157">&#34;Accept-Language&#34;</span><span class="op" id="8007174">:</span>&nbsp;&nbsp;<span class="op" id="8007177">{</span><span class="string" id="8007178">&#34;en-us,en;q=0.5&#34;</span><span class="op" id="8007194">}</span><span class="op" id="8007195">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8007201">&#34;Keep-Alive&#34;</span><span class="op" id="8007213">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8007221">{</span><span class="string" id="8007222">&#34;300&#34;</span><span class="op" id="8007227">}</span><span class="op" id="8007228">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8007234">&#34;Proxy-Connection&#34;</span><span class="op" id="8007252">:</span>&nbsp;<span class="op" id="8007254">{</span><span class="string" id="8007255">&#34;keep-alive&#34;</span><span class="op" id="8007267">}</span><span class="op" id="8007268">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8007274">&#34;User-Agent&#34;</span><span class="op" id="8007286">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8007294">{</span><span class="string" id="8007295">&#34;Fake&#34;</span><span class="op" id="8007301">}</span><span class="op" id="8007302">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8007307">}</span><span class="op" id="8007308">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007313">Body</span><span class="op" id="8007317">:</span>&nbsp;&nbsp;<span class="ident" id="8007320">nil</span><span class="op" id="8007323">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007328">Close</span><span class="op" id="8007333">:</span>&nbsp;<span class="ident" id="8007335">false</span><span class="op" id="8007340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007345">Host</span><span class="op" id="8007349">:</span>&nbsp;&nbsp;<span class="string" id="8007352">&#34;www.techcrunch.com&#34;</span><span class="op" id="8007372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007377">Form</span><span class="op" id="8007381">:</span>&nbsp;&nbsp;<span class="keyword" id="8007384">map</span><span class="op" id="8007387">[</span><span class="builtintype" id="8007388">string</span><span class="op" id="8007394">]</span><span class="op" id="8007395">[</span><span class="op" id="8007396">]</span><span class="builtintype" id="8007397">string</span><span class="op" id="8007403">{</span><span class="op" id="8007404">}</span><span class="op" id="8007405">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8007409">}</span><span class="op" id="8007410">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007415">WantWrite</span><span class="op" id="8007424">:</span>&nbsp;<span class="string" id="8007426">&#34;GET&nbsp;/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8007447">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8007452">&#34;Host:&nbsp;www.techcrunch.com\r\n&#34;</span>&nbsp;<span class="op" id="8007483">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8007488">&#34;User-Agent:&nbsp;Fake\r\n&#34;</span>&nbsp;<span class="op" id="8007511">+</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8007516">&#34;Accept:&nbsp;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n&#34;</span>&nbsp;<span class="op" id="8007594">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8007599">&#34;Accept-Charset:&nbsp;ISO-8859-1,utf-8;q=0.7,*;q=0.7\r\n&#34;</span>&nbsp;<span class="op" id="8007652">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8007657">&#34;Accept-Encoding:&nbsp;gzip,deflate\r\n&#34;</span>&nbsp;<span class="op" id="8007693">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8007698">&#34;Accept-Language:&nbsp;en-us,en;q=0.5\r\n&#34;</span>&nbsp;<span class="op" id="8007736">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8007741">&#34;Keep-Alive:&nbsp;300\r\n&#34;</span>&nbsp;<span class="op" id="8007763">+</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8007768">&#34;Proxy-Connection:&nbsp;keep-alive\r\n\r\n&#34;</span><span class="op" id="8007806">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8007811">WantProxy</span><span class="op" id="8007820">:</span>&nbsp;<span class="string" id="8007822">&#34;GET&nbsp;http://www.techcrunch.com/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8007868">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8007873">&#34;Host:&nbsp;www.techcrunch.com\r\n&#34;</span>&nbsp;<span class="op" id="8007904">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8007909">&#34;User-Agent:&nbsp;Fake\r\n&#34;</span>&nbsp;<span class="op" id="8007932">+</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8007937">&#34;Accept:&nbsp;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n&#34;</span>&nbsp;<span class="op" id="8008015">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8008020">&#34;Accept-Charset:&nbsp;ISO-8859-1,utf-8;q=0.7,*;q=0.7\r\n&#34;</span>&nbsp;<span class="op" id="8008073">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8008078">&#34;Accept-Encoding:&nbsp;gzip,deflate\r\n&#34;</span>&nbsp;<span class="op" id="8008114">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8008119">&#34;Accept-Language:&nbsp;en-us,en;q=0.5\r\n&#34;</span>&nbsp;<span class="op" id="8008157">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8008162">&#34;Keep-Alive:&nbsp;300\r\n&#34;</span>&nbsp;<span class="op" id="8008184">+</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8008189">&#34;Proxy-Connection:&nbsp;keep-alive\r\n\r\n&#34;</span><span class="op" id="8008227">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8008230">}</span><span class="op" id="8008231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8008234">//&nbsp;HTTP/1.1&nbsp;=&gt;&nbsp;chunked&nbsp;coding;&nbsp;body;&nbsp;empty&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8008286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008290">Req</span><span class="op" id="8008293">:</span>&nbsp;<span class="ident" id="8008295">Request</span><span class="op" id="8008302">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008307">Method</span><span class="op" id="8008313">:</span>&nbsp;<span class="string" id="8008315">&#34;GET&#34;</span><span class="op" id="8008320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008325">URL</span><span class="op" id="8008328">:</span>&nbsp;<span class="op" id="8008330">&amp;</span><span class="ident" id="8008331">url</span><span class="op" id="8008334">.</span><span class="ident" id="8008335">URL</span><span class="op" id="8008338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008344">Scheme</span><span class="op" id="8008350">:</span>&nbsp;<span class="string" id="8008352">&#34;http&#34;</span><span class="op" id="8008358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008364">Host</span><span class="op" id="8008368">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8008372">&#34;www.google.com&#34;</span><span class="op" id="8008388">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008394">Path</span><span class="op" id="8008398">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8008402">&#34;/search&#34;</span><span class="op" id="8008411">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8008416">}</span><span class="op" id="8008417">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008422">ProtoMajor</span><span class="op" id="8008432">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8008440">1</span><span class="op" id="8008441">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008446">ProtoMinor</span><span class="op" id="8008456">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8008464">1</span><span class="op" id="8008465">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008470">Header</span><span class="op" id="8008476">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8008488">Header</span><span class="op" id="8008494">{</span><span class="op" id="8008495">}</span><span class="op" id="8008496">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008501">TransferEncoding</span><span class="op" id="8008517">:</span>&nbsp;<span class="op" id="8008519">[</span><span class="op" id="8008520">]</span><span class="builtintype" id="8008521">string</span><span class="op" id="8008527">{</span><span class="string" id="8008528">&#34;chunked&#34;</span><span class="op" id="8008537">}</span><span class="op" id="8008538">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8008542">}</span><span class="op" id="8008543">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008548">Body</span><span class="op" id="8008552">:</span>&nbsp;<span class="op" id="8008554">[</span><span class="op" id="8008555">]</span><span class="builtintype" id="8008556">byte</span><span class="op" id="8008560">(</span><span class="string" id="8008561">&#34;abcdef&#34;</span><span class="op" id="8008569">)</span><span class="op" id="8008570">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008575">WantWrite</span><span class="op" id="8008584">:</span>&nbsp;<span class="string" id="8008586">&#34;GET&nbsp;/search&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8008613">+</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8008618">&#34;Host:&nbsp;www.google.com\r\n&#34;</span>&nbsp;<span class="op" id="8008645">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8008650">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="8008688">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8008693">&#34;Transfer-Encoding:&nbsp;chunked\r\n\r\n&#34;</span>&nbsp;<span class="op" id="8008730">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008735">chunk</span><span class="op" id="8008740">(</span><span class="string" id="8008741">&#34;abcdef&#34;</span><span class="op" id="8008749">)</span>&nbsp;<span class="op" id="8008751">+</span>&nbsp;<span class="ident" id="8008753">chunk</span><span class="op" id="8008758">(</span><span class="string" id="8008759">&#34;&#34;</span><span class="op" id="8008761">)</span><span class="op" id="8008762">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008767">WantProxy</span><span class="op" id="8008776">:</span>&nbsp;<span class="string" id="8008778">&#34;GET&nbsp;http://www.google.com/search&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8008826">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8008831">&#34;Host:&nbsp;www.google.com\r\n&#34;</span>&nbsp;<span class="op" id="8008858">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8008863">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="8008901">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8008906">&#34;Transfer-Encoding:&nbsp;chunked\r\n\r\n&#34;</span>&nbsp;<span class="op" id="8008943">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8008948">chunk</span><span class="op" id="8008953">(</span><span class="string" id="8008954">&#34;abcdef&#34;</span><span class="op" id="8008962">)</span>&nbsp;<span class="op" id="8008964">+</span>&nbsp;<span class="ident" id="8008966">chunk</span><span class="op" id="8008971">(</span><span class="string" id="8008972">&#34;&#34;</span><span class="op" id="8008974">)</span><span class="op" id="8008975">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8008978">}</span><span class="op" id="8008979">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8008982">//&nbsp;HTTP/1.1&nbsp;POST&nbsp;=&gt;&nbsp;chunked&nbsp;coding;&nbsp;body;&nbsp;empty&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8009039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009043">Req</span><span class="op" id="8009046">:</span>&nbsp;<span class="ident" id="8009048">Request</span><span class="op" id="8009055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009060">Method</span><span class="op" id="8009066">:</span>&nbsp;<span class="string" id="8009068">&#34;POST&#34;</span><span class="op" id="8009074">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009079">URL</span><span class="op" id="8009082">:</span>&nbsp;<span class="op" id="8009084">&amp;</span><span class="ident" id="8009085">url</span><span class="op" id="8009088">.</span><span class="ident" id="8009089">URL</span><span class="op" id="8009092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009098">Scheme</span><span class="op" id="8009104">:</span>&nbsp;<span class="string" id="8009106">&#34;http&#34;</span><span class="op" id="8009112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009118">Host</span><span class="op" id="8009122">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8009126">&#34;www.google.com&#34;</span><span class="op" id="8009142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009148">Path</span><span class="op" id="8009152">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8009156">&#34;/search&#34;</span><span class="op" id="8009165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8009170">}</span><span class="op" id="8009171">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009176">ProtoMajor</span><span class="op" id="8009186">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8009194">1</span><span class="op" id="8009195">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009200">ProtoMinor</span><span class="op" id="8009210">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8009218">1</span><span class="op" id="8009219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009224">Header</span><span class="op" id="8009230">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8009242">Header</span><span class="op" id="8009248">{</span><span class="op" id="8009249">}</span><span class="op" id="8009250">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009255">Close</span><span class="op" id="8009260">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8009273">true</span><span class="op" id="8009277">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009282">TransferEncoding</span><span class="op" id="8009298">:</span>&nbsp;<span class="op" id="8009300">[</span><span class="op" id="8009301">]</span><span class="builtintype" id="8009302">string</span><span class="op" id="8009308">{</span><span class="string" id="8009309">&#34;chunked&#34;</span><span class="op" id="8009318">}</span><span class="op" id="8009319">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8009323">}</span><span class="op" id="8009324">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009329">Body</span><span class="op" id="8009333">:</span>&nbsp;<span class="op" id="8009335">[</span><span class="op" id="8009336">]</span><span class="builtintype" id="8009337">byte</span><span class="op" id="8009341">(</span><span class="string" id="8009342">&#34;abcdef&#34;</span><span class="op" id="8009350">)</span><span class="op" id="8009351">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009356">WantWrite</span><span class="op" id="8009365">:</span>&nbsp;<span class="string" id="8009367">&#34;POST&nbsp;/search&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8009395">+</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8009400">&#34;Host:&nbsp;www.google.com\r\n&#34;</span>&nbsp;<span class="op" id="8009427">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8009432">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="8009470">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8009475">&#34;Connection:&nbsp;close\r\n&#34;</span>&nbsp;<span class="op" id="8009499">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8009504">&#34;Transfer-Encoding:&nbsp;chunked\r\n\r\n&#34;</span>&nbsp;<span class="op" id="8009541">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009546">chunk</span><span class="op" id="8009551">(</span><span class="string" id="8009552">&#34;abcdef&#34;</span><span class="op" id="8009560">)</span>&nbsp;<span class="op" id="8009562">+</span>&nbsp;<span class="ident" id="8009564">chunk</span><span class="op" id="8009569">(</span><span class="string" id="8009570">&#34;&#34;</span><span class="op" id="8009572">)</span><span class="op" id="8009573">,</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009578">WantProxy</span><span class="op" id="8009587">:</span>&nbsp;<span class="string" id="8009589">&#34;POST&nbsp;http://www.google.com/search&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8009638">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8009643">&#34;Host:&nbsp;www.google.com\r\n&#34;</span>&nbsp;<span class="op" id="8009670">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8009675">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="8009713">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8009718">&#34;Connection:&nbsp;close\r\n&#34;</span>&nbsp;<span class="op" id="8009742">+</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8009747">&#34;Transfer-Encoding:&nbsp;chunked\r\n\r\n&#34;</span>&nbsp;<span class="op" id="8009784">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009789">chunk</span><span class="op" id="8009794">(</span><span class="string" id="8009795">&#34;abcdef&#34;</span><span class="op" id="8009803">)</span>&nbsp;<span class="op" id="8009805">+</span>&nbsp;<span class="ident" id="8009807">chunk</span><span class="op" id="8009812">(</span><span class="string" id="8009813">&#34;&#34;</span><span class="op" id="8009815">)</span><span class="op" id="8009816">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8009819">}</span><span class="op" id="8009820">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8009824">//&nbsp;HTTP/1.1&nbsp;POST&nbsp;with&nbsp;Content-Length,&nbsp;no&nbsp;chunking</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8009875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009879">Req</span><span class="op" id="8009882">:</span>&nbsp;<span class="ident" id="8009884">Request</span><span class="op" id="8009891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009896">Method</span><span class="op" id="8009902">:</span>&nbsp;<span class="string" id="8009904">&#34;POST&#34;</span><span class="op" id="8009910">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009915">URL</span><span class="op" id="8009918">:</span>&nbsp;<span class="op" id="8009920">&amp;</span><span class="ident" id="8009921">url</span><span class="op" id="8009924">.</span><span class="ident" id="8009925">URL</span><span class="op" id="8009928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009934">Scheme</span><span class="op" id="8009940">:</span>&nbsp;<span class="string" id="8009942">&#34;http&#34;</span><span class="op" id="8009948">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009954">Host</span><span class="op" id="8009958">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8009962">&#34;www.google.com&#34;</span><span class="op" id="8009978">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009984">Path</span><span class="op" id="8009988">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8009992">&#34;/search&#34;</span><span class="op" id="8010001">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010006">}</span><span class="op" id="8010007">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010012">ProtoMajor</span><span class="op" id="8010022">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8010027">1</span><span class="op" id="8010028">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010033">ProtoMinor</span><span class="op" id="8010043">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8010048">1</span><span class="op" id="8010049">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010054">Header</span><span class="op" id="8010060">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8010069">Header</span><span class="op" id="8010075">{</span><span class="op" id="8010076">}</span><span class="op" id="8010077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010082">Close</span><span class="op" id="8010087">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8010097">true</span><span class="op" id="8010101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010106">ContentLength</span><span class="op" id="8010119">:</span>&nbsp;<span class="num" id="8010121">6</span><span class="op" id="8010122">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010126">}</span><span class="op" id="8010127">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010132">Body</span><span class="op" id="8010136">:</span>&nbsp;<span class="op" id="8010138">[</span><span class="op" id="8010139">]</span><span class="builtintype" id="8010140">byte</span><span class="op" id="8010144">(</span><span class="string" id="8010145">&#34;abcdef&#34;</span><span class="op" id="8010153">)</span><span class="op" id="8010154">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010159">WantWrite</span><span class="op" id="8010168">:</span>&nbsp;<span class="string" id="8010170">&#34;POST&nbsp;/search&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8010198">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8010203">&#34;Host:&nbsp;www.google.com\r\n&#34;</span>&nbsp;<span class="op" id="8010230">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8010235">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="8010273">+</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8010278">&#34;Connection:&nbsp;close\r\n&#34;</span>&nbsp;<span class="op" id="8010302">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8010307">&#34;Content-Length:&nbsp;6\r\n&#34;</span>&nbsp;<span class="op" id="8010331">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8010336">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="8010343">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8010348">&#34;abcdef&#34;</span><span class="op" id="8010356">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010361">WantProxy</span><span class="op" id="8010370">:</span>&nbsp;<span class="string" id="8010372">&#34;POST&nbsp;http://www.google.com/search&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8010421">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8010426">&#34;Host:&nbsp;www.google.com\r\n&#34;</span>&nbsp;<span class="op" id="8010453">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8010458">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="8010496">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8010501">&#34;Connection:&nbsp;close\r\n&#34;</span>&nbsp;<span class="op" id="8010525">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8010530">&#34;Content-Length:&nbsp;6\r\n&#34;</span>&nbsp;<span class="op" id="8010554">+</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8010559">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="8010566">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8010571">&#34;abcdef&#34;</span><span class="op" id="8010579">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010582">}</span><span class="op" id="8010583">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8010587">//&nbsp;HTTP/1.1&nbsp;POST&nbsp;with&nbsp;Content-Length&nbsp;in&nbsp;headers</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010640">Req</span><span class="op" id="8010643">:</span>&nbsp;<span class="ident" id="8010645">Request</span><span class="op" id="8010652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010657">Method</span><span class="op" id="8010663">:</span>&nbsp;<span class="string" id="8010665">&#34;POST&#34;</span><span class="op" id="8010671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010676">URL</span><span class="op" id="8010679">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8010684">mustParseURL</span><span class="op" id="8010696">(</span><span class="string" id="8010697">&#34;http://example.com/&#34;</span><span class="op" id="8010718">)</span><span class="op" id="8010719">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010724">Host</span><span class="op" id="8010728">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8010732">&#34;example.com&#34;</span><span class="op" id="8010745">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010750">Header</span><span class="op" id="8010756">:</span>&nbsp;<span class="ident" id="8010758">Header</span><span class="op" id="8010764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8010770">&#34;Content-Length&#34;</span><span class="op" id="8010786">:</span>&nbsp;<span class="op" id="8010788">[</span><span class="op" id="8010789">]</span><span class="builtintype" id="8010790">string</span><span class="op" id="8010796">{</span><span class="string" id="8010797">&#34;10&#34;</span><span class="op" id="8010801">}</span><span class="op" id="8010802">,</span>&nbsp;<span class="comment" id="8010804">//&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010818">}</span><span class="op" id="8010819">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010824">ContentLength</span><span class="op" id="8010837">:</span>&nbsp;<span class="num" id="8010839">6</span><span class="op" id="8010840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010844">}</span><span class="op" id="8010845">,</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010850">Body</span><span class="op" id="8010854">:</span>&nbsp;<span class="op" id="8010856">[</span><span class="op" id="8010857">]</span><span class="builtintype" id="8010858">byte</span><span class="op" id="8010862">(</span><span class="string" id="8010863">&#34;abcdef&#34;</span><span class="op" id="8010871">)</span><span class="op" id="8010872">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010877">WantWrite</span><span class="op" id="8010886">:</span>&nbsp;<span class="string" id="8010888">&#34;POST&nbsp;/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8010910">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8010915">&#34;Host:&nbsp;example.com\r\n&#34;</span>&nbsp;<span class="op" id="8010939">+</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8010944">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="8010982">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8010987">&#34;Content-Length:&nbsp;6\r\n&#34;</span>&nbsp;<span class="op" id="8011011">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8011016">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="8011023">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8011028">&#34;abcdef&#34;</span><span class="op" id="8011036">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011041">WantProxy</span><span class="op" id="8011050">:</span>&nbsp;<span class="string" id="8011052">&#34;POST&nbsp;http://example.com/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8011092">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8011097">&#34;Host:&nbsp;example.com\r\n&#34;</span>&nbsp;<span class="op" id="8011121">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8011126">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="8011164">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8011169">&#34;Content-Length:&nbsp;6\r\n&#34;</span>&nbsp;<span class="op" id="8011193">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8011198">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="8011205">+</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8011210">&#34;abcdef&#34;</span><span class="op" id="8011218">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8011221">}</span><span class="op" id="8011222">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8011226">//&nbsp;default&nbsp;to&nbsp;HTTP/1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8011250">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011254">Req</span><span class="op" id="8011257">:</span>&nbsp;<span class="ident" id="8011259">Request</span><span class="op" id="8011266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011271">Method</span><span class="op" id="8011277">:</span>&nbsp;<span class="string" id="8011279">&#34;GET&#34;</span><span class="op" id="8011284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011289">URL</span><span class="op" id="8011292">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8011297">mustParseURL</span><span class="op" id="8011309">(</span><span class="string" id="8011310">&#34;/search&#34;</span><span class="op" id="8011319">)</span><span class="op" id="8011320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011325">Host</span><span class="op" id="8011329">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8011333">&#34;www.google.com&#34;</span><span class="op" id="8011349">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8011353">}</span><span class="op" id="8011354">,</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011359">WantWrite</span><span class="op" id="8011368">:</span>&nbsp;<span class="string" id="8011370">&#34;GET&nbsp;/search&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8011397">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8011402">&#34;Host:&nbsp;www.google.com\r\n&#34;</span>&nbsp;<span class="op" id="8011429">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8011434">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="8011472">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8011477">&#34;\r\n&#34;</span><span class="op" id="8011483">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8011486">}</span><span class="op" id="8011487">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8011491">//&nbsp;Request&nbsp;with&nbsp;a&nbsp;0&nbsp;ContentLength&nbsp;and&nbsp;a&nbsp;0&nbsp;byte&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8011545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011549">Req</span><span class="op" id="8011552">:</span>&nbsp;<span class="ident" id="8011554">Request</span><span class="op" id="8011561">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011566">Method</span><span class="op" id="8011572">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8011581">&#34;POST&#34;</span><span class="op" id="8011587">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011592">URL</span><span class="op" id="8011595">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8011607">mustParseURL</span><span class="op" id="8011619">(</span><span class="string" id="8011620">&#34;/&#34;</span><span class="op" id="8011623">)</span><span class="op" id="8011624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011629">Host</span><span class="op" id="8011633">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8011644">&#34;example.com&#34;</span><span class="op" id="8011657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011662">ProtoMajor</span><span class="op" id="8011672">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8011677">1</span><span class="op" id="8011678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011683">ProtoMinor</span><span class="op" id="8011693">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8011698">1</span><span class="op" id="8011699">,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011704">ContentLength</span><span class="op" id="8011717">:</span>&nbsp;<span class="num" id="8011719">0</span><span class="op" id="8011720">,</span>&nbsp;<span class="comment" id="8011722">//&nbsp;as&nbsp;if&nbsp;unset&nbsp;by&nbsp;user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8011747">}</span><span class="op" id="8011748">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011753">Body</span><span class="op" id="8011757">:</span>&nbsp;<span class="keyword" id="8011759">func</span><span class="op" id="8011763">(</span><span class="op" id="8011764">)</span>&nbsp;<span class="ident" id="8011766">io</span><span class="op" id="8011768">.</span><span class="ident" id="8011769">ReadCloser</span>&nbsp;<span class="op" id="8011780">{</span>&nbsp;<span class="keyword" id="8011782">return</span>&nbsp;<span class="ident" id="8011789">ioutil</span><span class="op" id="8011795">.</span><span class="ident" id="8011796">NopCloser</span><span class="op" id="8011805">(</span><span class="ident" id="8011806">io</span><span class="op" id="8011808">.</span><span class="ident" id="8011809">LimitReader</span><span class="op" id="8011820">(</span><span class="ident" id="8011821">strings</span><span class="op" id="8011828">.</span><span class="ident" id="8011829">NewReader</span><span class="op" id="8011838">(</span><span class="string" id="8011839">&#34;xx&#34;</span><span class="op" id="8011843">)</span><span class="op" id="8011844">,</span>&nbsp;<span class="num" id="8011846">0</span><span class="op" id="8011847">)</span><span class="op" id="8011848">)</span>&nbsp;<span class="op" id="8011850">}</span><span class="op" id="8011851">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8011856">//&nbsp;RFC&nbsp;2616&nbsp;Section&nbsp;14.13&nbsp;says&nbsp;Content-Length&nbsp;should&nbsp;be&nbsp;specified</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8011924">//&nbsp;unless&nbsp;body&nbsp;is&nbsp;prohibited&nbsp;by&nbsp;the&nbsp;request&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8011978">//&nbsp;Also,&nbsp;nginx&nbsp;expects&nbsp;it&nbsp;for&nbsp;POST&nbsp;and&nbsp;PUT.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012024">WantWrite</span><span class="op" id="8012033">:</span>&nbsp;<span class="string" id="8012035">&#34;POST&nbsp;/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8012057">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8012062">&#34;Host:&nbsp;example.com\r\n&#34;</span>&nbsp;<span class="op" id="8012086">+</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8012091">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="8012129">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8012134">&#34;Content-Length:&nbsp;0\r\n&#34;</span>&nbsp;<span class="op" id="8012158">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8012163">&#34;\r\n&#34;</span><span class="op" id="8012169">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012174">WantProxy</span><span class="op" id="8012183">:</span>&nbsp;<span class="string" id="8012185">&#34;POST&nbsp;/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8012207">+</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8012212">&#34;Host:&nbsp;example.com\r\n&#34;</span>&nbsp;<span class="op" id="8012236">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8012241">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="8012279">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8012284">&#34;Content-Length:&nbsp;0\r\n&#34;</span>&nbsp;<span class="op" id="8012308">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8012313">&#34;\r\n&#34;</span><span class="op" id="8012319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012322">}</span><span class="op" id="8012323">,</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8012327">//&nbsp;Request&nbsp;with&nbsp;a&nbsp;0&nbsp;ContentLength&nbsp;and&nbsp;a&nbsp;1&nbsp;byte&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012385">Req</span><span class="op" id="8012388">:</span>&nbsp;<span class="ident" id="8012390">Request</span><span class="op" id="8012397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012402">Method</span><span class="op" id="8012408">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8012417">&#34;POST&#34;</span><span class="op" id="8012423">,</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012428">URL</span><span class="op" id="8012431">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8012443">mustParseURL</span><span class="op" id="8012455">(</span><span class="string" id="8012456">&#34;/&#34;</span><span class="op" id="8012459">)</span><span class="op" id="8012460">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012465">Host</span><span class="op" id="8012469">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8012480">&#34;example.com&#34;</span><span class="op" id="8012493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012498">ProtoMajor</span><span class="op" id="8012508">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8012513">1</span><span class="op" id="8012514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012519">ProtoMinor</span><span class="op" id="8012529">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8012534">1</span><span class="op" id="8012535">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012540">ContentLength</span><span class="op" id="8012553">:</span>&nbsp;<span class="num" id="8012555">0</span><span class="op" id="8012556">,</span>&nbsp;<span class="comment" id="8012558">//&nbsp;as&nbsp;if&nbsp;unset&nbsp;by&nbsp;user</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012583">}</span><span class="op" id="8012584">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012589">Body</span><span class="op" id="8012593">:</span>&nbsp;<span class="keyword" id="8012595">func</span><span class="op" id="8012599">(</span><span class="op" id="8012600">)</span>&nbsp;<span class="ident" id="8012602">io</span><span class="op" id="8012604">.</span><span class="ident" id="8012605">ReadCloser</span>&nbsp;<span class="op" id="8012616">{</span>&nbsp;<span class="keyword" id="8012618">return</span>&nbsp;<span class="ident" id="8012625">ioutil</span><span class="op" id="8012631">.</span><span class="ident" id="8012632">NopCloser</span><span class="op" id="8012641">(</span><span class="ident" id="8012642">io</span><span class="op" id="8012644">.</span><span class="ident" id="8012645">LimitReader</span><span class="op" id="8012656">(</span><span class="ident" id="8012657">strings</span><span class="op" id="8012664">.</span><span class="ident" id="8012665">NewReader</span><span class="op" id="8012674">(</span><span class="string" id="8012675">&#34;xx&#34;</span><span class="op" id="8012679">)</span><span class="op" id="8012680">,</span>&nbsp;<span class="num" id="8012682">1</span><span class="op" id="8012683">)</span><span class="op" id="8012684">)</span>&nbsp;<span class="op" id="8012686">}</span><span class="op" id="8012687">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012692">WantWrite</span><span class="op" id="8012701">:</span>&nbsp;<span class="string" id="8012703">&#34;POST&nbsp;/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8012725">+</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8012730">&#34;Host:&nbsp;example.com\r\n&#34;</span>&nbsp;<span class="op" id="8012754">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8012759">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="8012797">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8012802">&#34;Transfer-Encoding:&nbsp;chunked\r\n\r\n&#34;</span>&nbsp;<span class="op" id="8012839">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012844">chunk</span><span class="op" id="8012849">(</span><span class="string" id="8012850">&#34;x&#34;</span><span class="op" id="8012853">)</span>&nbsp;<span class="op" id="8012855">+</span>&nbsp;<span class="ident" id="8012857">chunk</span><span class="op" id="8012862">(</span><span class="string" id="8012863">&#34;&#34;</span><span class="op" id="8012865">)</span><span class="op" id="8012866">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012871">WantProxy</span><span class="op" id="8012880">:</span>&nbsp;<span class="string" id="8012882">&#34;POST&nbsp;/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8012904">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8012909">&#34;Host:&nbsp;example.com\r\n&#34;</span>&nbsp;<span class="op" id="8012933">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8012938">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="8012976">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8012981">&#34;Transfer-Encoding:&nbsp;chunked\r\n\r\n&#34;</span>&nbsp;<span class="op" id="8013018">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013023">chunk</span><span class="op" id="8013028">(</span><span class="string" id="8013029">&#34;x&#34;</span><span class="op" id="8013032">)</span>&nbsp;<span class="op" id="8013034">+</span>&nbsp;<span class="ident" id="8013036">chunk</span><span class="op" id="8013041">(</span><span class="string" id="8013042">&#34;&#34;</span><span class="op" id="8013044">)</span><span class="op" id="8013045">,</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013048">}</span><span class="op" id="8013049">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8013053">//&nbsp;Request&nbsp;with&nbsp;a&nbsp;ContentLength&nbsp;of&nbsp;10&nbsp;but&nbsp;a&nbsp;5&nbsp;byte&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013115">Req</span><span class="op" id="8013118">:</span>&nbsp;<span class="ident" id="8013120">Request</span><span class="op" id="8013127">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013132">Method</span><span class="op" id="8013138">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8013147">&#34;POST&#34;</span><span class="op" id="8013153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013158">URL</span><span class="op" id="8013161">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8013173">mustParseURL</span><span class="op" id="8013185">(</span><span class="string" id="8013186">&#34;/&#34;</span><span class="op" id="8013189">)</span><span class="op" id="8013190">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013195">Host</span><span class="op" id="8013199">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8013210">&#34;example.com&#34;</span><span class="op" id="8013223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013228">ProtoMajor</span><span class="op" id="8013238">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8013243">1</span><span class="op" id="8013244">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013249">ProtoMinor</span><span class="op" id="8013259">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8013264">1</span><span class="op" id="8013265">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013270">ContentLength</span><span class="op" id="8013283">:</span>&nbsp;<span class="num" id="8013285">10</span><span class="op" id="8013287">,</span>&nbsp;<span class="comment" id="8013289">//&nbsp;but&nbsp;we&#39;re&nbsp;going&nbsp;to&nbsp;send&nbsp;only&nbsp;5&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013331">}</span><span class="op" id="8013332">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013336">Body</span><span class="op" id="8013340">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8013347">[</span><span class="op" id="8013348">]</span><span class="builtintype" id="8013349">byte</span><span class="op" id="8013353">(</span><span class="string" id="8013354">&#34;12345&#34;</span><span class="op" id="8013361">)</span><span class="op" id="8013362">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013366">WantError</span><span class="op" id="8013375">:</span>&nbsp;<span class="ident" id="8013377">errors</span><span class="op" id="8013383">.</span><span class="ident" id="8013384">New</span><span class="op" id="8013387">(</span><span class="string" id="8013388">&#34;http:&nbsp;ContentLength=10&nbsp;with&nbsp;Body&nbsp;length&nbsp;5&#34;</span><span class="op" id="8013431">)</span><span class="op" id="8013432">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013435">}</span><span class="op" id="8013436">,</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8013440">//&nbsp;Request&nbsp;with&nbsp;a&nbsp;ContentLength&nbsp;of&nbsp;4&nbsp;but&nbsp;an&nbsp;8&nbsp;byte&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013502">Req</span><span class="op" id="8013505">:</span>&nbsp;<span class="ident" id="8013507">Request</span><span class="op" id="8013514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013519">Method</span><span class="op" id="8013525">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8013534">&#34;POST&#34;</span><span class="op" id="8013540">,</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013545">URL</span><span class="op" id="8013548">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8013560">mustParseURL</span><span class="op" id="8013572">(</span><span class="string" id="8013573">&#34;/&#34;</span><span class="op" id="8013576">)</span><span class="op" id="8013577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013582">Host</span><span class="op" id="8013586">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8013597">&#34;example.com&#34;</span><span class="op" id="8013610">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013615">ProtoMajor</span><span class="op" id="8013625">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8013630">1</span><span class="op" id="8013631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013636">ProtoMinor</span><span class="op" id="8013646">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8013651">1</span><span class="op" id="8013652">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013657">ContentLength</span><span class="op" id="8013670">:</span>&nbsp;<span class="num" id="8013672">4</span><span class="op" id="8013673">,</span>&nbsp;<span class="comment" id="8013675">//&nbsp;but&nbsp;we&#39;re&nbsp;going&nbsp;to&nbsp;try&nbsp;to&nbsp;send&nbsp;8&nbsp;bytes</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013719">}</span><span class="op" id="8013720">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013724">Body</span><span class="op" id="8013728">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8013735">[</span><span class="op" id="8013736">]</span><span class="builtintype" id="8013737">byte</span><span class="op" id="8013741">(</span><span class="string" id="8013742">&#34;12345678&#34;</span><span class="op" id="8013752">)</span><span class="op" id="8013753">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013757">WantError</span><span class="op" id="8013766">:</span>&nbsp;<span class="ident" id="8013768">errors</span><span class="op" id="8013774">.</span><span class="ident" id="8013775">New</span><span class="op" id="8013778">(</span><span class="string" id="8013779">&#34;http:&nbsp;ContentLength=4&nbsp;with&nbsp;Body&nbsp;length&nbsp;8&#34;</span><span class="op" id="8013821">)</span><span class="op" id="8013822">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013825">}</span><span class="op" id="8013826">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8013830">//&nbsp;Request&nbsp;with&nbsp;a&nbsp;5&nbsp;ContentLength&nbsp;and&nbsp;nil&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013883">Req</span><span class="op" id="8013886">:</span>&nbsp;<span class="ident" id="8013888">Request</span><span class="op" id="8013895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013900">Method</span><span class="op" id="8013906">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8013915">&#34;POST&#34;</span><span class="op" id="8013921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013926">URL</span><span class="op" id="8013929">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8013941">mustParseURL</span><span class="op" id="8013953">(</span><span class="string" id="8013954">&#34;/&#34;</span><span class="op" id="8013957">)</span><span class="op" id="8013958">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013963">Host</span><span class="op" id="8013967">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8013978">&#34;example.com&#34;</span><span class="op" id="8013991">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013996">ProtoMajor</span><span class="op" id="8014006">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8014011">1</span><span class="op" id="8014012">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014017">ProtoMinor</span><span class="op" id="8014027">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8014032">1</span><span class="op" id="8014033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014038">ContentLength</span><span class="op" id="8014051">:</span>&nbsp;<span class="num" id="8014053">5</span><span class="op" id="8014054">,</span>&nbsp;<span class="comment" id="8014056">//&nbsp;but&nbsp;we&#39;ll&nbsp;omit&nbsp;the&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014085">}</span><span class="op" id="8014086">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014090">WantError</span><span class="op" id="8014099">:</span>&nbsp;<span class="ident" id="8014101">errors</span><span class="op" id="8014107">.</span><span class="ident" id="8014108">New</span><span class="op" id="8014111">(</span><span class="string" id="8014112">&#34;http:&nbsp;Request.ContentLength=5&nbsp;with&nbsp;nil&nbsp;Body&#34;</span><span class="op" id="8014157">)</span><span class="op" id="8014158">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014161">}</span><span class="op" id="8014162">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8014166">//&nbsp;Request&nbsp;with&nbsp;a&nbsp;0&nbsp;ContentLength&nbsp;and&nbsp;a&nbsp;body&nbsp;with&nbsp;1&nbsp;byte&nbsp;content&nbsp;and&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014246">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014250">Req</span><span class="op" id="8014253">:</span>&nbsp;<span class="ident" id="8014255">Request</span><span class="op" id="8014262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014267">Method</span><span class="op" id="8014273">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8014282">&#34;POST&#34;</span><span class="op" id="8014288">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014293">URL</span><span class="op" id="8014296">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8014308">mustParseURL</span><span class="op" id="8014320">(</span><span class="string" id="8014321">&#34;/&#34;</span><span class="op" id="8014324">)</span><span class="op" id="8014325">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014330">Host</span><span class="op" id="8014334">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8014345">&#34;example.com&#34;</span><span class="op" id="8014358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014363">ProtoMajor</span><span class="op" id="8014373">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8014378">1</span><span class="op" id="8014379">,</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014384">ProtoMinor</span><span class="op" id="8014394">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8014399">1</span><span class="op" id="8014400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014405">ContentLength</span><span class="op" id="8014418">:</span>&nbsp;<span class="num" id="8014420">0</span><span class="op" id="8014421">,</span>&nbsp;<span class="comment" id="8014423">//&nbsp;as&nbsp;if&nbsp;unset&nbsp;by&nbsp;user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014448">}</span><span class="op" id="8014449">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014454">Body</span><span class="op" id="8014458">:</span>&nbsp;<span class="keyword" id="8014460">func</span><span class="op" id="8014464">(</span><span class="op" id="8014465">)</span>&nbsp;<span class="ident" id="8014467">io</span><span class="op" id="8014469">.</span><span class="ident" id="8014470">ReadCloser</span>&nbsp;<span class="op" id="8014481">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014486">err</span>&nbsp;<span class="op" id="8014490">:=</span>&nbsp;<span class="ident" id="8014493">errors</span><span class="op" id="8014499">.</span><span class="ident" id="8014500">New</span><span class="op" id="8014503">(</span><span class="string" id="8014504">&#34;Custom&nbsp;reader&nbsp;error&#34;</span><span class="op" id="8014525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014530">errReader</span>&nbsp;<span class="op" id="8014540">:=</span>&nbsp;<span class="op" id="8014543">&amp;</span><span class="ident" id="8014544">errorReader</span><span class="op" id="8014555">{</span><span class="ident" id="8014556">err</span><span class="op" id="8014559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014564">return</span>&nbsp;<span class="ident" id="8014571">ioutil</span><span class="op" id="8014577">.</span><span class="ident" id="8014578">NopCloser</span><span class="op" id="8014587">(</span><span class="ident" id="8014588">io</span><span class="op" id="8014590">.</span><span class="ident" id="8014591">MultiReader</span><span class="op" id="8014602">(</span><span class="ident" id="8014603">strings</span><span class="op" id="8014610">.</span><span class="ident" id="8014611">NewReader</span><span class="op" id="8014620">(</span><span class="string" id="8014621">&#34;x&#34;</span><span class="op" id="8014624">)</span><span class="op" id="8014625">,</span>&nbsp;<span class="ident" id="8014627">errReader</span><span class="op" id="8014636">)</span><span class="op" id="8014637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014641">}</span><span class="op" id="8014642">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014647">WantError</span><span class="op" id="8014656">:</span>&nbsp;<span class="ident" id="8014658">errors</span><span class="op" id="8014664">.</span><span class="ident" id="8014665">New</span><span class="op" id="8014668">(</span><span class="string" id="8014669">&#34;Custom&nbsp;reader&nbsp;error&#34;</span><span class="op" id="8014690">)</span><span class="op" id="8014691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014694">}</span><span class="op" id="8014695">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8014699">//&nbsp;Request&nbsp;with&nbsp;a&nbsp;0&nbsp;ContentLength&nbsp;and&nbsp;a&nbsp;body&nbsp;without&nbsp;content&nbsp;and&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014775">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014779">Req</span><span class="op" id="8014782">:</span>&nbsp;<span class="ident" id="8014784">Request</span><span class="op" id="8014791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014796">Method</span><span class="op" id="8014802">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8014811">&#34;POST&#34;</span><span class="op" id="8014817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014822">URL</span><span class="op" id="8014825">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8014837">mustParseURL</span><span class="op" id="8014849">(</span><span class="string" id="8014850">&#34;/&#34;</span><span class="op" id="8014853">)</span><span class="op" id="8014854">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014859">Host</span><span class="op" id="8014863">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8014874">&#34;example.com&#34;</span><span class="op" id="8014887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014892">ProtoMajor</span><span class="op" id="8014902">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8014907">1</span><span class="op" id="8014908">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014913">ProtoMinor</span><span class="op" id="8014923">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8014928">1</span><span class="op" id="8014929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014934">ContentLength</span><span class="op" id="8014947">:</span>&nbsp;<span class="num" id="8014949">0</span><span class="op" id="8014950">,</span>&nbsp;<span class="comment" id="8014952">//&nbsp;as&nbsp;if&nbsp;unset&nbsp;by&nbsp;user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014977">}</span><span class="op" id="8014978">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014983">Body</span><span class="op" id="8014987">:</span>&nbsp;<span class="keyword" id="8014989">func</span><span class="op" id="8014993">(</span><span class="op" id="8014994">)</span>&nbsp;<span class="ident" id="8014996">io</span><span class="op" id="8014998">.</span><span class="ident" id="8014999">ReadCloser</span>&nbsp;<span class="op" id="8015010">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015015">err</span>&nbsp;<span class="op" id="8015019">:=</span>&nbsp;<span class="ident" id="8015022">errors</span><span class="op" id="8015028">.</span><span class="ident" id="8015029">New</span><span class="op" id="8015032">(</span><span class="string" id="8015033">&#34;Custom&nbsp;reader&nbsp;error&#34;</span><span class="op" id="8015054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015059">errReader</span>&nbsp;<span class="op" id="8015069">:=</span>&nbsp;<span class="op" id="8015072">&amp;</span><span class="ident" id="8015073">errorReader</span><span class="op" id="8015084">{</span><span class="ident" id="8015085">err</span><span class="op" id="8015088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015093">return</span>&nbsp;<span class="ident" id="8015100">ioutil</span><span class="op" id="8015106">.</span><span class="ident" id="8015107">NopCloser</span><span class="op" id="8015116">(</span><span class="ident" id="8015117">errReader</span><span class="op" id="8015126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015130">}</span><span class="op" id="8015131">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015136">WantError</span><span class="op" id="8015145">:</span>&nbsp;<span class="ident" id="8015147">errors</span><span class="op" id="8015153">.</span><span class="ident" id="8015154">New</span><span class="op" id="8015157">(</span><span class="string" id="8015158">&#34;Custom&nbsp;reader&nbsp;error&#34;</span><span class="op" id="8015179">)</span><span class="op" id="8015180">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015183">}</span><span class="op" id="8015184">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8015188">//&nbsp;Verify&nbsp;that&nbsp;DumpRequest&nbsp;preserves&nbsp;the&nbsp;HTTP&nbsp;version&nbsp;number,&nbsp;doesn&#39;t&nbsp;add&nbsp;a&nbsp;Host,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8015271">//&nbsp;and&nbsp;doesn&#39;t&nbsp;add&nbsp;a&nbsp;User-Agent.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015309">Req</span><span class="op" id="8015312">:</span>&nbsp;<span class="ident" id="8015314">Request</span><span class="op" id="8015321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015326">Method</span><span class="op" id="8015332">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8015338">&#34;GET&#34;</span><span class="op" id="8015343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015348">URL</span><span class="op" id="8015351">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8015360">mustParseURL</span><span class="op" id="8015372">(</span><span class="string" id="8015373">&#34;/foo&#34;</span><span class="op" id="8015379">)</span><span class="op" id="8015380">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015385">ProtoMajor</span><span class="op" id="8015395">:</span>&nbsp;<span class="num" id="8015397">1</span><span class="op" id="8015398">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015403">ProtoMinor</span><span class="op" id="8015413">:</span>&nbsp;<span class="num" id="8015415">0</span><span class="op" id="8015416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015421">Header</span><span class="op" id="8015427">:</span>&nbsp;<span class="ident" id="8015429">Header</span><span class="op" id="8015435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8015441">&#34;X-Foo&#34;</span><span class="op" id="8015448">:</span>&nbsp;<span class="op" id="8015450">[</span><span class="op" id="8015451">]</span><span class="builtintype" id="8015452">string</span><span class="op" id="8015458">{</span><span class="string" id="8015459">&#34;X-Bar&#34;</span><span class="op" id="8015466">}</span><span class="op" id="8015467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015472">}</span><span class="op" id="8015473">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015477">}</span><span class="op" id="8015478">,</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015483">WantWrite</span><span class="op" id="8015492">:</span>&nbsp;<span class="string" id="8015494">&#34;GET&nbsp;/foo&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8015518">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8015523">&#34;Host:&nbsp;\r\n&#34;</span>&nbsp;<span class="op" id="8015536">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8015541">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="8015579">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8015584">&#34;X-Foo:&nbsp;X-Bar\r\n\r\n&#34;</span><span class="op" id="8015606">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015609">}</span><span class="op" id="8015610">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8015614">//&nbsp;If&nbsp;no&nbsp;Request.Host&nbsp;and&nbsp;no&nbsp;Request.URL.Host,&nbsp;we&nbsp;send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8015670">//&nbsp;an&nbsp;empty&nbsp;Host&nbsp;header,&nbsp;and&nbsp;don&#39;t&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8015710">//&nbsp;Request.Header[&#34;Host&#34;].&nbsp;This&nbsp;is&nbsp;just&nbsp;testing&nbsp;that</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8015764">//&nbsp;we&nbsp;don&#39;t&nbsp;change&nbsp;Go&nbsp;1.0&nbsp;behavior.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015805">Req</span><span class="op" id="8015808">:</span>&nbsp;<span class="ident" id="8015810">Request</span><span class="op" id="8015817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015822">Method</span><span class="op" id="8015828">:</span>&nbsp;<span class="string" id="8015830">&#34;GET&#34;</span><span class="op" id="8015835">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015840">Host</span><span class="op" id="8015844">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8015848">&#34;&#34;</span><span class="op" id="8015850">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015855">URL</span><span class="op" id="8015858">:</span>&nbsp;<span class="op" id="8015860">&amp;</span><span class="ident" id="8015861">url</span><span class="op" id="8015864">.</span><span class="ident" id="8015865">URL</span><span class="op" id="8015868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015874">Scheme</span><span class="op" id="8015880">:</span>&nbsp;<span class="string" id="8015882">&#34;http&#34;</span><span class="op" id="8015888">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015894">Host</span><span class="op" id="8015898">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8015902">&#34;&#34;</span><span class="op" id="8015904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015910">Path</span><span class="op" id="8015914">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8015918">&#34;/search&#34;</span><span class="op" id="8015927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015932">}</span><span class="op" id="8015933">,</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015938">ProtoMajor</span><span class="op" id="8015948">:</span>&nbsp;<span class="num" id="8015950">1</span><span class="op" id="8015951">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015956">ProtoMinor</span><span class="op" id="8015966">:</span>&nbsp;<span class="num" id="8015968">1</span><span class="op" id="8015969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015974">Header</span><span class="op" id="8015980">:</span>&nbsp;<span class="ident" id="8015982">Header</span><span class="op" id="8015988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8015994">&#34;Host&#34;</span><span class="op" id="8016000">:</span>&nbsp;<span class="op" id="8016002">[</span><span class="op" id="8016003">]</span><span class="builtintype" id="8016004">string</span><span class="op" id="8016010">{</span><span class="string" id="8016011">&#34;bad.example.com&#34;</span><span class="op" id="8016028">}</span><span class="op" id="8016029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016034">}</span><span class="op" id="8016035">,</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016039">}</span><span class="op" id="8016040">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016045">WantWrite</span><span class="op" id="8016054">:</span>&nbsp;<span class="string" id="8016056">&#34;GET&nbsp;/search&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8016083">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8016088">&#34;Host:&nbsp;\r\n&#34;</span>&nbsp;<span class="op" id="8016101">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8016106">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n\r\n&#34;</span><span class="op" id="8016147">,</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016150">}</span><span class="op" id="8016151">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8016155">//&nbsp;Opaque&nbsp;test&nbsp;#1&nbsp;from&nbsp;golang.org/issue/4860</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016205">Req</span><span class="op" id="8016208">:</span>&nbsp;<span class="ident" id="8016210">Request</span><span class="op" id="8016217">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016222">Method</span><span class="op" id="8016228">:</span>&nbsp;<span class="string" id="8016230">&#34;GET&#34;</span><span class="op" id="8016235">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016240">URL</span><span class="op" id="8016243">:</span>&nbsp;<span class="op" id="8016245">&amp;</span><span class="ident" id="8016246">url</span><span class="op" id="8016249">.</span><span class="ident" id="8016250">URL</span><span class="op" id="8016253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016259">Scheme</span><span class="op" id="8016265">:</span>&nbsp;<span class="string" id="8016267">&#34;http&#34;</span><span class="op" id="8016273">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016279">Host</span><span class="op" id="8016283">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8016287">&#34;www.google.com&#34;</span><span class="op" id="8016303">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016309">Opaque</span><span class="op" id="8016315">:</span>&nbsp;<span class="string" id="8016317">&#34;/%2F/%2F/&#34;</span><span class="op" id="8016328">,</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016333">}</span><span class="op" id="8016334">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016339">ProtoMajor</span><span class="op" id="8016349">:</span>&nbsp;<span class="num" id="8016351">1</span><span class="op" id="8016352">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016357">ProtoMinor</span><span class="op" id="8016367">:</span>&nbsp;<span class="num" id="8016369">1</span><span class="op" id="8016370">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016375">Header</span><span class="op" id="8016381">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8016387">Header</span><span class="op" id="8016393">{</span><span class="op" id="8016394">}</span><span class="op" id="8016395">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016399">}</span><span class="op" id="8016400">,</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016405">WantWrite</span><span class="op" id="8016414">:</span>&nbsp;<span class="string" id="8016416">&#34;GET&nbsp;/%2F/%2F/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8016445">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8016450">&#34;Host:&nbsp;www.google.com\r\n&#34;</span>&nbsp;<span class="op" id="8016477">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8016482">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n\r\n&#34;</span><span class="op" id="8016523">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016526">}</span><span class="op" id="8016527">,</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8016531">//&nbsp;Opaque&nbsp;test&nbsp;#2&nbsp;from&nbsp;golang.org/issue/4860</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016581">Req</span><span class="op" id="8016584">:</span>&nbsp;<span class="ident" id="8016586">Request</span><span class="op" id="8016593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016598">Method</span><span class="op" id="8016604">:</span>&nbsp;<span class="string" id="8016606">&#34;GET&#34;</span><span class="op" id="8016611">,</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016616">URL</span><span class="op" id="8016619">:</span>&nbsp;<span class="op" id="8016621">&amp;</span><span class="ident" id="8016622">url</span><span class="op" id="8016625">.</span><span class="ident" id="8016626">URL</span><span class="op" id="8016629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016635">Scheme</span><span class="op" id="8016641">:</span>&nbsp;<span class="string" id="8016643">&#34;http&#34;</span><span class="op" id="8016649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016655">Host</span><span class="op" id="8016659">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8016663">&#34;x.google.com&#34;</span><span class="op" id="8016677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016683">Opaque</span><span class="op" id="8016689">:</span>&nbsp;<span class="string" id="8016691">&#34;//y.google.com/%2F/%2F/&#34;</span><span class="op" id="8016716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016721">}</span><span class="op" id="8016722">,</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016727">ProtoMajor</span><span class="op" id="8016737">:</span>&nbsp;<span class="num" id="8016739">1</span><span class="op" id="8016740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016745">ProtoMinor</span><span class="op" id="8016755">:</span>&nbsp;<span class="num" id="8016757">1</span><span class="op" id="8016758">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016763">Header</span><span class="op" id="8016769">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8016775">Header</span><span class="op" id="8016781">{</span><span class="op" id="8016782">}</span><span class="op" id="8016783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016787">}</span><span class="op" id="8016788">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016793">WantWrite</span><span class="op" id="8016802">:</span>&nbsp;<span class="string" id="8016804">&#34;GET&nbsp;http://y.google.com/%2F/%2F/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8016852">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8016857">&#34;Host:&nbsp;x.google.com\r\n&#34;</span>&nbsp;<span class="op" id="8016882">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8016887">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n\r\n&#34;</span><span class="op" id="8016928">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016931">}</span><span class="op" id="8016932">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8016936">//&nbsp;Testing&nbsp;custom&nbsp;case&nbsp;in&nbsp;header&nbsp;keys.&nbsp;Issue&nbsp;5022.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016992">Req</span><span class="op" id="8016995">:</span>&nbsp;<span class="ident" id="8016997">Request</span><span class="op" id="8017004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017009">Method</span><span class="op" id="8017015">:</span>&nbsp;<span class="string" id="8017017">&#34;GET&#34;</span><span class="op" id="8017022">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017027">URL</span><span class="op" id="8017030">:</span>&nbsp;<span class="op" id="8017032">&amp;</span><span class="ident" id="8017033">url</span><span class="op" id="8017036">.</span><span class="ident" id="8017037">URL</span><span class="op" id="8017040">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017046">Scheme</span><span class="op" id="8017052">:</span>&nbsp;<span class="string" id="8017054">&#34;http&#34;</span><span class="op" id="8017060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017066">Host</span><span class="op" id="8017070">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8017074">&#34;www.google.com&#34;</span><span class="op" id="8017090">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017096">Path</span><span class="op" id="8017100">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8017104">&#34;/&#34;</span><span class="op" id="8017107">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8017112">}</span><span class="op" id="8017113">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017118">Proto</span><span class="op" id="8017123">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8017130">&#34;HTTP/1.1&#34;</span><span class="op" id="8017140">,</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017145">ProtoMajor</span><span class="op" id="8017155">:</span>&nbsp;<span class="num" id="8017157">1</span><span class="op" id="8017158">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017163">ProtoMinor</span><span class="op" id="8017173">:</span>&nbsp;<span class="num" id="8017175">1</span><span class="op" id="8017176">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017181">Header</span><span class="op" id="8017187">:</span>&nbsp;<span class="ident" id="8017189">Header</span><span class="op" id="8017195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8017201">&#34;ALL-CAPS&#34;</span><span class="op" id="8017211">:</span>&nbsp;<span class="op" id="8017213">{</span><span class="string" id="8017214">&#34;x&#34;</span><span class="op" id="8017217">}</span><span class="op" id="8017218">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8017223">}</span><span class="op" id="8017224">,</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8017228">}</span><span class="op" id="8017229">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017234">WantWrite</span><span class="op" id="8017243">:</span>&nbsp;<span class="string" id="8017245">&#34;GET&nbsp;/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8017266">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8017271">&#34;Host:&nbsp;www.google.com\r\n&#34;</span>&nbsp;<span class="op" id="8017298">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8017303">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="8017341">+</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8017346">&#34;ALL-CAPS:&nbsp;x\r\n&#34;</span>&nbsp;<span class="op" id="8017364">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8017369">&#34;\r\n&#34;</span><span class="op" id="8017375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8017378">}</span><span class="op" id="8017379">,</span><br>
<span class="lineno"></span><span class="op" id="8017381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span><span class="keyword" id="8017384">func</span>&nbsp;<span class="ident" id="8017389">TestRequestWrite</span><span class="op" id="8017405">(</span><span class="ident" id="8017406">t</span>&nbsp;<span class="op" id="8017408">*</span><span class="ident" id="8017409">testing</span><span class="op" id="8017416">.</span><span class="ident" id="8017417">T</span><span class="op" id="8017418">)</span>&nbsp;<span class="op" id="8017420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017423">for</span>&nbsp;<span class="ident" id="8017427">i</span>&nbsp;<span class="op" id="8017429">:=</span>&nbsp;<span class="keyword" id="8017432">range</span>&nbsp;<span class="ident" id="8017438">reqWriteTests</span>&nbsp;<span class="op" id="8017452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017456">tt</span>&nbsp;<span class="op" id="8017459">:=</span>&nbsp;<span class="op" id="8017462">&amp;</span><span class="ident" id="8017463">reqWriteTests</span><span class="op" id="8017476">[</span><span class="ident" id="8017477">i</span><span class="op" id="8017478">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017483">setBody</span>&nbsp;<span class="op" id="8017491">:=</span>&nbsp;<span class="keyword" id="8017494">func</span><span class="op" id="8017498">(</span><span class="op" id="8017499">)</span>&nbsp;<span class="op" id="8017501">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017506">if</span>&nbsp;<span class="ident" id="8017509">tt</span><span class="op" id="8017511">.</span><span class="ident" id="8017512">Body</span>&nbsp;<span class="op" id="8017517">==</span>&nbsp;<span class="ident" id="8017520">nil</span>&nbsp;<span class="op" id="8017524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017530">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8017540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017545">switch</span>&nbsp;<span class="ident" id="8017552">b</span>&nbsp;<span class="op" id="8017554">:=</span>&nbsp;<span class="ident" id="8017557">tt</span><span class="op" id="8017559">.</span><span class="ident" id="8017560">Body</span><span class="op" id="8017564">.</span><span class="op" id="8017565">(</span><span class="keyword" id="8017566">type</span><span class="op" id="8017570">)</span>&nbsp;<span class="op" id="8017572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017577">case</span>&nbsp;<span class="op" id="8017582">[</span><span class="op" id="8017583">]</span><span class="builtintype" id="8017584">byte</span><span class="op" id="8017588">:</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017594">tt</span><span class="op" id="8017596">.</span><span class="ident" id="8017597">Req</span><span class="op" id="8017600">.</span><span class="ident" id="8017601">Body</span>&nbsp;<span class="op" id="8017606">=</span>&nbsp;<span class="ident" id="8017608">ioutil</span><span class="op" id="8017614">.</span><span class="ident" id="8017615">NopCloser</span><span class="op" id="8017624">(</span><span class="ident" id="8017625">bytes</span><span class="op" id="8017630">.</span><span class="ident" id="8017631">NewReader</span><span class="op" id="8017640">(</span><span class="ident" id="8017641">b</span><span class="op" id="8017642">)</span><span class="op" id="8017643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017648">case</span>&nbsp;<span class="keyword" id="8017653">func</span><span class="op" id="8017657">(</span><span class="op" id="8017658">)</span>&nbsp;<span class="ident" id="8017660">io</span><span class="op" id="8017662">.</span><span class="ident" id="8017663">ReadCloser</span><span class="op" id="8017673">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017679">tt</span><span class="op" id="8017681">.</span><span class="ident" id="8017682">Req</span><span class="op" id="8017685">.</span><span class="ident" id="8017686">Body</span>&nbsp;<span class="op" id="8017691">=</span>&nbsp;<span class="ident" id="8017693">b</span><span class="op" id="8017694">(</span><span class="op" id="8017695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8017700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8017704">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017708">setBody</span><span class="op" id="8017715">(</span><span class="op" id="8017716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017720">if</span>&nbsp;<span class="ident" id="8017723">tt</span><span class="op" id="8017725">.</span><span class="ident" id="8017726">Req</span><span class="op" id="8017729">.</span><span class="ident" id="8017730">Header</span>&nbsp;<span class="op" id="8017737">==</span>&nbsp;<span class="ident" id="8017740">nil</span>&nbsp;<span class="op" id="8017744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017749">tt</span><span class="op" id="8017751">.</span><span class="ident" id="8017752">Req</span><span class="op" id="8017755">.</span><span class="ident" id="8017756">Header</span>&nbsp;<span class="op" id="8017763">=</span>&nbsp;<span class="builtinfunc" id="8017765">make</span><span class="op" id="8017769">(</span><span class="ident" id="8017770">Header</span><span class="op" id="8017776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8017780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017785">var</span>&nbsp;<span class="ident" id="8017789">braw</span>&nbsp;<span class="ident" id="8017794">bytes</span><span class="op" id="8017799">.</span><span class="ident" id="8017800">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017809">err</span>&nbsp;<span class="op" id="8017813">:=</span>&nbsp;<span class="ident" id="8017816">tt</span><span class="op" id="8017818">.</span><span class="ident" id="8017819">Req</span><span class="op" id="8017822">.</span><span class="ident" id="8017823">Write</span><span class="op" id="8017828">(</span><span class="op" id="8017829">&amp;</span><span class="ident" id="8017830">braw</span><span class="op" id="8017834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017838">if</span>&nbsp;<span class="ident" id="8017841">g</span><span class="op" id="8017842">,</span>&nbsp;<span class="ident" id="8017844">e</span>&nbsp;<span class="op" id="8017846">:=</span>&nbsp;<span class="ident" id="8017849">fmt</span><span class="op" id="8017852">.</span><span class="ident" id="8017853">Sprintf</span><span class="op" id="8017860">(</span><span class="string" id="8017861">&#34;%v&#34;</span><span class="op" id="8017865">,</span>&nbsp;<span class="ident" id="8017867">err</span><span class="op" id="8017870">)</span><span class="op" id="8017871">,</span>&nbsp;<span class="ident" id="8017873">fmt</span><span class="op" id="8017876">.</span><span class="ident" id="8017877">Sprintf</span><span class="op" id="8017884">(</span><span class="string" id="8017885">&#34;%v&#34;</span><span class="op" id="8017889">,</span>&nbsp;<span class="ident" id="8017891">tt</span><span class="op" id="8017893">.</span><span class="ident" id="8017894">WantError</span><span class="op" id="8017903">)</span><span class="op" id="8017904">;</span>&nbsp;<span class="ident" id="8017906">g</span>&nbsp;<span class="op" id="8017908">!=</span>&nbsp;<span class="ident" id="8017911">e</span>&nbsp;<span class="op" id="8017913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017918">t</span><span class="op" id="8017919">.</span><span class="ident" id="8017920">Errorf</span><span class="op" id="8017926">(</span><span class="string" id="8017927">&#34;writing&nbsp;#%d,&nbsp;err&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8017959">,</span>&nbsp;<span class="ident" id="8017961">i</span><span class="op" id="8017962">,</span>&nbsp;<span class="ident" id="8017964">g</span><span class="op" id="8017965">,</span>&nbsp;<span class="ident" id="8017967">e</span><span class="op" id="8017968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017973">continue</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8017984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017988">if</span>&nbsp;<span class="ident" id="8017991">err</span>&nbsp;<span class="op" id="8017995">!=</span>&nbsp;<span class="ident" id="8017998">nil</span>&nbsp;<span class="op" id="8018002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018007">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8018018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018023">if</span>&nbsp;<span class="ident" id="8018026">tt</span><span class="op" id="8018028">.</span><span class="ident" id="8018029">WantWrite</span>&nbsp;<span class="op" id="8018039">!=</span>&nbsp;<span class="string" id="8018042">&#34;&#34;</span>&nbsp;<span class="op" id="8018045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8018050">sraw</span>&nbsp;<span class="op" id="8018055">:=</span>&nbsp;<span class="ident" id="8018058">braw</span><span class="op" id="8018062">.</span><span class="ident" id="8018063">String</span><span class="op" id="8018069">(</span><span class="op" id="8018070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018075">if</span>&nbsp;<span class="ident" id="8018078">sraw</span>&nbsp;<span class="op" id="8018083">!=</span>&nbsp;<span class="ident" id="8018086">tt</span><span class="op" id="8018088">.</span><span class="ident" id="8018089">WantWrite</span>&nbsp;<span class="op" id="8018099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8018105">t</span><span class="op" id="8018106">.</span><span class="ident" id="8018107">Errorf</span><span class="op" id="8018113">(</span><span class="string" id="8018114">&#34;Test&nbsp;%d,&nbsp;expecting:\n%s\nGot:\n%s\n&#34;</span><span class="op" id="8018151">,</span>&nbsp;<span class="ident" id="8018153">i</span><span class="op" id="8018154">,</span>&nbsp;<span class="ident" id="8018156">tt</span><span class="op" id="8018158">.</span><span class="ident" id="8018159">WantWrite</span><span class="op" id="8018168">,</span>&nbsp;<span class="ident" id="8018170">sraw</span><span class="op" id="8018174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018180">continue</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8018192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8018196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018201">if</span>&nbsp;<span class="ident" id="8018204">tt</span><span class="op" id="8018206">.</span><span class="ident" id="8018207">WantProxy</span>&nbsp;<span class="op" id="8018217">!=</span>&nbsp;<span class="string" id="8018220">&#34;&#34;</span>&nbsp;<span class="op" id="8018223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8018228">setBody</span><span class="op" id="8018235">(</span><span class="op" id="8018236">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018241">var</span>&nbsp;<span class="ident" id="8018245">praw</span>&nbsp;<span class="ident" id="8018250">bytes</span><span class="op" id="8018255">.</span><span class="ident" id="8018256">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8018266">err</span>&nbsp;<span class="op" id="8018270">=</span>&nbsp;<span class="ident" id="8018272">tt</span><span class="op" id="8018274">.</span><span class="ident" id="8018275">Req</span><span class="op" id="8018278">.</span><span class="ident" id="8018279">WriteProxy</span><span class="op" id="8018289">(</span><span class="op" id="8018290">&amp;</span><span class="ident" id="8018291">praw</span><span class="op" id="8018295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018300">if</span>&nbsp;<span class="ident" id="8018303">err</span>&nbsp;<span class="op" id="8018307">!=</span>&nbsp;<span class="ident" id="8018310">nil</span>&nbsp;<span class="op" id="8018314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8018320">t</span><span class="op" id="8018321">.</span><span class="ident" id="8018322">Errorf</span><span class="op" id="8018328">(</span><span class="string" id="8018329">&#34;WriteProxy&nbsp;#%d:&nbsp;%s&#34;</span><span class="op" id="8018349">,</span>&nbsp;<span class="ident" id="8018351">i</span><span class="op" id="8018352">,</span>&nbsp;<span class="ident" id="8018354">err</span><span class="op" id="8018357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018363">continue</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8018375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8018380">sraw</span>&nbsp;<span class="op" id="8018385">:=</span>&nbsp;<span class="ident" id="8018388">praw</span><span class="op" id="8018392">.</span><span class="ident" id="8018393">String</span><span class="op" id="8018399">(</span><span class="op" id="8018400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018405">if</span>&nbsp;<span class="ident" id="8018408">sraw</span>&nbsp;<span class="op" id="8018413">!=</span>&nbsp;<span class="ident" id="8018416">tt</span><span class="op" id="8018418">.</span><span class="ident" id="8018419">WantProxy</span>&nbsp;<span class="op" id="8018429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8018435">t</span><span class="op" id="8018436">.</span><span class="ident" id="8018437">Errorf</span><span class="op" id="8018443">(</span><span class="string" id="8018444">&#34;Test&nbsp;Proxy&nbsp;%d,&nbsp;expecting:\n%s\nGot:\n%s\n&#34;</span><span class="op" id="8018487">,</span>&nbsp;<span class="ident" id="8018489">i</span><span class="op" id="8018490">,</span>&nbsp;<span class="ident" id="8018492">tt</span><span class="op" id="8018494">.</span><span class="ident" id="8018495">WantProxy</span><span class="op" id="8018504">,</span>&nbsp;<span class="ident" id="8018506">sraw</span><span class="op" id="8018510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018516">continue</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8018528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8018532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8018535">}</span><br>
<span class="lineno"></span><span class="op" id="8018537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="8018540">type</span>&nbsp;<span class="ident" id="8018545">closeChecker</span>&nbsp;<span class="keyword" id="8018558">struct</span>&nbsp;<span class="op" id="8018565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8018568">io</span><span class="op" id="8018570">.</span><span class="ident" id="8018571">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8018579">closed</span>&nbsp;<span class="builtintype" id="8018586">bool</span><br>
<span class="lineno"></span><span class="op" id="8018591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">520</span><span class="keyword" id="8018594">func</span>&nbsp;<span class="op" id="8018599">(</span><span class="ident" id="8018600">rc</span>&nbsp;<span class="op" id="8018603">*</span><span class="ident" id="8018604">closeChecker</span><span class="op" id="8018616">)</span>&nbsp;<span class="ident" id="8018618">Close</span><span class="op" id="8018623">(</span><span class="op" id="8018624">)</span>&nbsp;<span class="builtintype" id="8018626">error</span>&nbsp;<span class="op" id="8018632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8018635">rc</span><span class="op" id="8018637">.</span><span class="ident" id="8018638">closed</span>&nbsp;<span class="op" id="8018645">=</span>&nbsp;<span class="ident" id="8018647">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018653">return</span>&nbsp;<span class="ident" id="8018660">nil</span><br>
<span class="lineno"></span><span class="op" id="8018664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="comment" id="8018667">//&nbsp;TestRequestWriteClosesBody&nbsp;tests&nbsp;that&nbsp;Request.Write&nbsp;does&nbsp;close&nbsp;its&nbsp;request.Body.</span><br>
<span class="lineno"></span><span class="comment" id="8018751">//&nbsp;It&nbsp;also&nbsp;indirectly&nbsp;tests&nbsp;NewRequest&nbsp;and&nbsp;that&nbsp;it&nbsp;doesn&#39;t&nbsp;wrap&nbsp;an&nbsp;existing&nbsp;Closer</span><br>
<span class="lineno"></span><span class="comment" id="8018834">//&nbsp;inside&nbsp;a&nbsp;NopCloser,&nbsp;and&nbsp;that&nbsp;it&nbsp;serializes&nbsp;it&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="keyword" id="8018894">func</span>&nbsp;<span class="ident" id="8018899">TestRequestWriteClosesBody</span><span class="op" id="8018925">(</span><span class="ident" id="8018926">t</span>&nbsp;<span class="op" id="8018928">*</span><span class="ident" id="8018929">testing</span><span class="op" id="8018936">.</span><span class="ident" id="8018937">T</span><span class="op" id="8018938">)</span>&nbsp;<span class="op" id="8018940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8018943">rc</span>&nbsp;<span class="op" id="8018946">:=</span>&nbsp;<span class="op" id="8018949">&amp;</span><span class="ident" id="8018950">closeChecker</span><span class="op" id="8018962">{</span><span class="ident" id="8018963">Reader</span><span class="op" id="8018969">:</span>&nbsp;<span class="ident" id="8018971">strings</span><span class="op" id="8018978">.</span><span class="ident" id="8018979">NewReader</span><span class="op" id="8018988">(</span><span class="string" id="8018989">&#34;my&nbsp;body&#34;</span><span class="op" id="8018998">)</span><span class="op" id="8018999">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019002">req</span><span class="op" id="8019005">,</span>&nbsp;<span class="ident" id="8019007">_</span>&nbsp;<span class="op" id="8019009">:=</span>&nbsp;<span class="ident" id="8019012">NewRequest</span><span class="op" id="8019022">(</span><span class="string" id="8019023">&#34;POST&#34;</span><span class="op" id="8019029">,</span>&nbsp;<span class="string" id="8019031">&#34;http://foo.com/&#34;</span><span class="op" id="8019048">,</span>&nbsp;<span class="ident" id="8019050">rc</span><span class="op" id="8019052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019055">if</span>&nbsp;<span class="ident" id="8019058">req</span><span class="op" id="8019061">.</span><span class="ident" id="8019062">ContentLength</span>&nbsp;<span class="op" id="8019076">!=</span>&nbsp;<span class="num" id="8019079">0</span>&nbsp;<span class="op" id="8019081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019085">t</span><span class="op" id="8019086">.</span><span class="ident" id="8019087">Errorf</span><span class="op" id="8019093">(</span><span class="string" id="8019094">&#34;got&nbsp;req.ContentLength&nbsp;%d,&nbsp;want&nbsp;0&#34;</span><span class="op" id="8019128">,</span>&nbsp;<span class="ident" id="8019130">req</span><span class="op" id="8019133">.</span><span class="ident" id="8019134">ContentLength</span><span class="op" id="8019147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019153">buf</span>&nbsp;<span class="op" id="8019157">:=</span>&nbsp;<span class="builtinfunc" id="8019160">new</span><span class="op" id="8019163">(</span><span class="ident" id="8019164">bytes</span><span class="op" id="8019169">.</span><span class="ident" id="8019170">Buffer</span><span class="op" id="8019176">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019179">req</span><span class="op" id="8019182">.</span><span class="ident" id="8019183">Write</span><span class="op" id="8019188">(</span><span class="ident" id="8019189">buf</span><span class="op" id="8019192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019195">if</span>&nbsp;<span class="op" id="8019198">!</span><span class="ident" id="8019199">rc</span><span class="op" id="8019201">.</span><span class="ident" id="8019202">closed</span>&nbsp;<span class="op" id="8019209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019213">t</span><span class="op" id="8019214">.</span><span class="ident" id="8019215">Error</span><span class="op" id="8019220">(</span><span class="string" id="8019221">&#34;body&nbsp;not&nbsp;closed&nbsp;after&nbsp;write&#34;</span><span class="op" id="8019250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019256">expected</span>&nbsp;<span class="op" id="8019265">:=</span>&nbsp;<span class="string" id="8019268">&#34;POST&nbsp;/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="8019290">+</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8019294">&#34;Host:&nbsp;foo.com\r\n&#34;</span>&nbsp;<span class="op" id="8019314">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8019318">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="8019356">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8019360">&#34;Transfer-Encoding:&nbsp;chunked\r\n\r\n&#34;</span>&nbsp;<span class="op" id="8019397">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8019401">//&nbsp;TODO:&nbsp;currently&nbsp;we&nbsp;don&#39;t&nbsp;buffer&nbsp;before&nbsp;chunking,&nbsp;so&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8019467">//&nbsp;single&nbsp;&#34;m&#34;&nbsp;chunk&nbsp;before&nbsp;the&nbsp;other&nbsp;chunks,&nbsp;as&nbsp;this&nbsp;was&nbsp;the&nbsp;1-byte</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8019537">//&nbsp;read&nbsp;from&nbsp;our&nbsp;MultiReader&nbsp;where&nbsp;we&nbsp;stiched&nbsp;the&nbsp;Body&nbsp;back&nbsp;together</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8019608">//&nbsp;after&nbsp;sniffing&nbsp;whether&nbsp;the&nbsp;Body&nbsp;was&nbsp;0&nbsp;bytes&nbsp;or&nbsp;not.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019665">chunk</span><span class="op" id="8019670">(</span><span class="string" id="8019671">&#34;m&#34;</span><span class="op" id="8019674">)</span>&nbsp;<span class="op" id="8019676">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019680">chunk</span><span class="op" id="8019685">(</span><span class="string" id="8019686">&#34;y&nbsp;body&#34;</span><span class="op" id="8019694">)</span>&nbsp;<span class="op" id="8019696">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019700">chunk</span><span class="op" id="8019705">(</span><span class="string" id="8019706">&#34;&#34;</span><span class="op" id="8019708">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019711">if</span>&nbsp;<span class="ident" id="8019714">buf</span><span class="op" id="8019717">.</span><span class="ident" id="8019718">String</span><span class="op" id="8019724">(</span><span class="op" id="8019725">)</span>&nbsp;<span class="op" id="8019727">!=</span>&nbsp;<span class="ident" id="8019730">expected</span>&nbsp;<span class="op" id="8019739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019743">t</span><span class="op" id="8019744">.</span><span class="ident" id="8019745">Errorf</span><span class="op" id="8019751">(</span><span class="string" id="8019752">&#34;write:\n&nbsp;got:&nbsp;%s\nwant:&nbsp;%s&#34;</span><span class="op" id="8019780">,</span>&nbsp;<span class="ident" id="8019782">buf</span><span class="op" id="8019785">.</span><span class="ident" id="8019786">String</span><span class="op" id="8019792">(</span><span class="op" id="8019793">)</span><span class="op" id="8019794">,</span>&nbsp;<span class="ident" id="8019796">expected</span><span class="op" id="8019804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019807">}</span><br>
<span class="lineno"></span><span class="op" id="8019809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">555</span><span class="keyword" id="8019812">func</span>&nbsp;<span class="ident" id="8019817">chunk</span><span class="op" id="8019822">(</span><span class="ident" id="8019823">s</span>&nbsp;<span class="builtintype" id="8019825">string</span><span class="op" id="8019831">)</span>&nbsp;<span class="builtintype" id="8019833">string</span>&nbsp;<span class="op" id="8019840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019843">return</span>&nbsp;<span class="ident" id="8019850">fmt</span><span class="op" id="8019853">.</span><span class="ident" id="8019854">Sprintf</span><span class="op" id="8019861">(</span><span class="string" id="8019862">&#34;%x\r\n%s\r\n&#34;</span><span class="op" id="8019876">,</span>&nbsp;<span class="builtinfunc" id="8019878">len</span><span class="op" id="8019881">(</span><span class="ident" id="8019882">s</span><span class="op" id="8019883">)</span><span class="op" id="8019884">,</span>&nbsp;<span class="ident" id="8019886">s</span><span class="op" id="8019887">)</span><br>
<span class="lineno"></span><span class="op" id="8019889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8019892">func</span>&nbsp;<span class="ident" id="8019897">mustParseURL</span><span class="op" id="8019909">(</span><span class="ident" id="8019910">s</span>&nbsp;<span class="builtintype" id="8019912">string</span><span class="op" id="8019918">)</span>&nbsp;<span class="op" id="8019920">*</span><span class="ident" id="8019921">url</span><span class="op" id="8019924">.</span><span class="ident" id="8019925">URL</span>&nbsp;<span class="op" id="8019929">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019932">u</span><span class="op" id="8019933">,</span>&nbsp;<span class="ident" id="8019935">err</span>&nbsp;<span class="op" id="8019939">:=</span>&nbsp;<span class="ident" id="8019942">url</span><span class="op" id="8019945">.</span><span class="ident" id="8019946">Parse</span><span class="op" id="8019951">(</span><span class="ident" id="8019952">s</span><span class="op" id="8019953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019956">if</span>&nbsp;<span class="ident" id="8019959">err</span>&nbsp;<span class="op" id="8019963">!=</span>&nbsp;<span class="ident" id="8019966">nil</span>&nbsp;<span class="op" id="8019970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8019974">panic</span><span class="op" id="8019979">(</span><span class="ident" id="8019980">fmt</span><span class="op" id="8019983">.</span><span class="ident" id="8019984">Sprintf</span><span class="op" id="8019991">(</span><span class="string" id="8019992">&#34;Error&nbsp;parsing&nbsp;URL&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="8020018">,</span>&nbsp;<span class="ident" id="8020020">s</span><span class="op" id="8020021">,</span>&nbsp;<span class="ident" id="8020023">err</span><span class="op" id="8020026">)</span><span class="op" id="8020027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8020030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8020033">return</span>&nbsp;<span class="ident" id="8020040">u</span><br>
<span class="lineno">565</span><span class="op" id="8020042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8020045">type</span>&nbsp;<span class="ident" id="8020050">writerFunc</span>&nbsp;<span class="keyword" id="8020061">func</span><span class="op" id="8020065">(</span><span class="op" id="8020066">[</span><span class="op" id="8020067">]</span><span class="builtintype" id="8020068">byte</span><span class="op" id="8020072">)</span>&nbsp;<span class="op" id="8020074">(</span><span class="builtintype" id="8020075">int</span><span class="op" id="8020078">,</span>&nbsp;<span class="builtintype" id="8020080">error</span><span class="op" id="8020085">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8020088">func</span>&nbsp;<span class="op" id="8020093">(</span><span class="ident" id="8020094">f</span>&nbsp;<span class="ident" id="8020096">writerFunc</span><span class="op" id="8020106">)</span>&nbsp;<span class="ident" id="8020108">Write</span><span class="op" id="8020113">(</span><span class="ident" id="8020114">p</span>&nbsp;<span class="op" id="8020116">[</span><span class="op" id="8020117">]</span><span class="builtintype" id="8020118">byte</span><span class="op" id="8020122">)</span>&nbsp;<span class="op" id="8020124">(</span><span class="builtintype" id="8020125">int</span><span class="op" id="8020128">,</span>&nbsp;<span class="builtintype" id="8020130">error</span><span class="op" id="8020135">)</span>&nbsp;<span class="op" id="8020137">{</span>&nbsp;<span class="keyword" id="8020139">return</span>&nbsp;<span class="ident" id="8020146">f</span><span class="op" id="8020147">(</span><span class="ident" id="8020148">p</span><span class="op" id="8020149">)</span>&nbsp;<span class="op" id="8020151">}</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="comment" id="8020154">//&nbsp;TestRequestWriteError&nbsp;tests&nbsp;the&nbsp;Write&nbsp;err&nbsp;!=&nbsp;nil&nbsp;checks&nbsp;in&nbsp;(*Request).write.</span><br>
<span class="lineno"></span><span class="keyword" id="8020234">func</span>&nbsp;<span class="ident" id="8020239">TestRequestWriteError</span><span class="op" id="8020260">(</span><span class="ident" id="8020261">t</span>&nbsp;<span class="op" id="8020263">*</span><span class="ident" id="8020264">testing</span><span class="op" id="8020271">.</span><span class="ident" id="8020272">T</span><span class="op" id="8020273">)</span>&nbsp;<span class="op" id="8020275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020278">failAfter</span><span class="op" id="8020287">,</span>&nbsp;<span class="ident" id="8020289">writeCount</span>&nbsp;<span class="op" id="8020300">:=</span>&nbsp;<span class="num" id="8020303">0</span><span class="op" id="8020304">,</span>&nbsp;<span class="num" id="8020306">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020309">errFail</span>&nbsp;<span class="op" id="8020317">:=</span>&nbsp;<span class="ident" id="8020320">errors</span><span class="op" id="8020326">.</span><span class="ident" id="8020327">New</span><span class="op" id="8020330">(</span><span class="string" id="8020331">&#34;fake&nbsp;write&nbsp;failure&#34;</span><span class="op" id="8020351">)</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8020355">//&nbsp;w&nbsp;is&nbsp;the&nbsp;buffered&nbsp;io.Writer&nbsp;to&nbsp;write&nbsp;the&nbsp;request&nbsp;to.&nbsp;&nbsp;It</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8020416">//&nbsp;fails&nbsp;exactly&nbsp;once&nbsp;on&nbsp;its&nbsp;Nth&nbsp;Write&nbsp;call,&nbsp;as&nbsp;controlled&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8020479">//&nbsp;failAfter.&nbsp;It&nbsp;also&nbsp;tracks&nbsp;the&nbsp;number&nbsp;of&nbsp;calls&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8020532">//&nbsp;writeCount.</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020548">w</span>&nbsp;<span class="op" id="8020550">:=</span>&nbsp;<span class="keyword" id="8020553">struct</span>&nbsp;<span class="op" id="8020560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020564">io</span><span class="op" id="8020566">.</span><span class="ident" id="8020567">ByteWriter</span>&nbsp;<span class="comment" id="8020578">//&nbsp;to&nbsp;avoid&nbsp;being&nbsp;wrapped&nbsp;by&nbsp;a&nbsp;bufio.Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020624">io</span><span class="op" id="8020626">.</span><span class="ident" id="8020627">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8020635">}</span><span class="op" id="8020636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020640">nil</span><span class="op" id="8020643">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020647">writerFunc</span><span class="op" id="8020657">(</span><span class="keyword" id="8020658">func</span><span class="op" id="8020662">(</span><span class="ident" id="8020663">p</span>&nbsp;<span class="op" id="8020665">[</span><span class="op" id="8020666">]</span><span class="builtintype" id="8020667">byte</span><span class="op" id="8020671">)</span>&nbsp;<span class="op" id="8020673">(</span><span class="ident" id="8020674">n</span>&nbsp;<span class="builtintype" id="8020676">int</span><span class="op" id="8020679">,</span>&nbsp;<span class="ident" id="8020681">err</span>&nbsp;<span class="builtintype" id="8020685">error</span><span class="op" id="8020690">)</span>&nbsp;<span class="op" id="8020692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020697">writeCount</span><span class="op" id="8020707">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8020713">if</span>&nbsp;<span class="ident" id="8020716">failAfter</span>&nbsp;<span class="op" id="8020726">==</span>&nbsp;<span class="num" id="8020729">0</span>&nbsp;<span class="op" id="8020731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020737">err</span>&nbsp;<span class="op" id="8020741">=</span>&nbsp;<span class="ident" id="8020743">errFail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8020754">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020759">failAfter</span><span class="op" id="8020768">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8020774">return</span>&nbsp;<span class="builtinfunc" id="8020781">len</span><span class="op" id="8020784">(</span><span class="ident" id="8020785">p</span><span class="op" id="8020786">)</span><span class="op" id="8020787">,</span>&nbsp;<span class="ident" id="8020789">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8020795">}</span><span class="op" id="8020796">)</span><span class="op" id="8020797">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8020800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020804">req</span><span class="op" id="8020807">,</span>&nbsp;<span class="ident" id="8020809">_</span>&nbsp;<span class="op" id="8020811">:=</span>&nbsp;<span class="ident" id="8020814">NewRequest</span><span class="op" id="8020824">(</span><span class="string" id="8020825">&#34;GET&#34;</span><span class="op" id="8020830">,</span>&nbsp;<span class="string" id="8020832">&#34;http://example.com/&#34;</span><span class="op" id="8020853">,</span>&nbsp;<span class="ident" id="8020855">nil</span><span class="op" id="8020858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8020861">const</span>&nbsp;<span class="ident" id="8020867">writeCalls</span>&nbsp;<span class="op" id="8020878">=</span>&nbsp;<span class="num" id="8020880">4</span>&nbsp;<span class="comment" id="8020882">//&nbsp;number&nbsp;of&nbsp;Write&nbsp;calls&nbsp;in&nbsp;current&nbsp;implementation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020934">sawGood</span>&nbsp;<span class="op" id="8020942">:=</span>&nbsp;<span class="ident" id="8020945">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8020952">for</span>&nbsp;<span class="ident" id="8020956">n</span>&nbsp;<span class="op" id="8020958">:=</span>&nbsp;<span class="num" id="8020961">0</span><span class="op" id="8020962">;</span>&nbsp;<span class="ident" id="8020964">n</span>&nbsp;<span class="op" id="8020966">&lt;=</span>&nbsp;<span class="ident" id="8020969">writeCalls</span><span class="op" id="8020979">+</span><span class="num" id="8020980">2</span><span class="op" id="8020981">;</span>&nbsp;<span class="ident" id="8020983">n</span><span class="op" id="8020984">++</span>&nbsp;<span class="op" id="8020987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020991">failAfter</span>&nbsp;<span class="op" id="8021001">=</span>&nbsp;<span class="ident" id="8021003">n</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021007">writeCount</span>&nbsp;<span class="op" id="8021018">=</span>&nbsp;<span class="num" id="8021020">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021024">err</span>&nbsp;<span class="op" id="8021028">:=</span>&nbsp;<span class="ident" id="8021031">req</span><span class="op" id="8021034">.</span><span class="ident" id="8021035">Write</span><span class="op" id="8021040">(</span><span class="ident" id="8021041">w</span><span class="op" id="8021042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021046">var</span>&nbsp;<span class="ident" id="8021050">wantErr</span>&nbsp;<span class="builtintype" id="8021058">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021066">if</span>&nbsp;<span class="ident" id="8021069">n</span>&nbsp;<span class="op" id="8021071">&lt;</span>&nbsp;<span class="ident" id="8021073">writeCalls</span>&nbsp;<span class="op" id="8021084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021089">wantErr</span>&nbsp;<span class="op" id="8021097">=</span>&nbsp;<span class="ident" id="8021099">errFail</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021113">if</span>&nbsp;<span class="ident" id="8021116">err</span>&nbsp;<span class="op" id="8021120">!=</span>&nbsp;<span class="ident" id="8021123">wantErr</span>&nbsp;<span class="op" id="8021131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021136">t</span><span class="op" id="8021137">.</span><span class="ident" id="8021138">Errorf</span><span class="op" id="8021144">(</span><span class="string" id="8021145">&#34;for&nbsp;fail-after&nbsp;%d&nbsp;Writes,&nbsp;err&nbsp;=&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8021190">,</span>&nbsp;<span class="ident" id="8021192">n</span><span class="op" id="8021193">,</span>&nbsp;<span class="ident" id="8021195">err</span><span class="op" id="8021198">,</span>&nbsp;<span class="ident" id="8021200">wantErr</span><span class="op" id="8021207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021212">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021223">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021227">if</span>&nbsp;<span class="ident" id="8021230">err</span>&nbsp;<span class="op" id="8021234">==</span>&nbsp;<span class="ident" id="8021237">nil</span>&nbsp;<span class="op" id="8021241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021246">sawGood</span>&nbsp;<span class="op" id="8021254">=</span>&nbsp;<span class="ident" id="8021256">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021264">if</span>&nbsp;<span class="ident" id="8021267">writeCount</span>&nbsp;<span class="op" id="8021278">!=</span>&nbsp;<span class="ident" id="8021281">writeCalls</span>&nbsp;<span class="op" id="8021292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021298">t</span><span class="op" id="8021299">.</span><span class="ident" id="8021300">Fatalf</span><span class="op" id="8021306">(</span><span class="string" id="8021307">&#34;writeCalls&nbsp;constant&nbsp;is&nbsp;outdated&nbsp;in&nbsp;test&#34;</span><span class="op" id="8021348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021353">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021361">if</span>&nbsp;<span class="ident" id="8021364">writeCount</span>&nbsp;<span class="op" id="8021375">&gt;</span>&nbsp;<span class="ident" id="8021377">writeCalls</span>&nbsp;<span class="op" id="8021388">||</span>&nbsp;<span class="ident" id="8021391">writeCount</span>&nbsp;<span class="op" id="8021402">&gt;</span>&nbsp;<span class="ident" id="8021404">n</span><span class="op" id="8021405">+</span><span class="num" id="8021406">1</span>&nbsp;<span class="op" id="8021408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021413">t</span><span class="op" id="8021414">.</span><span class="ident" id="8021415">Errorf</span><span class="op" id="8021421">(</span><span class="string" id="8021422">&#34;for&nbsp;fail-after&nbsp;%d,&nbsp;saw&nbsp;unexpectedly&nbsp;high&nbsp;(%d)&nbsp;write&nbsp;calls&#34;</span><span class="op" id="8021481">,</span>&nbsp;<span class="ident" id="8021483">n</span><span class="op" id="8021484">,</span>&nbsp;<span class="ident" id="8021486">writeCount</span><span class="op" id="8021496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021503">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021506">if</span>&nbsp;<span class="op" id="8021509">!</span><span class="ident" id="8021510">sawGood</span>&nbsp;<span class="op" id="8021518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021522">t</span><span class="op" id="8021523">.</span><span class="ident" id="8021524">Fatalf</span><span class="op" id="8021530">(</span><span class="string" id="8021531">&#34;writeCalls&nbsp;constant&nbsp;is&nbsp;outdated&nbsp;in&nbsp;test&#34;</span><span class="op" id="8021572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021575">}</span><br>
<span class="lineno"></span><span class="op" id="8021577">}</span>
</div>
</body>
</html>
