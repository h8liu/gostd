<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/cipher</h2>
<ul>
<li><a href="/gostd/crypto/cipher/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc.go.html">cbc.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc_aes_test.go.html">cbc_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb.go.html">cfb.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb_test.go.html">cfb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher_test.go.html">cipher_test.go</a></li>
<li><a href="/gostd/crypto/cipher/common_test.go.html">common_test.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr.go.html">ctr.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr_aes_test.go.html">ctr_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm.go.html">gcm.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm_test.go.html">gcm_test.go</a></li>
<li><a href="/gostd/crypto/cipher/io.go.html">io.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb.go.html">ofb.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb_test.go.html">ofb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/xor.go.html">xor.go</a></li>
<li><a href="/gostd/crypto/cipher/xor_test.go.html">xor_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3817811">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3817866">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3817920">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3817971">package</span>&nbsp;<span class="ident" id="3817979">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3817987">import</span>&nbsp;<span class="op" id="3817994">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3817997">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3818014">&#34;errors&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3818023">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3818026">//&nbsp;AEAD&nbsp;is&nbsp;a&nbsp;cipher&nbsp;mode&nbsp;providing&nbsp;authenticated&nbsp;encryption&nbsp;with&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="3818102">//&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3818111">type</span>&nbsp;<span class="ident" id="3818116">AEAD</span>&nbsp;<span class="keyword" id="3818121">interface</span>&nbsp;<span class="op" id="3818131">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818134">//&nbsp;NonceSize&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;nonce&nbsp;that&nbsp;must&nbsp;be&nbsp;passed&nbsp;to&nbsp;Seal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818206">//&nbsp;and&nbsp;Open.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818220">NonceSize</span><span class="op" id="3818229">(</span><span class="op" id="3818230">)</span>&nbsp;<span class="builtintype" id="3818232">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818238">//&nbsp;Overhead&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;difference&nbsp;between&nbsp;the&nbsp;lengths&nbsp;of&nbsp;a</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818307">//&nbsp;plaintext&nbsp;and&nbsp;ciphertext.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818337">Overhead</span><span class="op" id="3818345">(</span><span class="op" id="3818346">)</span>&nbsp;<span class="builtintype" id="3818348">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818354">//&nbsp;Seal&nbsp;encrypts&nbsp;and&nbsp;authenticates&nbsp;plaintext,&nbsp;authenticates&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818419">//&nbsp;additional&nbsp;data&nbsp;and&nbsp;appends&nbsp;the&nbsp;result&nbsp;to&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;updated</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818492">//&nbsp;slice.&nbsp;The&nbsp;nonce&nbsp;must&nbsp;be&nbsp;NonceSize()&nbsp;bytes&nbsp;long&nbsp;and&nbsp;unique&nbsp;for&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818563">//&nbsp;time,&nbsp;for&nbsp;a&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818590">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818594">//&nbsp;The&nbsp;plaintext&nbsp;and&nbsp;dst&nbsp;may&nbsp;alias&nbsp;exactly&nbsp;or&nbsp;not&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818653">Seal</span><span class="op" id="3818657">(</span><span class="ident" id="3818658">dst</span><span class="op" id="3818661">,</span>&nbsp;<span class="ident" id="3818663">nonce</span><span class="op" id="3818668">,</span>&nbsp;<span class="ident" id="3818670">plaintext</span><span class="op" id="3818679">,</span>&nbsp;<span class="ident" id="3818681">data</span>&nbsp;<span class="op" id="3818686">[</span><span class="op" id="3818687">]</span><span class="builtintype" id="3818688">byte</span><span class="op" id="3818692">)</span>&nbsp;<span class="op" id="3818694">[</span><span class="op" id="3818695">]</span><span class="builtintype" id="3818696">byte</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818703">//&nbsp;Open&nbsp;decrypts&nbsp;and&nbsp;authenticates&nbsp;ciphertext,&nbsp;authenticates&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818769">//&nbsp;additional&nbsp;data&nbsp;and,&nbsp;if&nbsp;successful,&nbsp;appends&nbsp;the&nbsp;resulting&nbsp;plaintext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818841">//&nbsp;to&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;updated&nbsp;slice.&nbsp;The&nbsp;nonce&nbsp;must&nbsp;be&nbsp;NonceSize()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818912">//&nbsp;bytes&nbsp;long&nbsp;and&nbsp;both&nbsp;it&nbsp;and&nbsp;the&nbsp;additional&nbsp;data&nbsp;must&nbsp;match&nbsp;the</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818978">//&nbsp;value&nbsp;passed&nbsp;to&nbsp;Seal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3819004">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3819008">//&nbsp;The&nbsp;ciphertext&nbsp;and&nbsp;dst&nbsp;may&nbsp;alias&nbsp;exactly&nbsp;or&nbsp;not&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3819068">Open</span><span class="op" id="3819072">(</span><span class="ident" id="3819073">dst</span><span class="op" id="3819076">,</span>&nbsp;<span class="ident" id="3819078">nonce</span><span class="op" id="3819083">,</span>&nbsp;<span class="ident" id="3819085">ciphertext</span><span class="op" id="3819095">,</span>&nbsp;<span class="ident" id="3819097">data</span>&nbsp;<span class="op" id="3819102">[</span><span class="op" id="3819103">]</span><span class="builtintype" id="3819104">byte</span><span class="op" id="3819108">)</span>&nbsp;<span class="op" id="3819110">(</span><span class="op" id="3819111">[</span><span class="op" id="3819112">]</span><span class="builtintype" id="3819113">byte</span><span class="op" id="3819117">,</span>&nbsp;<span class="builtintype" id="3819119">error</span><span class="op" id="3819124">)</span><br>
<span class="lineno"></span><span class="op" id="3819126">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="3819129">//&nbsp;gcmFieldElement&nbsp;represents&nbsp;a&nbsp;value&nbsp;in&nbsp;GF(2¹²⁸).&nbsp;In&nbsp;order&nbsp;to&nbsp;reflect&nbsp;the&nbsp;GCM</span><br>
<span class="lineno"></span><span class="comment" id="3819212">//&nbsp;standard&nbsp;and&nbsp;make&nbsp;getUint64&nbsp;suitable&nbsp;for&nbsp;marshaling&nbsp;these&nbsp;values,&nbsp;the&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="3819290">//&nbsp;are&nbsp;stored&nbsp;backwards.&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="3819328">//&nbsp;&nbsp;&nbsp;the&nbsp;coefficient&nbsp;of&nbsp;x⁰&nbsp;can&nbsp;be&nbsp;obtained&nbsp;by&nbsp;v.low&nbsp;&gt;&gt;&nbsp;63.</span><br>
<span class="lineno">45</span><span class="comment" id="3819389">//&nbsp;&nbsp;&nbsp;the&nbsp;coefficient&nbsp;of&nbsp;x⁶³&nbsp;can&nbsp;be&nbsp;obtained&nbsp;by&nbsp;v.low&nbsp;&amp;&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="3819450">//&nbsp;&nbsp;&nbsp;the&nbsp;coefficient&nbsp;of&nbsp;x⁶⁴&nbsp;can&nbsp;be&nbsp;obtained&nbsp;by&nbsp;v.high&nbsp;&gt;&gt;&nbsp;63.</span><br>
<span class="lineno"></span><span class="comment" id="3819515">//&nbsp;&nbsp;&nbsp;the&nbsp;coefficient&nbsp;of&nbsp;x¹²⁷&nbsp;can&nbsp;be&nbsp;obtained&nbsp;by&nbsp;v.high&nbsp;&amp;&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="3819579">type</span>&nbsp;<span class="ident" id="3819584">gcmFieldElement</span>&nbsp;<span class="keyword" id="3819600">struct</span>&nbsp;<span class="op" id="3819607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3819610">low</span><span class="op" id="3819613">,</span>&nbsp;<span class="ident" id="3819615">high</span>&nbsp;<span class="ident" id="3819620">uint64</span><br>
<span class="lineno">50</span><span class="op" id="3819627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3819630">//&nbsp;gcm&nbsp;represents&nbsp;a&nbsp;Galois&nbsp;Counter&nbsp;Mode&nbsp;with&nbsp;a&nbsp;specific&nbsp;key.&nbsp;See</span><br>
<span class="lineno"></span><span class="comment" id="3819695">//&nbsp;http://csrc.nist.gov/groups/ST/toolkit/BCM/documents/proposedmodes/gcm/gcm-revised-spec.pdf</span><br>
<span class="lineno"></span><span class="keyword" id="3819790">type</span>&nbsp;<span class="ident" id="3819795">gcm</span>&nbsp;<span class="keyword" id="3819799">struct</span>&nbsp;<span class="op" id="3819806">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3819809">cipher</span>&nbsp;<span class="ident" id="3819816">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3819823">//&nbsp;productTable&nbsp;contains&nbsp;the&nbsp;first&nbsp;sixteen&nbsp;powers&nbsp;of&nbsp;the&nbsp;key,&nbsp;H.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3819889">//&nbsp;However,&nbsp;they&nbsp;are&nbsp;in&nbsp;bit&nbsp;reversed&nbsp;order.&nbsp;See&nbsp;NewGCM.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3819946">productTable</span>&nbsp;<span class="op" id="3819959">[</span><span class="num" id="3819960">16</span><span class="op" id="3819962">]</span><span class="ident" id="3819963">gcmFieldElement</span><br>
<span class="lineno"></span><span class="op" id="3819979">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="3819982">//&nbsp;NewGCM&nbsp;returns&nbsp;the&nbsp;given&nbsp;128-bit,&nbsp;block&nbsp;cipher&nbsp;wrapped&nbsp;in&nbsp;Galois&nbsp;Counter&nbsp;Mode.</span><br>
<span class="lineno"></span><span class="keyword" id="3820064">func</span>&nbsp;<span class="ident" id="3820069">NewGCM</span><span class="op" id="3820075">(</span><span class="ident" id="3820076">cipher</span>&nbsp;<span class="ident" id="3820083">Block</span><span class="op" id="3820088">)</span>&nbsp;<span class="op" id="3820090">(</span><span class="ident" id="3820091">AEAD</span><span class="op" id="3820095">,</span>&nbsp;<span class="builtintype" id="3820097">error</span><span class="op" id="3820102">)</span>&nbsp;<span class="op" id="3820104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820107">if</span>&nbsp;<span class="ident" id="3820110">cipher</span><span class="op" id="3820116">.</span><span class="ident" id="3820117">BlockSize</span><span class="op" id="3820126">(</span><span class="op" id="3820127">)</span>&nbsp;<span class="op" id="3820129">!=</span>&nbsp;<span class="ident" id="3820132">gcmBlockSize</span>&nbsp;<span class="op" id="3820145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820149">return</span>&nbsp;<span class="ident" id="3820156">nil</span><span class="op" id="3820159">,</span>&nbsp;<span class="ident" id="3820161">errors</span><span class="op" id="3820167">.</span><span class="ident" id="3820168">New</span><span class="op" id="3820171">(</span><span class="string" id="3820172">&#34;cipher:&nbsp;NewGCM&nbsp;requires&nbsp;128-bit&nbsp;block&nbsp;cipher&#34;</span><span class="op" id="3820218">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3820221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820225">var</span>&nbsp;<span class="ident" id="3820229">key</span>&nbsp;<span class="op" id="3820233">[</span><span class="ident" id="3820234">gcmBlockSize</span><span class="op" id="3820246">]</span><span class="builtintype" id="3820247">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820253">cipher</span><span class="op" id="3820259">.</span><span class="ident" id="3820260">Encrypt</span><span class="op" id="3820267">(</span><span class="ident" id="3820268">key</span><span class="op" id="3820271">[</span><span class="op" id="3820272">:</span><span class="op" id="3820273">]</span><span class="op" id="3820274">,</span>&nbsp;<span class="ident" id="3820276">key</span><span class="op" id="3820279">[</span><span class="op" id="3820280">:</span><span class="op" id="3820281">]</span><span class="op" id="3820282">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820286">g</span>&nbsp;<span class="op" id="3820288">:=</span>&nbsp;<span class="op" id="3820291">&amp;</span><span class="ident" id="3820292">gcm</span><span class="op" id="3820295">{</span><span class="ident" id="3820296">cipher</span><span class="op" id="3820302">:</span>&nbsp;<span class="ident" id="3820304">cipher</span><span class="op" id="3820310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3820314">//&nbsp;We&nbsp;precompute&nbsp;16&nbsp;multiples&nbsp;of&nbsp;|key|.&nbsp;However,&nbsp;when&nbsp;we&nbsp;do&nbsp;lookups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3820383">//&nbsp;into&nbsp;this&nbsp;table&nbsp;we&#39;ll&nbsp;be&nbsp;using&nbsp;bits&nbsp;from&nbsp;a&nbsp;field&nbsp;element&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3820448">//&nbsp;therefore&nbsp;the&nbsp;bits&nbsp;will&nbsp;be&nbsp;in&nbsp;the&nbsp;reverse&nbsp;order.&nbsp;So&nbsp;normally&nbsp;one</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3820517">//&nbsp;would&nbsp;expect,&nbsp;say,&nbsp;4*key&nbsp;to&nbsp;be&nbsp;in&nbsp;index&nbsp;4&nbsp;of&nbsp;the&nbsp;table&nbsp;but&nbsp;due&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3820587">//&nbsp;this&nbsp;bit&nbsp;ordering&nbsp;it&nbsp;will&nbsp;actually&nbsp;be&nbsp;in&nbsp;index&nbsp;0010&nbsp;(base&nbsp;2)&nbsp;=&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820657">x</span>&nbsp;<span class="op" id="3820659">:=</span>&nbsp;<span class="ident" id="3820662">gcmFieldElement</span><span class="op" id="3820677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820681">getUint64</span><span class="op" id="3820690">(</span><span class="ident" id="3820691">key</span><span class="op" id="3820694">[</span><span class="op" id="3820695">:</span><span class="num" id="3820696">8</span><span class="op" id="3820697">]</span><span class="op" id="3820698">)</span><span class="op" id="3820699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820703">getUint64</span><span class="op" id="3820712">(</span><span class="ident" id="3820713">key</span><span class="op" id="3820716">[</span><span class="num" id="3820717">8</span><span class="op" id="3820718">:</span><span class="op" id="3820719">]</span><span class="op" id="3820720">)</span><span class="op" id="3820721">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3820724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820727">g</span><span class="op" id="3820728">.</span><span class="ident" id="3820729">productTable</span><span class="op" id="3820741">[</span><span class="ident" id="3820742">reverseBits</span><span class="op" id="3820753">(</span><span class="num" id="3820754">1</span><span class="op" id="3820755">)</span><span class="op" id="3820756">]</span>&nbsp;<span class="op" id="3820758">=</span>&nbsp;<span class="ident" id="3820760">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820764">for</span>&nbsp;<span class="ident" id="3820768">i</span>&nbsp;<span class="op" id="3820770">:=</span>&nbsp;<span class="num" id="3820773">2</span><span class="op" id="3820774">;</span>&nbsp;<span class="ident" id="3820776">i</span>&nbsp;<span class="op" id="3820778">&lt;</span>&nbsp;<span class="num" id="3820780">16</span><span class="op" id="3820782">;</span>&nbsp;<span class="ident" id="3820784">i</span>&nbsp;<span class="op" id="3820786">+=</span>&nbsp;<span class="num" id="3820789">2</span>&nbsp;<span class="op" id="3820791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820795">g</span><span class="op" id="3820796">.</span><span class="ident" id="3820797">productTable</span><span class="op" id="3820809">[</span><span class="ident" id="3820810">reverseBits</span><span class="op" id="3820821">(</span><span class="ident" id="3820822">i</span><span class="op" id="3820823">)</span><span class="op" id="3820824">]</span>&nbsp;<span class="op" id="3820826">=</span>&nbsp;<span class="ident" id="3820828">gcmDouble</span><span class="op" id="3820837">(</span><span class="op" id="3820838">&amp;</span><span class="ident" id="3820839">g</span><span class="op" id="3820840">.</span><span class="ident" id="3820841">productTable</span><span class="op" id="3820853">[</span><span class="ident" id="3820854">reverseBits</span><span class="op" id="3820865">(</span><span class="ident" id="3820866">i</span><span class="op" id="3820867">/</span><span class="num" id="3820868">2</span><span class="op" id="3820869">)</span><span class="op" id="3820870">]</span><span class="op" id="3820871">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820875">g</span><span class="op" id="3820876">.</span><span class="ident" id="3820877">productTable</span><span class="op" id="3820889">[</span><span class="ident" id="3820890">reverseBits</span><span class="op" id="3820901">(</span><span class="ident" id="3820902">i</span><span class="op" id="3820903">+</span><span class="num" id="3820904">1</span><span class="op" id="3820905">)</span><span class="op" id="3820906">]</span>&nbsp;<span class="op" id="3820908">=</span>&nbsp;<span class="ident" id="3820910">gcmAdd</span><span class="op" id="3820916">(</span><span class="op" id="3820917">&amp;</span><span class="ident" id="3820918">g</span><span class="op" id="3820919">.</span><span class="ident" id="3820920">productTable</span><span class="op" id="3820932">[</span><span class="ident" id="3820933">reverseBits</span><span class="op" id="3820944">(</span><span class="ident" id="3820945">i</span><span class="op" id="3820946">)</span><span class="op" id="3820947">]</span><span class="op" id="3820948">,</span>&nbsp;<span class="op" id="3820950">&amp;</span><span class="ident" id="3820951">x</span><span class="op" id="3820952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3820955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820959">return</span>&nbsp;<span class="ident" id="3820966">g</span><span class="op" id="3820967">,</span>&nbsp;<span class="ident" id="3820969">nil</span><br>
<span class="lineno"></span><span class="op" id="3820973">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="3820976">const</span>&nbsp;<span class="op" id="3820982">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820985">gcmBlockSize</span>&nbsp;<span class="op" id="3820998">=</span>&nbsp;<span class="num" id="3821000">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821004">gcmTagSize</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3821017">=</span>&nbsp;<span class="num" id="3821019">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821023">gcmNonceSize</span>&nbsp;<span class="op" id="3821036">=</span>&nbsp;<span class="num" id="3821038">12</span><br>
<span class="lineno">95</span><span class="op" id="3821041">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3821044">func</span>&nbsp;<span class="op" id="3821049">(</span><span class="op" id="3821050">*</span><span class="ident" id="3821051">gcm</span><span class="op" id="3821054">)</span>&nbsp;<span class="ident" id="3821056">NonceSize</span><span class="op" id="3821065">(</span><span class="op" id="3821066">)</span>&nbsp;<span class="builtintype" id="3821068">int</span>&nbsp;<span class="op" id="3821072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821075">return</span>&nbsp;<span class="ident" id="3821082">gcmNonceSize</span><br>
<span class="lineno"></span><span class="op" id="3821095">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="3821098">func</span>&nbsp;<span class="op" id="3821103">(</span><span class="op" id="3821104">*</span><span class="ident" id="3821105">gcm</span><span class="op" id="3821108">)</span>&nbsp;<span class="ident" id="3821110">Overhead</span><span class="op" id="3821118">(</span><span class="op" id="3821119">)</span>&nbsp;<span class="builtintype" id="3821121">int</span>&nbsp;<span class="op" id="3821125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821128">return</span>&nbsp;<span class="ident" id="3821135">gcmTagSize</span><br>
<span class="lineno"></span><span class="op" id="3821146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="3821149">func</span>&nbsp;<span class="op" id="3821154">(</span><span class="ident" id="3821155">g</span>&nbsp;<span class="op" id="3821157">*</span><span class="ident" id="3821158">gcm</span><span class="op" id="3821161">)</span>&nbsp;<span class="ident" id="3821163">Seal</span><span class="op" id="3821167">(</span><span class="ident" id="3821168">dst</span><span class="op" id="3821171">,</span>&nbsp;<span class="ident" id="3821173">nonce</span><span class="op" id="3821178">,</span>&nbsp;<span class="ident" id="3821180">plaintext</span><span class="op" id="3821189">,</span>&nbsp;<span class="ident" id="3821191">data</span>&nbsp;<span class="op" id="3821196">[</span><span class="op" id="3821197">]</span><span class="builtintype" id="3821198">byte</span><span class="op" id="3821202">)</span>&nbsp;<span class="op" id="3821204">[</span><span class="op" id="3821205">]</span><span class="builtintype" id="3821206">byte</span>&nbsp;<span class="op" id="3821211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821214">if</span>&nbsp;<span class="builtinfunc" id="3821217">len</span><span class="op" id="3821220">(</span><span class="ident" id="3821221">nonce</span><span class="op" id="3821226">)</span>&nbsp;<span class="op" id="3821228">!=</span>&nbsp;<span class="ident" id="3821231">gcmNonceSize</span>&nbsp;<span class="op" id="3821244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3821248">panic</span><span class="op" id="3821253">(</span><span class="string" id="3821254">&#34;cipher:&nbsp;incorrect&nbsp;nonce&nbsp;length&nbsp;given&nbsp;to&nbsp;GCM&#34;</span><span class="op" id="3821299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3821302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821306">ret</span><span class="op" id="3821309">,</span>&nbsp;<span class="ident" id="3821311">out</span>&nbsp;<span class="op" id="3821315">:=</span>&nbsp;<span class="ident" id="3821318">sliceForAppend</span><span class="op" id="3821332">(</span><span class="ident" id="3821333">dst</span><span class="op" id="3821336">,</span>&nbsp;<span class="builtinfunc" id="3821338">len</span><span class="op" id="3821341">(</span><span class="ident" id="3821342">plaintext</span><span class="op" id="3821351">)</span><span class="op" id="3821352">+</span><span class="ident" id="3821353">gcmTagSize</span><span class="op" id="3821363">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3821367">//&nbsp;See&nbsp;GCM&nbsp;spec,&nbsp;section&nbsp;7.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821398">var</span>&nbsp;<span class="ident" id="3821402">counter</span><span class="op" id="3821409">,</span>&nbsp;<span class="ident" id="3821411">tagMask</span>&nbsp;<span class="op" id="3821419">[</span><span class="ident" id="3821420">gcmBlockSize</span><span class="op" id="3821432">]</span><span class="builtintype" id="3821433">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3821439">copy</span><span class="op" id="3821443">(</span><span class="ident" id="3821444">counter</span><span class="op" id="3821451">[</span><span class="op" id="3821452">:</span><span class="op" id="3821453">]</span><span class="op" id="3821454">,</span>&nbsp;<span class="ident" id="3821456">nonce</span><span class="op" id="3821461">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821464">counter</span><span class="op" id="3821471">[</span><span class="ident" id="3821472">gcmBlockSize</span><span class="op" id="3821484">-</span><span class="num" id="3821485">1</span><span class="op" id="3821486">]</span>&nbsp;<span class="op" id="3821488">=</span>&nbsp;<span class="num" id="3821490">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821494">g</span><span class="op" id="3821495">.</span><span class="ident" id="3821496">cipher</span><span class="op" id="3821502">.</span><span class="ident" id="3821503">Encrypt</span><span class="op" id="3821510">(</span><span class="ident" id="3821511">tagMask</span><span class="op" id="3821518">[</span><span class="op" id="3821519">:</span><span class="op" id="3821520">]</span><span class="op" id="3821521">,</span>&nbsp;<span class="ident" id="3821523">counter</span><span class="op" id="3821530">[</span><span class="op" id="3821531">:</span><span class="op" id="3821532">]</span><span class="op" id="3821533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821536">gcmInc32</span><span class="op" id="3821544">(</span><span class="op" id="3821545">&amp;</span><span class="ident" id="3821546">counter</span><span class="op" id="3821553">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821557">g</span><span class="op" id="3821558">.</span><span class="ident" id="3821559">counterCrypt</span><span class="op" id="3821571">(</span><span class="ident" id="3821572">out</span><span class="op" id="3821575">,</span>&nbsp;<span class="ident" id="3821577">plaintext</span><span class="op" id="3821586">,</span>&nbsp;<span class="op" id="3821588">&amp;</span><span class="ident" id="3821589">counter</span><span class="op" id="3821596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821599">g</span><span class="op" id="3821600">.</span><span class="ident" id="3821601">auth</span><span class="op" id="3821605">(</span><span class="ident" id="3821606">out</span><span class="op" id="3821609">[</span><span class="builtinfunc" id="3821610">len</span><span class="op" id="3821613">(</span><span class="ident" id="3821614">plaintext</span><span class="op" id="3821623">)</span><span class="op" id="3821624">:</span><span class="op" id="3821625">]</span><span class="op" id="3821626">,</span>&nbsp;<span class="ident" id="3821628">out</span><span class="op" id="3821631">[</span><span class="op" id="3821632">:</span><span class="builtinfunc" id="3821633">len</span><span class="op" id="3821636">(</span><span class="ident" id="3821637">plaintext</span><span class="op" id="3821646">)</span><span class="op" id="3821647">]</span><span class="op" id="3821648">,</span>&nbsp;<span class="ident" id="3821650">data</span><span class="op" id="3821654">,</span>&nbsp;<span class="op" id="3821656">&amp;</span><span class="ident" id="3821657">tagMask</span><span class="op" id="3821664">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821668">return</span>&nbsp;<span class="ident" id="3821675">ret</span><br>
<span class="lineno"></span><span class="op" id="3821679">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="3821682">var</span>&nbsp;<span class="ident" id="3821686">errOpen</span>&nbsp;<span class="op" id="3821694">=</span>&nbsp;<span class="ident" id="3821696">errors</span><span class="op" id="3821702">.</span><span class="ident" id="3821703">New</span><span class="op" id="3821706">(</span><span class="string" id="3821707">&#34;cipher:&nbsp;message&nbsp;authentication&nbsp;failed&#34;</span><span class="op" id="3821746">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3821749">func</span>&nbsp;<span class="op" id="3821754">(</span><span class="ident" id="3821755">g</span>&nbsp;<span class="op" id="3821757">*</span><span class="ident" id="3821758">gcm</span><span class="op" id="3821761">)</span>&nbsp;<span class="ident" id="3821763">Open</span><span class="op" id="3821767">(</span><span class="ident" id="3821768">dst</span><span class="op" id="3821771">,</span>&nbsp;<span class="ident" id="3821773">nonce</span><span class="op" id="3821778">,</span>&nbsp;<span class="ident" id="3821780">ciphertext</span><span class="op" id="3821790">,</span>&nbsp;<span class="ident" id="3821792">data</span>&nbsp;<span class="op" id="3821797">[</span><span class="op" id="3821798">]</span><span class="builtintype" id="3821799">byte</span><span class="op" id="3821803">)</span>&nbsp;<span class="op" id="3821805">(</span><span class="op" id="3821806">[</span><span class="op" id="3821807">]</span><span class="builtintype" id="3821808">byte</span><span class="op" id="3821812">,</span>&nbsp;<span class="builtintype" id="3821814">error</span><span class="op" id="3821819">)</span>&nbsp;<span class="op" id="3821821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821824">if</span>&nbsp;<span class="builtinfunc" id="3821827">len</span><span class="op" id="3821830">(</span><span class="ident" id="3821831">nonce</span><span class="op" id="3821836">)</span>&nbsp;<span class="op" id="3821838">!=</span>&nbsp;<span class="ident" id="3821841">gcmNonceSize</span>&nbsp;<span class="op" id="3821854">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3821858">panic</span><span class="op" id="3821863">(</span><span class="string" id="3821864">&#34;cipher:&nbsp;incorrect&nbsp;nonce&nbsp;length&nbsp;given&nbsp;to&nbsp;GCM&#34;</span><span class="op" id="3821909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3821912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821916">if</span>&nbsp;<span class="builtinfunc" id="3821919">len</span><span class="op" id="3821922">(</span><span class="ident" id="3821923">ciphertext</span><span class="op" id="3821933">)</span>&nbsp;<span class="op" id="3821935">&lt;</span>&nbsp;<span class="ident" id="3821937">gcmTagSize</span>&nbsp;<span class="op" id="3821948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821952">return</span>&nbsp;<span class="ident" id="3821959">nil</span><span class="op" id="3821962">,</span>&nbsp;<span class="ident" id="3821964">errOpen</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3821973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821976">tag</span>&nbsp;<span class="op" id="3821980">:=</span>&nbsp;<span class="ident" id="3821983">ciphertext</span><span class="op" id="3821993">[</span><span class="builtinfunc" id="3821994">len</span><span class="op" id="3821997">(</span><span class="ident" id="3821998">ciphertext</span><span class="op" id="3822008">)</span><span class="op" id="3822009">-</span><span class="ident" id="3822010">gcmTagSize</span><span class="op" id="3822020">:</span><span class="op" id="3822021">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3822024">ciphertext</span>&nbsp;<span class="op" id="3822035">=</span>&nbsp;<span class="ident" id="3822037">ciphertext</span><span class="op" id="3822047">[</span><span class="op" id="3822048">:</span><span class="builtinfunc" id="3822049">len</span><span class="op" id="3822052">(</span><span class="ident" id="3822053">ciphertext</span><span class="op" id="3822063">)</span><span class="op" id="3822064">-</span><span class="ident" id="3822065">gcmTagSize</span><span class="op" id="3822075">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3822079">//&nbsp;See&nbsp;GCM&nbsp;spec,&nbsp;section&nbsp;7.1.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3822110">var</span>&nbsp;<span class="ident" id="3822114">counter</span><span class="op" id="3822121">,</span>&nbsp;<span class="ident" id="3822123">tagMask</span>&nbsp;<span class="op" id="3822131">[</span><span class="ident" id="3822132">gcmBlockSize</span><span class="op" id="3822144">]</span><span class="builtintype" id="3822145">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3822151">copy</span><span class="op" id="3822155">(</span><span class="ident" id="3822156">counter</span><span class="op" id="3822163">[</span><span class="op" id="3822164">:</span><span class="op" id="3822165">]</span><span class="op" id="3822166">,</span>&nbsp;<span class="ident" id="3822168">nonce</span><span class="op" id="3822173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3822176">counter</span><span class="op" id="3822183">[</span><span class="ident" id="3822184">gcmBlockSize</span><span class="op" id="3822196">-</span><span class="num" id="3822197">1</span><span class="op" id="3822198">]</span>&nbsp;<span class="op" id="3822200">=</span>&nbsp;<span class="num" id="3822202">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3822206">g</span><span class="op" id="3822207">.</span><span class="ident" id="3822208">cipher</span><span class="op" id="3822214">.</span><span class="ident" id="3822215">Encrypt</span><span class="op" id="3822222">(</span><span class="ident" id="3822223">tagMask</span><span class="op" id="3822230">[</span><span class="op" id="3822231">:</span><span class="op" id="3822232">]</span><span class="op" id="3822233">,</span>&nbsp;<span class="ident" id="3822235">counter</span><span class="op" id="3822242">[</span><span class="op" id="3822243">:</span><span class="op" id="3822244">]</span><span class="op" id="3822245">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3822248">gcmInc32</span><span class="op" id="3822256">(</span><span class="op" id="3822257">&amp;</span><span class="ident" id="3822258">counter</span><span class="op" id="3822265">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3822269">var</span>&nbsp;<span class="ident" id="3822273">expectedTag</span>&nbsp;<span class="op" id="3822285">[</span><span class="ident" id="3822286">gcmTagSize</span><span class="op" id="3822296">]</span><span class="builtintype" id="3822297">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3822303">g</span><span class="op" id="3822304">.</span><span class="ident" id="3822305">auth</span><span class="op" id="3822309">(</span><span class="ident" id="3822310">expectedTag</span><span class="op" id="3822321">[</span><span class="op" id="3822322">:</span><span class="op" id="3822323">]</span><span class="op" id="3822324">,</span>&nbsp;<span class="ident" id="3822326">ciphertext</span><span class="op" id="3822336">,</span>&nbsp;<span class="ident" id="3822338">data</span><span class="op" id="3822342">,</span>&nbsp;<span class="op" id="3822344">&amp;</span><span class="ident" id="3822345">tagMask</span><span class="op" id="3822352">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3822356">if</span>&nbsp;<span class="ident" id="3822359">subtle</span><span class="op" id="3822365">.</span><span class="ident" id="3822366">ConstantTimeCompare</span><span class="op" id="3822385">(</span><span class="ident" id="3822386">expectedTag</span><span class="op" id="3822397">[</span><span class="op" id="3822398">:</span><span class="op" id="3822399">]</span><span class="op" id="3822400">,</span>&nbsp;<span class="ident" id="3822402">tag</span><span class="op" id="3822405">)</span>&nbsp;<span class="op" id="3822407">!=</span>&nbsp;<span class="num" id="3822410">1</span>&nbsp;<span class="op" id="3822412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3822416">return</span>&nbsp;<span class="ident" id="3822423">nil</span><span class="op" id="3822426">,</span>&nbsp;<span class="ident" id="3822428">errOpen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3822437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3822441">ret</span><span class="op" id="3822444">,</span>&nbsp;<span class="ident" id="3822446">out</span>&nbsp;<span class="op" id="3822450">:=</span>&nbsp;<span class="ident" id="3822453">sliceForAppend</span><span class="op" id="3822467">(</span><span class="ident" id="3822468">dst</span><span class="op" id="3822471">,</span>&nbsp;<span class="builtinfunc" id="3822473">len</span><span class="op" id="3822476">(</span><span class="ident" id="3822477">ciphertext</span><span class="op" id="3822487">)</span><span class="op" id="3822488">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3822491">g</span><span class="op" id="3822492">.</span><span class="ident" id="3822493">counterCrypt</span><span class="op" id="3822505">(</span><span class="ident" id="3822506">out</span><span class="op" id="3822509">,</span>&nbsp;<span class="ident" id="3822511">ciphertext</span><span class="op" id="3822521">,</span>&nbsp;<span class="op" id="3822523">&amp;</span><span class="ident" id="3822524">counter</span><span class="op" id="3822531">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3822535">return</span>&nbsp;<span class="ident" id="3822542">ret</span><span class="op" id="3822545">,</span>&nbsp;<span class="ident" id="3822547">nil</span><br>
<span class="lineno"></span><span class="op" id="3822551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="3822554">//&nbsp;reverseBits&nbsp;reverses&nbsp;the&nbsp;order&nbsp;of&nbsp;the&nbsp;bits&nbsp;of&nbsp;4-bit&nbsp;number&nbsp;in&nbsp;i.</span><br>
<span class="lineno"></span><span class="keyword" id="3822622">func</span>&nbsp;<span class="ident" id="3822627">reverseBits</span><span class="op" id="3822638">(</span><span class="ident" id="3822639">i</span>&nbsp;<span class="builtintype" id="3822641">int</span><span class="op" id="3822644">)</span>&nbsp;<span class="builtintype" id="3822646">int</span>&nbsp;<span class="op" id="3822650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3822653">i</span>&nbsp;<span class="op" id="3822655">=</span>&nbsp;<span class="op" id="3822657">(</span><span class="op" id="3822658">(</span><span class="ident" id="3822659">i</span>&nbsp;<span class="op" id="3822661">&lt;&lt;</span>&nbsp;<span class="num" id="3822664">2</span><span class="op" id="3822665">)</span>&nbsp;<span class="op" id="3822667">&amp;</span>&nbsp;<span class="num" id="3822669">0xc</span><span class="op" id="3822672">)</span>&nbsp;<span class="op" id="3822674">|</span>&nbsp;<span class="op" id="3822676">(</span><span class="op" id="3822677">(</span><span class="ident" id="3822678">i</span>&nbsp;<span class="op" id="3822680">&gt;&gt;</span>&nbsp;<span class="num" id="3822683">2</span><span class="op" id="3822684">)</span>&nbsp;<span class="op" id="3822686">&amp;</span>&nbsp;<span class="num" id="3822688">0x3</span><span class="op" id="3822691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3822694">i</span>&nbsp;<span class="op" id="3822696">=</span>&nbsp;<span class="op" id="3822698">(</span><span class="op" id="3822699">(</span><span class="ident" id="3822700">i</span>&nbsp;<span class="op" id="3822702">&lt;&lt;</span>&nbsp;<span class="num" id="3822705">1</span><span class="op" id="3822706">)</span>&nbsp;<span class="op" id="3822708">&amp;</span>&nbsp;<span class="num" id="3822710">0xa</span><span class="op" id="3822713">)</span>&nbsp;<span class="op" id="3822715">|</span>&nbsp;<span class="op" id="3822717">(</span><span class="op" id="3822718">(</span><span class="ident" id="3822719">i</span>&nbsp;<span class="op" id="3822721">&gt;&gt;</span>&nbsp;<span class="num" id="3822724">1</span><span class="op" id="3822725">)</span>&nbsp;<span class="op" id="3822727">&amp;</span>&nbsp;<span class="num" id="3822729">0x5</span><span class="op" id="3822732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3822735">return</span>&nbsp;<span class="ident" id="3822742">i</span><br>
<span class="lineno">165</span><span class="op" id="3822744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3822747">//&nbsp;gcmAdd&nbsp;adds&nbsp;two&nbsp;elements&nbsp;of&nbsp;GF(2¹²⁸)&nbsp;and&nbsp;returns&nbsp;the&nbsp;sum.</span><br>
<span class="lineno"></span><span class="keyword" id="3822812">func</span>&nbsp;<span class="ident" id="3822817">gcmAdd</span><span class="op" id="3822823">(</span><span class="ident" id="3822824">x</span><span class="op" id="3822825">,</span>&nbsp;<span class="ident" id="3822827">y</span>&nbsp;<span class="op" id="3822829">*</span><span class="ident" id="3822830">gcmFieldElement</span><span class="op" id="3822845">)</span>&nbsp;<span class="ident" id="3822847">gcmFieldElement</span>&nbsp;<span class="op" id="3822863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3822866">//&nbsp;Addition&nbsp;in&nbsp;a&nbsp;characteristic&nbsp;2&nbsp;field&nbsp;is&nbsp;just&nbsp;XOR.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3822920">return</span>&nbsp;<span class="ident" id="3822927">gcmFieldElement</span><span class="op" id="3822942">{</span><span class="ident" id="3822943">x</span><span class="op" id="3822944">.</span><span class="ident" id="3822945">low</span>&nbsp;<span class="op" id="3822949">^</span>&nbsp;<span class="ident" id="3822951">y</span><span class="op" id="3822952">.</span><span class="ident" id="3822953">low</span><span class="op" id="3822956">,</span>&nbsp;<span class="ident" id="3822958">x</span><span class="op" id="3822959">.</span><span class="ident" id="3822960">high</span>&nbsp;<span class="op" id="3822965">^</span>&nbsp;<span class="ident" id="3822967">y</span><span class="op" id="3822968">.</span><span class="ident" id="3822969">high</span><span class="op" id="3822973">}</span><br>
<span class="lineno"></span><span class="op" id="3822975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3822978">//&nbsp;gcmDouble&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;doubling&nbsp;an&nbsp;element&nbsp;of&nbsp;GF(2¹²⁸).</span><br>
<span class="lineno"></span><span class="keyword" id="3823050">func</span>&nbsp;<span class="ident" id="3823055">gcmDouble</span><span class="op" id="3823064">(</span><span class="ident" id="3823065">x</span>&nbsp;<span class="op" id="3823067">*</span><span class="ident" id="3823068">gcmFieldElement</span><span class="op" id="3823083">)</span>&nbsp;<span class="op" id="3823085">(</span><span class="ident" id="3823086">double</span>&nbsp;<span class="ident" id="3823093">gcmFieldElement</span><span class="op" id="3823108">)</span>&nbsp;<span class="op" id="3823110">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823113">msbSet</span>&nbsp;<span class="op" id="3823120">:=</span>&nbsp;<span class="ident" id="3823123">x</span><span class="op" id="3823124">.</span><span class="ident" id="3823125">high</span><span class="op" id="3823129">&amp;</span><span class="num" id="3823130">1</span>&nbsp;<span class="op" id="3823132">==</span>&nbsp;<span class="num" id="3823135">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3823139">//&nbsp;Because&nbsp;of&nbsp;the&nbsp;bit-ordering,&nbsp;doubling&nbsp;is&nbsp;actually&nbsp;a&nbsp;right&nbsp;shift.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823208">double</span><span class="op" id="3823214">.</span><span class="ident" id="3823215">high</span>&nbsp;<span class="op" id="3823220">=</span>&nbsp;<span class="ident" id="3823222">x</span><span class="op" id="3823223">.</span><span class="ident" id="3823224">high</span>&nbsp;<span class="op" id="3823229">&gt;&gt;</span>&nbsp;<span class="num" id="3823232">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823235">double</span><span class="op" id="3823241">.</span><span class="ident" id="3823242">high</span>&nbsp;<span class="op" id="3823247">|=</span>&nbsp;<span class="ident" id="3823250">x</span><span class="op" id="3823251">.</span><span class="ident" id="3823252">low</span>&nbsp;<span class="op" id="3823256">&lt;&lt;</span>&nbsp;<span class="num" id="3823259">63</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823263">double</span><span class="op" id="3823269">.</span><span class="ident" id="3823270">low</span>&nbsp;<span class="op" id="3823274">=</span>&nbsp;<span class="ident" id="3823276">x</span><span class="op" id="3823277">.</span><span class="ident" id="3823278">low</span>&nbsp;<span class="op" id="3823282">&gt;&gt;</span>&nbsp;<span class="num" id="3823285">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3823289">//&nbsp;If&nbsp;the&nbsp;most-significant&nbsp;bit&nbsp;was&nbsp;set&nbsp;before&nbsp;shifting&nbsp;then&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3823354">//&nbsp;conceptually,&nbsp;becomes&nbsp;a&nbsp;term&nbsp;of&nbsp;x^128.&nbsp;This&nbsp;is&nbsp;greater&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3823422">//&nbsp;irreducible&nbsp;polynomial&nbsp;so&nbsp;the&nbsp;result&nbsp;has&nbsp;to&nbsp;be&nbsp;reduced.&nbsp;The</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3823486">//&nbsp;irreducible&nbsp;polynomial&nbsp;is&nbsp;1+x+x^2+x^7+x^128.&nbsp;We&nbsp;can&nbsp;subtract&nbsp;that&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3823559">//&nbsp;eliminate&nbsp;the&nbsp;term&nbsp;at&nbsp;x^128&nbsp;which&nbsp;also&nbsp;means&nbsp;subtracting&nbsp;the&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3823630">//&nbsp;four&nbsp;terms.&nbsp;In&nbsp;characteristic&nbsp;2&nbsp;fields,&nbsp;subtraction&nbsp;==&nbsp;addition&nbsp;==</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3823701">//&nbsp;XOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823710">if</span>&nbsp;<span class="ident" id="3823713">msbSet</span>&nbsp;<span class="op" id="3823720">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823724">double</span><span class="op" id="3823730">.</span><span class="ident" id="3823731">low</span>&nbsp;<span class="op" id="3823735">^=</span>&nbsp;<span class="num" id="3823738">0xe100000000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3823758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823762">return</span><br>
<span class="lineno"></span><span class="op" id="3823769">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="3823772">var</span>&nbsp;<span class="ident" id="3823776">gcmReductionTable</span>&nbsp;<span class="op" id="3823794">=</span>&nbsp;<span class="op" id="3823796">[</span><span class="op" id="3823797">]</span><span class="builtintype" id="3823798">uint16</span><span class="op" id="3823804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3823807">0x0000</span><span class="op" id="3823813">,</span>&nbsp;<span class="num" id="3823815">0x1c20</span><span class="op" id="3823821">,</span>&nbsp;<span class="num" id="3823823">0x3840</span><span class="op" id="3823829">,</span>&nbsp;<span class="num" id="3823831">0x2460</span><span class="op" id="3823837">,</span>&nbsp;<span class="num" id="3823839">0x7080</span><span class="op" id="3823845">,</span>&nbsp;<span class="num" id="3823847">0x6ca0</span><span class="op" id="3823853">,</span>&nbsp;<span class="num" id="3823855">0x48c0</span><span class="op" id="3823861">,</span>&nbsp;<span class="num" id="3823863">0x54e0</span><span class="op" id="3823869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3823872">0xe100</span><span class="op" id="3823878">,</span>&nbsp;<span class="num" id="3823880">0xfd20</span><span class="op" id="3823886">,</span>&nbsp;<span class="num" id="3823888">0xd940</span><span class="op" id="3823894">,</span>&nbsp;<span class="num" id="3823896">0xc560</span><span class="op" id="3823902">,</span>&nbsp;<span class="num" id="3823904">0x9180</span><span class="op" id="3823910">,</span>&nbsp;<span class="num" id="3823912">0x8da0</span><span class="op" id="3823918">,</span>&nbsp;<span class="num" id="3823920">0xa9c0</span><span class="op" id="3823926">,</span>&nbsp;<span class="num" id="3823928">0xb5e0</span><span class="op" id="3823934">,</span><br>
<span class="lineno"></span><span class="op" id="3823936">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="3823939">//&nbsp;mul&nbsp;sets&nbsp;y&nbsp;to&nbsp;y*H,&nbsp;where&nbsp;H&nbsp;is&nbsp;the&nbsp;GCM&nbsp;key,&nbsp;fixed&nbsp;during&nbsp;NewGCM.</span><br>
<span class="lineno"></span><span class="keyword" id="3824006">func</span>&nbsp;<span class="op" id="3824011">(</span><span class="ident" id="3824012">g</span>&nbsp;<span class="op" id="3824014">*</span><span class="ident" id="3824015">gcm</span><span class="op" id="3824018">)</span>&nbsp;<span class="ident" id="3824020">mul</span><span class="op" id="3824023">(</span><span class="ident" id="3824024">y</span>&nbsp;<span class="op" id="3824026">*</span><span class="ident" id="3824027">gcmFieldElement</span><span class="op" id="3824042">)</span>&nbsp;<span class="op" id="3824044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824047">var</span>&nbsp;<span class="ident" id="3824051">z</span>&nbsp;<span class="ident" id="3824053">gcmFieldElement</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824071">for</span>&nbsp;<span class="ident" id="3824075">i</span>&nbsp;<span class="op" id="3824077">:=</span>&nbsp;<span class="num" id="3824080">0</span><span class="op" id="3824081">;</span>&nbsp;<span class="ident" id="3824083">i</span>&nbsp;<span class="op" id="3824085">&lt;</span>&nbsp;<span class="num" id="3824087">2</span><span class="op" id="3824088">;</span>&nbsp;<span class="ident" id="3824090">i</span><span class="op" id="3824091">++</span>&nbsp;<span class="op" id="3824094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824098">word</span>&nbsp;<span class="op" id="3824103">:=</span>&nbsp;<span class="ident" id="3824106">y</span><span class="op" id="3824107">.</span><span class="ident" id="3824108">high</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824115">if</span>&nbsp;<span class="ident" id="3824118">i</span>&nbsp;<span class="op" id="3824120">==</span>&nbsp;<span class="num" id="3824123">1</span>&nbsp;<span class="op" id="3824125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824130">word</span>&nbsp;<span class="op" id="3824135">=</span>&nbsp;<span class="ident" id="3824137">y</span><span class="op" id="3824138">.</span><span class="ident" id="3824139">low</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3824145">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3824150">//&nbsp;Multiplication&nbsp;works&nbsp;by&nbsp;multiplying&nbsp;z&nbsp;by&nbsp;16&nbsp;and&nbsp;adding&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3824213">//&nbsp;one&nbsp;of&nbsp;the&nbsp;precomputed&nbsp;multiples&nbsp;of&nbsp;H.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824257">for</span>&nbsp;<span class="ident" id="3824261">j</span>&nbsp;<span class="op" id="3824263">:=</span>&nbsp;<span class="num" id="3824266">0</span><span class="op" id="3824267">;</span>&nbsp;<span class="ident" id="3824269">j</span>&nbsp;<span class="op" id="3824271">&lt;</span>&nbsp;<span class="num" id="3824273">64</span><span class="op" id="3824275">;</span>&nbsp;<span class="ident" id="3824277">j</span>&nbsp;<span class="op" id="3824279">+=</span>&nbsp;<span class="num" id="3824282">4</span>&nbsp;<span class="op" id="3824284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824289">msw</span>&nbsp;<span class="op" id="3824293">:=</span>&nbsp;<span class="ident" id="3824296">z</span><span class="op" id="3824297">.</span><span class="ident" id="3824298">high</span>&nbsp;<span class="op" id="3824303">&amp;</span>&nbsp;<span class="num" id="3824305">0xf</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824312">z</span><span class="op" id="3824313">.</span><span class="ident" id="3824314">high</span>&nbsp;<span class="op" id="3824319">&gt;&gt;=</span>&nbsp;<span class="num" id="3824323">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824328">z</span><span class="op" id="3824329">.</span><span class="ident" id="3824330">high</span>&nbsp;<span class="op" id="3824335">|=</span>&nbsp;<span class="ident" id="3824338">z</span><span class="op" id="3824339">.</span><span class="ident" id="3824340">low</span>&nbsp;<span class="op" id="3824344">&lt;&lt;</span>&nbsp;<span class="num" id="3824347">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824353">z</span><span class="op" id="3824354">.</span><span class="ident" id="3824355">low</span>&nbsp;<span class="op" id="3824359">&gt;&gt;=</span>&nbsp;<span class="num" id="3824363">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824368">z</span><span class="op" id="3824369">.</span><span class="ident" id="3824370">low</span>&nbsp;<span class="op" id="3824374">^=</span>&nbsp;<span class="ident" id="3824377">uint64</span><span class="op" id="3824383">(</span><span class="ident" id="3824384">gcmReductionTable</span><span class="op" id="3824401">[</span><span class="ident" id="3824402">msw</span><span class="op" id="3824405">]</span><span class="op" id="3824406">)</span>&nbsp;<span class="op" id="3824408">&lt;&lt;</span>&nbsp;<span class="num" id="3824411">48</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3824418">//&nbsp;the&nbsp;values&nbsp;in&nbsp;|table|&nbsp;are&nbsp;ordered&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3824462">//&nbsp;little-endian&nbsp;bit&nbsp;positions.&nbsp;See&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3824513">//&nbsp;in&nbsp;NewGCM.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824530">t</span>&nbsp;<span class="op" id="3824532">:=</span>&nbsp;<span class="op" id="3824535">&amp;</span><span class="ident" id="3824536">g</span><span class="op" id="3824537">.</span><span class="ident" id="3824538">productTable</span><span class="op" id="3824550">[</span><span class="ident" id="3824551">word</span><span class="op" id="3824555">&amp;</span><span class="num" id="3824556">0xf</span><span class="op" id="3824559">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824565">z</span><span class="op" id="3824566">.</span><span class="ident" id="3824567">low</span>&nbsp;<span class="op" id="3824571">^=</span>&nbsp;<span class="ident" id="3824574">t</span><span class="op" id="3824575">.</span><span class="ident" id="3824576">low</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824583">z</span><span class="op" id="3824584">.</span><span class="ident" id="3824585">high</span>&nbsp;<span class="op" id="3824590">^=</span>&nbsp;<span class="ident" id="3824593">t</span><span class="op" id="3824594">.</span><span class="ident" id="3824595">high</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824603">word</span>&nbsp;<span class="op" id="3824608">&gt;&gt;=</span>&nbsp;<span class="num" id="3824612">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3824616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3824619">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3824623">*</span><span class="ident" id="3824624">y</span>&nbsp;<span class="op" id="3824626">=</span>&nbsp;<span class="ident" id="3824628">z</span><br>
<span class="lineno"></span><span class="op" id="3824630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3824633">//&nbsp;updateBlocks&nbsp;extends&nbsp;y&nbsp;with&nbsp;more&nbsp;polynomial&nbsp;terms&nbsp;from&nbsp;blocks,&nbsp;based&nbsp;on</span><br>
<span class="lineno">235</span><span class="comment" id="3824708">//&nbsp;Horner&#39;s&nbsp;rule.&nbsp;There&nbsp;must&nbsp;be&nbsp;a&nbsp;multiple&nbsp;of&nbsp;gcmBlockSize&nbsp;bytes&nbsp;in&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="3824784">func</span>&nbsp;<span class="op" id="3824789">(</span><span class="ident" id="3824790">g</span>&nbsp;<span class="op" id="3824792">*</span><span class="ident" id="3824793">gcm</span><span class="op" id="3824796">)</span>&nbsp;<span class="ident" id="3824798">updateBlocks</span><span class="op" id="3824810">(</span><span class="ident" id="3824811">y</span>&nbsp;<span class="op" id="3824813">*</span><span class="ident" id="3824814">gcmFieldElement</span><span class="op" id="3824829">,</span>&nbsp;<span class="ident" id="3824831">blocks</span>&nbsp;<span class="op" id="3824838">[</span><span class="op" id="3824839">]</span><span class="builtintype" id="3824840">byte</span><span class="op" id="3824844">)</span>&nbsp;<span class="op" id="3824846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824849">for</span>&nbsp;<span class="builtinfunc" id="3824853">len</span><span class="op" id="3824856">(</span><span class="ident" id="3824857">blocks</span><span class="op" id="3824863">)</span>&nbsp;<span class="op" id="3824865">&gt;</span>&nbsp;<span class="num" id="3824867">0</span>&nbsp;<span class="op" id="3824869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824873">y</span><span class="op" id="3824874">.</span><span class="ident" id="3824875">low</span>&nbsp;<span class="op" id="3824879">^=</span>&nbsp;<span class="ident" id="3824882">getUint64</span><span class="op" id="3824891">(</span><span class="ident" id="3824892">blocks</span><span class="op" id="3824898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824902">y</span><span class="op" id="3824903">.</span><span class="ident" id="3824904">high</span>&nbsp;<span class="op" id="3824909">^=</span>&nbsp;<span class="ident" id="3824912">getUint64</span><span class="op" id="3824921">(</span><span class="ident" id="3824922">blocks</span><span class="op" id="3824928">[</span><span class="num" id="3824929">8</span><span class="op" id="3824930">:</span><span class="op" id="3824931">]</span><span class="op" id="3824932">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824936">g</span><span class="op" id="3824937">.</span><span class="ident" id="3824938">mul</span><span class="op" id="3824941">(</span><span class="ident" id="3824942">y</span><span class="op" id="3824943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824947">blocks</span>&nbsp;<span class="op" id="3824954">=</span>&nbsp;<span class="ident" id="3824956">blocks</span><span class="op" id="3824962">[</span><span class="ident" id="3824963">gcmBlockSize</span><span class="op" id="3824975">:</span><span class="op" id="3824976">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3824979">}</span><br>
<span class="lineno"></span><span class="op" id="3824981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="3824984">//&nbsp;update&nbsp;extends&nbsp;y&nbsp;with&nbsp;more&nbsp;polynomial&nbsp;terms&nbsp;from&nbsp;data.&nbsp;If&nbsp;data&nbsp;is&nbsp;not&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3825059">//&nbsp;multiple&nbsp;of&nbsp;gcmBlockSize&nbsp;bytes&nbsp;long&nbsp;then&nbsp;the&nbsp;remainder&nbsp;is&nbsp;zero&nbsp;padded.</span><br>
<span class="lineno"></span><span class="keyword" id="3825133">func</span>&nbsp;<span class="op" id="3825138">(</span><span class="ident" id="3825139">g</span>&nbsp;<span class="op" id="3825141">*</span><span class="ident" id="3825142">gcm</span><span class="op" id="3825145">)</span>&nbsp;<span class="ident" id="3825147">update</span><span class="op" id="3825153">(</span><span class="ident" id="3825154">y</span>&nbsp;<span class="op" id="3825156">*</span><span class="ident" id="3825157">gcmFieldElement</span><span class="op" id="3825172">,</span>&nbsp;<span class="ident" id="3825174">data</span>&nbsp;<span class="op" id="3825179">[</span><span class="op" id="3825180">]</span><span class="builtintype" id="3825181">byte</span><span class="op" id="3825185">)</span>&nbsp;<span class="op" id="3825187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825190">fullBlocks</span>&nbsp;<span class="op" id="3825201">:=</span>&nbsp;<span class="op" id="3825204">(</span><span class="builtinfunc" id="3825205">len</span><span class="op" id="3825208">(</span><span class="ident" id="3825209">data</span><span class="op" id="3825213">)</span>&nbsp;<span class="op" id="3825215">&gt;&gt;</span>&nbsp;<span class="num" id="3825218">4</span><span class="op" id="3825219">)</span>&nbsp;<span class="op" id="3825221">&lt;&lt;</span>&nbsp;<span class="num" id="3825224">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825227">g</span><span class="op" id="3825228">.</span><span class="ident" id="3825229">updateBlocks</span><span class="op" id="3825241">(</span><span class="ident" id="3825242">y</span><span class="op" id="3825243">,</span>&nbsp;<span class="ident" id="3825245">data</span><span class="op" id="3825249">[</span><span class="op" id="3825250">:</span><span class="ident" id="3825251">fullBlocks</span><span class="op" id="3825261">]</span><span class="op" id="3825262">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825266">if</span>&nbsp;<span class="builtinfunc" id="3825269">len</span><span class="op" id="3825272">(</span><span class="ident" id="3825273">data</span><span class="op" id="3825277">)</span>&nbsp;<span class="op" id="3825279">!=</span>&nbsp;<span class="ident" id="3825282">fullBlocks</span>&nbsp;<span class="op" id="3825293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825297">var</span>&nbsp;<span class="ident" id="3825301">partialBlock</span>&nbsp;<span class="op" id="3825314">[</span><span class="ident" id="3825315">gcmBlockSize</span><span class="op" id="3825327">]</span><span class="builtintype" id="3825328">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3825335">copy</span><span class="op" id="3825339">(</span><span class="ident" id="3825340">partialBlock</span><span class="op" id="3825352">[</span><span class="op" id="3825353">:</span><span class="op" id="3825354">]</span><span class="op" id="3825355">,</span>&nbsp;<span class="ident" id="3825357">data</span><span class="op" id="3825361">[</span><span class="ident" id="3825362">fullBlocks</span><span class="op" id="3825372">:</span><span class="op" id="3825373">]</span><span class="op" id="3825374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825378">g</span><span class="op" id="3825379">.</span><span class="ident" id="3825380">updateBlocks</span><span class="op" id="3825392">(</span><span class="ident" id="3825393">y</span><span class="op" id="3825394">,</span>&nbsp;<span class="ident" id="3825396">partialBlock</span><span class="op" id="3825408">[</span><span class="op" id="3825409">:</span><span class="op" id="3825410">]</span><span class="op" id="3825411">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3825414">}</span><br>
<span class="lineno"></span><span class="op" id="3825416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3825419">//&nbsp;gcmInc32&nbsp;treats&nbsp;the&nbsp;final&nbsp;four&nbsp;bytes&nbsp;of&nbsp;counterBlock&nbsp;as&nbsp;a&nbsp;big-endian&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3825497">//&nbsp;and&nbsp;increments&nbsp;it.</span><br>
<span class="lineno">260</span><span class="keyword" id="3825519">func</span>&nbsp;<span class="ident" id="3825524">gcmInc32</span><span class="op" id="3825532">(</span><span class="ident" id="3825533">counterBlock</span>&nbsp;<span class="op" id="3825546">*</span><span class="op" id="3825547">[</span><span class="num" id="3825548">16</span><span class="op" id="3825550">]</span><span class="builtintype" id="3825551">byte</span><span class="op" id="3825555">)</span>&nbsp;<span class="op" id="3825557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825560">for</span>&nbsp;<span class="ident" id="3825564">i</span>&nbsp;<span class="op" id="3825566">:=</span>&nbsp;<span class="ident" id="3825569">gcmBlockSize</span>&nbsp;<span class="op" id="3825582">-</span>&nbsp;<span class="num" id="3825584">1</span><span class="op" id="3825585">;</span>&nbsp;<span class="ident" id="3825587">i</span>&nbsp;<span class="op" id="3825589">&gt;=</span>&nbsp;<span class="ident" id="3825592">gcmBlockSize</span><span class="op" id="3825604">-</span><span class="num" id="3825605">4</span><span class="op" id="3825606">;</span>&nbsp;<span class="ident" id="3825608">i</span><span class="op" id="3825609">--</span>&nbsp;<span class="op" id="3825612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825616">counterBlock</span><span class="op" id="3825628">[</span><span class="ident" id="3825629">i</span><span class="op" id="3825630">]</span><span class="op" id="3825631">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825636">if</span>&nbsp;<span class="ident" id="3825639">counterBlock</span><span class="op" id="3825651">[</span><span class="ident" id="3825652">i</span><span class="op" id="3825653">]</span>&nbsp;<span class="op" id="3825655">!=</span>&nbsp;<span class="num" id="3825658">0</span>&nbsp;<span class="op" id="3825660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825665">break</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3825673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3825676">}</span><br>
<span class="lineno"></span><span class="op" id="3825678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3825681">//&nbsp;sliceForAppend&nbsp;takes&nbsp;a&nbsp;slice&nbsp;and&nbsp;a&nbsp;requested&nbsp;number&nbsp;of&nbsp;bytes.&nbsp;It&nbsp;returns&nbsp;a</span><br>
<span class="lineno">270</span><span class="comment" id="3825759">//&nbsp;slice&nbsp;with&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;given&nbsp;slice&nbsp;followed&nbsp;by&nbsp;that&nbsp;many&nbsp;bytes&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3825839">//&nbsp;second&nbsp;slice&nbsp;that&nbsp;aliases&nbsp;into&nbsp;it&nbsp;and&nbsp;contains&nbsp;only&nbsp;the&nbsp;extra&nbsp;bytes.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3825918">//&nbsp;original&nbsp;slice&nbsp;has&nbsp;sufficient&nbsp;capacity&nbsp;then&nbsp;no&nbsp;allocation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="3825993">func</span>&nbsp;<span class="ident" id="3825998">sliceForAppend</span><span class="op" id="3826012">(</span><span class="ident" id="3826013">in</span>&nbsp;<span class="op" id="3826016">[</span><span class="op" id="3826017">]</span><span class="builtintype" id="3826018">byte</span><span class="op" id="3826022">,</span>&nbsp;<span class="ident" id="3826024">n</span>&nbsp;<span class="builtintype" id="3826026">int</span><span class="op" id="3826029">)</span>&nbsp;<span class="op" id="3826031">(</span><span class="ident" id="3826032">head</span><span class="op" id="3826036">,</span>&nbsp;<span class="ident" id="3826038">tail</span>&nbsp;<span class="op" id="3826043">[</span><span class="op" id="3826044">]</span><span class="builtintype" id="3826045">byte</span><span class="op" id="3826049">)</span>&nbsp;<span class="op" id="3826051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826054">if</span>&nbsp;<span class="ident" id="3826057">total</span>&nbsp;<span class="op" id="3826063">:=</span>&nbsp;<span class="builtinfunc" id="3826066">len</span><span class="op" id="3826069">(</span><span class="ident" id="3826070">in</span><span class="op" id="3826072">)</span>&nbsp;<span class="op" id="3826074">+</span>&nbsp;<span class="ident" id="3826076">n</span><span class="op" id="3826077">;</span>&nbsp;<span class="builtinfunc" id="3826079">cap</span><span class="op" id="3826082">(</span><span class="ident" id="3826083">in</span><span class="op" id="3826085">)</span>&nbsp;<span class="op" id="3826087">&gt;=</span>&nbsp;<span class="ident" id="3826090">total</span>&nbsp;<span class="op" id="3826096">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826100">head</span>&nbsp;<span class="op" id="3826105">=</span>&nbsp;<span class="ident" id="3826107">in</span><span class="op" id="3826109">[</span><span class="op" id="3826110">:</span><span class="ident" id="3826111">total</span><span class="op" id="3826116">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3826119">}</span>&nbsp;<span class="keyword" id="3826121">else</span>&nbsp;<span class="op" id="3826126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826130">head</span>&nbsp;<span class="op" id="3826135">=</span>&nbsp;<span class="builtinfunc" id="3826137">make</span><span class="op" id="3826141">(</span><span class="op" id="3826142">[</span><span class="op" id="3826143">]</span><span class="builtintype" id="3826144">byte</span><span class="op" id="3826148">,</span>&nbsp;<span class="ident" id="3826150">total</span><span class="op" id="3826155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3826159">copy</span><span class="op" id="3826163">(</span><span class="ident" id="3826164">head</span><span class="op" id="3826168">,</span>&nbsp;<span class="ident" id="3826170">in</span><span class="op" id="3826172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3826175">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826178">tail</span>&nbsp;<span class="op" id="3826183">=</span>&nbsp;<span class="ident" id="3826185">head</span><span class="op" id="3826189">[</span><span class="builtinfunc" id="3826190">len</span><span class="op" id="3826193">(</span><span class="ident" id="3826194">in</span><span class="op" id="3826196">)</span><span class="op" id="3826197">:</span><span class="op" id="3826198">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826201">return</span><br>
<span class="lineno"></span><span class="op" id="3826208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3826211">//&nbsp;counterCrypt&nbsp;crypts&nbsp;in&nbsp;to&nbsp;out&nbsp;using&nbsp;g.cipher&nbsp;in&nbsp;counter&nbsp;mode.</span><br>
<span class="lineno">285</span><span class="keyword" id="3826276">func</span>&nbsp;<span class="op" id="3826281">(</span><span class="ident" id="3826282">g</span>&nbsp;<span class="op" id="3826284">*</span><span class="ident" id="3826285">gcm</span><span class="op" id="3826288">)</span>&nbsp;<span class="ident" id="3826290">counterCrypt</span><span class="op" id="3826302">(</span><span class="ident" id="3826303">out</span><span class="op" id="3826306">,</span>&nbsp;<span class="ident" id="3826308">in</span>&nbsp;<span class="op" id="3826311">[</span><span class="op" id="3826312">]</span><span class="builtintype" id="3826313">byte</span><span class="op" id="3826317">,</span>&nbsp;<span class="ident" id="3826319">counter</span>&nbsp;<span class="op" id="3826327">*</span><span class="op" id="3826328">[</span><span class="ident" id="3826329">gcmBlockSize</span><span class="op" id="3826341">]</span><span class="builtintype" id="3826342">byte</span><span class="op" id="3826346">)</span>&nbsp;<span class="op" id="3826348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826351">var</span>&nbsp;<span class="ident" id="3826355">mask</span>&nbsp;<span class="op" id="3826360">[</span><span class="ident" id="3826361">gcmBlockSize</span><span class="op" id="3826373">]</span><span class="builtintype" id="3826374">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826381">for</span>&nbsp;<span class="builtinfunc" id="3826385">len</span><span class="op" id="3826388">(</span><span class="ident" id="3826389">in</span><span class="op" id="3826391">)</span>&nbsp;<span class="op" id="3826393">&gt;=</span>&nbsp;<span class="ident" id="3826396">gcmBlockSize</span>&nbsp;<span class="op" id="3826409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826413">g</span><span class="op" id="3826414">.</span><span class="ident" id="3826415">cipher</span><span class="op" id="3826421">.</span><span class="ident" id="3826422">Encrypt</span><span class="op" id="3826429">(</span><span class="ident" id="3826430">mask</span><span class="op" id="3826434">[</span><span class="op" id="3826435">:</span><span class="op" id="3826436">]</span><span class="op" id="3826437">,</span>&nbsp;<span class="ident" id="3826439">counter</span><span class="op" id="3826446">[</span><span class="op" id="3826447">:</span><span class="op" id="3826448">]</span><span class="op" id="3826449">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826453">gcmInc32</span><span class="op" id="3826461">(</span><span class="ident" id="3826462">counter</span><span class="op" id="3826469">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826474">xorWords</span><span class="op" id="3826482">(</span><span class="ident" id="3826483">out</span><span class="op" id="3826486">,</span>&nbsp;<span class="ident" id="3826488">in</span><span class="op" id="3826490">,</span>&nbsp;<span class="ident" id="3826492">mask</span><span class="op" id="3826496">[</span><span class="op" id="3826497">:</span><span class="op" id="3826498">]</span><span class="op" id="3826499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826503">out</span>&nbsp;<span class="op" id="3826507">=</span>&nbsp;<span class="ident" id="3826509">out</span><span class="op" id="3826512">[</span><span class="ident" id="3826513">gcmBlockSize</span><span class="op" id="3826525">:</span><span class="op" id="3826526">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826530">in</span>&nbsp;<span class="op" id="3826533">=</span>&nbsp;<span class="ident" id="3826535">in</span><span class="op" id="3826537">[</span><span class="ident" id="3826538">gcmBlockSize</span><span class="op" id="3826550">:</span><span class="op" id="3826551">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3826554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826558">if</span>&nbsp;<span class="builtinfunc" id="3826561">len</span><span class="op" id="3826564">(</span><span class="ident" id="3826565">in</span><span class="op" id="3826567">)</span>&nbsp;<span class="op" id="3826569">&gt;</span>&nbsp;<span class="num" id="3826571">0</span>&nbsp;<span class="op" id="3826573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826577">g</span><span class="op" id="3826578">.</span><span class="ident" id="3826579">cipher</span><span class="op" id="3826585">.</span><span class="ident" id="3826586">Encrypt</span><span class="op" id="3826593">(</span><span class="ident" id="3826594">mask</span><span class="op" id="3826598">[</span><span class="op" id="3826599">:</span><span class="op" id="3826600">]</span><span class="op" id="3826601">,</span>&nbsp;<span class="ident" id="3826603">counter</span><span class="op" id="3826610">[</span><span class="op" id="3826611">:</span><span class="op" id="3826612">]</span><span class="op" id="3826613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826617">gcmInc32</span><span class="op" id="3826625">(</span><span class="ident" id="3826626">counter</span><span class="op" id="3826633">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826637">xorBytes</span><span class="op" id="3826645">(</span><span class="ident" id="3826646">out</span><span class="op" id="3826649">,</span>&nbsp;<span class="ident" id="3826651">in</span><span class="op" id="3826653">,</span>&nbsp;<span class="ident" id="3826655">mask</span><span class="op" id="3826659">[</span><span class="op" id="3826660">:</span><span class="op" id="3826661">]</span><span class="op" id="3826662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3826665">}</span><br>
<span class="lineno"></span><span class="op" id="3826667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3826670">//&nbsp;auth&nbsp;calculates&nbsp;GHASH(ciphertext,&nbsp;additionalData),&nbsp;masks&nbsp;the&nbsp;result&nbsp;with</span><br>
<span class="lineno">305</span><span class="comment" id="3826746">//&nbsp;tagMask&nbsp;and&nbsp;writes&nbsp;the&nbsp;result&nbsp;to&nbsp;out.</span><br>
<span class="lineno"></span><span class="keyword" id="3826787">func</span>&nbsp;<span class="op" id="3826792">(</span><span class="ident" id="3826793">g</span>&nbsp;<span class="op" id="3826795">*</span><span class="ident" id="3826796">gcm</span><span class="op" id="3826799">)</span>&nbsp;<span class="ident" id="3826801">auth</span><span class="op" id="3826805">(</span><span class="ident" id="3826806">out</span><span class="op" id="3826809">,</span>&nbsp;<span class="ident" id="3826811">ciphertext</span><span class="op" id="3826821">,</span>&nbsp;<span class="ident" id="3826823">additionalData</span>&nbsp;<span class="op" id="3826838">[</span><span class="op" id="3826839">]</span><span class="builtintype" id="3826840">byte</span><span class="op" id="3826844">,</span>&nbsp;<span class="ident" id="3826846">tagMask</span>&nbsp;<span class="op" id="3826854">*</span><span class="op" id="3826855">[</span><span class="ident" id="3826856">gcmTagSize</span><span class="op" id="3826866">]</span><span class="builtintype" id="3826867">byte</span><span class="op" id="3826871">)</span>&nbsp;<span class="op" id="3826873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826876">var</span>&nbsp;<span class="ident" id="3826880">y</span>&nbsp;<span class="ident" id="3826882">gcmFieldElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826899">g</span><span class="op" id="3826900">.</span><span class="ident" id="3826901">update</span><span class="op" id="3826907">(</span><span class="op" id="3826908">&amp;</span><span class="ident" id="3826909">y</span><span class="op" id="3826910">,</span>&nbsp;<span class="ident" id="3826912">additionalData</span><span class="op" id="3826926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826929">g</span><span class="op" id="3826930">.</span><span class="ident" id="3826931">update</span><span class="op" id="3826937">(</span><span class="op" id="3826938">&amp;</span><span class="ident" id="3826939">y</span><span class="op" id="3826940">,</span>&nbsp;<span class="ident" id="3826942">ciphertext</span><span class="op" id="3826952">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826956">y</span><span class="op" id="3826957">.</span><span class="ident" id="3826958">low</span>&nbsp;<span class="op" id="3826962">^=</span>&nbsp;<span class="ident" id="3826965">uint64</span><span class="op" id="3826971">(</span><span class="builtinfunc" id="3826972">len</span><span class="op" id="3826975">(</span><span class="ident" id="3826976">additionalData</span><span class="op" id="3826990">)</span><span class="op" id="3826991">)</span>&nbsp;<span class="op" id="3826993">*</span>&nbsp;<span class="num" id="3826995">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826998">y</span><span class="op" id="3826999">.</span><span class="ident" id="3827000">high</span>&nbsp;<span class="op" id="3827005">^=</span>&nbsp;<span class="ident" id="3827008">uint64</span><span class="op" id="3827014">(</span><span class="builtinfunc" id="3827015">len</span><span class="op" id="3827018">(</span><span class="ident" id="3827019">ciphertext</span><span class="op" id="3827029">)</span><span class="op" id="3827030">)</span>&nbsp;<span class="op" id="3827032">*</span>&nbsp;<span class="num" id="3827034">8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827038">g</span><span class="op" id="3827039">.</span><span class="ident" id="3827040">mul</span><span class="op" id="3827043">(</span><span class="op" id="3827044">&amp;</span><span class="ident" id="3827045">y</span><span class="op" id="3827046">)</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827050">putUint64</span><span class="op" id="3827059">(</span><span class="ident" id="3827060">out</span><span class="op" id="3827063">,</span>&nbsp;<span class="ident" id="3827065">y</span><span class="op" id="3827066">.</span><span class="ident" id="3827067">low</span><span class="op" id="3827070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827073">putUint64</span><span class="op" id="3827082">(</span><span class="ident" id="3827083">out</span><span class="op" id="3827086">[</span><span class="num" id="3827087">8</span><span class="op" id="3827088">:</span><span class="op" id="3827089">]</span><span class="op" id="3827090">,</span>&nbsp;<span class="ident" id="3827092">y</span><span class="op" id="3827093">.</span><span class="ident" id="3827094">high</span><span class="op" id="3827098">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827102">xorWords</span><span class="op" id="3827110">(</span><span class="ident" id="3827111">out</span><span class="op" id="3827114">,</span>&nbsp;<span class="ident" id="3827116">out</span><span class="op" id="3827119">,</span>&nbsp;<span class="ident" id="3827121">tagMask</span><span class="op" id="3827128">[</span><span class="op" id="3827129">:</span><span class="op" id="3827130">]</span><span class="op" id="3827131">)</span><br>
<span class="lineno">320</span><span class="op" id="3827133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3827136">func</span>&nbsp;<span class="ident" id="3827141">getUint64</span><span class="op" id="3827150">(</span><span class="ident" id="3827151">data</span>&nbsp;<span class="op" id="3827156">[</span><span class="op" id="3827157">]</span><span class="builtintype" id="3827158">byte</span><span class="op" id="3827162">)</span>&nbsp;<span class="ident" id="3827164">uint64</span>&nbsp;<span class="op" id="3827171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827174">r</span>&nbsp;<span class="op" id="3827176">:=</span>&nbsp;<span class="ident" id="3827179">uint64</span><span class="op" id="3827185">(</span><span class="ident" id="3827186">data</span><span class="op" id="3827190">[</span><span class="num" id="3827191">0</span><span class="op" id="3827192">]</span><span class="op" id="3827193">)</span><span class="op" id="3827194">&lt;&lt;</span><span class="num" id="3827196">56</span>&nbsp;<span class="op" id="3827199">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827203">uint64</span><span class="op" id="3827209">(</span><span class="ident" id="3827210">data</span><span class="op" id="3827214">[</span><span class="num" id="3827215">1</span><span class="op" id="3827216">]</span><span class="op" id="3827217">)</span><span class="op" id="3827218">&lt;&lt;</span><span class="num" id="3827220">48</span>&nbsp;<span class="op" id="3827223">|</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827227">uint64</span><span class="op" id="3827233">(</span><span class="ident" id="3827234">data</span><span class="op" id="3827238">[</span><span class="num" id="3827239">2</span><span class="op" id="3827240">]</span><span class="op" id="3827241">)</span><span class="op" id="3827242">&lt;&lt;</span><span class="num" id="3827244">40</span>&nbsp;<span class="op" id="3827247">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827251">uint64</span><span class="op" id="3827257">(</span><span class="ident" id="3827258">data</span><span class="op" id="3827262">[</span><span class="num" id="3827263">3</span><span class="op" id="3827264">]</span><span class="op" id="3827265">)</span><span class="op" id="3827266">&lt;&lt;</span><span class="num" id="3827268">32</span>&nbsp;<span class="op" id="3827271">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827275">uint64</span><span class="op" id="3827281">(</span><span class="ident" id="3827282">data</span><span class="op" id="3827286">[</span><span class="num" id="3827287">4</span><span class="op" id="3827288">]</span><span class="op" id="3827289">)</span><span class="op" id="3827290">&lt;&lt;</span><span class="num" id="3827292">24</span>&nbsp;<span class="op" id="3827295">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827299">uint64</span><span class="op" id="3827305">(</span><span class="ident" id="3827306">data</span><span class="op" id="3827310">[</span><span class="num" id="3827311">5</span><span class="op" id="3827312">]</span><span class="op" id="3827313">)</span><span class="op" id="3827314">&lt;&lt;</span><span class="num" id="3827316">16</span>&nbsp;<span class="op" id="3827319">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827323">uint64</span><span class="op" id="3827329">(</span><span class="ident" id="3827330">data</span><span class="op" id="3827334">[</span><span class="num" id="3827335">6</span><span class="op" id="3827336">]</span><span class="op" id="3827337">)</span><span class="op" id="3827338">&lt;&lt;</span><span class="num" id="3827340">8</span>&nbsp;<span class="op" id="3827342">|</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827346">uint64</span><span class="op" id="3827352">(</span><span class="ident" id="3827353">data</span><span class="op" id="3827357">[</span><span class="num" id="3827358">7</span><span class="op" id="3827359">]</span><span class="op" id="3827360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827363">return</span>&nbsp;<span class="ident" id="3827370">r</span><br>
<span class="lineno"></span><span class="op" id="3827372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3827375">func</span>&nbsp;<span class="ident" id="3827380">putUint64</span><span class="op" id="3827389">(</span><span class="ident" id="3827390">out</span>&nbsp;<span class="op" id="3827394">[</span><span class="op" id="3827395">]</span><span class="builtintype" id="3827396">byte</span><span class="op" id="3827400">,</span>&nbsp;<span class="ident" id="3827402">v</span>&nbsp;<span class="ident" id="3827404">uint64</span><span class="op" id="3827410">)</span>&nbsp;<span class="op" id="3827412">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827415">out</span><span class="op" id="3827418">[</span><span class="num" id="3827419">0</span><span class="op" id="3827420">]</span>&nbsp;<span class="op" id="3827422">=</span>&nbsp;<span class="builtintype" id="3827424">byte</span><span class="op" id="3827428">(</span><span class="ident" id="3827429">v</span>&nbsp;<span class="op" id="3827431">&gt;&gt;</span>&nbsp;<span class="num" id="3827434">56</span><span class="op" id="3827436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827439">out</span><span class="op" id="3827442">[</span><span class="num" id="3827443">1</span><span class="op" id="3827444">]</span>&nbsp;<span class="op" id="3827446">=</span>&nbsp;<span class="builtintype" id="3827448">byte</span><span class="op" id="3827452">(</span><span class="ident" id="3827453">v</span>&nbsp;<span class="op" id="3827455">&gt;&gt;</span>&nbsp;<span class="num" id="3827458">48</span><span class="op" id="3827460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827463">out</span><span class="op" id="3827466">[</span><span class="num" id="3827467">2</span><span class="op" id="3827468">]</span>&nbsp;<span class="op" id="3827470">=</span>&nbsp;<span class="builtintype" id="3827472">byte</span><span class="op" id="3827476">(</span><span class="ident" id="3827477">v</span>&nbsp;<span class="op" id="3827479">&gt;&gt;</span>&nbsp;<span class="num" id="3827482">40</span><span class="op" id="3827484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827487">out</span><span class="op" id="3827490">[</span><span class="num" id="3827491">3</span><span class="op" id="3827492">]</span>&nbsp;<span class="op" id="3827494">=</span>&nbsp;<span class="builtintype" id="3827496">byte</span><span class="op" id="3827500">(</span><span class="ident" id="3827501">v</span>&nbsp;<span class="op" id="3827503">&gt;&gt;</span>&nbsp;<span class="num" id="3827506">32</span><span class="op" id="3827508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827511">out</span><span class="op" id="3827514">[</span><span class="num" id="3827515">4</span><span class="op" id="3827516">]</span>&nbsp;<span class="op" id="3827518">=</span>&nbsp;<span class="builtintype" id="3827520">byte</span><span class="op" id="3827524">(</span><span class="ident" id="3827525">v</span>&nbsp;<span class="op" id="3827527">&gt;&gt;</span>&nbsp;<span class="num" id="3827530">24</span><span class="op" id="3827532">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827535">out</span><span class="op" id="3827538">[</span><span class="num" id="3827539">5</span><span class="op" id="3827540">]</span>&nbsp;<span class="op" id="3827542">=</span>&nbsp;<span class="builtintype" id="3827544">byte</span><span class="op" id="3827548">(</span><span class="ident" id="3827549">v</span>&nbsp;<span class="op" id="3827551">&gt;&gt;</span>&nbsp;<span class="num" id="3827554">16</span><span class="op" id="3827556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827559">out</span><span class="op" id="3827562">[</span><span class="num" id="3827563">6</span><span class="op" id="3827564">]</span>&nbsp;<span class="op" id="3827566">=</span>&nbsp;<span class="builtintype" id="3827568">byte</span><span class="op" id="3827572">(</span><span class="ident" id="3827573">v</span>&nbsp;<span class="op" id="3827575">&gt;&gt;</span>&nbsp;<span class="num" id="3827578">8</span><span class="op" id="3827579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827582">out</span><span class="op" id="3827585">[</span><span class="num" id="3827586">7</span><span class="op" id="3827587">]</span>&nbsp;<span class="op" id="3827589">=</span>&nbsp;<span class="builtintype" id="3827591">byte</span><span class="op" id="3827595">(</span><span class="ident" id="3827596">v</span><span class="op" id="3827597">)</span><br>
<span class="lineno"></span><span class="op" id="3827599">}</span>
</div>
</body>
</html>
