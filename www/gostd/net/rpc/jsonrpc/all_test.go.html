<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7451573">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7451629">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7451683">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7451734">package</span>&nbsp;<span class="ident" id="7451742">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7451751">import</span>&nbsp;<span class="op" id="7451758">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7451761">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7451770">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7451787">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7451797">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7451804">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7451810">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7451823">&#34;net&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7451830">&#34;net/rpc&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7451841">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7451852">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7451862">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7451865">type</span>&nbsp;<span class="ident" id="7451870">Args</span>&nbsp;<span class="keyword" id="7451875">struct</span>&nbsp;<span class="op" id="7451882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451885">A</span><span class="op" id="7451886">,</span>&nbsp;<span class="ident" id="7451888">B</span>&nbsp;<span class="builtintype" id="7451890">int</span><br>
<span class="lineno"></span><span class="op" id="7451894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7451897">type</span>&nbsp;<span class="ident" id="7451902">Reply</span>&nbsp;<span class="keyword" id="7451908">struct</span>&nbsp;<span class="op" id="7451915">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451918">C</span>&nbsp;<span class="builtintype" id="7451920">int</span><br>
<span class="lineno"></span><span class="op" id="7451924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7451927">type</span>&nbsp;<span class="ident" id="7451932">Arith</span>&nbsp;<span class="builtintype" id="7451938">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7451943">type</span>&nbsp;<span class="ident" id="7451948">ArithAddResp</span>&nbsp;<span class="keyword" id="7451961">struct</span>&nbsp;<span class="op" id="7451968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451971">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7451978">interface</span><span class="op" id="7451987">{</span><span class="op" id="7451988">}</span>&nbsp;<span class="string" id="7451990">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452003">Result</span>&nbsp;<span class="ident" id="7452010">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7452022">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452039">Error</span>&nbsp;&nbsp;<span class="keyword" id="7452046">interface</span><span class="op" id="7452055">{</span><span class="op" id="7452056">}</span>&nbsp;<span class="string" id="7452058">`json:&#34;error&#34;`</span><br>
<span class="lineno"></span><span class="op" id="7452073">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="7452076">func</span>&nbsp;<span class="op" id="7452081">(</span><span class="ident" id="7452082">t</span>&nbsp;<span class="op" id="7452084">*</span><span class="ident" id="7452085">Arith</span><span class="op" id="7452090">)</span>&nbsp;<span class="ident" id="7452092">Add</span><span class="op" id="7452095">(</span><span class="ident" id="7452096">args</span>&nbsp;<span class="op" id="7452101">*</span><span class="ident" id="7452102">Args</span><span class="op" id="7452106">,</span>&nbsp;<span class="ident" id="7452108">reply</span>&nbsp;<span class="op" id="7452114">*</span><span class="ident" id="7452115">Reply</span><span class="op" id="7452120">)</span>&nbsp;<span class="builtintype" id="7452122">error</span>&nbsp;<span class="op" id="7452128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452131">reply</span><span class="op" id="7452136">.</span><span class="ident" id="7452137">C</span>&nbsp;<span class="op" id="7452139">=</span>&nbsp;<span class="ident" id="7452141">args</span><span class="op" id="7452145">.</span><span class="ident" id="7452146">A</span>&nbsp;<span class="op" id="7452148">+</span>&nbsp;<span class="ident" id="7452150">args</span><span class="op" id="7452154">.</span><span class="ident" id="7452155">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452158">return</span>&nbsp;<span class="ident" id="7452165">nil</span><br>
<span class="lineno"></span><span class="op" id="7452169">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="7452172">func</span>&nbsp;<span class="op" id="7452177">(</span><span class="ident" id="7452178">t</span>&nbsp;<span class="op" id="7452180">*</span><span class="ident" id="7452181">Arith</span><span class="op" id="7452186">)</span>&nbsp;<span class="ident" id="7452188">Mul</span><span class="op" id="7452191">(</span><span class="ident" id="7452192">args</span>&nbsp;<span class="op" id="7452197">*</span><span class="ident" id="7452198">Args</span><span class="op" id="7452202">,</span>&nbsp;<span class="ident" id="7452204">reply</span>&nbsp;<span class="op" id="7452210">*</span><span class="ident" id="7452211">Reply</span><span class="op" id="7452216">)</span>&nbsp;<span class="builtintype" id="7452218">error</span>&nbsp;<span class="op" id="7452224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452227">reply</span><span class="op" id="7452232">.</span><span class="ident" id="7452233">C</span>&nbsp;<span class="op" id="7452235">=</span>&nbsp;<span class="ident" id="7452237">args</span><span class="op" id="7452241">.</span><span class="ident" id="7452242">A</span>&nbsp;<span class="op" id="7452244">*</span>&nbsp;<span class="ident" id="7452246">args</span><span class="op" id="7452250">.</span><span class="ident" id="7452251">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452254">return</span>&nbsp;<span class="ident" id="7452261">nil</span><br>
<span class="lineno"></span><span class="op" id="7452265">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7452268">func</span>&nbsp;<span class="op" id="7452273">(</span><span class="ident" id="7452274">t</span>&nbsp;<span class="op" id="7452276">*</span><span class="ident" id="7452277">Arith</span><span class="op" id="7452282">)</span>&nbsp;<span class="ident" id="7452284">Div</span><span class="op" id="7452287">(</span><span class="ident" id="7452288">args</span>&nbsp;<span class="op" id="7452293">*</span><span class="ident" id="7452294">Args</span><span class="op" id="7452298">,</span>&nbsp;<span class="ident" id="7452300">reply</span>&nbsp;<span class="op" id="7452306">*</span><span class="ident" id="7452307">Reply</span><span class="op" id="7452312">)</span>&nbsp;<span class="builtintype" id="7452314">error</span>&nbsp;<span class="op" id="7452320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452323">if</span>&nbsp;<span class="ident" id="7452326">args</span><span class="op" id="7452330">.</span><span class="ident" id="7452331">B</span>&nbsp;<span class="op" id="7452333">==</span>&nbsp;<span class="num" id="7452336">0</span>&nbsp;<span class="op" id="7452338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452342">return</span>&nbsp;<span class="ident" id="7452349">errors</span><span class="op" id="7452355">.</span><span class="ident" id="7452356">New</span><span class="op" id="7452359">(</span><span class="string" id="7452360">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="7452376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452379">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452382">reply</span><span class="op" id="7452387">.</span><span class="ident" id="7452388">C</span>&nbsp;<span class="op" id="7452390">=</span>&nbsp;<span class="ident" id="7452392">args</span><span class="op" id="7452396">.</span><span class="ident" id="7452397">A</span>&nbsp;<span class="op" id="7452399">/</span>&nbsp;<span class="ident" id="7452401">args</span><span class="op" id="7452405">.</span><span class="ident" id="7452406">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452409">return</span>&nbsp;<span class="ident" id="7452416">nil</span><br>
<span class="lineno"></span><span class="op" id="7452420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7452423">func</span>&nbsp;<span class="op" id="7452428">(</span><span class="ident" id="7452429">t</span>&nbsp;<span class="op" id="7452431">*</span><span class="ident" id="7452432">Arith</span><span class="op" id="7452437">)</span>&nbsp;<span class="ident" id="7452439">Error</span><span class="op" id="7452444">(</span><span class="ident" id="7452445">args</span>&nbsp;<span class="op" id="7452450">*</span><span class="ident" id="7452451">Args</span><span class="op" id="7452455">,</span>&nbsp;<span class="ident" id="7452457">reply</span>&nbsp;<span class="op" id="7452463">*</span><span class="ident" id="7452464">Reply</span><span class="op" id="7452469">)</span>&nbsp;<span class="builtintype" id="7452471">error</span>&nbsp;<span class="op" id="7452477">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7452480">panic</span><span class="op" id="7452485">(</span><span class="string" id="7452486">&#34;ERROR&#34;</span><span class="op" id="7452493">)</span><br>
<span class="lineno"></span><span class="op" id="7452495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7452498">func</span>&nbsp;<span class="ident" id="7452503">init</span><span class="op" id="7452507">(</span><span class="op" id="7452508">)</span>&nbsp;<span class="op" id="7452510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452513">rpc</span><span class="op" id="7452516">.</span><span class="ident" id="7452517">Register</span><span class="op" id="7452525">(</span><span class="builtinfunc" id="7452526">new</span><span class="op" id="7452529">(</span><span class="ident" id="7452530">Arith</span><span class="op" id="7452535">)</span><span class="op" id="7452536">)</span><br>
<span class="lineno">60</span><span class="op" id="7452538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7452541">func</span>&nbsp;<span class="ident" id="7452546">TestServerNoParams</span><span class="op" id="7452564">(</span><span class="ident" id="7452565">t</span>&nbsp;<span class="op" id="7452567">*</span><span class="ident" id="7452568">testing</span><span class="op" id="7452575">.</span><span class="ident" id="7452576">T</span><span class="op" id="7452577">)</span>&nbsp;<span class="op" id="7452579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452582">cli</span><span class="op" id="7452585">,</span>&nbsp;<span class="ident" id="7452587">srv</span>&nbsp;<span class="op" id="7452591">:=</span>&nbsp;<span class="ident" id="7452594">net</span><span class="op" id="7452597">.</span><span class="ident" id="7452598">Pipe</span><span class="op" id="7452602">(</span><span class="op" id="7452603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452606">defer</span>&nbsp;<span class="ident" id="7452612">cli</span><span class="op" id="7452615">.</span><span class="ident" id="7452616">Close</span><span class="op" id="7452621">(</span><span class="op" id="7452622">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452625">go</span>&nbsp;<span class="ident" id="7452628">ServeConn</span><span class="op" id="7452637">(</span><span class="ident" id="7452638">srv</span><span class="op" id="7452641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452644">dec</span>&nbsp;<span class="op" id="7452648">:=</span>&nbsp;<span class="ident" id="7452651">json</span><span class="op" id="7452655">.</span><span class="ident" id="7452656">NewDecoder</span><span class="op" id="7452666">(</span><span class="ident" id="7452667">cli</span><span class="op" id="7452670">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452674">fmt</span><span class="op" id="7452677">.</span><span class="ident" id="7452678">Fprintf</span><span class="op" id="7452685">(</span><span class="ident" id="7452686">cli</span><span class="op" id="7452689">,</span>&nbsp;<span class="string" id="7452691">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;}`</span><span class="op" id="7452729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452732">var</span>&nbsp;<span class="ident" id="7452736">resp</span>&nbsp;<span class="ident" id="7452741">ArithAddResp</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452755">if</span>&nbsp;<span class="ident" id="7452758">err</span>&nbsp;<span class="op" id="7452762">:=</span>&nbsp;<span class="ident" id="7452765">dec</span><span class="op" id="7452768">.</span><span class="ident" id="7452769">Decode</span><span class="op" id="7452775">(</span><span class="op" id="7452776">&amp;</span><span class="ident" id="7452777">resp</span><span class="op" id="7452781">)</span><span class="op" id="7452782">;</span>&nbsp;<span class="ident" id="7452784">err</span>&nbsp;<span class="op" id="7452788">!=</span>&nbsp;<span class="ident" id="7452791">nil</span>&nbsp;<span class="op" id="7452795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452799">t</span><span class="op" id="7452800">.</span><span class="ident" id="7452801">Fatalf</span><span class="op" id="7452807">(</span><span class="string" id="7452808">&#34;Decode&nbsp;after&nbsp;no&nbsp;params:&nbsp;%s&#34;</span><span class="op" id="7452836">,</span>&nbsp;<span class="ident" id="7452838">err</span><span class="op" id="7452841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452847">if</span>&nbsp;<span class="ident" id="7452850">resp</span><span class="op" id="7452854">.</span><span class="ident" id="7452855">Error</span>&nbsp;<span class="op" id="7452861">==</span>&nbsp;<span class="ident" id="7452864">nil</span>&nbsp;<span class="op" id="7452868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452872">t</span><span class="op" id="7452873">.</span><span class="ident" id="7452874">Fatalf</span><span class="op" id="7452880">(</span><span class="string" id="7452881">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="7452906">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452909">}</span><br>
<span class="lineno"></span><span class="op" id="7452911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7452914">func</span>&nbsp;<span class="ident" id="7452919">TestServerEmptyMessage</span><span class="op" id="7452941">(</span><span class="ident" id="7452942">t</span>&nbsp;<span class="op" id="7452944">*</span><span class="ident" id="7452945">testing</span><span class="op" id="7452952">.</span><span class="ident" id="7452953">T</span><span class="op" id="7452954">)</span>&nbsp;<span class="op" id="7452956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452959">cli</span><span class="op" id="7452962">,</span>&nbsp;<span class="ident" id="7452964">srv</span>&nbsp;<span class="op" id="7452968">:=</span>&nbsp;<span class="ident" id="7452971">net</span><span class="op" id="7452974">.</span><span class="ident" id="7452975">Pipe</span><span class="op" id="7452979">(</span><span class="op" id="7452980">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452983">defer</span>&nbsp;<span class="ident" id="7452989">cli</span><span class="op" id="7452992">.</span><span class="ident" id="7452993">Close</span><span class="op" id="7452998">(</span><span class="op" id="7452999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453002">go</span>&nbsp;<span class="ident" id="7453005">ServeConn</span><span class="op" id="7453014">(</span><span class="ident" id="7453015">srv</span><span class="op" id="7453018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453021">dec</span>&nbsp;<span class="op" id="7453025">:=</span>&nbsp;<span class="ident" id="7453028">json</span><span class="op" id="7453032">.</span><span class="ident" id="7453033">NewDecoder</span><span class="op" id="7453043">(</span><span class="ident" id="7453044">cli</span><span class="op" id="7453047">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453051">fmt</span><span class="op" id="7453054">.</span><span class="ident" id="7453055">Fprintf</span><span class="op" id="7453062">(</span><span class="ident" id="7453063">cli</span><span class="op" id="7453066">,</span>&nbsp;<span class="string" id="7453068">&#34;{}&#34;</span><span class="op" id="7453072">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453075">var</span>&nbsp;<span class="ident" id="7453079">resp</span>&nbsp;<span class="ident" id="7453084">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453098">if</span>&nbsp;<span class="ident" id="7453101">err</span>&nbsp;<span class="op" id="7453105">:=</span>&nbsp;<span class="ident" id="7453108">dec</span><span class="op" id="7453111">.</span><span class="ident" id="7453112">Decode</span><span class="op" id="7453118">(</span><span class="op" id="7453119">&amp;</span><span class="ident" id="7453120">resp</span><span class="op" id="7453124">)</span><span class="op" id="7453125">;</span>&nbsp;<span class="ident" id="7453127">err</span>&nbsp;<span class="op" id="7453131">!=</span>&nbsp;<span class="ident" id="7453134">nil</span>&nbsp;<span class="op" id="7453138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453142">t</span><span class="op" id="7453143">.</span><span class="ident" id="7453144">Fatalf</span><span class="op" id="7453150">(</span><span class="string" id="7453151">&#34;Decode&nbsp;after&nbsp;empty:&nbsp;%s&#34;</span><span class="op" id="7453175">,</span>&nbsp;<span class="ident" id="7453177">err</span><span class="op" id="7453180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453186">if</span>&nbsp;<span class="ident" id="7453189">resp</span><span class="op" id="7453193">.</span><span class="ident" id="7453194">Error</span>&nbsp;<span class="op" id="7453200">==</span>&nbsp;<span class="ident" id="7453203">nil</span>&nbsp;<span class="op" id="7453207">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453211">t</span><span class="op" id="7453212">.</span><span class="ident" id="7453213">Fatalf</span><span class="op" id="7453219">(</span><span class="string" id="7453220">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="7453245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453248">}</span><br>
<span class="lineno"></span><span class="op" id="7453250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7453253">func</span>&nbsp;<span class="ident" id="7453258">TestServer</span><span class="op" id="7453268">(</span><span class="ident" id="7453269">t</span>&nbsp;<span class="op" id="7453271">*</span><span class="ident" id="7453272">testing</span><span class="op" id="7453279">.</span><span class="ident" id="7453280">T</span><span class="op" id="7453281">)</span>&nbsp;<span class="op" id="7453283">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453286">cli</span><span class="op" id="7453289">,</span>&nbsp;<span class="ident" id="7453291">srv</span>&nbsp;<span class="op" id="7453295">:=</span>&nbsp;<span class="ident" id="7453298">net</span><span class="op" id="7453301">.</span><span class="ident" id="7453302">Pipe</span><span class="op" id="7453306">(</span><span class="op" id="7453307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453310">defer</span>&nbsp;<span class="ident" id="7453316">cli</span><span class="op" id="7453319">.</span><span class="ident" id="7453320">Close</span><span class="op" id="7453325">(</span><span class="op" id="7453326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453329">go</span>&nbsp;<span class="ident" id="7453332">ServeConn</span><span class="op" id="7453341">(</span><span class="ident" id="7453342">srv</span><span class="op" id="7453345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453348">dec</span>&nbsp;<span class="op" id="7453352">:=</span>&nbsp;<span class="ident" id="7453355">json</span><span class="op" id="7453359">.</span><span class="ident" id="7453360">NewDecoder</span><span class="op" id="7453370">(</span><span class="ident" id="7453371">cli</span><span class="op" id="7453374">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7453378">//&nbsp;Send&nbsp;hand-coded&nbsp;requests&nbsp;to&nbsp;server,&nbsp;parse&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453435">for</span>&nbsp;<span class="ident" id="7453439">i</span>&nbsp;<span class="op" id="7453441">:=</span>&nbsp;<span class="num" id="7453444">0</span><span class="op" id="7453445">;</span>&nbsp;<span class="ident" id="7453447">i</span>&nbsp;<span class="op" id="7453449">&lt;</span>&nbsp;<span class="num" id="7453451">10</span><span class="op" id="7453453">;</span>&nbsp;<span class="ident" id="7453455">i</span><span class="op" id="7453456">++</span>&nbsp;<span class="op" id="7453459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453463">fmt</span><span class="op" id="7453466">.</span><span class="ident" id="7453467">Fprintf</span><span class="op" id="7453474">(</span><span class="ident" id="7453475">cli</span><span class="op" id="7453478">,</span>&nbsp;<span class="string" id="7453480">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;\u%04d&#34;,&nbsp;&#34;params&#34;:&nbsp;[{&#34;A&#34;:&nbsp;%d,&nbsp;&#34;B&#34;:&nbsp;%d}]}`</span><span class="op" id="7453553">,</span>&nbsp;<span class="ident" id="7453555">i</span><span class="op" id="7453556">,</span>&nbsp;<span class="ident" id="7453558">i</span><span class="op" id="7453559">,</span>&nbsp;<span class="ident" id="7453561">i</span><span class="op" id="7453562">+</span><span class="num" id="7453563">1</span><span class="op" id="7453564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453568">var</span>&nbsp;<span class="ident" id="7453572">resp</span>&nbsp;<span class="ident" id="7453577">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453592">err</span>&nbsp;<span class="op" id="7453596">:=</span>&nbsp;<span class="ident" id="7453599">dec</span><span class="op" id="7453602">.</span><span class="ident" id="7453603">Decode</span><span class="op" id="7453609">(</span><span class="op" id="7453610">&amp;</span><span class="ident" id="7453611">resp</span><span class="op" id="7453615">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453619">if</span>&nbsp;<span class="ident" id="7453622">err</span>&nbsp;<span class="op" id="7453626">!=</span>&nbsp;<span class="ident" id="7453629">nil</span>&nbsp;<span class="op" id="7453633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453638">t</span><span class="op" id="7453639">.</span><span class="ident" id="7453640">Fatalf</span><span class="op" id="7453646">(</span><span class="string" id="7453647">&#34;Decode:&nbsp;%s&#34;</span><span class="op" id="7453659">,</span>&nbsp;<span class="ident" id="7453661">err</span><span class="op" id="7453664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453672">if</span>&nbsp;<span class="ident" id="7453675">resp</span><span class="op" id="7453679">.</span><span class="ident" id="7453680">Error</span>&nbsp;<span class="op" id="7453686">!=</span>&nbsp;<span class="ident" id="7453689">nil</span>&nbsp;<span class="op" id="7453693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453698">t</span><span class="op" id="7453699">.</span><span class="ident" id="7453700">Fatalf</span><span class="op" id="7453706">(</span><span class="string" id="7453707">&#34;resp.Error:&nbsp;%s&#34;</span><span class="op" id="7453723">,</span>&nbsp;<span class="ident" id="7453725">resp</span><span class="op" id="7453729">.</span><span class="ident" id="7453730">Error</span><span class="op" id="7453735">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453743">if</span>&nbsp;<span class="ident" id="7453746">resp</span><span class="op" id="7453750">.</span><span class="ident" id="7453751">Id</span><span class="op" id="7453753">.</span><span class="op" id="7453754">(</span><span class="builtintype" id="7453755">string</span><span class="op" id="7453761">)</span>&nbsp;<span class="op" id="7453763">!=</span>&nbsp;<span class="builtintype" id="7453766">string</span><span class="op" id="7453772">(</span><span class="ident" id="7453773">i</span><span class="op" id="7453774">)</span>&nbsp;<span class="op" id="7453776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453781">t</span><span class="op" id="7453782">.</span><span class="ident" id="7453783">Fatalf</span><span class="op" id="7453789">(</span><span class="string" id="7453790">&#34;resp:&nbsp;bad&nbsp;id&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7453815">,</span>&nbsp;<span class="ident" id="7453817">resp</span><span class="op" id="7453821">.</span><span class="ident" id="7453822">Id</span><span class="op" id="7453824">.</span><span class="op" id="7453825">(</span><span class="builtintype" id="7453826">string</span><span class="op" id="7453832">)</span><span class="op" id="7453833">,</span>&nbsp;<span class="builtintype" id="7453835">string</span><span class="op" id="7453841">(</span><span class="ident" id="7453842">i</span><span class="op" id="7453843">)</span><span class="op" id="7453844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453852">if</span>&nbsp;<span class="ident" id="7453855">resp</span><span class="op" id="7453859">.</span><span class="ident" id="7453860">Result</span><span class="op" id="7453866">.</span><span class="ident" id="7453867">C</span>&nbsp;<span class="op" id="7453869">!=</span>&nbsp;<span class="num" id="7453872">2</span><span class="op" id="7453873">*</span><span class="ident" id="7453874">i</span><span class="op" id="7453875">+</span><span class="num" id="7453876">1</span>&nbsp;<span class="op" id="7453878">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453883">t</span><span class="op" id="7453884">.</span><span class="ident" id="7453885">Fatalf</span><span class="op" id="7453891">(</span><span class="string" id="7453892">&#34;resp:&nbsp;bad&nbsp;result:&nbsp;%d+%d=%d&#34;</span><span class="op" id="7453920">,</span>&nbsp;<span class="ident" id="7453922">i</span><span class="op" id="7453923">,</span>&nbsp;<span class="ident" id="7453925">i</span><span class="op" id="7453926">+</span><span class="num" id="7453927">1</span><span class="op" id="7453928">,</span>&nbsp;<span class="ident" id="7453930">resp</span><span class="op" id="7453934">.</span><span class="ident" id="7453935">Result</span><span class="op" id="7453941">.</span><span class="ident" id="7453942">C</span><span class="op" id="7453943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453950">}</span><br>
<span class="lineno"></span><span class="op" id="7453952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7453955">func</span>&nbsp;<span class="ident" id="7453960">TestClient</span><span class="op" id="7453970">(</span><span class="ident" id="7453971">t</span>&nbsp;<span class="op" id="7453973">*</span><span class="ident" id="7453974">testing</span><span class="op" id="7453981">.</span><span class="ident" id="7453982">T</span><span class="op" id="7453983">)</span>&nbsp;<span class="op" id="7453985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7453988">//&nbsp;Assume&nbsp;server&nbsp;is&nbsp;okay&nbsp;(TestServer&nbsp;is&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7454037">//&nbsp;Test&nbsp;client&nbsp;against&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454069">cli</span><span class="op" id="7454072">,</span>&nbsp;<span class="ident" id="7454074">srv</span>&nbsp;<span class="op" id="7454078">:=</span>&nbsp;<span class="ident" id="7454081">net</span><span class="op" id="7454084">.</span><span class="ident" id="7454085">Pipe</span><span class="op" id="7454089">(</span><span class="op" id="7454090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454093">go</span>&nbsp;<span class="ident" id="7454096">ServeConn</span><span class="op" id="7454105">(</span><span class="ident" id="7454106">srv</span><span class="op" id="7454109">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454113">client</span>&nbsp;<span class="op" id="7454120">:=</span>&nbsp;<span class="ident" id="7454123">NewClient</span><span class="op" id="7454132">(</span><span class="ident" id="7454133">cli</span><span class="op" id="7454136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454139">defer</span>&nbsp;<span class="ident" id="7454145">client</span><span class="op" id="7454151">.</span><span class="ident" id="7454152">Close</span><span class="op" id="7454157">(</span><span class="op" id="7454158">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7454162">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454184">args</span>&nbsp;<span class="op" id="7454189">:=</span>&nbsp;<span class="op" id="7454192">&amp;</span><span class="ident" id="7454193">Args</span><span class="op" id="7454197">{</span><span class="num" id="7454198">7</span><span class="op" id="7454199">,</span>&nbsp;<span class="num" id="7454201">8</span><span class="op" id="7454202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454205">reply</span>&nbsp;<span class="op" id="7454211">:=</span>&nbsp;<span class="builtinfunc" id="7454214">new</span><span class="op" id="7454217">(</span><span class="ident" id="7454218">Reply</span><span class="op" id="7454223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454226">err</span>&nbsp;<span class="op" id="7454230">:=</span>&nbsp;<span class="ident" id="7454233">client</span><span class="op" id="7454239">.</span><span class="ident" id="7454240">Call</span><span class="op" id="7454244">(</span><span class="string" id="7454245">&#34;Arith.Add&#34;</span><span class="op" id="7454256">,</span>&nbsp;<span class="ident" id="7454258">args</span><span class="op" id="7454262">,</span>&nbsp;<span class="ident" id="7454264">reply</span><span class="op" id="7454269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454272">if</span>&nbsp;<span class="ident" id="7454275">err</span>&nbsp;<span class="op" id="7454279">!=</span>&nbsp;<span class="ident" id="7454282">nil</span>&nbsp;<span class="op" id="7454286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454290">t</span><span class="op" id="7454291">.</span><span class="ident" id="7454292">Errorf</span><span class="op" id="7454298">(</span><span class="string" id="7454299">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7454341">,</span>&nbsp;<span class="ident" id="7454343">err</span><span class="op" id="7454346">.</span><span class="ident" id="7454347">Error</span><span class="op" id="7454352">(</span><span class="op" id="7454353">)</span><span class="op" id="7454354">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454360">if</span>&nbsp;<span class="ident" id="7454363">reply</span><span class="op" id="7454368">.</span><span class="ident" id="7454369">C</span>&nbsp;<span class="op" id="7454371">!=</span>&nbsp;<span class="ident" id="7454374">args</span><span class="op" id="7454378">.</span><span class="ident" id="7454379">A</span><span class="op" id="7454380">+</span><span class="ident" id="7454381">args</span><span class="op" id="7454385">.</span><span class="ident" id="7454386">B</span>&nbsp;<span class="op" id="7454388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454392">t</span><span class="op" id="7454393">.</span><span class="ident" id="7454394">Errorf</span><span class="op" id="7454400">(</span><span class="string" id="7454401">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7454426">,</span>&nbsp;<span class="ident" id="7454428">reply</span><span class="op" id="7454433">.</span><span class="ident" id="7454434">C</span><span class="op" id="7454435">,</span>&nbsp;<span class="ident" id="7454437">args</span><span class="op" id="7454441">.</span><span class="ident" id="7454442">A</span><span class="op" id="7454443">+</span><span class="ident" id="7454444">args</span><span class="op" id="7454448">.</span><span class="ident" id="7454449">B</span><span class="op" id="7454450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454457">args</span>&nbsp;<span class="op" id="7454462">=</span>&nbsp;<span class="op" id="7454464">&amp;</span><span class="ident" id="7454465">Args</span><span class="op" id="7454469">{</span><span class="num" id="7454470">7</span><span class="op" id="7454471">,</span>&nbsp;<span class="num" id="7454473">8</span><span class="op" id="7454474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454477">reply</span>&nbsp;<span class="op" id="7454483">=</span>&nbsp;<span class="builtinfunc" id="7454485">new</span><span class="op" id="7454488">(</span><span class="ident" id="7454489">Reply</span><span class="op" id="7454494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454497">err</span>&nbsp;<span class="op" id="7454501">=</span>&nbsp;<span class="ident" id="7454503">client</span><span class="op" id="7454509">.</span><span class="ident" id="7454510">Call</span><span class="op" id="7454514">(</span><span class="string" id="7454515">&#34;Arith.Mul&#34;</span><span class="op" id="7454526">,</span>&nbsp;<span class="ident" id="7454528">args</span><span class="op" id="7454532">,</span>&nbsp;<span class="ident" id="7454534">reply</span><span class="op" id="7454539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454542">if</span>&nbsp;<span class="ident" id="7454545">err</span>&nbsp;<span class="op" id="7454549">!=</span>&nbsp;<span class="ident" id="7454552">nil</span>&nbsp;<span class="op" id="7454556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454560">t</span><span class="op" id="7454561">.</span><span class="ident" id="7454562">Errorf</span><span class="op" id="7454568">(</span><span class="string" id="7454569">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7454611">,</span>&nbsp;<span class="ident" id="7454613">err</span><span class="op" id="7454616">.</span><span class="ident" id="7454617">Error</span><span class="op" id="7454622">(</span><span class="op" id="7454623">)</span><span class="op" id="7454624">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454630">if</span>&nbsp;<span class="ident" id="7454633">reply</span><span class="op" id="7454638">.</span><span class="ident" id="7454639">C</span>&nbsp;<span class="op" id="7454641">!=</span>&nbsp;<span class="ident" id="7454644">args</span><span class="op" id="7454648">.</span><span class="ident" id="7454649">A</span><span class="op" id="7454650">*</span><span class="ident" id="7454651">args</span><span class="op" id="7454655">.</span><span class="ident" id="7454656">B</span>&nbsp;<span class="op" id="7454658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454662">t</span><span class="op" id="7454663">.</span><span class="ident" id="7454664">Errorf</span><span class="op" id="7454670">(</span><span class="string" id="7454671">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7454696">,</span>&nbsp;<span class="ident" id="7454698">reply</span><span class="op" id="7454703">.</span><span class="ident" id="7454704">C</span><span class="op" id="7454705">,</span>&nbsp;<span class="ident" id="7454707">args</span><span class="op" id="7454711">.</span><span class="ident" id="7454712">A</span><span class="op" id="7454713">*</span><span class="ident" id="7454714">args</span><span class="op" id="7454718">.</span><span class="ident" id="7454719">B</span><span class="op" id="7454720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7454727">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454745">args</span>&nbsp;<span class="op" id="7454750">=</span>&nbsp;<span class="op" id="7454752">&amp;</span><span class="ident" id="7454753">Args</span><span class="op" id="7454757">{</span><span class="num" id="7454758">7</span><span class="op" id="7454759">,</span>&nbsp;<span class="num" id="7454761">8</span><span class="op" id="7454762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454765">mulReply</span>&nbsp;<span class="op" id="7454774">:=</span>&nbsp;<span class="builtinfunc" id="7454777">new</span><span class="op" id="7454780">(</span><span class="ident" id="7454781">Reply</span><span class="op" id="7454786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454789">mulCall</span>&nbsp;<span class="op" id="7454797">:=</span>&nbsp;<span class="ident" id="7454800">client</span><span class="op" id="7454806">.</span><span class="ident" id="7454807">Go</span><span class="op" id="7454809">(</span><span class="string" id="7454810">&#34;Arith.Mul&#34;</span><span class="op" id="7454821">,</span>&nbsp;<span class="ident" id="7454823">args</span><span class="op" id="7454827">,</span>&nbsp;<span class="ident" id="7454829">mulReply</span><span class="op" id="7454837">,</span>&nbsp;<span class="ident" id="7454839">nil</span><span class="op" id="7454842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454845">addReply</span>&nbsp;<span class="op" id="7454854">:=</span>&nbsp;<span class="builtinfunc" id="7454857">new</span><span class="op" id="7454860">(</span><span class="ident" id="7454861">Reply</span><span class="op" id="7454866">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454869">addCall</span>&nbsp;<span class="op" id="7454877">:=</span>&nbsp;<span class="ident" id="7454880">client</span><span class="op" id="7454886">.</span><span class="ident" id="7454887">Go</span><span class="op" id="7454889">(</span><span class="string" id="7454890">&#34;Arith.Add&#34;</span><span class="op" id="7454901">,</span>&nbsp;<span class="ident" id="7454903">args</span><span class="op" id="7454907">,</span>&nbsp;<span class="ident" id="7454909">addReply</span><span class="op" id="7454917">,</span>&nbsp;<span class="ident" id="7454919">nil</span><span class="op" id="7454922">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454926">addCall</span>&nbsp;<span class="op" id="7454934">=</span>&nbsp;<span class="op" id="7454936">&lt;-</span><span class="ident" id="7454938">addCall</span><span class="op" id="7454945">.</span><span class="ident" id="7454946">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454952">if</span>&nbsp;<span class="ident" id="7454955">addCall</span><span class="op" id="7454962">.</span><span class="ident" id="7454963">Error</span>&nbsp;<span class="op" id="7454969">!=</span>&nbsp;<span class="ident" id="7454972">nil</span>&nbsp;<span class="op" id="7454976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454980">t</span><span class="op" id="7454981">.</span><span class="ident" id="7454982">Errorf</span><span class="op" id="7454988">(</span><span class="string" id="7454989">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7455031">,</span>&nbsp;<span class="ident" id="7455033">addCall</span><span class="op" id="7455040">.</span><span class="ident" id="7455041">Error</span><span class="op" id="7455046">.</span><span class="ident" id="7455047">Error</span><span class="op" id="7455052">(</span><span class="op" id="7455053">)</span><span class="op" id="7455054">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455060">if</span>&nbsp;<span class="ident" id="7455063">addReply</span><span class="op" id="7455071">.</span><span class="ident" id="7455072">C</span>&nbsp;<span class="op" id="7455074">!=</span>&nbsp;<span class="ident" id="7455077">args</span><span class="op" id="7455081">.</span><span class="ident" id="7455082">A</span><span class="op" id="7455083">+</span><span class="ident" id="7455084">args</span><span class="op" id="7455088">.</span><span class="ident" id="7455089">B</span>&nbsp;<span class="op" id="7455091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455095">t</span><span class="op" id="7455096">.</span><span class="ident" id="7455097">Errorf</span><span class="op" id="7455103">(</span><span class="string" id="7455104">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7455129">,</span>&nbsp;<span class="ident" id="7455131">addReply</span><span class="op" id="7455139">.</span><span class="ident" id="7455140">C</span><span class="op" id="7455141">,</span>&nbsp;<span class="ident" id="7455143">args</span><span class="op" id="7455147">.</span><span class="ident" id="7455148">A</span><span class="op" id="7455149">+</span><span class="ident" id="7455150">args</span><span class="op" id="7455154">.</span><span class="ident" id="7455155">B</span><span class="op" id="7455156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455163">mulCall</span>&nbsp;<span class="op" id="7455171">=</span>&nbsp;<span class="op" id="7455173">&lt;-</span><span class="ident" id="7455175">mulCall</span><span class="op" id="7455182">.</span><span class="ident" id="7455183">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455189">if</span>&nbsp;<span class="ident" id="7455192">mulCall</span><span class="op" id="7455199">.</span><span class="ident" id="7455200">Error</span>&nbsp;<span class="op" id="7455206">!=</span>&nbsp;<span class="ident" id="7455209">nil</span>&nbsp;<span class="op" id="7455213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455217">t</span><span class="op" id="7455218">.</span><span class="ident" id="7455219">Errorf</span><span class="op" id="7455225">(</span><span class="string" id="7455226">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7455268">,</span>&nbsp;<span class="ident" id="7455270">mulCall</span><span class="op" id="7455277">.</span><span class="ident" id="7455278">Error</span><span class="op" id="7455283">.</span><span class="ident" id="7455284">Error</span><span class="op" id="7455289">(</span><span class="op" id="7455290">)</span><span class="op" id="7455291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455297">if</span>&nbsp;<span class="ident" id="7455300">mulReply</span><span class="op" id="7455308">.</span><span class="ident" id="7455309">C</span>&nbsp;<span class="op" id="7455311">!=</span>&nbsp;<span class="ident" id="7455314">args</span><span class="op" id="7455318">.</span><span class="ident" id="7455319">A</span><span class="op" id="7455320">*</span><span class="ident" id="7455321">args</span><span class="op" id="7455325">.</span><span class="ident" id="7455326">B</span>&nbsp;<span class="op" id="7455328">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455332">t</span><span class="op" id="7455333">.</span><span class="ident" id="7455334">Errorf</span><span class="op" id="7455340">(</span><span class="string" id="7455341">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7455366">,</span>&nbsp;<span class="ident" id="7455368">mulReply</span><span class="op" id="7455376">.</span><span class="ident" id="7455377">C</span><span class="op" id="7455378">,</span>&nbsp;<span class="ident" id="7455380">args</span><span class="op" id="7455384">.</span><span class="ident" id="7455385">A</span><span class="op" id="7455386">*</span><span class="ident" id="7455387">args</span><span class="op" id="7455391">.</span><span class="ident" id="7455392">B</span><span class="op" id="7455393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7455400">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455415">args</span>&nbsp;<span class="op" id="7455420">=</span>&nbsp;<span class="op" id="7455422">&amp;</span><span class="ident" id="7455423">Args</span><span class="op" id="7455427">{</span><span class="num" id="7455428">7</span><span class="op" id="7455429">,</span>&nbsp;<span class="num" id="7455431">0</span><span class="op" id="7455432">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455435">reply</span>&nbsp;<span class="op" id="7455441">=</span>&nbsp;<span class="builtinfunc" id="7455443">new</span><span class="op" id="7455446">(</span><span class="ident" id="7455447">Reply</span><span class="op" id="7455452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455455">err</span>&nbsp;<span class="op" id="7455459">=</span>&nbsp;<span class="ident" id="7455461">client</span><span class="op" id="7455467">.</span><span class="ident" id="7455468">Call</span><span class="op" id="7455472">(</span><span class="string" id="7455473">&#34;Arith.Div&#34;</span><span class="op" id="7455484">,</span>&nbsp;<span class="ident" id="7455486">args</span><span class="op" id="7455490">,</span>&nbsp;<span class="ident" id="7455492">reply</span><span class="op" id="7455497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7455500">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455533">if</span>&nbsp;<span class="ident" id="7455536">err</span>&nbsp;<span class="op" id="7455540">==</span>&nbsp;<span class="ident" id="7455543">nil</span>&nbsp;<span class="op" id="7455547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455551">t</span><span class="op" id="7455552">.</span><span class="ident" id="7455553">Error</span><span class="op" id="7455558">(</span><span class="string" id="7455559">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7455580">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455583">}</span>&nbsp;<span class="keyword" id="7455585">else</span>&nbsp;<span class="keyword" id="7455590">if</span>&nbsp;<span class="ident" id="7455593">err</span><span class="op" id="7455596">.</span><span class="ident" id="7455597">Error</span><span class="op" id="7455602">(</span><span class="op" id="7455603">)</span>&nbsp;<span class="op" id="7455605">!=</span>&nbsp;<span class="string" id="7455608">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="7455625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455629">t</span><span class="op" id="7455630">.</span><span class="ident" id="7455631">Error</span><span class="op" id="7455636">(</span><span class="string" id="7455637">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="7455678">,</span>&nbsp;<span class="ident" id="7455680">err</span><span class="op" id="7455683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455686">}</span><br>
<span class="lineno"></span><span class="op" id="7455688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="7455691">func</span>&nbsp;<span class="ident" id="7455696">TestMalformedInput</span><span class="op" id="7455714">(</span><span class="ident" id="7455715">t</span>&nbsp;<span class="op" id="7455717">*</span><span class="ident" id="7455718">testing</span><span class="op" id="7455725">.</span><span class="ident" id="7455726">T</span><span class="op" id="7455727">)</span>&nbsp;<span class="op" id="7455729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455732">cli</span><span class="op" id="7455735">,</span>&nbsp;<span class="ident" id="7455737">srv</span>&nbsp;<span class="op" id="7455741">:=</span>&nbsp;<span class="ident" id="7455744">net</span><span class="op" id="7455747">.</span><span class="ident" id="7455748">Pipe</span><span class="op" id="7455752">(</span><span class="op" id="7455753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455756">go</span>&nbsp;<span class="ident" id="7455759">cli</span><span class="op" id="7455762">.</span><span class="ident" id="7455763">Write</span><span class="op" id="7455768">(</span><span class="op" id="7455769">[</span><span class="op" id="7455770">]</span><span class="builtintype" id="7455771">byte</span><span class="op" id="7455775">(</span><span class="string" id="7455776">`{id:1}`</span><span class="op" id="7455784">)</span><span class="op" id="7455785">)</span>&nbsp;<span class="comment" id="7455787">//&nbsp;invalid&nbsp;json</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455804">ServeConn</span><span class="op" id="7455813">(</span><span class="ident" id="7455814">srv</span><span class="op" id="7455817">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7455835">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="7455860">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="7455863">func</span>&nbsp;<span class="ident" id="7455868">TestMalformedOutput</span><span class="op" id="7455887">(</span><span class="ident" id="7455888">t</span>&nbsp;<span class="op" id="7455890">*</span><span class="ident" id="7455891">testing</span><span class="op" id="7455898">.</span><span class="ident" id="7455899">T</span><span class="op" id="7455900">)</span>&nbsp;<span class="op" id="7455902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455905">cli</span><span class="op" id="7455908">,</span>&nbsp;<span class="ident" id="7455910">srv</span>&nbsp;<span class="op" id="7455914">:=</span>&nbsp;<span class="ident" id="7455917">net</span><span class="op" id="7455920">.</span><span class="ident" id="7455921">Pipe</span><span class="op" id="7455925">(</span><span class="op" id="7455926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455929">go</span>&nbsp;<span class="ident" id="7455932">srv</span><span class="op" id="7455935">.</span><span class="ident" id="7455936">Write</span><span class="op" id="7455941">(</span><span class="op" id="7455942">[</span><span class="op" id="7455943">]</span><span class="builtintype" id="7455944">byte</span><span class="op" id="7455948">(</span><span class="string" id="7455949">`{&#34;id&#34;:0,&#34;result&#34;:null,&#34;error&#34;:null}`</span><span class="op" id="7455986">)</span><span class="op" id="7455987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455990">go</span>&nbsp;<span class="ident" id="7455993">ioutil</span><span class="op" id="7455999">.</span><span class="ident" id="7456000">ReadAll</span><span class="op" id="7456007">(</span><span class="ident" id="7456008">srv</span><span class="op" id="7456011">)</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456015">client</span>&nbsp;<span class="op" id="7456022">:=</span>&nbsp;<span class="ident" id="7456025">NewClient</span><span class="op" id="7456034">(</span><span class="ident" id="7456035">cli</span><span class="op" id="7456038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7456041">defer</span>&nbsp;<span class="ident" id="7456047">client</span><span class="op" id="7456053">.</span><span class="ident" id="7456054">Close</span><span class="op" id="7456059">(</span><span class="op" id="7456060">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456064">args</span>&nbsp;<span class="op" id="7456069">:=</span>&nbsp;<span class="op" id="7456072">&amp;</span><span class="ident" id="7456073">Args</span><span class="op" id="7456077">{</span><span class="num" id="7456078">7</span><span class="op" id="7456079">,</span>&nbsp;<span class="num" id="7456081">8</span><span class="op" id="7456082">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456085">reply</span>&nbsp;<span class="op" id="7456091">:=</span>&nbsp;<span class="builtinfunc" id="7456094">new</span><span class="op" id="7456097">(</span><span class="ident" id="7456098">Reply</span><span class="op" id="7456103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456106">err</span>&nbsp;<span class="op" id="7456110">:=</span>&nbsp;<span class="ident" id="7456113">client</span><span class="op" id="7456119">.</span><span class="ident" id="7456120">Call</span><span class="op" id="7456124">(</span><span class="string" id="7456125">&#34;Arith.Add&#34;</span><span class="op" id="7456136">,</span>&nbsp;<span class="ident" id="7456138">args</span><span class="op" id="7456142">,</span>&nbsp;<span class="ident" id="7456144">reply</span><span class="op" id="7456149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7456152">if</span>&nbsp;<span class="ident" id="7456155">err</span>&nbsp;<span class="op" id="7456159">==</span>&nbsp;<span class="ident" id="7456162">nil</span>&nbsp;<span class="op" id="7456166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456170">t</span><span class="op" id="7456171">.</span><span class="ident" id="7456172">Error</span><span class="op" id="7456177">(</span><span class="string" id="7456178">&#34;expected&nbsp;error&#34;</span><span class="op" id="7456194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456197">}</span><br>
<span class="lineno">205</span><span class="op" id="7456199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7456202">func</span>&nbsp;<span class="ident" id="7456207">TestServerErrorHasNullResult</span><span class="op" id="7456235">(</span><span class="ident" id="7456236">t</span>&nbsp;<span class="op" id="7456238">*</span><span class="ident" id="7456239">testing</span><span class="op" id="7456246">.</span><span class="ident" id="7456247">T</span><span class="op" id="7456248">)</span>&nbsp;<span class="op" id="7456250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7456253">var</span>&nbsp;<span class="ident" id="7456257">out</span>&nbsp;<span class="ident" id="7456261">bytes</span><span class="op" id="7456266">.</span><span class="ident" id="7456267">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456275">sc</span>&nbsp;<span class="op" id="7456278">:=</span>&nbsp;<span class="ident" id="7456281">NewServerCodec</span><span class="op" id="7456295">(</span><span class="keyword" id="7456296">struct</span>&nbsp;<span class="op" id="7456303">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456307">io</span><span class="op" id="7456309">.</span><span class="ident" id="7456310">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456319">io</span><span class="op" id="7456321">.</span><span class="ident" id="7456322">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456331">io</span><span class="op" id="7456333">.</span><span class="ident" id="7456334">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456342">}</span><span class="op" id="7456343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456347">Reader</span><span class="op" id="7456353">:</span>&nbsp;<span class="ident" id="7456355">strings</span><span class="op" id="7456362">.</span><span class="ident" id="7456363">NewReader</span><span class="op" id="7456372">(</span><span class="string" id="7456373">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;,&nbsp;&#34;params&#34;:&nbsp;[]}`</span><span class="op" id="7456425">)</span><span class="op" id="7456426">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456430">Writer</span><span class="op" id="7456436">:</span>&nbsp;<span class="op" id="7456438">&amp;</span><span class="ident" id="7456439">out</span><span class="op" id="7456442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456446">Closer</span><span class="op" id="7456452">:</span>&nbsp;<span class="ident" id="7456454">ioutil</span><span class="op" id="7456460">.</span><span class="ident" id="7456461">NopCloser</span><span class="op" id="7456470">(</span><span class="ident" id="7456471">nil</span><span class="op" id="7456474">)</span><span class="op" id="7456475">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456478">}</span><span class="op" id="7456479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456482">r</span>&nbsp;<span class="op" id="7456484">:=</span>&nbsp;<span class="builtinfunc" id="7456487">new</span><span class="op" id="7456490">(</span><span class="ident" id="7456491">rpc</span><span class="op" id="7456494">.</span><span class="ident" id="7456495">Request</span><span class="op" id="7456502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7456505">if</span>&nbsp;<span class="ident" id="7456508">err</span>&nbsp;<span class="op" id="7456512">:=</span>&nbsp;<span class="ident" id="7456515">sc</span><span class="op" id="7456517">.</span><span class="ident" id="7456518">ReadRequestHeader</span><span class="op" id="7456535">(</span><span class="ident" id="7456536">r</span><span class="op" id="7456537">)</span><span class="op" id="7456538">;</span>&nbsp;<span class="ident" id="7456540">err</span>&nbsp;<span class="op" id="7456544">!=</span>&nbsp;<span class="ident" id="7456547">nil</span>&nbsp;<span class="op" id="7456551">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456555">t</span><span class="op" id="7456556">.</span><span class="ident" id="7456557">Fatal</span><span class="op" id="7456562">(</span><span class="ident" id="7456563">err</span><span class="op" id="7456566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7456572">const</span>&nbsp;<span class="ident" id="7456578">valueText</span>&nbsp;<span class="op" id="7456588">=</span>&nbsp;<span class="string" id="7456590">&#34;the&nbsp;value&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;see&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7456624">const</span>&nbsp;<span class="ident" id="7456630">errorText</span>&nbsp;<span class="op" id="7456640">=</span>&nbsp;<span class="string" id="7456642">&#34;some&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456656">err</span>&nbsp;<span class="op" id="7456660">:=</span>&nbsp;<span class="ident" id="7456663">sc</span><span class="op" id="7456665">.</span><span class="ident" id="7456666">WriteResponse</span><span class="op" id="7456679">(</span><span class="op" id="7456680">&amp;</span><span class="ident" id="7456681">rpc</span><span class="op" id="7456684">.</span><span class="ident" id="7456685">Response</span><span class="op" id="7456693">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456697">ServiceMethod</span><span class="op" id="7456710">:</span>&nbsp;<span class="string" id="7456712">&#34;Method&#34;</span><span class="op" id="7456720">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456724">Seq</span><span class="op" id="7456727">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7456739">1</span><span class="op" id="7456740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456744">Error</span><span class="op" id="7456749">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7456759">errorText</span><span class="op" id="7456768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456771">}</span><span class="op" id="7456772">,</span>&nbsp;<span class="ident" id="7456774">valueText</span><span class="op" id="7456783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7456786">if</span>&nbsp;<span class="ident" id="7456789">err</span>&nbsp;<span class="op" id="7456793">!=</span>&nbsp;<span class="ident" id="7456796">nil</span>&nbsp;<span class="op" id="7456800">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456804">t</span><span class="op" id="7456805">.</span><span class="ident" id="7456806">Fatal</span><span class="op" id="7456811">(</span><span class="ident" id="7456812">err</span><span class="op" id="7456815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7456821">if</span>&nbsp;<span class="op" id="7456824">!</span><span class="ident" id="7456825">strings</span><span class="op" id="7456832">.</span><span class="ident" id="7456833">Contains</span><span class="op" id="7456841">(</span><span class="ident" id="7456842">out</span><span class="op" id="7456845">.</span><span class="ident" id="7456846">String</span><span class="op" id="7456852">(</span><span class="op" id="7456853">)</span><span class="op" id="7456854">,</span>&nbsp;<span class="ident" id="7456856">errorText</span><span class="op" id="7456865">)</span>&nbsp;<span class="op" id="7456867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456871">t</span><span class="op" id="7456872">.</span><span class="ident" id="7456873">Fatalf</span><span class="op" id="7456879">(</span><span class="string" id="7456880">&#34;Response&nbsp;didn&#39;t&nbsp;contain&nbsp;expected&nbsp;error&nbsp;%q:&nbsp;%s&#34;</span><span class="op" id="7456927">,</span>&nbsp;<span class="ident" id="7456929">errorText</span><span class="op" id="7456938">,</span>&nbsp;<span class="op" id="7456940">&amp;</span><span class="ident" id="7456941">out</span><span class="op" id="7456944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456947">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7456950">if</span>&nbsp;<span class="ident" id="7456953">strings</span><span class="op" id="7456960">.</span><span class="ident" id="7456961">Contains</span><span class="op" id="7456969">(</span><span class="ident" id="7456970">out</span><span class="op" id="7456973">.</span><span class="ident" id="7456974">String</span><span class="op" id="7456980">(</span><span class="op" id="7456981">)</span><span class="op" id="7456982">,</span>&nbsp;<span class="ident" id="7456984">valueText</span><span class="op" id="7456993">)</span>&nbsp;<span class="op" id="7456995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456999">t</span><span class="op" id="7457000">.</span><span class="ident" id="7457001">Errorf</span><span class="op" id="7457007">(</span><span class="string" id="7457008">&#34;Response&nbsp;contains&nbsp;both&nbsp;an&nbsp;error&nbsp;and&nbsp;value:&nbsp;%s&#34;</span><span class="op" id="7457055">,</span>&nbsp;<span class="op" id="7457057">&amp;</span><span class="ident" id="7457058">out</span><span class="op" id="7457061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7457064">}</span><br>
<span class="lineno"></span><span class="op" id="7457066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7457069">func</span>&nbsp;<span class="ident" id="7457074">TestUnexpectedError</span><span class="op" id="7457093">(</span><span class="ident" id="7457094">t</span>&nbsp;<span class="op" id="7457096">*</span><span class="ident" id="7457097">testing</span><span class="op" id="7457104">.</span><span class="ident" id="7457105">T</span><span class="op" id="7457106">)</span>&nbsp;<span class="op" id="7457108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457111">cli</span><span class="op" id="7457114">,</span>&nbsp;<span class="ident" id="7457116">srv</span>&nbsp;<span class="op" id="7457120">:=</span>&nbsp;<span class="ident" id="7457123">myPipe</span><span class="op" id="7457129">(</span><span class="op" id="7457130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7457133">go</span>&nbsp;<span class="ident" id="7457136">cli</span><span class="op" id="7457139">.</span><span class="ident" id="7457140">PipeWriter</span><span class="op" id="7457150">.</span><span class="ident" id="7457151">CloseWithError</span><span class="op" id="7457165">(</span><span class="ident" id="7457166">errors</span><span class="op" id="7457172">.</span><span class="ident" id="7457173">New</span><span class="op" id="7457176">(</span><span class="string" id="7457177">&#34;unexpected&nbsp;error!&#34;</span><span class="op" id="7457196">)</span><span class="op" id="7457197">)</span>&nbsp;<span class="comment" id="7457199">//&nbsp;reader&nbsp;will&nbsp;get&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457230">ServeConn</span><span class="op" id="7457239">(</span><span class="ident" id="7457240">srv</span><span class="op" id="7457243">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7457296">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="7457321">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="7457324">//&nbsp;Copied&nbsp;from&nbsp;package&nbsp;net.</span><br>
<span class="lineno"></span><span class="keyword" id="7457352">func</span>&nbsp;<span class="ident" id="7457357">myPipe</span><span class="op" id="7457363">(</span><span class="op" id="7457364">)</span>&nbsp;<span class="op" id="7457366">(</span><span class="op" id="7457367">*</span><span class="ident" id="7457368">pipe</span><span class="op" id="7457372">,</span>&nbsp;<span class="op" id="7457374">*</span><span class="ident" id="7457375">pipe</span><span class="op" id="7457379">)</span>&nbsp;<span class="op" id="7457381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457384">r1</span><span class="op" id="7457386">,</span>&nbsp;<span class="ident" id="7457388">w1</span>&nbsp;<span class="op" id="7457391">:=</span>&nbsp;<span class="ident" id="7457394">io</span><span class="op" id="7457396">.</span><span class="ident" id="7457397">Pipe</span><span class="op" id="7457401">(</span><span class="op" id="7457402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457405">r2</span><span class="op" id="7457407">,</span>&nbsp;<span class="ident" id="7457409">w2</span>&nbsp;<span class="op" id="7457412">:=</span>&nbsp;<span class="ident" id="7457415">io</span><span class="op" id="7457417">.</span><span class="ident" id="7457418">Pipe</span><span class="op" id="7457422">(</span><span class="op" id="7457423">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7457427">return</span>&nbsp;<span class="op" id="7457434">&amp;</span><span class="ident" id="7457435">pipe</span><span class="op" id="7457439">{</span><span class="ident" id="7457440">r1</span><span class="op" id="7457442">,</span>&nbsp;<span class="ident" id="7457444">w2</span><span class="op" id="7457446">}</span><span class="op" id="7457447">,</span>&nbsp;<span class="op" id="7457449">&amp;</span><span class="ident" id="7457450">pipe</span><span class="op" id="7457454">{</span><span class="ident" id="7457455">r2</span><span class="op" id="7457457">,</span>&nbsp;<span class="ident" id="7457459">w1</span><span class="op" id="7457461">}</span><br>
<span class="lineno"></span><span class="op" id="7457463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7457466">type</span>&nbsp;<span class="ident" id="7457471">pipe</span>&nbsp;<span class="keyword" id="7457476">struct</span>&nbsp;<span class="op" id="7457483">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7457486">*</span><span class="ident" id="7457487">io</span><span class="op" id="7457489">.</span><span class="ident" id="7457490">PipeReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7457502">*</span><span class="ident" id="7457503">io</span><span class="op" id="7457505">.</span><span class="ident" id="7457506">PipeWriter</span><br>
<span class="lineno"></span><span class="op" id="7457517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7457520">type</span>&nbsp;<span class="ident" id="7457525">pipeAddr</span>&nbsp;<span class="builtintype" id="7457534">int</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="7457539">func</span>&nbsp;<span class="op" id="7457544">(</span><span class="ident" id="7457545">pipeAddr</span><span class="op" id="7457553">)</span>&nbsp;<span class="ident" id="7457555">Network</span><span class="op" id="7457562">(</span><span class="op" id="7457563">)</span>&nbsp;<span class="builtintype" id="7457565">string</span>&nbsp;<span class="op" id="7457572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7457575">return</span>&nbsp;<span class="string" id="7457582">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="7457589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="keyword" id="7457592">func</span>&nbsp;<span class="op" id="7457597">(</span><span class="ident" id="7457598">pipeAddr</span><span class="op" id="7457606">)</span>&nbsp;<span class="ident" id="7457608">String</span><span class="op" id="7457614">(</span><span class="op" id="7457615">)</span>&nbsp;<span class="builtintype" id="7457617">string</span>&nbsp;<span class="op" id="7457624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7457627">return</span>&nbsp;<span class="string" id="7457634">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="7457641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7457644">func</span>&nbsp;<span class="op" id="7457649">(</span><span class="ident" id="7457650">p</span>&nbsp;<span class="op" id="7457652">*</span><span class="ident" id="7457653">pipe</span><span class="op" id="7457657">)</span>&nbsp;<span class="ident" id="7457659">Close</span><span class="op" id="7457664">(</span><span class="op" id="7457665">)</span>&nbsp;<span class="builtintype" id="7457667">error</span>&nbsp;<span class="op" id="7457673">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457676">err</span>&nbsp;<span class="op" id="7457680">:=</span>&nbsp;<span class="ident" id="7457683">p</span><span class="op" id="7457684">.</span><span class="ident" id="7457685">PipeReader</span><span class="op" id="7457695">.</span><span class="ident" id="7457696">Close</span><span class="op" id="7457701">(</span><span class="op" id="7457702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457705">err1</span>&nbsp;<span class="op" id="7457710">:=</span>&nbsp;<span class="ident" id="7457713">p</span><span class="op" id="7457714">.</span><span class="ident" id="7457715">PipeWriter</span><span class="op" id="7457725">.</span><span class="ident" id="7457726">Close</span><span class="op" id="7457731">(</span><span class="op" id="7457732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7457735">if</span>&nbsp;<span class="ident" id="7457738">err</span>&nbsp;<span class="op" id="7457742">==</span>&nbsp;<span class="ident" id="7457745">nil</span>&nbsp;<span class="op" id="7457749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7457753">err</span>&nbsp;<span class="op" id="7457757">=</span>&nbsp;<span class="ident" id="7457759">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7457765">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7457768">return</span>&nbsp;<span class="ident" id="7457775">err</span><br>
<span class="lineno"></span><span class="op" id="7457779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7457782">func</span>&nbsp;<span class="op" id="7457787">(</span><span class="ident" id="7457788">p</span>&nbsp;<span class="op" id="7457790">*</span><span class="ident" id="7457791">pipe</span><span class="op" id="7457795">)</span>&nbsp;<span class="ident" id="7457797">LocalAddr</span><span class="op" id="7457806">(</span><span class="op" id="7457807">)</span>&nbsp;<span class="ident" id="7457809">net</span><span class="op" id="7457812">.</span><span class="ident" id="7457813">Addr</span>&nbsp;<span class="op" id="7457818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7457821">return</span>&nbsp;<span class="ident" id="7457828">pipeAddr</span><span class="op" id="7457836">(</span><span class="num" id="7457837">0</span><span class="op" id="7457838">)</span><br>
<span class="lineno">280</span><span class="op" id="7457840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7457843">func</span>&nbsp;<span class="op" id="7457848">(</span><span class="ident" id="7457849">p</span>&nbsp;<span class="op" id="7457851">*</span><span class="ident" id="7457852">pipe</span><span class="op" id="7457856">)</span>&nbsp;<span class="ident" id="7457858">RemoteAddr</span><span class="op" id="7457868">(</span><span class="op" id="7457869">)</span>&nbsp;<span class="ident" id="7457871">net</span><span class="op" id="7457874">.</span><span class="ident" id="7457875">Addr</span>&nbsp;<span class="op" id="7457880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7457883">return</span>&nbsp;<span class="ident" id="7457890">pipeAddr</span><span class="op" id="7457898">(</span><span class="num" id="7457899">0</span><span class="op" id="7457900">)</span><br>
<span class="lineno"></span><span class="op" id="7457902">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="7457905">func</span>&nbsp;<span class="op" id="7457910">(</span><span class="ident" id="7457911">p</span>&nbsp;<span class="op" id="7457913">*</span><span class="ident" id="7457914">pipe</span><span class="op" id="7457918">)</span>&nbsp;<span class="ident" id="7457920">SetTimeout</span><span class="op" id="7457930">(</span><span class="ident" id="7457931">nsec</span>&nbsp;<span class="ident" id="7457936">int64</span><span class="op" id="7457941">)</span>&nbsp;<span class="builtintype" id="7457943">error</span>&nbsp;<span class="op" id="7457949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7457952">return</span>&nbsp;<span class="ident" id="7457959">errors</span><span class="op" id="7457965">.</span><span class="ident" id="7457966">New</span><span class="op" id="7457969">(</span><span class="string" id="7457970">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="7458006">)</span><br>
<span class="lineno"></span><span class="op" id="7458008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="7458011">func</span>&nbsp;<span class="op" id="7458016">(</span><span class="ident" id="7458017">p</span>&nbsp;<span class="op" id="7458019">*</span><span class="ident" id="7458020">pipe</span><span class="op" id="7458024">)</span>&nbsp;<span class="ident" id="7458026">SetReadTimeout</span><span class="op" id="7458040">(</span><span class="ident" id="7458041">nsec</span>&nbsp;<span class="ident" id="7458046">int64</span><span class="op" id="7458051">)</span>&nbsp;<span class="builtintype" id="7458053">error</span>&nbsp;<span class="op" id="7458059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7458062">return</span>&nbsp;<span class="ident" id="7458069">errors</span><span class="op" id="7458075">.</span><span class="ident" id="7458076">New</span><span class="op" id="7458079">(</span><span class="string" id="7458080">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="7458116">)</span><br>
<span class="lineno"></span><span class="op" id="7458118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7458121">func</span>&nbsp;<span class="op" id="7458126">(</span><span class="ident" id="7458127">p</span>&nbsp;<span class="op" id="7458129">*</span><span class="ident" id="7458130">pipe</span><span class="op" id="7458134">)</span>&nbsp;<span class="ident" id="7458136">SetWriteTimeout</span><span class="op" id="7458151">(</span><span class="ident" id="7458152">nsec</span>&nbsp;<span class="ident" id="7458157">int64</span><span class="op" id="7458162">)</span>&nbsp;<span class="builtintype" id="7458164">error</span>&nbsp;<span class="op" id="7458170">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7458173">return</span>&nbsp;<span class="ident" id="7458180">errors</span><span class="op" id="7458186">.</span><span class="ident" id="7458187">New</span><span class="op" id="7458190">(</span><span class="string" id="7458191">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="7458227">)</span><br>
<span class="lineno"></span><span class="op" id="7458229">}</span>
</div>
</body>
</html>
