<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1671899">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1671955">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1672009">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1672060">package</span>&nbsp;<span class="ident" id="1672068">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1672077">var</span>&nbsp;<span class="ident" id="1672081">ticks</span>&nbsp;<span class="keyword" id="1672087">struct</span>&nbsp;<span class="op" id="1672094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672097">lock</span>&nbsp;<span class="ident" id="1672102">mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672109">val</span>&nbsp;&nbsp;<span class="ident" id="1672114">uint64</span><br>
<span class="lineno">10</span><span class="op" id="1672121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1672124">var</span>&nbsp;<span class="ident" id="1672128">tls0</span>&nbsp;<span class="op" id="1672133">[</span><span class="num" id="1672134">8</span><span class="op" id="1672135">]</span><span class="builtintype" id="1672136">uintptr</span>&nbsp;<span class="comment" id="1672144">//&nbsp;available&nbsp;storage&nbsp;for&nbsp;m0&#39;s&nbsp;TLS;&nbsp;not&nbsp;necessarily&nbsp;used;&nbsp;opaque&nbsp;to&nbsp;GC</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1672215">//&nbsp;Note:&nbsp;Called&nbsp;by&nbsp;runtime/pprof&nbsp;in&nbsp;addition&nbsp;to&nbsp;runtime&nbsp;code.</span><br>
<span class="lineno">15</span><span class="keyword" id="1672277">func</span>&nbsp;<span class="ident" id="1672282">tickspersecond</span><span class="op" id="1672296">(</span><span class="op" id="1672297">)</span>&nbsp;<span class="ident" id="1672299">int64</span>&nbsp;<span class="op" id="1672305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672308">r</span>&nbsp;<span class="op" id="1672310">:=</span>&nbsp;<span class="ident" id="1672313">int64</span><span class="op" id="1672318">(</span><span class="ident" id="1672319">atomicload64</span><span class="op" id="1672331">(</span><span class="op" id="1672332">&amp;</span><span class="ident" id="1672333">ticks</span><span class="op" id="1672338">.</span><span class="ident" id="1672339">val</span><span class="op" id="1672342">)</span><span class="op" id="1672343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672346">if</span>&nbsp;<span class="ident" id="1672349">r</span>&nbsp;<span class="op" id="1672351">!=</span>&nbsp;<span class="num" id="1672354">0</span>&nbsp;<span class="op" id="1672356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672360">return</span>&nbsp;<span class="ident" id="1672367">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1672370">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672373">lock</span><span class="op" id="1672377">(</span><span class="op" id="1672378">&amp;</span><span class="ident" id="1672379">ticks</span><span class="op" id="1672384">.</span><span class="ident" id="1672385">lock</span><span class="op" id="1672389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672392">r</span>&nbsp;<span class="op" id="1672394">=</span>&nbsp;<span class="ident" id="1672396">int64</span><span class="op" id="1672401">(</span><span class="ident" id="1672402">ticks</span><span class="op" id="1672407">.</span><span class="ident" id="1672408">val</span><span class="op" id="1672411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672414">if</span>&nbsp;<span class="ident" id="1672417">r</span>&nbsp;<span class="op" id="1672419">==</span>&nbsp;<span class="num" id="1672422">0</span>&nbsp;<span class="op" id="1672424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672428">t0</span>&nbsp;<span class="op" id="1672431">:=</span>&nbsp;<span class="ident" id="1672434">nanotime</span><span class="op" id="1672442">(</span><span class="op" id="1672443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672447">c0</span>&nbsp;<span class="op" id="1672450">:=</span>&nbsp;<span class="ident" id="1672453">cputicks</span><span class="op" id="1672461">(</span><span class="op" id="1672462">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672466">usleep</span><span class="op" id="1672472">(</span><span class="num" id="1672473">100</span>&nbsp;<span class="op" id="1672477">*</span>&nbsp;<span class="num" id="1672479">1000</span><span class="op" id="1672483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672487">t1</span>&nbsp;<span class="op" id="1672490">:=</span>&nbsp;<span class="ident" id="1672493">nanotime</span><span class="op" id="1672501">(</span><span class="op" id="1672502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672506">c1</span>&nbsp;<span class="op" id="1672509">:=</span>&nbsp;<span class="ident" id="1672512">cputicks</span><span class="op" id="1672520">(</span><span class="op" id="1672521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672525">if</span>&nbsp;<span class="ident" id="1672528">t1</span>&nbsp;<span class="op" id="1672531">==</span>&nbsp;<span class="ident" id="1672534">t0</span>&nbsp;<span class="op" id="1672537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672542">t1</span><span class="op" id="1672544">++</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1672549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672553">r</span>&nbsp;<span class="op" id="1672555">=</span>&nbsp;<span class="op" id="1672557">(</span><span class="ident" id="1672558">c1</span>&nbsp;<span class="op" id="1672561">-</span>&nbsp;<span class="ident" id="1672563">c0</span><span class="op" id="1672565">)</span>&nbsp;<span class="op" id="1672567">*</span>&nbsp;<span class="num" id="1672569">1000</span>&nbsp;<span class="op" id="1672574">*</span>&nbsp;<span class="num" id="1672576">1000</span>&nbsp;<span class="op" id="1672581">*</span>&nbsp;<span class="num" id="1672583">1000</span>&nbsp;<span class="op" id="1672588">/</span>&nbsp;<span class="op" id="1672590">(</span><span class="ident" id="1672591">t1</span>&nbsp;<span class="op" id="1672594">-</span>&nbsp;<span class="ident" id="1672596">t0</span><span class="op" id="1672598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672602">if</span>&nbsp;<span class="ident" id="1672605">r</span>&nbsp;<span class="op" id="1672607">==</span>&nbsp;<span class="num" id="1672610">0</span>&nbsp;<span class="op" id="1672612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672617">r</span><span class="op" id="1672618">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1672623">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672627">atomicstore64</span><span class="op" id="1672640">(</span><span class="op" id="1672641">&amp;</span><span class="ident" id="1672642">ticks</span><span class="op" id="1672647">.</span><span class="ident" id="1672648">val</span><span class="op" id="1672651">,</span>&nbsp;<span class="ident" id="1672653">uint64</span><span class="op" id="1672659">(</span><span class="ident" id="1672660">r</span><span class="op" id="1672661">)</span><span class="op" id="1672662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1672665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672668">unlock</span><span class="op" id="1672674">(</span><span class="op" id="1672675">&amp;</span><span class="ident" id="1672676">ticks</span><span class="op" id="1672681">.</span><span class="ident" id="1672682">lock</span><span class="op" id="1672686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672689">return</span>&nbsp;<span class="ident" id="1672696">r</span><br>
<span class="lineno"></span><span class="op" id="1672698">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="1672701">func</span>&nbsp;<span class="ident" id="1672706">makeStringSlice</span><span class="op" id="1672721">(</span><span class="ident" id="1672722">n</span>&nbsp;<span class="builtintype" id="1672724">int</span><span class="op" id="1672727">)</span>&nbsp;<span class="op" id="1672729">[</span><span class="op" id="1672730">]</span><span class="builtintype" id="1672731">string</span>&nbsp;<span class="op" id="1672738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672741">return</span>&nbsp;<span class="builtinfunc" id="1672748">make</span><span class="op" id="1672752">(</span><span class="op" id="1672753">[</span><span class="op" id="1672754">]</span><span class="builtintype" id="1672755">string</span><span class="op" id="1672761">,</span>&nbsp;<span class="ident" id="1672763">n</span><span class="op" id="1672764">)</span><br>
<span class="lineno"></span><span class="op" id="1672766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="1672769">//&nbsp;TODO:&nbsp;Move&nbsp;to&nbsp;parfor.go&nbsp;when&nbsp;parfor.c&nbsp;becomes&nbsp;parfor.go.</span><br>
<span class="lineno"></span><span class="keyword" id="1672829">func</span>&nbsp;<span class="ident" id="1672834">parforalloc</span><span class="op" id="1672845">(</span><span class="ident" id="1672846">nthrmax</span>&nbsp;<span class="builtintype" id="1672854">uint32</span><span class="op" id="1672860">)</span>&nbsp;<span class="op" id="1672862">*</span><span class="ident" id="1672863">parfor</span>&nbsp;<span class="op" id="1672870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672873">return</span>&nbsp;<span class="op" id="1672880">&amp;</span><span class="ident" id="1672881">parfor</span><span class="op" id="1672887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672891">thr</span><span class="op" id="1672894">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1672900">&amp;</span><span class="builtinfunc" id="1672901">make</span><span class="op" id="1672905">(</span><span class="op" id="1672906">[</span><span class="op" id="1672907">]</span><span class="ident" id="1672908">parforthread</span><span class="op" id="1672920">,</span>&nbsp;<span class="ident" id="1672922">nthrmax</span><span class="op" id="1672929">)</span><span class="op" id="1672930">[</span><span class="num" id="1672931">0</span><span class="op" id="1672932">]</span><span class="op" id="1672933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672937">nthrmax</span><span class="op" id="1672944">:</span>&nbsp;<span class="ident" id="1672946">nthrmax</span><span class="op" id="1672953">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1672956">}</span><br>
<span class="lineno"></span><span class="op" id="1672958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1672961">var</span>&nbsp;<span class="ident" id="1672965">envs</span>&nbsp;<span class="op" id="1672970">[</span><span class="op" id="1672971">]</span><span class="builtintype" id="1672972">string</span><br>
<span class="lineno"></span><span class="keyword" id="1672979">var</span>&nbsp;<span class="ident" id="1672983">argslice</span>&nbsp;<span class="op" id="1672992">[</span><span class="op" id="1672993">]</span><span class="builtintype" id="1672994">string</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="1673002">//&nbsp;called&nbsp;from&nbsp;syscall</span><br>
<span class="lineno"></span><span class="keyword" id="1673025">func</span>&nbsp;<span class="ident" id="1673030">runtime_envs</span><span class="op" id="1673042">(</span><span class="op" id="1673043">)</span>&nbsp;<span class="op" id="1673045">[</span><span class="op" id="1673046">]</span><span class="builtintype" id="1673047">string</span>&nbsp;<span class="op" id="1673054">{</span>&nbsp;<span class="keyword" id="1673056">return</span>&nbsp;<span class="ident" id="1673063">envs</span>&nbsp;<span class="op" id="1673068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1673071">//&nbsp;called&nbsp;from&nbsp;os</span><br>
<span class="lineno">60</span><span class="keyword" id="1673089">func</span>&nbsp;<span class="ident" id="1673094">runtime_args</span><span class="op" id="1673106">(</span><span class="op" id="1673107">)</span>&nbsp;<span class="op" id="1673109">[</span><span class="op" id="1673110">]</span><span class="builtintype" id="1673111">string</span>&nbsp;<span class="op" id="1673118">{</span>&nbsp;<span class="keyword" id="1673120">return</span>&nbsp;<span class="ident" id="1673127">argslice</span>&nbsp;<span class="op" id="1673136">}</span>
</div>
</body>
</html>
