<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html" class="current">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7562880">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7562935">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7562989">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7563040">package</span>&nbsp;<span class="ident" id="7563048">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7563054">import</span>&nbsp;<span class="op" id="7563061">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7563064">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7563073">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7563082">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7563096">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7563111">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7563117">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7563124">&#34;net/textproto&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7563141">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7563152">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7563163">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7563170">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7563173">type</span>&nbsp;<span class="ident" id="7563178">authTest</span>&nbsp;<span class="keyword" id="7563187">struct</span>&nbsp;<span class="op" id="7563194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7563197">auth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7563208"><a href="/gostd/net/smtp/auth.go.html#5787279">Auth</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7563214">challenges</span>&nbsp;<span class="op" id="7563225">[</span><span class="op" id="7563226">]</span><span class="builtintype" id="7563227">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7563235">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7563246">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7563254">responses</span>&nbsp;&nbsp;<span class="op" id="7563265">[</span><span class="op" id="7563266">]</span><span class="builtintype" id="7563267">string</span><br>
<span class="lineno">25</span><span class="op" id="7563274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7563277">var</span>&nbsp;<span class="ident" id="7563281">authTests</span>&nbsp;<span class="op" id="7563291">=</span>&nbsp;<span class="op" id="7563293">[</span><span class="op" id="7563294">]</span><span class="ident" id="7563295"><a href="/gostd/net/smtp/smtp_test.go.html#7563178">authTest</a></span><span class="op" id="7563303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7563306">{</span><span class="ident" id="7563307"><a href="/gostd/net/smtp/auth.go.html#5788807">PlainAuth</a></span><span class="op" id="7563316">(</span><span class="string" id="7563317">&#34;&#34;</span><span class="op" id="7563319">,</span>&nbsp;<span class="string" id="7563321">&#34;user&#34;</span><span class="op" id="7563327">,</span>&nbsp;<span class="string" id="7563329">&#34;pass&#34;</span><span class="op" id="7563335">,</span>&nbsp;<span class="string" id="7563337">&#34;testserver&#34;</span><span class="op" id="7563349">)</span><span class="op" id="7563350">,</span>&nbsp;<span class="op" id="7563352">[</span><span class="op" id="7563353">]</span><span class="builtintype" id="7563354">string</span><span class="op" id="7563360">{</span><span class="op" id="7563361">}</span><span class="op" id="7563362">,</span>&nbsp;<span class="string" id="7563364">&#34;PLAIN&#34;</span><span class="op" id="7563371">,</span>&nbsp;<span class="op" id="7563373">[</span><span class="op" id="7563374">]</span><span class="builtintype" id="7563375">string</span><span class="op" id="7563381">{</span><span class="string" id="7563382">&#34;\x00user\x00pass&#34;</span><span class="op" id="7563400">}</span><span class="op" id="7563401">}</span><span class="op" id="7563402">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7563405">{</span><span class="ident" id="7563406"><a href="/gostd/net/smtp/auth.go.html#5788807">PlainAuth</a></span><span class="op" id="7563415">(</span><span class="string" id="7563416">&#34;foo&#34;</span><span class="op" id="7563421">,</span>&nbsp;<span class="string" id="7563423">&#34;bar&#34;</span><span class="op" id="7563428">,</span>&nbsp;<span class="string" id="7563430">&#34;baz&#34;</span><span class="op" id="7563435">,</span>&nbsp;<span class="string" id="7563437">&#34;testserver&#34;</span><span class="op" id="7563449">)</span><span class="op" id="7563450">,</span>&nbsp;<span class="op" id="7563452">[</span><span class="op" id="7563453">]</span><span class="builtintype" id="7563454">string</span><span class="op" id="7563460">{</span><span class="op" id="7563461">}</span><span class="op" id="7563462">,</span>&nbsp;<span class="string" id="7563464">&#34;PLAIN&#34;</span><span class="op" id="7563471">,</span>&nbsp;<span class="op" id="7563473">[</span><span class="op" id="7563474">]</span><span class="builtintype" id="7563475">string</span><span class="op" id="7563481">{</span><span class="string" id="7563482">&#34;foo\x00bar\x00baz&#34;</span><span class="op" id="7563501">}</span><span class="op" id="7563502">}</span><span class="op" id="7563503">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7563506">{</span><span class="ident" id="7563507"><a href="/gostd/net/smtp/auth.go.html#5789911">CRAMMD5Auth</a></span><span class="op" id="7563518">(</span><span class="string" id="7563519">&#34;user&#34;</span><span class="op" id="7563525">,</span>&nbsp;<span class="string" id="7563527">&#34;pass&#34;</span><span class="op" id="7563533">)</span><span class="op" id="7563534">,</span>&nbsp;<span class="op" id="7563536">[</span><span class="op" id="7563537">]</span><span class="builtintype" id="7563538">string</span><span class="op" id="7563544">{</span><span class="string" id="7563545">&#34;&lt;123456.1322876914@testserver&gt;&#34;</span><span class="op" id="7563577">}</span><span class="op" id="7563578">,</span>&nbsp;<span class="string" id="7563580">&#34;CRAM-MD5&#34;</span><span class="op" id="7563590">,</span>&nbsp;<span class="op" id="7563592">[</span><span class="op" id="7563593">]</span><span class="builtintype" id="7563594">string</span><span class="op" id="7563600">{</span><span class="string" id="7563601">&#34;&#34;</span><span class="op" id="7563603">,</span>&nbsp;<span class="string" id="7563605">&#34;user&nbsp;287eb355114cf5c471c26a875f1ca4ae&#34;</span><span class="op" id="7563644">}</span><span class="op" id="7563645">}</span><span class="op" id="7563646">,</span><br>
<span class="lineno"></span><span class="op" id="7563648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7563651">func</span>&nbsp;<span class="ident" id="7563656">TestAuth</span><span class="op" id="7563664">(</span><span class="ident" id="7563665">t</span>&nbsp;<span class="op" id="7563667">*</span><span class="ident" id="7563668"><a href="/gostd/net/smtp/smtp_test.go.html#7563152">testing</a></span><span class="op" id="7563675">.</span><span class="ident" id="7563676"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7563677">)</span>&nbsp;<span class="op" id="7563679">{</span><br>
<span class="lineno"></span><span class="ident" id="7563681">testLoop</span><span class="op" id="7563689">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7563692">for</span>&nbsp;<span class="ident" id="7563696">i</span><span class="op" id="7563697">,</span>&nbsp;<span class="ident" id="7563699">test</span>&nbsp;<span class="op" id="7563704">:=</span>&nbsp;<span class="keyword" id="7563707">range</span>&nbsp;<span class="ident" id="7563713"><a href="/gostd/net/smtp/smtp_test.go.html#7563281">authTests</a></span>&nbsp;<span class="op" id="7563723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7563727">name</span><span class="op" id="7563731">,</span>&nbsp;<span class="ident" id="7563733">resp</span><span class="op" id="7563737">,</span>&nbsp;<span class="ident" id="7563739">err</span>&nbsp;<span class="op" id="7563743">:=</span>&nbsp;<span class="ident" id="7563746"><a href="/gostd/net/smtp/smtp_test.go.html#7563699">test</a></span><span class="op" id="7563750">.</span><span class="ident" id="7563751"><a href="/gostd/net/smtp/smtp_test.go.html#7563197">auth</a></span><span class="op" id="7563755">.</span><span class="ident" id="7563756"><a href="/gostd/net/smtp/auth.go.html#5787690">Start</a></span><span class="op" id="7563761">(</span><span class="op" id="7563762">&amp;</span><span class="ident" id="7563763"><a href="/gostd/net/smtp/auth.go.html#5788236">ServerInfo</a></span><span class="op" id="7563773">{</span><span class="string" id="7563774">&#34;testserver&#34;</span><span class="op" id="7563786">,</span>&nbsp;<span class="builtintype" id="7563788">true</span><span class="op" id="7563792">,</span>&nbsp;<span class="builtintype" id="7563794">nil</span><span class="op" id="7563797">}</span><span class="op" id="7563798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7563802">if</span>&nbsp;<span class="ident" id="7563805"><a href="/gostd/net/smtp/smtp_test.go.html#7563727">name</a></span>&nbsp;<span class="op" id="7563810">!=</span>&nbsp;<span class="ident" id="7563813"><a href="/gostd/net/smtp/smtp_test.go.html#7563699">test</a></span><span class="op" id="7563817">.</span><span class="ident" id="7563818"><a href="/gostd/net/smtp/smtp_test.go.html#7563235">name</a></span>&nbsp;<span class="op" id="7563823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7563828"><a href="/gostd/net/smtp/smtp_test.go.html#7563665">t</a></span><span class="op" id="7563829">.</span><span class="ident" id="7563830"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7563836">(</span><span class="string" id="7563837">&#34;#%d&nbsp;got&nbsp;name&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="7563867">,</span>&nbsp;<span class="ident" id="7563869"><a href="/gostd/net/smtp/smtp_test.go.html#7563696">i</a></span><span class="op" id="7563870">,</span>&nbsp;<span class="ident" id="7563872"><a href="/gostd/net/smtp/smtp_test.go.html#7563727">name</a></span><span class="op" id="7563876">,</span>&nbsp;<span class="ident" id="7563878"><a href="/gostd/net/smtp/smtp_test.go.html#7563699">test</a></span><span class="op" id="7563882">.</span><span class="ident" id="7563883"><a href="/gostd/net/smtp/smtp_test.go.html#7563235">name</a></span><span class="op" id="7563887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7563891">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7563895">if</span>&nbsp;<span class="op" id="7563898">!</span><span class="ident" id="7563899"><a href="/gostd/net/smtp/smtp_test.go.html#7563073">bytes</a></span><span class="op" id="7563904">.</span><span class="ident" id="7563905"><a href="/gostd/bytes/bytes_decl.go.html#1414806">Equal</a></span><span class="op" id="7563910">(</span><span class="ident" id="7563911"><a href="/gostd/net/smtp/smtp_test.go.html#7563733">resp</a></span><span class="op" id="7563915">,</span>&nbsp;<span class="op" id="7563917">[</span><span class="op" id="7563918">]</span><span class="builtintype" id="7563919">byte</span><span class="op" id="7563923">(</span><span class="ident" id="7563924"><a href="/gostd/net/smtp/smtp_test.go.html#7563699">test</a></span><span class="op" id="7563928">.</span><span class="ident" id="7563929"><a href="/gostd/net/smtp/smtp_test.go.html#7563254">responses</a></span><span class="op" id="7563938">[</span><span class="num" id="7563939">0</span><span class="op" id="7563940">]</span><span class="op" id="7563941">)</span><span class="op" id="7563942">)</span>&nbsp;<span class="op" id="7563944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7563949"><a href="/gostd/net/smtp/smtp_test.go.html#7563665">t</a></span><span class="op" id="7563950">.</span><span class="ident" id="7563951"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7563957">(</span><span class="string" id="7563958">&#34;#%d&nbsp;got&nbsp;response&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="7563992">,</span>&nbsp;<span class="ident" id="7563994"><a href="/gostd/net/smtp/smtp_test.go.html#7563696">i</a></span><span class="op" id="7563995">,</span>&nbsp;<span class="ident" id="7563997"><a href="/gostd/net/smtp/smtp_test.go.html#7563733">resp</a></span><span class="op" id="7564001">,</span>&nbsp;<span class="ident" id="7564003"><a href="/gostd/net/smtp/smtp_test.go.html#7563699">test</a></span><span class="op" id="7564007">.</span><span class="ident" id="7564008"><a href="/gostd/net/smtp/smtp_test.go.html#7563254">responses</a></span><span class="op" id="7564017">[</span><span class="num" id="7564018">0</span><span class="op" id="7564019">]</span><span class="op" id="7564020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7564024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7564028">if</span>&nbsp;<span class="ident" id="7564031"><a href="/gostd/net/smtp/smtp_test.go.html#7563739">err</a></span>&nbsp;<span class="op" id="7564035">!=</span>&nbsp;<span class="builtintype" id="7564038">nil</span>&nbsp;<span class="op" id="7564042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7564047"><a href="/gostd/net/smtp/smtp_test.go.html#7563665">t</a></span><span class="op" id="7564048">.</span><span class="ident" id="7564049"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7564055">(</span><span class="string" id="7564056">&#34;#%d&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7564071">,</span>&nbsp;<span class="ident" id="7564073"><a href="/gostd/net/smtp/smtp_test.go.html#7563696">i</a></span><span class="op" id="7564074">,</span>&nbsp;<span class="ident" id="7564076"><a href="/gostd/net/smtp/smtp_test.go.html#7563739">err</a></span><span class="op" id="7564079">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7564083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7564087">for</span>&nbsp;<span class="ident" id="7564091">j</span>&nbsp;<span class="op" id="7564093">:=</span>&nbsp;<span class="keyword" id="7564096">range</span>&nbsp;<span class="ident" id="7564102"><a href="/gostd/net/smtp/smtp_test.go.html#7563699">test</a></span><span class="op" id="7564106">.</span><span class="ident" id="7564107"><a href="/gostd/net/smtp/smtp_test.go.html#7563214">challenges</a></span>&nbsp;<span class="op" id="7564118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7564123">challenge</span>&nbsp;<span class="op" id="7564133">:=</span>&nbsp;<span class="op" id="7564136">[</span><span class="op" id="7564137">]</span><span class="builtintype" id="7564138">byte</span><span class="op" id="7564142">(</span><span class="ident" id="7564143"><a href="/gostd/net/smtp/smtp_test.go.html#7563699">test</a></span><span class="op" id="7564147">.</span><span class="ident" id="7564148"><a href="/gostd/net/smtp/smtp_test.go.html#7563214">challenges</a></span><span class="op" id="7564158">[</span><span class="ident" id="7564159"><a href="/gostd/net/smtp/smtp_test.go.html#7564091">j</a></span><span class="op" id="7564160">]</span><span class="op" id="7564161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7564166">expected</span>&nbsp;<span class="op" id="7564175">:=</span>&nbsp;<span class="op" id="7564178">[</span><span class="op" id="7564179">]</span><span class="builtintype" id="7564180">byte</span><span class="op" id="7564184">(</span><span class="ident" id="7564185"><a href="/gostd/net/smtp/smtp_test.go.html#7563699">test</a></span><span class="op" id="7564189">.</span><span class="ident" id="7564190"><a href="/gostd/net/smtp/smtp_test.go.html#7563254">responses</a></span><span class="op" id="7564199">[</span><span class="ident" id="7564200"><a href="/gostd/net/smtp/smtp_test.go.html#7564091">j</a></span><span class="op" id="7564201">+</span><span class="num" id="7564202">1</span><span class="op" id="7564203">]</span><span class="op" id="7564204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7564209">resp</span><span class="op" id="7564213">,</span>&nbsp;<span class="ident" id="7564215">err</span>&nbsp;<span class="op" id="7564219">:=</span>&nbsp;<span class="ident" id="7564222"><a href="/gostd/net/smtp/smtp_test.go.html#7563699">test</a></span><span class="op" id="7564226">.</span><span class="ident" id="7564227"><a href="/gostd/net/smtp/smtp_test.go.html#7563197">auth</a></span><span class="op" id="7564231">.</span><span class="ident" id="7564232"><a href="/gostd/net/smtp/auth.go.html#5788108">Next</a></span><span class="op" id="7564236">(</span><span class="ident" id="7564237"><a href="/gostd/net/smtp/smtp_test.go.html#7564123">challenge</a></span><span class="op" id="7564246">,</span>&nbsp;<span class="builtintype" id="7564248">true</span><span class="op" id="7564252">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7564257">if</span>&nbsp;<span class="ident" id="7564260"><a href="/gostd/net/smtp/smtp_test.go.html#7564215">err</a></span>&nbsp;<span class="op" id="7564264">!=</span>&nbsp;<span class="builtintype" id="7564267">nil</span>&nbsp;<span class="op" id="7564271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7564277"><a href="/gostd/net/smtp/smtp_test.go.html#7563665">t</a></span><span class="op" id="7564278">.</span><span class="ident" id="7564279"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7564285">(</span><span class="string" id="7564286">&#34;#%d&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7564301">,</span>&nbsp;<span class="ident" id="7564303"><a href="/gostd/net/smtp/smtp_test.go.html#7563696">i</a></span><span class="op" id="7564304">,</span>&nbsp;<span class="ident" id="7564306"><a href="/gostd/net/smtp/smtp_test.go.html#7564215">err</a></span><span class="op" id="7564309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7564315">continue</span>&nbsp;<span class="ident" id="7564324"><a href="/gostd/net/smtp/smtp_test.go.html#7563681">testLoop</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7564336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7564341">if</span>&nbsp;<span class="op" id="7564344">!</span><span class="ident" id="7564345"><a href="/gostd/net/smtp/smtp_test.go.html#7563073">bytes</a></span><span class="op" id="7564350">.</span><span class="ident" id="7564351"><a href="/gostd/bytes/bytes_decl.go.html#1414806">Equal</a></span><span class="op" id="7564356">(</span><span class="ident" id="7564357"><a href="/gostd/net/smtp/smtp_test.go.html#7564209">resp</a></span><span class="op" id="7564361">,</span>&nbsp;<span class="ident" id="7564363"><a href="/gostd/net/smtp/smtp_test.go.html#7564166">expected</a></span><span class="op" id="7564371">)</span>&nbsp;<span class="op" id="7564373">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7564379"><a href="/gostd/net/smtp/smtp_test.go.html#7563665">t</a></span><span class="op" id="7564380">.</span><span class="ident" id="7564381"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7564387">(</span><span class="string" id="7564388">&#34;#%d&nbsp;got&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="7564413">,</span>&nbsp;<span class="ident" id="7564415"><a href="/gostd/net/smtp/smtp_test.go.html#7563696">i</a></span><span class="op" id="7564416">,</span>&nbsp;<span class="ident" id="7564418"><a href="/gostd/net/smtp/smtp_test.go.html#7564209">resp</a></span><span class="op" id="7564422">,</span>&nbsp;<span class="ident" id="7564424"><a href="/gostd/net/smtp/smtp_test.go.html#7564166">expected</a></span><span class="op" id="7564432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7564438">continue</span>&nbsp;<span class="ident" id="7564447"><a href="/gostd/net/smtp/smtp_test.go.html#7563681">testLoop</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7564459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7564463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7564466">}</span><br>
<span class="lineno">60</span><span class="op" id="7564468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7564471">func</span>&nbsp;<span class="ident" id="7564476">TestAuthPlain</span><span class="op" id="7564489">(</span><span class="ident" id="7564490">t</span>&nbsp;<span class="op" id="7564492">*</span><span class="ident" id="7564493"><a href="/gostd/net/smtp/smtp_test.go.html#7563152">testing</a></span><span class="op" id="7564500">.</span><span class="ident" id="7564501"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7564502">)</span>&nbsp;<span class="op" id="7564504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7564507">auth</span>&nbsp;<span class="op" id="7564512">:=</span>&nbsp;<span class="ident" id="7564515"><a href="/gostd/net/smtp/auth.go.html#5788807">PlainAuth</a></span><span class="op" id="7564524">(</span><span class="string" id="7564525">&#34;foo&#34;</span><span class="op" id="7564530">,</span>&nbsp;<span class="string" id="7564532">&#34;bar&#34;</span><span class="op" id="7564537">,</span>&nbsp;<span class="string" id="7564539">&#34;baz&#34;</span><span class="op" id="7564544">,</span>&nbsp;<span class="string" id="7564546">&#34;servername&#34;</span><span class="op" id="7564558">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7564562">tests</span>&nbsp;<span class="op" id="7564568">:=</span>&nbsp;<span class="op" id="7564571">[</span><span class="op" id="7564572">]</span><span class="keyword" id="7564573">struct</span>&nbsp;<span class="op" id="7564580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7564584">server</span>&nbsp;<span class="op" id="7564591">*</span><span class="ident" id="7564592"><a href="/gostd/net/smtp/auth.go.html#5788236">ServerInfo</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7564605">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7564612">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7564620">}</span><span class="op" id="7564621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7564625">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7564630"><a href="/gostd/net/smtp/smtp_test.go.html#7564584">server</a></span><span class="op" id="7564636">:</span>&nbsp;<span class="op" id="7564638">&amp;</span><span class="ident" id="7564639"><a href="/gostd/net/smtp/auth.go.html#5788236">ServerInfo</a></span><span class="op" id="7564649">{</span><span class="ident" id="7564650"><a href="/gostd/net/smtp/auth.go.html#5788257">Name</a></span><span class="op" id="7564654">:</span>&nbsp;<span class="string" id="7564656">&#34;servername&#34;</span><span class="op" id="7564668">,</span>&nbsp;<span class="ident" id="7564670"><a href="/gostd/net/smtp/auth.go.html#5788292">TLS</a></span><span class="op" id="7564673">:</span>&nbsp;<span class="builtintype" id="7564675">true</span><span class="op" id="7564679">}</span><span class="op" id="7564680">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7564684">}</span><span class="op" id="7564685">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7564689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7564694">//&nbsp;Okay;&nbsp;explicitly&nbsp;advertised&nbsp;by&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7564739"><a href="/gostd/net/smtp/smtp_test.go.html#7564584">server</a></span><span class="op" id="7564745">:</span>&nbsp;<span class="op" id="7564747">&amp;</span><span class="ident" id="7564748"><a href="/gostd/net/smtp/auth.go.html#5788236">ServerInfo</a></span><span class="op" id="7564758">{</span><span class="ident" id="7564759"><a href="/gostd/net/smtp/auth.go.html#5788257">Name</a></span><span class="op" id="7564763">:</span>&nbsp;<span class="string" id="7564765">&#34;servername&#34;</span><span class="op" id="7564777">,</span>&nbsp;<span class="ident" id="7564779"><a href="/gostd/net/smtp/auth.go.html#5788353">Auth</a></span><span class="op" id="7564783">:</span>&nbsp;<span class="op" id="7564785">[</span><span class="op" id="7564786">]</span><span class="builtintype" id="7564787">string</span><span class="op" id="7564793">{</span><span class="string" id="7564794">&#34;PLAIN&#34;</span><span class="op" id="7564801">}</span><span class="op" id="7564802">}</span><span class="op" id="7564803">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7564807">}</span><span class="op" id="7564808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7564812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7564817"><a href="/gostd/net/smtp/smtp_test.go.html#7564584">server</a></span><span class="op" id="7564823">:</span>&nbsp;<span class="op" id="7564825">&amp;</span><span class="ident" id="7564826"><a href="/gostd/net/smtp/auth.go.html#5788236">ServerInfo</a></span><span class="op" id="7564836">{</span><span class="ident" id="7564837"><a href="/gostd/net/smtp/auth.go.html#5788257">Name</a></span><span class="op" id="7564841">:</span>&nbsp;<span class="string" id="7564843">&#34;servername&#34;</span><span class="op" id="7564855">,</span>&nbsp;<span class="ident" id="7564857"><a href="/gostd/net/smtp/auth.go.html#5788353">Auth</a></span><span class="op" id="7564861">:</span>&nbsp;<span class="op" id="7564863">[</span><span class="op" id="7564864">]</span><span class="builtintype" id="7564865">string</span><span class="op" id="7564871">{</span><span class="string" id="7564872">&#34;CRAM-MD5&#34;</span><span class="op" id="7564882">}</span><span class="op" id="7564883">}</span><span class="op" id="7564884">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7564889"><a href="/gostd/net/smtp/smtp_test.go.html#7564605">err</a></span><span class="op" id="7564892">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7564897">&#34;unencrypted&nbsp;connection&#34;</span><span class="op" id="7564921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7564925">}</span><span class="op" id="7564926">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7564930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7564935"><a href="/gostd/net/smtp/smtp_test.go.html#7564584">server</a></span><span class="op" id="7564941">:</span>&nbsp;<span class="op" id="7564943">&amp;</span><span class="ident" id="7564944"><a href="/gostd/net/smtp/auth.go.html#5788236">ServerInfo</a></span><span class="op" id="7564954">{</span><span class="ident" id="7564955"><a href="/gostd/net/smtp/auth.go.html#5788257">Name</a></span><span class="op" id="7564959">:</span>&nbsp;<span class="string" id="7564961">&#34;attacker&#34;</span><span class="op" id="7564971">,</span>&nbsp;<span class="ident" id="7564973"><a href="/gostd/net/smtp/auth.go.html#5788292">TLS</a></span><span class="op" id="7564976">:</span>&nbsp;<span class="builtintype" id="7564978">true</span><span class="op" id="7564982">}</span><span class="op" id="7564983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7564988"><a href="/gostd/net/smtp/smtp_test.go.html#7564605">err</a></span><span class="op" id="7564991">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7564996">&#34;wrong&nbsp;host&nbsp;name&#34;</span><span class="op" id="7565013">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7565017">}</span><span class="op" id="7565018">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7565021">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7565024">for</span>&nbsp;<span class="ident" id="7565028">i</span><span class="op" id="7565029">,</span>&nbsp;<span class="ident" id="7565031">tt</span>&nbsp;<span class="op" id="7565034">:=</span>&nbsp;<span class="keyword" id="7565037">range</span>&nbsp;<span class="ident" id="7565043"><a href="/gostd/net/smtp/smtp_test.go.html#7564562">tests</a></span>&nbsp;<span class="op" id="7565049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7565053">_</span><span class="op" id="7565054">,</span>&nbsp;<span class="ident" id="7565056">_</span><span class="op" id="7565057">,</span>&nbsp;<span class="ident" id="7565059">err</span>&nbsp;<span class="op" id="7565063">:=</span>&nbsp;<span class="ident" id="7565066"><a href="/gostd/net/smtp/smtp_test.go.html#7564507">auth</a></span><span class="op" id="7565070">.</span><span class="ident" id="7565071"><a href="/gostd/net/smtp/auth.go.html#5787690">Start</a></span><span class="op" id="7565076">(</span><span class="ident" id="7565077"><a href="/gostd/net/smtp/smtp_test.go.html#7565031">tt</a></span><span class="op" id="7565079">.</span><span class="ident" id="7565080"><a href="/gostd/net/smtp/smtp_test.go.html#7564584">server</a></span><span class="op" id="7565086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7565090">got</span>&nbsp;<span class="op" id="7565094">:=</span>&nbsp;<span class="string" id="7565097">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7565102">if</span>&nbsp;<span class="ident" id="7565105"><a href="/gostd/net/smtp/smtp_test.go.html#7565059">err</a></span>&nbsp;<span class="op" id="7565109">!=</span>&nbsp;<span class="builtintype" id="7565112">nil</span>&nbsp;<span class="op" id="7565116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7565121"><a href="/gostd/net/smtp/smtp_test.go.html#7565090">got</a></span>&nbsp;<span class="op" id="7565125">=</span>&nbsp;<span class="ident" id="7565127"><a href="/gostd/net/smtp/smtp_test.go.html#7565059">err</a></span><span class="op" id="7565130">.</span><span class="ident" id="7565131">Error</span><span class="op" id="7565136">(</span><span class="op" id="7565137">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7565141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7565145">if</span>&nbsp;<span class="ident" id="7565148"><a href="/gostd/net/smtp/smtp_test.go.html#7565090">got</a></span>&nbsp;<span class="op" id="7565152">!=</span>&nbsp;<span class="ident" id="7565155"><a href="/gostd/net/smtp/smtp_test.go.html#7565031">tt</a></span><span class="op" id="7565157">.</span><span class="ident" id="7565158"><a href="/gostd/net/smtp/smtp_test.go.html#7564605">err</a></span>&nbsp;<span class="op" id="7565162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7565167"><a href="/gostd/net/smtp/smtp_test.go.html#7564490">t</a></span><span class="op" id="7565168">.</span><span class="ident" id="7565169"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7565175">(</span><span class="string" id="7565176">&#34;%d.&nbsp;got&nbsp;error&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7565205">,</span>&nbsp;<span class="ident" id="7565207"><a href="/gostd/net/smtp/smtp_test.go.html#7565028">i</a></span><span class="op" id="7565208">,</span>&nbsp;<span class="ident" id="7565210"><a href="/gostd/net/smtp/smtp_test.go.html#7565090">got</a></span><span class="op" id="7565213">,</span>&nbsp;<span class="ident" id="7565215"><a href="/gostd/net/smtp/smtp_test.go.html#7565031">tt</a></span><span class="op" id="7565217">.</span><span class="ident" id="7565218"><a href="/gostd/net/smtp/smtp_test.go.html#7564605">err</a></span><span class="op" id="7565221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7565225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7565228">}</span><br>
<span class="lineno">95</span><span class="op" id="7565230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7565233">type</span>&nbsp;<span class="ident" id="7565238">faker</span>&nbsp;<span class="keyword" id="7565244">struct</span>&nbsp;<span class="op" id="7565251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7565254"><a href="/gostd/net/smtp/smtp_test.go.html#7563111">io</a></span><span class="op" id="7565256">.</span><span class="ident" id="7565257"><a href="/gostd/io/io.go.html#1423290">ReadWriter</a></span><br>
<span class="lineno"></span><span class="op" id="7565268">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="7565271">func</span>&nbsp;<span class="op" id="7565276">(</span><span class="ident" id="7565277">f</span>&nbsp;<span class="ident" id="7565279"><a href="/gostd/net/smtp/smtp_test.go.html#7565238">faker</a></span><span class="op" id="7565284">)</span>&nbsp;<span class="ident" id="7565286">Close</span><span class="op" id="7565291">(</span><span class="op" id="7565292">)</span>&nbsp;<span class="builtintype" id="7565294">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7565320">{</span>&nbsp;<span class="keyword" id="7565322">return</span>&nbsp;<span class="builtintype" id="7565329">nil</span>&nbsp;<span class="op" id="7565333">}</span><br>
<span class="lineno"></span><span class="keyword" id="7565335">func</span>&nbsp;<span class="op" id="7565340">(</span><span class="ident" id="7565341">f</span>&nbsp;<span class="ident" id="7565343"><a href="/gostd/net/smtp/smtp_test.go.html#7565238">faker</a></span><span class="op" id="7565348">)</span>&nbsp;<span class="ident" id="7565350">LocalAddr</span><span class="op" id="7565359">(</span><span class="op" id="7565360">)</span>&nbsp;<span class="ident" id="7565362"><a href="/gostd/net/smtp/smtp_test.go.html#7563117">net</a></span><span class="op" id="7565365">.</span><span class="ident" id="7565366"><a href="/gostd/net/net.go.html#3334179">Addr</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7565384">{</span>&nbsp;<span class="keyword" id="7565386">return</span>&nbsp;<span class="builtintype" id="7565393">nil</span>&nbsp;<span class="op" id="7565397">}</span><br>
<span class="lineno"></span><span class="keyword" id="7565399">func</span>&nbsp;<span class="op" id="7565404">(</span><span class="ident" id="7565405">f</span>&nbsp;<span class="ident" id="7565407"><a href="/gostd/net/smtp/smtp_test.go.html#7565238">faker</a></span><span class="op" id="7565412">)</span>&nbsp;<span class="ident" id="7565414">RemoteAddr</span><span class="op" id="7565424">(</span><span class="op" id="7565425">)</span>&nbsp;<span class="ident" id="7565427"><a href="/gostd/net/smtp/smtp_test.go.html#7563117">net</a></span><span class="op" id="7565430">.</span><span class="ident" id="7565431"><a href="/gostd/net/net.go.html#3334179">Addr</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7565448">{</span>&nbsp;<span class="keyword" id="7565450">return</span>&nbsp;<span class="builtintype" id="7565457">nil</span>&nbsp;<span class="op" id="7565461">}</span><br>
<span class="lineno"></span><span class="keyword" id="7565463">func</span>&nbsp;<span class="op" id="7565468">(</span><span class="ident" id="7565469">f</span>&nbsp;<span class="ident" id="7565471"><a href="/gostd/net/smtp/smtp_test.go.html#7565238">faker</a></span><span class="op" id="7565476">)</span>&nbsp;<span class="ident" id="7565478">SetDeadline</span><span class="op" id="7565489">(</span><span class="ident" id="7565490"><a href="/gostd/net/smtp/smtp_test.go.html#7563163">time</a></span><span class="op" id="7565494">.</span><span class="ident" id="7565495"><a href="/gostd/time/time.go.html#2722087">Time</a></span><span class="op" id="7565499">)</span>&nbsp;<span class="builtintype" id="7565501">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7565512">{</span>&nbsp;<span class="keyword" id="7565514">return</span>&nbsp;<span class="builtintype" id="7565521">nil</span>&nbsp;<span class="op" id="7565525">}</span><br>
<span class="lineno">105</span><span class="keyword" id="7565527">func</span>&nbsp;<span class="op" id="7565532">(</span><span class="ident" id="7565533">f</span>&nbsp;<span class="ident" id="7565535"><a href="/gostd/net/smtp/smtp_test.go.html#7565238">faker</a></span><span class="op" id="7565540">)</span>&nbsp;<span class="ident" id="7565542">SetReadDeadline</span><span class="op" id="7565557">(</span><span class="ident" id="7565558"><a href="/gostd/net/smtp/smtp_test.go.html#7563163">time</a></span><span class="op" id="7565562">.</span><span class="ident" id="7565563"><a href="/gostd/time/time.go.html#2722087">Time</a></span><span class="op" id="7565567">)</span>&nbsp;<span class="builtintype" id="7565569">error</span>&nbsp;&nbsp;<span class="op" id="7565576">{</span>&nbsp;<span class="keyword" id="7565578">return</span>&nbsp;<span class="builtintype" id="7565585">nil</span>&nbsp;<span class="op" id="7565589">}</span><br>
<span class="lineno"></span><span class="keyword" id="7565591">func</span>&nbsp;<span class="op" id="7565596">(</span><span class="ident" id="7565597">f</span>&nbsp;<span class="ident" id="7565599"><a href="/gostd/net/smtp/smtp_test.go.html#7565238">faker</a></span><span class="op" id="7565604">)</span>&nbsp;<span class="ident" id="7565606">SetWriteDeadline</span><span class="op" id="7565622">(</span><span class="ident" id="7565623"><a href="/gostd/net/smtp/smtp_test.go.html#7563163">time</a></span><span class="op" id="7565627">.</span><span class="ident" id="7565628"><a href="/gostd/time/time.go.html#2722087">Time</a></span><span class="op" id="7565632">)</span>&nbsp;<span class="builtintype" id="7565634">error</span>&nbsp;<span class="op" id="7565640">{</span>&nbsp;<span class="keyword" id="7565642">return</span>&nbsp;<span class="builtintype" id="7565649">nil</span>&nbsp;<span class="op" id="7565653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7565656">func</span>&nbsp;<span class="ident" id="7565661">TestBasic</span><span class="op" id="7565670">(</span><span class="ident" id="7565671">t</span>&nbsp;<span class="op" id="7565673">*</span><span class="ident" id="7565674"><a href="/gostd/net/smtp/smtp_test.go.html#7563152">testing</a></span><span class="op" id="7565681">.</span><span class="ident" id="7565682"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7565683">)</span>&nbsp;<span class="op" id="7565685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7565688">server</span>&nbsp;<span class="op" id="7565695">:=</span>&nbsp;<span class="ident" id="7565698"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7565705">.</span><span class="ident" id="7565706"><a href="/gostd/strings/strings.go.html#2974969">Join</a></span><span class="op" id="7565710">(</span><span class="ident" id="7565711"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7565718">.</span><span class="ident" id="7565719"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7565724">(</span><span class="ident" id="7565725"><a href="/gostd/net/smtp/smtp_test.go.html#7567819">basicServer</a></span><span class="op" id="7565736">,</span>&nbsp;<span class="string" id="7565738">&#34;\n&#34;</span><span class="op" id="7565742">)</span><span class="op" id="7565743">,</span>&nbsp;<span class="string" id="7565745">&#34;\r\n&#34;</span><span class="op" id="7565751">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7565754">client</span>&nbsp;<span class="op" id="7565761">:=</span>&nbsp;<span class="ident" id="7565764"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7565771">.</span><span class="ident" id="7565772"><a href="/gostd/strings/strings.go.html#2974969">Join</a></span><span class="op" id="7565776">(</span><span class="ident" id="7565777"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7565784">.</span><span class="ident" id="7565785"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7565790">(</span><span class="ident" id="7565791"><a href="/gostd/net/smtp/smtp_test.go.html#7568145">basicClient</a></span><span class="op" id="7565802">,</span>&nbsp;<span class="string" id="7565804">&#34;\n&#34;</span><span class="op" id="7565808">)</span><span class="op" id="7565809">,</span>&nbsp;<span class="string" id="7565811">&#34;\r\n&#34;</span><span class="op" id="7565817">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7565821">var</span>&nbsp;<span class="ident" id="7565825">cmdbuf</span>&nbsp;<span class="ident" id="7565832"><a href="/gostd/net/smtp/smtp_test.go.html#7563073">bytes</a></span><span class="op" id="7565837">.</span><span class="ident" id="7565838"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7565846">bcmdbuf</span>&nbsp;<span class="op" id="7565854">:=</span>&nbsp;<span class="ident" id="7565857"><a href="/gostd/net/smtp/smtp_test.go.html#7563064">bufio</a></span><span class="op" id="7565862">.</span><span class="ident" id="7565863"><a href="/gostd/bufio/bufio.go.html#1367149">NewWriter</a></span><span class="op" id="7565872">(</span><span class="op" id="7565873">&amp;</span><span class="ident" id="7565874"><a href="/gostd/net/smtp/smtp_test.go.html#7565825">cmdbuf</a></span><span class="op" id="7565880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7565883">var</span>&nbsp;<span class="ident" id="7565887">fake</span>&nbsp;<span class="ident" id="7565892"><a href="/gostd/net/smtp/smtp_test.go.html#7565238">faker</a></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7565899"><a href="/gostd/net/smtp/smtp_test.go.html#7565887">fake</a></span><span class="op" id="7565903">.</span><span class="ident" id="7565904"><a href="/gostd/net/smtp/smtp_test.go.html#7565254">ReadWriter</a></span>&nbsp;<span class="op" id="7565915">=</span>&nbsp;<span class="ident" id="7565917"><a href="/gostd/net/smtp/smtp_test.go.html#7563064">bufio</a></span><span class="op" id="7565922">.</span><span class="ident" id="7565923"><a href="/gostd/bufio/bufio.go.html#1371043">NewReadWriter</a></span><span class="op" id="7565936">(</span><span class="ident" id="7565937"><a href="/gostd/net/smtp/smtp_test.go.html#7563064">bufio</a></span><span class="op" id="7565942">.</span><span class="ident" id="7565943"><a href="/gostd/bufio/bufio.go.html#1355792">NewReader</a></span><span class="op" id="7565952">(</span><span class="ident" id="7565953"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7565960">.</span><span class="ident" id="7565961"><a href="/gostd/strings/reader.go.html#2948317">NewReader</a></span><span class="op" id="7565970">(</span><span class="ident" id="7565971"><a href="/gostd/net/smtp/smtp_test.go.html#7565688">server</a></span><span class="op" id="7565977">)</span><span class="op" id="7565978">)</span><span class="op" id="7565979">,</span>&nbsp;<span class="ident" id="7565981"><a href="/gostd/net/smtp/smtp_test.go.html#7565846">bcmdbuf</a></span><span class="op" id="7565988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7565991">c</span>&nbsp;<span class="op" id="7565993">:=</span>&nbsp;<span class="op" id="7565996">&amp;</span><span class="ident" id="7565997"><a href="/gostd/net/smtp/smtp.go.html#5790963">Client</a></span><span class="op" id="7566003">{</span><span class="ident" id="7566004"><a href="/gostd/net/smtp/smtp.go.html#5791090">Text</a></span><span class="op" id="7566008">:</span>&nbsp;<span class="ident" id="7566010"><a href="/gostd/net/smtp/smtp_test.go.html#7563124">textproto</a></span><span class="op" id="7566019">.</span><span class="ident" id="7566020"><a href="/gostd/net/textproto/textproto.go.html#4350610">NewConn</a></span><span class="op" id="7566027">(</span><span class="ident" id="7566028"><a href="/gostd/net/smtp/smtp_test.go.html#7565887">fake</a></span><span class="op" id="7566032">)</span><span class="op" id="7566033">,</span>&nbsp;<span class="ident" id="7566035"><a href="/gostd/net/smtp/smtp.go.html#5791399">localName</a></span><span class="op" id="7566044">:</span>&nbsp;<span class="string" id="7566046">&#34;localhost&#34;</span><span class="op" id="7566057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7566061">if</span>&nbsp;<span class="ident" id="7566064">err</span>&nbsp;<span class="op" id="7566068">:=</span>&nbsp;<span class="ident" id="7566071"><a href="/gostd/net/smtp/smtp_test.go.html#7565991">c</a></span><span class="op" id="7566072">.</span><span class="ident" id="7566073"><a href="/gostd/net/smtp/smtp.go.html#5793560">helo</a></span><span class="op" id="7566077">(</span><span class="op" id="7566078">)</span><span class="op" id="7566079">;</span>&nbsp;<span class="ident" id="7566081"><a href="/gostd/net/smtp/smtp_test.go.html#7566064">err</a></span>&nbsp;<span class="op" id="7566085">!=</span>&nbsp;<span class="builtintype" id="7566088">nil</span>&nbsp;<span class="op" id="7566092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7566096"><a href="/gostd/net/smtp/smtp_test.go.html#7565671">t</a></span><span class="op" id="7566097">.</span><span class="ident" id="7566098"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7566104">(</span><span class="string" id="7566105">&#34;HELO&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7566122">,</span>&nbsp;<span class="ident" id="7566124"><a href="/gostd/net/smtp/smtp_test.go.html#7566064">err</a></span><span class="op" id="7566127">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7566130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7566133">if</span>&nbsp;<span class="ident" id="7566136">err</span>&nbsp;<span class="op" id="7566140">:=</span>&nbsp;<span class="ident" id="7566143"><a href="/gostd/net/smtp/smtp_test.go.html#7565991">c</a></span><span class="op" id="7566144">.</span><span class="ident" id="7566145"><a href="/gostd/net/smtp/smtp.go.html#5793801">ehlo</a></span><span class="op" id="7566149">(</span><span class="op" id="7566150">)</span><span class="op" id="7566151">;</span>&nbsp;<span class="ident" id="7566153"><a href="/gostd/net/smtp/smtp_test.go.html#7566136">err</a></span>&nbsp;<span class="op" id="7566157">==</span>&nbsp;<span class="builtintype" id="7566160">nil</span>&nbsp;<span class="op" id="7566164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7566168"><a href="/gostd/net/smtp/smtp_test.go.html#7565671">t</a></span><span class="op" id="7566169">.</span><span class="ident" id="7566170"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7566176">(</span><span class="string" id="7566177">&#34;Expected&nbsp;first&nbsp;EHLO&nbsp;to&nbsp;fail&#34;</span><span class="op" id="7566206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7566209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7566212">if</span>&nbsp;<span class="ident" id="7566215">err</span>&nbsp;<span class="op" id="7566219">:=</span>&nbsp;<span class="ident" id="7566222"><a href="/gostd/net/smtp/smtp_test.go.html#7565991">c</a></span><span class="op" id="7566223">.</span><span class="ident" id="7566224"><a href="/gostd/net/smtp/smtp.go.html#5793801">ehlo</a></span><span class="op" id="7566228">(</span><span class="op" id="7566229">)</span><span class="op" id="7566230">;</span>&nbsp;<span class="ident" id="7566232"><a href="/gostd/net/smtp/smtp_test.go.html#7566215">err</a></span>&nbsp;<span class="op" id="7566236">!=</span>&nbsp;<span class="builtintype" id="7566239">nil</span>&nbsp;<span class="op" id="7566243">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7566247"><a href="/gostd/net/smtp/smtp_test.go.html#7565671">t</a></span><span class="op" id="7566248">.</span><span class="ident" id="7566249"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7566255">(</span><span class="string" id="7566256">&#34;Second&nbsp;EHLO&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7566280">,</span>&nbsp;<span class="ident" id="7566282"><a href="/gostd/net/smtp/smtp_test.go.html#7566215">err</a></span><span class="op" id="7566285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7566288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7566292"><a href="/gostd/net/smtp/smtp_test.go.html#7565991">c</a></span><span class="op" id="7566293">.</span><span class="ident" id="7566294"><a href="/gostd/net/smtp/smtp.go.html#5791450">didHello</a></span>&nbsp;<span class="op" id="7566303">=</span>&nbsp;<span class="builtintype" id="7566305">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7566311">if</span>&nbsp;<span class="ident" id="7566314">ok</span><span class="op" id="7566316">,</span>&nbsp;<span class="ident" id="7566318">args</span>&nbsp;<span class="op" id="7566323">:=</span>&nbsp;<span class="ident" id="7566326"><a href="/gostd/net/smtp/smtp_test.go.html#7565991">c</a></span><span class="op" id="7566327">.</span><span class="ident" id="7566328"><a href="/gostd/net/smtp/smtp.go.html#5799121">Extension</a></span><span class="op" id="7566337">(</span><span class="string" id="7566338">&#34;aUtH&#34;</span><span class="op" id="7566344">)</span><span class="op" id="7566345">;</span>&nbsp;<span class="op" id="7566347">!</span><span class="ident" id="7566348"><a href="/gostd/net/smtp/smtp_test.go.html#7566314">ok</a></span>&nbsp;<span class="op" id="7566351">||</span>&nbsp;<span class="ident" id="7566354"><a href="/gostd/net/smtp/smtp_test.go.html#7566318">args</a></span>&nbsp;<span class="op" id="7566359">!=</span>&nbsp;<span class="string" id="7566362">&#34;LOGIN&nbsp;PLAIN&#34;</span>&nbsp;<span class="op" id="7566376">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7566380"><a href="/gostd/net/smtp/smtp_test.go.html#7565671">t</a></span><span class="op" id="7566381">.</span><span class="ident" id="7566382"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7566388">(</span><span class="string" id="7566389">&#34;Expected&nbsp;AUTH&nbsp;supported&#34;</span><span class="op" id="7566414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7566417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7566420">if</span>&nbsp;<span class="ident" id="7566423">ok</span><span class="op" id="7566425">,</span>&nbsp;<span class="ident" id="7566427">_</span>&nbsp;<span class="op" id="7566429">:=</span>&nbsp;<span class="ident" id="7566432"><a href="/gostd/net/smtp/smtp_test.go.html#7565991">c</a></span><span class="op" id="7566433">.</span><span class="ident" id="7566434"><a href="/gostd/net/smtp/smtp.go.html#5799121">Extension</a></span><span class="op" id="7566443">(</span><span class="string" id="7566444">&#34;DSN&#34;</span><span class="op" id="7566449">)</span><span class="op" id="7566450">;</span>&nbsp;<span class="ident" id="7566452"><a href="/gostd/net/smtp/smtp_test.go.html#7566423">ok</a></span>&nbsp;<span class="op" id="7566455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7566459"><a href="/gostd/net/smtp/smtp_test.go.html#7565671">t</a></span><span class="op" id="7566460">.</span><span class="ident" id="7566461"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7566467">(</span><span class="string" id="7566468">&#34;Shouldn&#39;t&nbsp;support&nbsp;DSN&#34;</span><span class="op" id="7566491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7566494">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7566498">if</span>&nbsp;<span class="ident" id="7566501">err</span>&nbsp;<span class="op" id="7566505">:=</span>&nbsp;<span class="ident" id="7566508"><a href="/gostd/net/smtp/smtp_test.go.html#7565991">c</a></span><span class="op" id="7566509">.</span><span class="ident" id="7566510"><a href="/gostd/net/smtp/smtp.go.html#5796571">Mail</a></span><span class="op" id="7566514">(</span><span class="string" id="7566515">&#34;user@gmail.com&#34;</span><span class="op" id="7566531">)</span><span class="op" id="7566532">;</span>&nbsp;<span class="ident" id="7566534"><a href="/gostd/net/smtp/smtp_test.go.html#7566501">err</a></span>&nbsp;<span class="op" id="7566538">==</span>&nbsp;<span class="builtintype" id="7566541">nil</span>&nbsp;<span class="op" id="7566545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7566549"><a href="/gostd/net/smtp/smtp_test.go.html#7565671">t</a></span><span class="op" id="7566550">.</span><span class="ident" id="7566551"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7566557">(</span><span class="string" id="7566558">&#34;MAIL&nbsp;should&nbsp;require&nbsp;authentication&#34;</span><span class="op" id="7566594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7566597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7566601">if</span>&nbsp;<span class="ident" id="7566604">err</span>&nbsp;<span class="op" id="7566608">:=</span>&nbsp;<span class="ident" id="7566611"><a href="/gostd/net/smtp/smtp_test.go.html#7565991">c</a></span><span class="op" id="7566612">.</span><span class="ident" id="7566613"><a href="/gostd/net/smtp/smtp.go.html#5794989">Verify</a></span><span class="op" id="7566619">(</span><span class="string" id="7566620">&#34;user1@gmail.com&#34;</span><span class="op" id="7566637">)</span><span class="op" id="7566638">;</span>&nbsp;<span class="ident" id="7566640"><a href="/gostd/net/smtp/smtp_test.go.html#7566604">err</a></span>&nbsp;<span class="op" id="7566644">==</span>&nbsp;<span class="builtintype" id="7566647">nil</span>&nbsp;<span class="op" id="7566651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7566655"><a href="/gostd/net/smtp/smtp_test.go.html#7565671">t</a></span><span class="op" id="7566656">.</span><span class="ident" id="7566657"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7566663">(</span><span class="string" id="7566664">&#34;First&nbsp;VRFY:&nbsp;expected&nbsp;no&nbsp;verification&#34;</span><span class="op" id="7566702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7566705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7566708">if</span>&nbsp;<span class="ident" id="7566711">err</span>&nbsp;<span class="op" id="7566715">:=</span>&nbsp;<span class="ident" id="7566718"><a href="/gostd/net/smtp/smtp_test.go.html#7565991">c</a></span><span class="op" id="7566719">.</span><span class="ident" id="7566720"><a href="/gostd/net/smtp/smtp.go.html#5794989">Verify</a></span><span class="op" id="7566726">(</span><span class="string" id="7566727">&#34;user2@gmail.com&#34;</span><span class="op" id="7566744">)</span><span class="op" id="7566745">;</span>&nbsp;<span class="ident" id="7566747"><a href="/gostd/net/smtp/smtp_test.go.html#7566711">err</a></span>&nbsp;<span class="op" id="7566751">!=</span>&nbsp;<span class="builtintype" id="7566754">nil</span>&nbsp;<span class="op" id="7566758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7566762"><a href="/gostd/net/smtp/smtp_test.go.html#7565671">t</a></span><span class="op" id="7566763">.</span><span class="ident" id="7566764"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7566770">(</span><span class="string" id="7566771">&#34;Second&nbsp;VRFY:&nbsp;expected&nbsp;verification,&nbsp;got&nbsp;%s&#34;</span><span class="op" id="7566815">,</span>&nbsp;<span class="ident" id="7566817"><a href="/gostd/net/smtp/smtp_test.go.html#7566711">err</a></span><span class="op" id="7566820">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7566823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7566827">//&nbsp;fake&nbsp;TLS&nbsp;so&nbsp;authentication&nbsp;won&#39;t&nbsp;complain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7566873"><a href="/gostd/net/smtp/smtp_test.go.html#7565991">c</a></span><span class="op" id="7566874">.</span><span class="ident" id="7566875"><a href="/gostd/net/smtp/smtp.go.html#5791257">tls</a></span>&nbsp;<span class="op" id="7566879">=</span>&nbsp;<span class="builtintype" id="7566881">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7566887"><a href="/gostd/net/smtp/smtp_test.go.html#7565991">c</a></span><span class="op" id="7566888">.</span><span class="ident" id="7566889"><a href="/gostd/net/smtp/smtp.go.html#5791274">serverName</a></span>&nbsp;<span class="op" id="7566900">=</span>&nbsp;<span class="string" id="7566902">&#34;smtp.google.com&#34;</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7566921">if</span>&nbsp;<span class="ident" id="7566924">err</span>&nbsp;<span class="op" id="7566928">:=</span>&nbsp;<span class="ident" id="7566931"><a href="/gostd/net/smtp/smtp_test.go.html#7565991">c</a></span><span class="op" id="7566932">.</span><span class="ident" id="7566933"><a href="/gostd/net/smtp/smtp.go.html#5795341">Auth</a></span><span class="op" id="7566937">(</span><span class="ident" id="7566938"><a href="/gostd/net/smtp/auth.go.html#5788807">PlainAuth</a></span><span class="op" id="7566947">(</span><span class="string" id="7566948">&#34;&#34;</span><span class="op" id="7566950">,</span>&nbsp;<span class="string" id="7566952">&#34;user&#34;</span><span class="op" id="7566958">,</span>&nbsp;<span class="string" id="7566960">&#34;pass&#34;</span><span class="op" id="7566966">,</span>&nbsp;<span class="string" id="7566968">&#34;smtp.google.com&#34;</span><span class="op" id="7566985">)</span><span class="op" id="7566986">)</span><span class="op" id="7566987">;</span>&nbsp;<span class="ident" id="7566989"><a href="/gostd/net/smtp/smtp_test.go.html#7566924">err</a></span>&nbsp;<span class="op" id="7566993">!=</span>&nbsp;<span class="builtintype" id="7566996">nil</span>&nbsp;<span class="op" id="7567000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7567004"><a href="/gostd/net/smtp/smtp_test.go.html#7565671">t</a></span><span class="op" id="7567005">.</span><span class="ident" id="7567006"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7567012">(</span><span class="string" id="7567013">&#34;AUTH&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7567030">,</span>&nbsp;<span class="ident" id="7567032"><a href="/gostd/net/smtp/smtp_test.go.html#7566924">err</a></span><span class="op" id="7567035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7567038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7567042">if</span>&nbsp;<span class="ident" id="7567045">err</span>&nbsp;<span class="op" id="7567049">:=</span>&nbsp;<span class="ident" id="7567052"><a href="/gostd/net/smtp/smtp_test.go.html#7565991">c</a></span><span class="op" id="7567053">.</span><span class="ident" id="7567054"><a href="/gostd/net/smtp/smtp.go.html#5796571">Mail</a></span><span class="op" id="7567058">(</span><span class="string" id="7567059">&#34;user@gmail.com&#34;</span><span class="op" id="7567075">)</span><span class="op" id="7567076">;</span>&nbsp;<span class="ident" id="7567078"><a href="/gostd/net/smtp/smtp_test.go.html#7567045">err</a></span>&nbsp;<span class="op" id="7567082">!=</span>&nbsp;<span class="builtintype" id="7567085">nil</span>&nbsp;<span class="op" id="7567089">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7567093"><a href="/gostd/net/smtp/smtp_test.go.html#7565671">t</a></span><span class="op" id="7567094">.</span><span class="ident" id="7567095"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7567101">(</span><span class="string" id="7567102">&#34;MAIL&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7567119">,</span>&nbsp;<span class="ident" id="7567121"><a href="/gostd/net/smtp/smtp_test.go.html#7567045">err</a></span><span class="op" id="7567124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7567127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7567130">if</span>&nbsp;<span class="ident" id="7567133">err</span>&nbsp;<span class="op" id="7567137">:=</span>&nbsp;<span class="ident" id="7567140"><a href="/gostd/net/smtp/smtp_test.go.html#7565991">c</a></span><span class="op" id="7567141">.</span><span class="ident" id="7567142"><a href="/gostd/net/smtp/smtp.go.html#5797032">Rcpt</a></span><span class="op" id="7567146">(</span><span class="string" id="7567147">&#34;golang-nuts@googlegroups.com&#34;</span><span class="op" id="7567177">)</span><span class="op" id="7567178">;</span>&nbsp;<span class="ident" id="7567180"><a href="/gostd/net/smtp/smtp_test.go.html#7567133">err</a></span>&nbsp;<span class="op" id="7567184">!=</span>&nbsp;<span class="builtintype" id="7567187">nil</span>&nbsp;<span class="op" id="7567191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7567195"><a href="/gostd/net/smtp/smtp_test.go.html#7565671">t</a></span><span class="op" id="7567196">.</span><span class="ident" id="7567197"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7567203">(</span><span class="string" id="7567204">&#34;RCPT&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7567221">,</span>&nbsp;<span class="ident" id="7567223"><a href="/gostd/net/smtp/smtp_test.go.html#7567133">err</a></span><span class="op" id="7567226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7567229">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7567232">msg</span>&nbsp;<span class="op" id="7567236">:=</span>&nbsp;<span class="string" id="7567239">`From:&nbsp;user@gmail.com<br>
<span class="lineno"></span>To:&nbsp;golang-nuts@googlegroups.com<br>
<span class="lineno"></span>Subject:&nbsp;Hooray&nbsp;for&nbsp;Go<br>
<span class="lineno"></span><br>
<span class="lineno"></span>Line&nbsp;1<br>
<span class="lineno">165</span>.Leading&nbsp;dot&nbsp;line&nbsp;.<br>
<span class="lineno"></span>Goodbye.`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7567356">w</span><span class="op" id="7567357">,</span>&nbsp;<span class="ident" id="7567359">err</span>&nbsp;<span class="op" id="7567363">:=</span>&nbsp;<span class="ident" id="7567366"><a href="/gostd/net/smtp/smtp_test.go.html#7565991">c</a></span><span class="op" id="7567367">.</span><span class="ident" id="7567368"><a href="/gostd/net/smtp/smtp.go.html#5797548">Data</a></span><span class="op" id="7567372">(</span><span class="op" id="7567373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7567376">if</span>&nbsp;<span class="ident" id="7567379"><a href="/gostd/net/smtp/smtp_test.go.html#7567359">err</a></span>&nbsp;<span class="op" id="7567383">!=</span>&nbsp;<span class="builtintype" id="7567386">nil</span>&nbsp;<span class="op" id="7567390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7567394"><a href="/gostd/net/smtp/smtp_test.go.html#7565671">t</a></span><span class="op" id="7567395">.</span><span class="ident" id="7567396"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7567402">(</span><span class="string" id="7567403">&#34;DATA&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7567420">,</span>&nbsp;<span class="ident" id="7567422"><a href="/gostd/net/smtp/smtp_test.go.html#7567359">err</a></span><span class="op" id="7567425">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7567428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7567431">if</span>&nbsp;<span class="ident" id="7567434">_</span><span class="op" id="7567435">,</span>&nbsp;<span class="ident" id="7567437">err</span>&nbsp;<span class="op" id="7567441">:=</span>&nbsp;<span class="ident" id="7567444"><a href="/gostd/net/smtp/smtp_test.go.html#7567356">w</a></span><span class="op" id="7567445">.</span><span class="ident" id="7567446"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="7567451">(</span><span class="op" id="7567452">[</span><span class="op" id="7567453">]</span><span class="builtintype" id="7567454">byte</span><span class="op" id="7567458">(</span><span class="ident" id="7567459"><a href="/gostd/net/smtp/smtp_test.go.html#7567232">msg</a></span><span class="op" id="7567462">)</span><span class="op" id="7567463">)</span><span class="op" id="7567464">;</span>&nbsp;<span class="ident" id="7567466"><a href="/gostd/net/smtp/smtp_test.go.html#7567437">err</a></span>&nbsp;<span class="op" id="7567470">!=</span>&nbsp;<span class="builtintype" id="7567473">nil</span>&nbsp;<span class="op" id="7567477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7567481"><a href="/gostd/net/smtp/smtp_test.go.html#7565671">t</a></span><span class="op" id="7567482">.</span><span class="ident" id="7567483"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7567489">(</span><span class="string" id="7567490">&#34;Data&nbsp;write&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7567513">,</span>&nbsp;<span class="ident" id="7567515"><a href="/gostd/net/smtp/smtp_test.go.html#7567437">err</a></span><span class="op" id="7567518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7567521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7567524">if</span>&nbsp;<span class="ident" id="7567527">err</span>&nbsp;<span class="op" id="7567531">:=</span>&nbsp;<span class="ident" id="7567534"><a href="/gostd/net/smtp/smtp_test.go.html#7567356">w</a></span><span class="op" id="7567535">.</span><span class="ident" id="7567536"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="7567541">(</span><span class="op" id="7567542">)</span><span class="op" id="7567543">;</span>&nbsp;<span class="ident" id="7567545"><a href="/gostd/net/smtp/smtp_test.go.html#7567527">err</a></span>&nbsp;<span class="op" id="7567549">!=</span>&nbsp;<span class="builtintype" id="7567552">nil</span>&nbsp;<span class="op" id="7567556">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7567560"><a href="/gostd/net/smtp/smtp_test.go.html#7565671">t</a></span><span class="op" id="7567561">.</span><span class="ident" id="7567562"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7567568">(</span><span class="string" id="7567569">&#34;Bad&nbsp;data&nbsp;response:&nbsp;%s&#34;</span><span class="op" id="7567592">,</span>&nbsp;<span class="ident" id="7567594"><a href="/gostd/net/smtp/smtp_test.go.html#7567527">err</a></span><span class="op" id="7567597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7567600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7567604">if</span>&nbsp;<span class="ident" id="7567607">err</span>&nbsp;<span class="op" id="7567611">:=</span>&nbsp;<span class="ident" id="7567614"><a href="/gostd/net/smtp/smtp_test.go.html#7565991">c</a></span><span class="op" id="7567615">.</span><span class="ident" id="7567616"><a href="/gostd/net/smtp/smtp.go.html#5799642">Quit</a></span><span class="op" id="7567620">(</span><span class="op" id="7567621">)</span><span class="op" id="7567622">;</span>&nbsp;<span class="ident" id="7567624"><a href="/gostd/net/smtp/smtp_test.go.html#7567607">err</a></span>&nbsp;<span class="op" id="7567628">!=</span>&nbsp;<span class="builtintype" id="7567631">nil</span>&nbsp;<span class="op" id="7567635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7567639"><a href="/gostd/net/smtp/smtp_test.go.html#7565671">t</a></span><span class="op" id="7567640">.</span><span class="ident" id="7567641"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7567647">(</span><span class="string" id="7567648">&#34;QUIT&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7567665">,</span>&nbsp;<span class="ident" id="7567667"><a href="/gostd/net/smtp/smtp_test.go.html#7567607">err</a></span><span class="op" id="7567670">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7567673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7567677"><a href="/gostd/net/smtp/smtp_test.go.html#7565846">bcmdbuf</a></span><span class="op" id="7567684">.</span><span class="ident" id="7567685"><a href="/gostd/bufio/bufio.go.html#1367486">Flush</a></span><span class="op" id="7567690">(</span><span class="op" id="7567691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7567694">actualcmds</span>&nbsp;<span class="op" id="7567705">:=</span>&nbsp;<span class="ident" id="7567708"><a href="/gostd/net/smtp/smtp_test.go.html#7565825">cmdbuf</a></span><span class="op" id="7567714">.</span><span class="ident" id="7567715"><a href="/gostd/bytes/buffer.go.html#1384648">String</a></span><span class="op" id="7567721">(</span><span class="op" id="7567722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7567725">if</span>&nbsp;<span class="ident" id="7567728"><a href="/gostd/net/smtp/smtp_test.go.html#7565754">client</a></span>&nbsp;<span class="op" id="7567735">!=</span>&nbsp;<span class="ident" id="7567738"><a href="/gostd/net/smtp/smtp_test.go.html#7567694">actualcmds</a></span>&nbsp;<span class="op" id="7567749">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7567753"><a href="/gostd/net/smtp/smtp_test.go.html#7565671">t</a></span><span class="op" id="7567754">.</span><span class="ident" id="7567755"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7567761">(</span><span class="string" id="7567762">&#34;Got:\n%s\nExpected:\n%s&#34;</span><span class="op" id="7567787">,</span>&nbsp;<span class="ident" id="7567789"><a href="/gostd/net/smtp/smtp_test.go.html#7567694">actualcmds</a></span><span class="op" id="7567799">,</span>&nbsp;<span class="ident" id="7567801"><a href="/gostd/net/smtp/smtp_test.go.html#7565754">client</a></span><span class="op" id="7567807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7567810">}</span><br>
<span class="lineno"></span><span class="op" id="7567812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7567815">var</span>&nbsp;<span class="ident" id="7567819">basicServer</span>&nbsp;<span class="op" id="7567831">=</span>&nbsp;<span class="string" id="7567833">`250&nbsp;mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno">190</span>502&nbsp;Unrecognized&nbsp;command.<br>
<span class="lineno"></span>250-mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno"></span>250-SIZE&nbsp;35651584<br>
<span class="lineno"></span>250-AUTH&nbsp;LOGIN&nbsp;PLAIN<br>
<span class="lineno"></span>250&nbsp;8BITMIME<br>
<span class="lineno">195</span>530&nbsp;Authentication&nbsp;required<br>
<span class="lineno"></span>252&nbsp;Send&nbsp;some&nbsp;mail,&nbsp;I&#39;ll&nbsp;try&nbsp;my&nbsp;best<br>
<span class="lineno"></span>250&nbsp;User&nbsp;is&nbsp;valid<br>
<span class="lineno"></span>235&nbsp;Accepted<br>
<span class="lineno"></span>250&nbsp;Sender&nbsp;OK<br>
<span class="lineno">200</span>250&nbsp;Receiver&nbsp;OK<br>
<span class="lineno"></span>354&nbsp;Go&nbsp;ahead<br>
<span class="lineno"></span>250&nbsp;Data&nbsp;OK<br>
<span class="lineno"></span>221&nbsp;OK<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="keyword" id="7568141">var</span>&nbsp;<span class="ident" id="7568145">basicClient</span>&nbsp;<span class="op" id="7568157">=</span>&nbsp;<span class="string" id="7568159">`HELO&nbsp;localhost<br>
<span class="lineno"></span>EHLO&nbsp;localhost<br>
<span class="lineno"></span>EHLO&nbsp;localhost<br>
<span class="lineno"></span>MAIL&nbsp;FROM:&lt;user@gmail.com&gt;&nbsp;BODY=8BITMIME<br>
<span class="lineno">210</span>VRFY&nbsp;user1@gmail.com<br>
<span class="lineno"></span>VRFY&nbsp;user2@gmail.com<br>
<span class="lineno"></span>AUTH&nbsp;PLAIN&nbsp;AHVzZXIAcGFzcw==<br>
<span class="lineno"></span>MAIL&nbsp;FROM:&lt;user@gmail.com&gt;&nbsp;BODY=8BITMIME<br>
<span class="lineno"></span>RCPT&nbsp;TO:&lt;golang-nuts@googlegroups.com&gt;<br>
<span class="lineno">215</span>DATA<br>
<span class="lineno"></span>From:&nbsp;user@gmail.com<br>
<span class="lineno"></span>To:&nbsp;golang-nuts@googlegroups.com<br>
<span class="lineno"></span>Subject:&nbsp;Hooray&nbsp;for&nbsp;Go<br>
<span class="lineno"></span><br>
<span class="lineno">220</span>Line&nbsp;1<br>
<span class="lineno"></span>..Leading&nbsp;dot&nbsp;line&nbsp;.<br>
<span class="lineno"></span>Goodbye.<br>
<span class="lineno"></span>.<br>
<span class="lineno"></span>QUIT<br>
<span class="lineno">225</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7568526">func</span>&nbsp;<span class="ident" id="7568531">TestNewClient</span><span class="op" id="7568544">(</span><span class="ident" id="7568545">t</span>&nbsp;<span class="op" id="7568547">*</span><span class="ident" id="7568548"><a href="/gostd/net/smtp/smtp_test.go.html#7563152">testing</a></span><span class="op" id="7568555">.</span><span class="ident" id="7568556"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7568557">)</span>&nbsp;<span class="op" id="7568559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7568562">server</span>&nbsp;<span class="op" id="7568569">:=</span>&nbsp;<span class="ident" id="7568572"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7568579">.</span><span class="ident" id="7568580"><a href="/gostd/strings/strings.go.html#2974969">Join</a></span><span class="op" id="7568584">(</span><span class="ident" id="7568585"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7568592">.</span><span class="ident" id="7568593"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7568598">(</span><span class="ident" id="7568599"><a href="/gostd/net/smtp/smtp_test.go.html#7569446">newClientServer</a></span><span class="op" id="7568614">,</span>&nbsp;<span class="string" id="7568616">&#34;\n&#34;</span><span class="op" id="7568620">)</span><span class="op" id="7568621">,</span>&nbsp;<span class="string" id="7568623">&#34;\r\n&#34;</span><span class="op" id="7568629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7568632">client</span>&nbsp;<span class="op" id="7568639">:=</span>&nbsp;<span class="ident" id="7568642"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7568649">.</span><span class="ident" id="7568650"><a href="/gostd/strings/strings.go.html#2974969">Join</a></span><span class="op" id="7568654">(</span><span class="ident" id="7568655"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7568662">.</span><span class="ident" id="7568663"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7568668">(</span><span class="ident" id="7568669"><a href="/gostd/net/smtp/smtp_test.go.html#7569581">newClientClient</a></span><span class="op" id="7568684">,</span>&nbsp;<span class="string" id="7568686">&#34;\n&#34;</span><span class="op" id="7568690">)</span><span class="op" id="7568691">,</span>&nbsp;<span class="string" id="7568693">&#34;\r\n&#34;</span><span class="op" id="7568699">)</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7568703">var</span>&nbsp;<span class="ident" id="7568707">cmdbuf</span>&nbsp;<span class="ident" id="7568714"><a href="/gostd/net/smtp/smtp_test.go.html#7563073">bytes</a></span><span class="op" id="7568719">.</span><span class="ident" id="7568720"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7568728">bcmdbuf</span>&nbsp;<span class="op" id="7568736">:=</span>&nbsp;<span class="ident" id="7568739"><a href="/gostd/net/smtp/smtp_test.go.html#7563064">bufio</a></span><span class="op" id="7568744">.</span><span class="ident" id="7568745"><a href="/gostd/bufio/bufio.go.html#1367149">NewWriter</a></span><span class="op" id="7568754">(</span><span class="op" id="7568755">&amp;</span><span class="ident" id="7568756"><a href="/gostd/net/smtp/smtp_test.go.html#7568707">cmdbuf</a></span><span class="op" id="7568762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7568765">out</span>&nbsp;<span class="op" id="7568769">:=</span>&nbsp;<span class="keyword" id="7568772">func</span><span class="op" id="7568776">(</span><span class="op" id="7568777">)</span>&nbsp;<span class="builtintype" id="7568779">string</span>&nbsp;<span class="op" id="7568786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7568790"><a href="/gostd/net/smtp/smtp_test.go.html#7568728">bcmdbuf</a></span><span class="op" id="7568797">.</span><span class="ident" id="7568798"><a href="/gostd/bufio/bufio.go.html#1367486">Flush</a></span><span class="op" id="7568803">(</span><span class="op" id="7568804">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7568808">return</span>&nbsp;<span class="ident" id="7568815"><a href="/gostd/net/smtp/smtp_test.go.html#7568707">cmdbuf</a></span><span class="op" id="7568821">.</span><span class="ident" id="7568822"><a href="/gostd/bytes/buffer.go.html#1384648">String</a></span><span class="op" id="7568828">(</span><span class="op" id="7568829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7568832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7568835">var</span>&nbsp;<span class="ident" id="7568839">fake</span>&nbsp;<span class="ident" id="7568844"><a href="/gostd/net/smtp/smtp_test.go.html#7565238">faker</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7568851"><a href="/gostd/net/smtp/smtp_test.go.html#7568839">fake</a></span><span class="op" id="7568855">.</span><span class="ident" id="7568856"><a href="/gostd/net/smtp/smtp_test.go.html#7565254">ReadWriter</a></span>&nbsp;<span class="op" id="7568867">=</span>&nbsp;<span class="ident" id="7568869"><a href="/gostd/net/smtp/smtp_test.go.html#7563064">bufio</a></span><span class="op" id="7568874">.</span><span class="ident" id="7568875"><a href="/gostd/bufio/bufio.go.html#1371043">NewReadWriter</a></span><span class="op" id="7568888">(</span><span class="ident" id="7568889"><a href="/gostd/net/smtp/smtp_test.go.html#7563064">bufio</a></span><span class="op" id="7568894">.</span><span class="ident" id="7568895"><a href="/gostd/bufio/bufio.go.html#1355792">NewReader</a></span><span class="op" id="7568904">(</span><span class="ident" id="7568905"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7568912">.</span><span class="ident" id="7568913"><a href="/gostd/strings/reader.go.html#2948317">NewReader</a></span><span class="op" id="7568922">(</span><span class="ident" id="7568923"><a href="/gostd/net/smtp/smtp_test.go.html#7568562">server</a></span><span class="op" id="7568929">)</span><span class="op" id="7568930">)</span><span class="op" id="7568931">,</span>&nbsp;<span class="ident" id="7568933"><a href="/gostd/net/smtp/smtp_test.go.html#7568728">bcmdbuf</a></span><span class="op" id="7568940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7568943">c</span><span class="op" id="7568944">,</span>&nbsp;<span class="ident" id="7568946">err</span>&nbsp;<span class="op" id="7568950">:=</span>&nbsp;<span class="ident" id="7568953"><a href="/gostd/net/smtp/smtp.go.html#5791973">NewClient</a></span><span class="op" id="7568962">(</span><span class="ident" id="7568963"><a href="/gostd/net/smtp/smtp_test.go.html#7568839">fake</a></span><span class="op" id="7568967">,</span>&nbsp;<span class="string" id="7568969">&#34;fake.host&#34;</span><span class="op" id="7568980">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7568983">if</span>&nbsp;<span class="ident" id="7568986"><a href="/gostd/net/smtp/smtp_test.go.html#7568946">err</a></span>&nbsp;<span class="op" id="7568990">!=</span>&nbsp;<span class="builtintype" id="7568993">nil</span>&nbsp;<span class="op" id="7568997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7569001"><a href="/gostd/net/smtp/smtp_test.go.html#7568545">t</a></span><span class="op" id="7569002">.</span><span class="ident" id="7569003"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7569009">(</span><span class="string" id="7569010">&#34;NewClient:&nbsp;%v\n(after&nbsp;%v)&#34;</span><span class="op" id="7569037">,</span>&nbsp;<span class="ident" id="7569039"><a href="/gostd/net/smtp/smtp_test.go.html#7568946">err</a></span><span class="op" id="7569042">,</span>&nbsp;<span class="ident" id="7569044"><a href="/gostd/net/smtp/smtp_test.go.html#7568765">out</a></span><span class="op" id="7569047">(</span><span class="op" id="7569048">)</span><span class="op" id="7569049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7569052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7569055">defer</span>&nbsp;<span class="ident" id="7569061"><a href="/gostd/net/smtp/smtp_test.go.html#7568943">c</a></span><span class="op" id="7569062">.</span><span class="ident" id="7569063"><a href="/gostd/net/smtp/smtp.go.html#5792300">Close</a></span><span class="op" id="7569068">(</span><span class="op" id="7569069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7569072">if</span>&nbsp;<span class="ident" id="7569075">ok</span><span class="op" id="7569077">,</span>&nbsp;<span class="ident" id="7569079">args</span>&nbsp;<span class="op" id="7569084">:=</span>&nbsp;<span class="ident" id="7569087"><a href="/gostd/net/smtp/smtp_test.go.html#7568943">c</a></span><span class="op" id="7569088">.</span><span class="ident" id="7569089"><a href="/gostd/net/smtp/smtp.go.html#5799121">Extension</a></span><span class="op" id="7569098">(</span><span class="string" id="7569099">&#34;aUtH&#34;</span><span class="op" id="7569105">)</span><span class="op" id="7569106">;</span>&nbsp;<span class="op" id="7569108">!</span><span class="ident" id="7569109"><a href="/gostd/net/smtp/smtp_test.go.html#7569075">ok</a></span>&nbsp;<span class="op" id="7569112">||</span>&nbsp;<span class="ident" id="7569115"><a href="/gostd/net/smtp/smtp_test.go.html#7569079">args</a></span>&nbsp;<span class="op" id="7569120">!=</span>&nbsp;<span class="string" id="7569123">&#34;LOGIN&nbsp;PLAIN&#34;</span>&nbsp;<span class="op" id="7569137">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7569141"><a href="/gostd/net/smtp/smtp_test.go.html#7568545">t</a></span><span class="op" id="7569142">.</span><span class="ident" id="7569143"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7569149">(</span><span class="string" id="7569150">&#34;Expected&nbsp;AUTH&nbsp;supported&#34;</span><span class="op" id="7569175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7569178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7569181">if</span>&nbsp;<span class="ident" id="7569184">ok</span><span class="op" id="7569186">,</span>&nbsp;<span class="ident" id="7569188">_</span>&nbsp;<span class="op" id="7569190">:=</span>&nbsp;<span class="ident" id="7569193"><a href="/gostd/net/smtp/smtp_test.go.html#7568943">c</a></span><span class="op" id="7569194">.</span><span class="ident" id="7569195"><a href="/gostd/net/smtp/smtp.go.html#5799121">Extension</a></span><span class="op" id="7569204">(</span><span class="string" id="7569205">&#34;DSN&#34;</span><span class="op" id="7569210">)</span><span class="op" id="7569211">;</span>&nbsp;<span class="ident" id="7569213"><a href="/gostd/net/smtp/smtp_test.go.html#7569184">ok</a></span>&nbsp;<span class="op" id="7569216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7569220"><a href="/gostd/net/smtp/smtp_test.go.html#7568545">t</a></span><span class="op" id="7569221">.</span><span class="ident" id="7569222"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7569228">(</span><span class="string" id="7569229">&#34;Shouldn&#39;t&nbsp;support&nbsp;DSN&#34;</span><span class="op" id="7569252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7569255">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7569258">if</span>&nbsp;<span class="ident" id="7569261">err</span>&nbsp;<span class="op" id="7569265">:=</span>&nbsp;<span class="ident" id="7569268"><a href="/gostd/net/smtp/smtp_test.go.html#7568943">c</a></span><span class="op" id="7569269">.</span><span class="ident" id="7569270"><a href="/gostd/net/smtp/smtp.go.html#5799642">Quit</a></span><span class="op" id="7569274">(</span><span class="op" id="7569275">)</span><span class="op" id="7569276">;</span>&nbsp;<span class="ident" id="7569278"><a href="/gostd/net/smtp/smtp_test.go.html#7569261">err</a></span>&nbsp;<span class="op" id="7569282">!=</span>&nbsp;<span class="builtintype" id="7569285">nil</span>&nbsp;<span class="op" id="7569289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7569293"><a href="/gostd/net/smtp/smtp_test.go.html#7568545">t</a></span><span class="op" id="7569294">.</span><span class="ident" id="7569295"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7569301">(</span><span class="string" id="7569302">&#34;QUIT&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7569319">,</span>&nbsp;<span class="ident" id="7569321"><a href="/gostd/net/smtp/smtp_test.go.html#7569261">err</a></span><span class="op" id="7569324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7569327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7569331">actualcmds</span>&nbsp;<span class="op" id="7569342">:=</span>&nbsp;<span class="ident" id="7569345"><a href="/gostd/net/smtp/smtp_test.go.html#7568765">out</a></span><span class="op" id="7569348">(</span><span class="op" id="7569349">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7569352">if</span>&nbsp;<span class="ident" id="7569355"><a href="/gostd/net/smtp/smtp_test.go.html#7568632">client</a></span>&nbsp;<span class="op" id="7569362">!=</span>&nbsp;<span class="ident" id="7569365"><a href="/gostd/net/smtp/smtp_test.go.html#7569331">actualcmds</a></span>&nbsp;<span class="op" id="7569376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7569380"><a href="/gostd/net/smtp/smtp_test.go.html#7568545">t</a></span><span class="op" id="7569381">.</span><span class="ident" id="7569382"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7569388">(</span><span class="string" id="7569389">&#34;Got:\n%s\nExpected:\n%s&#34;</span><span class="op" id="7569414">,</span>&nbsp;<span class="ident" id="7569416"><a href="/gostd/net/smtp/smtp_test.go.html#7569331">actualcmds</a></span><span class="op" id="7569426">,</span>&nbsp;<span class="ident" id="7569428"><a href="/gostd/net/smtp/smtp_test.go.html#7568632">client</a></span><span class="op" id="7569434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7569437">}</span><br>
<span class="lineno"></span><span class="op" id="7569439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="7569442">var</span>&nbsp;<span class="ident" id="7569446">newClientServer</span>&nbsp;<span class="op" id="7569462">=</span>&nbsp;<span class="string" id="7569464">`220&nbsp;hello&nbsp;world<br>
<span class="lineno"></span>250-mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno"></span>250-SIZE&nbsp;35651584<br>
<span class="lineno"></span>250-AUTH&nbsp;LOGIN&nbsp;PLAIN<br>
<span class="lineno"></span>250&nbsp;8BITMIME<br>
<span class="lineno">265</span>221&nbsp;OK<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7569577">var</span>&nbsp;<span class="ident" id="7569581">newClientClient</span>&nbsp;<span class="op" id="7569597">=</span>&nbsp;<span class="string" id="7569599">`EHLO&nbsp;localhost<br>
<span class="lineno"></span>QUIT<br>
<span class="lineno">270</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7569623">func</span>&nbsp;<span class="ident" id="7569628">TestNewClient2</span><span class="op" id="7569642">(</span><span class="ident" id="7569643">t</span>&nbsp;<span class="op" id="7569645">*</span><span class="ident" id="7569646"><a href="/gostd/net/smtp/smtp_test.go.html#7563152">testing</a></span><span class="op" id="7569653">.</span><span class="ident" id="7569654"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7569655">)</span>&nbsp;<span class="op" id="7569657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7569660">server</span>&nbsp;<span class="op" id="7569667">:=</span>&nbsp;<span class="ident" id="7569670"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7569677">.</span><span class="ident" id="7569678"><a href="/gostd/strings/strings.go.html#2974969">Join</a></span><span class="op" id="7569682">(</span><span class="ident" id="7569683"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7569690">.</span><span class="ident" id="7569691"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7569696">(</span><span class="ident" id="7569697"><a href="/gostd/net/smtp/smtp_test.go.html#7570375">newClient2Server</a></span><span class="op" id="7569713">,</span>&nbsp;<span class="string" id="7569715">&#34;\n&#34;</span><span class="op" id="7569719">)</span><span class="op" id="7569720">,</span>&nbsp;<span class="string" id="7569722">&#34;\r\n&#34;</span><span class="op" id="7569728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7569731">client</span>&nbsp;<span class="op" id="7569738">:=</span>&nbsp;<span class="ident" id="7569741"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7569748">.</span><span class="ident" id="7569749"><a href="/gostd/strings/strings.go.html#2974969">Join</a></span><span class="op" id="7569753">(</span><span class="ident" id="7569754"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7569761">.</span><span class="ident" id="7569762"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7569767">(</span><span class="ident" id="7569768"><a href="/gostd/net/smtp/smtp_test.go.html#7570519">newClient2Client</a></span><span class="op" id="7569784">,</span>&nbsp;<span class="string" id="7569786">&#34;\n&#34;</span><span class="op" id="7569790">)</span><span class="op" id="7569791">,</span>&nbsp;<span class="string" id="7569793">&#34;\r\n&#34;</span><span class="op" id="7569799">)</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7569803">var</span>&nbsp;<span class="ident" id="7569807">cmdbuf</span>&nbsp;<span class="ident" id="7569814"><a href="/gostd/net/smtp/smtp_test.go.html#7563073">bytes</a></span><span class="op" id="7569819">.</span><span class="ident" id="7569820"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7569828">bcmdbuf</span>&nbsp;<span class="op" id="7569836">:=</span>&nbsp;<span class="ident" id="7569839"><a href="/gostd/net/smtp/smtp_test.go.html#7563064">bufio</a></span><span class="op" id="7569844">.</span><span class="ident" id="7569845"><a href="/gostd/bufio/bufio.go.html#1367149">NewWriter</a></span><span class="op" id="7569854">(</span><span class="op" id="7569855">&amp;</span><span class="ident" id="7569856"><a href="/gostd/net/smtp/smtp_test.go.html#7569807">cmdbuf</a></span><span class="op" id="7569862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7569865">var</span>&nbsp;<span class="ident" id="7569869">fake</span>&nbsp;<span class="ident" id="7569874"><a href="/gostd/net/smtp/smtp_test.go.html#7565238">faker</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7569881"><a href="/gostd/net/smtp/smtp_test.go.html#7569869">fake</a></span><span class="op" id="7569885">.</span><span class="ident" id="7569886"><a href="/gostd/net/smtp/smtp_test.go.html#7565254">ReadWriter</a></span>&nbsp;<span class="op" id="7569897">=</span>&nbsp;<span class="ident" id="7569899"><a href="/gostd/net/smtp/smtp_test.go.html#7563064">bufio</a></span><span class="op" id="7569904">.</span><span class="ident" id="7569905"><a href="/gostd/bufio/bufio.go.html#1371043">NewReadWriter</a></span><span class="op" id="7569918">(</span><span class="ident" id="7569919"><a href="/gostd/net/smtp/smtp_test.go.html#7563064">bufio</a></span><span class="op" id="7569924">.</span><span class="ident" id="7569925"><a href="/gostd/bufio/bufio.go.html#1355792">NewReader</a></span><span class="op" id="7569934">(</span><span class="ident" id="7569935"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7569942">.</span><span class="ident" id="7569943"><a href="/gostd/strings/reader.go.html#2948317">NewReader</a></span><span class="op" id="7569952">(</span><span class="ident" id="7569953"><a href="/gostd/net/smtp/smtp_test.go.html#7569660">server</a></span><span class="op" id="7569959">)</span><span class="op" id="7569960">)</span><span class="op" id="7569961">,</span>&nbsp;<span class="ident" id="7569963"><a href="/gostd/net/smtp/smtp_test.go.html#7569828">bcmdbuf</a></span><span class="op" id="7569970">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7569973">c</span><span class="op" id="7569974">,</span>&nbsp;<span class="ident" id="7569976">err</span>&nbsp;<span class="op" id="7569980">:=</span>&nbsp;<span class="ident" id="7569983"><a href="/gostd/net/smtp/smtp.go.html#5791973">NewClient</a></span><span class="op" id="7569992">(</span><span class="ident" id="7569993"><a href="/gostd/net/smtp/smtp_test.go.html#7569869">fake</a></span><span class="op" id="7569997">,</span>&nbsp;<span class="string" id="7569999">&#34;fake.host&#34;</span><span class="op" id="7570010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7570013">if</span>&nbsp;<span class="ident" id="7570016"><a href="/gostd/net/smtp/smtp_test.go.html#7569976">err</a></span>&nbsp;<span class="op" id="7570020">!=</span>&nbsp;<span class="builtintype" id="7570023">nil</span>&nbsp;<span class="op" id="7570027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7570031"><a href="/gostd/net/smtp/smtp_test.go.html#7569643">t</a></span><span class="op" id="7570032">.</span><span class="ident" id="7570033"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7570039">(</span><span class="string" id="7570040">&#34;NewClient:&nbsp;%v&#34;</span><span class="op" id="7570055">,</span>&nbsp;<span class="ident" id="7570057"><a href="/gostd/net/smtp/smtp_test.go.html#7569976">err</a></span><span class="op" id="7570060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7570063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7570066">defer</span>&nbsp;<span class="ident" id="7570072"><a href="/gostd/net/smtp/smtp_test.go.html#7569973">c</a></span><span class="op" id="7570073">.</span><span class="ident" id="7570074"><a href="/gostd/net/smtp/smtp.go.html#5792300">Close</a></span><span class="op" id="7570079">(</span><span class="op" id="7570080">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7570083">if</span>&nbsp;<span class="ident" id="7570086">ok</span><span class="op" id="7570088">,</span>&nbsp;<span class="ident" id="7570090">_</span>&nbsp;<span class="op" id="7570092">:=</span>&nbsp;<span class="ident" id="7570095"><a href="/gostd/net/smtp/smtp_test.go.html#7569973">c</a></span><span class="op" id="7570096">.</span><span class="ident" id="7570097"><a href="/gostd/net/smtp/smtp.go.html#5799121">Extension</a></span><span class="op" id="7570106">(</span><span class="string" id="7570107">&#34;DSN&#34;</span><span class="op" id="7570112">)</span><span class="op" id="7570113">;</span>&nbsp;<span class="ident" id="7570115"><a href="/gostd/net/smtp/smtp_test.go.html#7570086">ok</a></span>&nbsp;<span class="op" id="7570118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7570122"><a href="/gostd/net/smtp/smtp_test.go.html#7569643">t</a></span><span class="op" id="7570123">.</span><span class="ident" id="7570124"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7570130">(</span><span class="string" id="7570131">&#34;Shouldn&#39;t&nbsp;support&nbsp;DSN&#34;</span><span class="op" id="7570154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7570157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7570160">if</span>&nbsp;<span class="ident" id="7570163">err</span>&nbsp;<span class="op" id="7570167">:=</span>&nbsp;<span class="ident" id="7570170"><a href="/gostd/net/smtp/smtp_test.go.html#7569973">c</a></span><span class="op" id="7570171">.</span><span class="ident" id="7570172"><a href="/gostd/net/smtp/smtp.go.html#5799642">Quit</a></span><span class="op" id="7570176">(</span><span class="op" id="7570177">)</span><span class="op" id="7570178">;</span>&nbsp;<span class="ident" id="7570180"><a href="/gostd/net/smtp/smtp_test.go.html#7570163">err</a></span>&nbsp;<span class="op" id="7570184">!=</span>&nbsp;<span class="builtintype" id="7570187">nil</span>&nbsp;<span class="op" id="7570191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7570195"><a href="/gostd/net/smtp/smtp_test.go.html#7569643">t</a></span><span class="op" id="7570196">.</span><span class="ident" id="7570197"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7570203">(</span><span class="string" id="7570204">&#34;QUIT&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7570221">,</span>&nbsp;<span class="ident" id="7570223"><a href="/gostd/net/smtp/smtp_test.go.html#7570163">err</a></span><span class="op" id="7570226">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7570229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7570233"><a href="/gostd/net/smtp/smtp_test.go.html#7569828">bcmdbuf</a></span><span class="op" id="7570240">.</span><span class="ident" id="7570241"><a href="/gostd/bufio/bufio.go.html#1367486">Flush</a></span><span class="op" id="7570246">(</span><span class="op" id="7570247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7570250">actualcmds</span>&nbsp;<span class="op" id="7570261">:=</span>&nbsp;<span class="ident" id="7570264"><a href="/gostd/net/smtp/smtp_test.go.html#7569807">cmdbuf</a></span><span class="op" id="7570270">.</span><span class="ident" id="7570271"><a href="/gostd/bytes/buffer.go.html#1384648">String</a></span><span class="op" id="7570277">(</span><span class="op" id="7570278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7570281">if</span>&nbsp;<span class="ident" id="7570284"><a href="/gostd/net/smtp/smtp_test.go.html#7569731">client</a></span>&nbsp;<span class="op" id="7570291">!=</span>&nbsp;<span class="ident" id="7570294"><a href="/gostd/net/smtp/smtp_test.go.html#7570250">actualcmds</a></span>&nbsp;<span class="op" id="7570305">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7570309"><a href="/gostd/net/smtp/smtp_test.go.html#7569643">t</a></span><span class="op" id="7570310">.</span><span class="ident" id="7570311"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7570317">(</span><span class="string" id="7570318">&#34;Got:\n%s\nExpected:\n%s&#34;</span><span class="op" id="7570343">,</span>&nbsp;<span class="ident" id="7570345"><a href="/gostd/net/smtp/smtp_test.go.html#7570250">actualcmds</a></span><span class="op" id="7570355">,</span>&nbsp;<span class="ident" id="7570357"><a href="/gostd/net/smtp/smtp_test.go.html#7569731">client</a></span><span class="op" id="7570363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7570366">}</span><br>
<span class="lineno"></span><span class="op" id="7570368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7570371">var</span>&nbsp;<span class="ident" id="7570375">newClient2Server</span>&nbsp;<span class="op" id="7570392">=</span>&nbsp;<span class="string" id="7570394">`220&nbsp;hello&nbsp;world<br>
<span class="lineno">300</span>502&nbsp;EH?<br>
<span class="lineno"></span>250-mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno"></span>250-SIZE&nbsp;35651584<br>
<span class="lineno"></span>250-AUTH&nbsp;LOGIN&nbsp;PLAIN<br>
<span class="lineno"></span>250&nbsp;8BITMIME<br>
<span class="lineno">305</span>221&nbsp;OK<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7570515">var</span>&nbsp;<span class="ident" id="7570519">newClient2Client</span>&nbsp;<span class="op" id="7570536">=</span>&nbsp;<span class="string" id="7570538">`EHLO&nbsp;localhost<br>
<span class="lineno"></span>HELO&nbsp;localhost<br>
<span class="lineno">310</span>QUIT<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7570577">func</span>&nbsp;<span class="ident" id="7570582">TestHello</span><span class="op" id="7570591">(</span><span class="ident" id="7570592">t</span>&nbsp;<span class="op" id="7570594">*</span><span class="ident" id="7570595"><a href="/gostd/net/smtp/smtp_test.go.html#7563152">testing</a></span><span class="op" id="7570602">.</span><span class="ident" id="7570603"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7570604">)</span>&nbsp;<span class="op" id="7570606">{</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7570610">if</span>&nbsp;<span class="builtinfunc" id="7570613">len</span><span class="op" id="7570616">(</span><span class="ident" id="7570617"><a href="/gostd/net/smtp/smtp_test.go.html#7572330">helloServer</a></span><span class="op" id="7570628">)</span>&nbsp;<span class="op" id="7570630">!=</span>&nbsp;<span class="builtinfunc" id="7570633">len</span><span class="op" id="7570636">(</span><span class="ident" id="7570637"><a href="/gostd/net/smtp/smtp_test.go.html#7572575">helloClient</a></span><span class="op" id="7570648">)</span>&nbsp;<span class="op" id="7570650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7570654"><a href="/gostd/net/smtp/smtp_test.go.html#7570592">t</a></span><span class="op" id="7570655">.</span><span class="ident" id="7570656"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7570662">(</span><span class="string" id="7570663">&#34;Hello&nbsp;server&nbsp;and&nbsp;client&nbsp;size&nbsp;mismatch&#34;</span><span class="op" id="7570702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7570705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7570709">for</span>&nbsp;<span class="ident" id="7570713">i</span>&nbsp;<span class="op" id="7570715">:=</span>&nbsp;<span class="num" id="7570718">0</span><span class="op" id="7570719">;</span>&nbsp;<span class="ident" id="7570721"><a href="/gostd/net/smtp/smtp_test.go.html#7570713">i</a></span>&nbsp;<span class="op" id="7570723">&lt;</span>&nbsp;<span class="builtinfunc" id="7570725">len</span><span class="op" id="7570728">(</span><span class="ident" id="7570729"><a href="/gostd/net/smtp/smtp_test.go.html#7572330">helloServer</a></span><span class="op" id="7570740">)</span><span class="op" id="7570741">;</span>&nbsp;<span class="ident" id="7570743"><a href="/gostd/net/smtp/smtp_test.go.html#7570713">i</a></span><span class="op" id="7570744">++</span>&nbsp;<span class="op" id="7570747">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7570751">server</span>&nbsp;<span class="op" id="7570758">:=</span>&nbsp;<span class="ident" id="7570761"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7570768">.</span><span class="ident" id="7570769"><a href="/gostd/strings/strings.go.html#2974969">Join</a></span><span class="op" id="7570773">(</span><span class="ident" id="7570774"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7570781">.</span><span class="ident" id="7570782"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7570787">(</span><span class="ident" id="7570788"><a href="/gostd/net/smtp/smtp_test.go.html#7572234">baseHelloServer</a></span><span class="op" id="7570803">+</span><span class="ident" id="7570804"><a href="/gostd/net/smtp/smtp_test.go.html#7572330">helloServer</a></span><span class="op" id="7570815">[</span><span class="ident" id="7570816"><a href="/gostd/net/smtp/smtp_test.go.html#7570713">i</a></span><span class="op" id="7570817">]</span><span class="op" id="7570818">,</span>&nbsp;<span class="string" id="7570820">&#34;\n&#34;</span><span class="op" id="7570824">)</span><span class="op" id="7570825">,</span>&nbsp;<span class="string" id="7570827">&#34;\r\n&#34;</span><span class="op" id="7570833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7570837">client</span>&nbsp;<span class="op" id="7570844">:=</span>&nbsp;<span class="ident" id="7570847"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7570854">.</span><span class="ident" id="7570855"><a href="/gostd/strings/strings.go.html#2974969">Join</a></span><span class="op" id="7570859">(</span><span class="ident" id="7570860"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7570867">.</span><span class="ident" id="7570868"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7570873">(</span><span class="ident" id="7570874"><a href="/gostd/net/smtp/smtp_test.go.html#7572517">baseHelloClient</a></span><span class="op" id="7570889">+</span><span class="ident" id="7570890"><a href="/gostd/net/smtp/smtp_test.go.html#7572575">helloClient</a></span><span class="op" id="7570901">[</span><span class="ident" id="7570902"><a href="/gostd/net/smtp/smtp_test.go.html#7570713">i</a></span><span class="op" id="7570903">]</span><span class="op" id="7570904">,</span>&nbsp;<span class="string" id="7570906">&#34;\n&#34;</span><span class="op" id="7570910">)</span><span class="op" id="7570911">,</span>&nbsp;<span class="string" id="7570913">&#34;\r\n&#34;</span><span class="op" id="7570919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7570923">var</span>&nbsp;<span class="ident" id="7570927">cmdbuf</span>&nbsp;<span class="ident" id="7570934"><a href="/gostd/net/smtp/smtp_test.go.html#7563073">bytes</a></span><span class="op" id="7570939">.</span><span class="ident" id="7570940"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7570949">bcmdbuf</span>&nbsp;<span class="op" id="7570957">:=</span>&nbsp;<span class="ident" id="7570960"><a href="/gostd/net/smtp/smtp_test.go.html#7563064">bufio</a></span><span class="op" id="7570965">.</span><span class="ident" id="7570966"><a href="/gostd/bufio/bufio.go.html#1367149">NewWriter</a></span><span class="op" id="7570975">(</span><span class="op" id="7570976">&amp;</span><span class="ident" id="7570977"><a href="/gostd/net/smtp/smtp_test.go.html#7570927">cmdbuf</a></span><span class="op" id="7570983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7570987">var</span>&nbsp;<span class="ident" id="7570991">fake</span>&nbsp;<span class="ident" id="7570996"><a href="/gostd/net/smtp/smtp_test.go.html#7565238">faker</a></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571004"><a href="/gostd/net/smtp/smtp_test.go.html#7570991">fake</a></span><span class="op" id="7571008">.</span><span class="ident" id="7571009"><a href="/gostd/net/smtp/smtp_test.go.html#7565254">ReadWriter</a></span>&nbsp;<span class="op" id="7571020">=</span>&nbsp;<span class="ident" id="7571022"><a href="/gostd/net/smtp/smtp_test.go.html#7563064">bufio</a></span><span class="op" id="7571027">.</span><span class="ident" id="7571028"><a href="/gostd/bufio/bufio.go.html#1371043">NewReadWriter</a></span><span class="op" id="7571041">(</span><span class="ident" id="7571042"><a href="/gostd/net/smtp/smtp_test.go.html#7563064">bufio</a></span><span class="op" id="7571047">.</span><span class="ident" id="7571048"><a href="/gostd/bufio/bufio.go.html#1355792">NewReader</a></span><span class="op" id="7571057">(</span><span class="ident" id="7571058"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7571065">.</span><span class="ident" id="7571066"><a href="/gostd/strings/reader.go.html#2948317">NewReader</a></span><span class="op" id="7571075">(</span><span class="ident" id="7571076"><a href="/gostd/net/smtp/smtp_test.go.html#7570751">server</a></span><span class="op" id="7571082">)</span><span class="op" id="7571083">)</span><span class="op" id="7571084">,</span>&nbsp;<span class="ident" id="7571086"><a href="/gostd/net/smtp/smtp_test.go.html#7570949">bcmdbuf</a></span><span class="op" id="7571093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571097">c</span><span class="op" id="7571098">,</span>&nbsp;<span class="ident" id="7571100">err</span>&nbsp;<span class="op" id="7571104">:=</span>&nbsp;<span class="ident" id="7571107"><a href="/gostd/net/smtp/smtp.go.html#5791973">NewClient</a></span><span class="op" id="7571116">(</span><span class="ident" id="7571117"><a href="/gostd/net/smtp/smtp_test.go.html#7570991">fake</a></span><span class="op" id="7571121">,</span>&nbsp;<span class="string" id="7571123">&#34;fake.host&#34;</span><span class="op" id="7571134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7571138">if</span>&nbsp;<span class="ident" id="7571141"><a href="/gostd/net/smtp/smtp_test.go.html#7571100">err</a></span>&nbsp;<span class="op" id="7571145">!=</span>&nbsp;<span class="builtintype" id="7571148">nil</span>&nbsp;<span class="op" id="7571152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571157"><a href="/gostd/net/smtp/smtp_test.go.html#7570592">t</a></span><span class="op" id="7571158">.</span><span class="ident" id="7571159"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7571165">(</span><span class="string" id="7571166">&#34;NewClient:&nbsp;%v&#34;</span><span class="op" id="7571181">,</span>&nbsp;<span class="ident" id="7571183"><a href="/gostd/net/smtp/smtp_test.go.html#7571100">err</a></span><span class="op" id="7571186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7571190">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7571194">defer</span>&nbsp;<span class="ident" id="7571200"><a href="/gostd/net/smtp/smtp_test.go.html#7571097">c</a></span><span class="op" id="7571201">.</span><span class="ident" id="7571202"><a href="/gostd/net/smtp/smtp.go.html#5792300">Close</a></span><span class="op" id="7571207">(</span><span class="op" id="7571208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571212"><a href="/gostd/net/smtp/smtp_test.go.html#7571097">c</a></span><span class="op" id="7571213">.</span><span class="ident" id="7571214"><a href="/gostd/net/smtp/smtp.go.html#5791399">localName</a></span>&nbsp;<span class="op" id="7571224">=</span>&nbsp;<span class="string" id="7571226">&#34;customhost&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571241"><a href="/gostd/net/smtp/smtp_test.go.html#7571100">err</a></span>&nbsp;<span class="op" id="7571245">=</span>&nbsp;<span class="builtintype" id="7571247">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7571254">switch</span>&nbsp;<span class="ident" id="7571261"><a href="/gostd/net/smtp/smtp_test.go.html#7570713">i</a></span>&nbsp;<span class="op" id="7571263">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7571267">case</span>&nbsp;<span class="num" id="7571272">0</span><span class="op" id="7571273">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571278"><a href="/gostd/net/smtp/smtp_test.go.html#7571100">err</a></span>&nbsp;<span class="op" id="7571282">=</span>&nbsp;<span class="ident" id="7571284"><a href="/gostd/net/smtp/smtp_test.go.html#7571097">c</a></span><span class="op" id="7571285">.</span><span class="ident" id="7571286"><a href="/gostd/net/smtp/smtp.go.html#5792883">Hello</a></span><span class="op" id="7571291">(</span><span class="string" id="7571292">&#34;customhost&#34;</span><span class="op" id="7571304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7571308">case</span>&nbsp;<span class="num" id="7571313">1</span><span class="op" id="7571314">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571319"><a href="/gostd/net/smtp/smtp_test.go.html#7571100">err</a></span>&nbsp;<span class="op" id="7571323">=</span>&nbsp;<span class="ident" id="7571325"><a href="/gostd/net/smtp/smtp_test.go.html#7571097">c</a></span><span class="op" id="7571326">.</span><span class="ident" id="7571327"><a href="/gostd/net/smtp/smtp.go.html#5794460">StartTLS</a></span><span class="op" id="7571335">(</span><span class="builtintype" id="7571336">nil</span><span class="op" id="7571339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7571344">if</span>&nbsp;<span class="ident" id="7571347"><a href="/gostd/net/smtp/smtp_test.go.html#7571100">err</a></span><span class="op" id="7571350">.</span><span class="ident" id="7571351">Error</span><span class="op" id="7571356">(</span><span class="op" id="7571357">)</span>&nbsp;<span class="op" id="7571359">==</span>&nbsp;<span class="string" id="7571362">&#34;502&nbsp;Not&nbsp;implemented&#34;</span>&nbsp;<span class="op" id="7571384">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571390"><a href="/gostd/net/smtp/smtp_test.go.html#7571100">err</a></span>&nbsp;<span class="op" id="7571394">=</span>&nbsp;<span class="builtintype" id="7571396">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7571403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7571407">case</span>&nbsp;<span class="num" id="7571412">2</span><span class="op" id="7571413">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571418"><a href="/gostd/net/smtp/smtp_test.go.html#7571100">err</a></span>&nbsp;<span class="op" id="7571422">=</span>&nbsp;<span class="ident" id="7571424"><a href="/gostd/net/smtp/smtp_test.go.html#7571097">c</a></span><span class="op" id="7571425">.</span><span class="ident" id="7571426"><a href="/gostd/net/smtp/smtp.go.html#5794989">Verify</a></span><span class="op" id="7571432">(</span><span class="string" id="7571433">&#34;test@example.com&#34;</span><span class="op" id="7571451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7571455">case</span>&nbsp;<span class="num" id="7571460">3</span><span class="op" id="7571461">:</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571466"><a href="/gostd/net/smtp/smtp_test.go.html#7571097">c</a></span><span class="op" id="7571467">.</span><span class="ident" id="7571468"><a href="/gostd/net/smtp/smtp.go.html#5791257">tls</a></span>&nbsp;<span class="op" id="7571472">=</span>&nbsp;<span class="builtintype" id="7571474">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571482"><a href="/gostd/net/smtp/smtp_test.go.html#7571097">c</a></span><span class="op" id="7571483">.</span><span class="ident" id="7571484"><a href="/gostd/net/smtp/smtp.go.html#5791274">serverName</a></span>&nbsp;<span class="op" id="7571495">=</span>&nbsp;<span class="string" id="7571497">&#34;smtp.google.com&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571518"><a href="/gostd/net/smtp/smtp_test.go.html#7571100">err</a></span>&nbsp;<span class="op" id="7571522">=</span>&nbsp;<span class="ident" id="7571524"><a href="/gostd/net/smtp/smtp_test.go.html#7571097">c</a></span><span class="op" id="7571525">.</span><span class="ident" id="7571526"><a href="/gostd/net/smtp/smtp.go.html#5795341">Auth</a></span><span class="op" id="7571530">(</span><span class="ident" id="7571531"><a href="/gostd/net/smtp/auth.go.html#5788807">PlainAuth</a></span><span class="op" id="7571540">(</span><span class="string" id="7571541">&#34;&#34;</span><span class="op" id="7571543">,</span>&nbsp;<span class="string" id="7571545">&#34;user&#34;</span><span class="op" id="7571551">,</span>&nbsp;<span class="string" id="7571553">&#34;pass&#34;</span><span class="op" id="7571559">,</span>&nbsp;<span class="string" id="7571561">&#34;smtp.google.com&#34;</span><span class="op" id="7571578">)</span><span class="op" id="7571579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7571583">case</span>&nbsp;<span class="num" id="7571588">4</span><span class="op" id="7571589">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571594"><a href="/gostd/net/smtp/smtp_test.go.html#7571100">err</a></span>&nbsp;<span class="op" id="7571598">=</span>&nbsp;<span class="ident" id="7571600"><a href="/gostd/net/smtp/smtp_test.go.html#7571097">c</a></span><span class="op" id="7571601">.</span><span class="ident" id="7571602"><a href="/gostd/net/smtp/smtp.go.html#5796571">Mail</a></span><span class="op" id="7571606">(</span><span class="string" id="7571607">&#34;test@example.com&#34;</span><span class="op" id="7571625">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7571629">case</span>&nbsp;<span class="num" id="7571634">5</span><span class="op" id="7571635">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571640">ok</span><span class="op" id="7571642">,</span>&nbsp;<span class="ident" id="7571644">_</span>&nbsp;<span class="op" id="7571646">:=</span>&nbsp;<span class="ident" id="7571649"><a href="/gostd/net/smtp/smtp_test.go.html#7571097">c</a></span><span class="op" id="7571650">.</span><span class="ident" id="7571651"><a href="/gostd/net/smtp/smtp.go.html#5799121">Extension</a></span><span class="op" id="7571660">(</span><span class="string" id="7571661">&#34;feature&#34;</span><span class="op" id="7571670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7571675">if</span>&nbsp;<span class="ident" id="7571678"><a href="/gostd/net/smtp/smtp_test.go.html#7571640">ok</a></span>&nbsp;<span class="op" id="7571681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571687"><a href="/gostd/net/smtp/smtp_test.go.html#7570592">t</a></span><span class="op" id="7571688">.</span><span class="ident" id="7571689"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7571695">(</span><span class="string" id="7571696">&#34;Expected&nbsp;FEATURE&nbsp;not&nbsp;to&nbsp;be&nbsp;supported&#34;</span><span class="op" id="7571734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7571739">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7571743">case</span>&nbsp;<span class="num" id="7571748">6</span><span class="op" id="7571749">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571754"><a href="/gostd/net/smtp/smtp_test.go.html#7571100">err</a></span>&nbsp;<span class="op" id="7571758">=</span>&nbsp;<span class="ident" id="7571760"><a href="/gostd/net/smtp/smtp_test.go.html#7571097">c</a></span><span class="op" id="7571761">.</span><span class="ident" id="7571762"><a href="/gostd/net/smtp/smtp.go.html#5799438">Reset</a></span><span class="op" id="7571767">(</span><span class="op" id="7571768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7571772">case</span>&nbsp;<span class="num" id="7571777">7</span><span class="op" id="7571778">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571783"><a href="/gostd/net/smtp/smtp_test.go.html#7571100">err</a></span>&nbsp;<span class="op" id="7571787">=</span>&nbsp;<span class="ident" id="7571789"><a href="/gostd/net/smtp/smtp_test.go.html#7571097">c</a></span><span class="op" id="7571790">.</span><span class="ident" id="7571791"><a href="/gostd/net/smtp/smtp.go.html#5799642">Quit</a></span><span class="op" id="7571795">(</span><span class="op" id="7571796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7571800">case</span>&nbsp;<span class="num" id="7571805">8</span><span class="op" id="7571806">:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571811"><a href="/gostd/net/smtp/smtp_test.go.html#7571100">err</a></span>&nbsp;<span class="op" id="7571815">=</span>&nbsp;<span class="ident" id="7571817"><a href="/gostd/net/smtp/smtp_test.go.html#7571097">c</a></span><span class="op" id="7571818">.</span><span class="ident" id="7571819"><a href="/gostd/net/smtp/smtp.go.html#5794989">Verify</a></span><span class="op" id="7571825">(</span><span class="string" id="7571826">&#34;test@example.com&#34;</span><span class="op" id="7571844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7571849">if</span>&nbsp;<span class="ident" id="7571852"><a href="/gostd/net/smtp/smtp_test.go.html#7571100">err</a></span>&nbsp;<span class="op" id="7571856">!=</span>&nbsp;<span class="builtintype" id="7571859">nil</span>&nbsp;<span class="op" id="7571863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571869"><a href="/gostd/net/smtp/smtp_test.go.html#7571100">err</a></span>&nbsp;<span class="op" id="7571873">=</span>&nbsp;<span class="ident" id="7571875"><a href="/gostd/net/smtp/smtp_test.go.html#7571097">c</a></span><span class="op" id="7571876">.</span><span class="ident" id="7571877"><a href="/gostd/net/smtp/smtp.go.html#5792883">Hello</a></span><span class="op" id="7571882">(</span><span class="string" id="7571883">&#34;customhost&#34;</span><span class="op" id="7571895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7571901">if</span>&nbsp;<span class="ident" id="7571904"><a href="/gostd/net/smtp/smtp_test.go.html#7571100">err</a></span>&nbsp;<span class="op" id="7571908">!=</span>&nbsp;<span class="builtintype" id="7571911">nil</span>&nbsp;<span class="op" id="7571915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571922"><a href="/gostd/net/smtp/smtp_test.go.html#7570592">t</a></span><span class="op" id="7571923">.</span><span class="ident" id="7571924"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7571930">(</span><span class="string" id="7571931">&#34;Want&nbsp;error,&nbsp;got&nbsp;none&#34;</span><span class="op" id="7571953">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7571959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7571964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7571968">default</span><span class="op" id="7571975">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7571980"><a href="/gostd/net/smtp/smtp_test.go.html#7570592">t</a></span><span class="op" id="7571981">.</span><span class="ident" id="7571982"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7571988">(</span><span class="string" id="7571989">&#34;Unhandled&nbsp;command&#34;</span><span class="op" id="7572008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7572012">}</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7572017">if</span>&nbsp;<span class="ident" id="7572020"><a href="/gostd/net/smtp/smtp_test.go.html#7571100">err</a></span>&nbsp;<span class="op" id="7572024">!=</span>&nbsp;<span class="builtintype" id="7572027">nil</span>&nbsp;<span class="op" id="7572031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7572036"><a href="/gostd/net/smtp/smtp_test.go.html#7570592">t</a></span><span class="op" id="7572037">.</span><span class="ident" id="7572038"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7572044">(</span><span class="string" id="7572045">&#34;Command&nbsp;%d&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7572068">,</span>&nbsp;<span class="ident" id="7572070"><a href="/gostd/net/smtp/smtp_test.go.html#7570713">i</a></span><span class="op" id="7572071">,</span>&nbsp;<span class="ident" id="7572073"><a href="/gostd/net/smtp/smtp_test.go.html#7571100">err</a></span><span class="op" id="7572076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7572080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7572085"><a href="/gostd/net/smtp/smtp_test.go.html#7570949">bcmdbuf</a></span><span class="op" id="7572092">.</span><span class="ident" id="7572093"><a href="/gostd/bufio/bufio.go.html#1367486">Flush</a></span><span class="op" id="7572098">(</span><span class="op" id="7572099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7572103">actualcmds</span>&nbsp;<span class="op" id="7572114">:=</span>&nbsp;<span class="ident" id="7572117"><a href="/gostd/net/smtp/smtp_test.go.html#7570927">cmdbuf</a></span><span class="op" id="7572123">.</span><span class="ident" id="7572124"><a href="/gostd/bytes/buffer.go.html#1384648">String</a></span><span class="op" id="7572130">(</span><span class="op" id="7572131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7572135">if</span>&nbsp;<span class="ident" id="7572138"><a href="/gostd/net/smtp/smtp_test.go.html#7570837">client</a></span>&nbsp;<span class="op" id="7572145">!=</span>&nbsp;<span class="ident" id="7572148"><a href="/gostd/net/smtp/smtp_test.go.html#7572103">actualcmds</a></span>&nbsp;<span class="op" id="7572159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7572164"><a href="/gostd/net/smtp/smtp_test.go.html#7570592">t</a></span><span class="op" id="7572165">.</span><span class="ident" id="7572166"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7572172">(</span><span class="string" id="7572173">&#34;Got:\n%s\nExpected:\n%s&#34;</span><span class="op" id="7572198">,</span>&nbsp;<span class="ident" id="7572200"><a href="/gostd/net/smtp/smtp_test.go.html#7572103">actualcmds</a></span><span class="op" id="7572210">,</span>&nbsp;<span class="ident" id="7572212"><a href="/gostd/net/smtp/smtp_test.go.html#7570837">client</a></span><span class="op" id="7572218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7572222">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7572225">}</span><br>
<span class="lineno"></span><span class="op" id="7572227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7572230">var</span>&nbsp;<span class="ident" id="7572234">baseHelloServer</span>&nbsp;<span class="op" id="7572250">=</span>&nbsp;<span class="string" id="7572252">`220&nbsp;hello&nbsp;world<br>
<span class="lineno"></span>502&nbsp;EH?<br>
<span class="lineno">385</span>250-mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno"></span>250&nbsp;FEATURE<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7572326">var</span>&nbsp;<span class="ident" id="7572330">helloServer</span>&nbsp;<span class="op" id="7572342">=</span>&nbsp;<span class="op" id="7572344">[</span><span class="op" id="7572345">]</span><span class="builtintype" id="7572346">string</span><span class="op" id="7572352">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7572355">&#34;&#34;</span><span class="op" id="7572357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7572360">&#34;502&nbsp;Not&nbsp;implemented\n&#34;</span><span class="op" id="7572383">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7572386">&#34;250&nbsp;User&nbsp;is&nbsp;valid\n&#34;</span><span class="op" id="7572407">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7572410">&#34;235&nbsp;Accepted\n&#34;</span><span class="op" id="7572426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7572429">&#34;250&nbsp;Sender&nbsp;ok\n&#34;</span><span class="op" id="7572446">,</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7572449">&#34;&#34;</span><span class="op" id="7572451">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7572454">&#34;250&nbsp;Reset&nbsp;ok\n&#34;</span><span class="op" id="7572470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7572473">&#34;221&nbsp;Goodbye\n&#34;</span><span class="op" id="7572488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7572491">&#34;250&nbsp;Sender&nbsp;ok\n&#34;</span><span class="op" id="7572508">,</span><br>
<span class="lineno"></span><span class="op" id="7572510">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="keyword" id="7572513">var</span>&nbsp;<span class="ident" id="7572517">baseHelloClient</span>&nbsp;<span class="op" id="7572533">=</span>&nbsp;<span class="string" id="7572535">`EHLO&nbsp;customhost<br>
<span class="lineno"></span>HELO&nbsp;customhost<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="keyword" id="7572571">var</span>&nbsp;<span class="ident" id="7572575">helloClient</span>&nbsp;<span class="op" id="7572587">=</span>&nbsp;<span class="op" id="7572589">[</span><span class="op" id="7572590">]</span><span class="builtintype" id="7572591">string</span><span class="op" id="7572597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7572600">&#34;&#34;</span><span class="op" id="7572602">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7572605">&#34;STARTTLS\n&#34;</span><span class="op" id="7572617">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7572620">&#34;VRFY&nbsp;test@example.com\n&#34;</span><span class="op" id="7572645">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7572648">&#34;AUTH&nbsp;PLAIN&nbsp;AHVzZXIAcGFzcw==\n&#34;</span><span class="op" id="7572679">,</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7572682">&#34;MAIL&nbsp;FROM:&lt;test@example.com&gt;\n&#34;</span><span class="op" id="7572714">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7572717">&#34;&#34;</span><span class="op" id="7572719">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7572722">&#34;RSET\n&#34;</span><span class="op" id="7572730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7572733">&#34;QUIT\n&#34;</span><span class="op" id="7572741">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7572744">&#34;VRFY&nbsp;test@example.com\n&#34;</span><span class="op" id="7572769">,</span><br>
<span class="lineno">415</span><span class="op" id="7572771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7572774">func</span>&nbsp;<span class="ident" id="7572779">TestSendMail</span><span class="op" id="7572791">(</span><span class="ident" id="7572792">t</span>&nbsp;<span class="op" id="7572794">*</span><span class="ident" id="7572795"><a href="/gostd/net/smtp/smtp_test.go.html#7563152">testing</a></span><span class="op" id="7572802">.</span><span class="ident" id="7572803"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7572804">)</span>&nbsp;<span class="op" id="7572806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7572809">server</span>&nbsp;<span class="op" id="7572816">:=</span>&nbsp;<span class="ident" id="7572819"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7572826">.</span><span class="ident" id="7572827"><a href="/gostd/strings/strings.go.html#2974969">Join</a></span><span class="op" id="7572831">(</span><span class="ident" id="7572832"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7572839">.</span><span class="ident" id="7572840"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7572845">(</span><span class="ident" id="7572846"><a href="/gostd/net/smtp/smtp_test.go.html#7574381">sendMailServer</a></span><span class="op" id="7572860">,</span>&nbsp;<span class="string" id="7572862">&#34;\n&#34;</span><span class="op" id="7572866">)</span><span class="op" id="7572867">,</span>&nbsp;<span class="string" id="7572869">&#34;\r\n&#34;</span><span class="op" id="7572875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7572878">client</span>&nbsp;<span class="op" id="7572885">:=</span>&nbsp;<span class="ident" id="7572888"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7572895">.</span><span class="ident" id="7572896"><a href="/gostd/strings/strings.go.html#2974969">Join</a></span><span class="op" id="7572900">(</span><span class="ident" id="7572901"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7572908">.</span><span class="ident" id="7572909"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7572914">(</span><span class="ident" id="7572915"><a href="/gostd/net/smtp/smtp_test.go.html#7574531">sendMailClient</a></span><span class="op" id="7572929">,</span>&nbsp;<span class="string" id="7572931">&#34;\n&#34;</span><span class="op" id="7572935">)</span><span class="op" id="7572936">,</span>&nbsp;<span class="string" id="7572938">&#34;\r\n&#34;</span><span class="op" id="7572944">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7572947">var</span>&nbsp;<span class="ident" id="7572951">cmdbuf</span>&nbsp;<span class="ident" id="7572958"><a href="/gostd/net/smtp/smtp_test.go.html#7563073">bytes</a></span><span class="op" id="7572963">.</span><span class="ident" id="7572964"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7572972">bcmdbuf</span>&nbsp;<span class="op" id="7572980">:=</span>&nbsp;<span class="ident" id="7572983"><a href="/gostd/net/smtp/smtp_test.go.html#7563064">bufio</a></span><span class="op" id="7572988">.</span><span class="ident" id="7572989"><a href="/gostd/bufio/bufio.go.html#1367149">NewWriter</a></span><span class="op" id="7572998">(</span><span class="op" id="7572999">&amp;</span><span class="ident" id="7573000"><a href="/gostd/net/smtp/smtp_test.go.html#7572951">cmdbuf</a></span><span class="op" id="7573006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7573009">l</span><span class="op" id="7573010">,</span>&nbsp;<span class="ident" id="7573012">err</span>&nbsp;<span class="op" id="7573016">:=</span>&nbsp;<span class="ident" id="7573019"><a href="/gostd/net/smtp/smtp_test.go.html#7563117">net</a></span><span class="op" id="7573022">.</span><span class="ident" id="7573023"><a href="/gostd/net/dial.go.html#3207117">Listen</a></span><span class="op" id="7573029">(</span><span class="string" id="7573030">&#34;tcp&#34;</span><span class="op" id="7573035">,</span>&nbsp;<span class="string" id="7573037">&#34;127.0.0.1:0&#34;</span><span class="op" id="7573050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7573053">if</span>&nbsp;<span class="ident" id="7573056"><a href="/gostd/net/smtp/smtp_test.go.html#7573012">err</a></span>&nbsp;<span class="op" id="7573060">!=</span>&nbsp;<span class="builtintype" id="7573063">nil</span>&nbsp;<span class="op" id="7573067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7573071"><a href="/gostd/net/smtp/smtp_test.go.html#7572792">t</a></span><span class="op" id="7573072">.</span><span class="ident" id="7573073"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7573079">(</span><span class="string" id="7573080">&#34;Unable&nbsp;to&nbsp;to&nbsp;create&nbsp;listener:&nbsp;%v&#34;</span><span class="op" id="7573114">,</span>&nbsp;<span class="ident" id="7573116"><a href="/gostd/net/smtp/smtp_test.go.html#7573012">err</a></span><span class="op" id="7573119">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7573122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7573125">defer</span>&nbsp;<span class="ident" id="7573131"><a href="/gostd/net/smtp/smtp_test.go.html#7573009">l</a></span><span class="op" id="7573132">.</span><span class="ident" id="7573133"><a href="/gostd/net/net.go.html#3340928">Close</a></span><span class="op" id="7573138">(</span><span class="op" id="7573139">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7573143">//&nbsp;prevent&nbsp;data&nbsp;race&nbsp;on&nbsp;bcmdbuf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7573176">var</span>&nbsp;<span class="ident" id="7573180">done</span>&nbsp;<span class="op" id="7573185">=</span>&nbsp;<span class="builtinfunc" id="7573187">make</span><span class="op" id="7573191">(</span><span class="keyword" id="7573192">chan</span>&nbsp;<span class="keyword" id="7573197">struct</span><span class="op" id="7573203">{</span><span class="op" id="7573204">}</span><span class="op" id="7573205">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7573208">go</span>&nbsp;<span class="keyword" id="7573211">func</span><span class="op" id="7573215">(</span><span class="ident" id="7573216">data</span>&nbsp;<span class="op" id="7573221">[</span><span class="op" id="7573222">]</span><span class="builtintype" id="7573223">string</span><span class="op" id="7573229">)</span>&nbsp;<span class="op" id="7573231">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7573236">defer</span>&nbsp;<span class="builtinfunc" id="7573242">close</span><span class="op" id="7573247">(</span><span class="ident" id="7573248"><a href="/gostd/net/smtp/smtp_test.go.html#7573180">done</a></span><span class="op" id="7573252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7573257">conn</span><span class="op" id="7573261">,</span>&nbsp;<span class="ident" id="7573263">err</span>&nbsp;<span class="op" id="7573267">:=</span>&nbsp;<span class="ident" id="7573270"><a href="/gostd/net/smtp/smtp_test.go.html#7573009">l</a></span><span class="op" id="7573271">.</span><span class="ident" id="7573272"><a href="/gostd/net/net.go.html#3340795">Accept</a></span><span class="op" id="7573278">(</span><span class="op" id="7573279">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7573283">if</span>&nbsp;<span class="ident" id="7573286"><a href="/gostd/net/smtp/smtp_test.go.html#7573263">err</a></span>&nbsp;<span class="op" id="7573290">!=</span>&nbsp;<span class="builtintype" id="7573293">nil</span>&nbsp;<span class="op" id="7573297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7573302"><a href="/gostd/net/smtp/smtp_test.go.html#7572792">t</a></span><span class="op" id="7573303">.</span><span class="ident" id="7573304"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7573310">(</span><span class="string" id="7573311">&#34;Accept&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7573329">,</span>&nbsp;<span class="ident" id="7573331"><a href="/gostd/net/smtp/smtp_test.go.html#7573263">err</a></span><span class="op" id="7573334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7573339">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7573348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7573352">defer</span>&nbsp;<span class="ident" id="7573358"><a href="/gostd/net/smtp/smtp_test.go.html#7573257">conn</a></span><span class="op" id="7573362">.</span><span class="ident" id="7573363"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="7573368">(</span><span class="op" id="7573369">)</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7573374">tc</span>&nbsp;<span class="op" id="7573377">:=</span>&nbsp;<span class="ident" id="7573380"><a href="/gostd/net/smtp/smtp_test.go.html#7563124">textproto</a></span><span class="op" id="7573389">.</span><span class="ident" id="7573390"><a href="/gostd/net/textproto/textproto.go.html#4350610">NewConn</a></span><span class="op" id="7573397">(</span><span class="ident" id="7573398"><a href="/gostd/net/smtp/smtp_test.go.html#7573257">conn</a></span><span class="op" id="7573402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7573406">for</span>&nbsp;<span class="ident" id="7573410">i</span>&nbsp;<span class="op" id="7573412">:=</span>&nbsp;<span class="num" id="7573415">0</span><span class="op" id="7573416">;</span>&nbsp;<span class="ident" id="7573418"><a href="/gostd/net/smtp/smtp_test.go.html#7573410">i</a></span>&nbsp;<span class="op" id="7573420">&lt;</span>&nbsp;<span class="builtinfunc" id="7573422">len</span><span class="op" id="7573425">(</span><span class="ident" id="7573426"><a href="/gostd/net/smtp/smtp_test.go.html#7573216">data</a></span><span class="op" id="7573430">)</span>&nbsp;<span class="op" id="7573432">&amp;&amp;</span>&nbsp;<span class="ident" id="7573435"><a href="/gostd/net/smtp/smtp_test.go.html#7573216">data</a></span><span class="op" id="7573439">[</span><span class="ident" id="7573440"><a href="/gostd/net/smtp/smtp_test.go.html#7573410">i</a></span><span class="op" id="7573441">]</span>&nbsp;<span class="op" id="7573443">!=</span>&nbsp;<span class="string" id="7573446">&#34;&#34;</span><span class="op" id="7573448">;</span>&nbsp;<span class="ident" id="7573450"><a href="/gostd/net/smtp/smtp_test.go.html#7573410">i</a></span><span class="op" id="7573451">++</span>&nbsp;<span class="op" id="7573454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7573459"><a href="/gostd/net/smtp/smtp_test.go.html#7573374">tc</a></span><span class="op" id="7573461">.</span><span class="ident" id="7573462"><a href="/gostd/net/textproto/writer.go.html#4353348">PrintfLine</a></span><span class="op" id="7573472">(</span><span class="ident" id="7573473"><a href="/gostd/net/smtp/smtp_test.go.html#7573216">data</a></span><span class="op" id="7573477">[</span><span class="ident" id="7573478"><a href="/gostd/net/smtp/smtp_test.go.html#7573410">i</a></span><span class="op" id="7573479">]</span><span class="op" id="7573480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7573485">for</span>&nbsp;<span class="builtinfunc" id="7573489">len</span><span class="op" id="7573492">(</span><span class="ident" id="7573493"><a href="/gostd/net/smtp/smtp_test.go.html#7573216">data</a></span><span class="op" id="7573497">[</span><span class="ident" id="7573498"><a href="/gostd/net/smtp/smtp_test.go.html#7573410">i</a></span><span class="op" id="7573499">]</span><span class="op" id="7573500">)</span>&nbsp;<span class="op" id="7573502">&gt;=</span>&nbsp;<span class="num" id="7573505">4</span>&nbsp;<span class="op" id="7573507">&amp;&amp;</span>&nbsp;<span class="ident" id="7573510"><a href="/gostd/net/smtp/smtp_test.go.html#7573216">data</a></span><span class="op" id="7573514">[</span><span class="ident" id="7573515"><a href="/gostd/net/smtp/smtp_test.go.html#7573410">i</a></span><span class="op" id="7573516">]</span><span class="op" id="7573517">[</span><span class="num" id="7573518">3</span><span class="op" id="7573519">]</span>&nbsp;<span class="op" id="7573521">==</span>&nbsp;<span class="string" id="7573524">&#39;-&#39;</span>&nbsp;<span class="op" id="7573528">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7573534"><a href="/gostd/net/smtp/smtp_test.go.html#7573410">i</a></span><span class="op" id="7573535">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7573542"><a href="/gostd/net/smtp/smtp_test.go.html#7573374">tc</a></span><span class="op" id="7573544">.</span><span class="ident" id="7573545"><a href="/gostd/net/textproto/writer.go.html#4353348">PrintfLine</a></span><span class="op" id="7573555">(</span><span class="ident" id="7573556"><a href="/gostd/net/smtp/smtp_test.go.html#7573216">data</a></span><span class="op" id="7573560">[</span><span class="ident" id="7573561"><a href="/gostd/net/smtp/smtp_test.go.html#7573410">i</a></span><span class="op" id="7573562">]</span><span class="op" id="7573563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7573568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7573573">if</span>&nbsp;<span class="ident" id="7573576"><a href="/gostd/net/smtp/smtp_test.go.html#7573216">data</a></span><span class="op" id="7573580">[</span><span class="ident" id="7573581"><a href="/gostd/net/smtp/smtp_test.go.html#7573410">i</a></span><span class="op" id="7573582">]</span>&nbsp;<span class="op" id="7573584">==</span>&nbsp;<span class="string" id="7573587">&#34;221&nbsp;Goodbye&#34;</span>&nbsp;<span class="op" id="7573601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7573607">return</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7573617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7573622">read</span>&nbsp;<span class="op" id="7573627">:=</span>&nbsp;<span class="builtintype" id="7573630">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7573639">for</span>&nbsp;<span class="op" id="7573643">!</span><span class="ident" id="7573644"><a href="/gostd/net/smtp/smtp_test.go.html#7573622">read</a></span>&nbsp;<span class="op" id="7573649">||</span>&nbsp;<span class="ident" id="7573652"><a href="/gostd/net/smtp/smtp_test.go.html#7573216">data</a></span><span class="op" id="7573656">[</span><span class="ident" id="7573657"><a href="/gostd/net/smtp/smtp_test.go.html#7573410">i</a></span><span class="op" id="7573658">]</span>&nbsp;<span class="op" id="7573660">==</span>&nbsp;<span class="string" id="7573663">&#34;354&nbsp;Go&nbsp;ahead&#34;</span>&nbsp;<span class="op" id="7573678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7573684">msg</span><span class="op" id="7573687">,</span>&nbsp;<span class="ident" id="7573689">err</span>&nbsp;<span class="op" id="7573693">:=</span>&nbsp;<span class="ident" id="7573696"><a href="/gostd/net/smtp/smtp_test.go.html#7573374">tc</a></span><span class="op" id="7573698">.</span><span class="ident" id="7573699"><a href="/gostd/net/textproto/reader.go.html#4333526">ReadLine</a></span><span class="op" id="7573707">(</span><span class="op" id="7573708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7573714"><a href="/gostd/net/smtp/smtp_test.go.html#7572972">bcmdbuf</a></span><span class="op" id="7573721">.</span><span class="ident" id="7573722"><a href="/gostd/bufio/bufio.go.html#1368329">Write</a></span><span class="op" id="7573727">(</span><span class="op" id="7573728">[</span><span class="op" id="7573729">]</span><span class="builtintype" id="7573730">byte</span><span class="op" id="7573734">(</span><span class="ident" id="7573735"><a href="/gostd/net/smtp/smtp_test.go.html#7573684">msg</a></span>&nbsp;<span class="op" id="7573739">+</span>&nbsp;<span class="string" id="7573741">&#34;\r\n&#34;</span><span class="op" id="7573747">)</span><span class="op" id="7573748">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7573754"><a href="/gostd/net/smtp/smtp_test.go.html#7573622">read</a></span>&nbsp;<span class="op" id="7573759">=</span>&nbsp;<span class="builtintype" id="7573761">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7573770">if</span>&nbsp;<span class="ident" id="7573773"><a href="/gostd/net/smtp/smtp_test.go.html#7573689">err</a></span>&nbsp;<span class="op" id="7573777">!=</span>&nbsp;<span class="builtintype" id="7573780">nil</span>&nbsp;<span class="op" id="7573784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7573791"><a href="/gostd/net/smtp/smtp_test.go.html#7572792">t</a></span><span class="op" id="7573792">.</span><span class="ident" id="7573793"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7573799">(</span><span class="string" id="7573800">&#34;Read&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7573816">,</span>&nbsp;<span class="ident" id="7573818"><a href="/gostd/net/smtp/smtp_test.go.html#7573689">err</a></span><span class="op" id="7573821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7573828">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7573839">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7573845">if</span>&nbsp;<span class="ident" id="7573848"><a href="/gostd/net/smtp/smtp_test.go.html#7573216">data</a></span><span class="op" id="7573852">[</span><span class="ident" id="7573853"><a href="/gostd/net/smtp/smtp_test.go.html#7573410">i</a></span><span class="op" id="7573854">]</span>&nbsp;<span class="op" id="7573856">==</span>&nbsp;<span class="string" id="7573859">&#34;354&nbsp;Go&nbsp;ahead&#34;</span>&nbsp;<span class="op" id="7573874">&amp;&amp;</span>&nbsp;<span class="ident" id="7573877"><a href="/gostd/net/smtp/smtp_test.go.html#7573684">msg</a></span>&nbsp;<span class="op" id="7573881">==</span>&nbsp;<span class="string" id="7573884">&#34;.&#34;</span>&nbsp;<span class="op" id="7573888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7573895">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7573905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7573910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7573914">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7573917">}</span><span class="op" id="7573918">(</span><span class="ident" id="7573919"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7573926">.</span><span class="ident" id="7573927"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7573932">(</span><span class="ident" id="7573933"><a href="/gostd/net/smtp/smtp_test.go.html#7572809">server</a></span><span class="op" id="7573939">,</span>&nbsp;<span class="string" id="7573941">&#34;\r\n&#34;</span><span class="op" id="7573947">)</span><span class="op" id="7573948">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7573952"><a href="/gostd/net/smtp/smtp_test.go.html#7573012">err</a></span>&nbsp;<span class="op" id="7573956">=</span>&nbsp;<span class="ident" id="7573958"><a href="/gostd/net/smtp/smtp.go.html#5797990">SendMail</a></span><span class="op" id="7573966">(</span><span class="ident" id="7573967"><a href="/gostd/net/smtp/smtp_test.go.html#7573009">l</a></span><span class="op" id="7573968">.</span><span class="ident" id="7573969"><a href="/gostd/net/net.go.html#3340993">Addr</a></span><span class="op" id="7573973">(</span><span class="op" id="7573974">)</span><span class="op" id="7573975">.</span><span class="ident" id="7573976"><a href="/gostd/net/net.go.html#3334238">String</a></span><span class="op" id="7573982">(</span><span class="op" id="7573983">)</span><span class="op" id="7573984">,</span>&nbsp;<span class="builtintype" id="7573986">nil</span><span class="op" id="7573989">,</span>&nbsp;<span class="string" id="7573991">&#34;test@example.com&#34;</span><span class="op" id="7574009">,</span>&nbsp;<span class="op" id="7574011">[</span><span class="op" id="7574012">]</span><span class="builtintype" id="7574013">string</span><span class="op" id="7574019">{</span><span class="string" id="7574020">&#34;other@example.com&#34;</span><span class="op" id="7574039">}</span><span class="op" id="7574040">,</span>&nbsp;<span class="op" id="7574042">[</span><span class="op" id="7574043">]</span><span class="builtintype" id="7574044">byte</span><span class="op" id="7574048">(</span><span class="ident" id="7574049"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7574056">.</span><span class="ident" id="7574057"><a href="/gostd/strings/strings.go.html#2983409">Replace</a></span><span class="op" id="7574064">(</span><span class="string" id="7574065">`From:&nbsp;test@example.com<br>
<span class="lineno"></span>To:&nbsp;other@example.com<br>
<span class="lineno"></span>Subject:&nbsp;SendMail&nbsp;test<br>
<span class="lineno">470</span><br>
<span class="lineno"></span>SendMail&nbsp;is&nbsp;working&nbsp;for&nbsp;me.<br>
<span class="lineno"></span>`</span><span class="op" id="7574164">,</span>&nbsp;<span class="string" id="7574166">&#34;\n&#34;</span><span class="op" id="7574170">,</span>&nbsp;<span class="string" id="7574172">&#34;\r\n&#34;</span><span class="op" id="7574178">,</span>&nbsp;<span class="op" id="7574180">-</span><span class="num" id="7574181">1</span><span class="op" id="7574182">)</span><span class="op" id="7574183">)</span><span class="op" id="7574184">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7574188">if</span>&nbsp;<span class="ident" id="7574191"><a href="/gostd/net/smtp/smtp_test.go.html#7573012">err</a></span>&nbsp;<span class="op" id="7574195">!=</span>&nbsp;<span class="builtintype" id="7574198">nil</span>&nbsp;<span class="op" id="7574202">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7574206"><a href="/gostd/net/smtp/smtp_test.go.html#7572792">t</a></span><span class="op" id="7574207">.</span><span class="ident" id="7574208"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7574214">(</span><span class="string" id="7574215">&#34;%v&#34;</span><span class="op" id="7574219">,</span>&nbsp;<span class="ident" id="7574221"><a href="/gostd/net/smtp/smtp_test.go.html#7573012">err</a></span><span class="op" id="7574224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7574227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7574231">&lt;-</span><span class="ident" id="7574233"><a href="/gostd/net/smtp/smtp_test.go.html#7573180">done</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7574239"><a href="/gostd/net/smtp/smtp_test.go.html#7572972">bcmdbuf</a></span><span class="op" id="7574246">.</span><span class="ident" id="7574247"><a href="/gostd/bufio/bufio.go.html#1367486">Flush</a></span><span class="op" id="7574252">(</span><span class="op" id="7574253">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7574256">actualcmds</span>&nbsp;<span class="op" id="7574267">:=</span>&nbsp;<span class="ident" id="7574270"><a href="/gostd/net/smtp/smtp_test.go.html#7572951">cmdbuf</a></span><span class="op" id="7574276">.</span><span class="ident" id="7574277"><a href="/gostd/bytes/buffer.go.html#1384648">String</a></span><span class="op" id="7574283">(</span><span class="op" id="7574284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7574287">if</span>&nbsp;<span class="ident" id="7574290"><a href="/gostd/net/smtp/smtp_test.go.html#7572878">client</a></span>&nbsp;<span class="op" id="7574297">!=</span>&nbsp;<span class="ident" id="7574300"><a href="/gostd/net/smtp/smtp_test.go.html#7574256">actualcmds</a></span>&nbsp;<span class="op" id="7574311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7574315"><a href="/gostd/net/smtp/smtp_test.go.html#7572792">t</a></span><span class="op" id="7574316">.</span><span class="ident" id="7574317"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7574323">(</span><span class="string" id="7574324">&#34;Got:\n%s\nExpected:\n%s&#34;</span><span class="op" id="7574349">,</span>&nbsp;<span class="ident" id="7574351"><a href="/gostd/net/smtp/smtp_test.go.html#7574256">actualcmds</a></span><span class="op" id="7574361">,</span>&nbsp;<span class="ident" id="7574363"><a href="/gostd/net/smtp/smtp_test.go.html#7572878">client</a></span><span class="op" id="7574369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7574372">}</span><br>
<span class="lineno"></span><span class="op" id="7574374">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="keyword" id="7574377">var</span>&nbsp;<span class="ident" id="7574381">sendMailServer</span>&nbsp;<span class="op" id="7574396">=</span>&nbsp;<span class="string" id="7574398">`220&nbsp;hello&nbsp;world<br>
<span class="lineno"></span>502&nbsp;EH?<br>
<span class="lineno"></span>250&nbsp;mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno"></span>250&nbsp;Sender&nbsp;ok<br>
<span class="lineno">490</span>250&nbsp;Receiver&nbsp;ok<br>
<span class="lineno"></span>354&nbsp;Go&nbsp;ahead<br>
<span class="lineno"></span>250&nbsp;Data&nbsp;ok<br>
<span class="lineno"></span>221&nbsp;Goodbye<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="7574527">var</span>&nbsp;<span class="ident" id="7574531">sendMailClient</span>&nbsp;<span class="op" id="7574546">=</span>&nbsp;<span class="string" id="7574548">`EHLO&nbsp;localhost<br>
<span class="lineno"></span>HELO&nbsp;localhost<br>
<span class="lineno"></span>MAIL&nbsp;FROM:&lt;test@example.com&gt;<br>
<span class="lineno"></span>RCPT&nbsp;TO:&lt;other@example.com&gt;<br>
<span class="lineno">500</span>DATA<br>
<span class="lineno"></span>From:&nbsp;test@example.com<br>
<span class="lineno"></span>To:&nbsp;other@example.com<br>
<span class="lineno"></span>Subject:&nbsp;SendMail&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno">505</span>SendMail&nbsp;is&nbsp;working&nbsp;for&nbsp;me.<br>
<span class="lineno"></span>.<br>
<span class="lineno"></span>QUIT<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span><span class="keyword" id="7574748">func</span>&nbsp;<span class="ident" id="7574753">TestAuthFailed</span><span class="op" id="7574767">(</span><span class="ident" id="7574768">t</span>&nbsp;<span class="op" id="7574770">*</span><span class="ident" id="7574771"><a href="/gostd/net/smtp/smtp_test.go.html#7563152">testing</a></span><span class="op" id="7574778">.</span><span class="ident" id="7574779"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7574780">)</span>&nbsp;<span class="op" id="7574782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7574785">server</span>&nbsp;<span class="op" id="7574792">:=</span>&nbsp;<span class="ident" id="7574795"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7574802">.</span><span class="ident" id="7574803"><a href="/gostd/strings/strings.go.html#2974969">Join</a></span><span class="op" id="7574807">(</span><span class="ident" id="7574808"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7574815">.</span><span class="ident" id="7574816"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7574821">(</span><span class="ident" id="7574822"><a href="/gostd/net/smtp/smtp_test.go.html#7575714">authFailedServer</a></span><span class="op" id="7574838">,</span>&nbsp;<span class="string" id="7574840">&#34;\n&#34;</span><span class="op" id="7574844">)</span><span class="op" id="7574845">,</span>&nbsp;<span class="string" id="7574847">&#34;\r\n&#34;</span><span class="op" id="7574853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7574856">client</span>&nbsp;<span class="op" id="7574863">:=</span>&nbsp;<span class="ident" id="7574866"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7574873">.</span><span class="ident" id="7574874"><a href="/gostd/strings/strings.go.html#2974969">Join</a></span><span class="op" id="7574878">(</span><span class="ident" id="7574879"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7574886">.</span><span class="ident" id="7574887"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7574892">(</span><span class="ident" id="7574893"><a href="/gostd/net/smtp/smtp_test.go.html#7575879">authFailedClient</a></span><span class="op" id="7574909">,</span>&nbsp;<span class="string" id="7574911">&#34;\n&#34;</span><span class="op" id="7574915">)</span><span class="op" id="7574916">,</span>&nbsp;<span class="string" id="7574918">&#34;\r\n&#34;</span><span class="op" id="7574924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7574927">var</span>&nbsp;<span class="ident" id="7574931">cmdbuf</span>&nbsp;<span class="ident" id="7574938"><a href="/gostd/net/smtp/smtp_test.go.html#7563073">bytes</a></span><span class="op" id="7574943">.</span><span class="ident" id="7574944"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7574952">bcmdbuf</span>&nbsp;<span class="op" id="7574960">:=</span>&nbsp;<span class="ident" id="7574963"><a href="/gostd/net/smtp/smtp_test.go.html#7563064">bufio</a></span><span class="op" id="7574968">.</span><span class="ident" id="7574969"><a href="/gostd/bufio/bufio.go.html#1367149">NewWriter</a></span><span class="op" id="7574978">(</span><span class="op" id="7574979">&amp;</span><span class="ident" id="7574980"><a href="/gostd/net/smtp/smtp_test.go.html#7574931">cmdbuf</a></span><span class="op" id="7574986">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7574989">var</span>&nbsp;<span class="ident" id="7574993">fake</span>&nbsp;<span class="ident" id="7574998"><a href="/gostd/net/smtp/smtp_test.go.html#7565238">faker</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7575005"><a href="/gostd/net/smtp/smtp_test.go.html#7574993">fake</a></span><span class="op" id="7575009">.</span><span class="ident" id="7575010"><a href="/gostd/net/smtp/smtp_test.go.html#7565254">ReadWriter</a></span>&nbsp;<span class="op" id="7575021">=</span>&nbsp;<span class="ident" id="7575023"><a href="/gostd/net/smtp/smtp_test.go.html#7563064">bufio</a></span><span class="op" id="7575028">.</span><span class="ident" id="7575029"><a href="/gostd/bufio/bufio.go.html#1371043">NewReadWriter</a></span><span class="op" id="7575042">(</span><span class="ident" id="7575043"><a href="/gostd/net/smtp/smtp_test.go.html#7563064">bufio</a></span><span class="op" id="7575048">.</span><span class="ident" id="7575049"><a href="/gostd/bufio/bufio.go.html#1355792">NewReader</a></span><span class="op" id="7575058">(</span><span class="ident" id="7575059"><a href="/gostd/net/smtp/smtp_test.go.html#7563141">strings</a></span><span class="op" id="7575066">.</span><span class="ident" id="7575067"><a href="/gostd/strings/reader.go.html#2948317">NewReader</a></span><span class="op" id="7575076">(</span><span class="ident" id="7575077"><a href="/gostd/net/smtp/smtp_test.go.html#7574785">server</a></span><span class="op" id="7575083">)</span><span class="op" id="7575084">)</span><span class="op" id="7575085">,</span>&nbsp;<span class="ident" id="7575087"><a href="/gostd/net/smtp/smtp_test.go.html#7574952">bcmdbuf</a></span><span class="op" id="7575094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7575097">c</span><span class="op" id="7575098">,</span>&nbsp;<span class="ident" id="7575100">err</span>&nbsp;<span class="op" id="7575104">:=</span>&nbsp;<span class="ident" id="7575107"><a href="/gostd/net/smtp/smtp.go.html#5791973">NewClient</a></span><span class="op" id="7575116">(</span><span class="ident" id="7575117"><a href="/gostd/net/smtp/smtp_test.go.html#7574993">fake</a></span><span class="op" id="7575121">,</span>&nbsp;<span class="string" id="7575123">&#34;fake.host&#34;</span><span class="op" id="7575134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7575137">if</span>&nbsp;<span class="ident" id="7575140"><a href="/gostd/net/smtp/smtp_test.go.html#7575100">err</a></span>&nbsp;<span class="op" id="7575144">!=</span>&nbsp;<span class="builtintype" id="7575147">nil</span>&nbsp;<span class="op" id="7575151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7575155"><a href="/gostd/net/smtp/smtp_test.go.html#7574768">t</a></span><span class="op" id="7575156">.</span><span class="ident" id="7575157"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7575163">(</span><span class="string" id="7575164">&#34;NewClient:&nbsp;%v&#34;</span><span class="op" id="7575179">,</span>&nbsp;<span class="ident" id="7575181"><a href="/gostd/net/smtp/smtp_test.go.html#7575100">err</a></span><span class="op" id="7575184">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7575187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7575190">defer</span>&nbsp;<span class="ident" id="7575196"><a href="/gostd/net/smtp/smtp_test.go.html#7575097">c</a></span><span class="op" id="7575197">.</span><span class="ident" id="7575198"><a href="/gostd/net/smtp/smtp.go.html#5792300">Close</a></span><span class="op" id="7575203">(</span><span class="op" id="7575204">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7575208"><a href="/gostd/net/smtp/smtp_test.go.html#7575097">c</a></span><span class="op" id="7575209">.</span><span class="ident" id="7575210"><a href="/gostd/net/smtp/smtp.go.html#5791257">tls</a></span>&nbsp;<span class="op" id="7575214">=</span>&nbsp;<span class="builtintype" id="7575216">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7575222"><a href="/gostd/net/smtp/smtp_test.go.html#7575097">c</a></span><span class="op" id="7575223">.</span><span class="ident" id="7575224"><a href="/gostd/net/smtp/smtp.go.html#5791274">serverName</a></span>&nbsp;<span class="op" id="7575235">=</span>&nbsp;<span class="string" id="7575237">&#34;smtp.google.com&#34;</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7575256"><a href="/gostd/net/smtp/smtp_test.go.html#7575100">err</a></span>&nbsp;<span class="op" id="7575260">=</span>&nbsp;<span class="ident" id="7575262"><a href="/gostd/net/smtp/smtp_test.go.html#7575097">c</a></span><span class="op" id="7575263">.</span><span class="ident" id="7575264"><a href="/gostd/net/smtp/smtp.go.html#5795341">Auth</a></span><span class="op" id="7575268">(</span><span class="ident" id="7575269"><a href="/gostd/net/smtp/auth.go.html#5788807">PlainAuth</a></span><span class="op" id="7575278">(</span><span class="string" id="7575279">&#34;&#34;</span><span class="op" id="7575281">,</span>&nbsp;<span class="string" id="7575283">&#34;user&#34;</span><span class="op" id="7575289">,</span>&nbsp;<span class="string" id="7575291">&#34;pass&#34;</span><span class="op" id="7575297">,</span>&nbsp;<span class="string" id="7575299">&#34;smtp.google.com&#34;</span><span class="op" id="7575316">)</span><span class="op" id="7575317">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7575321">if</span>&nbsp;<span class="ident" id="7575324"><a href="/gostd/net/smtp/smtp_test.go.html#7575100">err</a></span>&nbsp;<span class="op" id="7575328">==</span>&nbsp;<span class="builtintype" id="7575331">nil</span>&nbsp;<span class="op" id="7575335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7575339"><a href="/gostd/net/smtp/smtp_test.go.html#7574768">t</a></span><span class="op" id="7575340">.</span><span class="ident" id="7575341"><a href="/gostd/testing/testing.go.html#5479963">Error</a></span><span class="op" id="7575346">(</span><span class="string" id="7575347">&#34;Auth:&nbsp;expected&nbsp;error;&nbsp;got&nbsp;none&#34;</span><span class="op" id="7575379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7575382">}</span>&nbsp;<span class="keyword" id="7575384">else</span>&nbsp;<span class="keyword" id="7575389">if</span>&nbsp;<span class="ident" id="7575392"><a href="/gostd/net/smtp/smtp_test.go.html#7575100">err</a></span><span class="op" id="7575395">.</span><span class="ident" id="7575396">Error</span><span class="op" id="7575401">(</span><span class="op" id="7575402">)</span>&nbsp;<span class="op" id="7575404">!=</span>&nbsp;<span class="string" id="7575407">&#34;535&nbsp;Invalid&nbsp;credentials\nplease&nbsp;see&nbsp;www.example.com&#34;</span>&nbsp;<span class="op" id="7575461">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7575465"><a href="/gostd/net/smtp/smtp_test.go.html#7574768">t</a></span><span class="op" id="7575466">.</span><span class="ident" id="7575467"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7575473">(</span><span class="string" id="7575474">&#34;Auth:&nbsp;got&nbsp;error:&nbsp;%v,&nbsp;want:&nbsp;%s&#34;</span><span class="op" id="7575505">,</span>&nbsp;<span class="ident" id="7575507"><a href="/gostd/net/smtp/smtp_test.go.html#7575100">err</a></span><span class="op" id="7575510">,</span>&nbsp;<span class="string" id="7575512">&#34;535&nbsp;Invalid&nbsp;credentials\nplease&nbsp;see&nbsp;www.example.com&#34;</span><span class="op" id="7575565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7575568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7575572"><a href="/gostd/net/smtp/smtp_test.go.html#7574952">bcmdbuf</a></span><span class="op" id="7575579">.</span><span class="ident" id="7575580"><a href="/gostd/bufio/bufio.go.html#1367486">Flush</a></span><span class="op" id="7575585">(</span><span class="op" id="7575586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7575589">actualcmds</span>&nbsp;<span class="op" id="7575600">:=</span>&nbsp;<span class="ident" id="7575603"><a href="/gostd/net/smtp/smtp_test.go.html#7574931">cmdbuf</a></span><span class="op" id="7575609">.</span><span class="ident" id="7575610"><a href="/gostd/bytes/buffer.go.html#1384648">String</a></span><span class="op" id="7575616">(</span><span class="op" id="7575617">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7575620">if</span>&nbsp;<span class="ident" id="7575623"><a href="/gostd/net/smtp/smtp_test.go.html#7574856">client</a></span>&nbsp;<span class="op" id="7575630">!=</span>&nbsp;<span class="ident" id="7575633"><a href="/gostd/net/smtp/smtp_test.go.html#7575589">actualcmds</a></span>&nbsp;<span class="op" id="7575644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7575648"><a href="/gostd/net/smtp/smtp_test.go.html#7574768">t</a></span><span class="op" id="7575649">.</span><span class="ident" id="7575650"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7575656">(</span><span class="string" id="7575657">&#34;Got:\n%s\nExpected:\n%s&#34;</span><span class="op" id="7575682">,</span>&nbsp;<span class="ident" id="7575684"><a href="/gostd/net/smtp/smtp_test.go.html#7575589">actualcmds</a></span><span class="op" id="7575694">,</span>&nbsp;<span class="ident" id="7575696"><a href="/gostd/net/smtp/smtp_test.go.html#7574856">client</a></span><span class="op" id="7575702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7575705">}</span><br>
<span class="lineno"></span><span class="op" id="7575707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="keyword" id="7575710">var</span>&nbsp;<span class="ident" id="7575714">authFailedServer</span>&nbsp;<span class="op" id="7575731">=</span>&nbsp;<span class="string" id="7575733">`220&nbsp;hello&nbsp;world<br>
<span class="lineno"></span>250-mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno"></span>250&nbsp;AUTH&nbsp;LOGIN&nbsp;PLAIN<br>
<span class="lineno"></span>535-Invalid&nbsp;credentials<br>
<span class="lineno"></span>535&nbsp;please&nbsp;see&nbsp;www.example.com<br>
<span class="lineno">545</span>221&nbsp;Goodbye<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7575875">var</span>&nbsp;<span class="ident" id="7575879">authFailedClient</span>&nbsp;<span class="op" id="7575896">=</span>&nbsp;<span class="string" id="7575898">`EHLO&nbsp;localhost<br>
<span class="lineno"></span>AUTH&nbsp;PLAIN&nbsp;AHVzZXIAcGFzcw==<br>
<span class="lineno">550</span>*<br>
<span class="lineno"></span>QUIT<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7575952">func</span>&nbsp;<span class="ident" id="7575957">TestTLSClient</span><span class="op" id="7575970">(</span><span class="ident" id="7575971">t</span>&nbsp;<span class="op" id="7575973">*</span><span class="ident" id="7575974"><a href="/gostd/net/smtp/smtp_test.go.html#7563152">testing</a></span><span class="op" id="7575981">.</span><span class="ident" id="7575982"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7575983">)</span>&nbsp;<span class="op" id="7575985">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7575988">ln</span>&nbsp;<span class="op" id="7575991">:=</span>&nbsp;<span class="ident" id="7575994"><a href="/gostd/net/smtp/smtp_test.go.html#7576412">newLocalListener</a></span><span class="op" id="7576010">(</span><span class="ident" id="7576011"><a href="/gostd/net/smtp/smtp_test.go.html#7575971">t</a></span><span class="op" id="7576012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7576015">defer</span>&nbsp;<span class="ident" id="7576021"><a href="/gostd/net/smtp/smtp_test.go.html#7575988">ln</a></span><span class="op" id="7576023">.</span><span class="ident" id="7576024"><a href="/gostd/net/net.go.html#3340928">Close</a></span><span class="op" id="7576029">(</span><span class="op" id="7576030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7576033">errc</span>&nbsp;<span class="op" id="7576038">:=</span>&nbsp;<span class="builtinfunc" id="7576041">make</span><span class="op" id="7576045">(</span><span class="keyword" id="7576046">chan</span>&nbsp;<span class="builtintype" id="7576051">error</span><span class="op" id="7576056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7576059">go</span>&nbsp;<span class="keyword" id="7576062">func</span><span class="op" id="7576066">(</span><span class="op" id="7576067">)</span>&nbsp;<span class="op" id="7576069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7576073"><a href="/gostd/net/smtp/smtp_test.go.html#7576033">errc</a></span>&nbsp;<span class="op" id="7576078">&lt;-</span>&nbsp;<span class="ident" id="7576081"><a href="/gostd/net/smtp/smtp_test.go.html#7578301">sendMail</a></span><span class="op" id="7576089">(</span><span class="ident" id="7576090"><a href="/gostd/net/smtp/smtp_test.go.html#7575988">ln</a></span><span class="op" id="7576092">.</span><span class="ident" id="7576093"><a href="/gostd/net/net.go.html#3340993">Addr</a></span><span class="op" id="7576097">(</span><span class="op" id="7576098">)</span><span class="op" id="7576099">.</span><span class="ident" id="7576100"><a href="/gostd/net/net.go.html#3334238">String</a></span><span class="op" id="7576106">(</span><span class="op" id="7576107">)</span><span class="op" id="7576108">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7576111">}</span><span class="op" id="7576112">(</span><span class="op" id="7576113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7576116">conn</span><span class="op" id="7576120">,</span>&nbsp;<span class="ident" id="7576122">err</span>&nbsp;<span class="op" id="7576126">:=</span>&nbsp;<span class="ident" id="7576129"><a href="/gostd/net/smtp/smtp_test.go.html#7575988">ln</a></span><span class="op" id="7576131">.</span><span class="ident" id="7576132"><a href="/gostd/net/net.go.html#3340795">Accept</a></span><span class="op" id="7576138">(</span><span class="op" id="7576139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7576142">if</span>&nbsp;<span class="ident" id="7576145"><a href="/gostd/net/smtp/smtp_test.go.html#7576122">err</a></span>&nbsp;<span class="op" id="7576149">!=</span>&nbsp;<span class="builtintype" id="7576152">nil</span>&nbsp;<span class="op" id="7576156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7576160"><a href="/gostd/net/smtp/smtp_test.go.html#7575971">t</a></span><span class="op" id="7576161">.</span><span class="ident" id="7576162"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7576168">(</span><span class="string" id="7576169">&#34;failed&nbsp;to&nbsp;accept&nbsp;connection:&nbsp;%v&#34;</span><span class="op" id="7576202">,</span>&nbsp;<span class="ident" id="7576204"><a href="/gostd/net/smtp/smtp_test.go.html#7576122">err</a></span><span class="op" id="7576207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7576210">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7576213">defer</span>&nbsp;<span class="ident" id="7576219"><a href="/gostd/net/smtp/smtp_test.go.html#7576116">conn</a></span><span class="op" id="7576223">.</span><span class="ident" id="7576224"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="7576229">(</span><span class="op" id="7576230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7576233">if</span>&nbsp;<span class="ident" id="7576236">err</span>&nbsp;<span class="op" id="7576240">:=</span>&nbsp;<span class="ident" id="7576243"><a href="/gostd/net/smtp/smtp_test.go.html#7576797">serverHandle</a></span><span class="op" id="7576255">(</span><span class="ident" id="7576256"><a href="/gostd/net/smtp/smtp_test.go.html#7576116">conn</a></span><span class="op" id="7576260">,</span>&nbsp;<span class="ident" id="7576262"><a href="/gostd/net/smtp/smtp_test.go.html#7575971">t</a></span><span class="op" id="7576263">)</span><span class="op" id="7576264">;</span>&nbsp;<span class="ident" id="7576266"><a href="/gostd/net/smtp/smtp_test.go.html#7576236">err</a></span>&nbsp;<span class="op" id="7576270">!=</span>&nbsp;<span class="builtintype" id="7576273">nil</span>&nbsp;<span class="op" id="7576277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7576281"><a href="/gostd/net/smtp/smtp_test.go.html#7575971">t</a></span><span class="op" id="7576282">.</span><span class="ident" id="7576283"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7576289">(</span><span class="string" id="7576290">&#34;failed&nbsp;to&nbsp;handle&nbsp;connection:&nbsp;%v&#34;</span><span class="op" id="7576323">,</span>&nbsp;<span class="ident" id="7576325"><a href="/gostd/net/smtp/smtp_test.go.html#7576236">err</a></span><span class="op" id="7576328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7576331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7576334">if</span>&nbsp;<span class="ident" id="7576337">err</span>&nbsp;<span class="op" id="7576341">:=</span>&nbsp;<span class="op" id="7576344">&lt;-</span><span class="ident" id="7576346"><a href="/gostd/net/smtp/smtp_test.go.html#7576033">errc</a></span><span class="op" id="7576350">;</span>&nbsp;<span class="ident" id="7576352"><a href="/gostd/net/smtp/smtp_test.go.html#7576337">err</a></span>&nbsp;<span class="op" id="7576356">!=</span>&nbsp;<span class="builtintype" id="7576359">nil</span>&nbsp;<span class="op" id="7576363">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7576367"><a href="/gostd/net/smtp/smtp_test.go.html#7575971">t</a></span><span class="op" id="7576368">.</span><span class="ident" id="7576369"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7576375">(</span><span class="string" id="7576376">&#34;client&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7576394">,</span>&nbsp;<span class="ident" id="7576396"><a href="/gostd/net/smtp/smtp_test.go.html#7576337">err</a></span><span class="op" id="7576399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7576402">}</span><br>
<span class="lineno"></span><span class="op" id="7576404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7576407">func</span>&nbsp;<span class="ident" id="7576412">newLocalListener</span><span class="op" id="7576428">(</span><span class="ident" id="7576429">t</span>&nbsp;<span class="op" id="7576431">*</span><span class="ident" id="7576432"><a href="/gostd/net/smtp/smtp_test.go.html#7563152">testing</a></span><span class="op" id="7576439">.</span><span class="ident" id="7576440"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7576441">)</span>&nbsp;<span class="ident" id="7576443"><a href="/gostd/net/smtp/smtp_test.go.html#7563117">net</a></span><span class="op" id="7576446">.</span><span class="ident" id="7576447"><a href="/gostd/net/net.go.html#3340703">Listener</a></span>&nbsp;<span class="op" id="7576456">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7576459">ln</span><span class="op" id="7576461">,</span>&nbsp;<span class="ident" id="7576463">err</span>&nbsp;<span class="op" id="7576467">:=</span>&nbsp;<span class="ident" id="7576470"><a href="/gostd/net/smtp/smtp_test.go.html#7563117">net</a></span><span class="op" id="7576473">.</span><span class="ident" id="7576474"><a href="/gostd/net/dial.go.html#3207117">Listen</a></span><span class="op" id="7576480">(</span><span class="string" id="7576481">&#34;tcp&#34;</span><span class="op" id="7576486">,</span>&nbsp;<span class="string" id="7576488">&#34;127.0.0.1:0&#34;</span><span class="op" id="7576501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7576504">if</span>&nbsp;<span class="ident" id="7576507"><a href="/gostd/net/smtp/smtp_test.go.html#7576463">err</a></span>&nbsp;<span class="op" id="7576511">!=</span>&nbsp;<span class="builtintype" id="7576514">nil</span>&nbsp;<span class="op" id="7576518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7576522"><a href="/gostd/net/smtp/smtp_test.go.html#7576459">ln</a></span><span class="op" id="7576524">,</span>&nbsp;<span class="ident" id="7576526"><a href="/gostd/net/smtp/smtp_test.go.html#7576463">err</a></span>&nbsp;<span class="op" id="7576530">=</span>&nbsp;<span class="ident" id="7576532"><a href="/gostd/net/smtp/smtp_test.go.html#7563117">net</a></span><span class="op" id="7576535">.</span><span class="ident" id="7576536"><a href="/gostd/net/dial.go.html#3207117">Listen</a></span><span class="op" id="7576542">(</span><span class="string" id="7576543">&#34;tcp6&#34;</span><span class="op" id="7576549">,</span>&nbsp;<span class="string" id="7576551">&#34;[::1]:0&#34;</span><span class="op" id="7576560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7576563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7576566">if</span>&nbsp;<span class="ident" id="7576569"><a href="/gostd/net/smtp/smtp_test.go.html#7576463">err</a></span>&nbsp;<span class="op" id="7576573">!=</span>&nbsp;<span class="builtintype" id="7576576">nil</span>&nbsp;<span class="op" id="7576580">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7576584"><a href="/gostd/net/smtp/smtp_test.go.html#7576429">t</a></span><span class="op" id="7576585">.</span><span class="ident" id="7576586"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="7576591">(</span><span class="ident" id="7576592"><a href="/gostd/net/smtp/smtp_test.go.html#7576463">err</a></span><span class="op" id="7576595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7576598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7576601">return</span>&nbsp;<span class="ident" id="7576608"><a href="/gostd/net/smtp/smtp_test.go.html#7576459">ln</a></span><br>
<span class="lineno"></span><span class="op" id="7576611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="keyword" id="7576614">type</span>&nbsp;<span class="ident" id="7576619">smtpSender</span>&nbsp;<span class="keyword" id="7576630">struct</span>&nbsp;<span class="op" id="7576637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7576640">w</span>&nbsp;<span class="ident" id="7576642"><a href="/gostd/net/smtp/smtp_test.go.html#7563111">io</a></span><span class="op" id="7576644">.</span><span class="ident" id="7576645"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><br>
<span class="lineno"></span><span class="op" id="7576652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7576655">func</span>&nbsp;<span class="op" id="7576660">(</span><span class="ident" id="7576661">s</span>&nbsp;<span class="ident" id="7576663"><a href="/gostd/net/smtp/smtp_test.go.html#7576619">smtpSender</a></span><span class="op" id="7576673">)</span>&nbsp;<span class="ident" id="7576675">send</span><span class="op" id="7576679">(</span><span class="ident" id="7576680">f</span>&nbsp;<span class="builtintype" id="7576682">string</span><span class="op" id="7576688">)</span>&nbsp;<span class="op" id="7576690">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7576693"><a href="/gostd/net/smtp/smtp_test.go.html#7576661">s</a></span><span class="op" id="7576694">.</span><span class="ident" id="7576695"><a href="/gostd/net/smtp/smtp_test.go.html#7576640">w</a></span><span class="op" id="7576696">.</span><span class="ident" id="7576697"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="7576702">(</span><span class="op" id="7576703">[</span><span class="op" id="7576704">]</span><span class="builtintype" id="7576705">byte</span><span class="op" id="7576709">(</span><span class="ident" id="7576710"><a href="/gostd/net/smtp/smtp_test.go.html#7576680">f</a></span>&nbsp;<span class="op" id="7576712">+</span>&nbsp;<span class="string" id="7576714">&#34;\r\n&#34;</span><span class="op" id="7576720">)</span><span class="op" id="7576721">)</span><br>
<span class="lineno"></span><span class="op" id="7576723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7576726">//&nbsp;smtp&nbsp;server,&nbsp;finely&nbsp;tailored&nbsp;to&nbsp;deal&nbsp;with&nbsp;our&nbsp;own&nbsp;client&nbsp;only!</span><br>
<span class="lineno"></span><span class="keyword" id="7576792">func</span>&nbsp;<span class="ident" id="7576797">serverHandle</span><span class="op" id="7576809">(</span><span class="ident" id="7576810">c</span>&nbsp;<span class="ident" id="7576812"><a href="/gostd/net/smtp/smtp_test.go.html#7563117">net</a></span><span class="op" id="7576815">.</span><span class="ident" id="7576816"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="7576820">,</span>&nbsp;<span class="ident" id="7576822">t</span>&nbsp;<span class="op" id="7576824">*</span><span class="ident" id="7576825"><a href="/gostd/net/smtp/smtp_test.go.html#7563152">testing</a></span><span class="op" id="7576832">.</span><span class="ident" id="7576833"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7576834">)</span>&nbsp;<span class="builtintype" id="7576836">error</span>&nbsp;<span class="op" id="7576842">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7576845">send</span>&nbsp;<span class="op" id="7576850">:=</span>&nbsp;<span class="ident" id="7576853"><a href="/gostd/net/smtp/smtp_test.go.html#7576619">smtpSender</a></span><span class="op" id="7576863">{</span><span class="ident" id="7576864"><a href="/gostd/net/smtp/smtp_test.go.html#7576810">c</a></span><span class="op" id="7576865">}</span><span class="op" id="7576866">.</span><span class="ident" id="7576867"><a href="/gostd/net/smtp/smtp_test.go.html#7576675">send</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7576873"><a href="/gostd/net/smtp/smtp_test.go.html#7576845">send</a></span><span class="op" id="7576877">(</span><span class="string" id="7576878">&#34;220&nbsp;127.0.0.1&nbsp;ESMTP&nbsp;service&nbsp;ready&#34;</span><span class="op" id="7576913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7576916">s</span>&nbsp;<span class="op" id="7576918">:=</span>&nbsp;<span class="ident" id="7576921"><a href="/gostd/net/smtp/smtp_test.go.html#7563064">bufio</a></span><span class="op" id="7576926">.</span><span class="ident" id="7576927"><a href="/gostd/bufio/scan.go.html#1374479">NewScanner</a></span><span class="op" id="7576937">(</span><span class="ident" id="7576938"><a href="/gostd/net/smtp/smtp_test.go.html#7576810">c</a></span><span class="op" id="7576939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7576942">for</span>&nbsp;<span class="ident" id="7576946"><a href="/gostd/net/smtp/smtp_test.go.html#7576916">s</a></span><span class="op" id="7576947">.</span><span class="ident" id="7576948"><a href="/gostd/bufio/scan.go.html#1375802">Scan</a></span><span class="op" id="7576952">(</span><span class="op" id="7576953">)</span>&nbsp;<span class="op" id="7576955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7576959">switch</span>&nbsp;<span class="ident" id="7576966"><a href="/gostd/net/smtp/smtp_test.go.html#7576916">s</a></span><span class="op" id="7576967">.</span><span class="ident" id="7576968"><a href="/gostd/bufio/scan.go.html#1375242">Text</a></span><span class="op" id="7576972">(</span><span class="op" id="7576973">)</span>&nbsp;<span class="op" id="7576975">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7576979">case</span>&nbsp;<span class="string" id="7576984">&#34;EHLO&nbsp;localhost&#34;</span><span class="op" id="7577000">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7577005"><a href="/gostd/net/smtp/smtp_test.go.html#7576845">send</a></span><span class="op" id="7577009">(</span><span class="string" id="7577010">&#34;250-127.0.0.1&nbsp;ESMTP&nbsp;offers&nbsp;a&nbsp;warm&nbsp;hug&nbsp;of&nbsp;welcome&#34;</span><span class="op" id="7577060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7577065"><a href="/gostd/net/smtp/smtp_test.go.html#7576845">send</a></span><span class="op" id="7577069">(</span><span class="string" id="7577070">&#34;250-STARTTLS&#34;</span><span class="op" id="7577084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7577089"><a href="/gostd/net/smtp/smtp_test.go.html#7576845">send</a></span><span class="op" id="7577093">(</span><span class="string" id="7577094">&#34;250&nbsp;Ok&#34;</span><span class="op" id="7577102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7577106">case</span>&nbsp;<span class="string" id="7577111">&#34;STARTTLS&#34;</span><span class="op" id="7577121">:</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7577126"><a href="/gostd/net/smtp/smtp_test.go.html#7576845">send</a></span><span class="op" id="7577130">(</span><span class="string" id="7577131">&#34;220&nbsp;Go&nbsp;ahead&#34;</span><span class="op" id="7577145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7577150">keypair</span><span class="op" id="7577157">,</span>&nbsp;<span class="ident" id="7577159">err</span>&nbsp;<span class="op" id="7577163">:=</span>&nbsp;<span class="ident" id="7577166"><a href="/gostd/net/smtp/smtp_test.go.html#7563082">tls</a></span><span class="op" id="7577169">.</span><span class="ident" id="7577170"><a href="/gostd/crypto/tls/tls.go.html#4588297">X509KeyPair</a></span><span class="op" id="7577181">(</span><span class="ident" id="7577182"><a href="/gostd/net/smtp/smtp_test.go.html#7578952">localhostCert</a></span><span class="op" id="7577195">,</span>&nbsp;<span class="ident" id="7577197"><a href="/gostd/net/smtp/smtp_test.go.html#7579607">localhostKey</a></span><span class="op" id="7577209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7577214">if</span>&nbsp;<span class="ident" id="7577217"><a href="/gostd/net/smtp/smtp_test.go.html#7577159">err</a></span>&nbsp;<span class="op" id="7577221">!=</span>&nbsp;<span class="builtintype" id="7577224">nil</span>&nbsp;<span class="op" id="7577228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7577234">return</span>&nbsp;<span class="ident" id="7577241"><a href="/gostd/net/smtp/smtp_test.go.html#7577159">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7577248">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7577253">config</span>&nbsp;<span class="op" id="7577260">:=</span>&nbsp;<span class="op" id="7577263">&amp;</span><span class="ident" id="7577264"><a href="/gostd/net/smtp/smtp_test.go.html#7563082">tls</a></span><span class="op" id="7577267">.</span><span class="ident" id="7577268"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="7577274">{</span><span class="ident" id="7577275"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="7577287">:</span>&nbsp;<span class="op" id="7577289">[</span><span class="op" id="7577290">]</span><span class="ident" id="7577291"><a href="/gostd/net/smtp/smtp_test.go.html#7563082">tls</a></span><span class="op" id="7577294">.</span><span class="ident" id="7577295"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><span class="op" id="7577306">{</span><span class="ident" id="7577307"><a href="/gostd/net/smtp/smtp_test.go.html#7577150">keypair</a></span><span class="op" id="7577314">}</span><span class="op" id="7577315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7577320"><a href="/gostd/net/smtp/smtp_test.go.html#7576810">c</a></span>&nbsp;<span class="op" id="7577322">=</span>&nbsp;<span class="ident" id="7577324"><a href="/gostd/net/smtp/smtp_test.go.html#7563082">tls</a></span><span class="op" id="7577327">.</span><span class="ident" id="7577328"><a href="/gostd/crypto/tls/tls.go.html#4583744">Server</a></span><span class="op" id="7577334">(</span><span class="ident" id="7577335"><a href="/gostd/net/smtp/smtp_test.go.html#7576810">c</a></span><span class="op" id="7577336">,</span>&nbsp;<span class="ident" id="7577338"><a href="/gostd/net/smtp/smtp_test.go.html#7577253">config</a></span><span class="op" id="7577344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7577349">defer</span>&nbsp;<span class="ident" id="7577355"><a href="/gostd/net/smtp/smtp_test.go.html#7576810">c</a></span><span class="op" id="7577356">.</span><span class="ident" id="7577357"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="7577362">(</span><span class="op" id="7577363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7577368">return</span>&nbsp;<span class="ident" id="7577375"><a href="/gostd/net/smtp/smtp_test.go.html#7577489">serverHandleTLS</a></span><span class="op" id="7577390">(</span><span class="ident" id="7577391"><a href="/gostd/net/smtp/smtp_test.go.html#7576810">c</a></span><span class="op" id="7577392">,</span>&nbsp;<span class="ident" id="7577394"><a href="/gostd/net/smtp/smtp_test.go.html#7576822">t</a></span><span class="op" id="7577395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7577399">default</span><span class="op" id="7577406">:</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7577411"><a href="/gostd/net/smtp/smtp_test.go.html#7576822">t</a></span><span class="op" id="7577412">.</span><span class="ident" id="7577413"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7577419">(</span><span class="string" id="7577420">&#34;unrecognized&nbsp;command:&nbsp;%q&#34;</span><span class="op" id="7577446">,</span>&nbsp;<span class="ident" id="7577448"><a href="/gostd/net/smtp/smtp_test.go.html#7576916">s</a></span><span class="op" id="7577449">.</span><span class="ident" id="7577450"><a href="/gostd/bufio/scan.go.html#1375242">Text</a></span><span class="op" id="7577454">(</span><span class="op" id="7577455">)</span><span class="op" id="7577456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7577460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7577463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7577466">return</span>&nbsp;<span class="ident" id="7577473"><a href="/gostd/net/smtp/smtp_test.go.html#7576916">s</a></span><span class="op" id="7577474">.</span><span class="ident" id="7577475"><a href="/gostd/bufio/scan.go.html#1374794">Err</a></span><span class="op" id="7577478">(</span><span class="op" id="7577479">)</span><br>
<span class="lineno"></span><span class="op" id="7577481">}</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span><span class="keyword" id="7577484">func</span>&nbsp;<span class="ident" id="7577489">serverHandleTLS</span><span class="op" id="7577504">(</span><span class="ident" id="7577505">c</span>&nbsp;<span class="ident" id="7577507"><a href="/gostd/net/smtp/smtp_test.go.html#7563117">net</a></span><span class="op" id="7577510">.</span><span class="ident" id="7577511"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="7577515">,</span>&nbsp;<span class="ident" id="7577517">t</span>&nbsp;<span class="op" id="7577519">*</span><span class="ident" id="7577520"><a href="/gostd/net/smtp/smtp_test.go.html#7563152">testing</a></span><span class="op" id="7577527">.</span><span class="ident" id="7577528"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7577529">)</span>&nbsp;<span class="builtintype" id="7577531">error</span>&nbsp;<span class="op" id="7577537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7577540">send</span>&nbsp;<span class="op" id="7577545">:=</span>&nbsp;<span class="ident" id="7577548"><a href="/gostd/net/smtp/smtp_test.go.html#7576619">smtpSender</a></span><span class="op" id="7577558">{</span><span class="ident" id="7577559"><a href="/gostd/net/smtp/smtp_test.go.html#7577505">c</a></span><span class="op" id="7577560">}</span><span class="op" id="7577561">.</span><span class="ident" id="7577562"><a href="/gostd/net/smtp/smtp_test.go.html#7576675">send</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7577568">s</span>&nbsp;<span class="op" id="7577570">:=</span>&nbsp;<span class="ident" id="7577573"><a href="/gostd/net/smtp/smtp_test.go.html#7563064">bufio</a></span><span class="op" id="7577578">.</span><span class="ident" id="7577579"><a href="/gostd/bufio/scan.go.html#1374479">NewScanner</a></span><span class="op" id="7577589">(</span><span class="ident" id="7577590"><a href="/gostd/net/smtp/smtp_test.go.html#7577505">c</a></span><span class="op" id="7577591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7577594">for</span>&nbsp;<span class="ident" id="7577598"><a href="/gostd/net/smtp/smtp_test.go.html#7577568">s</a></span><span class="op" id="7577599">.</span><span class="ident" id="7577600"><a href="/gostd/bufio/scan.go.html#1375802">Scan</a></span><span class="op" id="7577604">(</span><span class="op" id="7577605">)</span>&nbsp;<span class="op" id="7577607">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7577611">switch</span>&nbsp;<span class="ident" id="7577618"><a href="/gostd/net/smtp/smtp_test.go.html#7577568">s</a></span><span class="op" id="7577619">.</span><span class="ident" id="7577620"><a href="/gostd/bufio/scan.go.html#1375242">Text</a></span><span class="op" id="7577624">(</span><span class="op" id="7577625">)</span>&nbsp;<span class="op" id="7577627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7577631">case</span>&nbsp;<span class="string" id="7577636">&#34;EHLO&nbsp;localhost&#34;</span><span class="op" id="7577652">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7577657"><a href="/gostd/net/smtp/smtp_test.go.html#7577540">send</a></span><span class="op" id="7577661">(</span><span class="string" id="7577662">&#34;250&nbsp;Ok&#34;</span><span class="op" id="7577670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7577674">case</span>&nbsp;<span class="string" id="7577679">&#34;MAIL&nbsp;FROM:&lt;joe1@example.com&gt;&#34;</span><span class="op" id="7577709">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7577714"><a href="/gostd/net/smtp/smtp_test.go.html#7577540">send</a></span><span class="op" id="7577718">(</span><span class="string" id="7577719">&#34;250&nbsp;Ok&#34;</span><span class="op" id="7577727">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7577731">case</span>&nbsp;<span class="string" id="7577736">&#34;RCPT&nbsp;TO:&lt;joe2@example.com&gt;&#34;</span><span class="op" id="7577764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7577769"><a href="/gostd/net/smtp/smtp_test.go.html#7577540">send</a></span><span class="op" id="7577773">(</span><span class="string" id="7577774">&#34;250&nbsp;Ok&#34;</span><span class="op" id="7577782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7577786">case</span>&nbsp;<span class="string" id="7577791">&#34;DATA&#34;</span><span class="op" id="7577797">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7577802"><a href="/gostd/net/smtp/smtp_test.go.html#7577540">send</a></span><span class="op" id="7577806">(</span><span class="string" id="7577807">&#34;354&nbsp;send&nbsp;the&nbsp;mail&nbsp;data,&nbsp;end&nbsp;with&nbsp;.&#34;</span><span class="op" id="7577843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7577848"><a href="/gostd/net/smtp/smtp_test.go.html#7577540">send</a></span><span class="op" id="7577852">(</span><span class="string" id="7577853">&#34;250&nbsp;Ok&#34;</span><span class="op" id="7577861">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7577865">case</span>&nbsp;<span class="string" id="7577870">&#34;Subject:&nbsp;test&#34;</span><span class="op" id="7577885">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7577889">case</span>&nbsp;<span class="string" id="7577894">&#34;&#34;</span><span class="op" id="7577896">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7577900">case</span>&nbsp;<span class="string" id="7577905">&#34;howdy!&#34;</span><span class="op" id="7577913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7577917">case</span>&nbsp;<span class="string" id="7577922">&#34;.&#34;</span><span class="op" id="7577925">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7577929">case</span>&nbsp;<span class="string" id="7577934">&#34;QUIT&#34;</span><span class="op" id="7577940">:</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7577945"><a href="/gostd/net/smtp/smtp_test.go.html#7577540">send</a></span><span class="op" id="7577949">(</span><span class="string" id="7577950">&#34;221&nbsp;127.0.0.1&nbsp;Service&nbsp;closing&nbsp;transmission&nbsp;channel&#34;</span><span class="op" id="7578002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7578007">return</span>&nbsp;<span class="builtintype" id="7578014">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7578020">default</span><span class="op" id="7578027">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7578032"><a href="/gostd/net/smtp/smtp_test.go.html#7577517">t</a></span><span class="op" id="7578033">.</span><span class="ident" id="7578034"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7578040">(</span><span class="string" id="7578041">&#34;unrecognized&nbsp;command&nbsp;during&nbsp;TLS:&nbsp;%q&#34;</span><span class="op" id="7578078">,</span>&nbsp;<span class="ident" id="7578080"><a href="/gostd/net/smtp/smtp_test.go.html#7577568">s</a></span><span class="op" id="7578081">.</span><span class="ident" id="7578082"><a href="/gostd/bufio/scan.go.html#1375242">Text</a></span><span class="op" id="7578086">(</span><span class="op" id="7578087">)</span><span class="op" id="7578088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7578092">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7578095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7578098">return</span>&nbsp;<span class="ident" id="7578105"><a href="/gostd/net/smtp/smtp_test.go.html#7577568">s</a></span><span class="op" id="7578106">.</span><span class="ident" id="7578107"><a href="/gostd/bufio/scan.go.html#1374794">Err</a></span><span class="op" id="7578110">(</span><span class="op" id="7578111">)</span><br>
<span class="lineno"></span><span class="op" id="7578113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7578116">func</span>&nbsp;<span class="ident" id="7578121">init</span><span class="op" id="7578125">(</span><span class="op" id="7578126">)</span>&nbsp;<span class="op" id="7578128">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7578131">testRootCAs</span>&nbsp;<span class="op" id="7578143">:=</span>&nbsp;<span class="ident" id="7578146"><a href="/gostd/net/smtp/smtp_test.go.html#7563096">x509</a></span><span class="op" id="7578150">.</span><span class="ident" id="7578151"><a href="/gostd/crypto/x509/cert_pool.go.html#4613595">NewCertPool</a></span><span class="op" id="7578162">(</span><span class="op" id="7578163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7578166"><a href="/gostd/net/smtp/smtp_test.go.html#7578131">testRootCAs</a></span><span class="op" id="7578177">.</span><span class="ident" id="7578178"><a href="/gostd/crypto/x509/cert_pool.go.html#4615359">AppendCertsFromPEM</a></span><span class="op" id="7578196">(</span><span class="ident" id="7578197"><a href="/gostd/net/smtp/smtp_test.go.html#7578952">localhostCert</a></span><span class="op" id="7578210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7578213"><a href="/gostd/net/smtp/smtp.go.html#5797707">testHookStartTLS</a></span>&nbsp;<span class="op" id="7578230">=</span>&nbsp;<span class="keyword" id="7578232">func</span><span class="op" id="7578236">(</span><span class="ident" id="7578237">config</span>&nbsp;<span class="op" id="7578244">*</span><span class="ident" id="7578245"><a href="/gostd/net/smtp/smtp_test.go.html#7563082">tls</a></span><span class="op" id="7578248">.</span><span class="ident" id="7578249"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="7578255">)</span>&nbsp;<span class="op" id="7578257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7578261"><a href="/gostd/net/smtp/smtp_test.go.html#7578237">config</a></span><span class="op" id="7578267">.</span><span class="ident" id="7578268"><a href="/gostd/crypto/tls/common.go.html#4451971">RootCAs</a></span>&nbsp;<span class="op" id="7578276">=</span>&nbsp;<span class="ident" id="7578278"><a href="/gostd/net/smtp/smtp_test.go.html#7578131">testRootCAs</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7578291">}</span><br>
<span class="lineno">655</span><span class="op" id="7578293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7578296">func</span>&nbsp;<span class="ident" id="7578301">sendMail</span><span class="op" id="7578309">(</span><span class="ident" id="7578310">hostPort</span>&nbsp;<span class="builtintype" id="7578319">string</span><span class="op" id="7578325">)</span>&nbsp;<span class="builtintype" id="7578327">error</span>&nbsp;<span class="op" id="7578333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7578336">host</span><span class="op" id="7578340">,</span>&nbsp;<span class="ident" id="7578342">_</span><span class="op" id="7578343">,</span>&nbsp;<span class="ident" id="7578345">err</span>&nbsp;<span class="op" id="7578349">:=</span>&nbsp;<span class="ident" id="7578352"><a href="/gostd/net/smtp/smtp_test.go.html#7563117">net</a></span><span class="op" id="7578355">.</span><span class="ident" id="7578356"><a href="/gostd/net/ipsock.go.html#3313208">SplitHostPort</a></span><span class="op" id="7578369">(</span><span class="ident" id="7578370"><a href="/gostd/net/smtp/smtp_test.go.html#7578310">hostPort</a></span><span class="op" id="7578378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7578381">if</span>&nbsp;<span class="ident" id="7578384"><a href="/gostd/net/smtp/smtp_test.go.html#7578345">err</a></span>&nbsp;<span class="op" id="7578388">!=</span>&nbsp;<span class="builtintype" id="7578391">nil</span>&nbsp;<span class="op" id="7578395">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7578399">return</span>&nbsp;<span class="ident" id="7578406"><a href="/gostd/net/smtp/smtp_test.go.html#7578345">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7578411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7578414">auth</span>&nbsp;<span class="op" id="7578419">:=</span>&nbsp;<span class="ident" id="7578422"><a href="/gostd/net/smtp/auth.go.html#5788807">PlainAuth</a></span><span class="op" id="7578431">(</span><span class="string" id="7578432">&#34;&#34;</span><span class="op" id="7578434">,</span>&nbsp;<span class="string" id="7578436">&#34;&#34;</span><span class="op" id="7578438">,</span>&nbsp;<span class="string" id="7578440">&#34;&#34;</span><span class="op" id="7578442">,</span>&nbsp;<span class="ident" id="7578444"><a href="/gostd/net/smtp/smtp_test.go.html#7578336">host</a></span><span class="op" id="7578448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7578451">from</span>&nbsp;<span class="op" id="7578456">:=</span>&nbsp;<span class="string" id="7578459">&#34;joe1@example.com&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7578479">to</span>&nbsp;<span class="op" id="7578482">:=</span>&nbsp;<span class="op" id="7578485">[</span><span class="op" id="7578486">]</span><span class="builtintype" id="7578487">string</span><span class="op" id="7578493">{</span><span class="string" id="7578494">&#34;joe2@example.com&#34;</span><span class="op" id="7578512">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7578515">return</span>&nbsp;<span class="ident" id="7578522"><a href="/gostd/net/smtp/smtp.go.html#5797990">SendMail</a></span><span class="op" id="7578530">(</span><span class="ident" id="7578531"><a href="/gostd/net/smtp/smtp_test.go.html#7578310">hostPort</a></span><span class="op" id="7578539">,</span>&nbsp;<span class="ident" id="7578541"><a href="/gostd/net/smtp/smtp_test.go.html#7578414">auth</a></span><span class="op" id="7578545">,</span>&nbsp;<span class="ident" id="7578547"><a href="/gostd/net/smtp/smtp_test.go.html#7578451">from</a></span><span class="op" id="7578551">,</span>&nbsp;<span class="ident" id="7578553"><a href="/gostd/net/smtp/smtp_test.go.html#7578479">to</a></span><span class="op" id="7578555">,</span>&nbsp;<span class="op" id="7578557">[</span><span class="op" id="7578558">]</span><span class="builtintype" id="7578559">byte</span><span class="op" id="7578563">(</span><span class="string" id="7578564">&#34;Subject:&nbsp;test\n\nhowdy!&#34;</span><span class="op" id="7578589">)</span><span class="op" id="7578590">)</span><br>
<span class="lineno"></span><span class="op" id="7578592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7578595">//&nbsp;(copied&nbsp;from&nbsp;net/http/httptest)</span><br>
<span class="lineno"></span><span class="comment" id="7578630">//&nbsp;localhostCert&nbsp;is&nbsp;a&nbsp;PEM-encoded&nbsp;TLS&nbsp;cert&nbsp;with&nbsp;SAN&nbsp;IPs</span><br>
<span class="lineno">670</span><span class="comment" id="7578686">//&nbsp;&#34;127.0.0.1&#34;&nbsp;and&nbsp;&#34;[::1]&#34;,&nbsp;expiring&nbsp;at&nbsp;the&nbsp;last&nbsp;second&nbsp;of&nbsp;2049&nbsp;(the&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="7578759">//&nbsp;of&nbsp;ASN.1&nbsp;time).</span><br>
<span class="lineno"></span><span class="comment" id="7578778">//&nbsp;generated&nbsp;from&nbsp;src/crypto/tls:</span><br>
<span class="lineno"></span><span class="comment" id="7578812">//&nbsp;go&nbsp;run&nbsp;generate_cert.go&nbsp;&nbsp;--rsa-bits&nbsp;512&nbsp;--host&nbsp;127.0.0.1,::1,example.com&nbsp;--ca&nbsp;--start-date&nbsp;&#34;Jan&nbsp;1&nbsp;00:00:00&nbsp;1970&#34;&nbsp;--duration=1000000h</span><br>
<span class="lineno"></span><span class="keyword" id="7578948">var</span>&nbsp;<span class="ident" id="7578952">localhostCert</span>&nbsp;<span class="op" id="7578966">=</span>&nbsp;<span class="op" id="7578968">[</span><span class="op" id="7578969">]</span><span class="builtintype" id="7578970">byte</span><span class="op" id="7578974">(</span><span class="string" id="7578975">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno">675</span>MIIBdzCCASOgAwIBAgIBADALBgkqhkiG9w0BAQUwEjEQMA4GA1UEChMHQWNtZSBD<br>
<span class="lineno"></span>bzAeFw03MDAxMDEwMDAwMDBaFw00OTEyMzEyMzU5NTlaMBIxEDAOBgNVBAoTB0Fj<br>
<span class="lineno"></span>bWUgQ28wWjALBgkqhkiG9w0BAQEDSwAwSAJBAN55NcYKZeInyTuhcCwFMhDHCmwa<br>
<span class="lineno"></span>IUSdtXdcbItRB/yfXGBhiex00IaLXQnSU+QZPRZWYqeTEbFSgihqi1PUDy8CAwEA<br>
<span class="lineno"></span>AaNoMGYwDgYDVR0PAQH/BAQDAgCkMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA8GA1Ud<br>
<span class="lineno">680</span>EwEB/wQFMAMBAf8wLgYDVR0RBCcwJYILZXhhbXBsZS5jb22HBH8AAAGHEAAAAAAA<br>
<span class="lineno"></span>AAAAAAAAAAAAAAEwCwYJKoZIhvcNAQEFA0EAAoQn/ytgqpiLcZu9XKbCJsJcvkgk<br>
<span class="lineno"></span>Se6AbGXgSlq+ZCEVo0qIwSgeBqmsJxUu7NCSOwVJLYNEBO2DtIxoYVk+MA==<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----`</span><span class="op" id="7579546">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span><span class="comment" id="7579549">//&nbsp;localhostKey&nbsp;is&nbsp;the&nbsp;private&nbsp;key&nbsp;for&nbsp;localhostCert.</span><br>
<span class="lineno"></span><span class="keyword" id="7579603">var</span>&nbsp;<span class="ident" id="7579607">localhostKey</span>&nbsp;<span class="op" id="7579620">=</span>&nbsp;<span class="op" id="7579622">[</span><span class="op" id="7579623">]</span><span class="builtintype" id="7579624">byte</span><span class="op" id="7579628">(</span><span class="string" id="7579629">`-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIIBPAIBAAJBAN55NcYKZeInyTuhcCwFMhDHCmwaIUSdtXdcbItRB/yfXGBhiex0<br>
<span class="lineno"></span>0IaLXQnSU+QZPRZWYqeTEbFSgihqi1PUDy8CAwEAAQJBAQdUx66rfh8sYsgfdcvV<br>
<span class="lineno"></span>NoafYpnEcB5s4m/vSVe6SU7dCK6eYec9f9wpT353ljhDUHq3EbmE4foNzJngh35d<br>
<span class="lineno">690</span>AekCIQDhRQG5Li0Wj8TM4obOnnXUXf1jRv0UkzE9AHWLG5q3AwIhAPzSjpYUDjVW<br>
<span class="lineno"></span>MCUXgckTpKCuGwbJk7424Nb8bLzf3kllAiA5mUBgjfr/WtFSJdWcPQ4Zt9KTMNKD<br>
<span class="lineno"></span>EUO0ukpTwEIl6wIhAMbGqZK3zAAFdq8DD2jPx+UJXnh0rnOkZBzDtJ6/iN69AiEA<br>
<span class="lineno"></span>1Aq8MJgTaYsDQWyU/hDq5YkDJc9e9DSCvUIzqxQWMQE=<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----`</span><span class="op" id="7580127">)</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
