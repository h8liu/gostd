<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7483445">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7483500">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7483554">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7483605">package</span>&nbsp;<span class="ident" id="7483613">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7483619">import</span>&nbsp;<span class="op" id="7483626">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7483629">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7483638">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7483645">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7483654">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7483669">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7483675">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7483688">&#34;math/rand&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7483701">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7483707">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7483718">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7483728">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="7483731">//&nbsp;TestDecodeProgressive&nbsp;tests&nbsp;that&nbsp;decoding&nbsp;the&nbsp;baseline&nbsp;and&nbsp;progressive</span><br>
<span class="lineno"></span><span class="comment" id="7483805">//&nbsp;versions&nbsp;of&nbsp;the&nbsp;same&nbsp;image&nbsp;result&nbsp;in&nbsp;exactly&nbsp;the&nbsp;same&nbsp;pixel&nbsp;data,&nbsp;in&nbsp;YCbCr</span><br>
<span class="lineno"></span><span class="comment" id="7483883">//&nbsp;space&nbsp;for&nbsp;color&nbsp;images,&nbsp;and&nbsp;Y&nbsp;space&nbsp;for&nbsp;grayscale&nbsp;images.</span><br>
<span class="lineno"></span><span class="keyword" id="7483944">func</span>&nbsp;<span class="ident" id="7483949">TestDecodeProgressive</span><span class="op" id="7483970">(</span><span class="ident" id="7483971">t</span>&nbsp;<span class="op" id="7483973">*</span><span class="ident" id="7483974"><a href="/image/jpeg/reader_test.go.html#7483718">testing</a></span><span class="op" id="7483981">.</span><span class="ident" id="7483982">T</span><span class="op" id="7483983">)</span>&nbsp;<span class="op" id="7483985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483988">testCases</span>&nbsp;<span class="op" id="7483998">:=</span>&nbsp;<span class="op" id="7484001">[</span><span class="op" id="7484002">]</span><span class="builtintype" id="7484003">string</span><span class="op" id="7484009">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7484013">&#34;../testdata/video-001&#34;</span><span class="op" id="7484036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7484040">&#34;../testdata/video-001.q50.420&#34;</span><span class="op" id="7484071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7484075">&#34;../testdata/video-001.q50.422&#34;</span><span class="op" id="7484106">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7484110">&#34;../testdata/video-001.q50.440&#34;</span><span class="op" id="7484141">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7484145">&#34;../testdata/video-001.q50.444&#34;</span><span class="op" id="7484176">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7484180">&#34;../testdata/video-005.gray.q50&#34;</span><span class="op" id="7484212">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7484216">&#34;../testdata/video-005.gray.q50.2x2&#34;</span><span class="op" id="7484252">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7484256">&#34;../testdata/video-001.separate.dc.progression&#34;</span><span class="op" id="7484303">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7484306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484309">for</span>&nbsp;<span class="ident" id="7484313">_</span><span class="op" id="7484314">,</span>&nbsp;<span class="ident" id="7484316">tc</span>&nbsp;<span class="op" id="7484319">:=</span>&nbsp;<span class="keyword" id="7484322">range</span>&nbsp;<span class="ident" id="7484328"><a href="/image/jpeg/reader_test.go.html#7483988">testCases</a></span>&nbsp;<span class="op" id="7484338">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7484342">m0</span><span class="op" id="7484344">,</span>&nbsp;<span class="ident" id="7484346">err</span>&nbsp;<span class="op" id="7484350">:=</span>&nbsp;<span class="ident" id="7484353"><a href="/image/jpeg/reader_test.go.html#7485634">decodeFile</a></span><span class="op" id="7484363">(</span><span class="ident" id="7484364"><a href="/image/jpeg/reader_test.go.html#7484316">tc</a></span>&nbsp;<span class="op" id="7484367">+</span>&nbsp;<span class="string" id="7484369">&#34;.jpeg&#34;</span><span class="op" id="7484376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484380">if</span>&nbsp;<span class="ident" id="7484383"><a href="/image/jpeg/reader_test.go.html#7484346">err</a></span>&nbsp;<span class="op" id="7484387">!=</span>&nbsp;<span class="ident" id="7484390">nil</span>&nbsp;<span class="op" id="7484394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7484399"><a href="/image/jpeg/reader_test.go.html#7483971">t</a></span><span class="op" id="7484400">.</span><span class="ident" id="7484401">Errorf</span><span class="op" id="7484407">(</span><span class="string" id="7484408">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="7484416">,</span>&nbsp;<span class="ident" id="7484418"><a href="/image/jpeg/reader_test.go.html#7484316">tc</a></span><span class="op" id="7484420">+</span><span class="string" id="7484421">&#34;.jpeg&#34;</span><span class="op" id="7484428">,</span>&nbsp;<span class="ident" id="7484430"><a href="/image/jpeg/reader_test.go.html#7484346">err</a></span><span class="op" id="7484433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484438">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7484449">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7484453">m1</span><span class="op" id="7484455">,</span>&nbsp;<span class="ident" id="7484457"><a href="/image/jpeg/reader_test.go.html#7484346">err</a></span>&nbsp;<span class="op" id="7484461">:=</span>&nbsp;<span class="ident" id="7484464"><a href="/image/jpeg/reader_test.go.html#7485634">decodeFile</a></span><span class="op" id="7484474">(</span><span class="ident" id="7484475"><a href="/image/jpeg/reader_test.go.html#7484316">tc</a></span>&nbsp;<span class="op" id="7484478">+</span>&nbsp;<span class="string" id="7484480">&#34;.progressive.jpeg&#34;</span><span class="op" id="7484499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484503">if</span>&nbsp;<span class="ident" id="7484506"><a href="/image/jpeg/reader_test.go.html#7484346">err</a></span>&nbsp;<span class="op" id="7484510">!=</span>&nbsp;<span class="ident" id="7484513">nil</span>&nbsp;<span class="op" id="7484517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7484522"><a href="/image/jpeg/reader_test.go.html#7483971">t</a></span><span class="op" id="7484523">.</span><span class="ident" id="7484524">Errorf</span><span class="op" id="7484530">(</span><span class="string" id="7484531">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="7484539">,</span>&nbsp;<span class="ident" id="7484541"><a href="/image/jpeg/reader_test.go.html#7484316">tc</a></span><span class="op" id="7484543">+</span><span class="string" id="7484544">&#34;.progressive.jpeg&#34;</span><span class="op" id="7484563">,</span>&nbsp;<span class="ident" id="7484565"><a href="/image/jpeg/reader_test.go.html#7484346">err</a></span><span class="op" id="7484568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484573">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7484584">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484588">if</span>&nbsp;<span class="ident" id="7484591"><a href="/image/jpeg/reader_test.go.html#7484342">m0</a></span><span class="op" id="7484593">.</span><span class="ident" id="7484594">Bounds</span><span class="op" id="7484600">(</span><span class="op" id="7484601">)</span>&nbsp;<span class="op" id="7484603">!=</span>&nbsp;<span class="ident" id="7484606"><a href="/image/jpeg/reader_test.go.html#7484453">m1</a></span><span class="op" id="7484608">.</span><span class="ident" id="7484609">Bounds</span><span class="op" id="7484615">(</span><span class="op" id="7484616">)</span>&nbsp;<span class="op" id="7484618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7484623"><a href="/image/jpeg/reader_test.go.html#7483971">t</a></span><span class="op" id="7484624">.</span><span class="ident" id="7484625">Errorf</span><span class="op" id="7484631">(</span><span class="string" id="7484632">&#34;%s:&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7484662">,</span>&nbsp;<span class="ident" id="7484664"><a href="/image/jpeg/reader_test.go.html#7484316">tc</a></span><span class="op" id="7484666">,</span>&nbsp;<span class="ident" id="7484668"><a href="/image/jpeg/reader_test.go.html#7484342">m0</a></span><span class="op" id="7484670">.</span><span class="ident" id="7484671">Bounds</span><span class="op" id="7484677">(</span><span class="op" id="7484678">)</span><span class="op" id="7484679">,</span>&nbsp;<span class="ident" id="7484681"><a href="/image/jpeg/reader_test.go.html#7484453">m1</a></span><span class="op" id="7484683">.</span><span class="ident" id="7484684">Bounds</span><span class="op" id="7484690">(</span><span class="op" id="7484691">)</span><span class="op" id="7484692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484697">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7484708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7484712">//&nbsp;All&nbsp;of&nbsp;the&nbsp;video-*.jpeg&nbsp;files&nbsp;are&nbsp;150x103.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484760">if</span>&nbsp;<span class="ident" id="7484763"><a href="/image/jpeg/reader_test.go.html#7484342">m0</a></span><span class="op" id="7484765">.</span><span class="ident" id="7484766">Bounds</span><span class="op" id="7484772">(</span><span class="op" id="7484773">)</span>&nbsp;<span class="op" id="7484775">!=</span>&nbsp;<span class="ident" id="7484778"><a href="/image/jpeg/reader_test.go.html#7483645">image</a></span><span class="op" id="7484783">.</span><span class="ident" id="7484784">Rect</span><span class="op" id="7484788">(</span><span class="num" id="7484789">0</span><span class="op" id="7484790">,</span>&nbsp;<span class="num" id="7484792">0</span><span class="op" id="7484793">,</span>&nbsp;<span class="num" id="7484795">150</span><span class="op" id="7484798">,</span>&nbsp;<span class="num" id="7484800">103</span><span class="op" id="7484803">)</span>&nbsp;<span class="op" id="7484805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7484810"><a href="/image/jpeg/reader_test.go.html#7483971">t</a></span><span class="op" id="7484811">.</span><span class="ident" id="7484812">Errorf</span><span class="op" id="7484818">(</span><span class="string" id="7484819">&#34;%s:&nbsp;bad&nbsp;bounds:&nbsp;%v&#34;</span><span class="op" id="7484839">,</span>&nbsp;<span class="ident" id="7484841"><a href="/image/jpeg/reader_test.go.html#7484316">tc</a></span><span class="op" id="7484843">,</span>&nbsp;<span class="ident" id="7484845"><a href="/image/jpeg/reader_test.go.html#7484342">m0</a></span><span class="op" id="7484847">.</span><span class="ident" id="7484848">Bounds</span><span class="op" id="7484854">(</span><span class="op" id="7484855">)</span><span class="op" id="7484856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484861">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7484872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484877">switch</span>&nbsp;<span class="ident" id="7484884">m0</span>&nbsp;<span class="op" id="7484887">:=</span>&nbsp;<span class="ident" id="7484890"><a href="/image/jpeg/reader_test.go.html#7484342">m0</a></span><span class="op" id="7484892">.</span><span class="op" id="7484893">(</span><span class="keyword" id="7484894">type</span><span class="op" id="7484898">)</span>&nbsp;<span class="op" id="7484900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484904">case</span>&nbsp;<span class="op" id="7484909">*</span><span class="ident" id="7484910"><a href="/image/jpeg/reader_test.go.html#7483645">image</a></span><span class="op" id="7484915">.</span><span class="ident" id="7484916">YCbCr</span><span class="op" id="7484921">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7484926">m1</span>&nbsp;<span class="op" id="7484929">:=</span>&nbsp;<span class="ident" id="7484932"><a href="/image/jpeg/reader_test.go.html#7484453">m1</a></span><span class="op" id="7484934">.</span><span class="op" id="7484935">(</span><span class="op" id="7484936">*</span><span class="ident" id="7484937"><a href="/image/jpeg/reader_test.go.html#7483645">image</a></span><span class="op" id="7484942">.</span><span class="ident" id="7484943">YCbCr</span><span class="op" id="7484948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484953">if</span>&nbsp;<span class="ident" id="7484956">err</span>&nbsp;<span class="op" id="7484960">:=</span>&nbsp;<span class="ident" id="7484963"><a href="/image/jpeg/reader_test.go.html#7486782">check</a></span><span class="op" id="7484968">(</span><span class="ident" id="7484969"><a href="/image/jpeg/reader_test.go.html#7484884">m0</a></span><span class="op" id="7484971">.</span><span class="ident" id="7484972">Bounds</span><span class="op" id="7484978">(</span><span class="op" id="7484979">)</span><span class="op" id="7484980">,</span>&nbsp;<span class="ident" id="7484982"><a href="/image/jpeg/reader_test.go.html#7484884">m0</a></span><span class="op" id="7484984">.</span><span class="ident" id="7484985">Y</span><span class="op" id="7484986">,</span>&nbsp;<span class="ident" id="7484988"><a href="/image/jpeg/reader_test.go.html#7484926">m1</a></span><span class="op" id="7484990">.</span><span class="ident" id="7484991">Y</span><span class="op" id="7484992">,</span>&nbsp;<span class="ident" id="7484994"><a href="/image/jpeg/reader_test.go.html#7484884">m0</a></span><span class="op" id="7484996">.</span><span class="ident" id="7484997">YStride</span><span class="op" id="7485004">,</span>&nbsp;<span class="ident" id="7485006"><a href="/image/jpeg/reader_test.go.html#7484926">m1</a></span><span class="op" id="7485008">.</span><span class="ident" id="7485009">YStride</span><span class="op" id="7485016">)</span><span class="op" id="7485017">;</span>&nbsp;<span class="ident" id="7485019"><a href="/image/jpeg/reader_test.go.html#7484956">err</a></span>&nbsp;<span class="op" id="7485023">!=</span>&nbsp;<span class="ident" id="7485026">nil</span>&nbsp;<span class="op" id="7485030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485036"><a href="/image/jpeg/reader_test.go.html#7483971">t</a></span><span class="op" id="7485037">.</span><span class="ident" id="7485038">Errorf</span><span class="op" id="7485044">(</span><span class="string" id="7485045">&#34;%s&nbsp;(Y):&nbsp;%v&#34;</span><span class="op" id="7485057">,</span>&nbsp;<span class="ident" id="7485059"><a href="/image/jpeg/reader_test.go.html#7484316">tc</a></span><span class="op" id="7485061">,</span>&nbsp;<span class="ident" id="7485063"><a href="/image/jpeg/reader_test.go.html#7484956">err</a></span><span class="op" id="7485066">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485072">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7485084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485089">if</span>&nbsp;<span class="ident" id="7485092">err</span>&nbsp;<span class="op" id="7485096">:=</span>&nbsp;<span class="ident" id="7485099"><a href="/image/jpeg/reader_test.go.html#7486782">check</a></span><span class="op" id="7485104">(</span><span class="ident" id="7485105"><a href="/image/jpeg/reader_test.go.html#7484884">m0</a></span><span class="op" id="7485107">.</span><span class="ident" id="7485108">Bounds</span><span class="op" id="7485114">(</span><span class="op" id="7485115">)</span><span class="op" id="7485116">,</span>&nbsp;<span class="ident" id="7485118"><a href="/image/jpeg/reader_test.go.html#7484884">m0</a></span><span class="op" id="7485120">.</span><span class="ident" id="7485121">Cb</span><span class="op" id="7485123">,</span>&nbsp;<span class="ident" id="7485125"><a href="/image/jpeg/reader_test.go.html#7484926">m1</a></span><span class="op" id="7485127">.</span><span class="ident" id="7485128">Cb</span><span class="op" id="7485130">,</span>&nbsp;<span class="ident" id="7485132"><a href="/image/jpeg/reader_test.go.html#7484884">m0</a></span><span class="op" id="7485134">.</span><span class="ident" id="7485135">CStride</span><span class="op" id="7485142">,</span>&nbsp;<span class="ident" id="7485144"><a href="/image/jpeg/reader_test.go.html#7484926">m1</a></span><span class="op" id="7485146">.</span><span class="ident" id="7485147">CStride</span><span class="op" id="7485154">)</span><span class="op" id="7485155">;</span>&nbsp;<span class="ident" id="7485157"><a href="/image/jpeg/reader_test.go.html#7485092">err</a></span>&nbsp;<span class="op" id="7485161">!=</span>&nbsp;<span class="ident" id="7485164">nil</span>&nbsp;<span class="op" id="7485168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485174"><a href="/image/jpeg/reader_test.go.html#7483971">t</a></span><span class="op" id="7485175">.</span><span class="ident" id="7485176">Errorf</span><span class="op" id="7485182">(</span><span class="string" id="7485183">&#34;%s&nbsp;(Cb):&nbsp;%v&#34;</span><span class="op" id="7485196">,</span>&nbsp;<span class="ident" id="7485198"><a href="/image/jpeg/reader_test.go.html#7484316">tc</a></span><span class="op" id="7485200">,</span>&nbsp;<span class="ident" id="7485202"><a href="/image/jpeg/reader_test.go.html#7485092">err</a></span><span class="op" id="7485205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485211">continue</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7485223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485228">if</span>&nbsp;<span class="ident" id="7485231">err</span>&nbsp;<span class="op" id="7485235">:=</span>&nbsp;<span class="ident" id="7485238"><a href="/image/jpeg/reader_test.go.html#7486782">check</a></span><span class="op" id="7485243">(</span><span class="ident" id="7485244"><a href="/image/jpeg/reader_test.go.html#7484884">m0</a></span><span class="op" id="7485246">.</span><span class="ident" id="7485247">Bounds</span><span class="op" id="7485253">(</span><span class="op" id="7485254">)</span><span class="op" id="7485255">,</span>&nbsp;<span class="ident" id="7485257"><a href="/image/jpeg/reader_test.go.html#7484884">m0</a></span><span class="op" id="7485259">.</span><span class="ident" id="7485260">Cr</span><span class="op" id="7485262">,</span>&nbsp;<span class="ident" id="7485264"><a href="/image/jpeg/reader_test.go.html#7484926">m1</a></span><span class="op" id="7485266">.</span><span class="ident" id="7485267">Cr</span><span class="op" id="7485269">,</span>&nbsp;<span class="ident" id="7485271"><a href="/image/jpeg/reader_test.go.html#7484884">m0</a></span><span class="op" id="7485273">.</span><span class="ident" id="7485274">CStride</span><span class="op" id="7485281">,</span>&nbsp;<span class="ident" id="7485283"><a href="/image/jpeg/reader_test.go.html#7484926">m1</a></span><span class="op" id="7485285">.</span><span class="ident" id="7485286">CStride</span><span class="op" id="7485293">)</span><span class="op" id="7485294">;</span>&nbsp;<span class="ident" id="7485296"><a href="/image/jpeg/reader_test.go.html#7485231">err</a></span>&nbsp;<span class="op" id="7485300">!=</span>&nbsp;<span class="ident" id="7485303">nil</span>&nbsp;<span class="op" id="7485307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485313"><a href="/image/jpeg/reader_test.go.html#7483971">t</a></span><span class="op" id="7485314">.</span><span class="ident" id="7485315">Errorf</span><span class="op" id="7485321">(</span><span class="string" id="7485322">&#34;%s&nbsp;(Cr):&nbsp;%v&#34;</span><span class="op" id="7485335">,</span>&nbsp;<span class="ident" id="7485337"><a href="/image/jpeg/reader_test.go.html#7484316">tc</a></span><span class="op" id="7485339">,</span>&nbsp;<span class="ident" id="7485341"><a href="/image/jpeg/reader_test.go.html#7485231">err</a></span><span class="op" id="7485344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485350">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7485362">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485366">case</span>&nbsp;<span class="op" id="7485371">*</span><span class="ident" id="7485372"><a href="/image/jpeg/reader_test.go.html#7483645">image</a></span><span class="op" id="7485377">.</span><span class="ident" id="7485378">Gray</span><span class="op" id="7485382">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485387">m1</span>&nbsp;<span class="op" id="7485390">:=</span>&nbsp;<span class="ident" id="7485393"><a href="/image/jpeg/reader_test.go.html#7484453">m1</a></span><span class="op" id="7485395">.</span><span class="op" id="7485396">(</span><span class="op" id="7485397">*</span><span class="ident" id="7485398"><a href="/image/jpeg/reader_test.go.html#7483645">image</a></span><span class="op" id="7485403">.</span><span class="ident" id="7485404">Gray</span><span class="op" id="7485408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485413">if</span>&nbsp;<span class="ident" id="7485416">err</span>&nbsp;<span class="op" id="7485420">:=</span>&nbsp;<span class="ident" id="7485423"><a href="/image/jpeg/reader_test.go.html#7486782">check</a></span><span class="op" id="7485428">(</span><span class="ident" id="7485429"><a href="/image/jpeg/reader_test.go.html#7484884">m0</a></span><span class="op" id="7485431">.</span><span class="ident" id="7485432">Bounds</span><span class="op" id="7485438">(</span><span class="op" id="7485439">)</span><span class="op" id="7485440">,</span>&nbsp;<span class="ident" id="7485442"><a href="/image/jpeg/reader_test.go.html#7484884">m0</a></span><span class="op" id="7485444">.</span><span class="ident" id="7485445">Pix</span><span class="op" id="7485448">,</span>&nbsp;<span class="ident" id="7485450"><a href="/image/jpeg/reader_test.go.html#7485387">m1</a></span><span class="op" id="7485452">.</span><span class="ident" id="7485453">Pix</span><span class="op" id="7485456">,</span>&nbsp;<span class="ident" id="7485458"><a href="/image/jpeg/reader_test.go.html#7484884">m0</a></span><span class="op" id="7485460">.</span><span class="ident" id="7485461">Stride</span><span class="op" id="7485467">,</span>&nbsp;<span class="ident" id="7485469"><a href="/image/jpeg/reader_test.go.html#7485387">m1</a></span><span class="op" id="7485471">.</span><span class="ident" id="7485472">Stride</span><span class="op" id="7485478">)</span><span class="op" id="7485479">;</span>&nbsp;<span class="ident" id="7485481"><a href="/image/jpeg/reader_test.go.html#7485416">err</a></span>&nbsp;<span class="op" id="7485485">!=</span>&nbsp;<span class="ident" id="7485488">nil</span>&nbsp;<span class="op" id="7485492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485498"><a href="/image/jpeg/reader_test.go.html#7483971">t</a></span><span class="op" id="7485499">.</span><span class="ident" id="7485500">Errorf</span><span class="op" id="7485506">(</span><span class="string" id="7485507">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="7485515">,</span>&nbsp;<span class="ident" id="7485517"><a href="/image/jpeg/reader_test.go.html#7484316">tc</a></span><span class="op" id="7485519">,</span>&nbsp;<span class="ident" id="7485521"><a href="/image/jpeg/reader_test.go.html#7485416">err</a></span><span class="op" id="7485524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485530">continue</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7485542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485546">default</span><span class="op" id="7485553">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485558"><a href="/image/jpeg/reader_test.go.html#7483971">t</a></span><span class="op" id="7485559">.</span><span class="ident" id="7485560">Errorf</span><span class="op" id="7485566">(</span><span class="string" id="7485567">&#34;%s:&nbsp;unexpected&nbsp;image&nbsp;type&nbsp;%T&#34;</span><span class="op" id="7485597">,</span>&nbsp;<span class="ident" id="7485599"><a href="/image/jpeg/reader_test.go.html#7484316">tc</a></span><span class="op" id="7485601">,</span>&nbsp;<span class="ident" id="7485603"><a href="/image/jpeg/reader_test.go.html#7484884">m0</a></span><span class="op" id="7485605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485610">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7485621">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7485624">}</span><br>
<span class="lineno"></span><span class="op" id="7485626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7485629">func</span>&nbsp;<span class="ident" id="7485634">decodeFile</span><span class="op" id="7485644">(</span><span class="ident" id="7485645">filename</span>&nbsp;<span class="builtintype" id="7485654">string</span><span class="op" id="7485660">)</span>&nbsp;<span class="op" id="7485662">(</span><span class="ident" id="7485663"><a href="/image/jpeg/reader_test.go.html#7483645">image</a></span><span class="op" id="7485668">.</span><span class="ident" id="7485669">Image</span><span class="op" id="7485674">,</span>&nbsp;<span class="builtintype" id="7485676">error</span><span class="op" id="7485681">)</span>&nbsp;<span class="op" id="7485683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485686">f</span><span class="op" id="7485687">,</span>&nbsp;<span class="ident" id="7485689">err</span>&nbsp;<span class="op" id="7485693">:=</span>&nbsp;<span class="ident" id="7485696"><a href="/image/jpeg/reader_test.go.html#7483701">os</a></span><span class="op" id="7485698">.</span><span class="ident" id="7485699">Open</span><span class="op" id="7485703">(</span><span class="ident" id="7485704"><a href="/image/jpeg/reader_test.go.html#7485645">filename</a></span><span class="op" id="7485712">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485715">if</span>&nbsp;<span class="ident" id="7485718"><a href="/image/jpeg/reader_test.go.html#7485689">err</a></span>&nbsp;<span class="op" id="7485722">!=</span>&nbsp;<span class="ident" id="7485725">nil</span>&nbsp;<span class="op" id="7485729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485733">return</span>&nbsp;<span class="ident" id="7485740">nil</span><span class="op" id="7485743">,</span>&nbsp;<span class="ident" id="7485745"><a href="/image/jpeg/reader_test.go.html#7485689">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7485750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485753">defer</span>&nbsp;<span class="ident" id="7485759"><a href="/image/jpeg/reader_test.go.html#7485686">f</a></span><span class="op" id="7485760">.</span><span class="ident" id="7485761">Close</span><span class="op" id="7485766">(</span><span class="op" id="7485767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485770">return</span>&nbsp;<span class="ident" id="7485777"><a href="/image/jpeg/reader.go.html#5417124">Decode</a></span><span class="op" id="7485783">(</span><span class="ident" id="7485784"><a href="/image/jpeg/reader_test.go.html#7485686">f</a></span><span class="op" id="7485785">)</span><br>
<span class="lineno">90</span><span class="op" id="7485787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7485790">type</span>&nbsp;<span class="ident" id="7485795">eofReader</span>&nbsp;<span class="keyword" id="7485805">struct</span>&nbsp;<span class="op" id="7485812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485815">data</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7485824">[</span><span class="op" id="7485825">]</span><span class="builtintype" id="7485826">byte</span>&nbsp;<span class="comment" id="7485831">//&nbsp;deliver&nbsp;from&nbsp;Read&nbsp;without&nbsp;EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485865">dataEOF</span>&nbsp;&nbsp;<span class="op" id="7485874">[</span><span class="op" id="7485875">]</span><span class="builtintype" id="7485876">byte</span>&nbsp;<span class="comment" id="7485881">//&nbsp;then&nbsp;deliver&nbsp;from&nbsp;Read&nbsp;with&nbsp;EOF&nbsp;on&nbsp;last&nbsp;chunk</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485931">lenAtEOF</span>&nbsp;<span class="builtintype" id="7485940">int</span><br>
<span class="lineno"></span><span class="op" id="7485944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7485947">func</span>&nbsp;<span class="op" id="7485952">(</span><span class="ident" id="7485953">r</span>&nbsp;<span class="op" id="7485955">*</span><span class="ident" id="7485956"><a href="/image/jpeg/reader_test.go.html#7485795">eofReader</a></span><span class="op" id="7485965">)</span>&nbsp;<span class="ident" id="7485967">Read</span><span class="op" id="7485971">(</span><span class="ident" id="7485972">b</span>&nbsp;<span class="op" id="7485974">[</span><span class="op" id="7485975">]</span><span class="builtintype" id="7485976">byte</span><span class="op" id="7485980">)</span>&nbsp;<span class="op" id="7485982">(</span><span class="ident" id="7485983">n</span>&nbsp;<span class="builtintype" id="7485985">int</span><span class="op" id="7485988">,</span>&nbsp;<span class="ident" id="7485990">err</span>&nbsp;<span class="builtintype" id="7485994">error</span><span class="op" id="7485999">)</span>&nbsp;<span class="op" id="7486001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7486004">if</span>&nbsp;<span class="builtinfunc" id="7486007">len</span><span class="op" id="7486010">(</span><span class="ident" id="7486011"><a href="/image/jpeg/reader_test.go.html#7485953">r</a></span><span class="op" id="7486012">.</span><span class="ident" id="7486013">data</span><span class="op" id="7486017">)</span>&nbsp;<span class="op" id="7486019">&gt;</span>&nbsp;<span class="num" id="7486021">0</span>&nbsp;<span class="op" id="7486023">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486027"><a href="/image/jpeg/reader_test.go.html#7485983">n</a></span>&nbsp;<span class="op" id="7486029">=</span>&nbsp;<span class="builtinfunc" id="7486031">copy</span><span class="op" id="7486035">(</span><span class="ident" id="7486036"><a href="/image/jpeg/reader_test.go.html#7485972">b</a></span><span class="op" id="7486037">,</span>&nbsp;<span class="ident" id="7486039"><a href="/image/jpeg/reader_test.go.html#7485953">r</a></span><span class="op" id="7486040">.</span><span class="ident" id="7486041">data</span><span class="op" id="7486045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486049"><a href="/image/jpeg/reader_test.go.html#7485953">r</a></span><span class="op" id="7486050">.</span><span class="ident" id="7486051">data</span>&nbsp;<span class="op" id="7486056">=</span>&nbsp;<span class="ident" id="7486058"><a href="/image/jpeg/reader_test.go.html#7485953">r</a></span><span class="op" id="7486059">.</span><span class="ident" id="7486060">data</span><span class="op" id="7486064">[</span><span class="ident" id="7486065"><a href="/image/jpeg/reader_test.go.html#7485983">n</a></span><span class="op" id="7486066">:</span><span class="op" id="7486067">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7486070">}</span>&nbsp;<span class="keyword" id="7486072">else</span>&nbsp;<span class="op" id="7486077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486081"><a href="/image/jpeg/reader_test.go.html#7485983">n</a></span>&nbsp;<span class="op" id="7486083">=</span>&nbsp;<span class="builtinfunc" id="7486085">copy</span><span class="op" id="7486089">(</span><span class="ident" id="7486090"><a href="/image/jpeg/reader_test.go.html#7485972">b</a></span><span class="op" id="7486091">,</span>&nbsp;<span class="ident" id="7486093"><a href="/image/jpeg/reader_test.go.html#7485953">r</a></span><span class="op" id="7486094">.</span><span class="ident" id="7486095">dataEOF</span><span class="op" id="7486102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486106"><a href="/image/jpeg/reader_test.go.html#7485953">r</a></span><span class="op" id="7486107">.</span><span class="ident" id="7486108">dataEOF</span>&nbsp;<span class="op" id="7486116">=</span>&nbsp;<span class="ident" id="7486118"><a href="/image/jpeg/reader_test.go.html#7485953">r</a></span><span class="op" id="7486119">.</span><span class="ident" id="7486120">dataEOF</span><span class="op" id="7486127">[</span><span class="ident" id="7486128"><a href="/image/jpeg/reader_test.go.html#7485983">n</a></span><span class="op" id="7486129">:</span><span class="op" id="7486130">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7486134">if</span>&nbsp;<span class="builtinfunc" id="7486137">len</span><span class="op" id="7486140">(</span><span class="ident" id="7486141"><a href="/image/jpeg/reader_test.go.html#7485953">r</a></span><span class="op" id="7486142">.</span><span class="ident" id="7486143">dataEOF</span><span class="op" id="7486150">)</span>&nbsp;<span class="op" id="7486152">==</span>&nbsp;<span class="num" id="7486155">0</span>&nbsp;<span class="op" id="7486157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486162"><a href="/image/jpeg/reader_test.go.html#7485990">err</a></span>&nbsp;<span class="op" id="7486166">=</span>&nbsp;<span class="ident" id="7486168"><a href="/image/jpeg/reader_test.go.html#7483669">io</a></span><span class="op" id="7486170">.</span><span class="ident" id="7486171">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7486178">if</span>&nbsp;<span class="ident" id="7486181"><a href="/image/jpeg/reader_test.go.html#7485953">r</a></span><span class="op" id="7486182">.</span><span class="ident" id="7486183">lenAtEOF</span>&nbsp;<span class="op" id="7486192">==</span>&nbsp;<span class="op" id="7486195">-</span><span class="num" id="7486196">1</span>&nbsp;<span class="op" id="7486198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486204"><a href="/image/jpeg/reader_test.go.html#7485953">r</a></span><span class="op" id="7486205">.</span><span class="ident" id="7486206">lenAtEOF</span>&nbsp;<span class="op" id="7486215">=</span>&nbsp;<span class="ident" id="7486217"><a href="/image/jpeg/reader_test.go.html#7485983">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7486222">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7486226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7486229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7486232">return</span><br>
<span class="lineno"></span><span class="op" id="7486239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="7486242">func</span>&nbsp;<span class="ident" id="7486247">TestDecodeEOF</span><span class="op" id="7486260">(</span><span class="ident" id="7486261">t</span>&nbsp;<span class="op" id="7486263">*</span><span class="ident" id="7486264"><a href="/image/jpeg/reader_test.go.html#7483718">testing</a></span><span class="op" id="7486271">.</span><span class="ident" id="7486272">T</span><span class="op" id="7486273">)</span>&nbsp;<span class="op" id="7486275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7486278">//&nbsp;Check&nbsp;that&nbsp;if&nbsp;reader&nbsp;returns&nbsp;final&nbsp;data&nbsp;and&nbsp;EOF&nbsp;at&nbsp;same&nbsp;time,&nbsp;jpeg&nbsp;handles&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486361">data</span><span class="op" id="7486365">,</span>&nbsp;<span class="ident" id="7486367">err</span>&nbsp;<span class="op" id="7486371">:=</span>&nbsp;<span class="ident" id="7486374"><a href="/image/jpeg/reader_test.go.html#7483675">ioutil</a></span><span class="op" id="7486380">.</span><span class="ident" id="7486381">ReadFile</span><span class="op" id="7486389">(</span><span class="string" id="7486390">&#34;../testdata/video-001.jpeg&#34;</span><span class="op" id="7486418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7486421">if</span>&nbsp;<span class="ident" id="7486424"><a href="/image/jpeg/reader_test.go.html#7486367">err</a></span>&nbsp;<span class="op" id="7486428">!=</span>&nbsp;<span class="ident" id="7486431">nil</span>&nbsp;<span class="op" id="7486435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486439"><a href="/image/jpeg/reader_test.go.html#7486261">t</a></span><span class="op" id="7486440">.</span><span class="ident" id="7486441">Fatal</span><span class="op" id="7486446">(</span><span class="ident" id="7486447"><a href="/image/jpeg/reader_test.go.html#7486367">err</a></span><span class="op" id="7486450">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7486453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486457">n</span>&nbsp;<span class="op" id="7486459">:=</span>&nbsp;<span class="builtinfunc" id="7486462">len</span><span class="op" id="7486465">(</span><span class="ident" id="7486466"><a href="/image/jpeg/reader_test.go.html#7486361">data</a></span><span class="op" id="7486470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7486473">for</span>&nbsp;<span class="ident" id="7486477">i</span>&nbsp;<span class="op" id="7486479">:=</span>&nbsp;<span class="num" id="7486482">0</span><span class="op" id="7486483">;</span>&nbsp;<span class="ident" id="7486485"><a href="/image/jpeg/reader_test.go.html#7486477">i</a></span>&nbsp;<span class="op" id="7486487">&lt;</span>&nbsp;<span class="ident" id="7486489"><a href="/image/jpeg/reader_test.go.html#7486457">n</a></span><span class="op" id="7486490">;</span>&nbsp;<span class="op" id="7486492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486496">r</span>&nbsp;<span class="op" id="7486498">:=</span>&nbsp;<span class="op" id="7486501">&amp;</span><span class="ident" id="7486502"><a href="/image/jpeg/reader_test.go.html#7485795">eofReader</a></span><span class="op" id="7486511">{</span><span class="ident" id="7486512"><a href="/image/jpeg/reader_test.go.html#7486361">data</a></span><span class="op" id="7486516">[</span><span class="op" id="7486517">:</span><span class="ident" id="7486518"><a href="/image/jpeg/reader_test.go.html#7486457">n</a></span><span class="op" id="7486519">-</span><span class="ident" id="7486520"><a href="/image/jpeg/reader_test.go.html#7486477">i</a></span><span class="op" id="7486521">]</span><span class="op" id="7486522">,</span>&nbsp;<span class="ident" id="7486524"><a href="/image/jpeg/reader_test.go.html#7486361">data</a></span><span class="op" id="7486528">[</span><span class="ident" id="7486529"><a href="/image/jpeg/reader_test.go.html#7486457">n</a></span><span class="op" id="7486530">-</span><span class="ident" id="7486531"><a href="/image/jpeg/reader_test.go.html#7486477">i</a></span><span class="op" id="7486532">:</span><span class="op" id="7486533">]</span><span class="op" id="7486534">,</span>&nbsp;<span class="op" id="7486536">-</span><span class="num" id="7486537">1</span><span class="op" id="7486538">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486542">_</span><span class="op" id="7486543">,</span>&nbsp;<span class="ident" id="7486545">err</span>&nbsp;<span class="op" id="7486549">:=</span>&nbsp;<span class="ident" id="7486552"><a href="/image/jpeg/reader.go.html#5417124">Decode</a></span><span class="op" id="7486558">(</span><span class="ident" id="7486559"><a href="/image/jpeg/reader_test.go.html#7486496">r</a></span><span class="op" id="7486560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7486564">if</span>&nbsp;<span class="ident" id="7486567"><a href="/image/jpeg/reader_test.go.html#7486545">err</a></span>&nbsp;<span class="op" id="7486571">!=</span>&nbsp;<span class="ident" id="7486574">nil</span>&nbsp;<span class="op" id="7486578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486583"><a href="/image/jpeg/reader_test.go.html#7486261">t</a></span><span class="op" id="7486584">.</span><span class="ident" id="7486585">Errorf</span><span class="op" id="7486591">(</span><span class="string" id="7486592">&#34;Decode&nbsp;with&nbsp;Read()&nbsp;=&nbsp;%d,&nbsp;EOF:&nbsp;%v&#34;</span><span class="op" id="7486626">,</span>&nbsp;<span class="ident" id="7486628"><a href="/image/jpeg/reader_test.go.html#7486496">r</a></span><span class="op" id="7486629">.</span><span class="ident" id="7486630">lenAtEOF</span><span class="op" id="7486638">,</span>&nbsp;<span class="ident" id="7486640"><a href="/image/jpeg/reader_test.go.html#7486545">err</a></span><span class="op" id="7486643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7486647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7486651">if</span>&nbsp;<span class="ident" id="7486654"><a href="/image/jpeg/reader_test.go.html#7486477">i</a></span>&nbsp;<span class="op" id="7486656">==</span>&nbsp;<span class="num" id="7486659">0</span>&nbsp;<span class="op" id="7486661">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486666"><a href="/image/jpeg/reader_test.go.html#7486477">i</a></span>&nbsp;<span class="op" id="7486668">=</span>&nbsp;<span class="num" id="7486670">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7486674">}</span>&nbsp;<span class="keyword" id="7486676">else</span>&nbsp;<span class="op" id="7486681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486686"><a href="/image/jpeg/reader_test.go.html#7486477">i</a></span>&nbsp;<span class="op" id="7486688">*=</span>&nbsp;<span class="num" id="7486691">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7486695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7486698">}</span><br>
<span class="lineno">135</span><span class="op" id="7486700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7486703">//&nbsp;check&nbsp;checks&nbsp;that&nbsp;the&nbsp;two&nbsp;pix&nbsp;data&nbsp;are&nbsp;equal,&nbsp;within&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="7486777">func</span>&nbsp;<span class="ident" id="7486782">check</span><span class="op" id="7486787">(</span><span class="ident" id="7486788">bounds</span>&nbsp;<span class="ident" id="7486795"><a href="/image/jpeg/reader_test.go.html#7483645">image</a></span><span class="op" id="7486800">.</span><span class="ident" id="7486801">Rectangle</span><span class="op" id="7486810">,</span>&nbsp;<span class="ident" id="7486812">pix0</span><span class="op" id="7486816">,</span>&nbsp;<span class="ident" id="7486818">pix1</span>&nbsp;<span class="op" id="7486823">[</span><span class="op" id="7486824">]</span><span class="builtintype" id="7486825">byte</span><span class="op" id="7486829">,</span>&nbsp;<span class="ident" id="7486831">stride0</span><span class="op" id="7486838">,</span>&nbsp;<span class="ident" id="7486840">stride1</span>&nbsp;<span class="builtintype" id="7486848">int</span><span class="op" id="7486851">)</span>&nbsp;<span class="builtintype" id="7486853">error</span>&nbsp;<span class="op" id="7486859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7486862">if</span>&nbsp;<span class="ident" id="7486865"><a href="/image/jpeg/reader_test.go.html#7486831">stride0</a></span>&nbsp;<span class="op" id="7486873">&lt;=</span>&nbsp;<span class="num" id="7486876">0</span>&nbsp;<span class="op" id="7486878">||</span>&nbsp;<span class="ident" id="7486881"><a href="/image/jpeg/reader_test.go.html#7486831">stride0</a></span><span class="op" id="7486888">%</span><span class="num" id="7486889">8</span>&nbsp;<span class="op" id="7486891">!=</span>&nbsp;<span class="num" id="7486894">0</span>&nbsp;<span class="op" id="7486896">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7486900">return</span>&nbsp;<span class="ident" id="7486907"><a href="/image/jpeg/reader_test.go.html#7483638">fmt</a></span><span class="op" id="7486910">.</span><span class="ident" id="7486911">Errorf</span><span class="op" id="7486917">(</span><span class="string" id="7486918">&#34;bad&nbsp;stride&nbsp;%d&#34;</span><span class="op" id="7486933">,</span>&nbsp;<span class="ident" id="7486935"><a href="/image/jpeg/reader_test.go.html#7486831">stride0</a></span><span class="op" id="7486942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7486945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7486948">if</span>&nbsp;<span class="ident" id="7486951"><a href="/image/jpeg/reader_test.go.html#7486840">stride1</a></span>&nbsp;<span class="op" id="7486959">&lt;=</span>&nbsp;<span class="num" id="7486962">0</span>&nbsp;<span class="op" id="7486964">||</span>&nbsp;<span class="ident" id="7486967"><a href="/image/jpeg/reader_test.go.html#7486840">stride1</a></span><span class="op" id="7486974">%</span><span class="num" id="7486975">8</span>&nbsp;<span class="op" id="7486977">!=</span>&nbsp;<span class="num" id="7486980">0</span>&nbsp;<span class="op" id="7486982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7486986">return</span>&nbsp;<span class="ident" id="7486993"><a href="/image/jpeg/reader_test.go.html#7483638">fmt</a></span><span class="op" id="7486996">.</span><span class="ident" id="7486997">Errorf</span><span class="op" id="7487003">(</span><span class="string" id="7487004">&#34;bad&nbsp;stride&nbsp;%d&#34;</span><span class="op" id="7487019">,</span>&nbsp;<span class="ident" id="7487021"><a href="/image/jpeg/reader_test.go.html#7486840">stride1</a></span><span class="op" id="7487028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487031">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7487034">//&nbsp;Compare&nbsp;the&nbsp;two&nbsp;pix&nbsp;data,&nbsp;one&nbsp;8x8&nbsp;block&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487089">for</span>&nbsp;<span class="ident" id="7487093">y</span>&nbsp;<span class="op" id="7487095">:=</span>&nbsp;<span class="num" id="7487098">0</span><span class="op" id="7487099">;</span>&nbsp;<span class="ident" id="7487101"><a href="/image/jpeg/reader_test.go.html#7487093">y</a></span>&nbsp;<span class="op" id="7487103">&lt;</span>&nbsp;<span class="builtinfunc" id="7487105">len</span><span class="op" id="7487108">(</span><span class="ident" id="7487109"><a href="/image/jpeg/reader_test.go.html#7486812">pix0</a></span><span class="op" id="7487113">)</span><span class="op" id="7487114">/</span><span class="ident" id="7487115"><a href="/image/jpeg/reader_test.go.html#7486831">stride0</a></span>&nbsp;<span class="op" id="7487123">&amp;&amp;</span>&nbsp;<span class="ident" id="7487126"><a href="/image/jpeg/reader_test.go.html#7487093">y</a></span>&nbsp;<span class="op" id="7487128">&lt;</span>&nbsp;<span class="builtinfunc" id="7487130">len</span><span class="op" id="7487133">(</span><span class="ident" id="7487134"><a href="/image/jpeg/reader_test.go.html#7486818">pix1</a></span><span class="op" id="7487138">)</span><span class="op" id="7487139">/</span><span class="ident" id="7487140"><a href="/image/jpeg/reader_test.go.html#7486840">stride1</a></span><span class="op" id="7487147">;</span>&nbsp;<span class="ident" id="7487149"><a href="/image/jpeg/reader_test.go.html#7487093">y</a></span>&nbsp;<span class="op" id="7487151">+=</span>&nbsp;<span class="num" id="7487154">8</span>&nbsp;<span class="op" id="7487156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487160">for</span>&nbsp;<span class="ident" id="7487164">x</span>&nbsp;<span class="op" id="7487166">:=</span>&nbsp;<span class="num" id="7487169">0</span><span class="op" id="7487170">;</span>&nbsp;<span class="ident" id="7487172"><a href="/image/jpeg/reader_test.go.html#7487164">x</a></span>&nbsp;<span class="op" id="7487174">&lt;</span>&nbsp;<span class="ident" id="7487176"><a href="/image/jpeg/reader_test.go.html#7486831">stride0</a></span>&nbsp;<span class="op" id="7487184">&amp;&amp;</span>&nbsp;<span class="ident" id="7487187"><a href="/image/jpeg/reader_test.go.html#7487164">x</a></span>&nbsp;<span class="op" id="7487189">&lt;</span>&nbsp;<span class="ident" id="7487191"><a href="/image/jpeg/reader_test.go.html#7486840">stride1</a></span><span class="op" id="7487198">;</span>&nbsp;<span class="ident" id="7487200"><a href="/image/jpeg/reader_test.go.html#7487164">x</a></span>&nbsp;<span class="op" id="7487202">+=</span>&nbsp;<span class="num" id="7487205">8</span>&nbsp;<span class="op" id="7487207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487212">if</span>&nbsp;<span class="ident" id="7487215"><a href="/image/jpeg/reader_test.go.html#7487164">x</a></span>&nbsp;<span class="op" id="7487217">&gt;=</span>&nbsp;<span class="ident" id="7487220"><a href="/image/jpeg/reader_test.go.html#7486788">bounds</a></span><span class="op" id="7487226">.</span><span class="ident" id="7487227">Max</span><span class="op" id="7487230">.</span><span class="ident" id="7487231">X</span>&nbsp;<span class="op" id="7487233">||</span>&nbsp;<span class="ident" id="7487236"><a href="/image/jpeg/reader_test.go.html#7487093">y</a></span>&nbsp;<span class="op" id="7487238">&gt;=</span>&nbsp;<span class="ident" id="7487241"><a href="/image/jpeg/reader_test.go.html#7486788">bounds</a></span><span class="op" id="7487247">.</span><span class="ident" id="7487248">Max</span><span class="op" id="7487251">.</span><span class="ident" id="7487252">Y</span>&nbsp;<span class="op" id="7487254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7487260">//&nbsp;We&nbsp;don&#39;t&nbsp;care&nbsp;if&nbsp;the&nbsp;two&nbsp;pix&nbsp;data&nbsp;differ&nbsp;if&nbsp;the&nbsp;8x8&nbsp;block&nbsp;is</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7487328">//&nbsp;entirely&nbsp;outside&nbsp;of&nbsp;the&nbsp;image&#39;s&nbsp;bounds.&nbsp;For&nbsp;example,&nbsp;this&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7487397">//&nbsp;occur&nbsp;with&nbsp;a&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling&nbsp;and&nbsp;a&nbsp;1x1&nbsp;image.&nbsp;Baseline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7487468">//&nbsp;decoding&nbsp;works&nbsp;on&nbsp;the&nbsp;one&nbsp;16x16&nbsp;MCU&nbsp;as&nbsp;a&nbsp;whole;&nbsp;progressive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7487535">//&nbsp;decoding&#39;s&nbsp;first&nbsp;pass&nbsp;works&nbsp;on&nbsp;that&nbsp;16x16&nbsp;MCU&nbsp;as&nbsp;a&nbsp;whole&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7487603">//&nbsp;refinement&nbsp;passes&nbsp;only&nbsp;process&nbsp;one&nbsp;8x8&nbsp;block&nbsp;within&nbsp;the&nbsp;MCU.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487671">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487689">for</span>&nbsp;<span class="ident" id="7487693">j</span>&nbsp;<span class="op" id="7487695">:=</span>&nbsp;<span class="num" id="7487698">0</span><span class="op" id="7487699">;</span>&nbsp;<span class="ident" id="7487701"><a href="/image/jpeg/reader_test.go.html#7487693">j</a></span>&nbsp;<span class="op" id="7487703">&lt;</span>&nbsp;<span class="num" id="7487705">8</span><span class="op" id="7487706">;</span>&nbsp;<span class="ident" id="7487708"><a href="/image/jpeg/reader_test.go.html#7487693">j</a></span><span class="op" id="7487709">++</span>&nbsp;<span class="op" id="7487712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487718">for</span>&nbsp;<span class="ident" id="7487722">i</span>&nbsp;<span class="op" id="7487724">:=</span>&nbsp;<span class="num" id="7487727">0</span><span class="op" id="7487728">;</span>&nbsp;<span class="ident" id="7487730"><a href="/image/jpeg/reader_test.go.html#7487722">i</a></span>&nbsp;<span class="op" id="7487732">&lt;</span>&nbsp;<span class="num" id="7487734">8</span><span class="op" id="7487735">;</span>&nbsp;<span class="ident" id="7487737"><a href="/image/jpeg/reader_test.go.html#7487722">i</a></span><span class="op" id="7487738">++</span>&nbsp;<span class="op" id="7487741">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487748">index0</span>&nbsp;<span class="op" id="7487755">:=</span>&nbsp;<span class="op" id="7487758">(</span><span class="ident" id="7487759"><a href="/image/jpeg/reader_test.go.html#7487093">y</a></span><span class="op" id="7487760">+</span><span class="ident" id="7487761"><a href="/image/jpeg/reader_test.go.html#7487693">j</a></span><span class="op" id="7487762">)</span><span class="op" id="7487763">*</span><span class="ident" id="7487764"><a href="/image/jpeg/reader_test.go.html#7486831">stride0</a></span>&nbsp;<span class="op" id="7487772">+</span>&nbsp;<span class="op" id="7487774">(</span><span class="ident" id="7487775"><a href="/image/jpeg/reader_test.go.html#7487164">x</a></span>&nbsp;<span class="op" id="7487777">+</span>&nbsp;<span class="ident" id="7487779"><a href="/image/jpeg/reader_test.go.html#7487722">i</a></span><span class="op" id="7487780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487787">index1</span>&nbsp;<span class="op" id="7487794">:=</span>&nbsp;<span class="op" id="7487797">(</span><span class="ident" id="7487798"><a href="/image/jpeg/reader_test.go.html#7487093">y</a></span><span class="op" id="7487799">+</span><span class="ident" id="7487800"><a href="/image/jpeg/reader_test.go.html#7487693">j</a></span><span class="op" id="7487801">)</span><span class="op" id="7487802">*</span><span class="ident" id="7487803"><a href="/image/jpeg/reader_test.go.html#7486840">stride1</a></span>&nbsp;<span class="op" id="7487811">+</span>&nbsp;<span class="op" id="7487813">(</span><span class="ident" id="7487814"><a href="/image/jpeg/reader_test.go.html#7487164">x</a></span>&nbsp;<span class="op" id="7487816">+</span>&nbsp;<span class="ident" id="7487818"><a href="/image/jpeg/reader_test.go.html#7487722">i</a></span><span class="op" id="7487819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487826">if</span>&nbsp;<span class="ident" id="7487829"><a href="/image/jpeg/reader_test.go.html#7486812">pix0</a></span><span class="op" id="7487833">[</span><span class="ident" id="7487834"><a href="/image/jpeg/reader_test.go.html#7487748">index0</a></span><span class="op" id="7487840">]</span>&nbsp;<span class="op" id="7487842">!=</span>&nbsp;<span class="ident" id="7487845"><a href="/image/jpeg/reader_test.go.html#7486818">pix1</a></span><span class="op" id="7487849">[</span><span class="ident" id="7487850"><a href="/image/jpeg/reader_test.go.html#7487787">index1</a></span><span class="op" id="7487856">]</span>&nbsp;<span class="op" id="7487858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487866">return</span>&nbsp;<span class="ident" id="7487873"><a href="/image/jpeg/reader_test.go.html#7483638">fmt</a></span><span class="op" id="7487876">.</span><span class="ident" id="7487877">Errorf</span><span class="op" id="7487883">(</span><span class="string" id="7487884">&#34;blocks&nbsp;at&nbsp;(%d,&nbsp;%d)&nbsp;differ:\n%sand\n%s&#34;</span><span class="op" id="7487923">,</span>&nbsp;<span class="ident" id="7487925"><a href="/image/jpeg/reader_test.go.html#7487164">x</a></span><span class="op" id="7487926">,</span>&nbsp;<span class="ident" id="7487928"><a href="/image/jpeg/reader_test.go.html#7487093">y</a></span><span class="op" id="7487929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487938"><a href="/image/jpeg/reader_test.go.html#7488062">pixString</a></span><span class="op" id="7487947">(</span><span class="ident" id="7487948"><a href="/image/jpeg/reader_test.go.html#7486812">pix0</a></span><span class="op" id="7487952">,</span>&nbsp;<span class="ident" id="7487954"><a href="/image/jpeg/reader_test.go.html#7486831">stride0</a></span><span class="op" id="7487961">,</span>&nbsp;<span class="ident" id="7487963"><a href="/image/jpeg/reader_test.go.html#7487164">x</a></span><span class="op" id="7487964">,</span>&nbsp;<span class="ident" id="7487966"><a href="/image/jpeg/reader_test.go.html#7487093">y</a></span><span class="op" id="7487967">)</span><span class="op" id="7487968">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487977"><a href="/image/jpeg/reader_test.go.html#7488062">pixString</a></span><span class="op" id="7487986">(</span><span class="ident" id="7487987"><a href="/image/jpeg/reader_test.go.html#7486818">pix1</a></span><span class="op" id="7487991">,</span>&nbsp;<span class="ident" id="7487993"><a href="/image/jpeg/reader_test.go.html#7486840">stride1</a></span><span class="op" id="7488000">,</span>&nbsp;<span class="ident" id="7488002"><a href="/image/jpeg/reader_test.go.html#7487164">x</a></span><span class="op" id="7488003">,</span>&nbsp;<span class="ident" id="7488005"><a href="/image/jpeg/reader_test.go.html#7487093">y</a></span><span class="op" id="7488006">)</span><span class="op" id="7488007">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488033">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488043">return</span>&nbsp;<span class="ident" id="7488050">nil</span><br>
<span class="lineno"></span><span class="op" id="7488054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="7488057">func</span>&nbsp;<span class="ident" id="7488062">pixString</span><span class="op" id="7488071">(</span><span class="ident" id="7488072">pix</span>&nbsp;<span class="op" id="7488076">[</span><span class="op" id="7488077">]</span><span class="builtintype" id="7488078">byte</span><span class="op" id="7488082">,</span>&nbsp;<span class="ident" id="7488084">stride</span><span class="op" id="7488090">,</span>&nbsp;<span class="ident" id="7488092">x</span><span class="op" id="7488093">,</span>&nbsp;<span class="ident" id="7488095">y</span>&nbsp;<span class="builtintype" id="7488097">int</span><span class="op" id="7488100">)</span>&nbsp;<span class="builtintype" id="7488102">string</span>&nbsp;<span class="op" id="7488109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488112">s</span>&nbsp;<span class="op" id="7488114">:=</span>&nbsp;<span class="ident" id="7488117"><a href="/image/jpeg/reader_test.go.html#7483629">bytes</a></span><span class="op" id="7488122">.</span><span class="ident" id="7488123">NewBuffer</span><span class="op" id="7488132">(</span><span class="ident" id="7488133">nil</span><span class="op" id="7488136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488139">for</span>&nbsp;<span class="ident" id="7488143">j</span>&nbsp;<span class="op" id="7488145">:=</span>&nbsp;<span class="num" id="7488148">0</span><span class="op" id="7488149">;</span>&nbsp;<span class="ident" id="7488151"><a href="/image/jpeg/reader_test.go.html#7488143">j</a></span>&nbsp;<span class="op" id="7488153">&lt;</span>&nbsp;<span class="num" id="7488155">8</span><span class="op" id="7488156">;</span>&nbsp;<span class="ident" id="7488158"><a href="/image/jpeg/reader_test.go.html#7488143">j</a></span><span class="op" id="7488159">++</span>&nbsp;<span class="op" id="7488162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488166"><a href="/image/jpeg/reader_test.go.html#7483638">fmt</a></span><span class="op" id="7488169">.</span><span class="ident" id="7488170">Fprintf</span><span class="op" id="7488177">(</span><span class="ident" id="7488178"><a href="/image/jpeg/reader_test.go.html#7488112">s</a></span><span class="op" id="7488179">,</span>&nbsp;<span class="string" id="7488181">&#34;\t&#34;</span><span class="op" id="7488185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488189">for</span>&nbsp;<span class="ident" id="7488193">i</span>&nbsp;<span class="op" id="7488195">:=</span>&nbsp;<span class="num" id="7488198">0</span><span class="op" id="7488199">;</span>&nbsp;<span class="ident" id="7488201"><a href="/image/jpeg/reader_test.go.html#7488193">i</a></span>&nbsp;<span class="op" id="7488203">&lt;</span>&nbsp;<span class="num" id="7488205">8</span><span class="op" id="7488206">;</span>&nbsp;<span class="ident" id="7488208"><a href="/image/jpeg/reader_test.go.html#7488193">i</a></span><span class="op" id="7488209">++</span>&nbsp;<span class="op" id="7488212">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488217"><a href="/image/jpeg/reader_test.go.html#7483638">fmt</a></span><span class="op" id="7488220">.</span><span class="ident" id="7488221">Fprintf</span><span class="op" id="7488228">(</span><span class="ident" id="7488229"><a href="/image/jpeg/reader_test.go.html#7488112">s</a></span><span class="op" id="7488230">,</span>&nbsp;<span class="string" id="7488232">&#34;%02x&nbsp;&#34;</span><span class="op" id="7488239">,</span>&nbsp;<span class="ident" id="7488241"><a href="/image/jpeg/reader_test.go.html#7488072">pix</a></span><span class="op" id="7488244">[</span><span class="op" id="7488245">(</span><span class="ident" id="7488246"><a href="/image/jpeg/reader_test.go.html#7488095">y</a></span><span class="op" id="7488247">+</span><span class="ident" id="7488248"><a href="/image/jpeg/reader_test.go.html#7488143">j</a></span><span class="op" id="7488249">)</span><span class="op" id="7488250">*</span><span class="ident" id="7488251"><a href="/image/jpeg/reader_test.go.html#7488084">stride</a></span><span class="op" id="7488257">+</span><span class="op" id="7488258">(</span><span class="ident" id="7488259"><a href="/image/jpeg/reader_test.go.html#7488092">x</a></span><span class="op" id="7488260">+</span><span class="ident" id="7488261"><a href="/image/jpeg/reader_test.go.html#7488193">i</a></span><span class="op" id="7488262">)</span><span class="op" id="7488263">]</span><span class="op" id="7488264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488272"><a href="/image/jpeg/reader_test.go.html#7483638">fmt</a></span><span class="op" id="7488275">.</span><span class="ident" id="7488276">Fprintf</span><span class="op" id="7488283">(</span><span class="ident" id="7488284"><a href="/image/jpeg/reader_test.go.html#7488112">s</a></span><span class="op" id="7488285">,</span>&nbsp;<span class="string" id="7488287">&#34;\n&#34;</span><span class="op" id="7488291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488297">return</span>&nbsp;<span class="ident" id="7488304"><a href="/image/jpeg/reader_test.go.html#7488112">s</a></span><span class="op" id="7488305">.</span><span class="ident" id="7488306">String</span><span class="op" id="7488312">(</span><span class="op" id="7488313">)</span><br>
<span class="lineno">185</span><span class="op" id="7488315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7488318">func</span>&nbsp;<span class="ident" id="7488323">TestExtraneousData</span><span class="op" id="7488341">(</span><span class="ident" id="7488342">t</span>&nbsp;<span class="op" id="7488344">*</span><span class="ident" id="7488345"><a href="/image/jpeg/reader_test.go.html#7483718">testing</a></span><span class="op" id="7488352">.</span><span class="ident" id="7488353">T</span><span class="op" id="7488354">)</span>&nbsp;<span class="op" id="7488356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7488359">//&nbsp;Encode&nbsp;a&nbsp;1x1&nbsp;red&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488387">src</span>&nbsp;<span class="op" id="7488391">:=</span>&nbsp;<span class="ident" id="7488394"><a href="/image/jpeg/reader_test.go.html#7483645">image</a></span><span class="op" id="7488399">.</span><span class="ident" id="7488400">NewRGBA</span><span class="op" id="7488407">(</span><span class="ident" id="7488408"><a href="/image/jpeg/reader_test.go.html#7483645">image</a></span><span class="op" id="7488413">.</span><span class="ident" id="7488414">Rect</span><span class="op" id="7488418">(</span><span class="num" id="7488419">0</span><span class="op" id="7488420">,</span>&nbsp;<span class="num" id="7488422">0</span><span class="op" id="7488423">,</span>&nbsp;<span class="num" id="7488425">1</span><span class="op" id="7488426">,</span>&nbsp;<span class="num" id="7488428">1</span><span class="op" id="7488429">)</span><span class="op" id="7488430">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488433"><a href="/image/jpeg/reader_test.go.html#7488387">src</a></span><span class="op" id="7488436">.</span><span class="ident" id="7488437">Set</span><span class="op" id="7488440">(</span><span class="num" id="7488441">0</span><span class="op" id="7488442">,</span>&nbsp;<span class="num" id="7488444">0</span><span class="op" id="7488445">,</span>&nbsp;<span class="ident" id="7488447"><a href="/image/jpeg/reader_test.go.html#7483654">color</a></span><span class="op" id="7488452">.</span><span class="ident" id="7488453">RGBA</span><span class="op" id="7488457">{</span><span class="num" id="7488458">0xff</span><span class="op" id="7488462">,</span>&nbsp;<span class="num" id="7488464">0x00</span><span class="op" id="7488468">,</span>&nbsp;<span class="num" id="7488470">0x00</span><span class="op" id="7488474">,</span>&nbsp;<span class="num" id="7488476">0xff</span><span class="op" id="7488480">}</span><span class="op" id="7488481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488484">buf</span>&nbsp;<span class="op" id="7488488">:=</span>&nbsp;<span class="builtinfunc" id="7488491">new</span><span class="op" id="7488494">(</span><span class="ident" id="7488495"><a href="/image/jpeg/reader_test.go.html#7483629">bytes</a></span><span class="op" id="7488500">.</span><span class="ident" id="7488501">Buffer</span><span class="op" id="7488507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488510">if</span>&nbsp;<span class="ident" id="7488513">err</span>&nbsp;<span class="op" id="7488517">:=</span>&nbsp;<span class="ident" id="7488520"><a href="/image/jpeg/writer.go.html#5446040">Encode</a></span><span class="op" id="7488526">(</span><span class="ident" id="7488527"><a href="/image/jpeg/reader_test.go.html#7488484">buf</a></span><span class="op" id="7488530">,</span>&nbsp;<span class="ident" id="7488532"><a href="/image/jpeg/reader_test.go.html#7488387">src</a></span><span class="op" id="7488535">,</span>&nbsp;<span class="ident" id="7488537">nil</span><span class="op" id="7488540">)</span><span class="op" id="7488541">;</span>&nbsp;<span class="ident" id="7488543"><a href="/image/jpeg/reader_test.go.html#7488513">err</a></span>&nbsp;<span class="op" id="7488547">!=</span>&nbsp;<span class="ident" id="7488550">nil</span>&nbsp;<span class="op" id="7488554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488558"><a href="/image/jpeg/reader_test.go.html#7488342">t</a></span><span class="op" id="7488559">.</span><span class="ident" id="7488560">Fatalf</span><span class="op" id="7488566">(</span><span class="string" id="7488567">&#34;encode:&nbsp;%v&#34;</span><span class="op" id="7488579">,</span>&nbsp;<span class="ident" id="7488581"><a href="/image/jpeg/reader_test.go.html#7488513">err</a></span><span class="op" id="7488584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488587">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488590">enc</span>&nbsp;<span class="op" id="7488594">:=</span>&nbsp;<span class="ident" id="7488597"><a href="/image/jpeg/reader_test.go.html#7488484">buf</a></span><span class="op" id="7488600">.</span><span class="ident" id="7488601">String</span><span class="op" id="7488607">(</span><span class="op" id="7488608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7488611">//&nbsp;Sanity&nbsp;check&nbsp;that&nbsp;the&nbsp;encoded&nbsp;JPEG&nbsp;is&nbsp;long&nbsp;enough,&nbsp;that&nbsp;it&nbsp;ends&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7488684">//&nbsp;&#34;\xff\xd9&#34;&nbsp;EOI&nbsp;marker,&nbsp;and&nbsp;that&nbsp;it&nbsp;contains&nbsp;a&nbsp;&#34;\xff\xda&#34;&nbsp;SOS&nbsp;marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7488756">//&nbsp;somewhere&nbsp;in&nbsp;the&nbsp;final&nbsp;64&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488793">if</span>&nbsp;<span class="builtinfunc" id="7488796">len</span><span class="op" id="7488799">(</span><span class="ident" id="7488800"><a href="/image/jpeg/reader_test.go.html#7488590">enc</a></span><span class="op" id="7488803">)</span>&nbsp;<span class="op" id="7488805">&lt;</span>&nbsp;<span class="num" id="7488807">64</span>&nbsp;<span class="op" id="7488810">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488814"><a href="/image/jpeg/reader_test.go.html#7488342">t</a></span><span class="op" id="7488815">.</span><span class="ident" id="7488816">Fatalf</span><span class="op" id="7488822">(</span><span class="string" id="7488823">&#34;encoded&nbsp;JPEG&nbsp;is&nbsp;too&nbsp;short:&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="7488860">,</span>&nbsp;<span class="builtinfunc" id="7488862">len</span><span class="op" id="7488865">(</span><span class="ident" id="7488866"><a href="/image/jpeg/reader_test.go.html#7488590">enc</a></span><span class="op" id="7488869">)</span><span class="op" id="7488870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488876">if</span>&nbsp;<span class="ident" id="7488879">got</span><span class="op" id="7488882">,</span>&nbsp;<span class="ident" id="7488884">want</span>&nbsp;<span class="op" id="7488889">:=</span>&nbsp;<span class="ident" id="7488892"><a href="/image/jpeg/reader_test.go.html#7488590">enc</a></span><span class="op" id="7488895">[</span><span class="builtinfunc" id="7488896">len</span><span class="op" id="7488899">(</span><span class="ident" id="7488900"><a href="/image/jpeg/reader_test.go.html#7488590">enc</a></span><span class="op" id="7488903">)</span><span class="op" id="7488904">-</span><span class="num" id="7488905">2</span><span class="op" id="7488906">:</span><span class="op" id="7488907">]</span><span class="op" id="7488908">,</span>&nbsp;<span class="string" id="7488910">&#34;\xff\xd9&#34;</span><span class="op" id="7488920">;</span>&nbsp;<span class="ident" id="7488922"><a href="/image/jpeg/reader_test.go.html#7488879">got</a></span>&nbsp;<span class="op" id="7488926">!=</span>&nbsp;<span class="ident" id="7488929"><a href="/image/jpeg/reader_test.go.html#7488884">want</a></span>&nbsp;<span class="op" id="7488934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488938"><a href="/image/jpeg/reader_test.go.html#7488342">t</a></span><span class="op" id="7488939">.</span><span class="ident" id="7488940">Fatalf</span><span class="op" id="7488946">(</span><span class="string" id="7488947">&#34;encoded&nbsp;JPEG&nbsp;ends&nbsp;with&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7488983">,</span>&nbsp;<span class="ident" id="7488985"><a href="/image/jpeg/reader_test.go.html#7488879">got</a></span><span class="op" id="7488988">,</span>&nbsp;<span class="ident" id="7488990"><a href="/image/jpeg/reader_test.go.html#7488884">want</a></span><span class="op" id="7488994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488997">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7489000">if</span>&nbsp;<span class="ident" id="7489003">s</span>&nbsp;<span class="op" id="7489005">:=</span>&nbsp;<span class="ident" id="7489008"><a href="/image/jpeg/reader_test.go.html#7488590">enc</a></span><span class="op" id="7489011">[</span><span class="builtinfunc" id="7489012">len</span><span class="op" id="7489015">(</span><span class="ident" id="7489016"><a href="/image/jpeg/reader_test.go.html#7488590">enc</a></span><span class="op" id="7489019">)</span><span class="op" id="7489020">-</span><span class="num" id="7489021">64</span><span class="op" id="7489023">:</span><span class="op" id="7489024">]</span><span class="op" id="7489025">;</span>&nbsp;<span class="op" id="7489027">!</span><span class="ident" id="7489028"><a href="/image/jpeg/reader_test.go.html#7483707">strings</a></span><span class="op" id="7489035">.</span><span class="ident" id="7489036">Contains</span><span class="op" id="7489044">(</span><span class="ident" id="7489045"><a href="/image/jpeg/reader_test.go.html#7489003">s</a></span><span class="op" id="7489046">,</span>&nbsp;<span class="string" id="7489048">&#34;\xff\xda&#34;</span><span class="op" id="7489058">)</span>&nbsp;<span class="op" id="7489060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489064"><a href="/image/jpeg/reader_test.go.html#7488342">t</a></span><span class="op" id="7489065">.</span><span class="ident" id="7489066">Fatalf</span><span class="op" id="7489072">(</span><span class="string" id="7489073">&#34;encoded&nbsp;JPEG&nbsp;does&nbsp;not&nbsp;contain&nbsp;a&nbsp;SOS&nbsp;marker&nbsp;(ff&nbsp;da)&nbsp;near&nbsp;the&nbsp;end:&nbsp;%&nbsp;x&#34;</span><span class="op" id="7489143">,</span>&nbsp;<span class="ident" id="7489145"><a href="/image/jpeg/reader_test.go.html#7489003">s</a></span><span class="op" id="7489146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7489149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7489152">//&nbsp;Test&nbsp;that&nbsp;adding&nbsp;some&nbsp;random&nbsp;junk&nbsp;between&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7489221">//&nbsp;EOI&nbsp;marker&nbsp;does&nbsp;not&nbsp;affect&nbsp;the&nbsp;decoding.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489266">rnd</span>&nbsp;<span class="op" id="7489270">:=</span>&nbsp;<span class="ident" id="7489273"><a href="/image/jpeg/reader_test.go.html#7483688">rand</a></span><span class="op" id="7489277">.</span><span class="ident" id="7489278">New</span><span class="op" id="7489281">(</span><span class="ident" id="7489282"><a href="/image/jpeg/reader_test.go.html#7483688">rand</a></span><span class="op" id="7489286">.</span><span class="ident" id="7489287">NewSource</span><span class="op" id="7489296">(</span><span class="num" id="7489297">1</span><span class="op" id="7489298">)</span><span class="op" id="7489299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7489302">for</span>&nbsp;<span class="ident" id="7489306">i</span><span class="op" id="7489307">,</span>&nbsp;<span class="ident" id="7489309">nerr</span>&nbsp;<span class="op" id="7489314">:=</span>&nbsp;<span class="num" id="7489317">0</span><span class="op" id="7489318">,</span>&nbsp;<span class="num" id="7489320">0</span><span class="op" id="7489321">;</span>&nbsp;<span class="ident" id="7489323"><a href="/image/jpeg/reader_test.go.html#7489306">i</a></span>&nbsp;<span class="op" id="7489325">&lt;</span>&nbsp;<span class="num" id="7489327">1000</span>&nbsp;<span class="op" id="7489332">&amp;&amp;</span>&nbsp;<span class="ident" id="7489335"><a href="/image/jpeg/reader_test.go.html#7489309">nerr</a></span>&nbsp;<span class="op" id="7489340">&lt;</span>&nbsp;<span class="num" id="7489342">10</span><span class="op" id="7489344">;</span>&nbsp;<span class="ident" id="7489346"><a href="/image/jpeg/reader_test.go.html#7489306">i</a></span><span class="op" id="7489347">++</span>&nbsp;<span class="op" id="7489350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489354"><a href="/image/jpeg/reader_test.go.html#7488484">buf</a></span><span class="op" id="7489357">.</span><span class="ident" id="7489358">Reset</span><span class="op" id="7489363">(</span><span class="op" id="7489364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7489368">//&nbsp;Write&nbsp;all&nbsp;but&nbsp;the&nbsp;trailing&nbsp;&#34;\xff\xd9&#34;&nbsp;EOI&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489423"><a href="/image/jpeg/reader_test.go.html#7488484">buf</a></span><span class="op" id="7489426">.</span><span class="ident" id="7489427">WriteString</span><span class="op" id="7489438">(</span><span class="ident" id="7489439"><a href="/image/jpeg/reader_test.go.html#7488590">enc</a></span><span class="op" id="7489442">[</span><span class="op" id="7489443">:</span><span class="builtinfunc" id="7489444">len</span><span class="op" id="7489447">(</span><span class="ident" id="7489448"><a href="/image/jpeg/reader_test.go.html#7488590">enc</a></span><span class="op" id="7489451">)</span><span class="op" id="7489452">-</span><span class="num" id="7489453">2</span><span class="op" id="7489454">]</span><span class="op" id="7489455">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7489459">//&nbsp;Write&nbsp;some&nbsp;random&nbsp;extraneous&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7489499">for</span>&nbsp;<span class="ident" id="7489503">n</span>&nbsp;<span class="op" id="7489505">:=</span>&nbsp;<span class="ident" id="7489508"><a href="/image/jpeg/reader_test.go.html#7489266">rnd</a></span><span class="op" id="7489511">.</span><span class="ident" id="7489512">Intn</span><span class="op" id="7489516">(</span><span class="num" id="7489517">10</span><span class="op" id="7489519">)</span><span class="op" id="7489520">;</span>&nbsp;<span class="ident" id="7489522"><a href="/image/jpeg/reader_test.go.html#7489503">n</a></span>&nbsp;<span class="op" id="7489524">&gt;</span>&nbsp;<span class="num" id="7489526">0</span><span class="op" id="7489527">;</span>&nbsp;<span class="ident" id="7489529"><a href="/image/jpeg/reader_test.go.html#7489503">n</a></span><span class="op" id="7489530">--</span>&nbsp;<span class="op" id="7489533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7489538">if</span>&nbsp;<span class="ident" id="7489541">x</span>&nbsp;<span class="op" id="7489543">:=</span>&nbsp;<span class="builtintype" id="7489546">byte</span><span class="op" id="7489550">(</span><span class="ident" id="7489551"><a href="/image/jpeg/reader_test.go.html#7489266">rnd</a></span><span class="op" id="7489554">.</span><span class="ident" id="7489555">Intn</span><span class="op" id="7489559">(</span><span class="num" id="7489560">256</span><span class="op" id="7489563">)</span><span class="op" id="7489564">)</span><span class="op" id="7489565">;</span>&nbsp;<span class="ident" id="7489567"><a href="/image/jpeg/reader_test.go.html#7489541">x</a></span>&nbsp;<span class="op" id="7489569">!=</span>&nbsp;<span class="num" id="7489572">0xff</span>&nbsp;<span class="op" id="7489577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489583"><a href="/image/jpeg/reader_test.go.html#7488484">buf</a></span><span class="op" id="7489586">.</span><span class="ident" id="7489587">WriteByte</span><span class="op" id="7489596">(</span><span class="ident" id="7489597"><a href="/image/jpeg/reader_test.go.html#7489541">x</a></span><span class="op" id="7489598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7489603">}</span>&nbsp;<span class="keyword" id="7489605">else</span>&nbsp;<span class="op" id="7489610">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7489616">//&nbsp;The&nbsp;JPEG&nbsp;format&nbsp;escapes&nbsp;a&nbsp;SOS&nbsp;0xff&nbsp;data&nbsp;byte&nbsp;as&nbsp;&#34;\xff\x00&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489683"><a href="/image/jpeg/reader_test.go.html#7488484">buf</a></span><span class="op" id="7489686">.</span><span class="ident" id="7489687">WriteString</span><span class="op" id="7489698">(</span><span class="string" id="7489699">&#34;\xff\x00&#34;</span><span class="op" id="7489709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7489714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7489718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7489722">//&nbsp;Write&nbsp;the&nbsp;&#34;\xff\xd9&#34;&nbsp;EOI&nbsp;marker.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489760"><a href="/image/jpeg/reader_test.go.html#7488484">buf</a></span><span class="op" id="7489763">.</span><span class="ident" id="7489764">WriteString</span><span class="op" id="7489775">(</span><span class="string" id="7489776">&#34;\xff\xd9&#34;</span><span class="op" id="7489786">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7489791">//&nbsp;Check&nbsp;that&nbsp;we&nbsp;can&nbsp;still&nbsp;decode&nbsp;the&nbsp;resultant&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489848">got</span><span class="op" id="7489851">,</span>&nbsp;<span class="ident" id="7489853">err</span>&nbsp;<span class="op" id="7489857">:=</span>&nbsp;<span class="ident" id="7489860"><a href="/image/jpeg/reader.go.html#5417124">Decode</a></span><span class="op" id="7489866">(</span><span class="ident" id="7489867"><a href="/image/jpeg/reader_test.go.html#7488484">buf</a></span><span class="op" id="7489870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7489874">if</span>&nbsp;<span class="ident" id="7489877"><a href="/image/jpeg/reader_test.go.html#7489853">err</a></span>&nbsp;<span class="op" id="7489881">!=</span>&nbsp;<span class="ident" id="7489884">nil</span>&nbsp;<span class="op" id="7489888">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489893"><a href="/image/jpeg/reader_test.go.html#7488342">t</a></span><span class="op" id="7489894">.</span><span class="ident" id="7489895">Errorf</span><span class="op" id="7489901">(</span><span class="string" id="7489902">&#34;could&nbsp;not&nbsp;decode&nbsp;image&nbsp;#%d:&nbsp;%v&#34;</span><span class="op" id="7489934">,</span>&nbsp;<span class="ident" id="7489936"><a href="/image/jpeg/reader_test.go.html#7489306">i</a></span><span class="op" id="7489937">,</span>&nbsp;<span class="ident" id="7489939"><a href="/image/jpeg/reader_test.go.html#7489853">err</a></span><span class="op" id="7489942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489947"><a href="/image/jpeg/reader_test.go.html#7489309">nerr</a></span><span class="op" id="7489951">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7489957">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7489968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7489972">if</span>&nbsp;<span class="ident" id="7489975"><a href="/image/jpeg/reader_test.go.html#7489848">got</a></span><span class="op" id="7489978">.</span><span class="ident" id="7489979">Bounds</span><span class="op" id="7489985">(</span><span class="op" id="7489986">)</span>&nbsp;<span class="op" id="7489988">!=</span>&nbsp;<span class="ident" id="7489991"><a href="/image/jpeg/reader_test.go.html#7488387">src</a></span><span class="op" id="7489994">.</span><span class="ident" id="7489995">Bounds</span><span class="op" id="7490001">(</span><span class="op" id="7490002">)</span>&nbsp;<span class="op" id="7490004">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490009"><a href="/image/jpeg/reader_test.go.html#7488342">t</a></span><span class="op" id="7490010">.</span><span class="ident" id="7490011">Errorf</span><span class="op" id="7490017">(</span><span class="string" id="7490018">&#34;image&nbsp;#%d,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7490055">,</span>&nbsp;<span class="ident" id="7490057"><a href="/image/jpeg/reader_test.go.html#7489306">i</a></span><span class="op" id="7490058">,</span>&nbsp;<span class="ident" id="7490060"><a href="/image/jpeg/reader_test.go.html#7489848">got</a></span><span class="op" id="7490063">.</span><span class="ident" id="7490064">Bounds</span><span class="op" id="7490070">(</span><span class="op" id="7490071">)</span><span class="op" id="7490072">,</span>&nbsp;<span class="ident" id="7490074"><a href="/image/jpeg/reader_test.go.html#7488387">src</a></span><span class="op" id="7490077">.</span><span class="ident" id="7490078">Bounds</span><span class="op" id="7490084">(</span><span class="op" id="7490085">)</span><span class="op" id="7490086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490091"><a href="/image/jpeg/reader_test.go.html#7489309">nerr</a></span><span class="op" id="7490095">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7490101">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7490116">if</span>&nbsp;<span class="ident" id="7490119"><a href="/image/jpeg/writer_test.go.html#7495695">averageDelta</a></span><span class="op" id="7490131">(</span><span class="ident" id="7490132"><a href="/image/jpeg/reader_test.go.html#7489848">got</a></span><span class="op" id="7490135">,</span>&nbsp;<span class="ident" id="7490137"><a href="/image/jpeg/reader_test.go.html#7488387">src</a></span><span class="op" id="7490140">)</span>&nbsp;<span class="op" id="7490142">&gt;</span>&nbsp;<span class="num" id="7490144">2</span><span class="op" id="7490145">&lt;&lt;</span><span class="num" id="7490147">8</span>&nbsp;<span class="op" id="7490149">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490154"><a href="/image/jpeg/reader_test.go.html#7488342">t</a></span><span class="op" id="7490155">.</span><span class="ident" id="7490156">Errorf</span><span class="op" id="7490162">(</span><span class="string" id="7490163">&#34;image&nbsp;#%d&nbsp;changed&nbsp;too&nbsp;much&nbsp;after&nbsp;a&nbsp;round&nbsp;trip&#34;</span><span class="op" id="7490210">,</span>&nbsp;<span class="ident" id="7490212"><a href="/image/jpeg/reader_test.go.html#7489306">i</a></span><span class="op" id="7490213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490218"><a href="/image/jpeg/reader_test.go.html#7489309">nerr</a></span><span class="op" id="7490222">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7490228">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490242">}</span><br>
<span class="lineno">245</span><span class="op" id="7490244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7490247">func</span>&nbsp;<span class="ident" id="7490252">benchmarkDecode</span><span class="op" id="7490267">(</span><span class="ident" id="7490268">b</span>&nbsp;<span class="op" id="7490270">*</span><span class="ident" id="7490271"><a href="/image/jpeg/reader_test.go.html#7483718">testing</a></span><span class="op" id="7490278">.</span><span class="ident" id="7490279">B</span><span class="op" id="7490280">,</span>&nbsp;<span class="ident" id="7490282">filename</span>&nbsp;<span class="builtintype" id="7490291">string</span><span class="op" id="7490297">)</span>&nbsp;<span class="op" id="7490299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490302"><a href="/image/jpeg/reader_test.go.html#7490268">b</a></span><span class="op" id="7490303">.</span><span class="ident" id="7490304">StopTimer</span><span class="op" id="7490313">(</span><span class="op" id="7490314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490317">data</span><span class="op" id="7490321">,</span>&nbsp;<span class="ident" id="7490323">err</span>&nbsp;<span class="op" id="7490327">:=</span>&nbsp;<span class="ident" id="7490330"><a href="/image/jpeg/reader_test.go.html#7483675">ioutil</a></span><span class="op" id="7490336">.</span><span class="ident" id="7490337">ReadFile</span><span class="op" id="7490345">(</span><span class="ident" id="7490346"><a href="/image/jpeg/reader_test.go.html#7490282">filename</a></span><span class="op" id="7490354">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7490357">if</span>&nbsp;<span class="ident" id="7490360"><a href="/image/jpeg/reader_test.go.html#7490323">err</a></span>&nbsp;<span class="op" id="7490364">!=</span>&nbsp;<span class="ident" id="7490367">nil</span>&nbsp;<span class="op" id="7490371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490375"><a href="/image/jpeg/reader_test.go.html#7490268">b</a></span><span class="op" id="7490376">.</span><span class="ident" id="7490377">Fatal</span><span class="op" id="7490382">(</span><span class="ident" id="7490383"><a href="/image/jpeg/reader_test.go.html#7490323">err</a></span><span class="op" id="7490386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490392">cfg</span><span class="op" id="7490395">,</span>&nbsp;<span class="ident" id="7490397"><a href="/image/jpeg/reader_test.go.html#7490323">err</a></span>&nbsp;<span class="op" id="7490401">:=</span>&nbsp;<span class="ident" id="7490404"><a href="/image/jpeg/reader.go.html#5417326">DecodeConfig</a></span><span class="op" id="7490416">(</span><span class="ident" id="7490417"><a href="/image/jpeg/reader_test.go.html#7483629">bytes</a></span><span class="op" id="7490422">.</span><span class="ident" id="7490423">NewReader</span><span class="op" id="7490432">(</span><span class="ident" id="7490433"><a href="/image/jpeg/reader_test.go.html#7490317">data</a></span><span class="op" id="7490437">)</span><span class="op" id="7490438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7490441">if</span>&nbsp;<span class="ident" id="7490444"><a href="/image/jpeg/reader_test.go.html#7490323">err</a></span>&nbsp;<span class="op" id="7490448">!=</span>&nbsp;<span class="ident" id="7490451">nil</span>&nbsp;<span class="op" id="7490455">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490459"><a href="/image/jpeg/reader_test.go.html#7490268">b</a></span><span class="op" id="7490460">.</span><span class="ident" id="7490461">Fatal</span><span class="op" id="7490466">(</span><span class="ident" id="7490467"><a href="/image/jpeg/reader_test.go.html#7490323">err</a></span><span class="op" id="7490470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490476"><a href="/image/jpeg/reader_test.go.html#7490268">b</a></span><span class="op" id="7490477">.</span><span class="ident" id="7490478">SetBytes</span><span class="op" id="7490486">(</span><span class="ident" id="7490487">int64</span><span class="op" id="7490492">(</span><span class="ident" id="7490493"><a href="/image/jpeg/reader_test.go.html#7490392">cfg</a></span><span class="op" id="7490496">.</span><span class="ident" id="7490497">Width</span>&nbsp;<span class="op" id="7490503">*</span>&nbsp;<span class="ident" id="7490505"><a href="/image/jpeg/reader_test.go.html#7490392">cfg</a></span><span class="op" id="7490508">.</span><span class="ident" id="7490509">Height</span>&nbsp;<span class="op" id="7490516">*</span>&nbsp;<span class="num" id="7490518">4</span><span class="op" id="7490519">)</span><span class="op" id="7490520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490523"><a href="/image/jpeg/reader_test.go.html#7490268">b</a></span><span class="op" id="7490524">.</span><span class="ident" id="7490525">StartTimer</span><span class="op" id="7490535">(</span><span class="op" id="7490536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7490539">for</span>&nbsp;<span class="ident" id="7490543">i</span>&nbsp;<span class="op" id="7490545">:=</span>&nbsp;<span class="num" id="7490548">0</span><span class="op" id="7490549">;</span>&nbsp;<span class="ident" id="7490551"><a href="/image/jpeg/reader_test.go.html#7490543">i</a></span>&nbsp;<span class="op" id="7490553">&lt;</span>&nbsp;<span class="ident" id="7490555"><a href="/image/jpeg/reader_test.go.html#7490268">b</a></span><span class="op" id="7490556">.</span><span class="ident" id="7490557">N</span><span class="op" id="7490558">;</span>&nbsp;<span class="ident" id="7490560"><a href="/image/jpeg/reader_test.go.html#7490543">i</a></span><span class="op" id="7490561">++</span>&nbsp;<span class="op" id="7490564">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490568"><a href="/image/jpeg/reader.go.html#5417124">Decode</a></span><span class="op" id="7490574">(</span><span class="ident" id="7490575"><a href="/image/jpeg/reader_test.go.html#7483629">bytes</a></span><span class="op" id="7490580">.</span><span class="ident" id="7490581">NewReader</span><span class="op" id="7490590">(</span><span class="ident" id="7490591"><a href="/image/jpeg/reader_test.go.html#7490317">data</a></span><span class="op" id="7490595">)</span><span class="op" id="7490596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490599">}</span><br>
<span class="lineno"></span><span class="op" id="7490601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7490604">func</span>&nbsp;<span class="ident" id="7490609">BenchmarkDecodeBaseline</span><span class="op" id="7490632">(</span><span class="ident" id="7490633">b</span>&nbsp;<span class="op" id="7490635">*</span><span class="ident" id="7490636"><a href="/image/jpeg/reader_test.go.html#7483718">testing</a></span><span class="op" id="7490643">.</span><span class="ident" id="7490644">B</span><span class="op" id="7490645">)</span>&nbsp;<span class="op" id="7490647">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490650"><a href="/image/jpeg/reader_test.go.html#7490252">benchmarkDecode</a></span><span class="op" id="7490665">(</span><span class="ident" id="7490666"><a href="/image/jpeg/reader_test.go.html#7490633">b</a></span><span class="op" id="7490667">,</span>&nbsp;<span class="string" id="7490669">&#34;../testdata/video-001.jpeg&#34;</span><span class="op" id="7490697">)</span><br>
<span class="lineno"></span><span class="op" id="7490699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7490702">func</span>&nbsp;<span class="ident" id="7490707">BenchmarkDecodeProgressive</span><span class="op" id="7490733">(</span><span class="ident" id="7490734">b</span>&nbsp;<span class="op" id="7490736">*</span><span class="ident" id="7490737"><a href="/image/jpeg/reader_test.go.html#7483718">testing</a></span><span class="op" id="7490744">.</span><span class="ident" id="7490745">B</span><span class="op" id="7490746">)</span>&nbsp;<span class="op" id="7490748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490751"><a href="/image/jpeg/reader_test.go.html#7490252">benchmarkDecode</a></span><span class="op" id="7490766">(</span><span class="ident" id="7490767"><a href="/image/jpeg/reader_test.go.html#7490734">b</a></span><span class="op" id="7490768">,</span>&nbsp;<span class="string" id="7490770">&#34;../testdata/video-001.progressive.jpeg&#34;</span><span class="op" id="7490810">)</span><br>
<span class="lineno">270</span><span class="op" id="7490812">}</span>
</div>
</body>
</html>
