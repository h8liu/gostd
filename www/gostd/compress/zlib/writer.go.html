<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/zlib</h2>
<ul>
<li><a href="/gostd/compress/zlib/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/compress/zlib/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/zlib/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/zlib/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/zlib/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4917779">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4917834">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4917888">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4917939">package</span>&nbsp;<span class="ident" id="4917947">zlib</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4917953">import</span>&nbsp;<span class="op" id="4917960">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4917963">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4917981">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4917988">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4917996">&#34;hash/adler32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4918012">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4918017">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4918020">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="4918100">//&nbsp;&#34;compress/zlib&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4918166">const</span>&nbsp;<span class="op" id="4918172">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918175">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918194">=</span>&nbsp;<span class="ident" id="4918196">flate</span><span class="op" id="4918201">.</span><span class="ident" id="4918202">NoCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918217">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918236">=</span>&nbsp;<span class="ident" id="4918238">flate</span><span class="op" id="4918243">.</span><span class="ident" id="4918244">BestSpeed</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918255">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918274">=</span>&nbsp;<span class="ident" id="4918276">flate</span><span class="op" id="4918281">.</span><span class="ident" id="4918282">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918299">DefaultCompression</span>&nbsp;<span class="op" id="4918318">=</span>&nbsp;<span class="ident" id="4918320">flate</span><span class="op" id="4918325">.</span><span class="ident" id="4918326">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="4918345">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4918348">//&nbsp;A&nbsp;Writer&nbsp;takes&nbsp;data&nbsp;written&nbsp;to&nbsp;it&nbsp;and&nbsp;writes&nbsp;the&nbsp;compressed</span><br>
<span class="lineno">25</span><span class="comment" id="4918411">//&nbsp;form&nbsp;of&nbsp;that&nbsp;data&nbsp;to&nbsp;an&nbsp;underlying&nbsp;writer&nbsp;(see&nbsp;NewWriter).</span><br>
<span class="lineno"></span><span class="keyword" id="4918473">type</span>&nbsp;<span class="ident" id="4918478">Writer</span>&nbsp;<span class="keyword" id="4918485">struct</span>&nbsp;<span class="op" id="4918492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918495">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918507">io</span><span class="op" id="4918509">.</span><span class="ident" id="4918510">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918518">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4918530">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918535">dict</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918547">[</span><span class="op" id="4918548">]</span><span class="builtintype" id="4918549">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918555">compressor</span>&nbsp;&nbsp;<span class="op" id="4918567">*</span><span class="ident" id="4918568">flate</span><span class="op" id="4918573">.</span><span class="ident" id="4918574">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918582">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918594">hash</span><span class="op" id="4918598">.</span><span class="ident" id="4918599">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918607">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4918619">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918626">scratch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918638">[</span><span class="num" id="4918639">4</span><span class="op" id="4918640">]</span><span class="builtintype" id="4918641">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918647">wroteHeader</span>&nbsp;<span class="builtintype" id="4918659">bool</span><br>
<span class="lineno">35</span><span class="op" id="4918664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4918667">//&nbsp;NewWriter&nbsp;creates&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="4918702">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4918768">//</span><br>
<span class="lineno">40</span><span class="comment" id="4918771">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="4918852">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="4918907">func</span>&nbsp;<span class="ident" id="4918912">NewWriter</span><span class="op" id="4918921">(</span><span class="ident" id="4918922">w</span>&nbsp;<span class="ident" id="4918924">io</span><span class="op" id="4918926">.</span><span class="ident" id="4918927">Writer</span><span class="op" id="4918933">)</span>&nbsp;<span class="op" id="4918935">*</span><span class="ident" id="4918936">Writer</span>&nbsp;<span class="op" id="4918943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918946">z</span><span class="op" id="4918947">,</span>&nbsp;<span class="ident" id="4918949">_</span>&nbsp;<span class="op" id="4918951">:=</span>&nbsp;<span class="ident" id="4918954">NewWriterLevelDict</span><span class="op" id="4918972">(</span><span class="ident" id="4918973">w</span><span class="op" id="4918974">,</span>&nbsp;<span class="ident" id="4918976">DefaultCompression</span><span class="op" id="4918994">,</span>&nbsp;<span class="ident" id="4918996">nil</span><span class="op" id="4918999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4919002">return</span>&nbsp;<span class="ident" id="4919009">z</span><br>
<span class="lineno">45</span><span class="op" id="4919011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4919014">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="4919094">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="4919129">//</span><br>
<span class="lineno">50</span><span class="comment" id="4919132">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="4919206">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4919282">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4919329">func</span>&nbsp;<span class="ident" id="4919334">NewWriterLevel</span><span class="op" id="4919348">(</span><span class="ident" id="4919349">w</span>&nbsp;<span class="ident" id="4919351">io</span><span class="op" id="4919353">.</span><span class="ident" id="4919354">Writer</span><span class="op" id="4919360">,</span>&nbsp;<span class="ident" id="4919362">level</span>&nbsp;<span class="builtintype" id="4919368">int</span><span class="op" id="4919371">)</span>&nbsp;<span class="op" id="4919373">(</span><span class="op" id="4919374">*</span><span class="ident" id="4919375">Writer</span><span class="op" id="4919381">,</span>&nbsp;<span class="builtintype" id="4919383">error</span><span class="op" id="4919388">)</span>&nbsp;<span class="op" id="4919390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4919393">return</span>&nbsp;<span class="ident" id="4919400">NewWriterLevelDict</span><span class="op" id="4919418">(</span><span class="ident" id="4919419">w</span><span class="op" id="4919420">,</span>&nbsp;<span class="ident" id="4919422">level</span><span class="op" id="4919427">,</span>&nbsp;<span class="ident" id="4919429">nil</span><span class="op" id="4919432">)</span><br>
<span class="lineno">55</span><span class="op" id="4919434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4919437">//&nbsp;NewWriterLevelDict&nbsp;is&nbsp;like&nbsp;NewWriterLevel&nbsp;but&nbsp;specifies&nbsp;a&nbsp;dictionary&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4919512">//&nbsp;compress&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="4919530">//</span><br>
<span class="lineno">60</span><span class="comment" id="4919533">//&nbsp;The&nbsp;dictionary&nbsp;may&nbsp;be&nbsp;nil.&nbsp;If&nbsp;not,&nbsp;its&nbsp;contents&nbsp;should&nbsp;not&nbsp;be&nbsp;modified&nbsp;until</span><br>
<span class="lineno"></span><span class="comment" id="4919613">//&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="4919638">func</span>&nbsp;<span class="ident" id="4919643">NewWriterLevelDict</span><span class="op" id="4919661">(</span><span class="ident" id="4919662">w</span>&nbsp;<span class="ident" id="4919664">io</span><span class="op" id="4919666">.</span><span class="ident" id="4919667">Writer</span><span class="op" id="4919673">,</span>&nbsp;<span class="ident" id="4919675">level</span>&nbsp;<span class="builtintype" id="4919681">int</span><span class="op" id="4919684">,</span>&nbsp;<span class="ident" id="4919686">dict</span>&nbsp;<span class="op" id="4919691">[</span><span class="op" id="4919692">]</span><span class="builtintype" id="4919693">byte</span><span class="op" id="4919697">)</span>&nbsp;<span class="op" id="4919699">(</span><span class="op" id="4919700">*</span><span class="ident" id="4919701">Writer</span><span class="op" id="4919707">,</span>&nbsp;<span class="builtintype" id="4919709">error</span><span class="op" id="4919714">)</span>&nbsp;<span class="op" id="4919716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4919719">if</span>&nbsp;<span class="ident" id="4919722">level</span>&nbsp;<span class="op" id="4919728">&lt;</span>&nbsp;<span class="ident" id="4919730">DefaultCompression</span>&nbsp;<span class="op" id="4919749">||</span>&nbsp;<span class="ident" id="4919752">level</span>&nbsp;<span class="op" id="4919758">&gt;</span>&nbsp;<span class="ident" id="4919760">BestCompression</span>&nbsp;<span class="op" id="4919776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4919780">return</span>&nbsp;<span class="ident" id="4919787">nil</span><span class="op" id="4919790">,</span>&nbsp;<span class="ident" id="4919792">fmt</span><span class="op" id="4919795">.</span><span class="ident" id="4919796">Errorf</span><span class="op" id="4919802">(</span><span class="string" id="4919803">&#34;zlib:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="4919840">,</span>&nbsp;<span class="ident" id="4919842">level</span><span class="op" id="4919847">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4919850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4919853">return</span>&nbsp;<span class="op" id="4919860">&amp;</span><span class="ident" id="4919861">Writer</span><span class="op" id="4919867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919871">w</span><span class="op" id="4919872">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919878">w</span><span class="op" id="4919879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919883">level</span><span class="op" id="4919888">:</span>&nbsp;<span class="ident" id="4919890">level</span><span class="op" id="4919895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919899">dict</span><span class="op" id="4919903">:</span>&nbsp;&nbsp;<span class="ident" id="4919906">dict</span><span class="op" id="4919910">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4919913">}</span><span class="op" id="4919914">,</span>&nbsp;<span class="ident" id="4919916">nil</span><br>
<span class="lineno"></span><span class="op" id="4919920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4919923">//&nbsp;Reset&nbsp;clears&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;Writer&nbsp;z&nbsp;such&nbsp;that&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="4919999">//&nbsp;initial&nbsp;state&nbsp;from&nbsp;NewWriterLevel&nbsp;or&nbsp;NewWriterLevelDict,&nbsp;but&nbsp;instead&nbsp;writing</span><br>
<span class="lineno">75</span><span class="comment" id="4920079">//&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4920088">func</span>&nbsp;<span class="op" id="4920093">(</span><span class="ident" id="4920094">z</span>&nbsp;<span class="op" id="4920096">*</span><span class="ident" id="4920097">Writer</span><span class="op" id="4920103">)</span>&nbsp;<span class="ident" id="4920105">Reset</span><span class="op" id="4920110">(</span><span class="ident" id="4920111">w</span>&nbsp;<span class="ident" id="4920113">io</span><span class="op" id="4920115">.</span><span class="ident" id="4920116">Writer</span><span class="op" id="4920122">)</span>&nbsp;<span class="op" id="4920124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920127">z</span><span class="op" id="4920128">.</span><span class="ident" id="4920129">w</span>&nbsp;<span class="op" id="4920131">=</span>&nbsp;<span class="ident" id="4920133">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4920136">//&nbsp;z.level&nbsp;and&nbsp;z.dict&nbsp;left&nbsp;unchanged.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4920175">if</span>&nbsp;<span class="ident" id="4920178">z</span><span class="op" id="4920179">.</span><span class="ident" id="4920180">compressor</span>&nbsp;<span class="op" id="4920191">!=</span>&nbsp;<span class="ident" id="4920194">nil</span>&nbsp;<span class="op" id="4920198">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920202">z</span><span class="op" id="4920203">.</span><span class="ident" id="4920204">compressor</span><span class="op" id="4920214">.</span><span class="ident" id="4920215">Reset</span><span class="op" id="4920220">(</span><span class="ident" id="4920221">w</span><span class="op" id="4920222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4920225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4920228">if</span>&nbsp;<span class="ident" id="4920231">z</span><span class="op" id="4920232">.</span><span class="ident" id="4920233">digest</span>&nbsp;<span class="op" id="4920240">!=</span>&nbsp;<span class="ident" id="4920243">nil</span>&nbsp;<span class="op" id="4920247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920251">z</span><span class="op" id="4920252">.</span><span class="ident" id="4920253">digest</span><span class="op" id="4920259">.</span><span class="ident" id="4920260">Reset</span><span class="op" id="4920265">(</span><span class="op" id="4920266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4920269">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920272">z</span><span class="op" id="4920273">.</span><span class="ident" id="4920274">err</span>&nbsp;<span class="op" id="4920278">=</span>&nbsp;<span class="ident" id="4920280">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920285">z</span><span class="op" id="4920286">.</span><span class="ident" id="4920287">scratch</span>&nbsp;<span class="op" id="4920295">=</span>&nbsp;<span class="op" id="4920297">[</span><span class="num" id="4920298">4</span><span class="op" id="4920299">]</span><span class="builtintype" id="4920300">byte</span><span class="op" id="4920304">{</span><span class="op" id="4920305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920308">z</span><span class="op" id="4920309">.</span><span class="ident" id="4920310">wroteHeader</span>&nbsp;<span class="op" id="4920322">=</span>&nbsp;<span class="builtintype" id="4920324">false</span><br>
<span class="lineno"></span><span class="op" id="4920330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="4920333">//&nbsp;writeHeader&nbsp;writes&nbsp;the&nbsp;ZLIB&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="4920372">func</span>&nbsp;<span class="op" id="4920377">(</span><span class="ident" id="4920378">z</span>&nbsp;<span class="op" id="4920380">*</span><span class="ident" id="4920381">Writer</span><span class="op" id="4920387">)</span>&nbsp;<span class="ident" id="4920389">writeHeader</span><span class="op" id="4920400">(</span><span class="op" id="4920401">)</span>&nbsp;<span class="op" id="4920403">(</span><span class="ident" id="4920404">err</span>&nbsp;<span class="builtintype" id="4920408">error</span><span class="op" id="4920413">)</span>&nbsp;<span class="op" id="4920415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920418">z</span><span class="op" id="4920419">.</span><span class="ident" id="4920420">wroteHeader</span>&nbsp;<span class="op" id="4920432">=</span>&nbsp;<span class="builtintype" id="4920434">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4920440">//&nbsp;ZLIB&nbsp;has&nbsp;a&nbsp;two-byte&nbsp;header&nbsp;(as&nbsp;documented&nbsp;in&nbsp;RFC&nbsp;1950).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4920500">//&nbsp;The&nbsp;first&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CINFO&nbsp;(compression&nbsp;info),&nbsp;which&nbsp;is&nbsp;7&nbsp;for&nbsp;the&nbsp;default&nbsp;deflate&nbsp;window&nbsp;size.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4920605">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CM&nbsp;(compression&nbsp;method),&nbsp;which&nbsp;is&nbsp;8&nbsp;for&nbsp;deflate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920684">z</span><span class="op" id="4920685">.</span><span class="ident" id="4920686">scratch</span><span class="op" id="4920693">[</span><span class="num" id="4920694">0</span><span class="op" id="4920695">]</span>&nbsp;<span class="op" id="4920697">=</span>&nbsp;<span class="num" id="4920699">0x78</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4920705">//&nbsp;The&nbsp;next&nbsp;two&nbsp;bits&nbsp;is&nbsp;the&nbsp;FLEVEL&nbsp;(compression&nbsp;level).&nbsp;The&nbsp;four&nbsp;values&nbsp;are:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4920783">//&nbsp;0=fastest,&nbsp;1=fast,&nbsp;2=default,&nbsp;3=best.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4920825">//&nbsp;The&nbsp;next&nbsp;bit,&nbsp;FDICT,&nbsp;is&nbsp;set&nbsp;if&nbsp;a&nbsp;dictionary&nbsp;is&nbsp;given.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4920883">//&nbsp;The&nbsp;final&nbsp;five&nbsp;FCHECK&nbsp;bits&nbsp;form&nbsp;a&nbsp;mod-31&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4920938">switch</span>&nbsp;<span class="ident" id="4920945">z</span><span class="op" id="4920946">.</span><span class="ident" id="4920947">level</span>&nbsp;<span class="op" id="4920953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4920956">case</span>&nbsp;<span class="num" id="4920961">0</span><span class="op" id="4920962">,</span>&nbsp;<span class="num" id="4920964">1</span><span class="op" id="4920965">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920969">z</span><span class="op" id="4920970">.</span><span class="ident" id="4920971">scratch</span><span class="op" id="4920978">[</span><span class="num" id="4920979">1</span><span class="op" id="4920980">]</span>&nbsp;<span class="op" id="4920982">=</span>&nbsp;<span class="num" id="4920984">0</span>&nbsp;<span class="op" id="4920986">&lt;&lt;</span>&nbsp;<span class="num" id="4920989">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4920992">case</span>&nbsp;<span class="num" id="4920997">2</span><span class="op" id="4920998">,</span>&nbsp;<span class="num" id="4921000">3</span><span class="op" id="4921001">,</span>&nbsp;<span class="num" id="4921003">4</span><span class="op" id="4921004">,</span>&nbsp;<span class="num" id="4921006">5</span><span class="op" id="4921007">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4921011">z</span><span class="op" id="4921012">.</span><span class="ident" id="4921013">scratch</span><span class="op" id="4921020">[</span><span class="num" id="4921021">1</span><span class="op" id="4921022">]</span>&nbsp;<span class="op" id="4921024">=</span>&nbsp;<span class="num" id="4921026">1</span>&nbsp;<span class="op" id="4921028">&lt;&lt;</span>&nbsp;<span class="num" id="4921031">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921034">case</span>&nbsp;<span class="num" id="4921039">6</span><span class="op" id="4921040">,</span>&nbsp;<span class="op" id="4921042">-</span><span class="num" id="4921043">1</span><span class="op" id="4921044">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4921048">z</span><span class="op" id="4921049">.</span><span class="ident" id="4921050">scratch</span><span class="op" id="4921057">[</span><span class="num" id="4921058">1</span><span class="op" id="4921059">]</span>&nbsp;<span class="op" id="4921061">=</span>&nbsp;<span class="num" id="4921063">2</span>&nbsp;<span class="op" id="4921065">&lt;&lt;</span>&nbsp;<span class="num" id="4921068">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921071">case</span>&nbsp;<span class="num" id="4921076">7</span><span class="op" id="4921077">,</span>&nbsp;<span class="num" id="4921079">8</span><span class="op" id="4921080">,</span>&nbsp;<span class="num" id="4921082">9</span><span class="op" id="4921083">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4921087">z</span><span class="op" id="4921088">.</span><span class="ident" id="4921089">scratch</span><span class="op" id="4921096">[</span><span class="num" id="4921097">1</span><span class="op" id="4921098">]</span>&nbsp;<span class="op" id="4921100">=</span>&nbsp;<span class="num" id="4921102">3</span>&nbsp;<span class="op" id="4921104">&lt;&lt;</span>&nbsp;<span class="num" id="4921107">6</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921110">default</span><span class="op" id="4921117">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4921121">panic</span><span class="op" id="4921126">(</span><span class="string" id="4921127">&#34;unreachable&#34;</span><span class="op" id="4921140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4921143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921146">if</span>&nbsp;<span class="ident" id="4921149">z</span><span class="op" id="4921150">.</span><span class="ident" id="4921151">dict</span>&nbsp;<span class="op" id="4921156">!=</span>&nbsp;<span class="ident" id="4921159">nil</span>&nbsp;<span class="op" id="4921163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4921167">z</span><span class="op" id="4921168">.</span><span class="ident" id="4921169">scratch</span><span class="op" id="4921176">[</span><span class="num" id="4921177">1</span><span class="op" id="4921178">]</span>&nbsp;<span class="op" id="4921180">|=</span>&nbsp;<span class="num" id="4921183">1</span>&nbsp;<span class="op" id="4921185">&lt;&lt;</span>&nbsp;<span class="num" id="4921188">5</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4921191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4921194">z</span><span class="op" id="4921195">.</span><span class="ident" id="4921196">scratch</span><span class="op" id="4921203">[</span><span class="num" id="4921204">1</span><span class="op" id="4921205">]</span>&nbsp;<span class="op" id="4921207">+=</span>&nbsp;<span class="builtintype" id="4921210">uint8</span><span class="op" id="4921215">(</span><span class="num" id="4921216">31</span>&nbsp;<span class="op" id="4921219">-</span>&nbsp;<span class="op" id="4921221">(</span><span class="builtintype" id="4921222">uint16</span><span class="op" id="4921228">(</span><span class="ident" id="4921229">z</span><span class="op" id="4921230">.</span><span class="ident" id="4921231">scratch</span><span class="op" id="4921238">[</span><span class="num" id="4921239">0</span><span class="op" id="4921240">]</span><span class="op" id="4921241">)</span><span class="op" id="4921242">&lt;&lt;</span><span class="num" id="4921244">8</span><span class="op" id="4921245">+</span><span class="builtintype" id="4921246">uint16</span><span class="op" id="4921252">(</span><span class="ident" id="4921253">z</span><span class="op" id="4921254">.</span><span class="ident" id="4921255">scratch</span><span class="op" id="4921262">[</span><span class="num" id="4921263">1</span><span class="op" id="4921264">]</span><span class="op" id="4921265">)</span><span class="op" id="4921266">)</span><span class="op" id="4921267">%</span><span class="num" id="4921268">31</span><span class="op" id="4921270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921273">if</span>&nbsp;<span class="ident" id="4921276">_</span><span class="op" id="4921277">,</span>&nbsp;<span class="ident" id="4921279">err</span>&nbsp;<span class="op" id="4921283">=</span>&nbsp;<span class="ident" id="4921285">z</span><span class="op" id="4921286">.</span><span class="ident" id="4921287">w</span><span class="op" id="4921288">.</span><span class="ident" id="4921289">Write</span><span class="op" id="4921294">(</span><span class="ident" id="4921295">z</span><span class="op" id="4921296">.</span><span class="ident" id="4921297">scratch</span><span class="op" id="4921304">[</span><span class="num" id="4921305">0</span><span class="op" id="4921306">:</span><span class="num" id="4921307">2</span><span class="op" id="4921308">]</span><span class="op" id="4921309">)</span><span class="op" id="4921310">;</span>&nbsp;<span class="ident" id="4921312">err</span>&nbsp;<span class="op" id="4921316">!=</span>&nbsp;<span class="ident" id="4921319">nil</span>&nbsp;<span class="op" id="4921323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921327">return</span>&nbsp;<span class="ident" id="4921334">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4921339">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921342">if</span>&nbsp;<span class="ident" id="4921345">z</span><span class="op" id="4921346">.</span><span class="ident" id="4921347">dict</span>&nbsp;<span class="op" id="4921352">!=</span>&nbsp;<span class="ident" id="4921355">nil</span>&nbsp;<span class="op" id="4921359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4921363">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bytes&nbsp;are&nbsp;the&nbsp;Adler-32&nbsp;checksum&nbsp;of&nbsp;the&nbsp;dictionary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4921433">checksum</span>&nbsp;<span class="op" id="4921442">:=</span>&nbsp;<span class="ident" id="4921445">adler32</span><span class="op" id="4921452">.</span><span class="ident" id="4921453">Checksum</span><span class="op" id="4921461">(</span><span class="ident" id="4921462">z</span><span class="op" id="4921463">.</span><span class="ident" id="4921464">dict</span><span class="op" id="4921468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4921472">z</span><span class="op" id="4921473">.</span><span class="ident" id="4921474">scratch</span><span class="op" id="4921481">[</span><span class="num" id="4921482">0</span><span class="op" id="4921483">]</span>&nbsp;<span class="op" id="4921485">=</span>&nbsp;<span class="builtintype" id="4921487">uint8</span><span class="op" id="4921492">(</span><span class="ident" id="4921493">checksum</span>&nbsp;<span class="op" id="4921502">&gt;&gt;</span>&nbsp;<span class="num" id="4921505">24</span><span class="op" id="4921507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4921511">z</span><span class="op" id="4921512">.</span><span class="ident" id="4921513">scratch</span><span class="op" id="4921520">[</span><span class="num" id="4921521">1</span><span class="op" id="4921522">]</span>&nbsp;<span class="op" id="4921524">=</span>&nbsp;<span class="builtintype" id="4921526">uint8</span><span class="op" id="4921531">(</span><span class="ident" id="4921532">checksum</span>&nbsp;<span class="op" id="4921541">&gt;&gt;</span>&nbsp;<span class="num" id="4921544">16</span><span class="op" id="4921546">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4921550">z</span><span class="op" id="4921551">.</span><span class="ident" id="4921552">scratch</span><span class="op" id="4921559">[</span><span class="num" id="4921560">2</span><span class="op" id="4921561">]</span>&nbsp;<span class="op" id="4921563">=</span>&nbsp;<span class="builtintype" id="4921565">uint8</span><span class="op" id="4921570">(</span><span class="ident" id="4921571">checksum</span>&nbsp;<span class="op" id="4921580">&gt;&gt;</span>&nbsp;<span class="num" id="4921583">8</span><span class="op" id="4921584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4921588">z</span><span class="op" id="4921589">.</span><span class="ident" id="4921590">scratch</span><span class="op" id="4921597">[</span><span class="num" id="4921598">3</span><span class="op" id="4921599">]</span>&nbsp;<span class="op" id="4921601">=</span>&nbsp;<span class="builtintype" id="4921603">uint8</span><span class="op" id="4921608">(</span><span class="ident" id="4921609">checksum</span>&nbsp;<span class="op" id="4921618">&gt;&gt;</span>&nbsp;<span class="num" id="4921621">0</span><span class="op" id="4921622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921626">if</span>&nbsp;<span class="ident" id="4921629">_</span><span class="op" id="4921630">,</span>&nbsp;<span class="ident" id="4921632">err</span>&nbsp;<span class="op" id="4921636">=</span>&nbsp;<span class="ident" id="4921638">z</span><span class="op" id="4921639">.</span><span class="ident" id="4921640">w</span><span class="op" id="4921641">.</span><span class="ident" id="4921642">Write</span><span class="op" id="4921647">(</span><span class="ident" id="4921648">z</span><span class="op" id="4921649">.</span><span class="ident" id="4921650">scratch</span><span class="op" id="4921657">[</span><span class="num" id="4921658">0</span><span class="op" id="4921659">:</span><span class="num" id="4921660">4</span><span class="op" id="4921661">]</span><span class="op" id="4921662">)</span><span class="op" id="4921663">;</span>&nbsp;<span class="ident" id="4921665">err</span>&nbsp;<span class="op" id="4921669">!=</span>&nbsp;<span class="ident" id="4921672">nil</span>&nbsp;<span class="op" id="4921676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921681">return</span>&nbsp;<span class="ident" id="4921688">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4921694">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4921697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921700">if</span>&nbsp;<span class="ident" id="4921703">z</span><span class="op" id="4921704">.</span><span class="ident" id="4921705">compressor</span>&nbsp;<span class="op" id="4921716">==</span>&nbsp;<span class="ident" id="4921719">nil</span>&nbsp;<span class="op" id="4921723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4921727">//&nbsp;Initialize&nbsp;deflater&nbsp;unless&nbsp;the&nbsp;Writer&nbsp;is&nbsp;being&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4921786">//&nbsp;after&nbsp;a&nbsp;Reset&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4921811">z</span><span class="op" id="4921812">.</span><span class="ident" id="4921813">compressor</span><span class="op" id="4921823">,</span>&nbsp;<span class="ident" id="4921825">err</span>&nbsp;<span class="op" id="4921829">=</span>&nbsp;<span class="ident" id="4921831">flate</span><span class="op" id="4921836">.</span><span class="ident" id="4921837">NewWriterDict</span><span class="op" id="4921850">(</span><span class="ident" id="4921851">z</span><span class="op" id="4921852">.</span><span class="ident" id="4921853">w</span><span class="op" id="4921854">,</span>&nbsp;<span class="ident" id="4921856">z</span><span class="op" id="4921857">.</span><span class="ident" id="4921858">level</span><span class="op" id="4921863">,</span>&nbsp;<span class="ident" id="4921865">z</span><span class="op" id="4921866">.</span><span class="ident" id="4921867">dict</span><span class="op" id="4921871">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921875">if</span>&nbsp;<span class="ident" id="4921878">err</span>&nbsp;<span class="op" id="4921882">!=</span>&nbsp;<span class="ident" id="4921885">nil</span>&nbsp;<span class="op" id="4921889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921894">return</span>&nbsp;<span class="ident" id="4921901">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4921907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4921911">z</span><span class="op" id="4921912">.</span><span class="ident" id="4921913">digest</span>&nbsp;<span class="op" id="4921920">=</span>&nbsp;<span class="ident" id="4921922">adler32</span><span class="op" id="4921929">.</span><span class="ident" id="4921930">New</span><span class="op" id="4921933">(</span><span class="op" id="4921934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4921937">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921940">return</span>&nbsp;<span class="ident" id="4921947">nil</span><br>
<span class="lineno"></span><span class="op" id="4921951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4921954">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="4922026">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed&nbsp;or</span><br>
<span class="lineno">145</span><span class="comment" id="4922104">//&nbsp;explicitly&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="4922127">func</span>&nbsp;<span class="op" id="4922132">(</span><span class="ident" id="4922133">z</span>&nbsp;<span class="op" id="4922135">*</span><span class="ident" id="4922136">Writer</span><span class="op" id="4922142">)</span>&nbsp;<span class="ident" id="4922144">Write</span><span class="op" id="4922149">(</span><span class="ident" id="4922150">p</span>&nbsp;<span class="op" id="4922152">[</span><span class="op" id="4922153">]</span><span class="builtintype" id="4922154">byte</span><span class="op" id="4922158">)</span>&nbsp;<span class="op" id="4922160">(</span><span class="ident" id="4922161">n</span>&nbsp;<span class="builtintype" id="4922163">int</span><span class="op" id="4922166">,</span>&nbsp;<span class="ident" id="4922168">err</span>&nbsp;<span class="builtintype" id="4922172">error</span><span class="op" id="4922177">)</span>&nbsp;<span class="op" id="4922179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922182">if</span>&nbsp;<span class="op" id="4922185">!</span><span class="ident" id="4922186">z</span><span class="op" id="4922187">.</span><span class="ident" id="4922188">wroteHeader</span>&nbsp;<span class="op" id="4922200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4922204">z</span><span class="op" id="4922205">.</span><span class="ident" id="4922206">err</span>&nbsp;<span class="op" id="4922210">=</span>&nbsp;<span class="ident" id="4922212">z</span><span class="op" id="4922213">.</span><span class="ident" id="4922214">writeHeader</span><span class="op" id="4922225">(</span><span class="op" id="4922226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4922229">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922232">if</span>&nbsp;<span class="ident" id="4922235">z</span><span class="op" id="4922236">.</span><span class="ident" id="4922237">err</span>&nbsp;<span class="op" id="4922241">!=</span>&nbsp;<span class="ident" id="4922244">nil</span>&nbsp;<span class="op" id="4922248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922252">return</span>&nbsp;<span class="num" id="4922259">0</span><span class="op" id="4922260">,</span>&nbsp;<span class="ident" id="4922262">z</span><span class="op" id="4922263">.</span><span class="ident" id="4922264">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4922269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922272">if</span>&nbsp;<span class="builtinfunc" id="4922275">len</span><span class="op" id="4922278">(</span><span class="ident" id="4922279">p</span><span class="op" id="4922280">)</span>&nbsp;<span class="op" id="4922282">==</span>&nbsp;<span class="num" id="4922285">0</span>&nbsp;<span class="op" id="4922287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922291">return</span>&nbsp;<span class="num" id="4922298">0</span><span class="op" id="4922299">,</span>&nbsp;<span class="ident" id="4922301">nil</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4922306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4922309">n</span><span class="op" id="4922310">,</span>&nbsp;<span class="ident" id="4922312">err</span>&nbsp;<span class="op" id="4922316">=</span>&nbsp;<span class="ident" id="4922318">z</span><span class="op" id="4922319">.</span><span class="ident" id="4922320">compressor</span><span class="op" id="4922330">.</span><span class="ident" id="4922331">Write</span><span class="op" id="4922336">(</span><span class="ident" id="4922337">p</span><span class="op" id="4922338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922341">if</span>&nbsp;<span class="ident" id="4922344">err</span>&nbsp;<span class="op" id="4922348">!=</span>&nbsp;<span class="ident" id="4922351">nil</span>&nbsp;<span class="op" id="4922355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4922359">z</span><span class="op" id="4922360">.</span><span class="ident" id="4922361">err</span>&nbsp;<span class="op" id="4922365">=</span>&nbsp;<span class="ident" id="4922367">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922373">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4922381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4922384">z</span><span class="op" id="4922385">.</span><span class="ident" id="4922386">digest</span><span class="op" id="4922392">.</span><span class="ident" id="4922393">Write</span><span class="op" id="4922398">(</span><span class="ident" id="4922399">p</span><span class="op" id="4922400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922403">return</span><br>
<span class="lineno"></span><span class="op" id="4922410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="4922413">//&nbsp;Flush&nbsp;flushes&nbsp;the&nbsp;Writer&nbsp;to&nbsp;its&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4922470">func</span>&nbsp;<span class="op" id="4922475">(</span><span class="ident" id="4922476">z</span>&nbsp;<span class="op" id="4922478">*</span><span class="ident" id="4922479">Writer</span><span class="op" id="4922485">)</span>&nbsp;<span class="ident" id="4922487">Flush</span><span class="op" id="4922492">(</span><span class="op" id="4922493">)</span>&nbsp;<span class="builtintype" id="4922495">error</span>&nbsp;<span class="op" id="4922501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922504">if</span>&nbsp;<span class="op" id="4922507">!</span><span class="ident" id="4922508">z</span><span class="op" id="4922509">.</span><span class="ident" id="4922510">wroteHeader</span>&nbsp;<span class="op" id="4922522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4922526">z</span><span class="op" id="4922527">.</span><span class="ident" id="4922528">err</span>&nbsp;<span class="op" id="4922532">=</span>&nbsp;<span class="ident" id="4922534">z</span><span class="op" id="4922535">.</span><span class="ident" id="4922536">writeHeader</span><span class="op" id="4922547">(</span><span class="op" id="4922548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4922551">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922554">if</span>&nbsp;<span class="ident" id="4922557">z</span><span class="op" id="4922558">.</span><span class="ident" id="4922559">err</span>&nbsp;<span class="op" id="4922563">!=</span>&nbsp;<span class="ident" id="4922566">nil</span>&nbsp;<span class="op" id="4922570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922574">return</span>&nbsp;<span class="ident" id="4922581">z</span><span class="op" id="4922582">.</span><span class="ident" id="4922583">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4922588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4922591">z</span><span class="op" id="4922592">.</span><span class="ident" id="4922593">err</span>&nbsp;<span class="op" id="4922597">=</span>&nbsp;<span class="ident" id="4922599">z</span><span class="op" id="4922600">.</span><span class="ident" id="4922601">compressor</span><span class="op" id="4922611">.</span><span class="ident" id="4922612">Flush</span><span class="op" id="4922617">(</span><span class="op" id="4922618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922621">return</span>&nbsp;<span class="ident" id="4922628">z</span><span class="op" id="4922629">.</span><span class="ident" id="4922630">err</span><br>
<span class="lineno">175</span><span class="op" id="4922634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4922637">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4922711">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4922770">func</span>&nbsp;<span class="op" id="4922775">(</span><span class="ident" id="4922776">z</span>&nbsp;<span class="op" id="4922778">*</span><span class="ident" id="4922779">Writer</span><span class="op" id="4922785">)</span>&nbsp;<span class="ident" id="4922787">Close</span><span class="op" id="4922792">(</span><span class="op" id="4922793">)</span>&nbsp;<span class="builtintype" id="4922795">error</span>&nbsp;<span class="op" id="4922801">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922804">if</span>&nbsp;<span class="op" id="4922807">!</span><span class="ident" id="4922808">z</span><span class="op" id="4922809">.</span><span class="ident" id="4922810">wroteHeader</span>&nbsp;<span class="op" id="4922822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4922826">z</span><span class="op" id="4922827">.</span><span class="ident" id="4922828">err</span>&nbsp;<span class="op" id="4922832">=</span>&nbsp;<span class="ident" id="4922834">z</span><span class="op" id="4922835">.</span><span class="ident" id="4922836">writeHeader</span><span class="op" id="4922847">(</span><span class="op" id="4922848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4922851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922854">if</span>&nbsp;<span class="ident" id="4922857">z</span><span class="op" id="4922858">.</span><span class="ident" id="4922859">err</span>&nbsp;<span class="op" id="4922863">!=</span>&nbsp;<span class="ident" id="4922866">nil</span>&nbsp;<span class="op" id="4922870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922874">return</span>&nbsp;<span class="ident" id="4922881">z</span><span class="op" id="4922882">.</span><span class="ident" id="4922883">err</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4922888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4922891">z</span><span class="op" id="4922892">.</span><span class="ident" id="4922893">err</span>&nbsp;<span class="op" id="4922897">=</span>&nbsp;<span class="ident" id="4922899">z</span><span class="op" id="4922900">.</span><span class="ident" id="4922901">compressor</span><span class="op" id="4922911">.</span><span class="ident" id="4922912">Close</span><span class="op" id="4922917">(</span><span class="op" id="4922918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922921">if</span>&nbsp;<span class="ident" id="4922924">z</span><span class="op" id="4922925">.</span><span class="ident" id="4922926">err</span>&nbsp;<span class="op" id="4922930">!=</span>&nbsp;<span class="ident" id="4922933">nil</span>&nbsp;<span class="op" id="4922937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922941">return</span>&nbsp;<span class="ident" id="4922948">z</span><span class="op" id="4922949">.</span><span class="ident" id="4922950">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4922955">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4922958">checksum</span>&nbsp;<span class="op" id="4922967">:=</span>&nbsp;<span class="ident" id="4922970">z</span><span class="op" id="4922971">.</span><span class="ident" id="4922972">digest</span><span class="op" id="4922978">.</span><span class="ident" id="4922979">Sum32</span><span class="op" id="4922984">(</span><span class="op" id="4922985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922988">//&nbsp;ZLIB&nbsp;(RFC&nbsp;1950)&nbsp;is&nbsp;big-endian,&nbsp;unlike&nbsp;GZIP&nbsp;(RFC&nbsp;1952).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923047">z</span><span class="op" id="4923048">.</span><span class="ident" id="4923049">scratch</span><span class="op" id="4923056">[</span><span class="num" id="4923057">0</span><span class="op" id="4923058">]</span>&nbsp;<span class="op" id="4923060">=</span>&nbsp;<span class="builtintype" id="4923062">uint8</span><span class="op" id="4923067">(</span><span class="ident" id="4923068">checksum</span>&nbsp;<span class="op" id="4923077">&gt;&gt;</span>&nbsp;<span class="num" id="4923080">24</span><span class="op" id="4923082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923085">z</span><span class="op" id="4923086">.</span><span class="ident" id="4923087">scratch</span><span class="op" id="4923094">[</span><span class="num" id="4923095">1</span><span class="op" id="4923096">]</span>&nbsp;<span class="op" id="4923098">=</span>&nbsp;<span class="builtintype" id="4923100">uint8</span><span class="op" id="4923105">(</span><span class="ident" id="4923106">checksum</span>&nbsp;<span class="op" id="4923115">&gt;&gt;</span>&nbsp;<span class="num" id="4923118">16</span><span class="op" id="4923120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923123">z</span><span class="op" id="4923124">.</span><span class="ident" id="4923125">scratch</span><span class="op" id="4923132">[</span><span class="num" id="4923133">2</span><span class="op" id="4923134">]</span>&nbsp;<span class="op" id="4923136">=</span>&nbsp;<span class="builtintype" id="4923138">uint8</span><span class="op" id="4923143">(</span><span class="ident" id="4923144">checksum</span>&nbsp;<span class="op" id="4923153">&gt;&gt;</span>&nbsp;<span class="num" id="4923156">8</span><span class="op" id="4923157">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923160">z</span><span class="op" id="4923161">.</span><span class="ident" id="4923162">scratch</span><span class="op" id="4923169">[</span><span class="num" id="4923170">3</span><span class="op" id="4923171">]</span>&nbsp;<span class="op" id="4923173">=</span>&nbsp;<span class="builtintype" id="4923175">uint8</span><span class="op" id="4923180">(</span><span class="ident" id="4923181">checksum</span>&nbsp;<span class="op" id="4923190">&gt;&gt;</span>&nbsp;<span class="num" id="4923193">0</span><span class="op" id="4923194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923197">_</span><span class="op" id="4923198">,</span>&nbsp;<span class="ident" id="4923200">z</span><span class="op" id="4923201">.</span><span class="ident" id="4923202">err</span>&nbsp;<span class="op" id="4923206">=</span>&nbsp;<span class="ident" id="4923208">z</span><span class="op" id="4923209">.</span><span class="ident" id="4923210">w</span><span class="op" id="4923211">.</span><span class="ident" id="4923212">Write</span><span class="op" id="4923217">(</span><span class="ident" id="4923218">z</span><span class="op" id="4923219">.</span><span class="ident" id="4923220">scratch</span><span class="op" id="4923227">[</span><span class="num" id="4923228">0</span><span class="op" id="4923229">:</span><span class="num" id="4923230">4</span><span class="op" id="4923231">]</span><span class="op" id="4923232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4923235">return</span>&nbsp;<span class="ident" id="4923242">z</span><span class="op" id="4923243">.</span><span class="ident" id="4923244">err</span><br>
<span class="lineno"></span><span class="op" id="4923248">}</span>
</div>
</body>
</html>
