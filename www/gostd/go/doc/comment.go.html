<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/doc</h2>
<ul>
<li><a href="/gostd/go/doc/comment.go.html">comment.go</a></li>
<li><a href="/gostd/go/doc/comment_test.go.html">comment_test.go</a></li>
<li><a href="/gostd/go/doc/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/doc/doc_test.go.html">doc_test.go</a></li>
<li><a href="/gostd/go/doc/example.go.html">example.go</a></li>
<li><a href="/gostd/go/doc/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/doc/exports.go.html">exports.go</a></li>
<li><a href="/gostd/go/doc/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/doc/reader.go.html">reader.go</a></li>
<li><a href="/gostd/go/doc/synopsis.go.html">synopsis.go</a></li>
<li><a href="/gostd/go/doc/synopsis_test.go.html">synopsis_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5807460">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5807515">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5807569">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5807620">//&nbsp;Godoc&nbsp;comment&nbsp;extraction&nbsp;and&nbsp;comment&nbsp;-&gt;&nbsp;HTML&nbsp;formatting.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5807681">package</span>&nbsp;<span class="ident" id="5807689">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5807694">import</span>&nbsp;<span class="op" id="5807701">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5807704">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5807710">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5807720">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5807731">&#34;text/template&#34;</span>&nbsp;<span class="comment" id="5807747">//&nbsp;for&nbsp;HTMLEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5807766">&#34;unicode&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5807777">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5807792">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5807795">var</span>&nbsp;<span class="op" id="5807799">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807802">ldquo</span>&nbsp;<span class="op" id="5807808">=</span>&nbsp;<span class="op" id="5807810">[</span><span class="op" id="5807811">]</span><span class="builtintype" id="5807812">byte</span><span class="op" id="5807816">(</span><span class="string" id="5807817">&#34;&amp;ldquo;&#34;</span><span class="op" id="5807826">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807829">rdquo</span>&nbsp;<span class="op" id="5807835">=</span>&nbsp;<span class="op" id="5807837">[</span><span class="op" id="5807838">]</span><span class="builtintype" id="5807839">byte</span><span class="op" id="5807843">(</span><span class="string" id="5807844">&#34;&amp;rdquo;&#34;</span><span class="op" id="5807853">)</span><br>
<span class="lineno"></span><span class="op" id="5807855">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5807858">//&nbsp;Escape&nbsp;comment&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,</span><br>
<span class="lineno"></span><span class="comment" id="5807907">//&nbsp;also&nbsp;turn&nbsp;``&nbsp;into&nbsp;&amp;ldquo;&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;.</span><br>
<span class="lineno">25</span><span class="keyword" id="5807957">func</span>&nbsp;<span class="ident" id="5807962">commentEscape</span><span class="op" id="5807975">(</span><span class="ident" id="5807976">w</span>&nbsp;<span class="ident" id="5807978">io</span><span class="op" id="5807980">.</span><span class="ident" id="5807981">Writer</span><span class="op" id="5807987">,</span>&nbsp;<span class="ident" id="5807989">text</span>&nbsp;<span class="builtintype" id="5807994">string</span><span class="op" id="5808000">,</span>&nbsp;<span class="ident" id="5808002">nice</span>&nbsp;<span class="builtintype" id="5808007">bool</span><span class="op" id="5808011">)</span>&nbsp;<span class="op" id="5808013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808016">last</span>&nbsp;<span class="op" id="5808021">:=</span>&nbsp;<span class="num" id="5808024">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5808027">if</span>&nbsp;<span class="ident" id="5808030">nice</span>&nbsp;<span class="op" id="5808035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5808039">for</span>&nbsp;<span class="ident" id="5808043">i</span>&nbsp;<span class="op" id="5808045">:=</span>&nbsp;<span class="num" id="5808048">0</span><span class="op" id="5808049">;</span>&nbsp;<span class="ident" id="5808051">i</span>&nbsp;<span class="op" id="5808053">&lt;</span>&nbsp;<span class="builtinfunc" id="5808055">len</span><span class="op" id="5808058">(</span><span class="ident" id="5808059">text</span><span class="op" id="5808063">)</span><span class="op" id="5808064">-</span><span class="num" id="5808065">1</span><span class="op" id="5808066">;</span>&nbsp;<span class="ident" id="5808068">i</span><span class="op" id="5808069">++</span>&nbsp;<span class="op" id="5808072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808077">ch</span>&nbsp;<span class="op" id="5808080">:=</span>&nbsp;<span class="ident" id="5808083">text</span><span class="op" id="5808087">[</span><span class="ident" id="5808088">i</span><span class="op" id="5808089">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5808094">if</span>&nbsp;<span class="ident" id="5808097">ch</span>&nbsp;<span class="op" id="5808100">==</span>&nbsp;<span class="ident" id="5808103">text</span><span class="op" id="5808107">[</span><span class="ident" id="5808108">i</span><span class="op" id="5808109">+</span><span class="num" id="5808110">1</span><span class="op" id="5808111">]</span>&nbsp;<span class="op" id="5808113">&amp;&amp;</span>&nbsp;<span class="op" id="5808116">(</span><span class="ident" id="5808117">ch</span>&nbsp;<span class="op" id="5808120">==</span>&nbsp;<span class="string" id="5808123">&#39;`&#39;</span>&nbsp;<span class="op" id="5808127">||</span>&nbsp;<span class="ident" id="5808130">ch</span>&nbsp;<span class="op" id="5808133">==</span>&nbsp;<span class="string" id="5808136">&#39;\&#39;&#39;</span><span class="op" id="5808140">)</span>&nbsp;<span class="op" id="5808142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808148">template</span><span class="op" id="5808156">.</span><span class="ident" id="5808157">HTMLEscape</span><span class="op" id="5808167">(</span><span class="ident" id="5808168">w</span><span class="op" id="5808169">,</span>&nbsp;<span class="op" id="5808171">[</span><span class="op" id="5808172">]</span><span class="builtintype" id="5808173">byte</span><span class="op" id="5808177">(</span><span class="ident" id="5808178">text</span><span class="op" id="5808182">[</span><span class="ident" id="5808183">last</span><span class="op" id="5808187">:</span><span class="ident" id="5808188">i</span><span class="op" id="5808189">]</span><span class="op" id="5808190">)</span><span class="op" id="5808191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808197">last</span>&nbsp;<span class="op" id="5808202">=</span>&nbsp;<span class="ident" id="5808204">i</span>&nbsp;<span class="op" id="5808206">+</span>&nbsp;<span class="num" id="5808208">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5808214">switch</span>&nbsp;<span class="ident" id="5808221">ch</span>&nbsp;<span class="op" id="5808224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5808230">case</span>&nbsp;<span class="string" id="5808235">&#39;`&#39;</span><span class="op" id="5808238">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808245">w</span><span class="op" id="5808246">.</span><span class="ident" id="5808247">Write</span><span class="op" id="5808252">(</span><span class="ident" id="5808253">ldquo</span><span class="op" id="5808258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5808264">case</span>&nbsp;<span class="string" id="5808269">&#39;\&#39;&#39;</span><span class="op" id="5808273">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808280">w</span><span class="op" id="5808281">.</span><span class="ident" id="5808282">Write</span><span class="op" id="5808287">(</span><span class="ident" id="5808288">rdquo</span><span class="op" id="5808293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5808299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808305">i</span><span class="op" id="5808306">++</span>&nbsp;<span class="comment" id="5808309">//&nbsp;loop&nbsp;will&nbsp;add&nbsp;one&nbsp;more</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5808338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5808342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5808345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808348">template</span><span class="op" id="5808356">.</span><span class="ident" id="5808357">HTMLEscape</span><span class="op" id="5808367">(</span><span class="ident" id="5808368">w</span><span class="op" id="5808369">,</span>&nbsp;<span class="op" id="5808371">[</span><span class="op" id="5808372">]</span><span class="builtintype" id="5808373">byte</span><span class="op" id="5808377">(</span><span class="ident" id="5808378">text</span><span class="op" id="5808382">[</span><span class="ident" id="5808383">last</span><span class="op" id="5808387">:</span><span class="op" id="5808388">]</span><span class="op" id="5808389">)</span><span class="op" id="5808390">)</span><br>
<span class="lineno"></span><span class="op" id="5808392">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="5808395">const</span>&nbsp;<span class="op" id="5808401">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5808404">//&nbsp;Regexp&nbsp;for&nbsp;Go&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808434">identRx</span>&nbsp;<span class="op" id="5808442">=</span>&nbsp;<span class="string" id="5808444">`[\pL_][\pL_0-9]*`</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5808465">//&nbsp;Regexp&nbsp;for&nbsp;URLs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808485">protocol</span>&nbsp;<span class="op" id="5808494">=</span>&nbsp;<span class="string" id="5808496">`https?|ftp|file|gopher|mailto|news|nntp|telnet|wais|prospero`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808560">hostPart</span>&nbsp;<span class="op" id="5808569">=</span>&nbsp;<span class="string" id="5808571">`[a-zA-Z0-9_@\-]+`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808591">filePart</span>&nbsp;<span class="op" id="5808600">=</span>&nbsp;<span class="string" id="5808602">`[a-zA-Z0-9_?%#~&amp;/\-+=()]+`</span>&nbsp;<span class="comment" id="5808630">//&nbsp;parentheses&nbsp;may&nbsp;not&nbsp;be&nbsp;matching;&nbsp;see&nbsp;pairedParensPrefixLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808693">urlRx</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5808702">=</span>&nbsp;<span class="string" id="5808704">`(`</span>&nbsp;<span class="op" id="5808708">+</span>&nbsp;<span class="ident" id="5808710">protocol</span>&nbsp;<span class="op" id="5808719">+</span>&nbsp;<span class="string" id="5808721">`)://`</span>&nbsp;<span class="op" id="5808728">+</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5808732">//&nbsp;http://</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808745">hostPart</span>&nbsp;<span class="op" id="5808754">+</span>&nbsp;<span class="string" id="5808756">`([.:]`</span>&nbsp;<span class="op" id="5808764">+</span>&nbsp;<span class="ident" id="5808766">hostPart</span>&nbsp;<span class="op" id="5808775">+</span>&nbsp;<span class="string" id="5808777">`)*/?`</span>&nbsp;<span class="op" id="5808784">+</span>&nbsp;<span class="comment" id="5808786">//&nbsp;//www.google.com:8080/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808814">filePart</span>&nbsp;<span class="op" id="5808823">+</span>&nbsp;<span class="string" id="5808825">`([:.,]`</span>&nbsp;<span class="op" id="5808834">+</span>&nbsp;<span class="ident" id="5808836">filePart</span>&nbsp;<span class="op" id="5808845">+</span>&nbsp;<span class="string" id="5808847">`)*`</span><br>
<span class="lineno"></span><span class="op" id="5808852">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5808855">var</span>&nbsp;<span class="ident" id="5808859">matchRx</span>&nbsp;<span class="op" id="5808867">=</span>&nbsp;<span class="ident" id="5808869">regexp</span><span class="op" id="5808875">.</span><span class="ident" id="5808876">MustCompile</span><span class="op" id="5808887">(</span><span class="string" id="5808888">`(`</span>&nbsp;<span class="op" id="5808892">+</span>&nbsp;<span class="ident" id="5808894">urlRx</span>&nbsp;<span class="op" id="5808900">+</span>&nbsp;<span class="string" id="5808902">`)|(`</span>&nbsp;<span class="op" id="5808908">+</span>&nbsp;<span class="ident" id="5808910">identRx</span>&nbsp;<span class="op" id="5808918">+</span>&nbsp;<span class="string" id="5808920">`)`</span><span class="op" id="5808923">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="5808926">var</span>&nbsp;<span class="op" id="5808930">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808933">html_a</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5808945">=</span>&nbsp;<span class="op" id="5808947">[</span><span class="op" id="5808948">]</span><span class="builtintype" id="5808949">byte</span><span class="op" id="5808953">(</span><span class="string" id="5808954">`&lt;a&nbsp;href=&#34;`</span><span class="op" id="5808965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808968">html_aq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5808980">=</span>&nbsp;<span class="op" id="5808982">[</span><span class="op" id="5808983">]</span><span class="builtintype" id="5808984">byte</span><span class="op" id="5808988">(</span><span class="string" id="5808989">`&#34;&gt;`</span><span class="op" id="5808993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808996">html_enda</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5809008">=</span>&nbsp;<span class="op" id="5809010">[</span><span class="op" id="5809011">]</span><span class="builtintype" id="5809012">byte</span><span class="op" id="5809016">(</span><span class="string" id="5809017">&#34;&lt;/a&gt;&#34;</span><span class="op" id="5809023">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809026">html_i</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5809038">=</span>&nbsp;<span class="op" id="5809040">[</span><span class="op" id="5809041">]</span><span class="builtintype" id="5809042">byte</span><span class="op" id="5809046">(</span><span class="string" id="5809047">&#34;&lt;i&gt;&#34;</span><span class="op" id="5809052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809055">html_endi</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5809067">=</span>&nbsp;<span class="op" id="5809069">[</span><span class="op" id="5809070">]</span><span class="builtintype" id="5809071">byte</span><span class="op" id="5809075">(</span><span class="string" id="5809076">&#34;&lt;/i&gt;&#34;</span><span class="op" id="5809082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809085">html_p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5809097">=</span>&nbsp;<span class="op" id="5809099">[</span><span class="op" id="5809100">]</span><span class="builtintype" id="5809101">byte</span><span class="op" id="5809105">(</span><span class="string" id="5809106">&#34;&lt;p&gt;\n&#34;</span><span class="op" id="5809113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809116">html_endp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5809128">=</span>&nbsp;<span class="op" id="5809130">[</span><span class="op" id="5809131">]</span><span class="builtintype" id="5809132">byte</span><span class="op" id="5809136">(</span><span class="string" id="5809137">&#34;&lt;/p&gt;\n&#34;</span><span class="op" id="5809145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809148">html_pre</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5809160">=</span>&nbsp;<span class="op" id="5809162">[</span><span class="op" id="5809163">]</span><span class="builtintype" id="5809164">byte</span><span class="op" id="5809168">(</span><span class="string" id="5809169">&#34;&lt;pre&gt;&#34;</span><span class="op" id="5809176">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809179">html_endpre</span>&nbsp;<span class="op" id="5809191">=</span>&nbsp;<span class="op" id="5809193">[</span><span class="op" id="5809194">]</span><span class="builtintype" id="5809195">byte</span><span class="op" id="5809199">(</span><span class="string" id="5809200">&#34;&lt;/pre&gt;\n&#34;</span><span class="op" id="5809210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809213">html_h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5809225">=</span>&nbsp;<span class="op" id="5809227">[</span><span class="op" id="5809228">]</span><span class="builtintype" id="5809229">byte</span><span class="op" id="5809233">(</span><span class="string" id="5809234">`&lt;h3&nbsp;id=&#34;`</span><span class="op" id="5809244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809247">html_hq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5809259">=</span>&nbsp;<span class="op" id="5809261">[</span><span class="op" id="5809262">]</span><span class="builtintype" id="5809263">byte</span><span class="op" id="5809267">(</span><span class="string" id="5809268">`&#34;&gt;`</span><span class="op" id="5809272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809275">html_endh</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5809287">=</span>&nbsp;<span class="op" id="5809289">[</span><span class="op" id="5809290">]</span><span class="builtintype" id="5809291">byte</span><span class="op" id="5809295">(</span><span class="string" id="5809296">&#34;&lt;/h3&gt;\n&#34;</span><span class="op" id="5809305">)</span><br>
<span class="lineno"></span><span class="op" id="5809307">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="5809310">//&nbsp;pairedParensPrefixLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;longest&nbsp;prefix&nbsp;of&nbsp;s&nbsp;containing&nbsp;paired&nbsp;parentheses.</span><br>
<span class="lineno"></span><span class="keyword" id="5809412">func</span>&nbsp;<span class="ident" id="5809417">pairedParensPrefixLen</span><span class="op" id="5809438">(</span><span class="ident" id="5809439">s</span>&nbsp;<span class="builtintype" id="5809441">string</span><span class="op" id="5809447">)</span>&nbsp;<span class="builtintype" id="5809449">int</span>&nbsp;<span class="op" id="5809453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809456">parens</span>&nbsp;<span class="op" id="5809463">:=</span>&nbsp;<span class="num" id="5809466">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809469">l</span>&nbsp;<span class="op" id="5809471">:=</span>&nbsp;<span class="builtinfunc" id="5809474">len</span><span class="op" id="5809477">(</span><span class="ident" id="5809478">s</span><span class="op" id="5809479">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809482">for</span>&nbsp;<span class="ident" id="5809486">i</span><span class="op" id="5809487">,</span>&nbsp;<span class="ident" id="5809489">ch</span>&nbsp;<span class="op" id="5809492">:=</span>&nbsp;<span class="keyword" id="5809495">range</span>&nbsp;<span class="ident" id="5809501">s</span>&nbsp;<span class="op" id="5809503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809507">switch</span>&nbsp;<span class="ident" id="5809514">ch</span>&nbsp;<span class="op" id="5809517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809521">case</span>&nbsp;<span class="string" id="5809526">&#39;(&#39;</span><span class="op" id="5809529">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809534">if</span>&nbsp;<span class="ident" id="5809537">parens</span>&nbsp;<span class="op" id="5809544">==</span>&nbsp;<span class="num" id="5809547">0</span>&nbsp;<span class="op" id="5809549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809555">l</span>&nbsp;<span class="op" id="5809557">=</span>&nbsp;<span class="ident" id="5809559">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809569">parens</span><span class="op" id="5809575">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809580">case</span>&nbsp;<span class="string" id="5809585">&#39;)&#39;</span><span class="op" id="5809588">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809593">parens</span><span class="op" id="5809599">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809605">if</span>&nbsp;<span class="ident" id="5809608">parens</span>&nbsp;<span class="op" id="5809615">==</span>&nbsp;<span class="num" id="5809618">0</span>&nbsp;<span class="op" id="5809620">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809626">l</span>&nbsp;<span class="op" id="5809628">=</span>&nbsp;<span class="builtinfunc" id="5809630">len</span><span class="op" id="5809633">(</span><span class="ident" id="5809634">s</span><span class="op" id="5809635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809640">}</span>&nbsp;<span class="keyword" id="5809642">else</span>&nbsp;<span class="keyword" id="5809647">if</span>&nbsp;<span class="ident" id="5809650">parens</span>&nbsp;<span class="op" id="5809657">&lt;</span>&nbsp;<span class="num" id="5809659">0</span>&nbsp;<span class="op" id="5809661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809667">return</span>&nbsp;<span class="ident" id="5809674">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809683">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809689">return</span>&nbsp;<span class="ident" id="5809696">l</span><br>
<span class="lineno"></span><span class="op" id="5809698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5809701">//&nbsp;Emphasize&nbsp;and&nbsp;escape&nbsp;a&nbsp;line&nbsp;of&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;URLs&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;</span><br>
<span class="lineno">100</span><span class="comment" id="5809781">//&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if</span><br>
<span class="lineno"></span><span class="comment" id="5809861">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="5809938">//&nbsp;into&nbsp;a&nbsp;link).&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5810018">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="5810097">//&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;link.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,&nbsp;the&nbsp;remaining&nbsp;text&#39;s</span><br>
<span class="lineno">105</span><span class="comment" id="5810176">//&nbsp;appearance&nbsp;is&nbsp;improved&nbsp;where&nbsp;it&nbsp;makes&nbsp;sense&nbsp;(e.g.,&nbsp;``&nbsp;is&nbsp;turned&nbsp;into&nbsp;&amp;ldquo;</span><br>
<span class="lineno"></span><span class="comment" id="5810256">//&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;).</span><br>
<span class="lineno"></span><span class="keyword" id="5810281">func</span>&nbsp;<span class="ident" id="5810286">emphasize</span><span class="op" id="5810295">(</span><span class="ident" id="5810296">w</span>&nbsp;<span class="ident" id="5810298">io</span><span class="op" id="5810300">.</span><span class="ident" id="5810301">Writer</span><span class="op" id="5810307">,</span>&nbsp;<span class="ident" id="5810309">line</span>&nbsp;<span class="builtintype" id="5810314">string</span><span class="op" id="5810320">,</span>&nbsp;<span class="ident" id="5810322">words</span>&nbsp;<span class="keyword" id="5810328">map</span><span class="op" id="5810331">[</span><span class="builtintype" id="5810332">string</span><span class="op" id="5810338">]</span><span class="builtintype" id="5810339">string</span><span class="op" id="5810345">,</span>&nbsp;<span class="ident" id="5810347">nice</span>&nbsp;<span class="builtintype" id="5810352">bool</span><span class="op" id="5810356">)</span>&nbsp;<span class="op" id="5810358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810361">for</span>&nbsp;<span class="op" id="5810365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810369">m</span>&nbsp;<span class="op" id="5810371">:=</span>&nbsp;<span class="ident" id="5810374">matchRx</span><span class="op" id="5810381">.</span><span class="ident" id="5810382">FindStringSubmatchIndex</span><span class="op" id="5810405">(</span><span class="ident" id="5810406">line</span><span class="op" id="5810410">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810414">if</span>&nbsp;<span class="ident" id="5810417">m</span>&nbsp;<span class="op" id="5810419">==</span>&nbsp;<span class="ident" id="5810422">nil</span>&nbsp;<span class="op" id="5810426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810431">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5810443">//&nbsp;m&nbsp;&gt;=&nbsp;6&nbsp;(two&nbsp;parenthesized&nbsp;sub-regexps&nbsp;in&nbsp;matchRx,&nbsp;1st&nbsp;one&nbsp;is&nbsp;urlRx)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5810517">//&nbsp;write&nbsp;text&nbsp;before&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810546">commentEscape</span><span class="op" id="5810559">(</span><span class="ident" id="5810560">w</span><span class="op" id="5810561">,</span>&nbsp;<span class="ident" id="5810563">line</span><span class="op" id="5810567">[</span><span class="num" id="5810568">0</span><span class="op" id="5810569">:</span><span class="ident" id="5810570">m</span><span class="op" id="5810571">[</span><span class="num" id="5810572">0</span><span class="op" id="5810573">]</span><span class="op" id="5810574">]</span><span class="op" id="5810575">,</span>&nbsp;<span class="ident" id="5810577">nice</span><span class="op" id="5810581">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5810586">//&nbsp;adjust&nbsp;match&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810617">match</span>&nbsp;<span class="op" id="5810623">:=</span>&nbsp;<span class="ident" id="5810626">line</span><span class="op" id="5810630">[</span><span class="ident" id="5810631">m</span><span class="op" id="5810632">[</span><span class="num" id="5810633">0</span><span class="op" id="5810634">]</span><span class="op" id="5810635">:</span><span class="ident" id="5810636">m</span><span class="op" id="5810637">[</span><span class="num" id="5810638">1</span><span class="op" id="5810639">]</span><span class="op" id="5810640">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810644">if</span>&nbsp;<span class="ident" id="5810647">n</span>&nbsp;<span class="op" id="5810649">:=</span>&nbsp;<span class="ident" id="5810652">pairedParensPrefixLen</span><span class="op" id="5810673">(</span><span class="ident" id="5810674">match</span><span class="op" id="5810679">)</span><span class="op" id="5810680">;</span>&nbsp;<span class="ident" id="5810682">n</span>&nbsp;<span class="op" id="5810684">&lt;</span>&nbsp;<span class="builtinfunc" id="5810686">len</span><span class="op" id="5810689">(</span><span class="ident" id="5810690">match</span><span class="op" id="5810695">)</span>&nbsp;<span class="op" id="5810697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5810702">//&nbsp;match&nbsp;contains&nbsp;unpaired&nbsp;parentheses&nbsp;(rare);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5810752">//&nbsp;redo&nbsp;matching&nbsp;with&nbsp;shortened&nbsp;line&nbsp;for&nbsp;correct&nbsp;indices</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810812">m</span>&nbsp;<span class="op" id="5810814">=</span>&nbsp;<span class="ident" id="5810816">matchRx</span><span class="op" id="5810823">.</span><span class="ident" id="5810824">FindStringSubmatchIndex</span><span class="op" id="5810847">(</span><span class="ident" id="5810848">line</span><span class="op" id="5810852">[</span><span class="op" id="5810853">:</span><span class="ident" id="5810854">m</span><span class="op" id="5810855">[</span><span class="num" id="5810856">0</span><span class="op" id="5810857">]</span><span class="op" id="5810858">+</span><span class="ident" id="5810859">n</span><span class="op" id="5810860">]</span><span class="op" id="5810861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810866">match</span>&nbsp;<span class="op" id="5810872">=</span>&nbsp;<span class="ident" id="5810874">match</span><span class="op" id="5810879">[</span><span class="op" id="5810880">:</span><span class="ident" id="5810881">n</span><span class="op" id="5810882">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5810891">//&nbsp;analyze&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810910">url</span>&nbsp;<span class="op" id="5810914">:=</span>&nbsp;<span class="string" id="5810917">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810922">italics</span>&nbsp;<span class="op" id="5810930">:=</span>&nbsp;<span class="builtintype" id="5810933">false</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810941">if</span>&nbsp;<span class="ident" id="5810944">words</span>&nbsp;<span class="op" id="5810950">!=</span>&nbsp;<span class="ident" id="5810953">nil</span>&nbsp;<span class="op" id="5810957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810962">url</span><span class="op" id="5810965">,</span>&nbsp;<span class="ident" id="5810967">italics</span>&nbsp;<span class="op" id="5810975">=</span>&nbsp;<span class="ident" id="5810977">words</span><span class="op" id="5810982">[</span><span class="ident" id="5810983">match</span><span class="op" id="5810988">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810996">if</span>&nbsp;<span class="ident" id="5810999">m</span><span class="op" id="5811000">[</span><span class="num" id="5811001">2</span><span class="op" id="5811002">]</span>&nbsp;<span class="op" id="5811004">&gt;=</span>&nbsp;<span class="num" id="5811007">0</span>&nbsp;<span class="op" id="5811009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5811014">//&nbsp;match&nbsp;against&nbsp;first&nbsp;parenthesized&nbsp;sub-regexp;&nbsp;must&nbsp;be&nbsp;match&nbsp;against&nbsp;urlRx</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811094">if</span>&nbsp;<span class="op" id="5811097">!</span><span class="ident" id="5811098">italics</span>&nbsp;<span class="op" id="5811106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5811112">//&nbsp;no&nbsp;alternative&nbsp;URL&nbsp;in&nbsp;words&nbsp;list,&nbsp;use&nbsp;match&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811171">url</span>&nbsp;<span class="op" id="5811175">=</span>&nbsp;<span class="ident" id="5811177">match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811191">italics</span>&nbsp;<span class="op" id="5811199">=</span>&nbsp;<span class="builtintype" id="5811201">false</span>&nbsp;<span class="comment" id="5811207">//&nbsp;don&#39;t&nbsp;italicize&nbsp;URLs</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5811238">//&nbsp;write&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811255">if</span>&nbsp;<span class="builtinfunc" id="5811258">len</span><span class="op" id="5811261">(</span><span class="ident" id="5811262">url</span><span class="op" id="5811265">)</span>&nbsp;<span class="op" id="5811267">&gt;</span>&nbsp;<span class="num" id="5811269">0</span>&nbsp;<span class="op" id="5811271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811276">w</span><span class="op" id="5811277">.</span><span class="ident" id="5811278">Write</span><span class="op" id="5811283">(</span><span class="ident" id="5811284">html_a</span><span class="op" id="5811290">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811295">template</span><span class="op" id="5811303">.</span><span class="ident" id="5811304">HTMLEscape</span><span class="op" id="5811314">(</span><span class="ident" id="5811315">w</span><span class="op" id="5811316">,</span>&nbsp;<span class="op" id="5811318">[</span><span class="op" id="5811319">]</span><span class="builtintype" id="5811320">byte</span><span class="op" id="5811324">(</span><span class="ident" id="5811325">url</span><span class="op" id="5811328">)</span><span class="op" id="5811329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811334">w</span><span class="op" id="5811335">.</span><span class="ident" id="5811336">Write</span><span class="op" id="5811341">(</span><span class="ident" id="5811342">html_aq</span><span class="op" id="5811349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811357">if</span>&nbsp;<span class="ident" id="5811360">italics</span>&nbsp;<span class="op" id="5811368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811373">w</span><span class="op" id="5811374">.</span><span class="ident" id="5811375">Write</span><span class="op" id="5811380">(</span><span class="ident" id="5811381">html_i</span><span class="op" id="5811387">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811395">commentEscape</span><span class="op" id="5811408">(</span><span class="ident" id="5811409">w</span><span class="op" id="5811410">,</span>&nbsp;<span class="ident" id="5811412">match</span><span class="op" id="5811417">,</span>&nbsp;<span class="ident" id="5811419">nice</span><span class="op" id="5811423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811427">if</span>&nbsp;<span class="ident" id="5811430">italics</span>&nbsp;<span class="op" id="5811438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811443">w</span><span class="op" id="5811444">.</span><span class="ident" id="5811445">Write</span><span class="op" id="5811450">(</span><span class="ident" id="5811451">html_endi</span><span class="op" id="5811460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811464">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811468">if</span>&nbsp;<span class="builtinfunc" id="5811471">len</span><span class="op" id="5811474">(</span><span class="ident" id="5811475">url</span><span class="op" id="5811478">)</span>&nbsp;<span class="op" id="5811480">&gt;</span>&nbsp;<span class="num" id="5811482">0</span>&nbsp;<span class="op" id="5811484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811489">w</span><span class="op" id="5811490">.</span><span class="ident" id="5811491">Write</span><span class="op" id="5811496">(</span><span class="ident" id="5811497">html_enda</span><span class="op" id="5811506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5811515">//&nbsp;advance</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811528">line</span>&nbsp;<span class="op" id="5811533">=</span>&nbsp;<span class="ident" id="5811535">line</span><span class="op" id="5811539">[</span><span class="ident" id="5811540">m</span><span class="op" id="5811541">[</span><span class="num" id="5811542">1</span><span class="op" id="5811543">]</span><span class="op" id="5811544">:</span><span class="op" id="5811545">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811551">commentEscape</span><span class="op" id="5811564">(</span><span class="ident" id="5811565">w</span><span class="op" id="5811566">,</span>&nbsp;<span class="ident" id="5811568">line</span><span class="op" id="5811572">,</span>&nbsp;<span class="ident" id="5811574">nice</span><span class="op" id="5811578">)</span><br>
<span class="lineno"></span><span class="op" id="5811580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="5811583">func</span>&nbsp;<span class="ident" id="5811588">indentLen</span><span class="op" id="5811597">(</span><span class="ident" id="5811598">s</span>&nbsp;<span class="builtintype" id="5811600">string</span><span class="op" id="5811606">)</span>&nbsp;<span class="builtintype" id="5811608">int</span>&nbsp;<span class="op" id="5811612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811615">i</span>&nbsp;<span class="op" id="5811617">:=</span>&nbsp;<span class="num" id="5811620">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811623">for</span>&nbsp;<span class="ident" id="5811627">i</span>&nbsp;<span class="op" id="5811629">&lt;</span>&nbsp;<span class="builtinfunc" id="5811631">len</span><span class="op" id="5811634">(</span><span class="ident" id="5811635">s</span><span class="op" id="5811636">)</span>&nbsp;<span class="op" id="5811638">&amp;&amp;</span>&nbsp;<span class="op" id="5811641">(</span><span class="ident" id="5811642">s</span><span class="op" id="5811643">[</span><span class="ident" id="5811644">i</span><span class="op" id="5811645">]</span>&nbsp;<span class="op" id="5811647">==</span>&nbsp;<span class="string" id="5811650">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5811654">||</span>&nbsp;<span class="ident" id="5811657">s</span><span class="op" id="5811658">[</span><span class="ident" id="5811659">i</span><span class="op" id="5811660">]</span>&nbsp;<span class="op" id="5811662">==</span>&nbsp;<span class="string" id="5811665">&#39;\t&#39;</span><span class="op" id="5811669">)</span>&nbsp;<span class="op" id="5811671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811675">i</span><span class="op" id="5811676">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811680">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811683">return</span>&nbsp;<span class="ident" id="5811690">i</span><br>
<span class="lineno"></span><span class="op" id="5811692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5811695">func</span>&nbsp;<span class="ident" id="5811700">isBlank</span><span class="op" id="5811707">(</span><span class="ident" id="5811708">s</span>&nbsp;<span class="builtintype" id="5811710">string</span><span class="op" id="5811716">)</span>&nbsp;<span class="builtintype" id="5811718">bool</span>&nbsp;<span class="op" id="5811723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811726">return</span>&nbsp;<span class="builtinfunc" id="5811733">len</span><span class="op" id="5811736">(</span><span class="ident" id="5811737">s</span><span class="op" id="5811738">)</span>&nbsp;<span class="op" id="5811740">==</span>&nbsp;<span class="num" id="5811743">0</span>&nbsp;<span class="op" id="5811745">||</span>&nbsp;<span class="op" id="5811748">(</span><span class="builtinfunc" id="5811749">len</span><span class="op" id="5811752">(</span><span class="ident" id="5811753">s</span><span class="op" id="5811754">)</span>&nbsp;<span class="op" id="5811756">==</span>&nbsp;<span class="num" id="5811759">1</span>&nbsp;<span class="op" id="5811761">&amp;&amp;</span>&nbsp;<span class="ident" id="5811764">s</span><span class="op" id="5811765">[</span><span class="num" id="5811766">0</span><span class="op" id="5811767">]</span>&nbsp;<span class="op" id="5811769">==</span>&nbsp;<span class="string" id="5811772">&#39;\n&#39;</span><span class="op" id="5811776">)</span><br>
<span class="lineno">175</span><span class="op" id="5811778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5811781">func</span>&nbsp;<span class="ident" id="5811786">commonPrefix</span><span class="op" id="5811798">(</span><span class="ident" id="5811799">a</span><span class="op" id="5811800">,</span>&nbsp;<span class="ident" id="5811802">b</span>&nbsp;<span class="builtintype" id="5811804">string</span><span class="op" id="5811810">)</span>&nbsp;<span class="builtintype" id="5811812">string</span>&nbsp;<span class="op" id="5811819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811822">i</span>&nbsp;<span class="op" id="5811824">:=</span>&nbsp;<span class="num" id="5811827">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811830">for</span>&nbsp;<span class="ident" id="5811834">i</span>&nbsp;<span class="op" id="5811836">&lt;</span>&nbsp;<span class="builtinfunc" id="5811838">len</span><span class="op" id="5811841">(</span><span class="ident" id="5811842">a</span><span class="op" id="5811843">)</span>&nbsp;<span class="op" id="5811845">&amp;&amp;</span>&nbsp;<span class="ident" id="5811848">i</span>&nbsp;<span class="op" id="5811850">&lt;</span>&nbsp;<span class="builtinfunc" id="5811852">len</span><span class="op" id="5811855">(</span><span class="ident" id="5811856">b</span><span class="op" id="5811857">)</span>&nbsp;<span class="op" id="5811859">&amp;&amp;</span>&nbsp;<span class="ident" id="5811862">a</span><span class="op" id="5811863">[</span><span class="ident" id="5811864">i</span><span class="op" id="5811865">]</span>&nbsp;<span class="op" id="5811867">==</span>&nbsp;<span class="ident" id="5811870">b</span><span class="op" id="5811871">[</span><span class="ident" id="5811872">i</span><span class="op" id="5811873">]</span>&nbsp;<span class="op" id="5811875">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811879">i</span><span class="op" id="5811880">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811887">return</span>&nbsp;<span class="ident" id="5811894">a</span><span class="op" id="5811895">[</span><span class="num" id="5811896">0</span><span class="op" id="5811897">:</span><span class="ident" id="5811898">i</span><span class="op" id="5811899">]</span><br>
<span class="lineno"></span><span class="op" id="5811901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="5811904">func</span>&nbsp;<span class="ident" id="5811909">unindent</span><span class="op" id="5811917">(</span><span class="ident" id="5811918">block</span>&nbsp;<span class="op" id="5811924">[</span><span class="op" id="5811925">]</span><span class="builtintype" id="5811926">string</span><span class="op" id="5811932">)</span>&nbsp;<span class="op" id="5811934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811937">if</span>&nbsp;<span class="builtinfunc" id="5811940">len</span><span class="op" id="5811943">(</span><span class="ident" id="5811944">block</span><span class="op" id="5811949">)</span>&nbsp;<span class="op" id="5811951">==</span>&nbsp;<span class="num" id="5811954">0</span>&nbsp;<span class="op" id="5811956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811960">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5811972">//&nbsp;compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812012">prefix</span>&nbsp;<span class="op" id="5812019">:=</span>&nbsp;<span class="ident" id="5812022">block</span><span class="op" id="5812027">[</span><span class="num" id="5812028">0</span><span class="op" id="5812029">]</span><span class="op" id="5812030">[</span><span class="num" id="5812031">0</span><span class="op" id="5812032">:</span><span class="ident" id="5812033">indentLen</span><span class="op" id="5812042">(</span><span class="ident" id="5812043">block</span><span class="op" id="5812048">[</span><span class="num" id="5812049">0</span><span class="op" id="5812050">]</span><span class="op" id="5812051">)</span><span class="op" id="5812052">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812055">for</span>&nbsp;<span class="ident" id="5812059">_</span><span class="op" id="5812060">,</span>&nbsp;<span class="ident" id="5812062">line</span>&nbsp;<span class="op" id="5812067">:=</span>&nbsp;<span class="keyword" id="5812070">range</span>&nbsp;<span class="ident" id="5812076">block</span>&nbsp;<span class="op" id="5812082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812086">if</span>&nbsp;<span class="op" id="5812089">!</span><span class="ident" id="5812090">isBlank</span><span class="op" id="5812097">(</span><span class="ident" id="5812098">line</span><span class="op" id="5812102">)</span>&nbsp;<span class="op" id="5812104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812109">prefix</span>&nbsp;<span class="op" id="5812116">=</span>&nbsp;<span class="ident" id="5812118">commonPrefix</span><span class="op" id="5812130">(</span><span class="ident" id="5812131">prefix</span><span class="op" id="5812137">,</span>&nbsp;<span class="ident" id="5812139">line</span><span class="op" id="5812143">[</span><span class="num" id="5812144">0</span><span class="op" id="5812145">:</span><span class="ident" id="5812146">indentLen</span><span class="op" id="5812155">(</span><span class="ident" id="5812156">line</span><span class="op" id="5812160">)</span><span class="op" id="5812161">]</span><span class="op" id="5812162">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812172">n</span>&nbsp;<span class="op" id="5812174">:=</span>&nbsp;<span class="builtinfunc" id="5812177">len</span><span class="op" id="5812180">(</span><span class="ident" id="5812181">prefix</span><span class="op" id="5812187">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5812191">//&nbsp;remove</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812202">for</span>&nbsp;<span class="ident" id="5812206">i</span><span class="op" id="5812207">,</span>&nbsp;<span class="ident" id="5812209">line</span>&nbsp;<span class="op" id="5812214">:=</span>&nbsp;<span class="keyword" id="5812217">range</span>&nbsp;<span class="ident" id="5812223">block</span>&nbsp;<span class="op" id="5812229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812233">if</span>&nbsp;<span class="op" id="5812236">!</span><span class="ident" id="5812237">isBlank</span><span class="op" id="5812244">(</span><span class="ident" id="5812245">line</span><span class="op" id="5812249">)</span>&nbsp;<span class="op" id="5812251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812256">block</span><span class="op" id="5812261">[</span><span class="ident" id="5812262">i</span><span class="op" id="5812263">]</span>&nbsp;<span class="op" id="5812265">=</span>&nbsp;<span class="ident" id="5812267">line</span><span class="op" id="5812271">[</span><span class="ident" id="5812272">n</span><span class="op" id="5812273">:</span><span class="op" id="5812274">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812281">}</span><br>
<span class="lineno">205</span><span class="op" id="5812283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5812286">//&nbsp;heading&nbsp;returns&nbsp;the&nbsp;trimmed&nbsp;line&nbsp;if&nbsp;it&nbsp;passes&nbsp;as&nbsp;a&nbsp;section&nbsp;heading;</span><br>
<span class="lineno"></span><span class="comment" id="5812357">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5812399">func</span>&nbsp;<span class="ident" id="5812404">heading</span><span class="op" id="5812411">(</span><span class="ident" id="5812412">line</span>&nbsp;<span class="builtintype" id="5812417">string</span><span class="op" id="5812423">)</span>&nbsp;<span class="builtintype" id="5812425">string</span>&nbsp;<span class="op" id="5812432">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812435">line</span>&nbsp;<span class="op" id="5812440">=</span>&nbsp;<span class="ident" id="5812442">strings</span><span class="op" id="5812449">.</span><span class="ident" id="5812450">TrimSpace</span><span class="op" id="5812459">(</span><span class="ident" id="5812460">line</span><span class="op" id="5812464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812467">if</span>&nbsp;<span class="builtinfunc" id="5812470">len</span><span class="op" id="5812473">(</span><span class="ident" id="5812474">line</span><span class="op" id="5812478">)</span>&nbsp;<span class="op" id="5812480">==</span>&nbsp;<span class="num" id="5812483">0</span>&nbsp;<span class="op" id="5812485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812489">return</span>&nbsp;<span class="string" id="5812496">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5812504">//&nbsp;a&nbsp;heading&nbsp;must&nbsp;start&nbsp;with&nbsp;an&nbsp;uppercase&nbsp;letter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812554">r</span><span class="op" id="5812555">,</span>&nbsp;<span class="ident" id="5812557">_</span>&nbsp;<span class="op" id="5812559">:=</span>&nbsp;<span class="ident" id="5812562">utf8</span><span class="op" id="5812566">.</span><span class="ident" id="5812567">DecodeRuneInString</span><span class="op" id="5812585">(</span><span class="ident" id="5812586">line</span><span class="op" id="5812590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812593">if</span>&nbsp;<span class="op" id="5812596">!</span><span class="ident" id="5812597">unicode</span><span class="op" id="5812604">.</span><span class="ident" id="5812605">IsLetter</span><span class="op" id="5812613">(</span><span class="ident" id="5812614">r</span><span class="op" id="5812615">)</span>&nbsp;<span class="op" id="5812617">||</span>&nbsp;<span class="op" id="5812620">!</span><span class="ident" id="5812621">unicode</span><span class="op" id="5812628">.</span><span class="ident" id="5812629">IsUpper</span><span class="op" id="5812636">(</span><span class="ident" id="5812637">r</span><span class="op" id="5812638">)</span>&nbsp;<span class="op" id="5812640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812644">return</span>&nbsp;<span class="string" id="5812651">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812655">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5812659">//&nbsp;it&nbsp;must&nbsp;end&nbsp;in&nbsp;a&nbsp;letter&nbsp;or&nbsp;digit:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812697">r</span><span class="op" id="5812698">,</span>&nbsp;<span class="ident" id="5812700">_</span>&nbsp;<span class="op" id="5812702">=</span>&nbsp;<span class="ident" id="5812704">utf8</span><span class="op" id="5812708">.</span><span class="ident" id="5812709">DecodeLastRuneInString</span><span class="op" id="5812731">(</span><span class="ident" id="5812732">line</span><span class="op" id="5812736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812739">if</span>&nbsp;<span class="op" id="5812742">!</span><span class="ident" id="5812743">unicode</span><span class="op" id="5812750">.</span><span class="ident" id="5812751">IsLetter</span><span class="op" id="5812759">(</span><span class="ident" id="5812760">r</span><span class="op" id="5812761">)</span>&nbsp;<span class="op" id="5812763">&amp;&amp;</span>&nbsp;<span class="op" id="5812766">!</span><span class="ident" id="5812767">unicode</span><span class="op" id="5812774">.</span><span class="ident" id="5812775">IsDigit</span><span class="op" id="5812782">(</span><span class="ident" id="5812783">r</span><span class="op" id="5812784">)</span>&nbsp;<span class="op" id="5812786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812790">return</span>&nbsp;<span class="string" id="5812797">&#34;&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5812805">//&nbsp;exclude&nbsp;lines&nbsp;with&nbsp;illegal&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812847">if</span>&nbsp;<span class="ident" id="5812850">strings</span><span class="op" id="5812857">.</span><span class="ident" id="5812858">IndexAny</span><span class="op" id="5812866">(</span><span class="ident" id="5812867">line</span><span class="op" id="5812871">,</span>&nbsp;<span class="string" id="5812873">&#34;,.;:!?+*/=()[]{}_^°&amp;§~%#@&lt;\&#34;&gt;\\&#34;</span><span class="op" id="5812908">)</span>&nbsp;<span class="op" id="5812910">&gt;=</span>&nbsp;<span class="num" id="5812913">0</span>&nbsp;<span class="op" id="5812915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812919">return</span>&nbsp;<span class="string" id="5812926">&#34;&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5812934">//&nbsp;allow&nbsp;&#34;&#39;&#34;&nbsp;for&nbsp;possessive&nbsp;&#34;&#39;s&#34;&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812973">for</span>&nbsp;<span class="ident" id="5812977">b</span>&nbsp;<span class="op" id="5812979">:=</span>&nbsp;<span class="ident" id="5812982">line</span><span class="op" id="5812986">;</span>&nbsp;<span class="op" id="5812988">;</span>&nbsp;<span class="op" id="5812990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812994">i</span>&nbsp;<span class="op" id="5812996">:=</span>&nbsp;<span class="ident" id="5812999">strings</span><span class="op" id="5813006">.</span><span class="ident" id="5813007">IndexRune</span><span class="op" id="5813016">(</span><span class="ident" id="5813017">b</span><span class="op" id="5813018">,</span>&nbsp;<span class="string" id="5813020">&#39;\&#39;&#39;</span><span class="op" id="5813024">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813028">if</span>&nbsp;<span class="ident" id="5813031">i</span>&nbsp;<span class="op" id="5813033">&lt;</span>&nbsp;<span class="num" id="5813035">0</span>&nbsp;<span class="op" id="5813037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813042">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813054">if</span>&nbsp;<span class="ident" id="5813057">i</span><span class="op" id="5813058">+</span><span class="num" id="5813059">1</span>&nbsp;<span class="op" id="5813061">&gt;=</span>&nbsp;<span class="builtinfunc" id="5813064">len</span><span class="op" id="5813067">(</span><span class="ident" id="5813068">b</span><span class="op" id="5813069">)</span>&nbsp;<span class="op" id="5813071">||</span>&nbsp;<span class="ident" id="5813074">b</span><span class="op" id="5813075">[</span><span class="ident" id="5813076">i</span><span class="op" id="5813077">+</span><span class="num" id="5813078">1</span><span class="op" id="5813079">]</span>&nbsp;<span class="op" id="5813081">!=</span>&nbsp;<span class="string" id="5813084">&#39;s&#39;</span>&nbsp;<span class="op" id="5813088">||</span>&nbsp;<span class="op" id="5813091">(</span><span class="ident" id="5813092">i</span><span class="op" id="5813093">+</span><span class="num" id="5813094">2</span>&nbsp;<span class="op" id="5813096">&lt;</span>&nbsp;<span class="builtinfunc" id="5813098">len</span><span class="op" id="5813101">(</span><span class="ident" id="5813102">b</span><span class="op" id="5813103">)</span>&nbsp;<span class="op" id="5813105">&amp;&amp;</span>&nbsp;<span class="ident" id="5813108">b</span><span class="op" id="5813109">[</span><span class="ident" id="5813110">i</span><span class="op" id="5813111">+</span><span class="num" id="5813112">2</span><span class="op" id="5813113">]</span>&nbsp;<span class="op" id="5813115">!=</span>&nbsp;<span class="string" id="5813118">&#39;&nbsp;&#39;</span><span class="op" id="5813121">)</span>&nbsp;<span class="op" id="5813123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813128">return</span>&nbsp;<span class="string" id="5813135">&#34;&#34;</span>&nbsp;<span class="comment" id="5813138">//&nbsp;not&nbsp;followed&nbsp;by&nbsp;&#34;s&nbsp;&#34;</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813168">b</span>&nbsp;<span class="op" id="5813170">=</span>&nbsp;<span class="ident" id="5813172">b</span><span class="op" id="5813173">[</span><span class="ident" id="5813174">i</span><span class="op" id="5813175">+</span><span class="num" id="5813176">2</span><span class="op" id="5813177">:</span><span class="op" id="5813178">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813185">return</span>&nbsp;<span class="ident" id="5813192">line</span><br>
<span class="lineno">245</span><span class="op" id="5813197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5813200">type</span>&nbsp;<span class="ident" id="5813205">op</span>&nbsp;<span class="builtintype" id="5813208">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5813213">const</span>&nbsp;<span class="op" id="5813219">(</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813222">opPara</span>&nbsp;<span class="ident" id="5813229">op</span>&nbsp;<span class="op" id="5813232">=</span>&nbsp;<span class="ident" id="5813234">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813240">opHead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813248">opPre</span><br>
<span class="lineno"></span><span class="op" id="5813254">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="5813257">type</span>&nbsp;<span class="ident" id="5813262">block</span>&nbsp;<span class="keyword" id="5813268">struct</span>&nbsp;<span class="op" id="5813275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813278">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5813284">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813288">lines</span>&nbsp;<span class="op" id="5813294">[</span><span class="op" id="5813295">]</span><span class="builtintype" id="5813296">string</span><br>
<span class="lineno"></span><span class="op" id="5813303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="5813306">var</span>&nbsp;<span class="ident" id="5813310">nonAlphaNumRx</span>&nbsp;<span class="op" id="5813324">=</span>&nbsp;<span class="ident" id="5813326">regexp</span><span class="op" id="5813332">.</span><span class="ident" id="5813333">MustCompile</span><span class="op" id="5813344">(</span><span class="string" id="5813345">`[^a-zA-Z0-9]`</span><span class="op" id="5813359">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5813362">func</span>&nbsp;<span class="ident" id="5813367">anchorID</span><span class="op" id="5813375">(</span><span class="ident" id="5813376">line</span>&nbsp;<span class="builtintype" id="5813381">string</span><span class="op" id="5813387">)</span>&nbsp;<span class="builtintype" id="5813389">string</span>&nbsp;<span class="op" id="5813396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5813399">//&nbsp;Add&nbsp;a&nbsp;&#34;hdr-&#34;&nbsp;prefix&nbsp;to&nbsp;avoid&nbsp;conflicting&nbsp;with&nbsp;IDs&nbsp;used&nbsp;for&nbsp;package&nbsp;symbols.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813479">return</span>&nbsp;<span class="string" id="5813486">&#34;hdr-&#34;</span>&nbsp;<span class="op" id="5813493">+</span>&nbsp;<span class="ident" id="5813495">nonAlphaNumRx</span><span class="op" id="5813508">.</span><span class="ident" id="5813509">ReplaceAllString</span><span class="op" id="5813525">(</span><span class="ident" id="5813526">line</span><span class="op" id="5813530">,</span>&nbsp;<span class="string" id="5813532">&#34;_&#34;</span><span class="op" id="5813535">)</span><br>
<span class="lineno">265</span><span class="op" id="5813537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5813540">//&nbsp;ToHTML&nbsp;converts&nbsp;comment&nbsp;text&nbsp;to&nbsp;formatted&nbsp;HTML.</span><br>
<span class="lineno"></span><span class="comment" id="5813591">//&nbsp;The&nbsp;comment&nbsp;was&nbsp;prepared&nbsp;by&nbsp;DocReader,</span><br>
<span class="lineno"></span><span class="comment" id="5813633">//&nbsp;so&nbsp;it&nbsp;is&nbsp;known&nbsp;not&nbsp;to&nbsp;have&nbsp;leading,&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">270</span><span class="comment" id="5813693">//&nbsp;nor&nbsp;to&nbsp;have&nbsp;trailing&nbsp;spaces&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;lines.</span><br>
<span class="lineno"></span><span class="comment" id="5813745">//&nbsp;The&nbsp;comment&nbsp;markers&nbsp;have&nbsp;already&nbsp;been&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="5813795">//</span><br>
<span class="lineno"></span><span class="comment" id="5813798">//&nbsp;Each&nbsp;span&nbsp;of&nbsp;unindented&nbsp;non-blank&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="5813859">//&nbsp;a&nbsp;single&nbsp;paragraph.&nbsp;There&nbsp;is&nbsp;one&nbsp;exception&nbsp;to&nbsp;the&nbsp;rule:&nbsp;a&nbsp;span&nbsp;that</span><br>
<span class="lineno">275</span><span class="comment" id="5813930">//&nbsp;consists&nbsp;of&nbsp;a&nbsp;single&nbsp;line,&nbsp;is&nbsp;followed&nbsp;by&nbsp;another&nbsp;paragraph&nbsp;span,</span><br>
<span class="lineno"></span><span class="comment" id="5813999">//&nbsp;begins&nbsp;with&nbsp;a&nbsp;capital&nbsp;letter,&nbsp;and&nbsp;contains&nbsp;no&nbsp;punctuation</span><br>
<span class="lineno"></span><span class="comment" id="5814060">//&nbsp;is&nbsp;formatted&nbsp;as&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span><span class="comment" id="5814090">//</span><br>
<span class="lineno"></span><span class="comment" id="5814093">//&nbsp;A&nbsp;span&nbsp;of&nbsp;indented&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;&lt;pre&gt;&nbsp;block,</span><br>
<span class="lineno">280</span><span class="comment" id="5814154">//&nbsp;with&nbsp;the&nbsp;common&nbsp;indent&nbsp;prefix&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="5814196">//</span><br>
<span class="lineno"></span><span class="comment" id="5814199">//&nbsp;URLs&nbsp;in&nbsp;the&nbsp;comment&nbsp;text&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears</span><br>
<span class="lineno"></span><span class="comment" id="5814277">//&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if&nbsp;the&nbsp;corresponding&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="5814355">//&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted&nbsp;into&nbsp;a&nbsp;link).</span><br>
<span class="lineno">285</span><span class="comment" id="5814424">//</span><br>
<span class="lineno"></span><span class="comment" id="5814427">//&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="5814511">//&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="5814598">//&nbsp;into&nbsp;a&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="5814614">func</span>&nbsp;<span class="ident" id="5814619">ToHTML</span><span class="op" id="5814625">(</span><span class="ident" id="5814626">w</span>&nbsp;<span class="ident" id="5814628">io</span><span class="op" id="5814630">.</span><span class="ident" id="5814631">Writer</span><span class="op" id="5814637">,</span>&nbsp;<span class="ident" id="5814639">text</span>&nbsp;<span class="builtintype" id="5814644">string</span><span class="op" id="5814650">,</span>&nbsp;<span class="ident" id="5814652">words</span>&nbsp;<span class="keyword" id="5814658">map</span><span class="op" id="5814661">[</span><span class="builtintype" id="5814662">string</span><span class="op" id="5814668">]</span><span class="builtintype" id="5814669">string</span><span class="op" id="5814675">)</span>&nbsp;<span class="op" id="5814677">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814680">for</span>&nbsp;<span class="ident" id="5814684">_</span><span class="op" id="5814685">,</span>&nbsp;<span class="ident" id="5814687">b</span>&nbsp;<span class="op" id="5814689">:=</span>&nbsp;<span class="keyword" id="5814692">range</span>&nbsp;<span class="ident" id="5814698">blocks</span><span class="op" id="5814704">(</span><span class="ident" id="5814705">text</span><span class="op" id="5814709">)</span>&nbsp;<span class="op" id="5814711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814715">switch</span>&nbsp;<span class="ident" id="5814722">b</span><span class="op" id="5814723">.</span><span class="ident" id="5814724">op</span>&nbsp;<span class="op" id="5814727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814731">case</span>&nbsp;<span class="ident" id="5814736">opPara</span><span class="op" id="5814742">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5814747">w</span><span class="op" id="5814748">.</span><span class="ident" id="5814749">Write</span><span class="op" id="5814754">(</span><span class="ident" id="5814755">html_p</span><span class="op" id="5814761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814766">for</span>&nbsp;<span class="ident" id="5814770">_</span><span class="op" id="5814771">,</span>&nbsp;<span class="ident" id="5814773">line</span>&nbsp;<span class="op" id="5814778">:=</span>&nbsp;<span class="keyword" id="5814781">range</span>&nbsp;<span class="ident" id="5814787">b</span><span class="op" id="5814788">.</span><span class="ident" id="5814789">lines</span>&nbsp;<span class="op" id="5814795">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5814801">emphasize</span><span class="op" id="5814810">(</span><span class="ident" id="5814811">w</span><span class="op" id="5814812">,</span>&nbsp;<span class="ident" id="5814814">line</span><span class="op" id="5814818">,</span>&nbsp;<span class="ident" id="5814820">words</span><span class="op" id="5814825">,</span>&nbsp;<span class="builtintype" id="5814827">true</span><span class="op" id="5814831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5814836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5814841">w</span><span class="op" id="5814842">.</span><span class="ident" id="5814843">Write</span><span class="op" id="5814848">(</span><span class="ident" id="5814849">html_endp</span><span class="op" id="5814858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814862">case</span>&nbsp;<span class="ident" id="5814867">opHead</span><span class="op" id="5814873">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5814878">w</span><span class="op" id="5814879">.</span><span class="ident" id="5814880">Write</span><span class="op" id="5814885">(</span><span class="ident" id="5814886">html_h</span><span class="op" id="5814892">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5814897">id</span>&nbsp;<span class="op" id="5814900">:=</span>&nbsp;<span class="string" id="5814903">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814909">for</span>&nbsp;<span class="ident" id="5814913">_</span><span class="op" id="5814914">,</span>&nbsp;<span class="ident" id="5814916">line</span>&nbsp;<span class="op" id="5814921">:=</span>&nbsp;<span class="keyword" id="5814924">range</span>&nbsp;<span class="ident" id="5814930">b</span><span class="op" id="5814931">.</span><span class="ident" id="5814932">lines</span>&nbsp;<span class="op" id="5814938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814944">if</span>&nbsp;<span class="ident" id="5814947">id</span>&nbsp;<span class="op" id="5814950">==</span>&nbsp;<span class="string" id="5814953">&#34;&#34;</span>&nbsp;<span class="op" id="5814956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5814963">id</span>&nbsp;<span class="op" id="5814966">=</span>&nbsp;<span class="ident" id="5814968">anchorID</span><span class="op" id="5814976">(</span><span class="ident" id="5814977">line</span><span class="op" id="5814981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5814988">w</span><span class="op" id="5814989">.</span><span class="ident" id="5814990">Write</span><span class="op" id="5814995">(</span><span class="op" id="5814996">[</span><span class="op" id="5814997">]</span><span class="builtintype" id="5814998">byte</span><span class="op" id="5815002">(</span><span class="ident" id="5815003">id</span><span class="op" id="5815005">)</span><span class="op" id="5815006">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815013">w</span><span class="op" id="5815014">.</span><span class="ident" id="5815015">Write</span><span class="op" id="5815020">(</span><span class="ident" id="5815021">html_hq</span><span class="op" id="5815028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815040">commentEscape</span><span class="op" id="5815053">(</span><span class="ident" id="5815054">w</span><span class="op" id="5815055">,</span>&nbsp;<span class="ident" id="5815057">line</span><span class="op" id="5815061">,</span>&nbsp;<span class="builtintype" id="5815063">true</span><span class="op" id="5815067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815077">if</span>&nbsp;<span class="ident" id="5815080">id</span>&nbsp;<span class="op" id="5815083">==</span>&nbsp;<span class="string" id="5815086">&#34;&#34;</span>&nbsp;<span class="op" id="5815089">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815095">w</span><span class="op" id="5815096">.</span><span class="ident" id="5815097">Write</span><span class="op" id="5815102">(</span><span class="ident" id="5815103">html_hq</span><span class="op" id="5815110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815120">w</span><span class="op" id="5815121">.</span><span class="ident" id="5815122">Write</span><span class="op" id="5815127">(</span><span class="ident" id="5815128">html_endh</span><span class="op" id="5815137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815141">case</span>&nbsp;<span class="ident" id="5815146">opPre</span><span class="op" id="5815151">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815156">w</span><span class="op" id="5815157">.</span><span class="ident" id="5815158">Write</span><span class="op" id="5815163">(</span><span class="ident" id="5815164">html_pre</span><span class="op" id="5815172">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815177">for</span>&nbsp;<span class="ident" id="5815181">_</span><span class="op" id="5815182">,</span>&nbsp;<span class="ident" id="5815184">line</span>&nbsp;<span class="op" id="5815189">:=</span>&nbsp;<span class="keyword" id="5815192">range</span>&nbsp;<span class="ident" id="5815198">b</span><span class="op" id="5815199">.</span><span class="ident" id="5815200">lines</span>&nbsp;<span class="op" id="5815206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815212">emphasize</span><span class="op" id="5815221">(</span><span class="ident" id="5815222">w</span><span class="op" id="5815223">,</span>&nbsp;<span class="ident" id="5815225">line</span><span class="op" id="5815229">,</span>&nbsp;<span class="ident" id="5815231">nil</span><span class="op" id="5815234">,</span>&nbsp;<span class="builtintype" id="5815236">false</span><span class="op" id="5815241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815251">w</span><span class="op" id="5815252">.</span><span class="ident" id="5815253">Write</span><span class="op" id="5815258">(</span><span class="ident" id="5815259">html_endpre</span><span class="op" id="5815270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815274">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815277">}</span><br>
<span class="lineno"></span><span class="op" id="5815279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5815282">func</span>&nbsp;<span class="ident" id="5815287">blocks</span><span class="op" id="5815293">(</span><span class="ident" id="5815294">text</span>&nbsp;<span class="builtintype" id="5815299">string</span><span class="op" id="5815305">)</span>&nbsp;<span class="op" id="5815307">[</span><span class="op" id="5815308">]</span><span class="ident" id="5815309">block</span>&nbsp;<span class="op" id="5815315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815318">var</span>&nbsp;<span class="op" id="5815322">(</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815326">out</span>&nbsp;&nbsp;<span class="op" id="5815331">[</span><span class="op" id="5815332">]</span><span class="ident" id="5815333">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815341">para</span>&nbsp;<span class="op" id="5815346">[</span><span class="op" id="5815347">]</span><span class="builtintype" id="5815348">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815358">lastWasBlank</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5815373">=</span>&nbsp;<span class="builtintype" id="5815375">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815383">lastWasHeading</span>&nbsp;<span class="op" id="5815398">=</span>&nbsp;<span class="builtintype" id="5815400">false</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815407">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5815411">close</span>&nbsp;<span class="op" id="5815417">:=</span>&nbsp;<span class="keyword" id="5815420">func</span><span class="op" id="5815424">(</span><span class="op" id="5815425">)</span>&nbsp;<span class="op" id="5815427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815431">if</span>&nbsp;<span class="ident" id="5815434">para</span>&nbsp;<span class="op" id="5815439">!=</span>&nbsp;<span class="ident" id="5815442">nil</span>&nbsp;<span class="op" id="5815446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815451">out</span>&nbsp;<span class="op" id="5815455">=</span>&nbsp;<span class="builtinfunc" id="5815457">append</span><span class="op" id="5815463">(</span><span class="ident" id="5815464">out</span><span class="op" id="5815467">,</span>&nbsp;<span class="ident" id="5815469">block</span><span class="op" id="5815474">{</span><span class="ident" id="5815475">opPara</span><span class="op" id="5815481">,</span>&nbsp;<span class="ident" id="5815483">para</span><span class="op" id="5815487">}</span><span class="op" id="5815488">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815493">para</span>&nbsp;<span class="op" id="5815498">=</span>&nbsp;<span class="ident" id="5815500">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815513">lines</span>&nbsp;<span class="op" id="5815519">:=</span>&nbsp;<span class="ident" id="5815522">strings</span><span class="op" id="5815529">.</span><span class="ident" id="5815530">SplitAfter</span><span class="op" id="5815540">(</span><span class="ident" id="5815541">text</span><span class="op" id="5815545">,</span>&nbsp;<span class="string" id="5815547">&#34;\n&#34;</span><span class="op" id="5815551">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815554">unindent</span><span class="op" id="5815562">(</span><span class="ident" id="5815563">lines</span><span class="op" id="5815568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815571">for</span>&nbsp;<span class="ident" id="5815575">i</span>&nbsp;<span class="op" id="5815577">:=</span>&nbsp;<span class="num" id="5815580">0</span><span class="op" id="5815581">;</span>&nbsp;<span class="ident" id="5815583">i</span>&nbsp;<span class="op" id="5815585">&lt;</span>&nbsp;<span class="builtinfunc" id="5815587">len</span><span class="op" id="5815590">(</span><span class="ident" id="5815591">lines</span><span class="op" id="5815596">)</span><span class="op" id="5815597">;</span>&nbsp;<span class="op" id="5815599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815603">line</span>&nbsp;<span class="op" id="5815608">:=</span>&nbsp;<span class="ident" id="5815611">lines</span><span class="op" id="5815616">[</span><span class="ident" id="5815617">i</span><span class="op" id="5815618">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815622">if</span>&nbsp;<span class="ident" id="5815625">isBlank</span><span class="op" id="5815632">(</span><span class="ident" id="5815633">line</span><span class="op" id="5815637">)</span>&nbsp;<span class="op" id="5815639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5815644">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5815666">close</span><span class="op" id="5815671">(</span><span class="op" id="5815672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815677">i</span><span class="op" id="5815678">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815684">lastWasBlank</span>&nbsp;<span class="op" id="5815697">=</span>&nbsp;<span class="builtintype" id="5815699">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815707">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815718">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815722">if</span>&nbsp;<span class="ident" id="5815725">indentLen</span><span class="op" id="5815734">(</span><span class="ident" id="5815735">line</span><span class="op" id="5815739">)</span>&nbsp;<span class="op" id="5815741">&gt;</span>&nbsp;<span class="num" id="5815743">0</span>&nbsp;<span class="op" id="5815745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5815750">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5815772">close</span><span class="op" id="5815777">(</span><span class="op" id="5815778">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5815784">//&nbsp;count&nbsp;indented&nbsp;or&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815820">j</span>&nbsp;<span class="op" id="5815822">:=</span>&nbsp;<span class="ident" id="5815825">i</span>&nbsp;<span class="op" id="5815827">+</span>&nbsp;<span class="num" id="5815829">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815834">for</span>&nbsp;<span class="ident" id="5815838">j</span>&nbsp;<span class="op" id="5815840">&lt;</span>&nbsp;<span class="builtinfunc" id="5815842">len</span><span class="op" id="5815845">(</span><span class="ident" id="5815846">lines</span><span class="op" id="5815851">)</span>&nbsp;<span class="op" id="5815853">&amp;&amp;</span>&nbsp;<span class="op" id="5815856">(</span><span class="ident" id="5815857">isBlank</span><span class="op" id="5815864">(</span><span class="ident" id="5815865">lines</span><span class="op" id="5815870">[</span><span class="ident" id="5815871">j</span><span class="op" id="5815872">]</span><span class="op" id="5815873">)</span>&nbsp;<span class="op" id="5815875">||</span>&nbsp;<span class="ident" id="5815878">indentLen</span><span class="op" id="5815887">(</span><span class="ident" id="5815888">lines</span><span class="op" id="5815893">[</span><span class="ident" id="5815894">j</span><span class="op" id="5815895">]</span><span class="op" id="5815896">)</span>&nbsp;<span class="op" id="5815898">&gt;</span>&nbsp;<span class="num" id="5815900">0</span><span class="op" id="5815901">)</span>&nbsp;<span class="op" id="5815903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815909">j</span><span class="op" id="5815910">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5815921">//&nbsp;but&nbsp;not&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815956">for</span>&nbsp;<span class="ident" id="5815960">j</span>&nbsp;<span class="op" id="5815962">&gt;</span>&nbsp;<span class="ident" id="5815964">i</span>&nbsp;<span class="op" id="5815966">&amp;&amp;</span>&nbsp;<span class="ident" id="5815969">isBlank</span><span class="op" id="5815976">(</span><span class="ident" id="5815977">lines</span><span class="op" id="5815982">[</span><span class="ident" id="5815983">j</span><span class="op" id="5815984">-</span><span class="num" id="5815985">1</span><span class="op" id="5815986">]</span><span class="op" id="5815987">)</span>&nbsp;<span class="op" id="5815989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815995">j</span><span class="op" id="5815996">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5816002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816007">pre</span>&nbsp;<span class="op" id="5816011">:=</span>&nbsp;<span class="ident" id="5816014">lines</span><span class="op" id="5816019">[</span><span class="ident" id="5816020">i</span><span class="op" id="5816021">:</span><span class="ident" id="5816022">j</span><span class="op" id="5816023">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816028">i</span>&nbsp;<span class="op" id="5816030">=</span>&nbsp;<span class="ident" id="5816032">j</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816038">unindent</span><span class="op" id="5816046">(</span><span class="ident" id="5816047">pre</span><span class="op" id="5816050">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5816056">//&nbsp;put&nbsp;those&nbsp;lines&nbsp;in&nbsp;a&nbsp;pre&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816093">out</span>&nbsp;<span class="op" id="5816097">=</span>&nbsp;<span class="builtinfunc" id="5816099">append</span><span class="op" id="5816105">(</span><span class="ident" id="5816106">out</span><span class="op" id="5816109">,</span>&nbsp;<span class="ident" id="5816111">block</span><span class="op" id="5816116">{</span><span class="ident" id="5816117">opPre</span><span class="op" id="5816122">,</span>&nbsp;<span class="ident" id="5816124">pre</span><span class="op" id="5816127">}</span><span class="op" id="5816128">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816133">lastWasHeading</span>&nbsp;<span class="op" id="5816148">=</span>&nbsp;<span class="builtintype" id="5816150">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816159">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5816170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816175">if</span>&nbsp;<span class="ident" id="5816178">lastWasBlank</span>&nbsp;<span class="op" id="5816191">&amp;&amp;</span>&nbsp;<span class="op" id="5816194">!</span><span class="ident" id="5816195">lastWasHeading</span>&nbsp;<span class="op" id="5816210">&amp;&amp;</span>&nbsp;<span class="ident" id="5816213">i</span><span class="op" id="5816214">+</span><span class="num" id="5816215">2</span>&nbsp;<span class="op" id="5816217">&lt;</span>&nbsp;<span class="builtinfunc" id="5816219">len</span><span class="op" id="5816222">(</span><span class="ident" id="5816223">lines</span><span class="op" id="5816228">)</span>&nbsp;<span class="op" id="5816230">&amp;&amp;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816236">isBlank</span><span class="op" id="5816243">(</span><span class="ident" id="5816244">lines</span><span class="op" id="5816249">[</span><span class="ident" id="5816250">i</span><span class="op" id="5816251">+</span><span class="num" id="5816252">1</span><span class="op" id="5816253">]</span><span class="op" id="5816254">)</span>&nbsp;<span class="op" id="5816256">&amp;&amp;</span>&nbsp;<span class="op" id="5816259">!</span><span class="ident" id="5816260">isBlank</span><span class="op" id="5816267">(</span><span class="ident" id="5816268">lines</span><span class="op" id="5816273">[</span><span class="ident" id="5816274">i</span><span class="op" id="5816275">+</span><span class="num" id="5816276">2</span><span class="op" id="5816277">]</span><span class="op" id="5816278">)</span>&nbsp;<span class="op" id="5816280">&amp;&amp;</span>&nbsp;<span class="ident" id="5816283">indentLen</span><span class="op" id="5816292">(</span><span class="ident" id="5816293">lines</span><span class="op" id="5816298">[</span><span class="ident" id="5816299">i</span><span class="op" id="5816300">+</span><span class="num" id="5816301">2</span><span class="op" id="5816302">]</span><span class="op" id="5816303">)</span>&nbsp;<span class="op" id="5816305">==</span>&nbsp;<span class="num" id="5816308">0</span>&nbsp;<span class="op" id="5816310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5816315">//&nbsp;current&nbsp;line&nbsp;is&nbsp;non-blank,&nbsp;surrounded&nbsp;by&nbsp;blank&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5816374">//&nbsp;and&nbsp;the&nbsp;next&nbsp;non-blank&nbsp;line&nbsp;is&nbsp;not&nbsp;indented:&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5816430">//&nbsp;might&nbsp;be&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816456">if</span>&nbsp;<span class="ident" id="5816459">head</span>&nbsp;<span class="op" id="5816464">:=</span>&nbsp;<span class="ident" id="5816467">heading</span><span class="op" id="5816474">(</span><span class="ident" id="5816475">line</span><span class="op" id="5816479">)</span><span class="op" id="5816480">;</span>&nbsp;<span class="ident" id="5816482">head</span>&nbsp;<span class="op" id="5816487">!=</span>&nbsp;<span class="string" id="5816490">&#34;&#34;</span>&nbsp;<span class="op" id="5816493">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5816499">close</span><span class="op" id="5816504">(</span><span class="op" id="5816505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816511">out</span>&nbsp;<span class="op" id="5816515">=</span>&nbsp;<span class="builtinfunc" id="5816517">append</span><span class="op" id="5816523">(</span><span class="ident" id="5816524">out</span><span class="op" id="5816527">,</span>&nbsp;<span class="ident" id="5816529">block</span><span class="op" id="5816534">{</span><span class="ident" id="5816535">opHead</span><span class="op" id="5816541">,</span>&nbsp;<span class="op" id="5816543">[</span><span class="op" id="5816544">]</span><span class="builtintype" id="5816545">string</span><span class="op" id="5816551">{</span><span class="ident" id="5816552">head</span><span class="op" id="5816556">}</span><span class="op" id="5816557">}</span><span class="op" id="5816558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816564">i</span>&nbsp;<span class="op" id="5816566">+=</span>&nbsp;<span class="num" id="5816569">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816575">lastWasHeading</span>&nbsp;<span class="op" id="5816590">=</span>&nbsp;<span class="builtintype" id="5816592">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816601">continue</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5816613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5816617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5816622">//&nbsp;open&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816642">lastWasBlank</span>&nbsp;<span class="op" id="5816655">=</span>&nbsp;<span class="builtintype" id="5816657">false</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816665">lastWasHeading</span>&nbsp;<span class="op" id="5816680">=</span>&nbsp;<span class="builtintype" id="5816682">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816690">para</span>&nbsp;<span class="op" id="5816695">=</span>&nbsp;<span class="builtinfunc" id="5816697">append</span><span class="op" id="5816703">(</span><span class="ident" id="5816704">para</span><span class="op" id="5816708">,</span>&nbsp;<span class="ident" id="5816710">lines</span><span class="op" id="5816715">[</span><span class="ident" id="5816716">i</span><span class="op" id="5816717">]</span><span class="op" id="5816718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816722">i</span><span class="op" id="5816723">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5816727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5816730">close</span><span class="op" id="5816735">(</span><span class="op" id="5816736">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816740">return</span>&nbsp;<span class="ident" id="5816747">out</span><br>
<span class="lineno"></span><span class="op" id="5816751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5816754">//&nbsp;ToText&nbsp;prepares&nbsp;comment&nbsp;text&nbsp;for&nbsp;presentation&nbsp;in&nbsp;textual&nbsp;output.</span><br>
<span class="lineno">400</span><span class="comment" id="5816822">//&nbsp;It&nbsp;wraps&nbsp;paragraphs&nbsp;of&nbsp;text&nbsp;to&nbsp;width&nbsp;or&nbsp;fewer&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno"></span><span class="comment" id="5816891">//&nbsp;and&nbsp;then&nbsp;prefixes&nbsp;each&nbsp;line&nbsp;with&nbsp;the&nbsp;indent.&nbsp;&nbsp;In&nbsp;preformatted&nbsp;sections</span><br>
<span class="lineno"></span><span class="comment" id="5816965">//&nbsp;(such&nbsp;as&nbsp;program&nbsp;text),&nbsp;it&nbsp;prefixes&nbsp;each&nbsp;non-blank&nbsp;line&nbsp;with&nbsp;preIndent.</span><br>
<span class="lineno"></span><span class="keyword" id="5817040">func</span>&nbsp;<span class="ident" id="5817045">ToText</span><span class="op" id="5817051">(</span><span class="ident" id="5817052">w</span>&nbsp;<span class="ident" id="5817054">io</span><span class="op" id="5817056">.</span><span class="ident" id="5817057">Writer</span><span class="op" id="5817063">,</span>&nbsp;<span class="ident" id="5817065">text</span>&nbsp;<span class="builtintype" id="5817070">string</span><span class="op" id="5817076">,</span>&nbsp;<span class="ident" id="5817078">indent</span><span class="op" id="5817084">,</span>&nbsp;<span class="ident" id="5817086">preIndent</span>&nbsp;<span class="builtintype" id="5817096">string</span><span class="op" id="5817102">,</span>&nbsp;<span class="ident" id="5817104">width</span>&nbsp;<span class="builtintype" id="5817110">int</span><span class="op" id="5817113">)</span>&nbsp;<span class="op" id="5817115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817118">l</span>&nbsp;<span class="op" id="5817120">:=</span>&nbsp;<span class="ident" id="5817123">lineWrapper</span><span class="op" id="5817134">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817138">out</span><span class="op" id="5817141">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5817146">w</span><span class="op" id="5817147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817151">width</span><span class="op" id="5817156">:</span>&nbsp;&nbsp;<span class="ident" id="5817159">width</span><span class="op" id="5817164">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817168">indent</span><span class="op" id="5817174">:</span>&nbsp;<span class="ident" id="5817176">indent</span><span class="op" id="5817182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5817185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817188">for</span>&nbsp;<span class="ident" id="5817192">_</span><span class="op" id="5817193">,</span>&nbsp;<span class="ident" id="5817195">b</span>&nbsp;<span class="op" id="5817197">:=</span>&nbsp;<span class="keyword" id="5817200">range</span>&nbsp;<span class="ident" id="5817206">blocks</span><span class="op" id="5817212">(</span><span class="ident" id="5817213">text</span><span class="op" id="5817217">)</span>&nbsp;<span class="op" id="5817219">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817223">switch</span>&nbsp;<span class="ident" id="5817230">b</span><span class="op" id="5817231">.</span><span class="ident" id="5817232">op</span>&nbsp;<span class="op" id="5817235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817239">case</span>&nbsp;<span class="ident" id="5817244">opPara</span><span class="op" id="5817250">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817255">//&nbsp;l.write&nbsp;will&nbsp;add&nbsp;leading&nbsp;newline&nbsp;if&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817306">for</span>&nbsp;<span class="ident" id="5817310">_</span><span class="op" id="5817311">,</span>&nbsp;<span class="ident" id="5817313">line</span>&nbsp;<span class="op" id="5817318">:=</span>&nbsp;<span class="keyword" id="5817321">range</span>&nbsp;<span class="ident" id="5817327">b</span><span class="op" id="5817328">.</span><span class="ident" id="5817329">lines</span>&nbsp;<span class="op" id="5817335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817341">l</span><span class="op" id="5817342">.</span><span class="ident" id="5817343">write</span><span class="op" id="5817348">(</span><span class="ident" id="5817349">line</span><span class="op" id="5817353">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5817358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817363">l</span><span class="op" id="5817364">.</span><span class="ident" id="5817365">flush</span><span class="op" id="5817370">(</span><span class="op" id="5817371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817375">case</span>&nbsp;<span class="ident" id="5817380">opHead</span><span class="op" id="5817386">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817391">w</span><span class="op" id="5817392">.</span><span class="ident" id="5817393">Write</span><span class="op" id="5817398">(</span><span class="ident" id="5817399">nl</span><span class="op" id="5817401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817406">for</span>&nbsp;<span class="ident" id="5817410">_</span><span class="op" id="5817411">,</span>&nbsp;<span class="ident" id="5817413">line</span>&nbsp;<span class="op" id="5817418">:=</span>&nbsp;<span class="keyword" id="5817421">range</span>&nbsp;<span class="ident" id="5817427">b</span><span class="op" id="5817428">.</span><span class="ident" id="5817429">lines</span>&nbsp;<span class="op" id="5817435">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817441">l</span><span class="op" id="5817442">.</span><span class="ident" id="5817443">write</span><span class="op" id="5817448">(</span><span class="ident" id="5817449">line</span>&nbsp;<span class="op" id="5817454">+</span>&nbsp;<span class="string" id="5817456">&#34;\n&#34;</span><span class="op" id="5817460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5817465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817470">l</span><span class="op" id="5817471">.</span><span class="ident" id="5817472">flush</span><span class="op" id="5817477">(</span><span class="op" id="5817478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817482">case</span>&nbsp;<span class="ident" id="5817487">opPre</span><span class="op" id="5817492">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817497">w</span><span class="op" id="5817498">.</span><span class="ident" id="5817499">Write</span><span class="op" id="5817504">(</span><span class="ident" id="5817505">nl</span><span class="op" id="5817507">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817512">for</span>&nbsp;<span class="ident" id="5817516">_</span><span class="op" id="5817517">,</span>&nbsp;<span class="ident" id="5817519">line</span>&nbsp;<span class="op" id="5817524">:=</span>&nbsp;<span class="keyword" id="5817527">range</span>&nbsp;<span class="ident" id="5817533">b</span><span class="op" id="5817534">.</span><span class="ident" id="5817535">lines</span>&nbsp;<span class="op" id="5817541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817547">if</span>&nbsp;<span class="ident" id="5817550">isBlank</span><span class="op" id="5817557">(</span><span class="ident" id="5817558">line</span><span class="op" id="5817562">)</span>&nbsp;<span class="op" id="5817564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817571">w</span><span class="op" id="5817572">.</span><span class="ident" id="5817573">Write</span><span class="op" id="5817578">(</span><span class="op" id="5817579">[</span><span class="op" id="5817580">]</span><span class="builtintype" id="5817581">byte</span><span class="op" id="5817585">(</span><span class="string" id="5817586">&#34;\n&#34;</span><span class="op" id="5817590">)</span><span class="op" id="5817591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5817597">}</span>&nbsp;<span class="keyword" id="5817599">else</span>&nbsp;<span class="op" id="5817604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817611">w</span><span class="op" id="5817612">.</span><span class="ident" id="5817613">Write</span><span class="op" id="5817618">(</span><span class="op" id="5817619">[</span><span class="op" id="5817620">]</span><span class="builtintype" id="5817621">byte</span><span class="op" id="5817625">(</span><span class="ident" id="5817626">preIndent</span><span class="op" id="5817635">)</span><span class="op" id="5817636">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817643">w</span><span class="op" id="5817644">.</span><span class="ident" id="5817645">Write</span><span class="op" id="5817650">(</span><span class="op" id="5817651">[</span><span class="op" id="5817652">]</span><span class="builtintype" id="5817653">byte</span><span class="op" id="5817657">(</span><span class="ident" id="5817658">line</span><span class="op" id="5817662">)</span><span class="op" id="5817663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5817669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5817674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5817678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5817681">}</span><br>
<span class="lineno">435</span><span class="op" id="5817683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5817686">type</span>&nbsp;<span class="ident" id="5817691">lineWrapper</span>&nbsp;<span class="keyword" id="5817703">struct</span>&nbsp;<span class="op" id="5817710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817713">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5817723">io</span><span class="op" id="5817725">.</span><span class="ident" id="5817726">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817734">printed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5817744">bool</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817750">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5817760">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817765">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5817775">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817783">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5817793">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817798">pendSpace</span>&nbsp;<span class="builtintype" id="5817808">int</span><br>
<span class="lineno"></span><span class="op" id="5817812">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="5817815">var</span>&nbsp;<span class="ident" id="5817819">nl</span>&nbsp;<span class="op" id="5817822">=</span>&nbsp;<span class="op" id="5817824">[</span><span class="op" id="5817825">]</span><span class="builtintype" id="5817826">byte</span><span class="op" id="5817830">(</span><span class="string" id="5817831">&#34;\n&#34;</span><span class="op" id="5817835">)</span><br>
<span class="lineno"></span><span class="keyword" id="5817837">var</span>&nbsp;<span class="ident" id="5817841">space</span>&nbsp;<span class="op" id="5817847">=</span>&nbsp;<span class="op" id="5817849">[</span><span class="op" id="5817850">]</span><span class="builtintype" id="5817851">byte</span><span class="op" id="5817855">(</span><span class="string" id="5817856">&#34;&nbsp;&#34;</span><span class="op" id="5817859">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5817862">func</span>&nbsp;<span class="op" id="5817867">(</span><span class="ident" id="5817868">l</span>&nbsp;<span class="op" id="5817870">*</span><span class="ident" id="5817871">lineWrapper</span><span class="op" id="5817882">)</span>&nbsp;<span class="ident" id="5817884">write</span><span class="op" id="5817889">(</span><span class="ident" id="5817890">text</span>&nbsp;<span class="builtintype" id="5817895">string</span><span class="op" id="5817901">)</span>&nbsp;<span class="op" id="5817903">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817906">if</span>&nbsp;<span class="ident" id="5817909">l</span><span class="op" id="5817910">.</span><span class="ident" id="5817911">n</span>&nbsp;<span class="op" id="5817913">==</span>&nbsp;<span class="num" id="5817916">0</span>&nbsp;<span class="op" id="5817918">&amp;&amp;</span>&nbsp;<span class="ident" id="5817921">l</span><span class="op" id="5817922">.</span><span class="ident" id="5817923">printed</span>&nbsp;<span class="op" id="5817931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817935">l</span><span class="op" id="5817936">.</span><span class="ident" id="5817937">out</span><span class="op" id="5817940">.</span><span class="ident" id="5817941">Write</span><span class="op" id="5817946">(</span><span class="ident" id="5817947">nl</span><span class="op" id="5817949">)</span>&nbsp;<span class="comment" id="5817951">//&nbsp;blank&nbsp;line&nbsp;before&nbsp;new&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5817987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817990">l</span><span class="op" id="5817991">.</span><span class="ident" id="5817992">printed</span>&nbsp;<span class="op" id="5818000">=</span>&nbsp;<span class="builtintype" id="5818002">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818009">for</span>&nbsp;<span class="ident" id="5818013">_</span><span class="op" id="5818014">,</span>&nbsp;<span class="ident" id="5818016">f</span>&nbsp;<span class="op" id="5818018">:=</span>&nbsp;<span class="keyword" id="5818021">range</span>&nbsp;<span class="ident" id="5818027">strings</span><span class="op" id="5818034">.</span><span class="ident" id="5818035">Fields</span><span class="op" id="5818041">(</span><span class="ident" id="5818042">text</span><span class="op" id="5818046">)</span>&nbsp;<span class="op" id="5818048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818052">w</span>&nbsp;<span class="op" id="5818054">:=</span>&nbsp;<span class="ident" id="5818057">utf8</span><span class="op" id="5818061">.</span><span class="ident" id="5818062">RuneCountInString</span><span class="op" id="5818079">(</span><span class="ident" id="5818080">f</span><span class="op" id="5818081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5818085">//&nbsp;wrap&nbsp;if&nbsp;line&nbsp;is&nbsp;too&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818115">if</span>&nbsp;<span class="ident" id="5818118">l</span><span class="op" id="5818119">.</span><span class="ident" id="5818120">n</span>&nbsp;<span class="op" id="5818122">&gt;</span>&nbsp;<span class="num" id="5818124">0</span>&nbsp;<span class="op" id="5818126">&amp;&amp;</span>&nbsp;<span class="ident" id="5818129">l</span><span class="op" id="5818130">.</span><span class="ident" id="5818131">n</span><span class="op" id="5818132">+</span><span class="ident" id="5818133">l</span><span class="op" id="5818134">.</span><span class="ident" id="5818135">pendSpace</span><span class="op" id="5818144">+</span><span class="ident" id="5818145">w</span>&nbsp;<span class="op" id="5818147">&gt;</span>&nbsp;<span class="ident" id="5818149">l</span><span class="op" id="5818150">.</span><span class="ident" id="5818151">width</span>&nbsp;<span class="op" id="5818157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818162">l</span><span class="op" id="5818163">.</span><span class="ident" id="5818164">out</span><span class="op" id="5818167">.</span><span class="ident" id="5818168">Write</span><span class="op" id="5818173">(</span><span class="ident" id="5818174">nl</span><span class="op" id="5818176">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818181">l</span><span class="op" id="5818182">.</span><span class="ident" id="5818183">n</span>&nbsp;<span class="op" id="5818185">=</span>&nbsp;<span class="num" id="5818187">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818192">l</span><span class="op" id="5818193">.</span><span class="ident" id="5818194">pendSpace</span>&nbsp;<span class="op" id="5818204">=</span>&nbsp;<span class="num" id="5818206">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818214">if</span>&nbsp;<span class="ident" id="5818217">l</span><span class="op" id="5818218">.</span><span class="ident" id="5818219">n</span>&nbsp;<span class="op" id="5818221">==</span>&nbsp;<span class="num" id="5818224">0</span>&nbsp;<span class="op" id="5818226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818231">l</span><span class="op" id="5818232">.</span><span class="ident" id="5818233">out</span><span class="op" id="5818236">.</span><span class="ident" id="5818237">Write</span><span class="op" id="5818242">(</span><span class="op" id="5818243">[</span><span class="op" id="5818244">]</span><span class="builtintype" id="5818245">byte</span><span class="op" id="5818249">(</span><span class="ident" id="5818250">l</span><span class="op" id="5818251">.</span><span class="ident" id="5818252">indent</span><span class="op" id="5818258">)</span><span class="op" id="5818259">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818267">l</span><span class="op" id="5818268">.</span><span class="ident" id="5818269">out</span><span class="op" id="5818272">.</span><span class="ident" id="5818273">Write</span><span class="op" id="5818278">(</span><span class="ident" id="5818279">space</span><span class="op" id="5818284">[</span><span class="op" id="5818285">:</span><span class="ident" id="5818286">l</span><span class="op" id="5818287">.</span><span class="ident" id="5818288">pendSpace</span><span class="op" id="5818297">]</span><span class="op" id="5818298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818302">l</span><span class="op" id="5818303">.</span><span class="ident" id="5818304">out</span><span class="op" id="5818307">.</span><span class="ident" id="5818308">Write</span><span class="op" id="5818313">(</span><span class="op" id="5818314">[</span><span class="op" id="5818315">]</span><span class="builtintype" id="5818316">byte</span><span class="op" id="5818320">(</span><span class="ident" id="5818321">f</span><span class="op" id="5818322">)</span><span class="op" id="5818323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818327">l</span><span class="op" id="5818328">.</span><span class="ident" id="5818329">n</span>&nbsp;<span class="op" id="5818331">+=</span>&nbsp;<span class="ident" id="5818334">l</span><span class="op" id="5818335">.</span><span class="ident" id="5818336">pendSpace</span>&nbsp;<span class="op" id="5818346">+</span>&nbsp;<span class="ident" id="5818348">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818352">l</span><span class="op" id="5818353">.</span><span class="ident" id="5818354">pendSpace</span>&nbsp;<span class="op" id="5818364">=</span>&nbsp;<span class="num" id="5818366">1</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818369">}</span><br>
<span class="lineno"></span><span class="op" id="5818371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5818374">func</span>&nbsp;<span class="op" id="5818379">(</span><span class="ident" id="5818380">l</span>&nbsp;<span class="op" id="5818382">*</span><span class="ident" id="5818383">lineWrapper</span><span class="op" id="5818394">)</span>&nbsp;<span class="ident" id="5818396">flush</span><span class="op" id="5818401">(</span><span class="op" id="5818402">)</span>&nbsp;<span class="op" id="5818404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818407">if</span>&nbsp;<span class="ident" id="5818410">l</span><span class="op" id="5818411">.</span><span class="ident" id="5818412">n</span>&nbsp;<span class="op" id="5818414">==</span>&nbsp;<span class="num" id="5818417">0</span>&nbsp;<span class="op" id="5818419">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818423">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818434">l</span><span class="op" id="5818435">.</span><span class="ident" id="5818436">out</span><span class="op" id="5818439">.</span><span class="ident" id="5818440">Write</span><span class="op" id="5818445">(</span><span class="ident" id="5818446">nl</span><span class="op" id="5818448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818451">l</span><span class="op" id="5818452">.</span><span class="ident" id="5818453">pendSpace</span>&nbsp;<span class="op" id="5818463">=</span>&nbsp;<span class="num" id="5818465">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818468">l</span><span class="op" id="5818469">.</span><span class="ident" id="5818470">n</span>&nbsp;<span class="op" id="5818472">=</span>&nbsp;<span class="num" id="5818474">0</span><br>
<span class="lineno">480</span><span class="op" id="5818476">}</span>
</div>
</body>
</html>
