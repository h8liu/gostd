<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/aes</h2>
<ul>
<li><a href="/gostd/crypto/aes/aes_test.go.html">aes_test.go</a></li>
<li><a href="/gostd/crypto/aes/block.go.html">block.go</a></li>
<li><a href="/gostd/crypto/aes/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/aes/cipher_asm.go.html" class="current">cipher_asm.go</a></li>
<li><a href="/gostd/crypto/aes/const.go.html">const.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4332042">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4332097">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4332151">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4332202">//&nbsp;+build&nbsp;amd64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4332219">package</span>&nbsp;<span class="ident" id="4332227">aes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4332232">//&nbsp;defined&nbsp;in&nbsp;asm_$GOARCH.s</span><br>
<span class="lineno">10</span><span class="keyword" id="4332260">func</span>&nbsp;<span class="ident" id="4332265">hasAsm</span><span class="op" id="4332271">(</span><span class="op" id="4332272">)</span>&nbsp;<span class="builtintype" id="4332274">bool</span><br>
<span class="lineno"></span><span class="keyword" id="4332279">func</span>&nbsp;<span class="ident" id="4332284">encryptBlockAsm</span><span class="op" id="4332299">(</span><span class="ident" id="4332300">nr</span>&nbsp;<span class="builtintype" id="4332303">int</span><span class="op" id="4332306">,</span>&nbsp;<span class="ident" id="4332308">xk</span>&nbsp;<span class="op" id="4332311">*</span><span class="builtintype" id="4332312">uint32</span><span class="op" id="4332318">,</span>&nbsp;<span class="ident" id="4332320">dst</span><span class="op" id="4332323">,</span>&nbsp;<span class="ident" id="4332325">src</span>&nbsp;<span class="op" id="4332329">*</span><span class="builtintype" id="4332330">byte</span><span class="op" id="4332334">)</span><br>
<span class="lineno"></span><span class="keyword" id="4332336">func</span>&nbsp;<span class="ident" id="4332341">decryptBlockAsm</span><span class="op" id="4332356">(</span><span class="ident" id="4332357">nr</span>&nbsp;<span class="builtintype" id="4332360">int</span><span class="op" id="4332363">,</span>&nbsp;<span class="ident" id="4332365">xk</span>&nbsp;<span class="op" id="4332368">*</span><span class="builtintype" id="4332369">uint32</span><span class="op" id="4332375">,</span>&nbsp;<span class="ident" id="4332377">dst</span><span class="op" id="4332380">,</span>&nbsp;<span class="ident" id="4332382">src</span>&nbsp;<span class="op" id="4332386">*</span><span class="builtintype" id="4332387">byte</span><span class="op" id="4332391">)</span><br>
<span class="lineno"></span><span class="keyword" id="4332393">func</span>&nbsp;<span class="ident" id="4332398">expandKeyAsm</span><span class="op" id="4332410">(</span><span class="ident" id="4332411">nr</span>&nbsp;<span class="builtintype" id="4332414">int</span><span class="op" id="4332417">,</span>&nbsp;<span class="ident" id="4332419">key</span>&nbsp;<span class="op" id="4332423">*</span><span class="builtintype" id="4332424">byte</span><span class="op" id="4332428">,</span>&nbsp;<span class="ident" id="4332430">enc</span>&nbsp;<span class="op" id="4332434">*</span><span class="builtintype" id="4332435">uint32</span><span class="op" id="4332441">,</span>&nbsp;<span class="ident" id="4332443">dec</span>&nbsp;<span class="op" id="4332447">*</span><span class="builtintype" id="4332448">uint32</span><span class="op" id="4332454">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4332457">var</span>&nbsp;<span class="ident" id="4332461">useAsm</span>&nbsp;<span class="op" id="4332468">=</span>&nbsp;<span class="ident" id="4332470">hasAsm</span><span class="op" id="4332476">(</span><span class="op" id="4332477">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4332480">func</span>&nbsp;<span class="ident" id="4332485">encryptBlock</span><span class="op" id="4332497">(</span><span class="ident" id="4332498">xk</span>&nbsp;<span class="op" id="4332501">[</span><span class="op" id="4332502">]</span><span class="builtintype" id="4332503">uint32</span><span class="op" id="4332509">,</span>&nbsp;<span class="ident" id="4332511">dst</span><span class="op" id="4332514">,</span>&nbsp;<span class="ident" id="4332516">src</span>&nbsp;<span class="op" id="4332520">[</span><span class="op" id="4332521">]</span><span class="builtintype" id="4332522">byte</span><span class="op" id="4332526">)</span>&nbsp;<span class="op" id="4332528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4332531">if</span>&nbsp;<span class="ident" id="4332534">useAsm</span>&nbsp;<span class="op" id="4332541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4332545">encryptBlockAsm</span><span class="op" id="4332560">(</span><span class="builtinfunc" id="4332561">len</span><span class="op" id="4332564">(</span><span class="ident" id="4332565">xk</span><span class="op" id="4332567">)</span><span class="op" id="4332568">/</span><span class="num" id="4332569">4</span><span class="op" id="4332570">-</span><span class="num" id="4332571">1</span><span class="op" id="4332572">,</span>&nbsp;<span class="op" id="4332574">&amp;</span><span class="ident" id="4332575">xk</span><span class="op" id="4332577">[</span><span class="num" id="4332578">0</span><span class="op" id="4332579">]</span><span class="op" id="4332580">,</span>&nbsp;<span class="op" id="4332582">&amp;</span><span class="ident" id="4332583">dst</span><span class="op" id="4332586">[</span><span class="num" id="4332587">0</span><span class="op" id="4332588">]</span><span class="op" id="4332589">,</span>&nbsp;<span class="op" id="4332591">&amp;</span><span class="ident" id="4332592">src</span><span class="op" id="4332595">[</span><span class="num" id="4332596">0</span><span class="op" id="4332597">]</span><span class="op" id="4332598">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4332601">}</span>&nbsp;<span class="keyword" id="4332603">else</span>&nbsp;<span class="op" id="4332608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4332612">encryptBlockGo</span><span class="op" id="4332626">(</span><span class="ident" id="4332627">xk</span><span class="op" id="4332629">,</span>&nbsp;<span class="ident" id="4332631">dst</span><span class="op" id="4332634">,</span>&nbsp;<span class="ident" id="4332636">src</span><span class="op" id="4332639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4332642">}</span><br>
<span class="lineno"></span><span class="op" id="4332644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="4332647">func</span>&nbsp;<span class="ident" id="4332652">decryptBlock</span><span class="op" id="4332664">(</span><span class="ident" id="4332665">xk</span>&nbsp;<span class="op" id="4332668">[</span><span class="op" id="4332669">]</span><span class="builtintype" id="4332670">uint32</span><span class="op" id="4332676">,</span>&nbsp;<span class="ident" id="4332678">dst</span><span class="op" id="4332681">,</span>&nbsp;<span class="ident" id="4332683">src</span>&nbsp;<span class="op" id="4332687">[</span><span class="op" id="4332688">]</span><span class="builtintype" id="4332689">byte</span><span class="op" id="4332693">)</span>&nbsp;<span class="op" id="4332695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4332698">if</span>&nbsp;<span class="ident" id="4332701">useAsm</span>&nbsp;<span class="op" id="4332708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4332712">decryptBlockAsm</span><span class="op" id="4332727">(</span><span class="builtinfunc" id="4332728">len</span><span class="op" id="4332731">(</span><span class="ident" id="4332732">xk</span><span class="op" id="4332734">)</span><span class="op" id="4332735">/</span><span class="num" id="4332736">4</span><span class="op" id="4332737">-</span><span class="num" id="4332738">1</span><span class="op" id="4332739">,</span>&nbsp;<span class="op" id="4332741">&amp;</span><span class="ident" id="4332742">xk</span><span class="op" id="4332744">[</span><span class="num" id="4332745">0</span><span class="op" id="4332746">]</span><span class="op" id="4332747">,</span>&nbsp;<span class="op" id="4332749">&amp;</span><span class="ident" id="4332750">dst</span><span class="op" id="4332753">[</span><span class="num" id="4332754">0</span><span class="op" id="4332755">]</span><span class="op" id="4332756">,</span>&nbsp;<span class="op" id="4332758">&amp;</span><span class="ident" id="4332759">src</span><span class="op" id="4332762">[</span><span class="num" id="4332763">0</span><span class="op" id="4332764">]</span><span class="op" id="4332765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4332768">}</span>&nbsp;<span class="keyword" id="4332770">else</span>&nbsp;<span class="op" id="4332775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4332779">decryptBlockGo</span><span class="op" id="4332793">(</span><span class="ident" id="4332794">xk</span><span class="op" id="4332796">,</span>&nbsp;<span class="ident" id="4332798">dst</span><span class="op" id="4332801">,</span>&nbsp;<span class="ident" id="4332803">src</span><span class="op" id="4332806">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4332809">}</span><br>
<span class="lineno"></span><span class="op" id="4332811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4332814">func</span>&nbsp;<span class="ident" id="4332819">expandKey</span><span class="op" id="4332828">(</span><span class="ident" id="4332829">key</span>&nbsp;<span class="op" id="4332833">[</span><span class="op" id="4332834">]</span><span class="builtintype" id="4332835">byte</span><span class="op" id="4332839">,</span>&nbsp;<span class="ident" id="4332841">enc</span><span class="op" id="4332844">,</span>&nbsp;<span class="ident" id="4332846">dec</span>&nbsp;<span class="op" id="4332850">[</span><span class="op" id="4332851">]</span><span class="builtintype" id="4332852">uint32</span><span class="op" id="4332858">)</span>&nbsp;<span class="op" id="4332860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4332863">if</span>&nbsp;<span class="ident" id="4332866">useAsm</span>&nbsp;<span class="op" id="4332873">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4332877">rounds</span>&nbsp;<span class="op" id="4332884">:=</span>&nbsp;<span class="num" id="4332887">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4332892">switch</span>&nbsp;<span class="builtinfunc" id="4332899">len</span><span class="op" id="4332902">(</span><span class="ident" id="4332903">key</span><span class="op" id="4332906">)</span>&nbsp;<span class="op" id="4332908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4332912">case</span>&nbsp;<span class="num" id="4332917">128</span>&nbsp;<span class="op" id="4332921">/</span>&nbsp;<span class="num" id="4332923">8</span><span class="op" id="4332924">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4332929">rounds</span>&nbsp;<span class="op" id="4332936">=</span>&nbsp;<span class="num" id="4332938">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4332943">case</span>&nbsp;<span class="num" id="4332948">192</span>&nbsp;<span class="op" id="4332952">/</span>&nbsp;<span class="num" id="4332954">8</span><span class="op" id="4332955">:</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4332960">rounds</span>&nbsp;<span class="op" id="4332967">=</span>&nbsp;<span class="num" id="4332969">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4332974">case</span>&nbsp;<span class="num" id="4332979">256</span>&nbsp;<span class="op" id="4332983">/</span>&nbsp;<span class="num" id="4332985">8</span><span class="op" id="4332986">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4332991">rounds</span>&nbsp;<span class="op" id="4332998">=</span>&nbsp;<span class="num" id="4333000">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4333005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4333009">expandKeyAsm</span><span class="op" id="4333021">(</span><span class="ident" id="4333022">rounds</span><span class="op" id="4333028">,</span>&nbsp;<span class="op" id="4333030">&amp;</span><span class="ident" id="4333031">key</span><span class="op" id="4333034">[</span><span class="num" id="4333035">0</span><span class="op" id="4333036">]</span><span class="op" id="4333037">,</span>&nbsp;<span class="op" id="4333039">&amp;</span><span class="ident" id="4333040">enc</span><span class="op" id="4333043">[</span><span class="num" id="4333044">0</span><span class="op" id="4333045">]</span><span class="op" id="4333046">,</span>&nbsp;<span class="op" id="4333048">&amp;</span><span class="ident" id="4333049">dec</span><span class="op" id="4333052">[</span><span class="num" id="4333053">0</span><span class="op" id="4333054">]</span><span class="op" id="4333055">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4333058">}</span>&nbsp;<span class="keyword" id="4333060">else</span>&nbsp;<span class="op" id="4333065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4333069">expandKeyGo</span><span class="op" id="4333080">(</span><span class="ident" id="4333081">key</span><span class="op" id="4333084">,</span>&nbsp;<span class="ident" id="4333086">enc</span><span class="op" id="4333089">,</span>&nbsp;<span class="ident" id="4333091">dec</span><span class="op" id="4333094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4333097">}</span><br>
<span class="lineno"></span><span class="op" id="4333099">}</span>
</div>
</body>
</html>
