<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime</h2>
<ul>
<li><a href="/gostd/mime/grammar.go.html">grammar.go</a></li>
<li><a href="/gostd/mime/mediatype.go.html" class="current">mediatype.go</a></li>
<li><a href="/gostd/mime/mediatype_test.go.html">mediatype_test.go</a></li>
<li><a href="/gostd/mime/type.go.html">type.go</a></li>
<li><a href="/gostd/mime/type_test.go.html">type_test.go</a></li>
<li><a href="/gostd/mime/type_unix.go.html">type_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2318107">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2318162">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2318216">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2318267">package</span>&nbsp;<span class="ident" id="2318275">mime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2318281">import</span>&nbsp;<span class="op" id="2318288">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2318291">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2318300">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2318310">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2318317">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2318325">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2318336">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="2318346">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2318349">//&nbsp;FormatMediaType&nbsp;serializes&nbsp;mediatype&nbsp;t&nbsp;and&nbsp;the&nbsp;parameters</span><br>
<span class="lineno"></span><span class="comment" id="2318410">//&nbsp;param&nbsp;as&nbsp;a&nbsp;media&nbsp;type&nbsp;conforming&nbsp;to&nbsp;RFC&nbsp;2045&nbsp;and&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="2318472">//&nbsp;The&nbsp;type&nbsp;and&nbsp;parameter&nbsp;names&nbsp;are&nbsp;written&nbsp;in&nbsp;lower-case.</span><br>
<span class="lineno"></span><span class="comment" id="2318531">//&nbsp;When&nbsp;any&nbsp;of&nbsp;the&nbsp;arguments&nbsp;result&nbsp;in&nbsp;a&nbsp;standard&nbsp;violation&nbsp;then</span><br>
<span class="lineno">20</span><span class="comment" id="2318596">//&nbsp;FormatMediaType&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2318641">func</span>&nbsp;<span class="ident" id="2318646">FormatMediaType</span><span class="op" id="2318661">(</span><span class="ident" id="2318662">t</span>&nbsp;<span class="builtintype" id="2318664">string</span><span class="op" id="2318670">,</span>&nbsp;<span class="ident" id="2318672">param</span>&nbsp;<span class="keyword" id="2318678">map</span><span class="op" id="2318681">[</span><span class="builtintype" id="2318682">string</span><span class="op" id="2318688">]</span><span class="builtintype" id="2318689">string</span><span class="op" id="2318695">)</span>&nbsp;<span class="builtintype" id="2318697">string</span>&nbsp;<span class="op" id="2318704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2318707">slash</span>&nbsp;<span class="op" id="2318713">:=</span>&nbsp;<span class="ident" id="2318716">strings</span><span class="op" id="2318723">.</span><span class="ident" id="2318724">Index</span><span class="op" id="2318729">(</span><span class="ident" id="2318730">t</span><span class="op" id="2318731">,</span>&nbsp;<span class="string" id="2318733">&#34;/&#34;</span><span class="op" id="2318736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2318739">if</span>&nbsp;<span class="ident" id="2318742">slash</span>&nbsp;<span class="op" id="2318748">==</span>&nbsp;<span class="op" id="2318751">-</span><span class="num" id="2318752">1</span>&nbsp;<span class="op" id="2318754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2318758">return</span>&nbsp;<span class="string" id="2318765">&#34;&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2318769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2318772">major</span><span class="op" id="2318777">,</span>&nbsp;<span class="ident" id="2318779">sub</span>&nbsp;<span class="op" id="2318783">:=</span>&nbsp;<span class="ident" id="2318786">t</span><span class="op" id="2318787">[</span><span class="op" id="2318788">:</span><span class="ident" id="2318789">slash</span><span class="op" id="2318794">]</span><span class="op" id="2318795">,</span>&nbsp;<span class="ident" id="2318797">t</span><span class="op" id="2318798">[</span><span class="ident" id="2318799">slash</span><span class="op" id="2318804">+</span><span class="num" id="2318805">1</span><span class="op" id="2318806">:</span><span class="op" id="2318807">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2318810">if</span>&nbsp;<span class="op" id="2318813">!</span><span class="ident" id="2318814">isToken</span><span class="op" id="2318821">(</span><span class="ident" id="2318822">major</span><span class="op" id="2318827">)</span>&nbsp;<span class="op" id="2318829">||</span>&nbsp;<span class="op" id="2318832">!</span><span class="ident" id="2318833">isToken</span><span class="op" id="2318840">(</span><span class="ident" id="2318841">sub</span><span class="op" id="2318844">)</span>&nbsp;<span class="op" id="2318846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2318850">return</span>&nbsp;<span class="string" id="2318857">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2318861">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2318864">var</span>&nbsp;<span class="ident" id="2318868">b</span>&nbsp;<span class="ident" id="2318870">bytes</span><span class="op" id="2318875">.</span><span class="ident" id="2318876">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2318884">b</span><span class="op" id="2318885">.</span><span class="ident" id="2318886">WriteString</span><span class="op" id="2318897">(</span><span class="ident" id="2318898">strings</span><span class="op" id="2318905">.</span><span class="ident" id="2318906">ToLower</span><span class="op" id="2318913">(</span><span class="ident" id="2318914">major</span><span class="op" id="2318919">)</span><span class="op" id="2318920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2318923">b</span><span class="op" id="2318924">.</span><span class="ident" id="2318925">WriteByte</span><span class="op" id="2318934">(</span><span class="string" id="2318935">&#39;/&#39;</span><span class="op" id="2318938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2318941">b</span><span class="op" id="2318942">.</span><span class="ident" id="2318943">WriteString</span><span class="op" id="2318954">(</span><span class="ident" id="2318955">strings</span><span class="op" id="2318962">.</span><span class="ident" id="2318963">ToLower</span><span class="op" id="2318970">(</span><span class="ident" id="2318971">sub</span><span class="op" id="2318974">)</span><span class="op" id="2318975">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2318979">attrs</span>&nbsp;<span class="op" id="2318985">:=</span>&nbsp;<span class="builtinfunc" id="2318988">make</span><span class="op" id="2318992">(</span><span class="op" id="2318993">[</span><span class="op" id="2318994">]</span><span class="builtintype" id="2318995">string</span><span class="op" id="2319001">,</span>&nbsp;<span class="num" id="2319003">0</span><span class="op" id="2319004">,</span>&nbsp;<span class="builtinfunc" id="2319006">len</span><span class="op" id="2319009">(</span><span class="ident" id="2319010">param</span><span class="op" id="2319015">)</span><span class="op" id="2319016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2319019">for</span>&nbsp;<span class="ident" id="2319023">a</span>&nbsp;<span class="op" id="2319025">:=</span>&nbsp;<span class="keyword" id="2319028">range</span>&nbsp;<span class="ident" id="2319034">param</span>&nbsp;<span class="op" id="2319040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2319044">attrs</span>&nbsp;<span class="op" id="2319050">=</span>&nbsp;<span class="builtinfunc" id="2319052">append</span><span class="op" id="2319058">(</span><span class="ident" id="2319059">attrs</span><span class="op" id="2319064">,</span>&nbsp;<span class="ident" id="2319066">a</span><span class="op" id="2319067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2319070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2319073">sort</span><span class="op" id="2319077">.</span><span class="ident" id="2319078">Strings</span><span class="op" id="2319085">(</span><span class="ident" id="2319086">attrs</span><span class="op" id="2319091">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2319095">for</span>&nbsp;<span class="ident" id="2319099">_</span><span class="op" id="2319100">,</span>&nbsp;<span class="ident" id="2319102">attribute</span>&nbsp;<span class="op" id="2319112">:=</span>&nbsp;<span class="keyword" id="2319115">range</span>&nbsp;<span class="ident" id="2319121">attrs</span>&nbsp;<span class="op" id="2319127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2319131">value</span>&nbsp;<span class="op" id="2319137">:=</span>&nbsp;<span class="ident" id="2319140">param</span><span class="op" id="2319145">[</span><span class="ident" id="2319146">attribute</span><span class="op" id="2319155">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2319159">b</span><span class="op" id="2319160">.</span><span class="ident" id="2319161">WriteByte</span><span class="op" id="2319170">(</span><span class="string" id="2319171">&#39;;&#39;</span><span class="op" id="2319174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2319178">b</span><span class="op" id="2319179">.</span><span class="ident" id="2319180">WriteByte</span><span class="op" id="2319189">(</span><span class="string" id="2319190">&#39;&nbsp;&#39;</span><span class="op" id="2319193">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2319197">if</span>&nbsp;<span class="op" id="2319200">!</span><span class="ident" id="2319201">isToken</span><span class="op" id="2319208">(</span><span class="ident" id="2319209">attribute</span><span class="op" id="2319218">)</span>&nbsp;<span class="op" id="2319220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2319225">return</span>&nbsp;<span class="string" id="2319232">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2319237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2319241">b</span><span class="op" id="2319242">.</span><span class="ident" id="2319243">WriteString</span><span class="op" id="2319254">(</span><span class="ident" id="2319255">strings</span><span class="op" id="2319262">.</span><span class="ident" id="2319263">ToLower</span><span class="op" id="2319270">(</span><span class="ident" id="2319271">attribute</span><span class="op" id="2319280">)</span><span class="op" id="2319281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2319285">b</span><span class="op" id="2319286">.</span><span class="ident" id="2319287">WriteByte</span><span class="op" id="2319296">(</span><span class="string" id="2319297">&#39;=&#39;</span><span class="op" id="2319300">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2319304">if</span>&nbsp;<span class="ident" id="2319307">isToken</span><span class="op" id="2319314">(</span><span class="ident" id="2319315">value</span><span class="op" id="2319320">)</span>&nbsp;<span class="op" id="2319322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2319327">b</span><span class="op" id="2319328">.</span><span class="ident" id="2319329">WriteString</span><span class="op" id="2319340">(</span><span class="ident" id="2319341">value</span><span class="op" id="2319346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2319351">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2319362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2319367">b</span><span class="op" id="2319368">.</span><span class="ident" id="2319369">WriteByte</span><span class="op" id="2319378">(</span><span class="string" id="2319379">&#39;&#34;&#39;</span><span class="op" id="2319382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2319386">offset</span>&nbsp;<span class="op" id="2319393">:=</span>&nbsp;<span class="num" id="2319396">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2319400">for</span>&nbsp;<span class="ident" id="2319404">index</span><span class="op" id="2319409">,</span>&nbsp;<span class="ident" id="2319411">character</span>&nbsp;<span class="op" id="2319421">:=</span>&nbsp;<span class="keyword" id="2319424">range</span>&nbsp;<span class="ident" id="2319430">value</span>&nbsp;<span class="op" id="2319436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2319441">if</span>&nbsp;<span class="ident" id="2319444">character</span>&nbsp;<span class="op" id="2319454">==</span>&nbsp;<span class="string" id="2319457">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="2319461">||</span>&nbsp;<span class="ident" id="2319464">character</span>&nbsp;<span class="op" id="2319474">==</span>&nbsp;<span class="string" id="2319477">&#39;\\&#39;</span>&nbsp;<span class="op" id="2319482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2319488">b</span><span class="op" id="2319489">.</span><span class="ident" id="2319490">WriteString</span><span class="op" id="2319501">(</span><span class="ident" id="2319502">value</span><span class="op" id="2319507">[</span><span class="ident" id="2319508">offset</span><span class="op" id="2319514">:</span><span class="ident" id="2319515">index</span><span class="op" id="2319520">]</span><span class="op" id="2319521">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2319527">offset</span>&nbsp;<span class="op" id="2319534">=</span>&nbsp;<span class="ident" id="2319536">index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2319546">b</span><span class="op" id="2319547">.</span><span class="ident" id="2319548">WriteByte</span><span class="op" id="2319557">(</span><span class="string" id="2319558">&#39;\\&#39;</span><span class="op" id="2319562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2319567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2319572">if</span>&nbsp;<span class="ident" id="2319575">character</span><span class="op" id="2319584">&amp;</span><span class="num" id="2319585">0x80</span>&nbsp;<span class="op" id="2319590">!=</span>&nbsp;<span class="num" id="2319593">0</span>&nbsp;<span class="op" id="2319595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2319601">return</span>&nbsp;<span class="string" id="2319608">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2319614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2319618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2319622">b</span><span class="op" id="2319623">.</span><span class="ident" id="2319624">WriteString</span><span class="op" id="2319635">(</span><span class="ident" id="2319636">value</span><span class="op" id="2319641">[</span><span class="ident" id="2319642">offset</span><span class="op" id="2319648">:</span><span class="op" id="2319649">]</span><span class="op" id="2319650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2319654">b</span><span class="op" id="2319655">.</span><span class="ident" id="2319656">WriteByte</span><span class="op" id="2319665">(</span><span class="string" id="2319666">&#39;&#34;&#39;</span><span class="op" id="2319669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2319672">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2319675">return</span>&nbsp;<span class="ident" id="2319682">b</span><span class="op" id="2319683">.</span><span class="ident" id="2319684">String</span><span class="op" id="2319690">(</span><span class="op" id="2319691">)</span><br>
<span class="lineno"></span><span class="op" id="2319693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2319696">func</span>&nbsp;<span class="ident" id="2319701">checkMediaTypeDisposition</span><span class="op" id="2319726">(</span><span class="ident" id="2319727">s</span>&nbsp;<span class="builtintype" id="2319729">string</span><span class="op" id="2319735">)</span>&nbsp;<span class="builtintype" id="2319737">error</span>&nbsp;<span class="op" id="2319743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2319746">typ</span><span class="op" id="2319749">,</span>&nbsp;<span class="ident" id="2319751">rest</span>&nbsp;<span class="op" id="2319756">:=</span>&nbsp;<span class="ident" id="2319759">consumeToken</span><span class="op" id="2319771">(</span><span class="ident" id="2319772">s</span><span class="op" id="2319773">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2319776">if</span>&nbsp;<span class="ident" id="2319779">typ</span>&nbsp;<span class="op" id="2319783">==</span>&nbsp;<span class="string" id="2319786">&#34;&#34;</span>&nbsp;<span class="op" id="2319789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2319793">return</span>&nbsp;<span class="ident" id="2319800">errors</span><span class="op" id="2319806">.</span><span class="ident" id="2319807">New</span><span class="op" id="2319810">(</span><span class="string" id="2319811">&#34;mime:&nbsp;no&nbsp;media&nbsp;type&#34;</span><span class="op" id="2319832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2319835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2319838">if</span>&nbsp;<span class="ident" id="2319841">rest</span>&nbsp;<span class="op" id="2319846">==</span>&nbsp;<span class="string" id="2319849">&#34;&#34;</span>&nbsp;<span class="op" id="2319852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2319856">return</span>&nbsp;<span class="builtintype" id="2319863">nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2319868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2319871">if</span>&nbsp;<span class="op" id="2319874">!</span><span class="ident" id="2319875">strings</span><span class="op" id="2319882">.</span><span class="ident" id="2319883">HasPrefix</span><span class="op" id="2319892">(</span><span class="ident" id="2319893">rest</span><span class="op" id="2319897">,</span>&nbsp;<span class="string" id="2319899">&#34;/&#34;</span><span class="op" id="2319902">)</span>&nbsp;<span class="op" id="2319904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2319908">return</span>&nbsp;<span class="ident" id="2319915">errors</span><span class="op" id="2319921">.</span><span class="ident" id="2319922">New</span><span class="op" id="2319925">(</span><span class="string" id="2319926">&#34;mime:&nbsp;expected&nbsp;slash&nbsp;after&nbsp;first&nbsp;token&#34;</span><span class="op" id="2319966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2319969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2319972">subtype</span><span class="op" id="2319979">,</span>&nbsp;<span class="ident" id="2319981">rest</span>&nbsp;<span class="op" id="2319986">:=</span>&nbsp;<span class="ident" id="2319989">consumeToken</span><span class="op" id="2320001">(</span><span class="ident" id="2320002">rest</span><span class="op" id="2320006">[</span><span class="num" id="2320007">1</span><span class="op" id="2320008">:</span><span class="op" id="2320009">]</span><span class="op" id="2320010">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2320013">if</span>&nbsp;<span class="ident" id="2320016">subtype</span>&nbsp;<span class="op" id="2320024">==</span>&nbsp;<span class="string" id="2320027">&#34;&#34;</span>&nbsp;<span class="op" id="2320030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2320034">return</span>&nbsp;<span class="ident" id="2320041">errors</span><span class="op" id="2320047">.</span><span class="ident" id="2320048">New</span><span class="op" id="2320051">(</span><span class="string" id="2320052">&#34;mime:&nbsp;expected&nbsp;token&nbsp;after&nbsp;slash&#34;</span><span class="op" id="2320086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2320089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2320092">if</span>&nbsp;<span class="ident" id="2320095">rest</span>&nbsp;<span class="op" id="2320100">!=</span>&nbsp;<span class="string" id="2320103">&#34;&#34;</span>&nbsp;<span class="op" id="2320106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2320110">return</span>&nbsp;<span class="ident" id="2320117">errors</span><span class="op" id="2320123">.</span><span class="ident" id="2320124">New</span><span class="op" id="2320127">(</span><span class="string" id="2320128">&#34;mime:&nbsp;unexpected&nbsp;content&nbsp;after&nbsp;media&nbsp;subtype&#34;</span><span class="op" id="2320174">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2320177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2320180">return</span>&nbsp;<span class="builtintype" id="2320187">nil</span><br>
<span class="lineno"></span><span class="op" id="2320191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2320194">//&nbsp;ParseMediaType&nbsp;parses&nbsp;a&nbsp;media&nbsp;type&nbsp;value&nbsp;and&nbsp;any&nbsp;optional</span><br>
<span class="lineno">95</span><span class="comment" id="2320255">//&nbsp;parameters,&nbsp;per&nbsp;RFC&nbsp;1521.&nbsp;&nbsp;Media&nbsp;types&nbsp;are&nbsp;the&nbsp;values&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="2320315">//&nbsp;Content-Type&nbsp;and&nbsp;Content-Disposition&nbsp;headers&nbsp;(RFC&nbsp;2183).</span><br>
<span class="lineno"></span><span class="comment" id="2320375">//&nbsp;On&nbsp;success,&nbsp;ParseMediaType&nbsp;returns&nbsp;the&nbsp;media&nbsp;type&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="2320438">//&nbsp;to&nbsp;lowercase&nbsp;and&nbsp;trimmed&nbsp;of&nbsp;white&nbsp;space&nbsp;and&nbsp;a&nbsp;non-nil&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="2320500">//&nbsp;The&nbsp;returned&nbsp;map,&nbsp;params,&nbsp;maps&nbsp;from&nbsp;the&nbsp;lowercase</span><br>
<span class="lineno">100</span><span class="comment" id="2320553">//&nbsp;attribute&nbsp;to&nbsp;the&nbsp;attribute&nbsp;value&nbsp;with&nbsp;its&nbsp;case&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="keyword" id="2320614">func</span>&nbsp;<span class="ident" id="2320619">ParseMediaType</span><span class="op" id="2320633">(</span><span class="ident" id="2320634">v</span>&nbsp;<span class="builtintype" id="2320636">string</span><span class="op" id="2320642">)</span>&nbsp;<span class="op" id="2320644">(</span><span class="ident" id="2320645">mediatype</span>&nbsp;<span class="builtintype" id="2320655">string</span><span class="op" id="2320661">,</span>&nbsp;<span class="ident" id="2320663">params</span>&nbsp;<span class="keyword" id="2320670">map</span><span class="op" id="2320673">[</span><span class="builtintype" id="2320674">string</span><span class="op" id="2320680">]</span><span class="builtintype" id="2320681">string</span><span class="op" id="2320687">,</span>&nbsp;<span class="ident" id="2320689">err</span>&nbsp;<span class="builtintype" id="2320693">error</span><span class="op" id="2320698">)</span>&nbsp;<span class="op" id="2320700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2320703">i</span>&nbsp;<span class="op" id="2320705">:=</span>&nbsp;<span class="ident" id="2320708">strings</span><span class="op" id="2320715">.</span><span class="ident" id="2320716">Index</span><span class="op" id="2320721">(</span><span class="ident" id="2320722">v</span><span class="op" id="2320723">,</span>&nbsp;<span class="string" id="2320725">&#34;;&#34;</span><span class="op" id="2320728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2320731">if</span>&nbsp;<span class="ident" id="2320734">i</span>&nbsp;<span class="op" id="2320736">==</span>&nbsp;<span class="op" id="2320739">-</span><span class="num" id="2320740">1</span>&nbsp;<span class="op" id="2320742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2320746">i</span>&nbsp;<span class="op" id="2320748">=</span>&nbsp;<span class="builtinfunc" id="2320750">len</span><span class="op" id="2320753">(</span><span class="ident" id="2320754">v</span><span class="op" id="2320755">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2320758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2320761">mediatype</span>&nbsp;<span class="op" id="2320771">=</span>&nbsp;<span class="ident" id="2320773">strings</span><span class="op" id="2320780">.</span><span class="ident" id="2320781">TrimSpace</span><span class="op" id="2320790">(</span><span class="ident" id="2320791">strings</span><span class="op" id="2320798">.</span><span class="ident" id="2320799">ToLower</span><span class="op" id="2320806">(</span><span class="ident" id="2320807">v</span><span class="op" id="2320808">[</span><span class="num" id="2320809">0</span><span class="op" id="2320810">:</span><span class="ident" id="2320811">i</span><span class="op" id="2320812">]</span><span class="op" id="2320813">)</span><span class="op" id="2320814">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2320818">err</span>&nbsp;<span class="op" id="2320822">=</span>&nbsp;<span class="ident" id="2320824">checkMediaTypeDisposition</span><span class="op" id="2320849">(</span><span class="ident" id="2320850">mediatype</span><span class="op" id="2320859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2320862">if</span>&nbsp;<span class="ident" id="2320865">err</span>&nbsp;<span class="op" id="2320869">!=</span>&nbsp;<span class="builtintype" id="2320872">nil</span>&nbsp;<span class="op" id="2320876">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2320880">return</span>&nbsp;<span class="string" id="2320887">&#34;&#34;</span><span class="op" id="2320889">,</span>&nbsp;<span class="builtintype" id="2320891">nil</span><span class="op" id="2320894">,</span>&nbsp;<span class="ident" id="2320896">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2320901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2320905">params</span>&nbsp;<span class="op" id="2320912">=</span>&nbsp;<span class="builtinfunc" id="2320914">make</span><span class="op" id="2320918">(</span><span class="keyword" id="2320919">map</span><span class="op" id="2320922">[</span><span class="builtintype" id="2320923">string</span><span class="op" id="2320929">]</span><span class="builtintype" id="2320930">string</span><span class="op" id="2320936">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2320940">//&nbsp;Map&nbsp;of&nbsp;base&nbsp;parameter&nbsp;name&nbsp;-&gt;&nbsp;parameter&nbsp;name&nbsp;-&gt;&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2320998">//&nbsp;for&nbsp;parameters&nbsp;containing&nbsp;a&nbsp;&#39;*&#39;&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2321045">//&nbsp;Lazily&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2321069">var</span>&nbsp;<span class="ident" id="2321073">continuation</span>&nbsp;<span class="keyword" id="2321086">map</span><span class="op" id="2321089">[</span><span class="builtintype" id="2321090">string</span><span class="op" id="2321096">]</span><span class="keyword" id="2321097">map</span><span class="op" id="2321100">[</span><span class="builtintype" id="2321101">string</span><span class="op" id="2321107">]</span><span class="builtintype" id="2321108">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2321117">v</span>&nbsp;<span class="op" id="2321119">=</span>&nbsp;<span class="ident" id="2321121">v</span><span class="op" id="2321122">[</span><span class="ident" id="2321123">i</span><span class="op" id="2321124">:</span><span class="op" id="2321125">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2321128">for</span>&nbsp;<span class="builtinfunc" id="2321132">len</span><span class="op" id="2321135">(</span><span class="ident" id="2321136">v</span><span class="op" id="2321137">)</span>&nbsp;<span class="op" id="2321139">&gt;</span>&nbsp;<span class="num" id="2321141">0</span>&nbsp;<span class="op" id="2321143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2321147">v</span>&nbsp;<span class="op" id="2321149">=</span>&nbsp;<span class="ident" id="2321151">strings</span><span class="op" id="2321158">.</span><span class="ident" id="2321159">TrimLeftFunc</span><span class="op" id="2321171">(</span><span class="ident" id="2321172">v</span><span class="op" id="2321173">,</span>&nbsp;<span class="ident" id="2321175">unicode</span><span class="op" id="2321182">.</span><span class="ident" id="2321183">IsSpace</span><span class="op" id="2321190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2321194">if</span>&nbsp;<span class="builtinfunc" id="2321197">len</span><span class="op" id="2321200">(</span><span class="ident" id="2321201">v</span><span class="op" id="2321202">)</span>&nbsp;<span class="op" id="2321204">==</span>&nbsp;<span class="num" id="2321207">0</span>&nbsp;<span class="op" id="2321209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2321214">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2321222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2321226">key</span><span class="op" id="2321229">,</span>&nbsp;<span class="ident" id="2321231">value</span><span class="op" id="2321236">,</span>&nbsp;<span class="ident" id="2321238">rest</span>&nbsp;<span class="op" id="2321243">:=</span>&nbsp;<span class="ident" id="2321246">consumeMediaParam</span><span class="op" id="2321263">(</span><span class="ident" id="2321264">v</span><span class="op" id="2321265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2321269">if</span>&nbsp;<span class="ident" id="2321272">key</span>&nbsp;<span class="op" id="2321276">==</span>&nbsp;<span class="string" id="2321279">&#34;&#34;</span>&nbsp;<span class="op" id="2321282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2321287">if</span>&nbsp;<span class="ident" id="2321290">strings</span><span class="op" id="2321297">.</span><span class="ident" id="2321298">TrimSpace</span><span class="op" id="2321307">(</span><span class="ident" id="2321308">rest</span><span class="op" id="2321312">)</span>&nbsp;<span class="op" id="2321314">==</span>&nbsp;<span class="string" id="2321317">&#34;;&#34;</span>&nbsp;<span class="op" id="2321321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2321327">//&nbsp;Ignore&nbsp;trailing&nbsp;semicolons.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2321362">//&nbsp;Not&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2321383">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2321393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2321398">//&nbsp;Parse&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2321417">return</span>&nbsp;<span class="string" id="2321424">&#34;&#34;</span><span class="op" id="2321426">,</span>&nbsp;<span class="builtintype" id="2321428">nil</span><span class="op" id="2321431">,</span>&nbsp;<span class="ident" id="2321433">errors</span><span class="op" id="2321439">.</span><span class="ident" id="2321440">New</span><span class="op" id="2321443">(</span><span class="string" id="2321444">&#34;mime:&nbsp;invalid&nbsp;media&nbsp;parameter&#34;</span><span class="op" id="2321475">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2321479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2321484">pmap</span>&nbsp;<span class="op" id="2321489">:=</span>&nbsp;<span class="ident" id="2321492">params</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2321501">if</span>&nbsp;<span class="ident" id="2321504">idx</span>&nbsp;<span class="op" id="2321508">:=</span>&nbsp;<span class="ident" id="2321511">strings</span><span class="op" id="2321518">.</span><span class="ident" id="2321519">Index</span><span class="op" id="2321524">(</span><span class="ident" id="2321525">key</span><span class="op" id="2321528">,</span>&nbsp;<span class="string" id="2321530">&#34;*&#34;</span><span class="op" id="2321533">)</span><span class="op" id="2321534">;</span>&nbsp;<span class="ident" id="2321536">idx</span>&nbsp;<span class="op" id="2321540">!=</span>&nbsp;<span class="op" id="2321543">-</span><span class="num" id="2321544">1</span>&nbsp;<span class="op" id="2321546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2321551">baseName</span>&nbsp;<span class="op" id="2321560">:=</span>&nbsp;<span class="ident" id="2321563">key</span><span class="op" id="2321566">[</span><span class="op" id="2321567">:</span><span class="ident" id="2321568">idx</span><span class="op" id="2321571">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2321576">if</span>&nbsp;<span class="ident" id="2321579">continuation</span>&nbsp;<span class="op" id="2321592">==</span>&nbsp;<span class="builtintype" id="2321595">nil</span>&nbsp;<span class="op" id="2321599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2321605">continuation</span>&nbsp;<span class="op" id="2321618">=</span>&nbsp;<span class="builtinfunc" id="2321620">make</span><span class="op" id="2321624">(</span><span class="keyword" id="2321625">map</span><span class="op" id="2321628">[</span><span class="builtintype" id="2321629">string</span><span class="op" id="2321635">]</span><span class="keyword" id="2321636">map</span><span class="op" id="2321639">[</span><span class="builtintype" id="2321640">string</span><span class="op" id="2321646">]</span><span class="builtintype" id="2321647">string</span><span class="op" id="2321653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2321658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2321663">var</span>&nbsp;<span class="ident" id="2321667">ok</span>&nbsp;<span class="builtintype" id="2321670">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2321678">if</span>&nbsp;<span class="ident" id="2321681">pmap</span><span class="op" id="2321685">,</span>&nbsp;<span class="ident" id="2321687">ok</span>&nbsp;<span class="op" id="2321690">=</span>&nbsp;<span class="ident" id="2321692">continuation</span><span class="op" id="2321704">[</span><span class="ident" id="2321705">baseName</span><span class="op" id="2321713">]</span><span class="op" id="2321714">;</span>&nbsp;<span class="op" id="2321716">!</span><span class="ident" id="2321717">ok</span>&nbsp;<span class="op" id="2321720">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2321726">continuation</span><span class="op" id="2321738">[</span><span class="ident" id="2321739">baseName</span><span class="op" id="2321747">]</span>&nbsp;<span class="op" id="2321749">=</span>&nbsp;<span class="builtinfunc" id="2321751">make</span><span class="op" id="2321755">(</span><span class="keyword" id="2321756">map</span><span class="op" id="2321759">[</span><span class="builtintype" id="2321760">string</span><span class="op" id="2321766">]</span><span class="builtintype" id="2321767">string</span><span class="op" id="2321773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2321779">pmap</span>&nbsp;<span class="op" id="2321784">=</span>&nbsp;<span class="ident" id="2321786">continuation</span><span class="op" id="2321798">[</span><span class="ident" id="2321799">baseName</span><span class="op" id="2321807">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2321812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2321816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2321820">if</span>&nbsp;<span class="ident" id="2321823">_</span><span class="op" id="2321824">,</span>&nbsp;<span class="ident" id="2321826">exists</span>&nbsp;<span class="op" id="2321833">:=</span>&nbsp;<span class="ident" id="2321836">pmap</span><span class="op" id="2321840">[</span><span class="ident" id="2321841">key</span><span class="op" id="2321844">]</span><span class="op" id="2321845">;</span>&nbsp;<span class="ident" id="2321847">exists</span>&nbsp;<span class="op" id="2321854">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2321859">//&nbsp;Duplicate&nbsp;parameter&nbsp;name&nbsp;is&nbsp;bogus.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2321900">return</span>&nbsp;<span class="string" id="2321907">&#34;&#34;</span><span class="op" id="2321909">,</span>&nbsp;<span class="builtintype" id="2321911">nil</span><span class="op" id="2321914">,</span>&nbsp;<span class="ident" id="2321916">errors</span><span class="op" id="2321922">.</span><span class="ident" id="2321923">New</span><span class="op" id="2321926">(</span><span class="string" id="2321927">&#34;mime:&nbsp;duplicate&nbsp;parameter&nbsp;name&#34;</span><span class="op" id="2321959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2321963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2321967">pmap</span><span class="op" id="2321971">[</span><span class="ident" id="2321972">key</span><span class="op" id="2321975">]</span>&nbsp;<span class="op" id="2321977">=</span>&nbsp;<span class="ident" id="2321979">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2321987">v</span>&nbsp;<span class="op" id="2321989">=</span>&nbsp;<span class="ident" id="2321991">rest</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2321997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2322001">//&nbsp;Stitch&nbsp;together&nbsp;any&nbsp;continuations&nbsp;or&nbsp;things&nbsp;with&nbsp;stars</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2322060">//&nbsp;(i.e.&nbsp;RFC&nbsp;2231&nbsp;things&nbsp;with&nbsp;stars:&nbsp;&#34;foo*0&#34;&nbsp;or&nbsp;&#34;foo*&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2322117">var</span>&nbsp;<span class="ident" id="2322121">buf</span>&nbsp;<span class="ident" id="2322125">bytes</span><span class="op" id="2322130">.</span><span class="ident" id="2322131">Buffer</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2322139">for</span>&nbsp;<span class="ident" id="2322143">key</span><span class="op" id="2322146">,</span>&nbsp;<span class="ident" id="2322148">pieceMap</span>&nbsp;<span class="op" id="2322157">:=</span>&nbsp;<span class="keyword" id="2322160">range</span>&nbsp;<span class="ident" id="2322166">continuation</span>&nbsp;<span class="op" id="2322179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2322183">singlePartKey</span>&nbsp;<span class="op" id="2322197">:=</span>&nbsp;<span class="ident" id="2322200">key</span>&nbsp;<span class="op" id="2322204">+</span>&nbsp;<span class="string" id="2322206">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2322212">if</span>&nbsp;<span class="ident" id="2322215">v</span><span class="op" id="2322216">,</span>&nbsp;<span class="ident" id="2322218">ok</span>&nbsp;<span class="op" id="2322221">:=</span>&nbsp;<span class="ident" id="2322224">pieceMap</span><span class="op" id="2322232">[</span><span class="ident" id="2322233">singlePartKey</span><span class="op" id="2322246">]</span><span class="op" id="2322247">;</span>&nbsp;<span class="ident" id="2322249">ok</span>&nbsp;<span class="op" id="2322252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2322257">decv</span>&nbsp;<span class="op" id="2322262">:=</span>&nbsp;<span class="ident" id="2322265">decode2231Enc</span><span class="op" id="2322278">(</span><span class="ident" id="2322279">v</span><span class="op" id="2322280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2322285">params</span><span class="op" id="2322291">[</span><span class="ident" id="2322292">key</span><span class="op" id="2322295">]</span>&nbsp;<span class="op" id="2322297">=</span>&nbsp;<span class="ident" id="2322299">decv</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2322307">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2322318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2322323">buf</span><span class="op" id="2322326">.</span><span class="ident" id="2322327">Reset</span><span class="op" id="2322332">(</span><span class="op" id="2322333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2322337">valid</span>&nbsp;<span class="op" id="2322343">:=</span>&nbsp;<span class="builtintype" id="2322346">false</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2322354">for</span>&nbsp;<span class="ident" id="2322358">n</span>&nbsp;<span class="op" id="2322360">:=</span>&nbsp;<span class="num" id="2322363">0</span><span class="op" id="2322364">;</span>&nbsp;<span class="op" id="2322366">;</span>&nbsp;<span class="ident" id="2322368">n</span><span class="op" id="2322369">++</span>&nbsp;<span class="op" id="2322372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2322377">simplePart</span>&nbsp;<span class="op" id="2322388">:=</span>&nbsp;<span class="ident" id="2322391">fmt</span><span class="op" id="2322394">.</span><span class="ident" id="2322395">Sprintf</span><span class="op" id="2322402">(</span><span class="string" id="2322403">&#34;%s*%d&#34;</span><span class="op" id="2322410">,</span>&nbsp;<span class="ident" id="2322412">key</span><span class="op" id="2322415">,</span>&nbsp;<span class="ident" id="2322417">n</span><span class="op" id="2322418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2322423">if</span>&nbsp;<span class="ident" id="2322426">v</span><span class="op" id="2322427">,</span>&nbsp;<span class="ident" id="2322429">ok</span>&nbsp;<span class="op" id="2322432">:=</span>&nbsp;<span class="ident" id="2322435">pieceMap</span><span class="op" id="2322443">[</span><span class="ident" id="2322444">simplePart</span><span class="op" id="2322454">]</span><span class="op" id="2322455">;</span>&nbsp;<span class="ident" id="2322457">ok</span>&nbsp;<span class="op" id="2322460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2322466">valid</span>&nbsp;<span class="op" id="2322472">=</span>&nbsp;<span class="builtintype" id="2322474">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2322483">buf</span><span class="op" id="2322486">.</span><span class="ident" id="2322487">WriteString</span><span class="op" id="2322498">(</span><span class="ident" id="2322499">v</span><span class="op" id="2322500">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2322506">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2322518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2322523">encodedPart</span>&nbsp;<span class="op" id="2322535">:=</span>&nbsp;<span class="ident" id="2322538">simplePart</span>&nbsp;<span class="op" id="2322549">+</span>&nbsp;<span class="string" id="2322551">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2322558">if</span>&nbsp;<span class="ident" id="2322561">v</span><span class="op" id="2322562">,</span>&nbsp;<span class="ident" id="2322564">ok</span>&nbsp;<span class="op" id="2322567">:=</span>&nbsp;<span class="ident" id="2322570">pieceMap</span><span class="op" id="2322578">[</span><span class="ident" id="2322579">encodedPart</span><span class="op" id="2322590">]</span><span class="op" id="2322591">;</span>&nbsp;<span class="ident" id="2322593">ok</span>&nbsp;<span class="op" id="2322596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2322602">valid</span>&nbsp;<span class="op" id="2322608">=</span>&nbsp;<span class="builtintype" id="2322610">true</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2322619">if</span>&nbsp;<span class="ident" id="2322622">n</span>&nbsp;<span class="op" id="2322624">==</span>&nbsp;<span class="num" id="2322627">0</span>&nbsp;<span class="op" id="2322629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2322636">buf</span><span class="op" id="2322639">.</span><span class="ident" id="2322640">WriteString</span><span class="op" id="2322651">(</span><span class="ident" id="2322652">decode2231Enc</span><span class="op" id="2322665">(</span><span class="ident" id="2322666">v</span><span class="op" id="2322667">)</span><span class="op" id="2322668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2322674">}</span>&nbsp;<span class="keyword" id="2322676">else</span>&nbsp;<span class="op" id="2322681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2322688">decv</span><span class="op" id="2322692">,</span>&nbsp;<span class="ident" id="2322694">_</span>&nbsp;<span class="op" id="2322696">:=</span>&nbsp;<span class="ident" id="2322699">percentHexUnescape</span><span class="op" id="2322717">(</span><span class="ident" id="2322718">v</span><span class="op" id="2322719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2322726">buf</span><span class="op" id="2322729">.</span><span class="ident" id="2322730">WriteString</span><span class="op" id="2322741">(</span><span class="ident" id="2322742">decv</span><span class="op" id="2322746">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2322752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2322757">}</span>&nbsp;<span class="keyword" id="2322759">else</span>&nbsp;<span class="op" id="2322764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2322770">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2322779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2322783">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2322787">if</span>&nbsp;<span class="ident" id="2322790">valid</span>&nbsp;<span class="op" id="2322796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2322801">params</span><span class="op" id="2322807">[</span><span class="ident" id="2322808">key</span><span class="op" id="2322811">]</span>&nbsp;<span class="op" id="2322813">=</span>&nbsp;<span class="ident" id="2322815">buf</span><span class="op" id="2322818">.</span><span class="ident" id="2322819">String</span><span class="op" id="2322825">(</span><span class="op" id="2322826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2322830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2322833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2322837">return</span><br>
<span class="lineno"></span><span class="op" id="2322844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2322847">func</span>&nbsp;<span class="ident" id="2322852">decode2231Enc</span><span class="op" id="2322865">(</span><span class="ident" id="2322866">v</span>&nbsp;<span class="builtintype" id="2322868">string</span><span class="op" id="2322874">)</span>&nbsp;<span class="builtintype" id="2322876">string</span>&nbsp;<span class="op" id="2322883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2322886">sv</span>&nbsp;<span class="op" id="2322889">:=</span>&nbsp;<span class="ident" id="2322892">strings</span><span class="op" id="2322899">.</span><span class="ident" id="2322900">SplitN</span><span class="op" id="2322906">(</span><span class="ident" id="2322907">v</span><span class="op" id="2322908">,</span>&nbsp;<span class="string" id="2322910">&#34;&#39;&#34;</span><span class="op" id="2322913">,</span>&nbsp;<span class="num" id="2322915">3</span><span class="op" id="2322916">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2322919">if</span>&nbsp;<span class="builtinfunc" id="2322922">len</span><span class="op" id="2322925">(</span><span class="ident" id="2322926">sv</span><span class="op" id="2322928">)</span>&nbsp;<span class="op" id="2322930">!=</span>&nbsp;<span class="num" id="2322933">3</span>&nbsp;<span class="op" id="2322935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2322939">return</span>&nbsp;<span class="string" id="2322946">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2322950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2322953">//&nbsp;TODO:&nbsp;ignoring&nbsp;lang&nbsp;in&nbsp;sv[1]&nbsp;for&nbsp;now.&nbsp;If&nbsp;anybody&nbsp;needs&nbsp;it&nbsp;we&#39;ll</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2323021">//&nbsp;need&nbsp;to&nbsp;decide&nbsp;how&nbsp;to&nbsp;expose&nbsp;it&nbsp;in&nbsp;the&nbsp;API.&nbsp;But&nbsp;I&#39;m&nbsp;not&nbsp;sure</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2323086">//&nbsp;anybody&nbsp;uses&nbsp;it&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2323119">charset</span>&nbsp;<span class="op" id="2323127">:=</span>&nbsp;<span class="ident" id="2323130">strings</span><span class="op" id="2323137">.</span><span class="ident" id="2323138">ToLower</span><span class="op" id="2323145">(</span><span class="ident" id="2323146">sv</span><span class="op" id="2323148">[</span><span class="num" id="2323149">0</span><span class="op" id="2323150">]</span><span class="op" id="2323151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2323154">if</span>&nbsp;<span class="ident" id="2323157">charset</span>&nbsp;<span class="op" id="2323165">!=</span>&nbsp;<span class="string" id="2323168">&#34;us-ascii&#34;</span>&nbsp;<span class="op" id="2323179">&amp;&amp;</span>&nbsp;<span class="ident" id="2323182">charset</span>&nbsp;<span class="op" id="2323190">!=</span>&nbsp;<span class="string" id="2323193">&#34;utf-8&#34;</span>&nbsp;<span class="op" id="2323201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2323205">//&nbsp;TODO:&nbsp;unsupported&nbsp;encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2323237">return</span>&nbsp;<span class="string" id="2323244">&#34;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2323248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2323251">encv</span><span class="op" id="2323255">,</span>&nbsp;<span class="ident" id="2323257">_</span>&nbsp;<span class="op" id="2323259">:=</span>&nbsp;<span class="ident" id="2323262">percentHexUnescape</span><span class="op" id="2323280">(</span><span class="ident" id="2323281">sv</span><span class="op" id="2323283">[</span><span class="num" id="2323284">2</span><span class="op" id="2323285">]</span><span class="op" id="2323286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2323289">return</span>&nbsp;<span class="ident" id="2323296">encv</span><br>
<span class="lineno"></span><span class="op" id="2323301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="2323304">func</span>&nbsp;<span class="ident" id="2323309">isNotTokenChar</span><span class="op" id="2323323">(</span><span class="ident" id="2323324">r</span>&nbsp;<span class="builtintype" id="2323326">rune</span><span class="op" id="2323330">)</span>&nbsp;<span class="builtintype" id="2323332">bool</span>&nbsp;<span class="op" id="2323337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2323340">return</span>&nbsp;<span class="op" id="2323347">!</span><span class="ident" id="2323348">isTokenChar</span><span class="op" id="2323359">(</span><span class="ident" id="2323360">r</span><span class="op" id="2323361">)</span><br>
<span class="lineno"></span><span class="op" id="2323363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2323366">//&nbsp;consumeToken&nbsp;consumes&nbsp;a&nbsp;token&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;provided</span><br>
<span class="lineno">220</span><span class="comment" id="2323430">//&nbsp;string,&nbsp;per&nbsp;RFC&nbsp;2045&nbsp;section&nbsp;5.1&nbsp;(referenced&nbsp;from&nbsp;2183),&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="2323501">//&nbsp;the&nbsp;token&nbsp;consumed&nbsp;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;string.&nbsp;&nbsp;Returns&nbsp;(&#34;&#34;,&nbsp;v)&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="2323571">//&nbsp;failure&nbsp;to&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;character.</span><br>
<span class="lineno"></span><span class="keyword" id="2323617">func</span>&nbsp;<span class="ident" id="2323622">consumeToken</span><span class="op" id="2323634">(</span><span class="ident" id="2323635">v</span>&nbsp;<span class="builtintype" id="2323637">string</span><span class="op" id="2323643">)</span>&nbsp;<span class="op" id="2323645">(</span><span class="ident" id="2323646">token</span><span class="op" id="2323651">,</span>&nbsp;<span class="ident" id="2323653">rest</span>&nbsp;<span class="builtintype" id="2323658">string</span><span class="op" id="2323664">)</span>&nbsp;<span class="op" id="2323666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2323669">notPos</span>&nbsp;<span class="op" id="2323676">:=</span>&nbsp;<span class="ident" id="2323679">strings</span><span class="op" id="2323686">.</span><span class="ident" id="2323687">IndexFunc</span><span class="op" id="2323696">(</span><span class="ident" id="2323697">v</span><span class="op" id="2323698">,</span>&nbsp;<span class="ident" id="2323700">isNotTokenChar</span><span class="op" id="2323714">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2323717">if</span>&nbsp;<span class="ident" id="2323720">notPos</span>&nbsp;<span class="op" id="2323727">==</span>&nbsp;<span class="op" id="2323730">-</span><span class="num" id="2323731">1</span>&nbsp;<span class="op" id="2323733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2323737">return</span>&nbsp;<span class="ident" id="2323744">v</span><span class="op" id="2323745">,</span>&nbsp;<span class="string" id="2323747">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2323751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2323754">if</span>&nbsp;<span class="ident" id="2323757">notPos</span>&nbsp;<span class="op" id="2323764">==</span>&nbsp;<span class="num" id="2323767">0</span>&nbsp;<span class="op" id="2323769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2323773">return</span>&nbsp;<span class="string" id="2323780">&#34;&#34;</span><span class="op" id="2323782">,</span>&nbsp;<span class="ident" id="2323784">v</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2323787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2323790">return</span>&nbsp;<span class="ident" id="2323797">v</span><span class="op" id="2323798">[</span><span class="num" id="2323799">0</span><span class="op" id="2323800">:</span><span class="ident" id="2323801">notPos</span><span class="op" id="2323807">]</span><span class="op" id="2323808">,</span>&nbsp;<span class="ident" id="2323810">v</span><span class="op" id="2323811">[</span><span class="ident" id="2323812">notPos</span><span class="op" id="2323818">:</span><span class="op" id="2323819">]</span><br>
<span class="lineno"></span><span class="op" id="2323821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2323824">//&nbsp;consumeValue&nbsp;consumes&nbsp;a&nbsp;&#34;value&#34;&nbsp;per&nbsp;RFC&nbsp;2045,&nbsp;where&nbsp;a&nbsp;value&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="2323890">//&nbsp;either&nbsp;a&nbsp;&#39;token&#39;&nbsp;or&nbsp;a&nbsp;&#39;quoted-string&#39;.&nbsp;&nbsp;On&nbsp;success,&nbsp;consumeValue</span><br>
<span class="lineno"></span><span class="comment" id="2323958">//&nbsp;returns&nbsp;the&nbsp;value&nbsp;consumed&nbsp;(and&nbsp;de-quoted/escaped,&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="2324017">//&nbsp;quoted-string)&nbsp;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;string.&nbsp;&nbsp;On&nbsp;failure,&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="2324084">//&nbsp;(&#34;&#34;,&nbsp;v).</span><br>
<span class="lineno"></span><span class="keyword" id="2324096">func</span>&nbsp;<span class="ident" id="2324101">consumeValue</span><span class="op" id="2324113">(</span><span class="ident" id="2324114">v</span>&nbsp;<span class="builtintype" id="2324116">string</span><span class="op" id="2324122">)</span>&nbsp;<span class="op" id="2324124">(</span><span class="ident" id="2324125">value</span><span class="op" id="2324130">,</span>&nbsp;<span class="ident" id="2324132">rest</span>&nbsp;<span class="builtintype" id="2324137">string</span><span class="op" id="2324143">)</span>&nbsp;<span class="op" id="2324145">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2324148">if</span>&nbsp;<span class="op" id="2324151">!</span><span class="ident" id="2324152">strings</span><span class="op" id="2324159">.</span><span class="ident" id="2324160">HasPrefix</span><span class="op" id="2324169">(</span><span class="ident" id="2324170">v</span><span class="op" id="2324171">,</span>&nbsp;<span class="string" id="2324173">`&#34;`</span><span class="op" id="2324176">)</span>&nbsp;<span class="op" id="2324178">&amp;&amp;</span>&nbsp;<span class="op" id="2324181">!</span><span class="ident" id="2324182">strings</span><span class="op" id="2324189">.</span><span class="ident" id="2324190">HasPrefix</span><span class="op" id="2324199">(</span><span class="ident" id="2324200">v</span><span class="op" id="2324201">,</span>&nbsp;<span class="string" id="2324203">`&#39;`</span><span class="op" id="2324206">)</span>&nbsp;<span class="op" id="2324208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2324212">return</span>&nbsp;<span class="ident" id="2324219">consumeToken</span><span class="op" id="2324231">(</span><span class="ident" id="2324232">v</span><span class="op" id="2324233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2324236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2324240">leadQuote</span>&nbsp;<span class="op" id="2324250">:=</span>&nbsp;<span class="builtintype" id="2324253">rune</span><span class="op" id="2324257">(</span><span class="ident" id="2324258">v</span><span class="op" id="2324259">[</span><span class="num" id="2324260">0</span><span class="op" id="2324261">]</span><span class="op" id="2324262">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2324266">//&nbsp;parse&nbsp;a&nbsp;quoted-string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2324292">rest</span>&nbsp;<span class="op" id="2324297">=</span>&nbsp;<span class="ident" id="2324299">v</span><span class="op" id="2324300">[</span><span class="num" id="2324301">1</span><span class="op" id="2324302">:</span><span class="op" id="2324303">]</span>&nbsp;<span class="comment" id="2324305">//&nbsp;consume&nbsp;the&nbsp;leading&nbsp;quote</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2324335">buffer</span>&nbsp;<span class="op" id="2324342">:=</span>&nbsp;<span class="builtinfunc" id="2324345">new</span><span class="op" id="2324348">(</span><span class="ident" id="2324349">bytes</span><span class="op" id="2324354">.</span><span class="ident" id="2324355">Buffer</span><span class="op" id="2324361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2324364">var</span>&nbsp;<span class="ident" id="2324368">idx</span>&nbsp;<span class="builtintype" id="2324372">int</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2324377">var</span>&nbsp;<span class="ident" id="2324381">r</span>&nbsp;<span class="builtintype" id="2324383">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2324389">var</span>&nbsp;<span class="ident" id="2324393">nextIsLiteral</span>&nbsp;<span class="builtintype" id="2324407">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2324413">for</span>&nbsp;<span class="ident" id="2324417">idx</span><span class="op" id="2324420">,</span>&nbsp;<span class="ident" id="2324422">r</span>&nbsp;<span class="op" id="2324424">=</span>&nbsp;<span class="keyword" id="2324426">range</span>&nbsp;<span class="ident" id="2324432">rest</span>&nbsp;<span class="op" id="2324437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2324441">switch</span>&nbsp;<span class="op" id="2324448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2324452">case</span>&nbsp;<span class="ident" id="2324457">nextIsLiteral</span><span class="op" id="2324470">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2324475">buffer</span><span class="op" id="2324481">.</span><span class="ident" id="2324482">WriteRune</span><span class="op" id="2324491">(</span><span class="ident" id="2324492">r</span><span class="op" id="2324493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2324498">nextIsLiteral</span>&nbsp;<span class="op" id="2324512">=</span>&nbsp;<span class="builtintype" id="2324514">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2324522">case</span>&nbsp;<span class="ident" id="2324527">r</span>&nbsp;<span class="op" id="2324529">==</span>&nbsp;<span class="ident" id="2324532">leadQuote</span><span class="op" id="2324541">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2324546">return</span>&nbsp;<span class="ident" id="2324553">buffer</span><span class="op" id="2324559">.</span><span class="ident" id="2324560">String</span><span class="op" id="2324566">(</span><span class="op" id="2324567">)</span><span class="op" id="2324568">,</span>&nbsp;<span class="ident" id="2324570">rest</span><span class="op" id="2324574">[</span><span class="ident" id="2324575">idx</span><span class="op" id="2324578">+</span><span class="num" id="2324579">1</span><span class="op" id="2324580">:</span><span class="op" id="2324581">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2324585">case</span>&nbsp;<span class="ident" id="2324590">r</span>&nbsp;<span class="op" id="2324592">==</span>&nbsp;<span class="string" id="2324595">&#39;\\&#39;</span><span class="op" id="2324599">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2324604">nextIsLiteral</span>&nbsp;<span class="op" id="2324618">=</span>&nbsp;<span class="builtintype" id="2324620">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2324627">case</span>&nbsp;<span class="ident" id="2324632">r</span>&nbsp;<span class="op" id="2324634">!=</span>&nbsp;<span class="string" id="2324637">&#39;\r&#39;</span>&nbsp;<span class="op" id="2324642">&amp;&amp;</span>&nbsp;<span class="ident" id="2324645">r</span>&nbsp;<span class="op" id="2324647">!=</span>&nbsp;<span class="string" id="2324650">&#39;\n&#39;</span><span class="op" id="2324654">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2324659">buffer</span><span class="op" id="2324665">.</span><span class="ident" id="2324666">WriteRune</span><span class="op" id="2324675">(</span><span class="ident" id="2324676">r</span><span class="op" id="2324677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2324681">default</span><span class="op" id="2324688">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2324693">return</span>&nbsp;<span class="string" id="2324700">&#34;&#34;</span><span class="op" id="2324702">,</span>&nbsp;<span class="ident" id="2324704">v</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2324708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2324711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2324714">return</span>&nbsp;<span class="string" id="2324721">&#34;&#34;</span><span class="op" id="2324723">,</span>&nbsp;<span class="ident" id="2324725">v</span><br>
<span class="lineno"></span><span class="op" id="2324727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="2324730">func</span>&nbsp;<span class="ident" id="2324735">consumeMediaParam</span><span class="op" id="2324752">(</span><span class="ident" id="2324753">v</span>&nbsp;<span class="builtintype" id="2324755">string</span><span class="op" id="2324761">)</span>&nbsp;<span class="op" id="2324763">(</span><span class="ident" id="2324764">param</span><span class="op" id="2324769">,</span>&nbsp;<span class="ident" id="2324771">value</span><span class="op" id="2324776">,</span>&nbsp;<span class="ident" id="2324778">rest</span>&nbsp;<span class="builtintype" id="2324783">string</span><span class="op" id="2324789">)</span>&nbsp;<span class="op" id="2324791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2324794">rest</span>&nbsp;<span class="op" id="2324799">=</span>&nbsp;<span class="ident" id="2324801">strings</span><span class="op" id="2324808">.</span><span class="ident" id="2324809">TrimLeftFunc</span><span class="op" id="2324821">(</span><span class="ident" id="2324822">v</span><span class="op" id="2324823">,</span>&nbsp;<span class="ident" id="2324825">unicode</span><span class="op" id="2324832">.</span><span class="ident" id="2324833">IsSpace</span><span class="op" id="2324840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2324843">if</span>&nbsp;<span class="op" id="2324846">!</span><span class="ident" id="2324847">strings</span><span class="op" id="2324854">.</span><span class="ident" id="2324855">HasPrefix</span><span class="op" id="2324864">(</span><span class="ident" id="2324865">rest</span><span class="op" id="2324869">,</span>&nbsp;<span class="string" id="2324871">&#34;;&#34;</span><span class="op" id="2324874">)</span>&nbsp;<span class="op" id="2324876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2324880">return</span>&nbsp;<span class="string" id="2324887">&#34;&#34;</span><span class="op" id="2324889">,</span>&nbsp;<span class="string" id="2324891">&#34;&#34;</span><span class="op" id="2324893">,</span>&nbsp;<span class="ident" id="2324895">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2324898">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2324902">rest</span>&nbsp;<span class="op" id="2324907">=</span>&nbsp;<span class="ident" id="2324909">rest</span><span class="op" id="2324913">[</span><span class="num" id="2324914">1</span><span class="op" id="2324915">:</span><span class="op" id="2324916">]</span>&nbsp;<span class="comment" id="2324918">//&nbsp;consume&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2324940">rest</span>&nbsp;<span class="op" id="2324945">=</span>&nbsp;<span class="ident" id="2324947">strings</span><span class="op" id="2324954">.</span><span class="ident" id="2324955">TrimLeftFunc</span><span class="op" id="2324967">(</span><span class="ident" id="2324968">rest</span><span class="op" id="2324972">,</span>&nbsp;<span class="ident" id="2324974">unicode</span><span class="op" id="2324981">.</span><span class="ident" id="2324982">IsSpace</span><span class="op" id="2324989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2324992">param</span><span class="op" id="2324997">,</span>&nbsp;<span class="ident" id="2324999">rest</span>&nbsp;<span class="op" id="2325004">=</span>&nbsp;<span class="ident" id="2325006">consumeToken</span><span class="op" id="2325018">(</span><span class="ident" id="2325019">rest</span><span class="op" id="2325023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2325026">param</span>&nbsp;<span class="op" id="2325032">=</span>&nbsp;<span class="ident" id="2325034">strings</span><span class="op" id="2325041">.</span><span class="ident" id="2325042">ToLower</span><span class="op" id="2325049">(</span><span class="ident" id="2325050">param</span><span class="op" id="2325055">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2325058">if</span>&nbsp;<span class="ident" id="2325061">param</span>&nbsp;<span class="op" id="2325067">==</span>&nbsp;<span class="string" id="2325070">&#34;&#34;</span>&nbsp;<span class="op" id="2325073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2325077">return</span>&nbsp;<span class="string" id="2325084">&#34;&#34;</span><span class="op" id="2325086">,</span>&nbsp;<span class="string" id="2325088">&#34;&#34;</span><span class="op" id="2325090">,</span>&nbsp;<span class="ident" id="2325092">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2325095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2325099">rest</span>&nbsp;<span class="op" id="2325104">=</span>&nbsp;<span class="ident" id="2325106">strings</span><span class="op" id="2325113">.</span><span class="ident" id="2325114">TrimLeftFunc</span><span class="op" id="2325126">(</span><span class="ident" id="2325127">rest</span><span class="op" id="2325131">,</span>&nbsp;<span class="ident" id="2325133">unicode</span><span class="op" id="2325140">.</span><span class="ident" id="2325141">IsSpace</span><span class="op" id="2325148">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2325151">if</span>&nbsp;<span class="op" id="2325154">!</span><span class="ident" id="2325155">strings</span><span class="op" id="2325162">.</span><span class="ident" id="2325163">HasPrefix</span><span class="op" id="2325172">(</span><span class="ident" id="2325173">rest</span><span class="op" id="2325177">,</span>&nbsp;<span class="string" id="2325179">&#34;=&#34;</span><span class="op" id="2325182">)</span>&nbsp;<span class="op" id="2325184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2325188">return</span>&nbsp;<span class="string" id="2325195">&#34;&#34;</span><span class="op" id="2325197">,</span>&nbsp;<span class="string" id="2325199">&#34;&#34;</span><span class="op" id="2325201">,</span>&nbsp;<span class="ident" id="2325203">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2325206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2325209">rest</span>&nbsp;<span class="op" id="2325214">=</span>&nbsp;<span class="ident" id="2325216">rest</span><span class="op" id="2325220">[</span><span class="num" id="2325221">1</span><span class="op" id="2325222">:</span><span class="op" id="2325223">]</span>&nbsp;<span class="comment" id="2325225">//&nbsp;consume&nbsp;equals&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2325249">rest</span>&nbsp;<span class="op" id="2325254">=</span>&nbsp;<span class="ident" id="2325256">strings</span><span class="op" id="2325263">.</span><span class="ident" id="2325264">TrimLeftFunc</span><span class="op" id="2325276">(</span><span class="ident" id="2325277">rest</span><span class="op" id="2325281">,</span>&nbsp;<span class="ident" id="2325283">unicode</span><span class="op" id="2325290">.</span><span class="ident" id="2325291">IsSpace</span><span class="op" id="2325298">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2325301">value</span><span class="op" id="2325306">,</span>&nbsp;<span class="ident" id="2325308">rest</span>&nbsp;<span class="op" id="2325313">=</span>&nbsp;<span class="ident" id="2325315">consumeValue</span><span class="op" id="2325327">(</span><span class="ident" id="2325328">rest</span><span class="op" id="2325332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2325335">if</span>&nbsp;<span class="ident" id="2325338">value</span>&nbsp;<span class="op" id="2325344">==</span>&nbsp;<span class="string" id="2325347">&#34;&#34;</span>&nbsp;<span class="op" id="2325350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2325354">return</span>&nbsp;<span class="string" id="2325361">&#34;&#34;</span><span class="op" id="2325363">,</span>&nbsp;<span class="string" id="2325365">&#34;&#34;</span><span class="op" id="2325367">,</span>&nbsp;<span class="ident" id="2325369">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2325372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2325375">return</span>&nbsp;<span class="ident" id="2325382">param</span><span class="op" id="2325387">,</span>&nbsp;<span class="ident" id="2325389">value</span><span class="op" id="2325394">,</span>&nbsp;<span class="ident" id="2325396">rest</span><br>
<span class="lineno">295</span><span class="op" id="2325401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2325404">func</span>&nbsp;<span class="ident" id="2325409">percentHexUnescape</span><span class="op" id="2325427">(</span><span class="ident" id="2325428">s</span>&nbsp;<span class="builtintype" id="2325430">string</span><span class="op" id="2325436">)</span>&nbsp;<span class="op" id="2325438">(</span><span class="builtintype" id="2325439">string</span><span class="op" id="2325445">,</span>&nbsp;<span class="builtintype" id="2325447">error</span><span class="op" id="2325452">)</span>&nbsp;<span class="op" id="2325454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2325457">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2325502">percents</span>&nbsp;<span class="op" id="2325511">:=</span>&nbsp;<span class="num" id="2325514">0</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2325517">for</span>&nbsp;<span class="ident" id="2325521">i</span>&nbsp;<span class="op" id="2325523">:=</span>&nbsp;<span class="num" id="2325526">0</span><span class="op" id="2325527">;</span>&nbsp;<span class="ident" id="2325529">i</span>&nbsp;<span class="op" id="2325531">&lt;</span>&nbsp;<span class="builtinfunc" id="2325533">len</span><span class="op" id="2325536">(</span><span class="ident" id="2325537">s</span><span class="op" id="2325538">)</span><span class="op" id="2325539">;</span>&nbsp;<span class="op" id="2325541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2325545">if</span>&nbsp;<span class="ident" id="2325548">s</span><span class="op" id="2325549">[</span><span class="ident" id="2325550">i</span><span class="op" id="2325551">]</span>&nbsp;<span class="op" id="2325553">!=</span>&nbsp;<span class="string" id="2325556">&#39;%&#39;</span>&nbsp;<span class="op" id="2325560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2325565">i</span><span class="op" id="2325566">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2325572">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2325583">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2325587">percents</span><span class="op" id="2325595">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2325600">if</span>&nbsp;<span class="ident" id="2325603">i</span><span class="op" id="2325604">+</span><span class="num" id="2325605">2</span>&nbsp;<span class="op" id="2325607">&gt;=</span>&nbsp;<span class="builtinfunc" id="2325610">len</span><span class="op" id="2325613">(</span><span class="ident" id="2325614">s</span><span class="op" id="2325615">)</span>&nbsp;<span class="op" id="2325617">||</span>&nbsp;<span class="op" id="2325620">!</span><span class="ident" id="2325621">ishex</span><span class="op" id="2325626">(</span><span class="ident" id="2325627">s</span><span class="op" id="2325628">[</span><span class="ident" id="2325629">i</span><span class="op" id="2325630">+</span><span class="num" id="2325631">1</span><span class="op" id="2325632">]</span><span class="op" id="2325633">)</span>&nbsp;<span class="op" id="2325635">||</span>&nbsp;<span class="op" id="2325638">!</span><span class="ident" id="2325639">ishex</span><span class="op" id="2325644">(</span><span class="ident" id="2325645">s</span><span class="op" id="2325646">[</span><span class="ident" id="2325647">i</span><span class="op" id="2325648">+</span><span class="num" id="2325649">2</span><span class="op" id="2325650">]</span><span class="op" id="2325651">)</span>&nbsp;<span class="op" id="2325653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2325658">s</span>&nbsp;<span class="op" id="2325660">=</span>&nbsp;<span class="ident" id="2325662">s</span><span class="op" id="2325663">[</span><span class="ident" id="2325664">i</span><span class="op" id="2325665">:</span><span class="op" id="2325666">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2325671">if</span>&nbsp;<span class="builtinfunc" id="2325674">len</span><span class="op" id="2325677">(</span><span class="ident" id="2325678">s</span><span class="op" id="2325679">)</span>&nbsp;<span class="op" id="2325681">&gt;</span>&nbsp;<span class="num" id="2325683">3</span>&nbsp;<span class="op" id="2325685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2325691">s</span>&nbsp;<span class="op" id="2325693">=</span>&nbsp;<span class="ident" id="2325695">s</span><span class="op" id="2325696">[</span><span class="num" id="2325697">0</span><span class="op" id="2325698">:</span><span class="num" id="2325699">3</span><span class="op" id="2325700">]</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2325705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2325710">return</span>&nbsp;<span class="string" id="2325717">&#34;&#34;</span><span class="op" id="2325719">,</span>&nbsp;<span class="ident" id="2325721">fmt</span><span class="op" id="2325724">.</span><span class="ident" id="2325725">Errorf</span><span class="op" id="2325731">(</span><span class="string" id="2325732">&#34;mime:&nbsp;bogus&nbsp;characters&nbsp;after&nbsp;%%:&nbsp;%q&#34;</span><span class="op" id="2325769">,</span>&nbsp;<span class="ident" id="2325771">s</span><span class="op" id="2325772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2325776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2325780">i</span>&nbsp;<span class="op" id="2325782">+=</span>&nbsp;<span class="num" id="2325785">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2325788">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2325791">if</span>&nbsp;<span class="ident" id="2325794">percents</span>&nbsp;<span class="op" id="2325803">==</span>&nbsp;<span class="num" id="2325806">0</span>&nbsp;<span class="op" id="2325808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2325812">return</span>&nbsp;<span class="ident" id="2325819">s</span><span class="op" id="2325820">,</span>&nbsp;<span class="builtintype" id="2325822">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2325827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2325831">t</span>&nbsp;<span class="op" id="2325833">:=</span>&nbsp;<span class="builtinfunc" id="2325836">make</span><span class="op" id="2325840">(</span><span class="op" id="2325841">[</span><span class="op" id="2325842">]</span><span class="builtintype" id="2325843">byte</span><span class="op" id="2325847">,</span>&nbsp;<span class="builtinfunc" id="2325849">len</span><span class="op" id="2325852">(</span><span class="ident" id="2325853">s</span><span class="op" id="2325854">)</span><span class="op" id="2325855">-</span><span class="num" id="2325856">2</span><span class="op" id="2325857">*</span><span class="ident" id="2325858">percents</span><span class="op" id="2325866">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2325869">j</span>&nbsp;<span class="op" id="2325871">:=</span>&nbsp;<span class="num" id="2325874">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2325877">for</span>&nbsp;<span class="ident" id="2325881">i</span>&nbsp;<span class="op" id="2325883">:=</span>&nbsp;<span class="num" id="2325886">0</span><span class="op" id="2325887">;</span>&nbsp;<span class="ident" id="2325889">i</span>&nbsp;<span class="op" id="2325891">&lt;</span>&nbsp;<span class="builtinfunc" id="2325893">len</span><span class="op" id="2325896">(</span><span class="ident" id="2325897">s</span><span class="op" id="2325898">)</span><span class="op" id="2325899">;</span>&nbsp;<span class="op" id="2325901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2325905">switch</span>&nbsp;<span class="ident" id="2325912">s</span><span class="op" id="2325913">[</span><span class="ident" id="2325914">i</span><span class="op" id="2325915">]</span>&nbsp;<span class="op" id="2325917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2325921">case</span>&nbsp;<span class="string" id="2325926">&#39;%&#39;</span><span class="op" id="2325929">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2325934">t</span><span class="op" id="2325935">[</span><span class="ident" id="2325936">j</span><span class="op" id="2325937">]</span>&nbsp;<span class="op" id="2325939">=</span>&nbsp;<span class="ident" id="2325941">unhex</span><span class="op" id="2325946">(</span><span class="ident" id="2325947">s</span><span class="op" id="2325948">[</span><span class="ident" id="2325949">i</span><span class="op" id="2325950">+</span><span class="num" id="2325951">1</span><span class="op" id="2325952">]</span><span class="op" id="2325953">)</span><span class="op" id="2325954">&lt;&lt;</span><span class="num" id="2325956">4</span>&nbsp;<span class="op" id="2325958">|</span>&nbsp;<span class="ident" id="2325960">unhex</span><span class="op" id="2325965">(</span><span class="ident" id="2325966">s</span><span class="op" id="2325967">[</span><span class="ident" id="2325968">i</span><span class="op" id="2325969">+</span><span class="num" id="2325970">2</span><span class="op" id="2325971">]</span><span class="op" id="2325972">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2325977">j</span><span class="op" id="2325978">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2325984">i</span>&nbsp;<span class="op" id="2325986">+=</span>&nbsp;<span class="num" id="2325989">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2325993">default</span><span class="op" id="2326000">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2326005">t</span><span class="op" id="2326006">[</span><span class="ident" id="2326007">j</span><span class="op" id="2326008">]</span>&nbsp;<span class="op" id="2326010">=</span>&nbsp;<span class="ident" id="2326012">s</span><span class="op" id="2326013">[</span><span class="ident" id="2326014">i</span><span class="op" id="2326015">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2326020">j</span><span class="op" id="2326021">++</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2326027">i</span><span class="op" id="2326028">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2326033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2326036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2326039">return</span>&nbsp;<span class="builtintype" id="2326046">string</span><span class="op" id="2326052">(</span><span class="ident" id="2326053">t</span><span class="op" id="2326054">)</span><span class="op" id="2326055">,</span>&nbsp;<span class="builtintype" id="2326057">nil</span><br>
<span class="lineno"></span><span class="op" id="2326061">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="keyword" id="2326064">func</span>&nbsp;<span class="ident" id="2326069">ishex</span><span class="op" id="2326074">(</span><span class="ident" id="2326075">c</span>&nbsp;<span class="builtintype" id="2326077">byte</span><span class="op" id="2326081">)</span>&nbsp;<span class="builtintype" id="2326083">bool</span>&nbsp;<span class="op" id="2326088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2326091">switch</span>&nbsp;<span class="op" id="2326098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2326101">case</span>&nbsp;<span class="string" id="2326106">&#39;0&#39;</span>&nbsp;<span class="op" id="2326110">&lt;=</span>&nbsp;<span class="ident" id="2326113">c</span>&nbsp;<span class="op" id="2326115">&amp;&amp;</span>&nbsp;<span class="ident" id="2326118">c</span>&nbsp;<span class="op" id="2326120">&lt;=</span>&nbsp;<span class="string" id="2326123">&#39;9&#39;</span><span class="op" id="2326126">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2326130">return</span>&nbsp;<span class="builtintype" id="2326137">true</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2326143">case</span>&nbsp;<span class="string" id="2326148">&#39;a&#39;</span>&nbsp;<span class="op" id="2326152">&lt;=</span>&nbsp;<span class="ident" id="2326155">c</span>&nbsp;<span class="op" id="2326157">&amp;&amp;</span>&nbsp;<span class="ident" id="2326160">c</span>&nbsp;<span class="op" id="2326162">&lt;=</span>&nbsp;<span class="string" id="2326165">&#39;f&#39;</span><span class="op" id="2326168">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2326172">return</span>&nbsp;<span class="builtintype" id="2326179">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2326185">case</span>&nbsp;<span class="string" id="2326190">&#39;A&#39;</span>&nbsp;<span class="op" id="2326194">&lt;=</span>&nbsp;<span class="ident" id="2326197">c</span>&nbsp;<span class="op" id="2326199">&amp;&amp;</span>&nbsp;<span class="ident" id="2326202">c</span>&nbsp;<span class="op" id="2326204">&lt;=</span>&nbsp;<span class="string" id="2326207">&#39;F&#39;</span><span class="op" id="2326210">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2326214">return</span>&nbsp;<span class="builtintype" id="2326221">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2326227">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2326230">return</span>&nbsp;<span class="builtintype" id="2326237">false</span><br>
<span class="lineno"></span><span class="op" id="2326243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2326246">func</span>&nbsp;<span class="ident" id="2326251">unhex</span><span class="op" id="2326256">(</span><span class="ident" id="2326257">c</span>&nbsp;<span class="builtintype" id="2326259">byte</span><span class="op" id="2326263">)</span>&nbsp;<span class="builtintype" id="2326265">byte</span>&nbsp;<span class="op" id="2326270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2326273">switch</span>&nbsp;<span class="op" id="2326280">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2326283">case</span>&nbsp;<span class="string" id="2326288">&#39;0&#39;</span>&nbsp;<span class="op" id="2326292">&lt;=</span>&nbsp;<span class="ident" id="2326295">c</span>&nbsp;<span class="op" id="2326297">&amp;&amp;</span>&nbsp;<span class="ident" id="2326300">c</span>&nbsp;<span class="op" id="2326302">&lt;=</span>&nbsp;<span class="string" id="2326305">&#39;9&#39;</span><span class="op" id="2326308">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2326312">return</span>&nbsp;<span class="ident" id="2326319">c</span>&nbsp;<span class="op" id="2326321">-</span>&nbsp;<span class="string" id="2326323">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2326328">case</span>&nbsp;<span class="string" id="2326333">&#39;a&#39;</span>&nbsp;<span class="op" id="2326337">&lt;=</span>&nbsp;<span class="ident" id="2326340">c</span>&nbsp;<span class="op" id="2326342">&amp;&amp;</span>&nbsp;<span class="ident" id="2326345">c</span>&nbsp;<span class="op" id="2326347">&lt;=</span>&nbsp;<span class="string" id="2326350">&#39;f&#39;</span><span class="op" id="2326353">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2326357">return</span>&nbsp;<span class="ident" id="2326364">c</span>&nbsp;<span class="op" id="2326366">-</span>&nbsp;<span class="string" id="2326368">&#39;a&#39;</span>&nbsp;<span class="op" id="2326372">+</span>&nbsp;<span class="num" id="2326374">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2326378">case</span>&nbsp;<span class="string" id="2326383">&#39;A&#39;</span>&nbsp;<span class="op" id="2326387">&lt;=</span>&nbsp;<span class="ident" id="2326390">c</span>&nbsp;<span class="op" id="2326392">&amp;&amp;</span>&nbsp;<span class="ident" id="2326395">c</span>&nbsp;<span class="op" id="2326397">&lt;=</span>&nbsp;<span class="string" id="2326400">&#39;F&#39;</span><span class="op" id="2326403">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2326407">return</span>&nbsp;<span class="ident" id="2326414">c</span>&nbsp;<span class="op" id="2326416">-</span>&nbsp;<span class="string" id="2326418">&#39;A&#39;</span>&nbsp;<span class="op" id="2326422">+</span>&nbsp;<span class="num" id="2326424">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2326428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2326431">return</span>&nbsp;<span class="num" id="2326438">0</span><br>
<span class="lineno"></span><span class="op" id="2326440">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
