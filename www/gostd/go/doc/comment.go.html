<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/doc</h2>
<ul>
<li><a href="/gostd/go/doc/comment.go.html">comment.go</a></li>
<li><a href="/gostd/go/doc/comment_test.go.html">comment_test.go</a></li>
<li><a href="/gostd/go/doc/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/doc/doc_test.go.html">doc_test.go</a></li>
<li><a href="/gostd/go/doc/example.go.html">example.go</a></li>
<li><a href="/gostd/go/doc/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/doc/exports.go.html">exports.go</a></li>
<li><a href="/gostd/go/doc/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/doc/reader.go.html">reader.go</a></li>
<li><a href="/gostd/go/doc/synopsis.go.html">synopsis.go</a></li>
<li><a href="/gostd/go/doc/synopsis_test.go.html">synopsis_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5427560">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5427615">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5427669">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5427720">//&nbsp;Godoc&nbsp;comment&nbsp;extraction&nbsp;and&nbsp;comment&nbsp;-&gt;&nbsp;HTML&nbsp;formatting.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5427781">package</span>&nbsp;<span class="ident" id="5427789">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5427794">import</span>&nbsp;<span class="op" id="5427801">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5427804">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5427810">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5427820">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5427831">&#34;text/template&#34;</span>&nbsp;<span class="comment" id="5427847">//&nbsp;for&nbsp;HTMLEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5427866">&#34;unicode&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5427877">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5427892">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5427895">var</span>&nbsp;<span class="op" id="5427899">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5427902">ldquo</span>&nbsp;<span class="op" id="5427908">=</span>&nbsp;<span class="op" id="5427910">[</span><span class="op" id="5427911">]</span><span class="builtintype" id="5427912">byte</span><span class="op" id="5427916">(</span><span class="string" id="5427917">&#34;&amp;ldquo;&#34;</span><span class="op" id="5427926">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5427929">rdquo</span>&nbsp;<span class="op" id="5427935">=</span>&nbsp;<span class="op" id="5427937">[</span><span class="op" id="5427938">]</span><span class="builtintype" id="5427939">byte</span><span class="op" id="5427943">(</span><span class="string" id="5427944">&#34;&amp;rdquo;&#34;</span><span class="op" id="5427953">)</span><br>
<span class="lineno"></span><span class="op" id="5427955">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5427958">//&nbsp;Escape&nbsp;comment&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,</span><br>
<span class="lineno"></span><span class="comment" id="5428007">//&nbsp;also&nbsp;turn&nbsp;``&nbsp;into&nbsp;&amp;ldquo;&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;.</span><br>
<span class="lineno">25</span><span class="keyword" id="5428057">func</span>&nbsp;<span class="ident" id="5428062">commentEscape</span><span class="op" id="5428075">(</span><span class="ident" id="5428076">w</span>&nbsp;<span class="ident" id="5428078">io</span><span class="op" id="5428080">.</span><span class="ident" id="5428081">Writer</span><span class="op" id="5428087">,</span>&nbsp;<span class="ident" id="5428089">text</span>&nbsp;<span class="builtintype" id="5428094">string</span><span class="op" id="5428100">,</span>&nbsp;<span class="ident" id="5428102">nice</span>&nbsp;<span class="builtintype" id="5428107">bool</span><span class="op" id="5428111">)</span>&nbsp;<span class="op" id="5428113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428116">last</span>&nbsp;<span class="op" id="5428121">:=</span>&nbsp;<span class="num" id="5428124">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428127">if</span>&nbsp;<span class="ident" id="5428130">nice</span>&nbsp;<span class="op" id="5428135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428139">for</span>&nbsp;<span class="ident" id="5428143">i</span>&nbsp;<span class="op" id="5428145">:=</span>&nbsp;<span class="num" id="5428148">0</span><span class="op" id="5428149">;</span>&nbsp;<span class="ident" id="5428151">i</span>&nbsp;<span class="op" id="5428153">&lt;</span>&nbsp;<span class="builtinfunc" id="5428155">len</span><span class="op" id="5428158">(</span><span class="ident" id="5428159">text</span><span class="op" id="5428163">)</span><span class="op" id="5428164">-</span><span class="num" id="5428165">1</span><span class="op" id="5428166">;</span>&nbsp;<span class="ident" id="5428168">i</span><span class="op" id="5428169">++</span>&nbsp;<span class="op" id="5428172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428177">ch</span>&nbsp;<span class="op" id="5428180">:=</span>&nbsp;<span class="ident" id="5428183">text</span><span class="op" id="5428187">[</span><span class="ident" id="5428188">i</span><span class="op" id="5428189">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428194">if</span>&nbsp;<span class="ident" id="5428197">ch</span>&nbsp;<span class="op" id="5428200">==</span>&nbsp;<span class="ident" id="5428203">text</span><span class="op" id="5428207">[</span><span class="ident" id="5428208">i</span><span class="op" id="5428209">+</span><span class="num" id="5428210">1</span><span class="op" id="5428211">]</span>&nbsp;<span class="op" id="5428213">&amp;&amp;</span>&nbsp;<span class="op" id="5428216">(</span><span class="ident" id="5428217">ch</span>&nbsp;<span class="op" id="5428220">==</span>&nbsp;<span class="string" id="5428223">&#39;`&#39;</span>&nbsp;<span class="op" id="5428227">||</span>&nbsp;<span class="ident" id="5428230">ch</span>&nbsp;<span class="op" id="5428233">==</span>&nbsp;<span class="string" id="5428236">&#39;\&#39;&#39;</span><span class="op" id="5428240">)</span>&nbsp;<span class="op" id="5428242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428248">template</span><span class="op" id="5428256">.</span><span class="ident" id="5428257">HTMLEscape</span><span class="op" id="5428267">(</span><span class="ident" id="5428268">w</span><span class="op" id="5428269">,</span>&nbsp;<span class="op" id="5428271">[</span><span class="op" id="5428272">]</span><span class="builtintype" id="5428273">byte</span><span class="op" id="5428277">(</span><span class="ident" id="5428278">text</span><span class="op" id="5428282">[</span><span class="ident" id="5428283">last</span><span class="op" id="5428287">:</span><span class="ident" id="5428288">i</span><span class="op" id="5428289">]</span><span class="op" id="5428290">)</span><span class="op" id="5428291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428297">last</span>&nbsp;<span class="op" id="5428302">=</span>&nbsp;<span class="ident" id="5428304">i</span>&nbsp;<span class="op" id="5428306">+</span>&nbsp;<span class="num" id="5428308">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428314">switch</span>&nbsp;<span class="ident" id="5428321">ch</span>&nbsp;<span class="op" id="5428324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428330">case</span>&nbsp;<span class="string" id="5428335">&#39;`&#39;</span><span class="op" id="5428338">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428345">w</span><span class="op" id="5428346">.</span><span class="ident" id="5428347">Write</span><span class="op" id="5428352">(</span><span class="ident" id="5428353">ldquo</span><span class="op" id="5428358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428364">case</span>&nbsp;<span class="string" id="5428369">&#39;\&#39;&#39;</span><span class="op" id="5428373">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428380">w</span><span class="op" id="5428381">.</span><span class="ident" id="5428382">Write</span><span class="op" id="5428387">(</span><span class="ident" id="5428388">rdquo</span><span class="op" id="5428393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5428399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428405">i</span><span class="op" id="5428406">++</span>&nbsp;<span class="comment" id="5428409">//&nbsp;loop&nbsp;will&nbsp;add&nbsp;one&nbsp;more</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5428438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5428442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5428445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428448">template</span><span class="op" id="5428456">.</span><span class="ident" id="5428457">HTMLEscape</span><span class="op" id="5428467">(</span><span class="ident" id="5428468">w</span><span class="op" id="5428469">,</span>&nbsp;<span class="op" id="5428471">[</span><span class="op" id="5428472">]</span><span class="builtintype" id="5428473">byte</span><span class="op" id="5428477">(</span><span class="ident" id="5428478">text</span><span class="op" id="5428482">[</span><span class="ident" id="5428483">last</span><span class="op" id="5428487">:</span><span class="op" id="5428488">]</span><span class="op" id="5428489">)</span><span class="op" id="5428490">)</span><br>
<span class="lineno"></span><span class="op" id="5428492">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="5428495">const</span>&nbsp;<span class="op" id="5428501">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5428504">//&nbsp;Regexp&nbsp;for&nbsp;Go&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428534">identRx</span>&nbsp;<span class="op" id="5428542">=</span>&nbsp;<span class="string" id="5428544">`[\pL_][\pL_0-9]*`</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5428565">//&nbsp;Regexp&nbsp;for&nbsp;URLs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428585">protocol</span>&nbsp;<span class="op" id="5428594">=</span>&nbsp;<span class="string" id="5428596">`https?|ftp|file|gopher|mailto|news|nntp|telnet|wais|prospero`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428660">hostPart</span>&nbsp;<span class="op" id="5428669">=</span>&nbsp;<span class="string" id="5428671">`[a-zA-Z0-9_@\-]+`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428691">filePart</span>&nbsp;<span class="op" id="5428700">=</span>&nbsp;<span class="string" id="5428702">`[a-zA-Z0-9_?%#~&amp;/\-+=()]+`</span>&nbsp;<span class="comment" id="5428730">//&nbsp;parentheses&nbsp;may&nbsp;not&nbsp;be&nbsp;matching;&nbsp;see&nbsp;pairedParensPrefixLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428793">urlRx</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5428802">=</span>&nbsp;<span class="string" id="5428804">`(`</span>&nbsp;<span class="op" id="5428808">+</span>&nbsp;<span class="ident" id="5428810">protocol</span>&nbsp;<span class="op" id="5428819">+</span>&nbsp;<span class="string" id="5428821">`)://`</span>&nbsp;<span class="op" id="5428828">+</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5428832">//&nbsp;http://</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428845">hostPart</span>&nbsp;<span class="op" id="5428854">+</span>&nbsp;<span class="string" id="5428856">`([.:]`</span>&nbsp;<span class="op" id="5428864">+</span>&nbsp;<span class="ident" id="5428866">hostPart</span>&nbsp;<span class="op" id="5428875">+</span>&nbsp;<span class="string" id="5428877">`)*/?`</span>&nbsp;<span class="op" id="5428884">+</span>&nbsp;<span class="comment" id="5428886">//&nbsp;//www.google.com:8080/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428914">filePart</span>&nbsp;<span class="op" id="5428923">+</span>&nbsp;<span class="string" id="5428925">`([:.,]`</span>&nbsp;<span class="op" id="5428934">+</span>&nbsp;<span class="ident" id="5428936">filePart</span>&nbsp;<span class="op" id="5428945">+</span>&nbsp;<span class="string" id="5428947">`)*`</span><br>
<span class="lineno"></span><span class="op" id="5428952">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5428955">var</span>&nbsp;<span class="ident" id="5428959">matchRx</span>&nbsp;<span class="op" id="5428967">=</span>&nbsp;<span class="ident" id="5428969">regexp</span><span class="op" id="5428975">.</span><span class="ident" id="5428976">MustCompile</span><span class="op" id="5428987">(</span><span class="string" id="5428988">`(`</span>&nbsp;<span class="op" id="5428992">+</span>&nbsp;<span class="ident" id="5428994">urlRx</span>&nbsp;<span class="op" id="5429000">+</span>&nbsp;<span class="string" id="5429002">`)|(`</span>&nbsp;<span class="op" id="5429008">+</span>&nbsp;<span class="ident" id="5429010">identRx</span>&nbsp;<span class="op" id="5429018">+</span>&nbsp;<span class="string" id="5429020">`)`</span><span class="op" id="5429023">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="5429026">var</span>&nbsp;<span class="op" id="5429030">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429033">html_a</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5429045">=</span>&nbsp;<span class="op" id="5429047">[</span><span class="op" id="5429048">]</span><span class="builtintype" id="5429049">byte</span><span class="op" id="5429053">(</span><span class="string" id="5429054">`&lt;a&nbsp;href=&#34;`</span><span class="op" id="5429065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429068">html_aq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5429080">=</span>&nbsp;<span class="op" id="5429082">[</span><span class="op" id="5429083">]</span><span class="builtintype" id="5429084">byte</span><span class="op" id="5429088">(</span><span class="string" id="5429089">`&#34;&gt;`</span><span class="op" id="5429093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429096">html_enda</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5429108">=</span>&nbsp;<span class="op" id="5429110">[</span><span class="op" id="5429111">]</span><span class="builtintype" id="5429112">byte</span><span class="op" id="5429116">(</span><span class="string" id="5429117">&#34;&lt;/a&gt;&#34;</span><span class="op" id="5429123">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429126">html_i</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5429138">=</span>&nbsp;<span class="op" id="5429140">[</span><span class="op" id="5429141">]</span><span class="builtintype" id="5429142">byte</span><span class="op" id="5429146">(</span><span class="string" id="5429147">&#34;&lt;i&gt;&#34;</span><span class="op" id="5429152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429155">html_endi</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5429167">=</span>&nbsp;<span class="op" id="5429169">[</span><span class="op" id="5429170">]</span><span class="builtintype" id="5429171">byte</span><span class="op" id="5429175">(</span><span class="string" id="5429176">&#34;&lt;/i&gt;&#34;</span><span class="op" id="5429182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429185">html_p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5429197">=</span>&nbsp;<span class="op" id="5429199">[</span><span class="op" id="5429200">]</span><span class="builtintype" id="5429201">byte</span><span class="op" id="5429205">(</span><span class="string" id="5429206">&#34;&lt;p&gt;\n&#34;</span><span class="op" id="5429213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429216">html_endp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5429228">=</span>&nbsp;<span class="op" id="5429230">[</span><span class="op" id="5429231">]</span><span class="builtintype" id="5429232">byte</span><span class="op" id="5429236">(</span><span class="string" id="5429237">&#34;&lt;/p&gt;\n&#34;</span><span class="op" id="5429245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429248">html_pre</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5429260">=</span>&nbsp;<span class="op" id="5429262">[</span><span class="op" id="5429263">]</span><span class="builtintype" id="5429264">byte</span><span class="op" id="5429268">(</span><span class="string" id="5429269">&#34;&lt;pre&gt;&#34;</span><span class="op" id="5429276">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429279">html_endpre</span>&nbsp;<span class="op" id="5429291">=</span>&nbsp;<span class="op" id="5429293">[</span><span class="op" id="5429294">]</span><span class="builtintype" id="5429295">byte</span><span class="op" id="5429299">(</span><span class="string" id="5429300">&#34;&lt;/pre&gt;\n&#34;</span><span class="op" id="5429310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429313">html_h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5429325">=</span>&nbsp;<span class="op" id="5429327">[</span><span class="op" id="5429328">]</span><span class="builtintype" id="5429329">byte</span><span class="op" id="5429333">(</span><span class="string" id="5429334">`&lt;h3&nbsp;id=&#34;`</span><span class="op" id="5429344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429347">html_hq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5429359">=</span>&nbsp;<span class="op" id="5429361">[</span><span class="op" id="5429362">]</span><span class="builtintype" id="5429363">byte</span><span class="op" id="5429367">(</span><span class="string" id="5429368">`&#34;&gt;`</span><span class="op" id="5429372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429375">html_endh</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5429387">=</span>&nbsp;<span class="op" id="5429389">[</span><span class="op" id="5429390">]</span><span class="builtintype" id="5429391">byte</span><span class="op" id="5429395">(</span><span class="string" id="5429396">&#34;&lt;/h3&gt;\n&#34;</span><span class="op" id="5429405">)</span><br>
<span class="lineno"></span><span class="op" id="5429407">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="5429410">//&nbsp;pairedParensPrefixLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;longest&nbsp;prefix&nbsp;of&nbsp;s&nbsp;containing&nbsp;paired&nbsp;parentheses.</span><br>
<span class="lineno"></span><span class="keyword" id="5429512">func</span>&nbsp;<span class="ident" id="5429517">pairedParensPrefixLen</span><span class="op" id="5429538">(</span><span class="ident" id="5429539">s</span>&nbsp;<span class="builtintype" id="5429541">string</span><span class="op" id="5429547">)</span>&nbsp;<span class="builtintype" id="5429549">int</span>&nbsp;<span class="op" id="5429553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429556">parens</span>&nbsp;<span class="op" id="5429563">:=</span>&nbsp;<span class="num" id="5429566">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429569">l</span>&nbsp;<span class="op" id="5429571">:=</span>&nbsp;<span class="builtinfunc" id="5429574">len</span><span class="op" id="5429577">(</span><span class="ident" id="5429578">s</span><span class="op" id="5429579">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429582">for</span>&nbsp;<span class="ident" id="5429586">i</span><span class="op" id="5429587">,</span>&nbsp;<span class="ident" id="5429589">ch</span>&nbsp;<span class="op" id="5429592">:=</span>&nbsp;<span class="keyword" id="5429595">range</span>&nbsp;<span class="ident" id="5429601">s</span>&nbsp;<span class="op" id="5429603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429607">switch</span>&nbsp;<span class="ident" id="5429614">ch</span>&nbsp;<span class="op" id="5429617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429621">case</span>&nbsp;<span class="string" id="5429626">&#39;(&#39;</span><span class="op" id="5429629">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429634">if</span>&nbsp;<span class="ident" id="5429637">parens</span>&nbsp;<span class="op" id="5429644">==</span>&nbsp;<span class="num" id="5429647">0</span>&nbsp;<span class="op" id="5429649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429655">l</span>&nbsp;<span class="op" id="5429657">=</span>&nbsp;<span class="ident" id="5429659">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5429664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429669">parens</span><span class="op" id="5429675">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429680">case</span>&nbsp;<span class="string" id="5429685">&#39;)&#39;</span><span class="op" id="5429688">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429693">parens</span><span class="op" id="5429699">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429705">if</span>&nbsp;<span class="ident" id="5429708">parens</span>&nbsp;<span class="op" id="5429715">==</span>&nbsp;<span class="num" id="5429718">0</span>&nbsp;<span class="op" id="5429720">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429726">l</span>&nbsp;<span class="op" id="5429728">=</span>&nbsp;<span class="builtinfunc" id="5429730">len</span><span class="op" id="5429733">(</span><span class="ident" id="5429734">s</span><span class="op" id="5429735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5429740">}</span>&nbsp;<span class="keyword" id="5429742">else</span>&nbsp;<span class="keyword" id="5429747">if</span>&nbsp;<span class="ident" id="5429750">parens</span>&nbsp;<span class="op" id="5429757">&lt;</span>&nbsp;<span class="num" id="5429759">0</span>&nbsp;<span class="op" id="5429761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429767">return</span>&nbsp;<span class="ident" id="5429774">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5429779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5429783">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5429786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429789">return</span>&nbsp;<span class="ident" id="5429796">l</span><br>
<span class="lineno"></span><span class="op" id="5429798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5429801">//&nbsp;Emphasize&nbsp;and&nbsp;escape&nbsp;a&nbsp;line&nbsp;of&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;URLs&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;</span><br>
<span class="lineno">100</span><span class="comment" id="5429881">//&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if</span><br>
<span class="lineno"></span><span class="comment" id="5429961">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="5430038">//&nbsp;into&nbsp;a&nbsp;link).&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5430118">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="5430197">//&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;link.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,&nbsp;the&nbsp;remaining&nbsp;text&#39;s</span><br>
<span class="lineno">105</span><span class="comment" id="5430276">//&nbsp;appearance&nbsp;is&nbsp;improved&nbsp;where&nbsp;it&nbsp;makes&nbsp;sense&nbsp;(e.g.,&nbsp;``&nbsp;is&nbsp;turned&nbsp;into&nbsp;&amp;ldquo;</span><br>
<span class="lineno"></span><span class="comment" id="5430356">//&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;).</span><br>
<span class="lineno"></span><span class="keyword" id="5430381">func</span>&nbsp;<span class="ident" id="5430386">emphasize</span><span class="op" id="5430395">(</span><span class="ident" id="5430396">w</span>&nbsp;<span class="ident" id="5430398">io</span><span class="op" id="5430400">.</span><span class="ident" id="5430401">Writer</span><span class="op" id="5430407">,</span>&nbsp;<span class="ident" id="5430409">line</span>&nbsp;<span class="builtintype" id="5430414">string</span><span class="op" id="5430420">,</span>&nbsp;<span class="ident" id="5430422">words</span>&nbsp;<span class="keyword" id="5430428">map</span><span class="op" id="5430431">[</span><span class="builtintype" id="5430432">string</span><span class="op" id="5430438">]</span><span class="builtintype" id="5430439">string</span><span class="op" id="5430445">,</span>&nbsp;<span class="ident" id="5430447">nice</span>&nbsp;<span class="builtintype" id="5430452">bool</span><span class="op" id="5430456">)</span>&nbsp;<span class="op" id="5430458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430461">for</span>&nbsp;<span class="op" id="5430465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430469">m</span>&nbsp;<span class="op" id="5430471">:=</span>&nbsp;<span class="ident" id="5430474">matchRx</span><span class="op" id="5430481">.</span><span class="ident" id="5430482">FindStringSubmatchIndex</span><span class="op" id="5430505">(</span><span class="ident" id="5430506">line</span><span class="op" id="5430510">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430514">if</span>&nbsp;<span class="ident" id="5430517">m</span>&nbsp;<span class="op" id="5430519">==</span>&nbsp;<span class="ident" id="5430522">nil</span>&nbsp;<span class="op" id="5430526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430531">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5430539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5430543">//&nbsp;m&nbsp;&gt;=&nbsp;6&nbsp;(two&nbsp;parenthesized&nbsp;sub-regexps&nbsp;in&nbsp;matchRx,&nbsp;1st&nbsp;one&nbsp;is&nbsp;urlRx)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5430617">//&nbsp;write&nbsp;text&nbsp;before&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430646">commentEscape</span><span class="op" id="5430659">(</span><span class="ident" id="5430660">w</span><span class="op" id="5430661">,</span>&nbsp;<span class="ident" id="5430663">line</span><span class="op" id="5430667">[</span><span class="num" id="5430668">0</span><span class="op" id="5430669">:</span><span class="ident" id="5430670">m</span><span class="op" id="5430671">[</span><span class="num" id="5430672">0</span><span class="op" id="5430673">]</span><span class="op" id="5430674">]</span><span class="op" id="5430675">,</span>&nbsp;<span class="ident" id="5430677">nice</span><span class="op" id="5430681">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5430686">//&nbsp;adjust&nbsp;match&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430717">match</span>&nbsp;<span class="op" id="5430723">:=</span>&nbsp;<span class="ident" id="5430726">line</span><span class="op" id="5430730">[</span><span class="ident" id="5430731">m</span><span class="op" id="5430732">[</span><span class="num" id="5430733">0</span><span class="op" id="5430734">]</span><span class="op" id="5430735">:</span><span class="ident" id="5430736">m</span><span class="op" id="5430737">[</span><span class="num" id="5430738">1</span><span class="op" id="5430739">]</span><span class="op" id="5430740">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430744">if</span>&nbsp;<span class="ident" id="5430747">n</span>&nbsp;<span class="op" id="5430749">:=</span>&nbsp;<span class="ident" id="5430752">pairedParensPrefixLen</span><span class="op" id="5430773">(</span><span class="ident" id="5430774">match</span><span class="op" id="5430779">)</span><span class="op" id="5430780">;</span>&nbsp;<span class="ident" id="5430782">n</span>&nbsp;<span class="op" id="5430784">&lt;</span>&nbsp;<span class="builtinfunc" id="5430786">len</span><span class="op" id="5430789">(</span><span class="ident" id="5430790">match</span><span class="op" id="5430795">)</span>&nbsp;<span class="op" id="5430797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5430802">//&nbsp;match&nbsp;contains&nbsp;unpaired&nbsp;parentheses&nbsp;(rare);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5430852">//&nbsp;redo&nbsp;matching&nbsp;with&nbsp;shortened&nbsp;line&nbsp;for&nbsp;correct&nbsp;indices</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430912">m</span>&nbsp;<span class="op" id="5430914">=</span>&nbsp;<span class="ident" id="5430916">matchRx</span><span class="op" id="5430923">.</span><span class="ident" id="5430924">FindStringSubmatchIndex</span><span class="op" id="5430947">(</span><span class="ident" id="5430948">line</span><span class="op" id="5430952">[</span><span class="op" id="5430953">:</span><span class="ident" id="5430954">m</span><span class="op" id="5430955">[</span><span class="num" id="5430956">0</span><span class="op" id="5430957">]</span><span class="op" id="5430958">+</span><span class="ident" id="5430959">n</span><span class="op" id="5430960">]</span><span class="op" id="5430961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430966">match</span>&nbsp;<span class="op" id="5430972">=</span>&nbsp;<span class="ident" id="5430974">match</span><span class="op" id="5430979">[</span><span class="op" id="5430980">:</span><span class="ident" id="5430981">n</span><span class="op" id="5430982">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5430986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5430991">//&nbsp;analyze&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431010">url</span>&nbsp;<span class="op" id="5431014">:=</span>&nbsp;<span class="string" id="5431017">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431022">italics</span>&nbsp;<span class="op" id="5431030">:=</span>&nbsp;<span class="builtintype" id="5431033">false</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431041">if</span>&nbsp;<span class="ident" id="5431044">words</span>&nbsp;<span class="op" id="5431050">!=</span>&nbsp;<span class="ident" id="5431053">nil</span>&nbsp;<span class="op" id="5431057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431062">url</span><span class="op" id="5431065">,</span>&nbsp;<span class="ident" id="5431067">italics</span>&nbsp;<span class="op" id="5431075">=</span>&nbsp;<span class="ident" id="5431077">words</span><span class="op" id="5431082">[</span><span class="ident" id="5431083">match</span><span class="op" id="5431088">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431096">if</span>&nbsp;<span class="ident" id="5431099">m</span><span class="op" id="5431100">[</span><span class="num" id="5431101">2</span><span class="op" id="5431102">]</span>&nbsp;<span class="op" id="5431104">&gt;=</span>&nbsp;<span class="num" id="5431107">0</span>&nbsp;<span class="op" id="5431109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5431114">//&nbsp;match&nbsp;against&nbsp;first&nbsp;parenthesized&nbsp;sub-regexp;&nbsp;must&nbsp;be&nbsp;match&nbsp;against&nbsp;urlRx</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431194">if</span>&nbsp;<span class="op" id="5431197">!</span><span class="ident" id="5431198">italics</span>&nbsp;<span class="op" id="5431206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5431212">//&nbsp;no&nbsp;alternative&nbsp;URL&nbsp;in&nbsp;words&nbsp;list,&nbsp;use&nbsp;match&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431271">url</span>&nbsp;<span class="op" id="5431275">=</span>&nbsp;<span class="ident" id="5431277">match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431291">italics</span>&nbsp;<span class="op" id="5431299">=</span>&nbsp;<span class="builtintype" id="5431301">false</span>&nbsp;<span class="comment" id="5431307">//&nbsp;don&#39;t&nbsp;italicize&nbsp;URLs</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5431338">//&nbsp;write&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431355">if</span>&nbsp;<span class="builtinfunc" id="5431358">len</span><span class="op" id="5431361">(</span><span class="ident" id="5431362">url</span><span class="op" id="5431365">)</span>&nbsp;<span class="op" id="5431367">&gt;</span>&nbsp;<span class="num" id="5431369">0</span>&nbsp;<span class="op" id="5431371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431376">w</span><span class="op" id="5431377">.</span><span class="ident" id="5431378">Write</span><span class="op" id="5431383">(</span><span class="ident" id="5431384">html_a</span><span class="op" id="5431390">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431395">template</span><span class="op" id="5431403">.</span><span class="ident" id="5431404">HTMLEscape</span><span class="op" id="5431414">(</span><span class="ident" id="5431415">w</span><span class="op" id="5431416">,</span>&nbsp;<span class="op" id="5431418">[</span><span class="op" id="5431419">]</span><span class="builtintype" id="5431420">byte</span><span class="op" id="5431424">(</span><span class="ident" id="5431425">url</span><span class="op" id="5431428">)</span><span class="op" id="5431429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431434">w</span><span class="op" id="5431435">.</span><span class="ident" id="5431436">Write</span><span class="op" id="5431441">(</span><span class="ident" id="5431442">html_aq</span><span class="op" id="5431449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431457">if</span>&nbsp;<span class="ident" id="5431460">italics</span>&nbsp;<span class="op" id="5431468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431473">w</span><span class="op" id="5431474">.</span><span class="ident" id="5431475">Write</span><span class="op" id="5431480">(</span><span class="ident" id="5431481">html_i</span><span class="op" id="5431487">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431495">commentEscape</span><span class="op" id="5431508">(</span><span class="ident" id="5431509">w</span><span class="op" id="5431510">,</span>&nbsp;<span class="ident" id="5431512">match</span><span class="op" id="5431517">,</span>&nbsp;<span class="ident" id="5431519">nice</span><span class="op" id="5431523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431527">if</span>&nbsp;<span class="ident" id="5431530">italics</span>&nbsp;<span class="op" id="5431538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431543">w</span><span class="op" id="5431544">.</span><span class="ident" id="5431545">Write</span><span class="op" id="5431550">(</span><span class="ident" id="5431551">html_endi</span><span class="op" id="5431560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431564">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431568">if</span>&nbsp;<span class="builtinfunc" id="5431571">len</span><span class="op" id="5431574">(</span><span class="ident" id="5431575">url</span><span class="op" id="5431578">)</span>&nbsp;<span class="op" id="5431580">&gt;</span>&nbsp;<span class="num" id="5431582">0</span>&nbsp;<span class="op" id="5431584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431589">w</span><span class="op" id="5431590">.</span><span class="ident" id="5431591">Write</span><span class="op" id="5431596">(</span><span class="ident" id="5431597">html_enda</span><span class="op" id="5431606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5431615">//&nbsp;advance</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431628">line</span>&nbsp;<span class="op" id="5431633">=</span>&nbsp;<span class="ident" id="5431635">line</span><span class="op" id="5431639">[</span><span class="ident" id="5431640">m</span><span class="op" id="5431641">[</span><span class="num" id="5431642">1</span><span class="op" id="5431643">]</span><span class="op" id="5431644">:</span><span class="op" id="5431645">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431651">commentEscape</span><span class="op" id="5431664">(</span><span class="ident" id="5431665">w</span><span class="op" id="5431666">,</span>&nbsp;<span class="ident" id="5431668">line</span><span class="op" id="5431672">,</span>&nbsp;<span class="ident" id="5431674">nice</span><span class="op" id="5431678">)</span><br>
<span class="lineno"></span><span class="op" id="5431680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="5431683">func</span>&nbsp;<span class="ident" id="5431688">indentLen</span><span class="op" id="5431697">(</span><span class="ident" id="5431698">s</span>&nbsp;<span class="builtintype" id="5431700">string</span><span class="op" id="5431706">)</span>&nbsp;<span class="builtintype" id="5431708">int</span>&nbsp;<span class="op" id="5431712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431715">i</span>&nbsp;<span class="op" id="5431717">:=</span>&nbsp;<span class="num" id="5431720">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431723">for</span>&nbsp;<span class="ident" id="5431727">i</span>&nbsp;<span class="op" id="5431729">&lt;</span>&nbsp;<span class="builtinfunc" id="5431731">len</span><span class="op" id="5431734">(</span><span class="ident" id="5431735">s</span><span class="op" id="5431736">)</span>&nbsp;<span class="op" id="5431738">&amp;&amp;</span>&nbsp;<span class="op" id="5431741">(</span><span class="ident" id="5431742">s</span><span class="op" id="5431743">[</span><span class="ident" id="5431744">i</span><span class="op" id="5431745">]</span>&nbsp;<span class="op" id="5431747">==</span>&nbsp;<span class="string" id="5431750">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5431754">||</span>&nbsp;<span class="ident" id="5431757">s</span><span class="op" id="5431758">[</span><span class="ident" id="5431759">i</span><span class="op" id="5431760">]</span>&nbsp;<span class="op" id="5431762">==</span>&nbsp;<span class="string" id="5431765">&#39;\t&#39;</span><span class="op" id="5431769">)</span>&nbsp;<span class="op" id="5431771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431775">i</span><span class="op" id="5431776">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431780">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431783">return</span>&nbsp;<span class="ident" id="5431790">i</span><br>
<span class="lineno"></span><span class="op" id="5431792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5431795">func</span>&nbsp;<span class="ident" id="5431800">isBlank</span><span class="op" id="5431807">(</span><span class="ident" id="5431808">s</span>&nbsp;<span class="builtintype" id="5431810">string</span><span class="op" id="5431816">)</span>&nbsp;<span class="builtintype" id="5431818">bool</span>&nbsp;<span class="op" id="5431823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431826">return</span>&nbsp;<span class="builtinfunc" id="5431833">len</span><span class="op" id="5431836">(</span><span class="ident" id="5431837">s</span><span class="op" id="5431838">)</span>&nbsp;<span class="op" id="5431840">==</span>&nbsp;<span class="num" id="5431843">0</span>&nbsp;<span class="op" id="5431845">||</span>&nbsp;<span class="op" id="5431848">(</span><span class="builtinfunc" id="5431849">len</span><span class="op" id="5431852">(</span><span class="ident" id="5431853">s</span><span class="op" id="5431854">)</span>&nbsp;<span class="op" id="5431856">==</span>&nbsp;<span class="num" id="5431859">1</span>&nbsp;<span class="op" id="5431861">&amp;&amp;</span>&nbsp;<span class="ident" id="5431864">s</span><span class="op" id="5431865">[</span><span class="num" id="5431866">0</span><span class="op" id="5431867">]</span>&nbsp;<span class="op" id="5431869">==</span>&nbsp;<span class="string" id="5431872">&#39;\n&#39;</span><span class="op" id="5431876">)</span><br>
<span class="lineno">175</span><span class="op" id="5431878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5431881">func</span>&nbsp;<span class="ident" id="5431886">commonPrefix</span><span class="op" id="5431898">(</span><span class="ident" id="5431899">a</span><span class="op" id="5431900">,</span>&nbsp;<span class="ident" id="5431902">b</span>&nbsp;<span class="builtintype" id="5431904">string</span><span class="op" id="5431910">)</span>&nbsp;<span class="builtintype" id="5431912">string</span>&nbsp;<span class="op" id="5431919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431922">i</span>&nbsp;<span class="op" id="5431924">:=</span>&nbsp;<span class="num" id="5431927">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431930">for</span>&nbsp;<span class="ident" id="5431934">i</span>&nbsp;<span class="op" id="5431936">&lt;</span>&nbsp;<span class="builtinfunc" id="5431938">len</span><span class="op" id="5431941">(</span><span class="ident" id="5431942">a</span><span class="op" id="5431943">)</span>&nbsp;<span class="op" id="5431945">&amp;&amp;</span>&nbsp;<span class="ident" id="5431948">i</span>&nbsp;<span class="op" id="5431950">&lt;</span>&nbsp;<span class="builtinfunc" id="5431952">len</span><span class="op" id="5431955">(</span><span class="ident" id="5431956">b</span><span class="op" id="5431957">)</span>&nbsp;<span class="op" id="5431959">&amp;&amp;</span>&nbsp;<span class="ident" id="5431962">a</span><span class="op" id="5431963">[</span><span class="ident" id="5431964">i</span><span class="op" id="5431965">]</span>&nbsp;<span class="op" id="5431967">==</span>&nbsp;<span class="ident" id="5431970">b</span><span class="op" id="5431971">[</span><span class="ident" id="5431972">i</span><span class="op" id="5431973">]</span>&nbsp;<span class="op" id="5431975">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431979">i</span><span class="op" id="5431980">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431987">return</span>&nbsp;<span class="ident" id="5431994">a</span><span class="op" id="5431995">[</span><span class="num" id="5431996">0</span><span class="op" id="5431997">:</span><span class="ident" id="5431998">i</span><span class="op" id="5431999">]</span><br>
<span class="lineno"></span><span class="op" id="5432001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="5432004">func</span>&nbsp;<span class="ident" id="5432009">unindent</span><span class="op" id="5432017">(</span><span class="ident" id="5432018">block</span>&nbsp;<span class="op" id="5432024">[</span><span class="op" id="5432025">]</span><span class="builtintype" id="5432026">string</span><span class="op" id="5432032">)</span>&nbsp;<span class="op" id="5432034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432037">if</span>&nbsp;<span class="builtinfunc" id="5432040">len</span><span class="op" id="5432043">(</span><span class="ident" id="5432044">block</span><span class="op" id="5432049">)</span>&nbsp;<span class="op" id="5432051">==</span>&nbsp;<span class="num" id="5432054">0</span>&nbsp;<span class="op" id="5432056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432060">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5432068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5432072">//&nbsp;compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5432112">prefix</span>&nbsp;<span class="op" id="5432119">:=</span>&nbsp;<span class="ident" id="5432122">block</span><span class="op" id="5432127">[</span><span class="num" id="5432128">0</span><span class="op" id="5432129">]</span><span class="op" id="5432130">[</span><span class="num" id="5432131">0</span><span class="op" id="5432132">:</span><span class="ident" id="5432133">indentLen</span><span class="op" id="5432142">(</span><span class="ident" id="5432143">block</span><span class="op" id="5432148">[</span><span class="num" id="5432149">0</span><span class="op" id="5432150">]</span><span class="op" id="5432151">)</span><span class="op" id="5432152">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432155">for</span>&nbsp;<span class="ident" id="5432159">_</span><span class="op" id="5432160">,</span>&nbsp;<span class="ident" id="5432162">line</span>&nbsp;<span class="op" id="5432167">:=</span>&nbsp;<span class="keyword" id="5432170">range</span>&nbsp;<span class="ident" id="5432176">block</span>&nbsp;<span class="op" id="5432182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432186">if</span>&nbsp;<span class="op" id="5432189">!</span><span class="ident" id="5432190">isBlank</span><span class="op" id="5432197">(</span><span class="ident" id="5432198">line</span><span class="op" id="5432202">)</span>&nbsp;<span class="op" id="5432204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5432209">prefix</span>&nbsp;<span class="op" id="5432216">=</span>&nbsp;<span class="ident" id="5432218">commonPrefix</span><span class="op" id="5432230">(</span><span class="ident" id="5432231">prefix</span><span class="op" id="5432237">,</span>&nbsp;<span class="ident" id="5432239">line</span><span class="op" id="5432243">[</span><span class="num" id="5432244">0</span><span class="op" id="5432245">:</span><span class="ident" id="5432246">indentLen</span><span class="op" id="5432255">(</span><span class="ident" id="5432256">line</span><span class="op" id="5432260">)</span><span class="op" id="5432261">]</span><span class="op" id="5432262">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5432266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5432269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5432272">n</span>&nbsp;<span class="op" id="5432274">:=</span>&nbsp;<span class="builtinfunc" id="5432277">len</span><span class="op" id="5432280">(</span><span class="ident" id="5432281">prefix</span><span class="op" id="5432287">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5432291">//&nbsp;remove</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432302">for</span>&nbsp;<span class="ident" id="5432306">i</span><span class="op" id="5432307">,</span>&nbsp;<span class="ident" id="5432309">line</span>&nbsp;<span class="op" id="5432314">:=</span>&nbsp;<span class="keyword" id="5432317">range</span>&nbsp;<span class="ident" id="5432323">block</span>&nbsp;<span class="op" id="5432329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432333">if</span>&nbsp;<span class="op" id="5432336">!</span><span class="ident" id="5432337">isBlank</span><span class="op" id="5432344">(</span><span class="ident" id="5432345">line</span><span class="op" id="5432349">)</span>&nbsp;<span class="op" id="5432351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5432356">block</span><span class="op" id="5432361">[</span><span class="ident" id="5432362">i</span><span class="op" id="5432363">]</span>&nbsp;<span class="op" id="5432365">=</span>&nbsp;<span class="ident" id="5432367">line</span><span class="op" id="5432371">[</span><span class="ident" id="5432372">n</span><span class="op" id="5432373">:</span><span class="op" id="5432374">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5432378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5432381">}</span><br>
<span class="lineno">205</span><span class="op" id="5432383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5432386">//&nbsp;heading&nbsp;returns&nbsp;the&nbsp;trimmed&nbsp;line&nbsp;if&nbsp;it&nbsp;passes&nbsp;as&nbsp;a&nbsp;section&nbsp;heading;</span><br>
<span class="lineno"></span><span class="comment" id="5432457">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5432499">func</span>&nbsp;<span class="ident" id="5432504">heading</span><span class="op" id="5432511">(</span><span class="ident" id="5432512">line</span>&nbsp;<span class="builtintype" id="5432517">string</span><span class="op" id="5432523">)</span>&nbsp;<span class="builtintype" id="5432525">string</span>&nbsp;<span class="op" id="5432532">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5432535">line</span>&nbsp;<span class="op" id="5432540">=</span>&nbsp;<span class="ident" id="5432542">strings</span><span class="op" id="5432549">.</span><span class="ident" id="5432550">TrimSpace</span><span class="op" id="5432559">(</span><span class="ident" id="5432560">line</span><span class="op" id="5432564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432567">if</span>&nbsp;<span class="builtinfunc" id="5432570">len</span><span class="op" id="5432573">(</span><span class="ident" id="5432574">line</span><span class="op" id="5432578">)</span>&nbsp;<span class="op" id="5432580">==</span>&nbsp;<span class="num" id="5432583">0</span>&nbsp;<span class="op" id="5432585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432589">return</span>&nbsp;<span class="string" id="5432596">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5432600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5432604">//&nbsp;a&nbsp;heading&nbsp;must&nbsp;start&nbsp;with&nbsp;an&nbsp;uppercase&nbsp;letter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5432654">r</span><span class="op" id="5432655">,</span>&nbsp;<span class="ident" id="5432657">_</span>&nbsp;<span class="op" id="5432659">:=</span>&nbsp;<span class="ident" id="5432662">utf8</span><span class="op" id="5432666">.</span><span class="ident" id="5432667">DecodeRuneInString</span><span class="op" id="5432685">(</span><span class="ident" id="5432686">line</span><span class="op" id="5432690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432693">if</span>&nbsp;<span class="op" id="5432696">!</span><span class="ident" id="5432697">unicode</span><span class="op" id="5432704">.</span><span class="ident" id="5432705">IsLetter</span><span class="op" id="5432713">(</span><span class="ident" id="5432714">r</span><span class="op" id="5432715">)</span>&nbsp;<span class="op" id="5432717">||</span>&nbsp;<span class="op" id="5432720">!</span><span class="ident" id="5432721">unicode</span><span class="op" id="5432728">.</span><span class="ident" id="5432729">IsUpper</span><span class="op" id="5432736">(</span><span class="ident" id="5432737">r</span><span class="op" id="5432738">)</span>&nbsp;<span class="op" id="5432740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432744">return</span>&nbsp;<span class="string" id="5432751">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5432755">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5432759">//&nbsp;it&nbsp;must&nbsp;end&nbsp;in&nbsp;a&nbsp;letter&nbsp;or&nbsp;digit:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5432797">r</span><span class="op" id="5432798">,</span>&nbsp;<span class="ident" id="5432800">_</span>&nbsp;<span class="op" id="5432802">=</span>&nbsp;<span class="ident" id="5432804">utf8</span><span class="op" id="5432808">.</span><span class="ident" id="5432809">DecodeLastRuneInString</span><span class="op" id="5432831">(</span><span class="ident" id="5432832">line</span><span class="op" id="5432836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432839">if</span>&nbsp;<span class="op" id="5432842">!</span><span class="ident" id="5432843">unicode</span><span class="op" id="5432850">.</span><span class="ident" id="5432851">IsLetter</span><span class="op" id="5432859">(</span><span class="ident" id="5432860">r</span><span class="op" id="5432861">)</span>&nbsp;<span class="op" id="5432863">&amp;&amp;</span>&nbsp;<span class="op" id="5432866">!</span><span class="ident" id="5432867">unicode</span><span class="op" id="5432874">.</span><span class="ident" id="5432875">IsDigit</span><span class="op" id="5432882">(</span><span class="ident" id="5432883">r</span><span class="op" id="5432884">)</span>&nbsp;<span class="op" id="5432886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432890">return</span>&nbsp;<span class="string" id="5432897">&#34;&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5432901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5432905">//&nbsp;exclude&nbsp;lines&nbsp;with&nbsp;illegal&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5432947">if</span>&nbsp;<span class="ident" id="5432950">strings</span><span class="op" id="5432957">.</span><span class="ident" id="5432958">IndexAny</span><span class="op" id="5432966">(</span><span class="ident" id="5432967">line</span><span class="op" id="5432971">,</span>&nbsp;<span class="string" id="5432973">&#34;,.;:!?+*/=()[]{}_^°&amp;§~%#@&lt;\&#34;&gt;\\&#34;</span><span class="op" id="5433008">)</span>&nbsp;<span class="op" id="5433010">&gt;=</span>&nbsp;<span class="num" id="5433013">0</span>&nbsp;<span class="op" id="5433015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433019">return</span>&nbsp;<span class="string" id="5433026">&#34;&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5433034">//&nbsp;allow&nbsp;&#34;&#39;&#34;&nbsp;for&nbsp;possessive&nbsp;&#34;&#39;s&#34;&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433073">for</span>&nbsp;<span class="ident" id="5433077">b</span>&nbsp;<span class="op" id="5433079">:=</span>&nbsp;<span class="ident" id="5433082">line</span><span class="op" id="5433086">;</span>&nbsp;<span class="op" id="5433088">;</span>&nbsp;<span class="op" id="5433090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433094">i</span>&nbsp;<span class="op" id="5433096">:=</span>&nbsp;<span class="ident" id="5433099">strings</span><span class="op" id="5433106">.</span><span class="ident" id="5433107">IndexRune</span><span class="op" id="5433116">(</span><span class="ident" id="5433117">b</span><span class="op" id="5433118">,</span>&nbsp;<span class="string" id="5433120">&#39;\&#39;&#39;</span><span class="op" id="5433124">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433128">if</span>&nbsp;<span class="ident" id="5433131">i</span>&nbsp;<span class="op" id="5433133">&lt;</span>&nbsp;<span class="num" id="5433135">0</span>&nbsp;<span class="op" id="5433137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433142">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433154">if</span>&nbsp;<span class="ident" id="5433157">i</span><span class="op" id="5433158">+</span><span class="num" id="5433159">1</span>&nbsp;<span class="op" id="5433161">&gt;=</span>&nbsp;<span class="builtinfunc" id="5433164">len</span><span class="op" id="5433167">(</span><span class="ident" id="5433168">b</span><span class="op" id="5433169">)</span>&nbsp;<span class="op" id="5433171">||</span>&nbsp;<span class="ident" id="5433174">b</span><span class="op" id="5433175">[</span><span class="ident" id="5433176">i</span><span class="op" id="5433177">+</span><span class="num" id="5433178">1</span><span class="op" id="5433179">]</span>&nbsp;<span class="op" id="5433181">!=</span>&nbsp;<span class="string" id="5433184">&#39;s&#39;</span>&nbsp;<span class="op" id="5433188">||</span>&nbsp;<span class="op" id="5433191">(</span><span class="ident" id="5433192">i</span><span class="op" id="5433193">+</span><span class="num" id="5433194">2</span>&nbsp;<span class="op" id="5433196">&lt;</span>&nbsp;<span class="builtinfunc" id="5433198">len</span><span class="op" id="5433201">(</span><span class="ident" id="5433202">b</span><span class="op" id="5433203">)</span>&nbsp;<span class="op" id="5433205">&amp;&amp;</span>&nbsp;<span class="ident" id="5433208">b</span><span class="op" id="5433209">[</span><span class="ident" id="5433210">i</span><span class="op" id="5433211">+</span><span class="num" id="5433212">2</span><span class="op" id="5433213">]</span>&nbsp;<span class="op" id="5433215">!=</span>&nbsp;<span class="string" id="5433218">&#39;&nbsp;&#39;</span><span class="op" id="5433221">)</span>&nbsp;<span class="op" id="5433223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433228">return</span>&nbsp;<span class="string" id="5433235">&#34;&#34;</span>&nbsp;<span class="comment" id="5433238">//&nbsp;not&nbsp;followed&nbsp;by&nbsp;&#34;s&nbsp;&#34;</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433268">b</span>&nbsp;<span class="op" id="5433270">=</span>&nbsp;<span class="ident" id="5433272">b</span><span class="op" id="5433273">[</span><span class="ident" id="5433274">i</span><span class="op" id="5433275">+</span><span class="num" id="5433276">2</span><span class="op" id="5433277">:</span><span class="op" id="5433278">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433285">return</span>&nbsp;<span class="ident" id="5433292">line</span><br>
<span class="lineno">245</span><span class="op" id="5433297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5433300">type</span>&nbsp;<span class="ident" id="5433305">op</span>&nbsp;<span class="builtintype" id="5433308">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5433313">const</span>&nbsp;<span class="op" id="5433319">(</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433322">opPara</span>&nbsp;<span class="ident" id="5433329">op</span>&nbsp;<span class="op" id="5433332">=</span>&nbsp;<span class="ident" id="5433334">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433340">opHead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433348">opPre</span><br>
<span class="lineno"></span><span class="op" id="5433354">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="5433357">type</span>&nbsp;<span class="ident" id="5433362">block</span>&nbsp;<span class="keyword" id="5433368">struct</span>&nbsp;<span class="op" id="5433375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433378">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433384">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433388">lines</span>&nbsp;<span class="op" id="5433394">[</span><span class="op" id="5433395">]</span><span class="builtintype" id="5433396">string</span><br>
<span class="lineno"></span><span class="op" id="5433403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="5433406">var</span>&nbsp;<span class="ident" id="5433410">nonAlphaNumRx</span>&nbsp;<span class="op" id="5433424">=</span>&nbsp;<span class="ident" id="5433426">regexp</span><span class="op" id="5433432">.</span><span class="ident" id="5433433">MustCompile</span><span class="op" id="5433444">(</span><span class="string" id="5433445">`[^a-zA-Z0-9]`</span><span class="op" id="5433459">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5433462">func</span>&nbsp;<span class="ident" id="5433467">anchorID</span><span class="op" id="5433475">(</span><span class="ident" id="5433476">line</span>&nbsp;<span class="builtintype" id="5433481">string</span><span class="op" id="5433487">)</span>&nbsp;<span class="builtintype" id="5433489">string</span>&nbsp;<span class="op" id="5433496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5433499">//&nbsp;Add&nbsp;a&nbsp;&#34;hdr-&#34;&nbsp;prefix&nbsp;to&nbsp;avoid&nbsp;conflicting&nbsp;with&nbsp;IDs&nbsp;used&nbsp;for&nbsp;package&nbsp;symbols.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433579">return</span>&nbsp;<span class="string" id="5433586">&#34;hdr-&#34;</span>&nbsp;<span class="op" id="5433593">+</span>&nbsp;<span class="ident" id="5433595">nonAlphaNumRx</span><span class="op" id="5433608">.</span><span class="ident" id="5433609">ReplaceAllString</span><span class="op" id="5433625">(</span><span class="ident" id="5433626">line</span><span class="op" id="5433630">,</span>&nbsp;<span class="string" id="5433632">&#34;_&#34;</span><span class="op" id="5433635">)</span><br>
<span class="lineno">265</span><span class="op" id="5433637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5433640">//&nbsp;ToHTML&nbsp;converts&nbsp;comment&nbsp;text&nbsp;to&nbsp;formatted&nbsp;HTML.</span><br>
<span class="lineno"></span><span class="comment" id="5433691">//&nbsp;The&nbsp;comment&nbsp;was&nbsp;prepared&nbsp;by&nbsp;DocReader,</span><br>
<span class="lineno"></span><span class="comment" id="5433733">//&nbsp;so&nbsp;it&nbsp;is&nbsp;known&nbsp;not&nbsp;to&nbsp;have&nbsp;leading,&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">270</span><span class="comment" id="5433793">//&nbsp;nor&nbsp;to&nbsp;have&nbsp;trailing&nbsp;spaces&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;lines.</span><br>
<span class="lineno"></span><span class="comment" id="5433845">//&nbsp;The&nbsp;comment&nbsp;markers&nbsp;have&nbsp;already&nbsp;been&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="5433895">//</span><br>
<span class="lineno"></span><span class="comment" id="5433898">//&nbsp;Each&nbsp;span&nbsp;of&nbsp;unindented&nbsp;non-blank&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="5433959">//&nbsp;a&nbsp;single&nbsp;paragraph.&nbsp;There&nbsp;is&nbsp;one&nbsp;exception&nbsp;to&nbsp;the&nbsp;rule:&nbsp;a&nbsp;span&nbsp;that</span><br>
<span class="lineno">275</span><span class="comment" id="5434030">//&nbsp;consists&nbsp;of&nbsp;a&nbsp;single&nbsp;line,&nbsp;is&nbsp;followed&nbsp;by&nbsp;another&nbsp;paragraph&nbsp;span,</span><br>
<span class="lineno"></span><span class="comment" id="5434099">//&nbsp;begins&nbsp;with&nbsp;a&nbsp;capital&nbsp;letter,&nbsp;and&nbsp;contains&nbsp;no&nbsp;punctuation</span><br>
<span class="lineno"></span><span class="comment" id="5434160">//&nbsp;is&nbsp;formatted&nbsp;as&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span><span class="comment" id="5434190">//</span><br>
<span class="lineno"></span><span class="comment" id="5434193">//&nbsp;A&nbsp;span&nbsp;of&nbsp;indented&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;&lt;pre&gt;&nbsp;block,</span><br>
<span class="lineno">280</span><span class="comment" id="5434254">//&nbsp;with&nbsp;the&nbsp;common&nbsp;indent&nbsp;prefix&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="5434296">//</span><br>
<span class="lineno"></span><span class="comment" id="5434299">//&nbsp;URLs&nbsp;in&nbsp;the&nbsp;comment&nbsp;text&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears</span><br>
<span class="lineno"></span><span class="comment" id="5434377">//&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if&nbsp;the&nbsp;corresponding&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="5434455">//&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted&nbsp;into&nbsp;a&nbsp;link).</span><br>
<span class="lineno">285</span><span class="comment" id="5434524">//</span><br>
<span class="lineno"></span><span class="comment" id="5434527">//&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="5434611">//&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="5434698">//&nbsp;into&nbsp;a&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="5434714">func</span>&nbsp;<span class="ident" id="5434719">ToHTML</span><span class="op" id="5434725">(</span><span class="ident" id="5434726">w</span>&nbsp;<span class="ident" id="5434728">io</span><span class="op" id="5434730">.</span><span class="ident" id="5434731">Writer</span><span class="op" id="5434737">,</span>&nbsp;<span class="ident" id="5434739">text</span>&nbsp;<span class="builtintype" id="5434744">string</span><span class="op" id="5434750">,</span>&nbsp;<span class="ident" id="5434752">words</span>&nbsp;<span class="keyword" id="5434758">map</span><span class="op" id="5434761">[</span><span class="builtintype" id="5434762">string</span><span class="op" id="5434768">]</span><span class="builtintype" id="5434769">string</span><span class="op" id="5434775">)</span>&nbsp;<span class="op" id="5434777">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434780">for</span>&nbsp;<span class="ident" id="5434784">_</span><span class="op" id="5434785">,</span>&nbsp;<span class="ident" id="5434787">b</span>&nbsp;<span class="op" id="5434789">:=</span>&nbsp;<span class="keyword" id="5434792">range</span>&nbsp;<span class="ident" id="5434798">blocks</span><span class="op" id="5434804">(</span><span class="ident" id="5434805">text</span><span class="op" id="5434809">)</span>&nbsp;<span class="op" id="5434811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434815">switch</span>&nbsp;<span class="ident" id="5434822">b</span><span class="op" id="5434823">.</span><span class="ident" id="5434824">op</span>&nbsp;<span class="op" id="5434827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434831">case</span>&nbsp;<span class="ident" id="5434836">opPara</span><span class="op" id="5434842">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434847">w</span><span class="op" id="5434848">.</span><span class="ident" id="5434849">Write</span><span class="op" id="5434854">(</span><span class="ident" id="5434855">html_p</span><span class="op" id="5434861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434866">for</span>&nbsp;<span class="ident" id="5434870">_</span><span class="op" id="5434871">,</span>&nbsp;<span class="ident" id="5434873">line</span>&nbsp;<span class="op" id="5434878">:=</span>&nbsp;<span class="keyword" id="5434881">range</span>&nbsp;<span class="ident" id="5434887">b</span><span class="op" id="5434888">.</span><span class="ident" id="5434889">lines</span>&nbsp;<span class="op" id="5434895">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434901">emphasize</span><span class="op" id="5434910">(</span><span class="ident" id="5434911">w</span><span class="op" id="5434912">,</span>&nbsp;<span class="ident" id="5434914">line</span><span class="op" id="5434918">,</span>&nbsp;<span class="ident" id="5434920">words</span><span class="op" id="5434925">,</span>&nbsp;<span class="builtintype" id="5434927">true</span><span class="op" id="5434931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5434936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434941">w</span><span class="op" id="5434942">.</span><span class="ident" id="5434943">Write</span><span class="op" id="5434948">(</span><span class="ident" id="5434949">html_endp</span><span class="op" id="5434958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434962">case</span>&nbsp;<span class="ident" id="5434967">opHead</span><span class="op" id="5434973">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434978">w</span><span class="op" id="5434979">.</span><span class="ident" id="5434980">Write</span><span class="op" id="5434985">(</span><span class="ident" id="5434986">html_h</span><span class="op" id="5434992">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434997">id</span>&nbsp;<span class="op" id="5435000">:=</span>&nbsp;<span class="string" id="5435003">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435009">for</span>&nbsp;<span class="ident" id="5435013">_</span><span class="op" id="5435014">,</span>&nbsp;<span class="ident" id="5435016">line</span>&nbsp;<span class="op" id="5435021">:=</span>&nbsp;<span class="keyword" id="5435024">range</span>&nbsp;<span class="ident" id="5435030">b</span><span class="op" id="5435031">.</span><span class="ident" id="5435032">lines</span>&nbsp;<span class="op" id="5435038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435044">if</span>&nbsp;<span class="ident" id="5435047">id</span>&nbsp;<span class="op" id="5435050">==</span>&nbsp;<span class="string" id="5435053">&#34;&#34;</span>&nbsp;<span class="op" id="5435056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435063">id</span>&nbsp;<span class="op" id="5435066">=</span>&nbsp;<span class="ident" id="5435068">anchorID</span><span class="op" id="5435076">(</span><span class="ident" id="5435077">line</span><span class="op" id="5435081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435088">w</span><span class="op" id="5435089">.</span><span class="ident" id="5435090">Write</span><span class="op" id="5435095">(</span><span class="op" id="5435096">[</span><span class="op" id="5435097">]</span><span class="builtintype" id="5435098">byte</span><span class="op" id="5435102">(</span><span class="ident" id="5435103">id</span><span class="op" id="5435105">)</span><span class="op" id="5435106">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435113">w</span><span class="op" id="5435114">.</span><span class="ident" id="5435115">Write</span><span class="op" id="5435120">(</span><span class="ident" id="5435121">html_hq</span><span class="op" id="5435128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5435134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435140">commentEscape</span><span class="op" id="5435153">(</span><span class="ident" id="5435154">w</span><span class="op" id="5435155">,</span>&nbsp;<span class="ident" id="5435157">line</span><span class="op" id="5435161">,</span>&nbsp;<span class="builtintype" id="5435163">true</span><span class="op" id="5435167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5435172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435177">if</span>&nbsp;<span class="ident" id="5435180">id</span>&nbsp;<span class="op" id="5435183">==</span>&nbsp;<span class="string" id="5435186">&#34;&#34;</span>&nbsp;<span class="op" id="5435189">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435195">w</span><span class="op" id="5435196">.</span><span class="ident" id="5435197">Write</span><span class="op" id="5435202">(</span><span class="ident" id="5435203">html_hq</span><span class="op" id="5435210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5435215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435220">w</span><span class="op" id="5435221">.</span><span class="ident" id="5435222">Write</span><span class="op" id="5435227">(</span><span class="ident" id="5435228">html_endh</span><span class="op" id="5435237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435241">case</span>&nbsp;<span class="ident" id="5435246">opPre</span><span class="op" id="5435251">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435256">w</span><span class="op" id="5435257">.</span><span class="ident" id="5435258">Write</span><span class="op" id="5435263">(</span><span class="ident" id="5435264">html_pre</span><span class="op" id="5435272">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435277">for</span>&nbsp;<span class="ident" id="5435281">_</span><span class="op" id="5435282">,</span>&nbsp;<span class="ident" id="5435284">line</span>&nbsp;<span class="op" id="5435289">:=</span>&nbsp;<span class="keyword" id="5435292">range</span>&nbsp;<span class="ident" id="5435298">b</span><span class="op" id="5435299">.</span><span class="ident" id="5435300">lines</span>&nbsp;<span class="op" id="5435306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435312">emphasize</span><span class="op" id="5435321">(</span><span class="ident" id="5435322">w</span><span class="op" id="5435323">,</span>&nbsp;<span class="ident" id="5435325">line</span><span class="op" id="5435329">,</span>&nbsp;<span class="ident" id="5435331">nil</span><span class="op" id="5435334">,</span>&nbsp;<span class="builtintype" id="5435336">false</span><span class="op" id="5435341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5435346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435351">w</span><span class="op" id="5435352">.</span><span class="ident" id="5435353">Write</span><span class="op" id="5435358">(</span><span class="ident" id="5435359">html_endpre</span><span class="op" id="5435370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5435374">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5435377">}</span><br>
<span class="lineno"></span><span class="op" id="5435379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5435382">func</span>&nbsp;<span class="ident" id="5435387">blocks</span><span class="op" id="5435393">(</span><span class="ident" id="5435394">text</span>&nbsp;<span class="builtintype" id="5435399">string</span><span class="op" id="5435405">)</span>&nbsp;<span class="op" id="5435407">[</span><span class="op" id="5435408">]</span><span class="ident" id="5435409">block</span>&nbsp;<span class="op" id="5435415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435418">var</span>&nbsp;<span class="op" id="5435422">(</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435426">out</span>&nbsp;&nbsp;<span class="op" id="5435431">[</span><span class="op" id="5435432">]</span><span class="ident" id="5435433">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435441">para</span>&nbsp;<span class="op" id="5435446">[</span><span class="op" id="5435447">]</span><span class="builtintype" id="5435448">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435458">lastWasBlank</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5435473">=</span>&nbsp;<span class="builtintype" id="5435475">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435483">lastWasHeading</span>&nbsp;<span class="op" id="5435498">=</span>&nbsp;<span class="builtintype" id="5435500">false</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5435507">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5435511">close</span>&nbsp;<span class="op" id="5435517">:=</span>&nbsp;<span class="keyword" id="5435520">func</span><span class="op" id="5435524">(</span><span class="op" id="5435525">)</span>&nbsp;<span class="op" id="5435527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435531">if</span>&nbsp;<span class="ident" id="5435534">para</span>&nbsp;<span class="op" id="5435539">!=</span>&nbsp;<span class="ident" id="5435542">nil</span>&nbsp;<span class="op" id="5435546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435551">out</span>&nbsp;<span class="op" id="5435555">=</span>&nbsp;<span class="builtinfunc" id="5435557">append</span><span class="op" id="5435563">(</span><span class="ident" id="5435564">out</span><span class="op" id="5435567">,</span>&nbsp;<span class="ident" id="5435569">block</span><span class="op" id="5435574">{</span><span class="ident" id="5435575">opPara</span><span class="op" id="5435581">,</span>&nbsp;<span class="ident" id="5435583">para</span><span class="op" id="5435587">}</span><span class="op" id="5435588">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435593">para</span>&nbsp;<span class="op" id="5435598">=</span>&nbsp;<span class="ident" id="5435600">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5435606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5435609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435613">lines</span>&nbsp;<span class="op" id="5435619">:=</span>&nbsp;<span class="ident" id="5435622">strings</span><span class="op" id="5435629">.</span><span class="ident" id="5435630">SplitAfter</span><span class="op" id="5435640">(</span><span class="ident" id="5435641">text</span><span class="op" id="5435645">,</span>&nbsp;<span class="string" id="5435647">&#34;\n&#34;</span><span class="op" id="5435651">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435654">unindent</span><span class="op" id="5435662">(</span><span class="ident" id="5435663">lines</span><span class="op" id="5435668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435671">for</span>&nbsp;<span class="ident" id="5435675">i</span>&nbsp;<span class="op" id="5435677">:=</span>&nbsp;<span class="num" id="5435680">0</span><span class="op" id="5435681">;</span>&nbsp;<span class="ident" id="5435683">i</span>&nbsp;<span class="op" id="5435685">&lt;</span>&nbsp;<span class="builtinfunc" id="5435687">len</span><span class="op" id="5435690">(</span><span class="ident" id="5435691">lines</span><span class="op" id="5435696">)</span><span class="op" id="5435697">;</span>&nbsp;<span class="op" id="5435699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435703">line</span>&nbsp;<span class="op" id="5435708">:=</span>&nbsp;<span class="ident" id="5435711">lines</span><span class="op" id="5435716">[</span><span class="ident" id="5435717">i</span><span class="op" id="5435718">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435722">if</span>&nbsp;<span class="ident" id="5435725">isBlank</span><span class="op" id="5435732">(</span><span class="ident" id="5435733">line</span><span class="op" id="5435737">)</span>&nbsp;<span class="op" id="5435739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5435744">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5435766">close</span><span class="op" id="5435771">(</span><span class="op" id="5435772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435777">i</span><span class="op" id="5435778">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435784">lastWasBlank</span>&nbsp;<span class="op" id="5435797">=</span>&nbsp;<span class="builtintype" id="5435799">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435807">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5435818">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435822">if</span>&nbsp;<span class="ident" id="5435825">indentLen</span><span class="op" id="5435834">(</span><span class="ident" id="5435835">line</span><span class="op" id="5435839">)</span>&nbsp;<span class="op" id="5435841">&gt;</span>&nbsp;<span class="num" id="5435843">0</span>&nbsp;<span class="op" id="5435845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5435850">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5435872">close</span><span class="op" id="5435877">(</span><span class="op" id="5435878">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5435884">//&nbsp;count&nbsp;indented&nbsp;or&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435920">j</span>&nbsp;<span class="op" id="5435922">:=</span>&nbsp;<span class="ident" id="5435925">i</span>&nbsp;<span class="op" id="5435927">+</span>&nbsp;<span class="num" id="5435929">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435934">for</span>&nbsp;<span class="ident" id="5435938">j</span>&nbsp;<span class="op" id="5435940">&lt;</span>&nbsp;<span class="builtinfunc" id="5435942">len</span><span class="op" id="5435945">(</span><span class="ident" id="5435946">lines</span><span class="op" id="5435951">)</span>&nbsp;<span class="op" id="5435953">&amp;&amp;</span>&nbsp;<span class="op" id="5435956">(</span><span class="ident" id="5435957">isBlank</span><span class="op" id="5435964">(</span><span class="ident" id="5435965">lines</span><span class="op" id="5435970">[</span><span class="ident" id="5435971">j</span><span class="op" id="5435972">]</span><span class="op" id="5435973">)</span>&nbsp;<span class="op" id="5435975">||</span>&nbsp;<span class="ident" id="5435978">indentLen</span><span class="op" id="5435987">(</span><span class="ident" id="5435988">lines</span><span class="op" id="5435993">[</span><span class="ident" id="5435994">j</span><span class="op" id="5435995">]</span><span class="op" id="5435996">)</span>&nbsp;<span class="op" id="5435998">&gt;</span>&nbsp;<span class="num" id="5436000">0</span><span class="op" id="5436001">)</span>&nbsp;<span class="op" id="5436003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436009">j</span><span class="op" id="5436010">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5436021">//&nbsp;but&nbsp;not&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436056">for</span>&nbsp;<span class="ident" id="5436060">j</span>&nbsp;<span class="op" id="5436062">&gt;</span>&nbsp;<span class="ident" id="5436064">i</span>&nbsp;<span class="op" id="5436066">&amp;&amp;</span>&nbsp;<span class="ident" id="5436069">isBlank</span><span class="op" id="5436076">(</span><span class="ident" id="5436077">lines</span><span class="op" id="5436082">[</span><span class="ident" id="5436083">j</span><span class="op" id="5436084">-</span><span class="num" id="5436085">1</span><span class="op" id="5436086">]</span><span class="op" id="5436087">)</span>&nbsp;<span class="op" id="5436089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436095">j</span><span class="op" id="5436096">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436107">pre</span>&nbsp;<span class="op" id="5436111">:=</span>&nbsp;<span class="ident" id="5436114">lines</span><span class="op" id="5436119">[</span><span class="ident" id="5436120">i</span><span class="op" id="5436121">:</span><span class="ident" id="5436122">j</span><span class="op" id="5436123">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436128">i</span>&nbsp;<span class="op" id="5436130">=</span>&nbsp;<span class="ident" id="5436132">j</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436138">unindent</span><span class="op" id="5436146">(</span><span class="ident" id="5436147">pre</span><span class="op" id="5436150">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5436156">//&nbsp;put&nbsp;those&nbsp;lines&nbsp;in&nbsp;a&nbsp;pre&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436193">out</span>&nbsp;<span class="op" id="5436197">=</span>&nbsp;<span class="builtinfunc" id="5436199">append</span><span class="op" id="5436205">(</span><span class="ident" id="5436206">out</span><span class="op" id="5436209">,</span>&nbsp;<span class="ident" id="5436211">block</span><span class="op" id="5436216">{</span><span class="ident" id="5436217">opPre</span><span class="op" id="5436222">,</span>&nbsp;<span class="ident" id="5436224">pre</span><span class="op" id="5436227">}</span><span class="op" id="5436228">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436233">lastWasHeading</span>&nbsp;<span class="op" id="5436248">=</span>&nbsp;<span class="builtintype" id="5436250">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436259">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436275">if</span>&nbsp;<span class="ident" id="5436278">lastWasBlank</span>&nbsp;<span class="op" id="5436291">&amp;&amp;</span>&nbsp;<span class="op" id="5436294">!</span><span class="ident" id="5436295">lastWasHeading</span>&nbsp;<span class="op" id="5436310">&amp;&amp;</span>&nbsp;<span class="ident" id="5436313">i</span><span class="op" id="5436314">+</span><span class="num" id="5436315">2</span>&nbsp;<span class="op" id="5436317">&lt;</span>&nbsp;<span class="builtinfunc" id="5436319">len</span><span class="op" id="5436322">(</span><span class="ident" id="5436323">lines</span><span class="op" id="5436328">)</span>&nbsp;<span class="op" id="5436330">&amp;&amp;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436336">isBlank</span><span class="op" id="5436343">(</span><span class="ident" id="5436344">lines</span><span class="op" id="5436349">[</span><span class="ident" id="5436350">i</span><span class="op" id="5436351">+</span><span class="num" id="5436352">1</span><span class="op" id="5436353">]</span><span class="op" id="5436354">)</span>&nbsp;<span class="op" id="5436356">&amp;&amp;</span>&nbsp;<span class="op" id="5436359">!</span><span class="ident" id="5436360">isBlank</span><span class="op" id="5436367">(</span><span class="ident" id="5436368">lines</span><span class="op" id="5436373">[</span><span class="ident" id="5436374">i</span><span class="op" id="5436375">+</span><span class="num" id="5436376">2</span><span class="op" id="5436377">]</span><span class="op" id="5436378">)</span>&nbsp;<span class="op" id="5436380">&amp;&amp;</span>&nbsp;<span class="ident" id="5436383">indentLen</span><span class="op" id="5436392">(</span><span class="ident" id="5436393">lines</span><span class="op" id="5436398">[</span><span class="ident" id="5436399">i</span><span class="op" id="5436400">+</span><span class="num" id="5436401">2</span><span class="op" id="5436402">]</span><span class="op" id="5436403">)</span>&nbsp;<span class="op" id="5436405">==</span>&nbsp;<span class="num" id="5436408">0</span>&nbsp;<span class="op" id="5436410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5436415">//&nbsp;current&nbsp;line&nbsp;is&nbsp;non-blank,&nbsp;surrounded&nbsp;by&nbsp;blank&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5436474">//&nbsp;and&nbsp;the&nbsp;next&nbsp;non-blank&nbsp;line&nbsp;is&nbsp;not&nbsp;indented:&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5436530">//&nbsp;might&nbsp;be&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436556">if</span>&nbsp;<span class="ident" id="5436559">head</span>&nbsp;<span class="op" id="5436564">:=</span>&nbsp;<span class="ident" id="5436567">heading</span><span class="op" id="5436574">(</span><span class="ident" id="5436575">line</span><span class="op" id="5436579">)</span><span class="op" id="5436580">;</span>&nbsp;<span class="ident" id="5436582">head</span>&nbsp;<span class="op" id="5436587">!=</span>&nbsp;<span class="string" id="5436590">&#34;&#34;</span>&nbsp;<span class="op" id="5436593">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5436599">close</span><span class="op" id="5436604">(</span><span class="op" id="5436605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436611">out</span>&nbsp;<span class="op" id="5436615">=</span>&nbsp;<span class="builtinfunc" id="5436617">append</span><span class="op" id="5436623">(</span><span class="ident" id="5436624">out</span><span class="op" id="5436627">,</span>&nbsp;<span class="ident" id="5436629">block</span><span class="op" id="5436634">{</span><span class="ident" id="5436635">opHead</span><span class="op" id="5436641">,</span>&nbsp;<span class="op" id="5436643">[</span><span class="op" id="5436644">]</span><span class="builtintype" id="5436645">string</span><span class="op" id="5436651">{</span><span class="ident" id="5436652">head</span><span class="op" id="5436656">}</span><span class="op" id="5436657">}</span><span class="op" id="5436658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436664">i</span>&nbsp;<span class="op" id="5436666">+=</span>&nbsp;<span class="num" id="5436669">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436675">lastWasHeading</span>&nbsp;<span class="op" id="5436690">=</span>&nbsp;<span class="builtintype" id="5436692">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436701">continue</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5436722">//&nbsp;open&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436742">lastWasBlank</span>&nbsp;<span class="op" id="5436755">=</span>&nbsp;<span class="builtintype" id="5436757">false</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436765">lastWasHeading</span>&nbsp;<span class="op" id="5436780">=</span>&nbsp;<span class="builtintype" id="5436782">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436790">para</span>&nbsp;<span class="op" id="5436795">=</span>&nbsp;<span class="builtinfunc" id="5436797">append</span><span class="op" id="5436803">(</span><span class="ident" id="5436804">para</span><span class="op" id="5436808">,</span>&nbsp;<span class="ident" id="5436810">lines</span><span class="op" id="5436815">[</span><span class="ident" id="5436816">i</span><span class="op" id="5436817">]</span><span class="op" id="5436818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436822">i</span><span class="op" id="5436823">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5436830">close</span><span class="op" id="5436835">(</span><span class="op" id="5436836">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436840">return</span>&nbsp;<span class="ident" id="5436847">out</span><br>
<span class="lineno"></span><span class="op" id="5436851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5436854">//&nbsp;ToText&nbsp;prepares&nbsp;comment&nbsp;text&nbsp;for&nbsp;presentation&nbsp;in&nbsp;textual&nbsp;output.</span><br>
<span class="lineno">400</span><span class="comment" id="5436922">//&nbsp;It&nbsp;wraps&nbsp;paragraphs&nbsp;of&nbsp;text&nbsp;to&nbsp;width&nbsp;or&nbsp;fewer&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno"></span><span class="comment" id="5436991">//&nbsp;and&nbsp;then&nbsp;prefixes&nbsp;each&nbsp;line&nbsp;with&nbsp;the&nbsp;indent.&nbsp;&nbsp;In&nbsp;preformatted&nbsp;sections</span><br>
<span class="lineno"></span><span class="comment" id="5437065">//&nbsp;(such&nbsp;as&nbsp;program&nbsp;text),&nbsp;it&nbsp;prefixes&nbsp;each&nbsp;non-blank&nbsp;line&nbsp;with&nbsp;preIndent.</span><br>
<span class="lineno"></span><span class="keyword" id="5437140">func</span>&nbsp;<span class="ident" id="5437145">ToText</span><span class="op" id="5437151">(</span><span class="ident" id="5437152">w</span>&nbsp;<span class="ident" id="5437154">io</span><span class="op" id="5437156">.</span><span class="ident" id="5437157">Writer</span><span class="op" id="5437163">,</span>&nbsp;<span class="ident" id="5437165">text</span>&nbsp;<span class="builtintype" id="5437170">string</span><span class="op" id="5437176">,</span>&nbsp;<span class="ident" id="5437178">indent</span><span class="op" id="5437184">,</span>&nbsp;<span class="ident" id="5437186">preIndent</span>&nbsp;<span class="builtintype" id="5437196">string</span><span class="op" id="5437202">,</span>&nbsp;<span class="ident" id="5437204">width</span>&nbsp;<span class="builtintype" id="5437210">int</span><span class="op" id="5437213">)</span>&nbsp;<span class="op" id="5437215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437218">l</span>&nbsp;<span class="op" id="5437220">:=</span>&nbsp;<span class="ident" id="5437223">lineWrapper</span><span class="op" id="5437234">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437238">out</span><span class="op" id="5437241">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437246">w</span><span class="op" id="5437247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437251">width</span><span class="op" id="5437256">:</span>&nbsp;&nbsp;<span class="ident" id="5437259">width</span><span class="op" id="5437264">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437268">indent</span><span class="op" id="5437274">:</span>&nbsp;<span class="ident" id="5437276">indent</span><span class="op" id="5437282">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437288">for</span>&nbsp;<span class="ident" id="5437292">_</span><span class="op" id="5437293">,</span>&nbsp;<span class="ident" id="5437295">b</span>&nbsp;<span class="op" id="5437297">:=</span>&nbsp;<span class="keyword" id="5437300">range</span>&nbsp;<span class="ident" id="5437306">blocks</span><span class="op" id="5437312">(</span><span class="ident" id="5437313">text</span><span class="op" id="5437317">)</span>&nbsp;<span class="op" id="5437319">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437323">switch</span>&nbsp;<span class="ident" id="5437330">b</span><span class="op" id="5437331">.</span><span class="ident" id="5437332">op</span>&nbsp;<span class="op" id="5437335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437339">case</span>&nbsp;<span class="ident" id="5437344">opPara</span><span class="op" id="5437350">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5437355">//&nbsp;l.write&nbsp;will&nbsp;add&nbsp;leading&nbsp;newline&nbsp;if&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437406">for</span>&nbsp;<span class="ident" id="5437410">_</span><span class="op" id="5437411">,</span>&nbsp;<span class="ident" id="5437413">line</span>&nbsp;<span class="op" id="5437418">:=</span>&nbsp;<span class="keyword" id="5437421">range</span>&nbsp;<span class="ident" id="5437427">b</span><span class="op" id="5437428">.</span><span class="ident" id="5437429">lines</span>&nbsp;<span class="op" id="5437435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437441">l</span><span class="op" id="5437442">.</span><span class="ident" id="5437443">write</span><span class="op" id="5437448">(</span><span class="ident" id="5437449">line</span><span class="op" id="5437453">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437463">l</span><span class="op" id="5437464">.</span><span class="ident" id="5437465">flush</span><span class="op" id="5437470">(</span><span class="op" id="5437471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437475">case</span>&nbsp;<span class="ident" id="5437480">opHead</span><span class="op" id="5437486">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437491">w</span><span class="op" id="5437492">.</span><span class="ident" id="5437493">Write</span><span class="op" id="5437498">(</span><span class="ident" id="5437499">nl</span><span class="op" id="5437501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437506">for</span>&nbsp;<span class="ident" id="5437510">_</span><span class="op" id="5437511">,</span>&nbsp;<span class="ident" id="5437513">line</span>&nbsp;<span class="op" id="5437518">:=</span>&nbsp;<span class="keyword" id="5437521">range</span>&nbsp;<span class="ident" id="5437527">b</span><span class="op" id="5437528">.</span><span class="ident" id="5437529">lines</span>&nbsp;<span class="op" id="5437535">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437541">l</span><span class="op" id="5437542">.</span><span class="ident" id="5437543">write</span><span class="op" id="5437548">(</span><span class="ident" id="5437549">line</span>&nbsp;<span class="op" id="5437554">+</span>&nbsp;<span class="string" id="5437556">&#34;\n&#34;</span><span class="op" id="5437560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437570">l</span><span class="op" id="5437571">.</span><span class="ident" id="5437572">flush</span><span class="op" id="5437577">(</span><span class="op" id="5437578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437582">case</span>&nbsp;<span class="ident" id="5437587">opPre</span><span class="op" id="5437592">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437597">w</span><span class="op" id="5437598">.</span><span class="ident" id="5437599">Write</span><span class="op" id="5437604">(</span><span class="ident" id="5437605">nl</span><span class="op" id="5437607">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437612">for</span>&nbsp;<span class="ident" id="5437616">_</span><span class="op" id="5437617">,</span>&nbsp;<span class="ident" id="5437619">line</span>&nbsp;<span class="op" id="5437624">:=</span>&nbsp;<span class="keyword" id="5437627">range</span>&nbsp;<span class="ident" id="5437633">b</span><span class="op" id="5437634">.</span><span class="ident" id="5437635">lines</span>&nbsp;<span class="op" id="5437641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437647">if</span>&nbsp;<span class="ident" id="5437650">isBlank</span><span class="op" id="5437657">(</span><span class="ident" id="5437658">line</span><span class="op" id="5437662">)</span>&nbsp;<span class="op" id="5437664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437671">w</span><span class="op" id="5437672">.</span><span class="ident" id="5437673">Write</span><span class="op" id="5437678">(</span><span class="op" id="5437679">[</span><span class="op" id="5437680">]</span><span class="builtintype" id="5437681">byte</span><span class="op" id="5437685">(</span><span class="string" id="5437686">&#34;\n&#34;</span><span class="op" id="5437690">)</span><span class="op" id="5437691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437697">}</span>&nbsp;<span class="keyword" id="5437699">else</span>&nbsp;<span class="op" id="5437704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437711">w</span><span class="op" id="5437712">.</span><span class="ident" id="5437713">Write</span><span class="op" id="5437718">(</span><span class="op" id="5437719">[</span><span class="op" id="5437720">]</span><span class="builtintype" id="5437721">byte</span><span class="op" id="5437725">(</span><span class="ident" id="5437726">preIndent</span><span class="op" id="5437735">)</span><span class="op" id="5437736">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437743">w</span><span class="op" id="5437744">.</span><span class="ident" id="5437745">Write</span><span class="op" id="5437750">(</span><span class="op" id="5437751">[</span><span class="op" id="5437752">]</span><span class="builtintype" id="5437753">byte</span><span class="op" id="5437757">(</span><span class="ident" id="5437758">line</span><span class="op" id="5437762">)</span><span class="op" id="5437763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437781">}</span><br>
<span class="lineno">435</span><span class="op" id="5437783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5437786">type</span>&nbsp;<span class="ident" id="5437791">lineWrapper</span>&nbsp;<span class="keyword" id="5437803">struct</span>&nbsp;<span class="op" id="5437810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437813">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437823">io</span><span class="op" id="5437825">.</span><span class="ident" id="5437826">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437834">printed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5437844">bool</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437850">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5437860">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437865">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5437875">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437883">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5437893">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437898">pendSpace</span>&nbsp;<span class="builtintype" id="5437908">int</span><br>
<span class="lineno"></span><span class="op" id="5437912">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="5437915">var</span>&nbsp;<span class="ident" id="5437919">nl</span>&nbsp;<span class="op" id="5437922">=</span>&nbsp;<span class="op" id="5437924">[</span><span class="op" id="5437925">]</span><span class="builtintype" id="5437926">byte</span><span class="op" id="5437930">(</span><span class="string" id="5437931">&#34;\n&#34;</span><span class="op" id="5437935">)</span><br>
<span class="lineno"></span><span class="keyword" id="5437937">var</span>&nbsp;<span class="ident" id="5437941">space</span>&nbsp;<span class="op" id="5437947">=</span>&nbsp;<span class="op" id="5437949">[</span><span class="op" id="5437950">]</span><span class="builtintype" id="5437951">byte</span><span class="op" id="5437955">(</span><span class="string" id="5437956">&#34;&nbsp;&#34;</span><span class="op" id="5437959">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5437962">func</span>&nbsp;<span class="op" id="5437967">(</span><span class="ident" id="5437968">l</span>&nbsp;<span class="op" id="5437970">*</span><span class="ident" id="5437971">lineWrapper</span><span class="op" id="5437982">)</span>&nbsp;<span class="ident" id="5437984">write</span><span class="op" id="5437989">(</span><span class="ident" id="5437990">text</span>&nbsp;<span class="builtintype" id="5437995">string</span><span class="op" id="5438001">)</span>&nbsp;<span class="op" id="5438003">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5438006">if</span>&nbsp;<span class="ident" id="5438009">l</span><span class="op" id="5438010">.</span><span class="ident" id="5438011">n</span>&nbsp;<span class="op" id="5438013">==</span>&nbsp;<span class="num" id="5438016">0</span>&nbsp;<span class="op" id="5438018">&amp;&amp;</span>&nbsp;<span class="ident" id="5438021">l</span><span class="op" id="5438022">.</span><span class="ident" id="5438023">printed</span>&nbsp;<span class="op" id="5438031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438035">l</span><span class="op" id="5438036">.</span><span class="ident" id="5438037">out</span><span class="op" id="5438040">.</span><span class="ident" id="5438041">Write</span><span class="op" id="5438046">(</span><span class="ident" id="5438047">nl</span><span class="op" id="5438049">)</span>&nbsp;<span class="comment" id="5438051">//&nbsp;blank&nbsp;line&nbsp;before&nbsp;new&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5438087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438090">l</span><span class="op" id="5438091">.</span><span class="ident" id="5438092">printed</span>&nbsp;<span class="op" id="5438100">=</span>&nbsp;<span class="builtintype" id="5438102">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5438109">for</span>&nbsp;<span class="ident" id="5438113">_</span><span class="op" id="5438114">,</span>&nbsp;<span class="ident" id="5438116">f</span>&nbsp;<span class="op" id="5438118">:=</span>&nbsp;<span class="keyword" id="5438121">range</span>&nbsp;<span class="ident" id="5438127">strings</span><span class="op" id="5438134">.</span><span class="ident" id="5438135">Fields</span><span class="op" id="5438141">(</span><span class="ident" id="5438142">text</span><span class="op" id="5438146">)</span>&nbsp;<span class="op" id="5438148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438152">w</span>&nbsp;<span class="op" id="5438154">:=</span>&nbsp;<span class="ident" id="5438157">utf8</span><span class="op" id="5438161">.</span><span class="ident" id="5438162">RuneCountInString</span><span class="op" id="5438179">(</span><span class="ident" id="5438180">f</span><span class="op" id="5438181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5438185">//&nbsp;wrap&nbsp;if&nbsp;line&nbsp;is&nbsp;too&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5438215">if</span>&nbsp;<span class="ident" id="5438218">l</span><span class="op" id="5438219">.</span><span class="ident" id="5438220">n</span>&nbsp;<span class="op" id="5438222">&gt;</span>&nbsp;<span class="num" id="5438224">0</span>&nbsp;<span class="op" id="5438226">&amp;&amp;</span>&nbsp;<span class="ident" id="5438229">l</span><span class="op" id="5438230">.</span><span class="ident" id="5438231">n</span><span class="op" id="5438232">+</span><span class="ident" id="5438233">l</span><span class="op" id="5438234">.</span><span class="ident" id="5438235">pendSpace</span><span class="op" id="5438244">+</span><span class="ident" id="5438245">w</span>&nbsp;<span class="op" id="5438247">&gt;</span>&nbsp;<span class="ident" id="5438249">l</span><span class="op" id="5438250">.</span><span class="ident" id="5438251">width</span>&nbsp;<span class="op" id="5438257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438262">l</span><span class="op" id="5438263">.</span><span class="ident" id="5438264">out</span><span class="op" id="5438267">.</span><span class="ident" id="5438268">Write</span><span class="op" id="5438273">(</span><span class="ident" id="5438274">nl</span><span class="op" id="5438276">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438281">l</span><span class="op" id="5438282">.</span><span class="ident" id="5438283">n</span>&nbsp;<span class="op" id="5438285">=</span>&nbsp;<span class="num" id="5438287">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438292">l</span><span class="op" id="5438293">.</span><span class="ident" id="5438294">pendSpace</span>&nbsp;<span class="op" id="5438304">=</span>&nbsp;<span class="num" id="5438306">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5438310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5438314">if</span>&nbsp;<span class="ident" id="5438317">l</span><span class="op" id="5438318">.</span><span class="ident" id="5438319">n</span>&nbsp;<span class="op" id="5438321">==</span>&nbsp;<span class="num" id="5438324">0</span>&nbsp;<span class="op" id="5438326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438331">l</span><span class="op" id="5438332">.</span><span class="ident" id="5438333">out</span><span class="op" id="5438336">.</span><span class="ident" id="5438337">Write</span><span class="op" id="5438342">(</span><span class="op" id="5438343">[</span><span class="op" id="5438344">]</span><span class="builtintype" id="5438345">byte</span><span class="op" id="5438349">(</span><span class="ident" id="5438350">l</span><span class="op" id="5438351">.</span><span class="ident" id="5438352">indent</span><span class="op" id="5438358">)</span><span class="op" id="5438359">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5438363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438367">l</span><span class="op" id="5438368">.</span><span class="ident" id="5438369">out</span><span class="op" id="5438372">.</span><span class="ident" id="5438373">Write</span><span class="op" id="5438378">(</span><span class="ident" id="5438379">space</span><span class="op" id="5438384">[</span><span class="op" id="5438385">:</span><span class="ident" id="5438386">l</span><span class="op" id="5438387">.</span><span class="ident" id="5438388">pendSpace</span><span class="op" id="5438397">]</span><span class="op" id="5438398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438402">l</span><span class="op" id="5438403">.</span><span class="ident" id="5438404">out</span><span class="op" id="5438407">.</span><span class="ident" id="5438408">Write</span><span class="op" id="5438413">(</span><span class="op" id="5438414">[</span><span class="op" id="5438415">]</span><span class="builtintype" id="5438416">byte</span><span class="op" id="5438420">(</span><span class="ident" id="5438421">f</span><span class="op" id="5438422">)</span><span class="op" id="5438423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438427">l</span><span class="op" id="5438428">.</span><span class="ident" id="5438429">n</span>&nbsp;<span class="op" id="5438431">+=</span>&nbsp;<span class="ident" id="5438434">l</span><span class="op" id="5438435">.</span><span class="ident" id="5438436">pendSpace</span>&nbsp;<span class="op" id="5438446">+</span>&nbsp;<span class="ident" id="5438448">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438452">l</span><span class="op" id="5438453">.</span><span class="ident" id="5438454">pendSpace</span>&nbsp;<span class="op" id="5438464">=</span>&nbsp;<span class="num" id="5438466">1</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5438469">}</span><br>
<span class="lineno"></span><span class="op" id="5438471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5438474">func</span>&nbsp;<span class="op" id="5438479">(</span><span class="ident" id="5438480">l</span>&nbsp;<span class="op" id="5438482">*</span><span class="ident" id="5438483">lineWrapper</span><span class="op" id="5438494">)</span>&nbsp;<span class="ident" id="5438496">flush</span><span class="op" id="5438501">(</span><span class="op" id="5438502">)</span>&nbsp;<span class="op" id="5438504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5438507">if</span>&nbsp;<span class="ident" id="5438510">l</span><span class="op" id="5438511">.</span><span class="ident" id="5438512">n</span>&nbsp;<span class="op" id="5438514">==</span>&nbsp;<span class="num" id="5438517">0</span>&nbsp;<span class="op" id="5438519">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5438523">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5438531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438534">l</span><span class="op" id="5438535">.</span><span class="ident" id="5438536">out</span><span class="op" id="5438539">.</span><span class="ident" id="5438540">Write</span><span class="op" id="5438545">(</span><span class="ident" id="5438546">nl</span><span class="op" id="5438548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438551">l</span><span class="op" id="5438552">.</span><span class="ident" id="5438553">pendSpace</span>&nbsp;<span class="op" id="5438563">=</span>&nbsp;<span class="num" id="5438565">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438568">l</span><span class="op" id="5438569">.</span><span class="ident" id="5438570">n</span>&nbsp;<span class="op" id="5438572">=</span>&nbsp;<span class="num" id="5438574">0</span><br>
<span class="lineno">480</span><span class="op" id="5438576">}</span>
</div>
</body>
</html>
