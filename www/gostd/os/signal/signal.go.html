<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os/signal</h2>
<ul>
<li><a href="/gostd/os/signal/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/os/signal/signal.go.html" class="current">signal.go</a></li>
<li><a href="/gostd/os/signal/signal_test.go.html">signal_test.go</a></li>
<li><a href="/gostd/os/signal/signal_unix.go.html">signal_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6270586">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6270641">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6270695">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6270746">//&nbsp;Package&nbsp;signal&nbsp;implements&nbsp;access&nbsp;to&nbsp;incoming&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="6270803">package</span>&nbsp;<span class="ident" id="6270811">signal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6270819">//&nbsp;BUG(rsc):&nbsp;This&nbsp;package&nbsp;is&nbsp;not&nbsp;yet&nbsp;implemented&nbsp;on&nbsp;Plan&nbsp;9.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6270880">import</span>&nbsp;<span class="op" id="6270887">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6270890">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6270896">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6270903">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6270906">var</span>&nbsp;<span class="ident" id="6270910">handlers</span>&nbsp;<span class="keyword" id="6270919">struct</span>&nbsp;<span class="op" id="6270926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6270929">sync</span><span class="op" id="6270933">.</span><span class="ident" id="6270934">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6270941">m</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6270945">map</span><span class="op" id="6270948">[</span><span class="keyword" id="6270949">chan</span><span class="op" id="6270953">&lt;-</span>&nbsp;<span class="ident" id="6270956">os</span><span class="op" id="6270958">.</span><span class="ident" id="6270959">Signal</span><span class="op" id="6270965">]</span><span class="op" id="6270966">*</span><span class="ident" id="6270967">handler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6270976">ref</span>&nbsp;<span class="op" id="6270980">[</span><span class="ident" id="6270981">numSig</span><span class="op" id="6270987">]</span><span class="ident" id="6270988">int64</span><br>
<span class="lineno"></span><span class="op" id="6270994">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6270997">type</span>&nbsp;<span class="ident" id="6271002">handler</span>&nbsp;<span class="keyword" id="6271010">struct</span>&nbsp;<span class="op" id="6271017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6271020">mask</span>&nbsp;<span class="op" id="6271025">[</span><span class="op" id="6271026">(</span><span class="ident" id="6271027">numSig</span>&nbsp;<span class="op" id="6271034">+</span>&nbsp;<span class="num" id="6271036">31</span><span class="op" id="6271038">)</span>&nbsp;<span class="op" id="6271040">/</span>&nbsp;<span class="num" id="6271042">32</span><span class="op" id="6271044">]</span><span class="builtintype" id="6271045">uint32</span><br>
<span class="lineno"></span><span class="op" id="6271052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6271055">func</span>&nbsp;<span class="op" id="6271060">(</span><span class="ident" id="6271061">h</span>&nbsp;<span class="op" id="6271063">*</span><span class="ident" id="6271064">handler</span><span class="op" id="6271071">)</span>&nbsp;<span class="ident" id="6271073">want</span><span class="op" id="6271077">(</span><span class="ident" id="6271078">sig</span>&nbsp;<span class="builtintype" id="6271082">int</span><span class="op" id="6271085">)</span>&nbsp;<span class="builtintype" id="6271087">bool</span>&nbsp;<span class="op" id="6271092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271095">return</span>&nbsp;<span class="op" id="6271102">(</span><span class="ident" id="6271103">h</span><span class="op" id="6271104">.</span><span class="ident" id="6271105">mask</span><span class="op" id="6271109">[</span><span class="ident" id="6271110">sig</span><span class="op" id="6271113">/</span><span class="num" id="6271114">32</span><span class="op" id="6271116">]</span><span class="op" id="6271117">&gt;&gt;</span><span class="builtintype" id="6271119">uint</span><span class="op" id="6271123">(</span><span class="ident" id="6271124">sig</span><span class="op" id="6271127">&amp;</span><span class="num" id="6271128">31</span><span class="op" id="6271130">)</span><span class="op" id="6271131">)</span><span class="op" id="6271132">&amp;</span><span class="num" id="6271133">1</span>&nbsp;<span class="op" id="6271135">!=</span>&nbsp;<span class="num" id="6271138">0</span><br>
<span class="lineno"></span><span class="op" id="6271140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6271143">func</span>&nbsp;<span class="op" id="6271148">(</span><span class="ident" id="6271149">h</span>&nbsp;<span class="op" id="6271151">*</span><span class="ident" id="6271152">handler</span><span class="op" id="6271159">)</span>&nbsp;<span class="ident" id="6271161">set</span><span class="op" id="6271164">(</span><span class="ident" id="6271165">sig</span>&nbsp;<span class="builtintype" id="6271169">int</span><span class="op" id="6271172">)</span>&nbsp;<span class="op" id="6271174">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6271177">h</span><span class="op" id="6271178">.</span><span class="ident" id="6271179">mask</span><span class="op" id="6271183">[</span><span class="ident" id="6271184">sig</span><span class="op" id="6271187">/</span><span class="num" id="6271188">32</span><span class="op" id="6271190">]</span>&nbsp;<span class="op" id="6271192">|=</span>&nbsp;<span class="num" id="6271195">1</span>&nbsp;<span class="op" id="6271197">&lt;&lt;</span>&nbsp;<span class="builtintype" id="6271200">uint</span><span class="op" id="6271204">(</span><span class="ident" id="6271205">sig</span><span class="op" id="6271208">&amp;</span><span class="num" id="6271209">31</span><span class="op" id="6271211">)</span><br>
<span class="lineno"></span><span class="op" id="6271213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6271216">//&nbsp;Notify&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;relay&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6271280">//&nbsp;If&nbsp;no&nbsp;signals&nbsp;are&nbsp;listed,&nbsp;all&nbsp;incoming&nbsp;signals&nbsp;will&nbsp;be&nbsp;relayed&nbsp;to&nbsp;c.</span><br>
<span class="lineno">35</span><span class="comment" id="6271352">//&nbsp;Otherwise,&nbsp;just&nbsp;the&nbsp;listed&nbsp;signals&nbsp;will.</span><br>
<span class="lineno"></span><span class="comment" id="6271396">//</span><br>
<span class="lineno"></span><span class="comment" id="6271399">//&nbsp;Package&nbsp;signal&nbsp;will&nbsp;not&nbsp;block&nbsp;sending&nbsp;to&nbsp;c:&nbsp;the&nbsp;caller&nbsp;must&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="6271469">//&nbsp;that&nbsp;c&nbsp;has&nbsp;sufficient&nbsp;buffer&nbsp;space&nbsp;to&nbsp;keep&nbsp;up&nbsp;with&nbsp;the&nbsp;expected</span><br>
<span class="lineno"></span><span class="comment" id="6271536">//&nbsp;signal&nbsp;rate.&nbsp;&nbsp;For&nbsp;a&nbsp;channel&nbsp;used&nbsp;for&nbsp;notification&nbsp;of&nbsp;just&nbsp;one&nbsp;signal&nbsp;value,</span><br>
<span class="lineno">40</span><span class="comment" id="6271615">//&nbsp;a&nbsp;buffer&nbsp;of&nbsp;size&nbsp;1&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="comment" id="6271652">//</span><br>
<span class="lineno"></span><span class="comment" id="6271655">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;the&nbsp;same&nbsp;channel:</span><br>
<span class="lineno"></span><span class="comment" id="6271725">//&nbsp;each&nbsp;call&nbsp;expands&nbsp;the&nbsp;set&nbsp;of&nbsp;signals&nbsp;sent&nbsp;to&nbsp;that&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="6271787">//&nbsp;The&nbsp;only&nbsp;way&nbsp;to&nbsp;remove&nbsp;signals&nbsp;from&nbsp;the&nbsp;set&nbsp;is&nbsp;to&nbsp;call&nbsp;Stop.</span><br>
<span class="lineno">45</span><span class="comment" id="6271851">//</span><br>
<span class="lineno"></span><span class="comment" id="6271854">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;different&nbsp;channels</span><br>
<span class="lineno"></span><span class="comment" id="6271925">//&nbsp;and&nbsp;the&nbsp;same&nbsp;signals:&nbsp;each&nbsp;channel&nbsp;receives&nbsp;copies&nbsp;of&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="6271991">//&nbsp;signals&nbsp;independently.</span><br>
<span class="lineno"></span><span class="keyword" id="6272017">func</span>&nbsp;<span class="ident" id="6272022">Notify</span><span class="op" id="6272028">(</span><span class="ident" id="6272029">c</span>&nbsp;<span class="keyword" id="6272031">chan</span><span class="op" id="6272035">&lt;-</span>&nbsp;<span class="ident" id="6272038">os</span><span class="op" id="6272040">.</span><span class="ident" id="6272041">Signal</span><span class="op" id="6272047">,</span>&nbsp;<span class="ident" id="6272049">sig</span>&nbsp;<span class="op" id="6272053">...</span><span class="ident" id="6272056">os</span><span class="op" id="6272058">.</span><span class="ident" id="6272059">Signal</span><span class="op" id="6272065">)</span>&nbsp;<span class="op" id="6272067">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272070">if</span>&nbsp;<span class="ident" id="6272073">c</span>&nbsp;<span class="op" id="6272075">==</span>&nbsp;<span class="ident" id="6272078">nil</span>&nbsp;<span class="op" id="6272082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6272086">panic</span><span class="op" id="6272091">(</span><span class="string" id="6272092">&#34;os/signal:&nbsp;Notify&nbsp;using&nbsp;nil&nbsp;channel&#34;</span><span class="op" id="6272129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272136">handlers</span><span class="op" id="6272144">.</span><span class="ident" id="6272145">Lock</span><span class="op" id="6272149">(</span><span class="op" id="6272150">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272153">defer</span>&nbsp;<span class="ident" id="6272159">handlers</span><span class="op" id="6272167">.</span><span class="ident" id="6272168">Unlock</span><span class="op" id="6272174">(</span><span class="op" id="6272175">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272179">h</span>&nbsp;<span class="op" id="6272181">:=</span>&nbsp;<span class="ident" id="6272184">handlers</span><span class="op" id="6272192">.</span><span class="ident" id="6272193">m</span><span class="op" id="6272194">[</span><span class="ident" id="6272195">c</span><span class="op" id="6272196">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272199">if</span>&nbsp;<span class="ident" id="6272202">h</span>&nbsp;<span class="op" id="6272204">==</span>&nbsp;<span class="ident" id="6272207">nil</span>&nbsp;<span class="op" id="6272211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272215">if</span>&nbsp;<span class="ident" id="6272218">handlers</span><span class="op" id="6272226">.</span><span class="ident" id="6272227">m</span>&nbsp;<span class="op" id="6272229">==</span>&nbsp;<span class="ident" id="6272232">nil</span>&nbsp;<span class="op" id="6272236">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272241">handlers</span><span class="op" id="6272249">.</span><span class="ident" id="6272250">m</span>&nbsp;<span class="op" id="6272252">=</span>&nbsp;<span class="builtinfunc" id="6272254">make</span><span class="op" id="6272258">(</span><span class="keyword" id="6272259">map</span><span class="op" id="6272262">[</span><span class="keyword" id="6272263">chan</span><span class="op" id="6272267">&lt;-</span>&nbsp;<span class="ident" id="6272270">os</span><span class="op" id="6272272">.</span><span class="ident" id="6272273">Signal</span><span class="op" id="6272279">]</span><span class="op" id="6272280">*</span><span class="ident" id="6272281">handler</span><span class="op" id="6272288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272296">h</span>&nbsp;<span class="op" id="6272298">=</span>&nbsp;<span class="builtinfunc" id="6272300">new</span><span class="op" id="6272303">(</span><span class="ident" id="6272304">handler</span><span class="op" id="6272311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272315">handlers</span><span class="op" id="6272323">.</span><span class="ident" id="6272324">m</span><span class="op" id="6272325">[</span><span class="ident" id="6272326">c</span><span class="op" id="6272327">]</span>&nbsp;<span class="op" id="6272329">=</span>&nbsp;<span class="ident" id="6272331">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272334">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272338">add</span>&nbsp;<span class="op" id="6272342">:=</span>&nbsp;<span class="keyword" id="6272345">func</span><span class="op" id="6272349">(</span><span class="ident" id="6272350">n</span>&nbsp;<span class="builtintype" id="6272352">int</span><span class="op" id="6272355">)</span>&nbsp;<span class="op" id="6272357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272361">if</span>&nbsp;<span class="ident" id="6272364">n</span>&nbsp;<span class="op" id="6272366">&lt;</span>&nbsp;<span class="num" id="6272368">0</span>&nbsp;<span class="op" id="6272370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272375">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272384">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272388">if</span>&nbsp;<span class="op" id="6272391">!</span><span class="ident" id="6272392">h</span><span class="op" id="6272393">.</span><span class="ident" id="6272394">want</span><span class="op" id="6272398">(</span><span class="ident" id="6272399">n</span><span class="op" id="6272400">)</span>&nbsp;<span class="op" id="6272402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272407">h</span><span class="op" id="6272408">.</span><span class="ident" id="6272409">set</span><span class="op" id="6272412">(</span><span class="ident" id="6272413">n</span><span class="op" id="6272414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272419">if</span>&nbsp;<span class="ident" id="6272422">handlers</span><span class="op" id="6272430">.</span><span class="ident" id="6272431">ref</span><span class="op" id="6272434">[</span><span class="ident" id="6272435">n</span><span class="op" id="6272436">]</span>&nbsp;<span class="op" id="6272438">==</span>&nbsp;<span class="num" id="6272441">0</span>&nbsp;<span class="op" id="6272443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272449">enableSignal</span><span class="op" id="6272461">(</span><span class="ident" id="6272462">n</span><span class="op" id="6272463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272468">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272473">handlers</span><span class="op" id="6272481">.</span><span class="ident" id="6272482">ref</span><span class="op" id="6272485">[</span><span class="ident" id="6272486">n</span><span class="op" id="6272487">]</span><span class="op" id="6272488">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272500">if</span>&nbsp;<span class="builtinfunc" id="6272503">len</span><span class="op" id="6272506">(</span><span class="ident" id="6272507">sig</span><span class="op" id="6272510">)</span>&nbsp;<span class="op" id="6272512">==</span>&nbsp;<span class="num" id="6272515">0</span>&nbsp;<span class="op" id="6272517">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272521">for</span>&nbsp;<span class="ident" id="6272525">n</span>&nbsp;<span class="op" id="6272527">:=</span>&nbsp;<span class="num" id="6272530">0</span><span class="op" id="6272531">;</span>&nbsp;<span class="ident" id="6272533">n</span>&nbsp;<span class="op" id="6272535">&lt;</span>&nbsp;<span class="ident" id="6272537">numSig</span><span class="op" id="6272543">;</span>&nbsp;<span class="ident" id="6272545">n</span><span class="op" id="6272546">++</span>&nbsp;<span class="op" id="6272549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272554">add</span><span class="op" id="6272557">(</span><span class="ident" id="6272558">n</span><span class="op" id="6272559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272566">}</span>&nbsp;<span class="keyword" id="6272568">else</span>&nbsp;<span class="op" id="6272573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272577">for</span>&nbsp;<span class="ident" id="6272581">_</span><span class="op" id="6272582">,</span>&nbsp;<span class="ident" id="6272584">s</span>&nbsp;<span class="op" id="6272586">:=</span>&nbsp;<span class="keyword" id="6272589">range</span>&nbsp;<span class="ident" id="6272595">sig</span>&nbsp;<span class="op" id="6272599">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272604">add</span><span class="op" id="6272607">(</span><span class="ident" id="6272608">signum</span><span class="op" id="6272614">(</span><span class="ident" id="6272615">s</span><span class="op" id="6272616">)</span><span class="op" id="6272617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272624">}</span><br>
<span class="lineno"></span><span class="op" id="6272626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="6272629">//&nbsp;Stop&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;stop&nbsp;relaying&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6272699">//&nbsp;It&nbsp;undoes&nbsp;the&nbsp;effect&nbsp;of&nbsp;all&nbsp;prior&nbsp;calls&nbsp;to&nbsp;Notify&nbsp;using&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6272761">//&nbsp;When&nbsp;Stop&nbsp;returns,&nbsp;it&nbsp;is&nbsp;guaranteed&nbsp;that&nbsp;c&nbsp;will&nbsp;receive&nbsp;no&nbsp;more&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="6272837">func</span>&nbsp;<span class="ident" id="6272842">Stop</span><span class="op" id="6272846">(</span><span class="ident" id="6272847">c</span>&nbsp;<span class="keyword" id="6272849">chan</span><span class="op" id="6272853">&lt;-</span>&nbsp;<span class="ident" id="6272856">os</span><span class="op" id="6272858">.</span><span class="ident" id="6272859">Signal</span><span class="op" id="6272865">)</span>&nbsp;<span class="op" id="6272867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272870">handlers</span><span class="op" id="6272878">.</span><span class="ident" id="6272879">Lock</span><span class="op" id="6272883">(</span><span class="op" id="6272884">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272887">defer</span>&nbsp;<span class="ident" id="6272893">handlers</span><span class="op" id="6272901">.</span><span class="ident" id="6272902">Unlock</span><span class="op" id="6272908">(</span><span class="op" id="6272909">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272913">h</span>&nbsp;<span class="op" id="6272915">:=</span>&nbsp;<span class="ident" id="6272918">handlers</span><span class="op" id="6272926">.</span><span class="ident" id="6272927">m</span><span class="op" id="6272928">[</span><span class="ident" id="6272929">c</span><span class="op" id="6272930">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272933">if</span>&nbsp;<span class="ident" id="6272936">h</span>&nbsp;<span class="op" id="6272938">==</span>&nbsp;<span class="ident" id="6272941">nil</span>&nbsp;<span class="op" id="6272945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272949">return</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6272960">delete</span><span class="op" id="6272966">(</span><span class="ident" id="6272967">handlers</span><span class="op" id="6272975">.</span><span class="ident" id="6272976">m</span><span class="op" id="6272977">,</span>&nbsp;<span class="ident" id="6272979">c</span><span class="op" id="6272980">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272984">for</span>&nbsp;<span class="ident" id="6272988">n</span>&nbsp;<span class="op" id="6272990">:=</span>&nbsp;<span class="num" id="6272993">0</span><span class="op" id="6272994">;</span>&nbsp;<span class="ident" id="6272996">n</span>&nbsp;<span class="op" id="6272998">&lt;</span>&nbsp;<span class="ident" id="6273000">numSig</span><span class="op" id="6273006">;</span>&nbsp;<span class="ident" id="6273008">n</span><span class="op" id="6273009">++</span>&nbsp;<span class="op" id="6273012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273016">if</span>&nbsp;<span class="ident" id="6273019">h</span><span class="op" id="6273020">.</span><span class="ident" id="6273021">want</span><span class="op" id="6273025">(</span><span class="ident" id="6273026">n</span><span class="op" id="6273027">)</span>&nbsp;<span class="op" id="6273029">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273034">handlers</span><span class="op" id="6273042">.</span><span class="ident" id="6273043">ref</span><span class="op" id="6273046">[</span><span class="ident" id="6273047">n</span><span class="op" id="6273048">]</span><span class="op" id="6273049">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273055">if</span>&nbsp;<span class="ident" id="6273058">handlers</span><span class="op" id="6273066">.</span><span class="ident" id="6273067">ref</span><span class="op" id="6273070">[</span><span class="ident" id="6273071">n</span><span class="op" id="6273072">]</span>&nbsp;<span class="op" id="6273074">==</span>&nbsp;<span class="num" id="6273077">0</span>&nbsp;<span class="op" id="6273079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273085">disableSignal</span><span class="op" id="6273098">(</span><span class="ident" id="6273099">n</span><span class="op" id="6273100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6273105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6273109">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6273112">}</span><br>
<span class="lineno"></span><span class="op" id="6273114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6273117">func</span>&nbsp;<span class="ident" id="6273122">process</span><span class="op" id="6273129">(</span><span class="ident" id="6273130">sig</span>&nbsp;<span class="ident" id="6273134">os</span><span class="op" id="6273136">.</span><span class="ident" id="6273137">Signal</span><span class="op" id="6273143">)</span>&nbsp;<span class="op" id="6273145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273148">n</span>&nbsp;<span class="op" id="6273150">:=</span>&nbsp;<span class="ident" id="6273153">signum</span><span class="op" id="6273159">(</span><span class="ident" id="6273160">sig</span><span class="op" id="6273163">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273166">if</span>&nbsp;<span class="ident" id="6273169">n</span>&nbsp;<span class="op" id="6273171">&lt;</span>&nbsp;<span class="num" id="6273173">0</span>&nbsp;<span class="op" id="6273175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273179">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6273187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273191">handlers</span><span class="op" id="6273199">.</span><span class="ident" id="6273200">Lock</span><span class="op" id="6273204">(</span><span class="op" id="6273205">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273208">defer</span>&nbsp;<span class="ident" id="6273214">handlers</span><span class="op" id="6273222">.</span><span class="ident" id="6273223">Unlock</span><span class="op" id="6273229">(</span><span class="op" id="6273230">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273234">for</span>&nbsp;<span class="ident" id="6273238">c</span><span class="op" id="6273239">,</span>&nbsp;<span class="ident" id="6273241">h</span>&nbsp;<span class="op" id="6273243">:=</span>&nbsp;<span class="keyword" id="6273246">range</span>&nbsp;<span class="ident" id="6273252">handlers</span><span class="op" id="6273260">.</span><span class="ident" id="6273261">m</span>&nbsp;<span class="op" id="6273263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273267">if</span>&nbsp;<span class="ident" id="6273270">h</span><span class="op" id="6273271">.</span><span class="ident" id="6273272">want</span><span class="op" id="6273276">(</span><span class="ident" id="6273277">n</span><span class="op" id="6273278">)</span>&nbsp;<span class="op" id="6273280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6273285">//&nbsp;send&nbsp;but&nbsp;do&nbsp;not&nbsp;block&nbsp;for&nbsp;it</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273320">select</span>&nbsp;<span class="op" id="6273327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273332">case</span>&nbsp;<span class="ident" id="6273337">c</span>&nbsp;<span class="op" id="6273339">&lt;-</span>&nbsp;<span class="ident" id="6273342">sig</span><span class="op" id="6273345">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273350">default</span><span class="op" id="6273357">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6273362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6273366">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6273369">}</span><br>
<span class="lineno"></span><span class="op" id="6273371">}</span>
</div>
</body>
</html>
