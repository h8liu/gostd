<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8628503">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8628558">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8628612">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8628663">package</span>&nbsp;<span class="ident" id="8628671">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8628677">import</span>&nbsp;<span class="op" id="8628684">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8628687">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8628696">&#34;math&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8628704">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8628715">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8628726">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="8628736">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="8628739">type</span>&nbsp;<span class="ident" id="8628744">Optionals</span>&nbsp;<span class="keyword" id="8628754">struct</span>&nbsp;<span class="op" id="8628761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8628764">Sr</span>&nbsp;<span class="builtintype" id="8628767">string</span>&nbsp;<span class="string" id="8628774">`json:&#34;sr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8628787">So</span>&nbsp;<span class="builtintype" id="8628790">string</span>&nbsp;<span class="string" id="8628797">`json:&#34;so,omitempty&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8628820">Sw</span>&nbsp;<span class="builtintype" id="8628823">string</span>&nbsp;<span class="string" id="8628830">`json:&#34;-&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8628843">Ir</span>&nbsp;<span class="builtintype" id="8628846">int</span>&nbsp;<span class="string" id="8628850">`json:&#34;omitempty&#34;`</span>&nbsp;<span class="comment" id="8628869">//&nbsp;actually&nbsp;named&nbsp;omitempty,&nbsp;not&nbsp;an&nbsp;option</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8628913">Io</span>&nbsp;<span class="builtintype" id="8628916">int</span>&nbsp;<span class="string" id="8628920">`json:&#34;io,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8628944">Slr</span>&nbsp;<span class="op" id="8628948">[</span><span class="op" id="8628949">]</span><span class="builtintype" id="8628950">string</span>&nbsp;<span class="string" id="8628957">`json:&#34;slr,random&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8628978">Slo</span>&nbsp;<span class="op" id="8628982">[</span><span class="op" id="8628983">]</span><span class="builtintype" id="8628984">string</span>&nbsp;<span class="string" id="8628991">`json:&#34;slo,omitempty&#34;`</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8629016">Mr</span>&nbsp;<span class="keyword" id="8629019">map</span><span class="op" id="8629022">[</span><span class="builtintype" id="8629023">string</span><span class="op" id="8629029">]</span><span class="keyword" id="8629030">interface</span><span class="op" id="8629039">{</span><span class="op" id="8629040">}</span>&nbsp;<span class="string" id="8629042">`json:&#34;mr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8629055">Mo</span>&nbsp;<span class="keyword" id="8629058">map</span><span class="op" id="8629061">[</span><span class="builtintype" id="8629062">string</span><span class="op" id="8629068">]</span><span class="keyword" id="8629069">interface</span><span class="op" id="8629078">{</span><span class="op" id="8629079">}</span>&nbsp;<span class="string" id="8629081">`json:&#34;,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8629103">Fr</span>&nbsp;<span class="builtintype" id="8629106">float64</span>&nbsp;<span class="string" id="8629114">`json:&#34;fr&#34;`</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8629127">Fo</span>&nbsp;<span class="builtintype" id="8629130">float64</span>&nbsp;<span class="string" id="8629138">`json:&#34;fo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8629162">Br</span>&nbsp;<span class="builtintype" id="8629165">bool</span>&nbsp;<span class="string" id="8629170">`json:&#34;br&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8629183">Bo</span>&nbsp;<span class="builtintype" id="8629186">bool</span>&nbsp;<span class="string" id="8629191">`json:&#34;bo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8629215">Ur</span>&nbsp;<span class="builtintype" id="8629218">uint</span>&nbsp;<span class="string" id="8629223">`json:&#34;ur&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8629236">Uo</span>&nbsp;<span class="builtintype" id="8629239">uint</span>&nbsp;<span class="string" id="8629244">`json:&#34;uo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8629268">Str</span>&nbsp;<span class="keyword" id="8629272">struct</span><span class="op" id="8629278">{</span><span class="op" id="8629279">}</span>&nbsp;<span class="string" id="8629281">`json:&#34;str&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8629295">Sto</span>&nbsp;<span class="keyword" id="8629299">struct</span><span class="op" id="8629305">{</span><span class="op" id="8629306">}</span>&nbsp;<span class="string" id="8629308">`json:&#34;sto,omitempty&#34;`</span><br>
<span class="lineno">40</span><span class="op" id="8629331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8629334">var</span>&nbsp;<span class="ident" id="8629338">optionalsExpected</span>&nbsp;<span class="op" id="8629356">=</span>&nbsp;<span class="string" id="8629358">`{<br>
<span class="lineno"></span>&nbsp;&#34;sr&#34;:&nbsp;&#34;&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;omitempty&#34;:&nbsp;0,<br>
<span class="lineno">45</span>&nbsp;&#34;slr&#34;:&nbsp;null,<br>
<span class="lineno"></span>&nbsp;&#34;mr&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;fr&#34;:&nbsp;0,<br>
<span class="lineno"></span>&nbsp;&#34;br&#34;:&nbsp;false,<br>
<span class="lineno"></span>&nbsp;&#34;ur&#34;:&nbsp;0,<br>
<span class="lineno">50</span>&nbsp;&#34;str&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;sto&#34;:&nbsp;{}<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8629475">func</span>&nbsp;<span class="ident" id="8629480">TestOmitEmpty</span><span class="op" id="8629493">(</span><span class="ident" id="8629494">t</span>&nbsp;<span class="op" id="8629496">*</span><span class="ident" id="8629497">testing</span><span class="op" id="8629504">.</span><span class="ident" id="8629505">T</span><span class="op" id="8629506">)</span>&nbsp;<span class="op" id="8629508">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8629511">var</span>&nbsp;<span class="ident" id="8629515">o</span>&nbsp;<span class="ident" id="8629517">Optionals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8629528">o</span><span class="op" id="8629529">.</span><span class="ident" id="8629530">Sw</span>&nbsp;<span class="op" id="8629533">=</span>&nbsp;<span class="string" id="8629535">&#34;something&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8629548">o</span><span class="op" id="8629549">.</span><span class="ident" id="8629550">Mr</span>&nbsp;<span class="op" id="8629553">=</span>&nbsp;<span class="keyword" id="8629555">map</span><span class="op" id="8629558">[</span><span class="builtintype" id="8629559">string</span><span class="op" id="8629565">]</span><span class="keyword" id="8629566">interface</span><span class="op" id="8629575">{</span><span class="op" id="8629576">}</span><span class="op" id="8629577">{</span><span class="op" id="8629578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8629581">o</span><span class="op" id="8629582">.</span><span class="ident" id="8629583">Mo</span>&nbsp;<span class="op" id="8629586">=</span>&nbsp;<span class="keyword" id="8629588">map</span><span class="op" id="8629591">[</span><span class="builtintype" id="8629592">string</span><span class="op" id="8629598">]</span><span class="keyword" id="8629599">interface</span><span class="op" id="8629608">{</span><span class="op" id="8629609">}</span><span class="op" id="8629610">{</span><span class="op" id="8629611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8629615">got</span><span class="op" id="8629618">,</span>&nbsp;<span class="ident" id="8629620">err</span>&nbsp;<span class="op" id="8629624">:=</span>&nbsp;<span class="ident" id="8629627">MarshalIndent</span><span class="op" id="8629640">(</span><span class="op" id="8629641">&amp;</span><span class="ident" id="8629642">o</span><span class="op" id="8629643">,</span>&nbsp;<span class="string" id="8629645">&#34;&#34;</span><span class="op" id="8629647">,</span>&nbsp;<span class="string" id="8629649">&#34;&nbsp;&#34;</span><span class="op" id="8629652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8629655">if</span>&nbsp;<span class="ident" id="8629658">err</span>&nbsp;<span class="op" id="8629662">!=</span>&nbsp;<span class="ident" id="8629665">nil</span>&nbsp;<span class="op" id="8629669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8629673">t</span><span class="op" id="8629674">.</span><span class="ident" id="8629675">Fatal</span><span class="op" id="8629680">(</span><span class="ident" id="8629681">err</span><span class="op" id="8629684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8629687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8629690">if</span>&nbsp;<span class="ident" id="8629693">got</span>&nbsp;<span class="op" id="8629697">:=</span>&nbsp;<span class="builtintype" id="8629700">string</span><span class="op" id="8629706">(</span><span class="ident" id="8629707">got</span><span class="op" id="8629710">)</span><span class="op" id="8629711">;</span>&nbsp;<span class="ident" id="8629713">got</span>&nbsp;<span class="op" id="8629717">!=</span>&nbsp;<span class="ident" id="8629720">optionalsExpected</span>&nbsp;<span class="op" id="8629738">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8629742">t</span><span class="op" id="8629743">.</span><span class="ident" id="8629744">Errorf</span><span class="op" id="8629750">(</span><span class="string" id="8629751">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="8629773">,</span>&nbsp;<span class="ident" id="8629775">got</span><span class="op" id="8629778">,</span>&nbsp;<span class="ident" id="8629780">optionalsExpected</span><span class="op" id="8629797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8629800">}</span><br>
<span class="lineno"></span><span class="op" id="8629802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8629805">type</span>&nbsp;<span class="ident" id="8629810">StringTag</span>&nbsp;<span class="keyword" id="8629820">struct</span>&nbsp;<span class="op" id="8629827">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8629830">BoolStr</span>&nbsp;<span class="builtintype" id="8629838">bool</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8629845">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8629863">IntStr</span>&nbsp;&nbsp;<span class="ident" id="8629871">int64</span>&nbsp;&nbsp;<span class="string" id="8629878">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8629896">StrStr</span>&nbsp;&nbsp;<span class="builtintype" id="8629904">string</span>&nbsp;<span class="string" id="8629911">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span><span class="op" id="8629928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="8629931">var</span>&nbsp;<span class="ident" id="8629935">stringTagExpected</span>&nbsp;<span class="op" id="8629953">=</span>&nbsp;<span class="string" id="8629955">`{<br>
<span class="lineno"></span>&nbsp;&#34;BoolStr&#34;:&nbsp;&#34;true&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;IntStr&#34;:&nbsp;&#34;42&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;StrStr&#34;:&nbsp;&#34;\&#34;xzbit\&#34;&#34;<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="8630022">func</span>&nbsp;<span class="ident" id="8630027">TestStringTag</span><span class="op" id="8630040">(</span><span class="ident" id="8630041">t</span>&nbsp;<span class="op" id="8630043">*</span><span class="ident" id="8630044">testing</span><span class="op" id="8630051">.</span><span class="ident" id="8630052">T</span><span class="op" id="8630053">)</span>&nbsp;<span class="op" id="8630055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8630058">var</span>&nbsp;<span class="ident" id="8630062">s</span>&nbsp;<span class="ident" id="8630064">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8630075">s</span><span class="op" id="8630076">.</span><span class="ident" id="8630077">BoolStr</span>&nbsp;<span class="op" id="8630085">=</span>&nbsp;<span class="ident" id="8630087">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8630093">s</span><span class="op" id="8630094">.</span><span class="ident" id="8630095">IntStr</span>&nbsp;<span class="op" id="8630102">=</span>&nbsp;<span class="num" id="8630104">42</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8630108">s</span><span class="op" id="8630109">.</span><span class="ident" id="8630110">StrStr</span>&nbsp;<span class="op" id="8630117">=</span>&nbsp;<span class="string" id="8630119">&#34;xzbit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8630128">got</span><span class="op" id="8630131">,</span>&nbsp;<span class="ident" id="8630133">err</span>&nbsp;<span class="op" id="8630137">:=</span>&nbsp;<span class="ident" id="8630140">MarshalIndent</span><span class="op" id="8630153">(</span><span class="op" id="8630154">&amp;</span><span class="ident" id="8630155">s</span><span class="op" id="8630156">,</span>&nbsp;<span class="string" id="8630158">&#34;&#34;</span><span class="op" id="8630160">,</span>&nbsp;<span class="string" id="8630162">&#34;&nbsp;&#34;</span><span class="op" id="8630165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8630168">if</span>&nbsp;<span class="ident" id="8630171">err</span>&nbsp;<span class="op" id="8630175">!=</span>&nbsp;<span class="ident" id="8630178">nil</span>&nbsp;<span class="op" id="8630182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8630186">t</span><span class="op" id="8630187">.</span><span class="ident" id="8630188">Fatal</span><span class="op" id="8630193">(</span><span class="ident" id="8630194">err</span><span class="op" id="8630197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8630200">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8630203">if</span>&nbsp;<span class="ident" id="8630206">got</span>&nbsp;<span class="op" id="8630210">:=</span>&nbsp;<span class="builtintype" id="8630213">string</span><span class="op" id="8630219">(</span><span class="ident" id="8630220">got</span><span class="op" id="8630223">)</span><span class="op" id="8630224">;</span>&nbsp;<span class="ident" id="8630226">got</span>&nbsp;<span class="op" id="8630230">!=</span>&nbsp;<span class="ident" id="8630233">stringTagExpected</span>&nbsp;<span class="op" id="8630251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8630255">t</span><span class="op" id="8630256">.</span><span class="ident" id="8630257">Fatalf</span><span class="op" id="8630263">(</span><span class="string" id="8630264">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="8630286">,</span>&nbsp;<span class="ident" id="8630288">got</span><span class="op" id="8630291">,</span>&nbsp;<span class="ident" id="8630293">stringTagExpected</span><span class="op" id="8630310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8630313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8630317">//&nbsp;Verify&nbsp;that&nbsp;it&nbsp;round-trips.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8630349">var</span>&nbsp;<span class="ident" id="8630353">s2</span>&nbsp;<span class="ident" id="8630356">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8630367">err</span>&nbsp;<span class="op" id="8630371">=</span>&nbsp;<span class="ident" id="8630373">NewDecoder</span><span class="op" id="8630383">(</span><span class="ident" id="8630384">bytes</span><span class="op" id="8630389">.</span><span class="ident" id="8630390">NewReader</span><span class="op" id="8630399">(</span><span class="ident" id="8630400">got</span><span class="op" id="8630403">)</span><span class="op" id="8630404">)</span><span class="op" id="8630405">.</span><span class="ident" id="8630406">Decode</span><span class="op" id="8630412">(</span><span class="op" id="8630413">&amp;</span><span class="ident" id="8630414">s2</span><span class="op" id="8630416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8630419">if</span>&nbsp;<span class="ident" id="8630422">err</span>&nbsp;<span class="op" id="8630426">!=</span>&nbsp;<span class="ident" id="8630429">nil</span>&nbsp;<span class="op" id="8630433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8630437">t</span><span class="op" id="8630438">.</span><span class="ident" id="8630439">Fatalf</span><span class="op" id="8630445">(</span><span class="string" id="8630446">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="8630458">,</span>&nbsp;<span class="ident" id="8630460">err</span><span class="op" id="8630463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8630466">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8630469">if</span>&nbsp;<span class="op" id="8630472">!</span><span class="ident" id="8630473">reflect</span><span class="op" id="8630480">.</span><span class="ident" id="8630481">DeepEqual</span><span class="op" id="8630490">(</span><span class="ident" id="8630491">s</span><span class="op" id="8630492">,</span>&nbsp;<span class="ident" id="8630494">s2</span><span class="op" id="8630496">)</span>&nbsp;<span class="op" id="8630498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8630502">t</span><span class="op" id="8630503">.</span><span class="ident" id="8630504">Fatalf</span><span class="op" id="8630510">(</span><span class="string" id="8630511">&#34;decode&nbsp;didn&#39;t&nbsp;match.\nsource:&nbsp;%#v\nEncoded&nbsp;as:\n%s\ndecode:&nbsp;%#v&#34;</span><span class="op" id="8630576">,</span>&nbsp;<span class="ident" id="8630578">s</span><span class="op" id="8630579">,</span>&nbsp;<span class="builtintype" id="8630581">string</span><span class="op" id="8630587">(</span><span class="ident" id="8630588">got</span><span class="op" id="8630591">)</span><span class="op" id="8630592">,</span>&nbsp;<span class="ident" id="8630594">s2</span><span class="op" id="8630596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8630599">}</span><br>
<span class="lineno"></span><span class="op" id="8630601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="8630604">//&nbsp;byte&nbsp;slices&nbsp;are&nbsp;special&nbsp;even&nbsp;if&nbsp;they&#39;re&nbsp;renamed&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="8630662">type</span>&nbsp;<span class="ident" id="8630667">renamedByte</span>&nbsp;<span class="builtintype" id="8630679">byte</span><br>
<span class="lineno"></span><span class="keyword" id="8630684">type</span>&nbsp;<span class="ident" id="8630689">renamedByteSlice</span>&nbsp;<span class="op" id="8630706">[</span><span class="op" id="8630707">]</span><span class="builtintype" id="8630708">byte</span><br>
<span class="lineno"></span><span class="keyword" id="8630713">type</span>&nbsp;<span class="ident" id="8630718">renamedRenamedByteSlice</span>&nbsp;<span class="op" id="8630742">[</span><span class="op" id="8630743">]</span><span class="ident" id="8630744">renamedByte</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="8630757">func</span>&nbsp;<span class="ident" id="8630762">TestEncodeRenamedByteSlice</span><span class="op" id="8630788">(</span><span class="ident" id="8630789">t</span>&nbsp;<span class="op" id="8630791">*</span><span class="ident" id="8630792">testing</span><span class="op" id="8630799">.</span><span class="ident" id="8630800">T</span><span class="op" id="8630801">)</span>&nbsp;<span class="op" id="8630803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8630806">s</span>&nbsp;<span class="op" id="8630808">:=</span>&nbsp;<span class="ident" id="8630811">renamedByteSlice</span><span class="op" id="8630827">(</span><span class="string" id="8630828">&#34;abc&#34;</span><span class="op" id="8630833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8630836">result</span><span class="op" id="8630842">,</span>&nbsp;<span class="ident" id="8630844">err</span>&nbsp;<span class="op" id="8630848">:=</span>&nbsp;<span class="ident" id="8630851">Marshal</span><span class="op" id="8630858">(</span><span class="ident" id="8630859">s</span><span class="op" id="8630860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8630863">if</span>&nbsp;<span class="ident" id="8630866">err</span>&nbsp;<span class="op" id="8630870">!=</span>&nbsp;<span class="ident" id="8630873">nil</span>&nbsp;<span class="op" id="8630877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8630881">t</span><span class="op" id="8630882">.</span><span class="ident" id="8630883">Fatal</span><span class="op" id="8630888">(</span><span class="ident" id="8630889">err</span><span class="op" id="8630892">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8630895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8630898">expect</span>&nbsp;<span class="op" id="8630905">:=</span>&nbsp;<span class="string" id="8630908">`&#34;YWJj&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8630918">if</span>&nbsp;<span class="builtintype" id="8630921">string</span><span class="op" id="8630927">(</span><span class="ident" id="8630928">result</span><span class="op" id="8630934">)</span>&nbsp;<span class="op" id="8630936">!=</span>&nbsp;<span class="ident" id="8630939">expect</span>&nbsp;<span class="op" id="8630946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8630950">t</span><span class="op" id="8630951">.</span><span class="ident" id="8630952">Errorf</span><span class="op" id="8630958">(</span><span class="string" id="8630959">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8630976">,</span>&nbsp;<span class="ident" id="8630978">result</span><span class="op" id="8630984">,</span>&nbsp;<span class="ident" id="8630986">expect</span><span class="op" id="8630992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8630995">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8630998">r</span>&nbsp;<span class="op" id="8631000">:=</span>&nbsp;<span class="ident" id="8631003">renamedRenamedByteSlice</span><span class="op" id="8631026">(</span><span class="string" id="8631027">&#34;abc&#34;</span><span class="op" id="8631032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8631035">result</span><span class="op" id="8631041">,</span>&nbsp;<span class="ident" id="8631043">err</span>&nbsp;<span class="op" id="8631047">=</span>&nbsp;<span class="ident" id="8631049">Marshal</span><span class="op" id="8631056">(</span><span class="ident" id="8631057">r</span><span class="op" id="8631058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8631061">if</span>&nbsp;<span class="ident" id="8631064">err</span>&nbsp;<span class="op" id="8631068">!=</span>&nbsp;<span class="ident" id="8631071">nil</span>&nbsp;<span class="op" id="8631075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8631079">t</span><span class="op" id="8631080">.</span><span class="ident" id="8631081">Fatal</span><span class="op" id="8631086">(</span><span class="ident" id="8631087">err</span><span class="op" id="8631090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8631093">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8631096">if</span>&nbsp;<span class="builtintype" id="8631099">string</span><span class="op" id="8631105">(</span><span class="ident" id="8631106">result</span><span class="op" id="8631112">)</span>&nbsp;<span class="op" id="8631114">!=</span>&nbsp;<span class="ident" id="8631117">expect</span>&nbsp;<span class="op" id="8631124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8631128">t</span><span class="op" id="8631129">.</span><span class="ident" id="8631130">Errorf</span><span class="op" id="8631136">(</span><span class="string" id="8631137">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8631154">,</span>&nbsp;<span class="ident" id="8631156">result</span><span class="op" id="8631162">,</span>&nbsp;<span class="ident" id="8631164">expect</span><span class="op" id="8631170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8631173">}</span><br>
<span class="lineno"></span><span class="op" id="8631175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="8631178">var</span>&nbsp;<span class="ident" id="8631182">unsupportedValues</span>&nbsp;<span class="op" id="8631200">=</span>&nbsp;<span class="op" id="8631202">[</span><span class="op" id="8631203">]</span><span class="keyword" id="8631204">interface</span><span class="op" id="8631213">{</span><span class="op" id="8631214">}</span><span class="op" id="8631215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8631218">math</span><span class="op" id="8631222">.</span><span class="ident" id="8631223">NaN</span><span class="op" id="8631226">(</span><span class="op" id="8631227">)</span><span class="op" id="8631228">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8631231">math</span><span class="op" id="8631235">.</span><span class="ident" id="8631236">Inf</span><span class="op" id="8631239">(</span><span class="op" id="8631240">-</span><span class="num" id="8631241">1</span><span class="op" id="8631242">)</span><span class="op" id="8631243">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8631246">math</span><span class="op" id="8631250">.</span><span class="ident" id="8631251">Inf</span><span class="op" id="8631254">(</span><span class="num" id="8631255">1</span><span class="op" id="8631256">)</span><span class="op" id="8631257">,</span><br>
<span class="lineno"></span><span class="op" id="8631259">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="8631262">func</span>&nbsp;<span class="ident" id="8631267">TestUnsupportedValues</span><span class="op" id="8631288">(</span><span class="ident" id="8631289">t</span>&nbsp;<span class="op" id="8631291">*</span><span class="ident" id="8631292">testing</span><span class="op" id="8631299">.</span><span class="ident" id="8631300">T</span><span class="op" id="8631301">)</span>&nbsp;<span class="op" id="8631303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8631306">for</span>&nbsp;<span class="ident" id="8631310">_</span><span class="op" id="8631311">,</span>&nbsp;<span class="ident" id="8631313">v</span>&nbsp;<span class="op" id="8631315">:=</span>&nbsp;<span class="keyword" id="8631318">range</span>&nbsp;<span class="ident" id="8631324">unsupportedValues</span>&nbsp;<span class="op" id="8631342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8631346">if</span>&nbsp;<span class="ident" id="8631349">_</span><span class="op" id="8631350">,</span>&nbsp;<span class="ident" id="8631352">err</span>&nbsp;<span class="op" id="8631356">:=</span>&nbsp;<span class="ident" id="8631359">Marshal</span><span class="op" id="8631366">(</span><span class="ident" id="8631367">v</span><span class="op" id="8631368">)</span><span class="op" id="8631369">;</span>&nbsp;<span class="ident" id="8631371">err</span>&nbsp;<span class="op" id="8631375">!=</span>&nbsp;<span class="ident" id="8631378">nil</span>&nbsp;<span class="op" id="8631382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8631387">if</span>&nbsp;<span class="ident" id="8631390">_</span><span class="op" id="8631391">,</span>&nbsp;<span class="ident" id="8631393">ok</span>&nbsp;<span class="op" id="8631396">:=</span>&nbsp;<span class="ident" id="8631399">err</span><span class="op" id="8631402">.</span><span class="op" id="8631403">(</span><span class="op" id="8631404">*</span><span class="ident" id="8631405">UnsupportedValueError</span><span class="op" id="8631426">)</span><span class="op" id="8631427">;</span>&nbsp;<span class="op" id="8631429">!</span><span class="ident" id="8631430">ok</span>&nbsp;<span class="op" id="8631433">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8631439">t</span><span class="op" id="8631440">.</span><span class="ident" id="8631441">Errorf</span><span class="op" id="8631447">(</span><span class="string" id="8631448">&#34;for&nbsp;%v,&nbsp;got&nbsp;%T&nbsp;want&nbsp;UnsupportedValueError&#34;</span><span class="op" id="8631491">,</span>&nbsp;<span class="ident" id="8631493">v</span><span class="op" id="8631494">,</span>&nbsp;<span class="ident" id="8631496">err</span><span class="op" id="8631499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8631504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8631508">}</span>&nbsp;<span class="keyword" id="8631510">else</span>&nbsp;<span class="op" id="8631515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8631520">t</span><span class="op" id="8631521">.</span><span class="ident" id="8631522">Errorf</span><span class="op" id="8631528">(</span><span class="string" id="8631529">&#34;for&nbsp;%v,&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8631553">,</span>&nbsp;<span class="ident" id="8631555">v</span><span class="op" id="8631556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8631560">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8631563">}</span><br>
<span class="lineno"></span><span class="op" id="8631565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8631568">//&nbsp;Ref&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="8631636">type</span>&nbsp;<span class="ident" id="8631641">Ref</span>&nbsp;<span class="builtintype" id="8631645">int</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="8631650">func</span>&nbsp;<span class="op" id="8631655">(</span><span class="op" id="8631656">*</span><span class="ident" id="8631657">Ref</span><span class="op" id="8631660">)</span>&nbsp;<span class="ident" id="8631662">MarshalJSON</span><span class="op" id="8631673">(</span><span class="op" id="8631674">)</span>&nbsp;<span class="op" id="8631676">(</span><span class="op" id="8631677">[</span><span class="op" id="8631678">]</span><span class="builtintype" id="8631679">byte</span><span class="op" id="8631683">,</span>&nbsp;<span class="builtintype" id="8631685">error</span><span class="op" id="8631690">)</span>&nbsp;<span class="op" id="8631692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8631695">return</span>&nbsp;<span class="op" id="8631702">[</span><span class="op" id="8631703">]</span><span class="builtintype" id="8631704">byte</span><span class="op" id="8631708">(</span><span class="string" id="8631709">`&#34;ref&#34;`</span><span class="op" id="8631716">)</span><span class="op" id="8631717">,</span>&nbsp;<span class="ident" id="8631719">nil</span><br>
<span class="lineno"></span><span class="op" id="8631723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="8631726">func</span>&nbsp;<span class="op" id="8631731">(</span><span class="ident" id="8631732">r</span>&nbsp;<span class="op" id="8631734">*</span><span class="ident" id="8631735">Ref</span><span class="op" id="8631738">)</span>&nbsp;<span class="ident" id="8631740">UnmarshalJSON</span><span class="op" id="8631753">(</span><span class="op" id="8631754">[</span><span class="op" id="8631755">]</span><span class="builtintype" id="8631756">byte</span><span class="op" id="8631760">)</span>&nbsp;<span class="builtintype" id="8631762">error</span>&nbsp;<span class="op" id="8631768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8631771">*</span><span class="ident" id="8631772">r</span>&nbsp;<span class="op" id="8631774">=</span>&nbsp;<span class="num" id="8631776">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8631780">return</span>&nbsp;<span class="ident" id="8631787">nil</span><br>
<span class="lineno"></span><span class="op" id="8631791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="8631794">//&nbsp;Val&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="8631844">type</span>&nbsp;<span class="ident" id="8631849">Val</span>&nbsp;<span class="builtintype" id="8631853">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8631858">func</span>&nbsp;<span class="op" id="8631863">(</span><span class="ident" id="8631864">Val</span><span class="op" id="8631867">)</span>&nbsp;<span class="ident" id="8631869">MarshalJSON</span><span class="op" id="8631880">(</span><span class="op" id="8631881">)</span>&nbsp;<span class="op" id="8631883">(</span><span class="op" id="8631884">[</span><span class="op" id="8631885">]</span><span class="builtintype" id="8631886">byte</span><span class="op" id="8631890">,</span>&nbsp;<span class="builtintype" id="8631892">error</span><span class="op" id="8631897">)</span>&nbsp;<span class="op" id="8631899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8631902">return</span>&nbsp;<span class="op" id="8631909">[</span><span class="op" id="8631910">]</span><span class="builtintype" id="8631911">byte</span><span class="op" id="8631915">(</span><span class="string" id="8631916">`&#34;val&#34;`</span><span class="op" id="8631923">)</span><span class="op" id="8631924">,</span>&nbsp;<span class="ident" id="8631926">nil</span><br>
<span class="lineno">165</span><span class="op" id="8631930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8631933">//&nbsp;RefText&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="8632005">type</span>&nbsp;<span class="ident" id="8632010">RefText</span>&nbsp;<span class="builtintype" id="8632018">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="8632023">func</span>&nbsp;<span class="op" id="8632028">(</span><span class="op" id="8632029">*</span><span class="ident" id="8632030">RefText</span><span class="op" id="8632037">)</span>&nbsp;<span class="ident" id="8632039">MarshalText</span><span class="op" id="8632050">(</span><span class="op" id="8632051">)</span>&nbsp;<span class="op" id="8632053">(</span><span class="op" id="8632054">[</span><span class="op" id="8632055">]</span><span class="builtintype" id="8632056">byte</span><span class="op" id="8632060">,</span>&nbsp;<span class="builtintype" id="8632062">error</span><span class="op" id="8632067">)</span>&nbsp;<span class="op" id="8632069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8632072">return</span>&nbsp;<span class="op" id="8632079">[</span><span class="op" id="8632080">]</span><span class="builtintype" id="8632081">byte</span><span class="op" id="8632085">(</span><span class="string" id="8632086">`&#34;ref&#34;`</span><span class="op" id="8632093">)</span><span class="op" id="8632094">,</span>&nbsp;<span class="ident" id="8632096">nil</span><br>
<span class="lineno"></span><span class="op" id="8632100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8632103">func</span>&nbsp;<span class="op" id="8632108">(</span><span class="ident" id="8632109">r</span>&nbsp;<span class="op" id="8632111">*</span><span class="ident" id="8632112">RefText</span><span class="op" id="8632119">)</span>&nbsp;<span class="ident" id="8632121">UnmarshalText</span><span class="op" id="8632134">(</span><span class="op" id="8632135">[</span><span class="op" id="8632136">]</span><span class="builtintype" id="8632137">byte</span><span class="op" id="8632141">)</span>&nbsp;<span class="builtintype" id="8632143">error</span>&nbsp;<span class="op" id="8632149">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8632152">*</span><span class="ident" id="8632153">r</span>&nbsp;<span class="op" id="8632155">=</span>&nbsp;<span class="num" id="8632157">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8632161">return</span>&nbsp;<span class="ident" id="8632168">nil</span><br>
<span class="lineno"></span><span class="op" id="8632172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8632175">//&nbsp;ValText&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno">180</span><span class="keyword" id="8632229">type</span>&nbsp;<span class="ident" id="8632234">ValText</span>&nbsp;<span class="builtintype" id="8632242">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8632247">func</span>&nbsp;<span class="op" id="8632252">(</span><span class="ident" id="8632253">ValText</span><span class="op" id="8632260">)</span>&nbsp;<span class="ident" id="8632262">MarshalText</span><span class="op" id="8632273">(</span><span class="op" id="8632274">)</span>&nbsp;<span class="op" id="8632276">(</span><span class="op" id="8632277">[</span><span class="op" id="8632278">]</span><span class="builtintype" id="8632279">byte</span><span class="op" id="8632283">,</span>&nbsp;<span class="builtintype" id="8632285">error</span><span class="op" id="8632290">)</span>&nbsp;<span class="op" id="8632292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8632295">return</span>&nbsp;<span class="op" id="8632302">[</span><span class="op" id="8632303">]</span><span class="builtintype" id="8632304">byte</span><span class="op" id="8632308">(</span><span class="string" id="8632309">`&#34;val&#34;`</span><span class="op" id="8632316">)</span><span class="op" id="8632317">,</span>&nbsp;<span class="ident" id="8632319">nil</span><br>
<span class="lineno"></span><span class="op" id="8632323">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="8632326">func</span>&nbsp;<span class="ident" id="8632331">TestRefValMarshal</span><span class="op" id="8632348">(</span><span class="ident" id="8632349">t</span>&nbsp;<span class="op" id="8632351">*</span><span class="ident" id="8632352">testing</span><span class="op" id="8632359">.</span><span class="ident" id="8632360">T</span><span class="op" id="8632361">)</span>&nbsp;<span class="op" id="8632363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8632366">var</span>&nbsp;<span class="ident" id="8632370">s</span>&nbsp;<span class="op" id="8632372">=</span>&nbsp;<span class="keyword" id="8632374">struct</span>&nbsp;<span class="op" id="8632381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8632385">R0</span>&nbsp;<span class="ident" id="8632388">Ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8632394">R1</span>&nbsp;<span class="op" id="8632397">*</span><span class="ident" id="8632398">Ref</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8632404">R2</span>&nbsp;<span class="ident" id="8632407">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8632417">R3</span>&nbsp;<span class="op" id="8632420">*</span><span class="ident" id="8632421">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8632431">V0</span>&nbsp;<span class="ident" id="8632434">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8632440">V1</span>&nbsp;<span class="op" id="8632443">*</span><span class="ident" id="8632444">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8632450">V2</span>&nbsp;<span class="ident" id="8632453">ValText</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8632463">V3</span>&nbsp;<span class="op" id="8632466">*</span><span class="ident" id="8632467">ValText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8632476">}</span><span class="op" id="8632477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8632481">R0</span><span class="op" id="8632483">:</span>&nbsp;<span class="num" id="8632485">12</span><span class="op" id="8632487">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8632491">R1</span><span class="op" id="8632493">:</span>&nbsp;<span class="builtinfunc" id="8632495">new</span><span class="op" id="8632498">(</span><span class="ident" id="8632499">Ref</span><span class="op" id="8632502">)</span><span class="op" id="8632503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8632507">R2</span><span class="op" id="8632509">:</span>&nbsp;<span class="num" id="8632511">14</span><span class="op" id="8632513">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8632517">R3</span><span class="op" id="8632519">:</span>&nbsp;<span class="builtinfunc" id="8632521">new</span><span class="op" id="8632524">(</span><span class="ident" id="8632525">RefText</span><span class="op" id="8632532">)</span><span class="op" id="8632533">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8632537">V0</span><span class="op" id="8632539">:</span>&nbsp;<span class="num" id="8632541">13</span><span class="op" id="8632543">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8632547">V1</span><span class="op" id="8632549">:</span>&nbsp;<span class="builtinfunc" id="8632551">new</span><span class="op" id="8632554">(</span><span class="ident" id="8632555">Val</span><span class="op" id="8632558">)</span><span class="op" id="8632559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8632563">V2</span><span class="op" id="8632565">:</span>&nbsp;<span class="num" id="8632567">15</span><span class="op" id="8632569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8632573">V3</span><span class="op" id="8632575">:</span>&nbsp;<span class="builtinfunc" id="8632577">new</span><span class="op" id="8632580">(</span><span class="ident" id="8632581">ValText</span><span class="op" id="8632588">)</span><span class="op" id="8632589">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8632592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8632595">const</span>&nbsp;<span class="ident" id="8632601">want</span>&nbsp;<span class="op" id="8632606">=</span>&nbsp;<span class="string" id="8632608">`{&#34;R0&#34;:&#34;ref&#34;,&#34;R1&#34;:&#34;ref&#34;,&#34;R2&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;R3&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;V0&#34;:&#34;val&#34;,&#34;V1&#34;:&#34;val&#34;,&#34;V2&#34;:&#34;\&#34;val\&#34;&#34;,&#34;V3&#34;:&#34;\&#34;val\&#34;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8632717">b</span><span class="op" id="8632718">,</span>&nbsp;<span class="ident" id="8632720">err</span>&nbsp;<span class="op" id="8632724">:=</span>&nbsp;<span class="ident" id="8632727">Marshal</span><span class="op" id="8632734">(</span><span class="op" id="8632735">&amp;</span><span class="ident" id="8632736">s</span><span class="op" id="8632737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8632740">if</span>&nbsp;<span class="ident" id="8632743">err</span>&nbsp;<span class="op" id="8632747">!=</span>&nbsp;<span class="ident" id="8632750">nil</span>&nbsp;<span class="op" id="8632754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8632758">t</span><span class="op" id="8632759">.</span><span class="ident" id="8632760">Fatalf</span><span class="op" id="8632766">(</span><span class="string" id="8632767">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="8632780">,</span>&nbsp;<span class="ident" id="8632782">err</span><span class="op" id="8632785">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8632788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8632791">if</span>&nbsp;<span class="ident" id="8632794">got</span>&nbsp;<span class="op" id="8632798">:=</span>&nbsp;<span class="builtintype" id="8632801">string</span><span class="op" id="8632807">(</span><span class="ident" id="8632808">b</span><span class="op" id="8632809">)</span><span class="op" id="8632810">;</span>&nbsp;<span class="ident" id="8632812">got</span>&nbsp;<span class="op" id="8632816">!=</span>&nbsp;<span class="ident" id="8632819">want</span>&nbsp;<span class="op" id="8632824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8632828">t</span><span class="op" id="8632829">.</span><span class="ident" id="8632830">Errorf</span><span class="op" id="8632836">(</span><span class="string" id="8632837">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8632854">,</span>&nbsp;<span class="ident" id="8632856">got</span><span class="op" id="8632859">,</span>&nbsp;<span class="ident" id="8632861">want</span><span class="op" id="8632865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8632868">}</span><br>
<span class="lineno"></span><span class="op" id="8632870">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="8632873">//&nbsp;C&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="keyword" id="8632927">type</span>&nbsp;<span class="ident" id="8632932">C</span>&nbsp;<span class="builtintype" id="8632934">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8632939">func</span>&nbsp;<span class="op" id="8632944">(</span><span class="ident" id="8632945">C</span><span class="op" id="8632946">)</span>&nbsp;<span class="ident" id="8632948">MarshalJSON</span><span class="op" id="8632959">(</span><span class="op" id="8632960">)</span>&nbsp;<span class="op" id="8632962">(</span><span class="op" id="8632963">[</span><span class="op" id="8632964">]</span><span class="builtintype" id="8632965">byte</span><span class="op" id="8632969">,</span>&nbsp;<span class="builtintype" id="8632971">error</span><span class="op" id="8632976">)</span>&nbsp;<span class="op" id="8632978">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8632981">return</span>&nbsp;<span class="op" id="8632988">[</span><span class="op" id="8632989">]</span><span class="builtintype" id="8632990">byte</span><span class="op" id="8632994">(</span><span class="string" id="8632995">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="8633002">)</span><span class="op" id="8633003">,</span>&nbsp;<span class="ident" id="8633005">nil</span><br>
<span class="lineno"></span><span class="op" id="8633009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8633012">//&nbsp;CText&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="8633070">type</span>&nbsp;<span class="ident" id="8633075">CText</span>&nbsp;<span class="builtintype" id="8633081">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="8633086">func</span>&nbsp;<span class="op" id="8633091">(</span><span class="ident" id="8633092">CText</span><span class="op" id="8633097">)</span>&nbsp;<span class="ident" id="8633099">MarshalText</span><span class="op" id="8633110">(</span><span class="op" id="8633111">)</span>&nbsp;<span class="op" id="8633113">(</span><span class="op" id="8633114">[</span><span class="op" id="8633115">]</span><span class="builtintype" id="8633116">byte</span><span class="op" id="8633120">,</span>&nbsp;<span class="builtintype" id="8633122">error</span><span class="op" id="8633127">)</span>&nbsp;<span class="op" id="8633129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8633132">return</span>&nbsp;<span class="op" id="8633139">[</span><span class="op" id="8633140">]</span><span class="builtintype" id="8633141">byte</span><span class="op" id="8633145">(</span><span class="string" id="8633146">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="8633153">)</span><span class="op" id="8633154">,</span>&nbsp;<span class="ident" id="8633156">nil</span><br>
<span class="lineno"></span><span class="op" id="8633160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="8633163">func</span>&nbsp;<span class="ident" id="8633168">TestMarshalerEscaping</span><span class="op" id="8633189">(</span><span class="ident" id="8633190">t</span>&nbsp;<span class="op" id="8633192">*</span><span class="ident" id="8633193">testing</span><span class="op" id="8633200">.</span><span class="ident" id="8633201">T</span><span class="op" id="8633202">)</span>&nbsp;<span class="op" id="8633204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8633207">var</span>&nbsp;<span class="ident" id="8633211">c</span>&nbsp;<span class="ident" id="8633213">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8633216">want</span>&nbsp;<span class="op" id="8633221">:=</span>&nbsp;<span class="string" id="8633224">`&#34;\u003c\u0026\u003e&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8633248">b</span><span class="op" id="8633249">,</span>&nbsp;<span class="ident" id="8633251">err</span>&nbsp;<span class="op" id="8633255">:=</span>&nbsp;<span class="ident" id="8633258">Marshal</span><span class="op" id="8633265">(</span><span class="ident" id="8633266">c</span><span class="op" id="8633267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8633270">if</span>&nbsp;<span class="ident" id="8633273">err</span>&nbsp;<span class="op" id="8633277">!=</span>&nbsp;<span class="ident" id="8633280">nil</span>&nbsp;<span class="op" id="8633284">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8633288">t</span><span class="op" id="8633289">.</span><span class="ident" id="8633290">Fatalf</span><span class="op" id="8633296">(</span><span class="string" id="8633297">&#34;Marshal(c):&nbsp;%v&#34;</span><span class="op" id="8633313">,</span>&nbsp;<span class="ident" id="8633315">err</span><span class="op" id="8633318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8633321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8633324">if</span>&nbsp;<span class="ident" id="8633327">got</span>&nbsp;<span class="op" id="8633331">:=</span>&nbsp;<span class="builtintype" id="8633334">string</span><span class="op" id="8633340">(</span><span class="ident" id="8633341">b</span><span class="op" id="8633342">)</span><span class="op" id="8633343">;</span>&nbsp;<span class="ident" id="8633345">got</span>&nbsp;<span class="op" id="8633349">!=</span>&nbsp;<span class="ident" id="8633352">want</span>&nbsp;<span class="op" id="8633357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8633361">t</span><span class="op" id="8633362">.</span><span class="ident" id="8633363">Errorf</span><span class="op" id="8633369">(</span><span class="string" id="8633370">&#34;Marshal(c)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8633398">,</span>&nbsp;<span class="ident" id="8633400">got</span><span class="op" id="8633403">,</span>&nbsp;<span class="ident" id="8633405">want</span><span class="op" id="8633409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8633412">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8633416">var</span>&nbsp;<span class="ident" id="8633420">ct</span>&nbsp;<span class="ident" id="8633423">CText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8633430">want</span>&nbsp;<span class="op" id="8633435">=</span>&nbsp;<span class="string" id="8633437">`&#34;\&#34;\u003c\u0026\u003e\&#34;&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8633465">b</span><span class="op" id="8633466">,</span>&nbsp;<span class="ident" id="8633468">err</span>&nbsp;<span class="op" id="8633472">=</span>&nbsp;<span class="ident" id="8633474">Marshal</span><span class="op" id="8633481">(</span><span class="ident" id="8633482">ct</span><span class="op" id="8633484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8633487">if</span>&nbsp;<span class="ident" id="8633490">err</span>&nbsp;<span class="op" id="8633494">!=</span>&nbsp;<span class="ident" id="8633497">nil</span>&nbsp;<span class="op" id="8633501">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8633505">t</span><span class="op" id="8633506">.</span><span class="ident" id="8633507">Fatalf</span><span class="op" id="8633513">(</span><span class="string" id="8633514">&#34;Marshal(ct):&nbsp;%v&#34;</span><span class="op" id="8633531">,</span>&nbsp;<span class="ident" id="8633533">err</span><span class="op" id="8633536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8633539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8633542">if</span>&nbsp;<span class="ident" id="8633545">got</span>&nbsp;<span class="op" id="8633549">:=</span>&nbsp;<span class="builtintype" id="8633552">string</span><span class="op" id="8633558">(</span><span class="ident" id="8633559">b</span><span class="op" id="8633560">)</span><span class="op" id="8633561">;</span>&nbsp;<span class="ident" id="8633563">got</span>&nbsp;<span class="op" id="8633567">!=</span>&nbsp;<span class="ident" id="8633570">want</span>&nbsp;<span class="op" id="8633575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8633579">t</span><span class="op" id="8633580">.</span><span class="ident" id="8633581">Errorf</span><span class="op" id="8633587">(</span><span class="string" id="8633588">&#34;Marshal(ct)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8633617">,</span>&nbsp;<span class="ident" id="8633619">got</span><span class="op" id="8633622">,</span>&nbsp;<span class="ident" id="8633624">want</span><span class="op" id="8633628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8633631">}</span><br>
<span class="lineno">250</span><span class="op" id="8633633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8633636">type</span>&nbsp;<span class="ident" id="8633641">IntType</span>&nbsp;<span class="builtintype" id="8633649">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8633654">type</span>&nbsp;<span class="ident" id="8633659">MyStruct</span>&nbsp;<span class="keyword" id="8633668">struct</span>&nbsp;<span class="op" id="8633675">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8633678">IntType</span><br>
<span class="lineno"></span><span class="op" id="8633686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8633689">func</span>&nbsp;<span class="ident" id="8633694">TestAnonymousNonstruct</span><span class="op" id="8633716">(</span><span class="ident" id="8633717">t</span>&nbsp;<span class="op" id="8633719">*</span><span class="ident" id="8633720">testing</span><span class="op" id="8633727">.</span><span class="ident" id="8633728">T</span><span class="op" id="8633729">)</span>&nbsp;<span class="op" id="8633731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8633734">var</span>&nbsp;<span class="ident" id="8633738">i</span>&nbsp;<span class="ident" id="8633740">IntType</span>&nbsp;<span class="op" id="8633748">=</span>&nbsp;<span class="num" id="8633750">11</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8633754">a</span>&nbsp;<span class="op" id="8633756">:=</span>&nbsp;<span class="ident" id="8633759">MyStruct</span><span class="op" id="8633767">{</span><span class="ident" id="8633768">i</span><span class="op" id="8633769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8633772">const</span>&nbsp;<span class="ident" id="8633778">want</span>&nbsp;<span class="op" id="8633783">=</span>&nbsp;<span class="string" id="8633785">`{&#34;IntType&#34;:11}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8633804">b</span><span class="op" id="8633805">,</span>&nbsp;<span class="ident" id="8633807">err</span>&nbsp;<span class="op" id="8633811">:=</span>&nbsp;<span class="ident" id="8633814">Marshal</span><span class="op" id="8633821">(</span><span class="ident" id="8633822">a</span><span class="op" id="8633823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8633826">if</span>&nbsp;<span class="ident" id="8633829">err</span>&nbsp;<span class="op" id="8633833">!=</span>&nbsp;<span class="ident" id="8633836">nil</span>&nbsp;<span class="op" id="8633840">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8633844">t</span><span class="op" id="8633845">.</span><span class="ident" id="8633846">Fatalf</span><span class="op" id="8633852">(</span><span class="string" id="8633853">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="8633866">,</span>&nbsp;<span class="ident" id="8633868">err</span><span class="op" id="8633871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8633874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8633877">if</span>&nbsp;<span class="ident" id="8633880">got</span>&nbsp;<span class="op" id="8633884">:=</span>&nbsp;<span class="builtintype" id="8633887">string</span><span class="op" id="8633893">(</span><span class="ident" id="8633894">b</span><span class="op" id="8633895">)</span><span class="op" id="8633896">;</span>&nbsp;<span class="ident" id="8633898">got</span>&nbsp;<span class="op" id="8633902">!=</span>&nbsp;<span class="ident" id="8633905">want</span>&nbsp;<span class="op" id="8633910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8633914">t</span><span class="op" id="8633915">.</span><span class="ident" id="8633916">Errorf</span><span class="op" id="8633922">(</span><span class="string" id="8633923">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8633940">,</span>&nbsp;<span class="ident" id="8633942">got</span><span class="op" id="8633945">,</span>&nbsp;<span class="ident" id="8633947">want</span><span class="op" id="8633951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8633954">}</span><br>
<span class="lineno">270</span><span class="op" id="8633956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8633959">type</span>&nbsp;<span class="ident" id="8633964">BugA</span>&nbsp;<span class="keyword" id="8633969">struct</span>&nbsp;<span class="op" id="8633976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8633979">S</span>&nbsp;<span class="builtintype" id="8633981">string</span><br>
<span class="lineno"></span><span class="op" id="8633988">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="8633991">type</span>&nbsp;<span class="ident" id="8633996">BugB</span>&nbsp;<span class="keyword" id="8634001">struct</span>&nbsp;<span class="op" id="8634008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634011">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634017">S</span>&nbsp;<span class="builtintype" id="8634019">string</span><br>
<span class="lineno"></span><span class="op" id="8634026">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="8634029">type</span>&nbsp;<span class="ident" id="8634034">BugC</span>&nbsp;<span class="keyword" id="8634039">struct</span>&nbsp;<span class="op" id="8634046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634049">S</span>&nbsp;<span class="builtintype" id="8634051">string</span><br>
<span class="lineno"></span><span class="op" id="8634058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="8634061">//&nbsp;Legal&nbsp;Go:&nbsp;We&nbsp;never&nbsp;use&nbsp;the&nbsp;repeated&nbsp;embedded&nbsp;field&nbsp;(S).</span><br>
<span class="lineno"></span><span class="keyword" id="8634120">type</span>&nbsp;<span class="ident" id="8634125">BugX</span>&nbsp;<span class="keyword" id="8634130">struct</span>&nbsp;<span class="op" id="8634137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634140">A</span>&nbsp;<span class="builtintype" id="8634142">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634147">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634153">BugB</span><br>
<span class="lineno">290</span><span class="op" id="8634158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8634161">//&nbsp;Issue&nbsp;5245.</span><br>
<span class="lineno"></span><span class="keyword" id="8634176">func</span>&nbsp;<span class="ident" id="8634181">TestEmbeddedBug</span><span class="op" id="8634196">(</span><span class="ident" id="8634197">t</span>&nbsp;<span class="op" id="8634199">*</span><span class="ident" id="8634200">testing</span><span class="op" id="8634207">.</span><span class="ident" id="8634208">T</span><span class="op" id="8634209">)</span>&nbsp;<span class="op" id="8634211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634214">v</span>&nbsp;<span class="op" id="8634216">:=</span>&nbsp;<span class="ident" id="8634219">BugB</span><span class="op" id="8634223">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634227">BugA</span><span class="op" id="8634231">{</span><span class="string" id="8634232">&#34;A&#34;</span><span class="op" id="8634235">}</span><span class="op" id="8634236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8634240">&#34;B&#34;</span><span class="op" id="8634243">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8634246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634249">b</span><span class="op" id="8634250">,</span>&nbsp;<span class="ident" id="8634252">err</span>&nbsp;<span class="op" id="8634256">:=</span>&nbsp;<span class="ident" id="8634259">Marshal</span><span class="op" id="8634266">(</span><span class="ident" id="8634267">v</span><span class="op" id="8634268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8634271">if</span>&nbsp;<span class="ident" id="8634274">err</span>&nbsp;<span class="op" id="8634278">!=</span>&nbsp;<span class="ident" id="8634281">nil</span>&nbsp;<span class="op" id="8634285">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634289">t</span><span class="op" id="8634290">.</span><span class="ident" id="8634291">Fatal</span><span class="op" id="8634296">(</span><span class="string" id="8634297">&#34;Marshal:&#34;</span><span class="op" id="8634307">,</span>&nbsp;<span class="ident" id="8634309">err</span><span class="op" id="8634312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8634315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634318">want</span>&nbsp;<span class="op" id="8634323">:=</span>&nbsp;<span class="string" id="8634326">`{&#34;S&#34;:&#34;B&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634339">got</span>&nbsp;<span class="op" id="8634343">:=</span>&nbsp;<span class="builtintype" id="8634346">string</span><span class="op" id="8634352">(</span><span class="ident" id="8634353">b</span><span class="op" id="8634354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8634357">if</span>&nbsp;<span class="ident" id="8634360">got</span>&nbsp;<span class="op" id="8634364">!=</span>&nbsp;<span class="ident" id="8634367">want</span>&nbsp;<span class="op" id="8634372">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634376">t</span><span class="op" id="8634377">.</span><span class="ident" id="8634378">Fatalf</span><span class="op" id="8634384">(</span><span class="string" id="8634385">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8634410">,</span>&nbsp;<span class="ident" id="8634412">got</span><span class="op" id="8634415">,</span>&nbsp;<span class="ident" id="8634417">want</span><span class="op" id="8634421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8634424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8634427">//&nbsp;Now&nbsp;check&nbsp;that&nbsp;the&nbsp;duplicate&nbsp;field,&nbsp;S,&nbsp;does&nbsp;not&nbsp;appear.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634487">x</span>&nbsp;<span class="op" id="8634489">:=</span>&nbsp;<span class="ident" id="8634492">BugX</span><span class="op" id="8634496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634500">A</span><span class="op" id="8634501">:</span>&nbsp;<span class="num" id="8634503">23</span><span class="op" id="8634505">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8634508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634511">b</span><span class="op" id="8634512">,</span>&nbsp;<span class="ident" id="8634514">err</span>&nbsp;<span class="op" id="8634518">=</span>&nbsp;<span class="ident" id="8634520">Marshal</span><span class="op" id="8634527">(</span><span class="ident" id="8634528">x</span><span class="op" id="8634529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8634532">if</span>&nbsp;<span class="ident" id="8634535">err</span>&nbsp;<span class="op" id="8634539">!=</span>&nbsp;<span class="ident" id="8634542">nil</span>&nbsp;<span class="op" id="8634546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634550">t</span><span class="op" id="8634551">.</span><span class="ident" id="8634552">Fatal</span><span class="op" id="8634557">(</span><span class="string" id="8634558">&#34;Marshal:&#34;</span><span class="op" id="8634568">,</span>&nbsp;<span class="ident" id="8634570">err</span><span class="op" id="8634573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8634576">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634579">want</span>&nbsp;<span class="op" id="8634584">=</span>&nbsp;<span class="string" id="8634586">`{&#34;A&#34;:23}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634598">got</span>&nbsp;<span class="op" id="8634602">=</span>&nbsp;<span class="builtintype" id="8634604">string</span><span class="op" id="8634610">(</span><span class="ident" id="8634611">b</span><span class="op" id="8634612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8634615">if</span>&nbsp;<span class="ident" id="8634618">got</span>&nbsp;<span class="op" id="8634622">!=</span>&nbsp;<span class="ident" id="8634625">want</span>&nbsp;<span class="op" id="8634630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634634">t</span><span class="op" id="8634635">.</span><span class="ident" id="8634636">Fatalf</span><span class="op" id="8634642">(</span><span class="string" id="8634643">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8634668">,</span>&nbsp;<span class="ident" id="8634670">got</span><span class="op" id="8634673">,</span>&nbsp;<span class="ident" id="8634675">want</span><span class="op" id="8634679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8634682">}</span><br>
<span class="lineno">320</span><span class="op" id="8634684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8634687">type</span>&nbsp;<span class="ident" id="8634692">BugD</span>&nbsp;<span class="keyword" id="8634697">struct</span>&nbsp;<span class="op" id="8634704">{</span>&nbsp;<span class="comment" id="8634706">//&nbsp;Same&nbsp;as&nbsp;BugA&nbsp;after&nbsp;tagging.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634738">XXX</span>&nbsp;<span class="builtintype" id="8634742">string</span>&nbsp;<span class="string" id="8634749">`json:&#34;S&#34;`</span><br>
<span class="lineno"></span><span class="op" id="8634760">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="8634763">//&nbsp;BugD&#39;s&nbsp;tagged&nbsp;S&nbsp;field&nbsp;should&nbsp;dominate&nbsp;BugA&#39;s.</span><br>
<span class="lineno"></span><span class="keyword" id="8634812">type</span>&nbsp;<span class="ident" id="8634817">BugY</span>&nbsp;<span class="keyword" id="8634822">struct</span>&nbsp;<span class="op" id="8634829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634832">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634838">BugD</span><br>
<span class="lineno">330</span><span class="op" id="8634843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8634846">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;field&nbsp;with&nbsp;a&nbsp;tag&nbsp;dominates&nbsp;untagged&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="8634905">func</span>&nbsp;<span class="ident" id="8634910">TestTaggedFieldDominates</span><span class="op" id="8634934">(</span><span class="ident" id="8634935">t</span>&nbsp;<span class="op" id="8634937">*</span><span class="ident" id="8634938">testing</span><span class="op" id="8634945">.</span><span class="ident" id="8634946">T</span><span class="op" id="8634947">)</span>&nbsp;<span class="op" id="8634949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634952">v</span>&nbsp;<span class="op" id="8634954">:=</span>&nbsp;<span class="ident" id="8634957">BugY</span><span class="op" id="8634961">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634965">BugA</span><span class="op" id="8634969">{</span><span class="string" id="8634970">&#34;BugA&#34;</span><span class="op" id="8634976">}</span><span class="op" id="8634977">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634981">BugD</span><span class="op" id="8634985">{</span><span class="string" id="8634986">&#34;BugD&#34;</span><span class="op" id="8634992">}</span><span class="op" id="8634993">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8634996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8634999">b</span><span class="op" id="8635000">,</span>&nbsp;<span class="ident" id="8635002">err</span>&nbsp;<span class="op" id="8635006">:=</span>&nbsp;<span class="ident" id="8635009">Marshal</span><span class="op" id="8635016">(</span><span class="ident" id="8635017">v</span><span class="op" id="8635018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8635021">if</span>&nbsp;<span class="ident" id="8635024">err</span>&nbsp;<span class="op" id="8635028">!=</span>&nbsp;<span class="ident" id="8635031">nil</span>&nbsp;<span class="op" id="8635035">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635039">t</span><span class="op" id="8635040">.</span><span class="ident" id="8635041">Fatal</span><span class="op" id="8635046">(</span><span class="string" id="8635047">&#34;Marshal:&#34;</span><span class="op" id="8635057">,</span>&nbsp;<span class="ident" id="8635059">err</span><span class="op" id="8635062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8635065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635068">want</span>&nbsp;<span class="op" id="8635073">:=</span>&nbsp;<span class="string" id="8635076">`{&#34;S&#34;:&#34;BugD&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635092">got</span>&nbsp;<span class="op" id="8635096">:=</span>&nbsp;<span class="builtintype" id="8635099">string</span><span class="op" id="8635105">(</span><span class="ident" id="8635106">b</span><span class="op" id="8635107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8635110">if</span>&nbsp;<span class="ident" id="8635113">got</span>&nbsp;<span class="op" id="8635117">!=</span>&nbsp;<span class="ident" id="8635120">want</span>&nbsp;<span class="op" id="8635125">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635129">t</span><span class="op" id="8635130">.</span><span class="ident" id="8635131">Fatalf</span><span class="op" id="8635137">(</span><span class="string" id="8635138">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8635163">,</span>&nbsp;<span class="ident" id="8635165">got</span><span class="op" id="8635168">,</span>&nbsp;<span class="ident" id="8635170">want</span><span class="op" id="8635174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8635177">}</span><br>
<span class="lineno"></span><span class="op" id="8635179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8635182">//&nbsp;There&nbsp;are&nbsp;no&nbsp;tags&nbsp;here,&nbsp;so&nbsp;S&nbsp;should&nbsp;not&nbsp;appear.</span><br>
<span class="lineno">350</span><span class="keyword" id="8635233">type</span>&nbsp;<span class="ident" id="8635238">BugZ</span>&nbsp;<span class="keyword" id="8635243">struct</span>&nbsp;<span class="op" id="8635250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635253">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635259">BugC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635265">BugY</span>&nbsp;<span class="comment" id="8635270">//&nbsp;Contains&nbsp;a&nbsp;tagged&nbsp;S&nbsp;field&nbsp;through&nbsp;BugD;&nbsp;should&nbsp;not&nbsp;dominate.</span><br>
<span class="lineno"></span><span class="op" id="8635334">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="8635337">func</span>&nbsp;<span class="ident" id="8635342">TestDuplicatedFieldDisappears</span><span class="op" id="8635371">(</span><span class="ident" id="8635372">t</span>&nbsp;<span class="op" id="8635374">*</span><span class="ident" id="8635375">testing</span><span class="op" id="8635382">.</span><span class="ident" id="8635383">T</span><span class="op" id="8635384">)</span>&nbsp;<span class="op" id="8635386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635389">v</span>&nbsp;<span class="op" id="8635391">:=</span>&nbsp;<span class="ident" id="8635394">BugZ</span><span class="op" id="8635398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635402">BugA</span><span class="op" id="8635406">{</span><span class="string" id="8635407">&#34;BugA&#34;</span><span class="op" id="8635413">}</span><span class="op" id="8635414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635418">BugC</span><span class="op" id="8635422">{</span><span class="string" id="8635423">&#34;BugC&#34;</span><span class="op" id="8635429">}</span><span class="op" id="8635430">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635434">BugY</span><span class="op" id="8635438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635443">BugA</span><span class="op" id="8635447">{</span><span class="string" id="8635448">&#34;nested&nbsp;BugA&#34;</span><span class="op" id="8635461">}</span><span class="op" id="8635462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635467">BugD</span><span class="op" id="8635471">{</span><span class="string" id="8635472">&#34;nested&nbsp;BugD&#34;</span><span class="op" id="8635485">}</span><span class="op" id="8635486">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8635490">}</span><span class="op" id="8635491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8635494">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635497">b</span><span class="op" id="8635498">,</span>&nbsp;<span class="ident" id="8635500">err</span>&nbsp;<span class="op" id="8635504">:=</span>&nbsp;<span class="ident" id="8635507">Marshal</span><span class="op" id="8635514">(</span><span class="ident" id="8635515">v</span><span class="op" id="8635516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8635519">if</span>&nbsp;<span class="ident" id="8635522">err</span>&nbsp;<span class="op" id="8635526">!=</span>&nbsp;<span class="ident" id="8635529">nil</span>&nbsp;<span class="op" id="8635533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635537">t</span><span class="op" id="8635538">.</span><span class="ident" id="8635539">Fatal</span><span class="op" id="8635544">(</span><span class="string" id="8635545">&#34;Marshal:&#34;</span><span class="op" id="8635555">,</span>&nbsp;<span class="ident" id="8635557">err</span><span class="op" id="8635560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8635563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635566">want</span>&nbsp;<span class="op" id="8635571">:=</span>&nbsp;<span class="string" id="8635574">`{}`</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635580">got</span>&nbsp;<span class="op" id="8635584">:=</span>&nbsp;<span class="builtintype" id="8635587">string</span><span class="op" id="8635593">(</span><span class="ident" id="8635594">b</span><span class="op" id="8635595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8635598">if</span>&nbsp;<span class="ident" id="8635601">got</span>&nbsp;<span class="op" id="8635605">!=</span>&nbsp;<span class="ident" id="8635608">want</span>&nbsp;<span class="op" id="8635613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635617">t</span><span class="op" id="8635618">.</span><span class="ident" id="8635619">Fatalf</span><span class="op" id="8635625">(</span><span class="string" id="8635626">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8635651">,</span>&nbsp;<span class="ident" id="8635653">got</span><span class="op" id="8635656">,</span>&nbsp;<span class="ident" id="8635658">want</span><span class="op" id="8635662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8635665">}</span><br>
<span class="lineno"></span><span class="op" id="8635667">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="8635670">func</span>&nbsp;<span class="ident" id="8635675">TestStringBytes</span><span class="op" id="8635690">(</span><span class="ident" id="8635691">t</span>&nbsp;<span class="op" id="8635693">*</span><span class="ident" id="8635694">testing</span><span class="op" id="8635701">.</span><span class="ident" id="8635702">T</span><span class="op" id="8635703">)</span>&nbsp;<span class="op" id="8635705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8635708">//&nbsp;Test&nbsp;that&nbsp;encodeState.stringBytes&nbsp;and&nbsp;encodeState.string&nbsp;use&nbsp;the&nbsp;same&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635792">es</span>&nbsp;<span class="op" id="8635795">:=</span>&nbsp;<span class="op" id="8635798">&amp;</span><span class="ident" id="8635799">encodeState</span><span class="op" id="8635810">{</span><span class="op" id="8635811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8635814">var</span>&nbsp;<span class="ident" id="8635818">r</span>&nbsp;<span class="op" id="8635820">[</span><span class="op" id="8635821">]</span><span class="builtintype" id="8635822">rune</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8635828">for</span>&nbsp;<span class="ident" id="8635832">i</span>&nbsp;<span class="op" id="8635834">:=</span>&nbsp;<span class="string" id="8635837">&#39;\u0000&#39;</span><span class="op" id="8635845">;</span>&nbsp;<span class="ident" id="8635847">i</span>&nbsp;<span class="op" id="8635849">&lt;=</span>&nbsp;<span class="ident" id="8635852">unicode</span><span class="op" id="8635859">.</span><span class="ident" id="8635860">MaxRune</span><span class="op" id="8635867">;</span>&nbsp;<span class="ident" id="8635869">i</span><span class="op" id="8635870">++</span>&nbsp;<span class="op" id="8635873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635877">r</span>&nbsp;<span class="op" id="8635879">=</span>&nbsp;<span class="builtinfunc" id="8635881">append</span><span class="op" id="8635887">(</span><span class="ident" id="8635888">r</span><span class="op" id="8635889">,</span>&nbsp;<span class="ident" id="8635891">i</span><span class="op" id="8635892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8635895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635898">s</span>&nbsp;<span class="op" id="8635900">:=</span>&nbsp;<span class="builtintype" id="8635903">string</span><span class="op" id="8635909">(</span><span class="ident" id="8635910">r</span><span class="op" id="8635911">)</span>&nbsp;<span class="op" id="8635913">+</span>&nbsp;<span class="string" id="8635915">&#34;\xff\xff\xffhello&#34;</span>&nbsp;<span class="comment" id="8635935">//&nbsp;some&nbsp;invalid&nbsp;UTF-8&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8635962">_</span><span class="op" id="8635963">,</span>&nbsp;<span class="ident" id="8635965">err</span>&nbsp;<span class="op" id="8635969">:=</span>&nbsp;<span class="ident" id="8635972">es</span><span class="op" id="8635974">.</span><span class="builtintype" id="8635975">string</span><span class="op" id="8635981">(</span><span class="ident" id="8635982">s</span><span class="op" id="8635983">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8635986">if</span>&nbsp;<span class="ident" id="8635989">err</span>&nbsp;<span class="op" id="8635993">!=</span>&nbsp;<span class="ident" id="8635996">nil</span>&nbsp;<span class="op" id="8636000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636004">t</span><span class="op" id="8636005">.</span><span class="ident" id="8636006">Fatal</span><span class="op" id="8636011">(</span><span class="ident" id="8636012">err</span><span class="op" id="8636015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8636018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636022">esBytes</span>&nbsp;<span class="op" id="8636030">:=</span>&nbsp;<span class="op" id="8636033">&amp;</span><span class="ident" id="8636034">encodeState</span><span class="op" id="8636045">{</span><span class="op" id="8636046">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636049">_</span><span class="op" id="8636050">,</span>&nbsp;<span class="ident" id="8636052">err</span>&nbsp;<span class="op" id="8636056">=</span>&nbsp;<span class="ident" id="8636058">esBytes</span><span class="op" id="8636065">.</span><span class="ident" id="8636066">stringBytes</span><span class="op" id="8636077">(</span><span class="op" id="8636078">[</span><span class="op" id="8636079">]</span><span class="builtintype" id="8636080">byte</span><span class="op" id="8636084">(</span><span class="ident" id="8636085">s</span><span class="op" id="8636086">)</span><span class="op" id="8636087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8636090">if</span>&nbsp;<span class="ident" id="8636093">err</span>&nbsp;<span class="op" id="8636097">!=</span>&nbsp;<span class="ident" id="8636100">nil</span>&nbsp;<span class="op" id="8636104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636108">t</span><span class="op" id="8636109">.</span><span class="ident" id="8636110">Fatal</span><span class="op" id="8636115">(</span><span class="ident" id="8636116">err</span><span class="op" id="8636119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8636122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636126">enc</span>&nbsp;<span class="op" id="8636130">:=</span>&nbsp;<span class="ident" id="8636133">es</span><span class="op" id="8636135">.</span><span class="ident" id="8636136">Buffer</span><span class="op" id="8636142">.</span><span class="ident" id="8636143">String</span><span class="op" id="8636149">(</span><span class="op" id="8636150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636153">encBytes</span>&nbsp;<span class="op" id="8636162">:=</span>&nbsp;<span class="ident" id="8636165">esBytes</span><span class="op" id="8636172">.</span><span class="ident" id="8636173">Buffer</span><span class="op" id="8636179">.</span><span class="ident" id="8636180">String</span><span class="op" id="8636186">(</span><span class="op" id="8636187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8636190">if</span>&nbsp;<span class="ident" id="8636193">enc</span>&nbsp;<span class="op" id="8636197">!=</span>&nbsp;<span class="ident" id="8636200">encBytes</span>&nbsp;<span class="op" id="8636209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636213">i</span>&nbsp;<span class="op" id="8636215">:=</span>&nbsp;<span class="num" id="8636218">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8636222">for</span>&nbsp;<span class="ident" id="8636226">i</span>&nbsp;<span class="op" id="8636228">&lt;</span>&nbsp;<span class="builtinfunc" id="8636230">len</span><span class="op" id="8636233">(</span><span class="ident" id="8636234">enc</span><span class="op" id="8636237">)</span>&nbsp;<span class="op" id="8636239">&amp;&amp;</span>&nbsp;<span class="ident" id="8636242">i</span>&nbsp;<span class="op" id="8636244">&lt;</span>&nbsp;<span class="builtinfunc" id="8636246">len</span><span class="op" id="8636249">(</span><span class="ident" id="8636250">encBytes</span><span class="op" id="8636258">)</span>&nbsp;<span class="op" id="8636260">&amp;&amp;</span>&nbsp;<span class="ident" id="8636263">enc</span><span class="op" id="8636266">[</span><span class="ident" id="8636267">i</span><span class="op" id="8636268">]</span>&nbsp;<span class="op" id="8636270">==</span>&nbsp;<span class="ident" id="8636273">encBytes</span><span class="op" id="8636281">[</span><span class="ident" id="8636282">i</span><span class="op" id="8636283">]</span>&nbsp;<span class="op" id="8636285">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636290">i</span><span class="op" id="8636291">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8636296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636300">enc</span>&nbsp;<span class="op" id="8636304">=</span>&nbsp;<span class="ident" id="8636306">enc</span><span class="op" id="8636309">[</span><span class="ident" id="8636310">i</span><span class="op" id="8636311">:</span><span class="op" id="8636312">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636316">encBytes</span>&nbsp;<span class="op" id="8636325">=</span>&nbsp;<span class="ident" id="8636327">encBytes</span><span class="op" id="8636335">[</span><span class="ident" id="8636336">i</span><span class="op" id="8636337">:</span><span class="op" id="8636338">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636342">i</span>&nbsp;<span class="op" id="8636344">=</span>&nbsp;<span class="num" id="8636346">0</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8636350">for</span>&nbsp;<span class="ident" id="8636354">i</span>&nbsp;<span class="op" id="8636356">&lt;</span>&nbsp;<span class="builtinfunc" id="8636358">len</span><span class="op" id="8636361">(</span><span class="ident" id="8636362">enc</span><span class="op" id="8636365">)</span>&nbsp;<span class="op" id="8636367">&amp;&amp;</span>&nbsp;<span class="ident" id="8636370">i</span>&nbsp;<span class="op" id="8636372">&lt;</span>&nbsp;<span class="builtinfunc" id="8636374">len</span><span class="op" id="8636377">(</span><span class="ident" id="8636378">encBytes</span><span class="op" id="8636386">)</span>&nbsp;<span class="op" id="8636388">&amp;&amp;</span>&nbsp;<span class="ident" id="8636391">enc</span><span class="op" id="8636394">[</span><span class="builtinfunc" id="8636395">len</span><span class="op" id="8636398">(</span><span class="ident" id="8636399">enc</span><span class="op" id="8636402">)</span><span class="op" id="8636403">-</span><span class="ident" id="8636404">i</span><span class="op" id="8636405">-</span><span class="num" id="8636406">1</span><span class="op" id="8636407">]</span>&nbsp;<span class="op" id="8636409">==</span>&nbsp;<span class="ident" id="8636412">encBytes</span><span class="op" id="8636420">[</span><span class="builtinfunc" id="8636421">len</span><span class="op" id="8636424">(</span><span class="ident" id="8636425">encBytes</span><span class="op" id="8636433">)</span><span class="op" id="8636434">-</span><span class="ident" id="8636435">i</span><span class="op" id="8636436">-</span><span class="num" id="8636437">1</span><span class="op" id="8636438">]</span>&nbsp;<span class="op" id="8636440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636445">i</span><span class="op" id="8636446">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8636451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636455">enc</span>&nbsp;<span class="op" id="8636459">=</span>&nbsp;<span class="ident" id="8636461">enc</span><span class="op" id="8636464">[</span><span class="op" id="8636465">:</span><span class="builtinfunc" id="8636466">len</span><span class="op" id="8636469">(</span><span class="ident" id="8636470">enc</span><span class="op" id="8636473">)</span><span class="op" id="8636474">-</span><span class="ident" id="8636475">i</span><span class="op" id="8636476">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636480">encBytes</span>&nbsp;<span class="op" id="8636489">=</span>&nbsp;<span class="ident" id="8636491">encBytes</span><span class="op" id="8636499">[</span><span class="op" id="8636500">:</span><span class="builtinfunc" id="8636501">len</span><span class="op" id="8636504">(</span><span class="ident" id="8636505">encBytes</span><span class="op" id="8636513">)</span><span class="op" id="8636514">-</span><span class="ident" id="8636515">i</span><span class="op" id="8636516">]</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8636521">if</span>&nbsp;<span class="builtinfunc" id="8636524">len</span><span class="op" id="8636527">(</span><span class="ident" id="8636528">enc</span><span class="op" id="8636531">)</span>&nbsp;<span class="op" id="8636533">&gt;</span>&nbsp;<span class="num" id="8636535">20</span>&nbsp;<span class="op" id="8636538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636543">enc</span>&nbsp;<span class="op" id="8636547">=</span>&nbsp;<span class="ident" id="8636549">enc</span><span class="op" id="8636552">[</span><span class="op" id="8636553">:</span><span class="num" id="8636554">20</span><span class="op" id="8636556">]</span>&nbsp;<span class="op" id="8636558">+</span>&nbsp;<span class="string" id="8636560">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8636568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8636572">if</span>&nbsp;<span class="builtinfunc" id="8636575">len</span><span class="op" id="8636578">(</span><span class="ident" id="8636579">encBytes</span><span class="op" id="8636587">)</span>&nbsp;<span class="op" id="8636589">&gt;</span>&nbsp;<span class="num" id="8636591">20</span>&nbsp;<span class="op" id="8636594">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636599">encBytes</span>&nbsp;<span class="op" id="8636608">=</span>&nbsp;<span class="ident" id="8636610">encBytes</span><span class="op" id="8636618">[</span><span class="op" id="8636619">:</span><span class="num" id="8636620">20</span><span class="op" id="8636622">]</span>&nbsp;<span class="op" id="8636624">+</span>&nbsp;<span class="string" id="8636626">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8636634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636639">t</span><span class="op" id="8636640">.</span><span class="ident" id="8636641">Errorf</span><span class="op" id="8636647">(</span><span class="string" id="8636648">&#34;encodings&nbsp;differ&nbsp;at&nbsp;%#q&nbsp;vs&nbsp;%#q&#34;</span><span class="op" id="8636680">,</span>&nbsp;<span class="ident" id="8636682">enc</span><span class="op" id="8636685">,</span>&nbsp;<span class="ident" id="8636687">encBytes</span><span class="op" id="8636695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8636698">}</span><br>
<span class="lineno">420</span><span class="op" id="8636700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8636703">func</span>&nbsp;<span class="ident" id="8636708">TestIssue6458</span><span class="op" id="8636721">(</span><span class="ident" id="8636722">t</span>&nbsp;<span class="op" id="8636724">*</span><span class="ident" id="8636725">testing</span><span class="op" id="8636732">.</span><span class="ident" id="8636733">T</span><span class="op" id="8636734">)</span>&nbsp;<span class="op" id="8636736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8636739">type</span>&nbsp;<span class="ident" id="8636744">Foo</span>&nbsp;<span class="keyword" id="8636748">struct</span>&nbsp;<span class="op" id="8636755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636759">M</span>&nbsp;<span class="ident" id="8636761">RawMessage</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8636773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636776">x</span>&nbsp;<span class="op" id="8636778">:=</span>&nbsp;<span class="ident" id="8636781">Foo</span><span class="op" id="8636784">{</span><span class="ident" id="8636785">RawMessage</span><span class="op" id="8636795">(</span><span class="string" id="8636796">`&#34;foo&#34;`</span><span class="op" id="8636803">)</span><span class="op" id="8636804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636808">b</span><span class="op" id="8636809">,</span>&nbsp;<span class="ident" id="8636811">err</span>&nbsp;<span class="op" id="8636815">:=</span>&nbsp;<span class="ident" id="8636818">Marshal</span><span class="op" id="8636825">(</span><span class="op" id="8636826">&amp;</span><span class="ident" id="8636827">x</span><span class="op" id="8636828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8636831">if</span>&nbsp;<span class="ident" id="8636834">err</span>&nbsp;<span class="op" id="8636838">!=</span>&nbsp;<span class="ident" id="8636841">nil</span>&nbsp;<span class="op" id="8636845">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636849">t</span><span class="op" id="8636850">.</span><span class="ident" id="8636851">Fatal</span><span class="op" id="8636856">(</span><span class="ident" id="8636857">err</span><span class="op" id="8636860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8636863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8636866">if</span>&nbsp;<span class="ident" id="8636869">want</span>&nbsp;<span class="op" id="8636874">:=</span>&nbsp;<span class="string" id="8636877">`{&#34;M&#34;:&#34;foo&#34;}`</span><span class="op" id="8636890">;</span>&nbsp;<span class="builtintype" id="8636892">string</span><span class="op" id="8636898">(</span><span class="ident" id="8636899">b</span><span class="op" id="8636900">)</span>&nbsp;<span class="op" id="8636902">!=</span>&nbsp;<span class="ident" id="8636905">want</span>&nbsp;<span class="op" id="8636910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636914">t</span><span class="op" id="8636915">.</span><span class="ident" id="8636916">Errorf</span><span class="op" id="8636922">(</span><span class="string" id="8636923">&#34;Marshal(&amp;x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8636952">,</span>&nbsp;<span class="ident" id="8636954">b</span><span class="op" id="8636955">,</span>&nbsp;<span class="ident" id="8636957">want</span><span class="op" id="8636961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8636964">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8636968">b</span><span class="op" id="8636969">,</span>&nbsp;<span class="ident" id="8636971">err</span>&nbsp;<span class="op" id="8636975">=</span>&nbsp;<span class="ident" id="8636977">Marshal</span><span class="op" id="8636984">(</span><span class="ident" id="8636985">x</span><span class="op" id="8636986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8636989">if</span>&nbsp;<span class="ident" id="8636992">err</span>&nbsp;<span class="op" id="8636996">!=</span>&nbsp;<span class="ident" id="8636999">nil</span>&nbsp;<span class="op" id="8637003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8637007">t</span><span class="op" id="8637008">.</span><span class="ident" id="8637009">Fatal</span><span class="op" id="8637014">(</span><span class="ident" id="8637015">err</span><span class="op" id="8637018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8637021">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8637025">if</span>&nbsp;<span class="ident" id="8637028">want</span>&nbsp;<span class="op" id="8637033">:=</span>&nbsp;<span class="string" id="8637036">`{&#34;M&#34;:&#34;ImZvbyI=&#34;}`</span><span class="op" id="8637054">;</span>&nbsp;<span class="builtintype" id="8637056">string</span><span class="op" id="8637062">(</span><span class="ident" id="8637063">b</span><span class="op" id="8637064">)</span>&nbsp;<span class="op" id="8637066">!=</span>&nbsp;<span class="ident" id="8637069">want</span>&nbsp;<span class="op" id="8637074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8637078">t</span><span class="op" id="8637079">.</span><span class="ident" id="8637080">Errorf</span><span class="op" id="8637086">(</span><span class="string" id="8637087">&#34;Marshal(x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8637115">,</span>&nbsp;<span class="ident" id="8637117">b</span><span class="op" id="8637118">,</span>&nbsp;<span class="ident" id="8637120">want</span><span class="op" id="8637124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8637127">}</span><br>
<span class="lineno"></span><span class="op" id="8637129">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="8637132">func</span>&nbsp;<span class="ident" id="8637137">TestHTMLEscape</span><span class="op" id="8637151">(</span><span class="ident" id="8637152">t</span>&nbsp;<span class="op" id="8637154">*</span><span class="ident" id="8637155">testing</span><span class="op" id="8637162">.</span><span class="ident" id="8637163">T</span><span class="op" id="8637164">)</span>&nbsp;<span class="op" id="8637166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8637169">var</span>&nbsp;<span class="ident" id="8637173">b</span><span class="op" id="8637174">,</span>&nbsp;<span class="ident" id="8637176">want</span>&nbsp;<span class="ident" id="8637181">bytes</span><span class="op" id="8637186">.</span><span class="ident" id="8637187">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8637195">m</span>&nbsp;<span class="op" id="8637197">:=</span>&nbsp;<span class="string" id="8637200">`{&#34;M&#34;:&#34;&lt;html&gt;foo&nbsp;&amp;`</span>&nbsp;<span class="op" id="8637220">+</span>&nbsp;<span class="string" id="8637222">&#34;\xe2\x80\xa8&nbsp;\xe2\x80\xa9&#34;</span>&nbsp;<span class="op" id="8637250">+</span>&nbsp;<span class="string" id="8637252">`&lt;/html&gt;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8637265">want</span><span class="op" id="8637269">.</span><span class="ident" id="8637270">Write</span><span class="op" id="8637275">(</span><span class="op" id="8637276">[</span><span class="op" id="8637277">]</span><span class="builtintype" id="8637278">byte</span><span class="op" id="8637282">(</span><span class="string" id="8637283">`{&#34;M&#34;:&#34;\u003chtml\u003efoo&nbsp;\u0026\u2028&nbsp;\u2029\u003c/html\u003e&#34;}`</span><span class="op" id="8637349">)</span><span class="op" id="8637350">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8637353">HTMLEscape</span><span class="op" id="8637363">(</span><span class="op" id="8637364">&amp;</span><span class="ident" id="8637365">b</span><span class="op" id="8637366">,</span>&nbsp;<span class="op" id="8637368">[</span><span class="op" id="8637369">]</span><span class="builtintype" id="8637370">byte</span><span class="op" id="8637374">(</span><span class="ident" id="8637375">m</span><span class="op" id="8637376">)</span><span class="op" id="8637377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8637380">if</span>&nbsp;<span class="op" id="8637383">!</span><span class="ident" id="8637384">bytes</span><span class="op" id="8637389">.</span><span class="ident" id="8637390">Equal</span><span class="op" id="8637395">(</span><span class="ident" id="8637396">b</span><span class="op" id="8637397">.</span><span class="ident" id="8637398">Bytes</span><span class="op" id="8637403">(</span><span class="op" id="8637404">)</span><span class="op" id="8637405">,</span>&nbsp;<span class="ident" id="8637407">want</span><span class="op" id="8637411">.</span><span class="ident" id="8637412">Bytes</span><span class="op" id="8637417">(</span><span class="op" id="8637418">)</span><span class="op" id="8637419">)</span>&nbsp;<span class="op" id="8637421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8637425">t</span><span class="op" id="8637426">.</span><span class="ident" id="8637427">Errorf</span><span class="op" id="8637433">(</span><span class="string" id="8637434">&#34;HTMLEscape(&amp;b,&nbsp;[]byte(m))&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8637475">,</span>&nbsp;<span class="ident" id="8637477">b</span><span class="op" id="8637478">.</span><span class="ident" id="8637479">Bytes</span><span class="op" id="8637484">(</span><span class="op" id="8637485">)</span><span class="op" id="8637486">,</span>&nbsp;<span class="ident" id="8637488">want</span><span class="op" id="8637492">.</span><span class="ident" id="8637493">Bytes</span><span class="op" id="8637498">(</span><span class="op" id="8637499">)</span><span class="op" id="8637500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8637503">}</span><br>
<span class="lineno"></span><span class="op" id="8637505">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="8637508">//&nbsp;golang.org/issue/8582</span><br>
<span class="lineno"></span><span class="keyword" id="8637533">func</span>&nbsp;<span class="ident" id="8637538">TestEncodePointerString</span><span class="op" id="8637561">(</span><span class="ident" id="8637562">t</span>&nbsp;<span class="op" id="8637564">*</span><span class="ident" id="8637565">testing</span><span class="op" id="8637572">.</span><span class="ident" id="8637573">T</span><span class="op" id="8637574">)</span>&nbsp;<span class="op" id="8637576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8637579">type</span>&nbsp;<span class="ident" id="8637584">stringPointer</span>&nbsp;<span class="keyword" id="8637598">struct</span>&nbsp;<span class="op" id="8637605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8637609">N</span>&nbsp;<span class="op" id="8637611">*</span><span class="ident" id="8637612">int64</span>&nbsp;<span class="string" id="8637618">`json:&#34;n,string&#34;`</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8637637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8637640">var</span>&nbsp;<span class="ident" id="8637644">n</span>&nbsp;<span class="ident" id="8637646">int64</span>&nbsp;<span class="op" id="8637652">=</span>&nbsp;<span class="num" id="8637654">42</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8637658">b</span><span class="op" id="8637659">,</span>&nbsp;<span class="ident" id="8637661">err</span>&nbsp;<span class="op" id="8637665">:=</span>&nbsp;<span class="ident" id="8637668">Marshal</span><span class="op" id="8637675">(</span><span class="ident" id="8637676">stringPointer</span><span class="op" id="8637689">{</span><span class="ident" id="8637690">N</span><span class="op" id="8637691">:</span>&nbsp;<span class="op" id="8637693">&amp;</span><span class="ident" id="8637694">n</span><span class="op" id="8637695">}</span><span class="op" id="8637696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8637699">if</span>&nbsp;<span class="ident" id="8637702">err</span>&nbsp;<span class="op" id="8637706">!=</span>&nbsp;<span class="ident" id="8637709">nil</span>&nbsp;<span class="op" id="8637713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8637717">t</span><span class="op" id="8637718">.</span><span class="ident" id="8637719">Fatalf</span><span class="op" id="8637725">(</span><span class="string" id="8637726">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="8637739">,</span>&nbsp;<span class="ident" id="8637741">err</span><span class="op" id="8637744">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8637747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8637750">if</span>&nbsp;<span class="ident" id="8637753">got</span><span class="op" id="8637756">,</span>&nbsp;<span class="ident" id="8637758">want</span>&nbsp;<span class="op" id="8637763">:=</span>&nbsp;<span class="builtintype" id="8637766">string</span><span class="op" id="8637772">(</span><span class="ident" id="8637773">b</span><span class="op" id="8637774">)</span><span class="op" id="8637775">,</span>&nbsp;<span class="string" id="8637777">`{&#34;n&#34;:&#34;42&#34;}`</span><span class="op" id="8637789">;</span>&nbsp;<span class="ident" id="8637791">got</span>&nbsp;<span class="op" id="8637795">!=</span>&nbsp;<span class="ident" id="8637798">want</span>&nbsp;<span class="op" id="8637803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8637807">t</span><span class="op" id="8637808">.</span><span class="ident" id="8637809">Errorf</span><span class="op" id="8637815">(</span><span class="string" id="8637816">&#34;Marshal&nbsp;=&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8637839">,</span>&nbsp;<span class="ident" id="8637841">got</span><span class="op" id="8637844">,</span>&nbsp;<span class="ident" id="8637846">want</span><span class="op" id="8637850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8637853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8637856">var</span>&nbsp;<span class="ident" id="8637860">back</span>&nbsp;<span class="ident" id="8637865">stringPointer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8637880">err</span>&nbsp;<span class="op" id="8637884">=</span>&nbsp;<span class="ident" id="8637886">Unmarshal</span><span class="op" id="8637895">(</span><span class="ident" id="8637896">b</span><span class="op" id="8637897">,</span>&nbsp;<span class="op" id="8637899">&amp;</span><span class="ident" id="8637900">back</span><span class="op" id="8637904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8637907">if</span>&nbsp;<span class="ident" id="8637910">err</span>&nbsp;<span class="op" id="8637914">!=</span>&nbsp;<span class="ident" id="8637917">nil</span>&nbsp;<span class="op" id="8637921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8637925">t</span><span class="op" id="8637926">.</span><span class="ident" id="8637927">Fatalf</span><span class="op" id="8637933">(</span><span class="string" id="8637934">&#34;Unmarshal:&nbsp;%v&#34;</span><span class="op" id="8637949">,</span>&nbsp;<span class="ident" id="8637951">err</span><span class="op" id="8637954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8637957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8637960">if</span>&nbsp;<span class="ident" id="8637963">back</span><span class="op" id="8637967">.</span><span class="ident" id="8637968">N</span>&nbsp;<span class="op" id="8637970">==</span>&nbsp;<span class="ident" id="8637973">nil</span>&nbsp;<span class="op" id="8637977">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8637981">t</span><span class="op" id="8637982">.</span><span class="ident" id="8637983">Fatalf</span><span class="op" id="8637989">(</span><span class="string" id="8637990">&#34;Unmarshalled&nbsp;nil&nbsp;N&nbsp;field&#34;</span><span class="op" id="8638016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8638022">if</span>&nbsp;<span class="op" id="8638025">*</span><span class="ident" id="8638026">back</span><span class="op" id="8638030">.</span><span class="ident" id="8638031">N</span>&nbsp;<span class="op" id="8638033">!=</span>&nbsp;<span class="num" id="8638036">42</span>&nbsp;<span class="op" id="8638039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8638043">t</span><span class="op" id="8638044">.</span><span class="ident" id="8638045">Fatalf</span><span class="op" id="8638051">(</span><span class="string" id="8638052">&#34;*N&nbsp;=&nbsp;%d;&nbsp;want&nbsp;42&#34;</span><span class="op" id="8638070">,</span>&nbsp;<span class="op" id="8638072">*</span><span class="ident" id="8638073">back</span><span class="op" id="8638077">.</span><span class="ident" id="8638078">N</span><span class="op" id="8638079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638082">}</span><br>
<span class="lineno">480</span><span class="op" id="8638084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8638087">var</span>&nbsp;<span class="ident" id="8638091">encodeStringTests</span>&nbsp;<span class="op" id="8638109">=</span>&nbsp;<span class="op" id="8638111">[</span><span class="op" id="8638112">]</span><span class="keyword" id="8638113">struct</span>&nbsp;<span class="op" id="8638120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8638123">in</span>&nbsp;&nbsp;<span class="builtintype" id="8638127">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8638135">out</span>&nbsp;<span class="builtintype" id="8638139">string</span><br>
<span class="lineno">485</span><span class="op" id="8638146">}</span><span class="op" id="8638147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638150">{</span><span class="string" id="8638151">&#34;\x00&#34;</span><span class="op" id="8638157">,</span>&nbsp;<span class="string" id="8638159">`&#34;\u0000&#34;`</span><span class="op" id="8638169">}</span><span class="op" id="8638170">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638173">{</span><span class="string" id="8638174">&#34;\x01&#34;</span><span class="op" id="8638180">,</span>&nbsp;<span class="string" id="8638182">`&#34;\u0001&#34;`</span><span class="op" id="8638192">}</span><span class="op" id="8638193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638196">{</span><span class="string" id="8638197">&#34;\x02&#34;</span><span class="op" id="8638203">,</span>&nbsp;<span class="string" id="8638205">`&#34;\u0002&#34;`</span><span class="op" id="8638215">}</span><span class="op" id="8638216">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638219">{</span><span class="string" id="8638220">&#34;\x03&#34;</span><span class="op" id="8638226">,</span>&nbsp;<span class="string" id="8638228">`&#34;\u0003&#34;`</span><span class="op" id="8638238">}</span><span class="op" id="8638239">,</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638242">{</span><span class="string" id="8638243">&#34;\x04&#34;</span><span class="op" id="8638249">,</span>&nbsp;<span class="string" id="8638251">`&#34;\u0004&#34;`</span><span class="op" id="8638261">}</span><span class="op" id="8638262">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638265">{</span><span class="string" id="8638266">&#34;\x05&#34;</span><span class="op" id="8638272">,</span>&nbsp;<span class="string" id="8638274">`&#34;\u0005&#34;`</span><span class="op" id="8638284">}</span><span class="op" id="8638285">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638288">{</span><span class="string" id="8638289">&#34;\x06&#34;</span><span class="op" id="8638295">,</span>&nbsp;<span class="string" id="8638297">`&#34;\u0006&#34;`</span><span class="op" id="8638307">}</span><span class="op" id="8638308">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638311">{</span><span class="string" id="8638312">&#34;\x07&#34;</span><span class="op" id="8638318">,</span>&nbsp;<span class="string" id="8638320">`&#34;\u0007&#34;`</span><span class="op" id="8638330">}</span><span class="op" id="8638331">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638334">{</span><span class="string" id="8638335">&#34;\x08&#34;</span><span class="op" id="8638341">,</span>&nbsp;<span class="string" id="8638343">`&#34;\u0008&#34;`</span><span class="op" id="8638353">}</span><span class="op" id="8638354">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638357">{</span><span class="string" id="8638358">&#34;\x09&#34;</span><span class="op" id="8638364">,</span>&nbsp;<span class="string" id="8638366">`&#34;\t&#34;`</span><span class="op" id="8638372">}</span><span class="op" id="8638373">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638376">{</span><span class="string" id="8638377">&#34;\x0a&#34;</span><span class="op" id="8638383">,</span>&nbsp;<span class="string" id="8638385">`&#34;\n&#34;`</span><span class="op" id="8638391">}</span><span class="op" id="8638392">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638395">{</span><span class="string" id="8638396">&#34;\x0b&#34;</span><span class="op" id="8638402">,</span>&nbsp;<span class="string" id="8638404">`&#34;\u000b&#34;`</span><span class="op" id="8638414">}</span><span class="op" id="8638415">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638418">{</span><span class="string" id="8638419">&#34;\x0c&#34;</span><span class="op" id="8638425">,</span>&nbsp;<span class="string" id="8638427">`&#34;\u000c&#34;`</span><span class="op" id="8638437">}</span><span class="op" id="8638438">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638441">{</span><span class="string" id="8638442">&#34;\x0d&#34;</span><span class="op" id="8638448">,</span>&nbsp;<span class="string" id="8638450">`&#34;\r&#34;`</span><span class="op" id="8638456">}</span><span class="op" id="8638457">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638460">{</span><span class="string" id="8638461">&#34;\x0e&#34;</span><span class="op" id="8638467">,</span>&nbsp;<span class="string" id="8638469">`&#34;\u000e&#34;`</span><span class="op" id="8638479">}</span><span class="op" id="8638480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638483">{</span><span class="string" id="8638484">&#34;\x0f&#34;</span><span class="op" id="8638490">,</span>&nbsp;<span class="string" id="8638492">`&#34;\u000f&#34;`</span><span class="op" id="8638502">}</span><span class="op" id="8638503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638506">{</span><span class="string" id="8638507">&#34;\x10&#34;</span><span class="op" id="8638513">,</span>&nbsp;<span class="string" id="8638515">`&#34;\u0010&#34;`</span><span class="op" id="8638525">}</span><span class="op" id="8638526">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638529">{</span><span class="string" id="8638530">&#34;\x11&#34;</span><span class="op" id="8638536">,</span>&nbsp;<span class="string" id="8638538">`&#34;\u0011&#34;`</span><span class="op" id="8638548">}</span><span class="op" id="8638549">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638552">{</span><span class="string" id="8638553">&#34;\x12&#34;</span><span class="op" id="8638559">,</span>&nbsp;<span class="string" id="8638561">`&#34;\u0012&#34;`</span><span class="op" id="8638571">}</span><span class="op" id="8638572">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638575">{</span><span class="string" id="8638576">&#34;\x13&#34;</span><span class="op" id="8638582">,</span>&nbsp;<span class="string" id="8638584">`&#34;\u0013&#34;`</span><span class="op" id="8638594">}</span><span class="op" id="8638595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638598">{</span><span class="string" id="8638599">&#34;\x14&#34;</span><span class="op" id="8638605">,</span>&nbsp;<span class="string" id="8638607">`&#34;\u0014&#34;`</span><span class="op" id="8638617">}</span><span class="op" id="8638618">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638621">{</span><span class="string" id="8638622">&#34;\x15&#34;</span><span class="op" id="8638628">,</span>&nbsp;<span class="string" id="8638630">`&#34;\u0015&#34;`</span><span class="op" id="8638640">}</span><span class="op" id="8638641">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638644">{</span><span class="string" id="8638645">&#34;\x16&#34;</span><span class="op" id="8638651">,</span>&nbsp;<span class="string" id="8638653">`&#34;\u0016&#34;`</span><span class="op" id="8638663">}</span><span class="op" id="8638664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638667">{</span><span class="string" id="8638668">&#34;\x17&#34;</span><span class="op" id="8638674">,</span>&nbsp;<span class="string" id="8638676">`&#34;\u0017&#34;`</span><span class="op" id="8638686">}</span><span class="op" id="8638687">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638690">{</span><span class="string" id="8638691">&#34;\x18&#34;</span><span class="op" id="8638697">,</span>&nbsp;<span class="string" id="8638699">`&#34;\u0018&#34;`</span><span class="op" id="8638709">}</span><span class="op" id="8638710">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638713">{</span><span class="string" id="8638714">&#34;\x19&#34;</span><span class="op" id="8638720">,</span>&nbsp;<span class="string" id="8638722">`&#34;\u0019&#34;`</span><span class="op" id="8638732">}</span><span class="op" id="8638733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638736">{</span><span class="string" id="8638737">&#34;\x1a&#34;</span><span class="op" id="8638743">,</span>&nbsp;<span class="string" id="8638745">`&#34;\u001a&#34;`</span><span class="op" id="8638755">}</span><span class="op" id="8638756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638759">{</span><span class="string" id="8638760">&#34;\x1b&#34;</span><span class="op" id="8638766">,</span>&nbsp;<span class="string" id="8638768">`&#34;\u001b&#34;`</span><span class="op" id="8638778">}</span><span class="op" id="8638779">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638782">{</span><span class="string" id="8638783">&#34;\x1c&#34;</span><span class="op" id="8638789">,</span>&nbsp;<span class="string" id="8638791">`&#34;\u001c&#34;`</span><span class="op" id="8638801">}</span><span class="op" id="8638802">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638805">{</span><span class="string" id="8638806">&#34;\x1d&#34;</span><span class="op" id="8638812">,</span>&nbsp;<span class="string" id="8638814">`&#34;\u001d&#34;`</span><span class="op" id="8638824">}</span><span class="op" id="8638825">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638828">{</span><span class="string" id="8638829">&#34;\x1e&#34;</span><span class="op" id="8638835">,</span>&nbsp;<span class="string" id="8638837">`&#34;\u001e&#34;`</span><span class="op" id="8638847">}</span><span class="op" id="8638848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8638851">{</span><span class="string" id="8638852">&#34;\x1f&#34;</span><span class="op" id="8638858">,</span>&nbsp;<span class="string" id="8638860">`&#34;\u001f&#34;`</span><span class="op" id="8638870">}</span><span class="op" id="8638871">,</span><br>
<span class="lineno"></span><span class="op" id="8638873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">520</span><span class="keyword" id="8638876">func</span>&nbsp;<span class="ident" id="8638881">TestEncodeString</span><span class="op" id="8638897">(</span><span class="ident" id="8638898">t</span>&nbsp;<span class="op" id="8638900">*</span><span class="ident" id="8638901">testing</span><span class="op" id="8638908">.</span><span class="ident" id="8638909">T</span><span class="op" id="8638910">)</span>&nbsp;<span class="op" id="8638912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8638915">for</span>&nbsp;<span class="ident" id="8638919">_</span><span class="op" id="8638920">,</span>&nbsp;<span class="ident" id="8638922">tt</span>&nbsp;<span class="op" id="8638925">:=</span>&nbsp;<span class="keyword" id="8638928">range</span>&nbsp;<span class="ident" id="8638934">encodeStringTests</span>&nbsp;<span class="op" id="8638952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8638956">b</span><span class="op" id="8638957">,</span>&nbsp;<span class="ident" id="8638959">err</span>&nbsp;<span class="op" id="8638963">:=</span>&nbsp;<span class="ident" id="8638966">Marshal</span><span class="op" id="8638973">(</span><span class="ident" id="8638974">tt</span><span class="op" id="8638976">.</span><span class="ident" id="8638977">in</span><span class="op" id="8638979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8638983">if</span>&nbsp;<span class="ident" id="8638986">err</span>&nbsp;<span class="op" id="8638990">!=</span>&nbsp;<span class="ident" id="8638993">nil</span>&nbsp;<span class="op" id="8638997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8639002">t</span><span class="op" id="8639003">.</span><span class="ident" id="8639004">Errorf</span><span class="op" id="8639010">(</span><span class="string" id="8639011">&#34;Marshal(%q):&nbsp;%v&#34;</span><span class="op" id="8639028">,</span>&nbsp;<span class="ident" id="8639030">tt</span><span class="op" id="8639032">.</span><span class="ident" id="8639033">in</span><span class="op" id="8639035">,</span>&nbsp;<span class="ident" id="8639037">err</span><span class="op" id="8639040">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8639045">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8639056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8639060">out</span>&nbsp;<span class="op" id="8639064">:=</span>&nbsp;<span class="builtintype" id="8639067">string</span><span class="op" id="8639073">(</span><span class="ident" id="8639074">b</span><span class="op" id="8639075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8639079">if</span>&nbsp;<span class="ident" id="8639082">out</span>&nbsp;<span class="op" id="8639086">!=</span>&nbsp;<span class="ident" id="8639089">tt</span><span class="op" id="8639091">.</span><span class="ident" id="8639092">out</span>&nbsp;<span class="op" id="8639096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8639101">t</span><span class="op" id="8639102">.</span><span class="ident" id="8639103">Errorf</span><span class="op" id="8639109">(</span><span class="string" id="8639110">&#34;Marshal(%q)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8639139">,</span>&nbsp;<span class="ident" id="8639141">tt</span><span class="op" id="8639143">.</span><span class="ident" id="8639144">in</span><span class="op" id="8639146">,</span>&nbsp;<span class="ident" id="8639148">out</span><span class="op" id="8639151">,</span>&nbsp;<span class="ident" id="8639153">tt</span><span class="op" id="8639155">.</span><span class="ident" id="8639156">out</span><span class="op" id="8639159">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8639163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8639166">}</span><br>
<span class="lineno"></span><span class="op" id="8639168">}</span>
</div>
</body>
</html>
