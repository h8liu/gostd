<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5967309">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5967364">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5967418">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5967469">package</span>&nbsp;<span class="ident" id="5967477">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5967482">import</span>&nbsp;<span class="op" id="5967489">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5967492">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5967501">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5967520">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5967530">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5967538">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5967552">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5967557">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5967560">//&nbsp;TODO(adg):&nbsp;support&nbsp;zip&nbsp;file&nbsp;comments</span><br>
<span class="lineno"></span><span class="comment" id="5967600">//&nbsp;TODO(adg):&nbsp;support&nbsp;specifying&nbsp;deflate&nbsp;level</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5967648">//&nbsp;Writer&nbsp;implements&nbsp;a&nbsp;zip&nbsp;file&nbsp;writer.</span><br>
<span class="lineno">20</span><span class="keyword" id="5967688">type</span>&nbsp;<span class="ident" id="5967693">Writer</span>&nbsp;<span class="keyword" id="5967700">struct</span>&nbsp;<span class="op" id="5967707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967710">cw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5967717">*</span><span class="ident" id="5967718">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967731">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5967738">[</span><span class="op" id="5967739">]</span><span class="op" id="5967740">*</span><span class="ident" id="5967741">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967749">last</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5967756">*</span><span class="ident" id="5967757">fileWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967769">closed</span>&nbsp;<span class="builtintype" id="5967776">bool</span><br>
<span class="lineno">25</span><span class="op" id="5967781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5967784">type</span>&nbsp;<span class="ident" id="5967789">header</span>&nbsp;<span class="keyword" id="5967796">struct</span>&nbsp;<span class="op" id="5967803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967806">*</span><span class="ident" id="5967807">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967819">offset</span>&nbsp;<span class="ident" id="5967826">uint64</span><br>
<span class="lineno">30</span><span class="op" id="5967833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5967836">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;a&nbsp;zip&nbsp;file&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5967895">func</span>&nbsp;<span class="ident" id="5967900">NewWriter</span><span class="op" id="5967909">(</span><span class="ident" id="5967910">w</span>&nbsp;<span class="ident" id="5967912">io</span><span class="op" id="5967914">.</span><span class="ident" id="5967915">Writer</span><span class="op" id="5967921">)</span>&nbsp;<span class="op" id="5967923">*</span><span class="ident" id="5967924">Writer</span>&nbsp;<span class="op" id="5967931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967934">return</span>&nbsp;<span class="op" id="5967941">&amp;</span><span class="ident" id="5967942">Writer</span><span class="op" id="5967948">{</span><span class="ident" id="5967949">cw</span><span class="op" id="5967951">:</span>&nbsp;<span class="op" id="5967953">&amp;</span><span class="ident" id="5967954">countWriter</span><span class="op" id="5967965">{</span><span class="ident" id="5967966">w</span><span class="op" id="5967967">:</span>&nbsp;<span class="ident" id="5967969">bufio</span><span class="op" id="5967974">.</span><span class="ident" id="5967975">NewWriter</span><span class="op" id="5967984">(</span><span class="ident" id="5967985">w</span><span class="op" id="5967986">)</span><span class="op" id="5967987">}</span><span class="op" id="5967988">}</span><br>
<span class="lineno">35</span><span class="op" id="5967990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5967993">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="5968054">//&nbsp;Calling&nbsp;Flush&nbsp;is&nbsp;not&nbsp;normally&nbsp;necessary;&nbsp;calling&nbsp;Close&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="keyword" id="5968127">func</span>&nbsp;<span class="op" id="5968132">(</span><span class="ident" id="5968133">w</span>&nbsp;<span class="op" id="5968135">*</span><span class="ident" id="5968136">Writer</span><span class="op" id="5968142">)</span>&nbsp;<span class="ident" id="5968144">Flush</span><span class="op" id="5968149">(</span><span class="op" id="5968150">)</span>&nbsp;<span class="builtintype" id="5968152">error</span>&nbsp;<span class="op" id="5968158">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968161">return</span>&nbsp;<span class="ident" id="5968168">w</span><span class="op" id="5968169">.</span><span class="ident" id="5968170">cw</span><span class="op" id="5968172">.</span><span class="ident" id="5968173">w</span><span class="op" id="5968174">.</span><span class="op" id="5968175">(</span><span class="op" id="5968176">*</span><span class="ident" id="5968177">bufio</span><span class="op" id="5968182">.</span><span class="ident" id="5968183">Writer</span><span class="op" id="5968189">)</span><span class="op" id="5968190">.</span><span class="ident" id="5968191">Flush</span><span class="op" id="5968196">(</span><span class="op" id="5968197">)</span><br>
<span class="lineno"></span><span class="op" id="5968199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5968202">//&nbsp;Close&nbsp;finishes&nbsp;writing&nbsp;the&nbsp;zip&nbsp;file&nbsp;by&nbsp;writing&nbsp;the&nbsp;central&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="5968275">//&nbsp;It&nbsp;does&nbsp;not&nbsp;(and&nbsp;can&nbsp;not)&nbsp;close&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">45</span><span class="keyword" id="5968333">func</span>&nbsp;<span class="op" id="5968338">(</span><span class="ident" id="5968339">w</span>&nbsp;<span class="op" id="5968341">*</span><span class="ident" id="5968342">Writer</span><span class="op" id="5968348">)</span>&nbsp;<span class="ident" id="5968350">Close</span><span class="op" id="5968355">(</span><span class="op" id="5968356">)</span>&nbsp;<span class="builtintype" id="5968358">error</span>&nbsp;<span class="op" id="5968364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968367">if</span>&nbsp;<span class="ident" id="5968370">w</span><span class="op" id="5968371">.</span><span class="ident" id="5968372">last</span>&nbsp;<span class="op" id="5968377">!=</span>&nbsp;<span class="ident" id="5968380">nil</span>&nbsp;<span class="op" id="5968384">&amp;&amp;</span>&nbsp;<span class="op" id="5968387">!</span><span class="ident" id="5968388">w</span><span class="op" id="5968389">.</span><span class="ident" id="5968390">last</span><span class="op" id="5968394">.</span><span class="ident" id="5968395">closed</span>&nbsp;<span class="op" id="5968402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968406">if</span>&nbsp;<span class="ident" id="5968409">err</span>&nbsp;<span class="op" id="5968413">:=</span>&nbsp;<span class="ident" id="5968416">w</span><span class="op" id="5968417">.</span><span class="ident" id="5968418">last</span><span class="op" id="5968422">.</span><span class="builtinfunc" id="5968423">close</span><span class="op" id="5968428">(</span><span class="op" id="5968429">)</span><span class="op" id="5968430">;</span>&nbsp;<span class="ident" id="5968432">err</span>&nbsp;<span class="op" id="5968436">!=</span>&nbsp;<span class="ident" id="5968439">nil</span>&nbsp;<span class="op" id="5968443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968448">return</span>&nbsp;<span class="ident" id="5968455">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968461">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968465">w</span><span class="op" id="5968466">.</span><span class="ident" id="5968467">last</span>&nbsp;<span class="op" id="5968472">=</span>&nbsp;<span class="ident" id="5968474">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968482">if</span>&nbsp;<span class="ident" id="5968485">w</span><span class="op" id="5968486">.</span><span class="ident" id="5968487">closed</span>&nbsp;<span class="op" id="5968494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968498">return</span>&nbsp;<span class="ident" id="5968505">errors</span><span class="op" id="5968511">.</span><span class="ident" id="5968512">New</span><span class="op" id="5968515">(</span><span class="string" id="5968516">&#34;zip:&nbsp;writer&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="5968542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968545">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968548">w</span><span class="op" id="5968549">.</span><span class="ident" id="5968550">closed</span>&nbsp;<span class="op" id="5968557">=</span>&nbsp;<span class="builtintype" id="5968559">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5968566">//&nbsp;write&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968594">start</span>&nbsp;<span class="op" id="5968600">:=</span>&nbsp;<span class="ident" id="5968603">w</span><span class="op" id="5968604">.</span><span class="ident" id="5968605">cw</span><span class="op" id="5968607">.</span><span class="ident" id="5968608">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968615">for</span>&nbsp;<span class="ident" id="5968619">_</span><span class="op" id="5968620">,</span>&nbsp;<span class="ident" id="5968622">h</span>&nbsp;<span class="op" id="5968624">:=</span>&nbsp;<span class="keyword" id="5968627">range</span>&nbsp;<span class="ident" id="5968633">w</span><span class="op" id="5968634">.</span><span class="ident" id="5968635">dir</span>&nbsp;<span class="op" id="5968639">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968643">var</span>&nbsp;<span class="ident" id="5968647">buf</span>&nbsp;<span class="op" id="5968651">[</span><span class="ident" id="5968652">directoryHeaderLen</span><span class="op" id="5968670">]</span><span class="builtintype" id="5968671">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968678">b</span>&nbsp;<span class="op" id="5968680">:=</span>&nbsp;<span class="ident" id="5968683">writeBuf</span><span class="op" id="5968691">(</span><span class="ident" id="5968692">buf</span><span class="op" id="5968695">[</span><span class="op" id="5968696">:</span><span class="op" id="5968697">]</span><span class="op" id="5968698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968702">b</span><span class="op" id="5968703">.</span><span class="builtintype" id="5968704">uint32</span><span class="op" id="5968710">(</span><span class="builtintype" id="5968711">uint32</span><span class="op" id="5968717">(</span><span class="ident" id="5968718">directoryHeaderSignature</span><span class="op" id="5968742">)</span><span class="op" id="5968743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968747">b</span><span class="op" id="5968748">.</span><span class="builtintype" id="5968749">uint16</span><span class="op" id="5968755">(</span><span class="ident" id="5968756">h</span><span class="op" id="5968757">.</span><span class="ident" id="5968758">CreatorVersion</span><span class="op" id="5968772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968776">b</span><span class="op" id="5968777">.</span><span class="builtintype" id="5968778">uint16</span><span class="op" id="5968784">(</span><span class="ident" id="5968785">h</span><span class="op" id="5968786">.</span><span class="ident" id="5968787">ReaderVersion</span><span class="op" id="5968800">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968804">b</span><span class="op" id="5968805">.</span><span class="builtintype" id="5968806">uint16</span><span class="op" id="5968812">(</span><span class="ident" id="5968813">h</span><span class="op" id="5968814">.</span><span class="ident" id="5968815">Flags</span><span class="op" id="5968820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968824">b</span><span class="op" id="5968825">.</span><span class="builtintype" id="5968826">uint16</span><span class="op" id="5968832">(</span><span class="ident" id="5968833">h</span><span class="op" id="5968834">.</span><span class="ident" id="5968835">Method</span><span class="op" id="5968841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968845">b</span><span class="op" id="5968846">.</span><span class="builtintype" id="5968847">uint16</span><span class="op" id="5968853">(</span><span class="ident" id="5968854">h</span><span class="op" id="5968855">.</span><span class="ident" id="5968856">ModifiedTime</span><span class="op" id="5968868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968872">b</span><span class="op" id="5968873">.</span><span class="builtintype" id="5968874">uint16</span><span class="op" id="5968880">(</span><span class="ident" id="5968881">h</span><span class="op" id="5968882">.</span><span class="ident" id="5968883">ModifiedDate</span><span class="op" id="5968895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968899">b</span><span class="op" id="5968900">.</span><span class="builtintype" id="5968901">uint32</span><span class="op" id="5968907">(</span><span class="ident" id="5968908">h</span><span class="op" id="5968909">.</span><span class="ident" id="5968910">CRC32</span><span class="op" id="5968915">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968919">if</span>&nbsp;<span class="ident" id="5968922">h</span><span class="op" id="5968923">.</span><span class="ident" id="5968924">isZip64</span><span class="op" id="5968931">(</span><span class="op" id="5968932">)</span>&nbsp;<span class="op" id="5968934">||</span>&nbsp;<span class="ident" id="5968937">h</span><span class="op" id="5968938">.</span><span class="ident" id="5968939">offset</span>&nbsp;<span class="op" id="5968946">&gt;</span>&nbsp;<span class="ident" id="5968948">uint32max</span>&nbsp;<span class="op" id="5968958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5968963">//&nbsp;the&nbsp;file&nbsp;needs&nbsp;a&nbsp;zip64&nbsp;header.&nbsp;store&nbsp;maxint&nbsp;in&nbsp;both</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5969021">//&nbsp;32&nbsp;bit&nbsp;size&nbsp;fields&nbsp;(and&nbsp;offset&nbsp;later)&nbsp;to&nbsp;signal&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5969084">//&nbsp;zip64&nbsp;extra&nbsp;header&nbsp;should&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969125">b</span><span class="op" id="5969126">.</span><span class="builtintype" id="5969127">uint32</span><span class="op" id="5969133">(</span><span class="ident" id="5969134">uint32max</span><span class="op" id="5969143">)</span>&nbsp;<span class="comment" id="5969145">//&nbsp;compressed&nbsp;size</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969167">b</span><span class="op" id="5969168">.</span><span class="builtintype" id="5969169">uint32</span><span class="op" id="5969175">(</span><span class="ident" id="5969176">uint32max</span><span class="op" id="5969185">)</span>&nbsp;<span class="comment" id="5969187">//&nbsp;uncompressed&nbsp;size</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5969212">//&nbsp;append&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;block&nbsp;to&nbsp;Extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969254">var</span>&nbsp;<span class="ident" id="5969258">buf</span>&nbsp;<span class="op" id="5969262">[</span><span class="num" id="5969263">28</span><span class="op" id="5969265">]</span><span class="builtintype" id="5969266">byte</span>&nbsp;<span class="comment" id="5969271">//&nbsp;2x&nbsp;uint16&nbsp;+&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969299">eb</span>&nbsp;<span class="op" id="5969302">:=</span>&nbsp;<span class="ident" id="5969305">writeBuf</span><span class="op" id="5969313">(</span><span class="ident" id="5969314">buf</span><span class="op" id="5969317">[</span><span class="op" id="5969318">:</span><span class="op" id="5969319">]</span><span class="op" id="5969320">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969325">eb</span><span class="op" id="5969327">.</span><span class="builtintype" id="5969328">uint16</span><span class="op" id="5969334">(</span><span class="ident" id="5969335">zip64ExtraId</span><span class="op" id="5969347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969352">eb</span><span class="op" id="5969354">.</span><span class="builtintype" id="5969355">uint16</span><span class="op" id="5969361">(</span><span class="num" id="5969362">24</span><span class="op" id="5969364">)</span>&nbsp;<span class="comment" id="5969366">//&nbsp;size&nbsp;=&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969389">eb</span><span class="op" id="5969391">.</span><span class="ident" id="5969392">uint64</span><span class="op" id="5969398">(</span><span class="ident" id="5969399">h</span><span class="op" id="5969400">.</span><span class="ident" id="5969401">UncompressedSize64</span><span class="op" id="5969419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969424">eb</span><span class="op" id="5969426">.</span><span class="ident" id="5969427">uint64</span><span class="op" id="5969433">(</span><span class="ident" id="5969434">h</span><span class="op" id="5969435">.</span><span class="ident" id="5969436">CompressedSize64</span><span class="op" id="5969452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969457">eb</span><span class="op" id="5969459">.</span><span class="ident" id="5969460">uint64</span><span class="op" id="5969466">(</span><span class="ident" id="5969467">h</span><span class="op" id="5969468">.</span><span class="ident" id="5969469">offset</span><span class="op" id="5969475">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969480">h</span><span class="op" id="5969481">.</span><span class="ident" id="5969482">Extra</span>&nbsp;<span class="op" id="5969488">=</span>&nbsp;<span class="builtinfunc" id="5969490">append</span><span class="op" id="5969496">(</span><span class="ident" id="5969497">h</span><span class="op" id="5969498">.</span><span class="ident" id="5969499">Extra</span><span class="op" id="5969504">,</span>&nbsp;<span class="ident" id="5969506">buf</span><span class="op" id="5969509">[</span><span class="op" id="5969510">:</span><span class="op" id="5969511">]</span><span class="op" id="5969512">...</span><span class="op" id="5969515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969519">}</span>&nbsp;<span class="keyword" id="5969521">else</span>&nbsp;<span class="op" id="5969526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969531">b</span><span class="op" id="5969532">.</span><span class="builtintype" id="5969533">uint32</span><span class="op" id="5969539">(</span><span class="ident" id="5969540">h</span><span class="op" id="5969541">.</span><span class="ident" id="5969542">CompressedSize</span><span class="op" id="5969556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969561">b</span><span class="op" id="5969562">.</span><span class="builtintype" id="5969563">uint32</span><span class="op" id="5969569">(</span><span class="ident" id="5969570">h</span><span class="op" id="5969571">.</span><span class="ident" id="5969572">UncompressedSize</span><span class="op" id="5969588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969592">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969596">b</span><span class="op" id="5969597">.</span><span class="builtintype" id="5969598">uint16</span><span class="op" id="5969604">(</span><span class="builtintype" id="5969605">uint16</span><span class="op" id="5969611">(</span><span class="builtinfunc" id="5969612">len</span><span class="op" id="5969615">(</span><span class="ident" id="5969616">h</span><span class="op" id="5969617">.</span><span class="ident" id="5969618">Name</span><span class="op" id="5969622">)</span><span class="op" id="5969623">)</span><span class="op" id="5969624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969628">b</span><span class="op" id="5969629">.</span><span class="builtintype" id="5969630">uint16</span><span class="op" id="5969636">(</span><span class="builtintype" id="5969637">uint16</span><span class="op" id="5969643">(</span><span class="builtinfunc" id="5969644">len</span><span class="op" id="5969647">(</span><span class="ident" id="5969648">h</span><span class="op" id="5969649">.</span><span class="ident" id="5969650">Extra</span><span class="op" id="5969655">)</span><span class="op" id="5969656">)</span><span class="op" id="5969657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969661">b</span><span class="op" id="5969662">.</span><span class="builtintype" id="5969663">uint16</span><span class="op" id="5969669">(</span><span class="builtintype" id="5969670">uint16</span><span class="op" id="5969676">(</span><span class="builtinfunc" id="5969677">len</span><span class="op" id="5969680">(</span><span class="ident" id="5969681">h</span><span class="op" id="5969682">.</span><span class="ident" id="5969683">Comment</span><span class="op" id="5969690">)</span><span class="op" id="5969691">)</span><span class="op" id="5969692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969696">b</span>&nbsp;<span class="op" id="5969698">=</span>&nbsp;<span class="ident" id="5969700">b</span><span class="op" id="5969701">[</span><span class="num" id="5969702">4</span><span class="op" id="5969703">:</span><span class="op" id="5969704">]</span>&nbsp;<span class="comment" id="5969706">//&nbsp;skip&nbsp;disk&nbsp;number&nbsp;start&nbsp;and&nbsp;internal&nbsp;file&nbsp;attr&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969769">b</span><span class="op" id="5969770">.</span><span class="builtintype" id="5969771">uint32</span><span class="op" id="5969777">(</span><span class="ident" id="5969778">h</span><span class="op" id="5969779">.</span><span class="ident" id="5969780">ExternalAttrs</span><span class="op" id="5969793">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969797">if</span>&nbsp;<span class="ident" id="5969800">h</span><span class="op" id="5969801">.</span><span class="ident" id="5969802">offset</span>&nbsp;<span class="op" id="5969809">&gt;</span>&nbsp;<span class="ident" id="5969811">uint32max</span>&nbsp;<span class="op" id="5969821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969826">b</span><span class="op" id="5969827">.</span><span class="builtintype" id="5969828">uint32</span><span class="op" id="5969834">(</span><span class="ident" id="5969835">uint32max</span><span class="op" id="5969844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969848">}</span>&nbsp;<span class="keyword" id="5969850">else</span>&nbsp;<span class="op" id="5969855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969860">b</span><span class="op" id="5969861">.</span><span class="builtintype" id="5969862">uint32</span><span class="op" id="5969868">(</span><span class="builtintype" id="5969869">uint32</span><span class="op" id="5969875">(</span><span class="ident" id="5969876">h</span><span class="op" id="5969877">.</span><span class="ident" id="5969878">offset</span><span class="op" id="5969884">)</span><span class="op" id="5969885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969889">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969893">if</span>&nbsp;<span class="ident" id="5969896">_</span><span class="op" id="5969897">,</span>&nbsp;<span class="ident" id="5969899">err</span>&nbsp;<span class="op" id="5969903">:=</span>&nbsp;<span class="ident" id="5969906">w</span><span class="op" id="5969907">.</span><span class="ident" id="5969908">cw</span><span class="op" id="5969910">.</span><span class="ident" id="5969911">Write</span><span class="op" id="5969916">(</span><span class="ident" id="5969917">buf</span><span class="op" id="5969920">[</span><span class="op" id="5969921">:</span><span class="op" id="5969922">]</span><span class="op" id="5969923">)</span><span class="op" id="5969924">;</span>&nbsp;<span class="ident" id="5969926">err</span>&nbsp;<span class="op" id="5969930">!=</span>&nbsp;<span class="ident" id="5969933">nil</span>&nbsp;<span class="op" id="5969937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969942">return</span>&nbsp;<span class="ident" id="5969949">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969959">if</span>&nbsp;<span class="ident" id="5969962">_</span><span class="op" id="5969963">,</span>&nbsp;<span class="ident" id="5969965">err</span>&nbsp;<span class="op" id="5969969">:=</span>&nbsp;<span class="ident" id="5969972">io</span><span class="op" id="5969974">.</span><span class="ident" id="5969975">WriteString</span><span class="op" id="5969986">(</span><span class="ident" id="5969987">w</span><span class="op" id="5969988">.</span><span class="ident" id="5969989">cw</span><span class="op" id="5969991">,</span>&nbsp;<span class="ident" id="5969993">h</span><span class="op" id="5969994">.</span><span class="ident" id="5969995">Name</span><span class="op" id="5969999">)</span><span class="op" id="5970000">;</span>&nbsp;<span class="ident" id="5970002">err</span>&nbsp;<span class="op" id="5970006">!=</span>&nbsp;<span class="ident" id="5970009">nil</span>&nbsp;<span class="op" id="5970013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970018">return</span>&nbsp;<span class="ident" id="5970025">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970035">if</span>&nbsp;<span class="ident" id="5970038">_</span><span class="op" id="5970039">,</span>&nbsp;<span class="ident" id="5970041">err</span>&nbsp;<span class="op" id="5970045">:=</span>&nbsp;<span class="ident" id="5970048">w</span><span class="op" id="5970049">.</span><span class="ident" id="5970050">cw</span><span class="op" id="5970052">.</span><span class="ident" id="5970053">Write</span><span class="op" id="5970058">(</span><span class="ident" id="5970059">h</span><span class="op" id="5970060">.</span><span class="ident" id="5970061">Extra</span><span class="op" id="5970066">)</span><span class="op" id="5970067">;</span>&nbsp;<span class="ident" id="5970069">err</span>&nbsp;<span class="op" id="5970073">!=</span>&nbsp;<span class="ident" id="5970076">nil</span>&nbsp;<span class="op" id="5970080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970085">return</span>&nbsp;<span class="ident" id="5970092">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970102">if</span>&nbsp;<span class="ident" id="5970105">_</span><span class="op" id="5970106">,</span>&nbsp;<span class="ident" id="5970108">err</span>&nbsp;<span class="op" id="5970112">:=</span>&nbsp;<span class="ident" id="5970115">io</span><span class="op" id="5970117">.</span><span class="ident" id="5970118">WriteString</span><span class="op" id="5970129">(</span><span class="ident" id="5970130">w</span><span class="op" id="5970131">.</span><span class="ident" id="5970132">cw</span><span class="op" id="5970134">,</span>&nbsp;<span class="ident" id="5970136">h</span><span class="op" id="5970137">.</span><span class="ident" id="5970138">Comment</span><span class="op" id="5970145">)</span><span class="op" id="5970146">;</span>&nbsp;<span class="ident" id="5970148">err</span>&nbsp;<span class="op" id="5970152">!=</span>&nbsp;<span class="ident" id="5970155">nil</span>&nbsp;<span class="op" id="5970159">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970164">return</span>&nbsp;<span class="ident" id="5970171">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970183">end</span>&nbsp;<span class="op" id="5970187">:=</span>&nbsp;<span class="ident" id="5970190">w</span><span class="op" id="5970191">.</span><span class="ident" id="5970192">cw</span><span class="op" id="5970194">.</span><span class="ident" id="5970195">count</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970203">records</span>&nbsp;<span class="op" id="5970211">:=</span>&nbsp;<span class="ident" id="5970214">uint64</span><span class="op" id="5970220">(</span><span class="builtinfunc" id="5970221">len</span><span class="op" id="5970224">(</span><span class="ident" id="5970225">w</span><span class="op" id="5970226">.</span><span class="ident" id="5970227">dir</span><span class="op" id="5970230">)</span><span class="op" id="5970231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970234">size</span>&nbsp;<span class="op" id="5970239">:=</span>&nbsp;<span class="ident" id="5970242">uint64</span><span class="op" id="5970248">(</span><span class="ident" id="5970249">end</span>&nbsp;<span class="op" id="5970253">-</span>&nbsp;<span class="ident" id="5970255">start</span><span class="op" id="5970260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970263">offset</span>&nbsp;<span class="op" id="5970270">:=</span>&nbsp;<span class="ident" id="5970273">uint64</span><span class="op" id="5970279">(</span><span class="ident" id="5970280">start</span><span class="op" id="5970285">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970289">if</span>&nbsp;<span class="ident" id="5970292">records</span>&nbsp;<span class="op" id="5970300">&gt;</span>&nbsp;<span class="ident" id="5970302">uint16max</span>&nbsp;<span class="op" id="5970312">||</span>&nbsp;<span class="ident" id="5970315">size</span>&nbsp;<span class="op" id="5970320">&gt;</span>&nbsp;<span class="ident" id="5970322">uint32max</span>&nbsp;<span class="op" id="5970332">||</span>&nbsp;<span class="ident" id="5970335">offset</span>&nbsp;<span class="op" id="5970342">&gt;</span>&nbsp;<span class="ident" id="5970344">uint32max</span>&nbsp;<span class="op" id="5970354">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970358">var</span>&nbsp;<span class="ident" id="5970362">buf</span>&nbsp;<span class="op" id="5970366">[</span><span class="ident" id="5970367">directory64EndLen</span>&nbsp;<span class="op" id="5970385">+</span>&nbsp;<span class="ident" id="5970387">directory64LocLen</span><span class="op" id="5970404">]</span><span class="builtintype" id="5970405">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970412">b</span>&nbsp;<span class="op" id="5970414">:=</span>&nbsp;<span class="ident" id="5970417">writeBuf</span><span class="op" id="5970425">(</span><span class="ident" id="5970426">buf</span><span class="op" id="5970429">[</span><span class="op" id="5970430">:</span><span class="op" id="5970431">]</span><span class="op" id="5970432">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5970437">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970480">b</span><span class="op" id="5970481">.</span><span class="builtintype" id="5970482">uint32</span><span class="op" id="5970488">(</span><span class="ident" id="5970489">directory64EndSignature</span><span class="op" id="5970512">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970516">b</span><span class="op" id="5970517">.</span><span class="ident" id="5970518">uint64</span><span class="op" id="5970524">(</span><span class="ident" id="5970525">directory64EndLen</span><span class="op" id="5970542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970546">b</span><span class="op" id="5970547">.</span><span class="builtintype" id="5970548">uint16</span><span class="op" id="5970554">(</span><span class="ident" id="5970555">zipVersion45</span><span class="op" id="5970567">)</span>&nbsp;<span class="comment" id="5970569">//&nbsp;version&nbsp;made&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970590">b</span><span class="op" id="5970591">.</span><span class="builtintype" id="5970592">uint16</span><span class="op" id="5970598">(</span><span class="ident" id="5970599">zipVersion45</span><span class="op" id="5970611">)</span>&nbsp;<span class="comment" id="5970613">//&nbsp;version&nbsp;needed&nbsp;to&nbsp;extract</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970644">b</span><span class="op" id="5970645">.</span><span class="builtintype" id="5970646">uint32</span><span class="op" id="5970652">(</span><span class="num" id="5970653">0</span><span class="op" id="5970654">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5970667">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970692">b</span><span class="op" id="5970693">.</span><span class="builtintype" id="5970694">uint32</span><span class="op" id="5970700">(</span><span class="num" id="5970701">0</span><span class="op" id="5970702">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5970715">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970779">b</span><span class="op" id="5970780">.</span><span class="ident" id="5970781">uint64</span><span class="op" id="5970787">(</span><span class="ident" id="5970788">records</span><span class="op" id="5970795">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5970802">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970869">b</span><span class="op" id="5970870">.</span><span class="ident" id="5970871">uint64</span><span class="op" id="5970877">(</span><span class="ident" id="5970878">records</span><span class="op" id="5970885">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5970892">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970946">b</span><span class="op" id="5970947">.</span><span class="ident" id="5970948">uint64</span><span class="op" id="5970954">(</span><span class="ident" id="5970955">size</span><span class="op" id="5970959">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5970969">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971004">b</span><span class="op" id="5971005">.</span><span class="ident" id="5971006">uint64</span><span class="op" id="5971012">(</span><span class="ident" id="5971013">offset</span><span class="op" id="5971019">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5971027">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5971111">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;locator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971155">b</span><span class="op" id="5971156">.</span><span class="builtintype" id="5971157">uint32</span><span class="op" id="5971163">(</span><span class="ident" id="5971164">directory64LocSignature</span><span class="op" id="5971187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971191">b</span><span class="op" id="5971192">.</span><span class="builtintype" id="5971193">uint32</span><span class="op" id="5971199">(</span><span class="num" id="5971200">0</span><span class="op" id="5971201">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5971213">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971290">b</span><span class="op" id="5971291">.</span><span class="ident" id="5971292">uint64</span><span class="op" id="5971298">(</span><span class="ident" id="5971299">uint64</span><span class="op" id="5971305">(</span><span class="ident" id="5971306">end</span><span class="op" id="5971309">)</span><span class="op" id="5971310">)</span>&nbsp;<span class="comment" id="5971312">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971378">b</span><span class="op" id="5971379">.</span><span class="builtintype" id="5971380">uint32</span><span class="op" id="5971386">(</span><span class="num" id="5971387">1</span><span class="op" id="5971388">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5971400">//&nbsp;total&nbsp;number&nbsp;of&nbsp;disks</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971428">if</span>&nbsp;<span class="ident" id="5971431">_</span><span class="op" id="5971432">,</span>&nbsp;<span class="ident" id="5971434">err</span>&nbsp;<span class="op" id="5971438">:=</span>&nbsp;<span class="ident" id="5971441">w</span><span class="op" id="5971442">.</span><span class="ident" id="5971443">cw</span><span class="op" id="5971445">.</span><span class="ident" id="5971446">Write</span><span class="op" id="5971451">(</span><span class="ident" id="5971452">buf</span><span class="op" id="5971455">[</span><span class="op" id="5971456">:</span><span class="op" id="5971457">]</span><span class="op" id="5971458">)</span><span class="op" id="5971459">;</span>&nbsp;<span class="ident" id="5971461">err</span>&nbsp;<span class="op" id="5971465">!=</span>&nbsp;<span class="ident" id="5971468">nil</span>&nbsp;<span class="op" id="5971472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971477">return</span>&nbsp;<span class="ident" id="5971484">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5971495">//&nbsp;store&nbsp;max&nbsp;values&nbsp;in&nbsp;the&nbsp;regular&nbsp;end&nbsp;record&nbsp;to&nbsp;signal&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5971558">//&nbsp;that&nbsp;the&nbsp;zip64&nbsp;values&nbsp;should&nbsp;be&nbsp;used&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971608">records</span>&nbsp;<span class="op" id="5971616">=</span>&nbsp;<span class="ident" id="5971618">uint16max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971630">size</span>&nbsp;<span class="op" id="5971635">=</span>&nbsp;<span class="ident" id="5971637">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971649">offset</span>&nbsp;<span class="op" id="5971656">=</span>&nbsp;<span class="ident" id="5971658">uint32max</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5971673">//&nbsp;write&nbsp;end&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971694">var</span>&nbsp;<span class="ident" id="5971698">buf</span>&nbsp;<span class="op" id="5971702">[</span><span class="ident" id="5971703">directoryEndLen</span><span class="op" id="5971718">]</span><span class="builtintype" id="5971719">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971725">b</span>&nbsp;<span class="op" id="5971727">:=</span>&nbsp;<span class="ident" id="5971730">writeBuf</span><span class="op" id="5971738">(</span><span class="ident" id="5971739">buf</span><span class="op" id="5971742">[</span><span class="op" id="5971743">:</span><span class="op" id="5971744">]</span><span class="op" id="5971745">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971748">b</span><span class="op" id="5971749">.</span><span class="builtintype" id="5971750">uint32</span><span class="op" id="5971756">(</span><span class="builtintype" id="5971757">uint32</span><span class="op" id="5971763">(</span><span class="ident" id="5971764">directoryEndSignature</span><span class="op" id="5971785">)</span><span class="op" id="5971786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971789">b</span>&nbsp;<span class="op" id="5971791">=</span>&nbsp;<span class="ident" id="5971793">b</span><span class="op" id="5971794">[</span><span class="num" id="5971795">4</span><span class="op" id="5971796">:</span><span class="op" id="5971797">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5971815">//&nbsp;skip&nbsp;over&nbsp;disk&nbsp;number&nbsp;and&nbsp;first&nbsp;disk&nbsp;number&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971875">b</span><span class="op" id="5971876">.</span><span class="builtintype" id="5971877">uint16</span><span class="op" id="5971883">(</span><span class="builtintype" id="5971884">uint16</span><span class="op" id="5971890">(</span><span class="ident" id="5971891">records</span><span class="op" id="5971898">)</span><span class="op" id="5971899">)</span>&nbsp;<span class="comment" id="5971901">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971933">b</span><span class="op" id="5971934">.</span><span class="builtintype" id="5971935">uint16</span><span class="op" id="5971941">(</span><span class="builtintype" id="5971942">uint16</span><span class="op" id="5971948">(</span><span class="ident" id="5971949">records</span><span class="op" id="5971956">)</span><span class="op" id="5971957">)</span>&nbsp;<span class="comment" id="5971959">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;total</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971987">b</span><span class="op" id="5971988">.</span><span class="builtintype" id="5971989">uint32</span><span class="op" id="5971995">(</span><span class="builtintype" id="5971996">uint32</span><span class="op" id="5972002">(</span><span class="ident" id="5972003">size</span><span class="op" id="5972007">)</span><span class="op" id="5972008">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5972013">//&nbsp;size&nbsp;of&nbsp;directory</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972035">b</span><span class="op" id="5972036">.</span><span class="builtintype" id="5972037">uint32</span><span class="op" id="5972043">(</span><span class="builtintype" id="5972044">uint32</span><span class="op" id="5972050">(</span><span class="ident" id="5972051">offset</span><span class="op" id="5972057">)</span><span class="op" id="5972058">)</span>&nbsp;&nbsp;<span class="comment" id="5972061">//&nbsp;start&nbsp;of&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972084">//&nbsp;skipped&nbsp;size&nbsp;of&nbsp;comment&nbsp;(always&nbsp;zero)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972126">if</span>&nbsp;<span class="ident" id="5972129">_</span><span class="op" id="5972130">,</span>&nbsp;<span class="ident" id="5972132">err</span>&nbsp;<span class="op" id="5972136">:=</span>&nbsp;<span class="ident" id="5972139">w</span><span class="op" id="5972140">.</span><span class="ident" id="5972141">cw</span><span class="op" id="5972143">.</span><span class="ident" id="5972144">Write</span><span class="op" id="5972149">(</span><span class="ident" id="5972150">buf</span><span class="op" id="5972153">[</span><span class="op" id="5972154">:</span><span class="op" id="5972155">]</span><span class="op" id="5972156">)</span><span class="op" id="5972157">;</span>&nbsp;<span class="ident" id="5972159">err</span>&nbsp;<span class="op" id="5972163">!=</span>&nbsp;<span class="ident" id="5972166">nil</span>&nbsp;<span class="op" id="5972170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972174">return</span>&nbsp;<span class="ident" id="5972181">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972186">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972190">return</span>&nbsp;<span class="ident" id="5972197">w</span><span class="op" id="5972198">.</span><span class="ident" id="5972199">cw</span><span class="op" id="5972201">.</span><span class="ident" id="5972202">w</span><span class="op" id="5972203">.</span><span class="op" id="5972204">(</span><span class="op" id="5972205">*</span><span class="ident" id="5972206">bufio</span><span class="op" id="5972211">.</span><span class="ident" id="5972212">Writer</span><span class="op" id="5972218">)</span><span class="op" id="5972219">.</span><span class="ident" id="5972220">Flush</span><span class="op" id="5972225">(</span><span class="op" id="5972226">)</span><br>
<span class="lineno"></span><span class="op" id="5972228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5972231">//&nbsp;Create&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;name.</span><br>
<span class="lineno">170</span><span class="comment" id="5972294">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="5972363">//&nbsp;The&nbsp;name&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span><span class="comment" id="5972431">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5972498">//&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="5972510">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno">175</span><span class="comment" id="5972582">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5972625">func</span>&nbsp;<span class="op" id="5972630">(</span><span class="ident" id="5972631">w</span>&nbsp;<span class="op" id="5972633">*</span><span class="ident" id="5972634">Writer</span><span class="op" id="5972640">)</span>&nbsp;<span class="ident" id="5972642">Create</span><span class="op" id="5972648">(</span><span class="ident" id="5972649">name</span>&nbsp;<span class="builtintype" id="5972654">string</span><span class="op" id="5972660">)</span>&nbsp;<span class="op" id="5972662">(</span><span class="ident" id="5972663">io</span><span class="op" id="5972665">.</span><span class="ident" id="5972666">Writer</span><span class="op" id="5972672">,</span>&nbsp;<span class="builtintype" id="5972674">error</span><span class="op" id="5972679">)</span>&nbsp;<span class="op" id="5972681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972684">header</span>&nbsp;<span class="op" id="5972691">:=</span>&nbsp;<span class="op" id="5972694">&amp;</span><span class="ident" id="5972695">FileHeader</span><span class="op" id="5972705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972709">Name</span><span class="op" id="5972713">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5972717">name</span><span class="op" id="5972721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972725">Method</span><span class="op" id="5972731">:</span>&nbsp;<span class="ident" id="5972733">Deflate</span><span class="op" id="5972740">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972746">return</span>&nbsp;<span class="ident" id="5972753">w</span><span class="op" id="5972754">.</span><span class="ident" id="5972755">CreateHeader</span><span class="op" id="5972767">(</span><span class="ident" id="5972768">header</span><span class="op" id="5972774">)</span><br>
<span class="lineno"></span><span class="op" id="5972776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5972779">//&nbsp;CreateHeader&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;FileHeader</span><br>
<span class="lineno">185</span><span class="comment" id="5972853">//&nbsp;for&nbsp;the&nbsp;file&nbsp;metadata.</span><br>
<span class="lineno"></span><span class="comment" id="5972879">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="5972948">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="5973020">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5973063">func</span>&nbsp;<span class="op" id="5973068">(</span><span class="ident" id="5973069">w</span>&nbsp;<span class="op" id="5973071">*</span><span class="ident" id="5973072">Writer</span><span class="op" id="5973078">)</span>&nbsp;<span class="ident" id="5973080">CreateHeader</span><span class="op" id="5973092">(</span><span class="ident" id="5973093">fh</span>&nbsp;<span class="op" id="5973096">*</span><span class="ident" id="5973097">FileHeader</span><span class="op" id="5973107">)</span>&nbsp;<span class="op" id="5973109">(</span><span class="ident" id="5973110">io</span><span class="op" id="5973112">.</span><span class="ident" id="5973113">Writer</span><span class="op" id="5973119">,</span>&nbsp;<span class="builtintype" id="5973121">error</span><span class="op" id="5973126">)</span>&nbsp;<span class="op" id="5973128">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973131">if</span>&nbsp;<span class="ident" id="5973134">w</span><span class="op" id="5973135">.</span><span class="ident" id="5973136">last</span>&nbsp;<span class="op" id="5973141">!=</span>&nbsp;<span class="ident" id="5973144">nil</span>&nbsp;<span class="op" id="5973148">&amp;&amp;</span>&nbsp;<span class="op" id="5973151">!</span><span class="ident" id="5973152">w</span><span class="op" id="5973153">.</span><span class="ident" id="5973154">last</span><span class="op" id="5973158">.</span><span class="ident" id="5973159">closed</span>&nbsp;<span class="op" id="5973166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973170">if</span>&nbsp;<span class="ident" id="5973173">err</span>&nbsp;<span class="op" id="5973177">:=</span>&nbsp;<span class="ident" id="5973180">w</span><span class="op" id="5973181">.</span><span class="ident" id="5973182">last</span><span class="op" id="5973186">.</span><span class="builtinfunc" id="5973187">close</span><span class="op" id="5973192">(</span><span class="op" id="5973193">)</span><span class="op" id="5973194">;</span>&nbsp;<span class="ident" id="5973196">err</span>&nbsp;<span class="op" id="5973200">!=</span>&nbsp;<span class="ident" id="5973203">nil</span>&nbsp;<span class="op" id="5973207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973212">return</span>&nbsp;<span class="ident" id="5973219">nil</span><span class="op" id="5973222">,</span>&nbsp;<span class="ident" id="5973224">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973233">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973237">fh</span><span class="op" id="5973239">.</span><span class="ident" id="5973240">Flags</span>&nbsp;<span class="op" id="5973246">|=</span>&nbsp;<span class="num" id="5973249">0x8</span>&nbsp;<span class="comment" id="5973253">//&nbsp;we&nbsp;will&nbsp;write&nbsp;a&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973290">fh</span><span class="op" id="5973292">.</span><span class="ident" id="5973293">CreatorVersion</span>&nbsp;<span class="op" id="5973308">=</span>&nbsp;<span class="ident" id="5973310">fh</span><span class="op" id="5973312">.</span><span class="ident" id="5973313">CreatorVersion</span><span class="op" id="5973327">&amp;</span><span class="num" id="5973328">0xff00</span>&nbsp;<span class="op" id="5973335">|</span>&nbsp;<span class="ident" id="5973337">zipVersion20</span>&nbsp;<span class="comment" id="5973350">//&nbsp;preserve&nbsp;compatibility&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973382">fh</span><span class="op" id="5973384">.</span><span class="ident" id="5973385">ReaderVersion</span>&nbsp;<span class="op" id="5973399">=</span>&nbsp;<span class="ident" id="5973401">zipVersion20</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973416">fw</span>&nbsp;<span class="op" id="5973419">:=</span>&nbsp;<span class="op" id="5973422">&amp;</span><span class="ident" id="5973423">fileWriter</span><span class="op" id="5973433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973437">zipw</span><span class="op" id="5973441">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5973448">w</span><span class="op" id="5973449">.</span><span class="ident" id="5973450">cw</span><span class="op" id="5973452">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973456">compCount</span><span class="op" id="5973465">:</span>&nbsp;<span class="op" id="5973467">&amp;</span><span class="ident" id="5973468">countWriter</span><span class="op" id="5973479">{</span><span class="ident" id="5973480">w</span><span class="op" id="5973481">:</span>&nbsp;<span class="ident" id="5973483">w</span><span class="op" id="5973484">.</span><span class="ident" id="5973485">cw</span><span class="op" id="5973487">}</span><span class="op" id="5973488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973492">crc32</span><span class="op" id="5973497">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5973503">crc32</span><span class="op" id="5973508">.</span><span class="ident" id="5973509">NewIEEE</span><span class="op" id="5973516">(</span><span class="op" id="5973517">)</span><span class="op" id="5973518">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973524">comp</span>&nbsp;<span class="op" id="5973529">:=</span>&nbsp;<span class="ident" id="5973532">compressor</span><span class="op" id="5973542">(</span><span class="ident" id="5973543">fh</span><span class="op" id="5973545">.</span><span class="ident" id="5973546">Method</span><span class="op" id="5973552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973555">if</span>&nbsp;<span class="ident" id="5973558">comp</span>&nbsp;<span class="op" id="5973563">==</span>&nbsp;<span class="ident" id="5973566">nil</span>&nbsp;<span class="op" id="5973570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973574">return</span>&nbsp;<span class="ident" id="5973581">nil</span><span class="op" id="5973584">,</span>&nbsp;<span class="ident" id="5973586">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973600">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973603">var</span>&nbsp;<span class="ident" id="5973607">err</span>&nbsp;<span class="builtintype" id="5973611">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973618">fw</span><span class="op" id="5973620">.</span><span class="ident" id="5973621">comp</span><span class="op" id="5973625">,</span>&nbsp;<span class="ident" id="5973627">err</span>&nbsp;<span class="op" id="5973631">=</span>&nbsp;<span class="ident" id="5973633">comp</span><span class="op" id="5973637">(</span><span class="ident" id="5973638">fw</span><span class="op" id="5973640">.</span><span class="ident" id="5973641">compCount</span><span class="op" id="5973650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973653">if</span>&nbsp;<span class="ident" id="5973656">err</span>&nbsp;<span class="op" id="5973660">!=</span>&nbsp;<span class="ident" id="5973663">nil</span>&nbsp;<span class="op" id="5973667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973671">return</span>&nbsp;<span class="ident" id="5973678">nil</span><span class="op" id="5973681">,</span>&nbsp;<span class="ident" id="5973683">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973688">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973691">fw</span><span class="op" id="5973693">.</span><span class="ident" id="5973694">rawCount</span>&nbsp;<span class="op" id="5973703">=</span>&nbsp;<span class="op" id="5973705">&amp;</span><span class="ident" id="5973706">countWriter</span><span class="op" id="5973717">{</span><span class="ident" id="5973718">w</span><span class="op" id="5973719">:</span>&nbsp;<span class="ident" id="5973721">fw</span><span class="op" id="5973723">.</span><span class="ident" id="5973724">comp</span><span class="op" id="5973728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973732">h</span>&nbsp;<span class="op" id="5973734">:=</span>&nbsp;<span class="op" id="5973737">&amp;</span><span class="ident" id="5973738">header</span><span class="op" id="5973744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973748">FileHeader</span><span class="op" id="5973758">:</span>&nbsp;<span class="ident" id="5973760">fh</span><span class="op" id="5973762">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973766">offset</span><span class="op" id="5973772">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5973778">uint64</span><span class="op" id="5973784">(</span><span class="ident" id="5973785">w</span><span class="op" id="5973786">.</span><span class="ident" id="5973787">cw</span><span class="op" id="5973789">.</span><span class="ident" id="5973790">count</span><span class="op" id="5973795">)</span><span class="op" id="5973796">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973802">w</span><span class="op" id="5973803">.</span><span class="ident" id="5973804">dir</span>&nbsp;<span class="op" id="5973808">=</span>&nbsp;<span class="builtinfunc" id="5973810">append</span><span class="op" id="5973816">(</span><span class="ident" id="5973817">w</span><span class="op" id="5973818">.</span><span class="ident" id="5973819">dir</span><span class="op" id="5973822">,</span>&nbsp;<span class="ident" id="5973824">h</span><span class="op" id="5973825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973828">fw</span><span class="op" id="5973830">.</span><span class="ident" id="5973831">header</span>&nbsp;<span class="op" id="5973838">=</span>&nbsp;<span class="ident" id="5973840">h</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973844">if</span>&nbsp;<span class="ident" id="5973847">err</span>&nbsp;<span class="op" id="5973851">:=</span>&nbsp;<span class="ident" id="5973854">writeHeader</span><span class="op" id="5973865">(</span><span class="ident" id="5973866">w</span><span class="op" id="5973867">.</span><span class="ident" id="5973868">cw</span><span class="op" id="5973870">,</span>&nbsp;<span class="ident" id="5973872">fh</span><span class="op" id="5973874">)</span><span class="op" id="5973875">;</span>&nbsp;<span class="ident" id="5973877">err</span>&nbsp;<span class="op" id="5973881">!=</span>&nbsp;<span class="ident" id="5973884">nil</span>&nbsp;<span class="op" id="5973888">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973892">return</span>&nbsp;<span class="ident" id="5973899">nil</span><span class="op" id="5973902">,</span>&nbsp;<span class="ident" id="5973904">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973913">w</span><span class="op" id="5973914">.</span><span class="ident" id="5973915">last</span>&nbsp;<span class="op" id="5973920">=</span>&nbsp;<span class="ident" id="5973922">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973926">return</span>&nbsp;<span class="ident" id="5973933">fw</span><span class="op" id="5973935">,</span>&nbsp;<span class="ident" id="5973937">nil</span><br>
<span class="lineno">230</span><span class="op" id="5973941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5973944">func</span>&nbsp;<span class="ident" id="5973949">writeHeader</span><span class="op" id="5973960">(</span><span class="ident" id="5973961">w</span>&nbsp;<span class="ident" id="5973963">io</span><span class="op" id="5973965">.</span><span class="ident" id="5973966">Writer</span><span class="op" id="5973972">,</span>&nbsp;<span class="ident" id="5973974">h</span>&nbsp;<span class="op" id="5973976">*</span><span class="ident" id="5973977">FileHeader</span><span class="op" id="5973987">)</span>&nbsp;<span class="builtintype" id="5973989">error</span>&nbsp;<span class="op" id="5973995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973998">var</span>&nbsp;<span class="ident" id="5974002">buf</span>&nbsp;<span class="op" id="5974006">[</span><span class="ident" id="5974007">fileHeaderLen</span><span class="op" id="5974020">]</span><span class="builtintype" id="5974021">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974027">b</span>&nbsp;<span class="op" id="5974029">:=</span>&nbsp;<span class="ident" id="5974032">writeBuf</span><span class="op" id="5974040">(</span><span class="ident" id="5974041">buf</span><span class="op" id="5974044">[</span><span class="op" id="5974045">:</span><span class="op" id="5974046">]</span><span class="op" id="5974047">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974050">b</span><span class="op" id="5974051">.</span><span class="builtintype" id="5974052">uint32</span><span class="op" id="5974058">(</span><span class="builtintype" id="5974059">uint32</span><span class="op" id="5974065">(</span><span class="ident" id="5974066">fileHeaderSignature</span><span class="op" id="5974085">)</span><span class="op" id="5974086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974089">b</span><span class="op" id="5974090">.</span><span class="builtintype" id="5974091">uint16</span><span class="op" id="5974097">(</span><span class="ident" id="5974098">h</span><span class="op" id="5974099">.</span><span class="ident" id="5974100">ReaderVersion</span><span class="op" id="5974113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974116">b</span><span class="op" id="5974117">.</span><span class="builtintype" id="5974118">uint16</span><span class="op" id="5974124">(</span><span class="ident" id="5974125">h</span><span class="op" id="5974126">.</span><span class="ident" id="5974127">Flags</span><span class="op" id="5974132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974135">b</span><span class="op" id="5974136">.</span><span class="builtintype" id="5974137">uint16</span><span class="op" id="5974143">(</span><span class="ident" id="5974144">h</span><span class="op" id="5974145">.</span><span class="ident" id="5974146">Method</span><span class="op" id="5974152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974155">b</span><span class="op" id="5974156">.</span><span class="builtintype" id="5974157">uint16</span><span class="op" id="5974163">(</span><span class="ident" id="5974164">h</span><span class="op" id="5974165">.</span><span class="ident" id="5974166">ModifiedTime</span><span class="op" id="5974178">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974181">b</span><span class="op" id="5974182">.</span><span class="builtintype" id="5974183">uint16</span><span class="op" id="5974189">(</span><span class="ident" id="5974190">h</span><span class="op" id="5974191">.</span><span class="ident" id="5974192">ModifiedDate</span><span class="op" id="5974204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974207">b</span><span class="op" id="5974208">.</span><span class="builtintype" id="5974209">uint32</span><span class="op" id="5974215">(</span><span class="num" id="5974216">0</span><span class="op" id="5974217">)</span>&nbsp;<span class="comment" id="5974219">//&nbsp;since&nbsp;we&nbsp;are&nbsp;writing&nbsp;a&nbsp;data&nbsp;descriptor&nbsp;crc32,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974269">b</span><span class="op" id="5974270">.</span><span class="builtintype" id="5974271">uint32</span><span class="op" id="5974277">(</span><span class="num" id="5974278">0</span><span class="op" id="5974279">)</span>&nbsp;<span class="comment" id="5974281">//&nbsp;compressed&nbsp;size,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974302">b</span><span class="op" id="5974303">.</span><span class="builtintype" id="5974304">uint32</span><span class="op" id="5974310">(</span><span class="num" id="5974311">0</span><span class="op" id="5974312">)</span>&nbsp;<span class="comment" id="5974314">//&nbsp;and&nbsp;uncompressed&nbsp;size&nbsp;should&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974355">b</span><span class="op" id="5974356">.</span><span class="builtintype" id="5974357">uint16</span><span class="op" id="5974363">(</span><span class="builtintype" id="5974364">uint16</span><span class="op" id="5974370">(</span><span class="builtinfunc" id="5974371">len</span><span class="op" id="5974374">(</span><span class="ident" id="5974375">h</span><span class="op" id="5974376">.</span><span class="ident" id="5974377">Name</span><span class="op" id="5974381">)</span><span class="op" id="5974382">)</span><span class="op" id="5974383">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974386">b</span><span class="op" id="5974387">.</span><span class="builtintype" id="5974388">uint16</span><span class="op" id="5974394">(</span><span class="builtintype" id="5974395">uint16</span><span class="op" id="5974401">(</span><span class="builtinfunc" id="5974402">len</span><span class="op" id="5974405">(</span><span class="ident" id="5974406">h</span><span class="op" id="5974407">.</span><span class="ident" id="5974408">Extra</span><span class="op" id="5974413">)</span><span class="op" id="5974414">)</span><span class="op" id="5974415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974418">if</span>&nbsp;<span class="ident" id="5974421">_</span><span class="op" id="5974422">,</span>&nbsp;<span class="ident" id="5974424">err</span>&nbsp;<span class="op" id="5974428">:=</span>&nbsp;<span class="ident" id="5974431">w</span><span class="op" id="5974432">.</span><span class="ident" id="5974433">Write</span><span class="op" id="5974438">(</span><span class="ident" id="5974439">buf</span><span class="op" id="5974442">[</span><span class="op" id="5974443">:</span><span class="op" id="5974444">]</span><span class="op" id="5974445">)</span><span class="op" id="5974446">;</span>&nbsp;<span class="ident" id="5974448">err</span>&nbsp;<span class="op" id="5974452">!=</span>&nbsp;<span class="ident" id="5974455">nil</span>&nbsp;<span class="op" id="5974459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974463">return</span>&nbsp;<span class="ident" id="5974470">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974478">if</span>&nbsp;<span class="ident" id="5974481">_</span><span class="op" id="5974482">,</span>&nbsp;<span class="ident" id="5974484">err</span>&nbsp;<span class="op" id="5974488">:=</span>&nbsp;<span class="ident" id="5974491">io</span><span class="op" id="5974493">.</span><span class="ident" id="5974494">WriteString</span><span class="op" id="5974505">(</span><span class="ident" id="5974506">w</span><span class="op" id="5974507">,</span>&nbsp;<span class="ident" id="5974509">h</span><span class="op" id="5974510">.</span><span class="ident" id="5974511">Name</span><span class="op" id="5974515">)</span><span class="op" id="5974516">;</span>&nbsp;<span class="ident" id="5974518">err</span>&nbsp;<span class="op" id="5974522">!=</span>&nbsp;<span class="ident" id="5974525">nil</span>&nbsp;<span class="op" id="5974529">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974533">return</span>&nbsp;<span class="ident" id="5974540">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974548">_</span><span class="op" id="5974549">,</span>&nbsp;<span class="ident" id="5974551">err</span>&nbsp;<span class="op" id="5974555">:=</span>&nbsp;<span class="ident" id="5974558">w</span><span class="op" id="5974559">.</span><span class="ident" id="5974560">Write</span><span class="op" id="5974565">(</span><span class="ident" id="5974566">h</span><span class="op" id="5974567">.</span><span class="ident" id="5974568">Extra</span><span class="op" id="5974573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974576">return</span>&nbsp;<span class="ident" id="5974583">err</span><br>
<span class="lineno"></span><span class="op" id="5974587">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="5974590">type</span>&nbsp;<span class="ident" id="5974595">fileWriter</span>&nbsp;<span class="keyword" id="5974606">struct</span>&nbsp;<span class="op" id="5974613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974616">*</span><span class="ident" id="5974617">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974625">zipw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5974635">io</span><span class="op" id="5974637">.</span><span class="ident" id="5974638">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974646">rawCount</span>&nbsp;&nbsp;<span class="op" id="5974656">*</span><span class="ident" id="5974657">countWriter</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974670">comp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5974680">io</span><span class="op" id="5974682">.</span><span class="ident" id="5974683">WriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974696">compCount</span>&nbsp;<span class="op" id="5974706">*</span><span class="ident" id="5974707">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974720">crc32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5974730">hash</span><span class="op" id="5974734">.</span><span class="ident" id="5974735">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974743">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5974753">bool</span><br>
<span class="lineno"></span><span class="op" id="5974758">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="5974761">func</span>&nbsp;<span class="op" id="5974766">(</span><span class="ident" id="5974767">w</span>&nbsp;<span class="op" id="5974769">*</span><span class="ident" id="5974770">fileWriter</span><span class="op" id="5974780">)</span>&nbsp;<span class="ident" id="5974782">Write</span><span class="op" id="5974787">(</span><span class="ident" id="5974788">p</span>&nbsp;<span class="op" id="5974790">[</span><span class="op" id="5974791">]</span><span class="builtintype" id="5974792">byte</span><span class="op" id="5974796">)</span>&nbsp;<span class="op" id="5974798">(</span><span class="builtintype" id="5974799">int</span><span class="op" id="5974802">,</span>&nbsp;<span class="builtintype" id="5974804">error</span><span class="op" id="5974809">)</span>&nbsp;<span class="op" id="5974811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974814">if</span>&nbsp;<span class="ident" id="5974817">w</span><span class="op" id="5974818">.</span><span class="ident" id="5974819">closed</span>&nbsp;<span class="op" id="5974826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974830">return</span>&nbsp;<span class="num" id="5974837">0</span><span class="op" id="5974838">,</span>&nbsp;<span class="ident" id="5974840">errors</span><span class="op" id="5974846">.</span><span class="ident" id="5974847">New</span><span class="op" id="5974850">(</span><span class="string" id="5974851">&#34;zip:&nbsp;write&nbsp;to&nbsp;closed&nbsp;file&#34;</span><span class="op" id="5974878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974881">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974884">w</span><span class="op" id="5974885">.</span><span class="ident" id="5974886">crc32</span><span class="op" id="5974891">.</span><span class="ident" id="5974892">Write</span><span class="op" id="5974897">(</span><span class="ident" id="5974898">p</span><span class="op" id="5974899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974902">return</span>&nbsp;<span class="ident" id="5974909">w</span><span class="op" id="5974910">.</span><span class="ident" id="5974911">rawCount</span><span class="op" id="5974919">.</span><span class="ident" id="5974920">Write</span><span class="op" id="5974925">(</span><span class="ident" id="5974926">p</span><span class="op" id="5974927">)</span><br>
<span class="lineno"></span><span class="op" id="5974929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5974932">func</span>&nbsp;<span class="op" id="5974937">(</span><span class="ident" id="5974938">w</span>&nbsp;<span class="op" id="5974940">*</span><span class="ident" id="5974941">fileWriter</span><span class="op" id="5974951">)</span>&nbsp;<span class="builtinfunc" id="5974953">close</span><span class="op" id="5974958">(</span><span class="op" id="5974959">)</span>&nbsp;<span class="builtintype" id="5974961">error</span>&nbsp;<span class="op" id="5974967">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974970">if</span>&nbsp;<span class="ident" id="5974973">w</span><span class="op" id="5974974">.</span><span class="ident" id="5974975">closed</span>&nbsp;<span class="op" id="5974982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974986">return</span>&nbsp;<span class="ident" id="5974993">errors</span><span class="op" id="5974999">.</span><span class="ident" id="5975000">New</span><span class="op" id="5975003">(</span><span class="string" id="5975004">&#34;zip:&nbsp;file&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="5975028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975034">w</span><span class="op" id="5975035">.</span><span class="ident" id="5975036">closed</span>&nbsp;<span class="op" id="5975043">=</span>&nbsp;<span class="builtintype" id="5975045">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975051">if</span>&nbsp;<span class="ident" id="5975054">err</span>&nbsp;<span class="op" id="5975058">:=</span>&nbsp;<span class="ident" id="5975061">w</span><span class="op" id="5975062">.</span><span class="ident" id="5975063">comp</span><span class="op" id="5975067">.</span><span class="ident" id="5975068">Close</span><span class="op" id="5975073">(</span><span class="op" id="5975074">)</span><span class="op" id="5975075">;</span>&nbsp;<span class="ident" id="5975077">err</span>&nbsp;<span class="op" id="5975081">!=</span>&nbsp;<span class="ident" id="5975084">nil</span>&nbsp;<span class="op" id="5975088">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975092">return</span>&nbsp;<span class="ident" id="5975099">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5975108">//&nbsp;update&nbsp;FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975130">fh</span>&nbsp;<span class="op" id="5975133">:=</span>&nbsp;<span class="ident" id="5975136">w</span><span class="op" id="5975137">.</span><span class="ident" id="5975138">header</span><span class="op" id="5975144">.</span><span class="ident" id="5975145">FileHeader</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975157">fh</span><span class="op" id="5975159">.</span><span class="ident" id="5975160">CRC32</span>&nbsp;<span class="op" id="5975166">=</span>&nbsp;<span class="ident" id="5975168">w</span><span class="op" id="5975169">.</span><span class="ident" id="5975170">crc32</span><span class="op" id="5975175">.</span><span class="ident" id="5975176">Sum32</span><span class="op" id="5975181">(</span><span class="op" id="5975182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975185">fh</span><span class="op" id="5975187">.</span><span class="ident" id="5975188">CompressedSize64</span>&nbsp;<span class="op" id="5975205">=</span>&nbsp;<span class="ident" id="5975207">uint64</span><span class="op" id="5975213">(</span><span class="ident" id="5975214">w</span><span class="op" id="5975215">.</span><span class="ident" id="5975216">compCount</span><span class="op" id="5975225">.</span><span class="ident" id="5975226">count</span><span class="op" id="5975231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975234">fh</span><span class="op" id="5975236">.</span><span class="ident" id="5975237">UncompressedSize64</span>&nbsp;<span class="op" id="5975256">=</span>&nbsp;<span class="ident" id="5975258">uint64</span><span class="op" id="5975264">(</span><span class="ident" id="5975265">w</span><span class="op" id="5975266">.</span><span class="ident" id="5975267">rawCount</span><span class="op" id="5975275">.</span><span class="ident" id="5975276">count</span><span class="op" id="5975281">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975285">if</span>&nbsp;<span class="ident" id="5975288">fh</span><span class="op" id="5975290">.</span><span class="ident" id="5975291">isZip64</span><span class="op" id="5975298">(</span><span class="op" id="5975299">)</span>&nbsp;<span class="op" id="5975301">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975305">fh</span><span class="op" id="5975307">.</span><span class="ident" id="5975308">CompressedSize</span>&nbsp;<span class="op" id="5975323">=</span>&nbsp;<span class="ident" id="5975325">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975337">fh</span><span class="op" id="5975339">.</span><span class="ident" id="5975340">UncompressedSize</span>&nbsp;<span class="op" id="5975357">=</span>&nbsp;<span class="ident" id="5975359">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975371">fh</span><span class="op" id="5975373">.</span><span class="ident" id="5975374">ReaderVersion</span>&nbsp;<span class="op" id="5975388">=</span>&nbsp;<span class="ident" id="5975390">zipVersion45</span>&nbsp;<span class="comment" id="5975403">//&nbsp;requires&nbsp;4.5&nbsp;-&nbsp;File&nbsp;uses&nbsp;ZIP64&nbsp;format&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975456">}</span>&nbsp;<span class="keyword" id="5975458">else</span>&nbsp;<span class="op" id="5975463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975467">fh</span><span class="op" id="5975469">.</span><span class="ident" id="5975470">CompressedSize</span>&nbsp;<span class="op" id="5975485">=</span>&nbsp;<span class="builtintype" id="5975487">uint32</span><span class="op" id="5975493">(</span><span class="ident" id="5975494">fh</span><span class="op" id="5975496">.</span><span class="ident" id="5975497">CompressedSize64</span><span class="op" id="5975513">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975517">fh</span><span class="op" id="5975519">.</span><span class="ident" id="5975520">UncompressedSize</span>&nbsp;<span class="op" id="5975537">=</span>&nbsp;<span class="builtintype" id="5975539">uint32</span><span class="op" id="5975545">(</span><span class="ident" id="5975546">fh</span><span class="op" id="5975548">.</span><span class="ident" id="5975549">UncompressedSize64</span><span class="op" id="5975567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5975574">//&nbsp;Write&nbsp;data&nbsp;descriptor.&nbsp;This&nbsp;is&nbsp;more&nbsp;complicated&nbsp;than&nbsp;one&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5975641">//&nbsp;think,&nbsp;see&nbsp;e.g.&nbsp;comments&nbsp;in&nbsp;zipfile.c:putextended()&nbsp;and</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5975701">//&nbsp;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7073588.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5975765">//&nbsp;The&nbsp;approach&nbsp;here&nbsp;is&nbsp;to&nbsp;write&nbsp;8&nbsp;byte&nbsp;sizes&nbsp;if&nbsp;needed&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5975830">//&nbsp;adding&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;in&nbsp;the&nbsp;local&nbsp;header&nbsp;(too&nbsp;late&nbsp;anyway).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975894">var</span>&nbsp;<span class="ident" id="5975898">buf</span>&nbsp;<span class="op" id="5975902">[</span><span class="op" id="5975903">]</span><span class="builtintype" id="5975904">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975910">if</span>&nbsp;<span class="ident" id="5975913">fh</span><span class="op" id="5975915">.</span><span class="ident" id="5975916">isZip64</span><span class="op" id="5975923">(</span><span class="op" id="5975924">)</span>&nbsp;<span class="op" id="5975926">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975930">buf</span>&nbsp;<span class="op" id="5975934">=</span>&nbsp;<span class="builtinfunc" id="5975936">make</span><span class="op" id="5975940">(</span><span class="op" id="5975941">[</span><span class="op" id="5975942">]</span><span class="builtintype" id="5975943">byte</span><span class="op" id="5975947">,</span>&nbsp;<span class="ident" id="5975949">dataDescriptor64Len</span><span class="op" id="5975968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975971">}</span>&nbsp;<span class="keyword" id="5975973">else</span>&nbsp;<span class="op" id="5975978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975982">buf</span>&nbsp;<span class="op" id="5975986">=</span>&nbsp;<span class="builtinfunc" id="5975988">make</span><span class="op" id="5975992">(</span><span class="op" id="5975993">[</span><span class="op" id="5975994">]</span><span class="builtintype" id="5975995">byte</span><span class="op" id="5975999">,</span>&nbsp;<span class="ident" id="5976001">dataDescriptorLen</span><span class="op" id="5976018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976024">b</span>&nbsp;<span class="op" id="5976026">:=</span>&nbsp;<span class="ident" id="5976029">writeBuf</span><span class="op" id="5976037">(</span><span class="ident" id="5976038">buf</span><span class="op" id="5976041">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976044">b</span><span class="op" id="5976045">.</span><span class="builtintype" id="5976046">uint32</span><span class="op" id="5976052">(</span><span class="ident" id="5976053">dataDescriptorSignature</span><span class="op" id="5976076">)</span>&nbsp;<span class="comment" id="5976078">//&nbsp;de-facto&nbsp;standard,&nbsp;required&nbsp;by&nbsp;OS&nbsp;X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976118">b</span><span class="op" id="5976119">.</span><span class="builtintype" id="5976120">uint32</span><span class="op" id="5976126">(</span><span class="ident" id="5976127">fh</span><span class="op" id="5976129">.</span><span class="ident" id="5976130">CRC32</span><span class="op" id="5976135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976138">if</span>&nbsp;<span class="ident" id="5976141">fh</span><span class="op" id="5976143">.</span><span class="ident" id="5976144">isZip64</span><span class="op" id="5976151">(</span><span class="op" id="5976152">)</span>&nbsp;<span class="op" id="5976154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976158">b</span><span class="op" id="5976159">.</span><span class="ident" id="5976160">uint64</span><span class="op" id="5976166">(</span><span class="ident" id="5976167">fh</span><span class="op" id="5976169">.</span><span class="ident" id="5976170">CompressedSize64</span><span class="op" id="5976186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976190">b</span><span class="op" id="5976191">.</span><span class="ident" id="5976192">uint64</span><span class="op" id="5976198">(</span><span class="ident" id="5976199">fh</span><span class="op" id="5976201">.</span><span class="ident" id="5976202">UncompressedSize64</span><span class="op" id="5976220">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976223">}</span>&nbsp;<span class="keyword" id="5976225">else</span>&nbsp;<span class="op" id="5976230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976234">b</span><span class="op" id="5976235">.</span><span class="builtintype" id="5976236">uint32</span><span class="op" id="5976242">(</span><span class="ident" id="5976243">fh</span><span class="op" id="5976245">.</span><span class="ident" id="5976246">CompressedSize</span><span class="op" id="5976260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976264">b</span><span class="op" id="5976265">.</span><span class="builtintype" id="5976266">uint32</span><span class="op" id="5976272">(</span><span class="ident" id="5976273">fh</span><span class="op" id="5976275">.</span><span class="ident" id="5976276">UncompressedSize</span><span class="op" id="5976292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976298">_</span><span class="op" id="5976299">,</span>&nbsp;<span class="ident" id="5976301">err</span>&nbsp;<span class="op" id="5976305">:=</span>&nbsp;<span class="ident" id="5976308">w</span><span class="op" id="5976309">.</span><span class="ident" id="5976310">zipw</span><span class="op" id="5976314">.</span><span class="ident" id="5976315">Write</span><span class="op" id="5976320">(</span><span class="ident" id="5976321">buf</span><span class="op" id="5976324">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976327">return</span>&nbsp;<span class="ident" id="5976334">err</span><br>
<span class="lineno"></span><span class="op" id="5976338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5976341">type</span>&nbsp;<span class="ident" id="5976346">countWriter</span>&nbsp;<span class="keyword" id="5976358">struct</span>&nbsp;<span class="op" id="5976365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976368">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5976374">io</span><span class="op" id="5976376">.</span><span class="ident" id="5976377">Writer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976385">count</span>&nbsp;<span class="ident" id="5976391">int64</span><br>
<span class="lineno"></span><span class="op" id="5976397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5976400">func</span>&nbsp;<span class="op" id="5976405">(</span><span class="ident" id="5976406">w</span>&nbsp;<span class="op" id="5976408">*</span><span class="ident" id="5976409">countWriter</span><span class="op" id="5976420">)</span>&nbsp;<span class="ident" id="5976422">Write</span><span class="op" id="5976427">(</span><span class="ident" id="5976428">p</span>&nbsp;<span class="op" id="5976430">[</span><span class="op" id="5976431">]</span><span class="builtintype" id="5976432">byte</span><span class="op" id="5976436">)</span>&nbsp;<span class="op" id="5976438">(</span><span class="builtintype" id="5976439">int</span><span class="op" id="5976442">,</span>&nbsp;<span class="builtintype" id="5976444">error</span><span class="op" id="5976449">)</span>&nbsp;<span class="op" id="5976451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976454">n</span><span class="op" id="5976455">,</span>&nbsp;<span class="ident" id="5976457">err</span>&nbsp;<span class="op" id="5976461">:=</span>&nbsp;<span class="ident" id="5976464">w</span><span class="op" id="5976465">.</span><span class="ident" id="5976466">w</span><span class="op" id="5976467">.</span><span class="ident" id="5976468">Write</span><span class="op" id="5976473">(</span><span class="ident" id="5976474">p</span><span class="op" id="5976475">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976478">w</span><span class="op" id="5976479">.</span><span class="ident" id="5976480">count</span>&nbsp;<span class="op" id="5976486">+=</span>&nbsp;<span class="ident" id="5976489">int64</span><span class="op" id="5976494">(</span><span class="ident" id="5976495">n</span><span class="op" id="5976496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976499">return</span>&nbsp;<span class="ident" id="5976506">n</span><span class="op" id="5976507">,</span>&nbsp;<span class="ident" id="5976509">err</span><br>
<span class="lineno"></span><span class="op" id="5976513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5976516">type</span>&nbsp;<span class="ident" id="5976521">nopCloser</span>&nbsp;<span class="keyword" id="5976531">struct</span>&nbsp;<span class="op" id="5976538">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976541">io</span><span class="op" id="5976543">.</span><span class="ident" id="5976544">Writer</span><br>
<span class="lineno"></span><span class="op" id="5976551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5976554">func</span>&nbsp;<span class="op" id="5976559">(</span><span class="ident" id="5976560">w</span>&nbsp;<span class="ident" id="5976562">nopCloser</span><span class="op" id="5976571">)</span>&nbsp;<span class="ident" id="5976573">Close</span><span class="op" id="5976578">(</span><span class="op" id="5976579">)</span>&nbsp;<span class="builtintype" id="5976581">error</span>&nbsp;<span class="op" id="5976587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976590">return</span>&nbsp;<span class="ident" id="5976597">nil</span><br>
<span class="lineno">340</span><span class="op" id="5976601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5976604">type</span>&nbsp;<span class="ident" id="5976609">writeBuf</span>&nbsp;<span class="op" id="5976618">[</span><span class="op" id="5976619">]</span><span class="builtintype" id="5976620">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5976626">func</span>&nbsp;<span class="op" id="5976631">(</span><span class="ident" id="5976632">b</span>&nbsp;<span class="op" id="5976634">*</span><span class="ident" id="5976635">writeBuf</span><span class="op" id="5976643">)</span>&nbsp;<span class="builtintype" id="5976645">uint16</span><span class="op" id="5976651">(</span><span class="ident" id="5976652">v</span>&nbsp;<span class="builtintype" id="5976654">uint16</span><span class="op" id="5976660">)</span>&nbsp;<span class="op" id="5976662">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976665">binary</span><span class="op" id="5976671">.</span><span class="ident" id="5976672">LittleEndian</span><span class="op" id="5976684">.</span><span class="ident" id="5976685">PutUint16</span><span class="op" id="5976694">(</span><span class="op" id="5976695">*</span><span class="ident" id="5976696">b</span><span class="op" id="5976697">,</span>&nbsp;<span class="ident" id="5976699">v</span><span class="op" id="5976700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976703">*</span><span class="ident" id="5976704">b</span>&nbsp;<span class="op" id="5976706">=</span>&nbsp;<span class="op" id="5976708">(</span><span class="op" id="5976709">*</span><span class="ident" id="5976710">b</span><span class="op" id="5976711">)</span><span class="op" id="5976712">[</span><span class="num" id="5976713">2</span><span class="op" id="5976714">:</span><span class="op" id="5976715">]</span><br>
<span class="lineno"></span><span class="op" id="5976717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5976720">func</span>&nbsp;<span class="op" id="5976725">(</span><span class="ident" id="5976726">b</span>&nbsp;<span class="op" id="5976728">*</span><span class="ident" id="5976729">writeBuf</span><span class="op" id="5976737">)</span>&nbsp;<span class="builtintype" id="5976739">uint32</span><span class="op" id="5976745">(</span><span class="ident" id="5976746">v</span>&nbsp;<span class="builtintype" id="5976748">uint32</span><span class="op" id="5976754">)</span>&nbsp;<span class="op" id="5976756">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976759">binary</span><span class="op" id="5976765">.</span><span class="ident" id="5976766">LittleEndian</span><span class="op" id="5976778">.</span><span class="ident" id="5976779">PutUint32</span><span class="op" id="5976788">(</span><span class="op" id="5976789">*</span><span class="ident" id="5976790">b</span><span class="op" id="5976791">,</span>&nbsp;<span class="ident" id="5976793">v</span><span class="op" id="5976794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976797">*</span><span class="ident" id="5976798">b</span>&nbsp;<span class="op" id="5976800">=</span>&nbsp;<span class="op" id="5976802">(</span><span class="op" id="5976803">*</span><span class="ident" id="5976804">b</span><span class="op" id="5976805">)</span><span class="op" id="5976806">[</span><span class="num" id="5976807">4</span><span class="op" id="5976808">:</span><span class="op" id="5976809">]</span><br>
<span class="lineno"></span><span class="op" id="5976811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5976814">func</span>&nbsp;<span class="op" id="5976819">(</span><span class="ident" id="5976820">b</span>&nbsp;<span class="op" id="5976822">*</span><span class="ident" id="5976823">writeBuf</span><span class="op" id="5976831">)</span>&nbsp;<span class="ident" id="5976833">uint64</span><span class="op" id="5976839">(</span><span class="ident" id="5976840">v</span>&nbsp;<span class="ident" id="5976842">uint64</span><span class="op" id="5976848">)</span>&nbsp;<span class="op" id="5976850">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976853">binary</span><span class="op" id="5976859">.</span><span class="ident" id="5976860">LittleEndian</span><span class="op" id="5976872">.</span><span class="ident" id="5976873">PutUint64</span><span class="op" id="5976882">(</span><span class="op" id="5976883">*</span><span class="ident" id="5976884">b</span><span class="op" id="5976885">,</span>&nbsp;<span class="ident" id="5976887">v</span><span class="op" id="5976888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976891">*</span><span class="ident" id="5976892">b</span>&nbsp;<span class="op" id="5976894">=</span>&nbsp;<span class="op" id="5976896">(</span><span class="op" id="5976897">*</span><span class="ident" id="5976898">b</span><span class="op" id="5976899">)</span><span class="op" id="5976900">[</span><span class="num" id="5976901">8</span><span class="op" id="5976902">:</span><span class="op" id="5976903">]</span><br>
<span class="lineno"></span><span class="op" id="5976905">}</span>
</div>
</body>
</html>
