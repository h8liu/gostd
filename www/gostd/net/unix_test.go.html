<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8383666">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8383722">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8383776">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8383827">//&nbsp;+build&nbsp;!nacl,!plan9,!windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8383860">package</span>&nbsp;<span class="ident" id="8383868">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8383873">import</span>&nbsp;<span class="op" id="8383880">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8383883">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8383892">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8383898">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8383909">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8383920">&#34;syscall&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8383931">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8383942">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8383949">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8383952">func</span>&nbsp;<span class="ident" id="8383957">TestReadUnixgramWithUnnamedSocket</span><span class="op" id="8383990">(</span><span class="ident" id="8383991">t</span>&nbsp;<span class="op" id="8383993">*</span><span class="ident" id="8383994">testing</span><span class="op" id="8384001">.</span><span class="ident" id="8384002">T</span><span class="op" id="8384003">)</span>&nbsp;<span class="op" id="8384005">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384008">addr</span>&nbsp;<span class="op" id="8384013">:=</span>&nbsp;<span class="ident" id="8384016">testUnixAddr</span><span class="op" id="8384028">(</span><span class="op" id="8384029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384032">la</span><span class="op" id="8384034">,</span>&nbsp;<span class="ident" id="8384036">err</span>&nbsp;<span class="op" id="8384040">:=</span>&nbsp;<span class="ident" id="8384043">ResolveUnixAddr</span><span class="op" id="8384058">(</span><span class="string" id="8384059">&#34;unixgram&#34;</span><span class="op" id="8384069">,</span>&nbsp;<span class="ident" id="8384071">addr</span><span class="op" id="8384075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384078">if</span>&nbsp;<span class="ident" id="8384081">err</span>&nbsp;<span class="op" id="8384085">!=</span>&nbsp;<span class="ident" id="8384088">nil</span>&nbsp;<span class="op" id="8384092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384096">t</span><span class="op" id="8384097">.</span><span class="ident" id="8384098">Fatalf</span><span class="op" id="8384104">(</span><span class="string" id="8384105">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8384133">,</span>&nbsp;<span class="ident" id="8384135">err</span><span class="op" id="8384138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384141">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384144">c</span><span class="op" id="8384145">,</span>&nbsp;<span class="ident" id="8384147">err</span>&nbsp;<span class="op" id="8384151">:=</span>&nbsp;<span class="ident" id="8384154">ListenUnixgram</span><span class="op" id="8384168">(</span><span class="string" id="8384169">&#34;unixgram&#34;</span><span class="op" id="8384179">,</span>&nbsp;<span class="ident" id="8384181">la</span><span class="op" id="8384183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384186">if</span>&nbsp;<span class="ident" id="8384189">err</span>&nbsp;<span class="op" id="8384193">!=</span>&nbsp;<span class="ident" id="8384196">nil</span>&nbsp;<span class="op" id="8384200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384204">t</span><span class="op" id="8384205">.</span><span class="ident" id="8384206">Fatalf</span><span class="op" id="8384212">(</span><span class="string" id="8384213">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8384240">,</span>&nbsp;<span class="ident" id="8384242">err</span><span class="op" id="8384245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384251">defer</span>&nbsp;<span class="keyword" id="8384257">func</span><span class="op" id="8384261">(</span><span class="op" id="8384262">)</span>&nbsp;<span class="op" id="8384264">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384268">c</span><span class="op" id="8384269">.</span><span class="ident" id="8384270">Close</span><span class="op" id="8384275">(</span><span class="op" id="8384276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384280">os</span><span class="op" id="8384282">.</span><span class="ident" id="8384283">Remove</span><span class="op" id="8384289">(</span><span class="ident" id="8384290">addr</span><span class="op" id="8384294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384297">}</span><span class="op" id="8384298">(</span><span class="op" id="8384299">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384303">off</span>&nbsp;<span class="op" id="8384307">:=</span>&nbsp;<span class="builtinfunc" id="8384310">make</span><span class="op" id="8384314">(</span><span class="keyword" id="8384315">chan</span>&nbsp;<span class="builtintype" id="8384320">bool</span><span class="op" id="8384324">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384327">data</span>&nbsp;<span class="op" id="8384332">:=</span>&nbsp;<span class="op" id="8384335">[</span><span class="num" id="8384336">5</span><span class="op" id="8384337">]</span><span class="builtintype" id="8384338">byte</span><span class="op" id="8384342">{</span><span class="num" id="8384343">1</span><span class="op" id="8384344">,</span>&nbsp;<span class="num" id="8384346">2</span><span class="op" id="8384347">,</span>&nbsp;<span class="num" id="8384349">3</span><span class="op" id="8384350">,</span>&nbsp;<span class="num" id="8384352">4</span><span class="op" id="8384353">,</span>&nbsp;<span class="num" id="8384355">5</span><span class="op" id="8384356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384359">go</span>&nbsp;<span class="keyword" id="8384362">func</span><span class="op" id="8384366">(</span><span class="op" id="8384367">)</span>&nbsp;<span class="op" id="8384369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384373">defer</span>&nbsp;<span class="keyword" id="8384379">func</span><span class="op" id="8384383">(</span><span class="op" id="8384384">)</span>&nbsp;<span class="op" id="8384386">{</span>&nbsp;<span class="ident" id="8384388">off</span>&nbsp;<span class="op" id="8384392">&lt;-</span>&nbsp;<span class="builtintype" id="8384395">true</span>&nbsp;<span class="op" id="8384400">}</span><span class="op" id="8384401">(</span><span class="op" id="8384402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384406">s</span><span class="op" id="8384407">,</span>&nbsp;<span class="ident" id="8384409">err</span>&nbsp;<span class="op" id="8384413">:=</span>&nbsp;<span class="ident" id="8384416">syscall</span><span class="op" id="8384423">.</span><span class="ident" id="8384424">Socket</span><span class="op" id="8384430">(</span><span class="ident" id="8384431">syscall</span><span class="op" id="8384438">.</span><span class="ident" id="8384439">AF_UNIX</span><span class="op" id="8384446">,</span>&nbsp;<span class="ident" id="8384448">syscall</span><span class="op" id="8384455">.</span><span class="ident" id="8384456">SOCK_DGRAM</span><span class="op" id="8384466">,</span>&nbsp;<span class="num" id="8384468">0</span><span class="op" id="8384469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384473">if</span>&nbsp;<span class="ident" id="8384476">err</span>&nbsp;<span class="op" id="8384480">!=</span>&nbsp;<span class="ident" id="8384483">nil</span>&nbsp;<span class="op" id="8384487">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384492">t</span><span class="op" id="8384493">.</span><span class="ident" id="8384494">Errorf</span><span class="op" id="8384500">(</span><span class="string" id="8384501">&#34;syscall.Socket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8384528">,</span>&nbsp;<span class="ident" id="8384530">err</span><span class="op" id="8384533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384538">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384551">defer</span>&nbsp;<span class="ident" id="8384557">syscall</span><span class="op" id="8384564">.</span><span class="ident" id="8384565">Close</span><span class="op" id="8384570">(</span><span class="ident" id="8384571">s</span><span class="op" id="8384572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384576">rsa</span>&nbsp;<span class="op" id="8384580">:=</span>&nbsp;<span class="op" id="8384583">&amp;</span><span class="ident" id="8384584">syscall</span><span class="op" id="8384591">.</span><span class="ident" id="8384592">SockaddrUnix</span><span class="op" id="8384604">{</span><span class="ident" id="8384605">Name</span><span class="op" id="8384609">:</span>&nbsp;<span class="ident" id="8384611">addr</span><span class="op" id="8384615">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384619">if</span>&nbsp;<span class="ident" id="8384622">err</span>&nbsp;<span class="op" id="8384626">:=</span>&nbsp;<span class="ident" id="8384629">syscall</span><span class="op" id="8384636">.</span><span class="ident" id="8384637">Sendto</span><span class="op" id="8384643">(</span><span class="ident" id="8384644">s</span><span class="op" id="8384645">,</span>&nbsp;<span class="ident" id="8384647">data</span><span class="op" id="8384651">[</span><span class="op" id="8384652">:</span><span class="op" id="8384653">]</span><span class="op" id="8384654">,</span>&nbsp;<span class="num" id="8384656">0</span><span class="op" id="8384657">,</span>&nbsp;<span class="ident" id="8384659">rsa</span><span class="op" id="8384662">)</span><span class="op" id="8384663">;</span>&nbsp;<span class="ident" id="8384665">err</span>&nbsp;<span class="op" id="8384669">!=</span>&nbsp;<span class="ident" id="8384672">nil</span>&nbsp;<span class="op" id="8384676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384681">t</span><span class="op" id="8384682">.</span><span class="ident" id="8384683">Errorf</span><span class="op" id="8384689">(</span><span class="string" id="8384690">&#34;syscall.Sendto&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8384717">,</span>&nbsp;<span class="ident" id="8384719">err</span><span class="op" id="8384722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384727">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384739">}</span><span class="op" id="8384740">(</span><span class="op" id="8384741">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384745">&lt;-</span><span class="ident" id="8384747">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384752">b</span>&nbsp;<span class="op" id="8384754">:=</span>&nbsp;<span class="builtinfunc" id="8384757">make</span><span class="op" id="8384761">(</span><span class="op" id="8384762">[</span><span class="op" id="8384763">]</span><span class="builtintype" id="8384764">byte</span><span class="op" id="8384768">,</span>&nbsp;<span class="num" id="8384770">64</span><span class="op" id="8384772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384775">c</span><span class="op" id="8384776">.</span><span class="ident" id="8384777">SetReadDeadline</span><span class="op" id="8384792">(</span><span class="ident" id="8384793">time</span><span class="op" id="8384797">.</span><span class="ident" id="8384798">Now</span><span class="op" id="8384801">(</span><span class="op" id="8384802">)</span><span class="op" id="8384803">.</span><span class="ident" id="8384804">Add</span><span class="op" id="8384807">(</span><span class="num" id="8384808">100</span>&nbsp;<span class="op" id="8384812">*</span>&nbsp;<span class="ident" id="8384814">time</span><span class="op" id="8384818">.</span><span class="ident" id="8384819">Millisecond</span><span class="op" id="8384830">)</span><span class="op" id="8384831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384834">n</span><span class="op" id="8384835">,</span>&nbsp;<span class="ident" id="8384837">from</span><span class="op" id="8384841">,</span>&nbsp;<span class="ident" id="8384843">err</span>&nbsp;<span class="op" id="8384847">:=</span>&nbsp;<span class="ident" id="8384850">c</span><span class="op" id="8384851">.</span><span class="ident" id="8384852">ReadFrom</span><span class="op" id="8384860">(</span><span class="ident" id="8384861">b</span><span class="op" id="8384862">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384865">if</span>&nbsp;<span class="ident" id="8384868">err</span>&nbsp;<span class="op" id="8384872">!=</span>&nbsp;<span class="ident" id="8384875">nil</span>&nbsp;<span class="op" id="8384879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384883">t</span><span class="op" id="8384884">.</span><span class="ident" id="8384885">Fatalf</span><span class="op" id="8384891">(</span><span class="string" id="8384892">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8384922">,</span>&nbsp;<span class="ident" id="8384924">err</span><span class="op" id="8384927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384933">if</span>&nbsp;<span class="ident" id="8384936">from</span>&nbsp;<span class="op" id="8384941">!=</span>&nbsp;<span class="ident" id="8384944">nil</span>&nbsp;<span class="op" id="8384948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8384952">t</span><span class="op" id="8384953">.</span><span class="ident" id="8384954">Fatalf</span><span class="op" id="8384960">(</span><span class="string" id="8384961">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="8384985">,</span>&nbsp;<span class="ident" id="8384987">from</span><span class="op" id="8384991">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8384994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8384997">if</span>&nbsp;<span class="op" id="8385000">!</span><span class="ident" id="8385001">bytes</span><span class="op" id="8385006">.</span><span class="ident" id="8385007">Equal</span><span class="op" id="8385012">(</span><span class="ident" id="8385013">b</span><span class="op" id="8385014">[</span><span class="op" id="8385015">:</span><span class="ident" id="8385016">n</span><span class="op" id="8385017">]</span><span class="op" id="8385018">,</span>&nbsp;<span class="ident" id="8385020">data</span><span class="op" id="8385024">[</span><span class="op" id="8385025">:</span><span class="op" id="8385026">]</span><span class="op" id="8385027">)</span>&nbsp;<span class="op" id="8385029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385033">t</span><span class="op" id="8385034">.</span><span class="ident" id="8385035">Fatalf</span><span class="op" id="8385041">(</span><span class="string" id="8385042">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8385059">,</span>&nbsp;<span class="ident" id="8385061">b</span><span class="op" id="8385062">[</span><span class="op" id="8385063">:</span><span class="ident" id="8385064">n</span><span class="op" id="8385065">]</span><span class="op" id="8385066">,</span>&nbsp;<span class="ident" id="8385068">data</span><span class="op" id="8385072">[</span><span class="op" id="8385073">:</span><span class="op" id="8385074">]</span><span class="op" id="8385075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8385078">}</span><br>
<span class="lineno"></span><span class="op" id="8385080">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="8385083">func</span>&nbsp;<span class="ident" id="8385088">TestReadUnixgramWithZeroBytesBuffer</span><span class="op" id="8385123">(</span><span class="ident" id="8385124">t</span>&nbsp;<span class="op" id="8385126">*</span><span class="ident" id="8385127">testing</span><span class="op" id="8385134">.</span><span class="ident" id="8385135">T</span><span class="op" id="8385136">)</span>&nbsp;<span class="op" id="8385138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8385141">//&nbsp;issue&nbsp;4352:&nbsp;Recvfrom&nbsp;failed&nbsp;with&nbsp;&#34;address&nbsp;family&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8385198">//&nbsp;supported&nbsp;by&nbsp;protocol&nbsp;family&#34;&nbsp;if&nbsp;zero-length&nbsp;buffer&nbsp;provided</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385264">addr</span>&nbsp;<span class="op" id="8385269">:=</span>&nbsp;<span class="ident" id="8385272">testUnixAddr</span><span class="op" id="8385284">(</span><span class="op" id="8385285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385288">la</span><span class="op" id="8385290">,</span>&nbsp;<span class="ident" id="8385292">err</span>&nbsp;<span class="op" id="8385296">:=</span>&nbsp;<span class="ident" id="8385299">ResolveUnixAddr</span><span class="op" id="8385314">(</span><span class="string" id="8385315">&#34;unixgram&#34;</span><span class="op" id="8385325">,</span>&nbsp;<span class="ident" id="8385327">addr</span><span class="op" id="8385331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385334">if</span>&nbsp;<span class="ident" id="8385337">err</span>&nbsp;<span class="op" id="8385341">!=</span>&nbsp;<span class="ident" id="8385344">nil</span>&nbsp;<span class="op" id="8385348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385352">t</span><span class="op" id="8385353">.</span><span class="ident" id="8385354">Fatalf</span><span class="op" id="8385360">(</span><span class="string" id="8385361">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8385389">,</span>&nbsp;<span class="ident" id="8385391">err</span><span class="op" id="8385394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8385397">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385400">c</span><span class="op" id="8385401">,</span>&nbsp;<span class="ident" id="8385403">err</span>&nbsp;<span class="op" id="8385407">:=</span>&nbsp;<span class="ident" id="8385410">ListenUnixgram</span><span class="op" id="8385424">(</span><span class="string" id="8385425">&#34;unixgram&#34;</span><span class="op" id="8385435">,</span>&nbsp;<span class="ident" id="8385437">la</span><span class="op" id="8385439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385442">if</span>&nbsp;<span class="ident" id="8385445">err</span>&nbsp;<span class="op" id="8385449">!=</span>&nbsp;<span class="ident" id="8385452">nil</span>&nbsp;<span class="op" id="8385456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385460">t</span><span class="op" id="8385461">.</span><span class="ident" id="8385462">Fatalf</span><span class="op" id="8385468">(</span><span class="string" id="8385469">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8385496">,</span>&nbsp;<span class="ident" id="8385498">err</span><span class="op" id="8385501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8385504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385507">defer</span>&nbsp;<span class="keyword" id="8385513">func</span><span class="op" id="8385517">(</span><span class="op" id="8385518">)</span>&nbsp;<span class="op" id="8385520">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385524">c</span><span class="op" id="8385525">.</span><span class="ident" id="8385526">Close</span><span class="op" id="8385531">(</span><span class="op" id="8385532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385536">os</span><span class="op" id="8385538">.</span><span class="ident" id="8385539">Remove</span><span class="op" id="8385545">(</span><span class="ident" id="8385546">addr</span><span class="op" id="8385550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8385553">}</span><span class="op" id="8385554">(</span><span class="op" id="8385555">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385559">off</span>&nbsp;<span class="op" id="8385563">:=</span>&nbsp;<span class="builtinfunc" id="8385566">make</span><span class="op" id="8385570">(</span><span class="keyword" id="8385571">chan</span>&nbsp;<span class="builtintype" id="8385576">bool</span><span class="op" id="8385580">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385583">go</span>&nbsp;<span class="keyword" id="8385586">func</span><span class="op" id="8385590">(</span><span class="op" id="8385591">)</span>&nbsp;<span class="op" id="8385593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385597">defer</span>&nbsp;<span class="keyword" id="8385603">func</span><span class="op" id="8385607">(</span><span class="op" id="8385608">)</span>&nbsp;<span class="op" id="8385610">{</span>&nbsp;<span class="ident" id="8385612">off</span>&nbsp;<span class="op" id="8385616">&lt;-</span>&nbsp;<span class="builtintype" id="8385619">true</span>&nbsp;<span class="op" id="8385624">}</span><span class="op" id="8385625">(</span><span class="op" id="8385626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385630">c</span><span class="op" id="8385631">,</span>&nbsp;<span class="ident" id="8385633">err</span>&nbsp;<span class="op" id="8385637">:=</span>&nbsp;<span class="ident" id="8385640">DialUnix</span><span class="op" id="8385648">(</span><span class="string" id="8385649">&#34;unixgram&#34;</span><span class="op" id="8385659">,</span>&nbsp;<span class="ident" id="8385661">nil</span><span class="op" id="8385664">,</span>&nbsp;<span class="ident" id="8385666">la</span><span class="op" id="8385668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385672">if</span>&nbsp;<span class="ident" id="8385675">err</span>&nbsp;<span class="op" id="8385679">!=</span>&nbsp;<span class="ident" id="8385682">nil</span>&nbsp;<span class="op" id="8385686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385691">t</span><span class="op" id="8385692">.</span><span class="ident" id="8385693">Errorf</span><span class="op" id="8385699">(</span><span class="string" id="8385700">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8385721">,</span>&nbsp;<span class="ident" id="8385723">err</span><span class="op" id="8385726">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385731">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8385740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385744">defer</span>&nbsp;<span class="ident" id="8385750">c</span><span class="op" id="8385751">.</span><span class="ident" id="8385752">Close</span><span class="op" id="8385757">(</span><span class="op" id="8385758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385762">if</span>&nbsp;<span class="ident" id="8385765">_</span><span class="op" id="8385766">,</span>&nbsp;<span class="ident" id="8385768">err</span>&nbsp;<span class="op" id="8385772">:=</span>&nbsp;<span class="ident" id="8385775">c</span><span class="op" id="8385776">.</span><span class="ident" id="8385777">Write</span><span class="op" id="8385782">(</span><span class="op" id="8385783">[</span><span class="op" id="8385784">]</span><span class="builtintype" id="8385785">byte</span><span class="op" id="8385789">{</span><span class="num" id="8385790">1</span><span class="op" id="8385791">,</span>&nbsp;<span class="num" id="8385793">2</span><span class="op" id="8385794">,</span>&nbsp;<span class="num" id="8385796">3</span><span class="op" id="8385797">,</span>&nbsp;<span class="num" id="8385799">4</span><span class="op" id="8385800">,</span>&nbsp;<span class="num" id="8385802">5</span><span class="op" id="8385803">}</span><span class="op" id="8385804">)</span><span class="op" id="8385805">;</span>&nbsp;<span class="ident" id="8385807">err</span>&nbsp;<span class="op" id="8385811">!=</span>&nbsp;<span class="ident" id="8385814">nil</span>&nbsp;<span class="op" id="8385818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385823">t</span><span class="op" id="8385824">.</span><span class="ident" id="8385825">Errorf</span><span class="op" id="8385831">(</span><span class="string" id="8385832">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8385859">,</span>&nbsp;<span class="ident" id="8385861">err</span><span class="op" id="8385864">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385869">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8385878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8385881">}</span><span class="op" id="8385882">(</span><span class="op" id="8385883">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8385887">&lt;-</span><span class="ident" id="8385889">off</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385894">c</span><span class="op" id="8385895">.</span><span class="ident" id="8385896">SetReadDeadline</span><span class="op" id="8385911">(</span><span class="ident" id="8385912">time</span><span class="op" id="8385916">.</span><span class="ident" id="8385917">Now</span><span class="op" id="8385920">(</span><span class="op" id="8385921">)</span><span class="op" id="8385922">.</span><span class="ident" id="8385923">Add</span><span class="op" id="8385926">(</span><span class="num" id="8385927">100</span>&nbsp;<span class="op" id="8385931">*</span>&nbsp;<span class="ident" id="8385933">time</span><span class="op" id="8385937">.</span><span class="ident" id="8385938">Millisecond</span><span class="op" id="8385949">)</span><span class="op" id="8385950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8385953">_</span><span class="op" id="8385954">,</span>&nbsp;<span class="ident" id="8385956">from</span><span class="op" id="8385960">,</span>&nbsp;<span class="ident" id="8385962">err</span>&nbsp;<span class="op" id="8385966">:=</span>&nbsp;<span class="ident" id="8385969">c</span><span class="op" id="8385970">.</span><span class="ident" id="8385971">ReadFrom</span><span class="op" id="8385979">(</span><span class="ident" id="8385980">nil</span><span class="op" id="8385983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8385986">if</span>&nbsp;<span class="ident" id="8385989">err</span>&nbsp;<span class="op" id="8385993">!=</span>&nbsp;<span class="ident" id="8385996">nil</span>&nbsp;<span class="op" id="8386000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386004">t</span><span class="op" id="8386005">.</span><span class="ident" id="8386006">Fatalf</span><span class="op" id="8386012">(</span><span class="string" id="8386013">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8386043">,</span>&nbsp;<span class="ident" id="8386045">err</span><span class="op" id="8386048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8386051">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8386054">if</span>&nbsp;<span class="ident" id="8386057">from</span>&nbsp;<span class="op" id="8386062">!=</span>&nbsp;<span class="ident" id="8386065">nil</span>&nbsp;<span class="op" id="8386069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386073">t</span><span class="op" id="8386074">.</span><span class="ident" id="8386075">Fatalf</span><span class="op" id="8386081">(</span><span class="string" id="8386082">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="8386106">,</span>&nbsp;<span class="ident" id="8386108">from</span><span class="op" id="8386112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8386115">}</span><br>
<span class="lineno"></span><span class="op" id="8386117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="8386120">func</span>&nbsp;<span class="ident" id="8386125">TestUnixgramAutobind</span><span class="op" id="8386145">(</span><span class="ident" id="8386146">t</span>&nbsp;<span class="op" id="8386148">*</span><span class="ident" id="8386149">testing</span><span class="op" id="8386156">.</span><span class="ident" id="8386157">T</span><span class="op" id="8386158">)</span>&nbsp;<span class="op" id="8386160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8386163">if</span>&nbsp;<span class="ident" id="8386166">runtime</span><span class="op" id="8386173">.</span><span class="ident" id="8386174">GOOS</span>&nbsp;<span class="op" id="8386179">!=</span>&nbsp;<span class="string" id="8386182">&#34;linux&#34;</span>&nbsp;<span class="op" id="8386190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386194">t</span><span class="op" id="8386195">.</span><span class="ident" id="8386196">Skip</span><span class="op" id="8386200">(</span><span class="string" id="8386201">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="8386235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8386238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386242">laddr</span>&nbsp;<span class="op" id="8386248">:=</span>&nbsp;<span class="op" id="8386251">&amp;</span><span class="ident" id="8386252">UnixAddr</span><span class="op" id="8386260">{</span><span class="ident" id="8386261">Name</span><span class="op" id="8386265">:</span>&nbsp;<span class="string" id="8386267">&#34;&#34;</span><span class="op" id="8386269">,</span>&nbsp;<span class="ident" id="8386271">Net</span><span class="op" id="8386274">:</span>&nbsp;<span class="string" id="8386276">&#34;unixgram&#34;</span><span class="op" id="8386286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386289">c1</span><span class="op" id="8386291">,</span>&nbsp;<span class="ident" id="8386293">err</span>&nbsp;<span class="op" id="8386297">:=</span>&nbsp;<span class="ident" id="8386300">ListenUnixgram</span><span class="op" id="8386314">(</span><span class="string" id="8386315">&#34;unixgram&#34;</span><span class="op" id="8386325">,</span>&nbsp;<span class="ident" id="8386327">laddr</span><span class="op" id="8386332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8386335">if</span>&nbsp;<span class="ident" id="8386338">err</span>&nbsp;<span class="op" id="8386342">!=</span>&nbsp;<span class="ident" id="8386345">nil</span>&nbsp;<span class="op" id="8386349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386353">t</span><span class="op" id="8386354">.</span><span class="ident" id="8386355">Fatalf</span><span class="op" id="8386361">(</span><span class="string" id="8386362">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8386389">,</span>&nbsp;<span class="ident" id="8386391">err</span><span class="op" id="8386394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8386397">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8386400">defer</span>&nbsp;<span class="ident" id="8386406">c1</span><span class="op" id="8386408">.</span><span class="ident" id="8386409">Close</span><span class="op" id="8386414">(</span><span class="op" id="8386415">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8386419">//&nbsp;retrieve&nbsp;the&nbsp;autobind&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386453">autoAddr</span>&nbsp;<span class="op" id="8386462">:=</span>&nbsp;<span class="ident" id="8386465">c1</span><span class="op" id="8386467">.</span><span class="ident" id="8386468">LocalAddr</span><span class="op" id="8386477">(</span><span class="op" id="8386478">)</span><span class="op" id="8386479">.</span><span class="op" id="8386480">(</span><span class="op" id="8386481">*</span><span class="ident" id="8386482">UnixAddr</span><span class="op" id="8386490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8386493">if</span>&nbsp;<span class="builtinfunc" id="8386496">len</span><span class="op" id="8386499">(</span><span class="ident" id="8386500">autoAddr</span><span class="op" id="8386508">.</span><span class="ident" id="8386509">Name</span><span class="op" id="8386513">)</span>&nbsp;<span class="op" id="8386515">&lt;=</span>&nbsp;<span class="num" id="8386518">1</span>&nbsp;<span class="op" id="8386520">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386524">t</span><span class="op" id="8386525">.</span><span class="ident" id="8386526">Fatalf</span><span class="op" id="8386532">(</span><span class="string" id="8386533">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="8386563">,</span>&nbsp;<span class="ident" id="8386565">autoAddr</span><span class="op" id="8386573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8386576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8386579">if</span>&nbsp;<span class="ident" id="8386582">autoAddr</span><span class="op" id="8386590">.</span><span class="ident" id="8386591">Name</span><span class="op" id="8386595">[</span><span class="num" id="8386596">0</span><span class="op" id="8386597">]</span>&nbsp;<span class="op" id="8386599">!=</span>&nbsp;<span class="string" id="8386602">&#39;@&#39;</span>&nbsp;<span class="op" id="8386606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386610">t</span><span class="op" id="8386611">.</span><span class="ident" id="8386612">Fatalf</span><span class="op" id="8386618">(</span><span class="string" id="8386619">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="8386649">,</span>&nbsp;<span class="ident" id="8386651">autoAddr</span><span class="op" id="8386659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8386662">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386666">c2</span><span class="op" id="8386668">,</span>&nbsp;<span class="ident" id="8386670">err</span>&nbsp;<span class="op" id="8386674">:=</span>&nbsp;<span class="ident" id="8386677">DialUnix</span><span class="op" id="8386685">(</span><span class="string" id="8386686">&#34;unixgram&#34;</span><span class="op" id="8386696">,</span>&nbsp;<span class="ident" id="8386698">nil</span><span class="op" id="8386701">,</span>&nbsp;<span class="ident" id="8386703">autoAddr</span><span class="op" id="8386711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8386714">if</span>&nbsp;<span class="ident" id="8386717">err</span>&nbsp;<span class="op" id="8386721">!=</span>&nbsp;<span class="ident" id="8386724">nil</span>&nbsp;<span class="op" id="8386728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386732">t</span><span class="op" id="8386733">.</span><span class="ident" id="8386734">Fatalf</span><span class="op" id="8386740">(</span><span class="string" id="8386741">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8386762">,</span>&nbsp;<span class="ident" id="8386764">err</span><span class="op" id="8386767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8386770">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8386773">defer</span>&nbsp;<span class="ident" id="8386779">c2</span><span class="op" id="8386781">.</span><span class="ident" id="8386782">Close</span><span class="op" id="8386787">(</span><span class="op" id="8386788">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8386792">if</span>&nbsp;<span class="op" id="8386795">!</span><span class="ident" id="8386796">reflect</span><span class="op" id="8386803">.</span><span class="ident" id="8386804">DeepEqual</span><span class="op" id="8386813">(</span><span class="ident" id="8386814">c1</span><span class="op" id="8386816">.</span><span class="ident" id="8386817">LocalAddr</span><span class="op" id="8386826">(</span><span class="op" id="8386827">)</span><span class="op" id="8386828">,</span>&nbsp;<span class="ident" id="8386830">c2</span><span class="op" id="8386832">.</span><span class="ident" id="8386833">RemoteAddr</span><span class="op" id="8386843">(</span><span class="op" id="8386844">)</span><span class="op" id="8386845">)</span>&nbsp;<span class="op" id="8386847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8386851">t</span><span class="op" id="8386852">.</span><span class="ident" id="8386853">Fatalf</span><span class="op" id="8386859">(</span><span class="string" id="8386860">&#34;expected&nbsp;autobind&nbsp;address&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8386898">,</span>&nbsp;<span class="ident" id="8386900">c1</span><span class="op" id="8386902">.</span><span class="ident" id="8386903">LocalAddr</span><span class="op" id="8386912">(</span><span class="op" id="8386913">)</span><span class="op" id="8386914">,</span>&nbsp;<span class="ident" id="8386916">c2</span><span class="op" id="8386918">.</span><span class="ident" id="8386919">RemoteAddr</span><span class="op" id="8386929">(</span><span class="op" id="8386930">)</span><span class="op" id="8386931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8386934">}</span><br>
<span class="lineno">140</span><span class="op" id="8386936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8386939">func</span>&nbsp;<span class="ident" id="8386944">TestUnixAutobindClose</span><span class="op" id="8386965">(</span><span class="ident" id="8386966">t</span>&nbsp;<span class="op" id="8386968">*</span><span class="ident" id="8386969">testing</span><span class="op" id="8386976">.</span><span class="ident" id="8386977">T</span><span class="op" id="8386978">)</span>&nbsp;<span class="op" id="8386980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8386983">if</span>&nbsp;<span class="ident" id="8386986">runtime</span><span class="op" id="8386993">.</span><span class="ident" id="8386994">GOOS</span>&nbsp;<span class="op" id="8386999">!=</span>&nbsp;<span class="string" id="8387002">&#34;linux&#34;</span>&nbsp;<span class="op" id="8387010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387014">t</span><span class="op" id="8387015">.</span><span class="ident" id="8387016">Skip</span><span class="op" id="8387020">(</span><span class="string" id="8387021">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="8387055">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8387058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387061">laddr</span>&nbsp;<span class="op" id="8387067">:=</span>&nbsp;<span class="op" id="8387070">&amp;</span><span class="ident" id="8387071">UnixAddr</span><span class="op" id="8387079">{</span><span class="ident" id="8387080">Name</span><span class="op" id="8387084">:</span>&nbsp;<span class="string" id="8387086">&#34;&#34;</span><span class="op" id="8387088">,</span>&nbsp;<span class="ident" id="8387090">Net</span><span class="op" id="8387093">:</span>&nbsp;<span class="string" id="8387095">&#34;unix&#34;</span><span class="op" id="8387101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387104">ln</span><span class="op" id="8387106">,</span>&nbsp;<span class="ident" id="8387108">err</span>&nbsp;<span class="op" id="8387112">:=</span>&nbsp;<span class="ident" id="8387115">ListenUnix</span><span class="op" id="8387125">(</span><span class="string" id="8387126">&#34;unix&#34;</span><span class="op" id="8387132">,</span>&nbsp;<span class="ident" id="8387134">laddr</span><span class="op" id="8387139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8387142">if</span>&nbsp;<span class="ident" id="8387145">err</span>&nbsp;<span class="op" id="8387149">!=</span>&nbsp;<span class="ident" id="8387152">nil</span>&nbsp;<span class="op" id="8387156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387160">t</span><span class="op" id="8387161">.</span><span class="ident" id="8387162">Fatalf</span><span class="op" id="8387168">(</span><span class="string" id="8387169">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8387192">,</span>&nbsp;<span class="ident" id="8387194">err</span><span class="op" id="8387197">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8387200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387203">ln</span><span class="op" id="8387205">.</span><span class="ident" id="8387206">Close</span><span class="op" id="8387211">(</span><span class="op" id="8387212">)</span><br>
<span class="lineno"></span><span class="op" id="8387214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8387217">func</span>&nbsp;<span class="ident" id="8387222">TestUnixgramWrite</span><span class="op" id="8387239">(</span><span class="ident" id="8387240">t</span>&nbsp;<span class="op" id="8387242">*</span><span class="ident" id="8387243">testing</span><span class="op" id="8387250">.</span><span class="ident" id="8387251">T</span><span class="op" id="8387252">)</span>&nbsp;<span class="op" id="8387254">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387257">addr</span>&nbsp;<span class="op" id="8387262">:=</span>&nbsp;<span class="ident" id="8387265">testUnixAddr</span><span class="op" id="8387277">(</span><span class="op" id="8387278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387281">laddr</span><span class="op" id="8387286">,</span>&nbsp;<span class="ident" id="8387288">err</span>&nbsp;<span class="op" id="8387292">:=</span>&nbsp;<span class="ident" id="8387295">ResolveUnixAddr</span><span class="op" id="8387310">(</span><span class="string" id="8387311">&#34;unixgram&#34;</span><span class="op" id="8387321">,</span>&nbsp;<span class="ident" id="8387323">addr</span><span class="op" id="8387327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8387330">if</span>&nbsp;<span class="ident" id="8387333">err</span>&nbsp;<span class="op" id="8387337">!=</span>&nbsp;<span class="ident" id="8387340">nil</span>&nbsp;<span class="op" id="8387344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387348">t</span><span class="op" id="8387349">.</span><span class="ident" id="8387350">Fatalf</span><span class="op" id="8387356">(</span><span class="string" id="8387357">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8387385">,</span>&nbsp;<span class="ident" id="8387387">err</span><span class="op" id="8387390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8387393">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387396">c</span><span class="op" id="8387397">,</span>&nbsp;<span class="ident" id="8387399">err</span>&nbsp;<span class="op" id="8387403">:=</span>&nbsp;<span class="ident" id="8387406">ListenPacket</span><span class="op" id="8387418">(</span><span class="string" id="8387419">&#34;unixgram&#34;</span><span class="op" id="8387429">,</span>&nbsp;<span class="ident" id="8387431">addr</span><span class="op" id="8387435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8387438">if</span>&nbsp;<span class="ident" id="8387441">err</span>&nbsp;<span class="op" id="8387445">!=</span>&nbsp;<span class="ident" id="8387448">nil</span>&nbsp;<span class="op" id="8387452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387456">t</span><span class="op" id="8387457">.</span><span class="ident" id="8387458">Fatalf</span><span class="op" id="8387464">(</span><span class="string" id="8387465">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8387490">,</span>&nbsp;<span class="ident" id="8387492">err</span><span class="op" id="8387495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8387498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8387501">defer</span>&nbsp;<span class="ident" id="8387507">os</span><span class="op" id="8387509">.</span><span class="ident" id="8387510">Remove</span><span class="op" id="8387516">(</span><span class="ident" id="8387517">addr</span><span class="op" id="8387521">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8387524">defer</span>&nbsp;<span class="ident" id="8387530">c</span><span class="op" id="8387531">.</span><span class="ident" id="8387532">Close</span><span class="op" id="8387537">(</span><span class="op" id="8387538">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387542">testUnixgramWriteConn</span><span class="op" id="8387563">(</span><span class="ident" id="8387564">t</span><span class="op" id="8387565">,</span>&nbsp;<span class="ident" id="8387567">laddr</span><span class="op" id="8387572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387575">testUnixgramWritePacketConn</span><span class="op" id="8387602">(</span><span class="ident" id="8387603">t</span><span class="op" id="8387604">,</span>&nbsp;<span class="ident" id="8387606">laddr</span><span class="op" id="8387611">)</span><br>
<span class="lineno"></span><span class="op" id="8387613">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="8387616">func</span>&nbsp;<span class="ident" id="8387621">testUnixgramWriteConn</span><span class="op" id="8387642">(</span><span class="ident" id="8387643">t</span>&nbsp;<span class="op" id="8387645">*</span><span class="ident" id="8387646">testing</span><span class="op" id="8387653">.</span><span class="ident" id="8387654">T</span><span class="op" id="8387655">,</span>&nbsp;<span class="ident" id="8387657">raddr</span>&nbsp;<span class="op" id="8387663">*</span><span class="ident" id="8387664">UnixAddr</span><span class="op" id="8387672">)</span>&nbsp;<span class="op" id="8387674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387677">c</span><span class="op" id="8387678">,</span>&nbsp;<span class="ident" id="8387680">err</span>&nbsp;<span class="op" id="8387684">:=</span>&nbsp;<span class="ident" id="8387687">Dial</span><span class="op" id="8387691">(</span><span class="string" id="8387692">&#34;unixgram&#34;</span><span class="op" id="8387702">,</span>&nbsp;<span class="ident" id="8387704">raddr</span><span class="op" id="8387709">.</span><span class="ident" id="8387710">String</span><span class="op" id="8387716">(</span><span class="op" id="8387717">)</span><span class="op" id="8387718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8387721">if</span>&nbsp;<span class="ident" id="8387724">err</span>&nbsp;<span class="op" id="8387728">!=</span>&nbsp;<span class="ident" id="8387731">nil</span>&nbsp;<span class="op" id="8387735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387739">t</span><span class="op" id="8387740">.</span><span class="ident" id="8387741">Fatalf</span><span class="op" id="8387747">(</span><span class="string" id="8387748">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8387765">,</span>&nbsp;<span class="ident" id="8387767">err</span><span class="op" id="8387770">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8387773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8387776">defer</span>&nbsp;<span class="ident" id="8387782">c</span><span class="op" id="8387783">.</span><span class="ident" id="8387784">Close</span><span class="op" id="8387789">(</span><span class="op" id="8387790">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8387794">if</span>&nbsp;<span class="ident" id="8387797">_</span><span class="op" id="8387798">,</span>&nbsp;<span class="ident" id="8387800">err</span>&nbsp;<span class="op" id="8387804">:=</span>&nbsp;<span class="ident" id="8387807">c</span><span class="op" id="8387808">.</span><span class="op" id="8387809">(</span><span class="op" id="8387810">*</span><span class="ident" id="8387811">UnixConn</span><span class="op" id="8387819">)</span><span class="op" id="8387820">.</span><span class="ident" id="8387821">WriteToUnix</span><span class="op" id="8387832">(</span><span class="op" id="8387833">[</span><span class="op" id="8387834">]</span><span class="builtintype" id="8387835">byte</span><span class="op" id="8387839">(</span><span class="string" id="8387840">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8387873">)</span><span class="op" id="8387874">,</span>&nbsp;<span class="ident" id="8387876">raddr</span><span class="op" id="8387881">)</span><span class="op" id="8387882">;</span>&nbsp;<span class="ident" id="8387884">err</span>&nbsp;<span class="op" id="8387888">==</span>&nbsp;<span class="ident" id="8387891">nil</span>&nbsp;<span class="op" id="8387895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387899">t</span><span class="op" id="8387900">.</span><span class="ident" id="8387901">Fatal</span><span class="op" id="8387906">(</span><span class="string" id="8387907">&#34;WriteToUnix&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8387932">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8387935">}</span>&nbsp;<span class="keyword" id="8387937">else</span>&nbsp;<span class="keyword" id="8387942">if</span>&nbsp;<span class="ident" id="8387945">err</span><span class="op" id="8387948">.</span><span class="op" id="8387949">(</span><span class="op" id="8387950">*</span><span class="ident" id="8387951">OpError</span><span class="op" id="8387958">)</span><span class="op" id="8387959">.</span><span class="ident" id="8387960">Err</span>&nbsp;<span class="op" id="8387964">!=</span>&nbsp;<span class="ident" id="8387967">ErrWriteToConnected</span>&nbsp;<span class="op" id="8387987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8387991">t</span><span class="op" id="8387992">.</span><span class="ident" id="8387993">Fatalf</span><span class="op" id="8387999">(</span><span class="string" id="8388000">&#34;WriteToUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="8388052">,</span>&nbsp;<span class="ident" id="8388054">err</span><span class="op" id="8388057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8388060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8388063">if</span>&nbsp;<span class="ident" id="8388066">_</span><span class="op" id="8388067">,</span>&nbsp;<span class="ident" id="8388069">err</span>&nbsp;<span class="op" id="8388073">=</span>&nbsp;<span class="ident" id="8388075">c</span><span class="op" id="8388076">.</span><span class="op" id="8388077">(</span><span class="op" id="8388078">*</span><span class="ident" id="8388079">UnixConn</span><span class="op" id="8388087">)</span><span class="op" id="8388088">.</span><span class="ident" id="8388089">WriteTo</span><span class="op" id="8388096">(</span><span class="op" id="8388097">[</span><span class="op" id="8388098">]</span><span class="builtintype" id="8388099">byte</span><span class="op" id="8388103">(</span><span class="string" id="8388104">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8388137">)</span><span class="op" id="8388138">,</span>&nbsp;<span class="ident" id="8388140">raddr</span><span class="op" id="8388145">)</span><span class="op" id="8388146">;</span>&nbsp;<span class="ident" id="8388148">err</span>&nbsp;<span class="op" id="8388152">==</span>&nbsp;<span class="ident" id="8388155">nil</span>&nbsp;<span class="op" id="8388159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8388163">t</span><span class="op" id="8388164">.</span><span class="ident" id="8388165">Fatal</span><span class="op" id="8388170">(</span><span class="string" id="8388171">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8388192">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8388195">}</span>&nbsp;<span class="keyword" id="8388197">else</span>&nbsp;<span class="keyword" id="8388202">if</span>&nbsp;<span class="ident" id="8388205">err</span><span class="op" id="8388208">.</span><span class="op" id="8388209">(</span><span class="op" id="8388210">*</span><span class="ident" id="8388211">OpError</span><span class="op" id="8388218">)</span><span class="op" id="8388219">.</span><span class="ident" id="8388220">Err</span>&nbsp;<span class="op" id="8388224">!=</span>&nbsp;<span class="ident" id="8388227">ErrWriteToConnected</span>&nbsp;<span class="op" id="8388247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8388251">t</span><span class="op" id="8388252">.</span><span class="ident" id="8388253">Fatalf</span><span class="op" id="8388259">(</span><span class="string" id="8388260">&#34;WriteTo&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="8388308">,</span>&nbsp;<span class="ident" id="8388310">err</span><span class="op" id="8388313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8388316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8388319">if</span>&nbsp;<span class="ident" id="8388322">_</span><span class="op" id="8388323">,</span>&nbsp;<span class="ident" id="8388325">_</span><span class="op" id="8388326">,</span>&nbsp;<span class="ident" id="8388328">err</span>&nbsp;<span class="op" id="8388332">=</span>&nbsp;<span class="ident" id="8388334">c</span><span class="op" id="8388335">.</span><span class="op" id="8388336">(</span><span class="op" id="8388337">*</span><span class="ident" id="8388338">UnixConn</span><span class="op" id="8388346">)</span><span class="op" id="8388347">.</span><span class="ident" id="8388348">WriteMsgUnix</span><span class="op" id="8388360">(</span><span class="op" id="8388361">[</span><span class="op" id="8388362">]</span><span class="builtintype" id="8388363">byte</span><span class="op" id="8388367">(</span><span class="string" id="8388368">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8388401">)</span><span class="op" id="8388402">,</span>&nbsp;<span class="ident" id="8388404">nil</span><span class="op" id="8388407">,</span>&nbsp;<span class="ident" id="8388409">raddr</span><span class="op" id="8388414">)</span><span class="op" id="8388415">;</span>&nbsp;<span class="ident" id="8388417">err</span>&nbsp;<span class="op" id="8388421">==</span>&nbsp;<span class="ident" id="8388424">nil</span>&nbsp;<span class="op" id="8388428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8388432">t</span><span class="op" id="8388433">.</span><span class="ident" id="8388434">Fatal</span><span class="op" id="8388439">(</span><span class="string" id="8388440">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8388461">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8388464">}</span>&nbsp;<span class="keyword" id="8388466">else</span>&nbsp;<span class="keyword" id="8388471">if</span>&nbsp;<span class="ident" id="8388474">err</span><span class="op" id="8388477">.</span><span class="op" id="8388478">(</span><span class="op" id="8388479">*</span><span class="ident" id="8388480">OpError</span><span class="op" id="8388487">)</span><span class="op" id="8388488">.</span><span class="ident" id="8388489">Err</span>&nbsp;<span class="op" id="8388493">!=</span>&nbsp;<span class="ident" id="8388496">ErrWriteToConnected</span>&nbsp;<span class="op" id="8388516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8388520">t</span><span class="op" id="8388521">.</span><span class="ident" id="8388522">Fatalf</span><span class="op" id="8388528">(</span><span class="string" id="8388529">&#34;WriteMsgUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="8388582">,</span>&nbsp;<span class="ident" id="8388584">err</span><span class="op" id="8388587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8388590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8388593">if</span>&nbsp;<span class="ident" id="8388596">_</span><span class="op" id="8388597">,</span>&nbsp;<span class="ident" id="8388599">err</span>&nbsp;<span class="op" id="8388603">:=</span>&nbsp;<span class="ident" id="8388606">c</span><span class="op" id="8388607">.</span><span class="ident" id="8388608">Write</span><span class="op" id="8388613">(</span><span class="op" id="8388614">[</span><span class="op" id="8388615">]</span><span class="builtintype" id="8388616">byte</span><span class="op" id="8388620">(</span><span class="string" id="8388621">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8388654">)</span><span class="op" id="8388655">)</span><span class="op" id="8388656">;</span>&nbsp;<span class="ident" id="8388658">err</span>&nbsp;<span class="op" id="8388662">!=</span>&nbsp;<span class="ident" id="8388665">nil</span>&nbsp;<span class="op" id="8388669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8388673">t</span><span class="op" id="8388674">.</span><span class="ident" id="8388675">Fatalf</span><span class="op" id="8388681">(</span><span class="string" id="8388682">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8388700">,</span>&nbsp;<span class="ident" id="8388702">err</span><span class="op" id="8388705">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8388708">}</span><br>
<span class="lineno"></span><span class="op" id="8388710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8388713">func</span>&nbsp;<span class="ident" id="8388718">testUnixgramWritePacketConn</span><span class="op" id="8388745">(</span><span class="ident" id="8388746">t</span>&nbsp;<span class="op" id="8388748">*</span><span class="ident" id="8388749">testing</span><span class="op" id="8388756">.</span><span class="ident" id="8388757">T</span><span class="op" id="8388758">,</span>&nbsp;<span class="ident" id="8388760">raddr</span>&nbsp;<span class="op" id="8388766">*</span><span class="ident" id="8388767">UnixAddr</span><span class="op" id="8388775">)</span>&nbsp;<span class="op" id="8388777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8388780">addr</span>&nbsp;<span class="op" id="8388785">:=</span>&nbsp;<span class="ident" id="8388788">testUnixAddr</span><span class="op" id="8388800">(</span><span class="op" id="8388801">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8388804">c</span><span class="op" id="8388805">,</span>&nbsp;<span class="ident" id="8388807">err</span>&nbsp;<span class="op" id="8388811">:=</span>&nbsp;<span class="ident" id="8388814">ListenPacket</span><span class="op" id="8388826">(</span><span class="string" id="8388827">&#34;unixgram&#34;</span><span class="op" id="8388837">,</span>&nbsp;<span class="ident" id="8388839">addr</span><span class="op" id="8388843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8388846">if</span>&nbsp;<span class="ident" id="8388849">err</span>&nbsp;<span class="op" id="8388853">!=</span>&nbsp;<span class="ident" id="8388856">nil</span>&nbsp;<span class="op" id="8388860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8388864">t</span><span class="op" id="8388865">.</span><span class="ident" id="8388866">Fatalf</span><span class="op" id="8388872">(</span><span class="string" id="8388873">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8388898">,</span>&nbsp;<span class="ident" id="8388900">err</span><span class="op" id="8388903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8388906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8388909">defer</span>&nbsp;<span class="ident" id="8388915">os</span><span class="op" id="8388917">.</span><span class="ident" id="8388918">Remove</span><span class="op" id="8388924">(</span><span class="ident" id="8388925">addr</span><span class="op" id="8388929">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8388932">defer</span>&nbsp;<span class="ident" id="8388938">c</span><span class="op" id="8388939">.</span><span class="ident" id="8388940">Close</span><span class="op" id="8388945">(</span><span class="op" id="8388946">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8388950">if</span>&nbsp;<span class="ident" id="8388953">_</span><span class="op" id="8388954">,</span>&nbsp;<span class="ident" id="8388956">err</span>&nbsp;<span class="op" id="8388960">:=</span>&nbsp;<span class="ident" id="8388963">c</span><span class="op" id="8388964">.</span><span class="op" id="8388965">(</span><span class="op" id="8388966">*</span><span class="ident" id="8388967">UnixConn</span><span class="op" id="8388975">)</span><span class="op" id="8388976">.</span><span class="ident" id="8388977">WriteToUnix</span><span class="op" id="8388988">(</span><span class="op" id="8388989">[</span><span class="op" id="8388990">]</span><span class="builtintype" id="8388991">byte</span><span class="op" id="8388995">(</span><span class="string" id="8388996">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8389024">)</span><span class="op" id="8389025">,</span>&nbsp;<span class="ident" id="8389027">raddr</span><span class="op" id="8389032">)</span><span class="op" id="8389033">;</span>&nbsp;<span class="ident" id="8389035">err</span>&nbsp;<span class="op" id="8389039">!=</span>&nbsp;<span class="ident" id="8389042">nil</span>&nbsp;<span class="op" id="8389046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389050">t</span><span class="op" id="8389051">.</span><span class="ident" id="8389052">Fatalf</span><span class="op" id="8389058">(</span><span class="string" id="8389059">&#34;WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8389083">,</span>&nbsp;<span class="ident" id="8389085">err</span><span class="op" id="8389088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8389091">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389094">if</span>&nbsp;<span class="ident" id="8389097">_</span><span class="op" id="8389098">,</span>&nbsp;<span class="ident" id="8389100">err</span>&nbsp;<span class="op" id="8389104">:=</span>&nbsp;<span class="ident" id="8389107">c</span><span class="op" id="8389108">.</span><span class="ident" id="8389109">WriteTo</span><span class="op" id="8389116">(</span><span class="op" id="8389117">[</span><span class="op" id="8389118">]</span><span class="builtintype" id="8389119">byte</span><span class="op" id="8389123">(</span><span class="string" id="8389124">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8389152">)</span><span class="op" id="8389153">,</span>&nbsp;<span class="ident" id="8389155">raddr</span><span class="op" id="8389160">)</span><span class="op" id="8389161">;</span>&nbsp;<span class="ident" id="8389163">err</span>&nbsp;<span class="op" id="8389167">!=</span>&nbsp;<span class="ident" id="8389170">nil</span>&nbsp;<span class="op" id="8389174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389178">t</span><span class="op" id="8389179">.</span><span class="ident" id="8389180">Fatalf</span><span class="op" id="8389186">(</span><span class="string" id="8389187">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8389207">,</span>&nbsp;<span class="ident" id="8389209">err</span><span class="op" id="8389212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8389215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389218">if</span>&nbsp;<span class="ident" id="8389221">_</span><span class="op" id="8389222">,</span>&nbsp;<span class="ident" id="8389224">_</span><span class="op" id="8389225">,</span>&nbsp;<span class="ident" id="8389227">err</span>&nbsp;<span class="op" id="8389231">:=</span>&nbsp;<span class="ident" id="8389234">c</span><span class="op" id="8389235">.</span><span class="op" id="8389236">(</span><span class="op" id="8389237">*</span><span class="ident" id="8389238">UnixConn</span><span class="op" id="8389246">)</span><span class="op" id="8389247">.</span><span class="ident" id="8389248">WriteMsgUnix</span><span class="op" id="8389260">(</span><span class="op" id="8389261">[</span><span class="op" id="8389262">]</span><span class="builtintype" id="8389263">byte</span><span class="op" id="8389267">(</span><span class="string" id="8389268">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8389296">)</span><span class="op" id="8389297">,</span>&nbsp;<span class="ident" id="8389299">nil</span><span class="op" id="8389302">,</span>&nbsp;<span class="ident" id="8389304">raddr</span><span class="op" id="8389309">)</span><span class="op" id="8389310">;</span>&nbsp;<span class="ident" id="8389312">err</span>&nbsp;<span class="op" id="8389316">!=</span>&nbsp;<span class="ident" id="8389319">nil</span>&nbsp;<span class="op" id="8389323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389327">t</span><span class="op" id="8389328">.</span><span class="ident" id="8389329">Fatalf</span><span class="op" id="8389335">(</span><span class="string" id="8389336">&#34;WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8389361">,</span>&nbsp;<span class="ident" id="8389363">err</span><span class="op" id="8389366">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8389369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389372">if</span>&nbsp;<span class="ident" id="8389375">_</span><span class="op" id="8389376">,</span>&nbsp;<span class="ident" id="8389378">err</span>&nbsp;<span class="op" id="8389382">:=</span>&nbsp;<span class="ident" id="8389385">c</span><span class="op" id="8389386">.</span><span class="op" id="8389387">(</span><span class="op" id="8389388">*</span><span class="ident" id="8389389">UnixConn</span><span class="op" id="8389397">)</span><span class="op" id="8389398">.</span><span class="ident" id="8389399">Write</span><span class="op" id="8389404">(</span><span class="op" id="8389405">[</span><span class="op" id="8389406">]</span><span class="builtintype" id="8389407">byte</span><span class="op" id="8389411">(</span><span class="string" id="8389412">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8389440">)</span><span class="op" id="8389441">)</span><span class="op" id="8389442">;</span>&nbsp;<span class="ident" id="8389444">err</span>&nbsp;<span class="op" id="8389448">==</span>&nbsp;<span class="ident" id="8389451">nil</span>&nbsp;<span class="op" id="8389455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389459">t</span><span class="op" id="8389460">.</span><span class="ident" id="8389461">Fatal</span><span class="op" id="8389466">(</span><span class="string" id="8389467">&#34;Write&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8389486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8389489">}</span><br>
<span class="lineno"></span><span class="op" id="8389491">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="8389494">func</span>&nbsp;<span class="ident" id="8389499">TestUnixConnLocalAndRemoteNames</span><span class="op" id="8389530">(</span><span class="ident" id="8389531">t</span>&nbsp;<span class="op" id="8389533">*</span><span class="ident" id="8389534">testing</span><span class="op" id="8389541">.</span><span class="ident" id="8389542">T</span><span class="op" id="8389543">)</span>&nbsp;<span class="op" id="8389545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389548">for</span>&nbsp;<span class="ident" id="8389552">_</span><span class="op" id="8389553">,</span>&nbsp;<span class="ident" id="8389555">laddr</span>&nbsp;<span class="op" id="8389561">:=</span>&nbsp;<span class="keyword" id="8389564">range</span>&nbsp;<span class="op" id="8389570">[</span><span class="op" id="8389571">]</span><span class="builtintype" id="8389572">string</span><span class="op" id="8389578">{</span><span class="string" id="8389579">&#34;&#34;</span><span class="op" id="8389581">,</span>&nbsp;<span class="ident" id="8389583">testUnixAddr</span><span class="op" id="8389595">(</span><span class="op" id="8389596">)</span><span class="op" id="8389597">}</span>&nbsp;<span class="op" id="8389599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389603">laddr</span>&nbsp;<span class="op" id="8389609">:=</span>&nbsp;<span class="ident" id="8389612">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389620">taddr</span>&nbsp;<span class="op" id="8389626">:=</span>&nbsp;<span class="ident" id="8389629">testUnixAddr</span><span class="op" id="8389641">(</span><span class="op" id="8389642">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389646">ta</span><span class="op" id="8389648">,</span>&nbsp;<span class="ident" id="8389650">err</span>&nbsp;<span class="op" id="8389654">:=</span>&nbsp;<span class="ident" id="8389657">ResolveUnixAddr</span><span class="op" id="8389672">(</span><span class="string" id="8389673">&#34;unix&#34;</span><span class="op" id="8389679">,</span>&nbsp;<span class="ident" id="8389681">taddr</span><span class="op" id="8389686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389690">if</span>&nbsp;<span class="ident" id="8389693">err</span>&nbsp;<span class="op" id="8389697">!=</span>&nbsp;<span class="ident" id="8389700">nil</span>&nbsp;<span class="op" id="8389704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389709">t</span><span class="op" id="8389710">.</span><span class="ident" id="8389711">Fatalf</span><span class="op" id="8389717">(</span><span class="string" id="8389718">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8389746">,</span>&nbsp;<span class="ident" id="8389748">err</span><span class="op" id="8389751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8389755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389759">ln</span><span class="op" id="8389761">,</span>&nbsp;<span class="ident" id="8389763">err</span>&nbsp;<span class="op" id="8389767">:=</span>&nbsp;<span class="ident" id="8389770">ListenUnix</span><span class="op" id="8389780">(</span><span class="string" id="8389781">&#34;unix&#34;</span><span class="op" id="8389787">,</span>&nbsp;<span class="ident" id="8389789">ta</span><span class="op" id="8389791">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389795">if</span>&nbsp;<span class="ident" id="8389798">err</span>&nbsp;<span class="op" id="8389802">!=</span>&nbsp;<span class="ident" id="8389805">nil</span>&nbsp;<span class="op" id="8389809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389814">t</span><span class="op" id="8389815">.</span><span class="ident" id="8389816">Fatalf</span><span class="op" id="8389822">(</span><span class="string" id="8389823">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8389846">,</span>&nbsp;<span class="ident" id="8389848">err</span><span class="op" id="8389851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8389855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389859">defer</span>&nbsp;<span class="keyword" id="8389865">func</span><span class="op" id="8389869">(</span><span class="op" id="8389870">)</span>&nbsp;<span class="op" id="8389872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389877">ln</span><span class="op" id="8389879">.</span><span class="ident" id="8389880">Close</span><span class="op" id="8389885">(</span><span class="op" id="8389886">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389891">os</span><span class="op" id="8389893">.</span><span class="ident" id="8389894">Remove</span><span class="op" id="8389900">(</span><span class="ident" id="8389901">taddr</span><span class="op" id="8389906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8389910">}</span><span class="op" id="8389911">(</span><span class="op" id="8389912">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389917">done</span>&nbsp;<span class="op" id="8389922">:=</span>&nbsp;<span class="builtinfunc" id="8389925">make</span><span class="op" id="8389929">(</span><span class="keyword" id="8389930">chan</span>&nbsp;<span class="builtintype" id="8389935">int</span><span class="op" id="8389938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8389942">go</span>&nbsp;<span class="ident" id="8389945">transponder</span><span class="op" id="8389956">(</span><span class="ident" id="8389957">t</span><span class="op" id="8389958">,</span>&nbsp;<span class="ident" id="8389960">ln</span><span class="op" id="8389962">,</span>&nbsp;<span class="ident" id="8389964">done</span><span class="op" id="8389968">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8389973">la</span><span class="op" id="8389975">,</span>&nbsp;<span class="ident" id="8389977">err</span>&nbsp;<span class="op" id="8389981">:=</span>&nbsp;<span class="ident" id="8389984">ResolveUnixAddr</span><span class="op" id="8389999">(</span><span class="string" id="8390000">&#34;unix&#34;</span><span class="op" id="8390006">,</span>&nbsp;<span class="ident" id="8390008">laddr</span><span class="op" id="8390013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390017">if</span>&nbsp;<span class="ident" id="8390020">err</span>&nbsp;<span class="op" id="8390024">!=</span>&nbsp;<span class="ident" id="8390027">nil</span>&nbsp;<span class="op" id="8390031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390036">t</span><span class="op" id="8390037">.</span><span class="ident" id="8390038">Fatalf</span><span class="op" id="8390044">(</span><span class="string" id="8390045">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8390073">,</span>&nbsp;<span class="ident" id="8390075">err</span><span class="op" id="8390078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390082">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390086">c</span><span class="op" id="8390087">,</span>&nbsp;<span class="ident" id="8390089">err</span>&nbsp;<span class="op" id="8390093">:=</span>&nbsp;<span class="ident" id="8390096">DialUnix</span><span class="op" id="8390104">(</span><span class="string" id="8390105">&#34;unix&#34;</span><span class="op" id="8390111">,</span>&nbsp;<span class="ident" id="8390113">la</span><span class="op" id="8390115">,</span>&nbsp;<span class="ident" id="8390117">ta</span><span class="op" id="8390119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390123">if</span>&nbsp;<span class="ident" id="8390126">err</span>&nbsp;<span class="op" id="8390130">!=</span>&nbsp;<span class="ident" id="8390133">nil</span>&nbsp;<span class="op" id="8390137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390142">t</span><span class="op" id="8390143">.</span><span class="ident" id="8390144">Fatalf</span><span class="op" id="8390150">(</span><span class="string" id="8390151">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8390172">,</span>&nbsp;<span class="ident" id="8390174">err</span><span class="op" id="8390177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390185">defer</span>&nbsp;<span class="keyword" id="8390191">func</span><span class="op" id="8390195">(</span><span class="op" id="8390196">)</span>&nbsp;<span class="op" id="8390198">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390203">c</span><span class="op" id="8390204">.</span><span class="ident" id="8390205">Close</span><span class="op" id="8390210">(</span><span class="op" id="8390211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390216">if</span>&nbsp;<span class="ident" id="8390219">la</span>&nbsp;<span class="op" id="8390222">!=</span>&nbsp;<span class="ident" id="8390225">nil</span>&nbsp;<span class="op" id="8390229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390235">defer</span>&nbsp;<span class="ident" id="8390241">os</span><span class="op" id="8390243">.</span><span class="ident" id="8390244">Remove</span><span class="op" id="8390250">(</span><span class="ident" id="8390251">laddr</span><span class="op" id="8390256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390265">}</span><span class="op" id="8390266">(</span><span class="op" id="8390267">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390271">if</span>&nbsp;<span class="ident" id="8390274">_</span><span class="op" id="8390275">,</span>&nbsp;<span class="ident" id="8390277">err</span>&nbsp;<span class="op" id="8390281">:=</span>&nbsp;<span class="ident" id="8390284">c</span><span class="op" id="8390285">.</span><span class="ident" id="8390286">Write</span><span class="op" id="8390291">(</span><span class="op" id="8390292">[</span><span class="op" id="8390293">]</span><span class="builtintype" id="8390294">byte</span><span class="op" id="8390298">(</span><span class="string" id="8390299">&#34;UNIXCONN&nbsp;LOCAL&nbsp;AND&nbsp;REMOTE&nbsp;NAME&nbsp;TEST&#34;</span><span class="op" id="8390336">)</span><span class="op" id="8390337">)</span><span class="op" id="8390338">;</span>&nbsp;<span class="ident" id="8390340">err</span>&nbsp;<span class="op" id="8390344">!=</span>&nbsp;<span class="ident" id="8390347">nil</span>&nbsp;<span class="op" id="8390351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390356">t</span><span class="op" id="8390357">.</span><span class="ident" id="8390358">Fatalf</span><span class="op" id="8390364">(</span><span class="string" id="8390365">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8390392">,</span>&nbsp;<span class="ident" id="8390394">err</span><span class="op" id="8390397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390406">switch</span>&nbsp;<span class="ident" id="8390413">runtime</span><span class="op" id="8390420">.</span><span class="ident" id="8390421">GOOS</span>&nbsp;<span class="op" id="8390426">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390430">case</span>&nbsp;<span class="string" id="8390435">&#34;android&#34;</span><span class="op" id="8390444">,</span>&nbsp;<span class="string" id="8390446">&#34;linux&#34;</span><span class="op" id="8390453">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390458">if</span>&nbsp;<span class="ident" id="8390461">laddr</span>&nbsp;<span class="op" id="8390467">==</span>&nbsp;<span class="string" id="8390470">&#34;&#34;</span>&nbsp;<span class="op" id="8390473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390479">laddr</span>&nbsp;<span class="op" id="8390485">=</span>&nbsp;<span class="string" id="8390487">&#34;@&#34;</span>&nbsp;<span class="comment" id="8390491">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390518">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390522">var</span>&nbsp;<span class="ident" id="8390526">connAddrs</span>&nbsp;<span class="op" id="8390536">=</span>&nbsp;<span class="op" id="8390538">[</span><span class="num" id="8390539">3</span><span class="op" id="8390540">]</span><span class="keyword" id="8390541">struct</span><span class="op" id="8390547">{</span>&nbsp;<span class="ident" id="8390549">got</span><span class="op" id="8390552">,</span>&nbsp;<span class="ident" id="8390554">want</span>&nbsp;<span class="ident" id="8390559">Addr</span>&nbsp;<span class="op" id="8390564">}</span><span class="op" id="8390565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390570">{</span><span class="ident" id="8390571">ln</span><span class="op" id="8390573">.</span><span class="ident" id="8390574">Addr</span><span class="op" id="8390578">(</span><span class="op" id="8390579">)</span><span class="op" id="8390580">,</span>&nbsp;<span class="ident" id="8390582">ta</span><span class="op" id="8390584">}</span><span class="op" id="8390585">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390590">{</span><span class="ident" id="8390591">c</span><span class="op" id="8390592">.</span><span class="ident" id="8390593">LocalAddr</span><span class="op" id="8390602">(</span><span class="op" id="8390603">)</span><span class="op" id="8390604">,</span>&nbsp;<span class="op" id="8390606">&amp;</span><span class="ident" id="8390607">UnixAddr</span><span class="op" id="8390615">{</span><span class="ident" id="8390616">Name</span><span class="op" id="8390620">:</span>&nbsp;<span class="ident" id="8390622">laddr</span><span class="op" id="8390627">,</span>&nbsp;<span class="ident" id="8390629">Net</span><span class="op" id="8390632">:</span>&nbsp;<span class="string" id="8390634">&#34;unix&#34;</span><span class="op" id="8390640">}</span><span class="op" id="8390641">}</span><span class="op" id="8390642">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390647">{</span><span class="ident" id="8390648">c</span><span class="op" id="8390649">.</span><span class="ident" id="8390650">RemoteAddr</span><span class="op" id="8390660">(</span><span class="op" id="8390661">)</span><span class="op" id="8390662">,</span>&nbsp;<span class="ident" id="8390664">ta</span><span class="op" id="8390666">}</span><span class="op" id="8390667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390671">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390675">for</span>&nbsp;<span class="ident" id="8390679">_</span><span class="op" id="8390680">,</span>&nbsp;<span class="ident" id="8390682">ca</span>&nbsp;<span class="op" id="8390685">:=</span>&nbsp;<span class="keyword" id="8390688">range</span>&nbsp;<span class="ident" id="8390694">connAddrs</span>&nbsp;<span class="op" id="8390704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390709">if</span>&nbsp;<span class="op" id="8390712">!</span><span class="ident" id="8390713">reflect</span><span class="op" id="8390720">.</span><span class="ident" id="8390721">DeepEqual</span><span class="op" id="8390730">(</span><span class="ident" id="8390731">ca</span><span class="op" id="8390733">.</span><span class="ident" id="8390734">got</span><span class="op" id="8390737">,</span>&nbsp;<span class="ident" id="8390739">ca</span><span class="op" id="8390741">.</span><span class="ident" id="8390742">want</span><span class="op" id="8390746">)</span>&nbsp;<span class="op" id="8390748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390754">t</span><span class="op" id="8390755">.</span><span class="ident" id="8390756">Fatalf</span><span class="op" id="8390762">(</span><span class="string" id="8390763">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="8390786">,</span>&nbsp;<span class="ident" id="8390788">ca</span><span class="op" id="8390790">.</span><span class="ident" id="8390791">got</span><span class="op" id="8390794">,</span>&nbsp;<span class="ident" id="8390796">ca</span><span class="op" id="8390798">.</span><span class="ident" id="8390799">want</span><span class="op" id="8390803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390812">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390817">&lt;-</span><span class="ident" id="8390819">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390825">}</span><br>
<span class="lineno"></span><span class="op" id="8390827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="8390830">func</span>&nbsp;<span class="ident" id="8390835">TestUnixgramConnLocalAndRemoteNames</span><span class="op" id="8390870">(</span><span class="ident" id="8390871">t</span>&nbsp;<span class="op" id="8390873">*</span><span class="ident" id="8390874">testing</span><span class="op" id="8390881">.</span><span class="ident" id="8390882">T</span><span class="op" id="8390883">)</span>&nbsp;<span class="op" id="8390885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390888">for</span>&nbsp;<span class="ident" id="8390892">_</span><span class="op" id="8390893">,</span>&nbsp;<span class="ident" id="8390895">laddr</span>&nbsp;<span class="op" id="8390901">:=</span>&nbsp;<span class="keyword" id="8390904">range</span>&nbsp;<span class="op" id="8390910">[</span><span class="op" id="8390911">]</span><span class="builtintype" id="8390912">string</span><span class="op" id="8390918">{</span><span class="string" id="8390919">&#34;&#34;</span><span class="op" id="8390921">,</span>&nbsp;<span class="ident" id="8390923">testUnixAddr</span><span class="op" id="8390935">(</span><span class="op" id="8390936">)</span><span class="op" id="8390937">}</span>&nbsp;<span class="op" id="8390939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390943">laddr</span>&nbsp;<span class="op" id="8390949">:=</span>&nbsp;<span class="ident" id="8390952">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390960">taddr</span>&nbsp;<span class="op" id="8390966">:=</span>&nbsp;<span class="ident" id="8390969">testUnixAddr</span><span class="op" id="8390981">(</span><span class="op" id="8390982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390986">ta</span><span class="op" id="8390988">,</span>&nbsp;<span class="ident" id="8390990">err</span>&nbsp;<span class="op" id="8390994">:=</span>&nbsp;<span class="ident" id="8390997">ResolveUnixAddr</span><span class="op" id="8391012">(</span><span class="string" id="8391013">&#34;unixgram&#34;</span><span class="op" id="8391023">,</span>&nbsp;<span class="ident" id="8391025">taddr</span><span class="op" id="8391030">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391034">if</span>&nbsp;<span class="ident" id="8391037">err</span>&nbsp;<span class="op" id="8391041">!=</span>&nbsp;<span class="ident" id="8391044">nil</span>&nbsp;<span class="op" id="8391048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391053">t</span><span class="op" id="8391054">.</span><span class="ident" id="8391055">Fatalf</span><span class="op" id="8391061">(</span><span class="string" id="8391062">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8391090">,</span>&nbsp;<span class="ident" id="8391092">err</span><span class="op" id="8391095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391103">c1</span><span class="op" id="8391105">,</span>&nbsp;<span class="ident" id="8391107">err</span>&nbsp;<span class="op" id="8391111">:=</span>&nbsp;<span class="ident" id="8391114">ListenUnixgram</span><span class="op" id="8391128">(</span><span class="string" id="8391129">&#34;unixgram&#34;</span><span class="op" id="8391139">,</span>&nbsp;<span class="ident" id="8391141">ta</span><span class="op" id="8391143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391147">if</span>&nbsp;<span class="ident" id="8391150">err</span>&nbsp;<span class="op" id="8391154">!=</span>&nbsp;<span class="ident" id="8391157">nil</span>&nbsp;<span class="op" id="8391161">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391166">t</span><span class="op" id="8391167">.</span><span class="ident" id="8391168">Fatalf</span><span class="op" id="8391174">(</span><span class="string" id="8391175">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8391202">,</span>&nbsp;<span class="ident" id="8391204">err</span><span class="op" id="8391207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391215">defer</span>&nbsp;<span class="keyword" id="8391221">func</span><span class="op" id="8391225">(</span><span class="op" id="8391226">)</span>&nbsp;<span class="op" id="8391228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391233">c1</span><span class="op" id="8391235">.</span><span class="ident" id="8391236">Close</span><span class="op" id="8391241">(</span><span class="op" id="8391242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391247">os</span><span class="op" id="8391249">.</span><span class="ident" id="8391250">Remove</span><span class="op" id="8391256">(</span><span class="ident" id="8391257">taddr</span><span class="op" id="8391262">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391266">}</span><span class="op" id="8391267">(</span><span class="op" id="8391268">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391273">var</span>&nbsp;<span class="ident" id="8391277">la</span>&nbsp;<span class="op" id="8391280">*</span><span class="ident" id="8391281">UnixAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391292">if</span>&nbsp;<span class="ident" id="8391295">laddr</span>&nbsp;<span class="op" id="8391301">!=</span>&nbsp;<span class="string" id="8391304">&#34;&#34;</span>&nbsp;<span class="op" id="8391307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391312">if</span>&nbsp;<span class="ident" id="8391315">la</span><span class="op" id="8391317">,</span>&nbsp;<span class="ident" id="8391319">err</span>&nbsp;<span class="op" id="8391323">=</span>&nbsp;<span class="ident" id="8391325">ResolveUnixAddr</span><span class="op" id="8391340">(</span><span class="string" id="8391341">&#34;unixgram&#34;</span><span class="op" id="8391351">,</span>&nbsp;<span class="ident" id="8391353">laddr</span><span class="op" id="8391358">)</span><span class="op" id="8391359">;</span>&nbsp;<span class="ident" id="8391361">err</span>&nbsp;<span class="op" id="8391365">!=</span>&nbsp;<span class="ident" id="8391368">nil</span>&nbsp;<span class="op" id="8391372">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391378">t</span><span class="op" id="8391379">.</span><span class="ident" id="8391380">Fatalf</span><span class="op" id="8391386">(</span><span class="string" id="8391387">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8391415">,</span>&nbsp;<span class="ident" id="8391417">err</span><span class="op" id="8391420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391433">c2</span><span class="op" id="8391435">,</span>&nbsp;<span class="ident" id="8391437">err</span>&nbsp;<span class="op" id="8391441">:=</span>&nbsp;<span class="ident" id="8391444">DialUnix</span><span class="op" id="8391452">(</span><span class="string" id="8391453">&#34;unixgram&#34;</span><span class="op" id="8391463">,</span>&nbsp;<span class="ident" id="8391465">la</span><span class="op" id="8391467">,</span>&nbsp;<span class="ident" id="8391469">ta</span><span class="op" id="8391471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391475">if</span>&nbsp;<span class="ident" id="8391478">err</span>&nbsp;<span class="op" id="8391482">!=</span>&nbsp;<span class="ident" id="8391485">nil</span>&nbsp;<span class="op" id="8391489">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391494">t</span><span class="op" id="8391495">.</span><span class="ident" id="8391496">Fatalf</span><span class="op" id="8391502">(</span><span class="string" id="8391503">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8391524">,</span>&nbsp;<span class="ident" id="8391526">err</span><span class="op" id="8391529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391537">defer</span>&nbsp;<span class="keyword" id="8391543">func</span><span class="op" id="8391547">(</span><span class="op" id="8391548">)</span>&nbsp;<span class="op" id="8391550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391555">c2</span><span class="op" id="8391557">.</span><span class="ident" id="8391558">Close</span><span class="op" id="8391563">(</span><span class="op" id="8391564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391569">if</span>&nbsp;<span class="ident" id="8391572">la</span>&nbsp;<span class="op" id="8391575">!=</span>&nbsp;<span class="ident" id="8391578">nil</span>&nbsp;<span class="op" id="8391582">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391588">defer</span>&nbsp;<span class="ident" id="8391594">os</span><span class="op" id="8391596">.</span><span class="ident" id="8391597">Remove</span><span class="op" id="8391603">(</span><span class="ident" id="8391604">laddr</span><span class="op" id="8391609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391618">}</span><span class="op" id="8391619">(</span><span class="op" id="8391620">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391625">switch</span>&nbsp;<span class="ident" id="8391632">runtime</span><span class="op" id="8391639">.</span><span class="ident" id="8391640">GOOS</span>&nbsp;<span class="op" id="8391645">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391649">case</span>&nbsp;<span class="string" id="8391654">&#34;android&#34;</span><span class="op" id="8391663">,</span>&nbsp;<span class="string" id="8391665">&#34;linux&#34;</span><span class="op" id="8391672">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391677">if</span>&nbsp;<span class="ident" id="8391680">laddr</span>&nbsp;<span class="op" id="8391686">==</span>&nbsp;<span class="string" id="8391689">&#34;&#34;</span>&nbsp;<span class="op" id="8391692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391698">laddr</span>&nbsp;<span class="op" id="8391704">=</span>&nbsp;<span class="string" id="8391706">&#34;@&#34;</span>&nbsp;<span class="comment" id="8391710">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391737">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391742">var</span>&nbsp;<span class="ident" id="8391746">connAddrs</span>&nbsp;<span class="op" id="8391756">=</span>&nbsp;<span class="op" id="8391758">[</span><span class="num" id="8391759">4</span><span class="op" id="8391760">]</span><span class="keyword" id="8391761">struct</span><span class="op" id="8391767">{</span>&nbsp;<span class="ident" id="8391769">got</span><span class="op" id="8391772">,</span>&nbsp;<span class="ident" id="8391774">want</span>&nbsp;<span class="ident" id="8391779">Addr</span>&nbsp;<span class="op" id="8391784">}</span><span class="op" id="8391785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391790">{</span><span class="ident" id="8391791">c1</span><span class="op" id="8391793">.</span><span class="ident" id="8391794">LocalAddr</span><span class="op" id="8391803">(</span><span class="op" id="8391804">)</span><span class="op" id="8391805">,</span>&nbsp;<span class="ident" id="8391807">ta</span><span class="op" id="8391809">}</span><span class="op" id="8391810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391815">{</span><span class="ident" id="8391816">c1</span><span class="op" id="8391818">.</span><span class="ident" id="8391819">RemoteAddr</span><span class="op" id="8391829">(</span><span class="op" id="8391830">)</span><span class="op" id="8391831">,</span>&nbsp;<span class="ident" id="8391833">nil</span><span class="op" id="8391836">}</span><span class="op" id="8391837">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391842">{</span><span class="ident" id="8391843">c2</span><span class="op" id="8391845">.</span><span class="ident" id="8391846">LocalAddr</span><span class="op" id="8391855">(</span><span class="op" id="8391856">)</span><span class="op" id="8391857">,</span>&nbsp;<span class="op" id="8391859">&amp;</span><span class="ident" id="8391860">UnixAddr</span><span class="op" id="8391868">{</span><span class="ident" id="8391869">Name</span><span class="op" id="8391873">:</span>&nbsp;<span class="ident" id="8391875">laddr</span><span class="op" id="8391880">,</span>&nbsp;<span class="ident" id="8391882">Net</span><span class="op" id="8391885">:</span>&nbsp;<span class="string" id="8391887">&#34;unixgram&#34;</span><span class="op" id="8391897">}</span><span class="op" id="8391898">}</span><span class="op" id="8391899">,</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391904">{</span><span class="ident" id="8391905">c2</span><span class="op" id="8391907">.</span><span class="ident" id="8391908">RemoteAddr</span><span class="op" id="8391918">(</span><span class="op" id="8391919">)</span><span class="op" id="8391920">,</span>&nbsp;<span class="ident" id="8391922">ta</span><span class="op" id="8391924">}</span><span class="op" id="8391925">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391933">for</span>&nbsp;<span class="ident" id="8391937">_</span><span class="op" id="8391938">,</span>&nbsp;<span class="ident" id="8391940">ca</span>&nbsp;<span class="op" id="8391943">:=</span>&nbsp;<span class="keyword" id="8391946">range</span>&nbsp;<span class="ident" id="8391952">connAddrs</span>&nbsp;<span class="op" id="8391962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391967">if</span>&nbsp;<span class="op" id="8391970">!</span><span class="ident" id="8391971">reflect</span><span class="op" id="8391978">.</span><span class="ident" id="8391979">DeepEqual</span><span class="op" id="8391988">(</span><span class="ident" id="8391989">ca</span><span class="op" id="8391991">.</span><span class="ident" id="8391992">got</span><span class="op" id="8391995">,</span>&nbsp;<span class="ident" id="8391997">ca</span><span class="op" id="8391999">.</span><span class="ident" id="8392000">want</span><span class="op" id="8392004">)</span>&nbsp;<span class="op" id="8392006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392012">t</span><span class="op" id="8392013">.</span><span class="ident" id="8392014">Fatalf</span><span class="op" id="8392020">(</span><span class="string" id="8392021">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="8392044">,</span>&nbsp;<span class="ident" id="8392046">ca</span><span class="op" id="8392048">.</span><span class="ident" id="8392049">got</span><span class="op" id="8392052">,</span>&nbsp;<span class="ident" id="8392054">ca</span><span class="op" id="8392056">.</span><span class="ident" id="8392057">want</span><span class="op" id="8392061">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8392066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8392070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8392073">}</span><br>
<span class="lineno"></span><span class="op" id="8392075">}</span>
</div>
</body>
</html>
