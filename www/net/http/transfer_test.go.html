<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8042476">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8042531">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8042585">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8042636">package</span>&nbsp;<span class="ident" id="8042644">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8042650">import</span>&nbsp;<span class="op" id="8042657">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8042660">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8042669">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8042675">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8042686">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8042696">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8042699">func</span>&nbsp;<span class="ident" id="8042704">TestBodyReadBadTrailer</span><span class="op" id="8042726">(</span><span class="ident" id="8042727">t</span>&nbsp;<span class="op" id="8042729">*</span><span class="ident" id="8042730">testing</span><span class="op" id="8042737">.</span><span class="ident" id="8042738">T</span><span class="op" id="8042739">)</span>&nbsp;<span class="op" id="8042741">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8042744">b</span>&nbsp;<span class="op" id="8042746">:=</span>&nbsp;<span class="op" id="8042749">&amp;</span><span class="ident" id="8042750">body</span><span class="op" id="8042754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8042758">src</span><span class="op" id="8042761">:</span>&nbsp;<span class="ident" id="8042763">strings</span><span class="op" id="8042770">.</span><span class="ident" id="8042771">NewReader</span><span class="op" id="8042780">(</span><span class="string" id="8042781">&#34;foobar&#34;</span><span class="op" id="8042789">)</span><span class="op" id="8042790">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8042794">hdr</span><span class="op" id="8042797">:</span>&nbsp;<span class="ident" id="8042799">true</span><span class="op" id="8042803">,</span>&nbsp;<span class="comment" id="8042805">//&nbsp;force&nbsp;reading&nbsp;the&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8042836">r</span><span class="op" id="8042837">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8042841">bufio</span><span class="op" id="8042846">.</span><span class="ident" id="8042847">NewReader</span><span class="op" id="8042856">(</span><span class="ident" id="8042857">strings</span><span class="op" id="8042864">.</span><span class="ident" id="8042865">NewReader</span><span class="op" id="8042874">(</span><span class="string" id="8042875">&#34;&#34;</span><span class="op" id="8042877">)</span><span class="op" id="8042878">)</span><span class="op" id="8042879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8042882">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8042885">buf</span>&nbsp;<span class="op" id="8042889">:=</span>&nbsp;<span class="builtinfunc" id="8042892">make</span><span class="op" id="8042896">(</span><span class="op" id="8042897">[</span><span class="op" id="8042898">]</span><span class="builtintype" id="8042899">byte</span><span class="op" id="8042903">,</span>&nbsp;<span class="num" id="8042905">7</span><span class="op" id="8042906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8042909">n</span><span class="op" id="8042910">,</span>&nbsp;<span class="ident" id="8042912">err</span>&nbsp;<span class="op" id="8042916">:=</span>&nbsp;<span class="ident" id="8042919">b</span><span class="op" id="8042920">.</span><span class="ident" id="8042921">Read</span><span class="op" id="8042925">(</span><span class="ident" id="8042926">buf</span><span class="op" id="8042929">[</span><span class="op" id="8042930">:</span><span class="num" id="8042931">3</span><span class="op" id="8042932">]</span><span class="op" id="8042933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8042936">got</span>&nbsp;<span class="op" id="8042940">:=</span>&nbsp;<span class="builtintype" id="8042943">string</span><span class="op" id="8042949">(</span><span class="ident" id="8042950">buf</span><span class="op" id="8042953">[</span><span class="op" id="8042954">:</span><span class="ident" id="8042955">n</span><span class="op" id="8042956">]</span><span class="op" id="8042957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8042960">if</span>&nbsp;<span class="ident" id="8042963">got</span>&nbsp;<span class="op" id="8042967">!=</span>&nbsp;<span class="string" id="8042970">&#34;foo&#34;</span>&nbsp;<span class="op" id="8042976">||</span>&nbsp;<span class="ident" id="8042979">err</span>&nbsp;<span class="op" id="8042983">!=</span>&nbsp;<span class="ident" id="8042986">nil</span>&nbsp;<span class="op" id="8042990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8042994">t</span><span class="op" id="8042995">.</span><span class="ident" id="8042996">Fatalf</span><span class="op" id="8043002">(</span><span class="string" id="8043003">`first&nbsp;Read&nbsp;=&nbsp;%d&nbsp;(%q),&nbsp;%v;&nbsp;want&nbsp;3&nbsp;(&#34;foo&#34;)`</span><span class="op" id="8043045">,</span>&nbsp;<span class="ident" id="8043047">n</span><span class="op" id="8043048">,</span>&nbsp;<span class="ident" id="8043050">got</span><span class="op" id="8043053">,</span>&nbsp;<span class="ident" id="8043055">err</span><span class="op" id="8043058">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8043061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043065">n</span><span class="op" id="8043066">,</span>&nbsp;<span class="ident" id="8043068">err</span>&nbsp;<span class="op" id="8043072">=</span>&nbsp;<span class="ident" id="8043074">b</span><span class="op" id="8043075">.</span><span class="ident" id="8043076">Read</span><span class="op" id="8043080">(</span><span class="ident" id="8043081">buf</span><span class="op" id="8043084">[</span><span class="op" id="8043085">:</span><span class="op" id="8043086">]</span><span class="op" id="8043087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043090">got</span>&nbsp;<span class="op" id="8043094">=</span>&nbsp;<span class="builtintype" id="8043096">string</span><span class="op" id="8043102">(</span><span class="ident" id="8043103">buf</span><span class="op" id="8043106">[</span><span class="op" id="8043107">:</span><span class="ident" id="8043108">n</span><span class="op" id="8043109">]</span><span class="op" id="8043110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8043113">if</span>&nbsp;<span class="ident" id="8043116">got</span>&nbsp;<span class="op" id="8043120">!=</span>&nbsp;<span class="string" id="8043123">&#34;bar&#34;</span>&nbsp;<span class="op" id="8043129">||</span>&nbsp;<span class="ident" id="8043132">err</span>&nbsp;<span class="op" id="8043136">!=</span>&nbsp;<span class="ident" id="8043139">nil</span>&nbsp;<span class="op" id="8043143">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043147">t</span><span class="op" id="8043148">.</span><span class="ident" id="8043149">Fatalf</span><span class="op" id="8043155">(</span><span class="string" id="8043156">`second&nbsp;Read&nbsp;=&nbsp;%d&nbsp;(%q),&nbsp;%v;&nbsp;want&nbsp;3&nbsp;(&#34;bar&#34;)`</span><span class="op" id="8043199">,</span>&nbsp;<span class="ident" id="8043201">n</span><span class="op" id="8043202">,</span>&nbsp;<span class="ident" id="8043204">got</span><span class="op" id="8043207">,</span>&nbsp;<span class="ident" id="8043209">err</span><span class="op" id="8043212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8043215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043219">n</span><span class="op" id="8043220">,</span>&nbsp;<span class="ident" id="8043222">err</span>&nbsp;<span class="op" id="8043226">=</span>&nbsp;<span class="ident" id="8043228">b</span><span class="op" id="8043229">.</span><span class="ident" id="8043230">Read</span><span class="op" id="8043234">(</span><span class="ident" id="8043235">buf</span><span class="op" id="8043238">[</span><span class="op" id="8043239">:</span><span class="op" id="8043240">]</span><span class="op" id="8043241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043244">got</span>&nbsp;<span class="op" id="8043248">=</span>&nbsp;<span class="builtintype" id="8043250">string</span><span class="op" id="8043256">(</span><span class="ident" id="8043257">buf</span><span class="op" id="8043260">[</span><span class="op" id="8043261">:</span><span class="ident" id="8043262">n</span><span class="op" id="8043263">]</span><span class="op" id="8043264">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8043267">if</span>&nbsp;<span class="ident" id="8043270">err</span>&nbsp;<span class="op" id="8043274">==</span>&nbsp;<span class="ident" id="8043277">nil</span>&nbsp;<span class="op" id="8043281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043285">t</span><span class="op" id="8043286">.</span><span class="ident" id="8043287">Errorf</span><span class="op" id="8043293">(</span><span class="string" id="8043294">&#34;final&nbsp;Read&nbsp;was&nbsp;successful&nbsp;(%q),&nbsp;expected&nbsp;error&nbsp;from&nbsp;trailer&nbsp;read&#34;</span><span class="op" id="8043360">,</span>&nbsp;<span class="ident" id="8043362">got</span><span class="op" id="8043365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8043368">}</span><br>
<span class="lineno"></span><span class="op" id="8043370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="8043373">func</span>&nbsp;<span class="ident" id="8043378">TestFinalChunkedBodyReadEOF</span><span class="op" id="8043405">(</span><span class="ident" id="8043406">t</span>&nbsp;<span class="op" id="8043408">*</span><span class="ident" id="8043409">testing</span><span class="op" id="8043416">.</span><span class="ident" id="8043417">T</span><span class="op" id="8043418">)</span>&nbsp;<span class="op" id="8043420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043423">res</span><span class="op" id="8043426">,</span>&nbsp;<span class="ident" id="8043428">err</span>&nbsp;<span class="op" id="8043432">:=</span>&nbsp;<span class="ident" id="8043435">ReadResponse</span><span class="op" id="8043447">(</span><span class="ident" id="8043448">bufio</span><span class="op" id="8043453">.</span><span class="ident" id="8043454">NewReader</span><span class="op" id="8043463">(</span><span class="ident" id="8043464">strings</span><span class="op" id="8043471">.</span><span class="ident" id="8043472">NewReader</span><span class="op" id="8043481">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8043485">&#34;HTTP/1.1&nbsp;200&nbsp;OK\r\n&#34;</span><span class="op" id="8043506">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8043511">&#34;Transfer-Encoding:&nbsp;chunked\r\n&#34;</span><span class="op" id="8043543">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8043548">&#34;\r\n&#34;</span><span class="op" id="8043554">+</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8043559">&#34;0a\r\n&#34;</span><span class="op" id="8043567">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8043572">&#34;Body&nbsp;here\n\r\n&#34;</span><span class="op" id="8043589">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8043594">&#34;09\r\n&#34;</span><span class="op" id="8043602">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8043607">&#34;continued\r\n&#34;</span><span class="op" id="8043622">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8043627">&#34;0\r\n&#34;</span><span class="op" id="8043634">+</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8043639">&#34;\r\n&#34;</span><span class="op" id="8043645">)</span><span class="op" id="8043646">)</span><span class="op" id="8043647">,</span>&nbsp;<span class="ident" id="8043649">nil</span><span class="op" id="8043652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8043655">if</span>&nbsp;<span class="ident" id="8043658">err</span>&nbsp;<span class="op" id="8043662">!=</span>&nbsp;<span class="ident" id="8043665">nil</span>&nbsp;<span class="op" id="8043669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043673">t</span><span class="op" id="8043674">.</span><span class="ident" id="8043675">Fatal</span><span class="op" id="8043680">(</span><span class="ident" id="8043681">err</span><span class="op" id="8043684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8043687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043690">want</span>&nbsp;<span class="op" id="8043695">:=</span>&nbsp;<span class="string" id="8043698">&#34;Body&nbsp;here\ncontinued&#34;</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043722">buf</span>&nbsp;<span class="op" id="8043726">:=</span>&nbsp;<span class="builtinfunc" id="8043729">make</span><span class="op" id="8043733">(</span><span class="op" id="8043734">[</span><span class="op" id="8043735">]</span><span class="builtintype" id="8043736">byte</span><span class="op" id="8043740">,</span>&nbsp;<span class="builtinfunc" id="8043742">len</span><span class="op" id="8043745">(</span><span class="ident" id="8043746">want</span><span class="op" id="8043750">)</span><span class="op" id="8043751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043754">n</span><span class="op" id="8043755">,</span>&nbsp;<span class="ident" id="8043757">err</span>&nbsp;<span class="op" id="8043761">:=</span>&nbsp;<span class="ident" id="8043764">res</span><span class="op" id="8043767">.</span><span class="ident" id="8043768">Body</span><span class="op" id="8043772">.</span><span class="ident" id="8043773">Read</span><span class="op" id="8043777">(</span><span class="ident" id="8043778">buf</span><span class="op" id="8043781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8043784">if</span>&nbsp;<span class="ident" id="8043787">n</span>&nbsp;<span class="op" id="8043789">!=</span>&nbsp;<span class="builtinfunc" id="8043792">len</span><span class="op" id="8043795">(</span><span class="ident" id="8043796">want</span><span class="op" id="8043800">)</span>&nbsp;<span class="op" id="8043802">||</span>&nbsp;<span class="ident" id="8043805">err</span>&nbsp;<span class="op" id="8043809">!=</span>&nbsp;<span class="ident" id="8043812">io</span><span class="op" id="8043814">.</span><span class="ident" id="8043815">EOF</span>&nbsp;<span class="op" id="8043819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043823">t</span><span class="op" id="8043824">.</span><span class="ident" id="8043825">Logf</span><span class="op" id="8043829">(</span><span class="string" id="8043830">&#34;body&nbsp;=&nbsp;%#v&#34;</span><span class="op" id="8043842">,</span>&nbsp;<span class="ident" id="8043844">res</span><span class="op" id="8043847">.</span><span class="ident" id="8043848">Body</span><span class="op" id="8043852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043856">t</span><span class="op" id="8043857">.</span><span class="ident" id="8043858">Errorf</span><span class="op" id="8043864">(</span><span class="string" id="8043865">&#34;Read&nbsp;=&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;EOF&#34;</span><span class="op" id="8043894">,</span>&nbsp;<span class="ident" id="8043896">n</span><span class="op" id="8043897">,</span>&nbsp;<span class="ident" id="8043899">err</span><span class="op" id="8043902">,</span>&nbsp;<span class="builtinfunc" id="8043904">len</span><span class="op" id="8043907">(</span><span class="ident" id="8043908">want</span><span class="op" id="8043912">)</span><span class="op" id="8043913">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8043916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8043919">if</span>&nbsp;<span class="builtintype" id="8043922">string</span><span class="op" id="8043928">(</span><span class="ident" id="8043929">buf</span><span class="op" id="8043932">)</span>&nbsp;<span class="op" id="8043934">!=</span>&nbsp;<span class="ident" id="8043937">want</span>&nbsp;<span class="op" id="8043942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8043946">t</span><span class="op" id="8043947">.</span><span class="ident" id="8043948">Errorf</span><span class="op" id="8043954">(</span><span class="string" id="8043955">&#34;buf&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8043974">,</span>&nbsp;<span class="ident" id="8043976">buf</span><span class="op" id="8043979">,</span>&nbsp;<span class="ident" id="8043981">want</span><span class="op" id="8043985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8043988">}</span><br>
<span class="lineno"></span><span class="op" id="8043990">}</span>
</div>
</body>
</html>
