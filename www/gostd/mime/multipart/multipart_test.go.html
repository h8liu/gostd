<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7513351">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7513406">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7513460">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7513511">package</span>&nbsp;<span class="ident" id="7513519">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7513530">import</span>&nbsp;<span class="op" id="7513537">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7513540">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7513549">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7513566">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7513573">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7513579">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7513592">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7513609">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7513615">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7513626">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7513637">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7513647">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7513650">func</span>&nbsp;<span class="ident" id="7513655">TestBoundaryLine</span><span class="op" id="7513671">(</span><span class="ident" id="7513672">t</span>&nbsp;<span class="op" id="7513674">*</span><span class="ident" id="7513675">testing</span><span class="op" id="7513682">.</span><span class="ident" id="7513683">T</span><span class="op" id="7513684">)</span>&nbsp;<span class="op" id="7513686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513689">mr</span>&nbsp;<span class="op" id="7513692">:=</span>&nbsp;<span class="ident" id="7513695">NewReader</span><span class="op" id="7513704">(</span><span class="ident" id="7513705">strings</span><span class="op" id="7513712">.</span><span class="ident" id="7513713">NewReader</span><span class="op" id="7513722">(</span><span class="string" id="7513723">&#34;&#34;</span><span class="op" id="7513725">)</span><span class="op" id="7513726">,</span>&nbsp;<span class="string" id="7513728">&#34;myBoundary&#34;</span><span class="op" id="7513740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7513743">if</span>&nbsp;<span class="op" id="7513746">!</span><span class="ident" id="7513747">mr</span><span class="op" id="7513749">.</span><span class="ident" id="7513750">isBoundaryDelimiterLine</span><span class="op" id="7513773">(</span><span class="op" id="7513774">[</span><span class="op" id="7513775">]</span><span class="builtintype" id="7513776">byte</span><span class="op" id="7513780">(</span><span class="string" id="7513781">&#34;--myBoundary\r\n&#34;</span><span class="op" id="7513799">)</span><span class="op" id="7513800">)</span>&nbsp;<span class="op" id="7513802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513806">t</span><span class="op" id="7513807">.</span><span class="ident" id="7513808">Error</span><span class="op" id="7513813">(</span><span class="string" id="7513814">&#34;expected&#34;</span><span class="op" id="7513824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7513827">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7513830">if</span>&nbsp;<span class="op" id="7513833">!</span><span class="ident" id="7513834">mr</span><span class="op" id="7513836">.</span><span class="ident" id="7513837">isBoundaryDelimiterLine</span><span class="op" id="7513860">(</span><span class="op" id="7513861">[</span><span class="op" id="7513862">]</span><span class="builtintype" id="7513863">byte</span><span class="op" id="7513867">(</span><span class="string" id="7513868">&#34;--myBoundary&nbsp;\r\n&#34;</span><span class="op" id="7513887">)</span><span class="op" id="7513888">)</span>&nbsp;<span class="op" id="7513890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513894">t</span><span class="op" id="7513895">.</span><span class="ident" id="7513896">Error</span><span class="op" id="7513901">(</span><span class="string" id="7513902">&#34;expected&#34;</span><span class="op" id="7513912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7513915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7513918">if</span>&nbsp;<span class="op" id="7513921">!</span><span class="ident" id="7513922">mr</span><span class="op" id="7513924">.</span><span class="ident" id="7513925">isBoundaryDelimiterLine</span><span class="op" id="7513948">(</span><span class="op" id="7513949">[</span><span class="op" id="7513950">]</span><span class="builtintype" id="7513951">byte</span><span class="op" id="7513955">(</span><span class="string" id="7513956">&#34;--myBoundary&nbsp;\n&#34;</span><span class="op" id="7513973">)</span><span class="op" id="7513974">)</span>&nbsp;<span class="op" id="7513976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513980">t</span><span class="op" id="7513981">.</span><span class="ident" id="7513982">Error</span><span class="op" id="7513987">(</span><span class="string" id="7513988">&#34;expected&#34;</span><span class="op" id="7513998">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7514004">if</span>&nbsp;<span class="ident" id="7514007">mr</span><span class="op" id="7514009">.</span><span class="ident" id="7514010">isBoundaryDelimiterLine</span><span class="op" id="7514033">(</span><span class="op" id="7514034">[</span><span class="op" id="7514035">]</span><span class="builtintype" id="7514036">byte</span><span class="op" id="7514040">(</span><span class="string" id="7514041">&#34;--myBoundary&nbsp;bogus&nbsp;\n&#34;</span><span class="op" id="7514064">)</span><span class="op" id="7514065">)</span>&nbsp;<span class="op" id="7514067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514071">t</span><span class="op" id="7514072">.</span><span class="ident" id="7514073">Error</span><span class="op" id="7514078">(</span><span class="string" id="7514079">&#34;expected&nbsp;fail&#34;</span><span class="op" id="7514094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7514100">if</span>&nbsp;<span class="ident" id="7514103">mr</span><span class="op" id="7514105">.</span><span class="ident" id="7514106">isBoundaryDelimiterLine</span><span class="op" id="7514129">(</span><span class="op" id="7514130">[</span><span class="op" id="7514131">]</span><span class="builtintype" id="7514132">byte</span><span class="op" id="7514136">(</span><span class="string" id="7514137">&#34;--myBoundary&nbsp;bogus--&#34;</span><span class="op" id="7514159">)</span><span class="op" id="7514160">)</span>&nbsp;<span class="op" id="7514162">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514166">t</span><span class="op" id="7514167">.</span><span class="ident" id="7514168">Error</span><span class="op" id="7514173">(</span><span class="string" id="7514174">&#34;expected&nbsp;fail&#34;</span><span class="op" id="7514189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514192">}</span><br>
<span class="lineno"></span><span class="op" id="7514194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7514197">func</span>&nbsp;<span class="ident" id="7514202">escapeString</span><span class="op" id="7514214">(</span><span class="ident" id="7514215">v</span>&nbsp;<span class="builtintype" id="7514217">string</span><span class="op" id="7514223">)</span>&nbsp;<span class="builtintype" id="7514225">string</span>&nbsp;<span class="op" id="7514232">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514235">bytes</span><span class="op" id="7514240">,</span>&nbsp;<span class="ident" id="7514242">_</span>&nbsp;<span class="op" id="7514244">:=</span>&nbsp;<span class="ident" id="7514247">json</span><span class="op" id="7514251">.</span><span class="ident" id="7514252">Marshal</span><span class="op" id="7514259">(</span><span class="ident" id="7514260">v</span><span class="op" id="7514261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7514264">return</span>&nbsp;<span class="builtintype" id="7514271">string</span><span class="op" id="7514277">(</span><span class="ident" id="7514278">bytes</span><span class="op" id="7514283">)</span><br>
<span class="lineno"></span><span class="op" id="7514285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7514288">func</span>&nbsp;<span class="ident" id="7514293">expectEq</span><span class="op" id="7514301">(</span><span class="ident" id="7514302">t</span>&nbsp;<span class="op" id="7514304">*</span><span class="ident" id="7514305">testing</span><span class="op" id="7514312">.</span><span class="ident" id="7514313">T</span><span class="op" id="7514314">,</span>&nbsp;<span class="ident" id="7514316">expected</span><span class="op" id="7514324">,</span>&nbsp;<span class="ident" id="7514326">actual</span><span class="op" id="7514332">,</span>&nbsp;<span class="ident" id="7514334">what</span>&nbsp;<span class="builtintype" id="7514339">string</span><span class="op" id="7514345">)</span>&nbsp;<span class="op" id="7514347">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7514350">if</span>&nbsp;<span class="ident" id="7514353">expected</span>&nbsp;<span class="op" id="7514362">==</span>&nbsp;<span class="ident" id="7514365">actual</span>&nbsp;<span class="op" id="7514372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7514376">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514387">t</span><span class="op" id="7514388">.</span><span class="ident" id="7514389">Errorf</span><span class="op" id="7514395">(</span><span class="string" id="7514396">&#34;Unexpected&nbsp;value&nbsp;for&nbsp;%s;&nbsp;got&nbsp;%s&nbsp;(len&nbsp;%d)&nbsp;but&nbsp;expected:&nbsp;%s&nbsp;(len&nbsp;%d)&#34;</span><span class="op" id="7514464">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514468">what</span><span class="op" id="7514472">,</span>&nbsp;<span class="ident" id="7514474">escapeString</span><span class="op" id="7514486">(</span><span class="ident" id="7514487">actual</span><span class="op" id="7514493">)</span><span class="op" id="7514494">,</span>&nbsp;<span class="builtinfunc" id="7514496">len</span><span class="op" id="7514499">(</span><span class="ident" id="7514500">actual</span><span class="op" id="7514506">)</span><span class="op" id="7514507">,</span>&nbsp;<span class="ident" id="7514509">escapeString</span><span class="op" id="7514521">(</span><span class="ident" id="7514522">expected</span><span class="op" id="7514530">)</span><span class="op" id="7514531">,</span>&nbsp;<span class="builtinfunc" id="7514533">len</span><span class="op" id="7514536">(</span><span class="ident" id="7514537">expected</span><span class="op" id="7514545">)</span><span class="op" id="7514546">)</span><br>
<span class="lineno">50</span><span class="op" id="7514548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7514551">func</span>&nbsp;<span class="ident" id="7514556">TestNameAccessors</span><span class="op" id="7514573">(</span><span class="ident" id="7514574">t</span>&nbsp;<span class="op" id="7514576">*</span><span class="ident" id="7514577">testing</span><span class="op" id="7514584">.</span><span class="ident" id="7514585">T</span><span class="op" id="7514586">)</span>&nbsp;<span class="op" id="7514588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7514591">tests</span>&nbsp;<span class="op" id="7514597">:=</span>&nbsp;<span class="op" id="7514600">[</span><span class="op" id="7514601">...</span><span class="op" id="7514604">]</span><span class="op" id="7514605">[</span><span class="num" id="7514606">3</span><span class="op" id="7514607">]</span><span class="builtintype" id="7514608">string</span><span class="op" id="7514614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514618">{</span><span class="string" id="7514619">`form-data;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="7514642">,</span>&nbsp;<span class="string" id="7514644">&#34;foo&#34;</span><span class="op" id="7514649">,</span>&nbsp;<span class="string" id="7514651">&#34;&#34;</span><span class="op" id="7514653">}</span><span class="op" id="7514654">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514658">{</span><span class="string" id="7514659">`&nbsp;form-data&nbsp;;&nbsp;name=foo`</span><span class="op" id="7514682">,</span>&nbsp;<span class="string" id="7514684">&#34;foo&#34;</span><span class="op" id="7514689">,</span>&nbsp;<span class="string" id="7514691">&#34;&#34;</span><span class="op" id="7514693">}</span><span class="op" id="7514694">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514698">{</span><span class="string" id="7514699">`FORM-DATA;name=&#34;foo&#34;`</span><span class="op" id="7514721">,</span>&nbsp;<span class="string" id="7514723">&#34;foo&#34;</span><span class="op" id="7514728">,</span>&nbsp;<span class="string" id="7514730">&#34;&#34;</span><span class="op" id="7514732">}</span><span class="op" id="7514733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514737">{</span><span class="string" id="7514738">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="7514763">,</span>&nbsp;<span class="string" id="7514765">&#34;foo&#34;</span><span class="op" id="7514770">,</span>&nbsp;<span class="string" id="7514772">&#34;&#34;</span><span class="op" id="7514774">}</span><span class="op" id="7514775">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514779">{</span><span class="string" id="7514780">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="7514805">,</span>&nbsp;<span class="string" id="7514807">&#34;foo&#34;</span><span class="op" id="7514812">,</span>&nbsp;<span class="string" id="7514814">&#34;&#34;</span><span class="op" id="7514816">}</span><span class="op" id="7514817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514821">{</span><span class="string" id="7514822">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=foo`</span><span class="op" id="7514845">,</span>&nbsp;<span class="string" id="7514847">&#34;foo&#34;</span><span class="op" id="7514852">,</span>&nbsp;<span class="string" id="7514854">&#34;&#34;</span><span class="op" id="7514856">}</span><span class="op" id="7514857">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514861">{</span><span class="string" id="7514862">`&nbsp;FORM-DATA&nbsp;;&nbsp;filename=&#34;foo.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="7514915">,</span>&nbsp;<span class="string" id="7514917">&#34;foo&#34;</span><span class="op" id="7514922">,</span>&nbsp;<span class="string" id="7514924">&#34;foo.txt&#34;</span><span class="op" id="7514933">}</span><span class="op" id="7514934">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7514938">{</span><span class="string" id="7514939">`&nbsp;not-form-data&nbsp;;&nbsp;filename=&#34;bar.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="7514996">,</span>&nbsp;<span class="string" id="7514998">&#34;&#34;</span><span class="op" id="7515000">,</span>&nbsp;<span class="string" id="7515002">&#34;bar.txt&#34;</span><span class="op" id="7515011">}</span><span class="op" id="7515012">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7515015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7515018">for</span>&nbsp;<span class="ident" id="7515022">i</span><span class="op" id="7515023">,</span>&nbsp;<span class="ident" id="7515025">test</span>&nbsp;<span class="op" id="7515030">:=</span>&nbsp;<span class="keyword" id="7515033">range</span>&nbsp;<span class="ident" id="7515039">tests</span>&nbsp;<span class="op" id="7515045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515049">p</span>&nbsp;<span class="op" id="7515051">:=</span>&nbsp;<span class="op" id="7515054">&amp;</span><span class="ident" id="7515055">Part</span><span class="op" id="7515059">{</span><span class="ident" id="7515060">Header</span><span class="op" id="7515066">:</span>&nbsp;<span class="builtinfunc" id="7515068">make</span><span class="op" id="7515072">(</span><span class="keyword" id="7515073">map</span><span class="op" id="7515076">[</span><span class="builtintype" id="7515077">string</span><span class="op" id="7515083">]</span><span class="op" id="7515084">[</span><span class="op" id="7515085">]</span><span class="builtintype" id="7515086">string</span><span class="op" id="7515092">)</span><span class="op" id="7515093">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515097">p</span><span class="op" id="7515098">.</span><span class="ident" id="7515099">Header</span><span class="op" id="7515105">.</span><span class="ident" id="7515106">Set</span><span class="op" id="7515109">(</span><span class="string" id="7515110">&#34;Content-Disposition&#34;</span><span class="op" id="7515131">,</span>&nbsp;<span class="ident" id="7515133">test</span><span class="op" id="7515137">[</span><span class="num" id="7515138">0</span><span class="op" id="7515139">]</span><span class="op" id="7515140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7515144">if</span>&nbsp;<span class="ident" id="7515147">g</span><span class="op" id="7515148">,</span>&nbsp;<span class="ident" id="7515150">e</span>&nbsp;<span class="op" id="7515152">:=</span>&nbsp;<span class="ident" id="7515155">p</span><span class="op" id="7515156">.</span><span class="ident" id="7515157">FormName</span><span class="op" id="7515165">(</span><span class="op" id="7515166">)</span><span class="op" id="7515167">,</span>&nbsp;<span class="ident" id="7515169">test</span><span class="op" id="7515173">[</span><span class="num" id="7515174">1</span><span class="op" id="7515175">]</span><span class="op" id="7515176">;</span>&nbsp;<span class="ident" id="7515178">g</span>&nbsp;<span class="op" id="7515180">!=</span>&nbsp;<span class="ident" id="7515183">e</span>&nbsp;<span class="op" id="7515185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515190">t</span><span class="op" id="7515191">.</span><span class="ident" id="7515192">Errorf</span><span class="op" id="7515198">(</span><span class="string" id="7515199">&#34;test&nbsp;%d:&nbsp;FormName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7515234">,</span>&nbsp;<span class="ident" id="7515236">i</span><span class="op" id="7515237">,</span>&nbsp;<span class="ident" id="7515239">g</span><span class="op" id="7515240">,</span>&nbsp;<span class="ident" id="7515242">e</span><span class="op" id="7515243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7515247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7515251">if</span>&nbsp;<span class="ident" id="7515254">g</span><span class="op" id="7515255">,</span>&nbsp;<span class="ident" id="7515257">e</span>&nbsp;<span class="op" id="7515259">:=</span>&nbsp;<span class="ident" id="7515262">p</span><span class="op" id="7515263">.</span><span class="ident" id="7515264">FileName</span><span class="op" id="7515272">(</span><span class="op" id="7515273">)</span><span class="op" id="7515274">,</span>&nbsp;<span class="ident" id="7515276">test</span><span class="op" id="7515280">[</span><span class="num" id="7515281">2</span><span class="op" id="7515282">]</span><span class="op" id="7515283">;</span>&nbsp;<span class="ident" id="7515285">g</span>&nbsp;<span class="op" id="7515287">!=</span>&nbsp;<span class="ident" id="7515290">e</span>&nbsp;<span class="op" id="7515292">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515297">t</span><span class="op" id="7515298">.</span><span class="ident" id="7515299">Errorf</span><span class="op" id="7515305">(</span><span class="string" id="7515306">&#34;test&nbsp;%d:&nbsp;FileName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7515341">,</span>&nbsp;<span class="ident" id="7515343">i</span><span class="op" id="7515344">,</span>&nbsp;<span class="ident" id="7515346">g</span><span class="op" id="7515347">,</span>&nbsp;<span class="ident" id="7515349">e</span><span class="op" id="7515350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7515354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7515357">}</span><br>
<span class="lineno"></span><span class="op" id="7515359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="7515362">var</span>&nbsp;<span class="ident" id="7515366">longLine</span>&nbsp;<span class="op" id="7515375">=</span>&nbsp;<span class="ident" id="7515377">strings</span><span class="op" id="7515384">.</span><span class="ident" id="7515385">Repeat</span><span class="op" id="7515391">(</span><span class="string" id="7515392">&#34;\n\n\r\r\r\n\r\000&#34;</span><span class="op" id="7515412">,</span>&nbsp;<span class="op" id="7515414">(</span><span class="num" id="7515415">1</span><span class="op" id="7515416">&lt;&lt;</span><span class="num" id="7515418">20</span><span class="op" id="7515420">)</span><span class="op" id="7515421">/</span><span class="num" id="7515422">8</span><span class="op" id="7515423">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7515426">func</span>&nbsp;<span class="ident" id="7515431">testMultipartBody</span><span class="op" id="7515448">(</span><span class="ident" id="7515449">sep</span>&nbsp;<span class="builtintype" id="7515453">string</span><span class="op" id="7515459">)</span>&nbsp;<span class="builtintype" id="7515461">string</span>&nbsp;<span class="op" id="7515468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515471">testBody</span>&nbsp;<span class="op" id="7515480">:=</span>&nbsp;<span class="string" id="7515483">`<br>
<span class="lineno"></span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno">80</span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1<br>
<span class="lineno"></span>HEADER2:&nbsp;value2<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno">85</span>My&nbsp;value<br>
<span class="lineno"></span>The&nbsp;end.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>name:&nbsp;bigsection<br>
<span class="lineno"></span><br>
<span class="lineno">90</span>[longline]<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1b<br>
<span class="lineno"></span>HEADER2:&nbsp;value2b<br>
<span class="lineno"></span>foo-bar:&nbsp;bazb<br>
<span class="lineno">95</span><br>
<span class="lineno"></span>Line&nbsp;1<br>
<span class="lineno"></span>Line&nbsp;2<br>
<span class="lineno"></span>Line&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.<br>
<span class="lineno"></span><br>
<span class="lineno">100</span>--MyBoundary<br>
<span class="lineno"></span><br>
<span class="lineno"></span>never&nbsp;read&nbsp;data<br>
<span class="lineno"></span>--MyBoundary--<br>
<span class="lineno"></span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>useless&nbsp;trailer<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515840">testBody</span>&nbsp;<span class="op" id="7515849">=</span>&nbsp;<span class="ident" id="7515851">strings</span><span class="op" id="7515858">.</span><span class="ident" id="7515859">Replace</span><span class="op" id="7515866">(</span><span class="ident" id="7515867">testBody</span><span class="op" id="7515875">,</span>&nbsp;<span class="string" id="7515877">&#34;\n&#34;</span><span class="op" id="7515881">,</span>&nbsp;<span class="ident" id="7515883">sep</span><span class="op" id="7515886">,</span>&nbsp;<span class="op" id="7515888">-</span><span class="num" id="7515889">1</span><span class="op" id="7515890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7515893">return</span>&nbsp;<span class="ident" id="7515900">strings</span><span class="op" id="7515907">.</span><span class="ident" id="7515908">Replace</span><span class="op" id="7515915">(</span><span class="ident" id="7515916">testBody</span><span class="op" id="7515924">,</span>&nbsp;<span class="string" id="7515926">&#34;[longline]&#34;</span><span class="op" id="7515938">,</span>&nbsp;<span class="ident" id="7515940">longLine</span><span class="op" id="7515948">,</span>&nbsp;<span class="num" id="7515950">1</span><span class="op" id="7515951">)</span><br>
<span class="lineno">110</span><span class="op" id="7515953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7515956">func</span>&nbsp;<span class="ident" id="7515961">TestMultipart</span><span class="op" id="7515974">(</span><span class="ident" id="7515975">t</span>&nbsp;<span class="op" id="7515977">*</span><span class="ident" id="7515978">testing</span><span class="op" id="7515985">.</span><span class="ident" id="7515986">T</span><span class="op" id="7515987">)</span>&nbsp;<span class="op" id="7515989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515992">bodyReader</span>&nbsp;<span class="op" id="7516003">:=</span>&nbsp;<span class="ident" id="7516006">strings</span><span class="op" id="7516013">.</span><span class="ident" id="7516014">NewReader</span><span class="op" id="7516023">(</span><span class="ident" id="7516024">testMultipartBody</span><span class="op" id="7516041">(</span><span class="string" id="7516042">&#34;\r\n&#34;</span><span class="op" id="7516048">)</span><span class="op" id="7516049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516052">testMultipart</span><span class="op" id="7516065">(</span><span class="ident" id="7516066">t</span><span class="op" id="7516067">,</span>&nbsp;<span class="ident" id="7516069">bodyReader</span><span class="op" id="7516079">,</span>&nbsp;<span class="builtintype" id="7516081">false</span><span class="op" id="7516086">)</span><br>
<span class="lineno">115</span><span class="op" id="7516088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7516091">func</span>&nbsp;<span class="ident" id="7516096">TestMultipartOnlyNewlines</span><span class="op" id="7516121">(</span><span class="ident" id="7516122">t</span>&nbsp;<span class="op" id="7516124">*</span><span class="ident" id="7516125">testing</span><span class="op" id="7516132">.</span><span class="ident" id="7516133">T</span><span class="op" id="7516134">)</span>&nbsp;<span class="op" id="7516136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516139">bodyReader</span>&nbsp;<span class="op" id="7516150">:=</span>&nbsp;<span class="ident" id="7516153">strings</span><span class="op" id="7516160">.</span><span class="ident" id="7516161">NewReader</span><span class="op" id="7516170">(</span><span class="ident" id="7516171">testMultipartBody</span><span class="op" id="7516188">(</span><span class="string" id="7516189">&#34;\n&#34;</span><span class="op" id="7516193">)</span><span class="op" id="7516194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516197">testMultipart</span><span class="op" id="7516210">(</span><span class="ident" id="7516211">t</span><span class="op" id="7516212">,</span>&nbsp;<span class="ident" id="7516214">bodyReader</span><span class="op" id="7516224">,</span>&nbsp;<span class="builtintype" id="7516226">true</span><span class="op" id="7516230">)</span><br>
<span class="lineno">120</span><span class="op" id="7516232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7516235">func</span>&nbsp;<span class="ident" id="7516240">TestMultipartSlowInput</span><span class="op" id="7516262">(</span><span class="ident" id="7516263">t</span>&nbsp;<span class="op" id="7516265">*</span><span class="ident" id="7516266">testing</span><span class="op" id="7516273">.</span><span class="ident" id="7516274">T</span><span class="op" id="7516275">)</span>&nbsp;<span class="op" id="7516277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516280">bodyReader</span>&nbsp;<span class="op" id="7516291">:=</span>&nbsp;<span class="ident" id="7516294">strings</span><span class="op" id="7516301">.</span><span class="ident" id="7516302">NewReader</span><span class="op" id="7516311">(</span><span class="ident" id="7516312">testMultipartBody</span><span class="op" id="7516329">(</span><span class="string" id="7516330">&#34;\r\n&#34;</span><span class="op" id="7516336">)</span><span class="op" id="7516337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516340">testMultipart</span><span class="op" id="7516353">(</span><span class="ident" id="7516354">t</span><span class="op" id="7516355">,</span>&nbsp;<span class="op" id="7516357">&amp;</span><span class="ident" id="7516358">slowReader</span><span class="op" id="7516368">{</span><span class="ident" id="7516369">bodyReader</span><span class="op" id="7516379">}</span><span class="op" id="7516380">,</span>&nbsp;<span class="builtintype" id="7516382">false</span><span class="op" id="7516387">)</span><br>
<span class="lineno">125</span><span class="op" id="7516389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7516392">func</span>&nbsp;<span class="ident" id="7516397">testMultipart</span><span class="op" id="7516410">(</span><span class="ident" id="7516411">t</span>&nbsp;<span class="op" id="7516413">*</span><span class="ident" id="7516414">testing</span><span class="op" id="7516421">.</span><span class="ident" id="7516422">T</span><span class="op" id="7516423">,</span>&nbsp;<span class="ident" id="7516425">r</span>&nbsp;<span class="ident" id="7516427">io</span><span class="op" id="7516429">.</span><span class="ident" id="7516430">Reader</span><span class="op" id="7516436">,</span>&nbsp;<span class="ident" id="7516438">onlyNewlines</span>&nbsp;<span class="builtintype" id="7516451">bool</span><span class="op" id="7516455">)</span>&nbsp;<span class="op" id="7516457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516460">reader</span>&nbsp;<span class="op" id="7516467">:=</span>&nbsp;<span class="ident" id="7516470">NewReader</span><span class="op" id="7516479">(</span><span class="ident" id="7516480">r</span><span class="op" id="7516481">,</span>&nbsp;<span class="string" id="7516483">&#34;MyBoundary&#34;</span><span class="op" id="7516495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516498">buf</span>&nbsp;<span class="op" id="7516502">:=</span>&nbsp;<span class="builtinfunc" id="7516505">new</span><span class="op" id="7516508">(</span><span class="ident" id="7516509">bytes</span><span class="op" id="7516514">.</span><span class="ident" id="7516515">Buffer</span><span class="op" id="7516521">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7516525">//&nbsp;Part1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516535">part</span><span class="op" id="7516539">,</span>&nbsp;<span class="ident" id="7516541">err</span>&nbsp;<span class="op" id="7516545">:=</span>&nbsp;<span class="ident" id="7516548">reader</span><span class="op" id="7516554">.</span><span class="ident" id="7516555">NextPart</span><span class="op" id="7516563">(</span><span class="op" id="7516564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516567">if</span>&nbsp;<span class="ident" id="7516570">part</span>&nbsp;<span class="op" id="7516575">==</span>&nbsp;<span class="ident" id="7516578">nil</span>&nbsp;<span class="op" id="7516582">||</span>&nbsp;<span class="ident" id="7516585">err</span>&nbsp;<span class="op" id="7516589">!=</span>&nbsp;<span class="ident" id="7516592">nil</span>&nbsp;<span class="op" id="7516596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516600">t</span><span class="op" id="7516601">.</span><span class="ident" id="7516602">Error</span><span class="op" id="7516607">(</span><span class="string" id="7516608">&#34;Expected&nbsp;part1&#34;</span><span class="op" id="7516624">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516628">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516639">if</span>&nbsp;<span class="ident" id="7516642">x</span>&nbsp;<span class="op" id="7516644">:=</span>&nbsp;<span class="ident" id="7516647">part</span><span class="op" id="7516651">.</span><span class="ident" id="7516652">Header</span><span class="op" id="7516658">.</span><span class="ident" id="7516659">Get</span><span class="op" id="7516662">(</span><span class="string" id="7516663">&#34;Header1&#34;</span><span class="op" id="7516672">)</span><span class="op" id="7516673">;</span>&nbsp;<span class="ident" id="7516675">x</span>&nbsp;<span class="op" id="7516677">!=</span>&nbsp;<span class="string" id="7516680">&#34;value1&#34;</span>&nbsp;<span class="op" id="7516689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516693">t</span><span class="op" id="7516694">.</span><span class="ident" id="7516695">Errorf</span><span class="op" id="7516701">(</span><span class="string" id="7516702">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7516737">,</span>&nbsp;<span class="string" id="7516739">&#34;Header1&#34;</span><span class="op" id="7516748">,</span>&nbsp;<span class="ident" id="7516750">x</span><span class="op" id="7516751">,</span>&nbsp;<span class="string" id="7516753">&#34;value1&#34;</span><span class="op" id="7516761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516764">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516767">if</span>&nbsp;<span class="ident" id="7516770">x</span>&nbsp;<span class="op" id="7516772">:=</span>&nbsp;<span class="ident" id="7516775">part</span><span class="op" id="7516779">.</span><span class="ident" id="7516780">Header</span><span class="op" id="7516786">.</span><span class="ident" id="7516787">Get</span><span class="op" id="7516790">(</span><span class="string" id="7516791">&#34;foo-bar&#34;</span><span class="op" id="7516800">)</span><span class="op" id="7516801">;</span>&nbsp;<span class="ident" id="7516803">x</span>&nbsp;<span class="op" id="7516805">!=</span>&nbsp;<span class="string" id="7516808">&#34;baz&#34;</span>&nbsp;<span class="op" id="7516814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516818">t</span><span class="op" id="7516819">.</span><span class="ident" id="7516820">Errorf</span><span class="op" id="7516826">(</span><span class="string" id="7516827">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7516862">,</span>&nbsp;<span class="string" id="7516864">&#34;foo-bar&#34;</span><span class="op" id="7516873">,</span>&nbsp;<span class="ident" id="7516875">x</span><span class="op" id="7516876">,</span>&nbsp;<span class="string" id="7516878">&#34;baz&#34;</span><span class="op" id="7516883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516889">if</span>&nbsp;<span class="ident" id="7516892">x</span>&nbsp;<span class="op" id="7516894">:=</span>&nbsp;<span class="ident" id="7516897">part</span><span class="op" id="7516901">.</span><span class="ident" id="7516902">Header</span><span class="op" id="7516908">.</span><span class="ident" id="7516909">Get</span><span class="op" id="7516912">(</span><span class="string" id="7516913">&#34;Foo-Bar&#34;</span><span class="op" id="7516922">)</span><span class="op" id="7516923">;</span>&nbsp;<span class="ident" id="7516925">x</span>&nbsp;<span class="op" id="7516927">!=</span>&nbsp;<span class="string" id="7516930">&#34;baz&#34;</span>&nbsp;<span class="op" id="7516936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516940">t</span><span class="op" id="7516941">.</span><span class="ident" id="7516942">Errorf</span><span class="op" id="7516948">(</span><span class="string" id="7516949">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7516984">,</span>&nbsp;<span class="string" id="7516986">&#34;Foo-Bar&#34;</span><span class="op" id="7516995">,</span>&nbsp;<span class="ident" id="7516997">x</span><span class="op" id="7516998">,</span>&nbsp;<span class="string" id="7517000">&#34;baz&#34;</span><span class="op" id="7517005">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517011">buf</span><span class="op" id="7517014">.</span><span class="ident" id="7517015">Reset</span><span class="op" id="7517020">(</span><span class="op" id="7517021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517024">if</span>&nbsp;<span class="ident" id="7517027">_</span><span class="op" id="7517028">,</span>&nbsp;<span class="ident" id="7517030">err</span>&nbsp;<span class="op" id="7517034">:=</span>&nbsp;<span class="ident" id="7517037">io</span><span class="op" id="7517039">.</span><span class="ident" id="7517040">Copy</span><span class="op" id="7517044">(</span><span class="ident" id="7517045">buf</span><span class="op" id="7517048">,</span>&nbsp;<span class="ident" id="7517050">part</span><span class="op" id="7517054">)</span><span class="op" id="7517055">;</span>&nbsp;<span class="ident" id="7517057">err</span>&nbsp;<span class="op" id="7517061">!=</span>&nbsp;<span class="ident" id="7517064">nil</span>&nbsp;<span class="op" id="7517068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517072">t</span><span class="op" id="7517073">.</span><span class="ident" id="7517074">Errorf</span><span class="op" id="7517080">(</span><span class="string" id="7517081">&#34;part&nbsp;1&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="7517098">,</span>&nbsp;<span class="ident" id="7517100">err</span><span class="op" id="7517103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517106">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517110">adjustNewlines</span>&nbsp;<span class="op" id="7517125">:=</span>&nbsp;<span class="keyword" id="7517128">func</span><span class="op" id="7517132">(</span><span class="ident" id="7517133">s</span>&nbsp;<span class="builtintype" id="7517135">string</span><span class="op" id="7517141">)</span>&nbsp;<span class="builtintype" id="7517143">string</span>&nbsp;<span class="op" id="7517150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517154">if</span>&nbsp;<span class="ident" id="7517157">onlyNewlines</span>&nbsp;<span class="op" id="7517170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517175">return</span>&nbsp;<span class="ident" id="7517182">strings</span><span class="op" id="7517189">.</span><span class="ident" id="7517190">Replace</span><span class="op" id="7517197">(</span><span class="ident" id="7517198">s</span><span class="op" id="7517199">,</span>&nbsp;<span class="string" id="7517201">&#34;\r\n&#34;</span><span class="op" id="7517207">,</span>&nbsp;<span class="string" id="7517209">&#34;\n&#34;</span><span class="op" id="7517213">,</span>&nbsp;<span class="op" id="7517215">-</span><span class="num" id="7517216">1</span><span class="op" id="7517217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517221">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517225">return</span>&nbsp;<span class="ident" id="7517232">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517239">expectEq</span><span class="op" id="7517247">(</span><span class="ident" id="7517248">t</span><span class="op" id="7517249">,</span>&nbsp;<span class="ident" id="7517251">adjustNewlines</span><span class="op" id="7517265">(</span><span class="string" id="7517266">&#34;My&nbsp;value\r\nThe&nbsp;end.&#34;</span><span class="op" id="7517288">)</span><span class="op" id="7517289">,</span>&nbsp;<span class="ident" id="7517291">buf</span><span class="op" id="7517294">.</span><span class="ident" id="7517295">String</span><span class="op" id="7517301">(</span><span class="op" id="7517302">)</span><span class="op" id="7517303">,</span>&nbsp;<span class="string" id="7517305">&#34;Value&nbsp;of&nbsp;first&nbsp;part&#34;</span><span class="op" id="7517326">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7517330">//&nbsp;Part2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517340">part</span><span class="op" id="7517344">,</span>&nbsp;<span class="ident" id="7517346">err</span>&nbsp;<span class="op" id="7517350">=</span>&nbsp;<span class="ident" id="7517352">reader</span><span class="op" id="7517358">.</span><span class="ident" id="7517359">NextPart</span><span class="op" id="7517367">(</span><span class="op" id="7517368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517371">if</span>&nbsp;<span class="ident" id="7517374">err</span>&nbsp;<span class="op" id="7517378">!=</span>&nbsp;<span class="ident" id="7517381">nil</span>&nbsp;<span class="op" id="7517385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517389">t</span><span class="op" id="7517390">.</span><span class="ident" id="7517391">Fatalf</span><span class="op" id="7517397">(</span><span class="string" id="7517398">&#34;Expected&nbsp;part2;&nbsp;got:&nbsp;%v&#34;</span><span class="op" id="7517423">,</span>&nbsp;<span class="ident" id="7517425">err</span><span class="op" id="7517428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517432">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517443">if</span>&nbsp;<span class="ident" id="7517446">e</span><span class="op" id="7517447">,</span>&nbsp;<span class="ident" id="7517449">g</span>&nbsp;<span class="op" id="7517451">:=</span>&nbsp;<span class="string" id="7517454">&#34;bigsection&#34;</span><span class="op" id="7517466">,</span>&nbsp;<span class="ident" id="7517468">part</span><span class="op" id="7517472">.</span><span class="ident" id="7517473">Header</span><span class="op" id="7517479">.</span><span class="ident" id="7517480">Get</span><span class="op" id="7517483">(</span><span class="string" id="7517484">&#34;name&#34;</span><span class="op" id="7517490">)</span><span class="op" id="7517491">;</span>&nbsp;<span class="ident" id="7517493">e</span>&nbsp;<span class="op" id="7517495">!=</span>&nbsp;<span class="ident" id="7517498">g</span>&nbsp;<span class="op" id="7517500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517504">t</span><span class="op" id="7517505">.</span><span class="ident" id="7517506">Errorf</span><span class="op" id="7517512">(</span><span class="string" id="7517513">&#34;part2&#39;s&nbsp;name&nbsp;header:&nbsp;expected&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7517555">,</span>&nbsp;<span class="ident" id="7517557">e</span><span class="op" id="7517558">,</span>&nbsp;<span class="ident" id="7517560">g</span><span class="op" id="7517561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517567">buf</span><span class="op" id="7517570">.</span><span class="ident" id="7517571">Reset</span><span class="op" id="7517576">(</span><span class="op" id="7517577">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517580">if</span>&nbsp;<span class="ident" id="7517583">_</span><span class="op" id="7517584">,</span>&nbsp;<span class="ident" id="7517586">err</span>&nbsp;<span class="op" id="7517590">:=</span>&nbsp;<span class="ident" id="7517593">io</span><span class="op" id="7517595">.</span><span class="ident" id="7517596">Copy</span><span class="op" id="7517600">(</span><span class="ident" id="7517601">buf</span><span class="op" id="7517604">,</span>&nbsp;<span class="ident" id="7517606">part</span><span class="op" id="7517610">)</span><span class="op" id="7517611">;</span>&nbsp;<span class="ident" id="7517613">err</span>&nbsp;<span class="op" id="7517617">!=</span>&nbsp;<span class="ident" id="7517620">nil</span>&nbsp;<span class="op" id="7517624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517628">t</span><span class="op" id="7517629">.</span><span class="ident" id="7517630">Errorf</span><span class="op" id="7517636">(</span><span class="string" id="7517637">&#34;part&nbsp;2&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="7517654">,</span>&nbsp;<span class="ident" id="7517656">err</span><span class="op" id="7517659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517665">s</span>&nbsp;<span class="op" id="7517667">:=</span>&nbsp;<span class="ident" id="7517670">buf</span><span class="op" id="7517673">.</span><span class="ident" id="7517674">String</span><span class="op" id="7517680">(</span><span class="op" id="7517681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517684">if</span>&nbsp;<span class="builtinfunc" id="7517687">len</span><span class="op" id="7517690">(</span><span class="ident" id="7517691">s</span><span class="op" id="7517692">)</span>&nbsp;<span class="op" id="7517694">!=</span>&nbsp;<span class="builtinfunc" id="7517697">len</span><span class="op" id="7517700">(</span><span class="ident" id="7517701">longLine</span><span class="op" id="7517709">)</span>&nbsp;<span class="op" id="7517711">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517715">t</span><span class="op" id="7517716">.</span><span class="ident" id="7517717">Errorf</span><span class="op" id="7517723">(</span><span class="string" id="7517724">&#34;part2&nbsp;body&nbsp;expected&nbsp;long&nbsp;line&nbsp;of&nbsp;length&nbsp;%d;&nbsp;got&nbsp;length&nbsp;%d&#34;</span><span class="op" id="7517783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7517788">len</span><span class="op" id="7517791">(</span><span class="ident" id="7517792">longLine</span><span class="op" id="7517800">)</span><span class="op" id="7517801">,</span>&nbsp;<span class="builtinfunc" id="7517803">len</span><span class="op" id="7517806">(</span><span class="ident" id="7517807">s</span><span class="op" id="7517808">)</span><span class="op" id="7517809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517815">if</span>&nbsp;<span class="ident" id="7517818">s</span>&nbsp;<span class="op" id="7517820">!=</span>&nbsp;<span class="ident" id="7517823">longLine</span>&nbsp;<span class="op" id="7517832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517836">t</span><span class="op" id="7517837">.</span><span class="ident" id="7517838">Errorf</span><span class="op" id="7517844">(</span><span class="string" id="7517845">&#34;part2&nbsp;long&nbsp;body&nbsp;didn&#39;t&nbsp;match&#34;</span><span class="op" id="7517875">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7517882">//&nbsp;Part3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517892">part</span><span class="op" id="7517896">,</span>&nbsp;<span class="ident" id="7517898">err</span>&nbsp;<span class="op" id="7517902">=</span>&nbsp;<span class="ident" id="7517904">reader</span><span class="op" id="7517910">.</span><span class="ident" id="7517911">NextPart</span><span class="op" id="7517919">(</span><span class="op" id="7517920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517923">if</span>&nbsp;<span class="ident" id="7517926">part</span>&nbsp;<span class="op" id="7517931">==</span>&nbsp;<span class="ident" id="7517934">nil</span>&nbsp;<span class="op" id="7517938">||</span>&nbsp;<span class="ident" id="7517941">err</span>&nbsp;<span class="op" id="7517945">!=</span>&nbsp;<span class="ident" id="7517948">nil</span>&nbsp;<span class="op" id="7517952">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517956">t</span><span class="op" id="7517957">.</span><span class="ident" id="7517958">Error</span><span class="op" id="7517963">(</span><span class="string" id="7517964">&#34;Expected&nbsp;part3&#34;</span><span class="op" id="7517980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517984">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517995">if</span>&nbsp;<span class="ident" id="7517998">part</span><span class="op" id="7518002">.</span><span class="ident" id="7518003">Header</span><span class="op" id="7518009">.</span><span class="ident" id="7518010">Get</span><span class="op" id="7518013">(</span><span class="string" id="7518014">&#34;foo-bar&#34;</span><span class="op" id="7518023">)</span>&nbsp;<span class="op" id="7518025">!=</span>&nbsp;<span class="string" id="7518028">&#34;bazb&#34;</span>&nbsp;<span class="op" id="7518035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518039">t</span><span class="op" id="7518040">.</span><span class="ident" id="7518041">Error</span><span class="op" id="7518046">(</span><span class="string" id="7518047">&#34;Expected&nbsp;foo-bar:&nbsp;bazb&#34;</span><span class="op" id="7518071">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7518074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518077">buf</span><span class="op" id="7518080">.</span><span class="ident" id="7518081">Reset</span><span class="op" id="7518086">(</span><span class="op" id="7518087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518090">if</span>&nbsp;<span class="ident" id="7518093">_</span><span class="op" id="7518094">,</span>&nbsp;<span class="ident" id="7518096">err</span>&nbsp;<span class="op" id="7518100">:=</span>&nbsp;<span class="ident" id="7518103">io</span><span class="op" id="7518105">.</span><span class="ident" id="7518106">Copy</span><span class="op" id="7518110">(</span><span class="ident" id="7518111">buf</span><span class="op" id="7518114">,</span>&nbsp;<span class="ident" id="7518116">part</span><span class="op" id="7518120">)</span><span class="op" id="7518121">;</span>&nbsp;<span class="ident" id="7518123">err</span>&nbsp;<span class="op" id="7518127">!=</span>&nbsp;<span class="ident" id="7518130">nil</span>&nbsp;<span class="op" id="7518134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518138">t</span><span class="op" id="7518139">.</span><span class="ident" id="7518140">Errorf</span><span class="op" id="7518146">(</span><span class="string" id="7518147">&#34;part&nbsp;3&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="7518164">,</span>&nbsp;<span class="ident" id="7518166">err</span><span class="op" id="7518169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7518172">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518175">expectEq</span><span class="op" id="7518183">(</span><span class="ident" id="7518184">t</span><span class="op" id="7518185">,</span>&nbsp;<span class="ident" id="7518187">adjustNewlines</span><span class="op" id="7518201">(</span><span class="string" id="7518202">&#34;Line&nbsp;1\r\nLine&nbsp;2\r\nLine&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.\r\n&#34;</span><span class="op" id="7518267">)</span><span class="op" id="7518268">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518272">buf</span><span class="op" id="7518275">.</span><span class="ident" id="7518276">String</span><span class="op" id="7518282">(</span><span class="op" id="7518283">)</span><span class="op" id="7518284">,</span>&nbsp;<span class="string" id="7518286">&#34;body&nbsp;of&nbsp;part&nbsp;3&#34;</span><span class="op" id="7518302">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7518306">//&nbsp;Part4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518316">part</span><span class="op" id="7518320">,</span>&nbsp;<span class="ident" id="7518322">err</span>&nbsp;<span class="op" id="7518326">=</span>&nbsp;<span class="ident" id="7518328">reader</span><span class="op" id="7518334">.</span><span class="ident" id="7518335">NextPart</span><span class="op" id="7518343">(</span><span class="op" id="7518344">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518347">if</span>&nbsp;<span class="ident" id="7518350">part</span>&nbsp;<span class="op" id="7518355">==</span>&nbsp;<span class="ident" id="7518358">nil</span>&nbsp;<span class="op" id="7518362">||</span>&nbsp;<span class="ident" id="7518365">err</span>&nbsp;<span class="op" id="7518369">!=</span>&nbsp;<span class="ident" id="7518372">nil</span>&nbsp;<span class="op" id="7518376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518380">t</span><span class="op" id="7518381">.</span><span class="ident" id="7518382">Error</span><span class="op" id="7518387">(</span><span class="string" id="7518388">&#34;Expected&nbsp;part&nbsp;4&nbsp;without&nbsp;errors&#34;</span><span class="op" id="7518420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518424">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7518432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7518436">//&nbsp;Non-existent&nbsp;part5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518459">part</span><span class="op" id="7518463">,</span>&nbsp;<span class="ident" id="7518465">err</span>&nbsp;<span class="op" id="7518469">=</span>&nbsp;<span class="ident" id="7518471">reader</span><span class="op" id="7518477">.</span><span class="ident" id="7518478">NextPart</span><span class="op" id="7518486">(</span><span class="op" id="7518487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518490">if</span>&nbsp;<span class="ident" id="7518493">part</span>&nbsp;<span class="op" id="7518498">!=</span>&nbsp;<span class="ident" id="7518501">nil</span>&nbsp;<span class="op" id="7518505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518509">t</span><span class="op" id="7518510">.</span><span class="ident" id="7518511">Error</span><span class="op" id="7518516">(</span><span class="string" id="7518517">&#34;Didn&#39;t&nbsp;expect&nbsp;a&nbsp;fifth&nbsp;part.&#34;</span><span class="op" id="7518546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7518549">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518552">if</span>&nbsp;<span class="ident" id="7518555">err</span>&nbsp;<span class="op" id="7518559">!=</span>&nbsp;<span class="ident" id="7518562">io</span><span class="op" id="7518564">.</span><span class="ident" id="7518565">EOF</span>&nbsp;<span class="op" id="7518569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518573">t</span><span class="op" id="7518574">.</span><span class="ident" id="7518575">Errorf</span><span class="op" id="7518581">(</span><span class="string" id="7518582">&#34;On&nbsp;fifth&nbsp;part&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7518621">,</span>&nbsp;<span class="ident" id="7518623">err</span><span class="op" id="7518626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7518629">}</span><br>
<span class="lineno"></span><span class="op" id="7518631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="7518634">func</span>&nbsp;<span class="ident" id="7518639">TestVariousTextLineEndings</span><span class="op" id="7518665">(</span><span class="ident" id="7518666">t</span>&nbsp;<span class="op" id="7518668">*</span><span class="ident" id="7518669">testing</span><span class="op" id="7518676">.</span><span class="ident" id="7518677">T</span><span class="op" id="7518678">)</span>&nbsp;<span class="op" id="7518680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518683">tests</span>&nbsp;<span class="op" id="7518689">:=</span>&nbsp;<span class="op" id="7518692">[</span><span class="op" id="7518693">...</span><span class="op" id="7518696">]</span><span class="builtintype" id="7518697">string</span><span class="op" id="7518703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7518707">&#34;Foo\nBar&#34;</span><span class="op" id="7518717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7518721">&#34;Foo\nBar\n&#34;</span><span class="op" id="7518733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7518737">&#34;Foo\r\nBar&#34;</span><span class="op" id="7518749">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7518753">&#34;Foo\r\nBar\r\n&#34;</span><span class="op" id="7518769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7518773">&#34;Foo\rBar&#34;</span><span class="op" id="7518783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7518787">&#34;Foo\rBar\r&#34;</span><span class="op" id="7518799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7518803">&#34;\x00\x01\x02\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10&#34;</span><span class="op" id="7518849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7518852">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518856">for</span>&nbsp;<span class="ident" id="7518860">testNum</span><span class="op" id="7518867">,</span>&nbsp;<span class="ident" id="7518869">expectedBody</span>&nbsp;<span class="op" id="7518882">:=</span>&nbsp;<span class="keyword" id="7518885">range</span>&nbsp;<span class="ident" id="7518891">tests</span>&nbsp;<span class="op" id="7518897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518901">body</span>&nbsp;<span class="op" id="7518906">:=</span>&nbsp;<span class="string" id="7518909">&#34;--BOUNDARY\r\n&#34;</span>&nbsp;<span class="op" id="7518926">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7518931">&#34;Content-Disposition:&nbsp;form-data;&nbsp;name=\&#34;value\&#34;\r\n&#34;</span>&nbsp;<span class="op" id="7518984">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7518989">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="7518996">+</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519001">expectedBody</span>&nbsp;<span class="op" id="7519014">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7519019">&#34;\r\n--BOUNDARY--\r\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519044">bodyReader</span>&nbsp;<span class="op" id="7519055">:=</span>&nbsp;<span class="ident" id="7519058">strings</span><span class="op" id="7519065">.</span><span class="ident" id="7519066">NewReader</span><span class="op" id="7519075">(</span><span class="ident" id="7519076">body</span><span class="op" id="7519080">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519085">reader</span>&nbsp;<span class="op" id="7519092">:=</span>&nbsp;<span class="ident" id="7519095">NewReader</span><span class="op" id="7519104">(</span><span class="ident" id="7519105">bodyReader</span><span class="op" id="7519115">,</span>&nbsp;<span class="string" id="7519117">&#34;BOUNDARY&#34;</span><span class="op" id="7519127">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519131">buf</span>&nbsp;<span class="op" id="7519135">:=</span>&nbsp;<span class="builtinfunc" id="7519138">new</span><span class="op" id="7519141">(</span><span class="ident" id="7519142">bytes</span><span class="op" id="7519147">.</span><span class="ident" id="7519148">Buffer</span><span class="op" id="7519154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519158">part</span><span class="op" id="7519162">,</span>&nbsp;<span class="ident" id="7519164">err</span>&nbsp;<span class="op" id="7519168">:=</span>&nbsp;<span class="ident" id="7519171">reader</span><span class="op" id="7519177">.</span><span class="ident" id="7519178">NextPart</span><span class="op" id="7519186">(</span><span class="op" id="7519187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7519191">if</span>&nbsp;<span class="ident" id="7519194">part</span>&nbsp;<span class="op" id="7519199">==</span>&nbsp;<span class="ident" id="7519202">nil</span>&nbsp;<span class="op" id="7519206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519211">t</span><span class="op" id="7519212">.</span><span class="ident" id="7519213">Errorf</span><span class="op" id="7519219">(</span><span class="string" id="7519220">&#34;Expected&nbsp;a&nbsp;body&nbsp;part&nbsp;on&nbsp;text&nbsp;%d&#34;</span><span class="op" id="7519253">,</span>&nbsp;<span class="ident" id="7519255">testNum</span><span class="op" id="7519262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7519267">continue</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7519282">if</span>&nbsp;<span class="ident" id="7519285">err</span>&nbsp;<span class="op" id="7519289">!=</span>&nbsp;<span class="ident" id="7519292">nil</span>&nbsp;<span class="op" id="7519296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519301">t</span><span class="op" id="7519302">.</span><span class="ident" id="7519303">Errorf</span><span class="op" id="7519309">(</span><span class="string" id="7519310">&#34;Unexpected&nbsp;error&nbsp;on&nbsp;text&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="7519343">,</span>&nbsp;<span class="ident" id="7519345">testNum</span><span class="op" id="7519352">,</span>&nbsp;<span class="ident" id="7519354">err</span><span class="op" id="7519357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7519362">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519373">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519377">written</span><span class="op" id="7519384">,</span>&nbsp;<span class="ident" id="7519386">err</span>&nbsp;<span class="op" id="7519390">:=</span>&nbsp;<span class="ident" id="7519393">io</span><span class="op" id="7519395">.</span><span class="ident" id="7519396">Copy</span><span class="op" id="7519400">(</span><span class="ident" id="7519401">buf</span><span class="op" id="7519404">,</span>&nbsp;<span class="ident" id="7519406">part</span><span class="op" id="7519410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519414">expectEq</span><span class="op" id="7519422">(</span><span class="ident" id="7519423">t</span><span class="op" id="7519424">,</span>&nbsp;<span class="ident" id="7519426">expectedBody</span><span class="op" id="7519438">,</span>&nbsp;<span class="ident" id="7519440">buf</span><span class="op" id="7519443">.</span><span class="ident" id="7519444">String</span><span class="op" id="7519450">(</span><span class="op" id="7519451">)</span><span class="op" id="7519452">,</span>&nbsp;<span class="ident" id="7519454">fmt</span><span class="op" id="7519457">.</span><span class="ident" id="7519458">Sprintf</span><span class="op" id="7519465">(</span><span class="string" id="7519466">&#34;test&nbsp;%d&#34;</span><span class="op" id="7519475">,</span>&nbsp;<span class="ident" id="7519477">testNum</span><span class="op" id="7519484">)</span><span class="op" id="7519485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7519489">if</span>&nbsp;<span class="ident" id="7519492">err</span>&nbsp;<span class="op" id="7519496">!=</span>&nbsp;<span class="ident" id="7519499">nil</span>&nbsp;<span class="op" id="7519503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519508">t</span><span class="op" id="7519509">.</span><span class="ident" id="7519510">Errorf</span><span class="op" id="7519516">(</span><span class="string" id="7519517">&#34;Error&nbsp;copying&nbsp;multipart;&nbsp;bytes=%v,&nbsp;error=%v&#34;</span><span class="op" id="7519562">,</span>&nbsp;<span class="ident" id="7519564">written</span><span class="op" id="7519571">,</span>&nbsp;<span class="ident" id="7519573">err</span><span class="op" id="7519576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519580">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519585">part</span><span class="op" id="7519589">,</span>&nbsp;<span class="ident" id="7519591">err</span>&nbsp;<span class="op" id="7519595">=</span>&nbsp;<span class="ident" id="7519597">reader</span><span class="op" id="7519603">.</span><span class="ident" id="7519604">NextPart</span><span class="op" id="7519612">(</span><span class="op" id="7519613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7519617">if</span>&nbsp;<span class="ident" id="7519620">part</span>&nbsp;<span class="op" id="7519625">!=</span>&nbsp;<span class="ident" id="7519628">nil</span>&nbsp;<span class="op" id="7519632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519637">t</span><span class="op" id="7519638">.</span><span class="ident" id="7519639">Errorf</span><span class="op" id="7519645">(</span><span class="string" id="7519646">&#34;Unexpected&nbsp;part&nbsp;in&nbsp;test&nbsp;%d&#34;</span><span class="op" id="7519674">,</span>&nbsp;<span class="ident" id="7519676">testNum</span><span class="op" id="7519683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519687">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7519691">if</span>&nbsp;<span class="ident" id="7519694">err</span>&nbsp;<span class="op" id="7519698">!=</span>&nbsp;<span class="ident" id="7519701">io</span><span class="op" id="7519703">.</span><span class="ident" id="7519704">EOF</span>&nbsp;<span class="op" id="7519708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519713">t</span><span class="op" id="7519714">.</span><span class="ident" id="7519715">Errorf</span><span class="op" id="7519721">(</span><span class="string" id="7519722">&#34;On&nbsp;test&nbsp;%d&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7519758">,</span>&nbsp;<span class="ident" id="7519760">testNum</span><span class="op" id="7519767">,</span>&nbsp;<span class="ident" id="7519769">err</span><span class="op" id="7519772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519780">}</span><br>
<span class="lineno">260</span><span class="op" id="7519782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7519785">type</span>&nbsp;<span class="ident" id="7519790">maliciousReader</span>&nbsp;<span class="keyword" id="7519806">struct</span>&nbsp;<span class="op" id="7519813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519816">t</span>&nbsp;<span class="op" id="7519818">*</span><span class="ident" id="7519819">testing</span><span class="op" id="7519826">.</span><span class="ident" id="7519827">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519830">n</span>&nbsp;<span class="builtintype" id="7519832">int</span><br>
<span class="lineno">265</span><span class="op" id="7519836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7519839">const</span>&nbsp;<span class="ident" id="7519845">maxReadThreshold</span>&nbsp;<span class="op" id="7519862">=</span>&nbsp;<span class="num" id="7519864">1</span>&nbsp;<span class="op" id="7519866">&lt;&lt;</span>&nbsp;<span class="num" id="7519869">20</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7519873">func</span>&nbsp;<span class="op" id="7519878">(</span><span class="ident" id="7519879">mr</span>&nbsp;<span class="op" id="7519882">*</span><span class="ident" id="7519883">maliciousReader</span><span class="op" id="7519898">)</span>&nbsp;<span class="ident" id="7519900">Read</span><span class="op" id="7519904">(</span><span class="ident" id="7519905">b</span>&nbsp;<span class="op" id="7519907">[</span><span class="op" id="7519908">]</span><span class="builtintype" id="7519909">byte</span><span class="op" id="7519913">)</span>&nbsp;<span class="op" id="7519915">(</span><span class="ident" id="7519916">n</span>&nbsp;<span class="builtintype" id="7519918">int</span><span class="op" id="7519921">,</span>&nbsp;<span class="ident" id="7519923">err</span>&nbsp;<span class="builtintype" id="7519927">error</span><span class="op" id="7519932">)</span>&nbsp;<span class="op" id="7519934">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519937">mr</span><span class="op" id="7519939">.</span><span class="ident" id="7519940">n</span>&nbsp;<span class="op" id="7519942">+=</span>&nbsp;<span class="builtinfunc" id="7519945">len</span><span class="op" id="7519948">(</span><span class="ident" id="7519949">b</span><span class="op" id="7519950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7519953">if</span>&nbsp;<span class="ident" id="7519956">mr</span><span class="op" id="7519958">.</span><span class="ident" id="7519959">n</span>&nbsp;<span class="op" id="7519961">&gt;=</span>&nbsp;<span class="ident" id="7519964">maxReadThreshold</span>&nbsp;<span class="op" id="7519981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519985">mr</span><span class="op" id="7519987">.</span><span class="ident" id="7519988">t</span><span class="op" id="7519989">.</span><span class="ident" id="7519990">Fatal</span><span class="op" id="7519995">(</span><span class="string" id="7519996">&#34;too&nbsp;much&nbsp;was&nbsp;read&#34;</span><span class="op" id="7520015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7520019">return</span>&nbsp;<span class="num" id="7520026">0</span><span class="op" id="7520027">,</span>&nbsp;<span class="ident" id="7520029">io</span><span class="op" id="7520031">.</span><span class="ident" id="7520032">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520037">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7520040">return</span>&nbsp;<span class="builtinfunc" id="7520047">len</span><span class="op" id="7520050">(</span><span class="ident" id="7520051">b</span><span class="op" id="7520052">)</span><span class="op" id="7520053">,</span>&nbsp;<span class="ident" id="7520055">nil</span><br>
<span class="lineno"></span><span class="op" id="7520059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7520062">func</span>&nbsp;<span class="ident" id="7520067">TestLineLimit</span><span class="op" id="7520080">(</span><span class="ident" id="7520081">t</span>&nbsp;<span class="op" id="7520083">*</span><span class="ident" id="7520084">testing</span><span class="op" id="7520091">.</span><span class="ident" id="7520092">T</span><span class="op" id="7520093">)</span>&nbsp;<span class="op" id="7520095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520098">mr</span>&nbsp;<span class="op" id="7520101">:=</span>&nbsp;<span class="op" id="7520104">&amp;</span><span class="ident" id="7520105">maliciousReader</span><span class="op" id="7520120">{</span><span class="ident" id="7520121">t</span><span class="op" id="7520122">:</span>&nbsp;<span class="ident" id="7520124">t</span><span class="op" id="7520125">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520128">r</span>&nbsp;<span class="op" id="7520130">:=</span>&nbsp;<span class="ident" id="7520133">NewReader</span><span class="op" id="7520142">(</span><span class="ident" id="7520143">mr</span><span class="op" id="7520145">,</span>&nbsp;<span class="string" id="7520147">&#34;fooBoundary&#34;</span><span class="op" id="7520160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520163">part</span><span class="op" id="7520167">,</span>&nbsp;<span class="ident" id="7520169">err</span>&nbsp;<span class="op" id="7520173">:=</span>&nbsp;<span class="ident" id="7520176">r</span><span class="op" id="7520177">.</span><span class="ident" id="7520178">NextPart</span><span class="op" id="7520186">(</span><span class="op" id="7520187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7520190">if</span>&nbsp;<span class="ident" id="7520193">part</span>&nbsp;<span class="op" id="7520198">!=</span>&nbsp;<span class="ident" id="7520201">nil</span>&nbsp;<span class="op" id="7520205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520209">t</span><span class="op" id="7520210">.</span><span class="ident" id="7520211">Errorf</span><span class="op" id="7520217">(</span><span class="string" id="7520218">&#34;unexpected&nbsp;part&nbsp;read&#34;</span><span class="op" id="7520240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520243">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7520246">if</span>&nbsp;<span class="ident" id="7520249">err</span>&nbsp;<span class="op" id="7520253">==</span>&nbsp;<span class="ident" id="7520256">nil</span>&nbsp;<span class="op" id="7520260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520264">t</span><span class="op" id="7520265">.</span><span class="ident" id="7520266">Errorf</span><span class="op" id="7520272">(</span><span class="string" id="7520273">&#34;expected&nbsp;an&nbsp;error&#34;</span><span class="op" id="7520292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7520298">if</span>&nbsp;<span class="ident" id="7520301">mr</span><span class="op" id="7520303">.</span><span class="ident" id="7520304">n</span>&nbsp;<span class="op" id="7520306">&gt;=</span>&nbsp;<span class="ident" id="7520309">maxReadThreshold</span>&nbsp;<span class="op" id="7520326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520330">t</span><span class="op" id="7520331">.</span><span class="ident" id="7520332">Errorf</span><span class="op" id="7520338">(</span><span class="string" id="7520339">&#34;expected&nbsp;to&nbsp;read&nbsp;&lt;&nbsp;%d&nbsp;bytes;&nbsp;read&nbsp;%d&#34;</span><span class="op" id="7520377">,</span>&nbsp;<span class="ident" id="7520379">maxReadThreshold</span><span class="op" id="7520395">,</span>&nbsp;<span class="ident" id="7520397">mr</span><span class="op" id="7520399">.</span><span class="ident" id="7520400">n</span><span class="op" id="7520401">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520404">}</span><br>
<span class="lineno"></span><span class="op" id="7520406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7520409">func</span>&nbsp;<span class="ident" id="7520414">TestMultipartTruncated</span><span class="op" id="7520436">(</span><span class="ident" id="7520437">t</span>&nbsp;<span class="op" id="7520439">*</span><span class="ident" id="7520440">testing</span><span class="op" id="7520447">.</span><span class="ident" id="7520448">T</span><span class="op" id="7520449">)</span>&nbsp;<span class="op" id="7520451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520454">testBody</span>&nbsp;<span class="op" id="7520463">:=</span>&nbsp;<span class="string" id="7520466">`<br>
<span class="lineno">295</span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno"></span>Oh&nbsp;no,&nbsp;premature&nbsp;EOF!<br>
<span class="lineno">300</span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520573">body</span>&nbsp;<span class="op" id="7520578">:=</span>&nbsp;<span class="ident" id="7520581">strings</span><span class="op" id="7520588">.</span><span class="ident" id="7520589">Replace</span><span class="op" id="7520596">(</span><span class="ident" id="7520597">testBody</span><span class="op" id="7520605">,</span>&nbsp;<span class="string" id="7520607">&#34;\n&#34;</span><span class="op" id="7520611">,</span>&nbsp;<span class="string" id="7520613">&#34;\r\n&#34;</span><span class="op" id="7520619">,</span>&nbsp;<span class="op" id="7520621">-</span><span class="num" id="7520622">1</span><span class="op" id="7520623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520626">bodyReader</span>&nbsp;<span class="op" id="7520637">:=</span>&nbsp;<span class="ident" id="7520640">strings</span><span class="op" id="7520647">.</span><span class="ident" id="7520648">NewReader</span><span class="op" id="7520657">(</span><span class="ident" id="7520658">body</span><span class="op" id="7520662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520665">r</span>&nbsp;<span class="op" id="7520667">:=</span>&nbsp;<span class="ident" id="7520670">NewReader</span><span class="op" id="7520679">(</span><span class="ident" id="7520680">bodyReader</span><span class="op" id="7520690">,</span>&nbsp;<span class="string" id="7520692">&#34;MyBoundary&#34;</span><span class="op" id="7520704">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520708">part</span><span class="op" id="7520712">,</span>&nbsp;<span class="ident" id="7520714">err</span>&nbsp;<span class="op" id="7520718">:=</span>&nbsp;<span class="ident" id="7520721">r</span><span class="op" id="7520722">.</span><span class="ident" id="7520723">NextPart</span><span class="op" id="7520731">(</span><span class="op" id="7520732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7520735">if</span>&nbsp;<span class="ident" id="7520738">err</span>&nbsp;<span class="op" id="7520742">!=</span>&nbsp;<span class="ident" id="7520745">nil</span>&nbsp;<span class="op" id="7520749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520753">t</span><span class="op" id="7520754">.</span><span class="ident" id="7520755">Fatalf</span><span class="op" id="7520761">(</span><span class="string" id="7520762">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="7520781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520787">_</span><span class="op" id="7520788">,</span>&nbsp;<span class="ident" id="7520790">err</span>&nbsp;<span class="op" id="7520794">=</span>&nbsp;<span class="ident" id="7520796">io</span><span class="op" id="7520798">.</span><span class="ident" id="7520799">Copy</span><span class="op" id="7520803">(</span><span class="ident" id="7520804">ioutil</span><span class="op" id="7520810">.</span><span class="ident" id="7520811">Discard</span><span class="op" id="7520818">,</span>&nbsp;<span class="ident" id="7520820">part</span><span class="op" id="7520824">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7520827">if</span>&nbsp;<span class="ident" id="7520830">err</span>&nbsp;<span class="op" id="7520834">!=</span>&nbsp;<span class="ident" id="7520837">io</span><span class="op" id="7520839">.</span><span class="ident" id="7520840">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="7520857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520861">t</span><span class="op" id="7520862">.</span><span class="ident" id="7520863">Fatalf</span><span class="op" id="7520869">(</span><span class="string" id="7520870">&#34;expected&nbsp;error&nbsp;io.ErrUnexpectedEOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7520914">,</span>&nbsp;<span class="ident" id="7520916">err</span><span class="op" id="7520919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520922">}</span><br>
<span class="lineno"></span><span class="op" id="7520924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="7520927">type</span>&nbsp;<span class="ident" id="7520932">slowReader</span>&nbsp;<span class="keyword" id="7520943">struct</span>&nbsp;<span class="op" id="7520950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520953">r</span>&nbsp;<span class="ident" id="7520955">io</span><span class="op" id="7520957">.</span><span class="ident" id="7520958">Reader</span><br>
<span class="lineno"></span><span class="op" id="7520965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7520968">func</span>&nbsp;<span class="op" id="7520973">(</span><span class="ident" id="7520974">s</span>&nbsp;<span class="op" id="7520976">*</span><span class="ident" id="7520977">slowReader</span><span class="op" id="7520987">)</span>&nbsp;<span class="ident" id="7520989">Read</span><span class="op" id="7520993">(</span><span class="ident" id="7520994">p</span>&nbsp;<span class="op" id="7520996">[</span><span class="op" id="7520997">]</span><span class="builtintype" id="7520998">byte</span><span class="op" id="7521002">)</span>&nbsp;<span class="op" id="7521004">(</span><span class="builtintype" id="7521005">int</span><span class="op" id="7521008">,</span>&nbsp;<span class="builtintype" id="7521010">error</span><span class="op" id="7521015">)</span>&nbsp;<span class="op" id="7521017">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521020">if</span>&nbsp;<span class="builtinfunc" id="7521023">len</span><span class="op" id="7521026">(</span><span class="ident" id="7521027">p</span><span class="op" id="7521028">)</span>&nbsp;<span class="op" id="7521030">==</span>&nbsp;<span class="num" id="7521033">0</span>&nbsp;<span class="op" id="7521035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521039">return</span>&nbsp;<span class="ident" id="7521046">s</span><span class="op" id="7521047">.</span><span class="ident" id="7521048">r</span><span class="op" id="7521049">.</span><span class="ident" id="7521050">Read</span><span class="op" id="7521054">(</span><span class="ident" id="7521055">p</span><span class="op" id="7521056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521062">return</span>&nbsp;<span class="ident" id="7521069">s</span><span class="op" id="7521070">.</span><span class="ident" id="7521071">r</span><span class="op" id="7521072">.</span><span class="ident" id="7521073">Read</span><span class="op" id="7521077">(</span><span class="ident" id="7521078">p</span><span class="op" id="7521079">[</span><span class="op" id="7521080">:</span><span class="num" id="7521081">1</span><span class="op" id="7521082">]</span><span class="op" id="7521083">)</span><br>
<span class="lineno"></span><span class="op" id="7521085">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="7521088">func</span>&nbsp;<span class="ident" id="7521093">TestLineContinuation</span><span class="op" id="7521113">(</span><span class="ident" id="7521114">t</span>&nbsp;<span class="op" id="7521116">*</span><span class="ident" id="7521117">testing</span><span class="op" id="7521124">.</span><span class="ident" id="7521125">T</span><span class="op" id="7521126">)</span>&nbsp;<span class="op" id="7521128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7521131">//&nbsp;This&nbsp;body,&nbsp;extracted&nbsp;from&nbsp;an&nbsp;email,&nbsp;contains&nbsp;headers&nbsp;that&nbsp;span&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7521207">//&nbsp;lines.</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7521219">//&nbsp;TODO:&nbsp;The&nbsp;original&nbsp;mail&nbsp;ended&nbsp;with&nbsp;a&nbsp;double-newline&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7521286">//&nbsp;final&nbsp;delimiter;&nbsp;this&nbsp;was&nbsp;manually&nbsp;edited&nbsp;to&nbsp;use&nbsp;a&nbsp;CRLF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521347">testBody</span>&nbsp;<span class="op" id="7521356">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7521361">&#34;\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;7bit\nContent-Type:&nbsp;text/plain;\n\tcharset=US-ASCII;\n\tdelsp=yes;\n\tformat=flowed\n\nI&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;happening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).\n\n\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;quoted-printable\nContent-Type:&nbsp;text/html;\n\tcharset=ISO-8859-1\n\n&lt;HTML&gt;&lt;BODY&gt;I&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;=\nhappening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).=A0&nbsp;But&nbsp;I&nbsp;built&nbsp;it&nbsp;with&nbsp;XCode&nbsp;=\n2.0.&lt;/BODY&gt;&lt;/=\nHTML&gt;=\n\r\n--Apple-Mail-2-292336769--\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521857">r</span>&nbsp;<span class="op" id="7521859">:=</span>&nbsp;<span class="ident" id="7521862">NewReader</span><span class="op" id="7521871">(</span><span class="ident" id="7521872">strings</span><span class="op" id="7521879">.</span><span class="ident" id="7521880">NewReader</span><span class="op" id="7521889">(</span><span class="ident" id="7521890">testBody</span><span class="op" id="7521898">)</span><span class="op" id="7521899">,</span>&nbsp;<span class="string" id="7521901">&#34;Apple-Mail-2-292336769&#34;</span><span class="op" id="7521925">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521929">for</span>&nbsp;<span class="ident" id="7521933">i</span>&nbsp;<span class="op" id="7521935">:=</span>&nbsp;<span class="num" id="7521938">0</span><span class="op" id="7521939">;</span>&nbsp;<span class="ident" id="7521941">i</span>&nbsp;<span class="op" id="7521943">&lt;</span>&nbsp;<span class="num" id="7521945">2</span><span class="op" id="7521946">;</span>&nbsp;<span class="ident" id="7521948">i</span><span class="op" id="7521949">++</span>&nbsp;<span class="op" id="7521952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521956">part</span><span class="op" id="7521960">,</span>&nbsp;<span class="ident" id="7521962">err</span>&nbsp;<span class="op" id="7521966">:=</span>&nbsp;<span class="ident" id="7521969">r</span><span class="op" id="7521970">.</span><span class="ident" id="7521971">NextPart</span><span class="op" id="7521979">(</span><span class="op" id="7521980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521984">if</span>&nbsp;<span class="ident" id="7521987">err</span>&nbsp;<span class="op" id="7521991">!=</span>&nbsp;<span class="ident" id="7521994">nil</span>&nbsp;<span class="op" id="7521998">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522003">t</span><span class="op" id="7522004">.</span><span class="ident" id="7522005">Fatalf</span><span class="op" id="7522011">(</span><span class="string" id="7522012">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="7522031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7522039">var</span>&nbsp;<span class="ident" id="7522043">buf</span>&nbsp;<span class="ident" id="7522047">bytes</span><span class="op" id="7522052">.</span><span class="ident" id="7522053">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522062">n</span><span class="op" id="7522063">,</span>&nbsp;<span class="ident" id="7522065">err</span>&nbsp;<span class="op" id="7522069">:=</span>&nbsp;<span class="ident" id="7522072">io</span><span class="op" id="7522074">.</span><span class="ident" id="7522075">Copy</span><span class="op" id="7522079">(</span><span class="op" id="7522080">&amp;</span><span class="ident" id="7522081">buf</span><span class="op" id="7522084">,</span>&nbsp;<span class="ident" id="7522086">part</span><span class="op" id="7522090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7522094">if</span>&nbsp;<span class="ident" id="7522097">err</span>&nbsp;<span class="op" id="7522101">!=</span>&nbsp;<span class="ident" id="7522104">nil</span>&nbsp;<span class="op" id="7522108">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522113">t</span><span class="op" id="7522114">.</span><span class="ident" id="7522115">Errorf</span><span class="op" id="7522121">(</span><span class="string" id="7522122">&#34;error&nbsp;reading&nbsp;part:&nbsp;%v\nread&nbsp;so&nbsp;far:&nbsp;%q&#34;</span><span class="op" id="7522163">,</span>&nbsp;<span class="ident" id="7522165">err</span><span class="op" id="7522168">,</span>&nbsp;<span class="ident" id="7522170">buf</span><span class="op" id="7522173">.</span><span class="ident" id="7522174">String</span><span class="op" id="7522180">(</span><span class="op" id="7522181">)</span><span class="op" id="7522182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7522190">if</span>&nbsp;<span class="ident" id="7522193">n</span>&nbsp;<span class="op" id="7522195">&lt;=</span>&nbsp;<span class="num" id="7522198">0</span>&nbsp;<span class="op" id="7522200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522205">t</span><span class="op" id="7522206">.</span><span class="ident" id="7522207">Errorf</span><span class="op" id="7522213">(</span><span class="string" id="7522214">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;expected&nbsp;&gt;0&#34;</span><span class="op" id="7522242">,</span>&nbsp;<span class="ident" id="7522244">n</span><span class="op" id="7522245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522249">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522252">}</span><br>
<span class="lineno"></span><span class="op" id="7522254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7522257">func</span>&nbsp;<span class="ident" id="7522262">TestQuotedPrintableEncoding</span><span class="op" id="7522289">(</span><span class="ident" id="7522290">t</span>&nbsp;<span class="op" id="7522292">*</span><span class="ident" id="7522293">testing</span><span class="op" id="7522300">.</span><span class="ident" id="7522301">T</span><span class="op" id="7522302">)</span>&nbsp;<span class="op" id="7522304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7522307">//&nbsp;From&nbsp;http://golang.org/issue/4411</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522345">body</span>&nbsp;<span class="op" id="7522350">:=</span>&nbsp;<span class="string" id="7522353">&#34;--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=text\r\nContent-Transfer-Encoding:&nbsp;quoted-printable\r\n\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words\r\n--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--0016e68ee29c5d515f04cedf6733--&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523087">r</span>&nbsp;<span class="op" id="7523089">:=</span>&nbsp;<span class="ident" id="7523092">NewReader</span><span class="op" id="7523101">(</span><span class="ident" id="7523102">strings</span><span class="op" id="7523109">.</span><span class="ident" id="7523110">NewReader</span><span class="op" id="7523119">(</span><span class="ident" id="7523120">body</span><span class="op" id="7523124">)</span><span class="op" id="7523125">,</span>&nbsp;<span class="string" id="7523127">&#34;0016e68ee29c5d515f04cedf6733&#34;</span><span class="op" id="7523157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523160">part</span><span class="op" id="7523164">,</span>&nbsp;<span class="ident" id="7523166">err</span>&nbsp;<span class="op" id="7523170">:=</span>&nbsp;<span class="ident" id="7523173">r</span><span class="op" id="7523174">.</span><span class="ident" id="7523175">NextPart</span><span class="op" id="7523183">(</span><span class="op" id="7523184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523187">if</span>&nbsp;<span class="ident" id="7523190">err</span>&nbsp;<span class="op" id="7523194">!=</span>&nbsp;<span class="ident" id="7523197">nil</span>&nbsp;<span class="op" id="7523201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523205">t</span><span class="op" id="7523206">.</span><span class="ident" id="7523207">Fatal</span><span class="op" id="7523212">(</span><span class="ident" id="7523213">err</span><span class="op" id="7523216">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523222">if</span>&nbsp;<span class="ident" id="7523225">te</span><span class="op" id="7523227">,</span>&nbsp;<span class="ident" id="7523229">ok</span>&nbsp;<span class="op" id="7523232">:=</span>&nbsp;<span class="ident" id="7523235">part</span><span class="op" id="7523239">.</span><span class="ident" id="7523240">Header</span><span class="op" id="7523246">[</span><span class="string" id="7523247">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="7523274">]</span><span class="op" id="7523275">;</span>&nbsp;<span class="ident" id="7523277">ok</span>&nbsp;<span class="op" id="7523280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523284">t</span><span class="op" id="7523285">.</span><span class="ident" id="7523286">Errorf</span><span class="op" id="7523292">(</span><span class="string" id="7523293">&#34;unexpected&nbsp;Content-Transfer-Encoding&nbsp;of&nbsp;%q&#34;</span><span class="op" id="7523337">,</span>&nbsp;<span class="ident" id="7523339">te</span><span class="op" id="7523341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523347">var</span>&nbsp;<span class="ident" id="7523351">buf</span>&nbsp;<span class="ident" id="7523355">bytes</span><span class="op" id="7523360">.</span><span class="ident" id="7523361">Buffer</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523369">_</span><span class="op" id="7523370">,</span>&nbsp;<span class="ident" id="7523372">err</span>&nbsp;<span class="op" id="7523376">=</span>&nbsp;<span class="ident" id="7523378">io</span><span class="op" id="7523380">.</span><span class="ident" id="7523381">Copy</span><span class="op" id="7523385">(</span><span class="op" id="7523386">&amp;</span><span class="ident" id="7523387">buf</span><span class="op" id="7523390">,</span>&nbsp;<span class="ident" id="7523392">part</span><span class="op" id="7523396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523399">if</span>&nbsp;<span class="ident" id="7523402">err</span>&nbsp;<span class="op" id="7523406">!=</span>&nbsp;<span class="ident" id="7523409">nil</span>&nbsp;<span class="op" id="7523413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523417">t</span><span class="op" id="7523418">.</span><span class="ident" id="7523419">Error</span><span class="op" id="7523424">(</span><span class="ident" id="7523425">err</span><span class="op" id="7523428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523434">got</span>&nbsp;<span class="op" id="7523438">:=</span>&nbsp;<span class="ident" id="7523441">buf</span><span class="op" id="7523444">.</span><span class="ident" id="7523445">String</span><span class="op" id="7523451">(</span><span class="op" id="7523452">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523455">want</span>&nbsp;<span class="op" id="7523460">:=</span>&nbsp;<span class="string" id="7523463">&#34;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523820">if</span>&nbsp;<span class="ident" id="7523823">got</span>&nbsp;<span class="op" id="7523827">!=</span>&nbsp;<span class="ident" id="7523830">want</span>&nbsp;<span class="op" id="7523835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523839">t</span><span class="op" id="7523840">.</span><span class="ident" id="7523841">Errorf</span><span class="op" id="7523847">(</span><span class="string" id="7523848">&#34;wrong&nbsp;part&nbsp;value:\n&nbsp;got:&nbsp;%q\nwant:&nbsp;%q&#34;</span><span class="op" id="7523887">,</span>&nbsp;<span class="ident" id="7523889">got</span><span class="op" id="7523892">,</span>&nbsp;<span class="ident" id="7523894">want</span><span class="op" id="7523898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523901">}</span><br>
<span class="lineno"></span><span class="op" id="7523903">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="7523906">//&nbsp;Test&nbsp;parsing&nbsp;an&nbsp;image&nbsp;attachment&nbsp;from&nbsp;gmail,&nbsp;which&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="7523979">func</span>&nbsp;<span class="ident" id="7523984">TestNested</span><span class="op" id="7523994">(</span><span class="ident" id="7523995">t</span>&nbsp;<span class="op" id="7523997">*</span><span class="ident" id="7523998">testing</span><span class="op" id="7524005">.</span><span class="ident" id="7524006">T</span><span class="op" id="7524007">)</span>&nbsp;<span class="op" id="7524009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7524012">//&nbsp;nested-mime&nbsp;is&nbsp;the&nbsp;body&nbsp;part&nbsp;of&nbsp;a&nbsp;multipart/mixed&nbsp;email</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7524072">//&nbsp;with&nbsp;boundary&nbsp;e89a8ff1c1e83553e304be640612</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524119">f</span><span class="op" id="7524120">,</span>&nbsp;<span class="ident" id="7524122">err</span>&nbsp;<span class="op" id="7524126">:=</span>&nbsp;<span class="ident" id="7524129">os</span><span class="op" id="7524131">.</span><span class="ident" id="7524132">Open</span><span class="op" id="7524136">(</span><span class="string" id="7524137">&#34;testdata/nested-mime&#34;</span><span class="op" id="7524159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524162">if</span>&nbsp;<span class="ident" id="7524165">err</span>&nbsp;<span class="op" id="7524169">!=</span>&nbsp;<span class="ident" id="7524172">nil</span>&nbsp;<span class="op" id="7524176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524180">t</span><span class="op" id="7524181">.</span><span class="ident" id="7524182">Fatal</span><span class="op" id="7524187">(</span><span class="ident" id="7524188">err</span><span class="op" id="7524191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524197">defer</span>&nbsp;<span class="ident" id="7524203">f</span><span class="op" id="7524204">.</span><span class="ident" id="7524205">Close</span><span class="op" id="7524210">(</span><span class="op" id="7524211">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524214">mr</span>&nbsp;<span class="op" id="7524217">:=</span>&nbsp;<span class="ident" id="7524220">NewReader</span><span class="op" id="7524229">(</span><span class="ident" id="7524230">f</span><span class="op" id="7524231">,</span>&nbsp;<span class="string" id="7524233">&#34;e89a8ff1c1e83553e304be640612&#34;</span><span class="op" id="7524263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524266">p</span><span class="op" id="7524267">,</span>&nbsp;<span class="ident" id="7524269">err</span>&nbsp;<span class="op" id="7524273">:=</span>&nbsp;<span class="ident" id="7524276">mr</span><span class="op" id="7524278">.</span><span class="ident" id="7524279">NextPart</span><span class="op" id="7524287">(</span><span class="op" id="7524288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524291">if</span>&nbsp;<span class="ident" id="7524294">err</span>&nbsp;<span class="op" id="7524298">!=</span>&nbsp;<span class="ident" id="7524301">nil</span>&nbsp;<span class="op" id="7524305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524309">t</span><span class="op" id="7524310">.</span><span class="ident" id="7524311">Fatalf</span><span class="op" id="7524317">(</span><span class="string" id="7524318">&#34;error&nbsp;reading&nbsp;first&nbsp;section&nbsp;(alternative):&nbsp;%v&#34;</span><span class="op" id="7524365">,</span>&nbsp;<span class="ident" id="7524367">err</span><span class="op" id="7524370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524373">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7524377">//&nbsp;Read&nbsp;the&nbsp;inner&nbsp;text/plain&nbsp;and&nbsp;text/html&nbsp;sections&nbsp;of&nbsp;the&nbsp;multipart/alternative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524460">mr2</span>&nbsp;<span class="op" id="7524464">:=</span>&nbsp;<span class="ident" id="7524467">NewReader</span><span class="op" id="7524476">(</span><span class="ident" id="7524477">p</span><span class="op" id="7524478">,</span>&nbsp;<span class="string" id="7524480">&#34;e89a8ff1c1e83553e004be640610&#34;</span><span class="op" id="7524510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524513">p</span><span class="op" id="7524514">,</span>&nbsp;<span class="ident" id="7524516">err</span>&nbsp;<span class="op" id="7524520">=</span>&nbsp;<span class="ident" id="7524522">mr2</span><span class="op" id="7524525">.</span><span class="ident" id="7524526">NextPart</span><span class="op" id="7524534">(</span><span class="op" id="7524535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524538">if</span>&nbsp;<span class="ident" id="7524541">err</span>&nbsp;<span class="op" id="7524545">!=</span>&nbsp;<span class="ident" id="7524548">nil</span>&nbsp;<span class="op" id="7524552">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524556">t</span><span class="op" id="7524557">.</span><span class="ident" id="7524558">Fatalf</span><span class="op" id="7524564">(</span><span class="string" id="7524565">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="7524594">,</span>&nbsp;<span class="ident" id="7524596">err</span><span class="op" id="7524599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524605">if</span>&nbsp;<span class="ident" id="7524608">b</span><span class="op" id="7524609">,</span>&nbsp;<span class="ident" id="7524611">err</span>&nbsp;<span class="op" id="7524615">:=</span>&nbsp;<span class="ident" id="7524618">ioutil</span><span class="op" id="7524624">.</span><span class="ident" id="7524625">ReadAll</span><span class="op" id="7524632">(</span><span class="ident" id="7524633">p</span><span class="op" id="7524634">)</span><span class="op" id="7524635">;</span>&nbsp;<span class="builtintype" id="7524637">string</span><span class="op" id="7524643">(</span><span class="ident" id="7524644">b</span><span class="op" id="7524645">)</span>&nbsp;<span class="op" id="7524647">!=</span>&nbsp;<span class="string" id="7524650">&#34;*body*\r\n&#34;</span>&nbsp;<span class="op" id="7524663">||</span>&nbsp;<span class="ident" id="7524666">err</span>&nbsp;<span class="op" id="7524670">!=</span>&nbsp;<span class="ident" id="7524673">nil</span>&nbsp;<span class="op" id="7524677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524681">t</span><span class="op" id="7524682">.</span><span class="ident" id="7524683">Fatalf</span><span class="op" id="7524689">(</span><span class="string" id="7524690">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="7524727">,</span>&nbsp;<span class="ident" id="7524729">b</span><span class="op" id="7524730">,</span>&nbsp;<span class="ident" id="7524732">err</span><span class="op" id="7524735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524738">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524741">p</span><span class="op" id="7524742">,</span>&nbsp;<span class="ident" id="7524744">err</span>&nbsp;<span class="op" id="7524748">=</span>&nbsp;<span class="ident" id="7524750">mr2</span><span class="op" id="7524753">.</span><span class="ident" id="7524754">NextPart</span><span class="op" id="7524762">(</span><span class="op" id="7524763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524766">if</span>&nbsp;<span class="ident" id="7524769">err</span>&nbsp;<span class="op" id="7524773">!=</span>&nbsp;<span class="ident" id="7524776">nil</span>&nbsp;<span class="op" id="7524780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524784">t</span><span class="op" id="7524785">.</span><span class="ident" id="7524786">Fatalf</span><span class="op" id="7524792">(</span><span class="string" id="7524793">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="7524821">,</span>&nbsp;<span class="ident" id="7524823">err</span><span class="op" id="7524826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524832">if</span>&nbsp;<span class="ident" id="7524835">b</span><span class="op" id="7524836">,</span>&nbsp;<span class="ident" id="7524838">err</span>&nbsp;<span class="op" id="7524842">:=</span>&nbsp;<span class="ident" id="7524845">ioutil</span><span class="op" id="7524851">.</span><span class="ident" id="7524852">ReadAll</span><span class="op" id="7524859">(</span><span class="ident" id="7524860">p</span><span class="op" id="7524861">)</span><span class="op" id="7524862">;</span>&nbsp;<span class="builtintype" id="7524864">string</span><span class="op" id="7524870">(</span><span class="ident" id="7524871">b</span><span class="op" id="7524872">)</span>&nbsp;<span class="op" id="7524874">!=</span>&nbsp;<span class="string" id="7524877">&#34;&lt;b&gt;body&lt;/b&gt;\r\n&#34;</span>&nbsp;<span class="op" id="7524895">||</span>&nbsp;<span class="ident" id="7524898">err</span>&nbsp;<span class="op" id="7524902">!=</span>&nbsp;<span class="ident" id="7524905">nil</span>&nbsp;<span class="op" id="7524909">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524913">t</span><span class="op" id="7524914">.</span><span class="ident" id="7524915">Fatalf</span><span class="op" id="7524921">(</span><span class="string" id="7524922">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="7524958">,</span>&nbsp;<span class="ident" id="7524960">b</span><span class="op" id="7524961">,</span>&nbsp;<span class="ident" id="7524963">err</span><span class="op" id="7524966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524973">p</span><span class="op" id="7524974">,</span>&nbsp;<span class="ident" id="7524976">err</span>&nbsp;<span class="op" id="7524980">=</span>&nbsp;<span class="ident" id="7524982">mr2</span><span class="op" id="7524985">.</span><span class="ident" id="7524986">NextPart</span><span class="op" id="7524994">(</span><span class="op" id="7524995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524998">if</span>&nbsp;<span class="ident" id="7525001">err</span>&nbsp;<span class="op" id="7525005">!=</span>&nbsp;<span class="ident" id="7525008">io</span><span class="op" id="7525010">.</span><span class="ident" id="7525011">EOF</span>&nbsp;<span class="op" id="7525015">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525019">t</span><span class="op" id="7525020">.</span><span class="ident" id="7525021">Fatalf</span><span class="op" id="7525027">(</span><span class="string" id="7525028">&#34;final&nbsp;inner&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="7525068">,</span>&nbsp;<span class="ident" id="7525070">err</span><span class="op" id="7525073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7525080">//&nbsp;Back&nbsp;to&nbsp;the&nbsp;outer&nbsp;multipart/mixed,&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525149">_</span><span class="op" id="7525150">,</span>&nbsp;<span class="ident" id="7525152">err</span>&nbsp;<span class="op" id="7525156">=</span>&nbsp;<span class="ident" id="7525158">mr</span><span class="op" id="7525160">.</span><span class="ident" id="7525161">NextPart</span><span class="op" id="7525169">(</span><span class="op" id="7525170">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525173">if</span>&nbsp;<span class="ident" id="7525176">err</span>&nbsp;<span class="op" id="7525180">!=</span>&nbsp;<span class="ident" id="7525183">nil</span>&nbsp;<span class="op" id="7525187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525191">t</span><span class="op" id="7525192">.</span><span class="ident" id="7525193">Fatalf</span><span class="op" id="7525199">(</span><span class="string" id="7525200">&#34;error&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment&nbsp;at&nbsp;the&nbsp;end:&nbsp;%v&#34;</span><span class="op" id="7525251">,</span>&nbsp;<span class="ident" id="7525253">err</span><span class="op" id="7525256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525263">_</span><span class="op" id="7525264">,</span>&nbsp;<span class="ident" id="7525266">err</span>&nbsp;<span class="op" id="7525270">=</span>&nbsp;<span class="ident" id="7525272">mr</span><span class="op" id="7525274">.</span><span class="ident" id="7525275">NextPart</span><span class="op" id="7525283">(</span><span class="op" id="7525284">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525287">if</span>&nbsp;<span class="ident" id="7525290">err</span>&nbsp;<span class="op" id="7525294">!=</span>&nbsp;<span class="ident" id="7525297">io</span><span class="op" id="7525299">.</span><span class="ident" id="7525300">EOF</span>&nbsp;<span class="op" id="7525304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525308">t</span><span class="op" id="7525309">.</span><span class="ident" id="7525310">Fatalf</span><span class="op" id="7525316">(</span><span class="string" id="7525317">&#34;final&nbsp;outer&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="7525357">,</span>&nbsp;<span class="ident" id="7525359">err</span><span class="op" id="7525362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525365">}</span><br>
<span class="lineno"></span><span class="op" id="7525367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span><span class="keyword" id="7525370">type</span>&nbsp;<span class="ident" id="7525375">headerBody</span>&nbsp;<span class="keyword" id="7525386">struct</span>&nbsp;<span class="op" id="7525393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525396">header</span>&nbsp;<span class="ident" id="7525403">textproto</span><span class="op" id="7525412">.</span><span class="ident" id="7525413">MIMEHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525425">body</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7525432">string</span><br>
<span class="lineno"></span><span class="op" id="7525439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="7525442">func</span>&nbsp;<span class="ident" id="7525447">formData</span><span class="op" id="7525455">(</span><span class="ident" id="7525456">key</span><span class="op" id="7525459">,</span>&nbsp;<span class="ident" id="7525461">value</span>&nbsp;<span class="builtintype" id="7525467">string</span><span class="op" id="7525473">)</span>&nbsp;<span class="ident" id="7525475">headerBody</span>&nbsp;<span class="op" id="7525486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525489">return</span>&nbsp;<span class="ident" id="7525496">headerBody</span><span class="op" id="7525506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525510">textproto</span><span class="op" id="7525519">.</span><span class="ident" id="7525520">MIMEHeader</span><span class="op" id="7525530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7525535">&#34;Content-Type&#34;</span><span class="op" id="7525549">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7525558">{</span><span class="string" id="7525559">&#34;text/plain;&nbsp;charset=ISO-8859-1&#34;</span><span class="op" id="7525591">}</span><span class="op" id="7525592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7525597">&#34;Content-Disposition&#34;</span><span class="op" id="7525618">:</span>&nbsp;<span class="op" id="7525620">{</span><span class="string" id="7525621">&#34;form-data;&nbsp;name=&#34;</span>&nbsp;<span class="op" id="7525640">+</span>&nbsp;<span class="ident" id="7525642">key</span><span class="op" id="7525645">}</span><span class="op" id="7525646">,</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525650">}</span><span class="op" id="7525651">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525655">value</span><span class="op" id="7525660">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525663">}</span><br>
<span class="lineno"></span><span class="op" id="7525665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="keyword" id="7525668">type</span>&nbsp;<span class="ident" id="7525673">parseTest</span>&nbsp;<span class="keyword" id="7525683">struct</span>&nbsp;<span class="op" id="7525690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525693">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7525701">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525709">in</span><span class="op" id="7525711">,</span>&nbsp;<span class="ident" id="7525713">sep</span>&nbsp;<span class="builtintype" id="7525717">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525725">want</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7525733">[</span><span class="op" id="7525734">]</span><span class="ident" id="7525735">headerBody</span><br>
<span class="lineno"></span><span class="op" id="7525746">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="7525749">var</span>&nbsp;<span class="ident" id="7525753">parseTests</span>&nbsp;<span class="op" id="7525764">=</span>&nbsp;<span class="op" id="7525766">[</span><span class="op" id="7525767">]</span><span class="ident" id="7525768">parseTest</span><span class="op" id="7525777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7525780">//&nbsp;Actual&nbsp;body&nbsp;from&nbsp;App&nbsp;Engine&nbsp;on&nbsp;a&nbsp;blob&nbsp;upload.&nbsp;The&nbsp;final&nbsp;part&nbsp;(the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7525850">//&nbsp;Content-Type:&nbsp;message/external-body)&nbsp;is&nbsp;what&nbsp;App&nbsp;Engine&nbsp;replaces</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7525919">//&nbsp;the&nbsp;uploaded&nbsp;file&nbsp;with.&nbsp;&nbsp;The&nbsp;other&nbsp;form&nbsp;fields&nbsp;(prefixed&nbsp;with</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7525985">//&nbsp;&#34;other&#34;&nbsp;in&nbsp;their&nbsp;form-data&nbsp;name)&nbsp;are&nbsp;unchanged.&nbsp;&nbsp;A&nbsp;bug&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7526048">//&nbsp;reported&nbsp;with&nbsp;blob&nbsp;uploads&nbsp;failing&nbsp;when&nbsp;the&nbsp;other&nbsp;fields&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7526114">//&nbsp;empty.&nbsp;This&nbsp;was&nbsp;the&nbsp;MIME&nbsp;POST&nbsp;body&nbsp;that&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7526177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7526181">name</span><span class="op" id="7526185">:</span>&nbsp;<span class="string" id="7526187">&#34;App&nbsp;Engine&nbsp;post&#34;</span><span class="op" id="7526204">,</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7526208">sep</span><span class="op" id="7526211">:</span>&nbsp;&nbsp;<span class="string" id="7526214">&#34;00151757727e9583fd04bfbca4c6&#34;</span><span class="op" id="7526244">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7526248">in</span><span class="op" id="7526250">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7526254">&#34;--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty1\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo1\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo2\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty2\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\nContent-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n\r\n--00151757727e9583fd04bfbca4c6--&#34;</span><span class="op" id="7528162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7528166">want</span><span class="op" id="7528170">:</span>&nbsp;<span class="op" id="7528172">[</span><span class="op" id="7528173">]</span><span class="ident" id="7528174">headerBody</span><span class="op" id="7528184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7528189">formData</span><span class="op" id="7528197">(</span><span class="string" id="7528198">&#34;otherEmpty1&#34;</span><span class="op" id="7528211">,</span>&nbsp;<span class="string" id="7528213">&#34;&#34;</span><span class="op" id="7528215">)</span><span class="op" id="7528216">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7528221">formData</span><span class="op" id="7528229">(</span><span class="string" id="7528230">&#34;otherFoo1&#34;</span><span class="op" id="7528241">,</span>&nbsp;<span class="string" id="7528243">&#34;foo&#34;</span><span class="op" id="7528248">)</span><span class="op" id="7528249">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7528254">formData</span><span class="op" id="7528262">(</span><span class="string" id="7528263">&#34;otherFoo2&#34;</span><span class="op" id="7528274">,</span>&nbsp;<span class="string" id="7528276">&#34;foo&#34;</span><span class="op" id="7528281">)</span><span class="op" id="7528282">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7528287">formData</span><span class="op" id="7528295">(</span><span class="string" id="7528296">&#34;otherEmpty2&#34;</span><span class="op" id="7528309">,</span>&nbsp;<span class="string" id="7528311">&#34;&#34;</span><span class="op" id="7528313">)</span><span class="op" id="7528314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7528319">formData</span><span class="op" id="7528327">(</span><span class="string" id="7528328">&#34;otherRepeatFoo&#34;</span><span class="op" id="7528344">,</span>&nbsp;<span class="string" id="7528346">&#34;foo&#34;</span><span class="op" id="7528351">)</span><span class="op" id="7528352">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7528357">formData</span><span class="op" id="7528365">(</span><span class="string" id="7528366">&#34;otherRepeatFoo&#34;</span><span class="op" id="7528382">,</span>&nbsp;<span class="string" id="7528384">&#34;foo&#34;</span><span class="op" id="7528389">)</span><span class="op" id="7528390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7528395">formData</span><span class="op" id="7528403">(</span><span class="string" id="7528404">&#34;otherRepeatEmpty&#34;</span><span class="op" id="7528422">,</span>&nbsp;<span class="string" id="7528424">&#34;&#34;</span><span class="op" id="7528426">)</span><span class="op" id="7528427">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7528432">formData</span><span class="op" id="7528440">(</span><span class="string" id="7528441">&#34;otherRepeatEmpty&#34;</span><span class="op" id="7528459">,</span>&nbsp;<span class="string" id="7528461">&#34;&#34;</span><span class="op" id="7528463">)</span><span class="op" id="7528464">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7528469">formData</span><span class="op" id="7528477">(</span><span class="string" id="7528478">&#34;submit&#34;</span><span class="op" id="7528486">,</span>&nbsp;<span class="string" id="7528488">&#34;Submit&#34;</span><span class="op" id="7528496">)</span><span class="op" id="7528497">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7528502">{</span><span class="ident" id="7528503">textproto</span><span class="op" id="7528512">.</span><span class="ident" id="7528513">MIMEHeader</span><span class="op" id="7528523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7528529">&#34;Content-Type&#34;</span><span class="op" id="7528543">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7528552">{</span><span class="string" id="7528553">&#34;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q&#34;</span><span class="op" id="7528769">}</span><span class="op" id="7528770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7528776">&#34;Content-Disposition&#34;</span><span class="op" id="7528797">:</span>&nbsp;<span class="op" id="7528799">{</span><span class="string" id="7528800">&#34;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;&#34;</span><span class="op" id="7528845">}</span><span class="op" id="7528846">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7528851">}</span><span class="op" id="7528852">,</span>&nbsp;<span class="string" id="7528854">&#34;Content-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n&#34;</span><span class="op" id="7529101">}</span><span class="op" id="7529102">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529106">}</span><span class="op" id="7529107">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529110">}</span><span class="op" id="7529111">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7529115">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7529191">name</span><span class="op" id="7529195">:</span>&nbsp;<span class="string" id="7529197">&#34;single&nbsp;empty&nbsp;part,&nbsp;--boundary&#34;</span><span class="op" id="7529228">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7529232">sep</span><span class="op" id="7529235">:</span>&nbsp;&nbsp;<span class="string" id="7529238">&#34;abc&#34;</span><span class="op" id="7529243">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7529247">in</span><span class="op" id="7529249">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7529253">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&#34;</span><span class="op" id="7529287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7529291">want</span><span class="op" id="7529295">:</span>&nbsp;<span class="op" id="7529297">[</span><span class="op" id="7529298">]</span><span class="ident" id="7529299">headerBody</span><span class="op" id="7529309">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529314">{</span><span class="ident" id="7529315">textproto</span><span class="op" id="7529324">.</span><span class="ident" id="7529325">MIMEHeader</span><span class="op" id="7529335">{</span><span class="string" id="7529336">&#34;Foo&#34;</span><span class="op" id="7529341">:</span>&nbsp;<span class="op" id="7529343">{</span><span class="string" id="7529344">&#34;bar&#34;</span><span class="op" id="7529349">}</span><span class="op" id="7529350">}</span><span class="op" id="7529351">,</span>&nbsp;<span class="string" id="7529353">&#34;&#34;</span><span class="op" id="7529355">}</span><span class="op" id="7529356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529360">}</span><span class="op" id="7529361">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529364">}</span><span class="op" id="7529365">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7529369">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;\r\n--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7529449">name</span><span class="op" id="7529453">:</span>&nbsp;<span class="string" id="7529455">&#34;single&nbsp;empty&nbsp;part,&nbsp;\r\n--boundary&#34;</span><span class="op" id="7529490">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7529494">sep</span><span class="op" id="7529497">:</span>&nbsp;&nbsp;<span class="string" id="7529500">&#34;abc&#34;</span><span class="op" id="7529505">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7529509">in</span><span class="op" id="7529511">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7529515">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n\r\n--abc--&#34;</span><span class="op" id="7529553">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7529557">want</span><span class="op" id="7529561">:</span>&nbsp;<span class="op" id="7529563">[</span><span class="op" id="7529564">]</span><span class="ident" id="7529565">headerBody</span><span class="op" id="7529575">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529580">{</span><span class="ident" id="7529581">textproto</span><span class="op" id="7529590">.</span><span class="ident" id="7529591">MIMEHeader</span><span class="op" id="7529601">{</span><span class="string" id="7529602">&#34;Foo&#34;</span><span class="op" id="7529607">:</span>&nbsp;<span class="op" id="7529609">{</span><span class="string" id="7529610">&#34;bar&#34;</span><span class="op" id="7529615">}</span><span class="op" id="7529616">}</span><span class="op" id="7529617">,</span>&nbsp;<span class="string" id="7529619">&#34;&#34;</span><span class="op" id="7529621">}</span><span class="op" id="7529622">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529626">}</span><span class="op" id="7529627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529630">}</span><span class="op" id="7529631">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7529635">//&nbsp;Final&nbsp;part&nbsp;empty.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7529661">name</span><span class="op" id="7529665">:</span>&nbsp;<span class="string" id="7529667">&#34;final&nbsp;part&nbsp;empty&#34;</span><span class="op" id="7529685">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7529689">sep</span><span class="op" id="7529692">:</span>&nbsp;&nbsp;<span class="string" id="7529695">&#34;abc&#34;</span><span class="op" id="7529700">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7529704">in</span><span class="op" id="7529706">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7529710">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc\r\nFoo2:&nbsp;bar2\r\n\r\n--abc--&#34;</span><span class="op" id="7529771">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7529775">want</span><span class="op" id="7529779">:</span>&nbsp;<span class="op" id="7529781">[</span><span class="op" id="7529782">]</span><span class="ident" id="7529783">headerBody</span><span class="op" id="7529793">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529798">{</span><span class="ident" id="7529799">textproto</span><span class="op" id="7529808">.</span><span class="ident" id="7529809">MIMEHeader</span><span class="op" id="7529819">{</span><span class="string" id="7529820">&#34;Foo&#34;</span><span class="op" id="7529825">:</span>&nbsp;<span class="op" id="7529827">{</span><span class="string" id="7529828">&#34;bar&#34;</span><span class="op" id="7529833">}</span><span class="op" id="7529834">}</span><span class="op" id="7529835">,</span>&nbsp;<span class="string" id="7529837">&#34;&#34;</span><span class="op" id="7529839">}</span><span class="op" id="7529840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529845">{</span><span class="ident" id="7529846">textproto</span><span class="op" id="7529855">.</span><span class="ident" id="7529856">MIMEHeader</span><span class="op" id="7529866">{</span><span class="string" id="7529867">&#34;Foo2&#34;</span><span class="op" id="7529873">:</span>&nbsp;<span class="op" id="7529875">{</span><span class="string" id="7529876">&#34;bar2&#34;</span><span class="op" id="7529882">}</span><span class="op" id="7529883">}</span><span class="op" id="7529884">,</span>&nbsp;<span class="string" id="7529886">&#34;&#34;</span><span class="op" id="7529888">}</span><span class="op" id="7529889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529893">}</span><span class="op" id="7529894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529897">}</span><span class="op" id="7529898">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7529902">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;newlines&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7529964">name</span><span class="op" id="7529968">:</span>&nbsp;<span class="string" id="7529970">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;crlf&#34;</span><span class="op" id="7529998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530002">sep</span><span class="op" id="7530005">:</span>&nbsp;&nbsp;<span class="string" id="7530008">&#34;abc&#34;</span><span class="op" id="7530013">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530017">in</span><span class="op" id="7530019">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7530023">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--\r\n&#34;</span><span class="op" id="7530061">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530065">want</span><span class="op" id="7530069">:</span>&nbsp;<span class="op" id="7530071">[</span><span class="op" id="7530072">]</span><span class="ident" id="7530073">headerBody</span><span class="op" id="7530083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530088">{</span><span class="ident" id="7530089">textproto</span><span class="op" id="7530098">.</span><span class="ident" id="7530099">MIMEHeader</span><span class="op" id="7530109">{</span><span class="string" id="7530110">&#34;Foo&#34;</span><span class="op" id="7530115">:</span>&nbsp;<span class="op" id="7530117">{</span><span class="string" id="7530118">&#34;bar&#34;</span><span class="op" id="7530123">}</span><span class="op" id="7530124">}</span><span class="op" id="7530125">,</span>&nbsp;<span class="string" id="7530127">&#34;&#34;</span><span class="op" id="7530129">}</span><span class="op" id="7530130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530134">}</span><span class="op" id="7530135">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530138">}</span><span class="op" id="7530139">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7530143">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;lwsp-chars&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530207">name</span><span class="op" id="7530211">:</span>&nbsp;<span class="string" id="7530213">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;lwsp&#34;</span><span class="op" id="7530241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530245">sep</span><span class="op" id="7530248">:</span>&nbsp;&nbsp;<span class="string" id="7530251">&#34;abc&#34;</span><span class="op" id="7530256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530260">in</span><span class="op" id="7530262">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7530266">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&nbsp;\t&#34;</span><span class="op" id="7530303">,</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530307">want</span><span class="op" id="7530311">:</span>&nbsp;<span class="op" id="7530313">[</span><span class="op" id="7530314">]</span><span class="ident" id="7530315">headerBody</span><span class="op" id="7530325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530330">{</span><span class="ident" id="7530331">textproto</span><span class="op" id="7530340">.</span><span class="ident" id="7530341">MIMEHeader</span><span class="op" id="7530351">{</span><span class="string" id="7530352">&#34;Foo&#34;</span><span class="op" id="7530357">:</span>&nbsp;<span class="op" id="7530359">{</span><span class="string" id="7530360">&#34;bar&#34;</span><span class="op" id="7530365">}</span><span class="op" id="7530366">}</span><span class="op" id="7530367">,</span>&nbsp;<span class="string" id="7530369">&#34;&#34;</span><span class="op" id="7530371">}</span><span class="op" id="7530372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530376">}</span><span class="op" id="7530377">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530380">}</span><span class="op" id="7530381">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7530385">//&nbsp;No&nbsp;parts&nbsp;(empty&nbsp;form&nbsp;as&nbsp;submitted&nbsp;by&nbsp;Chrome)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530438">name</span><span class="op" id="7530442">:</span>&nbsp;<span class="string" id="7530444">&#34;no&nbsp;parts&#34;</span><span class="op" id="7530454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530458">sep</span><span class="op" id="7530461">:</span>&nbsp;&nbsp;<span class="string" id="7530464">&#34;----WebKitFormBoundaryQfEAfzFOiSemeHfA&#34;</span><span class="op" id="7530504">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530508">in</span><span class="op" id="7530510">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7530514">&#34;------WebKitFormBoundaryQfEAfzFOiSemeHfA--\r\n&#34;</span><span class="op" id="7530562">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530566">want</span><span class="op" id="7530570">:</span>&nbsp;<span class="op" id="7530572">[</span><span class="op" id="7530573">]</span><span class="ident" id="7530574">headerBody</span><span class="op" id="7530584">{</span><span class="op" id="7530585">}</span><span class="op" id="7530586">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530589">}</span><span class="op" id="7530590">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7530594">//&nbsp;Part&nbsp;containing&nbsp;data&nbsp;starting&nbsp;with&nbsp;the&nbsp;boundary,&nbsp;but&nbsp;with&nbsp;additional&nbsp;suffix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530675">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530679">name</span><span class="op" id="7530683">:</span>&nbsp;<span class="string" id="7530685">&#34;fake&nbsp;separator&nbsp;as&nbsp;data&#34;</span><span class="op" id="7530709">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530713">sep</span><span class="op" id="7530716">:</span>&nbsp;&nbsp;<span class="string" id="7530719">&#34;sep&#34;</span><span class="op" id="7530724">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530728">in</span><span class="op" id="7530730">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7530734">&#34;--sep\r\nFoo:&nbsp;bar\r\n\r\n--sepFAKE\r\n--sep--&#34;</span><span class="op" id="7530781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530785">want</span><span class="op" id="7530789">:</span>&nbsp;<span class="op" id="7530791">[</span><span class="op" id="7530792">]</span><span class="ident" id="7530793">headerBody</span><span class="op" id="7530803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530808">{</span><span class="ident" id="7530809">textproto</span><span class="op" id="7530818">.</span><span class="ident" id="7530819">MIMEHeader</span><span class="op" id="7530829">{</span><span class="string" id="7530830">&#34;Foo&#34;</span><span class="op" id="7530835">:</span>&nbsp;<span class="op" id="7530837">{</span><span class="string" id="7530838">&#34;bar&#34;</span><span class="op" id="7530843">}</span><span class="op" id="7530844">}</span><span class="op" id="7530845">,</span>&nbsp;<span class="string" id="7530847">&#34;--sepFAKE&#34;</span><span class="op" id="7530858">}</span><span class="op" id="7530859">,</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530863">}</span><span class="op" id="7530864">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530867">}</span><span class="op" id="7530868">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7530872">//&nbsp;Part&nbsp;containing&nbsp;a&nbsp;boundary&nbsp;with&nbsp;whitespace&nbsp;following&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530933">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530937">name</span><span class="op" id="7530941">:</span>&nbsp;<span class="string" id="7530943">&#34;boundary&nbsp;with&nbsp;whitespace&#34;</span><span class="op" id="7530969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530973">sep</span><span class="op" id="7530976">:</span>&nbsp;&nbsp;<span class="string" id="7530979">&#34;sep&#34;</span><span class="op" id="7530984">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530988">in</span><span class="op" id="7530990">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7530994">&#34;--sep&nbsp;\r\nFoo:&nbsp;bar\r\n\r\ntext\r\n--sep--&#34;</span><span class="op" id="7531037">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531041">want</span><span class="op" id="7531045">:</span>&nbsp;<span class="op" id="7531047">[</span><span class="op" id="7531048">]</span><span class="ident" id="7531049">headerBody</span><span class="op" id="7531059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531064">{</span><span class="ident" id="7531065">textproto</span><span class="op" id="7531074">.</span><span class="ident" id="7531075">MIMEHeader</span><span class="op" id="7531085">{</span><span class="string" id="7531086">&#34;Foo&#34;</span><span class="op" id="7531091">:</span>&nbsp;<span class="op" id="7531093">{</span><span class="string" id="7531094">&#34;bar&#34;</span><span class="op" id="7531099">}</span><span class="op" id="7531100">}</span><span class="op" id="7531101">,</span>&nbsp;<span class="string" id="7531103">&#34;text&#34;</span><span class="op" id="7531109">}</span><span class="op" id="7531110">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531114">}</span><span class="op" id="7531115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531118">}</span><span class="op" id="7531119">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7531123">//&nbsp;With&nbsp;ignored&nbsp;leading&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531154">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531158">name</span><span class="op" id="7531162">:</span>&nbsp;<span class="string" id="7531164">&#34;leading&nbsp;line&#34;</span><span class="op" id="7531178">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531182">sep</span><span class="op" id="7531185">:</span>&nbsp;&nbsp;<span class="string" id="7531188">&#34;MyBoundary&#34;</span><span class="op" id="7531200">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531204">in</span><span class="op" id="7531206">:</span>&nbsp;<span class="ident" id="7531208">strings</span><span class="op" id="7531215">.</span><span class="ident" id="7531216">Replace</span><span class="op" id="7531223">(</span><span class="string" id="7531224">`This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo:&nbsp;bar<br>
<span class="lineno">560</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>--MyBoundary--`</span><span class="op" id="7531317">,</span>&nbsp;<span class="string" id="7531319">&#34;\n&#34;</span><span class="op" id="7531323">,</span>&nbsp;<span class="string" id="7531325">&#34;\r\n&#34;</span><span class="op" id="7531331">,</span>&nbsp;<span class="op" id="7531333">-</span><span class="num" id="7531334">1</span><span class="op" id="7531335">)</span><span class="op" id="7531336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531340">want</span><span class="op" id="7531344">:</span>&nbsp;<span class="op" id="7531346">[</span><span class="op" id="7531347">]</span><span class="ident" id="7531348">headerBody</span><span class="op" id="7531358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531363">{</span><span class="ident" id="7531364">textproto</span><span class="op" id="7531373">.</span><span class="ident" id="7531374">MIMEHeader</span><span class="op" id="7531384">{</span><span class="string" id="7531385">&#34;Foo&#34;</span><span class="op" id="7531390">:</span>&nbsp;<span class="op" id="7531392">{</span><span class="string" id="7531393">&#34;bar&#34;</span><span class="op" id="7531398">}</span><span class="op" id="7531399">}</span><span class="op" id="7531400">,</span>&nbsp;<span class="string" id="7531402">&#34;&#34;</span><span class="op" id="7531404">}</span><span class="op" id="7531405">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531409">}</span><span class="op" id="7531410">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531413">}</span><span class="op" id="7531414">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531418">roundTripParseTest</span><span class="op" id="7531436">(</span><span class="op" id="7531437">)</span><span class="op" id="7531438">,</span><br>
<span class="lineno"></span><span class="op" id="7531440">}</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="keyword" id="7531443">func</span>&nbsp;<span class="ident" id="7531448">TestParse</span><span class="op" id="7531457">(</span><span class="ident" id="7531458">t</span>&nbsp;<span class="op" id="7531460">*</span><span class="ident" id="7531461">testing</span><span class="op" id="7531468">.</span><span class="ident" id="7531469">T</span><span class="op" id="7531470">)</span>&nbsp;<span class="op" id="7531472">{</span><br>
<span class="lineno"></span><span class="ident" id="7531474">Cases</span><span class="op" id="7531479">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531482">for</span>&nbsp;<span class="ident" id="7531486">_</span><span class="op" id="7531487">,</span>&nbsp;<span class="ident" id="7531489">tt</span>&nbsp;<span class="op" id="7531492">:=</span>&nbsp;<span class="keyword" id="7531495">range</span>&nbsp;<span class="ident" id="7531501">parseTests</span>&nbsp;<span class="op" id="7531512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531516">r</span>&nbsp;<span class="op" id="7531518">:=</span>&nbsp;<span class="ident" id="7531521">NewReader</span><span class="op" id="7531530">(</span><span class="ident" id="7531531">strings</span><span class="op" id="7531538">.</span><span class="ident" id="7531539">NewReader</span><span class="op" id="7531548">(</span><span class="ident" id="7531549">tt</span><span class="op" id="7531551">.</span><span class="ident" id="7531552">in</span><span class="op" id="7531554">)</span><span class="op" id="7531555">,</span>&nbsp;<span class="ident" id="7531557">tt</span><span class="op" id="7531559">.</span><span class="ident" id="7531560">sep</span><span class="op" id="7531563">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531567">got</span>&nbsp;<span class="op" id="7531571">:=</span>&nbsp;<span class="op" id="7531574">[</span><span class="op" id="7531575">]</span><span class="ident" id="7531576">headerBody</span><span class="op" id="7531586">{</span><span class="op" id="7531587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531591">for</span>&nbsp;<span class="op" id="7531595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531600">p</span><span class="op" id="7531601">,</span>&nbsp;<span class="ident" id="7531603">err</span>&nbsp;<span class="op" id="7531607">:=</span>&nbsp;<span class="ident" id="7531610">r</span><span class="op" id="7531611">.</span><span class="ident" id="7531612">NextPart</span><span class="op" id="7531620">(</span><span class="op" id="7531621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531626">if</span>&nbsp;<span class="ident" id="7531629">err</span>&nbsp;<span class="op" id="7531633">==</span>&nbsp;<span class="ident" id="7531636">io</span><span class="op" id="7531638">.</span><span class="ident" id="7531639">EOF</span>&nbsp;<span class="op" id="7531643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531649">break</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531663">if</span>&nbsp;<span class="ident" id="7531666">err</span>&nbsp;<span class="op" id="7531670">!=</span>&nbsp;<span class="ident" id="7531673">nil</span>&nbsp;<span class="op" id="7531677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531683">t</span><span class="op" id="7531684">.</span><span class="ident" id="7531685">Errorf</span><span class="op" id="7531691">(</span><span class="string" id="7531692">&#34;in&nbsp;test&nbsp;%q,&nbsp;NextPart:&nbsp;%v&#34;</span><span class="op" id="7531718">,</span>&nbsp;<span class="ident" id="7531720">tt</span><span class="op" id="7531722">.</span><span class="ident" id="7531723">name</span><span class="op" id="7531727">,</span>&nbsp;<span class="ident" id="7531729">err</span><span class="op" id="7531732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531738">continue</span>&nbsp;<span class="ident" id="7531747">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531756">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531761">pbody</span><span class="op" id="7531766">,</span>&nbsp;<span class="ident" id="7531768">err</span>&nbsp;<span class="op" id="7531772">:=</span>&nbsp;<span class="ident" id="7531775">ioutil</span><span class="op" id="7531781">.</span><span class="ident" id="7531782">ReadAll</span><span class="op" id="7531789">(</span><span class="ident" id="7531790">p</span><span class="op" id="7531791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531796">if</span>&nbsp;<span class="ident" id="7531799">err</span>&nbsp;<span class="op" id="7531803">!=</span>&nbsp;<span class="ident" id="7531806">nil</span>&nbsp;<span class="op" id="7531810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531816">t</span><span class="op" id="7531817">.</span><span class="ident" id="7531818">Errorf</span><span class="op" id="7531824">(</span><span class="string" id="7531825">&#34;in&nbsp;test&nbsp;%q,&nbsp;error&nbsp;reading&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="7531861">,</span>&nbsp;<span class="ident" id="7531863">tt</span><span class="op" id="7531865">.</span><span class="ident" id="7531866">name</span><span class="op" id="7531870">,</span>&nbsp;<span class="ident" id="7531872">err</span><span class="op" id="7531875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531881">continue</span>&nbsp;<span class="ident" id="7531890">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531899">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531904">got</span>&nbsp;<span class="op" id="7531908">=</span>&nbsp;<span class="builtinfunc" id="7531910">append</span><span class="op" id="7531916">(</span><span class="ident" id="7531917">got</span><span class="op" id="7531920">,</span>&nbsp;<span class="ident" id="7531922">headerBody</span><span class="op" id="7531932">{</span><span class="ident" id="7531933">p</span><span class="op" id="7531934">.</span><span class="ident" id="7531935">Header</span><span class="op" id="7531941">,</span>&nbsp;<span class="builtintype" id="7531943">string</span><span class="op" id="7531949">(</span><span class="ident" id="7531950">pbody</span><span class="op" id="7531955">)</span><span class="op" id="7531956">}</span><span class="op" id="7531957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531965">if</span>&nbsp;<span class="op" id="7531968">!</span><span class="ident" id="7531969">reflect</span><span class="op" id="7531976">.</span><span class="ident" id="7531977">DeepEqual</span><span class="op" id="7531986">(</span><span class="ident" id="7531987">tt</span><span class="op" id="7531989">.</span><span class="ident" id="7531990">want</span><span class="op" id="7531994">,</span>&nbsp;<span class="ident" id="7531996">got</span><span class="op" id="7531999">)</span>&nbsp;<span class="op" id="7532001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532006">t</span><span class="op" id="7532007">.</span><span class="ident" id="7532008">Errorf</span><span class="op" id="7532014">(</span><span class="string" id="7532015">&#34;test&nbsp;%q:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="7532045">,</span>&nbsp;<span class="ident" id="7532047">tt</span><span class="op" id="7532049">.</span><span class="ident" id="7532050">name</span><span class="op" id="7532054">,</span>&nbsp;<span class="ident" id="7532056">got</span><span class="op" id="7532059">,</span>&nbsp;<span class="ident" id="7532061">tt</span><span class="op" id="7532063">.</span><span class="ident" id="7532064">want</span><span class="op" id="7532068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532073">if</span>&nbsp;<span class="builtinfunc" id="7532076">len</span><span class="op" id="7532079">(</span><span class="ident" id="7532080">tt</span><span class="op" id="7532082">.</span><span class="ident" id="7532083">want</span><span class="op" id="7532087">)</span>&nbsp;<span class="op" id="7532089">!=</span>&nbsp;<span class="builtinfunc" id="7532092">len</span><span class="op" id="7532095">(</span><span class="ident" id="7532096">got</span><span class="op" id="7532099">)</span>&nbsp;<span class="op" id="7532101">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532107">t</span><span class="op" id="7532108">.</span><span class="ident" id="7532109">Errorf</span><span class="op" id="7532115">(</span><span class="string" id="7532116">&#34;test&nbsp;%q:&nbsp;got&nbsp;%d&nbsp;parts,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7532148">,</span>&nbsp;<span class="ident" id="7532150">tt</span><span class="op" id="7532152">.</span><span class="ident" id="7532153">name</span><span class="op" id="7532157">,</span>&nbsp;<span class="builtinfunc" id="7532159">len</span><span class="op" id="7532162">(</span><span class="ident" id="7532163">got</span><span class="op" id="7532166">)</span><span class="op" id="7532167">,</span>&nbsp;<span class="builtinfunc" id="7532169">len</span><span class="op" id="7532172">(</span><span class="ident" id="7532173">tt</span><span class="op" id="7532175">.</span><span class="ident" id="7532176">want</span><span class="op" id="7532180">)</span><span class="op" id="7532181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532186">}</span>&nbsp;<span class="keyword" id="7532188">else</span>&nbsp;<span class="keyword" id="7532193">if</span>&nbsp;<span class="builtinfunc" id="7532196">len</span><span class="op" id="7532199">(</span><span class="ident" id="7532200">got</span><span class="op" id="7532203">)</span>&nbsp;<span class="op" id="7532205">&gt;</span>&nbsp;<span class="num" id="7532207">1</span>&nbsp;<span class="op" id="7532209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532215">for</span>&nbsp;<span class="ident" id="7532219">pi</span><span class="op" id="7532221">,</span>&nbsp;<span class="ident" id="7532223">wantPart</span>&nbsp;<span class="op" id="7532232">:=</span>&nbsp;<span class="keyword" id="7532235">range</span>&nbsp;<span class="ident" id="7532241">tt</span><span class="op" id="7532243">.</span><span class="ident" id="7532244">want</span>&nbsp;<span class="op" id="7532249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532256">if</span>&nbsp;<span class="op" id="7532259">!</span><span class="ident" id="7532260">reflect</span><span class="op" id="7532267">.</span><span class="ident" id="7532268">DeepEqual</span><span class="op" id="7532277">(</span><span class="ident" id="7532278">wantPart</span><span class="op" id="7532286">,</span>&nbsp;<span class="ident" id="7532288">got</span><span class="op" id="7532291">[</span><span class="ident" id="7532292">pi</span><span class="op" id="7532294">]</span><span class="op" id="7532295">)</span>&nbsp;<span class="op" id="7532297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532305">t</span><span class="op" id="7532306">.</span><span class="ident" id="7532307">Errorf</span><span class="op" id="7532313">(</span><span class="string" id="7532314">&#34;test&nbsp;%q,&nbsp;part&nbsp;%d:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="7532353">,</span>&nbsp;<span class="ident" id="7532355">tt</span><span class="op" id="7532357">.</span><span class="ident" id="7532358">name</span><span class="op" id="7532362">,</span>&nbsp;<span class="ident" id="7532364">pi</span><span class="op" id="7532366">,</span>&nbsp;<span class="ident" id="7532368">got</span><span class="op" id="7532371">[</span><span class="ident" id="7532372">pi</span><span class="op" id="7532374">]</span><span class="op" id="7532375">,</span>&nbsp;<span class="ident" id="7532377">wantPart</span><span class="op" id="7532385">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532410">}</span><br>
<span class="lineno">605</span><span class="op" id="7532412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7532415">func</span>&nbsp;<span class="ident" id="7532420">roundTripParseTest</span><span class="op" id="7532438">(</span><span class="op" id="7532439">)</span>&nbsp;<span class="ident" id="7532441">parseTest</span>&nbsp;<span class="op" id="7532451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532454">t</span>&nbsp;<span class="op" id="7532456">:=</span>&nbsp;<span class="ident" id="7532459">parseTest</span><span class="op" id="7532468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532472">name</span><span class="op" id="7532476">:</span>&nbsp;<span class="string" id="7532478">&#34;round&nbsp;trip&#34;</span><span class="op" id="7532490">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532494">want</span><span class="op" id="7532498">:</span>&nbsp;<span class="op" id="7532500">[</span><span class="op" id="7532501">]</span><span class="ident" id="7532502">headerBody</span><span class="op" id="7532512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532517">formData</span><span class="op" id="7532525">(</span><span class="string" id="7532526">&#34;empty&#34;</span><span class="op" id="7532533">,</span>&nbsp;<span class="string" id="7532535">&#34;&#34;</span><span class="op" id="7532537">)</span><span class="op" id="7532538">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532543">formData</span><span class="op" id="7532551">(</span><span class="string" id="7532552">&#34;lf&#34;</span><span class="op" id="7532556">,</span>&nbsp;<span class="string" id="7532558">&#34;\n&#34;</span><span class="op" id="7532562">)</span><span class="op" id="7532563">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532568">formData</span><span class="op" id="7532576">(</span><span class="string" id="7532577">&#34;cr&#34;</span><span class="op" id="7532581">,</span>&nbsp;<span class="string" id="7532583">&#34;\r&#34;</span><span class="op" id="7532587">)</span><span class="op" id="7532588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532593">formData</span><span class="op" id="7532601">(</span><span class="string" id="7532602">&#34;crlf&#34;</span><span class="op" id="7532608">,</span>&nbsp;<span class="string" id="7532610">&#34;\r\n&#34;</span><span class="op" id="7532616">)</span><span class="op" id="7532617">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532622">formData</span><span class="op" id="7532630">(</span><span class="string" id="7532631">&#34;foo&#34;</span><span class="op" id="7532636">,</span>&nbsp;<span class="string" id="7532638">&#34;bar&#34;</span><span class="op" id="7532643">)</span><span class="op" id="7532644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532648">}</span><span class="op" id="7532649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532655">var</span>&nbsp;<span class="ident" id="7532659">buf</span>&nbsp;<span class="ident" id="7532663">bytes</span><span class="op" id="7532668">.</span><span class="ident" id="7532669">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532677">w</span>&nbsp;<span class="op" id="7532679">:=</span>&nbsp;<span class="ident" id="7532682">NewWriter</span><span class="op" id="7532691">(</span><span class="op" id="7532692">&amp;</span><span class="ident" id="7532693">buf</span><span class="op" id="7532696">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532699">for</span>&nbsp;<span class="ident" id="7532703">_</span><span class="op" id="7532704">,</span>&nbsp;<span class="ident" id="7532706">p</span>&nbsp;<span class="op" id="7532708">:=</span>&nbsp;<span class="keyword" id="7532711">range</span>&nbsp;<span class="ident" id="7532717">t</span><span class="op" id="7532718">.</span><span class="ident" id="7532719">want</span>&nbsp;<span class="op" id="7532724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532728">pw</span><span class="op" id="7532730">,</span>&nbsp;<span class="ident" id="7532732">err</span>&nbsp;<span class="op" id="7532736">:=</span>&nbsp;<span class="ident" id="7532739">w</span><span class="op" id="7532740">.</span><span class="ident" id="7532741">CreatePart</span><span class="op" id="7532751">(</span><span class="ident" id="7532752">p</span><span class="op" id="7532753">.</span><span class="ident" id="7532754">header</span><span class="op" id="7532760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532764">if</span>&nbsp;<span class="ident" id="7532767">err</span>&nbsp;<span class="op" id="7532771">!=</span>&nbsp;<span class="ident" id="7532774">nil</span>&nbsp;<span class="op" id="7532778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7532783">panic</span><span class="op" id="7532788">(</span><span class="ident" id="7532789">err</span><span class="op" id="7532792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532796">}</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532800">_</span><span class="op" id="7532801">,</span>&nbsp;<span class="ident" id="7532803">err</span>&nbsp;<span class="op" id="7532807">=</span>&nbsp;<span class="ident" id="7532809">pw</span><span class="op" id="7532811">.</span><span class="ident" id="7532812">Write</span><span class="op" id="7532817">(</span><span class="op" id="7532818">[</span><span class="op" id="7532819">]</span><span class="builtintype" id="7532820">byte</span><span class="op" id="7532824">(</span><span class="ident" id="7532825">p</span><span class="op" id="7532826">.</span><span class="ident" id="7532827">body</span><span class="op" id="7532831">)</span><span class="op" id="7532832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532836">if</span>&nbsp;<span class="ident" id="7532839">err</span>&nbsp;<span class="op" id="7532843">!=</span>&nbsp;<span class="ident" id="7532846">nil</span>&nbsp;<span class="op" id="7532850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7532855">panic</span><span class="op" id="7532860">(</span><span class="ident" id="7532861">err</span><span class="op" id="7532864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532871">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532874">w</span><span class="op" id="7532875">.</span><span class="ident" id="7532876">Close</span><span class="op" id="7532881">(</span><span class="op" id="7532882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532885">t</span><span class="op" id="7532886">.</span><span class="ident" id="7532887">in</span>&nbsp;<span class="op" id="7532890">=</span>&nbsp;<span class="ident" id="7532892">buf</span><span class="op" id="7532895">.</span><span class="ident" id="7532896">String</span><span class="op" id="7532902">(</span><span class="op" id="7532903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532906">t</span><span class="op" id="7532907">.</span><span class="ident" id="7532908">sep</span>&nbsp;<span class="op" id="7532912">=</span>&nbsp;<span class="ident" id="7532914">w</span><span class="op" id="7532915">.</span><span class="ident" id="7532916">Boundary</span><span class="op" id="7532924">(</span><span class="op" id="7532925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532928">return</span>&nbsp;<span class="ident" id="7532935">t</span><br>
<span class="lineno"></span><span class="op" id="7532937">}</span>
</div>
</body>
</html>
