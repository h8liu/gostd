<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html" class="current">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3036635">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3036690">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3036744">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3036795">package</span>&nbsp;<span class="ident" id="3036803">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3036813">import</span>&nbsp;<span class="op" id="3036820">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3036823">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3036832">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3036849">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3036856">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3036867">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3036878">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3036893">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3036896">//&nbsp;nextJSCtx&nbsp;returns&nbsp;the&nbsp;context&nbsp;that&nbsp;determines&nbsp;whether&nbsp;a&nbsp;slash&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3036971">//&nbsp;given&nbsp;run&nbsp;of&nbsp;tokens&nbsp;starts&nbsp;a&nbsp;regular&nbsp;expression&nbsp;instead&nbsp;of&nbsp;a&nbsp;division</span><br>
<span class="lineno"></span><span class="comment" id="3037044">//&nbsp;operator:&nbsp;/&nbsp;or&nbsp;/=.</span><br>
<span class="lineno"></span><span class="comment" id="3037066">//</span><br>
<span class="lineno">20</span><span class="comment" id="3037069">//&nbsp;This&nbsp;assumes&nbsp;that&nbsp;the&nbsp;token&nbsp;run&nbsp;does&nbsp;not&nbsp;include&nbsp;any&nbsp;string&nbsp;tokens,&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="3037148">//&nbsp;tokens,&nbsp;regular&nbsp;expression&nbsp;literal&nbsp;tokens,&nbsp;or&nbsp;division&nbsp;operators.</span><br>
<span class="lineno"></span><span class="comment" id="3037217">//</span><br>
<span class="lineno"></span><span class="comment" id="3037220">//&nbsp;This&nbsp;fails&nbsp;on&nbsp;some&nbsp;valid&nbsp;but&nbsp;nonsensical&nbsp;JavaScript&nbsp;programs&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="3037289">//&nbsp;&#34;x&nbsp;=&nbsp;++/foo/i&#34;&nbsp;which&nbsp;is&nbsp;quite&nbsp;different&nbsp;than&nbsp;&#34;x++/foo/i&#34;,&nbsp;but&nbsp;is&nbsp;not&nbsp;known&nbsp;to</span><br>
<span class="lineno">25</span><span class="comment" id="3037370">//&nbsp;fail&nbsp;on&nbsp;any&nbsp;known&nbsp;useful&nbsp;programs.&nbsp;It&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;draft</span><br>
<span class="lineno"></span><span class="comment" id="3037433">//&nbsp;JavaScript&nbsp;2.0&nbsp;lexical&nbsp;grammar&nbsp;and&nbsp;requires&nbsp;one&nbsp;token&nbsp;of&nbsp;lookbehind:</span><br>
<span class="lineno"></span><span class="comment" id="3037505">//&nbsp;http://www.mozilla.org/js/language/js20-2000-07/rationale/syntax.html</span><br>
<span class="lineno"></span><span class="keyword" id="3037578">func</span>&nbsp;<span class="ident" id="3037583">nextJSCtx</span><span class="op" id="3037592">(</span><span class="ident" id="3037593">s</span>&nbsp;<span class="op" id="3037595">[</span><span class="op" id="3037596">]</span><span class="builtintype" id="3037597">byte</span><span class="op" id="3037601">,</span>&nbsp;<span class="ident" id="3037603">preceding</span>&nbsp;<span class="ident" id="3037613">jsCtx</span><span class="op" id="3037618">)</span>&nbsp;<span class="ident" id="3037620">jsCtx</span>&nbsp;<span class="op" id="3037626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3037629">s</span>&nbsp;<span class="op" id="3037631">=</span>&nbsp;<span class="ident" id="3037633">bytes</span><span class="op" id="3037638">.</span><span class="ident" id="3037639">TrimRight</span><span class="op" id="3037648">(</span><span class="ident" id="3037649">s</span><span class="op" id="3037650">,</span>&nbsp;<span class="string" id="3037652">&#34;\t\n\f\r&nbsp;\u2028\u2029&#34;</span><span class="op" id="3037675">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3037678">if</span>&nbsp;<span class="builtinfunc" id="3037681">len</span><span class="op" id="3037684">(</span><span class="ident" id="3037685">s</span><span class="op" id="3037686">)</span>&nbsp;<span class="op" id="3037688">==</span>&nbsp;<span class="num" id="3037691">0</span>&nbsp;<span class="op" id="3037693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3037697">return</span>&nbsp;<span class="ident" id="3037704">preceding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3037715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3037719">//&nbsp;All&nbsp;cases&nbsp;below&nbsp;are&nbsp;in&nbsp;the&nbsp;single-byte&nbsp;UTF-8&nbsp;group.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3037775">switch</span>&nbsp;<span class="ident" id="3037782">c</span><span class="op" id="3037783">,</span>&nbsp;<span class="ident" id="3037785">n</span>&nbsp;<span class="op" id="3037787">:=</span>&nbsp;<span class="ident" id="3037790">s</span><span class="op" id="3037791">[</span><span class="builtinfunc" id="3037792">len</span><span class="op" id="3037795">(</span><span class="ident" id="3037796">s</span><span class="op" id="3037797">)</span><span class="op" id="3037798">-</span><span class="num" id="3037799">1</span><span class="op" id="3037800">]</span><span class="op" id="3037801">,</span>&nbsp;<span class="builtinfunc" id="3037803">len</span><span class="op" id="3037806">(</span><span class="ident" id="3037807">s</span><span class="op" id="3037808">)</span><span class="op" id="3037809">;</span>&nbsp;<span class="ident" id="3037811">c</span>&nbsp;<span class="op" id="3037813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3037816">case</span>&nbsp;<span class="string" id="3037821">&#39;+&#39;</span><span class="op" id="3037824">,</span>&nbsp;<span class="string" id="3037826">&#39;-&#39;</span><span class="op" id="3037829">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3037833">//&nbsp;++&nbsp;and&nbsp;--&nbsp;are&nbsp;not&nbsp;regexp&nbsp;preceders,&nbsp;but&nbsp;+&nbsp;and&nbsp;-&nbsp;are&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3037898">//&nbsp;they&nbsp;are&nbsp;used&nbsp;as&nbsp;infix&nbsp;or&nbsp;prefix&nbsp;operators.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3037947">start</span>&nbsp;<span class="op" id="3037953">:=</span>&nbsp;<span class="ident" id="3037956">n</span>&nbsp;<span class="op" id="3037958">-</span>&nbsp;<span class="num" id="3037960">1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3037964">//&nbsp;Count&nbsp;the&nbsp;number&nbsp;of&nbsp;adjacent&nbsp;dashes&nbsp;or&nbsp;pluses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038016">for</span>&nbsp;<span class="ident" id="3038020">start</span>&nbsp;<span class="op" id="3038026">&gt;</span>&nbsp;<span class="num" id="3038028">0</span>&nbsp;<span class="op" id="3038030">&amp;&amp;</span>&nbsp;<span class="ident" id="3038033">s</span><span class="op" id="3038034">[</span><span class="ident" id="3038035">start</span><span class="op" id="3038040">-</span><span class="num" id="3038041">1</span><span class="op" id="3038042">]</span>&nbsp;<span class="op" id="3038044">==</span>&nbsp;<span class="ident" id="3038047">c</span>&nbsp;<span class="op" id="3038049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3038054">start</span><span class="op" id="3038059">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3038064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038068">if</span>&nbsp;<span class="op" id="3038071">(</span><span class="ident" id="3038072">n</span><span class="op" id="3038073">-</span><span class="ident" id="3038074">start</span><span class="op" id="3038079">)</span><span class="op" id="3038080">&amp;</span><span class="num" id="3038081">1</span>&nbsp;<span class="op" id="3038083">==</span>&nbsp;<span class="num" id="3038086">1</span>&nbsp;<span class="op" id="3038088">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3038093">//&nbsp;Reached&nbsp;for&nbsp;trailing&nbsp;minus&nbsp;signs&nbsp;since&nbsp;&#34;---&#34;&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3038151">//&nbsp;same&nbsp;as&nbsp;&#34;--&nbsp;-&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038173">return</span>&nbsp;<span class="ident" id="3038180">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3038194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038198">return</span>&nbsp;<span class="ident" id="3038205">jsCtxDivOp</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038217">case</span>&nbsp;<span class="string" id="3038222">&#39;.&#39;</span><span class="op" id="3038225">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3038229">//&nbsp;Handle&nbsp;&#34;42.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038247">if</span>&nbsp;<span class="ident" id="3038250">n</span>&nbsp;<span class="op" id="3038252">!=</span>&nbsp;<span class="num" id="3038255">1</span>&nbsp;<span class="op" id="3038257">&amp;&amp;</span>&nbsp;<span class="string" id="3038260">&#39;0&#39;</span>&nbsp;<span class="op" id="3038264">&lt;=</span>&nbsp;<span class="ident" id="3038267">s</span><span class="op" id="3038268">[</span><span class="ident" id="3038269">n</span><span class="op" id="3038270">-</span><span class="num" id="3038271">2</span><span class="op" id="3038272">]</span>&nbsp;<span class="op" id="3038274">&amp;&amp;</span>&nbsp;<span class="ident" id="3038277">s</span><span class="op" id="3038278">[</span><span class="ident" id="3038279">n</span><span class="op" id="3038280">-</span><span class="num" id="3038281">2</span><span class="op" id="3038282">]</span>&nbsp;<span class="op" id="3038284">&lt;=</span>&nbsp;<span class="string" id="3038287">&#39;9&#39;</span>&nbsp;<span class="op" id="3038291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038296">return</span>&nbsp;<span class="ident" id="3038303">jsCtxDivOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3038316">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038320">return</span>&nbsp;<span class="ident" id="3038327">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3038340">//&nbsp;Suffixes&nbsp;for&nbsp;all&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3038411">//&nbsp;that&nbsp;only&nbsp;end&nbsp;binary&nbsp;operators&nbsp;not&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038465">case</span>&nbsp;<span class="string" id="3038470">&#39;,&#39;</span><span class="op" id="3038473">,</span>&nbsp;<span class="string" id="3038475">&#39;&lt;&#39;</span><span class="op" id="3038478">,</span>&nbsp;<span class="string" id="3038480">&#39;&gt;&#39;</span><span class="op" id="3038483">,</span>&nbsp;<span class="string" id="3038485">&#39;=&#39;</span><span class="op" id="3038488">,</span>&nbsp;<span class="string" id="3038490">&#39;*&#39;</span><span class="op" id="3038493">,</span>&nbsp;<span class="string" id="3038495">&#39;%&#39;</span><span class="op" id="3038498">,</span>&nbsp;<span class="string" id="3038500">&#39;&amp;&#39;</span><span class="op" id="3038503">,</span>&nbsp;<span class="string" id="3038505">&#39;|&#39;</span><span class="op" id="3038508">,</span>&nbsp;<span class="string" id="3038510">&#39;^&#39;</span><span class="op" id="3038513">,</span>&nbsp;<span class="string" id="3038515">&#39;?&#39;</span><span class="op" id="3038518">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038522">return</span>&nbsp;<span class="ident" id="3038529">jsCtxRegexp</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3038542">//&nbsp;Suffixes&nbsp;for&nbsp;all&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3038613">//&nbsp;that&nbsp;are&nbsp;prefix&nbsp;operators&nbsp;not&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038662">case</span>&nbsp;<span class="string" id="3038667">&#39;!&#39;</span><span class="op" id="3038670">,</span>&nbsp;<span class="string" id="3038672">&#39;~&#39;</span><span class="op" id="3038675">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038679">return</span>&nbsp;<span class="ident" id="3038686">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3038699">//&nbsp;Matches&nbsp;all&nbsp;the&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3038769">//&nbsp;that&nbsp;are&nbsp;open&nbsp;brackets&nbsp;not&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038815">case</span>&nbsp;<span class="string" id="3038820">&#39;(&#39;</span><span class="op" id="3038823">,</span>&nbsp;<span class="string" id="3038825">&#39;[&#39;</span><span class="op" id="3038828">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038832">return</span>&nbsp;<span class="ident" id="3038839">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3038852">//&nbsp;Matches&nbsp;all&nbsp;the&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3038922">//&nbsp;that&nbsp;precede&nbsp;expression&nbsp;starts.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038958">case</span>&nbsp;<span class="string" id="3038963">&#39;:&#39;</span><span class="op" id="3038966">,</span>&nbsp;<span class="string" id="3038968">&#39;;&#39;</span><span class="op" id="3038971">,</span>&nbsp;<span class="string" id="3038973">&#39;{&#39;</span><span class="op" id="3038976">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3038980">return</span>&nbsp;<span class="ident" id="3038987">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039000">//&nbsp;CAVEAT:&nbsp;the&nbsp;close&nbsp;punctuators&nbsp;(&#39;}&#39;,&nbsp;&#39;]&#39;,&nbsp;&#39;)&#39;)&nbsp;precede&nbsp;div&nbsp;ops&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039070">//&nbsp;are&nbsp;handled&nbsp;in&nbsp;the&nbsp;default&nbsp;except&nbsp;for&nbsp;&#39;}&#39;&nbsp;which&nbsp;can&nbsp;precede&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039136">//&nbsp;division&nbsp;op&nbsp;as&nbsp;in</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039158">//&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;valueOf:&nbsp;function&nbsp;()&nbsp;{&nbsp;return&nbsp;42&nbsp;}&nbsp;}&nbsp;/&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039209">//&nbsp;which&nbsp;is&nbsp;valid,&nbsp;but,&nbsp;in&nbsp;practice,&nbsp;developers&nbsp;don&#39;t&nbsp;divide&nbsp;object</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039278">//&nbsp;literals,&nbsp;so&nbsp;our&nbsp;heuristic&nbsp;works&nbsp;well&nbsp;for&nbsp;code&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039334">//&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;()&nbsp;{&nbsp;...&nbsp;}&nbsp;&nbsp;/foo/.test(x)&nbsp;&amp;&amp;&nbsp;sideEffect();</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039393">//&nbsp;The&nbsp;&#39;)&#39;&nbsp;punctuator&nbsp;can&nbsp;precede&nbsp;a&nbsp;regular&nbsp;expression&nbsp;as&nbsp;in</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039455">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(b)&nbsp;/foo/.test(x)&nbsp;&amp;&amp;&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039491">//&nbsp;but&nbsp;this&nbsp;is&nbsp;much&nbsp;less&nbsp;likely&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039529">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(a&nbsp;+&nbsp;b)&nbsp;/&nbsp;c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3039549">case</span>&nbsp;<span class="string" id="3039554">&#39;}&#39;</span><span class="op" id="3039557">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3039561">return</span>&nbsp;<span class="ident" id="3039568">jsCtxRegexp</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3039581">default</span><span class="op" id="3039588">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039592">//&nbsp;Look&nbsp;for&nbsp;an&nbsp;IdentifierName&nbsp;and&nbsp;see&nbsp;if&nbsp;it&nbsp;is&nbsp;a&nbsp;keyword&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039656">//&nbsp;can&nbsp;precede&nbsp;a&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3039695">j</span>&nbsp;<span class="op" id="3039697">:=</span>&nbsp;<span class="ident" id="3039700">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3039704">for</span>&nbsp;<span class="ident" id="3039708">j</span>&nbsp;<span class="op" id="3039710">&gt;</span>&nbsp;<span class="num" id="3039712">0</span>&nbsp;<span class="op" id="3039714">&amp;&amp;</span>&nbsp;<span class="ident" id="3039717">isJSIdentPart</span><span class="op" id="3039730">(</span><span class="builtintype" id="3039731">rune</span><span class="op" id="3039735">(</span><span class="ident" id="3039736">s</span><span class="op" id="3039737">[</span><span class="ident" id="3039738">j</span><span class="op" id="3039739">-</span><span class="num" id="3039740">1</span><span class="op" id="3039741">]</span><span class="op" id="3039742">)</span><span class="op" id="3039743">)</span>&nbsp;<span class="op" id="3039745">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3039750">j</span><span class="op" id="3039751">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3039756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3039760">if</span>&nbsp;<span class="ident" id="3039763">regexpPrecederKeywords</span><span class="op" id="3039785">[</span><span class="builtintype" id="3039786">string</span><span class="op" id="3039792">(</span><span class="ident" id="3039793">s</span><span class="op" id="3039794">[</span><span class="ident" id="3039795">j</span><span class="op" id="3039796">:</span><span class="op" id="3039797">]</span><span class="op" id="3039798">)</span><span class="op" id="3039799">]</span>&nbsp;<span class="op" id="3039801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3039806">return</span>&nbsp;<span class="ident" id="3039813">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3039827">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3039830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039833">//&nbsp;Otherwise&nbsp;is&nbsp;a&nbsp;punctuator&nbsp;not&nbsp;listed&nbsp;above,&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039884">//&nbsp;a&nbsp;string&nbsp;which&nbsp;precedes&nbsp;a&nbsp;div&nbsp;op,&nbsp;or&nbsp;an&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3039939">//&nbsp;which&nbsp;precedes&nbsp;a&nbsp;div&nbsp;op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3039968">return</span>&nbsp;<span class="ident" id="3039975">jsCtxDivOp</span><br>
<span class="lineno">100</span><span class="op" id="3039986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3039989">//&nbsp;regexpPrecederKeywords&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;reserved&nbsp;JS&nbsp;keywords&nbsp;that&nbsp;can&nbsp;precede&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3040067">//&nbsp;regular&nbsp;expression&nbsp;in&nbsp;JS&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="3040103">var</span>&nbsp;<span class="ident" id="3040107">regexpPrecederKeywords</span>&nbsp;<span class="op" id="3040130">=</span>&nbsp;<span class="keyword" id="3040132">map</span><span class="op" id="3040135">[</span><span class="builtintype" id="3040136">string</span><span class="op" id="3040142">]</span><span class="builtintype" id="3040143">bool</span><span class="op" id="3040147">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3040150">&#34;break&#34;</span><span class="op" id="3040157">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3040164">true</span><span class="op" id="3040168">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3040171">&#34;case&#34;</span><span class="op" id="3040177">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3040185">true</span><span class="op" id="3040189">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3040192">&#34;continue&#34;</span><span class="op" id="3040202">:</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3040206">true</span><span class="op" id="3040210">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3040213">&#34;delete&#34;</span><span class="op" id="3040221">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3040227">true</span><span class="op" id="3040231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3040234">&#34;do&#34;</span><span class="op" id="3040238">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3040248">true</span><span class="op" id="3040252">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3040255">&#34;else&#34;</span><span class="op" id="3040261">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3040269">true</span><span class="op" id="3040273">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3040276">&#34;finally&#34;</span><span class="op" id="3040285">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3040290">true</span><span class="op" id="3040294">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3040297">&#34;in&#34;</span><span class="op" id="3040301">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3040311">true</span><span class="op" id="3040315">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3040318">&#34;instanceof&#34;</span><span class="op" id="3040330">:</span>&nbsp;<span class="builtintype" id="3040332">true</span><span class="op" id="3040336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3040339">&#34;return&#34;</span><span class="op" id="3040347">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3040353">true</span><span class="op" id="3040357">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3040360">&#34;throw&#34;</span><span class="op" id="3040367">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3040374">true</span><span class="op" id="3040378">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3040381">&#34;try&#34;</span><span class="op" id="3040386">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3040395">true</span><span class="op" id="3040399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3040402">&#34;typeof&#34;</span><span class="op" id="3040410">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3040416">true</span><span class="op" id="3040420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3040423">&#34;void&#34;</span><span class="op" id="3040429">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3040437">true</span><span class="op" id="3040441">,</span><br>
<span class="lineno"></span><span class="op" id="3040443">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="3040446">var</span>&nbsp;<span class="ident" id="3040450">jsonMarshalType</span>&nbsp;<span class="op" id="3040466">=</span>&nbsp;<span class="ident" id="3040468">reflect</span><span class="op" id="3040475">.</span><span class="ident" id="3040476">TypeOf</span><span class="op" id="3040482">(</span><span class="op" id="3040483">(</span><span class="op" id="3040484">*</span><span class="ident" id="3040485">json</span><span class="op" id="3040489">.</span><span class="ident" id="3040490">Marshaler</span><span class="op" id="3040499">)</span><span class="op" id="3040500">(</span><span class="builtintype" id="3040501">nil</span><span class="op" id="3040504">)</span><span class="op" id="3040505">)</span><span class="op" id="3040506">.</span><span class="ident" id="3040507">Elem</span><span class="op" id="3040511">(</span><span class="op" id="3040512">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3040515">//&nbsp;indirectToJSONMarshaler&nbsp;returns&nbsp;the&nbsp;value,&nbsp;after&nbsp;dereferencing&nbsp;as&nbsp;many&nbsp;times</span><br>
<span class="lineno"></span><span class="comment" id="3040595">//&nbsp;as&nbsp;necessary&nbsp;to&nbsp;reach&nbsp;the&nbsp;base&nbsp;type&nbsp;(or&nbsp;nil)&nbsp;or&nbsp;an&nbsp;implementation&nbsp;of&nbsp;json.Marshal.</span><br>
<span class="lineno">125</span><span class="keyword" id="3040681">func</span>&nbsp;<span class="ident" id="3040686">indirectToJSONMarshaler</span><span class="op" id="3040709">(</span><span class="ident" id="3040710">a</span>&nbsp;<span class="keyword" id="3040712">interface</span><span class="op" id="3040721">{</span><span class="op" id="3040722">}</span><span class="op" id="3040723">)</span>&nbsp;<span class="keyword" id="3040725">interface</span><span class="op" id="3040734">{</span><span class="op" id="3040735">}</span>&nbsp;<span class="op" id="3040737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3040740">v</span>&nbsp;<span class="op" id="3040742">:=</span>&nbsp;<span class="ident" id="3040745">reflect</span><span class="op" id="3040752">.</span><span class="ident" id="3040753">ValueOf</span><span class="op" id="3040760">(</span><span class="ident" id="3040761">a</span><span class="op" id="3040762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3040765">for</span>&nbsp;<span class="op" id="3040769">!</span><span class="ident" id="3040770">v</span><span class="op" id="3040771">.</span><span class="ident" id="3040772">Type</span><span class="op" id="3040776">(</span><span class="op" id="3040777">)</span><span class="op" id="3040778">.</span><span class="ident" id="3040779">Implements</span><span class="op" id="3040789">(</span><span class="ident" id="3040790">jsonMarshalType</span><span class="op" id="3040805">)</span>&nbsp;<span class="op" id="3040807">&amp;&amp;</span>&nbsp;<span class="ident" id="3040810">v</span><span class="op" id="3040811">.</span><span class="ident" id="3040812">Kind</span><span class="op" id="3040816">(</span><span class="op" id="3040817">)</span>&nbsp;<span class="op" id="3040819">==</span>&nbsp;<span class="ident" id="3040822">reflect</span><span class="op" id="3040829">.</span><span class="ident" id="3040830">Ptr</span>&nbsp;<span class="op" id="3040834">&amp;&amp;</span>&nbsp;<span class="op" id="3040837">!</span><span class="ident" id="3040838">v</span><span class="op" id="3040839">.</span><span class="ident" id="3040840">IsNil</span><span class="op" id="3040845">(</span><span class="op" id="3040846">)</span>&nbsp;<span class="op" id="3040848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3040852">v</span>&nbsp;<span class="op" id="3040854">=</span>&nbsp;<span class="ident" id="3040856">v</span><span class="op" id="3040857">.</span><span class="ident" id="3040858">Elem</span><span class="op" id="3040862">(</span><span class="op" id="3040863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3040866">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3040869">return</span>&nbsp;<span class="ident" id="3040876">v</span><span class="op" id="3040877">.</span><span class="ident" id="3040878">Interface</span><span class="op" id="3040887">(</span><span class="op" id="3040888">)</span><br>
<span class="lineno"></span><span class="op" id="3040890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3040893">//&nbsp;jsValEscaper&nbsp;escapes&nbsp;its&nbsp;inputs&nbsp;to&nbsp;a&nbsp;JS&nbsp;Expression&nbsp;(section&nbsp;11.14)&nbsp;that&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="3040972">//&nbsp;neither&nbsp;side-effects&nbsp;nor&nbsp;free&nbsp;variables&nbsp;outside&nbsp;(NaN,&nbsp;Infinity).</span><br>
<span class="lineno">135</span><span class="keyword" id="3041040">func</span>&nbsp;<span class="ident" id="3041045">jsValEscaper</span><span class="op" id="3041057">(</span><span class="ident" id="3041058">args</span>&nbsp;<span class="op" id="3041063">...</span><span class="keyword" id="3041066">interface</span><span class="op" id="3041075">{</span><span class="op" id="3041076">}</span><span class="op" id="3041077">)</span>&nbsp;<span class="builtintype" id="3041079">string</span>&nbsp;<span class="op" id="3041086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3041089">var</span>&nbsp;<span class="ident" id="3041093">a</span>&nbsp;<span class="keyword" id="3041095">interface</span><span class="op" id="3041104">{</span><span class="op" id="3041105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3041108">if</span>&nbsp;<span class="builtinfunc" id="3041111">len</span><span class="op" id="3041114">(</span><span class="ident" id="3041115">args</span><span class="op" id="3041119">)</span>&nbsp;<span class="op" id="3041121">==</span>&nbsp;<span class="num" id="3041124">1</span>&nbsp;<span class="op" id="3041126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3041130">a</span>&nbsp;<span class="op" id="3041132">=</span>&nbsp;<span class="ident" id="3041134">indirectToJSONMarshaler</span><span class="op" id="3041157">(</span><span class="ident" id="3041158">args</span><span class="op" id="3041162">[</span><span class="num" id="3041163">0</span><span class="op" id="3041164">]</span><span class="op" id="3041165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3041169">switch</span>&nbsp;<span class="ident" id="3041176">t</span>&nbsp;<span class="op" id="3041178">:=</span>&nbsp;<span class="ident" id="3041181">a</span><span class="op" id="3041182">.</span><span class="op" id="3041183">(</span><span class="keyword" id="3041184">type</span><span class="op" id="3041188">)</span>&nbsp;<span class="op" id="3041190">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3041194">case</span>&nbsp;<span class="ident" id="3041199">JS</span><span class="op" id="3041201">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3041206">return</span>&nbsp;<span class="builtintype" id="3041213">string</span><span class="op" id="3041219">(</span><span class="ident" id="3041220">t</span><span class="op" id="3041221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3041225">case</span>&nbsp;<span class="ident" id="3041230">JSStr</span><span class="op" id="3041235">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3041240">//&nbsp;TODO:&nbsp;normalize&nbsp;quotes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3041270">return</span>&nbsp;<span class="string" id="3041277">`&#34;`</span>&nbsp;<span class="op" id="3041281">+</span>&nbsp;<span class="builtintype" id="3041283">string</span><span class="op" id="3041289">(</span><span class="ident" id="3041290">t</span><span class="op" id="3041291">)</span>&nbsp;<span class="op" id="3041293">+</span>&nbsp;<span class="string" id="3041295">`&#34;`</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3041301">case</span>&nbsp;<span class="ident" id="3041306">json</span><span class="op" id="3041310">.</span><span class="ident" id="3041311">Marshaler</span><span class="op" id="3041320">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3041325">//&nbsp;Do&nbsp;not&nbsp;treat&nbsp;as&nbsp;a&nbsp;Stringer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3041358">case</span>&nbsp;<span class="ident" id="3041363">fmt</span><span class="op" id="3041366">.</span><span class="ident" id="3041367">Stringer</span><span class="op" id="3041375">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3041380">a</span>&nbsp;<span class="op" id="3041382">=</span>&nbsp;<span class="ident" id="3041384">t</span><span class="op" id="3041385">.</span><span class="ident" id="3041386">String</span><span class="op" id="3041392">(</span><span class="op" id="3041393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3041397">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3041400">}</span>&nbsp;<span class="keyword" id="3041402">else</span>&nbsp;<span class="op" id="3041407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3041411">for</span>&nbsp;<span class="ident" id="3041415">i</span><span class="op" id="3041416">,</span>&nbsp;<span class="ident" id="3041418">arg</span>&nbsp;<span class="op" id="3041422">:=</span>&nbsp;<span class="keyword" id="3041425">range</span>&nbsp;<span class="ident" id="3041431">args</span>&nbsp;<span class="op" id="3041436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3041441">args</span><span class="op" id="3041445">[</span><span class="ident" id="3041446">i</span><span class="op" id="3041447">]</span>&nbsp;<span class="op" id="3041449">=</span>&nbsp;<span class="ident" id="3041451">indirectToJSONMarshaler</span><span class="op" id="3041474">(</span><span class="ident" id="3041475">arg</span><span class="op" id="3041478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3041482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3041486">a</span>&nbsp;<span class="op" id="3041488">=</span>&nbsp;<span class="ident" id="3041490">fmt</span><span class="op" id="3041493">.</span><span class="ident" id="3041494">Sprint</span><span class="op" id="3041500">(</span><span class="ident" id="3041501">args</span><span class="op" id="3041505">...</span><span class="op" id="3041508">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3041511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3041514">//&nbsp;TODO:&nbsp;detect&nbsp;cycles&nbsp;before&nbsp;calling&nbsp;Marshal&nbsp;which&nbsp;loops&nbsp;infinitely&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3041587">//&nbsp;cyclic&nbsp;data.&nbsp;This&nbsp;may&nbsp;be&nbsp;an&nbsp;unacceptable&nbsp;DoS&nbsp;risk.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3041643">b</span><span class="op" id="3041644">,</span>&nbsp;<span class="ident" id="3041646">err</span>&nbsp;<span class="op" id="3041650">:=</span>&nbsp;<span class="ident" id="3041653">json</span><span class="op" id="3041657">.</span><span class="ident" id="3041658">Marshal</span><span class="op" id="3041665">(</span><span class="ident" id="3041666">a</span><span class="op" id="3041667">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3041670">if</span>&nbsp;<span class="ident" id="3041673">err</span>&nbsp;<span class="op" id="3041677">!=</span>&nbsp;<span class="builtintype" id="3041680">nil</span>&nbsp;<span class="op" id="3041684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3041688">//&nbsp;Put&nbsp;a&nbsp;space&nbsp;before&nbsp;comment&nbsp;so&nbsp;that&nbsp;if&nbsp;it&nbsp;is&nbsp;flush&nbsp;against</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3041751">//&nbsp;a&nbsp;division&nbsp;operator&nbsp;it&nbsp;is&nbsp;not&nbsp;turned&nbsp;into&nbsp;a&nbsp;line&nbsp;comment:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3041814">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x/{{y}}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3041831">//&nbsp;turning&nbsp;into</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3041849">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x//*&nbsp;error&nbsp;marshalling&nbsp;y:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3041884">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;second&nbsp;line&nbsp;of&nbsp;error&nbsp;message&nbsp;*/null</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3041934">return</span>&nbsp;<span class="ident" id="3041941">fmt</span><span class="op" id="3041944">.</span><span class="ident" id="3041945">Sprintf</span><span class="op" id="3041952">(</span><span class="string" id="3041953">&#34;&nbsp;/*&nbsp;%s&nbsp;*/null&nbsp;&#34;</span><span class="op" id="3041969">,</span>&nbsp;<span class="ident" id="3041971">strings</span><span class="op" id="3041978">.</span><span class="ident" id="3041979">Replace</span><span class="op" id="3041986">(</span><span class="ident" id="3041987">err</span><span class="op" id="3041990">.</span><span class="ident" id="3041991">Error</span><span class="op" id="3041996">(</span><span class="op" id="3041997">)</span><span class="op" id="3041998">,</span>&nbsp;<span class="string" id="3042000">&#34;*/&#34;</span><span class="op" id="3042004">,</span>&nbsp;<span class="string" id="3042006">&#34;*&nbsp;/&#34;</span><span class="op" id="3042011">,</span>&nbsp;<span class="op" id="3042013">-</span><span class="num" id="3042014">1</span><span class="op" id="3042015">)</span><span class="op" id="3042016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3042019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3042023">//&nbsp;TODO:&nbsp;maybe&nbsp;post-process&nbsp;output&nbsp;to&nbsp;prevent&nbsp;it&nbsp;from&nbsp;containing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3042089">//&nbsp;&#34;&lt;!--&#34;,&nbsp;&#34;--&gt;&#34;,&nbsp;&#34;&lt;![CDATA[&#34;,&nbsp;&#34;]]&gt;&#34;,&nbsp;or&nbsp;&#34;&lt;/script&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3042142">//&nbsp;in&nbsp;case&nbsp;custom&nbsp;marshallers&nbsp;produce&nbsp;output&nbsp;containing&nbsp;those.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3042207">//&nbsp;TODO:&nbsp;Maybe&nbsp;abbreviate&nbsp;\u00ab&nbsp;to&nbsp;\xab&nbsp;to&nbsp;produce&nbsp;more&nbsp;compact&nbsp;output.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3042281">if</span>&nbsp;<span class="builtinfunc" id="3042284">len</span><span class="op" id="3042287">(</span><span class="ident" id="3042288">b</span><span class="op" id="3042289">)</span>&nbsp;<span class="op" id="3042291">==</span>&nbsp;<span class="num" id="3042294">0</span>&nbsp;<span class="op" id="3042296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3042300">//&nbsp;In,&nbsp;`x=y/{{.}}*z`&nbsp;a&nbsp;json.Marshaler&nbsp;that&nbsp;produces&nbsp;&#34;&#34;&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3042364">//&nbsp;not&nbsp;cause&nbsp;the&nbsp;output&nbsp;`x=y/*z`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3042400">return</span>&nbsp;<span class="string" id="3042407">&#34;&nbsp;null&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3042417">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3042420">first</span><span class="op" id="3042425">,</span>&nbsp;<span class="ident" id="3042427">_</span>&nbsp;<span class="op" id="3042429">:=</span>&nbsp;<span class="ident" id="3042432">utf8</span><span class="op" id="3042436">.</span><span class="ident" id="3042437">DecodeRune</span><span class="op" id="3042447">(</span><span class="ident" id="3042448">b</span><span class="op" id="3042449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3042452">last</span><span class="op" id="3042456">,</span>&nbsp;<span class="ident" id="3042458">_</span>&nbsp;<span class="op" id="3042460">:=</span>&nbsp;<span class="ident" id="3042463">utf8</span><span class="op" id="3042467">.</span><span class="ident" id="3042468">DecodeLastRune</span><span class="op" id="3042482">(</span><span class="ident" id="3042483">b</span><span class="op" id="3042484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3042487">var</span>&nbsp;<span class="ident" id="3042491">buf</span>&nbsp;<span class="ident" id="3042495">bytes</span><span class="op" id="3042500">.</span><span class="ident" id="3042501">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3042509">//&nbsp;Prevent&nbsp;IdentifierNames&nbsp;and&nbsp;NumericLiterals&nbsp;from&nbsp;running&nbsp;into</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3042575">//&nbsp;keywords:&nbsp;in,&nbsp;instanceof,&nbsp;typeof,&nbsp;void</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3042618">pad</span>&nbsp;<span class="op" id="3042622">:=</span>&nbsp;<span class="ident" id="3042625">isJSIdentPart</span><span class="op" id="3042638">(</span><span class="ident" id="3042639">first</span><span class="op" id="3042644">)</span>&nbsp;<span class="op" id="3042646">||</span>&nbsp;<span class="ident" id="3042649">isJSIdentPart</span><span class="op" id="3042662">(</span><span class="ident" id="3042663">last</span><span class="op" id="3042667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3042670">if</span>&nbsp;<span class="ident" id="3042673">pad</span>&nbsp;<span class="op" id="3042677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3042681">buf</span><span class="op" id="3042684">.</span><span class="ident" id="3042685">WriteByte</span><span class="op" id="3042694">(</span><span class="string" id="3042695">&#39;&nbsp;&#39;</span><span class="op" id="3042698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3042701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3042704">written</span>&nbsp;<span class="op" id="3042712">:=</span>&nbsp;<span class="num" id="3042715">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3042718">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;json.Marshal&nbsp;escapes&nbsp;codepoints&nbsp;U+2028&nbsp;&amp;&nbsp;U+2029</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3042785">//&nbsp;so&nbsp;it&nbsp;falls&nbsp;within&nbsp;the&nbsp;subset&nbsp;of&nbsp;JSON&nbsp;which&nbsp;is&nbsp;valid&nbsp;JS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3042846">for</span>&nbsp;<span class="ident" id="3042850">i</span>&nbsp;<span class="op" id="3042852">:=</span>&nbsp;<span class="num" id="3042855">0</span><span class="op" id="3042856">;</span>&nbsp;<span class="ident" id="3042858">i</span>&nbsp;<span class="op" id="3042860">&lt;</span>&nbsp;<span class="builtinfunc" id="3042862">len</span><span class="op" id="3042865">(</span><span class="ident" id="3042866">b</span><span class="op" id="3042867">)</span><span class="op" id="3042868">;</span>&nbsp;<span class="op" id="3042870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3042874">rune</span><span class="op" id="3042878">,</span>&nbsp;<span class="ident" id="3042880">n</span>&nbsp;<span class="op" id="3042882">:=</span>&nbsp;<span class="ident" id="3042885">utf8</span><span class="op" id="3042889">.</span><span class="ident" id="3042890">DecodeRune</span><span class="op" id="3042900">(</span><span class="ident" id="3042901">b</span><span class="op" id="3042902">[</span><span class="ident" id="3042903">i</span><span class="op" id="3042904">:</span><span class="op" id="3042905">]</span><span class="op" id="3042906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3042910">repl</span>&nbsp;<span class="op" id="3042915">:=</span>&nbsp;<span class="string" id="3042918">&#34;&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3042923">if</span>&nbsp;<span class="builtintype" id="3042926">rune</span>&nbsp;<span class="op" id="3042931">==</span>&nbsp;<span class="num" id="3042934">0x2028</span>&nbsp;<span class="op" id="3042941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3042946">repl</span>&nbsp;<span class="op" id="3042951">=</span>&nbsp;<span class="string" id="3042953">`\u2028`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3042964">}</span>&nbsp;<span class="keyword" id="3042966">else</span>&nbsp;<span class="keyword" id="3042971">if</span>&nbsp;<span class="builtintype" id="3042974">rune</span>&nbsp;<span class="op" id="3042979">==</span>&nbsp;<span class="num" id="3042982">0x2029</span>&nbsp;<span class="op" id="3042989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3042994">repl</span>&nbsp;<span class="op" id="3042999">=</span>&nbsp;<span class="string" id="3043001">`\u2029`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3043012">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043016">if</span>&nbsp;<span class="ident" id="3043019">repl</span>&nbsp;<span class="op" id="3043024">!=</span>&nbsp;<span class="string" id="3043027">&#34;&#34;</span>&nbsp;<span class="op" id="3043030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3043035">buf</span><span class="op" id="3043038">.</span><span class="ident" id="3043039">Write</span><span class="op" id="3043044">(</span><span class="ident" id="3043045">b</span><span class="op" id="3043046">[</span><span class="ident" id="3043047">written</span><span class="op" id="3043054">:</span><span class="ident" id="3043055">i</span><span class="op" id="3043056">]</span><span class="op" id="3043057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3043062">buf</span><span class="op" id="3043065">.</span><span class="ident" id="3043066">WriteString</span><span class="op" id="3043077">(</span><span class="ident" id="3043078">repl</span><span class="op" id="3043082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3043087">written</span>&nbsp;<span class="op" id="3043095">=</span>&nbsp;<span class="ident" id="3043097">i</span>&nbsp;<span class="op" id="3043099">+</span>&nbsp;<span class="ident" id="3043101">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3043105">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3043109">i</span>&nbsp;<span class="op" id="3043111">+=</span>&nbsp;<span class="ident" id="3043114">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3043117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043120">if</span>&nbsp;<span class="ident" id="3043123">buf</span><span class="op" id="3043126">.</span><span class="ident" id="3043127">Len</span><span class="op" id="3043130">(</span><span class="op" id="3043131">)</span>&nbsp;<span class="op" id="3043133">!=</span>&nbsp;<span class="num" id="3043136">0</span>&nbsp;<span class="op" id="3043138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3043142">buf</span><span class="op" id="3043145">.</span><span class="ident" id="3043146">Write</span><span class="op" id="3043151">(</span><span class="ident" id="3043152">b</span><span class="op" id="3043153">[</span><span class="ident" id="3043154">written</span><span class="op" id="3043161">:</span><span class="op" id="3043162">]</span><span class="op" id="3043163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043167">if</span>&nbsp;<span class="ident" id="3043170">pad</span>&nbsp;<span class="op" id="3043174">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3043179">buf</span><span class="op" id="3043182">.</span><span class="ident" id="3043183">WriteByte</span><span class="op" id="3043192">(</span><span class="string" id="3043193">&#39;&nbsp;&#39;</span><span class="op" id="3043196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3043200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3043204">b</span>&nbsp;<span class="op" id="3043206">=</span>&nbsp;<span class="ident" id="3043208">buf</span><span class="op" id="3043211">.</span><span class="ident" id="3043212">Bytes</span><span class="op" id="3043217">(</span><span class="op" id="3043218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3043221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043224">return</span>&nbsp;<span class="builtintype" id="3043231">string</span><span class="op" id="3043237">(</span><span class="ident" id="3043238">b</span><span class="op" id="3043239">)</span><br>
<span class="lineno">215</span><span class="op" id="3043241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3043244">//&nbsp;jsStrEscaper&nbsp;produces&nbsp;a&nbsp;string&nbsp;that&nbsp;can&nbsp;be&nbsp;included&nbsp;between&nbsp;quotes&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3043317">//&nbsp;JavaScript&nbsp;source,&nbsp;in&nbsp;JavaScript&nbsp;embedded&nbsp;in&nbsp;an&nbsp;HTML5&nbsp;&lt;script&gt;&nbsp;element,</span><br>
<span class="lineno"></span><span class="comment" id="3043392">//&nbsp;or&nbsp;in&nbsp;an&nbsp;HTML5&nbsp;event&nbsp;handler&nbsp;attribute&nbsp;such&nbsp;as&nbsp;onclick.</span><br>
<span class="lineno">220</span><span class="keyword" id="3043451">func</span>&nbsp;<span class="ident" id="3043456">jsStrEscaper</span><span class="op" id="3043468">(</span><span class="ident" id="3043469">args</span>&nbsp;<span class="op" id="3043474">...</span><span class="keyword" id="3043477">interface</span><span class="op" id="3043486">{</span><span class="op" id="3043487">}</span><span class="op" id="3043488">)</span>&nbsp;<span class="builtintype" id="3043490">string</span>&nbsp;<span class="op" id="3043497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3043500">s</span><span class="op" id="3043501">,</span>&nbsp;<span class="ident" id="3043503">t</span>&nbsp;<span class="op" id="3043505">:=</span>&nbsp;<span class="ident" id="3043508">stringify</span><span class="op" id="3043517">(</span><span class="ident" id="3043518">args</span><span class="op" id="3043522">...</span><span class="op" id="3043525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043528">if</span>&nbsp;<span class="ident" id="3043531">t</span>&nbsp;<span class="op" id="3043533">==</span>&nbsp;<span class="ident" id="3043536">contentTypeJSStr</span>&nbsp;<span class="op" id="3043553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043557">return</span>&nbsp;<span class="ident" id="3043564">replace</span><span class="op" id="3043571">(</span><span class="ident" id="3043572">s</span><span class="op" id="3043573">,</span>&nbsp;<span class="ident" id="3043575">jsStrNormReplacementTable</span><span class="op" id="3043600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3043603">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3043606">return</span>&nbsp;<span class="ident" id="3043613">replace</span><span class="op" id="3043620">(</span><span class="ident" id="3043621">s</span><span class="op" id="3043622">,</span>&nbsp;<span class="ident" id="3043624">jsStrReplacementTable</span><span class="op" id="3043645">)</span><br>
<span class="lineno"></span><span class="op" id="3043647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3043650">//&nbsp;jsRegexpEscaper&nbsp;behaves&nbsp;like&nbsp;jsStrEscaper&nbsp;but&nbsp;escapes&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="3043726">//&nbsp;specials&nbsp;so&nbsp;the&nbsp;result&nbsp;is&nbsp;treated&nbsp;literally&nbsp;when&nbsp;included&nbsp;in&nbsp;a&nbsp;regular</span><br>
<span class="lineno">230</span><span class="comment" id="3043800">//&nbsp;expression&nbsp;literal.&nbsp;/foo{{.X}}bar/&nbsp;matches&nbsp;the&nbsp;string&nbsp;&#34;foo&#34;&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="3043875">//&nbsp;the&nbsp;literal&nbsp;text&nbsp;of&nbsp;{{.X}}&nbsp;followed&nbsp;by&nbsp;the&nbsp;string&nbsp;&#34;bar&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3043935">func</span>&nbsp;<span class="ident" id="3043940">jsRegexpEscaper</span><span class="op" id="3043955">(</span><span class="ident" id="3043956">args</span>&nbsp;<span class="op" id="3043961">...</span><span class="keyword" id="3043964">interface</span><span class="op" id="3043973">{</span><span class="op" id="3043974">}</span><span class="op" id="3043975">)</span>&nbsp;<span class="builtintype" id="3043977">string</span>&nbsp;<span class="op" id="3043984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3043987">s</span><span class="op" id="3043988">,</span>&nbsp;<span class="ident" id="3043990">_</span>&nbsp;<span class="op" id="3043992">:=</span>&nbsp;<span class="ident" id="3043995">stringify</span><span class="op" id="3044004">(</span><span class="ident" id="3044005">args</span><span class="op" id="3044009">...</span><span class="op" id="3044012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3044015">s</span>&nbsp;<span class="op" id="3044017">=</span>&nbsp;<span class="ident" id="3044019">replace</span><span class="op" id="3044026">(</span><span class="ident" id="3044027">s</span><span class="op" id="3044028">,</span>&nbsp;<span class="ident" id="3044030">jsRegexpReplacementTable</span><span class="op" id="3044054">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044057">if</span>&nbsp;<span class="ident" id="3044060">s</span>&nbsp;<span class="op" id="3044062">==</span>&nbsp;<span class="string" id="3044065">&#34;&#34;</span>&nbsp;<span class="op" id="3044068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3044072">//&nbsp;/{{.X}}/&nbsp;should&nbsp;not&nbsp;produce&nbsp;a&nbsp;line&nbsp;comment&nbsp;when&nbsp;.X&nbsp;==&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044135">return</span>&nbsp;<span class="string" id="3044142">&#34;(?:)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3044150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044153">return</span>&nbsp;<span class="ident" id="3044160">s</span><br>
<span class="lineno">240</span><span class="op" id="3044162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3044165">//&nbsp;replace&nbsp;replaces&nbsp;each&nbsp;rune&nbsp;r&nbsp;of&nbsp;s&nbsp;with&nbsp;replacementTable[r],&nbsp;provided&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3044242">//&nbsp;r&nbsp;&lt;&nbsp;len(replacementTable).&nbsp;If&nbsp;replacementTable[r]&nbsp;is&nbsp;the&nbsp;empty&nbsp;string&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="3044320">//&nbsp;no&nbsp;replacement&nbsp;is&nbsp;made.</span><br>
<span class="lineno">245</span><span class="comment" id="3044347">//&nbsp;It&nbsp;also&nbsp;replaces&nbsp;runes&nbsp;U+2028&nbsp;and&nbsp;U+2029&nbsp;with&nbsp;the&nbsp;raw&nbsp;strings&nbsp;`\u2028`&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3044425">//&nbsp;`\u2029`.</span><br>
<span class="lineno"></span><span class="keyword" id="3044438">func</span>&nbsp;<span class="ident" id="3044443">replace</span><span class="op" id="3044450">(</span><span class="ident" id="3044451">s</span>&nbsp;<span class="builtintype" id="3044453">string</span><span class="op" id="3044459">,</span>&nbsp;<span class="ident" id="3044461">replacementTable</span>&nbsp;<span class="op" id="3044478">[</span><span class="op" id="3044479">]</span><span class="builtintype" id="3044480">string</span><span class="op" id="3044486">)</span>&nbsp;<span class="builtintype" id="3044488">string</span>&nbsp;<span class="op" id="3044495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044498">var</span>&nbsp;<span class="ident" id="3044502">b</span>&nbsp;<span class="ident" id="3044504">bytes</span><span class="op" id="3044509">.</span><span class="ident" id="3044510">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3044518">written</span>&nbsp;<span class="op" id="3044526">:=</span>&nbsp;<span class="num" id="3044529">0</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044532">for</span>&nbsp;<span class="ident" id="3044536">i</span><span class="op" id="3044537">,</span>&nbsp;<span class="ident" id="3044539">r</span>&nbsp;<span class="op" id="3044541">:=</span>&nbsp;<span class="keyword" id="3044544">range</span>&nbsp;<span class="ident" id="3044550">s</span>&nbsp;<span class="op" id="3044552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044556">var</span>&nbsp;<span class="ident" id="3044560">repl</span>&nbsp;<span class="builtintype" id="3044565">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044574">switch</span>&nbsp;<span class="op" id="3044581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044585">case</span>&nbsp;<span class="builtintype" id="3044590">int</span><span class="op" id="3044593">(</span><span class="ident" id="3044594">r</span><span class="op" id="3044595">)</span>&nbsp;<span class="op" id="3044597">&lt;</span>&nbsp;<span class="builtinfunc" id="3044599">len</span><span class="op" id="3044602">(</span><span class="ident" id="3044603">replacementTable</span><span class="op" id="3044619">)</span>&nbsp;<span class="op" id="3044621">&amp;&amp;</span>&nbsp;<span class="ident" id="3044624">replacementTable</span><span class="op" id="3044640">[</span><span class="ident" id="3044641">r</span><span class="op" id="3044642">]</span>&nbsp;<span class="op" id="3044644">!=</span>&nbsp;<span class="string" id="3044647">&#34;&#34;</span><span class="op" id="3044649">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3044654">repl</span>&nbsp;<span class="op" id="3044659">=</span>&nbsp;<span class="ident" id="3044661">replacementTable</span><span class="op" id="3044677">[</span><span class="ident" id="3044678">r</span><span class="op" id="3044679">]</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044683">case</span>&nbsp;<span class="ident" id="3044688">r</span>&nbsp;<span class="op" id="3044690">==</span>&nbsp;<span class="string" id="3044693">&#39;\u2028&#39;</span><span class="op" id="3044701">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3044706">repl</span>&nbsp;<span class="op" id="3044711">=</span>&nbsp;<span class="string" id="3044713">`\u2028`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044724">case</span>&nbsp;<span class="ident" id="3044729">r</span>&nbsp;<span class="op" id="3044731">==</span>&nbsp;<span class="string" id="3044734">&#39;\u2029&#39;</span><span class="op" id="3044742">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3044747">repl</span>&nbsp;<span class="op" id="3044752">=</span>&nbsp;<span class="string" id="3044754">`\u2029`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044765">default</span><span class="op" id="3044772">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044777">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3044788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3044792">b</span><span class="op" id="3044793">.</span><span class="ident" id="3044794">WriteString</span><span class="op" id="3044805">(</span><span class="ident" id="3044806">s</span><span class="op" id="3044807">[</span><span class="ident" id="3044808">written</span><span class="op" id="3044815">:</span><span class="ident" id="3044816">i</span><span class="op" id="3044817">]</span><span class="op" id="3044818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3044822">b</span><span class="op" id="3044823">.</span><span class="ident" id="3044824">WriteString</span><span class="op" id="3044835">(</span><span class="ident" id="3044836">repl</span><span class="op" id="3044840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3044844">written</span>&nbsp;<span class="op" id="3044852">=</span>&nbsp;<span class="ident" id="3044854">i</span>&nbsp;<span class="op" id="3044856">+</span>&nbsp;<span class="ident" id="3044858">utf8</span><span class="op" id="3044862">.</span><span class="ident" id="3044863">RuneLen</span><span class="op" id="3044870">(</span><span class="ident" id="3044871">r</span><span class="op" id="3044872">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3044875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044878">if</span>&nbsp;<span class="ident" id="3044881">written</span>&nbsp;<span class="op" id="3044889">==</span>&nbsp;<span class="num" id="3044892">0</span>&nbsp;<span class="op" id="3044894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044898">return</span>&nbsp;<span class="ident" id="3044905">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3044908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3044911">b</span><span class="op" id="3044912">.</span><span class="ident" id="3044913">WriteString</span><span class="op" id="3044924">(</span><span class="ident" id="3044925">s</span><span class="op" id="3044926">[</span><span class="ident" id="3044927">written</span><span class="op" id="3044934">:</span><span class="op" id="3044935">]</span><span class="op" id="3044936">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3044939">return</span>&nbsp;<span class="ident" id="3044946">b</span><span class="op" id="3044947">.</span><span class="ident" id="3044948">String</span><span class="op" id="3044954">(</span><span class="op" id="3044955">)</span><br>
<span class="lineno"></span><span class="op" id="3044957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3044960">var</span>&nbsp;<span class="ident" id="3044964">jsStrReplacementTable</span>&nbsp;<span class="op" id="3044986">=</span>&nbsp;<span class="op" id="3044988">[</span><span class="op" id="3044989">]</span><span class="builtintype" id="3044990">string</span><span class="op" id="3044996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3044999">0</span><span class="op" id="3045000">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045005">`\0`</span><span class="op" id="3045009">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045012">&#39;\t&#39;</span><span class="op" id="3045016">:</span>&nbsp;<span class="string" id="3045018">`\t`</span><span class="op" id="3045022">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045025">&#39;\n&#39;</span><span class="op" id="3045029">:</span>&nbsp;<span class="string" id="3045031">`\n`</span><span class="op" id="3045035">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045038">&#39;\v&#39;</span><span class="op" id="3045042">:</span>&nbsp;<span class="string" id="3045044">`\x0b`</span><span class="op" id="3045050">,</span>&nbsp;<span class="comment" id="3045052">//&nbsp;&#34;\v&#34;&nbsp;==&nbsp;&#34;v&#34;&nbsp;on&nbsp;IE&nbsp;6.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045077">&#39;\f&#39;</span><span class="op" id="3045081">:</span>&nbsp;<span class="string" id="3045083">`\f`</span><span class="op" id="3045087">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045090">&#39;\r&#39;</span><span class="op" id="3045094">:</span>&nbsp;<span class="string" id="3045096">`\r`</span><span class="op" id="3045100">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3045103">//&nbsp;Encode&nbsp;HTML&nbsp;specials&nbsp;as&nbsp;hex&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3045165">//&nbsp;in&nbsp;HTML&nbsp;attributes&nbsp;without&nbsp;further&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045214">&#39;&#34;&#39;</span><span class="op" id="3045217">:</span>&nbsp;&nbsp;<span class="string" id="3045220">`\x22`</span><span class="op" id="3045226">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045229">&#39;&amp;&#39;</span><span class="op" id="3045232">:</span>&nbsp;&nbsp;<span class="string" id="3045235">`\x26`</span><span class="op" id="3045241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045244">&#39;\&#39;&#39;</span><span class="op" id="3045248">:</span>&nbsp;<span class="string" id="3045250">`\x27`</span><span class="op" id="3045256">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045259">&#39;+&#39;</span><span class="op" id="3045262">:</span>&nbsp;&nbsp;<span class="string" id="3045265">`\x2b`</span><span class="op" id="3045271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045274">&#39;/&#39;</span><span class="op" id="3045277">:</span>&nbsp;&nbsp;<span class="string" id="3045280">`\/`</span><span class="op" id="3045284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045287">&#39;&lt;&#39;</span><span class="op" id="3045290">:</span>&nbsp;&nbsp;<span class="string" id="3045293">`\x3c`</span><span class="op" id="3045299">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045302">&#39;&gt;&#39;</span><span class="op" id="3045305">:</span>&nbsp;&nbsp;<span class="string" id="3045308">`\x3e`</span><span class="op" id="3045314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045317">&#39;\\&#39;</span><span class="op" id="3045321">:</span>&nbsp;<span class="string" id="3045323">`\\`</span><span class="op" id="3045327">,</span><br>
<span class="lineno">290</span><span class="op" id="3045329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3045332">//&nbsp;jsStrNormReplacementTable&nbsp;is&nbsp;like&nbsp;jsStrReplacementTable&nbsp;but&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3045404">//&nbsp;overencode&nbsp;existing&nbsp;escapes&nbsp;since&nbsp;this&nbsp;table&nbsp;has&nbsp;no&nbsp;entry&nbsp;for&nbsp;`\`.</span><br>
<span class="lineno"></span><span class="keyword" id="3045474">var</span>&nbsp;<span class="ident" id="3045478">jsStrNormReplacementTable</span>&nbsp;<span class="op" id="3045504">=</span>&nbsp;<span class="op" id="3045506">[</span><span class="op" id="3045507">]</span><span class="builtintype" id="3045508">string</span><span class="op" id="3045514">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3045517">0</span><span class="op" id="3045518">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045523">`\0`</span><span class="op" id="3045527">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045530">&#39;\t&#39;</span><span class="op" id="3045534">:</span>&nbsp;<span class="string" id="3045536">`\t`</span><span class="op" id="3045540">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045543">&#39;\n&#39;</span><span class="op" id="3045547">:</span>&nbsp;<span class="string" id="3045549">`\n`</span><span class="op" id="3045553">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045556">&#39;\v&#39;</span><span class="op" id="3045560">:</span>&nbsp;<span class="string" id="3045562">`\x0b`</span><span class="op" id="3045568">,</span>&nbsp;<span class="comment" id="3045570">//&nbsp;&#34;\v&#34;&nbsp;==&nbsp;&#34;v&#34;&nbsp;on&nbsp;IE&nbsp;6.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045595">&#39;\f&#39;</span><span class="op" id="3045599">:</span>&nbsp;<span class="string" id="3045601">`\f`</span><span class="op" id="3045605">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045608">&#39;\r&#39;</span><span class="op" id="3045612">:</span>&nbsp;<span class="string" id="3045614">`\r`</span><span class="op" id="3045618">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3045621">//&nbsp;Encode&nbsp;HTML&nbsp;specials&nbsp;as&nbsp;hex&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3045683">//&nbsp;in&nbsp;HTML&nbsp;attributes&nbsp;without&nbsp;further&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045732">&#39;&#34;&#39;</span><span class="op" id="3045735">:</span>&nbsp;&nbsp;<span class="string" id="3045738">`\x22`</span><span class="op" id="3045744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045747">&#39;&amp;&#39;</span><span class="op" id="3045750">:</span>&nbsp;&nbsp;<span class="string" id="3045753">`\x26`</span><span class="op" id="3045759">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045762">&#39;\&#39;&#39;</span><span class="op" id="3045766">:</span>&nbsp;<span class="string" id="3045768">`\x27`</span><span class="op" id="3045774">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045777">&#39;+&#39;</span><span class="op" id="3045780">:</span>&nbsp;&nbsp;<span class="string" id="3045783">`\x2b`</span><span class="op" id="3045789">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045792">&#39;/&#39;</span><span class="op" id="3045795">:</span>&nbsp;&nbsp;<span class="string" id="3045798">`\/`</span><span class="op" id="3045802">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045805">&#39;&lt;&#39;</span><span class="op" id="3045808">:</span>&nbsp;&nbsp;<span class="string" id="3045811">`\x3c`</span><span class="op" id="3045817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045820">&#39;&gt;&#39;</span><span class="op" id="3045823">:</span>&nbsp;&nbsp;<span class="string" id="3045826">`\x3e`</span><span class="op" id="3045832">,</span><br>
<span class="lineno">310</span><span class="op" id="3045834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3045837">var</span>&nbsp;<span class="ident" id="3045841">jsRegexpReplacementTable</span>&nbsp;<span class="op" id="3045866">=</span>&nbsp;<span class="op" id="3045868">[</span><span class="op" id="3045869">]</span><span class="builtintype" id="3045870">string</span><span class="op" id="3045876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3045879">0</span><span class="op" id="3045880">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045885">`\0`</span><span class="op" id="3045889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045892">&#39;\t&#39;</span><span class="op" id="3045896">:</span>&nbsp;<span class="string" id="3045898">`\t`</span><span class="op" id="3045902">,</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045905">&#39;\n&#39;</span><span class="op" id="3045909">:</span>&nbsp;<span class="string" id="3045911">`\n`</span><span class="op" id="3045915">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045918">&#39;\v&#39;</span><span class="op" id="3045922">:</span>&nbsp;<span class="string" id="3045924">`\x0b`</span><span class="op" id="3045930">,</span>&nbsp;<span class="comment" id="3045932">//&nbsp;&#34;\v&#34;&nbsp;==&nbsp;&#34;v&#34;&nbsp;on&nbsp;IE&nbsp;6.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045957">&#39;\f&#39;</span><span class="op" id="3045961">:</span>&nbsp;<span class="string" id="3045963">`\f`</span><span class="op" id="3045967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3045970">&#39;\r&#39;</span><span class="op" id="3045974">:</span>&nbsp;<span class="string" id="3045976">`\r`</span><span class="op" id="3045980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3045983">//&nbsp;Encode&nbsp;HTML&nbsp;specials&nbsp;as&nbsp;hex&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3046045">//&nbsp;in&nbsp;HTML&nbsp;attributes&nbsp;without&nbsp;further&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046094">&#39;&#34;&#39;</span><span class="op" id="3046097">:</span>&nbsp;&nbsp;<span class="string" id="3046100">`\x22`</span><span class="op" id="3046106">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046109">&#39;$&#39;</span><span class="op" id="3046112">:</span>&nbsp;&nbsp;<span class="string" id="3046115">`\$`</span><span class="op" id="3046119">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046122">&#39;&amp;&#39;</span><span class="op" id="3046125">:</span>&nbsp;&nbsp;<span class="string" id="3046128">`\x26`</span><span class="op" id="3046134">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046137">&#39;\&#39;&#39;</span><span class="op" id="3046141">:</span>&nbsp;<span class="string" id="3046143">`\x27`</span><span class="op" id="3046149">,</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046152">&#39;(&#39;</span><span class="op" id="3046155">:</span>&nbsp;&nbsp;<span class="string" id="3046158">`\(`</span><span class="op" id="3046162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046165">&#39;)&#39;</span><span class="op" id="3046168">:</span>&nbsp;&nbsp;<span class="string" id="3046171">`\)`</span><span class="op" id="3046175">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046178">&#39;*&#39;</span><span class="op" id="3046181">:</span>&nbsp;&nbsp;<span class="string" id="3046184">`\*`</span><span class="op" id="3046188">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046191">&#39;+&#39;</span><span class="op" id="3046194">:</span>&nbsp;&nbsp;<span class="string" id="3046197">`\x2b`</span><span class="op" id="3046203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046206">&#39;-&#39;</span><span class="op" id="3046209">:</span>&nbsp;&nbsp;<span class="string" id="3046212">`\-`</span><span class="op" id="3046216">,</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046219">&#39;.&#39;</span><span class="op" id="3046222">:</span>&nbsp;&nbsp;<span class="string" id="3046225">`\.`</span><span class="op" id="3046229">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046232">&#39;/&#39;</span><span class="op" id="3046235">:</span>&nbsp;&nbsp;<span class="string" id="3046238">`\/`</span><span class="op" id="3046242">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046245">&#39;&lt;&#39;</span><span class="op" id="3046248">:</span>&nbsp;&nbsp;<span class="string" id="3046251">`\x3c`</span><span class="op" id="3046257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046260">&#39;&gt;&#39;</span><span class="op" id="3046263">:</span>&nbsp;&nbsp;<span class="string" id="3046266">`\x3e`</span><span class="op" id="3046272">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046275">&#39;?&#39;</span><span class="op" id="3046278">:</span>&nbsp;&nbsp;<span class="string" id="3046281">`\?`</span><span class="op" id="3046285">,</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046288">&#39;[&#39;</span><span class="op" id="3046291">:</span>&nbsp;&nbsp;<span class="string" id="3046294">`\[`</span><span class="op" id="3046298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046301">&#39;\\&#39;</span><span class="op" id="3046305">:</span>&nbsp;<span class="string" id="3046307">`\\`</span><span class="op" id="3046311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046314">&#39;]&#39;</span><span class="op" id="3046317">:</span>&nbsp;&nbsp;<span class="string" id="3046320">`\]`</span><span class="op" id="3046324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046327">&#39;^&#39;</span><span class="op" id="3046330">:</span>&nbsp;&nbsp;<span class="string" id="3046333">`\^`</span><span class="op" id="3046337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046340">&#39;{&#39;</span><span class="op" id="3046343">:</span>&nbsp;&nbsp;<span class="string" id="3046346">`\{`</span><span class="op" id="3046350">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046353">&#39;|&#39;</span><span class="op" id="3046356">:</span>&nbsp;&nbsp;<span class="string" id="3046359">`\|`</span><span class="op" id="3046363">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3046366">&#39;}&#39;</span><span class="op" id="3046369">:</span>&nbsp;&nbsp;<span class="string" id="3046372">`\}`</span><span class="op" id="3046376">,</span><br>
<span class="lineno"></span><span class="op" id="3046378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3046381">//&nbsp;isJSIdentPart&nbsp;reports&nbsp;whether&nbsp;the&nbsp;given&nbsp;rune&nbsp;is&nbsp;a&nbsp;JS&nbsp;identifier&nbsp;part.</span><br>
<span class="lineno">345</span><span class="comment" id="3046454">//&nbsp;It&nbsp;does&nbsp;not&nbsp;handle&nbsp;all&nbsp;the&nbsp;non-Latin&nbsp;letters,&nbsp;joiners,&nbsp;and&nbsp;combining&nbsp;marks,</span><br>
<span class="lineno"></span><span class="comment" id="3046533">//&nbsp;but&nbsp;it&nbsp;does&nbsp;handle&nbsp;every&nbsp;codepoint&nbsp;that&nbsp;can&nbsp;occur&nbsp;in&nbsp;a&nbsp;numeric&nbsp;literal&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3046610">//&nbsp;a&nbsp;keyword.</span><br>
<span class="lineno"></span><span class="keyword" id="3046624">func</span>&nbsp;<span class="ident" id="3046629">isJSIdentPart</span><span class="op" id="3046642">(</span><span class="ident" id="3046643">r</span>&nbsp;<span class="builtintype" id="3046645">rune</span><span class="op" id="3046649">)</span>&nbsp;<span class="builtintype" id="3046651">bool</span>&nbsp;<span class="op" id="3046656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046659">switch</span>&nbsp;<span class="op" id="3046666">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046669">case</span>&nbsp;<span class="ident" id="3046674">r</span>&nbsp;<span class="op" id="3046676">==</span>&nbsp;<span class="string" id="3046679">&#39;$&#39;</span><span class="op" id="3046682">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046686">return</span>&nbsp;<span class="builtintype" id="3046693">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046699">case</span>&nbsp;<span class="string" id="3046704">&#39;0&#39;</span>&nbsp;<span class="op" id="3046708">&lt;=</span>&nbsp;<span class="ident" id="3046711">r</span>&nbsp;<span class="op" id="3046713">&amp;&amp;</span>&nbsp;<span class="ident" id="3046716">r</span>&nbsp;<span class="op" id="3046718">&lt;=</span>&nbsp;<span class="string" id="3046721">&#39;9&#39;</span><span class="op" id="3046724">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046728">return</span>&nbsp;<span class="builtintype" id="3046735">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046741">case</span>&nbsp;<span class="string" id="3046746">&#39;A&#39;</span>&nbsp;<span class="op" id="3046750">&lt;=</span>&nbsp;<span class="ident" id="3046753">r</span>&nbsp;<span class="op" id="3046755">&amp;&amp;</span>&nbsp;<span class="ident" id="3046758">r</span>&nbsp;<span class="op" id="3046760">&lt;=</span>&nbsp;<span class="string" id="3046763">&#39;Z&#39;</span><span class="op" id="3046766">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046770">return</span>&nbsp;<span class="builtintype" id="3046777">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046783">case</span>&nbsp;<span class="ident" id="3046788">r</span>&nbsp;<span class="op" id="3046790">==</span>&nbsp;<span class="string" id="3046793">&#39;_&#39;</span><span class="op" id="3046796">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046800">return</span>&nbsp;<span class="builtintype" id="3046807">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046813">case</span>&nbsp;<span class="string" id="3046818">&#39;a&#39;</span>&nbsp;<span class="op" id="3046822">&lt;=</span>&nbsp;<span class="ident" id="3046825">r</span>&nbsp;<span class="op" id="3046827">&amp;&amp;</span>&nbsp;<span class="ident" id="3046830">r</span>&nbsp;<span class="op" id="3046832">&lt;=</span>&nbsp;<span class="string" id="3046835">&#39;z&#39;</span><span class="op" id="3046838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046842">return</span>&nbsp;<span class="builtintype" id="3046849">true</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3046855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3046858">return</span>&nbsp;<span class="builtintype" id="3046865">false</span><br>
<span class="lineno"></span><span class="op" id="3046871">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
