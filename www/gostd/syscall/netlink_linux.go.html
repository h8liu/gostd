<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2530178">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2530234">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2530288">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2530339">//&nbsp;Netlink&nbsp;sockets&nbsp;and&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2530372">package</span>&nbsp;<span class="ident" id="2530380">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2530389">import</span>&nbsp;<span class="string" id="2530396">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2530406">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;netlink&nbsp;message&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2530472">func</span>&nbsp;<span class="ident" id="2530477">nlmAlignOf</span><span class="op" id="2530487">(</span><span class="ident" id="2530488">msglen</span>&nbsp;<span class="builtintype" id="2530495">int</span><span class="op" id="2530498">)</span>&nbsp;<span class="builtintype" id="2530500">int</span>&nbsp;<span class="op" id="2530504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2530507">return</span>&nbsp;<span class="op" id="2530514">(</span><span class="ident" id="2530515">msglen</span>&nbsp;<span class="op" id="2530522">+</span>&nbsp;<span class="ident" id="2530524">NLMSG_ALIGNTO</span>&nbsp;<span class="op" id="2530538">-</span>&nbsp;<span class="num" id="2530540">1</span><span class="op" id="2530541">)</span>&nbsp;<span class="op" id="2530543">&amp;</span>&nbsp;<span class="op" id="2530545">^</span><span class="op" id="2530546">(</span><span class="ident" id="2530547">NLMSG_ALIGNTO</span>&nbsp;<span class="op" id="2530561">-</span>&nbsp;<span class="num" id="2530563">1</span><span class="op" id="2530564">)</span><br>
<span class="lineno"></span><span class="op" id="2530566">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2530569">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;netlink&nbsp;route&nbsp;attribute&nbsp;up&nbsp;to&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="2530633">//&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2530646">func</span>&nbsp;<span class="ident" id="2530651">rtaAlignOf</span><span class="op" id="2530661">(</span><span class="ident" id="2530662">attrlen</span>&nbsp;<span class="builtintype" id="2530670">int</span><span class="op" id="2530673">)</span>&nbsp;<span class="builtintype" id="2530675">int</span>&nbsp;<span class="op" id="2530679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2530682">return</span>&nbsp;<span class="op" id="2530689">(</span><span class="ident" id="2530690">attrlen</span>&nbsp;<span class="op" id="2530698">+</span>&nbsp;<span class="ident" id="2530700">RTA_ALIGNTO</span>&nbsp;<span class="op" id="2530712">-</span>&nbsp;<span class="num" id="2530714">1</span><span class="op" id="2530715">)</span>&nbsp;<span class="op" id="2530717">&amp;</span>&nbsp;<span class="op" id="2530719">^</span><span class="op" id="2530720">(</span><span class="ident" id="2530721">RTA_ALIGNTO</span>&nbsp;<span class="op" id="2530733">-</span>&nbsp;<span class="num" id="2530735">1</span><span class="op" id="2530736">)</span><br>
<span class="lineno">20</span><span class="op" id="2530738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2530741">//&nbsp;NetlinkRouteRequest&nbsp;represents&nbsp;a&nbsp;request&nbsp;message&nbsp;to&nbsp;receive&nbsp;routing</span><br>
<span class="lineno"></span><span class="comment" id="2530812">//&nbsp;and&nbsp;link&nbsp;states&nbsp;from&nbsp;the&nbsp;kernel.</span><br>
<span class="lineno"></span><span class="keyword" id="2530848">type</span>&nbsp;<span class="ident" id="2530853">NetlinkRouteRequest</span>&nbsp;<span class="keyword" id="2530873">struct</span>&nbsp;<span class="op" id="2530880">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2530883">Header</span>&nbsp;<span class="ident" id="2530890">NlMsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2530900">Data</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2530907">RtGenmsg</span><br>
<span class="lineno"></span><span class="op" id="2530916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2530919">func</span>&nbsp;<span class="op" id="2530924">(</span><span class="ident" id="2530925">rr</span>&nbsp;<span class="op" id="2530928">*</span><span class="ident" id="2530929">NetlinkRouteRequest</span><span class="op" id="2530948">)</span>&nbsp;<span class="ident" id="2530950">toWireFormat</span><span class="op" id="2530962">(</span><span class="op" id="2530963">)</span>&nbsp;<span class="op" id="2530965">[</span><span class="op" id="2530966">]</span><span class="builtintype" id="2530967">byte</span>&nbsp;<span class="op" id="2530972">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2530975">b</span>&nbsp;<span class="op" id="2530977">:=</span>&nbsp;<span class="builtinfunc" id="2530980">make</span><span class="op" id="2530984">(</span><span class="op" id="2530985">[</span><span class="op" id="2530986">]</span><span class="builtintype" id="2530987">byte</span><span class="op" id="2530991">,</span>&nbsp;<span class="ident" id="2530993">rr</span><span class="op" id="2530995">.</span><span class="ident" id="2530996">Header</span><span class="op" id="2531002">.</span><span class="ident" id="2531003">Len</span><span class="op" id="2531006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2531009">*</span><span class="op" id="2531010">(</span><span class="op" id="2531011">*</span><span class="builtintype" id="2531012">uint32</span><span class="op" id="2531018">)</span><span class="op" id="2531019">(</span><span class="ident" id="2531020">unsafe</span><span class="op" id="2531026">.</span><span class="ident" id="2531027">Pointer</span><span class="op" id="2531034">(</span><span class="op" id="2531035">&amp;</span><span class="ident" id="2531036">b</span><span class="op" id="2531037">[</span><span class="num" id="2531038">0</span><span class="op" id="2531039">:</span><span class="num" id="2531040">4</span><span class="op" id="2531041">]</span><span class="op" id="2531042">[</span><span class="num" id="2531043">0</span><span class="op" id="2531044">]</span><span class="op" id="2531045">)</span><span class="op" id="2531046">)</span>&nbsp;<span class="op" id="2531048">=</span>&nbsp;<span class="ident" id="2531050">rr</span><span class="op" id="2531052">.</span><span class="ident" id="2531053">Header</span><span class="op" id="2531059">.</span><span class="ident" id="2531060">Len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2531065">*</span><span class="op" id="2531066">(</span><span class="op" id="2531067">*</span><span class="builtintype" id="2531068">uint16</span><span class="op" id="2531074">)</span><span class="op" id="2531075">(</span><span class="ident" id="2531076">unsafe</span><span class="op" id="2531082">.</span><span class="ident" id="2531083">Pointer</span><span class="op" id="2531090">(</span><span class="op" id="2531091">&amp;</span><span class="ident" id="2531092">b</span><span class="op" id="2531093">[</span><span class="num" id="2531094">4</span><span class="op" id="2531095">:</span><span class="num" id="2531096">6</span><span class="op" id="2531097">]</span><span class="op" id="2531098">[</span><span class="num" id="2531099">0</span><span class="op" id="2531100">]</span><span class="op" id="2531101">)</span><span class="op" id="2531102">)</span>&nbsp;<span class="op" id="2531104">=</span>&nbsp;<span class="ident" id="2531106">rr</span><span class="op" id="2531108">.</span><span class="ident" id="2531109">Header</span><span class="op" id="2531115">.</span><span class="ident" id="2531116">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2531122">*</span><span class="op" id="2531123">(</span><span class="op" id="2531124">*</span><span class="builtintype" id="2531125">uint16</span><span class="op" id="2531131">)</span><span class="op" id="2531132">(</span><span class="ident" id="2531133">unsafe</span><span class="op" id="2531139">.</span><span class="ident" id="2531140">Pointer</span><span class="op" id="2531147">(</span><span class="op" id="2531148">&amp;</span><span class="ident" id="2531149">b</span><span class="op" id="2531150">[</span><span class="num" id="2531151">6</span><span class="op" id="2531152">:</span><span class="num" id="2531153">8</span><span class="op" id="2531154">]</span><span class="op" id="2531155">[</span><span class="num" id="2531156">0</span><span class="op" id="2531157">]</span><span class="op" id="2531158">)</span><span class="op" id="2531159">)</span>&nbsp;<span class="op" id="2531161">=</span>&nbsp;<span class="ident" id="2531163">rr</span><span class="op" id="2531165">.</span><span class="ident" id="2531166">Header</span><span class="op" id="2531172">.</span><span class="ident" id="2531173">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2531180">*</span><span class="op" id="2531181">(</span><span class="op" id="2531182">*</span><span class="builtintype" id="2531183">uint32</span><span class="op" id="2531189">)</span><span class="op" id="2531190">(</span><span class="ident" id="2531191">unsafe</span><span class="op" id="2531197">.</span><span class="ident" id="2531198">Pointer</span><span class="op" id="2531205">(</span><span class="op" id="2531206">&amp;</span><span class="ident" id="2531207">b</span><span class="op" id="2531208">[</span><span class="num" id="2531209">8</span><span class="op" id="2531210">:</span><span class="num" id="2531211">12</span><span class="op" id="2531213">]</span><span class="op" id="2531214">[</span><span class="num" id="2531215">0</span><span class="op" id="2531216">]</span><span class="op" id="2531217">)</span><span class="op" id="2531218">)</span>&nbsp;<span class="op" id="2531220">=</span>&nbsp;<span class="ident" id="2531222">rr</span><span class="op" id="2531224">.</span><span class="ident" id="2531225">Header</span><span class="op" id="2531231">.</span><span class="ident" id="2531232">Seq</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2531237">*</span><span class="op" id="2531238">(</span><span class="op" id="2531239">*</span><span class="builtintype" id="2531240">uint32</span><span class="op" id="2531246">)</span><span class="op" id="2531247">(</span><span class="ident" id="2531248">unsafe</span><span class="op" id="2531254">.</span><span class="ident" id="2531255">Pointer</span><span class="op" id="2531262">(</span><span class="op" id="2531263">&amp;</span><span class="ident" id="2531264">b</span><span class="op" id="2531265">[</span><span class="num" id="2531266">12</span><span class="op" id="2531268">:</span><span class="num" id="2531269">16</span><span class="op" id="2531271">]</span><span class="op" id="2531272">[</span><span class="num" id="2531273">0</span><span class="op" id="2531274">]</span><span class="op" id="2531275">)</span><span class="op" id="2531276">)</span>&nbsp;<span class="op" id="2531278">=</span>&nbsp;<span class="ident" id="2531280">rr</span><span class="op" id="2531282">.</span><span class="ident" id="2531283">Header</span><span class="op" id="2531289">.</span><span class="ident" id="2531290">Pid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2531295">b</span><span class="op" id="2531296">[</span><span class="num" id="2531297">16</span><span class="op" id="2531299">]</span>&nbsp;<span class="op" id="2531301">=</span>&nbsp;<span class="builtintype" id="2531303">byte</span><span class="op" id="2531307">(</span><span class="ident" id="2531308">rr</span><span class="op" id="2531310">.</span><span class="ident" id="2531311">Data</span><span class="op" id="2531315">.</span><span class="ident" id="2531316">Family</span><span class="op" id="2531322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2531325">return</span>&nbsp;<span class="ident" id="2531332">b</span><br>
<span class="lineno"></span><span class="op" id="2531334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="2531337">func</span>&nbsp;<span class="ident" id="2531342">newNetlinkRouteRequest</span><span class="op" id="2531364">(</span><span class="ident" id="2531365">proto</span><span class="op" id="2531370">,</span>&nbsp;<span class="ident" id="2531372">seq</span><span class="op" id="2531375">,</span>&nbsp;<span class="ident" id="2531377">family</span>&nbsp;<span class="builtintype" id="2531384">int</span><span class="op" id="2531387">)</span>&nbsp;<span class="op" id="2531389">[</span><span class="op" id="2531390">]</span><span class="builtintype" id="2531391">byte</span>&nbsp;<span class="op" id="2531396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2531399">rr</span>&nbsp;<span class="op" id="2531402">:=</span>&nbsp;<span class="op" id="2531405">&amp;</span><span class="ident" id="2531406">NetlinkRouteRequest</span><span class="op" id="2531425">{</span><span class="op" id="2531426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2531429">rr</span><span class="op" id="2531431">.</span><span class="ident" id="2531432">Header</span><span class="op" id="2531438">.</span><span class="ident" id="2531439">Len</span>&nbsp;<span class="op" id="2531443">=</span>&nbsp;<span class="builtintype" id="2531445">uint32</span><span class="op" id="2531451">(</span><span class="ident" id="2531452">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2531465">+</span>&nbsp;<span class="ident" id="2531467">SizeofRtGenmsg</span><span class="op" id="2531481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2531484">rr</span><span class="op" id="2531486">.</span><span class="ident" id="2531487">Header</span><span class="op" id="2531493">.</span><span class="ident" id="2531494">Type</span>&nbsp;<span class="op" id="2531499">=</span>&nbsp;<span class="builtintype" id="2531501">uint16</span><span class="op" id="2531507">(</span><span class="ident" id="2531508">proto</span><span class="op" id="2531513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2531516">rr</span><span class="op" id="2531518">.</span><span class="ident" id="2531519">Header</span><span class="op" id="2531525">.</span><span class="ident" id="2531526">Flags</span>&nbsp;<span class="op" id="2531532">=</span>&nbsp;<span class="ident" id="2531534">NLM_F_DUMP</span>&nbsp;<span class="op" id="2531545">|</span>&nbsp;<span class="ident" id="2531547">NLM_F_REQUEST</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2531562">rr</span><span class="op" id="2531564">.</span><span class="ident" id="2531565">Header</span><span class="op" id="2531571">.</span><span class="ident" id="2531572">Seq</span>&nbsp;<span class="op" id="2531576">=</span>&nbsp;<span class="builtintype" id="2531578">uint32</span><span class="op" id="2531584">(</span><span class="ident" id="2531585">seq</span><span class="op" id="2531588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2531591">rr</span><span class="op" id="2531593">.</span><span class="ident" id="2531594">Data</span><span class="op" id="2531598">.</span><span class="ident" id="2531599">Family</span>&nbsp;<span class="op" id="2531606">=</span>&nbsp;<span class="builtintype" id="2531608">uint8</span><span class="op" id="2531613">(</span><span class="ident" id="2531614">family</span><span class="op" id="2531620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2531623">return</span>&nbsp;<span class="ident" id="2531630">rr</span><span class="op" id="2531632">.</span><span class="ident" id="2531633">toWireFormat</span><span class="op" id="2531645">(</span><span class="op" id="2531646">)</span><br>
<span class="lineno"></span><span class="op" id="2531648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="2531651">//&nbsp;NetlinkRIB&nbsp;returns&nbsp;routing&nbsp;information&nbsp;base,&nbsp;as&nbsp;known&nbsp;as&nbsp;RIB,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="2531722">//&nbsp;consists&nbsp;of&nbsp;network&nbsp;facility&nbsp;information,&nbsp;states&nbsp;and&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="2531790">func</span>&nbsp;<span class="ident" id="2531795">NetlinkRIB</span><span class="op" id="2531805">(</span><span class="ident" id="2531806">proto</span><span class="op" id="2531811">,</span>&nbsp;<span class="ident" id="2531813">family</span>&nbsp;<span class="builtintype" id="2531820">int</span><span class="op" id="2531823">)</span>&nbsp;<span class="op" id="2531825">(</span><span class="op" id="2531826">[</span><span class="op" id="2531827">]</span><span class="builtintype" id="2531828">byte</span><span class="op" id="2531832">,</span>&nbsp;<span class="builtintype" id="2531834">error</span><span class="op" id="2531839">)</span>&nbsp;<span class="op" id="2531841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2531844">s</span><span class="op" id="2531845">,</span>&nbsp;<span class="ident" id="2531847">err</span>&nbsp;<span class="op" id="2531851">:=</span>&nbsp;<span class="ident" id="2531854">Socket</span><span class="op" id="2531860">(</span><span class="ident" id="2531861">AF_NETLINK</span><span class="op" id="2531871">,</span>&nbsp;<span class="ident" id="2531873">SOCK_RAW</span><span class="op" id="2531881">,</span>&nbsp;<span class="ident" id="2531883">NETLINK_ROUTE</span><span class="op" id="2531896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2531899">if</span>&nbsp;<span class="ident" id="2531902">err</span>&nbsp;<span class="op" id="2531906">!=</span>&nbsp;<span class="ident" id="2531909">nil</span>&nbsp;<span class="op" id="2531913">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2531917">return</span>&nbsp;<span class="ident" id="2531924">nil</span><span class="op" id="2531927">,</span>&nbsp;<span class="ident" id="2531929">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2531934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2531937">defer</span>&nbsp;<span class="ident" id="2531943">Close</span><span class="op" id="2531948">(</span><span class="ident" id="2531949">s</span><span class="op" id="2531950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2531953">lsa</span>&nbsp;<span class="op" id="2531957">:=</span>&nbsp;<span class="op" id="2531960">&amp;</span><span class="ident" id="2531961">SockaddrNetlink</span><span class="op" id="2531976">{</span><span class="ident" id="2531977">Family</span><span class="op" id="2531983">:</span>&nbsp;<span class="ident" id="2531985">AF_NETLINK</span><span class="op" id="2531995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2531998">if</span>&nbsp;<span class="ident" id="2532001">err</span>&nbsp;<span class="op" id="2532005">:=</span>&nbsp;<span class="ident" id="2532008">Bind</span><span class="op" id="2532012">(</span><span class="ident" id="2532013">s</span><span class="op" id="2532014">,</span>&nbsp;<span class="ident" id="2532016">lsa</span><span class="op" id="2532019">)</span><span class="op" id="2532020">;</span>&nbsp;<span class="ident" id="2532022">err</span>&nbsp;<span class="op" id="2532026">!=</span>&nbsp;<span class="ident" id="2532029">nil</span>&nbsp;<span class="op" id="2532033">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532037">return</span>&nbsp;<span class="ident" id="2532044">nil</span><span class="op" id="2532047">,</span>&nbsp;<span class="ident" id="2532049">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2532054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2532057">wb</span>&nbsp;<span class="op" id="2532060">:=</span>&nbsp;<span class="ident" id="2532063">newNetlinkRouteRequest</span><span class="op" id="2532085">(</span><span class="ident" id="2532086">proto</span><span class="op" id="2532091">,</span>&nbsp;<span class="num" id="2532093">1</span><span class="op" id="2532094">,</span>&nbsp;<span class="ident" id="2532096">family</span><span class="op" id="2532102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532105">if</span>&nbsp;<span class="ident" id="2532108">err</span>&nbsp;<span class="op" id="2532112">:=</span>&nbsp;<span class="ident" id="2532115">Sendto</span><span class="op" id="2532121">(</span><span class="ident" id="2532122">s</span><span class="op" id="2532123">,</span>&nbsp;<span class="ident" id="2532125">wb</span><span class="op" id="2532127">,</span>&nbsp;<span class="num" id="2532129">0</span><span class="op" id="2532130">,</span>&nbsp;<span class="ident" id="2532132">lsa</span><span class="op" id="2532135">)</span><span class="op" id="2532136">;</span>&nbsp;<span class="ident" id="2532138">err</span>&nbsp;<span class="op" id="2532142">!=</span>&nbsp;<span class="ident" id="2532145">nil</span>&nbsp;<span class="op" id="2532149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532153">return</span>&nbsp;<span class="ident" id="2532160">nil</span><span class="op" id="2532163">,</span>&nbsp;<span class="ident" id="2532165">err</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2532170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532173">var</span>&nbsp;<span class="ident" id="2532177">tab</span>&nbsp;<span class="op" id="2532181">[</span><span class="op" id="2532182">]</span><span class="builtintype" id="2532183">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2532189">rbNew</span>&nbsp;<span class="op" id="2532195">:=</span>&nbsp;<span class="builtinfunc" id="2532198">make</span><span class="op" id="2532202">(</span><span class="op" id="2532203">[</span><span class="op" id="2532204">]</span><span class="builtintype" id="2532205">byte</span><span class="op" id="2532209">,</span>&nbsp;<span class="ident" id="2532211">Getpagesize</span><span class="op" id="2532222">(</span><span class="op" id="2532223">)</span><span class="op" id="2532224">)</span><br>
<span class="lineno"></span><span class="ident" id="2532226">done</span><span class="op" id="2532230">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532233">for</span>&nbsp;<span class="op" id="2532237">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2532241">rb</span>&nbsp;<span class="op" id="2532244">:=</span>&nbsp;<span class="ident" id="2532247">rbNew</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2532255">nr</span><span class="op" id="2532257">,</span>&nbsp;<span class="ident" id="2532259">_</span><span class="op" id="2532260">,</span>&nbsp;<span class="ident" id="2532262">err</span>&nbsp;<span class="op" id="2532266">:=</span>&nbsp;<span class="ident" id="2532269">Recvfrom</span><span class="op" id="2532277">(</span><span class="ident" id="2532278">s</span><span class="op" id="2532279">,</span>&nbsp;<span class="ident" id="2532281">rb</span><span class="op" id="2532283">,</span>&nbsp;<span class="num" id="2532285">0</span><span class="op" id="2532286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532290">if</span>&nbsp;<span class="ident" id="2532293">err</span>&nbsp;<span class="op" id="2532297">!=</span>&nbsp;<span class="ident" id="2532300">nil</span>&nbsp;<span class="op" id="2532304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532309">return</span>&nbsp;<span class="ident" id="2532316">nil</span><span class="op" id="2532319">,</span>&nbsp;<span class="ident" id="2532321">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2532327">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532331">if</span>&nbsp;<span class="ident" id="2532334">nr</span>&nbsp;<span class="op" id="2532337">&lt;</span>&nbsp;<span class="ident" id="2532339">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2532352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532357">return</span>&nbsp;<span class="ident" id="2532364">nil</span><span class="op" id="2532367">,</span>&nbsp;<span class="ident" id="2532369">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2532378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2532382">rb</span>&nbsp;<span class="op" id="2532385">=</span>&nbsp;<span class="ident" id="2532387">rb</span><span class="op" id="2532389">[</span><span class="op" id="2532390">:</span><span class="ident" id="2532391">nr</span><span class="op" id="2532393">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2532397">tab</span>&nbsp;<span class="op" id="2532401">=</span>&nbsp;<span class="builtinfunc" id="2532403">append</span><span class="op" id="2532409">(</span><span class="ident" id="2532410">tab</span><span class="op" id="2532413">,</span>&nbsp;<span class="ident" id="2532415">rb</span><span class="op" id="2532417">...</span><span class="op" id="2532420">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2532424">msgs</span><span class="op" id="2532428">,</span>&nbsp;<span class="ident" id="2532430">err</span>&nbsp;<span class="op" id="2532434">:=</span>&nbsp;<span class="ident" id="2532437">ParseNetlinkMessage</span><span class="op" id="2532456">(</span><span class="ident" id="2532457">rb</span><span class="op" id="2532459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532463">if</span>&nbsp;<span class="ident" id="2532466">err</span>&nbsp;<span class="op" id="2532470">!=</span>&nbsp;<span class="ident" id="2532473">nil</span>&nbsp;<span class="op" id="2532477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532482">return</span>&nbsp;<span class="ident" id="2532489">nil</span><span class="op" id="2532492">,</span>&nbsp;<span class="ident" id="2532494">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2532500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532504">for</span>&nbsp;<span class="ident" id="2532508">_</span><span class="op" id="2532509">,</span>&nbsp;<span class="ident" id="2532511">m</span>&nbsp;<span class="op" id="2532513">:=</span>&nbsp;<span class="keyword" id="2532516">range</span>&nbsp;<span class="ident" id="2532522">msgs</span>&nbsp;<span class="op" id="2532527">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2532532">lsa</span><span class="op" id="2532535">,</span>&nbsp;<span class="ident" id="2532537">err</span>&nbsp;<span class="op" id="2532541">:=</span>&nbsp;<span class="ident" id="2532544">Getsockname</span><span class="op" id="2532555">(</span><span class="ident" id="2532556">s</span><span class="op" id="2532557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532562">if</span>&nbsp;<span class="ident" id="2532565">err</span>&nbsp;<span class="op" id="2532569">!=</span>&nbsp;<span class="ident" id="2532572">nil</span>&nbsp;<span class="op" id="2532576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532582">return</span>&nbsp;<span class="ident" id="2532589">nil</span><span class="op" id="2532592">,</span>&nbsp;<span class="ident" id="2532594">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2532601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532606">switch</span>&nbsp;<span class="ident" id="2532613">v</span>&nbsp;<span class="op" id="2532615">:=</span>&nbsp;<span class="ident" id="2532618">lsa</span><span class="op" id="2532621">.</span><span class="op" id="2532622">(</span><span class="keyword" id="2532623">type</span><span class="op" id="2532627">)</span>&nbsp;<span class="op" id="2532629">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532634">case</span>&nbsp;<span class="op" id="2532639">*</span><span class="ident" id="2532640">SockaddrNetlink</span><span class="op" id="2532655">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532661">if</span>&nbsp;<span class="ident" id="2532664">m</span><span class="op" id="2532665">.</span><span class="ident" id="2532666">Header</span><span class="op" id="2532672">.</span><span class="ident" id="2532673">Seq</span>&nbsp;<span class="op" id="2532677">!=</span>&nbsp;<span class="num" id="2532680">1</span>&nbsp;<span class="op" id="2532682">||</span>&nbsp;<span class="ident" id="2532685">m</span><span class="op" id="2532686">.</span><span class="ident" id="2532687">Header</span><span class="op" id="2532693">.</span><span class="ident" id="2532694">Pid</span>&nbsp;<span class="op" id="2532698">!=</span>&nbsp;<span class="ident" id="2532701">v</span><span class="op" id="2532702">.</span><span class="ident" id="2532703">Pid</span>&nbsp;<span class="op" id="2532707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532714">return</span>&nbsp;<span class="ident" id="2532721">nil</span><span class="op" id="2532724">,</span>&nbsp;<span class="ident" id="2532726">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2532737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532742">default</span><span class="op" id="2532749">:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532755">return</span>&nbsp;<span class="ident" id="2532762">nil</span><span class="op" id="2532765">,</span>&nbsp;<span class="ident" id="2532767">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2532777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532782">if</span>&nbsp;<span class="ident" id="2532785">m</span><span class="op" id="2532786">.</span><span class="ident" id="2532787">Header</span><span class="op" id="2532793">.</span><span class="ident" id="2532794">Type</span>&nbsp;<span class="op" id="2532799">==</span>&nbsp;<span class="ident" id="2532802">NLMSG_DONE</span>&nbsp;<span class="op" id="2532813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532819">break</span>&nbsp;<span class="ident" id="2532825">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2532833">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532838">if</span>&nbsp;<span class="ident" id="2532841">m</span><span class="op" id="2532842">.</span><span class="ident" id="2532843">Header</span><span class="op" id="2532849">.</span><span class="ident" id="2532850">Type</span>&nbsp;<span class="op" id="2532855">==</span>&nbsp;<span class="ident" id="2532858">NLMSG_ERROR</span>&nbsp;<span class="op" id="2532870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532876">return</span>&nbsp;<span class="ident" id="2532883">nil</span><span class="op" id="2532886">,</span>&nbsp;<span class="ident" id="2532888">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2532898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2532902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2532905">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2532908">return</span>&nbsp;<span class="ident" id="2532915">tab</span><span class="op" id="2532918">,</span>&nbsp;<span class="ident" id="2532920">nil</span><br>
<span class="lineno"></span><span class="op" id="2532924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2532927">//&nbsp;NetlinkMessage&nbsp;represents&nbsp;a&nbsp;netlink&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2532975">type</span>&nbsp;<span class="ident" id="2532980">NetlinkMessage</span>&nbsp;<span class="keyword" id="2532995">struct</span>&nbsp;<span class="op" id="2533002">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2533005">Header</span>&nbsp;<span class="ident" id="2533012">NlMsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2533022">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2533029">[</span><span class="op" id="2533030">]</span><span class="builtintype" id="2533031">byte</span><br>
<span class="lineno"></span><span class="op" id="2533036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2533039">//&nbsp;ParseNetlinkMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;netlink&nbsp;messages&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="2533107">//&nbsp;returns&nbsp;the&nbsp;slice&nbsp;containing&nbsp;the&nbsp;NetlinkMessage&nbsp;structures.</span><br>
<span class="lineno"></span><span class="keyword" id="2533170">func</span>&nbsp;<span class="ident" id="2533175">ParseNetlinkMessage</span><span class="op" id="2533194">(</span><span class="ident" id="2533195">b</span>&nbsp;<span class="op" id="2533197">[</span><span class="op" id="2533198">]</span><span class="builtintype" id="2533199">byte</span><span class="op" id="2533203">)</span>&nbsp;<span class="op" id="2533205">(</span><span class="op" id="2533206">[</span><span class="op" id="2533207">]</span><span class="ident" id="2533208">NetlinkMessage</span><span class="op" id="2533222">,</span>&nbsp;<span class="builtintype" id="2533224">error</span><span class="op" id="2533229">)</span>&nbsp;<span class="op" id="2533231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2533234">var</span>&nbsp;<span class="ident" id="2533238">msgs</span>&nbsp;<span class="op" id="2533243">[</span><span class="op" id="2533244">]</span><span class="ident" id="2533245">NetlinkMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2533261">for</span>&nbsp;<span class="builtinfunc" id="2533265">len</span><span class="op" id="2533268">(</span><span class="ident" id="2533269">b</span><span class="op" id="2533270">)</span>&nbsp;<span class="op" id="2533272">&gt;=</span>&nbsp;<span class="ident" id="2533275">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2533288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2533292">h</span><span class="op" id="2533293">,</span>&nbsp;<span class="ident" id="2533295">dbuf</span><span class="op" id="2533299">,</span>&nbsp;<span class="ident" id="2533301">dlen</span><span class="op" id="2533305">,</span>&nbsp;<span class="ident" id="2533307">err</span>&nbsp;<span class="op" id="2533311">:=</span>&nbsp;<span class="ident" id="2533314">netlinkMessageHeaderAndData</span><span class="op" id="2533341">(</span><span class="ident" id="2533342">b</span><span class="op" id="2533343">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2533347">if</span>&nbsp;<span class="ident" id="2533350">err</span>&nbsp;<span class="op" id="2533354">!=</span>&nbsp;<span class="ident" id="2533357">nil</span>&nbsp;<span class="op" id="2533361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2533366">return</span>&nbsp;<span class="ident" id="2533373">nil</span><span class="op" id="2533376">,</span>&nbsp;<span class="ident" id="2533378">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2533384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2533388">m</span>&nbsp;<span class="op" id="2533390">:=</span>&nbsp;<span class="ident" id="2533393">NetlinkMessage</span><span class="op" id="2533407">{</span><span class="ident" id="2533408">Header</span><span class="op" id="2533414">:</span>&nbsp;<span class="op" id="2533416">*</span><span class="ident" id="2533417">h</span><span class="op" id="2533418">,</span>&nbsp;<span class="ident" id="2533420">Data</span><span class="op" id="2533424">:</span>&nbsp;<span class="ident" id="2533426">dbuf</span><span class="op" id="2533430">[</span><span class="op" id="2533431">:</span><span class="builtintype" id="2533432">int</span><span class="op" id="2533435">(</span><span class="ident" id="2533436">h</span><span class="op" id="2533437">.</span><span class="ident" id="2533438">Len</span><span class="op" id="2533441">)</span><span class="op" id="2533442">-</span><span class="ident" id="2533443">NLMSG_HDRLEN</span><span class="op" id="2533455">]</span><span class="op" id="2533456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2533460">msgs</span>&nbsp;<span class="op" id="2533465">=</span>&nbsp;<span class="builtinfunc" id="2533467">append</span><span class="op" id="2533473">(</span><span class="ident" id="2533474">msgs</span><span class="op" id="2533478">,</span>&nbsp;<span class="ident" id="2533480">m</span><span class="op" id="2533481">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2533485">b</span>&nbsp;<span class="op" id="2533487">=</span>&nbsp;<span class="ident" id="2533489">b</span><span class="op" id="2533490">[</span><span class="ident" id="2533491">dlen</span><span class="op" id="2533495">:</span><span class="op" id="2533496">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2533499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2533502">return</span>&nbsp;<span class="ident" id="2533509">msgs</span><span class="op" id="2533513">,</span>&nbsp;<span class="ident" id="2533515">nil</span><br>
<span class="lineno"></span><span class="op" id="2533519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="2533522">func</span>&nbsp;<span class="ident" id="2533527">netlinkMessageHeaderAndData</span><span class="op" id="2533554">(</span><span class="ident" id="2533555">b</span>&nbsp;<span class="op" id="2533557">[</span><span class="op" id="2533558">]</span><span class="builtintype" id="2533559">byte</span><span class="op" id="2533563">)</span>&nbsp;<span class="op" id="2533565">(</span><span class="op" id="2533566">*</span><span class="ident" id="2533567">NlMsghdr</span><span class="op" id="2533575">,</span>&nbsp;<span class="op" id="2533577">[</span><span class="op" id="2533578">]</span><span class="builtintype" id="2533579">byte</span><span class="op" id="2533583">,</span>&nbsp;<span class="builtintype" id="2533585">int</span><span class="op" id="2533588">,</span>&nbsp;<span class="builtintype" id="2533590">error</span><span class="op" id="2533595">)</span>&nbsp;<span class="op" id="2533597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2533600">h</span>&nbsp;<span class="op" id="2533602">:=</span>&nbsp;<span class="op" id="2533605">(</span><span class="op" id="2533606">*</span><span class="ident" id="2533607">NlMsghdr</span><span class="op" id="2533615">)</span><span class="op" id="2533616">(</span><span class="ident" id="2533617">unsafe</span><span class="op" id="2533623">.</span><span class="ident" id="2533624">Pointer</span><span class="op" id="2533631">(</span><span class="op" id="2533632">&amp;</span><span class="ident" id="2533633">b</span><span class="op" id="2533634">[</span><span class="num" id="2533635">0</span><span class="op" id="2533636">]</span><span class="op" id="2533637">)</span><span class="op" id="2533638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2533641">if</span>&nbsp;<span class="builtintype" id="2533644">int</span><span class="op" id="2533647">(</span><span class="ident" id="2533648">h</span><span class="op" id="2533649">.</span><span class="ident" id="2533650">Len</span><span class="op" id="2533653">)</span>&nbsp;<span class="op" id="2533655">&lt;</span>&nbsp;<span class="ident" id="2533657">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2533670">||</span>&nbsp;<span class="builtintype" id="2533673">int</span><span class="op" id="2533676">(</span><span class="ident" id="2533677">h</span><span class="op" id="2533678">.</span><span class="ident" id="2533679">Len</span><span class="op" id="2533682">)</span>&nbsp;<span class="op" id="2533684">&gt;</span>&nbsp;<span class="builtinfunc" id="2533686">len</span><span class="op" id="2533689">(</span><span class="ident" id="2533690">b</span><span class="op" id="2533691">)</span>&nbsp;<span class="op" id="2533693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2533697">return</span>&nbsp;<span class="ident" id="2533704">nil</span><span class="op" id="2533707">,</span>&nbsp;<span class="ident" id="2533709">nil</span><span class="op" id="2533712">,</span>&nbsp;<span class="num" id="2533714">0</span><span class="op" id="2533715">,</span>&nbsp;<span class="ident" id="2533717">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2533725">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2533728">return</span>&nbsp;<span class="ident" id="2533735">h</span><span class="op" id="2533736">,</span>&nbsp;<span class="ident" id="2533738">b</span><span class="op" id="2533739">[</span><span class="ident" id="2533740">NLMSG_HDRLEN</span><span class="op" id="2533752">:</span><span class="op" id="2533753">]</span><span class="op" id="2533754">,</span>&nbsp;<span class="ident" id="2533756">nlmAlignOf</span><span class="op" id="2533766">(</span><span class="builtintype" id="2533767">int</span><span class="op" id="2533770">(</span><span class="ident" id="2533771">h</span><span class="op" id="2533772">.</span><span class="ident" id="2533773">Len</span><span class="op" id="2533776">)</span><span class="op" id="2533777">)</span><span class="op" id="2533778">,</span>&nbsp;<span class="ident" id="2533780">nil</span><br>
<span class="lineno"></span><span class="op" id="2533784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2533787">//&nbsp;NetlinkRouteAttr&nbsp;represents&nbsp;a&nbsp;netlink&nbsp;route&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="2533845">type</span>&nbsp;<span class="ident" id="2533850">NetlinkRouteAttr</span>&nbsp;<span class="keyword" id="2533867">struct</span>&nbsp;<span class="op" id="2533874">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2533877">Attr</span>&nbsp;&nbsp;<span class="ident" id="2533883">RtAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2533891">Value</span>&nbsp;<span class="op" id="2533897">[</span><span class="op" id="2533898">]</span><span class="builtintype" id="2533899">byte</span><br>
<span class="lineno"></span><span class="op" id="2533904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2533907">//&nbsp;ParseNetlinkRouteAttr&nbsp;parses&nbsp;m&#39;s&nbsp;payload&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;netlink</span><br>
<span class="lineno">145</span><span class="comment" id="2533974">//&nbsp;route&nbsp;attributes&nbsp;and&nbsp;returns&nbsp;the&nbsp;slice&nbsp;containing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2534031">//&nbsp;NetlinkRouteAttr&nbsp;structures.</span><br>
<span class="lineno"></span><span class="keyword" id="2534063">func</span>&nbsp;<span class="ident" id="2534068">ParseNetlinkRouteAttr</span><span class="op" id="2534089">(</span><span class="ident" id="2534090">m</span>&nbsp;<span class="op" id="2534092">*</span><span class="ident" id="2534093">NetlinkMessage</span><span class="op" id="2534107">)</span>&nbsp;<span class="op" id="2534109">(</span><span class="op" id="2534110">[</span><span class="op" id="2534111">]</span><span class="ident" id="2534112">NetlinkRouteAttr</span><span class="op" id="2534128">,</span>&nbsp;<span class="builtintype" id="2534130">error</span><span class="op" id="2534135">)</span>&nbsp;<span class="op" id="2534137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534140">var</span>&nbsp;<span class="ident" id="2534144">b</span>&nbsp;<span class="op" id="2534146">[</span><span class="op" id="2534147">]</span><span class="builtintype" id="2534148">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534154">switch</span>&nbsp;<span class="ident" id="2534161">m</span><span class="op" id="2534162">.</span><span class="ident" id="2534163">Header</span><span class="op" id="2534169">.</span><span class="ident" id="2534170">Type</span>&nbsp;<span class="op" id="2534175">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534178">case</span>&nbsp;<span class="ident" id="2534183">RTM_NEWLINK</span><span class="op" id="2534194">,</span>&nbsp;<span class="ident" id="2534196">RTM_DELLINK</span><span class="op" id="2534207">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2534211">b</span>&nbsp;<span class="op" id="2534213">=</span>&nbsp;<span class="ident" id="2534215">m</span><span class="op" id="2534216">.</span><span class="ident" id="2534217">Data</span><span class="op" id="2534221">[</span><span class="ident" id="2534222">SizeofIfInfomsg</span><span class="op" id="2534237">:</span><span class="op" id="2534238">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534241">case</span>&nbsp;<span class="ident" id="2534246">RTM_NEWADDR</span><span class="op" id="2534257">,</span>&nbsp;<span class="ident" id="2534259">RTM_DELADDR</span><span class="op" id="2534270">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2534274">b</span>&nbsp;<span class="op" id="2534276">=</span>&nbsp;<span class="ident" id="2534278">m</span><span class="op" id="2534279">.</span><span class="ident" id="2534280">Data</span><span class="op" id="2534284">[</span><span class="ident" id="2534285">SizeofIfAddrmsg</span><span class="op" id="2534300">:</span><span class="op" id="2534301">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534304">case</span>&nbsp;<span class="ident" id="2534309">RTM_NEWROUTE</span><span class="op" id="2534321">,</span>&nbsp;<span class="ident" id="2534323">RTM_DELROUTE</span><span class="op" id="2534335">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2534339">b</span>&nbsp;<span class="op" id="2534341">=</span>&nbsp;<span class="ident" id="2534343">m</span><span class="op" id="2534344">.</span><span class="ident" id="2534345">Data</span><span class="op" id="2534349">[</span><span class="ident" id="2534350">SizeofRtMsg</span><span class="op" id="2534361">:</span><span class="op" id="2534362">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534365">default</span><span class="op" id="2534372">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534376">return</span>&nbsp;<span class="ident" id="2534383">nil</span><span class="op" id="2534386">,</span>&nbsp;<span class="ident" id="2534388">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2534396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534399">var</span>&nbsp;<span class="ident" id="2534403">attrs</span>&nbsp;<span class="op" id="2534409">[</span><span class="op" id="2534410">]</span><span class="ident" id="2534411">NetlinkRouteAttr</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534429">for</span>&nbsp;<span class="builtinfunc" id="2534433">len</span><span class="op" id="2534436">(</span><span class="ident" id="2534437">b</span><span class="op" id="2534438">)</span>&nbsp;<span class="op" id="2534440">&gt;=</span>&nbsp;<span class="ident" id="2534443">SizeofRtAttr</span>&nbsp;<span class="op" id="2534456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2534460">a</span><span class="op" id="2534461">,</span>&nbsp;<span class="ident" id="2534463">vbuf</span><span class="op" id="2534467">,</span>&nbsp;<span class="ident" id="2534469">alen</span><span class="op" id="2534473">,</span>&nbsp;<span class="ident" id="2534475">err</span>&nbsp;<span class="op" id="2534479">:=</span>&nbsp;<span class="ident" id="2534482">netlinkRouteAttrAndValue</span><span class="op" id="2534506">(</span><span class="ident" id="2534507">b</span><span class="op" id="2534508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534512">if</span>&nbsp;<span class="ident" id="2534515">err</span>&nbsp;<span class="op" id="2534519">!=</span>&nbsp;<span class="ident" id="2534522">nil</span>&nbsp;<span class="op" id="2534526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534531">return</span>&nbsp;<span class="ident" id="2534538">nil</span><span class="op" id="2534541">,</span>&nbsp;<span class="ident" id="2534543">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2534549">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2534553">ra</span>&nbsp;<span class="op" id="2534556">:=</span>&nbsp;<span class="ident" id="2534559">NetlinkRouteAttr</span><span class="op" id="2534575">{</span><span class="ident" id="2534576">Attr</span><span class="op" id="2534580">:</span>&nbsp;<span class="op" id="2534582">*</span><span class="ident" id="2534583">a</span><span class="op" id="2534584">,</span>&nbsp;<span class="ident" id="2534586">Value</span><span class="op" id="2534591">:</span>&nbsp;<span class="ident" id="2534593">vbuf</span><span class="op" id="2534597">[</span><span class="op" id="2534598">:</span><span class="builtintype" id="2534599">int</span><span class="op" id="2534602">(</span><span class="ident" id="2534603">a</span><span class="op" id="2534604">.</span><span class="ident" id="2534605">Len</span><span class="op" id="2534608">)</span><span class="op" id="2534609">-</span><span class="ident" id="2534610">SizeofRtAttr</span><span class="op" id="2534622">]</span><span class="op" id="2534623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2534627">attrs</span>&nbsp;<span class="op" id="2534633">=</span>&nbsp;<span class="builtinfunc" id="2534635">append</span><span class="op" id="2534641">(</span><span class="ident" id="2534642">attrs</span><span class="op" id="2534647">,</span>&nbsp;<span class="ident" id="2534649">ra</span><span class="op" id="2534651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2534655">b</span>&nbsp;<span class="op" id="2534657">=</span>&nbsp;<span class="ident" id="2534659">b</span><span class="op" id="2534660">[</span><span class="ident" id="2534661">alen</span><span class="op" id="2534665">:</span><span class="op" id="2534666">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2534669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534672">return</span>&nbsp;<span class="ident" id="2534679">attrs</span><span class="op" id="2534684">,</span>&nbsp;<span class="ident" id="2534686">nil</span><br>
<span class="lineno">170</span><span class="op" id="2534690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2534693">func</span>&nbsp;<span class="ident" id="2534698">netlinkRouteAttrAndValue</span><span class="op" id="2534722">(</span><span class="ident" id="2534723">b</span>&nbsp;<span class="op" id="2534725">[</span><span class="op" id="2534726">]</span><span class="builtintype" id="2534727">byte</span><span class="op" id="2534731">)</span>&nbsp;<span class="op" id="2534733">(</span><span class="op" id="2534734">*</span><span class="ident" id="2534735">RtAttr</span><span class="op" id="2534741">,</span>&nbsp;<span class="op" id="2534743">[</span><span class="op" id="2534744">]</span><span class="builtintype" id="2534745">byte</span><span class="op" id="2534749">,</span>&nbsp;<span class="builtintype" id="2534751">int</span><span class="op" id="2534754">,</span>&nbsp;<span class="builtintype" id="2534756">error</span><span class="op" id="2534761">)</span>&nbsp;<span class="op" id="2534763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2534766">a</span>&nbsp;<span class="op" id="2534768">:=</span>&nbsp;<span class="op" id="2534771">(</span><span class="op" id="2534772">*</span><span class="ident" id="2534773">RtAttr</span><span class="op" id="2534779">)</span><span class="op" id="2534780">(</span><span class="ident" id="2534781">unsafe</span><span class="op" id="2534787">.</span><span class="ident" id="2534788">Pointer</span><span class="op" id="2534795">(</span><span class="op" id="2534796">&amp;</span><span class="ident" id="2534797">b</span><span class="op" id="2534798">[</span><span class="num" id="2534799">0</span><span class="op" id="2534800">]</span><span class="op" id="2534801">)</span><span class="op" id="2534802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534805">if</span>&nbsp;<span class="builtintype" id="2534808">int</span><span class="op" id="2534811">(</span><span class="ident" id="2534812">a</span><span class="op" id="2534813">.</span><span class="ident" id="2534814">Len</span><span class="op" id="2534817">)</span>&nbsp;<span class="op" id="2534819">&lt;</span>&nbsp;<span class="ident" id="2534821">SizeofRtAttr</span>&nbsp;<span class="op" id="2534834">||</span>&nbsp;<span class="builtintype" id="2534837">int</span><span class="op" id="2534840">(</span><span class="ident" id="2534841">a</span><span class="op" id="2534842">.</span><span class="ident" id="2534843">Len</span><span class="op" id="2534846">)</span>&nbsp;<span class="op" id="2534848">&gt;</span>&nbsp;<span class="builtinfunc" id="2534850">len</span><span class="op" id="2534853">(</span><span class="ident" id="2534854">b</span><span class="op" id="2534855">)</span>&nbsp;<span class="op" id="2534857">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534861">return</span>&nbsp;<span class="ident" id="2534868">nil</span><span class="op" id="2534871">,</span>&nbsp;<span class="ident" id="2534873">nil</span><span class="op" id="2534876">,</span>&nbsp;<span class="num" id="2534878">0</span><span class="op" id="2534879">,</span>&nbsp;<span class="ident" id="2534881">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2534889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534892">return</span>&nbsp;<span class="ident" id="2534899">a</span><span class="op" id="2534900">,</span>&nbsp;<span class="ident" id="2534902">b</span><span class="op" id="2534903">[</span><span class="ident" id="2534904">SizeofRtAttr</span><span class="op" id="2534916">:</span><span class="op" id="2534917">]</span><span class="op" id="2534918">,</span>&nbsp;<span class="ident" id="2534920">rtaAlignOf</span><span class="op" id="2534930">(</span><span class="builtintype" id="2534931">int</span><span class="op" id="2534934">(</span><span class="ident" id="2534935">a</span><span class="op" id="2534936">.</span><span class="ident" id="2534937">Len</span><span class="op" id="2534940">)</span><span class="op" id="2534941">)</span><span class="op" id="2534942">,</span>&nbsp;<span class="ident" id="2534944">nil</span><br>
<span class="lineno"></span><span class="op" id="2534948">}</span>
</div>
</body>
</html>
