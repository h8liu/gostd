<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5700564">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5700620">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5700674">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5700725">package</span>&nbsp;<span class="ident" id="5700733">xml</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5700738">import</span>&nbsp;<span class="op" id="5700745">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5700748">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5700755">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5700766">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5700777">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5700784">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5700787">//&nbsp;typeInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;type.</span><br>
<span class="lineno">15</span><span class="keyword" id="5700851">type</span>&nbsp;<span class="ident" id="5700856">typeInfo</span>&nbsp;<span class="keyword" id="5700865">struct</span>&nbsp;<span class="op" id="5700872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700875">xmlname</span>&nbsp;<span class="op" id="5700883">*</span><span class="ident" id="5700884">fieldInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700895">fields</span>&nbsp;&nbsp;<span class="op" id="5700903">[</span><span class="op" id="5700904">]</span><span class="ident" id="5700905">fieldInfo</span><br>
<span class="lineno"></span><span class="op" id="5700915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5700918">//&nbsp;fieldInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="5700991">type</span>&nbsp;<span class="ident" id="5700996">fieldInfo</span>&nbsp;<span class="keyword" id="5701006">struct</span>&nbsp;<span class="op" id="5701013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701016">idx</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5701024">[</span><span class="op" id="5701025">]</span><span class="builtintype" id="5701026">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701031">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5701039">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701047">xmlns</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5701055">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701063">flags</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5701071">fieldFlags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701083">parents</span>&nbsp;<span class="op" id="5701091">[</span><span class="op" id="5701092">]</span><span class="builtintype" id="5701093">string</span><br>
<span class="lineno"></span><span class="op" id="5701100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5701103">type</span>&nbsp;<span class="ident" id="5701108">fieldFlags</span>&nbsp;<span class="builtintype" id="5701119">int</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="5701124">const</span>&nbsp;<span class="op" id="5701130">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701133">fElement</span>&nbsp;<span class="ident" id="5701142">fieldFlags</span>&nbsp;<span class="op" id="5701153">=</span>&nbsp;<span class="num" id="5701155">1</span>&nbsp;<span class="op" id="5701157">&lt;&lt;</span>&nbsp;<span class="ident" id="5701160">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701166">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701173">fCharData</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701184">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701195">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701205">fAny</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701212">fOmitEmpty</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701225">fMode</span>&nbsp;<span class="op" id="5701231">=</span>&nbsp;<span class="ident" id="5701233">fElement</span>&nbsp;<span class="op" id="5701242">|</span>&nbsp;<span class="ident" id="5701244">fAttr</span>&nbsp;<span class="op" id="5701250">|</span>&nbsp;<span class="ident" id="5701252">fCharData</span>&nbsp;<span class="op" id="5701262">|</span>&nbsp;<span class="ident" id="5701264">fInnerXml</span>&nbsp;<span class="op" id="5701274">|</span>&nbsp;<span class="ident" id="5701276">fComment</span>&nbsp;<span class="op" id="5701285">|</span>&nbsp;<span class="ident" id="5701287">fAny</span><br>
<span class="lineno"></span><span class="op" id="5701292">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5701295">var</span>&nbsp;<span class="ident" id="5701299">tinfoMap</span>&nbsp;<span class="op" id="5701308">=</span>&nbsp;<span class="builtinfunc" id="5701310">make</span><span class="op" id="5701314">(</span><span class="keyword" id="5701315">map</span><span class="op" id="5701318">[</span><span class="ident" id="5701319">reflect</span><span class="op" id="5701326">.</span><span class="ident" id="5701327">Type</span><span class="op" id="5701331">]</span><span class="op" id="5701332">*</span><span class="ident" id="5701333">typeInfo</span><span class="op" id="5701341">)</span><br>
<span class="lineno">45</span><span class="keyword" id="5701343">var</span>&nbsp;<span class="ident" id="5701347">tinfoLock</span>&nbsp;<span class="ident" id="5701357">sync</span><span class="op" id="5701361">.</span><span class="ident" id="5701362">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5701371">var</span>&nbsp;<span class="ident" id="5701375">nameType</span>&nbsp;<span class="op" id="5701384">=</span>&nbsp;<span class="ident" id="5701386">reflect</span><span class="op" id="5701393">.</span><span class="ident" id="5701394">TypeOf</span><span class="op" id="5701400">(</span><span class="ident" id="5701401">Name</span><span class="op" id="5701405">{</span><span class="op" id="5701406">}</span><span class="op" id="5701407">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5701410">//&nbsp;getTypeInfo&nbsp;returns&nbsp;the&nbsp;typeInfo&nbsp;structure&nbsp;with&nbsp;details&nbsp;necessary</span><br>
<span class="lineno">50</span><span class="comment" id="5701479">//&nbsp;for&nbsp;marshalling&nbsp;and&nbsp;unmarshalling&nbsp;typ.</span><br>
<span class="lineno"></span><span class="keyword" id="5701521">func</span>&nbsp;<span class="ident" id="5701526">getTypeInfo</span><span class="op" id="5701537">(</span><span class="ident" id="5701538">typ</span>&nbsp;<span class="ident" id="5701542">reflect</span><span class="op" id="5701549">.</span><span class="ident" id="5701550">Type</span><span class="op" id="5701554">)</span>&nbsp;<span class="op" id="5701556">(</span><span class="op" id="5701557">*</span><span class="ident" id="5701558">typeInfo</span><span class="op" id="5701566">,</span>&nbsp;<span class="builtintype" id="5701568">error</span><span class="op" id="5701573">)</span>&nbsp;<span class="op" id="5701575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701578">tinfoLock</span><span class="op" id="5701587">.</span><span class="ident" id="5701588">RLock</span><span class="op" id="5701593">(</span><span class="op" id="5701594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701597">tinfo</span><span class="op" id="5701602">,</span>&nbsp;<span class="ident" id="5701604">ok</span>&nbsp;<span class="op" id="5701607">:=</span>&nbsp;<span class="ident" id="5701610">tinfoMap</span><span class="op" id="5701618">[</span><span class="ident" id="5701619">typ</span><span class="op" id="5701622">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701625">tinfoLock</span><span class="op" id="5701634">.</span><span class="ident" id="5701635">RUnlock</span><span class="op" id="5701642">(</span><span class="op" id="5701643">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701646">if</span>&nbsp;<span class="ident" id="5701649">ok</span>&nbsp;<span class="op" id="5701652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701656">return</span>&nbsp;<span class="ident" id="5701663">tinfo</span><span class="op" id="5701668">,</span>&nbsp;<span class="ident" id="5701670">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5701675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701678">tinfo</span>&nbsp;<span class="op" id="5701684">=</span>&nbsp;<span class="op" id="5701686">&amp;</span><span class="ident" id="5701687">typeInfo</span><span class="op" id="5701695">{</span><span class="op" id="5701696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701699">if</span>&nbsp;<span class="ident" id="5701702">typ</span><span class="op" id="5701705">.</span><span class="ident" id="5701706">Kind</span><span class="op" id="5701710">(</span><span class="op" id="5701711">)</span>&nbsp;<span class="op" id="5701713">==</span>&nbsp;<span class="ident" id="5701716">reflect</span><span class="op" id="5701723">.</span><span class="ident" id="5701724">Struct</span>&nbsp;<span class="op" id="5701731">&amp;&amp;</span>&nbsp;<span class="ident" id="5701734">typ</span>&nbsp;<span class="op" id="5701738">!=</span>&nbsp;<span class="ident" id="5701741">nameType</span>&nbsp;<span class="op" id="5701750">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701754">n</span>&nbsp;<span class="op" id="5701756">:=</span>&nbsp;<span class="ident" id="5701759">typ</span><span class="op" id="5701762">.</span><span class="ident" id="5701763">NumField</span><span class="op" id="5701771">(</span><span class="op" id="5701772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701776">for</span>&nbsp;<span class="ident" id="5701780">i</span>&nbsp;<span class="op" id="5701782">:=</span>&nbsp;<span class="num" id="5701785">0</span><span class="op" id="5701786">;</span>&nbsp;<span class="ident" id="5701788">i</span>&nbsp;<span class="op" id="5701790">&lt;</span>&nbsp;<span class="ident" id="5701792">n</span><span class="op" id="5701793">;</span>&nbsp;<span class="ident" id="5701795">i</span><span class="op" id="5701796">++</span>&nbsp;<span class="op" id="5701799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701804">f</span>&nbsp;<span class="op" id="5701806">:=</span>&nbsp;<span class="ident" id="5701809">typ</span><span class="op" id="5701812">.</span><span class="ident" id="5701813">Field</span><span class="op" id="5701818">(</span><span class="ident" id="5701819">i</span><span class="op" id="5701820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701825">if</span>&nbsp;<span class="ident" id="5701828">f</span><span class="op" id="5701829">.</span><span class="ident" id="5701830">PkgPath</span>&nbsp;<span class="op" id="5701838">!=</span>&nbsp;<span class="string" id="5701841">&#34;&#34;</span>&nbsp;<span class="op" id="5701844">||</span>&nbsp;<span class="ident" id="5701847">f</span><span class="op" id="5701848">.</span><span class="ident" id="5701849">Tag</span><span class="op" id="5701852">.</span><span class="ident" id="5701853">Get</span><span class="op" id="5701856">(</span><span class="string" id="5701857">&#34;xml&#34;</span><span class="op" id="5701862">)</span>&nbsp;<span class="op" id="5701864">==</span>&nbsp;<span class="string" id="5701867">&#34;-&#34;</span>&nbsp;<span class="op" id="5701871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701877">continue</span>&nbsp;<span class="comment" id="5701886">//&nbsp;Private&nbsp;field</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5701906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5701912">//&nbsp;For&nbsp;embedded&nbsp;structs,&nbsp;embed&nbsp;its&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701958">if</span>&nbsp;<span class="ident" id="5701961">f</span><span class="op" id="5701962">.</span><span class="ident" id="5701963">Anonymous</span>&nbsp;<span class="op" id="5701973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701979">t</span>&nbsp;<span class="op" id="5701981">:=</span>&nbsp;<span class="ident" id="5701984">f</span><span class="op" id="5701985">.</span><span class="ident" id="5701986">Type</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701995">if</span>&nbsp;<span class="ident" id="5701998">t</span><span class="op" id="5701999">.</span><span class="ident" id="5702000">Kind</span><span class="op" id="5702004">(</span><span class="op" id="5702005">)</span>&nbsp;<span class="op" id="5702007">==</span>&nbsp;<span class="ident" id="5702010">reflect</span><span class="op" id="5702017">.</span><span class="ident" id="5702018">Ptr</span>&nbsp;<span class="op" id="5702022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702029">t</span>&nbsp;<span class="op" id="5702031">=</span>&nbsp;<span class="ident" id="5702033">t</span><span class="op" id="5702034">.</span><span class="ident" id="5702035">Elem</span><span class="op" id="5702039">(</span><span class="op" id="5702040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5702046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702052">if</span>&nbsp;<span class="ident" id="5702055">t</span><span class="op" id="5702056">.</span><span class="ident" id="5702057">Kind</span><span class="op" id="5702061">(</span><span class="op" id="5702062">)</span>&nbsp;<span class="op" id="5702064">==</span>&nbsp;<span class="ident" id="5702067">reflect</span><span class="op" id="5702074">.</span><span class="ident" id="5702075">Struct</span>&nbsp;<span class="op" id="5702082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702089">inner</span><span class="op" id="5702094">,</span>&nbsp;<span class="ident" id="5702096">err</span>&nbsp;<span class="op" id="5702100">:=</span>&nbsp;<span class="ident" id="5702103">getTypeInfo</span><span class="op" id="5702114">(</span><span class="ident" id="5702115">t</span><span class="op" id="5702116">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702123">if</span>&nbsp;<span class="ident" id="5702126">err</span>&nbsp;<span class="op" id="5702130">!=</span>&nbsp;<span class="ident" id="5702133">nil</span>&nbsp;<span class="op" id="5702137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702145">return</span>&nbsp;<span class="ident" id="5702152">nil</span><span class="op" id="5702155">,</span>&nbsp;<span class="ident" id="5702157">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5702166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702173">if</span>&nbsp;<span class="ident" id="5702176">tinfo</span><span class="op" id="5702181">.</span><span class="ident" id="5702182">xmlname</span>&nbsp;<span class="op" id="5702190">==</span>&nbsp;<span class="ident" id="5702193">nil</span>&nbsp;<span class="op" id="5702197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702205">tinfo</span><span class="op" id="5702210">.</span><span class="ident" id="5702211">xmlname</span>&nbsp;<span class="op" id="5702219">=</span>&nbsp;<span class="ident" id="5702221">inner</span><span class="op" id="5702226">.</span><span class="ident" id="5702227">xmlname</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5702240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702247">for</span>&nbsp;<span class="ident" id="5702251">_</span><span class="op" id="5702252">,</span>&nbsp;<span class="ident" id="5702254">finfo</span>&nbsp;<span class="op" id="5702260">:=</span>&nbsp;<span class="keyword" id="5702263">range</span>&nbsp;<span class="ident" id="5702269">inner</span><span class="op" id="5702274">.</span><span class="ident" id="5702275">fields</span>&nbsp;<span class="op" id="5702282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702290">finfo</span><span class="op" id="5702295">.</span><span class="ident" id="5702296">idx</span>&nbsp;<span class="op" id="5702300">=</span>&nbsp;<span class="builtinfunc" id="5702302">append</span><span class="op" id="5702308">(</span><span class="op" id="5702309">[</span><span class="op" id="5702310">]</span><span class="builtintype" id="5702311">int</span><span class="op" id="5702314">{</span><span class="ident" id="5702315">i</span><span class="op" id="5702316">}</span><span class="op" id="5702317">,</span>&nbsp;<span class="ident" id="5702319">finfo</span><span class="op" id="5702324">.</span><span class="ident" id="5702325">idx</span><span class="op" id="5702328">...</span><span class="op" id="5702331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702339">if</span>&nbsp;<span class="ident" id="5702342">err</span>&nbsp;<span class="op" id="5702346">:=</span>&nbsp;<span class="ident" id="5702349">addFieldInfo</span><span class="op" id="5702361">(</span><span class="ident" id="5702362">typ</span><span class="op" id="5702365">,</span>&nbsp;<span class="ident" id="5702367">tinfo</span><span class="op" id="5702372">,</span>&nbsp;<span class="op" id="5702374">&amp;</span><span class="ident" id="5702375">finfo</span><span class="op" id="5702380">)</span><span class="op" id="5702381">;</span>&nbsp;<span class="ident" id="5702383">err</span>&nbsp;<span class="op" id="5702387">!=</span>&nbsp;<span class="ident" id="5702390">nil</span>&nbsp;<span class="op" id="5702394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702403">return</span>&nbsp;<span class="ident" id="5702410">nil</span><span class="op" id="5702413">,</span>&nbsp;<span class="ident" id="5702415">err</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5702425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5702432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702439">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5702452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5702457">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702463">finfo</span><span class="op" id="5702468">,</span>&nbsp;<span class="ident" id="5702470">err</span>&nbsp;<span class="op" id="5702474">:=</span>&nbsp;<span class="ident" id="5702477">structFieldInfo</span><span class="op" id="5702492">(</span><span class="ident" id="5702493">typ</span><span class="op" id="5702496">,</span>&nbsp;<span class="op" id="5702498">&amp;</span><span class="ident" id="5702499">f</span><span class="op" id="5702500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702505">if</span>&nbsp;<span class="ident" id="5702508">err</span>&nbsp;<span class="op" id="5702512">!=</span>&nbsp;<span class="ident" id="5702515">nil</span>&nbsp;<span class="op" id="5702519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702525">return</span>&nbsp;<span class="ident" id="5702532">nil</span><span class="op" id="5702535">,</span>&nbsp;<span class="ident" id="5702537">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5702544">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702550">if</span>&nbsp;<span class="ident" id="5702553">f</span><span class="op" id="5702554">.</span><span class="ident" id="5702555">Name</span>&nbsp;<span class="op" id="5702560">==</span>&nbsp;<span class="string" id="5702563">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="5702573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702579">tinfo</span><span class="op" id="5702584">.</span><span class="ident" id="5702585">xmlname</span>&nbsp;<span class="op" id="5702593">=</span>&nbsp;<span class="ident" id="5702595">finfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702605">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5702617">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702623">//&nbsp;Add&nbsp;the&nbsp;field&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;conflict&nbsp;with&nbsp;other&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702685">if</span>&nbsp;<span class="ident" id="5702688">err</span>&nbsp;<span class="op" id="5702692">:=</span>&nbsp;<span class="ident" id="5702695">addFieldInfo</span><span class="op" id="5702707">(</span><span class="ident" id="5702708">typ</span><span class="op" id="5702711">,</span>&nbsp;<span class="ident" id="5702713">tinfo</span><span class="op" id="5702718">,</span>&nbsp;<span class="ident" id="5702720">finfo</span><span class="op" id="5702725">)</span><span class="op" id="5702726">;</span>&nbsp;<span class="ident" id="5702728">err</span>&nbsp;<span class="op" id="5702732">!=</span>&nbsp;<span class="ident" id="5702735">nil</span>&nbsp;<span class="op" id="5702739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702745">return</span>&nbsp;<span class="ident" id="5702752">nil</span><span class="op" id="5702755">,</span>&nbsp;<span class="ident" id="5702757">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5702764">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5702768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5702771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702774">tinfoLock</span><span class="op" id="5702783">.</span><span class="ident" id="5702784">Lock</span><span class="op" id="5702788">(</span><span class="op" id="5702789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702792">tinfoMap</span><span class="op" id="5702800">[</span><span class="ident" id="5702801">typ</span><span class="op" id="5702804">]</span>&nbsp;<span class="op" id="5702806">=</span>&nbsp;<span class="ident" id="5702808">tinfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702815">tinfoLock</span><span class="op" id="5702824">.</span><span class="ident" id="5702825">Unlock</span><span class="op" id="5702831">(</span><span class="op" id="5702832">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702835">return</span>&nbsp;<span class="ident" id="5702842">tinfo</span><span class="op" id="5702847">,</span>&nbsp;<span class="ident" id="5702849">nil</span><br>
<span class="lineno"></span><span class="op" id="5702853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5702856">//&nbsp;structFieldInfo&nbsp;builds&nbsp;and&nbsp;returns&nbsp;a&nbsp;fieldInfo&nbsp;for&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="5702913">func</span>&nbsp;<span class="ident" id="5702918">structFieldInfo</span><span class="op" id="5702933">(</span><span class="ident" id="5702934">typ</span>&nbsp;<span class="ident" id="5702938">reflect</span><span class="op" id="5702945">.</span><span class="ident" id="5702946">Type</span><span class="op" id="5702950">,</span>&nbsp;<span class="ident" id="5702952">f</span>&nbsp;<span class="op" id="5702954">*</span><span class="ident" id="5702955">reflect</span><span class="op" id="5702962">.</span><span class="ident" id="5702963">StructField</span><span class="op" id="5702974">)</span>&nbsp;<span class="op" id="5702976">(</span><span class="op" id="5702977">*</span><span class="ident" id="5702978">fieldInfo</span><span class="op" id="5702987">,</span>&nbsp;<span class="builtintype" id="5702989">error</span><span class="op" id="5702994">)</span>&nbsp;<span class="op" id="5702996">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702999">finfo</span>&nbsp;<span class="op" id="5703005">:=</span>&nbsp;<span class="op" id="5703008">&amp;</span><span class="ident" id="5703009">fieldInfo</span><span class="op" id="5703018">{</span><span class="ident" id="5703019">idx</span><span class="op" id="5703022">:</span>&nbsp;<span class="ident" id="5703024">f</span><span class="op" id="5703025">.</span><span class="ident" id="5703026">Index</span><span class="op" id="5703031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5703035">//&nbsp;Split&nbsp;the&nbsp;tag&nbsp;from&nbsp;the&nbsp;xml&nbsp;namespace&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703090">tag</span>&nbsp;<span class="op" id="5703094">:=</span>&nbsp;<span class="ident" id="5703097">f</span><span class="op" id="5703098">.</span><span class="ident" id="5703099">Tag</span><span class="op" id="5703102">.</span><span class="ident" id="5703103">Get</span><span class="op" id="5703106">(</span><span class="string" id="5703107">&#34;xml&#34;</span><span class="op" id="5703112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703115">if</span>&nbsp;<span class="ident" id="5703118">i</span>&nbsp;<span class="op" id="5703120">:=</span>&nbsp;<span class="ident" id="5703123">strings</span><span class="op" id="5703130">.</span><span class="ident" id="5703131">Index</span><span class="op" id="5703136">(</span><span class="ident" id="5703137">tag</span><span class="op" id="5703140">,</span>&nbsp;<span class="string" id="5703142">&#34;&nbsp;&#34;</span><span class="op" id="5703145">)</span><span class="op" id="5703146">;</span>&nbsp;<span class="ident" id="5703148">i</span>&nbsp;<span class="op" id="5703150">&gt;=</span>&nbsp;<span class="num" id="5703153">0</span>&nbsp;<span class="op" id="5703155">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703159">finfo</span><span class="op" id="5703164">.</span><span class="ident" id="5703165">xmlns</span><span class="op" id="5703170">,</span>&nbsp;<span class="ident" id="5703172">tag</span>&nbsp;<span class="op" id="5703176">=</span>&nbsp;<span class="ident" id="5703178">tag</span><span class="op" id="5703181">[</span><span class="op" id="5703182">:</span><span class="ident" id="5703183">i</span><span class="op" id="5703184">]</span><span class="op" id="5703185">,</span>&nbsp;<span class="ident" id="5703187">tag</span><span class="op" id="5703190">[</span><span class="ident" id="5703191">i</span><span class="op" id="5703192">+</span><span class="num" id="5703193">1</span><span class="op" id="5703194">:</span><span class="op" id="5703195">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5703202">//&nbsp;Parse&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703219">tokens</span>&nbsp;<span class="op" id="5703226">:=</span>&nbsp;<span class="ident" id="5703229">strings</span><span class="op" id="5703236">.</span><span class="ident" id="5703237">Split</span><span class="op" id="5703242">(</span><span class="ident" id="5703243">tag</span><span class="op" id="5703246">,</span>&nbsp;<span class="string" id="5703248">&#34;,&#34;</span><span class="op" id="5703251">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703254">if</span>&nbsp;<span class="builtinfunc" id="5703257">len</span><span class="op" id="5703260">(</span><span class="ident" id="5703261">tokens</span><span class="op" id="5703267">)</span>&nbsp;<span class="op" id="5703269">==</span>&nbsp;<span class="num" id="5703272">1</span>&nbsp;<span class="op" id="5703274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703278">finfo</span><span class="op" id="5703283">.</span><span class="ident" id="5703284">flags</span>&nbsp;<span class="op" id="5703290">=</span>&nbsp;<span class="ident" id="5703292">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703302">}</span>&nbsp;<span class="keyword" id="5703304">else</span>&nbsp;<span class="op" id="5703309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703313">tag</span>&nbsp;<span class="op" id="5703317">=</span>&nbsp;<span class="ident" id="5703319">tokens</span><span class="op" id="5703325">[</span><span class="num" id="5703326">0</span><span class="op" id="5703327">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703331">for</span>&nbsp;<span class="ident" id="5703335">_</span><span class="op" id="5703336">,</span>&nbsp;<span class="ident" id="5703338">flag</span>&nbsp;<span class="op" id="5703343">:=</span>&nbsp;<span class="keyword" id="5703346">range</span>&nbsp;<span class="ident" id="5703352">tokens</span><span class="op" id="5703358">[</span><span class="num" id="5703359">1</span><span class="op" id="5703360">:</span><span class="op" id="5703361">]</span>&nbsp;<span class="op" id="5703363">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703368">switch</span>&nbsp;<span class="ident" id="5703375">flag</span>&nbsp;<span class="op" id="5703380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703385">case</span>&nbsp;<span class="string" id="5703390">&#34;attr&#34;</span><span class="op" id="5703396">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703402">finfo</span><span class="op" id="5703407">.</span><span class="ident" id="5703408">flags</span>&nbsp;<span class="op" id="5703414">|=</span>&nbsp;<span class="ident" id="5703417">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703426">case</span>&nbsp;<span class="string" id="5703431">&#34;chardata&#34;</span><span class="op" id="5703441">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703447">finfo</span><span class="op" id="5703452">.</span><span class="ident" id="5703453">flags</span>&nbsp;<span class="op" id="5703459">|=</span>&nbsp;<span class="ident" id="5703462">fCharData</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703475">case</span>&nbsp;<span class="string" id="5703480">&#34;innerxml&#34;</span><span class="op" id="5703490">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703496">finfo</span><span class="op" id="5703501">.</span><span class="ident" id="5703502">flags</span>&nbsp;<span class="op" id="5703508">|=</span>&nbsp;<span class="ident" id="5703511">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703524">case</span>&nbsp;<span class="string" id="5703529">&#34;comment&#34;</span><span class="op" id="5703538">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703544">finfo</span><span class="op" id="5703549">.</span><span class="ident" id="5703550">flags</span>&nbsp;<span class="op" id="5703556">|=</span>&nbsp;<span class="ident" id="5703559">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703571">case</span>&nbsp;<span class="string" id="5703576">&#34;any&#34;</span><span class="op" id="5703581">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703587">finfo</span><span class="op" id="5703592">.</span><span class="ident" id="5703593">flags</span>&nbsp;<span class="op" id="5703599">|=</span>&nbsp;<span class="ident" id="5703602">fAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703610">case</span>&nbsp;<span class="string" id="5703615">&#34;omitempty&#34;</span><span class="op" id="5703626">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703632">finfo</span><span class="op" id="5703637">.</span><span class="ident" id="5703638">flags</span>&nbsp;<span class="op" id="5703644">|=</span>&nbsp;<span class="ident" id="5703647">fOmitEmpty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703665">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5703670">//&nbsp;Validate&nbsp;the&nbsp;flags&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703700">valid</span>&nbsp;<span class="op" id="5703706">:=</span>&nbsp;<span class="builtintype" id="5703709">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703716">switch</span>&nbsp;<span class="ident" id="5703723">mode</span>&nbsp;<span class="op" id="5703728">:=</span>&nbsp;<span class="ident" id="5703731">finfo</span><span class="op" id="5703736">.</span><span class="ident" id="5703737">flags</span>&nbsp;<span class="op" id="5703743">&amp;</span>&nbsp;<span class="ident" id="5703745">fMode</span><span class="op" id="5703750">;</span>&nbsp;<span class="ident" id="5703752">mode</span>&nbsp;<span class="op" id="5703757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703761">case</span>&nbsp;<span class="num" id="5703766">0</span><span class="op" id="5703767">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703772">finfo</span><span class="op" id="5703777">.</span><span class="ident" id="5703778">flags</span>&nbsp;<span class="op" id="5703784">|=</span>&nbsp;<span class="ident" id="5703787">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703798">case</span>&nbsp;<span class="ident" id="5703803">fAttr</span><span class="op" id="5703808">,</span>&nbsp;<span class="ident" id="5703810">fCharData</span><span class="op" id="5703819">,</span>&nbsp;<span class="ident" id="5703821">fInnerXml</span><span class="op" id="5703830">,</span>&nbsp;<span class="ident" id="5703832">fComment</span><span class="op" id="5703840">,</span>&nbsp;<span class="ident" id="5703842">fAny</span><span class="op" id="5703846">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703851">if</span>&nbsp;<span class="ident" id="5703854">f</span><span class="op" id="5703855">.</span><span class="ident" id="5703856">Name</span>&nbsp;<span class="op" id="5703861">==</span>&nbsp;<span class="string" id="5703864">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="5703874">||</span>&nbsp;<span class="ident" id="5703877">tag</span>&nbsp;<span class="op" id="5703881">!=</span>&nbsp;<span class="string" id="5703884">&#34;&#34;</span>&nbsp;<span class="op" id="5703887">&amp;&amp;</span>&nbsp;<span class="ident" id="5703890">mode</span>&nbsp;<span class="op" id="5703895">!=</span>&nbsp;<span class="ident" id="5703898">fAttr</span>&nbsp;<span class="op" id="5703904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703910">valid</span>&nbsp;<span class="op" id="5703916">=</span>&nbsp;<span class="builtintype" id="5703918">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703927">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703931">default</span><span class="op" id="5703938">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5703943">//&nbsp;This&nbsp;will&nbsp;also&nbsp;catch&nbsp;multiple&nbsp;modes&nbsp;in&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704004">valid</span>&nbsp;<span class="op" id="5704010">=</span>&nbsp;<span class="builtintype" id="5704012">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704024">if</span>&nbsp;<span class="ident" id="5704027">finfo</span><span class="op" id="5704032">.</span><span class="ident" id="5704033">flags</span><span class="op" id="5704038">&amp;</span><span class="ident" id="5704039">fMode</span>&nbsp;<span class="op" id="5704045">==</span>&nbsp;<span class="ident" id="5704048">fAny</span>&nbsp;<span class="op" id="5704053">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704058">finfo</span><span class="op" id="5704063">.</span><span class="ident" id="5704064">flags</span>&nbsp;<span class="op" id="5704070">|=</span>&nbsp;<span class="ident" id="5704073">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704088">if</span>&nbsp;<span class="ident" id="5704091">finfo</span><span class="op" id="5704096">.</span><span class="ident" id="5704097">flags</span><span class="op" id="5704102">&amp;</span><span class="ident" id="5704103">fOmitEmpty</span>&nbsp;<span class="op" id="5704114">!=</span>&nbsp;<span class="num" id="5704117">0</span>&nbsp;<span class="op" id="5704119">&amp;&amp;</span>&nbsp;<span class="ident" id="5704122">finfo</span><span class="op" id="5704127">.</span><span class="ident" id="5704128">flags</span><span class="op" id="5704133">&amp;</span><span class="op" id="5704134">(</span><span class="ident" id="5704135">fElement</span><span class="op" id="5704143">|</span><span class="ident" id="5704144">fAttr</span><span class="op" id="5704149">)</span>&nbsp;<span class="op" id="5704151">==</span>&nbsp;<span class="num" id="5704154">0</span>&nbsp;<span class="op" id="5704156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704161">valid</span>&nbsp;<span class="op" id="5704167">=</span>&nbsp;<span class="builtintype" id="5704169">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704177">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704181">if</span>&nbsp;<span class="op" id="5704184">!</span><span class="ident" id="5704185">valid</span>&nbsp;<span class="op" id="5704191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704196">return</span>&nbsp;<span class="ident" id="5704203">nil</span><span class="op" id="5704206">,</span>&nbsp;<span class="ident" id="5704208">fmt</span><span class="op" id="5704211">.</span><span class="ident" id="5704212">Errorf</span><span class="op" id="5704218">(</span><span class="string" id="5704219">&#34;xml:&nbsp;invalid&nbsp;tag&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="5704264">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704270">f</span><span class="op" id="5704271">.</span><span class="ident" id="5704272">Name</span><span class="op" id="5704276">,</span>&nbsp;<span class="ident" id="5704278">typ</span><span class="op" id="5704281">,</span>&nbsp;<span class="ident" id="5704283">f</span><span class="op" id="5704284">.</span><span class="ident" id="5704285">Tag</span><span class="op" id="5704288">.</span><span class="ident" id="5704289">Get</span><span class="op" id="5704292">(</span><span class="string" id="5704293">&#34;xml&#34;</span><span class="op" id="5704298">)</span><span class="op" id="5704299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704306">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5704310">//&nbsp;Use&nbsp;of&nbsp;xmlns&nbsp;without&nbsp;a&nbsp;name&nbsp;is&nbsp;not&nbsp;allowed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704358">if</span>&nbsp;<span class="ident" id="5704361">finfo</span><span class="op" id="5704366">.</span><span class="ident" id="5704367">xmlns</span>&nbsp;<span class="op" id="5704373">!=</span>&nbsp;<span class="string" id="5704376">&#34;&#34;</span>&nbsp;<span class="op" id="5704379">&amp;&amp;</span>&nbsp;<span class="ident" id="5704382">tag</span>&nbsp;<span class="op" id="5704386">==</span>&nbsp;<span class="string" id="5704389">&#34;&#34;</span>&nbsp;<span class="op" id="5704392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704396">return</span>&nbsp;<span class="ident" id="5704403">nil</span><span class="op" id="5704406">,</span>&nbsp;<span class="ident" id="5704408">fmt</span><span class="op" id="5704411">.</span><span class="ident" id="5704412">Errorf</span><span class="op" id="5704418">(</span><span class="string" id="5704419">&#34;xml:&nbsp;namespace&nbsp;without&nbsp;name&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="5704475">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704480">f</span><span class="op" id="5704481">.</span><span class="ident" id="5704482">Name</span><span class="op" id="5704486">,</span>&nbsp;<span class="ident" id="5704488">typ</span><span class="op" id="5704491">,</span>&nbsp;<span class="ident" id="5704493">f</span><span class="op" id="5704494">.</span><span class="ident" id="5704495">Tag</span><span class="op" id="5704498">.</span><span class="ident" id="5704499">Get</span><span class="op" id="5704502">(</span><span class="string" id="5704503">&#34;xml&#34;</span><span class="op" id="5704508">)</span><span class="op" id="5704509">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704516">if</span>&nbsp;<span class="ident" id="5704519">f</span><span class="op" id="5704520">.</span><span class="ident" id="5704521">Name</span>&nbsp;<span class="op" id="5704526">==</span>&nbsp;<span class="string" id="5704529">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="5704539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5704543">//&nbsp;The&nbsp;XMLName&nbsp;field&nbsp;records&nbsp;the&nbsp;XML&nbsp;element&nbsp;name.&nbsp;Don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5704602">//&nbsp;process&nbsp;it&nbsp;as&nbsp;usual&nbsp;because&nbsp;its&nbsp;name&nbsp;should&nbsp;default&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5704662">//&nbsp;empty&nbsp;rather&nbsp;than&nbsp;to&nbsp;the&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704704">finfo</span><span class="op" id="5704709">.</span><span class="ident" id="5704710">name</span>&nbsp;<span class="op" id="5704715">=</span>&nbsp;<span class="ident" id="5704717">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704723">return</span>&nbsp;<span class="ident" id="5704730">finfo</span><span class="op" id="5704735">,</span>&nbsp;<span class="ident" id="5704737">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704746">if</span>&nbsp;<span class="ident" id="5704749">tag</span>&nbsp;<span class="op" id="5704753">==</span>&nbsp;<span class="string" id="5704756">&#34;&#34;</span>&nbsp;<span class="op" id="5704759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5704763">//&nbsp;If&nbsp;the&nbsp;name&nbsp;part&nbsp;of&nbsp;the&nbsp;tag&nbsp;is&nbsp;completely&nbsp;empty,&nbsp;get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5704821">//&nbsp;default&nbsp;from&nbsp;XMLName&nbsp;of&nbsp;underlying&nbsp;struct&nbsp;if&nbsp;feasible,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5704881">//&nbsp;or&nbsp;field&nbsp;name&nbsp;otherwise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704911">if</span>&nbsp;<span class="ident" id="5704914">xmlname</span>&nbsp;<span class="op" id="5704922">:=</span>&nbsp;<span class="ident" id="5704925">lookupXMLName</span><span class="op" id="5704938">(</span><span class="ident" id="5704939">f</span><span class="op" id="5704940">.</span><span class="ident" id="5704941">Type</span><span class="op" id="5704945">)</span><span class="op" id="5704946">;</span>&nbsp;<span class="ident" id="5704948">xmlname</span>&nbsp;<span class="op" id="5704956">!=</span>&nbsp;<span class="ident" id="5704959">nil</span>&nbsp;<span class="op" id="5704963">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704968">finfo</span><span class="op" id="5704973">.</span><span class="ident" id="5704974">xmlns</span><span class="op" id="5704979">,</span>&nbsp;<span class="ident" id="5704981">finfo</span><span class="op" id="5704986">.</span><span class="ident" id="5704987">name</span>&nbsp;<span class="op" id="5704992">=</span>&nbsp;<span class="ident" id="5704994">xmlname</span><span class="op" id="5705001">.</span><span class="ident" id="5705002">xmlns</span><span class="op" id="5705007">,</span>&nbsp;<span class="ident" id="5705009">xmlname</span><span class="op" id="5705016">.</span><span class="ident" id="5705017">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5705024">}</span>&nbsp;<span class="keyword" id="5705026">else</span>&nbsp;<span class="op" id="5705031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705036">finfo</span><span class="op" id="5705041">.</span><span class="ident" id="5705042">name</span>&nbsp;<span class="op" id="5705047">=</span>&nbsp;<span class="ident" id="5705049">f</span><span class="op" id="5705050">.</span><span class="ident" id="5705051">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5705058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705062">return</span>&nbsp;<span class="ident" id="5705069">finfo</span><span class="op" id="5705074">,</span>&nbsp;<span class="ident" id="5705076">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5705081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5705085">//&nbsp;Prepare&nbsp;field&nbsp;name&nbsp;and&nbsp;parents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705121">parents</span>&nbsp;<span class="op" id="5705129">:=</span>&nbsp;<span class="ident" id="5705132">strings</span><span class="op" id="5705139">.</span><span class="ident" id="5705140">Split</span><span class="op" id="5705145">(</span><span class="ident" id="5705146">tag</span><span class="op" id="5705149">,</span>&nbsp;<span class="string" id="5705151">&#34;&gt;&#34;</span><span class="op" id="5705154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705157">if</span>&nbsp;<span class="ident" id="5705160">parents</span><span class="op" id="5705167">[</span><span class="num" id="5705168">0</span><span class="op" id="5705169">]</span>&nbsp;<span class="op" id="5705171">==</span>&nbsp;<span class="string" id="5705174">&#34;&#34;</span>&nbsp;<span class="op" id="5705177">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705181">parents</span><span class="op" id="5705188">[</span><span class="num" id="5705189">0</span><span class="op" id="5705190">]</span>&nbsp;<span class="op" id="5705192">=</span>&nbsp;<span class="ident" id="5705194">f</span><span class="op" id="5705195">.</span><span class="ident" id="5705196">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5705202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705205">if</span>&nbsp;<span class="ident" id="5705208">parents</span><span class="op" id="5705215">[</span><span class="builtinfunc" id="5705216">len</span><span class="op" id="5705219">(</span><span class="ident" id="5705220">parents</span><span class="op" id="5705227">)</span><span class="op" id="5705228">-</span><span class="num" id="5705229">1</span><span class="op" id="5705230">]</span>&nbsp;<span class="op" id="5705232">==</span>&nbsp;<span class="string" id="5705235">&#34;&#34;</span>&nbsp;<span class="op" id="5705238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705242">return</span>&nbsp;<span class="ident" id="5705249">nil</span><span class="op" id="5705252">,</span>&nbsp;<span class="ident" id="5705254">fmt</span><span class="op" id="5705257">.</span><span class="ident" id="5705258">Errorf</span><span class="op" id="5705264">(</span><span class="string" id="5705265">&#34;xml:&nbsp;trailing&nbsp;&#39;&gt;&#39;&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5705307">,</span>&nbsp;<span class="ident" id="5705309">f</span><span class="op" id="5705310">.</span><span class="ident" id="5705311">Name</span><span class="op" id="5705315">,</span>&nbsp;<span class="ident" id="5705317">typ</span><span class="op" id="5705320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5705323">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705326">finfo</span><span class="op" id="5705331">.</span><span class="ident" id="5705332">name</span>&nbsp;<span class="op" id="5705337">=</span>&nbsp;<span class="ident" id="5705339">parents</span><span class="op" id="5705346">[</span><span class="builtinfunc" id="5705347">len</span><span class="op" id="5705350">(</span><span class="ident" id="5705351">parents</span><span class="op" id="5705358">)</span><span class="op" id="5705359">-</span><span class="num" id="5705360">1</span><span class="op" id="5705361">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705364">if</span>&nbsp;<span class="builtinfunc" id="5705367">len</span><span class="op" id="5705370">(</span><span class="ident" id="5705371">parents</span><span class="op" id="5705378">)</span>&nbsp;<span class="op" id="5705380">&gt;</span>&nbsp;<span class="num" id="5705382">1</span>&nbsp;<span class="op" id="5705384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705388">if</span>&nbsp;<span class="op" id="5705391">(</span><span class="ident" id="5705392">finfo</span><span class="op" id="5705397">.</span><span class="ident" id="5705398">flags</span>&nbsp;<span class="op" id="5705404">&amp;</span>&nbsp;<span class="ident" id="5705406">fElement</span><span class="op" id="5705414">)</span>&nbsp;<span class="op" id="5705416">==</span>&nbsp;<span class="num" id="5705419">0</span>&nbsp;<span class="op" id="5705421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705426">return</span>&nbsp;<span class="ident" id="5705433">nil</span><span class="op" id="5705436">,</span>&nbsp;<span class="ident" id="5705438">fmt</span><span class="op" id="5705441">.</span><span class="ident" id="5705442">Errorf</span><span class="op" id="5705448">(</span><span class="string" id="5705449">&#34;xml:&nbsp;%s&nbsp;chain&nbsp;not&nbsp;valid&nbsp;with&nbsp;%s&nbsp;flag&#34;</span><span class="op" id="5705487">,</span>&nbsp;<span class="ident" id="5705489">tag</span><span class="op" id="5705492">,</span>&nbsp;<span class="ident" id="5705494">strings</span><span class="op" id="5705501">.</span><span class="ident" id="5705502">Join</span><span class="op" id="5705506">(</span><span class="ident" id="5705507">tokens</span><span class="op" id="5705513">[</span><span class="num" id="5705514">1</span><span class="op" id="5705515">:</span><span class="op" id="5705516">]</span><span class="op" id="5705517">,</span>&nbsp;<span class="string" id="5705519">&#34;,&#34;</span><span class="op" id="5705522">)</span><span class="op" id="5705523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5705527">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705531">finfo</span><span class="op" id="5705536">.</span><span class="ident" id="5705537">parents</span>&nbsp;<span class="op" id="5705545">=</span>&nbsp;<span class="ident" id="5705547">parents</span><span class="op" id="5705554">[</span><span class="op" id="5705555">:</span><span class="builtinfunc" id="5705556">len</span><span class="op" id="5705559">(</span><span class="ident" id="5705560">parents</span><span class="op" id="5705567">)</span><span class="op" id="5705568">-</span><span class="num" id="5705569">1</span><span class="op" id="5705570">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5705573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5705577">//&nbsp;If&nbsp;the&nbsp;field&nbsp;type&nbsp;has&nbsp;an&nbsp;XMLName&nbsp;field,&nbsp;the&nbsp;names&nbsp;must&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5705642">//&nbsp;so&nbsp;that&nbsp;the&nbsp;behavior&nbsp;of&nbsp;both&nbsp;marshalling&nbsp;and&nbsp;unmarshalling</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5705705">//&nbsp;is&nbsp;straightforward&nbsp;and&nbsp;unambiguous.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705745">if</span>&nbsp;<span class="ident" id="5705748">finfo</span><span class="op" id="5705753">.</span><span class="ident" id="5705754">flags</span><span class="op" id="5705759">&amp;</span><span class="ident" id="5705760">fElement</span>&nbsp;<span class="op" id="5705769">!=</span>&nbsp;<span class="num" id="5705772">0</span>&nbsp;<span class="op" id="5705774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705778">ftyp</span>&nbsp;<span class="op" id="5705783">:=</span>&nbsp;<span class="ident" id="5705786">f</span><span class="op" id="5705787">.</span><span class="ident" id="5705788">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705795">xmlname</span>&nbsp;<span class="op" id="5705803">:=</span>&nbsp;<span class="ident" id="5705806">lookupXMLName</span><span class="op" id="5705819">(</span><span class="ident" id="5705820">ftyp</span><span class="op" id="5705824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705828">if</span>&nbsp;<span class="ident" id="5705831">xmlname</span>&nbsp;<span class="op" id="5705839">!=</span>&nbsp;<span class="ident" id="5705842">nil</span>&nbsp;<span class="op" id="5705846">&amp;&amp;</span>&nbsp;<span class="ident" id="5705849">xmlname</span><span class="op" id="5705856">.</span><span class="ident" id="5705857">name</span>&nbsp;<span class="op" id="5705862">!=</span>&nbsp;<span class="ident" id="5705865">finfo</span><span class="op" id="5705870">.</span><span class="ident" id="5705871">name</span>&nbsp;<span class="op" id="5705876">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705881">return</span>&nbsp;<span class="ident" id="5705888">nil</span><span class="op" id="5705891">,</span>&nbsp;<span class="ident" id="5705893">fmt</span><span class="op" id="5705896">.</span><span class="ident" id="5705897">Errorf</span><span class="op" id="5705903">(</span><span class="string" id="5705904">&#34;xml:&nbsp;name&nbsp;%q&nbsp;in&nbsp;tag&nbsp;of&nbsp;%s.%s&nbsp;conflicts&nbsp;with&nbsp;name&nbsp;%q&nbsp;in&nbsp;%s.XMLName&#34;</span><span class="op" id="5705971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705977">finfo</span><span class="op" id="5705982">.</span><span class="ident" id="5705983">name</span><span class="op" id="5705987">,</span>&nbsp;<span class="ident" id="5705989">typ</span><span class="op" id="5705992">,</span>&nbsp;<span class="ident" id="5705994">f</span><span class="op" id="5705995">.</span><span class="ident" id="5705996">Name</span><span class="op" id="5706000">,</span>&nbsp;<span class="ident" id="5706002">xmlname</span><span class="op" id="5706009">.</span><span class="ident" id="5706010">name</span><span class="op" id="5706014">,</span>&nbsp;<span class="ident" id="5706016">ftyp</span><span class="op" id="5706020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5706024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5706027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706030">return</span>&nbsp;<span class="ident" id="5706037">finfo</span><span class="op" id="5706042">,</span>&nbsp;<span class="ident" id="5706044">nil</span><br>
<span class="lineno">225</span><span class="op" id="5706048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5706051">//&nbsp;lookupXMLName&nbsp;returns&nbsp;the&nbsp;fieldInfo&nbsp;for&nbsp;typ&#39;s&nbsp;XMLName&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5706114">//&nbsp;in&nbsp;case&nbsp;it&nbsp;exists&nbsp;and&nbsp;has&nbsp;a&nbsp;valid&nbsp;xml&nbsp;field&nbsp;tag,&nbsp;otherwise</span><br>
<span class="lineno"></span><span class="comment" id="5706176">//&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">230</span><span class="keyword" id="5706195">func</span>&nbsp;<span class="ident" id="5706200">lookupXMLName</span><span class="op" id="5706213">(</span><span class="ident" id="5706214">typ</span>&nbsp;<span class="ident" id="5706218">reflect</span><span class="op" id="5706225">.</span><span class="ident" id="5706226">Type</span><span class="op" id="5706230">)</span>&nbsp;<span class="op" id="5706232">(</span><span class="ident" id="5706233">xmlname</span>&nbsp;<span class="op" id="5706241">*</span><span class="ident" id="5706242">fieldInfo</span><span class="op" id="5706251">)</span>&nbsp;<span class="op" id="5706253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706256">for</span>&nbsp;<span class="ident" id="5706260">typ</span><span class="op" id="5706263">.</span><span class="ident" id="5706264">Kind</span><span class="op" id="5706268">(</span><span class="op" id="5706269">)</span>&nbsp;<span class="op" id="5706271">==</span>&nbsp;<span class="ident" id="5706274">reflect</span><span class="op" id="5706281">.</span><span class="ident" id="5706282">Ptr</span>&nbsp;<span class="op" id="5706286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5706290">typ</span>&nbsp;<span class="op" id="5706294">=</span>&nbsp;<span class="ident" id="5706296">typ</span><span class="op" id="5706299">.</span><span class="ident" id="5706300">Elem</span><span class="op" id="5706304">(</span><span class="op" id="5706305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5706308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706311">if</span>&nbsp;<span class="ident" id="5706314">typ</span><span class="op" id="5706317">.</span><span class="ident" id="5706318">Kind</span><span class="op" id="5706322">(</span><span class="op" id="5706323">)</span>&nbsp;<span class="op" id="5706325">!=</span>&nbsp;<span class="ident" id="5706328">reflect</span><span class="op" id="5706335">.</span><span class="ident" id="5706336">Struct</span>&nbsp;<span class="op" id="5706343">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706347">return</span>&nbsp;<span class="ident" id="5706354">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5706359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706362">for</span>&nbsp;<span class="ident" id="5706366">i</span><span class="op" id="5706367">,</span>&nbsp;<span class="ident" id="5706369">n</span>&nbsp;<span class="op" id="5706371">:=</span>&nbsp;<span class="num" id="5706374">0</span><span class="op" id="5706375">,</span>&nbsp;<span class="ident" id="5706377">typ</span><span class="op" id="5706380">.</span><span class="ident" id="5706381">NumField</span><span class="op" id="5706389">(</span><span class="op" id="5706390">)</span><span class="op" id="5706391">;</span>&nbsp;<span class="ident" id="5706393">i</span>&nbsp;<span class="op" id="5706395">&lt;</span>&nbsp;<span class="ident" id="5706397">n</span><span class="op" id="5706398">;</span>&nbsp;<span class="ident" id="5706400">i</span><span class="op" id="5706401">++</span>&nbsp;<span class="op" id="5706404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5706408">f</span>&nbsp;<span class="op" id="5706410">:=</span>&nbsp;<span class="ident" id="5706413">typ</span><span class="op" id="5706416">.</span><span class="ident" id="5706417">Field</span><span class="op" id="5706422">(</span><span class="ident" id="5706423">i</span><span class="op" id="5706424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706428">if</span>&nbsp;<span class="ident" id="5706431">f</span><span class="op" id="5706432">.</span><span class="ident" id="5706433">Name</span>&nbsp;<span class="op" id="5706438">!=</span>&nbsp;<span class="string" id="5706441">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="5706451">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706456">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5706467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5706471">finfo</span><span class="op" id="5706476">,</span>&nbsp;<span class="ident" id="5706478">err</span>&nbsp;<span class="op" id="5706482">:=</span>&nbsp;<span class="ident" id="5706485">structFieldInfo</span><span class="op" id="5706500">(</span><span class="ident" id="5706501">typ</span><span class="op" id="5706504">,</span>&nbsp;<span class="op" id="5706506">&amp;</span><span class="ident" id="5706507">f</span><span class="op" id="5706508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706512">if</span>&nbsp;<span class="ident" id="5706515">finfo</span><span class="op" id="5706520">.</span><span class="ident" id="5706521">name</span>&nbsp;<span class="op" id="5706526">!=</span>&nbsp;<span class="string" id="5706529">&#34;&#34;</span>&nbsp;<span class="op" id="5706532">&amp;&amp;</span>&nbsp;<span class="ident" id="5706535">err</span>&nbsp;<span class="op" id="5706539">==</span>&nbsp;<span class="ident" id="5706542">nil</span>&nbsp;<span class="op" id="5706546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706551">return</span>&nbsp;<span class="ident" id="5706558">finfo</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5706566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5706570">//&nbsp;Also&nbsp;consider&nbsp;errors&nbsp;as&nbsp;a&nbsp;non-existent&nbsp;field&nbsp;tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5706624">//&nbsp;and&nbsp;let&nbsp;getTypeInfo&nbsp;itself&nbsp;report&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706674">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5706681">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706684">return</span>&nbsp;<span class="ident" id="5706691">nil</span><br>
<span class="lineno"></span><span class="op" id="5706695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5706698">func</span>&nbsp;<span class="ident" id="5706703">min</span><span class="op" id="5706706">(</span><span class="ident" id="5706707">a</span><span class="op" id="5706708">,</span>&nbsp;<span class="ident" id="5706710">b</span>&nbsp;<span class="builtintype" id="5706712">int</span><span class="op" id="5706715">)</span>&nbsp;<span class="builtintype" id="5706717">int</span>&nbsp;<span class="op" id="5706721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706724">if</span>&nbsp;<span class="ident" id="5706727">a</span>&nbsp;<span class="op" id="5706729">&lt;=</span>&nbsp;<span class="ident" id="5706732">b</span>&nbsp;<span class="op" id="5706734">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706738">return</span>&nbsp;<span class="ident" id="5706745">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5706748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706751">return</span>&nbsp;<span class="ident" id="5706758">b</span><br>
<span class="lineno"></span><span class="op" id="5706760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="5706763">//&nbsp;addFieldInfo&nbsp;adds&nbsp;finfo&nbsp;to&nbsp;tinfo.fields&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="5706822">//&nbsp;conflicts,&nbsp;or&nbsp;if&nbsp;conflicts&nbsp;arise&nbsp;from&nbsp;previous&nbsp;fields&nbsp;that&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="5706889">//&nbsp;obtained&nbsp;from&nbsp;deeper&nbsp;embedded&nbsp;structures&nbsp;than&nbsp;finfo.&nbsp;In&nbsp;the&nbsp;latter</span><br>
<span class="lineno"></span><span class="comment" id="5706959">//&nbsp;case,&nbsp;the&nbsp;conflicting&nbsp;entries&nbsp;are&nbsp;dropped.</span><br>
<span class="lineno"></span><span class="comment" id="5707005">//&nbsp;A&nbsp;conflict&nbsp;occurs&nbsp;when&nbsp;the&nbsp;path&nbsp;(parent&nbsp;+&nbsp;name)&nbsp;to&nbsp;a&nbsp;field&nbsp;is</span><br>
<span class="lineno">265</span><span class="comment" id="5707070">//&nbsp;itself&nbsp;a&nbsp;prefix&nbsp;of&nbsp;another&nbsp;path,&nbsp;or&nbsp;when&nbsp;two&nbsp;paths&nbsp;match&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="comment" id="5707139">//&nbsp;It&nbsp;is&nbsp;okay&nbsp;for&nbsp;field&nbsp;paths&nbsp;to&nbsp;share&nbsp;a&nbsp;common,&nbsp;shorter&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="5707204">func</span>&nbsp;<span class="ident" id="5707209">addFieldInfo</span><span class="op" id="5707221">(</span><span class="ident" id="5707222">typ</span>&nbsp;<span class="ident" id="5707226">reflect</span><span class="op" id="5707233">.</span><span class="ident" id="5707234">Type</span><span class="op" id="5707238">,</span>&nbsp;<span class="ident" id="5707240">tinfo</span>&nbsp;<span class="op" id="5707246">*</span><span class="ident" id="5707247">typeInfo</span><span class="op" id="5707255">,</span>&nbsp;<span class="ident" id="5707257">newf</span>&nbsp;<span class="op" id="5707262">*</span><span class="ident" id="5707263">fieldInfo</span><span class="op" id="5707272">)</span>&nbsp;<span class="builtintype" id="5707274">error</span>&nbsp;<span class="op" id="5707280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5707283">var</span>&nbsp;<span class="ident" id="5707287">conflicts</span>&nbsp;<span class="op" id="5707297">[</span><span class="op" id="5707298">]</span><span class="builtintype" id="5707299">int</span><br>
<span class="lineno"></span><span class="ident" id="5707303">Loop</span><span class="op" id="5707307">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5707310">//&nbsp;First,&nbsp;figure&nbsp;all&nbsp;conflicts.&nbsp;Most&nbsp;working&nbsp;code&nbsp;will&nbsp;have&nbsp;none.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5707377">for</span>&nbsp;<span class="ident" id="5707381">i</span>&nbsp;<span class="op" id="5707383">:=</span>&nbsp;<span class="keyword" id="5707386">range</span>&nbsp;<span class="ident" id="5707392">tinfo</span><span class="op" id="5707397">.</span><span class="ident" id="5707398">fields</span>&nbsp;<span class="op" id="5707405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5707409">oldf</span>&nbsp;<span class="op" id="5707414">:=</span>&nbsp;<span class="op" id="5707417">&amp;</span><span class="ident" id="5707418">tinfo</span><span class="op" id="5707423">.</span><span class="ident" id="5707424">fields</span><span class="op" id="5707430">[</span><span class="ident" id="5707431">i</span><span class="op" id="5707432">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5707436">if</span>&nbsp;<span class="ident" id="5707439">oldf</span><span class="op" id="5707443">.</span><span class="ident" id="5707444">flags</span><span class="op" id="5707449">&amp;</span><span class="ident" id="5707450">fMode</span>&nbsp;<span class="op" id="5707456">!=</span>&nbsp;<span class="ident" id="5707459">newf</span><span class="op" id="5707463">.</span><span class="ident" id="5707464">flags</span><span class="op" id="5707469">&amp;</span><span class="ident" id="5707470">fMode</span>&nbsp;<span class="op" id="5707476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5707481">continue</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5707492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5707496">if</span>&nbsp;<span class="ident" id="5707499">oldf</span><span class="op" id="5707503">.</span><span class="ident" id="5707504">xmlns</span>&nbsp;<span class="op" id="5707510">!=</span>&nbsp;<span class="string" id="5707513">&#34;&#34;</span>&nbsp;<span class="op" id="5707516">&amp;&amp;</span>&nbsp;<span class="ident" id="5707519">newf</span><span class="op" id="5707523">.</span><span class="ident" id="5707524">xmlns</span>&nbsp;<span class="op" id="5707530">!=</span>&nbsp;<span class="string" id="5707533">&#34;&#34;</span>&nbsp;<span class="op" id="5707536">&amp;&amp;</span>&nbsp;<span class="ident" id="5707539">oldf</span><span class="op" id="5707543">.</span><span class="ident" id="5707544">xmlns</span>&nbsp;<span class="op" id="5707550">!=</span>&nbsp;<span class="ident" id="5707553">newf</span><span class="op" id="5707557">.</span><span class="ident" id="5707558">xmlns</span>&nbsp;<span class="op" id="5707564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5707569">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5707580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5707584">minl</span>&nbsp;<span class="op" id="5707589">:=</span>&nbsp;<span class="ident" id="5707592">min</span><span class="op" id="5707595">(</span><span class="builtinfunc" id="5707596">len</span><span class="op" id="5707599">(</span><span class="ident" id="5707600">newf</span><span class="op" id="5707604">.</span><span class="ident" id="5707605">parents</span><span class="op" id="5707612">)</span><span class="op" id="5707613">,</span>&nbsp;<span class="builtinfunc" id="5707615">len</span><span class="op" id="5707618">(</span><span class="ident" id="5707619">oldf</span><span class="op" id="5707623">.</span><span class="ident" id="5707624">parents</span><span class="op" id="5707631">)</span><span class="op" id="5707632">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5707636">for</span>&nbsp;<span class="ident" id="5707640">p</span>&nbsp;<span class="op" id="5707642">:=</span>&nbsp;<span class="num" id="5707645">0</span><span class="op" id="5707646">;</span>&nbsp;<span class="ident" id="5707648">p</span>&nbsp;<span class="op" id="5707650">&lt;</span>&nbsp;<span class="ident" id="5707652">minl</span><span class="op" id="5707656">;</span>&nbsp;<span class="ident" id="5707658">p</span><span class="op" id="5707659">++</span>&nbsp;<span class="op" id="5707662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5707667">if</span>&nbsp;<span class="ident" id="5707670">oldf</span><span class="op" id="5707674">.</span><span class="ident" id="5707675">parents</span><span class="op" id="5707682">[</span><span class="ident" id="5707683">p</span><span class="op" id="5707684">]</span>&nbsp;<span class="op" id="5707686">!=</span>&nbsp;<span class="ident" id="5707689">newf</span><span class="op" id="5707693">.</span><span class="ident" id="5707694">parents</span><span class="op" id="5707701">[</span><span class="ident" id="5707702">p</span><span class="op" id="5707703">]</span>&nbsp;<span class="op" id="5707705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5707711">continue</span>&nbsp;<span class="ident" id="5707720">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5707728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5707732">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5707736">if</span>&nbsp;<span class="builtinfunc" id="5707739">len</span><span class="op" id="5707742">(</span><span class="ident" id="5707743">oldf</span><span class="op" id="5707747">.</span><span class="ident" id="5707748">parents</span><span class="op" id="5707755">)</span>&nbsp;<span class="op" id="5707757">&gt;</span>&nbsp;<span class="builtinfunc" id="5707759">len</span><span class="op" id="5707762">(</span><span class="ident" id="5707763">newf</span><span class="op" id="5707767">.</span><span class="ident" id="5707768">parents</span><span class="op" id="5707775">)</span>&nbsp;<span class="op" id="5707777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5707782">if</span>&nbsp;<span class="ident" id="5707785">oldf</span><span class="op" id="5707789">.</span><span class="ident" id="5707790">parents</span><span class="op" id="5707797">[</span><span class="builtinfunc" id="5707798">len</span><span class="op" id="5707801">(</span><span class="ident" id="5707802">newf</span><span class="op" id="5707806">.</span><span class="ident" id="5707807">parents</span><span class="op" id="5707814">)</span><span class="op" id="5707815">]</span>&nbsp;<span class="op" id="5707817">==</span>&nbsp;<span class="ident" id="5707820">newf</span><span class="op" id="5707824">.</span><span class="ident" id="5707825">name</span>&nbsp;<span class="op" id="5707830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5707836">conflicts</span>&nbsp;<span class="op" id="5707846">=</span>&nbsp;<span class="builtinfunc" id="5707848">append</span><span class="op" id="5707854">(</span><span class="ident" id="5707855">conflicts</span><span class="op" id="5707864">,</span>&nbsp;<span class="ident" id="5707866">i</span><span class="op" id="5707867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5707872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5707876">}</span>&nbsp;<span class="keyword" id="5707878">else</span>&nbsp;<span class="keyword" id="5707883">if</span>&nbsp;<span class="builtinfunc" id="5707886">len</span><span class="op" id="5707889">(</span><span class="ident" id="5707890">oldf</span><span class="op" id="5707894">.</span><span class="ident" id="5707895">parents</span><span class="op" id="5707902">)</span>&nbsp;<span class="op" id="5707904">&lt;</span>&nbsp;<span class="builtinfunc" id="5707906">len</span><span class="op" id="5707909">(</span><span class="ident" id="5707910">newf</span><span class="op" id="5707914">.</span><span class="ident" id="5707915">parents</span><span class="op" id="5707922">)</span>&nbsp;<span class="op" id="5707924">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5707929">if</span>&nbsp;<span class="ident" id="5707932">newf</span><span class="op" id="5707936">.</span><span class="ident" id="5707937">parents</span><span class="op" id="5707944">[</span><span class="builtinfunc" id="5707945">len</span><span class="op" id="5707948">(</span><span class="ident" id="5707949">oldf</span><span class="op" id="5707953">.</span><span class="ident" id="5707954">parents</span><span class="op" id="5707961">)</span><span class="op" id="5707962">]</span>&nbsp;<span class="op" id="5707964">==</span>&nbsp;<span class="ident" id="5707967">oldf</span><span class="op" id="5707971">.</span><span class="ident" id="5707972">name</span>&nbsp;<span class="op" id="5707977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5707983">conflicts</span>&nbsp;<span class="op" id="5707993">=</span>&nbsp;<span class="builtinfunc" id="5707995">append</span><span class="op" id="5708001">(</span><span class="ident" id="5708002">conflicts</span><span class="op" id="5708011">,</span>&nbsp;<span class="ident" id="5708013">i</span><span class="op" id="5708014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5708019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5708023">}</span>&nbsp;<span class="keyword" id="5708025">else</span>&nbsp;<span class="op" id="5708030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708035">if</span>&nbsp;<span class="ident" id="5708038">newf</span><span class="op" id="5708042">.</span><span class="ident" id="5708043">name</span>&nbsp;<span class="op" id="5708048">==</span>&nbsp;<span class="ident" id="5708051">oldf</span><span class="op" id="5708055">.</span><span class="ident" id="5708056">name</span>&nbsp;<span class="op" id="5708061">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5708067">conflicts</span>&nbsp;<span class="op" id="5708077">=</span>&nbsp;<span class="builtinfunc" id="5708079">append</span><span class="op" id="5708085">(</span><span class="ident" id="5708086">conflicts</span><span class="op" id="5708095">,</span>&nbsp;<span class="ident" id="5708097">i</span><span class="op" id="5708098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5708103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5708107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5708110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5708113">//&nbsp;Without&nbsp;conflicts,&nbsp;add&nbsp;the&nbsp;new&nbsp;field&nbsp;and&nbsp;return.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708166">if</span>&nbsp;<span class="ident" id="5708169">conflicts</span>&nbsp;<span class="op" id="5708179">==</span>&nbsp;<span class="ident" id="5708182">nil</span>&nbsp;<span class="op" id="5708186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5708190">tinfo</span><span class="op" id="5708195">.</span><span class="ident" id="5708196">fields</span>&nbsp;<span class="op" id="5708203">=</span>&nbsp;<span class="builtinfunc" id="5708205">append</span><span class="op" id="5708211">(</span><span class="ident" id="5708212">tinfo</span><span class="op" id="5708217">.</span><span class="ident" id="5708218">fields</span><span class="op" id="5708224">,</span>&nbsp;<span class="op" id="5708226">*</span><span class="ident" id="5708227">newf</span><span class="op" id="5708231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708235">return</span>&nbsp;<span class="ident" id="5708242">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5708247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5708251">//&nbsp;If&nbsp;any&nbsp;conflict&nbsp;is&nbsp;shallower,&nbsp;ignore&nbsp;the&nbsp;new&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5708307">//&nbsp;This&nbsp;matches&nbsp;the&nbsp;Go&nbsp;field&nbsp;resolution&nbsp;on&nbsp;embedding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708362">for</span>&nbsp;<span class="ident" id="5708366">_</span><span class="op" id="5708367">,</span>&nbsp;<span class="ident" id="5708369">i</span>&nbsp;<span class="op" id="5708371">:=</span>&nbsp;<span class="keyword" id="5708374">range</span>&nbsp;<span class="ident" id="5708380">conflicts</span>&nbsp;<span class="op" id="5708390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708394">if</span>&nbsp;<span class="builtinfunc" id="5708397">len</span><span class="op" id="5708400">(</span><span class="ident" id="5708401">tinfo</span><span class="op" id="5708406">.</span><span class="ident" id="5708407">fields</span><span class="op" id="5708413">[</span><span class="ident" id="5708414">i</span><span class="op" id="5708415">]</span><span class="op" id="5708416">.</span><span class="ident" id="5708417">idx</span><span class="op" id="5708420">)</span>&nbsp;<span class="op" id="5708422">&lt;</span>&nbsp;<span class="builtinfunc" id="5708424">len</span><span class="op" id="5708427">(</span><span class="ident" id="5708428">newf</span><span class="op" id="5708432">.</span><span class="ident" id="5708433">idx</span><span class="op" id="5708436">)</span>&nbsp;<span class="op" id="5708438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708443">return</span>&nbsp;<span class="ident" id="5708450">nil</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5708456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5708459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5708463">//&nbsp;Otherwise,&nbsp;if&nbsp;any&nbsp;of&nbsp;them&nbsp;is&nbsp;at&nbsp;the&nbsp;same&nbsp;depth&nbsp;level,&nbsp;it&#39;s&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708536">for</span>&nbsp;<span class="ident" id="5708540">_</span><span class="op" id="5708541">,</span>&nbsp;<span class="ident" id="5708543">i</span>&nbsp;<span class="op" id="5708545">:=</span>&nbsp;<span class="keyword" id="5708548">range</span>&nbsp;<span class="ident" id="5708554">conflicts</span>&nbsp;<span class="op" id="5708564">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5708568">oldf</span>&nbsp;<span class="op" id="5708573">:=</span>&nbsp;<span class="op" id="5708576">&amp;</span><span class="ident" id="5708577">tinfo</span><span class="op" id="5708582">.</span><span class="ident" id="5708583">fields</span><span class="op" id="5708589">[</span><span class="ident" id="5708590">i</span><span class="op" id="5708591">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708595">if</span>&nbsp;<span class="builtinfunc" id="5708598">len</span><span class="op" id="5708601">(</span><span class="ident" id="5708602">oldf</span><span class="op" id="5708606">.</span><span class="ident" id="5708607">idx</span><span class="op" id="5708610">)</span>&nbsp;<span class="op" id="5708612">==</span>&nbsp;<span class="builtinfunc" id="5708615">len</span><span class="op" id="5708618">(</span><span class="ident" id="5708619">newf</span><span class="op" id="5708623">.</span><span class="ident" id="5708624">idx</span><span class="op" id="5708627">)</span>&nbsp;<span class="op" id="5708629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5708634">f1</span>&nbsp;<span class="op" id="5708637">:=</span>&nbsp;<span class="ident" id="5708640">typ</span><span class="op" id="5708643">.</span><span class="ident" id="5708644">FieldByIndex</span><span class="op" id="5708656">(</span><span class="ident" id="5708657">oldf</span><span class="op" id="5708661">.</span><span class="ident" id="5708662">idx</span><span class="op" id="5708665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5708670">f2</span>&nbsp;<span class="op" id="5708673">:=</span>&nbsp;<span class="ident" id="5708676">typ</span><span class="op" id="5708679">.</span><span class="ident" id="5708680">FieldByIndex</span><span class="op" id="5708692">(</span><span class="ident" id="5708693">newf</span><span class="op" id="5708697">.</span><span class="ident" id="5708698">idx</span><span class="op" id="5708701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708706">return</span>&nbsp;<span class="op" id="5708713">&amp;</span><span class="ident" id="5708714">TagPathError</span><span class="op" id="5708726">{</span><span class="ident" id="5708727">typ</span><span class="op" id="5708730">,</span>&nbsp;<span class="ident" id="5708732">f1</span><span class="op" id="5708734">.</span><span class="ident" id="5708735">Name</span><span class="op" id="5708739">,</span>&nbsp;<span class="ident" id="5708741">f1</span><span class="op" id="5708743">.</span><span class="ident" id="5708744">Tag</span><span class="op" id="5708747">.</span><span class="ident" id="5708748">Get</span><span class="op" id="5708751">(</span><span class="string" id="5708752">&#34;xml&#34;</span><span class="op" id="5708757">)</span><span class="op" id="5708758">,</span>&nbsp;<span class="ident" id="5708760">f2</span><span class="op" id="5708762">.</span><span class="ident" id="5708763">Name</span><span class="op" id="5708767">,</span>&nbsp;<span class="ident" id="5708769">f2</span><span class="op" id="5708771">.</span><span class="ident" id="5708772">Tag</span><span class="op" id="5708775">.</span><span class="ident" id="5708776">Get</span><span class="op" id="5708779">(</span><span class="string" id="5708780">&#34;xml&#34;</span><span class="op" id="5708785">)</span><span class="op" id="5708786">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5708790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5708793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5708797">//&nbsp;Otherwise,&nbsp;the&nbsp;new&nbsp;field&nbsp;is&nbsp;shallower,&nbsp;and&nbsp;thus&nbsp;takes&nbsp;precedence,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5708867">//&nbsp;so&nbsp;drop&nbsp;the&nbsp;conflicting&nbsp;fields&nbsp;from&nbsp;tinfo&nbsp;and&nbsp;append&nbsp;the&nbsp;new&nbsp;one.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708937">for</span>&nbsp;<span class="ident" id="5708941">c</span>&nbsp;<span class="op" id="5708943">:=</span>&nbsp;<span class="builtinfunc" id="5708946">len</span><span class="op" id="5708949">(</span><span class="ident" id="5708950">conflicts</span><span class="op" id="5708959">)</span>&nbsp;<span class="op" id="5708961">-</span>&nbsp;<span class="num" id="5708963">1</span><span class="op" id="5708964">;</span>&nbsp;<span class="ident" id="5708966">c</span>&nbsp;<span class="op" id="5708968">&gt;=</span>&nbsp;<span class="num" id="5708971">0</span><span class="op" id="5708972">;</span>&nbsp;<span class="ident" id="5708974">c</span><span class="op" id="5708975">--</span>&nbsp;<span class="op" id="5708978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5708982">i</span>&nbsp;<span class="op" id="5708984">:=</span>&nbsp;<span class="ident" id="5708987">conflicts</span><span class="op" id="5708996">[</span><span class="ident" id="5708997">c</span><span class="op" id="5708998">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5709002">copy</span><span class="op" id="5709006">(</span><span class="ident" id="5709007">tinfo</span><span class="op" id="5709012">.</span><span class="ident" id="5709013">fields</span><span class="op" id="5709019">[</span><span class="ident" id="5709020">i</span><span class="op" id="5709021">:</span><span class="op" id="5709022">]</span><span class="op" id="5709023">,</span>&nbsp;<span class="ident" id="5709025">tinfo</span><span class="op" id="5709030">.</span><span class="ident" id="5709031">fields</span><span class="op" id="5709037">[</span><span class="ident" id="5709038">i</span><span class="op" id="5709039">+</span><span class="num" id="5709040">1</span><span class="op" id="5709041">:</span><span class="op" id="5709042">]</span><span class="op" id="5709043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5709047">tinfo</span><span class="op" id="5709052">.</span><span class="ident" id="5709053">fields</span>&nbsp;<span class="op" id="5709060">=</span>&nbsp;<span class="ident" id="5709062">tinfo</span><span class="op" id="5709067">.</span><span class="ident" id="5709068">fields</span><span class="op" id="5709074">[</span><span class="op" id="5709075">:</span><span class="builtinfunc" id="5709076">len</span><span class="op" id="5709079">(</span><span class="ident" id="5709080">tinfo</span><span class="op" id="5709085">.</span><span class="ident" id="5709086">fields</span><span class="op" id="5709092">)</span><span class="op" id="5709093">-</span><span class="num" id="5709094">1</span><span class="op" id="5709095">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5709098">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5709101">tinfo</span><span class="op" id="5709106">.</span><span class="ident" id="5709107">fields</span>&nbsp;<span class="op" id="5709114">=</span>&nbsp;<span class="builtinfunc" id="5709116">append</span><span class="op" id="5709122">(</span><span class="ident" id="5709123">tinfo</span><span class="op" id="5709128">.</span><span class="ident" id="5709129">fields</span><span class="op" id="5709135">,</span>&nbsp;<span class="op" id="5709137">*</span><span class="ident" id="5709138">newf</span><span class="op" id="5709142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5709145">return</span>&nbsp;<span class="ident" id="5709152">nil</span><br>
<span class="lineno"></span><span class="op" id="5709156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5709159">//&nbsp;A&nbsp;TagPathError&nbsp;represents&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;unmarshalling&nbsp;process</span><br>
<span class="lineno">335</span><span class="comment" id="5709226">//&nbsp;caused&nbsp;by&nbsp;the&nbsp;use&nbsp;of&nbsp;field&nbsp;tags&nbsp;with&nbsp;conflicting&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="5709285">type</span>&nbsp;<span class="ident" id="5709290">TagPathError</span>&nbsp;<span class="keyword" id="5709303">struct</span>&nbsp;<span class="op" id="5709310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5709313">Struct</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5709326">reflect</span><span class="op" id="5709333">.</span><span class="ident" id="5709334">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5709340">Field1</span><span class="op" id="5709346">,</span>&nbsp;<span class="ident" id="5709348">Tag1</span>&nbsp;<span class="builtintype" id="5709353">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5709361">Field2</span><span class="op" id="5709367">,</span>&nbsp;<span class="ident" id="5709369">Tag2</span>&nbsp;<span class="builtintype" id="5709374">string</span><br>
<span class="lineno">340</span><span class="op" id="5709381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5709384">func</span>&nbsp;<span class="op" id="5709389">(</span><span class="ident" id="5709390">e</span>&nbsp;<span class="op" id="5709392">*</span><span class="ident" id="5709393">TagPathError</span><span class="op" id="5709405">)</span>&nbsp;<span class="ident" id="5709407">Error</span><span class="op" id="5709412">(</span><span class="op" id="5709413">)</span>&nbsp;<span class="builtintype" id="5709415">string</span>&nbsp;<span class="op" id="5709422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5709425">return</span>&nbsp;<span class="ident" id="5709432">fmt</span><span class="op" id="5709435">.</span><span class="ident" id="5709436">Sprintf</span><span class="op" id="5709443">(</span><span class="string" id="5709444">&#34;%s&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&nbsp;conflicts&nbsp;with&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&#34;</span><span class="op" id="5709505">,</span>&nbsp;<span class="ident" id="5709507">e</span><span class="op" id="5709508">.</span><span class="ident" id="5709509">Struct</span><span class="op" id="5709515">,</span>&nbsp;<span class="ident" id="5709517">e</span><span class="op" id="5709518">.</span><span class="ident" id="5709519">Field1</span><span class="op" id="5709525">,</span>&nbsp;<span class="ident" id="5709527">e</span><span class="op" id="5709528">.</span><span class="ident" id="5709529">Tag1</span><span class="op" id="5709533">,</span>&nbsp;<span class="ident" id="5709535">e</span><span class="op" id="5709536">.</span><span class="ident" id="5709537">Field2</span><span class="op" id="5709543">,</span>&nbsp;<span class="ident" id="5709545">e</span><span class="op" id="5709546">.</span><span class="ident" id="5709547">Tag2</span><span class="op" id="5709551">)</span><br>
<span class="lineno"></span><span class="op" id="5709553">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="comment" id="5709556">//&nbsp;value&nbsp;returns&nbsp;v&#39;s&nbsp;field&nbsp;value&nbsp;corresponding&nbsp;to&nbsp;finfo.</span><br>
<span class="lineno"></span><span class="comment" id="5709613">//&nbsp;It&#39;s&nbsp;equivalent&nbsp;to&nbsp;v.FieldByIndex(finfo.idx),&nbsp;but&nbsp;initializes</span><br>
<span class="lineno"></span><span class="comment" id="5709678">//&nbsp;and&nbsp;dereferences&nbsp;pointers&nbsp;as&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="5709721">func</span>&nbsp;<span class="op" id="5709726">(</span><span class="ident" id="5709727">finfo</span>&nbsp;<span class="op" id="5709733">*</span><span class="ident" id="5709734">fieldInfo</span><span class="op" id="5709743">)</span>&nbsp;<span class="ident" id="5709745">value</span><span class="op" id="5709750">(</span><span class="ident" id="5709751">v</span>&nbsp;<span class="ident" id="5709753">reflect</span><span class="op" id="5709760">.</span><span class="ident" id="5709761">Value</span><span class="op" id="5709766">)</span>&nbsp;<span class="ident" id="5709768">reflect</span><span class="op" id="5709775">.</span><span class="ident" id="5709776">Value</span>&nbsp;<span class="op" id="5709782">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5709785">for</span>&nbsp;<span class="ident" id="5709789">i</span><span class="op" id="5709790">,</span>&nbsp;<span class="ident" id="5709792">x</span>&nbsp;<span class="op" id="5709794">:=</span>&nbsp;<span class="keyword" id="5709797">range</span>&nbsp;<span class="ident" id="5709803">finfo</span><span class="op" id="5709808">.</span><span class="ident" id="5709809">idx</span>&nbsp;<span class="op" id="5709813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5709817">if</span>&nbsp;<span class="ident" id="5709820">i</span>&nbsp;<span class="op" id="5709822">&gt;</span>&nbsp;<span class="num" id="5709824">0</span>&nbsp;<span class="op" id="5709826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5709831">t</span>&nbsp;<span class="op" id="5709833">:=</span>&nbsp;<span class="ident" id="5709836">v</span><span class="op" id="5709837">.</span><span class="ident" id="5709838">Type</span><span class="op" id="5709842">(</span><span class="op" id="5709843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5709848">if</span>&nbsp;<span class="ident" id="5709851">t</span><span class="op" id="5709852">.</span><span class="ident" id="5709853">Kind</span><span class="op" id="5709857">(</span><span class="op" id="5709858">)</span>&nbsp;<span class="op" id="5709860">==</span>&nbsp;<span class="ident" id="5709863">reflect</span><span class="op" id="5709870">.</span><span class="ident" id="5709871">Ptr</span>&nbsp;<span class="op" id="5709875">&amp;&amp;</span>&nbsp;<span class="ident" id="5709878">t</span><span class="op" id="5709879">.</span><span class="ident" id="5709880">Elem</span><span class="op" id="5709884">(</span><span class="op" id="5709885">)</span><span class="op" id="5709886">.</span><span class="ident" id="5709887">Kind</span><span class="op" id="5709891">(</span><span class="op" id="5709892">)</span>&nbsp;<span class="op" id="5709894">==</span>&nbsp;<span class="ident" id="5709897">reflect</span><span class="op" id="5709904">.</span><span class="ident" id="5709905">Struct</span>&nbsp;<span class="op" id="5709912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5709918">if</span>&nbsp;<span class="ident" id="5709921">v</span><span class="op" id="5709922">.</span><span class="ident" id="5709923">IsNil</span><span class="op" id="5709928">(</span><span class="op" id="5709929">)</span>&nbsp;<span class="op" id="5709931">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5709938">v</span><span class="op" id="5709939">.</span><span class="ident" id="5709940">Set</span><span class="op" id="5709943">(</span><span class="ident" id="5709944">reflect</span><span class="op" id="5709951">.</span><span class="ident" id="5709952">New</span><span class="op" id="5709955">(</span><span class="ident" id="5709956">v</span><span class="op" id="5709957">.</span><span class="ident" id="5709958">Type</span><span class="op" id="5709962">(</span><span class="op" id="5709963">)</span><span class="op" id="5709964">.</span><span class="ident" id="5709965">Elem</span><span class="op" id="5709969">(</span><span class="op" id="5709970">)</span><span class="op" id="5709971">)</span><span class="op" id="5709972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5709978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5709984">v</span>&nbsp;<span class="op" id="5709986">=</span>&nbsp;<span class="ident" id="5709988">v</span><span class="op" id="5709989">.</span><span class="ident" id="5709990">Elem</span><span class="op" id="5709994">(</span><span class="op" id="5709995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5710000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5710004">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5710008">v</span>&nbsp;<span class="op" id="5710010">=</span>&nbsp;<span class="ident" id="5710012">v</span><span class="op" id="5710013">.</span><span class="ident" id="5710014">Field</span><span class="op" id="5710019">(</span><span class="ident" id="5710020">x</span><span class="op" id="5710021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5710024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5710027">return</span>&nbsp;<span class="ident" id="5710034">v</span><br>
<span class="lineno"></span><span class="op" id="5710036">}</span>
</div>
</body>
</html>
