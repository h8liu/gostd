<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html" class="current">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3675599">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3675655">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3675709">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3675760">package</span>&nbsp;<span class="ident" id="3675768">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3675773">import</span>&nbsp;<span class="op" id="3675780">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3675783">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3675793">&#34;time&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3675800">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3675803">//&nbsp;A&nbsp;Dialer&nbsp;contains&nbsp;options&nbsp;for&nbsp;connecting&nbsp;to&nbsp;an&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="3675862">//</span><br>
<span class="lineno"></span><span class="comment" id="3675865">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;each&nbsp;field&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;dialing</span><br>
<span class="lineno">15</span><span class="comment" id="3675923">//&nbsp;without&nbsp;that&nbsp;option.&nbsp;Dialing&nbsp;with&nbsp;the&nbsp;zero&nbsp;value&nbsp;of&nbsp;Dialer</span><br>
<span class="lineno"></span><span class="comment" id="3675985">//&nbsp;is&nbsp;therefore&nbsp;equivalent&nbsp;to&nbsp;just&nbsp;calling&nbsp;the&nbsp;Dial&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="3676047">type</span>&nbsp;<span class="ident" id="3676052">Dialer</span>&nbsp;<span class="keyword" id="3676059">struct</span>&nbsp;<span class="op" id="3676066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676069">//&nbsp;Timeout&nbsp;is&nbsp;the&nbsp;maximum&nbsp;amount&nbsp;of&nbsp;time&nbsp;a&nbsp;dial&nbsp;will&nbsp;wait&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676132">//&nbsp;a&nbsp;connect&nbsp;to&nbsp;complete.&nbsp;If&nbsp;Deadline&nbsp;is&nbsp;also&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676196">//&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676209">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676213">//&nbsp;The&nbsp;default&nbsp;is&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676244">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676248">//&nbsp;With&nbsp;or&nbsp;without&nbsp;a&nbsp;timeout,&nbsp;the&nbsp;operating&nbsp;system&nbsp;may&nbsp;impose</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676311">//&nbsp;its&nbsp;own&nbsp;earlier&nbsp;timeout.&nbsp;For&nbsp;instance,&nbsp;TCP&nbsp;timeouts&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676371">//&nbsp;often&nbsp;around&nbsp;3&nbsp;minutes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676399">Timeout</span>&nbsp;<span class="ident" id="3676407">time</span><span class="op" id="3676411">.</span><span class="ident" id="3676412">Duration</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676423">//&nbsp;Deadline&nbsp;is&nbsp;the&nbsp;absolute&nbsp;point&nbsp;in&nbsp;time&nbsp;after&nbsp;which&nbsp;dials</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676484">//&nbsp;will&nbsp;fail.&nbsp;If&nbsp;Timeout&nbsp;is&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676539">//&nbsp;Zero&nbsp;means&nbsp;no&nbsp;deadline,&nbsp;or&nbsp;dependent&nbsp;on&nbsp;the&nbsp;operating&nbsp;system</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676604">//&nbsp;as&nbsp;with&nbsp;the&nbsp;Timeout&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676636">Deadline</span>&nbsp;<span class="ident" id="3676645">time</span><span class="op" id="3676649">.</span><span class="ident" id="3676650">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676657">//&nbsp;LocalAddr&nbsp;is&nbsp;the&nbsp;local&nbsp;address&nbsp;to&nbsp;use&nbsp;when&nbsp;dialing&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676715">//&nbsp;address.&nbsp;The&nbsp;address&nbsp;must&nbsp;be&nbsp;of&nbsp;a&nbsp;compatible&nbsp;type&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676777">//&nbsp;network&nbsp;being&nbsp;dialed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676803">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;local&nbsp;address&nbsp;is&nbsp;automatically&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676856">LocalAddr</span>&nbsp;<span class="ident" id="3676866">Addr</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676873">//&nbsp;DualStack&nbsp;allows&nbsp;a&nbsp;single&nbsp;dial&nbsp;to&nbsp;attempt&nbsp;to&nbsp;establish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676932">//&nbsp;multiple&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;connections&nbsp;and&nbsp;to&nbsp;return&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676995">//&nbsp;established&nbsp;connection&nbsp;when&nbsp;the&nbsp;network&nbsp;is&nbsp;&#34;tcp&#34;&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3677056">//&nbsp;destination&nbsp;is&nbsp;a&nbsp;host&nbsp;name&nbsp;that&nbsp;has&nbsp;multiple&nbsp;address&nbsp;family</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3677120">//&nbsp;DNS&nbsp;records.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677137">DualStack</span>&nbsp;<span class="builtintype" id="3677147">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3677154">//&nbsp;KeepAlive&nbsp;specifies&nbsp;the&nbsp;keep-alive&nbsp;period&nbsp;for&nbsp;an&nbsp;active</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3677214">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3677238">//&nbsp;If&nbsp;zero,&nbsp;keep-alives&nbsp;are&nbsp;not&nbsp;enabled.&nbsp;Network&nbsp;protocols</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3677298">//&nbsp;that&nbsp;do&nbsp;not&nbsp;support&nbsp;keep-alives&nbsp;ignore&nbsp;this&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677353">KeepAlive</span>&nbsp;<span class="ident" id="3677363">time</span><span class="op" id="3677367">.</span><span class="ident" id="3677368">Duration</span><br>
<span class="lineno"></span><span class="op" id="3677377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="3677380">//&nbsp;Return&nbsp;either&nbsp;now+Timeout&nbsp;or&nbsp;Deadline,&nbsp;whichever&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="3677445">//&nbsp;Or&nbsp;zero,&nbsp;if&nbsp;neither&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3677476">func</span>&nbsp;<span class="op" id="3677481">(</span><span class="ident" id="3677482">d</span>&nbsp;<span class="op" id="3677484">*</span><span class="ident" id="3677485">Dialer</span><span class="op" id="3677491">)</span>&nbsp;<span class="ident" id="3677493">deadline</span><span class="op" id="3677501">(</span><span class="op" id="3677502">)</span>&nbsp;<span class="ident" id="3677504">time</span><span class="op" id="3677508">.</span><span class="ident" id="3677509">Time</span>&nbsp;<span class="op" id="3677514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677517">if</span>&nbsp;<span class="ident" id="3677520">d</span><span class="op" id="3677521">.</span><span class="ident" id="3677522">Timeout</span>&nbsp;<span class="op" id="3677530">==</span>&nbsp;<span class="num" id="3677533">0</span>&nbsp;<span class="op" id="3677535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677539">return</span>&nbsp;<span class="ident" id="3677546">d</span><span class="op" id="3677547">.</span><span class="ident" id="3677548">Deadline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3677558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677561">timeoutDeadline</span>&nbsp;<span class="op" id="3677577">:=</span>&nbsp;<span class="ident" id="3677580">time</span><span class="op" id="3677584">.</span><span class="ident" id="3677585">Now</span><span class="op" id="3677588">(</span><span class="op" id="3677589">)</span><span class="op" id="3677590">.</span><span class="ident" id="3677591">Add</span><span class="op" id="3677594">(</span><span class="ident" id="3677595">d</span><span class="op" id="3677596">.</span><span class="ident" id="3677597">Timeout</span><span class="op" id="3677604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677607">if</span>&nbsp;<span class="ident" id="3677610">d</span><span class="op" id="3677611">.</span><span class="ident" id="3677612">Deadline</span><span class="op" id="3677620">.</span><span class="ident" id="3677621">IsZero</span><span class="op" id="3677627">(</span><span class="op" id="3677628">)</span>&nbsp;<span class="op" id="3677630">||</span>&nbsp;<span class="ident" id="3677633">timeoutDeadline</span><span class="op" id="3677648">.</span><span class="ident" id="3677649">Before</span><span class="op" id="3677655">(</span><span class="ident" id="3677656">d</span><span class="op" id="3677657">.</span><span class="ident" id="3677658">Deadline</span><span class="op" id="3677666">)</span>&nbsp;<span class="op" id="3677668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677672">return</span>&nbsp;<span class="ident" id="3677679">timeoutDeadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3677696">}</span>&nbsp;<span class="keyword" id="3677698">else</span>&nbsp;<span class="op" id="3677703">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677707">return</span>&nbsp;<span class="ident" id="3677714">d</span><span class="op" id="3677715">.</span><span class="ident" id="3677716">Deadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3677726">}</span><br>
<span class="lineno"></span><span class="op" id="3677728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3677731">func</span>&nbsp;<span class="ident" id="3677736">parseNetwork</span><span class="op" id="3677748">(</span><span class="ident" id="3677749">net</span>&nbsp;<span class="builtintype" id="3677753">string</span><span class="op" id="3677759">)</span>&nbsp;<span class="op" id="3677761">(</span><span class="ident" id="3677762">afnet</span>&nbsp;<span class="builtintype" id="3677768">string</span><span class="op" id="3677774">,</span>&nbsp;<span class="ident" id="3677776">proto</span>&nbsp;<span class="builtintype" id="3677782">int</span><span class="op" id="3677785">,</span>&nbsp;<span class="ident" id="3677787">err</span>&nbsp;<span class="builtintype" id="3677791">error</span><span class="op" id="3677796">)</span>&nbsp;<span class="op" id="3677798">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677801">i</span>&nbsp;<span class="op" id="3677803">:=</span>&nbsp;<span class="ident" id="3677806">last</span><span class="op" id="3677810">(</span><span class="ident" id="3677811">net</span><span class="op" id="3677814">,</span>&nbsp;<span class="string" id="3677816">&#39;:&#39;</span><span class="op" id="3677819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677822">if</span>&nbsp;<span class="ident" id="3677825">i</span>&nbsp;<span class="op" id="3677827">&lt;</span>&nbsp;<span class="num" id="3677829">0</span>&nbsp;<span class="op" id="3677831">{</span>&nbsp;<span class="comment" id="3677833">//&nbsp;no&nbsp;colon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677847">switch</span>&nbsp;<span class="ident" id="3677854">net</span>&nbsp;<span class="op" id="3677858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677862">case</span>&nbsp;<span class="string" id="3677867">&#34;tcp&#34;</span><span class="op" id="3677872">,</span>&nbsp;<span class="string" id="3677874">&#34;tcp4&#34;</span><span class="op" id="3677880">,</span>&nbsp;<span class="string" id="3677882">&#34;tcp6&#34;</span><span class="op" id="3677888">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677892">case</span>&nbsp;<span class="string" id="3677897">&#34;udp&#34;</span><span class="op" id="3677902">,</span>&nbsp;<span class="string" id="3677904">&#34;udp4&#34;</span><span class="op" id="3677910">,</span>&nbsp;<span class="string" id="3677912">&#34;udp6&#34;</span><span class="op" id="3677918">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677922">case</span>&nbsp;<span class="string" id="3677927">&#34;ip&#34;</span><span class="op" id="3677931">,</span>&nbsp;<span class="string" id="3677933">&#34;ip4&#34;</span><span class="op" id="3677938">,</span>&nbsp;<span class="string" id="3677940">&#34;ip6&#34;</span><span class="op" id="3677945">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677949">case</span>&nbsp;<span class="string" id="3677954">&#34;unix&#34;</span><span class="op" id="3677960">,</span>&nbsp;<span class="string" id="3677962">&#34;unixgram&#34;</span><span class="op" id="3677972">,</span>&nbsp;<span class="string" id="3677974">&#34;unixpacket&#34;</span><span class="op" id="3677986">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677990">default</span><span class="op" id="3677997">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678002">return</span>&nbsp;<span class="string" id="3678009">&#34;&#34;</span><span class="op" id="3678011">,</span>&nbsp;<span class="num" id="3678013">0</span><span class="op" id="3678014">,</span>&nbsp;<span class="ident" id="3678016">UnknownNetworkError</span><span class="op" id="3678035">(</span><span class="ident" id="3678036">net</span><span class="op" id="3678039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3678043">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678047">return</span>&nbsp;<span class="ident" id="3678054">net</span><span class="op" id="3678057">,</span>&nbsp;<span class="num" id="3678059">0</span><span class="op" id="3678060">,</span>&nbsp;<span class="builtintype" id="3678062">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3678067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678070">afnet</span>&nbsp;<span class="op" id="3678076">=</span>&nbsp;<span class="ident" id="3678078">net</span><span class="op" id="3678081">[</span><span class="op" id="3678082">:</span><span class="ident" id="3678083">i</span><span class="op" id="3678084">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678087">switch</span>&nbsp;<span class="ident" id="3678094">afnet</span>&nbsp;<span class="op" id="3678100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678103">case</span>&nbsp;<span class="string" id="3678108">&#34;ip&#34;</span><span class="op" id="3678112">,</span>&nbsp;<span class="string" id="3678114">&#34;ip4&#34;</span><span class="op" id="3678119">,</span>&nbsp;<span class="string" id="3678121">&#34;ip6&#34;</span><span class="op" id="3678126">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678130">protostr</span>&nbsp;<span class="op" id="3678139">:=</span>&nbsp;<span class="ident" id="3678142">net</span><span class="op" id="3678145">[</span><span class="ident" id="3678146">i</span><span class="op" id="3678147">+</span><span class="num" id="3678148">1</span><span class="op" id="3678149">:</span><span class="op" id="3678150">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678154">proto</span><span class="op" id="3678159">,</span>&nbsp;<span class="ident" id="3678161">i</span><span class="op" id="3678162">,</span>&nbsp;<span class="ident" id="3678164">ok</span>&nbsp;<span class="op" id="3678167">:=</span>&nbsp;<span class="ident" id="3678170">dtoi</span><span class="op" id="3678174">(</span><span class="ident" id="3678175">protostr</span><span class="op" id="3678183">,</span>&nbsp;<span class="num" id="3678185">0</span><span class="op" id="3678186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678190">if</span>&nbsp;<span class="op" id="3678193">!</span><span class="ident" id="3678194">ok</span>&nbsp;<span class="op" id="3678197">||</span>&nbsp;<span class="ident" id="3678200">i</span>&nbsp;<span class="op" id="3678202">!=</span>&nbsp;<span class="builtinfunc" id="3678205">len</span><span class="op" id="3678208">(</span><span class="ident" id="3678209">protostr</span><span class="op" id="3678217">)</span>&nbsp;<span class="op" id="3678219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678224">proto</span><span class="op" id="3678229">,</span>&nbsp;<span class="ident" id="3678231">err</span>&nbsp;<span class="op" id="3678235">=</span>&nbsp;<span class="ident" id="3678237">lookupProtocol</span><span class="op" id="3678251">(</span><span class="ident" id="3678252">protostr</span><span class="op" id="3678260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678265">if</span>&nbsp;<span class="ident" id="3678268">err</span>&nbsp;<span class="op" id="3678272">!=</span>&nbsp;<span class="builtintype" id="3678275">nil</span>&nbsp;<span class="op" id="3678279">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678285">return</span>&nbsp;<span class="string" id="3678292">&#34;&#34;</span><span class="op" id="3678294">,</span>&nbsp;<span class="num" id="3678296">0</span><span class="op" id="3678297">,</span>&nbsp;<span class="ident" id="3678299">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3678306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3678310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678314">return</span>&nbsp;<span class="ident" id="3678321">afnet</span><span class="op" id="3678326">,</span>&nbsp;<span class="ident" id="3678328">proto</span><span class="op" id="3678333">,</span>&nbsp;<span class="builtintype" id="3678335">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3678340">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678343">return</span>&nbsp;<span class="string" id="3678350">&#34;&#34;</span><span class="op" id="3678352">,</span>&nbsp;<span class="num" id="3678354">0</span><span class="op" id="3678355">,</span>&nbsp;<span class="ident" id="3678357">UnknownNetworkError</span><span class="op" id="3678376">(</span><span class="ident" id="3678377">net</span><span class="op" id="3678380">)</span><br>
<span class="lineno"></span><span class="op" id="3678382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3678385">func</span>&nbsp;<span class="ident" id="3678390">resolveAddr</span><span class="op" id="3678401">(</span><span class="ident" id="3678402">op</span><span class="op" id="3678404">,</span>&nbsp;<span class="ident" id="3678406">net</span><span class="op" id="3678409">,</span>&nbsp;<span class="ident" id="3678411">addr</span>&nbsp;<span class="builtintype" id="3678416">string</span><span class="op" id="3678422">,</span>&nbsp;<span class="ident" id="3678424">deadline</span>&nbsp;<span class="ident" id="3678433">time</span><span class="op" id="3678437">.</span><span class="ident" id="3678438">Time</span><span class="op" id="3678442">)</span>&nbsp;<span class="op" id="3678444">(</span><span class="ident" id="3678445">netaddr</span><span class="op" id="3678452">,</span>&nbsp;<span class="builtintype" id="3678454">error</span><span class="op" id="3678459">)</span>&nbsp;<span class="op" id="3678461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678464">afnet</span><span class="op" id="3678469">,</span>&nbsp;<span class="ident" id="3678471">_</span><span class="op" id="3678472">,</span>&nbsp;<span class="ident" id="3678474">err</span>&nbsp;<span class="op" id="3678478">:=</span>&nbsp;<span class="ident" id="3678481">parseNetwork</span><span class="op" id="3678493">(</span><span class="ident" id="3678494">net</span><span class="op" id="3678497">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678500">if</span>&nbsp;<span class="ident" id="3678503">err</span>&nbsp;<span class="op" id="3678507">!=</span>&nbsp;<span class="builtintype" id="3678510">nil</span>&nbsp;<span class="op" id="3678514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678518">return</span>&nbsp;<span class="builtintype" id="3678525">nil</span><span class="op" id="3678528">,</span>&nbsp;<span class="ident" id="3678530">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3678535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678538">if</span>&nbsp;<span class="ident" id="3678541">op</span>&nbsp;<span class="op" id="3678544">==</span>&nbsp;<span class="string" id="3678547">&#34;dial&#34;</span>&nbsp;<span class="op" id="3678554">&amp;&amp;</span>&nbsp;<span class="ident" id="3678557">addr</span>&nbsp;<span class="op" id="3678562">==</span>&nbsp;<span class="string" id="3678565">&#34;&#34;</span>&nbsp;<span class="op" id="3678568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678572">return</span>&nbsp;<span class="builtintype" id="3678579">nil</span><span class="op" id="3678582">,</span>&nbsp;<span class="ident" id="3678584">errMissingAddress</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3678603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678606">switch</span>&nbsp;<span class="ident" id="3678613">afnet</span>&nbsp;<span class="op" id="3678619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678622">case</span>&nbsp;<span class="string" id="3678627">&#34;unix&#34;</span><span class="op" id="3678633">,</span>&nbsp;<span class="string" id="3678635">&#34;unixgram&#34;</span><span class="op" id="3678645">,</span>&nbsp;<span class="string" id="3678647">&#34;unixpacket&#34;</span><span class="op" id="3678659">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678663">return</span>&nbsp;<span class="ident" id="3678670">ResolveUnixAddr</span><span class="op" id="3678685">(</span><span class="ident" id="3678686">afnet</span><span class="op" id="3678691">,</span>&nbsp;<span class="ident" id="3678693">addr</span><span class="op" id="3678697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3678700">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678703">return</span>&nbsp;<span class="ident" id="3678710">resolveInternetAddr</span><span class="op" id="3678729">(</span><span class="ident" id="3678730">afnet</span><span class="op" id="3678735">,</span>&nbsp;<span class="ident" id="3678737">addr</span><span class="op" id="3678741">,</span>&nbsp;<span class="ident" id="3678743">deadline</span><span class="op" id="3678751">)</span><br>
<span class="lineno"></span><span class="op" id="3678753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3678756">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="3678810">//</span><br>
<span class="lineno">115</span><span class="comment" id="3678813">//&nbsp;Known&nbsp;networks&nbsp;are&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;tcp6&#34;&nbsp;(IPv6-only),</span><br>
<span class="lineno"></span><span class="comment" id="3678882">//&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;udp6&#34;&nbsp;(IPv6-only),&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3678944">//&nbsp;(IPv4-only),&nbsp;&#34;ip6&#34;&nbsp;(IPv6-only),&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3679002">//&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3679019">//</span><br>
<span class="lineno">120</span><span class="comment" id="3679022">//&nbsp;For&nbsp;TCP&nbsp;and&nbsp;UDP&nbsp;networks,&nbsp;addresses&nbsp;have&nbsp;the&nbsp;form&nbsp;host:port.</span><br>
<span class="lineno"></span><span class="comment" id="3679086">//&nbsp;If&nbsp;host&nbsp;is&nbsp;a&nbsp;literal&nbsp;IPv6&nbsp;address&nbsp;it&nbsp;must&nbsp;be&nbsp;enclosed</span><br>
<span class="lineno"></span><span class="comment" id="3679143">//&nbsp;in&nbsp;square&nbsp;brackets&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3679208">//&nbsp;The&nbsp;functions&nbsp;JoinHostPort&nbsp;and&nbsp;SplitHostPort&nbsp;manipulate&nbsp;addresses</span><br>
<span class="lineno"></span><span class="comment" id="3679277">//&nbsp;in&nbsp;this&nbsp;form.</span><br>
<span class="lineno">125</span><span class="comment" id="3679294">//</span><br>
<span class="lineno"></span><span class="comment" id="3679297">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3679310">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;tcp&#34;,&nbsp;&#34;12.34.56.78:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3679343">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;tcp&#34;,&nbsp;&#34;google.com:http&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3679377">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;tcp&#34;,&nbsp;&#34;[2001:db8::1]:http&#34;)</span><br>
<span class="lineno">130</span><span class="comment" id="3679414">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;tcp&#34;,&nbsp;&#34;[fe80::1%lo0]:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3679449">//</span><br>
<span class="lineno"></span><span class="comment" id="3679452">//&nbsp;For&nbsp;IP&nbsp;networks,&nbsp;the&nbsp;network&nbsp;must&nbsp;be&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;&nbsp;or&nbsp;&#34;ip6&#34;&nbsp;followed</span><br>
<span class="lineno"></span><span class="comment" id="3679522">//&nbsp;by&nbsp;a&nbsp;colon&nbsp;and&nbsp;a&nbsp;protocol&nbsp;number&nbsp;or&nbsp;name&nbsp;and&nbsp;the&nbsp;addr&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3679589">//&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">135</span><span class="comment" id="3679612">//</span><br>
<span class="lineno"></span><span class="comment" id="3679615">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3679628">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;ip4:1&#34;,&nbsp;&#34;127.0.0.1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3679658">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;ip6:ospf&#34;,&nbsp;&#34;::1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3679685">//</span><br>
<span class="lineno">140</span><span class="comment" id="3679688">//&nbsp;For&nbsp;Unix&nbsp;networks,&nbsp;the&nbsp;address&nbsp;must&nbsp;be&nbsp;a&nbsp;file&nbsp;system&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="3679750">func</span>&nbsp;<span class="ident" id="3679755">Dial</span><span class="op" id="3679759">(</span><span class="ident" id="3679760">network</span><span class="op" id="3679767">,</span>&nbsp;<span class="ident" id="3679769">address</span>&nbsp;<span class="builtintype" id="3679777">string</span><span class="op" id="3679783">)</span>&nbsp;<span class="op" id="3679785">(</span><span class="ident" id="3679786">Conn</span><span class="op" id="3679790">,</span>&nbsp;<span class="builtintype" id="3679792">error</span><span class="op" id="3679797">)</span>&nbsp;<span class="op" id="3679799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679802">var</span>&nbsp;<span class="ident" id="3679806">d</span>&nbsp;<span class="ident" id="3679808">Dialer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679816">return</span>&nbsp;<span class="ident" id="3679823">d</span><span class="op" id="3679824">.</span><span class="ident" id="3679825">Dial</span><span class="op" id="3679829">(</span><span class="ident" id="3679830">network</span><span class="op" id="3679837">,</span>&nbsp;<span class="ident" id="3679839">address</span><span class="op" id="3679846">)</span><br>
<span class="lineno"></span><span class="op" id="3679848">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="3679851">//&nbsp;DialTimeout&nbsp;acts&nbsp;like&nbsp;Dial&nbsp;but&nbsp;takes&nbsp;a&nbsp;timeout.</span><br>
<span class="lineno"></span><span class="comment" id="3679902">//&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;name&nbsp;resolution,&nbsp;if&nbsp;required.</span><br>
<span class="lineno"></span><span class="keyword" id="3679956">func</span>&nbsp;<span class="ident" id="3679961">DialTimeout</span><span class="op" id="3679972">(</span><span class="ident" id="3679973">network</span><span class="op" id="3679980">,</span>&nbsp;<span class="ident" id="3679982">address</span>&nbsp;<span class="builtintype" id="3679990">string</span><span class="op" id="3679996">,</span>&nbsp;<span class="ident" id="3679998">timeout</span>&nbsp;<span class="ident" id="3680006">time</span><span class="op" id="3680010">.</span><span class="ident" id="3680011">Duration</span><span class="op" id="3680019">)</span>&nbsp;<span class="op" id="3680021">(</span><span class="ident" id="3680022">Conn</span><span class="op" id="3680026">,</span>&nbsp;<span class="builtintype" id="3680028">error</span><span class="op" id="3680033">)</span>&nbsp;<span class="op" id="3680035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680038">d</span>&nbsp;<span class="op" id="3680040">:=</span>&nbsp;<span class="ident" id="3680043">Dialer</span><span class="op" id="3680049">{</span><span class="ident" id="3680050">Timeout</span><span class="op" id="3680057">:</span>&nbsp;<span class="ident" id="3680059">timeout</span><span class="op" id="3680066">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680069">return</span>&nbsp;<span class="ident" id="3680076">d</span><span class="op" id="3680077">.</span><span class="ident" id="3680078">Dial</span><span class="op" id="3680082">(</span><span class="ident" id="3680083">network</span><span class="op" id="3680090">,</span>&nbsp;<span class="ident" id="3680092">address</span><span class="op" id="3680099">)</span><br>
<span class="lineno"></span><span class="op" id="3680101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3680104">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="3680158">//</span><br>
<span class="lineno">155</span><span class="comment" id="3680161">//&nbsp;See&nbsp;func&nbsp;Dial&nbsp;for&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;network&nbsp;and&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3680223">//&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="3680238">func</span>&nbsp;<span class="op" id="3680243">(</span><span class="ident" id="3680244">d</span>&nbsp;<span class="op" id="3680246">*</span><span class="ident" id="3680247">Dialer</span><span class="op" id="3680253">)</span>&nbsp;<span class="ident" id="3680255">Dial</span><span class="op" id="3680259">(</span><span class="ident" id="3680260">network</span><span class="op" id="3680267">,</span>&nbsp;<span class="ident" id="3680269">address</span>&nbsp;<span class="builtintype" id="3680277">string</span><span class="op" id="3680283">)</span>&nbsp;<span class="op" id="3680285">(</span><span class="ident" id="3680286">Conn</span><span class="op" id="3680290">,</span>&nbsp;<span class="builtintype" id="3680292">error</span><span class="op" id="3680297">)</span>&nbsp;<span class="op" id="3680299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680302">ra</span><span class="op" id="3680304">,</span>&nbsp;<span class="ident" id="3680306">err</span>&nbsp;<span class="op" id="3680310">:=</span>&nbsp;<span class="ident" id="3680313">resolveAddr</span><span class="op" id="3680324">(</span><span class="string" id="3680325">&#34;dial&#34;</span><span class="op" id="3680331">,</span>&nbsp;<span class="ident" id="3680333">network</span><span class="op" id="3680340">,</span>&nbsp;<span class="ident" id="3680342">address</span><span class="op" id="3680349">,</span>&nbsp;<span class="ident" id="3680351">d</span><span class="op" id="3680352">.</span><span class="ident" id="3680353">deadline</span><span class="op" id="3680361">(</span><span class="op" id="3680362">)</span><span class="op" id="3680363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680366">if</span>&nbsp;<span class="ident" id="3680369">err</span>&nbsp;<span class="op" id="3680373">!=</span>&nbsp;<span class="builtintype" id="3680376">nil</span>&nbsp;<span class="op" id="3680380">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680384">return</span>&nbsp;<span class="builtintype" id="3680391">nil</span><span class="op" id="3680394">,</span>&nbsp;<span class="op" id="3680396">&amp;</span><span class="ident" id="3680397">OpError</span><span class="op" id="3680404">{</span><span class="ident" id="3680405">Op</span><span class="op" id="3680407">:</span>&nbsp;<span class="string" id="3680409">&#34;dial&#34;</span><span class="op" id="3680415">,</span>&nbsp;<span class="ident" id="3680417">Net</span><span class="op" id="3680420">:</span>&nbsp;<span class="ident" id="3680422">network</span><span class="op" id="3680429">,</span>&nbsp;<span class="ident" id="3680431">Addr</span><span class="op" id="3680435">:</span>&nbsp;<span class="builtintype" id="3680437">nil</span><span class="op" id="3680440">,</span>&nbsp;<span class="ident" id="3680442">Err</span><span class="op" id="3680445">:</span>&nbsp;<span class="ident" id="3680447">err</span><span class="op" id="3680450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3680453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680456">dialer</span>&nbsp;<span class="op" id="3680463">:=</span>&nbsp;<span class="keyword" id="3680466">func</span><span class="op" id="3680470">(</span><span class="ident" id="3680471">deadline</span>&nbsp;<span class="ident" id="3680480">time</span><span class="op" id="3680484">.</span><span class="ident" id="3680485">Time</span><span class="op" id="3680489">)</span>&nbsp;<span class="op" id="3680491">(</span><span class="ident" id="3680492">Conn</span><span class="op" id="3680496">,</span>&nbsp;<span class="builtintype" id="3680498">error</span><span class="op" id="3680503">)</span>&nbsp;<span class="op" id="3680505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680509">return</span>&nbsp;<span class="ident" id="3680516">dialSingle</span><span class="op" id="3680526">(</span><span class="ident" id="3680527">network</span><span class="op" id="3680534">,</span>&nbsp;<span class="ident" id="3680536">address</span><span class="op" id="3680543">,</span>&nbsp;<span class="ident" id="3680545">d</span><span class="op" id="3680546">.</span><span class="ident" id="3680547">LocalAddr</span><span class="op" id="3680556">,</span>&nbsp;<span class="ident" id="3680558">ra</span><span class="op" id="3680560">.</span><span class="ident" id="3680561">toAddr</span><span class="op" id="3680567">(</span><span class="op" id="3680568">)</span><span class="op" id="3680569">,</span>&nbsp;<span class="ident" id="3680571">deadline</span><span class="op" id="3680579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3680582">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680585">if</span>&nbsp;<span class="ident" id="3680588">ras</span><span class="op" id="3680591">,</span>&nbsp;<span class="ident" id="3680593">ok</span>&nbsp;<span class="op" id="3680596">:=</span>&nbsp;<span class="ident" id="3680599">ra</span><span class="op" id="3680601">.</span><span class="op" id="3680602">(</span><span class="ident" id="3680603">addrList</span><span class="op" id="3680611">)</span><span class="op" id="3680612">;</span>&nbsp;<span class="ident" id="3680614">ok</span>&nbsp;<span class="op" id="3680617">&amp;&amp;</span>&nbsp;<span class="ident" id="3680620">d</span><span class="op" id="3680621">.</span><span class="ident" id="3680622">DualStack</span>&nbsp;<span class="op" id="3680632">&amp;&amp;</span>&nbsp;<span class="ident" id="3680635">network</span>&nbsp;<span class="op" id="3680643">==</span>&nbsp;<span class="string" id="3680646">&#34;tcp&#34;</span>&nbsp;<span class="op" id="3680652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680656">dialer</span>&nbsp;<span class="op" id="3680663">=</span>&nbsp;<span class="keyword" id="3680665">func</span><span class="op" id="3680669">(</span><span class="ident" id="3680670">deadline</span>&nbsp;<span class="ident" id="3680679">time</span><span class="op" id="3680683">.</span><span class="ident" id="3680684">Time</span><span class="op" id="3680688">)</span>&nbsp;<span class="op" id="3680690">(</span><span class="ident" id="3680691">Conn</span><span class="op" id="3680695">,</span>&nbsp;<span class="builtintype" id="3680697">error</span><span class="op" id="3680702">)</span>&nbsp;<span class="op" id="3680704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680709">return</span>&nbsp;<span class="ident" id="3680716">dialMulti</span><span class="op" id="3680725">(</span><span class="ident" id="3680726">network</span><span class="op" id="3680733">,</span>&nbsp;<span class="ident" id="3680735">address</span><span class="op" id="3680742">,</span>&nbsp;<span class="ident" id="3680744">d</span><span class="op" id="3680745">.</span><span class="ident" id="3680746">LocalAddr</span><span class="op" id="3680755">,</span>&nbsp;<span class="ident" id="3680757">ras</span><span class="op" id="3680760">,</span>&nbsp;<span class="ident" id="3680762">deadline</span><span class="op" id="3680770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3680774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3680777">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680780">c</span><span class="op" id="3680781">,</span>&nbsp;<span class="ident" id="3680783">err</span>&nbsp;<span class="op" id="3680787">:=</span>&nbsp;<span class="ident" id="3680790">dial</span><span class="op" id="3680794">(</span><span class="ident" id="3680795">network</span><span class="op" id="3680802">,</span>&nbsp;<span class="ident" id="3680804">ra</span><span class="op" id="3680806">.</span><span class="ident" id="3680807">toAddr</span><span class="op" id="3680813">(</span><span class="op" id="3680814">)</span><span class="op" id="3680815">,</span>&nbsp;<span class="ident" id="3680817">dialer</span><span class="op" id="3680823">,</span>&nbsp;<span class="ident" id="3680825">d</span><span class="op" id="3680826">.</span><span class="ident" id="3680827">deadline</span><span class="op" id="3680835">(</span><span class="op" id="3680836">)</span><span class="op" id="3680837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680840">if</span>&nbsp;<span class="ident" id="3680843">d</span><span class="op" id="3680844">.</span><span class="ident" id="3680845">KeepAlive</span>&nbsp;<span class="op" id="3680855">&gt;</span>&nbsp;<span class="num" id="3680857">0</span>&nbsp;<span class="op" id="3680859">&amp;&amp;</span>&nbsp;<span class="ident" id="3680862">err</span>&nbsp;<span class="op" id="3680866">==</span>&nbsp;<span class="builtintype" id="3680869">nil</span>&nbsp;<span class="op" id="3680873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680877">if</span>&nbsp;<span class="ident" id="3680880">tc</span><span class="op" id="3680882">,</span>&nbsp;<span class="ident" id="3680884">ok</span>&nbsp;<span class="op" id="3680887">:=</span>&nbsp;<span class="ident" id="3680890">c</span><span class="op" id="3680891">.</span><span class="op" id="3680892">(</span><span class="op" id="3680893">*</span><span class="ident" id="3680894">TCPConn</span><span class="op" id="3680901">)</span><span class="op" id="3680902">;</span>&nbsp;<span class="ident" id="3680904">ok</span>&nbsp;<span class="op" id="3680907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680912">tc</span><span class="op" id="3680914">.</span><span class="ident" id="3680915">SetKeepAlive</span><span class="op" id="3680927">(</span><span class="builtintype" id="3680928">true</span><span class="op" id="3680932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680937">tc</span><span class="op" id="3680939">.</span><span class="ident" id="3680940">SetKeepAlivePeriod</span><span class="op" id="3680958">(</span><span class="ident" id="3680959">d</span><span class="op" id="3680960">.</span><span class="ident" id="3680961">KeepAlive</span><span class="op" id="3680970">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680975">testHookSetKeepAlive</span><span class="op" id="3680995">(</span><span class="op" id="3680996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3681000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3681003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681006">return</span>&nbsp;<span class="ident" id="3681013">c</span><span class="op" id="3681014">,</span>&nbsp;<span class="ident" id="3681016">err</span><br>
<span class="lineno"></span><span class="op" id="3681020">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="3681023">var</span>&nbsp;<span class="ident" id="3681027">testHookSetKeepAlive</span>&nbsp;<span class="op" id="3681048">=</span>&nbsp;<span class="keyword" id="3681050">func</span><span class="op" id="3681054">(</span><span class="op" id="3681055">)</span>&nbsp;<span class="op" id="3681057">{</span><span class="op" id="3681058">}</span>&nbsp;<span class="comment" id="3681060">//&nbsp;changed&nbsp;by&nbsp;dial_test.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3681088">//&nbsp;dialMulti&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;connections&nbsp;to&nbsp;each&nbsp;destination&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3681158">//&nbsp;the&nbsp;list&nbsp;of&nbsp;addresses.&nbsp;It&nbsp;will&nbsp;return&nbsp;the&nbsp;first&nbsp;established</span><br>
<span class="lineno">185</span><span class="comment" id="3681221">//&nbsp;connection&nbsp;and&nbsp;close&nbsp;the&nbsp;other&nbsp;connections.&nbsp;Otherwise&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3681289">//&nbsp;error&nbsp;on&nbsp;the&nbsp;last&nbsp;attempt.</span><br>
<span class="lineno"></span><span class="keyword" id="3681319">func</span>&nbsp;<span class="ident" id="3681324">dialMulti</span><span class="op" id="3681333">(</span><span class="ident" id="3681334">net</span><span class="op" id="3681337">,</span>&nbsp;<span class="ident" id="3681339">addr</span>&nbsp;<span class="builtintype" id="3681344">string</span><span class="op" id="3681350">,</span>&nbsp;<span class="ident" id="3681352">la</span>&nbsp;<span class="ident" id="3681355">Addr</span><span class="op" id="3681359">,</span>&nbsp;<span class="ident" id="3681361">ras</span>&nbsp;<span class="ident" id="3681365">addrList</span><span class="op" id="3681373">,</span>&nbsp;<span class="ident" id="3681375">deadline</span>&nbsp;<span class="ident" id="3681384">time</span><span class="op" id="3681388">.</span><span class="ident" id="3681389">Time</span><span class="op" id="3681393">)</span>&nbsp;<span class="op" id="3681395">(</span><span class="ident" id="3681396">Conn</span><span class="op" id="3681400">,</span>&nbsp;<span class="builtintype" id="3681402">error</span><span class="op" id="3681407">)</span>&nbsp;<span class="op" id="3681409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681412">type</span>&nbsp;<span class="ident" id="3681417">racer</span>&nbsp;<span class="keyword" id="3681423">struct</span>&nbsp;<span class="op" id="3681430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681434">Conn</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3681441">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3681448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3681451">//&nbsp;Sig&nbsp;controls&nbsp;the&nbsp;flow&nbsp;of&nbsp;dial&nbsp;results&nbsp;on&nbsp;lane.&nbsp;It&nbsp;passes&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3681514">//&nbsp;token&nbsp;to&nbsp;the&nbsp;next&nbsp;racer&nbsp;and&nbsp;also&nbsp;indicates&nbsp;the&nbsp;end&nbsp;of&nbsp;flow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3681577">//&nbsp;by&nbsp;using&nbsp;closed&nbsp;channel.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681606">sig</span>&nbsp;<span class="op" id="3681610">:=</span>&nbsp;<span class="builtinfunc" id="3681613">make</span><span class="op" id="3681617">(</span><span class="keyword" id="3681618">chan</span>&nbsp;<span class="builtintype" id="3681623">bool</span><span class="op" id="3681627">,</span>&nbsp;<span class="num" id="3681629">1</span><span class="op" id="3681630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681633">lane</span>&nbsp;<span class="op" id="3681638">:=</span>&nbsp;<span class="builtinfunc" id="3681641">make</span><span class="op" id="3681645">(</span><span class="keyword" id="3681646">chan</span>&nbsp;<span class="ident" id="3681651">racer</span><span class="op" id="3681656">,</span>&nbsp;<span class="num" id="3681658">1</span><span class="op" id="3681659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681662">for</span>&nbsp;<span class="ident" id="3681666">_</span><span class="op" id="3681667">,</span>&nbsp;<span class="ident" id="3681669">ra</span>&nbsp;<span class="op" id="3681672">:=</span>&nbsp;<span class="keyword" id="3681675">range</span>&nbsp;<span class="ident" id="3681681">ras</span>&nbsp;<span class="op" id="3681685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681689">go</span>&nbsp;<span class="keyword" id="3681692">func</span><span class="op" id="3681696">(</span><span class="ident" id="3681697">ra</span>&nbsp;<span class="ident" id="3681700">Addr</span><span class="op" id="3681704">)</span>&nbsp;<span class="op" id="3681706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681711">c</span><span class="op" id="3681712">,</span>&nbsp;<span class="ident" id="3681714">err</span>&nbsp;<span class="op" id="3681718">:=</span>&nbsp;<span class="ident" id="3681721">dialSingle</span><span class="op" id="3681731">(</span><span class="ident" id="3681732">net</span><span class="op" id="3681735">,</span>&nbsp;<span class="ident" id="3681737">addr</span><span class="op" id="3681741">,</span>&nbsp;<span class="ident" id="3681743">la</span><span class="op" id="3681745">,</span>&nbsp;<span class="ident" id="3681747">ra</span><span class="op" id="3681749">,</span>&nbsp;<span class="ident" id="3681751">deadline</span><span class="op" id="3681759">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681764">if</span>&nbsp;<span class="ident" id="3681767">_</span><span class="op" id="3681768">,</span>&nbsp;<span class="ident" id="3681770">ok</span>&nbsp;<span class="op" id="3681773">:=</span>&nbsp;<span class="op" id="3681776">&lt;-</span><span class="ident" id="3681778">sig</span><span class="op" id="3681781">;</span>&nbsp;<span class="ident" id="3681783">ok</span>&nbsp;<span class="op" id="3681786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681792">lane</span>&nbsp;<span class="op" id="3681797">&lt;-</span>&nbsp;<span class="ident" id="3681800">racer</span><span class="op" id="3681805">{</span><span class="ident" id="3681806">c</span><span class="op" id="3681807">,</span>&nbsp;<span class="ident" id="3681809">err</span><span class="op" id="3681812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3681817">}</span>&nbsp;<span class="keyword" id="3681819">else</span>&nbsp;<span class="keyword" id="3681824">if</span>&nbsp;<span class="ident" id="3681827">err</span>&nbsp;<span class="op" id="3681831">==</span>&nbsp;<span class="builtintype" id="3681834">nil</span>&nbsp;<span class="op" id="3681838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3681844">//&nbsp;We&nbsp;have&nbsp;to&nbsp;return&nbsp;the&nbsp;resources</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3681883">//&nbsp;that&nbsp;belong&nbsp;to&nbsp;the&nbsp;other</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3681915">//&nbsp;connections&nbsp;here&nbsp;for&nbsp;avoiding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3681952">//&nbsp;unnecessary&nbsp;resource&nbsp;starvation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681992">c</span><span class="op" id="3681993">.</span><span class="ident" id="3681994">Close</span><span class="op" id="3681999">(</span><span class="op" id="3682000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3682005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3682009">}</span><span class="op" id="3682010">(</span><span class="ident" id="3682011">ra</span><span class="op" id="3682013">.</span><span class="ident" id="3682014">toAddr</span><span class="op" id="3682020">(</span><span class="op" id="3682021">)</span><span class="op" id="3682022">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3682025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682028">defer</span>&nbsp;<span class="builtinfunc" id="3682034">close</span><span class="op" id="3682039">(</span><span class="ident" id="3682040">sig</span><span class="op" id="3682043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682046">lastErr</span>&nbsp;<span class="op" id="3682054">:=</span>&nbsp;<span class="ident" id="3682057">errTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682069">nracers</span>&nbsp;<span class="op" id="3682077">:=</span>&nbsp;<span class="builtinfunc" id="3682080">len</span><span class="op" id="3682083">(</span><span class="ident" id="3682084">ras</span><span class="op" id="3682087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682090">for</span>&nbsp;<span class="ident" id="3682094">nracers</span>&nbsp;<span class="op" id="3682102">&gt;</span>&nbsp;<span class="num" id="3682104">0</span>&nbsp;<span class="op" id="3682106">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682110">sig</span>&nbsp;<span class="op" id="3682114">&lt;-</span>&nbsp;<span class="builtintype" id="3682117">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682124">racer</span>&nbsp;<span class="op" id="3682130">:=</span>&nbsp;<span class="op" id="3682133">&lt;-</span><span class="ident" id="3682135">lane</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682142">if</span>&nbsp;<span class="ident" id="3682145">racer</span><span class="op" id="3682150">.</span><span class="builtintype" id="3682151">error</span>&nbsp;<span class="op" id="3682157">==</span>&nbsp;<span class="builtintype" id="3682160">nil</span>&nbsp;<span class="op" id="3682164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682169">return</span>&nbsp;<span class="ident" id="3682176">racer</span><span class="op" id="3682181">.</span><span class="ident" id="3682182">Conn</span><span class="op" id="3682186">,</span>&nbsp;<span class="builtintype" id="3682188">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3682194">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682198">lastErr</span>&nbsp;<span class="op" id="3682206">=</span>&nbsp;<span class="ident" id="3682208">racer</span><span class="op" id="3682213">.</span><span class="builtintype" id="3682214">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682222">nracers</span><span class="op" id="3682229">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3682233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682236">return</span>&nbsp;<span class="builtintype" id="3682243">nil</span><span class="op" id="3682246">,</span>&nbsp;<span class="ident" id="3682248">lastErr</span><br>
<span class="lineno"></span><span class="op" id="3682256">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="3682259">//&nbsp;dialSingle&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;connection&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3682330">//&nbsp;the&nbsp;destination&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3682358">func</span>&nbsp;<span class="ident" id="3682363">dialSingle</span><span class="op" id="3682373">(</span><span class="ident" id="3682374">net</span><span class="op" id="3682377">,</span>&nbsp;<span class="ident" id="3682379">addr</span>&nbsp;<span class="builtintype" id="3682384">string</span><span class="op" id="3682390">,</span>&nbsp;<span class="ident" id="3682392">la</span><span class="op" id="3682394">,</span>&nbsp;<span class="ident" id="3682396">ra</span>&nbsp;<span class="ident" id="3682399">Addr</span><span class="op" id="3682403">,</span>&nbsp;<span class="ident" id="3682405">deadline</span>&nbsp;<span class="ident" id="3682414">time</span><span class="op" id="3682418">.</span><span class="ident" id="3682419">Time</span><span class="op" id="3682423">)</span>&nbsp;<span class="op" id="3682425">(</span><span class="ident" id="3682426">c</span>&nbsp;<span class="ident" id="3682428">Conn</span><span class="op" id="3682432">,</span>&nbsp;<span class="ident" id="3682434">err</span>&nbsp;<span class="builtintype" id="3682438">error</span><span class="op" id="3682443">)</span>&nbsp;<span class="op" id="3682445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682448">if</span>&nbsp;<span class="ident" id="3682451">la</span>&nbsp;<span class="op" id="3682454">!=</span>&nbsp;<span class="builtintype" id="3682457">nil</span>&nbsp;<span class="op" id="3682461">&amp;&amp;</span>&nbsp;<span class="ident" id="3682464">la</span><span class="op" id="3682466">.</span><span class="ident" id="3682467">Network</span><span class="op" id="3682474">(</span><span class="op" id="3682475">)</span>&nbsp;<span class="op" id="3682477">!=</span>&nbsp;<span class="ident" id="3682480">ra</span><span class="op" id="3682482">.</span><span class="ident" id="3682483">Network</span><span class="op" id="3682490">(</span><span class="op" id="3682491">)</span>&nbsp;<span class="op" id="3682493">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682497">return</span>&nbsp;<span class="builtintype" id="3682504">nil</span><span class="op" id="3682507">,</span>&nbsp;<span class="op" id="3682509">&amp;</span><span class="ident" id="3682510">OpError</span><span class="op" id="3682517">{</span><span class="ident" id="3682518">Op</span><span class="op" id="3682520">:</span>&nbsp;<span class="string" id="3682522">&#34;dial&#34;</span><span class="op" id="3682528">,</span>&nbsp;<span class="ident" id="3682530">Net</span><span class="op" id="3682533">:</span>&nbsp;<span class="ident" id="3682535">net</span><span class="op" id="3682538">,</span>&nbsp;<span class="ident" id="3682540">Addr</span><span class="op" id="3682544">:</span>&nbsp;<span class="ident" id="3682546">ra</span><span class="op" id="3682548">,</span>&nbsp;<span class="ident" id="3682550">Err</span><span class="op" id="3682553">:</span>&nbsp;<span class="ident" id="3682555">errors</span><span class="op" id="3682561">.</span><span class="ident" id="3682562">New</span><span class="op" id="3682565">(</span><span class="string" id="3682566">&#34;mismatched&nbsp;local&nbsp;address&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3682599">+</span>&nbsp;<span class="ident" id="3682601">la</span><span class="op" id="3682603">.</span><span class="ident" id="3682604">Network</span><span class="op" id="3682611">(</span><span class="op" id="3682612">)</span><span class="op" id="3682613">)</span><span class="op" id="3682614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3682617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682620">switch</span>&nbsp;<span class="ident" id="3682627">ra</span>&nbsp;<span class="op" id="3682630">:=</span>&nbsp;<span class="ident" id="3682633">ra</span><span class="op" id="3682635">.</span><span class="op" id="3682636">(</span><span class="keyword" id="3682637">type</span><span class="op" id="3682641">)</span>&nbsp;<span class="op" id="3682643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682646">case</span>&nbsp;<span class="op" id="3682651">*</span><span class="ident" id="3682652">TCPAddr</span><span class="op" id="3682659">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682663">la</span><span class="op" id="3682665">,</span>&nbsp;<span class="ident" id="3682667">_</span>&nbsp;<span class="op" id="3682669">:=</span>&nbsp;<span class="ident" id="3682672">la</span><span class="op" id="3682674">.</span><span class="op" id="3682675">(</span><span class="op" id="3682676">*</span><span class="ident" id="3682677">TCPAddr</span><span class="op" id="3682684">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682688">c</span><span class="op" id="3682689">,</span>&nbsp;<span class="ident" id="3682691">err</span>&nbsp;<span class="op" id="3682695">=</span>&nbsp;<span class="ident" id="3682697">dialTCP</span><span class="op" id="3682704">(</span><span class="ident" id="3682705">net</span><span class="op" id="3682708">,</span>&nbsp;<span class="ident" id="3682710">la</span><span class="op" id="3682712">,</span>&nbsp;<span class="ident" id="3682714">ra</span><span class="op" id="3682716">,</span>&nbsp;<span class="ident" id="3682718">deadline</span><span class="op" id="3682726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682729">case</span>&nbsp;<span class="op" id="3682734">*</span><span class="ident" id="3682735">UDPAddr</span><span class="op" id="3682742">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682746">la</span><span class="op" id="3682748">,</span>&nbsp;<span class="ident" id="3682750">_</span>&nbsp;<span class="op" id="3682752">:=</span>&nbsp;<span class="ident" id="3682755">la</span><span class="op" id="3682757">.</span><span class="op" id="3682758">(</span><span class="op" id="3682759">*</span><span class="ident" id="3682760">UDPAddr</span><span class="op" id="3682767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682771">c</span><span class="op" id="3682772">,</span>&nbsp;<span class="ident" id="3682774">err</span>&nbsp;<span class="op" id="3682778">=</span>&nbsp;<span class="ident" id="3682780">dialUDP</span><span class="op" id="3682787">(</span><span class="ident" id="3682788">net</span><span class="op" id="3682791">,</span>&nbsp;<span class="ident" id="3682793">la</span><span class="op" id="3682795">,</span>&nbsp;<span class="ident" id="3682797">ra</span><span class="op" id="3682799">,</span>&nbsp;<span class="ident" id="3682801">deadline</span><span class="op" id="3682809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682812">case</span>&nbsp;<span class="op" id="3682817">*</span><span class="ident" id="3682818">IPAddr</span><span class="op" id="3682824">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682828">la</span><span class="op" id="3682830">,</span>&nbsp;<span class="ident" id="3682832">_</span>&nbsp;<span class="op" id="3682834">:=</span>&nbsp;<span class="ident" id="3682837">la</span><span class="op" id="3682839">.</span><span class="op" id="3682840">(</span><span class="op" id="3682841">*</span><span class="ident" id="3682842">IPAddr</span><span class="op" id="3682848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682852">c</span><span class="op" id="3682853">,</span>&nbsp;<span class="ident" id="3682855">err</span>&nbsp;<span class="op" id="3682859">=</span>&nbsp;<span class="ident" id="3682861">dialIP</span><span class="op" id="3682867">(</span><span class="ident" id="3682868">net</span><span class="op" id="3682871">,</span>&nbsp;<span class="ident" id="3682873">la</span><span class="op" id="3682875">,</span>&nbsp;<span class="ident" id="3682877">ra</span><span class="op" id="3682879">,</span>&nbsp;<span class="ident" id="3682881">deadline</span><span class="op" id="3682889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682892">case</span>&nbsp;<span class="op" id="3682897">*</span><span class="ident" id="3682898">UnixAddr</span><span class="op" id="3682906">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682910">la</span><span class="op" id="3682912">,</span>&nbsp;<span class="ident" id="3682914">_</span>&nbsp;<span class="op" id="3682916">:=</span>&nbsp;<span class="ident" id="3682919">la</span><span class="op" id="3682921">.</span><span class="op" id="3682922">(</span><span class="op" id="3682923">*</span><span class="ident" id="3682924">UnixAddr</span><span class="op" id="3682932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682936">c</span><span class="op" id="3682937">,</span>&nbsp;<span class="ident" id="3682939">err</span>&nbsp;<span class="op" id="3682943">=</span>&nbsp;<span class="ident" id="3682945">dialUnix</span><span class="op" id="3682953">(</span><span class="ident" id="3682954">net</span><span class="op" id="3682957">,</span>&nbsp;<span class="ident" id="3682959">la</span><span class="op" id="3682961">,</span>&nbsp;<span class="ident" id="3682963">ra</span><span class="op" id="3682965">,</span>&nbsp;<span class="ident" id="3682967">deadline</span><span class="op" id="3682975">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682978">default</span><span class="op" id="3682985">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682989">return</span>&nbsp;<span class="builtintype" id="3682996">nil</span><span class="op" id="3682999">,</span>&nbsp;<span class="op" id="3683001">&amp;</span><span class="ident" id="3683002">OpError</span><span class="op" id="3683009">{</span><span class="ident" id="3683010">Op</span><span class="op" id="3683012">:</span>&nbsp;<span class="string" id="3683014">&#34;dial&#34;</span><span class="op" id="3683020">,</span>&nbsp;<span class="ident" id="3683022">Net</span><span class="op" id="3683025">:</span>&nbsp;<span class="ident" id="3683027">net</span><span class="op" id="3683030">,</span>&nbsp;<span class="ident" id="3683032">Addr</span><span class="op" id="3683036">:</span>&nbsp;<span class="ident" id="3683038">ra</span><span class="op" id="3683040">,</span>&nbsp;<span class="ident" id="3683042">Err</span><span class="op" id="3683045">:</span>&nbsp;<span class="op" id="3683047">&amp;</span><span class="ident" id="3683048">AddrError</span><span class="op" id="3683057">{</span><span class="ident" id="3683058">Err</span><span class="op" id="3683061">:</span>&nbsp;<span class="string" id="3683063">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3683088">,</span>&nbsp;<span class="ident" id="3683090">Addr</span><span class="op" id="3683094">:</span>&nbsp;<span class="ident" id="3683096">addr</span><span class="op" id="3683100">}</span><span class="op" id="3683101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3683104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683107">if</span>&nbsp;<span class="ident" id="3683110">err</span>&nbsp;<span class="op" id="3683114">!=</span>&nbsp;<span class="builtintype" id="3683117">nil</span>&nbsp;<span class="op" id="3683121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683125">return</span>&nbsp;<span class="builtintype" id="3683132">nil</span><span class="op" id="3683135">,</span>&nbsp;<span class="ident" id="3683137">err</span>&nbsp;<span class="comment" id="3683141">//&nbsp;c&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3683191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683194">return</span>&nbsp;<span class="ident" id="3683201">c</span><span class="op" id="3683202">,</span>&nbsp;<span class="builtintype" id="3683204">nil</span><br>
<span class="lineno"></span><span class="op" id="3683208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3683211">//&nbsp;Listen&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno">255</span><span class="comment" id="3683267">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;stream-oriented&nbsp;network:&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3683336">//&nbsp;&#34;tcp6&#34;,&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3683371">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3683408">func</span>&nbsp;<span class="ident" id="3683413">Listen</span><span class="op" id="3683419">(</span><span class="ident" id="3683420">net</span><span class="op" id="3683423">,</span>&nbsp;<span class="ident" id="3683425">laddr</span>&nbsp;<span class="builtintype" id="3683431">string</span><span class="op" id="3683437">)</span>&nbsp;<span class="op" id="3683439">(</span><span class="ident" id="3683440">Listener</span><span class="op" id="3683448">,</span>&nbsp;<span class="builtintype" id="3683450">error</span><span class="op" id="3683455">)</span>&nbsp;<span class="op" id="3683457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3683460">la</span><span class="op" id="3683462">,</span>&nbsp;<span class="ident" id="3683464">err</span>&nbsp;<span class="op" id="3683468">:=</span>&nbsp;<span class="ident" id="3683471">resolveAddr</span><span class="op" id="3683482">(</span><span class="string" id="3683483">&#34;listen&#34;</span><span class="op" id="3683491">,</span>&nbsp;<span class="ident" id="3683493">net</span><span class="op" id="3683496">,</span>&nbsp;<span class="ident" id="3683498">laddr</span><span class="op" id="3683503">,</span>&nbsp;<span class="ident" id="3683505">noDeadline</span><span class="op" id="3683515">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683518">if</span>&nbsp;<span class="ident" id="3683521">err</span>&nbsp;<span class="op" id="3683525">!=</span>&nbsp;<span class="builtintype" id="3683528">nil</span>&nbsp;<span class="op" id="3683532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683536">return</span>&nbsp;<span class="builtintype" id="3683543">nil</span><span class="op" id="3683546">,</span>&nbsp;<span class="op" id="3683548">&amp;</span><span class="ident" id="3683549">OpError</span><span class="op" id="3683556">{</span><span class="ident" id="3683557">Op</span><span class="op" id="3683559">:</span>&nbsp;<span class="string" id="3683561">&#34;listen&#34;</span><span class="op" id="3683569">,</span>&nbsp;<span class="ident" id="3683571">Net</span><span class="op" id="3683574">:</span>&nbsp;<span class="ident" id="3683576">net</span><span class="op" id="3683579">,</span>&nbsp;<span class="ident" id="3683581">Addr</span><span class="op" id="3683585">:</span>&nbsp;<span class="builtintype" id="3683587">nil</span><span class="op" id="3683590">,</span>&nbsp;<span class="ident" id="3683592">Err</span><span class="op" id="3683595">:</span>&nbsp;<span class="ident" id="3683597">err</span><span class="op" id="3683600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3683603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683606">var</span>&nbsp;<span class="ident" id="3683610">l</span>&nbsp;<span class="ident" id="3683612">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683622">switch</span>&nbsp;<span class="ident" id="3683629">la</span>&nbsp;<span class="op" id="3683632">:=</span>&nbsp;<span class="ident" id="3683635">la</span><span class="op" id="3683637">.</span><span class="ident" id="3683638">toAddr</span><span class="op" id="3683644">(</span><span class="op" id="3683645">)</span><span class="op" id="3683646">.</span><span class="op" id="3683647">(</span><span class="keyword" id="3683648">type</span><span class="op" id="3683652">)</span>&nbsp;<span class="op" id="3683654">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683657">case</span>&nbsp;<span class="op" id="3683662">*</span><span class="ident" id="3683663">TCPAddr</span><span class="op" id="3683670">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3683674">l</span><span class="op" id="3683675">,</span>&nbsp;<span class="ident" id="3683677">err</span>&nbsp;<span class="op" id="3683681">=</span>&nbsp;<span class="ident" id="3683683">ListenTCP</span><span class="op" id="3683692">(</span><span class="ident" id="3683693">net</span><span class="op" id="3683696">,</span>&nbsp;<span class="ident" id="3683698">la</span><span class="op" id="3683700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683703">case</span>&nbsp;<span class="op" id="3683708">*</span><span class="ident" id="3683709">UnixAddr</span><span class="op" id="3683717">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3683721">l</span><span class="op" id="3683722">,</span>&nbsp;<span class="ident" id="3683724">err</span>&nbsp;<span class="op" id="3683728">=</span>&nbsp;<span class="ident" id="3683730">ListenUnix</span><span class="op" id="3683740">(</span><span class="ident" id="3683741">net</span><span class="op" id="3683744">,</span>&nbsp;<span class="ident" id="3683746">la</span><span class="op" id="3683748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683751">default</span><span class="op" id="3683758">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683762">return</span>&nbsp;<span class="builtintype" id="3683769">nil</span><span class="op" id="3683772">,</span>&nbsp;<span class="op" id="3683774">&amp;</span><span class="ident" id="3683775">OpError</span><span class="op" id="3683782">{</span><span class="ident" id="3683783">Op</span><span class="op" id="3683785">:</span>&nbsp;<span class="string" id="3683787">&#34;listen&#34;</span><span class="op" id="3683795">,</span>&nbsp;<span class="ident" id="3683797">Net</span><span class="op" id="3683800">:</span>&nbsp;<span class="ident" id="3683802">net</span><span class="op" id="3683805">,</span>&nbsp;<span class="ident" id="3683807">Addr</span><span class="op" id="3683811">:</span>&nbsp;<span class="ident" id="3683813">la</span><span class="op" id="3683815">,</span>&nbsp;<span class="ident" id="3683817">Err</span><span class="op" id="3683820">:</span>&nbsp;<span class="op" id="3683822">&amp;</span><span class="ident" id="3683823">AddrError</span><span class="op" id="3683832">{</span><span class="ident" id="3683833">Err</span><span class="op" id="3683836">:</span>&nbsp;<span class="string" id="3683838">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3683863">,</span>&nbsp;<span class="ident" id="3683865">Addr</span><span class="op" id="3683869">:</span>&nbsp;<span class="ident" id="3683871">laddr</span><span class="op" id="3683876">}</span><span class="op" id="3683877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3683880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683883">if</span>&nbsp;<span class="ident" id="3683886">err</span>&nbsp;<span class="op" id="3683890">!=</span>&nbsp;<span class="builtintype" id="3683893">nil</span>&nbsp;<span class="op" id="3683897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683901">return</span>&nbsp;<span class="builtintype" id="3683908">nil</span><span class="op" id="3683911">,</span>&nbsp;<span class="ident" id="3683913">err</span>&nbsp;<span class="comment" id="3683917">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3683967">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683970">return</span>&nbsp;<span class="ident" id="3683977">l</span><span class="op" id="3683978">,</span>&nbsp;<span class="builtintype" id="3683980">nil</span><br>
<span class="lineno"></span><span class="op" id="3683984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3683987">//&nbsp;ListenPacket&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="comment" id="3684049">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;packet-oriented&nbsp;network:&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,</span><br>
<span class="lineno">280</span><span class="comment" id="3684118">//&nbsp;&#34;udp6&#34;,&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;,&nbsp;&#34;ip6&#34;&nbsp;or&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3684163">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3684200">func</span>&nbsp;<span class="ident" id="3684205">ListenPacket</span><span class="op" id="3684217">(</span><span class="ident" id="3684218">net</span><span class="op" id="3684221">,</span>&nbsp;<span class="ident" id="3684223">laddr</span>&nbsp;<span class="builtintype" id="3684229">string</span><span class="op" id="3684235">)</span>&nbsp;<span class="op" id="3684237">(</span><span class="ident" id="3684238">PacketConn</span><span class="op" id="3684248">,</span>&nbsp;<span class="builtintype" id="3684250">error</span><span class="op" id="3684255">)</span>&nbsp;<span class="op" id="3684257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3684260">la</span><span class="op" id="3684262">,</span>&nbsp;<span class="ident" id="3684264">err</span>&nbsp;<span class="op" id="3684268">:=</span>&nbsp;<span class="ident" id="3684271">resolveAddr</span><span class="op" id="3684282">(</span><span class="string" id="3684283">&#34;listen&#34;</span><span class="op" id="3684291">,</span>&nbsp;<span class="ident" id="3684293">net</span><span class="op" id="3684296">,</span>&nbsp;<span class="ident" id="3684298">laddr</span><span class="op" id="3684303">,</span>&nbsp;<span class="ident" id="3684305">noDeadline</span><span class="op" id="3684315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3684318">if</span>&nbsp;<span class="ident" id="3684321">err</span>&nbsp;<span class="op" id="3684325">!=</span>&nbsp;<span class="builtintype" id="3684328">nil</span>&nbsp;<span class="op" id="3684332">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3684336">return</span>&nbsp;<span class="builtintype" id="3684343">nil</span><span class="op" id="3684346">,</span>&nbsp;<span class="op" id="3684348">&amp;</span><span class="ident" id="3684349">OpError</span><span class="op" id="3684356">{</span><span class="ident" id="3684357">Op</span><span class="op" id="3684359">:</span>&nbsp;<span class="string" id="3684361">&#34;listen&#34;</span><span class="op" id="3684369">,</span>&nbsp;<span class="ident" id="3684371">Net</span><span class="op" id="3684374">:</span>&nbsp;<span class="ident" id="3684376">net</span><span class="op" id="3684379">,</span>&nbsp;<span class="ident" id="3684381">Addr</span><span class="op" id="3684385">:</span>&nbsp;<span class="builtintype" id="3684387">nil</span><span class="op" id="3684390">,</span>&nbsp;<span class="ident" id="3684392">Err</span><span class="op" id="3684395">:</span>&nbsp;<span class="ident" id="3684397">err</span><span class="op" id="3684400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3684403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3684406">var</span>&nbsp;<span class="ident" id="3684410">l</span>&nbsp;<span class="ident" id="3684412">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3684424">switch</span>&nbsp;<span class="ident" id="3684431">la</span>&nbsp;<span class="op" id="3684434">:=</span>&nbsp;<span class="ident" id="3684437">la</span><span class="op" id="3684439">.</span><span class="ident" id="3684440">toAddr</span><span class="op" id="3684446">(</span><span class="op" id="3684447">)</span><span class="op" id="3684448">.</span><span class="op" id="3684449">(</span><span class="keyword" id="3684450">type</span><span class="op" id="3684454">)</span>&nbsp;<span class="op" id="3684456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3684459">case</span>&nbsp;<span class="op" id="3684464">*</span><span class="ident" id="3684465">UDPAddr</span><span class="op" id="3684472">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3684476">l</span><span class="op" id="3684477">,</span>&nbsp;<span class="ident" id="3684479">err</span>&nbsp;<span class="op" id="3684483">=</span>&nbsp;<span class="ident" id="3684485">ListenUDP</span><span class="op" id="3684494">(</span><span class="ident" id="3684495">net</span><span class="op" id="3684498">,</span>&nbsp;<span class="ident" id="3684500">la</span><span class="op" id="3684502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3684505">case</span>&nbsp;<span class="op" id="3684510">*</span><span class="ident" id="3684511">IPAddr</span><span class="op" id="3684517">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3684521">l</span><span class="op" id="3684522">,</span>&nbsp;<span class="ident" id="3684524">err</span>&nbsp;<span class="op" id="3684528">=</span>&nbsp;<span class="ident" id="3684530">ListenIP</span><span class="op" id="3684538">(</span><span class="ident" id="3684539">net</span><span class="op" id="3684542">,</span>&nbsp;<span class="ident" id="3684544">la</span><span class="op" id="3684546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3684549">case</span>&nbsp;<span class="op" id="3684554">*</span><span class="ident" id="3684555">UnixAddr</span><span class="op" id="3684563">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3684567">l</span><span class="op" id="3684568">,</span>&nbsp;<span class="ident" id="3684570">err</span>&nbsp;<span class="op" id="3684574">=</span>&nbsp;<span class="ident" id="3684576">ListenUnixgram</span><span class="op" id="3684590">(</span><span class="ident" id="3684591">net</span><span class="op" id="3684594">,</span>&nbsp;<span class="ident" id="3684596">la</span><span class="op" id="3684598">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3684601">default</span><span class="op" id="3684608">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3684612">return</span>&nbsp;<span class="builtintype" id="3684619">nil</span><span class="op" id="3684622">,</span>&nbsp;<span class="op" id="3684624">&amp;</span><span class="ident" id="3684625">OpError</span><span class="op" id="3684632">{</span><span class="ident" id="3684633">Op</span><span class="op" id="3684635">:</span>&nbsp;<span class="string" id="3684637">&#34;listen&#34;</span><span class="op" id="3684645">,</span>&nbsp;<span class="ident" id="3684647">Net</span><span class="op" id="3684650">:</span>&nbsp;<span class="ident" id="3684652">net</span><span class="op" id="3684655">,</span>&nbsp;<span class="ident" id="3684657">Addr</span><span class="op" id="3684661">:</span>&nbsp;<span class="ident" id="3684663">la</span><span class="op" id="3684665">,</span>&nbsp;<span class="ident" id="3684667">Err</span><span class="op" id="3684670">:</span>&nbsp;<span class="op" id="3684672">&amp;</span><span class="ident" id="3684673">AddrError</span><span class="op" id="3684682">{</span><span class="ident" id="3684683">Err</span><span class="op" id="3684686">:</span>&nbsp;<span class="string" id="3684688">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3684713">,</span>&nbsp;<span class="ident" id="3684715">Addr</span><span class="op" id="3684719">:</span>&nbsp;<span class="ident" id="3684721">laddr</span><span class="op" id="3684726">}</span><span class="op" id="3684727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3684730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3684733">if</span>&nbsp;<span class="ident" id="3684736">err</span>&nbsp;<span class="op" id="3684740">!=</span>&nbsp;<span class="builtintype" id="3684743">nil</span>&nbsp;<span class="op" id="3684747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3684751">return</span>&nbsp;<span class="builtintype" id="3684758">nil</span><span class="op" id="3684761">,</span>&nbsp;<span class="ident" id="3684763">err</span>&nbsp;<span class="comment" id="3684767">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3684817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3684820">return</span>&nbsp;<span class="ident" id="3684827">l</span><span class="op" id="3684828">,</span>&nbsp;<span class="builtintype" id="3684830">nil</span><br>
<span class="lineno"></span><span class="op" id="3684834">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
