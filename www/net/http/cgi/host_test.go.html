<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6997781">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6997836">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6997890">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6997941">//&nbsp;Tests&nbsp;for&nbsp;package&nbsp;cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6997967">package</span>&nbsp;<span class="ident" id="6997975">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6997980">import</span>&nbsp;<span class="op" id="6997987">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6997990">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6997999">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6998006">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6998012">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6998019">&#34;net/http&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6998031">&#34;net/http/httptest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6998052">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6998058">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6998069">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6998086">&#34;runtime&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6998097">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6998108">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6998119">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6998130">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6998137">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="6998140">func</span>&nbsp;<span class="ident" id="6998145">newRequest</span><span class="op" id="6998155">(</span><span class="ident" id="6998156">httpreq</span>&nbsp;<span class="builtintype" id="6998164">string</span><span class="op" id="6998170">)</span>&nbsp;<span class="op" id="6998172">*</span><span class="ident" id="6998173"><a href="/net/http/cgi/host_test.go.html#6998019">http</a></span><span class="op" id="6998177">.</span><span class="ident" id="6998178">Request</span>&nbsp;<span class="op" id="6998186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6998189">buf</span>&nbsp;<span class="op" id="6998193">:=</span>&nbsp;<span class="ident" id="6998196"><a href="/net/http/cgi/host_test.go.html#6997990">bufio</a></span><span class="op" id="6998201">.</span><span class="ident" id="6998202">NewReader</span><span class="op" id="6998211">(</span><span class="ident" id="6998212"><a href="/net/http/cgi/host_test.go.html#6998108">strings</a></span><span class="op" id="6998219">.</span><span class="ident" id="6998220">NewReader</span><span class="op" id="6998229">(</span><span class="ident" id="6998230"><a href="/net/http/cgi/host_test.go.html#6998156">httpreq</a></span><span class="op" id="6998237">)</span><span class="op" id="6998238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6998241">req</span><span class="op" id="6998244">,</span>&nbsp;<span class="ident" id="6998246">err</span>&nbsp;<span class="op" id="6998250">:=</span>&nbsp;<span class="ident" id="6998253"><a href="/net/http/cgi/host_test.go.html#6998019">http</a></span><span class="op" id="6998257">.</span><span class="ident" id="6998258">ReadRequest</span><span class="op" id="6998269">(</span><span class="ident" id="6998270"><a href="/net/http/cgi/host_test.go.html#6998189">buf</a></span><span class="op" id="6998273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6998276">if</span>&nbsp;<span class="ident" id="6998279"><a href="/net/http/cgi/host_test.go.html#6998246">err</a></span>&nbsp;<span class="op" id="6998283">!=</span>&nbsp;<span class="ident" id="6998286">nil</span>&nbsp;<span class="op" id="6998290">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6998294">panic</span><span class="op" id="6998299">(</span><span class="string" id="6998300">&#34;cgi:&nbsp;bogus&nbsp;http&nbsp;request&nbsp;in&nbsp;test:&nbsp;&#34;</span>&nbsp;<span class="op" id="6998336">+</span>&nbsp;<span class="ident" id="6998338"><a href="/net/http/cgi/host_test.go.html#6998156">httpreq</a></span><span class="op" id="6998345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6998348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6998351"><a href="/net/http/cgi/host_test.go.html#6998241">req</a></span><span class="op" id="6998354">.</span><span class="ident" id="6998355">RemoteAddr</span>&nbsp;<span class="op" id="6998366">=</span>&nbsp;<span class="string" id="6998368">&#34;1.2.3.4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6998379">return</span>&nbsp;<span class="ident" id="6998386"><a href="/net/http/cgi/host_test.go.html#6998241">req</a></span><br>
<span class="lineno"></span><span class="op" id="6998390">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="6998393">func</span>&nbsp;<span class="ident" id="6998398">runCgiTest</span><span class="op" id="6998408">(</span><span class="ident" id="6998409">t</span>&nbsp;<span class="op" id="6998411">*</span><span class="ident" id="6998412"><a href="/net/http/cgi/host_test.go.html#6998119">testing</a></span><span class="op" id="6998419">.</span><span class="ident" id="6998420">T</span><span class="op" id="6998421">,</span>&nbsp;<span class="ident" id="6998423">h</span>&nbsp;<span class="op" id="6998425">*</span><span class="ident" id="6998426"><a href="/net/http/cgi/host.go.html#6144504">Handler</a></span><span class="op" id="6998433">,</span>&nbsp;<span class="ident" id="6998435">httpreq</span>&nbsp;<span class="builtintype" id="6998443">string</span><span class="op" id="6998449">,</span>&nbsp;<span class="ident" id="6998451">expectedMap</span>&nbsp;<span class="keyword" id="6998463">map</span><span class="op" id="6998466">[</span><span class="builtintype" id="6998467">string</span><span class="op" id="6998473">]</span><span class="builtintype" id="6998474">string</span><span class="op" id="6998480">)</span>&nbsp;<span class="op" id="6998482">*</span><span class="ident" id="6998483"><a href="/net/http/cgi/host_test.go.html#6998031">httptest</a></span><span class="op" id="6998491">.</span><span class="ident" id="6998492">ResponseRecorder</span>&nbsp;<span class="op" id="6998509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6998512">rw</span>&nbsp;<span class="op" id="6998515">:=</span>&nbsp;<span class="ident" id="6998518"><a href="/net/http/cgi/host_test.go.html#6998031">httptest</a></span><span class="op" id="6998526">.</span><span class="ident" id="6998527">NewRecorder</span><span class="op" id="6998538">(</span><span class="op" id="6998539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6998542">req</span>&nbsp;<span class="op" id="6998546">:=</span>&nbsp;<span class="ident" id="6998549"><a href="/net/http/cgi/host_test.go.html#6998145">newRequest</a></span><span class="op" id="6998559">(</span><span class="ident" id="6998560"><a href="/net/http/cgi/host_test.go.html#6998435">httpreq</a></span><span class="op" id="6998567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6998570"><a href="/net/http/cgi/host_test.go.html#6998423">h</a></span><span class="op" id="6998571">.</span><span class="ident" id="6998572">ServeHTTP</span><span class="op" id="6998581">(</span><span class="ident" id="6998582"><a href="/net/http/cgi/host_test.go.html#6998512">rw</a></span><span class="op" id="6998584">,</span>&nbsp;<span class="ident" id="6998586"><a href="/net/http/cgi/host_test.go.html#6998542">req</a></span><span class="op" id="6998589">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6998593">//&nbsp;Make&nbsp;a&nbsp;map&nbsp;to&nbsp;hold&nbsp;the&nbsp;test&nbsp;map&nbsp;that&nbsp;the&nbsp;CGI&nbsp;returns.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6998651">m</span>&nbsp;<span class="op" id="6998653">:=</span>&nbsp;<span class="builtinfunc" id="6998656">make</span><span class="op" id="6998660">(</span><span class="keyword" id="6998661">map</span><span class="op" id="6998664">[</span><span class="builtintype" id="6998665">string</span><span class="op" id="6998671">]</span><span class="builtintype" id="6998672">string</span><span class="op" id="6998678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6998681"><a href="/net/http/cgi/host_test.go.html#6998651">m</a></span><span class="op" id="6998682">[</span><span class="string" id="6998683">&#34;_body&#34;</span><span class="op" id="6998690">]</span>&nbsp;<span class="op" id="6998692">=</span>&nbsp;<span class="ident" id="6998694"><a href="/net/http/cgi/host_test.go.html#6998512">rw</a></span><span class="op" id="6998696">.</span><span class="ident" id="6998697">Body</span><span class="op" id="6998701">.</span><span class="ident" id="6998702">String</span><span class="op" id="6998708">(</span><span class="op" id="6998709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6998712">linesRead</span>&nbsp;<span class="op" id="6998722">:=</span>&nbsp;<span class="num" id="6998725">0</span><br>
<span class="lineno">45</span><span class="ident" id="6998727">readlines</span><span class="op" id="6998736">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6998739">for</span>&nbsp;<span class="op" id="6998743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6998747">line</span><span class="op" id="6998751">,</span>&nbsp;<span class="ident" id="6998753">err</span>&nbsp;<span class="op" id="6998757">:=</span>&nbsp;<span class="ident" id="6998760"><a href="/net/http/cgi/host_test.go.html#6998512">rw</a></span><span class="op" id="6998762">.</span><span class="ident" id="6998763">Body</span><span class="op" id="6998767">.</span><span class="ident" id="6998768">ReadString</span><span class="op" id="6998778">(</span><span class="string" id="6998779">&#39;\n&#39;</span><span class="op" id="6998783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6998787">switch</span>&nbsp;<span class="op" id="6998794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6998798">case</span>&nbsp;<span class="ident" id="6998803"><a href="/net/http/cgi/host_test.go.html#6998753">err</a></span>&nbsp;<span class="op" id="6998807">==</span>&nbsp;<span class="ident" id="6998810"><a href="/net/http/cgi/host_test.go.html#6998006">io</a></span><span class="op" id="6998812">.</span><span class="ident" id="6998813">EOF</span><span class="op" id="6998816">:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6998821">break</span>&nbsp;<span class="ident" id="6998827">readlines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6998839">case</span>&nbsp;<span class="ident" id="6998844"><a href="/net/http/cgi/host_test.go.html#6998753">err</a></span>&nbsp;<span class="op" id="6998848">!=</span>&nbsp;<span class="ident" id="6998851">nil</span><span class="op" id="6998854">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6998859"><a href="/net/http/cgi/host_test.go.html#6998409">t</a></span><span class="op" id="6998860">.</span><span class="ident" id="6998861">Fatalf</span><span class="op" id="6998867">(</span><span class="string" id="6998868">&#34;unexpected&nbsp;error&nbsp;reading&nbsp;from&nbsp;CGI:&nbsp;%v&#34;</span><span class="op" id="6998907">,</span>&nbsp;<span class="ident" id="6998909"><a href="/net/http/cgi/host_test.go.html#6998753">err</a></span><span class="op" id="6998912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6998916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6998920"><a href="/net/http/cgi/host_test.go.html#6998712">linesRead</a></span><span class="op" id="6998929">++</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6998934">trimmedLine</span>&nbsp;<span class="op" id="6998946">:=</span>&nbsp;<span class="ident" id="6998949"><a href="/net/http/cgi/host_test.go.html#6998108">strings</a></span><span class="op" id="6998956">.</span><span class="ident" id="6998957">TrimRight</span><span class="op" id="6998966">(</span><span class="ident" id="6998967"><a href="/net/http/cgi/host_test.go.html#6998747">line</a></span><span class="op" id="6998971">,</span>&nbsp;<span class="string" id="6998973">&#34;\r\n&#34;</span><span class="op" id="6998979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6998983">split</span>&nbsp;<span class="op" id="6998989">:=</span>&nbsp;<span class="ident" id="6998992"><a href="/net/http/cgi/host_test.go.html#6998108">strings</a></span><span class="op" id="6998999">.</span><span class="ident" id="6999000">SplitN</span><span class="op" id="6999006">(</span><span class="ident" id="6999007"><a href="/net/http/cgi/host_test.go.html#6998934">trimmedLine</a></span><span class="op" id="6999018">,</span>&nbsp;<span class="string" id="6999020">&#34;=&#34;</span><span class="op" id="6999023">,</span>&nbsp;<span class="num" id="6999025">2</span><span class="op" id="6999026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6999030">if</span>&nbsp;<span class="builtinfunc" id="6999033">len</span><span class="op" id="6999036">(</span><span class="ident" id="6999037"><a href="/net/http/cgi/host_test.go.html#6998983">split</a></span><span class="op" id="6999042">)</span>&nbsp;<span class="op" id="6999044">!=</span>&nbsp;<span class="num" id="6999047">2</span>&nbsp;<span class="op" id="6999049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6999054"><a href="/net/http/cgi/host_test.go.html#6998409">t</a></span><span class="op" id="6999055">.</span><span class="ident" id="6999056">Fatalf</span><span class="op" id="6999062">(</span><span class="string" id="6999063">&#34;Unexpected&nbsp;%d&nbsp;parts&nbsp;from&nbsp;invalid&nbsp;line&nbsp;number&nbsp;%v:&nbsp;%q;&nbsp;existing&nbsp;map=%v&#34;</span><span class="op" id="6999133">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6999139">len</span><span class="op" id="6999142">(</span><span class="ident" id="6999143"><a href="/net/http/cgi/host_test.go.html#6998983">split</a></span><span class="op" id="6999148">)</span><span class="op" id="6999149">,</span>&nbsp;<span class="ident" id="6999151"><a href="/net/http/cgi/host_test.go.html#6998712">linesRead</a></span><span class="op" id="6999160">,</span>&nbsp;<span class="ident" id="6999162"><a href="/net/http/cgi/host_test.go.html#6998747">line</a></span><span class="op" id="6999166">,</span>&nbsp;<span class="ident" id="6999168"><a href="/net/http/cgi/host_test.go.html#6998651">m</a></span><span class="op" id="6999169">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6999173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6999177"><a href="/net/http/cgi/host_test.go.html#6998651">m</a></span><span class="op" id="6999178">[</span><span class="ident" id="6999179"><a href="/net/http/cgi/host_test.go.html#6998983">split</a></span><span class="op" id="6999184">[</span><span class="num" id="6999185">0</span><span class="op" id="6999186">]</span><span class="op" id="6999187">]</span>&nbsp;<span class="op" id="6999189">=</span>&nbsp;<span class="ident" id="6999191"><a href="/net/http/cgi/host_test.go.html#6998983">split</a></span><span class="op" id="6999196">[</span><span class="num" id="6999197">1</span><span class="op" id="6999198">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6999201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6999205">for</span>&nbsp;<span class="ident" id="6999209">key</span><span class="op" id="6999212">,</span>&nbsp;<span class="ident" id="6999214">expected</span>&nbsp;<span class="op" id="6999223">:=</span>&nbsp;<span class="keyword" id="6999226">range</span>&nbsp;<span class="ident" id="6999232"><a href="/net/http/cgi/host_test.go.html#6998451">expectedMap</a></span>&nbsp;<span class="op" id="6999244">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6999248">got</span>&nbsp;<span class="op" id="6999252">:=</span>&nbsp;<span class="ident" id="6999255"><a href="/net/http/cgi/host_test.go.html#6998651">m</a></span><span class="op" id="6999256">[</span><span class="ident" id="6999257"><a href="/net/http/cgi/host_test.go.html#6999209">key</a></span><span class="op" id="6999260">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6999264">if</span>&nbsp;<span class="ident" id="6999267"><a href="/net/http/cgi/host_test.go.html#6999209">key</a></span>&nbsp;<span class="op" id="6999271">==</span>&nbsp;<span class="string" id="6999274">&#34;cwd&#34;</span>&nbsp;<span class="op" id="6999280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6999285">//&nbsp;For&nbsp;Windows.&nbsp;golang.org/issue/4645.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6999327">fi1</span><span class="op" id="6999330">,</span>&nbsp;<span class="ident" id="6999332">_</span>&nbsp;<span class="op" id="6999334">:=</span>&nbsp;<span class="ident" id="6999337"><a href="/net/http/cgi/host_test.go.html#6998052">os</a></span><span class="op" id="6999339">.</span><span class="ident" id="6999340">Stat</span><span class="op" id="6999344">(</span><span class="ident" id="6999345"><a href="/net/http/cgi/host_test.go.html#6999248">got</a></span><span class="op" id="6999348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6999353">fi2</span><span class="op" id="6999356">,</span>&nbsp;<span class="ident" id="6999358">_</span>&nbsp;<span class="op" id="6999360">:=</span>&nbsp;<span class="ident" id="6999363"><a href="/net/http/cgi/host_test.go.html#6998052">os</a></span><span class="op" id="6999365">.</span><span class="ident" id="6999366">Stat</span><span class="op" id="6999370">(</span><span class="ident" id="6999371"><a href="/net/http/cgi/host_test.go.html#6999214">expected</a></span><span class="op" id="6999379">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6999384">if</span>&nbsp;<span class="ident" id="6999387"><a href="/net/http/cgi/host_test.go.html#6998052">os</a></span><span class="op" id="6999389">.</span><span class="ident" id="6999390">SameFile</span><span class="op" id="6999398">(</span><span class="ident" id="6999399"><a href="/net/http/cgi/host_test.go.html#6999327">fi1</a></span><span class="op" id="6999402">,</span>&nbsp;<span class="ident" id="6999404"><a href="/net/http/cgi/host_test.go.html#6999353">fi2</a></span><span class="op" id="6999407">)</span>&nbsp;<span class="op" id="6999409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6999415"><a href="/net/http/cgi/host_test.go.html#6999248">got</a></span>&nbsp;<span class="op" id="6999419">=</span>&nbsp;<span class="ident" id="6999421"><a href="/net/http/cgi/host_test.go.html#6999214">expected</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6999433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6999437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6999441">if</span>&nbsp;<span class="ident" id="6999444"><a href="/net/http/cgi/host_test.go.html#6999248">got</a></span>&nbsp;<span class="op" id="6999448">!=</span>&nbsp;<span class="ident" id="6999451"><a href="/net/http/cgi/host_test.go.html#6999214">expected</a></span>&nbsp;<span class="op" id="6999460">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6999465"><a href="/net/http/cgi/host_test.go.html#6998409">t</a></span><span class="op" id="6999466">.</span><span class="ident" id="6999467">Errorf</span><span class="op" id="6999473">(</span><span class="string" id="6999474">&#34;for&nbsp;key&nbsp;%q&nbsp;got&nbsp;%q;&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="6999506">,</span>&nbsp;<span class="ident" id="6999508"><a href="/net/http/cgi/host_test.go.html#6999209">key</a></span><span class="op" id="6999511">,</span>&nbsp;<span class="ident" id="6999513"><a href="/net/http/cgi/host_test.go.html#6999248">got</a></span><span class="op" id="6999516">,</span>&nbsp;<span class="ident" id="6999518"><a href="/net/http/cgi/host_test.go.html#6999214">expected</a></span><span class="op" id="6999526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6999530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6999533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6999536">return</span>&nbsp;<span class="ident" id="6999543"><a href="/net/http/cgi/host_test.go.html#6998512">rw</a></span><br>
<span class="lineno"></span><span class="op" id="6999546">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="6999549">var</span>&nbsp;<span class="ident" id="6999553">cgiTested</span><span class="op" id="6999562">,</span>&nbsp;<span class="ident" id="6999564">cgiWorks</span>&nbsp;<span class="builtintype" id="6999573">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6999579">func</span>&nbsp;<span class="ident" id="6999584">check</span><span class="op" id="6999589">(</span><span class="ident" id="6999590">t</span>&nbsp;<span class="op" id="6999592">*</span><span class="ident" id="6999593"><a href="/net/http/cgi/host_test.go.html#6998119">testing</a></span><span class="op" id="6999600">.</span><span class="ident" id="6999601">T</span><span class="op" id="6999602">)</span>&nbsp;<span class="op" id="6999604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6999607">if</span>&nbsp;<span class="op" id="6999610">!</span><span class="ident" id="6999611"><a href="/net/http/cgi/host_test.go.html#6999553">cgiTested</a></span>&nbsp;<span class="op" id="6999621">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6999625"><a href="/net/http/cgi/host_test.go.html#6999553">cgiTested</a></span>&nbsp;<span class="op" id="6999635">=</span>&nbsp;<span class="builtintype" id="6999637">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6999644"><a href="/net/http/cgi/host_test.go.html#6999564">cgiWorks</a></span>&nbsp;<span class="op" id="6999653">=</span>&nbsp;<span class="ident" id="6999655"><a href="/net/http/cgi/host_test.go.html#6998058">exec</a></span><span class="op" id="6999659">.</span><span class="ident" id="6999660">Command</span><span class="op" id="6999667">(</span><span class="string" id="6999668">&#34;./testdata/test.cgi&#34;</span><span class="op" id="6999689">)</span><span class="op" id="6999690">.</span><span class="ident" id="6999691">Run</span><span class="op" id="6999694">(</span><span class="op" id="6999695">)</span>&nbsp;<span class="op" id="6999697">==</span>&nbsp;<span class="ident" id="6999700">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6999705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6999708">if</span>&nbsp;<span class="op" id="6999711">!</span><span class="ident" id="6999712"><a href="/net/http/cgi/host_test.go.html#6999564">cgiWorks</a></span>&nbsp;<span class="op" id="6999721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6999725">//&nbsp;No&nbsp;Perl&nbsp;on&nbsp;Windows,&nbsp;needed&nbsp;by&nbsp;test.cgi</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6999769">//&nbsp;TODO:&nbsp;make&nbsp;the&nbsp;child&nbsp;process&nbsp;be&nbsp;Go,&nbsp;not&nbsp;Perl.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6999820"><a href="/net/http/cgi/host_test.go.html#6999590">t</a></span><span class="op" id="6999821">.</span><span class="ident" id="6999822">Skip</span><span class="op" id="6999826">(</span><span class="string" id="6999827">&#34;Skipping&nbsp;test:&nbsp;test.cgi&nbsp;failed.&#34;</span><span class="op" id="6999860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6999863">}</span><br>
<span class="lineno"></span><span class="op" id="6999865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6999868">func</span>&nbsp;<span class="ident" id="6999873">TestCGIBasicGet</span><span class="op" id="6999888">(</span><span class="ident" id="6999889">t</span>&nbsp;<span class="op" id="6999891">*</span><span class="ident" id="6999892"><a href="/net/http/cgi/host_test.go.html#6998119">testing</a></span><span class="op" id="6999899">.</span><span class="ident" id="6999900">T</span><span class="op" id="6999901">)</span>&nbsp;<span class="op" id="6999903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6999906"><a href="/net/http/cgi/host_test.go.html#6999584">check</a></span><span class="op" id="6999911">(</span><span class="ident" id="6999912"><a href="/net/http/cgi/host_test.go.html#6999889">t</a></span><span class="op" id="6999913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6999916">h</span>&nbsp;<span class="op" id="6999918">:=</span>&nbsp;<span class="op" id="6999921">&amp;</span><span class="ident" id="6999922"><a href="/net/http/cgi/host.go.html#6144504">Handler</a></span><span class="op" id="6999929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6999933">Path</span><span class="op" id="6999937">:</span>&nbsp;<span class="string" id="6999939">&#34;testdata/test.cgi&#34;</span><span class="op" id="6999958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6999962">Root</span><span class="op" id="6999966">:</span>&nbsp;<span class="string" id="6999968">&#34;/test.cgi&#34;</span><span class="op" id="6999979">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6999982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6999985">expectedMap</span>&nbsp;<span class="op" id="6999997">:=</span>&nbsp;<span class="keyword" id="7000000">map</span><span class="op" id="7000003">[</span><span class="builtintype" id="7000004">string</span><span class="op" id="7000010">]</span><span class="builtintype" id="7000011">string</span><span class="op" id="7000017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7000021">&#34;test&#34;</span><span class="op" id="7000027">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7000046">&#34;Hello&nbsp;CGI&#34;</span><span class="op" id="7000057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7000061">&#34;param-a&#34;</span><span class="op" id="7000070">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7000086">&#34;b&#34;</span><span class="op" id="7000089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7000093">&#34;param-foo&#34;</span><span class="op" id="7000104">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7000118">&#34;bar&#34;</span><span class="op" id="7000123">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7000127">&#34;env-GATEWAY_INTERFACE&#34;</span><span class="op" id="7000150">:</span>&nbsp;<span class="string" id="7000152">&#34;CGI/1.1&#34;</span><span class="op" id="7000161">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7000165">&#34;env-HTTP_HOST&#34;</span><span class="op" id="7000180">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7000190">&#34;example.com&#34;</span><span class="op" id="7000203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7000207">&#34;env-PATH_INFO&#34;</span><span class="op" id="7000222">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7000232">&#34;&#34;</span><span class="op" id="7000234">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7000238">&#34;env-QUERY_STRING&#34;</span><span class="op" id="7000256">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7000263">&#34;foo=bar&amp;a=b&#34;</span><span class="op" id="7000276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7000280">&#34;env-REMOTE_ADDR&#34;</span><span class="op" id="7000297">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7000305">&#34;1.2.3.4&#34;</span><span class="op" id="7000314">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7000318">&#34;env-REMOTE_HOST&#34;</span><span class="op" id="7000335">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7000343">&#34;1.2.3.4&#34;</span><span class="op" id="7000352">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7000356">&#34;env-REQUEST_METHOD&#34;</span><span class="op" id="7000376">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7000381">&#34;GET&#34;</span><span class="op" id="7000386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7000390">&#34;env-REQUEST_URI&#34;</span><span class="op" id="7000407">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7000415">&#34;/test.cgi?foo=bar&amp;a=b&#34;</span><span class="op" id="7000438">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7000442">&#34;env-SCRIPT_FILENAME&#34;</span><span class="op" id="7000463">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7000467">&#34;testdata/test.cgi&#34;</span><span class="op" id="7000486">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7000490">&#34;env-SCRIPT_NAME&#34;</span><span class="op" id="7000507">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7000515">&#34;/test.cgi&#34;</span><span class="op" id="7000526">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7000530">&#34;env-SERVER_NAME&#34;</span><span class="op" id="7000547">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7000555">&#34;example.com&#34;</span><span class="op" id="7000568">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7000572">&#34;env-SERVER_PORT&#34;</span><span class="op" id="7000589">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7000597">&#34;80&#34;</span><span class="op" id="7000601">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7000605">&#34;env-SERVER_SOFTWARE&#34;</span><span class="op" id="7000626">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7000630">&#34;go&#34;</span><span class="op" id="7000634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7000637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7000640">replay</span>&nbsp;<span class="op" id="7000647">:=</span>&nbsp;<span class="ident" id="7000650"><a href="/net/http/cgi/host_test.go.html#6998398">runCgiTest</a></span><span class="op" id="7000660">(</span><span class="ident" id="7000661"><a href="/net/http/cgi/host_test.go.html#6999889">t</a></span><span class="op" id="7000662">,</span>&nbsp;<span class="ident" id="7000664"><a href="/net/http/cgi/host_test.go.html#6999916">h</a></span><span class="op" id="7000665">,</span>&nbsp;<span class="string" id="7000667">&#34;GET&nbsp;/test.cgi?foo=bar&amp;a=b&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7000726">,</span>&nbsp;<span class="ident" id="7000728"><a href="/net/http/cgi/host_test.go.html#6999985">expectedMap</a></span><span class="op" id="7000739">)</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7000743">if</span>&nbsp;<span class="ident" id="7000746">expected</span><span class="op" id="7000754">,</span>&nbsp;<span class="ident" id="7000756">got</span>&nbsp;<span class="op" id="7000760">:=</span>&nbsp;<span class="string" id="7000763">&#34;text/html&#34;</span><span class="op" id="7000774">,</span>&nbsp;<span class="ident" id="7000776"><a href="/net/http/cgi/host_test.go.html#7000640">replay</a></span><span class="op" id="7000782">.</span><span class="ident" id="7000783">Header</span><span class="op" id="7000789">(</span><span class="op" id="7000790">)</span><span class="op" id="7000791">.</span><span class="ident" id="7000792">Get</span><span class="op" id="7000795">(</span><span class="string" id="7000796">&#34;Content-Type&#34;</span><span class="op" id="7000810">)</span><span class="op" id="7000811">;</span>&nbsp;<span class="ident" id="7000813"><a href="/net/http/cgi/host_test.go.html#7000756">got</a></span>&nbsp;<span class="op" id="7000817">!=</span>&nbsp;<span class="ident" id="7000820"><a href="/net/http/cgi/host_test.go.html#7000746">expected</a></span>&nbsp;<span class="op" id="7000829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7000833"><a href="/net/http/cgi/host_test.go.html#6999889">t</a></span><span class="op" id="7000834">.</span><span class="ident" id="7000835">Errorf</span><span class="op" id="7000841">(</span><span class="string" id="7000842">&#34;got&nbsp;a&nbsp;Content-Type&nbsp;of&nbsp;%q;&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7000881">,</span>&nbsp;<span class="ident" id="7000883"><a href="/net/http/cgi/host_test.go.html#7000756">got</a></span><span class="op" id="7000886">,</span>&nbsp;<span class="ident" id="7000888"><a href="/net/http/cgi/host_test.go.html#7000746">expected</a></span><span class="op" id="7000896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7000899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7000902">if</span>&nbsp;<span class="ident" id="7000905">expected</span><span class="op" id="7000913">,</span>&nbsp;<span class="ident" id="7000915">got</span>&nbsp;<span class="op" id="7000919">:=</span>&nbsp;<span class="string" id="7000922">&#34;X-Test-Value&#34;</span><span class="op" id="7000936">,</span>&nbsp;<span class="ident" id="7000938"><a href="/net/http/cgi/host_test.go.html#7000640">replay</a></span><span class="op" id="7000944">.</span><span class="ident" id="7000945">Header</span><span class="op" id="7000951">(</span><span class="op" id="7000952">)</span><span class="op" id="7000953">.</span><span class="ident" id="7000954">Get</span><span class="op" id="7000957">(</span><span class="string" id="7000958">&#34;X-Test-Header&#34;</span><span class="op" id="7000973">)</span><span class="op" id="7000974">;</span>&nbsp;<span class="ident" id="7000976"><a href="/net/http/cgi/host_test.go.html#7000915">got</a></span>&nbsp;<span class="op" id="7000980">!=</span>&nbsp;<span class="ident" id="7000983"><a href="/net/http/cgi/host_test.go.html#7000905">expected</a></span>&nbsp;<span class="op" id="7000992">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7000996"><a href="/net/http/cgi/host_test.go.html#6999889">t</a></span><span class="op" id="7000997">.</span><span class="ident" id="7000998">Errorf</span><span class="op" id="7001004">(</span><span class="string" id="7001005">&#34;got&nbsp;a&nbsp;X-Test-Header&nbsp;of&nbsp;%q;&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7001045">,</span>&nbsp;<span class="ident" id="7001047"><a href="/net/http/cgi/host_test.go.html#7000915">got</a></span><span class="op" id="7001050">,</span>&nbsp;<span class="ident" id="7001052"><a href="/net/http/cgi/host_test.go.html#7000905">expected</a></span><span class="op" id="7001060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7001063">}</span><br>
<span class="lineno"></span><span class="op" id="7001065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7001068">func</span>&nbsp;<span class="ident" id="7001073">TestCGIBasicGetAbsPath</span><span class="op" id="7001095">(</span><span class="ident" id="7001096">t</span>&nbsp;<span class="op" id="7001098">*</span><span class="ident" id="7001099"><a href="/net/http/cgi/host_test.go.html#6998119">testing</a></span><span class="op" id="7001106">.</span><span class="ident" id="7001107">T</span><span class="op" id="7001108">)</span>&nbsp;<span class="op" id="7001110">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7001113"><a href="/net/http/cgi/host_test.go.html#6999584">check</a></span><span class="op" id="7001118">(</span><span class="ident" id="7001119"><a href="/net/http/cgi/host_test.go.html#7001096">t</a></span><span class="op" id="7001120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7001123">pwd</span><span class="op" id="7001126">,</span>&nbsp;<span class="ident" id="7001128">err</span>&nbsp;<span class="op" id="7001132">:=</span>&nbsp;<span class="ident" id="7001135"><a href="/net/http/cgi/host_test.go.html#6998052">os</a></span><span class="op" id="7001137">.</span><span class="ident" id="7001138">Getwd</span><span class="op" id="7001143">(</span><span class="op" id="7001144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7001147">if</span>&nbsp;<span class="ident" id="7001150"><a href="/net/http/cgi/host_test.go.html#7001128">err</a></span>&nbsp;<span class="op" id="7001154">!=</span>&nbsp;<span class="ident" id="7001157">nil</span>&nbsp;<span class="op" id="7001161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7001165"><a href="/net/http/cgi/host_test.go.html#7001096">t</a></span><span class="op" id="7001166">.</span><span class="ident" id="7001167">Fatalf</span><span class="op" id="7001173">(</span><span class="string" id="7001174">&#34;getwd&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7001191">,</span>&nbsp;<span class="ident" id="7001193"><a href="/net/http/cgi/host_test.go.html#7001128">err</a></span><span class="op" id="7001196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7001199">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7001202">h</span>&nbsp;<span class="op" id="7001204">:=</span>&nbsp;<span class="op" id="7001207">&amp;</span><span class="ident" id="7001208"><a href="/net/http/cgi/host.go.html#6144504">Handler</a></span><span class="op" id="7001215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7001219">Path</span><span class="op" id="7001223">:</span>&nbsp;<span class="ident" id="7001225"><a href="/net/http/cgi/host_test.go.html#7001123">pwd</a></span>&nbsp;<span class="op" id="7001229">+</span>&nbsp;<span class="string" id="7001231">&#34;/testdata/test.cgi&#34;</span><span class="op" id="7001251">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7001255">Root</span><span class="op" id="7001259">:</span>&nbsp;<span class="string" id="7001261">&#34;/test.cgi&#34;</span><span class="op" id="7001272">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7001275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7001278">expectedMap</span>&nbsp;<span class="op" id="7001290">:=</span>&nbsp;<span class="keyword" id="7001293">map</span><span class="op" id="7001296">[</span><span class="builtintype" id="7001297">string</span><span class="op" id="7001303">]</span><span class="builtintype" id="7001304">string</span><span class="op" id="7001310">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7001314">&#34;env-REQUEST_URI&#34;</span><span class="op" id="7001331">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7001337">&#34;/test.cgi?foo=bar&amp;a=b&#34;</span><span class="op" id="7001360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7001364">&#34;env-SCRIPT_FILENAME&#34;</span><span class="op" id="7001385">:</span>&nbsp;<span class="ident" id="7001387"><a href="/net/http/cgi/host_test.go.html#7001123">pwd</a></span>&nbsp;<span class="op" id="7001391">+</span>&nbsp;<span class="string" id="7001393">&#34;/testdata/test.cgi&#34;</span><span class="op" id="7001413">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7001417">&#34;env-SCRIPT_NAME&#34;</span><span class="op" id="7001434">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7001440">&#34;/test.cgi&#34;</span><span class="op" id="7001451">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7001454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7001457"><a href="/net/http/cgi/host_test.go.html#6998398">runCgiTest</a></span><span class="op" id="7001467">(</span><span class="ident" id="7001468"><a href="/net/http/cgi/host_test.go.html#7001096">t</a></span><span class="op" id="7001469">,</span>&nbsp;<span class="ident" id="7001471"><a href="/net/http/cgi/host_test.go.html#7001202">h</a></span><span class="op" id="7001472">,</span>&nbsp;<span class="string" id="7001474">&#34;GET&nbsp;/test.cgi?foo=bar&amp;a=b&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7001533">,</span>&nbsp;<span class="ident" id="7001535"><a href="/net/http/cgi/host_test.go.html#7001278">expectedMap</a></span><span class="op" id="7001546">)</span><br>
<span class="lineno">145</span><span class="op" id="7001548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7001551">func</span>&nbsp;<span class="ident" id="7001556">TestPathInfo</span><span class="op" id="7001568">(</span><span class="ident" id="7001569">t</span>&nbsp;<span class="op" id="7001571">*</span><span class="ident" id="7001572"><a href="/net/http/cgi/host_test.go.html#6998119">testing</a></span><span class="op" id="7001579">.</span><span class="ident" id="7001580">T</span><span class="op" id="7001581">)</span>&nbsp;<span class="op" id="7001583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7001586"><a href="/net/http/cgi/host_test.go.html#6999584">check</a></span><span class="op" id="7001591">(</span><span class="ident" id="7001592"><a href="/net/http/cgi/host_test.go.html#7001569">t</a></span><span class="op" id="7001593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7001596">h</span>&nbsp;<span class="op" id="7001598">:=</span>&nbsp;<span class="op" id="7001601">&amp;</span><span class="ident" id="7001602"><a href="/net/http/cgi/host.go.html#6144504">Handler</a></span><span class="op" id="7001609">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7001613">Path</span><span class="op" id="7001617">:</span>&nbsp;<span class="string" id="7001619">&#34;testdata/test.cgi&#34;</span><span class="op" id="7001638">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7001642">Root</span><span class="op" id="7001646">:</span>&nbsp;<span class="string" id="7001648">&#34;/test.cgi&#34;</span><span class="op" id="7001659">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7001662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7001665">expectedMap</span>&nbsp;<span class="op" id="7001677">:=</span>&nbsp;<span class="keyword" id="7001680">map</span><span class="op" id="7001683">[</span><span class="builtintype" id="7001684">string</span><span class="op" id="7001690">]</span><span class="builtintype" id="7001691">string</span><span class="op" id="7001697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7001701">&#34;param-a&#34;</span><span class="op" id="7001710">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7001724">&#34;b&#34;</span><span class="op" id="7001727">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7001731">&#34;env-PATH_INFO&#34;</span><span class="op" id="7001746">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7001754">&#34;/extrapath&#34;</span><span class="op" id="7001766">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7001770">&#34;env-QUERY_STRING&#34;</span><span class="op" id="7001788">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7001793">&#34;a=b&#34;</span><span class="op" id="7001798">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7001802">&#34;env-REQUEST_URI&#34;</span><span class="op" id="7001819">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7001825">&#34;/test.cgi/extrapath?a=b&#34;</span><span class="op" id="7001850">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7001854">&#34;env-SCRIPT_FILENAME&#34;</span><span class="op" id="7001875">:</span>&nbsp;<span class="string" id="7001877">&#34;testdata/test.cgi&#34;</span><span class="op" id="7001896">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7001900">&#34;env-SCRIPT_NAME&#34;</span><span class="op" id="7001917">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7001923">&#34;/test.cgi&#34;</span><span class="op" id="7001934">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7001937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7001940"><a href="/net/http/cgi/host_test.go.html#6998398">runCgiTest</a></span><span class="op" id="7001950">(</span><span class="ident" id="7001951"><a href="/net/http/cgi/host_test.go.html#7001569">t</a></span><span class="op" id="7001952">,</span>&nbsp;<span class="ident" id="7001954"><a href="/net/http/cgi/host_test.go.html#7001596">h</a></span><span class="op" id="7001955">,</span>&nbsp;<span class="string" id="7001957">&#34;GET&nbsp;/test.cgi/extrapath?a=b&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7002018">,</span>&nbsp;<span class="ident" id="7002020"><a href="/net/http/cgi/host_test.go.html#7001665">expectedMap</a></span><span class="op" id="7002031">)</span><br>
<span class="lineno"></span><span class="op" id="7002033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7002036">func</span>&nbsp;<span class="ident" id="7002041">TestPathInfoDirRoot</span><span class="op" id="7002060">(</span><span class="ident" id="7002061">t</span>&nbsp;<span class="op" id="7002063">*</span><span class="ident" id="7002064"><a href="/net/http/cgi/host_test.go.html#6998119">testing</a></span><span class="op" id="7002071">.</span><span class="ident" id="7002072">T</span><span class="op" id="7002073">)</span>&nbsp;<span class="op" id="7002075">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7002078"><a href="/net/http/cgi/host_test.go.html#6999584">check</a></span><span class="op" id="7002083">(</span><span class="ident" id="7002084"><a href="/net/http/cgi/host_test.go.html#7002061">t</a></span><span class="op" id="7002085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7002088">h</span>&nbsp;<span class="op" id="7002090">:=</span>&nbsp;<span class="op" id="7002093">&amp;</span><span class="ident" id="7002094"><a href="/net/http/cgi/host.go.html#6144504">Handler</a></span><span class="op" id="7002101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7002105">Path</span><span class="op" id="7002109">:</span>&nbsp;<span class="string" id="7002111">&#34;testdata/test.cgi&#34;</span><span class="op" id="7002130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7002134">Root</span><span class="op" id="7002138">:</span>&nbsp;<span class="string" id="7002140">&#34;/myscript/&#34;</span><span class="op" id="7002152">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7002155">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7002158">expectedMap</span>&nbsp;<span class="op" id="7002170">:=</span>&nbsp;<span class="keyword" id="7002173">map</span><span class="op" id="7002176">[</span><span class="builtintype" id="7002177">string</span><span class="op" id="7002183">]</span><span class="builtintype" id="7002184">string</span><span class="op" id="7002190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7002194">&#34;env-PATH_INFO&#34;</span><span class="op" id="7002209">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7002217">&#34;bar&#34;</span><span class="op" id="7002222">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7002226">&#34;env-QUERY_STRING&#34;</span><span class="op" id="7002244">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7002249">&#34;a=b&#34;</span><span class="op" id="7002254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7002258">&#34;env-REQUEST_URI&#34;</span><span class="op" id="7002275">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7002281">&#34;/myscript/bar?a=b&#34;</span><span class="op" id="7002300">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7002304">&#34;env-SCRIPT_FILENAME&#34;</span><span class="op" id="7002325">:</span>&nbsp;<span class="string" id="7002327">&#34;testdata/test.cgi&#34;</span><span class="op" id="7002346">,</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7002350">&#34;env-SCRIPT_NAME&#34;</span><span class="op" id="7002367">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7002373">&#34;/myscript/&#34;</span><span class="op" id="7002385">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7002388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7002391"><a href="/net/http/cgi/host_test.go.html#6998398">runCgiTest</a></span><span class="op" id="7002401">(</span><span class="ident" id="7002402"><a href="/net/http/cgi/host_test.go.html#7002061">t</a></span><span class="op" id="7002403">,</span>&nbsp;<span class="ident" id="7002405"><a href="/net/http/cgi/host_test.go.html#7002088">h</a></span><span class="op" id="7002406">,</span>&nbsp;<span class="string" id="7002408">&#34;GET&nbsp;/myscript/bar?a=b&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7002463">,</span>&nbsp;<span class="ident" id="7002465"><a href="/net/http/cgi/host_test.go.html#7002158">expectedMap</a></span><span class="op" id="7002476">)</span><br>
<span class="lineno"></span><span class="op" id="7002478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="7002481">func</span>&nbsp;<span class="ident" id="7002486">TestDupHeaders</span><span class="op" id="7002500">(</span><span class="ident" id="7002501">t</span>&nbsp;<span class="op" id="7002503">*</span><span class="ident" id="7002504"><a href="/net/http/cgi/host_test.go.html#6998119">testing</a></span><span class="op" id="7002511">.</span><span class="ident" id="7002512">T</span><span class="op" id="7002513">)</span>&nbsp;<span class="op" id="7002515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7002518"><a href="/net/http/cgi/host_test.go.html#6999584">check</a></span><span class="op" id="7002523">(</span><span class="ident" id="7002524"><a href="/net/http/cgi/host_test.go.html#7002501">t</a></span><span class="op" id="7002525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7002528">h</span>&nbsp;<span class="op" id="7002530">:=</span>&nbsp;<span class="op" id="7002533">&amp;</span><span class="ident" id="7002534"><a href="/net/http/cgi/host.go.html#6144504">Handler</a></span><span class="op" id="7002541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7002545">Path</span><span class="op" id="7002549">:</span>&nbsp;<span class="string" id="7002551">&#34;testdata/test.cgi&#34;</span><span class="op" id="7002570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7002573">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7002576">expectedMap</span>&nbsp;<span class="op" id="7002588">:=</span>&nbsp;<span class="keyword" id="7002591">map</span><span class="op" id="7002594">[</span><span class="builtintype" id="7002595">string</span><span class="op" id="7002601">]</span><span class="builtintype" id="7002602">string</span><span class="op" id="7002608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7002612">&#34;env-REQUEST_URI&#34;</span><span class="op" id="7002629">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7002635">&#34;/myscript/bar?a=b&#34;</span><span class="op" id="7002654">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7002658">&#34;env-SCRIPT_FILENAME&#34;</span><span class="op" id="7002679">:</span>&nbsp;<span class="string" id="7002681">&#34;testdata/test.cgi&#34;</span><span class="op" id="7002700">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7002704">&#34;env-HTTP_COOKIE&#34;</span><span class="op" id="7002721">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7002727">&#34;nom=NOM;&nbsp;yum=YUM&#34;</span><span class="op" id="7002745">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7002749">&#34;env-HTTP_X_FOO&#34;</span><span class="op" id="7002765">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7002772">&#34;val1,&nbsp;val2&#34;</span><span class="op" id="7002784">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7002787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7002790"><a href="/net/http/cgi/host_test.go.html#6998398">runCgiTest</a></span><span class="op" id="7002800">(</span><span class="ident" id="7002801"><a href="/net/http/cgi/host_test.go.html#7002501">t</a></span><span class="op" id="7002802">,</span>&nbsp;<span class="ident" id="7002804"><a href="/net/http/cgi/host_test.go.html#7002528">h</a></span><span class="op" id="7002805">,</span>&nbsp;<span class="string" id="7002807">&#34;GET&nbsp;/myscript/bar?a=b&nbsp;HTTP/1.0\n&#34;</span><span class="op" id="7002841">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7002845">&#34;Cookie:&nbsp;nom=NOM\n&#34;</span><span class="op" id="7002864">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7002868">&#34;Cookie:&nbsp;yum=YUM\n&#34;</span><span class="op" id="7002887">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7002891">&#34;X-Foo:&nbsp;val1\n&#34;</span><span class="op" id="7002906">+</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7002910">&#34;X-Foo:&nbsp;val2\n&#34;</span><span class="op" id="7002925">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7002929">&#34;Host:&nbsp;example.com\n\n&#34;</span><span class="op" id="7002952">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7002956"><a href="/net/http/cgi/host_test.go.html#7002576">expectedMap</a></span><span class="op" id="7002967">)</span><br>
<span class="lineno"></span><span class="op" id="7002969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="keyword" id="7002972">func</span>&nbsp;<span class="ident" id="7002977">TestPathInfoNoRoot</span><span class="op" id="7002995">(</span><span class="ident" id="7002996">t</span>&nbsp;<span class="op" id="7002998">*</span><span class="ident" id="7002999"><a href="/net/http/cgi/host_test.go.html#6998119">testing</a></span><span class="op" id="7003006">.</span><span class="ident" id="7003007">T</span><span class="op" id="7003008">)</span>&nbsp;<span class="op" id="7003010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003013"><a href="/net/http/cgi/host_test.go.html#6999584">check</a></span><span class="op" id="7003018">(</span><span class="ident" id="7003019"><a href="/net/http/cgi/host_test.go.html#7002996">t</a></span><span class="op" id="7003020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003023">h</span>&nbsp;<span class="op" id="7003025">:=</span>&nbsp;<span class="op" id="7003028">&amp;</span><span class="ident" id="7003029"><a href="/net/http/cgi/host.go.html#6144504">Handler</a></span><span class="op" id="7003036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003040">Path</span><span class="op" id="7003044">:</span>&nbsp;<span class="string" id="7003046">&#34;testdata/test.cgi&#34;</span><span class="op" id="7003065">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003069">Root</span><span class="op" id="7003073">:</span>&nbsp;<span class="string" id="7003075">&#34;&#34;</span><span class="op" id="7003077">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7003080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003083">expectedMap</span>&nbsp;<span class="op" id="7003095">:=</span>&nbsp;<span class="keyword" id="7003098">map</span><span class="op" id="7003101">[</span><span class="builtintype" id="7003102">string</span><span class="op" id="7003108">]</span><span class="builtintype" id="7003109">string</span><span class="op" id="7003115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7003119">&#34;env-PATH_INFO&#34;</span><span class="op" id="7003134">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7003142">&#34;/bar&#34;</span><span class="op" id="7003148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7003152">&#34;env-QUERY_STRING&#34;</span><span class="op" id="7003170">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7003175">&#34;a=b&#34;</span><span class="op" id="7003180">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7003184">&#34;env-REQUEST_URI&#34;</span><span class="op" id="7003201">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7003207">&#34;/bar?a=b&#34;</span><span class="op" id="7003217">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7003221">&#34;env-SCRIPT_FILENAME&#34;</span><span class="op" id="7003242">:</span>&nbsp;<span class="string" id="7003244">&#34;testdata/test.cgi&#34;</span><span class="op" id="7003263">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7003267">&#34;env-SCRIPT_NAME&#34;</span><span class="op" id="7003284">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7003290">&#34;/&#34;</span><span class="op" id="7003293">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7003296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003299"><a href="/net/http/cgi/host_test.go.html#6998398">runCgiTest</a></span><span class="op" id="7003309">(</span><span class="ident" id="7003310"><a href="/net/http/cgi/host_test.go.html#7002996">t</a></span><span class="op" id="7003311">,</span>&nbsp;<span class="ident" id="7003313"><a href="/net/http/cgi/host_test.go.html#7003023">h</a></span><span class="op" id="7003314">,</span>&nbsp;<span class="string" id="7003316">&#34;GET&nbsp;/bar?a=b&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7003362">,</span>&nbsp;<span class="ident" id="7003364"><a href="/net/http/cgi/host_test.go.html#7003083">expectedMap</a></span><span class="op" id="7003375">)</span><br>
<span class="lineno"></span><span class="op" id="7003377">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="7003380">func</span>&nbsp;<span class="ident" id="7003385">TestCGIBasicPost</span><span class="op" id="7003401">(</span><span class="ident" id="7003402">t</span>&nbsp;<span class="op" id="7003404">*</span><span class="ident" id="7003405"><a href="/net/http/cgi/host_test.go.html#6998119">testing</a></span><span class="op" id="7003412">.</span><span class="ident" id="7003413">T</span><span class="op" id="7003414">)</span>&nbsp;<span class="op" id="7003416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003419"><a href="/net/http/cgi/host_test.go.html#6999584">check</a></span><span class="op" id="7003424">(</span><span class="ident" id="7003425"><a href="/net/http/cgi/host_test.go.html#7003402">t</a></span><span class="op" id="7003426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003429">postReq</span>&nbsp;<span class="op" id="7003437">:=</span>&nbsp;<span class="string" id="7003440">`POST&nbsp;/test.cgi?a=b&nbsp;HTTP/1.0<br>
<span class="lineno"></span>Host:&nbsp;example.com<br>
<span class="lineno">220</span>Content-Type:&nbsp;application/x-www-form-urlencoded<br>
<span class="lineno"></span>Content-Length:&nbsp;15<br>
<span class="lineno"></span><br>
<span class="lineno"></span>postfoo=postbar`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003573">h</span>&nbsp;<span class="op" id="7003575">:=</span>&nbsp;<span class="op" id="7003578">&amp;</span><span class="ident" id="7003579"><a href="/net/http/cgi/host.go.html#6144504">Handler</a></span><span class="op" id="7003586">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003590">Path</span><span class="op" id="7003594">:</span>&nbsp;<span class="string" id="7003596">&#34;testdata/test.cgi&#34;</span><span class="op" id="7003615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003619">Root</span><span class="op" id="7003623">:</span>&nbsp;<span class="string" id="7003625">&#34;/test.cgi&#34;</span><span class="op" id="7003636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7003639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003642">expectedMap</span>&nbsp;<span class="op" id="7003654">:=</span>&nbsp;<span class="keyword" id="7003657">map</span><span class="op" id="7003660">[</span><span class="builtintype" id="7003661">string</span><span class="op" id="7003667">]</span><span class="builtintype" id="7003668">string</span><span class="op" id="7003674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7003678">&#34;test&#34;</span><span class="op" id="7003684">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7003700">&#34;Hello&nbsp;CGI&#34;</span><span class="op" id="7003711">,</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7003715">&#34;param-postfoo&#34;</span><span class="op" id="7003730">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7003737">&#34;postbar&#34;</span><span class="op" id="7003746">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7003750">&#34;env-REQUEST_METHOD&#34;</span><span class="op" id="7003770">:</span>&nbsp;<span class="string" id="7003772">&#34;POST&#34;</span><span class="op" id="7003778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7003782">&#34;env-CONTENT_LENGTH&#34;</span><span class="op" id="7003802">:</span>&nbsp;<span class="string" id="7003804">&#34;15&#34;</span><span class="op" id="7003808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7003812">&#34;env-REQUEST_URI&#34;</span><span class="op" id="7003829">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7003834">&#34;/test.cgi?a=b&#34;</span><span class="op" id="7003849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7003852">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003855"><a href="/net/http/cgi/host_test.go.html#6998398">runCgiTest</a></span><span class="op" id="7003865">(</span><span class="ident" id="7003866"><a href="/net/http/cgi/host_test.go.html#7003402">t</a></span><span class="op" id="7003867">,</span>&nbsp;<span class="ident" id="7003869"><a href="/net/http/cgi/host_test.go.html#7003573">h</a></span><span class="op" id="7003870">,</span>&nbsp;<span class="ident" id="7003872"><a href="/net/http/cgi/host_test.go.html#7003429">postReq</a></span><span class="op" id="7003879">,</span>&nbsp;<span class="ident" id="7003881"><a href="/net/http/cgi/host_test.go.html#7003642">expectedMap</a></span><span class="op" id="7003892">)</span><br>
<span class="lineno"></span><span class="op" id="7003894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7003897">func</span>&nbsp;<span class="ident" id="7003902">chunk</span><span class="op" id="7003907">(</span><span class="ident" id="7003908">s</span>&nbsp;<span class="builtintype" id="7003910">string</span><span class="op" id="7003916">)</span>&nbsp;<span class="builtintype" id="7003918">string</span>&nbsp;<span class="op" id="7003925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7003928">return</span>&nbsp;<span class="ident" id="7003935"><a href="/net/http/cgi/host_test.go.html#6997999">fmt</a></span><span class="op" id="7003938">.</span><span class="ident" id="7003939">Sprintf</span><span class="op" id="7003946">(</span><span class="string" id="7003947">&#34;%x\r\n%s\r\n&#34;</span><span class="op" id="7003961">,</span>&nbsp;<span class="builtinfunc" id="7003963">len</span><span class="op" id="7003966">(</span><span class="ident" id="7003967"><a href="/net/http/cgi/host_test.go.html#7003908">s</a></span><span class="op" id="7003968">)</span><span class="op" id="7003969">,</span>&nbsp;<span class="ident" id="7003971"><a href="/net/http/cgi/host_test.go.html#7003908">s</a></span><span class="op" id="7003972">)</span><br>
<span class="lineno">240</span><span class="op" id="7003974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7003977">//&nbsp;The&nbsp;CGI&nbsp;spec&nbsp;doesn&#39;t&nbsp;allow&nbsp;chunked&nbsp;requests.</span><br>
<span class="lineno"></span><span class="keyword" id="7004025">func</span>&nbsp;<span class="ident" id="7004030">TestCGIPostChunked</span><span class="op" id="7004048">(</span><span class="ident" id="7004049">t</span>&nbsp;<span class="op" id="7004051">*</span><span class="ident" id="7004052"><a href="/net/http/cgi/host_test.go.html#6998119">testing</a></span><span class="op" id="7004059">.</span><span class="ident" id="7004060">T</span><span class="op" id="7004061">)</span>&nbsp;<span class="op" id="7004063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004066"><a href="/net/http/cgi/host_test.go.html#6999584">check</a></span><span class="op" id="7004071">(</span><span class="ident" id="7004072"><a href="/net/http/cgi/host_test.go.html#7004049">t</a></span><span class="op" id="7004073">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004076">postReq</span>&nbsp;<span class="op" id="7004084">:=</span>&nbsp;<span class="string" id="7004087">`POST&nbsp;/test.cgi?a=b&nbsp;HTTP/1.1<br>
<span class="lineno"></span>Host:&nbsp;example.com<br>
<span class="lineno"></span>Content-Type:&nbsp;application/x-www-form-urlencoded<br>
<span class="lineno"></span>Transfer-Encoding:&nbsp;chunked<br>
<span class="lineno"></span><br>
<span class="lineno">250</span>`</span>&nbsp;<span class="op" id="7004212">+</span>&nbsp;<span class="ident" id="7004214"><a href="/net/http/cgi/host_test.go.html#7003902">chunk</a></span><span class="op" id="7004219">(</span><span class="string" id="7004220">&#34;postfoo&#34;</span><span class="op" id="7004229">)</span>&nbsp;<span class="op" id="7004231">+</span>&nbsp;<span class="ident" id="7004233"><a href="/net/http/cgi/host_test.go.html#7003902">chunk</a></span><span class="op" id="7004238">(</span><span class="string" id="7004239">&#34;=&#34;</span><span class="op" id="7004242">)</span>&nbsp;<span class="op" id="7004244">+</span>&nbsp;<span class="ident" id="7004246"><a href="/net/http/cgi/host_test.go.html#7003902">chunk</a></span><span class="op" id="7004251">(</span><span class="string" id="7004252">&#34;postbar&#34;</span><span class="op" id="7004261">)</span>&nbsp;<span class="op" id="7004263">+</span>&nbsp;<span class="ident" id="7004265"><a href="/net/http/cgi/host_test.go.html#7003902">chunk</a></span><span class="op" id="7004270">(</span><span class="string" id="7004271">&#34;&#34;</span><span class="op" id="7004273">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004277">h</span>&nbsp;<span class="op" id="7004279">:=</span>&nbsp;<span class="op" id="7004282">&amp;</span><span class="ident" id="7004283"><a href="/net/http/cgi/host.go.html#6144504">Handler</a></span><span class="op" id="7004290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004294">Path</span><span class="op" id="7004298">:</span>&nbsp;<span class="string" id="7004300">&#34;testdata/test.cgi&#34;</span><span class="op" id="7004319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004323">Root</span><span class="op" id="7004327">:</span>&nbsp;<span class="string" id="7004329">&#34;/test.cgi&#34;</span><span class="op" id="7004340">,</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7004343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004346">expectedMap</span>&nbsp;<span class="op" id="7004358">:=</span>&nbsp;<span class="keyword" id="7004361">map</span><span class="op" id="7004364">[</span><span class="builtintype" id="7004365">string</span><span class="op" id="7004371">]</span><span class="builtintype" id="7004372">string</span><span class="op" id="7004378">{</span><span class="op" id="7004379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004382">resp</span>&nbsp;<span class="op" id="7004387">:=</span>&nbsp;<span class="ident" id="7004390"><a href="/net/http/cgi/host_test.go.html#6998398">runCgiTest</a></span><span class="op" id="7004400">(</span><span class="ident" id="7004401"><a href="/net/http/cgi/host_test.go.html#7004049">t</a></span><span class="op" id="7004402">,</span>&nbsp;<span class="ident" id="7004404"><a href="/net/http/cgi/host_test.go.html#7004277">h</a></span><span class="op" id="7004405">,</span>&nbsp;<span class="ident" id="7004407"><a href="/net/http/cgi/host_test.go.html#7004076">postReq</a></span><span class="op" id="7004414">,</span>&nbsp;<span class="ident" id="7004416"><a href="/net/http/cgi/host_test.go.html#7004346">expectedMap</a></span><span class="op" id="7004427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7004430">if</span>&nbsp;<span class="ident" id="7004433">got</span><span class="op" id="7004436">,</span>&nbsp;<span class="ident" id="7004438">expected</span>&nbsp;<span class="op" id="7004447">:=</span>&nbsp;<span class="ident" id="7004450"><a href="/net/http/cgi/host_test.go.html#7004382">resp</a></span><span class="op" id="7004454">.</span><span class="ident" id="7004455">Code</span><span class="op" id="7004459">,</span>&nbsp;<span class="ident" id="7004461"><a href="/net/http/cgi/host_test.go.html#6998019">http</a></span><span class="op" id="7004465">.</span><span class="ident" id="7004466">StatusBadRequest</span><span class="op" id="7004482">;</span>&nbsp;<span class="ident" id="7004484"><a href="/net/http/cgi/host_test.go.html#7004433">got</a></span>&nbsp;<span class="op" id="7004488">!=</span>&nbsp;<span class="ident" id="7004491"><a href="/net/http/cgi/host_test.go.html#7004438">expected</a></span>&nbsp;<span class="op" id="7004500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004504"><a href="/net/http/cgi/host_test.go.html#7004049">t</a></span><span class="op" id="7004505">.</span><span class="ident" id="7004506">Fatalf</span><span class="op" id="7004512">(</span><span class="string" id="7004513">&#34;Expected&nbsp;%v&nbsp;response&nbsp;code&nbsp;from&nbsp;chunked&nbsp;request&nbsp;body;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7004574">,</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004579"><a href="/net/http/cgi/host_test.go.html#7004438">expected</a></span><span class="op" id="7004587">,</span>&nbsp;<span class="ident" id="7004589"><a href="/net/http/cgi/host_test.go.html#7004433">got</a></span><span class="op" id="7004592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7004595">}</span><br>
<span class="lineno"></span><span class="op" id="7004597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7004600">func</span>&nbsp;<span class="ident" id="7004605">TestRedirect</span><span class="op" id="7004617">(</span><span class="ident" id="7004618">t</span>&nbsp;<span class="op" id="7004620">*</span><span class="ident" id="7004621"><a href="/net/http/cgi/host_test.go.html#6998119">testing</a></span><span class="op" id="7004628">.</span><span class="ident" id="7004629">T</span><span class="op" id="7004630">)</span>&nbsp;<span class="op" id="7004632">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004635"><a href="/net/http/cgi/host_test.go.html#6999584">check</a></span><span class="op" id="7004640">(</span><span class="ident" id="7004641"><a href="/net/http/cgi/host_test.go.html#7004618">t</a></span><span class="op" id="7004642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004645">h</span>&nbsp;<span class="op" id="7004647">:=</span>&nbsp;<span class="op" id="7004650">&amp;</span><span class="ident" id="7004651"><a href="/net/http/cgi/host.go.html#6144504">Handler</a></span><span class="op" id="7004658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004662">Path</span><span class="op" id="7004666">:</span>&nbsp;<span class="string" id="7004668">&#34;testdata/test.cgi&#34;</span><span class="op" id="7004687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004691">Root</span><span class="op" id="7004695">:</span>&nbsp;<span class="string" id="7004697">&#34;/test.cgi&#34;</span><span class="op" id="7004708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7004711">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004714">rec</span>&nbsp;<span class="op" id="7004718">:=</span>&nbsp;<span class="ident" id="7004721"><a href="/net/http/cgi/host_test.go.html#6998398">runCgiTest</a></span><span class="op" id="7004731">(</span><span class="ident" id="7004732"><a href="/net/http/cgi/host_test.go.html#7004618">t</a></span><span class="op" id="7004733">,</span>&nbsp;<span class="ident" id="7004735"><a href="/net/http/cgi/host_test.go.html#7004645">h</a></span><span class="op" id="7004736">,</span>&nbsp;<span class="string" id="7004738">&#34;GET&nbsp;/test.cgi?loc=http://foo.com/&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7004805">,</span>&nbsp;<span class="ident" id="7004807">nil</span><span class="op" id="7004810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7004813">if</span>&nbsp;<span class="ident" id="7004816">e</span><span class="op" id="7004817">,</span>&nbsp;<span class="ident" id="7004819">g</span>&nbsp;<span class="op" id="7004821">:=</span>&nbsp;<span class="num" id="7004824">302</span><span class="op" id="7004827">,</span>&nbsp;<span class="ident" id="7004829"><a href="/net/http/cgi/host_test.go.html#7004714">rec</a></span><span class="op" id="7004832">.</span><span class="ident" id="7004833">Code</span><span class="op" id="7004837">;</span>&nbsp;<span class="ident" id="7004839"><a href="/net/http/cgi/host_test.go.html#7004816">e</a></span>&nbsp;<span class="op" id="7004841">!=</span>&nbsp;<span class="ident" id="7004844"><a href="/net/http/cgi/host_test.go.html#7004819">g</a></span>&nbsp;<span class="op" id="7004846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004850"><a href="/net/http/cgi/host_test.go.html#7004618">t</a></span><span class="op" id="7004851">.</span><span class="ident" id="7004852">Errorf</span><span class="op" id="7004858">(</span><span class="string" id="7004859">&#34;expected&nbsp;status&nbsp;code&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7004892">,</span>&nbsp;<span class="ident" id="7004894"><a href="/net/http/cgi/host_test.go.html#7004816">e</a></span><span class="op" id="7004895">,</span>&nbsp;<span class="ident" id="7004897"><a href="/net/http/cgi/host_test.go.html#7004819">g</a></span><span class="op" id="7004898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7004901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7004904">if</span>&nbsp;<span class="ident" id="7004907">e</span><span class="op" id="7004908">,</span>&nbsp;<span class="ident" id="7004910">g</span>&nbsp;<span class="op" id="7004912">:=</span>&nbsp;<span class="string" id="7004915">&#34;http://foo.com/&#34;</span><span class="op" id="7004932">,</span>&nbsp;<span class="ident" id="7004934"><a href="/net/http/cgi/host_test.go.html#7004714">rec</a></span><span class="op" id="7004937">.</span><span class="ident" id="7004938">Header</span><span class="op" id="7004944">(</span><span class="op" id="7004945">)</span><span class="op" id="7004946">.</span><span class="ident" id="7004947">Get</span><span class="op" id="7004950">(</span><span class="string" id="7004951">&#34;Location&#34;</span><span class="op" id="7004961">)</span><span class="op" id="7004962">;</span>&nbsp;<span class="ident" id="7004964"><a href="/net/http/cgi/host_test.go.html#7004907">e</a></span>&nbsp;<span class="op" id="7004966">!=</span>&nbsp;<span class="ident" id="7004969"><a href="/net/http/cgi/host_test.go.html#7004910">g</a></span>&nbsp;<span class="op" id="7004971">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004975"><a href="/net/http/cgi/host_test.go.html#7004618">t</a></span><span class="op" id="7004976">.</span><span class="ident" id="7004977">Errorf</span><span class="op" id="7004983">(</span><span class="string" id="7004984">&#34;expected&nbsp;Location&nbsp;header&nbsp;of&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7005024">,</span>&nbsp;<span class="ident" id="7005026"><a href="/net/http/cgi/host_test.go.html#7004907">e</a></span><span class="op" id="7005027">,</span>&nbsp;<span class="ident" id="7005029"><a href="/net/http/cgi/host_test.go.html#7004910">g</a></span><span class="op" id="7005030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7005033">}</span><br>
<span class="lineno"></span><span class="op" id="7005035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7005038">func</span>&nbsp;<span class="ident" id="7005043">TestInternalRedirect</span><span class="op" id="7005063">(</span><span class="ident" id="7005064">t</span>&nbsp;<span class="op" id="7005066">*</span><span class="ident" id="7005067"><a href="/net/http/cgi/host_test.go.html#6998119">testing</a></span><span class="op" id="7005074">.</span><span class="ident" id="7005075">T</span><span class="op" id="7005076">)</span>&nbsp;<span class="op" id="7005078">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005081"><a href="/net/http/cgi/host_test.go.html#6999584">check</a></span><span class="op" id="7005086">(</span><span class="ident" id="7005087"><a href="/net/http/cgi/host_test.go.html#7005064">t</a></span><span class="op" id="7005088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005091">baseHandler</span>&nbsp;<span class="op" id="7005103">:=</span>&nbsp;<span class="ident" id="7005106"><a href="/net/http/cgi/host_test.go.html#6998019">http</a></span><span class="op" id="7005110">.</span><span class="ident" id="7005111">HandlerFunc</span><span class="op" id="7005122">(</span><span class="keyword" id="7005123">func</span><span class="op" id="7005127">(</span><span class="ident" id="7005128">rw</span>&nbsp;<span class="ident" id="7005131"><a href="/net/http/cgi/host_test.go.html#6998019">http</a></span><span class="op" id="7005135">.</span><span class="ident" id="7005136">ResponseWriter</span><span class="op" id="7005150">,</span>&nbsp;<span class="ident" id="7005152">req</span>&nbsp;<span class="op" id="7005156">*</span><span class="ident" id="7005157"><a href="/net/http/cgi/host_test.go.html#6998019">http</a></span><span class="op" id="7005161">.</span><span class="ident" id="7005162">Request</span><span class="op" id="7005169">)</span>&nbsp;<span class="op" id="7005171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005175"><a href="/net/http/cgi/host_test.go.html#6997999">fmt</a></span><span class="op" id="7005178">.</span><span class="ident" id="7005179">Fprintf</span><span class="op" id="7005186">(</span><span class="ident" id="7005187"><a href="/net/http/cgi/host_test.go.html#7005128">rw</a></span><span class="op" id="7005189">,</span>&nbsp;<span class="string" id="7005191">&#34;basepath=%s\n&#34;</span><span class="op" id="7005206">,</span>&nbsp;<span class="ident" id="7005208"><a href="/net/http/cgi/host_test.go.html#7005152">req</a></span><span class="op" id="7005211">.</span><span class="ident" id="7005212">URL</span><span class="op" id="7005215">.</span><span class="ident" id="7005216">Path</span><span class="op" id="7005220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005224"><a href="/net/http/cgi/host_test.go.html#6997999">fmt</a></span><span class="op" id="7005227">.</span><span class="ident" id="7005228">Fprintf</span><span class="op" id="7005235">(</span><span class="ident" id="7005236"><a href="/net/http/cgi/host_test.go.html#7005128">rw</a></span><span class="op" id="7005238">,</span>&nbsp;<span class="string" id="7005240">&#34;remoteaddr=%s\n&#34;</span><span class="op" id="7005257">,</span>&nbsp;<span class="ident" id="7005259"><a href="/net/http/cgi/host_test.go.html#7005152">req</a></span><span class="op" id="7005262">.</span><span class="ident" id="7005263">RemoteAddr</span><span class="op" id="7005273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7005276">}</span><span class="op" id="7005277">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005280">h</span>&nbsp;<span class="op" id="7005282">:=</span>&nbsp;<span class="op" id="7005285">&amp;</span><span class="ident" id="7005286"><a href="/net/http/cgi/host.go.html#6144504">Handler</a></span><span class="op" id="7005293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005297">Path</span><span class="op" id="7005301">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7005318">&#34;testdata/test.cgi&#34;</span><span class="op" id="7005337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005341">Root</span><span class="op" id="7005345">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7005362">&#34;/test.cgi&#34;</span><span class="op" id="7005373">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005377">PathLocationHandler</span><span class="op" id="7005396">:</span>&nbsp;<span class="ident" id="7005398"><a href="/net/http/cgi/host_test.go.html#7005091">baseHandler</a></span><span class="op" id="7005409">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7005412">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005415">expectedMap</span>&nbsp;<span class="op" id="7005427">:=</span>&nbsp;<span class="keyword" id="7005430">map</span><span class="op" id="7005433">[</span><span class="builtintype" id="7005434">string</span><span class="op" id="7005440">]</span><span class="builtintype" id="7005441">string</span><span class="op" id="7005447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7005451">&#34;basepath&#34;</span><span class="op" id="7005461">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7005465">&#34;/foo&#34;</span><span class="op" id="7005471">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7005475">&#34;remoteaddr&#34;</span><span class="op" id="7005487">:</span>&nbsp;<span class="string" id="7005489">&#34;1.2.3.4&#34;</span><span class="op" id="7005498">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7005501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005504"><a href="/net/http/cgi/host_test.go.html#6998398">runCgiTest</a></span><span class="op" id="7005514">(</span><span class="ident" id="7005515"><a href="/net/http/cgi/host_test.go.html#7005064">t</a></span><span class="op" id="7005516">,</span>&nbsp;<span class="ident" id="7005518"><a href="/net/http/cgi/host_test.go.html#7005280">h</a></span><span class="op" id="7005519">,</span>&nbsp;<span class="string" id="7005521">&#34;GET&nbsp;/test.cgi?loc=/foo&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7005577">,</span>&nbsp;<span class="ident" id="7005579"><a href="/net/http/cgi/host_test.go.html#7005415">expectedMap</a></span><span class="op" id="7005590">)</span><br>
<span class="lineno">295</span><span class="op" id="7005592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7005595">//&nbsp;TestCopyError&nbsp;tests&nbsp;that&nbsp;we&nbsp;kill&nbsp;the&nbsp;process&nbsp;if&nbsp;there&#39;s&nbsp;an&nbsp;error&nbsp;copying</span><br>
<span class="lineno"></span><span class="comment" id="7005671">//&nbsp;its&nbsp;output.&nbsp;(for&nbsp;example,&nbsp;from&nbsp;the&nbsp;client&nbsp;having&nbsp;gone&nbsp;away)</span><br>
<span class="lineno"></span><span class="keyword" id="7005734">func</span>&nbsp;<span class="ident" id="7005739">TestCopyError</span><span class="op" id="7005752">(</span><span class="ident" id="7005753">t</span>&nbsp;<span class="op" id="7005755">*</span><span class="ident" id="7005756"><a href="/net/http/cgi/host_test.go.html#6998119">testing</a></span><span class="op" id="7005763">.</span><span class="ident" id="7005764">T</span><span class="op" id="7005765">)</span>&nbsp;<span class="op" id="7005767">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005770"><a href="/net/http/cgi/host_test.go.html#6999584">check</a></span><span class="op" id="7005775">(</span><span class="ident" id="7005776"><a href="/net/http/cgi/host_test.go.html#7005753">t</a></span><span class="op" id="7005777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7005780">if</span>&nbsp;<span class="ident" id="7005783"><a href="/net/http/cgi/host_test.go.html#6998086">runtime</a></span><span class="op" id="7005790">.</span><span class="ident" id="7005791">GOOS</span>&nbsp;<span class="op" id="7005796">==</span>&nbsp;<span class="string" id="7005799">&#34;windows&#34;</span>&nbsp;<span class="op" id="7005809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005813"><a href="/net/http/cgi/host_test.go.html#7005753">t</a></span><span class="op" id="7005814">.</span><span class="ident" id="7005815">Skipf</span><span class="op" id="7005820">(</span><span class="string" id="7005821">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7005842">,</span>&nbsp;<span class="ident" id="7005844"><a href="/net/http/cgi/host_test.go.html#6998086">runtime</a></span><span class="op" id="7005851">.</span><span class="ident" id="7005852">GOOS</span><span class="op" id="7005856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7005859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005862">h</span>&nbsp;<span class="op" id="7005864">:=</span>&nbsp;<span class="op" id="7005867">&amp;</span><span class="ident" id="7005868"><a href="/net/http/cgi/host.go.html#6144504">Handler</a></span><span class="op" id="7005875">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005879">Path</span><span class="op" id="7005883">:</span>&nbsp;<span class="string" id="7005885">&#34;testdata/test.cgi&#34;</span><span class="op" id="7005904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005908">Root</span><span class="op" id="7005912">:</span>&nbsp;<span class="string" id="7005914">&#34;/test.cgi&#34;</span><span class="op" id="7005925">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7005928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005931">ts</span>&nbsp;<span class="op" id="7005934">:=</span>&nbsp;<span class="ident" id="7005937"><a href="/net/http/cgi/host_test.go.html#6998031">httptest</a></span><span class="op" id="7005945">.</span><span class="ident" id="7005946">NewServer</span><span class="op" id="7005955">(</span><span class="ident" id="7005956"><a href="/net/http/cgi/host_test.go.html#7005862">h</a></span><span class="op" id="7005957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7005960">defer</span>&nbsp;<span class="ident" id="7005966"><a href="/net/http/cgi/host_test.go.html#7005931">ts</a></span><span class="op" id="7005968">.</span><span class="ident" id="7005969">Close</span><span class="op" id="7005974">(</span><span class="op" id="7005975">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005979">conn</span><span class="op" id="7005983">,</span>&nbsp;<span class="ident" id="7005985">err</span>&nbsp;<span class="op" id="7005989">:=</span>&nbsp;<span class="ident" id="7005992"><a href="/net/http/cgi/host_test.go.html#6998012">net</a></span><span class="op" id="7005995">.</span><span class="ident" id="7005996">Dial</span><span class="op" id="7006000">(</span><span class="string" id="7006001">&#34;tcp&#34;</span><span class="op" id="7006006">,</span>&nbsp;<span class="ident" id="7006008"><a href="/net/http/cgi/host_test.go.html#7005931">ts</a></span><span class="op" id="7006010">.</span><span class="ident" id="7006011">Listener</span><span class="op" id="7006019">.</span><span class="ident" id="7006020">Addr</span><span class="op" id="7006024">(</span><span class="op" id="7006025">)</span><span class="op" id="7006026">.</span><span class="ident" id="7006027">String</span><span class="op" id="7006033">(</span><span class="op" id="7006034">)</span><span class="op" id="7006035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7006038">if</span>&nbsp;<span class="ident" id="7006041"><a href="/net/http/cgi/host_test.go.html#7005985">err</a></span>&nbsp;<span class="op" id="7006045">!=</span>&nbsp;<span class="ident" id="7006048">nil</span>&nbsp;<span class="op" id="7006052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006056"><a href="/net/http/cgi/host_test.go.html#7005753">t</a></span><span class="op" id="7006057">.</span><span class="ident" id="7006058">Fatal</span><span class="op" id="7006063">(</span><span class="ident" id="7006064"><a href="/net/http/cgi/host_test.go.html#7005985">err</a></span><span class="op" id="7006067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7006070">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006073">req</span><span class="op" id="7006076">,</span>&nbsp;<span class="ident" id="7006078">_</span>&nbsp;<span class="op" id="7006080">:=</span>&nbsp;<span class="ident" id="7006083"><a href="/net/http/cgi/host_test.go.html#6998019">http</a></span><span class="op" id="7006087">.</span><span class="ident" id="7006088">NewRequest</span><span class="op" id="7006098">(</span><span class="string" id="7006099">&#34;GET&#34;</span><span class="op" id="7006104">,</span>&nbsp;<span class="string" id="7006106">&#34;http://example.com/test.cgi?bigresponse=1&#34;</span><span class="op" id="7006149">,</span>&nbsp;<span class="ident" id="7006151">nil</span><span class="op" id="7006154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006157"><a href="/net/http/cgi/host_test.go.html#7005985">err</a></span>&nbsp;<span class="op" id="7006161">=</span>&nbsp;<span class="ident" id="7006163"><a href="/net/http/cgi/host_test.go.html#7006073">req</a></span><span class="op" id="7006166">.</span><span class="ident" id="7006167">Write</span><span class="op" id="7006172">(</span><span class="ident" id="7006173"><a href="/net/http/cgi/host_test.go.html#7005979">conn</a></span><span class="op" id="7006177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7006180">if</span>&nbsp;<span class="ident" id="7006183"><a href="/net/http/cgi/host_test.go.html#7005985">err</a></span>&nbsp;<span class="op" id="7006187">!=</span>&nbsp;<span class="ident" id="7006190">nil</span>&nbsp;<span class="op" id="7006194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006198"><a href="/net/http/cgi/host_test.go.html#7005753">t</a></span><span class="op" id="7006199">.</span><span class="ident" id="7006200">Fatalf</span><span class="op" id="7006206">(</span><span class="string" id="7006207">&#34;Write:&nbsp;%v&#34;</span><span class="op" id="7006218">,</span>&nbsp;<span class="ident" id="7006220"><a href="/net/http/cgi/host_test.go.html#7005985">err</a></span><span class="op" id="7006223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7006226">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006230">res</span><span class="op" id="7006233">,</span>&nbsp;<span class="ident" id="7006235"><a href="/net/http/cgi/host_test.go.html#7005985">err</a></span>&nbsp;<span class="op" id="7006239">:=</span>&nbsp;<span class="ident" id="7006242"><a href="/net/http/cgi/host_test.go.html#6998019">http</a></span><span class="op" id="7006246">.</span><span class="ident" id="7006247">ReadResponse</span><span class="op" id="7006259">(</span><span class="ident" id="7006260"><a href="/net/http/cgi/host_test.go.html#6997990">bufio</a></span><span class="op" id="7006265">.</span><span class="ident" id="7006266">NewReader</span><span class="op" id="7006275">(</span><span class="ident" id="7006276"><a href="/net/http/cgi/host_test.go.html#7005979">conn</a></span><span class="op" id="7006280">)</span><span class="op" id="7006281">,</span>&nbsp;<span class="ident" id="7006283"><a href="/net/http/cgi/host_test.go.html#7006073">req</a></span><span class="op" id="7006286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7006289">if</span>&nbsp;<span class="ident" id="7006292"><a href="/net/http/cgi/host_test.go.html#7005985">err</a></span>&nbsp;<span class="op" id="7006296">!=</span>&nbsp;<span class="ident" id="7006299">nil</span>&nbsp;<span class="op" id="7006303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006307"><a href="/net/http/cgi/host_test.go.html#7005753">t</a></span><span class="op" id="7006308">.</span><span class="ident" id="7006309">Fatalf</span><span class="op" id="7006315">(</span><span class="string" id="7006316">&#34;ReadResponse:&nbsp;%v&#34;</span><span class="op" id="7006334">,</span>&nbsp;<span class="ident" id="7006336"><a href="/net/http/cgi/host_test.go.html#7005985">err</a></span><span class="op" id="7006339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7006342">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006346">pidstr</span>&nbsp;<span class="op" id="7006353">:=</span>&nbsp;<span class="ident" id="7006356"><a href="/net/http/cgi/host_test.go.html#7006230">res</a></span><span class="op" id="7006359">.</span><span class="ident" id="7006360">Header</span><span class="op" id="7006366">.</span><span class="ident" id="7006367">Get</span><span class="op" id="7006370">(</span><span class="string" id="7006371">&#34;X-CGI-Pid&#34;</span><span class="op" id="7006382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7006385">if</span>&nbsp;<span class="ident" id="7006388"><a href="/net/http/cgi/host_test.go.html#7006346">pidstr</a></span>&nbsp;<span class="op" id="7006395">==</span>&nbsp;<span class="string" id="7006398">&#34;&#34;</span>&nbsp;<span class="op" id="7006401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006405"><a href="/net/http/cgi/host_test.go.html#7005753">t</a></span><span class="op" id="7006406">.</span><span class="ident" id="7006407">Fatalf</span><span class="op" id="7006413">(</span><span class="string" id="7006414">&#34;expected&nbsp;an&nbsp;X-CGI-Pid&nbsp;header&nbsp;in&nbsp;response&#34;</span><span class="op" id="7006456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7006459">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006462">pid</span><span class="op" id="7006465">,</span>&nbsp;<span class="ident" id="7006467"><a href="/net/http/cgi/host_test.go.html#7005985">err</a></span>&nbsp;<span class="op" id="7006471">:=</span>&nbsp;<span class="ident" id="7006474"><a href="/net/http/cgi/host_test.go.html#6998097">strconv</a></span><span class="op" id="7006481">.</span><span class="ident" id="7006482">Atoi</span><span class="op" id="7006486">(</span><span class="ident" id="7006487"><a href="/net/http/cgi/host_test.go.html#7006346">pidstr</a></span><span class="op" id="7006493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7006496">if</span>&nbsp;<span class="ident" id="7006499"><a href="/net/http/cgi/host_test.go.html#7005985">err</a></span>&nbsp;<span class="op" id="7006503">!=</span>&nbsp;<span class="ident" id="7006506">nil</span>&nbsp;<span class="op" id="7006510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006514"><a href="/net/http/cgi/host_test.go.html#7005753">t</a></span><span class="op" id="7006515">.</span><span class="ident" id="7006516">Fatalf</span><span class="op" id="7006522">(</span><span class="string" id="7006523">&#34;invalid&nbsp;X-CGI-Pid&nbsp;value&#34;</span><span class="op" id="7006548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7006551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7006555">var</span>&nbsp;<span class="ident" id="7006559">buf</span>&nbsp;<span class="op" id="7006563">[</span><span class="num" id="7006564">5000</span><span class="op" id="7006568">]</span><span class="builtintype" id="7006569">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006575">n</span><span class="op" id="7006576">,</span>&nbsp;<span class="ident" id="7006578"><a href="/net/http/cgi/host_test.go.html#7005985">err</a></span>&nbsp;<span class="op" id="7006582">:=</span>&nbsp;<span class="ident" id="7006585"><a href="/net/http/cgi/host_test.go.html#6998006">io</a></span><span class="op" id="7006587">.</span><span class="ident" id="7006588">ReadFull</span><span class="op" id="7006596">(</span><span class="ident" id="7006597"><a href="/net/http/cgi/host_test.go.html#7006230">res</a></span><span class="op" id="7006600">.</span><span class="ident" id="7006601">Body</span><span class="op" id="7006605">,</span>&nbsp;<span class="ident" id="7006607"><a href="/net/http/cgi/host_test.go.html#7006559">buf</a></span><span class="op" id="7006610">[</span><span class="op" id="7006611">:</span><span class="op" id="7006612">]</span><span class="op" id="7006613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7006616">if</span>&nbsp;<span class="ident" id="7006619"><a href="/net/http/cgi/host_test.go.html#7005985">err</a></span>&nbsp;<span class="op" id="7006623">!=</span>&nbsp;<span class="ident" id="7006626">nil</span>&nbsp;<span class="op" id="7006630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006634"><a href="/net/http/cgi/host_test.go.html#7005753">t</a></span><span class="op" id="7006635">.</span><span class="ident" id="7006636">Fatalf</span><span class="op" id="7006642">(</span><span class="string" id="7006643">&#34;ReadFull:&nbsp;%d&nbsp;bytes,&nbsp;%v&#34;</span><span class="op" id="7006667">,</span>&nbsp;<span class="ident" id="7006669"><a href="/net/http/cgi/host_test.go.html#7006575">n</a></span><span class="op" id="7006670">,</span>&nbsp;<span class="ident" id="7006672"><a href="/net/http/cgi/host_test.go.html#7005985">err</a></span><span class="op" id="7006675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7006678">}</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006682">childRunning</span>&nbsp;<span class="op" id="7006695">:=</span>&nbsp;<span class="keyword" id="7006698">func</span><span class="op" id="7006702">(</span><span class="op" id="7006703">)</span>&nbsp;<span class="builtintype" id="7006705">bool</span>&nbsp;<span class="op" id="7006710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7006714">return</span>&nbsp;<span class="ident" id="7006721"><a href="/net/http/cgi/posix_test.go.html#7015576">isProcessRunning</a></span><span class="op" id="7006737">(</span><span class="ident" id="7006738"><a href="/net/http/cgi/host_test.go.html#7005753">t</a></span><span class="op" id="7006739">,</span>&nbsp;<span class="ident" id="7006741"><a href="/net/http/cgi/host_test.go.html#7006462">pid</a></span><span class="op" id="7006744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7006747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7006751">if</span>&nbsp;<span class="op" id="7006754">!</span><span class="ident" id="7006755"><a href="/net/http/cgi/host_test.go.html#7006682">childRunning</a></span><span class="op" id="7006767">(</span><span class="op" id="7006768">)</span>&nbsp;<span class="op" id="7006770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006774"><a href="/net/http/cgi/host_test.go.html#7005753">t</a></span><span class="op" id="7006775">.</span><span class="ident" id="7006776">Fatalf</span><span class="op" id="7006782">(</span><span class="string" id="7006783">&#34;pre-conn.Close,&nbsp;expected&nbsp;child&nbsp;to&nbsp;be&nbsp;running&#34;</span><span class="op" id="7006829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7006832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006835"><a href="/net/http/cgi/host_test.go.html#7005979">conn</a></span><span class="op" id="7006839">.</span><span class="ident" id="7006840">Close</span><span class="op" id="7006845">(</span><span class="op" id="7006846">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006850">tries</span>&nbsp;<span class="op" id="7006856">:=</span>&nbsp;<span class="num" id="7006859">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7006862">for</span>&nbsp;<span class="ident" id="7006866"><a href="/net/http/cgi/host_test.go.html#7006850">tries</a></span>&nbsp;<span class="op" id="7006872">&lt;</span>&nbsp;<span class="num" id="7006874">25</span>&nbsp;<span class="op" id="7006877">&amp;&amp;</span>&nbsp;<span class="ident" id="7006880"><a href="/net/http/cgi/host_test.go.html#7006682">childRunning</a></span><span class="op" id="7006892">(</span><span class="op" id="7006893">)</span>&nbsp;<span class="op" id="7006895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006899"><a href="/net/http/cgi/host_test.go.html#6998130">time</a></span><span class="op" id="7006903">.</span><span class="ident" id="7006904">Sleep</span><span class="op" id="7006909">(</span><span class="num" id="7006910">50</span>&nbsp;<span class="op" id="7006913">*</span>&nbsp;<span class="ident" id="7006915"><a href="/net/http/cgi/host_test.go.html#6998130">time</a></span><span class="op" id="7006919">.</span><span class="ident" id="7006920">Millisecond</span>&nbsp;<span class="op" id="7006932">*</span>&nbsp;<span class="ident" id="7006934"><a href="/net/http/cgi/host_test.go.html#6998130">time</a></span><span class="op" id="7006938">.</span><span class="ident" id="7006939">Duration</span><span class="op" id="7006947">(</span><span class="ident" id="7006948"><a href="/net/http/cgi/host_test.go.html#7006850">tries</a></span><span class="op" id="7006953">)</span><span class="op" id="7006954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006958"><a href="/net/http/cgi/host_test.go.html#7006850">tries</a></span><span class="op" id="7006963">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7006967">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7006970">if</span>&nbsp;<span class="ident" id="7006973"><a href="/net/http/cgi/host_test.go.html#7006682">childRunning</a></span><span class="op" id="7006985">(</span><span class="op" id="7006986">)</span>&nbsp;<span class="op" id="7006988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006992"><a href="/net/http/cgi/host_test.go.html#7005753">t</a></span><span class="op" id="7006993">.</span><span class="ident" id="7006994">Fatalf</span><span class="op" id="7007000">(</span><span class="string" id="7007001">&#34;post-conn.Close,&nbsp;expected&nbsp;child&nbsp;to&nbsp;be&nbsp;gone&#34;</span><span class="op" id="7007045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7007048">}</span><br>
<span class="lineno"></span><span class="op" id="7007050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="keyword" id="7007053">func</span>&nbsp;<span class="ident" id="7007058">TestDirUnix</span><span class="op" id="7007069">(</span><span class="ident" id="7007070">t</span>&nbsp;<span class="op" id="7007072">*</span><span class="ident" id="7007073"><a href="/net/http/cgi/host_test.go.html#6998119">testing</a></span><span class="op" id="7007080">.</span><span class="ident" id="7007081">T</span><span class="op" id="7007082">)</span>&nbsp;<span class="op" id="7007084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007087"><a href="/net/http/cgi/host_test.go.html#6999584">check</a></span><span class="op" id="7007092">(</span><span class="ident" id="7007093"><a href="/net/http/cgi/host_test.go.html#7007070">t</a></span><span class="op" id="7007094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7007097">if</span>&nbsp;<span class="ident" id="7007100"><a href="/net/http/cgi/host_test.go.html#6998086">runtime</a></span><span class="op" id="7007107">.</span><span class="ident" id="7007108">GOOS</span>&nbsp;<span class="op" id="7007113">==</span>&nbsp;<span class="string" id="7007116">&#34;windows&#34;</span>&nbsp;<span class="op" id="7007126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007130"><a href="/net/http/cgi/host_test.go.html#7007070">t</a></span><span class="op" id="7007131">.</span><span class="ident" id="7007132">Skipf</span><span class="op" id="7007137">(</span><span class="string" id="7007138">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7007159">,</span>&nbsp;<span class="ident" id="7007161"><a href="/net/http/cgi/host_test.go.html#6998086">runtime</a></span><span class="op" id="7007168">.</span><span class="ident" id="7007169">GOOS</span><span class="op" id="7007173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7007176">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007179">cwd</span><span class="op" id="7007182">,</span>&nbsp;<span class="ident" id="7007184">_</span>&nbsp;<span class="op" id="7007186">:=</span>&nbsp;<span class="ident" id="7007189"><a href="/net/http/cgi/host_test.go.html#6998052">os</a></span><span class="op" id="7007191">.</span><span class="ident" id="7007192">Getwd</span><span class="op" id="7007197">(</span><span class="op" id="7007198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007201">h</span>&nbsp;<span class="op" id="7007203">:=</span>&nbsp;<span class="op" id="7007206">&amp;</span><span class="ident" id="7007207"><a href="/net/http/cgi/host.go.html#6144504">Handler</a></span><span class="op" id="7007214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007218">Path</span><span class="op" id="7007222">:</span>&nbsp;<span class="string" id="7007224">&#34;testdata/test.cgi&#34;</span><span class="op" id="7007243">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007247">Root</span><span class="op" id="7007251">:</span>&nbsp;<span class="string" id="7007253">&#34;/test.cgi&#34;</span><span class="op" id="7007264">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007268">Dir</span><span class="op" id="7007271">:</span>&nbsp;&nbsp;<span class="ident" id="7007274"><a href="/net/http/cgi/host_test.go.html#7007179">cwd</a></span><span class="op" id="7007277">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7007280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007283">expectedMap</span>&nbsp;<span class="op" id="7007295">:=</span>&nbsp;<span class="keyword" id="7007298">map</span><span class="op" id="7007301">[</span><span class="builtintype" id="7007302">string</span><span class="op" id="7007308">]</span><span class="builtintype" id="7007309">string</span><span class="op" id="7007315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7007319">&#34;cwd&#34;</span><span class="op" id="7007324">:</span>&nbsp;<span class="ident" id="7007326"><a href="/net/http/cgi/host_test.go.html#7007179">cwd</a></span><span class="op" id="7007329">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7007332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007335"><a href="/net/http/cgi/host_test.go.html#6998398">runCgiTest</a></span><span class="op" id="7007345">(</span><span class="ident" id="7007346"><a href="/net/http/cgi/host_test.go.html#7007070">t</a></span><span class="op" id="7007347">,</span>&nbsp;<span class="ident" id="7007349"><a href="/net/http/cgi/host_test.go.html#7007201">h</a></span><span class="op" id="7007350">,</span>&nbsp;<span class="string" id="7007352">&#34;GET&nbsp;/test.cgi&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7007399">,</span>&nbsp;<span class="ident" id="7007401"><a href="/net/http/cgi/host_test.go.html#7007283">expectedMap</a></span><span class="op" id="7007412">)</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007416"><a href="/net/http/cgi/host_test.go.html#7007179">cwd</a></span><span class="op" id="7007419">,</span>&nbsp;<span class="ident" id="7007421">_</span>&nbsp;<span class="op" id="7007423">=</span>&nbsp;<span class="ident" id="7007425"><a href="/net/http/cgi/host_test.go.html#6998052">os</a></span><span class="op" id="7007427">.</span><span class="ident" id="7007428">Getwd</span><span class="op" id="7007433">(</span><span class="op" id="7007434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007437"><a href="/net/http/cgi/host_test.go.html#7007179">cwd</a></span>&nbsp;<span class="op" id="7007441">=</span>&nbsp;<span class="ident" id="7007443"><a href="/net/http/cgi/host_test.go.html#6998069">filepath</a></span><span class="op" id="7007451">.</span><span class="ident" id="7007452">Join</span><span class="op" id="7007456">(</span><span class="ident" id="7007457"><a href="/net/http/cgi/host_test.go.html#7007179">cwd</a></span><span class="op" id="7007460">,</span>&nbsp;<span class="string" id="7007462">&#34;testdata&#34;</span><span class="op" id="7007472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007475"><a href="/net/http/cgi/host_test.go.html#7007201">h</a></span>&nbsp;<span class="op" id="7007477">=</span>&nbsp;<span class="op" id="7007479">&amp;</span><span class="ident" id="7007480"><a href="/net/http/cgi/host.go.html#6144504">Handler</a></span><span class="op" id="7007487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007491">Path</span><span class="op" id="7007495">:</span>&nbsp;<span class="string" id="7007497">&#34;testdata/test.cgi&#34;</span><span class="op" id="7007516">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007520">Root</span><span class="op" id="7007524">:</span>&nbsp;<span class="string" id="7007526">&#34;/test.cgi&#34;</span><span class="op" id="7007537">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7007540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007543"><a href="/net/http/cgi/host_test.go.html#7007283">expectedMap</a></span>&nbsp;<span class="op" id="7007555">=</span>&nbsp;<span class="keyword" id="7007557">map</span><span class="op" id="7007560">[</span><span class="builtintype" id="7007561">string</span><span class="op" id="7007567">]</span><span class="builtintype" id="7007568">string</span><span class="op" id="7007574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7007578">&#34;cwd&#34;</span><span class="op" id="7007583">:</span>&nbsp;<span class="ident" id="7007585"><a href="/net/http/cgi/host_test.go.html#7007179">cwd</a></span><span class="op" id="7007588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7007591">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007594"><a href="/net/http/cgi/host_test.go.html#6998398">runCgiTest</a></span><span class="op" id="7007604">(</span><span class="ident" id="7007605"><a href="/net/http/cgi/host_test.go.html#7007070">t</a></span><span class="op" id="7007606">,</span>&nbsp;<span class="ident" id="7007608"><a href="/net/http/cgi/host_test.go.html#7007201">h</a></span><span class="op" id="7007609">,</span>&nbsp;<span class="string" id="7007611">&#34;GET&nbsp;/test.cgi&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7007658">,</span>&nbsp;<span class="ident" id="7007660"><a href="/net/http/cgi/host_test.go.html#7007283">expectedMap</a></span><span class="op" id="7007671">)</span><br>
<span class="lineno"></span><span class="op" id="7007673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7007676">func</span>&nbsp;<span class="ident" id="7007681">TestDirWindows</span><span class="op" id="7007695">(</span><span class="ident" id="7007696">t</span>&nbsp;<span class="op" id="7007698">*</span><span class="ident" id="7007699"><a href="/net/http/cgi/host_test.go.html#6998119">testing</a></span><span class="op" id="7007706">.</span><span class="ident" id="7007707">T</span><span class="op" id="7007708">)</span>&nbsp;<span class="op" id="7007710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7007713">if</span>&nbsp;<span class="ident" id="7007716"><a href="/net/http/cgi/host_test.go.html#6998086">runtime</a></span><span class="op" id="7007723">.</span><span class="ident" id="7007724">GOOS</span>&nbsp;<span class="op" id="7007729">!=</span>&nbsp;<span class="string" id="7007732">&#34;windows&#34;</span>&nbsp;<span class="op" id="7007742">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007746"><a href="/net/http/cgi/host_test.go.html#7007696">t</a></span><span class="op" id="7007747">.</span><span class="ident" id="7007748">Skip</span><span class="op" id="7007752">(</span><span class="string" id="7007753">&#34;Skipping&nbsp;windows&nbsp;specific&nbsp;test.&#34;</span><span class="op" id="7007786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7007789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007793">cgifile</span><span class="op" id="7007800">,</span>&nbsp;<span class="ident" id="7007802">_</span>&nbsp;<span class="op" id="7007804">:=</span>&nbsp;<span class="ident" id="7007807"><a href="/net/http/cgi/host_test.go.html#6998069">filepath</a></span><span class="op" id="7007815">.</span><span class="ident" id="7007816">Abs</span><span class="op" id="7007819">(</span><span class="string" id="7007820">&#34;testdata/test.cgi&#34;</span><span class="op" id="7007839">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7007843">var</span>&nbsp;<span class="ident" id="7007847">perl</span>&nbsp;<span class="builtintype" id="7007852">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7007860">var</span>&nbsp;<span class="ident" id="7007864">err</span>&nbsp;<span class="builtintype" id="7007868">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007875"><a href="/net/http/cgi/host_test.go.html#7007847">perl</a></span><span class="op" id="7007879">,</span>&nbsp;<span class="ident" id="7007881"><a href="/net/http/cgi/host_test.go.html#7007864">err</a></span>&nbsp;<span class="op" id="7007885">=</span>&nbsp;<span class="ident" id="7007887"><a href="/net/http/cgi/host_test.go.html#6998058">exec</a></span><span class="op" id="7007891">.</span><span class="ident" id="7007892">LookPath</span><span class="op" id="7007900">(</span><span class="string" id="7007901">&#34;perl&#34;</span><span class="op" id="7007907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7007910">if</span>&nbsp;<span class="ident" id="7007913"><a href="/net/http/cgi/host_test.go.html#7007864">err</a></span>&nbsp;<span class="op" id="7007917">!=</span>&nbsp;<span class="ident" id="7007920">nil</span>&nbsp;<span class="op" id="7007924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007928"><a href="/net/http/cgi/host_test.go.html#7007696">t</a></span><span class="op" id="7007929">.</span><span class="ident" id="7007930">Skip</span><span class="op" id="7007934">(</span><span class="string" id="7007935">&#34;Skipping&nbsp;test:&nbsp;perl&nbsp;not&nbsp;found.&#34;</span><span class="op" id="7007967">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7007970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007973"><a href="/net/http/cgi/host_test.go.html#7007847">perl</a></span><span class="op" id="7007977">,</span>&nbsp;<span class="ident" id="7007979">_</span>&nbsp;<span class="op" id="7007981">=</span>&nbsp;<span class="ident" id="7007983"><a href="/net/http/cgi/host_test.go.html#6998069">filepath</a></span><span class="op" id="7007991">.</span><span class="ident" id="7007992">Abs</span><span class="op" id="7007995">(</span><span class="ident" id="7007996"><a href="/net/http/cgi/host_test.go.html#7007847">perl</a></span><span class="op" id="7008000">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008004">cwd</span><span class="op" id="7008007">,</span>&nbsp;<span class="ident" id="7008009">_</span>&nbsp;<span class="op" id="7008011">:=</span>&nbsp;<span class="ident" id="7008014"><a href="/net/http/cgi/host_test.go.html#6998052">os</a></span><span class="op" id="7008016">.</span><span class="ident" id="7008017">Getwd</span><span class="op" id="7008022">(</span><span class="op" id="7008023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008026">h</span>&nbsp;<span class="op" id="7008028">:=</span>&nbsp;<span class="op" id="7008031">&amp;</span><span class="ident" id="7008032"><a href="/net/http/cgi/host.go.html#6144504">Handler</a></span><span class="op" id="7008039">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008043">Path</span><span class="op" id="7008047">:</span>&nbsp;<span class="ident" id="7008049"><a href="/net/http/cgi/host_test.go.html#7007847">perl</a></span><span class="op" id="7008053">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008057">Root</span><span class="op" id="7008061">:</span>&nbsp;<span class="string" id="7008063">&#34;/test.cgi&#34;</span><span class="op" id="7008074">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008078">Dir</span><span class="op" id="7008081">:</span>&nbsp;&nbsp;<span class="ident" id="7008084"><a href="/net/http/cgi/host_test.go.html#7008004">cwd</a></span><span class="op" id="7008087">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008091">Args</span><span class="op" id="7008095">:</span>&nbsp;<span class="op" id="7008097">[</span><span class="op" id="7008098">]</span><span class="builtintype" id="7008099">string</span><span class="op" id="7008105">{</span><span class="ident" id="7008106"><a href="/net/http/cgi/host_test.go.html#7007793">cgifile</a></span><span class="op" id="7008113">}</span><span class="op" id="7008114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008118">Env</span><span class="op" id="7008121">:</span>&nbsp;&nbsp;<span class="op" id="7008124">[</span><span class="op" id="7008125">]</span><span class="builtintype" id="7008126">string</span><span class="op" id="7008132">{</span><span class="string" id="7008133">&#34;SCRIPT_FILENAME=&#34;</span>&nbsp;<span class="op" id="7008152">+</span>&nbsp;<span class="ident" id="7008154"><a href="/net/http/cgi/host_test.go.html#7007793">cgifile</a></span><span class="op" id="7008161">}</span><span class="op" id="7008162">,</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7008165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008168">expectedMap</span>&nbsp;<span class="op" id="7008180">:=</span>&nbsp;<span class="keyword" id="7008183">map</span><span class="op" id="7008186">[</span><span class="builtintype" id="7008187">string</span><span class="op" id="7008193">]</span><span class="builtintype" id="7008194">string</span><span class="op" id="7008200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7008204">&#34;cwd&#34;</span><span class="op" id="7008209">:</span>&nbsp;<span class="ident" id="7008211"><a href="/net/http/cgi/host_test.go.html#7008004">cwd</a></span><span class="op" id="7008214">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7008217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008220"><a href="/net/http/cgi/host_test.go.html#6998398">runCgiTest</a></span><span class="op" id="7008230">(</span><span class="ident" id="7008231"><a href="/net/http/cgi/host_test.go.html#7007696">t</a></span><span class="op" id="7008232">,</span>&nbsp;<span class="ident" id="7008234"><a href="/net/http/cgi/host_test.go.html#7008026">h</a></span><span class="op" id="7008235">,</span>&nbsp;<span class="string" id="7008237">&#34;GET&nbsp;/test.cgi&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7008284">,</span>&nbsp;<span class="ident" id="7008286"><a href="/net/http/cgi/host_test.go.html#7008168">expectedMap</a></span><span class="op" id="7008297">)</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7008301">//&nbsp;If&nbsp;not&nbsp;specify&nbsp;Dir&nbsp;on&nbsp;windows,&nbsp;working&nbsp;directory&nbsp;should&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7008364">//&nbsp;base&nbsp;directory&nbsp;of&nbsp;perl.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008392"><a href="/net/http/cgi/host_test.go.html#7008004">cwd</a></span><span class="op" id="7008395">,</span>&nbsp;<span class="ident" id="7008397">_</span>&nbsp;<span class="op" id="7008399">=</span>&nbsp;<span class="ident" id="7008401"><a href="/net/http/cgi/host_test.go.html#6998069">filepath</a></span><span class="op" id="7008409">.</span><span class="ident" id="7008410">Split</span><span class="op" id="7008415">(</span><span class="ident" id="7008416"><a href="/net/http/cgi/host_test.go.html#7007847">perl</a></span><span class="op" id="7008420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7008423">if</span>&nbsp;<span class="ident" id="7008426"><a href="/net/http/cgi/host_test.go.html#7008004">cwd</a></span>&nbsp;<span class="op" id="7008430">!=</span>&nbsp;<span class="string" id="7008433">&#34;&#34;</span>&nbsp;<span class="op" id="7008436">&amp;&amp;</span>&nbsp;<span class="ident" id="7008439"><a href="/net/http/cgi/host_test.go.html#7008004">cwd</a></span><span class="op" id="7008442">[</span><span class="builtinfunc" id="7008443">len</span><span class="op" id="7008446">(</span><span class="ident" id="7008447"><a href="/net/http/cgi/host_test.go.html#7008004">cwd</a></span><span class="op" id="7008450">)</span><span class="op" id="7008451">-</span><span class="num" id="7008452">1</span><span class="op" id="7008453">]</span>&nbsp;<span class="op" id="7008455">==</span>&nbsp;<span class="ident" id="7008458"><a href="/net/http/cgi/host_test.go.html#6998069">filepath</a></span><span class="op" id="7008466">.</span><span class="ident" id="7008467">Separator</span>&nbsp;<span class="op" id="7008477">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008481"><a href="/net/http/cgi/host_test.go.html#7008004">cwd</a></span>&nbsp;<span class="op" id="7008485">=</span>&nbsp;<span class="ident" id="7008487"><a href="/net/http/cgi/host_test.go.html#7008004">cwd</a></span><span class="op" id="7008490">[</span><span class="op" id="7008491">:</span><span class="builtinfunc" id="7008492">len</span><span class="op" id="7008495">(</span><span class="ident" id="7008496"><a href="/net/http/cgi/host_test.go.html#7008004">cwd</a></span><span class="op" id="7008499">)</span><span class="op" id="7008500">-</span><span class="num" id="7008501">1</span><span class="op" id="7008502">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7008505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008508"><a href="/net/http/cgi/host_test.go.html#7008026">h</a></span>&nbsp;<span class="op" id="7008510">=</span>&nbsp;<span class="op" id="7008512">&amp;</span><span class="ident" id="7008513"><a href="/net/http/cgi/host.go.html#6144504">Handler</a></span><span class="op" id="7008520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008524">Path</span><span class="op" id="7008528">:</span>&nbsp;<span class="ident" id="7008530"><a href="/net/http/cgi/host_test.go.html#7007847">perl</a></span><span class="op" id="7008534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008538">Root</span><span class="op" id="7008542">:</span>&nbsp;<span class="string" id="7008544">&#34;/test.cgi&#34;</span><span class="op" id="7008555">,</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008559">Args</span><span class="op" id="7008563">:</span>&nbsp;<span class="op" id="7008565">[</span><span class="op" id="7008566">]</span><span class="builtintype" id="7008567">string</span><span class="op" id="7008573">{</span><span class="ident" id="7008574"><a href="/net/http/cgi/host_test.go.html#7007793">cgifile</a></span><span class="op" id="7008581">}</span><span class="op" id="7008582">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008586">Env</span><span class="op" id="7008589">:</span>&nbsp;&nbsp;<span class="op" id="7008592">[</span><span class="op" id="7008593">]</span><span class="builtintype" id="7008594">string</span><span class="op" id="7008600">{</span><span class="string" id="7008601">&#34;SCRIPT_FILENAME=&#34;</span>&nbsp;<span class="op" id="7008620">+</span>&nbsp;<span class="ident" id="7008622"><a href="/net/http/cgi/host_test.go.html#7007793">cgifile</a></span><span class="op" id="7008629">}</span><span class="op" id="7008630">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7008633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008636"><a href="/net/http/cgi/host_test.go.html#7008168">expectedMap</a></span>&nbsp;<span class="op" id="7008648">=</span>&nbsp;<span class="keyword" id="7008650">map</span><span class="op" id="7008653">[</span><span class="builtintype" id="7008654">string</span><span class="op" id="7008660">]</span><span class="builtintype" id="7008661">string</span><span class="op" id="7008667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7008671">&#34;cwd&#34;</span><span class="op" id="7008676">:</span>&nbsp;<span class="ident" id="7008678"><a href="/net/http/cgi/host_test.go.html#7008004">cwd</a></span><span class="op" id="7008681">,</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7008684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008687"><a href="/net/http/cgi/host_test.go.html#6998398">runCgiTest</a></span><span class="op" id="7008697">(</span><span class="ident" id="7008698"><a href="/net/http/cgi/host_test.go.html#7007696">t</a></span><span class="op" id="7008699">,</span>&nbsp;<span class="ident" id="7008701"><a href="/net/http/cgi/host_test.go.html#7008026">h</a></span><span class="op" id="7008702">,</span>&nbsp;<span class="string" id="7008704">&#34;GET&nbsp;/test.cgi&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7008751">,</span>&nbsp;<span class="ident" id="7008753"><a href="/net/http/cgi/host_test.go.html#7008168">expectedMap</a></span><span class="op" id="7008764">)</span><br>
<span class="lineno"></span><span class="op" id="7008766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7008769">func</span>&nbsp;<span class="ident" id="7008774">TestEnvOverride</span><span class="op" id="7008789">(</span><span class="ident" id="7008790">t</span>&nbsp;<span class="op" id="7008792">*</span><span class="ident" id="7008793"><a href="/net/http/cgi/host_test.go.html#6998119">testing</a></span><span class="op" id="7008800">.</span><span class="ident" id="7008801">T</span><span class="op" id="7008802">)</span>&nbsp;<span class="op" id="7008804">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008807">cgifile</span><span class="op" id="7008814">,</span>&nbsp;<span class="ident" id="7008816">_</span>&nbsp;<span class="op" id="7008818">:=</span>&nbsp;<span class="ident" id="7008821"><a href="/net/http/cgi/host_test.go.html#6998069">filepath</a></span><span class="op" id="7008829">.</span><span class="ident" id="7008830">Abs</span><span class="op" id="7008833">(</span><span class="string" id="7008834">&#34;testdata/test.cgi&#34;</span><span class="op" id="7008853">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7008857">var</span>&nbsp;<span class="ident" id="7008861">perl</span>&nbsp;<span class="builtintype" id="7008866">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7008874">var</span>&nbsp;<span class="ident" id="7008878">err</span>&nbsp;<span class="builtintype" id="7008882">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008889"><a href="/net/http/cgi/host_test.go.html#7008861">perl</a></span><span class="op" id="7008893">,</span>&nbsp;<span class="ident" id="7008895"><a href="/net/http/cgi/host_test.go.html#7008878">err</a></span>&nbsp;<span class="op" id="7008899">=</span>&nbsp;<span class="ident" id="7008901"><a href="/net/http/cgi/host_test.go.html#6998058">exec</a></span><span class="op" id="7008905">.</span><span class="ident" id="7008906">LookPath</span><span class="op" id="7008914">(</span><span class="string" id="7008915">&#34;perl&#34;</span><span class="op" id="7008921">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7008924">if</span>&nbsp;<span class="ident" id="7008927"><a href="/net/http/cgi/host_test.go.html#7008878">err</a></span>&nbsp;<span class="op" id="7008931">!=</span>&nbsp;<span class="ident" id="7008934">nil</span>&nbsp;<span class="op" id="7008938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008942"><a href="/net/http/cgi/host_test.go.html#7008790">t</a></span><span class="op" id="7008943">.</span><span class="ident" id="7008944">Skipf</span><span class="op" id="7008949">(</span><span class="string" id="7008950">&#34;Skipping&nbsp;test:&nbsp;perl&nbsp;not&nbsp;found.&#34;</span><span class="op" id="7008982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7008985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008988"><a href="/net/http/cgi/host_test.go.html#7008861">perl</a></span><span class="op" id="7008992">,</span>&nbsp;<span class="ident" id="7008994">_</span>&nbsp;<span class="op" id="7008996">=</span>&nbsp;<span class="ident" id="7008998"><a href="/net/http/cgi/host_test.go.html#6998069">filepath</a></span><span class="op" id="7009006">.</span><span class="ident" id="7009007">Abs</span><span class="op" id="7009010">(</span><span class="ident" id="7009011"><a href="/net/http/cgi/host_test.go.html#7008861">perl</a></span><span class="op" id="7009015">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009019">cwd</span><span class="op" id="7009022">,</span>&nbsp;<span class="ident" id="7009024">_</span>&nbsp;<span class="op" id="7009026">:=</span>&nbsp;<span class="ident" id="7009029"><a href="/net/http/cgi/host_test.go.html#6998052">os</a></span><span class="op" id="7009031">.</span><span class="ident" id="7009032">Getwd</span><span class="op" id="7009037">(</span><span class="op" id="7009038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009041">h</span>&nbsp;<span class="op" id="7009043">:=</span>&nbsp;<span class="op" id="7009046">&amp;</span><span class="ident" id="7009047"><a href="/net/http/cgi/host.go.html#6144504">Handler</a></span><span class="op" id="7009054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009058">Path</span><span class="op" id="7009062">:</span>&nbsp;<span class="ident" id="7009064"><a href="/net/http/cgi/host_test.go.html#7008861">perl</a></span><span class="op" id="7009068">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009072">Root</span><span class="op" id="7009076">:</span>&nbsp;<span class="string" id="7009078">&#34;/test.cgi&#34;</span><span class="op" id="7009089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009093">Dir</span><span class="op" id="7009096">:</span>&nbsp;&nbsp;<span class="ident" id="7009099"><a href="/net/http/cgi/host_test.go.html#7009019">cwd</a></span><span class="op" id="7009102">,</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009106">Args</span><span class="op" id="7009110">:</span>&nbsp;<span class="op" id="7009112">[</span><span class="op" id="7009113">]</span><span class="builtintype" id="7009114">string</span><span class="op" id="7009120">{</span><span class="ident" id="7009121"><a href="/net/http/cgi/host_test.go.html#7008807">cgifile</a></span><span class="op" id="7009128">}</span><span class="op" id="7009129">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009133">Env</span><span class="op" id="7009136">:</span>&nbsp;<span class="op" id="7009138">[</span><span class="op" id="7009139">]</span><span class="builtintype" id="7009140">string</span><span class="op" id="7009146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7009151">&#34;SCRIPT_FILENAME=&#34;</span>&nbsp;<span class="op" id="7009170">+</span>&nbsp;<span class="ident" id="7009172"><a href="/net/http/cgi/host_test.go.html#7008807">cgifile</a></span><span class="op" id="7009179">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7009184">&#34;REQUEST_URI=/foo/bar&#34;</span><span class="op" id="7009206">}</span><span class="op" id="7009207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7009210">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009213">expectedMap</span>&nbsp;<span class="op" id="7009225">:=</span>&nbsp;<span class="keyword" id="7009228">map</span><span class="op" id="7009231">[</span><span class="builtintype" id="7009232">string</span><span class="op" id="7009238">]</span><span class="builtintype" id="7009239">string</span><span class="op" id="7009245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7009249">&#34;cwd&#34;</span><span class="op" id="7009254">:</span>&nbsp;<span class="ident" id="7009256"><a href="/net/http/cgi/host_test.go.html#7009019">cwd</a></span><span class="op" id="7009259">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7009263">&#34;env-SCRIPT_FILENAME&#34;</span><span class="op" id="7009284">:</span>&nbsp;<span class="ident" id="7009286"><a href="/net/http/cgi/host_test.go.html#7008807">cgifile</a></span><span class="op" id="7009293">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7009297">&#34;env-REQUEST_URI&#34;</span><span class="op" id="7009314">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7009320">&#34;/foo/bar&#34;</span><span class="op" id="7009330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7009333">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009336"><a href="/net/http/cgi/host_test.go.html#6998398">runCgiTest</a></span><span class="op" id="7009346">(</span><span class="ident" id="7009347"><a href="/net/http/cgi/host_test.go.html#7008790">t</a></span><span class="op" id="7009348">,</span>&nbsp;<span class="ident" id="7009350"><a href="/net/http/cgi/host_test.go.html#7009041">h</a></span><span class="op" id="7009351">,</span>&nbsp;<span class="string" id="7009353">&#34;GET&nbsp;/test.cgi&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7009400">,</span>&nbsp;<span class="ident" id="7009402"><a href="/net/http/cgi/host_test.go.html#7009213">expectedMap</a></span><span class="op" id="7009413">)</span><br>
<span class="lineno"></span><span class="op" id="7009415">}</span>
</div>
</body>
</html>
