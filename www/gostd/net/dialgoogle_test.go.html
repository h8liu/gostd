<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6569258">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6569313">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6569367">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6569418">package</span>&nbsp;<span class="ident" id="6569426">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6569431">import</span>&nbsp;<span class="op" id="6569438">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6569441">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6569449">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6569456">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6569462">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6569473">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6569484">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6569494">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="6569497">//&nbsp;If&nbsp;an&nbsp;IPv6&nbsp;tunnel&nbsp;is&nbsp;running,&nbsp;we&nbsp;can&nbsp;try&nbsp;dialing&nbsp;a&nbsp;real&nbsp;IPv6&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="6569570">var</span>&nbsp;<span class="ident" id="6569574">testIPv6</span>&nbsp;<span class="op" id="6569583">=</span>&nbsp;<span class="ident" id="6569585">flag</span><span class="op" id="6569589">.</span><span class="ident" id="6569590">Bool</span><span class="op" id="6569594">(</span><span class="string" id="6569595">&#34;ipv6&#34;</span><span class="op" id="6569601">,</span>&nbsp;<span class="builtintype" id="6569603">false</span><span class="op" id="6569608">,</span>&nbsp;<span class="string" id="6569610">&#34;assume&nbsp;ipv6&nbsp;tunnel&nbsp;is&nbsp;present&#34;</span><span class="op" id="6569641">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6569644">func</span>&nbsp;<span class="ident" id="6569649">TestResolveGoogle</span><span class="op" id="6569666">(</span><span class="ident" id="6569667">t</span>&nbsp;<span class="op" id="6569669">*</span><span class="ident" id="6569670">testing</span><span class="op" id="6569677">.</span><span class="ident" id="6569678">T</span><span class="op" id="6569679">)</span>&nbsp;<span class="op" id="6569681">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6569684">if</span>&nbsp;<span class="ident" id="6569687">testing</span><span class="op" id="6569694">.</span><span class="ident" id="6569695">Short</span><span class="op" id="6569700">(</span><span class="op" id="6569701">)</span>&nbsp;<span class="op" id="6569703">||</span>&nbsp;<span class="op" id="6569706">!</span><span class="op" id="6569707">*</span><span class="ident" id="6569708">testExternal</span>&nbsp;<span class="op" id="6569721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6569725">t</span><span class="op" id="6569726">.</span><span class="ident" id="6569727">Skip</span><span class="op" id="6569731">(</span><span class="string" id="6569732">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6569773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6569776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6569780">for</span>&nbsp;<span class="ident" id="6569784">_</span><span class="op" id="6569785">,</span>&nbsp;<span class="ident" id="6569787">network</span>&nbsp;<span class="op" id="6569795">:=</span>&nbsp;<span class="keyword" id="6569798">range</span>&nbsp;<span class="op" id="6569804">[</span><span class="op" id="6569805">]</span><span class="builtintype" id="6569806">string</span><span class="op" id="6569812">{</span><span class="string" id="6569813">&#34;tcp&#34;</span><span class="op" id="6569818">,</span>&nbsp;<span class="string" id="6569820">&#34;tcp4&#34;</span><span class="op" id="6569826">,</span>&nbsp;<span class="string" id="6569828">&#34;tcp6&#34;</span><span class="op" id="6569834">}</span>&nbsp;<span class="op" id="6569836">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6569840">addr</span><span class="op" id="6569844">,</span>&nbsp;<span class="ident" id="6569846">err</span>&nbsp;<span class="op" id="6569850">:=</span>&nbsp;<span class="ident" id="6569853">ResolveTCPAddr</span><span class="op" id="6569867">(</span><span class="ident" id="6569868">network</span><span class="op" id="6569875">,</span>&nbsp;<span class="string" id="6569877">&#34;www.google.com:http&#34;</span><span class="op" id="6569898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6569902">if</span>&nbsp;<span class="ident" id="6569905">err</span>&nbsp;<span class="op" id="6569909">!=</span>&nbsp;<span class="ident" id="6569912">nil</span>&nbsp;<span class="op" id="6569916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6569921">if</span>&nbsp;<span class="op" id="6569924">(</span><span class="ident" id="6569925">network</span>&nbsp;<span class="op" id="6569933">==</span>&nbsp;<span class="string" id="6569936">&#34;tcp&#34;</span>&nbsp;<span class="op" id="6569942">||</span>&nbsp;<span class="ident" id="6569945">network</span>&nbsp;<span class="op" id="6569953">==</span>&nbsp;<span class="string" id="6569956">&#34;tcp4&#34;</span><span class="op" id="6569962">)</span>&nbsp;<span class="op" id="6569964">&amp;&amp;</span>&nbsp;<span class="op" id="6569967">!</span><span class="ident" id="6569968">supportsIPv4</span>&nbsp;<span class="op" id="6569981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6569987">t</span><span class="op" id="6569988">.</span><span class="ident" id="6569989">Logf</span><span class="op" id="6569993">(</span><span class="string" id="6569994">&#34;ipv4&nbsp;is&nbsp;not&nbsp;supported:&nbsp;%v&#34;</span><span class="op" id="6570021">,</span>&nbsp;<span class="ident" id="6570023">err</span><span class="op" id="6570026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6570031">}</span>&nbsp;<span class="keyword" id="6570033">else</span>&nbsp;<span class="keyword" id="6570038">if</span>&nbsp;<span class="ident" id="6570041">network</span>&nbsp;<span class="op" id="6570049">==</span>&nbsp;<span class="string" id="6570052">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="6570059">&amp;&amp;</span>&nbsp;<span class="op" id="6570062">!</span><span class="ident" id="6570063">supportsIPv6</span>&nbsp;<span class="op" id="6570076">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570082">t</span><span class="op" id="6570083">.</span><span class="ident" id="6570084">Logf</span><span class="op" id="6570088">(</span><span class="string" id="6570089">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported:&nbsp;%v&#34;</span><span class="op" id="6570116">,</span>&nbsp;<span class="ident" id="6570118">err</span><span class="op" id="6570121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6570126">}</span>&nbsp;<span class="keyword" id="6570128">else</span>&nbsp;<span class="op" id="6570133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570139">t</span><span class="op" id="6570140">.</span><span class="ident" id="6570141">Errorf</span><span class="op" id="6570147">(</span><span class="string" id="6570148">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6570175">,</span>&nbsp;<span class="ident" id="6570177">err</span><span class="op" id="6570180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6570185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6570190">continue</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6570201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6570205">if</span>&nbsp;<span class="op" id="6570208">(</span><span class="ident" id="6570209">network</span>&nbsp;<span class="op" id="6570217">==</span>&nbsp;<span class="string" id="6570220">&#34;tcp&#34;</span>&nbsp;<span class="op" id="6570226">||</span>&nbsp;<span class="ident" id="6570229">network</span>&nbsp;<span class="op" id="6570237">==</span>&nbsp;<span class="string" id="6570240">&#34;tcp4&#34;</span><span class="op" id="6570246">)</span>&nbsp;<span class="op" id="6570248">&amp;&amp;</span>&nbsp;<span class="ident" id="6570251">addr</span><span class="op" id="6570255">.</span><span class="ident" id="6570256">IP</span><span class="op" id="6570258">.</span><span class="ident" id="6570259">To4</span><span class="op" id="6570262">(</span><span class="op" id="6570263">)</span>&nbsp;<span class="op" id="6570265">==</span>&nbsp;<span class="ident" id="6570268">nil</span>&nbsp;<span class="op" id="6570272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570277">t</span><span class="op" id="6570278">.</span><span class="ident" id="6570279">Errorf</span><span class="op" id="6570285">(</span><span class="string" id="6570286">&#34;got&nbsp;%v;&nbsp;expected&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;on&nbsp;%v&#34;</span><span class="op" id="6570326">,</span>&nbsp;<span class="ident" id="6570328">addr</span><span class="op" id="6570332">,</span>&nbsp;<span class="ident" id="6570334">network</span><span class="op" id="6570341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6570345">}</span>&nbsp;<span class="keyword" id="6570347">else</span>&nbsp;<span class="keyword" id="6570352">if</span>&nbsp;<span class="ident" id="6570355">network</span>&nbsp;<span class="op" id="6570363">==</span>&nbsp;<span class="string" id="6570366">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="6570373">&amp;&amp;</span>&nbsp;<span class="op" id="6570376">(</span><span class="ident" id="6570377">addr</span><span class="op" id="6570381">.</span><span class="ident" id="6570382">IP</span><span class="op" id="6570384">.</span><span class="ident" id="6570385">To16</span><span class="op" id="6570389">(</span><span class="op" id="6570390">)</span>&nbsp;<span class="op" id="6570392">==</span>&nbsp;<span class="ident" id="6570395">nil</span>&nbsp;<span class="op" id="6570399">||</span>&nbsp;<span class="ident" id="6570402">addr</span><span class="op" id="6570406">.</span><span class="ident" id="6570407">IP</span><span class="op" id="6570409">.</span><span class="ident" id="6570410">To4</span><span class="op" id="6570413">(</span><span class="op" id="6570414">)</span>&nbsp;<span class="op" id="6570416">!=</span>&nbsp;<span class="ident" id="6570419">nil</span><span class="op" id="6570422">)</span>&nbsp;<span class="op" id="6570424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570429">t</span><span class="op" id="6570430">.</span><span class="ident" id="6570431">Errorf</span><span class="op" id="6570437">(</span><span class="string" id="6570438">&#34;got&nbsp;%v;&nbsp;expected&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;on&nbsp;%v&#34;</span><span class="op" id="6570478">,</span>&nbsp;<span class="ident" id="6570480">addr</span><span class="op" id="6570484">,</span>&nbsp;<span class="ident" id="6570486">network</span><span class="op" id="6570493">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6570497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6570500">}</span><br>
<span class="lineno"></span><span class="op" id="6570502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6570505">func</span>&nbsp;<span class="ident" id="6570510">TestDialGoogle</span><span class="op" id="6570524">(</span><span class="ident" id="6570525">t</span>&nbsp;<span class="op" id="6570527">*</span><span class="ident" id="6570528">testing</span><span class="op" id="6570535">.</span><span class="ident" id="6570536">T</span><span class="op" id="6570537">)</span>&nbsp;<span class="op" id="6570539">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6570542">if</span>&nbsp;<span class="ident" id="6570545">testing</span><span class="op" id="6570552">.</span><span class="ident" id="6570553">Short</span><span class="op" id="6570558">(</span><span class="op" id="6570559">)</span>&nbsp;<span class="op" id="6570561">||</span>&nbsp;<span class="op" id="6570564">!</span><span class="op" id="6570565">*</span><span class="ident" id="6570566">testExternal</span>&nbsp;<span class="op" id="6570579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570583">t</span><span class="op" id="6570584">.</span><span class="ident" id="6570585">Skip</span><span class="op" id="6570589">(</span><span class="string" id="6570590">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6570631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6570634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570638">d</span>&nbsp;<span class="op" id="6570640">:=</span>&nbsp;<span class="op" id="6570643">&amp;</span><span class="ident" id="6570644">Dialer</span><span class="op" id="6570650">{</span><span class="ident" id="6570651">DualStack</span><span class="op" id="6570660">:</span>&nbsp;<span class="builtintype" id="6570662">true</span><span class="op" id="6570666">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6570669">for</span>&nbsp;<span class="ident" id="6570673">_</span><span class="op" id="6570674">,</span>&nbsp;<span class="ident" id="6570676">network</span>&nbsp;<span class="op" id="6570684">:=</span>&nbsp;<span class="keyword" id="6570687">range</span>&nbsp;<span class="op" id="6570693">[</span><span class="op" id="6570694">]</span><span class="builtintype" id="6570695">string</span><span class="op" id="6570701">{</span><span class="string" id="6570702">&#34;tcp&#34;</span><span class="op" id="6570707">,</span>&nbsp;<span class="string" id="6570709">&#34;tcp4&#34;</span><span class="op" id="6570715">,</span>&nbsp;<span class="string" id="6570717">&#34;tcp6&#34;</span><span class="op" id="6570723">}</span>&nbsp;<span class="op" id="6570725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6570729">if</span>&nbsp;<span class="ident" id="6570732">network</span>&nbsp;<span class="op" id="6570740">==</span>&nbsp;<span class="string" id="6570743">&#34;tcp&#34;</span>&nbsp;<span class="op" id="6570749">&amp;&amp;</span>&nbsp;<span class="op" id="6570752">!</span><span class="ident" id="6570753">supportsIPv4</span>&nbsp;<span class="op" id="6570766">&amp;&amp;</span>&nbsp;<span class="op" id="6570769">!</span><span class="ident" id="6570770">supportsIPv6</span>&nbsp;<span class="op" id="6570783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570788">t</span><span class="op" id="6570789">.</span><span class="ident" id="6570790">Logf</span><span class="op" id="6570794">(</span><span class="string" id="6570795">&#34;skipping&nbsp;test;&nbsp;both&nbsp;ipv4&nbsp;and&nbsp;ipv6&nbsp;are&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6570848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6570853">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6570864">}</span>&nbsp;<span class="keyword" id="6570866">else</span>&nbsp;<span class="keyword" id="6570871">if</span>&nbsp;<span class="ident" id="6570874">network</span>&nbsp;<span class="op" id="6570882">==</span>&nbsp;<span class="string" id="6570885">&#34;tcp4&#34;</span>&nbsp;<span class="op" id="6570892">&amp;&amp;</span>&nbsp;<span class="op" id="6570895">!</span><span class="ident" id="6570896">supportsIPv4</span>&nbsp;<span class="op" id="6570909">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6570914">t</span><span class="op" id="6570915">.</span><span class="ident" id="6570916">Logf</span><span class="op" id="6570920">(</span><span class="string" id="6570921">&#34;skipping&nbsp;test;&nbsp;ipv4&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6570959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6570964">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6570975">}</span>&nbsp;<span class="keyword" id="6570977">else</span>&nbsp;<span class="keyword" id="6570982">if</span>&nbsp;<span class="ident" id="6570985">network</span>&nbsp;<span class="op" id="6570993">==</span>&nbsp;<span class="string" id="6570996">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="6571003">&amp;&amp;</span>&nbsp;<span class="op" id="6571006">!</span><span class="ident" id="6571007">supportsIPv6</span>&nbsp;<span class="op" id="6571020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6571025">t</span><span class="op" id="6571026">.</span><span class="ident" id="6571027">Logf</span><span class="op" id="6571031">(</span><span class="string" id="6571032">&#34;skipping&nbsp;test;&nbsp;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6571070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6571075">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6571086">}</span>&nbsp;<span class="keyword" id="6571088">else</span>&nbsp;<span class="keyword" id="6571093">if</span>&nbsp;<span class="ident" id="6571096">network</span>&nbsp;<span class="op" id="6571104">==</span>&nbsp;<span class="string" id="6571107">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="6571114">&amp;&amp;</span>&nbsp;<span class="op" id="6571117">!</span><span class="op" id="6571118">*</span><span class="ident" id="6571119">testIPv6</span>&nbsp;<span class="op" id="6571128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6571133">t</span><span class="op" id="6571134">.</span><span class="ident" id="6571135">Logf</span><span class="op" id="6571139">(</span><span class="string" id="6571140">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-ipv6&nbsp;to&nbsp;enable&#34;</span><span class="op" id="6571176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6571181">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6571192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6571196">if</span>&nbsp;<span class="ident" id="6571199">c</span><span class="op" id="6571200">,</span>&nbsp;<span class="ident" id="6571202">err</span>&nbsp;<span class="op" id="6571206">:=</span>&nbsp;<span class="ident" id="6571209">d</span><span class="op" id="6571210">.</span><span class="ident" id="6571211">Dial</span><span class="op" id="6571215">(</span><span class="ident" id="6571216">network</span><span class="op" id="6571223">,</span>&nbsp;<span class="string" id="6571225">&#34;www.google.com:http&#34;</span><span class="op" id="6571246">)</span><span class="op" id="6571247">;</span>&nbsp;<span class="ident" id="6571249">err</span>&nbsp;<span class="op" id="6571253">!=</span>&nbsp;<span class="ident" id="6571256">nil</span>&nbsp;<span class="op" id="6571260">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6571265">t</span><span class="op" id="6571266">.</span><span class="ident" id="6571267">Errorf</span><span class="op" id="6571273">(</span><span class="string" id="6571274">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6571291">,</span>&nbsp;<span class="ident" id="6571293">err</span><span class="op" id="6571296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6571300">}</span>&nbsp;<span class="keyword" id="6571302">else</span>&nbsp;<span class="op" id="6571307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6571312">c</span><span class="op" id="6571313">.</span><span class="ident" id="6571314">Close</span><span class="op" id="6571319">(</span><span class="op" id="6571320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6571324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6571327">}</span><br>
<span class="lineno">70</span><span class="op" id="6571329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6571332">//&nbsp;fd&nbsp;is&nbsp;already&nbsp;connected&nbsp;to&nbsp;the&nbsp;destination,&nbsp;port&nbsp;80.</span><br>
<span class="lineno"></span><span class="comment" id="6571388">//&nbsp;Run&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;to&nbsp;fetch&nbsp;the&nbsp;appropriate&nbsp;page.</span><br>
<span class="lineno"></span><span class="keyword" id="6571442">func</span>&nbsp;<span class="ident" id="6571447">fetchGoogle</span><span class="op" id="6571458">(</span><span class="ident" id="6571459">t</span>&nbsp;<span class="op" id="6571461">*</span><span class="ident" id="6571462">testing</span><span class="op" id="6571469">.</span><span class="ident" id="6571470">T</span><span class="op" id="6571471">,</span>&nbsp;<span class="ident" id="6571473">fd</span>&nbsp;<span class="ident" id="6571476">Conn</span><span class="op" id="6571480">,</span>&nbsp;<span class="ident" id="6571482">network</span><span class="op" id="6571489">,</span>&nbsp;<span class="ident" id="6571491">addr</span>&nbsp;<span class="builtintype" id="6571496">string</span><span class="op" id="6571502">)</span>&nbsp;<span class="op" id="6571504">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6571507">req</span>&nbsp;<span class="op" id="6571511">:=</span>&nbsp;<span class="op" id="6571514">[</span><span class="op" id="6571515">]</span><span class="builtintype" id="6571516">byte</span><span class="op" id="6571520">(</span><span class="string" id="6571521">&#34;GET&nbsp;/robots.txt&nbsp;HTTP/1.0\r\nHost:&nbsp;www.google.com\r\n\r\n&#34;</span><span class="op" id="6571579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6571582">n</span><span class="op" id="6571583">,</span>&nbsp;<span class="ident" id="6571585">err</span>&nbsp;<span class="op" id="6571589">:=</span>&nbsp;<span class="ident" id="6571592">fd</span><span class="op" id="6571594">.</span><span class="ident" id="6571595">Write</span><span class="op" id="6571600">(</span><span class="ident" id="6571601">req</span><span class="op" id="6571604">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6571608">buf</span>&nbsp;<span class="op" id="6571612">:=</span>&nbsp;<span class="builtinfunc" id="6571615">make</span><span class="op" id="6571619">(</span><span class="op" id="6571620">[</span><span class="op" id="6571621">]</span><span class="builtintype" id="6571622">byte</span><span class="op" id="6571626">,</span>&nbsp;<span class="num" id="6571628">1000</span><span class="op" id="6571632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6571635">n</span><span class="op" id="6571636">,</span>&nbsp;<span class="ident" id="6571638">err</span>&nbsp;<span class="op" id="6571642">=</span>&nbsp;<span class="ident" id="6571644">io</span><span class="op" id="6571646">.</span><span class="ident" id="6571647">ReadFull</span><span class="op" id="6571655">(</span><span class="ident" id="6571656">fd</span><span class="op" id="6571658">,</span>&nbsp;<span class="ident" id="6571660">buf</span><span class="op" id="6571663">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6571667">if</span>&nbsp;<span class="ident" id="6571670">n</span>&nbsp;<span class="op" id="6571672">&lt;</span>&nbsp;<span class="num" id="6571674">1000</span>&nbsp;<span class="op" id="6571679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6571683">t</span><span class="op" id="6571684">.</span><span class="ident" id="6571685">Errorf</span><span class="op" id="6571691">(</span><span class="string" id="6571692">&#34;fetchGoogle:&nbsp;short&nbsp;HTTP&nbsp;read&nbsp;from&nbsp;%s&nbsp;%s&nbsp;-&nbsp;%v&#34;</span><span class="op" id="6571738">,</span>&nbsp;<span class="ident" id="6571740">network</span><span class="op" id="6571747">,</span>&nbsp;<span class="ident" id="6571749">addr</span><span class="op" id="6571753">,</span>&nbsp;<span class="ident" id="6571755">err</span><span class="op" id="6571758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6571762">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6571770">}</span><br>
<span class="lineno">85</span><span class="op" id="6571772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6571775">func</span>&nbsp;<span class="ident" id="6571780">doDial</span><span class="op" id="6571786">(</span><span class="ident" id="6571787">t</span>&nbsp;<span class="op" id="6571789">*</span><span class="ident" id="6571790">testing</span><span class="op" id="6571797">.</span><span class="ident" id="6571798">T</span><span class="op" id="6571799">,</span>&nbsp;<span class="ident" id="6571801">network</span><span class="op" id="6571808">,</span>&nbsp;<span class="ident" id="6571810">addr</span>&nbsp;<span class="builtintype" id="6571815">string</span><span class="op" id="6571821">)</span>&nbsp;<span class="op" id="6571823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6571826">fd</span><span class="op" id="6571828">,</span>&nbsp;<span class="ident" id="6571830">err</span>&nbsp;<span class="op" id="6571834">:=</span>&nbsp;<span class="ident" id="6571837">Dial</span><span class="op" id="6571841">(</span><span class="ident" id="6571842">network</span><span class="op" id="6571849">,</span>&nbsp;<span class="ident" id="6571851">addr</span><span class="op" id="6571855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6571858">if</span>&nbsp;<span class="ident" id="6571861">err</span>&nbsp;<span class="op" id="6571865">!=</span>&nbsp;<span class="ident" id="6571868">nil</span>&nbsp;<span class="op" id="6571872">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6571876">t</span><span class="op" id="6571877">.</span><span class="ident" id="6571878">Errorf</span><span class="op" id="6571884">(</span><span class="string" id="6571885">&#34;Dial(%q,&nbsp;%q,&nbsp;%q)&nbsp;=&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="6571911">,</span>&nbsp;<span class="ident" id="6571913">network</span><span class="op" id="6571920">,</span>&nbsp;<span class="string" id="6571922">&#34;&#34;</span><span class="op" id="6571924">,</span>&nbsp;<span class="ident" id="6571926">addr</span><span class="op" id="6571930">,</span>&nbsp;<span class="ident" id="6571932">err</span><span class="op" id="6571935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6571939">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6571947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6571950">fetchGoogle</span><span class="op" id="6571961">(</span><span class="ident" id="6571962">t</span><span class="op" id="6571963">,</span>&nbsp;<span class="ident" id="6571965">fd</span><span class="op" id="6571967">,</span>&nbsp;<span class="ident" id="6571969">network</span><span class="op" id="6571976">,</span>&nbsp;<span class="ident" id="6571978">addr</span><span class="op" id="6571982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6571985">fd</span><span class="op" id="6571987">.</span><span class="ident" id="6571988">Close</span><span class="op" id="6571993">(</span><span class="op" id="6571994">)</span><br>
<span class="lineno">95</span><span class="op" id="6571996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6571999">var</span>&nbsp;<span class="ident" id="6572003">googleaddrsipv4</span>&nbsp;<span class="op" id="6572019">=</span>&nbsp;<span class="op" id="6572021">[</span><span class="op" id="6572022">]</span><span class="builtintype" id="6572023">string</span><span class="op" id="6572029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6572032">&#34;%d.%d.%d.%d:80&#34;</span><span class="op" id="6572048">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6572051">&#34;www.google.com:80&#34;</span><span class="op" id="6572070">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6572073">&#34;%d.%d.%d.%d:http&#34;</span><span class="op" id="6572091">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6572094">&#34;www.google.com:http&#34;</span><span class="op" id="6572115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6572118">&#34;%03d.%03d.%03d.%03d:0080&#34;</span><span class="op" id="6572144">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6572147">&#34;[::ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="6572172">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6572175">&#34;[::ffff:%02x%02x:%02x%02x]:80&#34;</span><span class="op" id="6572206">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6572209">&#34;[0:0:0:0:0000:ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="6572245">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6572248">&#34;[0:0:0:0:000000:ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="6572286">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6572289">&#34;[0:0:0:0::ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="6572321">,</span><br>
<span class="lineno"></span><span class="op" id="6572323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6572326">func</span>&nbsp;<span class="ident" id="6572331">TestDialGoogleIPv4</span><span class="op" id="6572349">(</span><span class="ident" id="6572350">t</span>&nbsp;<span class="op" id="6572352">*</span><span class="ident" id="6572353">testing</span><span class="op" id="6572360">.</span><span class="ident" id="6572361">T</span><span class="op" id="6572362">)</span>&nbsp;<span class="op" id="6572364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6572367">if</span>&nbsp;<span class="ident" id="6572370">testing</span><span class="op" id="6572377">.</span><span class="ident" id="6572378">Short</span><span class="op" id="6572383">(</span><span class="op" id="6572384">)</span>&nbsp;<span class="op" id="6572386">||</span>&nbsp;<span class="op" id="6572389">!</span><span class="op" id="6572390">*</span><span class="ident" id="6572391">testExternal</span>&nbsp;<span class="op" id="6572404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6572408">t</span><span class="op" id="6572409">.</span><span class="ident" id="6572410">Skip</span><span class="op" id="6572414">(</span><span class="string" id="6572415">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6572456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6572459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6572463">//&nbsp;Insert&nbsp;an&nbsp;actual&nbsp;IPv4&nbsp;address&nbsp;for&nbsp;google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6572512">//&nbsp;into&nbsp;the&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6572532">addrs</span><span class="op" id="6572537">,</span>&nbsp;<span class="ident" id="6572539">err</span>&nbsp;<span class="op" id="6572543">:=</span>&nbsp;<span class="ident" id="6572546">LookupIP</span><span class="op" id="6572554">(</span><span class="string" id="6572555">&#34;www.google.com&#34;</span><span class="op" id="6572571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6572574">if</span>&nbsp;<span class="ident" id="6572577">err</span>&nbsp;<span class="op" id="6572581">!=</span>&nbsp;<span class="ident" id="6572584">nil</span>&nbsp;<span class="op" id="6572588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6572592">t</span><span class="op" id="6572593">.</span><span class="ident" id="6572594">Fatalf</span><span class="op" id="6572600">(</span><span class="string" id="6572601">&#34;lookup&nbsp;www.google.com:&nbsp;%v&#34;</span><span class="op" id="6572628">,</span>&nbsp;<span class="ident" id="6572630">err</span><span class="op" id="6572633">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6572636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6572639">var</span>&nbsp;<span class="ident" id="6572643">ip</span>&nbsp;<span class="ident" id="6572646">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6572650">for</span>&nbsp;<span class="ident" id="6572654">_</span><span class="op" id="6572655">,</span>&nbsp;<span class="ident" id="6572657">addr</span>&nbsp;<span class="op" id="6572662">:=</span>&nbsp;<span class="keyword" id="6572665">range</span>&nbsp;<span class="ident" id="6572671">addrs</span>&nbsp;<span class="op" id="6572677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6572681">if</span>&nbsp;<span class="ident" id="6572684">x</span>&nbsp;<span class="op" id="6572686">:=</span>&nbsp;<span class="ident" id="6572689">addr</span><span class="op" id="6572693">.</span><span class="ident" id="6572694">To4</span><span class="op" id="6572697">(</span><span class="op" id="6572698">)</span><span class="op" id="6572699">;</span>&nbsp;<span class="ident" id="6572701">x</span>&nbsp;<span class="op" id="6572703">!=</span>&nbsp;<span class="ident" id="6572706">nil</span>&nbsp;<span class="op" id="6572710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6572715">ip</span>&nbsp;<span class="op" id="6572718">=</span>&nbsp;<span class="ident" id="6572720">x</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6572725">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6572733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6572736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6572739">if</span>&nbsp;<span class="ident" id="6572742">ip</span>&nbsp;<span class="op" id="6572745">==</span>&nbsp;<span class="ident" id="6572748">nil</span>&nbsp;<span class="op" id="6572752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6572756">t</span><span class="op" id="6572757">.</span><span class="ident" id="6572758">Fatalf</span><span class="op" id="6572764">(</span><span class="string" id="6572765">&#34;no&nbsp;IPv4&nbsp;addresses&nbsp;for&nbsp;www.google.com&#34;</span><span class="op" id="6572803">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6572806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6572810">for</span>&nbsp;<span class="ident" id="6572814">i</span><span class="op" id="6572815">,</span>&nbsp;<span class="ident" id="6572817">s</span>&nbsp;<span class="op" id="6572819">:=</span>&nbsp;<span class="keyword" id="6572822">range</span>&nbsp;<span class="ident" id="6572828">googleaddrsipv4</span>&nbsp;<span class="op" id="6572844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6572848">if</span>&nbsp;<span class="ident" id="6572851">strings</span><span class="op" id="6572858">.</span><span class="ident" id="6572859">Contains</span><span class="op" id="6572867">(</span><span class="ident" id="6572868">s</span><span class="op" id="6572869">,</span>&nbsp;<span class="string" id="6572871">&#34;%&#34;</span><span class="op" id="6572874">)</span>&nbsp;<span class="op" id="6572876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6572881">googleaddrsipv4</span><span class="op" id="6572896">[</span><span class="ident" id="6572897">i</span><span class="op" id="6572898">]</span>&nbsp;<span class="op" id="6572900">=</span>&nbsp;<span class="ident" id="6572902">fmt</span><span class="op" id="6572905">.</span><span class="ident" id="6572906">Sprintf</span><span class="op" id="6572913">(</span><span class="ident" id="6572914">s</span><span class="op" id="6572915">,</span>&nbsp;<span class="ident" id="6572917">ip</span><span class="op" id="6572919">[</span><span class="num" id="6572920">0</span><span class="op" id="6572921">]</span><span class="op" id="6572922">,</span>&nbsp;<span class="ident" id="6572924">ip</span><span class="op" id="6572926">[</span><span class="num" id="6572927">1</span><span class="op" id="6572928">]</span><span class="op" id="6572929">,</span>&nbsp;<span class="ident" id="6572931">ip</span><span class="op" id="6572933">[</span><span class="num" id="6572934">2</span><span class="op" id="6572935">]</span><span class="op" id="6572936">,</span>&nbsp;<span class="ident" id="6572938">ip</span><span class="op" id="6572940">[</span><span class="num" id="6572941">3</span><span class="op" id="6572942">]</span><span class="op" id="6572943">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6572947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6572950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6572954">for</span>&nbsp;<span class="ident" id="6572958">i</span>&nbsp;<span class="op" id="6572960">:=</span>&nbsp;<span class="num" id="6572963">0</span><span class="op" id="6572964">;</span>&nbsp;<span class="ident" id="6572966">i</span>&nbsp;<span class="op" id="6572968">&lt;</span>&nbsp;<span class="builtinfunc" id="6572970">len</span><span class="op" id="6572973">(</span><span class="ident" id="6572974">googleaddrsipv4</span><span class="op" id="6572989">)</span><span class="op" id="6572990">;</span>&nbsp;<span class="ident" id="6572992">i</span><span class="op" id="6572993">++</span>&nbsp;<span class="op" id="6572996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6573000">addr</span>&nbsp;<span class="op" id="6573005">:=</span>&nbsp;<span class="ident" id="6573008">googleaddrsipv4</span><span class="op" id="6573023">[</span><span class="ident" id="6573024">i</span><span class="op" id="6573025">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6573029">if</span>&nbsp;<span class="ident" id="6573032">addr</span>&nbsp;<span class="op" id="6573037">==</span>&nbsp;<span class="string" id="6573040">&#34;&#34;</span>&nbsp;<span class="op" id="6573043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6573048">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6573059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6573063">t</span><span class="op" id="6573064">.</span><span class="ident" id="6573065">Logf</span><span class="op" id="6573069">(</span><span class="string" id="6573070">&#34;--&nbsp;%s&nbsp;--&#34;</span><span class="op" id="6573080">,</span>&nbsp;<span class="ident" id="6573082">addr</span><span class="op" id="6573086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6573090">doDial</span><span class="op" id="6573096">(</span><span class="ident" id="6573097">t</span><span class="op" id="6573098">,</span>&nbsp;<span class="string" id="6573100">&#34;tcp&#34;</span><span class="op" id="6573105">,</span>&nbsp;<span class="ident" id="6573107">addr</span><span class="op" id="6573111">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6573115">if</span>&nbsp;<span class="ident" id="6573118">addr</span><span class="op" id="6573122">[</span><span class="num" id="6573123">0</span><span class="op" id="6573124">]</span>&nbsp;<span class="op" id="6573126">!=</span>&nbsp;<span class="string" id="6573129">&#39;[&#39;</span>&nbsp;<span class="op" id="6573133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6573138">doDial</span><span class="op" id="6573144">(</span><span class="ident" id="6573145">t</span><span class="op" id="6573146">,</span>&nbsp;<span class="string" id="6573148">&#34;tcp4&#34;</span><span class="op" id="6573154">,</span>&nbsp;<span class="ident" id="6573156">addr</span><span class="op" id="6573160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6573165">if</span>&nbsp;<span class="ident" id="6573168">supportsIPv6</span>&nbsp;<span class="op" id="6573181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6573187">//&nbsp;make&nbsp;sure&nbsp;syscall.SocketDisableIPv6&nbsp;flag&nbsp;works.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6573242">syscall</span><span class="op" id="6573249">.</span><span class="ident" id="6573250">SocketDisableIPv6</span>&nbsp;<span class="op" id="6573268">=</span>&nbsp;<span class="builtintype" id="6573270">true</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6573279">doDial</span><span class="op" id="6573285">(</span><span class="ident" id="6573286">t</span><span class="op" id="6573287">,</span>&nbsp;<span class="string" id="6573289">&#34;tcp&#34;</span><span class="op" id="6573294">,</span>&nbsp;<span class="ident" id="6573296">addr</span><span class="op" id="6573300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6573306">doDial</span><span class="op" id="6573312">(</span><span class="ident" id="6573313">t</span><span class="op" id="6573314">,</span>&nbsp;<span class="string" id="6573316">&#34;tcp4&#34;</span><span class="op" id="6573322">,</span>&nbsp;<span class="ident" id="6573324">addr</span><span class="op" id="6573328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6573334">syscall</span><span class="op" id="6573341">.</span><span class="ident" id="6573342">SocketDisableIPv6</span>&nbsp;<span class="op" id="6573360">=</span>&nbsp;<span class="builtintype" id="6573362">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6573371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6573375">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6573378">}</span><br>
<span class="lineno"></span><span class="op" id="6573380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6573383">var</span>&nbsp;<span class="ident" id="6573387">googleaddrsipv6</span>&nbsp;<span class="op" id="6573403">=</span>&nbsp;<span class="op" id="6573405">[</span><span class="op" id="6573406">]</span><span class="builtintype" id="6573407">string</span><span class="op" id="6573413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6573416">&#34;[%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x]:80&#34;</span><span class="op" id="6573494">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6573497">&#34;ipv6.google.com:80&#34;</span><span class="op" id="6573517">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6573520">&#34;[%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x]:http&#34;</span><span class="op" id="6573600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6573603">&#34;ipv6.google.com:http&#34;</span><span class="op" id="6573625">,</span><br>
<span class="lineno"></span><span class="op" id="6573627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="6573630">func</span>&nbsp;<span class="ident" id="6573635">TestDialGoogleIPv6</span><span class="op" id="6573653">(</span><span class="ident" id="6573654">t</span>&nbsp;<span class="op" id="6573656">*</span><span class="ident" id="6573657">testing</span><span class="op" id="6573664">.</span><span class="ident" id="6573665">T</span><span class="op" id="6573666">)</span>&nbsp;<span class="op" id="6573668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6573671">if</span>&nbsp;<span class="ident" id="6573674">testing</span><span class="op" id="6573681">.</span><span class="ident" id="6573682">Short</span><span class="op" id="6573687">(</span><span class="op" id="6573688">)</span>&nbsp;<span class="op" id="6573690">||</span>&nbsp;<span class="op" id="6573693">!</span><span class="op" id="6573694">*</span><span class="ident" id="6573695">testExternal</span>&nbsp;<span class="op" id="6573708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6573712">t</span><span class="op" id="6573713">.</span><span class="ident" id="6573714">Skip</span><span class="op" id="6573718">(</span><span class="string" id="6573719">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6573760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6573763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6573766">//&nbsp;Only&nbsp;run&nbsp;tcp6&nbsp;if&nbsp;the&nbsp;kernel&nbsp;will&nbsp;take&nbsp;it.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6573812">if</span>&nbsp;<span class="op" id="6573815">!</span><span class="ident" id="6573816">supportsIPv6</span>&nbsp;<span class="op" id="6573829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6573833">t</span><span class="op" id="6573834">.</span><span class="ident" id="6573835">Skip</span><span class="op" id="6573839">(</span><span class="string" id="6573840">&#34;skipping&nbsp;test;&nbsp;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6573878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6573881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6573884">if</span>&nbsp;<span class="op" id="6573887">!</span><span class="op" id="6573888">*</span><span class="ident" id="6573889">testIPv6</span>&nbsp;<span class="op" id="6573898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6573902">t</span><span class="op" id="6573903">.</span><span class="ident" id="6573904">Skip</span><span class="op" id="6573908">(</span><span class="string" id="6573909">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-ipv6&nbsp;to&nbsp;enable&#34;</span><span class="op" id="6573945">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6573948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6573952">//&nbsp;Insert&nbsp;an&nbsp;actual&nbsp;IPv6&nbsp;address&nbsp;for&nbsp;ipv6.google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6574006">//&nbsp;into&nbsp;the&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6574026">addrs</span><span class="op" id="6574031">,</span>&nbsp;<span class="ident" id="6574033">err</span>&nbsp;<span class="op" id="6574037">:=</span>&nbsp;<span class="ident" id="6574040">LookupIP</span><span class="op" id="6574048">(</span><span class="string" id="6574049">&#34;ipv6.google.com&#34;</span><span class="op" id="6574066">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6574069">if</span>&nbsp;<span class="ident" id="6574072">err</span>&nbsp;<span class="op" id="6574076">!=</span>&nbsp;<span class="ident" id="6574079">nil</span>&nbsp;<span class="op" id="6574083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6574087">t</span><span class="op" id="6574088">.</span><span class="ident" id="6574089">Fatalf</span><span class="op" id="6574095">(</span><span class="string" id="6574096">&#34;lookup&nbsp;ipv6.google.com:&nbsp;%v&#34;</span><span class="op" id="6574124">,</span>&nbsp;<span class="ident" id="6574126">err</span><span class="op" id="6574129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6574132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6574135">var</span>&nbsp;<span class="ident" id="6574139">ip</span>&nbsp;<span class="ident" id="6574142">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6574146">for</span>&nbsp;<span class="ident" id="6574150">_</span><span class="op" id="6574151">,</span>&nbsp;<span class="ident" id="6574153">addr</span>&nbsp;<span class="op" id="6574158">:=</span>&nbsp;<span class="keyword" id="6574161">range</span>&nbsp;<span class="ident" id="6574167">addrs</span>&nbsp;<span class="op" id="6574173">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6574177">if</span>&nbsp;<span class="ident" id="6574180">x</span>&nbsp;<span class="op" id="6574182">:=</span>&nbsp;<span class="ident" id="6574185">addr</span><span class="op" id="6574189">.</span><span class="ident" id="6574190">To16</span><span class="op" id="6574194">(</span><span class="op" id="6574195">)</span><span class="op" id="6574196">;</span>&nbsp;<span class="ident" id="6574198">x</span>&nbsp;<span class="op" id="6574200">!=</span>&nbsp;<span class="ident" id="6574203">nil</span>&nbsp;<span class="op" id="6574207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6574212">ip</span>&nbsp;<span class="op" id="6574215">=</span>&nbsp;<span class="ident" id="6574217">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6574222">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6574230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6574233">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6574236">if</span>&nbsp;<span class="ident" id="6574239">ip</span>&nbsp;<span class="op" id="6574242">==</span>&nbsp;<span class="ident" id="6574245">nil</span>&nbsp;<span class="op" id="6574249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6574253">t</span><span class="op" id="6574254">.</span><span class="ident" id="6574255">Fatalf</span><span class="op" id="6574261">(</span><span class="string" id="6574262">&#34;no&nbsp;IPv6&nbsp;addresses&nbsp;for&nbsp;ipv6.google.com&#34;</span><span class="op" id="6574301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6574304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6574308">for</span>&nbsp;<span class="ident" id="6574312">i</span><span class="op" id="6574313">,</span>&nbsp;<span class="ident" id="6574315">s</span>&nbsp;<span class="op" id="6574317">:=</span>&nbsp;<span class="keyword" id="6574320">range</span>&nbsp;<span class="ident" id="6574326">googleaddrsipv6</span>&nbsp;<span class="op" id="6574342">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6574346">if</span>&nbsp;<span class="ident" id="6574349">strings</span><span class="op" id="6574356">.</span><span class="ident" id="6574357">Contains</span><span class="op" id="6574365">(</span><span class="ident" id="6574366">s</span><span class="op" id="6574367">,</span>&nbsp;<span class="string" id="6574369">&#34;%&#34;</span><span class="op" id="6574372">)</span>&nbsp;<span class="op" id="6574374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6574379">googleaddrsipv6</span><span class="op" id="6574394">[</span><span class="ident" id="6574395">i</span><span class="op" id="6574396">]</span>&nbsp;<span class="op" id="6574398">=</span>&nbsp;<span class="ident" id="6574400">fmt</span><span class="op" id="6574403">.</span><span class="ident" id="6574404">Sprintf</span><span class="op" id="6574411">(</span><span class="ident" id="6574412">s</span><span class="op" id="6574413">,</span>&nbsp;<span class="ident" id="6574415">ip</span><span class="op" id="6574417">[</span><span class="num" id="6574418">0</span><span class="op" id="6574419">]</span><span class="op" id="6574420">,</span>&nbsp;<span class="ident" id="6574422">ip</span><span class="op" id="6574424">[</span><span class="num" id="6574425">1</span><span class="op" id="6574426">]</span><span class="op" id="6574427">,</span>&nbsp;<span class="ident" id="6574429">ip</span><span class="op" id="6574431">[</span><span class="num" id="6574432">2</span><span class="op" id="6574433">]</span><span class="op" id="6574434">,</span>&nbsp;<span class="ident" id="6574436">ip</span><span class="op" id="6574438">[</span><span class="num" id="6574439">3</span><span class="op" id="6574440">]</span><span class="op" id="6574441">,</span>&nbsp;<span class="ident" id="6574443">ip</span><span class="op" id="6574445">[</span><span class="num" id="6574446">4</span><span class="op" id="6574447">]</span><span class="op" id="6574448">,</span>&nbsp;<span class="ident" id="6574450">ip</span><span class="op" id="6574452">[</span><span class="num" id="6574453">5</span><span class="op" id="6574454">]</span><span class="op" id="6574455">,</span>&nbsp;<span class="ident" id="6574457">ip</span><span class="op" id="6574459">[</span><span class="num" id="6574460">6</span><span class="op" id="6574461">]</span><span class="op" id="6574462">,</span>&nbsp;<span class="ident" id="6574464">ip</span><span class="op" id="6574466">[</span><span class="num" id="6574467">7</span><span class="op" id="6574468">]</span><span class="op" id="6574469">,</span>&nbsp;<span class="ident" id="6574471">ip</span><span class="op" id="6574473">[</span><span class="num" id="6574474">8</span><span class="op" id="6574475">]</span><span class="op" id="6574476">,</span>&nbsp;<span class="ident" id="6574478">ip</span><span class="op" id="6574480">[</span><span class="num" id="6574481">9</span><span class="op" id="6574482">]</span><span class="op" id="6574483">,</span>&nbsp;<span class="ident" id="6574485">ip</span><span class="op" id="6574487">[</span><span class="num" id="6574488">10</span><span class="op" id="6574490">]</span><span class="op" id="6574491">,</span>&nbsp;<span class="ident" id="6574493">ip</span><span class="op" id="6574495">[</span><span class="num" id="6574496">11</span><span class="op" id="6574498">]</span><span class="op" id="6574499">,</span>&nbsp;<span class="ident" id="6574501">ip</span><span class="op" id="6574503">[</span><span class="num" id="6574504">12</span><span class="op" id="6574506">]</span><span class="op" id="6574507">,</span>&nbsp;<span class="ident" id="6574509">ip</span><span class="op" id="6574511">[</span><span class="num" id="6574512">13</span><span class="op" id="6574514">]</span><span class="op" id="6574515">,</span>&nbsp;<span class="ident" id="6574517">ip</span><span class="op" id="6574519">[</span><span class="num" id="6574520">14</span><span class="op" id="6574522">]</span><span class="op" id="6574523">,</span>&nbsp;<span class="ident" id="6574525">ip</span><span class="op" id="6574527">[</span><span class="num" id="6574528">15</span><span class="op" id="6574530">]</span><span class="op" id="6574531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6574535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6574538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6574542">for</span>&nbsp;<span class="ident" id="6574546">i</span>&nbsp;<span class="op" id="6574548">:=</span>&nbsp;<span class="num" id="6574551">0</span><span class="op" id="6574552">;</span>&nbsp;<span class="ident" id="6574554">i</span>&nbsp;<span class="op" id="6574556">&lt;</span>&nbsp;<span class="builtinfunc" id="6574558">len</span><span class="op" id="6574561">(</span><span class="ident" id="6574562">googleaddrsipv6</span><span class="op" id="6574577">)</span><span class="op" id="6574578">;</span>&nbsp;<span class="ident" id="6574580">i</span><span class="op" id="6574581">++</span>&nbsp;<span class="op" id="6574584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6574588">addr</span>&nbsp;<span class="op" id="6574593">:=</span>&nbsp;<span class="ident" id="6574596">googleaddrsipv6</span><span class="op" id="6574611">[</span><span class="ident" id="6574612">i</span><span class="op" id="6574613">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6574617">if</span>&nbsp;<span class="ident" id="6574620">addr</span>&nbsp;<span class="op" id="6574625">==</span>&nbsp;<span class="string" id="6574628">&#34;&#34;</span>&nbsp;<span class="op" id="6574631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6574636">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6574647">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6574651">t</span><span class="op" id="6574652">.</span><span class="ident" id="6574653">Logf</span><span class="op" id="6574657">(</span><span class="string" id="6574658">&#34;--&nbsp;%s&nbsp;--&#34;</span><span class="op" id="6574668">,</span>&nbsp;<span class="ident" id="6574670">addr</span><span class="op" id="6574674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6574678">doDial</span><span class="op" id="6574684">(</span><span class="ident" id="6574685">t</span><span class="op" id="6574686">,</span>&nbsp;<span class="string" id="6574688">&#34;tcp&#34;</span><span class="op" id="6574693">,</span>&nbsp;<span class="ident" id="6574695">addr</span><span class="op" id="6574699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6574703">doDial</span><span class="op" id="6574709">(</span><span class="ident" id="6574710">t</span><span class="op" id="6574711">,</span>&nbsp;<span class="string" id="6574713">&#34;tcp6&#34;</span><span class="op" id="6574719">,</span>&nbsp;<span class="ident" id="6574721">addr</span><span class="op" id="6574725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6574728">}</span><br>
<span class="lineno"></span><span class="op" id="6574730">}</span>
</div>
</body>
</html>
