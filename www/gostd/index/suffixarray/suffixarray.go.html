<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5854272">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5854327">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5854381">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5854432">//&nbsp;Package&nbsp;suffixarray&nbsp;implements&nbsp;substring&nbsp;search&nbsp;in&nbsp;logarithmic&nbsp;time&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="5854509">//&nbsp;an&nbsp;in-memory&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="5854539">//</span><br>
<span class="lineno"></span><span class="comment" id="5854542">//&nbsp;Example&nbsp;use:</span><br>
<span class="lineno"></span><span class="comment" id="5854558">//</span><br>
<span class="lineno">10</span><span class="comment" id="5854561">//&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;create&nbsp;index&nbsp;for&nbsp;some&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5854594">//&nbsp;&nbsp;&nbsp;&nbspindex&nbsp;:=&nbsp;suffixarray.New(data)</span><br>
<span class="lineno"></span><span class="comment" id="5854628">//</span><br>
<span class="lineno"></span><span class="comment" id="5854631">//&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;lookup&nbsp;byte&nbsp;slice&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5854657">//&nbsp;&nbsp;&nbsp;&nbspoffsets1&nbsp;:=&nbsp;index.Lookup(s,&nbsp;-1)&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;all&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno">15</span><span class="comment" id="5854742">//&nbsp;&nbsp;&nbsp;&nbspoffsets2&nbsp;:=&nbsp;index.Lookup(s,&nbsp;3)&nbsp;&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;3&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5854833">//</span><br>
<span class="lineno"></span><span class="keyword" id="5854836">package</span>&nbsp;<span class="ident" id="5854844">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5854857">import</span>&nbsp;<span class="op" id="5854864">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5854867">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5854876">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5854895">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5854901">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5854911">&#34;sort&#34;</span><br>
<span class="lineno">25</span><span class="op" id="5854918">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5854921">//&nbsp;Index&nbsp;implements&nbsp;a&nbsp;suffix&nbsp;array&nbsp;for&nbsp;fast&nbsp;substring&nbsp;search.</span><br>
<span class="lineno"></span><span class="keyword" id="5854983">type</span>&nbsp;<span class="ident" id="5854988">Index</span>&nbsp;<span class="keyword" id="5854994">struct</span>&nbsp;<span class="op" id="5855001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855004">data</span>&nbsp;<span class="op" id="5855009">[</span><span class="op" id="5855010">]</span><span class="builtintype" id="5855011">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855017">sa</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5855022">[</span><span class="op" id="5855023">]</span><span class="builtintype" id="5855024">int</span>&nbsp;<span class="comment" id="5855028">//&nbsp;suffix&nbsp;array&nbsp;for&nbsp;data;&nbsp;len(sa)&nbsp;==&nbsp;len(data)</span><br>
<span class="lineno"></span><span class="op" id="5855075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5855078">//&nbsp;New&nbsp;creates&nbsp;a&nbsp;new&nbsp;Index&nbsp;for&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5855115">//&nbsp;Index&nbsp;creation&nbsp;time&nbsp;is&nbsp;O(N*log(N))&nbsp;for&nbsp;N&nbsp;=&nbsp;len(data).</span><br>
<span class="lineno">35</span><span class="keyword" id="5855172">func</span>&nbsp;<span class="ident" id="5855177">New</span><span class="op" id="5855180">(</span><span class="ident" id="5855181">data</span>&nbsp;<span class="op" id="5855186">[</span><span class="op" id="5855187">]</span><span class="builtintype" id="5855188">byte</span><span class="op" id="5855192">)</span>&nbsp;<span class="op" id="5855194">*</span><span class="ident" id="5855195">Index</span>&nbsp;<span class="op" id="5855201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855204">return</span>&nbsp;<span class="op" id="5855211">&amp;</span><span class="ident" id="5855212">Index</span><span class="op" id="5855217">{</span><span class="ident" id="5855218">data</span><span class="op" id="5855222">,</span>&nbsp;<span class="ident" id="5855224">qsufsort</span><span class="op" id="5855232">(</span><span class="ident" id="5855233">data</span><span class="op" id="5855237">)</span><span class="op" id="5855238">}</span><br>
<span class="lineno"></span><span class="op" id="5855240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5855243">//&nbsp;writeInt&nbsp;writes&nbsp;an&nbsp;int&nbsp;x&nbsp;to&nbsp;w&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">40</span><span class="keyword" id="5855307">func</span>&nbsp;<span class="ident" id="5855312">writeInt</span><span class="op" id="5855320">(</span><span class="ident" id="5855321">w</span>&nbsp;<span class="ident" id="5855323">io</span><span class="op" id="5855325">.</span><span class="ident" id="5855326">Writer</span><span class="op" id="5855332">,</span>&nbsp;<span class="ident" id="5855334">buf</span>&nbsp;<span class="op" id="5855338">[</span><span class="op" id="5855339">]</span><span class="builtintype" id="5855340">byte</span><span class="op" id="5855344">,</span>&nbsp;<span class="ident" id="5855346">x</span>&nbsp;<span class="builtintype" id="5855348">int</span><span class="op" id="5855351">)</span>&nbsp;<span class="builtintype" id="5855353">error</span>&nbsp;<span class="op" id="5855359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855362">binary</span><span class="op" id="5855368">.</span><span class="ident" id="5855369">PutVarint</span><span class="op" id="5855378">(</span><span class="ident" id="5855379">buf</span><span class="op" id="5855382">,</span>&nbsp;<span class="ident" id="5855384">int64</span><span class="op" id="5855389">(</span><span class="ident" id="5855390">x</span><span class="op" id="5855391">)</span><span class="op" id="5855392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855395">_</span><span class="op" id="5855396">,</span>&nbsp;<span class="ident" id="5855398">err</span>&nbsp;<span class="op" id="5855402">:=</span>&nbsp;<span class="ident" id="5855405">w</span><span class="op" id="5855406">.</span><span class="ident" id="5855407">Write</span><span class="op" id="5855412">(</span><span class="ident" id="5855413">buf</span><span class="op" id="5855416">[</span><span class="num" id="5855417">0</span><span class="op" id="5855418">:</span><span class="ident" id="5855419">binary</span><span class="op" id="5855425">.</span><span class="ident" id="5855426">MaxVarintLen64</span><span class="op" id="5855440">]</span><span class="op" id="5855441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855444">return</span>&nbsp;<span class="ident" id="5855451">err</span><br>
<span class="lineno"></span><span class="op" id="5855455">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5855458">//&nbsp;readInt&nbsp;reads&nbsp;an&nbsp;int&nbsp;x&nbsp;from&nbsp;r&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read&nbsp;and&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="5855535">func</span>&nbsp;<span class="ident" id="5855540">readInt</span><span class="op" id="5855547">(</span><span class="ident" id="5855548">r</span>&nbsp;<span class="ident" id="5855550">io</span><span class="op" id="5855552">.</span><span class="ident" id="5855553">Reader</span><span class="op" id="5855559">,</span>&nbsp;<span class="ident" id="5855561">buf</span>&nbsp;<span class="op" id="5855565">[</span><span class="op" id="5855566">]</span><span class="builtintype" id="5855567">byte</span><span class="op" id="5855571">)</span>&nbsp;<span class="op" id="5855573">(</span><span class="builtintype" id="5855574">int</span><span class="op" id="5855577">,</span>&nbsp;<span class="builtintype" id="5855579">error</span><span class="op" id="5855584">)</span>&nbsp;<span class="op" id="5855586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855589">_</span><span class="op" id="5855590">,</span>&nbsp;<span class="ident" id="5855592">err</span>&nbsp;<span class="op" id="5855596">:=</span>&nbsp;<span class="ident" id="5855599">io</span><span class="op" id="5855601">.</span><span class="ident" id="5855602">ReadFull</span><span class="op" id="5855610">(</span><span class="ident" id="5855611">r</span><span class="op" id="5855612">,</span>&nbsp;<span class="ident" id="5855614">buf</span><span class="op" id="5855617">[</span><span class="num" id="5855618">0</span><span class="op" id="5855619">:</span><span class="ident" id="5855620">binary</span><span class="op" id="5855626">.</span><span class="ident" id="5855627">MaxVarintLen64</span><span class="op" id="5855641">]</span><span class="op" id="5855642">)</span>&nbsp;<span class="comment" id="5855644">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;with&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855674">x</span><span class="op" id="5855675">,</span>&nbsp;<span class="ident" id="5855677">_</span>&nbsp;<span class="op" id="5855679">:=</span>&nbsp;<span class="ident" id="5855682">binary</span><span class="op" id="5855688">.</span><span class="ident" id="5855689">Varint</span><span class="op" id="5855695">(</span><span class="ident" id="5855696">buf</span><span class="op" id="5855699">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855702">return</span>&nbsp;<span class="builtintype" id="5855709">int</span><span class="op" id="5855712">(</span><span class="ident" id="5855713">x</span><span class="op" id="5855714">)</span><span class="op" id="5855715">,</span>&nbsp;<span class="ident" id="5855717">err</span><br>
<span class="lineno"></span><span class="op" id="5855721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5855724">//&nbsp;writeSlice&nbsp;writes&nbsp;data[:n]&nbsp;to&nbsp;w&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="5855774">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">55</span><span class="keyword" id="5855810">func</span>&nbsp;<span class="ident" id="5855815">writeSlice</span><span class="op" id="5855825">(</span><span class="ident" id="5855826">w</span>&nbsp;<span class="ident" id="5855828">io</span><span class="op" id="5855830">.</span><span class="ident" id="5855831">Writer</span><span class="op" id="5855837">,</span>&nbsp;<span class="ident" id="5855839">buf</span>&nbsp;<span class="op" id="5855843">[</span><span class="op" id="5855844">]</span><span class="builtintype" id="5855845">byte</span><span class="op" id="5855849">,</span>&nbsp;<span class="ident" id="5855851">data</span>&nbsp;<span class="op" id="5855856">[</span><span class="op" id="5855857">]</span><span class="builtintype" id="5855858">int</span><span class="op" id="5855861">)</span>&nbsp;<span class="op" id="5855863">(</span><span class="ident" id="5855864">n</span>&nbsp;<span class="builtintype" id="5855866">int</span><span class="op" id="5855869">,</span>&nbsp;<span class="ident" id="5855871">err</span>&nbsp;<span class="builtintype" id="5855875">error</span><span class="op" id="5855880">)</span>&nbsp;<span class="op" id="5855882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5855885">//&nbsp;encode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;fit&nbsp;into&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855929">p</span>&nbsp;<span class="op" id="5855931">:=</span>&nbsp;<span class="ident" id="5855934">binary</span><span class="op" id="5855940">.</span><span class="ident" id="5855941">MaxVarintLen64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855957">for</span>&nbsp;<span class="op" id="5855961">;</span>&nbsp;<span class="ident" id="5855963">n</span>&nbsp;<span class="op" id="5855965">&lt;</span>&nbsp;<span class="builtinfunc" id="5855967">len</span><span class="op" id="5855970">(</span><span class="ident" id="5855971">data</span><span class="op" id="5855975">)</span>&nbsp;<span class="op" id="5855977">&amp;&amp;</span>&nbsp;<span class="ident" id="5855980">p</span><span class="op" id="5855981">+</span><span class="ident" id="5855982">binary</span><span class="op" id="5855988">.</span><span class="ident" id="5855989">MaxVarintLen64</span>&nbsp;<span class="op" id="5856004">&lt;=</span>&nbsp;<span class="builtinfunc" id="5856007">len</span><span class="op" id="5856010">(</span><span class="ident" id="5856011">buf</span><span class="op" id="5856014">)</span><span class="op" id="5856015">;</span>&nbsp;<span class="ident" id="5856017">n</span><span class="op" id="5856018">++</span>&nbsp;<span class="op" id="5856021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856025">p</span>&nbsp;<span class="op" id="5856027">+=</span>&nbsp;<span class="ident" id="5856030">binary</span><span class="op" id="5856036">.</span><span class="ident" id="5856037">PutUvarint</span><span class="op" id="5856047">(</span><span class="ident" id="5856048">buf</span><span class="op" id="5856051">[</span><span class="ident" id="5856052">p</span><span class="op" id="5856053">:</span><span class="op" id="5856054">]</span><span class="op" id="5856055">,</span>&nbsp;<span class="ident" id="5856057">uint64</span><span class="op" id="5856063">(</span><span class="ident" id="5856064">data</span><span class="op" id="5856068">[</span><span class="ident" id="5856069">n</span><span class="op" id="5856070">]</span><span class="op" id="5856071">)</span><span class="op" id="5856072">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5856075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856079">//&nbsp;update&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856102">binary</span><span class="op" id="5856108">.</span><span class="ident" id="5856109">PutVarint</span><span class="op" id="5856118">(</span><span class="ident" id="5856119">buf</span><span class="op" id="5856122">,</span>&nbsp;<span class="ident" id="5856124">int64</span><span class="op" id="5856129">(</span><span class="ident" id="5856130">p</span><span class="op" id="5856131">)</span><span class="op" id="5856132">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856136">//&nbsp;write&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856153">_</span><span class="op" id="5856154">,</span>&nbsp;<span class="ident" id="5856156">err</span>&nbsp;<span class="op" id="5856160">=</span>&nbsp;<span class="ident" id="5856162">w</span><span class="op" id="5856163">.</span><span class="ident" id="5856164">Write</span><span class="op" id="5856169">(</span><span class="ident" id="5856170">buf</span><span class="op" id="5856173">[</span><span class="num" id="5856174">0</span><span class="op" id="5856175">:</span><span class="ident" id="5856176">p</span><span class="op" id="5856177">]</span><span class="op" id="5856178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856181">return</span><br>
<span class="lineno"></span><span class="op" id="5856188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="5856191">//&nbsp;readSlice&nbsp;reads&nbsp;data[:n]&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="5856241">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="5856276">func</span>&nbsp;<span class="ident" id="5856281">readSlice</span><span class="op" id="5856290">(</span><span class="ident" id="5856291">r</span>&nbsp;<span class="ident" id="5856293">io</span><span class="op" id="5856295">.</span><span class="ident" id="5856296">Reader</span><span class="op" id="5856302">,</span>&nbsp;<span class="ident" id="5856304">buf</span>&nbsp;<span class="op" id="5856308">[</span><span class="op" id="5856309">]</span><span class="builtintype" id="5856310">byte</span><span class="op" id="5856314">,</span>&nbsp;<span class="ident" id="5856316">data</span>&nbsp;<span class="op" id="5856321">[</span><span class="op" id="5856322">]</span><span class="builtintype" id="5856323">int</span><span class="op" id="5856326">)</span>&nbsp;<span class="op" id="5856328">(</span><span class="ident" id="5856329">n</span>&nbsp;<span class="builtintype" id="5856331">int</span><span class="op" id="5856334">,</span>&nbsp;<span class="ident" id="5856336">err</span>&nbsp;<span class="builtintype" id="5856340">error</span><span class="op" id="5856345">)</span>&nbsp;<span class="op" id="5856347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856350">//&nbsp;read&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856371">var</span>&nbsp;<span class="ident" id="5856375">size</span>&nbsp;<span class="builtintype" id="5856380">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856385">size</span><span class="op" id="5856389">,</span>&nbsp;<span class="ident" id="5856391">err</span>&nbsp;<span class="op" id="5856395">=</span>&nbsp;<span class="ident" id="5856397">readInt</span><span class="op" id="5856404">(</span><span class="ident" id="5856405">r</span><span class="op" id="5856406">,</span>&nbsp;<span class="ident" id="5856408">buf</span><span class="op" id="5856411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856414">if</span>&nbsp;<span class="ident" id="5856417">err</span>&nbsp;<span class="op" id="5856421">!=</span>&nbsp;<span class="ident" id="5856424">nil</span>&nbsp;<span class="op" id="5856428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856432">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5856440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856444">//&nbsp;read&nbsp;buffer&nbsp;w/o&nbsp;the&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856473">if</span>&nbsp;<span class="ident" id="5856476">_</span><span class="op" id="5856477">,</span>&nbsp;<span class="ident" id="5856479">err</span>&nbsp;<span class="op" id="5856483">=</span>&nbsp;<span class="ident" id="5856485">io</span><span class="op" id="5856487">.</span><span class="ident" id="5856488">ReadFull</span><span class="op" id="5856496">(</span><span class="ident" id="5856497">r</span><span class="op" id="5856498">,</span>&nbsp;<span class="ident" id="5856500">buf</span><span class="op" id="5856503">[</span><span class="ident" id="5856504">binary</span><span class="op" id="5856510">.</span><span class="ident" id="5856511">MaxVarintLen64</span><span class="op" id="5856525">:</span><span class="ident" id="5856526">size</span><span class="op" id="5856530">]</span><span class="op" id="5856531">)</span><span class="op" id="5856532">;</span>&nbsp;<span class="ident" id="5856534">err</span>&nbsp;<span class="op" id="5856538">!=</span>&nbsp;<span class="ident" id="5856541">nil</span>&nbsp;<span class="op" id="5856545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856549">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5856557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856561">//&nbsp;decode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;present&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856607">for</span>&nbsp;<span class="ident" id="5856611">p</span>&nbsp;<span class="op" id="5856613">:=</span>&nbsp;<span class="ident" id="5856616">binary</span><span class="op" id="5856622">.</span><span class="ident" id="5856623">MaxVarintLen64</span><span class="op" id="5856637">;</span>&nbsp;<span class="ident" id="5856639">p</span>&nbsp;<span class="op" id="5856641">&lt;</span>&nbsp;<span class="ident" id="5856643">size</span><span class="op" id="5856647">;</span>&nbsp;<span class="ident" id="5856649">n</span><span class="op" id="5856650">++</span>&nbsp;<span class="op" id="5856653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856657">x</span><span class="op" id="5856658">,</span>&nbsp;<span class="ident" id="5856660">w</span>&nbsp;<span class="op" id="5856662">:=</span>&nbsp;<span class="ident" id="5856665">binary</span><span class="op" id="5856671">.</span><span class="ident" id="5856672">Uvarint</span><span class="op" id="5856679">(</span><span class="ident" id="5856680">buf</span><span class="op" id="5856683">[</span><span class="ident" id="5856684">p</span><span class="op" id="5856685">:</span><span class="op" id="5856686">]</span><span class="op" id="5856687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856691">data</span><span class="op" id="5856695">[</span><span class="ident" id="5856696">n</span><span class="op" id="5856697">]</span>&nbsp;<span class="op" id="5856699">=</span>&nbsp;<span class="builtintype" id="5856701">int</span><span class="op" id="5856704">(</span><span class="ident" id="5856705">x</span><span class="op" id="5856706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856710">p</span>&nbsp;<span class="op" id="5856712">+=</span>&nbsp;<span class="ident" id="5856715">w</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5856718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856722">return</span><br>
<span class="lineno"></span><span class="op" id="5856729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5856732">const</span>&nbsp;<span class="ident" id="5856738">bufSize</span>&nbsp;<span class="op" id="5856746">=</span>&nbsp;<span class="num" id="5856748">16</span>&nbsp;<span class="op" id="5856751">&lt;&lt;</span>&nbsp;<span class="num" id="5856754">10</span>&nbsp;<span class="comment" id="5856757">//&nbsp;reasonable&nbsp;for&nbsp;BenchmarkSaveRestore</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5856797">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;index&nbsp;from&nbsp;r&nbsp;into&nbsp;x;&nbsp;x&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5856855">func</span>&nbsp;<span class="op" id="5856860">(</span><span class="ident" id="5856861">x</span>&nbsp;<span class="op" id="5856863">*</span><span class="ident" id="5856864">Index</span><span class="op" id="5856869">)</span>&nbsp;<span class="ident" id="5856871">Read</span><span class="op" id="5856875">(</span><span class="ident" id="5856876">r</span>&nbsp;<span class="ident" id="5856878">io</span><span class="op" id="5856880">.</span><span class="ident" id="5856881">Reader</span><span class="op" id="5856887">)</span>&nbsp;<span class="builtintype" id="5856889">error</span>&nbsp;<span class="op" id="5856895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856898">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;reads</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856923">buf</span>&nbsp;<span class="op" id="5856927">:=</span>&nbsp;<span class="builtinfunc" id="5856930">make</span><span class="op" id="5856934">(</span><span class="op" id="5856935">[</span><span class="op" id="5856936">]</span><span class="builtintype" id="5856937">byte</span><span class="op" id="5856941">,</span>&nbsp;<span class="ident" id="5856943">bufSize</span><span class="op" id="5856950">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856954">//&nbsp;read&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856970">n</span><span class="op" id="5856971">,</span>&nbsp;<span class="ident" id="5856973">err</span>&nbsp;<span class="op" id="5856977">:=</span>&nbsp;<span class="ident" id="5856980">readInt</span><span class="op" id="5856987">(</span><span class="ident" id="5856988">r</span><span class="op" id="5856989">,</span>&nbsp;<span class="ident" id="5856991">buf</span><span class="op" id="5856994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856997">if</span>&nbsp;<span class="ident" id="5857000">err</span>&nbsp;<span class="op" id="5857004">!=</span>&nbsp;<span class="ident" id="5857007">nil</span>&nbsp;<span class="op" id="5857011">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857015">return</span>&nbsp;<span class="ident" id="5857022">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857031">//&nbsp;allocate&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857050">if</span>&nbsp;<span class="num" id="5857053">2</span><span class="op" id="5857054">*</span><span class="ident" id="5857055">n</span>&nbsp;<span class="op" id="5857057">&lt;</span>&nbsp;<span class="builtinfunc" id="5857059">cap</span><span class="op" id="5857062">(</span><span class="ident" id="5857063">x</span><span class="op" id="5857064">.</span><span class="ident" id="5857065">data</span><span class="op" id="5857069">)</span>&nbsp;<span class="op" id="5857071">||</span>&nbsp;<span class="builtinfunc" id="5857074">cap</span><span class="op" id="5857077">(</span><span class="ident" id="5857078">x</span><span class="op" id="5857079">.</span><span class="ident" id="5857080">data</span><span class="op" id="5857084">)</span>&nbsp;<span class="op" id="5857086">&lt;</span>&nbsp;<span class="ident" id="5857088">n</span>&nbsp;<span class="op" id="5857090">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857094">//&nbsp;new&nbsp;data&nbsp;is&nbsp;significantly&nbsp;smaller&nbsp;or&nbsp;larger&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857148">//&nbsp;existing&nbsp;buffers&nbsp;-&nbsp;allocate&nbsp;new&nbsp;ones</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857190">x</span><span class="op" id="5857191">.</span><span class="ident" id="5857192">data</span>&nbsp;<span class="op" id="5857197">=</span>&nbsp;<span class="builtinfunc" id="5857199">make</span><span class="op" id="5857203">(</span><span class="op" id="5857204">[</span><span class="op" id="5857205">]</span><span class="builtintype" id="5857206">byte</span><span class="op" id="5857210">,</span>&nbsp;<span class="ident" id="5857212">n</span><span class="op" id="5857213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857217">x</span><span class="op" id="5857218">.</span><span class="ident" id="5857219">sa</span>&nbsp;<span class="op" id="5857222">=</span>&nbsp;<span class="builtinfunc" id="5857224">make</span><span class="op" id="5857228">(</span><span class="op" id="5857229">[</span><span class="op" id="5857230">]</span><span class="builtintype" id="5857231">int</span><span class="op" id="5857234">,</span>&nbsp;<span class="ident" id="5857236">n</span><span class="op" id="5857237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857240">}</span>&nbsp;<span class="keyword" id="5857242">else</span>&nbsp;<span class="op" id="5857247">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857251">//&nbsp;re-use&nbsp;existing&nbsp;buffers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857280">x</span><span class="op" id="5857281">.</span><span class="ident" id="5857282">data</span>&nbsp;<span class="op" id="5857287">=</span>&nbsp;<span class="ident" id="5857289">x</span><span class="op" id="5857290">.</span><span class="ident" id="5857291">data</span><span class="op" id="5857295">[</span><span class="num" id="5857296">0</span><span class="op" id="5857297">:</span><span class="ident" id="5857298">n</span><span class="op" id="5857299">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857303">x</span><span class="op" id="5857304">.</span><span class="ident" id="5857305">sa</span>&nbsp;<span class="op" id="5857308">=</span>&nbsp;<span class="ident" id="5857310">x</span><span class="op" id="5857311">.</span><span class="ident" id="5857312">sa</span><span class="op" id="5857314">[</span><span class="num" id="5857315">0</span><span class="op" id="5857316">:</span><span class="ident" id="5857317">n</span><span class="op" id="5857318">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857325">//&nbsp;read&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857339">if</span>&nbsp;<span class="ident" id="5857342">_</span><span class="op" id="5857343">,</span>&nbsp;<span class="ident" id="5857345">err</span>&nbsp;<span class="op" id="5857349">:=</span>&nbsp;<span class="ident" id="5857352">io</span><span class="op" id="5857354">.</span><span class="ident" id="5857355">ReadFull</span><span class="op" id="5857363">(</span><span class="ident" id="5857364">r</span><span class="op" id="5857365">,</span>&nbsp;<span class="ident" id="5857367">x</span><span class="op" id="5857368">.</span><span class="ident" id="5857369">data</span><span class="op" id="5857373">)</span><span class="op" id="5857374">;</span>&nbsp;<span class="ident" id="5857376">err</span>&nbsp;<span class="op" id="5857380">!=</span>&nbsp;<span class="ident" id="5857383">nil</span>&nbsp;<span class="op" id="5857387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857391">return</span>&nbsp;<span class="ident" id="5857398">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857407">//&nbsp;read&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857422">for</span>&nbsp;<span class="ident" id="5857426">sa</span>&nbsp;<span class="op" id="5857429">:=</span>&nbsp;<span class="ident" id="5857432">x</span><span class="op" id="5857433">.</span><span class="ident" id="5857434">sa</span><span class="op" id="5857436">;</span>&nbsp;<span class="builtinfunc" id="5857438">len</span><span class="op" id="5857441">(</span><span class="ident" id="5857442">sa</span><span class="op" id="5857444">)</span>&nbsp;<span class="op" id="5857446">&gt;</span>&nbsp;<span class="num" id="5857448">0</span><span class="op" id="5857449">;</span>&nbsp;<span class="op" id="5857451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857455">n</span><span class="op" id="5857456">,</span>&nbsp;<span class="ident" id="5857458">err</span>&nbsp;<span class="op" id="5857462">:=</span>&nbsp;<span class="ident" id="5857465">readSlice</span><span class="op" id="5857474">(</span><span class="ident" id="5857475">r</span><span class="op" id="5857476">,</span>&nbsp;<span class="ident" id="5857478">buf</span><span class="op" id="5857481">,</span>&nbsp;<span class="ident" id="5857483">sa</span><span class="op" id="5857485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857489">if</span>&nbsp;<span class="ident" id="5857492">err</span>&nbsp;<span class="op" id="5857496">!=</span>&nbsp;<span class="ident" id="5857499">nil</span>&nbsp;<span class="op" id="5857503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857508">return</span>&nbsp;<span class="ident" id="5857515">err</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857525">sa</span>&nbsp;<span class="op" id="5857528">=</span>&nbsp;<span class="ident" id="5857530">sa</span><span class="op" id="5857532">[</span><span class="ident" id="5857533">n</span><span class="op" id="5857534">:</span><span class="op" id="5857535">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857541">return</span>&nbsp;<span class="ident" id="5857548">nil</span><br>
<span class="lineno"></span><span class="op" id="5857552">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="5857555">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;index&nbsp;x&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5857589">func</span>&nbsp;<span class="op" id="5857594">(</span><span class="ident" id="5857595">x</span>&nbsp;<span class="op" id="5857597">*</span><span class="ident" id="5857598">Index</span><span class="op" id="5857603">)</span>&nbsp;<span class="ident" id="5857605">Write</span><span class="op" id="5857610">(</span><span class="ident" id="5857611">w</span>&nbsp;<span class="ident" id="5857613">io</span><span class="op" id="5857615">.</span><span class="ident" id="5857616">Writer</span><span class="op" id="5857622">)</span>&nbsp;<span class="builtintype" id="5857624">error</span>&nbsp;<span class="op" id="5857630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857633">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857659">buf</span>&nbsp;<span class="op" id="5857663">:=</span>&nbsp;<span class="builtinfunc" id="5857666">make</span><span class="op" id="5857670">(</span><span class="op" id="5857671">[</span><span class="op" id="5857672">]</span><span class="builtintype" id="5857673">byte</span><span class="op" id="5857677">,</span>&nbsp;<span class="ident" id="5857679">bufSize</span><span class="op" id="5857686">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857690">//&nbsp;write&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857707">if</span>&nbsp;<span class="ident" id="5857710">err</span>&nbsp;<span class="op" id="5857714">:=</span>&nbsp;<span class="ident" id="5857717">writeInt</span><span class="op" id="5857725">(</span><span class="ident" id="5857726">w</span><span class="op" id="5857727">,</span>&nbsp;<span class="ident" id="5857729">buf</span><span class="op" id="5857732">,</span>&nbsp;<span class="builtinfunc" id="5857734">len</span><span class="op" id="5857737">(</span><span class="ident" id="5857738">x</span><span class="op" id="5857739">.</span><span class="ident" id="5857740">data</span><span class="op" id="5857744">)</span><span class="op" id="5857745">)</span><span class="op" id="5857746">;</span>&nbsp;<span class="ident" id="5857748">err</span>&nbsp;<span class="op" id="5857752">!=</span>&nbsp;<span class="ident" id="5857755">nil</span>&nbsp;<span class="op" id="5857759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857763">return</span>&nbsp;<span class="ident" id="5857770">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857775">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857779">//&nbsp;write&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857794">if</span>&nbsp;<span class="ident" id="5857797">_</span><span class="op" id="5857798">,</span>&nbsp;<span class="ident" id="5857800">err</span>&nbsp;<span class="op" id="5857804">:=</span>&nbsp;<span class="ident" id="5857807">w</span><span class="op" id="5857808">.</span><span class="ident" id="5857809">Write</span><span class="op" id="5857814">(</span><span class="ident" id="5857815">x</span><span class="op" id="5857816">.</span><span class="ident" id="5857817">data</span><span class="op" id="5857821">)</span><span class="op" id="5857822">;</span>&nbsp;<span class="ident" id="5857824">err</span>&nbsp;<span class="op" id="5857828">!=</span>&nbsp;<span class="ident" id="5857831">nil</span>&nbsp;<span class="op" id="5857835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857839">return</span>&nbsp;<span class="ident" id="5857846">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857851">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857855">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857871">for</span>&nbsp;<span class="ident" id="5857875">sa</span>&nbsp;<span class="op" id="5857878">:=</span>&nbsp;<span class="ident" id="5857881">x</span><span class="op" id="5857882">.</span><span class="ident" id="5857883">sa</span><span class="op" id="5857885">;</span>&nbsp;<span class="builtinfunc" id="5857887">len</span><span class="op" id="5857890">(</span><span class="ident" id="5857891">sa</span><span class="op" id="5857893">)</span>&nbsp;<span class="op" id="5857895">&gt;</span>&nbsp;<span class="num" id="5857897">0</span><span class="op" id="5857898">;</span>&nbsp;<span class="op" id="5857900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857904">n</span><span class="op" id="5857905">,</span>&nbsp;<span class="ident" id="5857907">err</span>&nbsp;<span class="op" id="5857911">:=</span>&nbsp;<span class="ident" id="5857914">writeSlice</span><span class="op" id="5857924">(</span><span class="ident" id="5857925">w</span><span class="op" id="5857926">,</span>&nbsp;<span class="ident" id="5857928">buf</span><span class="op" id="5857931">,</span>&nbsp;<span class="ident" id="5857933">sa</span><span class="op" id="5857935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857939">if</span>&nbsp;<span class="ident" id="5857942">err</span>&nbsp;<span class="op" id="5857946">!=</span>&nbsp;<span class="ident" id="5857949">nil</span>&nbsp;<span class="op" id="5857953">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857958">return</span>&nbsp;<span class="ident" id="5857965">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857975">sa</span>&nbsp;<span class="op" id="5857978">=</span>&nbsp;<span class="ident" id="5857980">sa</span><span class="op" id="5857982">[</span><span class="ident" id="5857983">n</span><span class="op" id="5857984">:</span><span class="op" id="5857985">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857991">return</span>&nbsp;<span class="ident" id="5857998">nil</span><br>
<span class="lineno">160</span><span class="op" id="5858002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5858005">//&nbsp;Bytes&nbsp;returns&nbsp;the&nbsp;data&nbsp;over&nbsp;which&nbsp;the&nbsp;index&nbsp;was&nbsp;created.</span><br>
<span class="lineno"></span><span class="comment" id="5858065">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="comment" id="5858093">//</span><br>
<span class="lineno">165</span><span class="keyword" id="5858096">func</span>&nbsp;<span class="op" id="5858101">(</span><span class="ident" id="5858102">x</span>&nbsp;<span class="op" id="5858104">*</span><span class="ident" id="5858105">Index</span><span class="op" id="5858110">)</span>&nbsp;<span class="ident" id="5858112">Bytes</span><span class="op" id="5858117">(</span><span class="op" id="5858118">)</span>&nbsp;<span class="op" id="5858120">[</span><span class="op" id="5858121">]</span><span class="builtintype" id="5858122">byte</span>&nbsp;<span class="op" id="5858127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858130">return</span>&nbsp;<span class="ident" id="5858137">x</span><span class="op" id="5858138">.</span><span class="ident" id="5858139">data</span><br>
<span class="lineno"></span><span class="op" id="5858144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5858147">func</span>&nbsp;<span class="op" id="5858152">(</span><span class="ident" id="5858153">x</span>&nbsp;<span class="op" id="5858155">*</span><span class="ident" id="5858156">Index</span><span class="op" id="5858161">)</span>&nbsp;<span class="ident" id="5858163">at</span><span class="op" id="5858165">(</span><span class="ident" id="5858166">i</span>&nbsp;<span class="builtintype" id="5858168">int</span><span class="op" id="5858171">)</span>&nbsp;<span class="op" id="5858173">[</span><span class="op" id="5858174">]</span><span class="builtintype" id="5858175">byte</span>&nbsp;<span class="op" id="5858180">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858183">return</span>&nbsp;<span class="ident" id="5858190">x</span><span class="op" id="5858191">.</span><span class="ident" id="5858192">data</span><span class="op" id="5858196">[</span><span class="ident" id="5858197">x</span><span class="op" id="5858198">.</span><span class="ident" id="5858199">sa</span><span class="op" id="5858201">[</span><span class="ident" id="5858202">i</span><span class="op" id="5858203">]</span><span class="op" id="5858204">:</span><span class="op" id="5858205">]</span><br>
<span class="lineno"></span><span class="op" id="5858207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5858210">//&nbsp;lookupAll&nbsp;returns&nbsp;a&nbsp;slice&nbsp;into&nbsp;the&nbsp;matching&nbsp;region&nbsp;of&nbsp;the&nbsp;index.</span><br>
<span class="lineno"></span><span class="comment" id="5858278">//&nbsp;The&nbsp;runtime&nbsp;is&nbsp;O(log(N)*len(s)).</span><br>
<span class="lineno">175</span><span class="keyword" id="5858314">func</span>&nbsp;<span class="op" id="5858319">(</span><span class="ident" id="5858320">x</span>&nbsp;<span class="op" id="5858322">*</span><span class="ident" id="5858323">Index</span><span class="op" id="5858328">)</span>&nbsp;<span class="ident" id="5858330">lookupAll</span><span class="op" id="5858339">(</span><span class="ident" id="5858340">s</span>&nbsp;<span class="op" id="5858342">[</span><span class="op" id="5858343">]</span><span class="builtintype" id="5858344">byte</span><span class="op" id="5858348">)</span>&nbsp;<span class="op" id="5858350">[</span><span class="op" id="5858351">]</span><span class="builtintype" id="5858352">int</span>&nbsp;<span class="op" id="5858356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858359">//&nbsp;find&nbsp;matching&nbsp;suffix&nbsp;index&nbsp;range&nbsp;[i:j]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858402">//&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;where&nbsp;s&nbsp;would&nbsp;be&nbsp;the&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858455">i</span>&nbsp;<span class="op" id="5858457">:=</span>&nbsp;<span class="ident" id="5858460">sort</span><span class="op" id="5858464">.</span><span class="ident" id="5858465">Search</span><span class="op" id="5858471">(</span><span class="builtinfunc" id="5858472">len</span><span class="op" id="5858475">(</span><span class="ident" id="5858476">x</span><span class="op" id="5858477">.</span><span class="ident" id="5858478">sa</span><span class="op" id="5858480">)</span><span class="op" id="5858481">,</span>&nbsp;<span class="keyword" id="5858483">func</span><span class="op" id="5858487">(</span><span class="ident" id="5858488">i</span>&nbsp;<span class="builtintype" id="5858490">int</span><span class="op" id="5858493">)</span>&nbsp;<span class="builtintype" id="5858495">bool</span>&nbsp;<span class="op" id="5858500">{</span>&nbsp;<span class="keyword" id="5858502">return</span>&nbsp;<span class="ident" id="5858509">bytes</span><span class="op" id="5858514">.</span><span class="ident" id="5858515">Compare</span><span class="op" id="5858522">(</span><span class="ident" id="5858523">x</span><span class="op" id="5858524">.</span><span class="ident" id="5858525">at</span><span class="op" id="5858527">(</span><span class="ident" id="5858528">i</span><span class="op" id="5858529">)</span><span class="op" id="5858530">,</span>&nbsp;<span class="ident" id="5858532">s</span><span class="op" id="5858533">)</span>&nbsp;<span class="op" id="5858535">&gt;=</span>&nbsp;<span class="num" id="5858538">0</span>&nbsp;<span class="op" id="5858540">}</span><span class="op" id="5858541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858544">//&nbsp;starting&nbsp;at&nbsp;i,&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;at&nbsp;which&nbsp;s&nbsp;is&nbsp;not&nbsp;a&nbsp;prefix</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858611">j</span>&nbsp;<span class="op" id="5858613">:=</span>&nbsp;<span class="ident" id="5858616">i</span>&nbsp;<span class="op" id="5858618">+</span>&nbsp;<span class="ident" id="5858620">sort</span><span class="op" id="5858624">.</span><span class="ident" id="5858625">Search</span><span class="op" id="5858631">(</span><span class="builtinfunc" id="5858632">len</span><span class="op" id="5858635">(</span><span class="ident" id="5858636">x</span><span class="op" id="5858637">.</span><span class="ident" id="5858638">sa</span><span class="op" id="5858640">)</span><span class="op" id="5858641">-</span><span class="ident" id="5858642">i</span><span class="op" id="5858643">,</span>&nbsp;<span class="keyword" id="5858645">func</span><span class="op" id="5858649">(</span><span class="ident" id="5858650">j</span>&nbsp;<span class="builtintype" id="5858652">int</span><span class="op" id="5858655">)</span>&nbsp;<span class="builtintype" id="5858657">bool</span>&nbsp;<span class="op" id="5858662">{</span>&nbsp;<span class="keyword" id="5858664">return</span>&nbsp;<span class="op" id="5858671">!</span><span class="ident" id="5858672">bytes</span><span class="op" id="5858677">.</span><span class="ident" id="5858678">HasPrefix</span><span class="op" id="5858687">(</span><span class="ident" id="5858688">x</span><span class="op" id="5858689">.</span><span class="ident" id="5858690">at</span><span class="op" id="5858692">(</span><span class="ident" id="5858693">j</span><span class="op" id="5858694">+</span><span class="ident" id="5858695">i</span><span class="op" id="5858696">)</span><span class="op" id="5858697">,</span>&nbsp;<span class="ident" id="5858699">s</span><span class="op" id="5858700">)</span>&nbsp;<span class="op" id="5858702">}</span><span class="op" id="5858703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858706">return</span>&nbsp;<span class="ident" id="5858713">x</span><span class="op" id="5858714">.</span><span class="ident" id="5858715">sa</span><span class="op" id="5858717">[</span><span class="ident" id="5858718">i</span><span class="op" id="5858719">:</span><span class="ident" id="5858720">j</span><span class="op" id="5858721">]</span><br>
<span class="lineno"></span><span class="op" id="5858723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5858726">//&nbsp;Lookup&nbsp;returns&nbsp;an&nbsp;unsorted&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;n&nbsp;indices&nbsp;where&nbsp;the&nbsp;byte&nbsp;string&nbsp;s</span><br>
<span class="lineno">185</span><span class="comment" id="5858806">//&nbsp;occurs&nbsp;in&nbsp;the&nbsp;indexed&nbsp;data.&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;occurrences&nbsp;are&nbsp;returned.</span><br>
<span class="lineno"></span><span class="comment" id="5858877">//&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;s&nbsp;is&nbsp;empty,&nbsp;s&nbsp;is&nbsp;not&nbsp;found,&nbsp;or&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="5858940">//&nbsp;Lookup&nbsp;time&nbsp;is&nbsp;O(log(N)*len(s)&nbsp;+&nbsp;len(result))&nbsp;where&nbsp;N&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5859004">//&nbsp;size&nbsp;of&nbsp;the&nbsp;indexed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5859033">//</span><br>
<span class="lineno">190</span><span class="keyword" id="5859036">func</span>&nbsp;<span class="op" id="5859041">(</span><span class="ident" id="5859042">x</span>&nbsp;<span class="op" id="5859044">*</span><span class="ident" id="5859045">Index</span><span class="op" id="5859050">)</span>&nbsp;<span class="ident" id="5859052">Lookup</span><span class="op" id="5859058">(</span><span class="ident" id="5859059">s</span>&nbsp;<span class="op" id="5859061">[</span><span class="op" id="5859062">]</span><span class="builtintype" id="5859063">byte</span><span class="op" id="5859067">,</span>&nbsp;<span class="ident" id="5859069">n</span>&nbsp;<span class="builtintype" id="5859071">int</span><span class="op" id="5859074">)</span>&nbsp;<span class="op" id="5859076">(</span><span class="ident" id="5859077">result</span>&nbsp;<span class="op" id="5859084">[</span><span class="op" id="5859085">]</span><span class="builtintype" id="5859086">int</span><span class="op" id="5859089">)</span>&nbsp;<span class="op" id="5859091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859094">if</span>&nbsp;<span class="builtinfunc" id="5859097">len</span><span class="op" id="5859100">(</span><span class="ident" id="5859101">s</span><span class="op" id="5859102">)</span>&nbsp;<span class="op" id="5859104">&gt;</span>&nbsp;<span class="num" id="5859106">0</span>&nbsp;<span class="op" id="5859108">&amp;&amp;</span>&nbsp;<span class="ident" id="5859111">n</span>&nbsp;<span class="op" id="5859113">!=</span>&nbsp;<span class="num" id="5859116">0</span>&nbsp;<span class="op" id="5859118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859122">matches</span>&nbsp;<span class="op" id="5859130">:=</span>&nbsp;<span class="ident" id="5859133">x</span><span class="op" id="5859134">.</span><span class="ident" id="5859135">lookupAll</span><span class="op" id="5859144">(</span><span class="ident" id="5859145">s</span><span class="op" id="5859146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859150">if</span>&nbsp;<span class="ident" id="5859153">n</span>&nbsp;<span class="op" id="5859155">&lt;</span>&nbsp;<span class="num" id="5859157">0</span>&nbsp;<span class="op" id="5859159">||</span>&nbsp;<span class="builtinfunc" id="5859162">len</span><span class="op" id="5859165">(</span><span class="ident" id="5859166">matches</span><span class="op" id="5859173">)</span>&nbsp;<span class="op" id="5859175">&lt;</span>&nbsp;<span class="ident" id="5859177">n</span>&nbsp;<span class="op" id="5859179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859184">n</span>&nbsp;<span class="op" id="5859186">=</span>&nbsp;<span class="builtinfunc" id="5859188">len</span><span class="op" id="5859191">(</span><span class="ident" id="5859192">matches</span><span class="op" id="5859199">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859207">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(matches)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859235">if</span>&nbsp;<span class="ident" id="5859238">n</span>&nbsp;<span class="op" id="5859240">&gt;</span>&nbsp;<span class="num" id="5859242">0</span>&nbsp;<span class="op" id="5859244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859249">result</span>&nbsp;<span class="op" id="5859256">=</span>&nbsp;<span class="builtinfunc" id="5859258">make</span><span class="op" id="5859262">(</span><span class="op" id="5859263">[</span><span class="op" id="5859264">]</span><span class="builtintype" id="5859265">int</span><span class="op" id="5859268">,</span>&nbsp;<span class="ident" id="5859270">n</span><span class="op" id="5859271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5859276">copy</span><span class="op" id="5859280">(</span><span class="ident" id="5859281">result</span><span class="op" id="5859287">,</span>&nbsp;<span class="ident" id="5859289">matches</span><span class="op" id="5859296">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859306">return</span><br>
<span class="lineno"></span><span class="op" id="5859313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5859316">//&nbsp;FindAllIndex&nbsp;returns&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;non-overlapping&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5859388">//&nbsp;regular&nbsp;expression&nbsp;r,&nbsp;where&nbsp;a&nbsp;match&nbsp;is&nbsp;a&nbsp;pair&nbsp;of&nbsp;indices&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="5859459">//&nbsp;the&nbsp;matched&nbsp;slice&nbsp;of&nbsp;x.Bytes().&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;matches&nbsp;are&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="5859529">//&nbsp;in&nbsp;successive&nbsp;order.&nbsp;Otherwise,&nbsp;at&nbsp;most&nbsp;n&nbsp;matches&nbsp;are&nbsp;returned&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5859599">//&nbsp;they&nbsp;may&nbsp;not&nbsp;be&nbsp;successive.&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;matches,</span><br>
<span class="lineno">210</span><span class="comment" id="5859673">//&nbsp;or&nbsp;if&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="5859690">//</span><br>
<span class="lineno"></span><span class="keyword" id="5859693">func</span>&nbsp;<span class="op" id="5859698">(</span><span class="ident" id="5859699">x</span>&nbsp;<span class="op" id="5859701">*</span><span class="ident" id="5859702">Index</span><span class="op" id="5859707">)</span>&nbsp;<span class="ident" id="5859709">FindAllIndex</span><span class="op" id="5859721">(</span><span class="ident" id="5859722">r</span>&nbsp;<span class="op" id="5859724">*</span><span class="ident" id="5859725">regexp</span><span class="op" id="5859731">.</span><span class="ident" id="5859732">Regexp</span><span class="op" id="5859738">,</span>&nbsp;<span class="ident" id="5859740">n</span>&nbsp;<span class="builtintype" id="5859742">int</span><span class="op" id="5859745">)</span>&nbsp;<span class="op" id="5859747">(</span><span class="ident" id="5859748">result</span>&nbsp;<span class="op" id="5859755">[</span><span class="op" id="5859756">]</span><span class="op" id="5859757">[</span><span class="op" id="5859758">]</span><span class="builtintype" id="5859759">int</span><span class="op" id="5859762">)</span>&nbsp;<span class="op" id="5859764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859767">//&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix&nbsp;is&nbsp;used&nbsp;to&nbsp;determine&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859828">//&nbsp;match&nbsp;start&nbsp;indices&nbsp;with&nbsp;Lookup</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859864">prefix</span><span class="op" id="5859870">,</span>&nbsp;<span class="ident" id="5859872">complete</span>&nbsp;<span class="op" id="5859881">:=</span>&nbsp;<span class="ident" id="5859884">r</span><span class="op" id="5859885">.</span><span class="ident" id="5859886">LiteralPrefix</span><span class="op" id="5859899">(</span><span class="op" id="5859900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859903">lit</span>&nbsp;<span class="op" id="5859907">:=</span>&nbsp;<span class="op" id="5859910">[</span><span class="op" id="5859911">]</span><span class="builtintype" id="5859912">byte</span><span class="op" id="5859916">(</span><span class="ident" id="5859917">prefix</span><span class="op" id="5859923">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859927">//&nbsp;worst-case&nbsp;scenario:&nbsp;no&nbsp;literal&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859970">if</span>&nbsp;<span class="ident" id="5859973">prefix</span>&nbsp;<span class="op" id="5859980">==</span>&nbsp;<span class="string" id="5859983">&#34;&#34;</span>&nbsp;<span class="op" id="5859986">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859990">return</span>&nbsp;<span class="ident" id="5859997">r</span><span class="op" id="5859998">.</span><span class="ident" id="5859999">FindAllIndex</span><span class="op" id="5860011">(</span><span class="ident" id="5860012">x</span><span class="op" id="5860013">.</span><span class="ident" id="5860014">data</span><span class="op" id="5860018">,</span>&nbsp;<span class="ident" id="5860020">n</span><span class="op" id="5860021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5860024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5860028">//&nbsp;if&nbsp;regexp&nbsp;is&nbsp;a&nbsp;literal&nbsp;just&nbsp;use&nbsp;Lookup&nbsp;and&nbsp;convert&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5860087">//&nbsp;result&nbsp;into&nbsp;match&nbsp;pairs</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860115">if</span>&nbsp;<span class="ident" id="5860118">complete</span>&nbsp;<span class="op" id="5860127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5860131">//&nbsp;Lookup&nbsp;returns&nbsp;indices&nbsp;that&nbsp;may&nbsp;belong&nbsp;to&nbsp;overlapping&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5860199">//&nbsp;After&nbsp;eliminating&nbsp;them,&nbsp;we&nbsp;may&nbsp;end&nbsp;up&nbsp;with&nbsp;fewer&nbsp;than&nbsp;n&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5860269">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;enough&nbsp;at&nbsp;the&nbsp;end,&nbsp;redo&nbsp;the&nbsp;search&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5860334">//&nbsp;increased&nbsp;value&nbsp;n1,&nbsp;but&nbsp;only&nbsp;if&nbsp;Lookup&nbsp;returned&nbsp;all&nbsp;the&nbsp;requested</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5860405">//&nbsp;indices&nbsp;in&nbsp;the&nbsp;first&nbsp;place&nbsp;(if&nbsp;it&nbsp;returned&nbsp;fewer&nbsp;than&nbsp;that&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5860474">//&nbsp;there&nbsp;cannot&nbsp;be&nbsp;more).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860502">for</span>&nbsp;<span class="ident" id="5860506">n1</span>&nbsp;<span class="op" id="5860509">:=</span>&nbsp;<span class="ident" id="5860512">n</span><span class="op" id="5860513">;</span>&nbsp;<span class="op" id="5860515">;</span>&nbsp;<span class="ident" id="5860517">n1</span>&nbsp;<span class="op" id="5860520">+=</span>&nbsp;<span class="num" id="5860523">2</span>&nbsp;<span class="op" id="5860525">*</span>&nbsp;<span class="op" id="5860527">(</span><span class="ident" id="5860528">n</span>&nbsp;<span class="op" id="5860530">-</span>&nbsp;<span class="builtinfunc" id="5860532">len</span><span class="op" id="5860535">(</span><span class="ident" id="5860536">result</span><span class="op" id="5860542">)</span><span class="op" id="5860543">)</span>&nbsp;<span class="comment" id="5860545">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="5860563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860568">indices</span>&nbsp;<span class="op" id="5860576">:=</span>&nbsp;<span class="ident" id="5860579">x</span><span class="op" id="5860580">.</span><span class="ident" id="5860581">Lookup</span><span class="op" id="5860587">(</span><span class="ident" id="5860588">lit</span><span class="op" id="5860591">,</span>&nbsp;<span class="ident" id="5860593">n1</span><span class="op" id="5860595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860600">if</span>&nbsp;<span class="builtinfunc" id="5860603">len</span><span class="op" id="5860606">(</span><span class="ident" id="5860607">indices</span><span class="op" id="5860614">)</span>&nbsp;<span class="op" id="5860616">==</span>&nbsp;<span class="num" id="5860619">0</span>&nbsp;<span class="op" id="5860621">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860627">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5860637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860642">sort</span><span class="op" id="5860646">.</span><span class="ident" id="5860647">Ints</span><span class="op" id="5860651">(</span><span class="ident" id="5860652">indices</span><span class="op" id="5860659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860664">pairs</span>&nbsp;<span class="op" id="5860670">:=</span>&nbsp;<span class="builtinfunc" id="5860673">make</span><span class="op" id="5860677">(</span><span class="op" id="5860678">[</span><span class="op" id="5860679">]</span><span class="builtintype" id="5860680">int</span><span class="op" id="5860683">,</span>&nbsp;<span class="num" id="5860685">2</span><span class="op" id="5860686">*</span><span class="builtinfunc" id="5860687">len</span><span class="op" id="5860690">(</span><span class="ident" id="5860691">indices</span><span class="op" id="5860698">)</span><span class="op" id="5860699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860704">result</span>&nbsp;<span class="op" id="5860711">=</span>&nbsp;<span class="builtinfunc" id="5860713">make</span><span class="op" id="5860717">(</span><span class="op" id="5860718">[</span><span class="op" id="5860719">]</span><span class="op" id="5860720">[</span><span class="op" id="5860721">]</span><span class="builtintype" id="5860722">int</span><span class="op" id="5860725">,</span>&nbsp;<span class="builtinfunc" id="5860727">len</span><span class="op" id="5860730">(</span><span class="ident" id="5860731">indices</span><span class="op" id="5860738">)</span><span class="op" id="5860739">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860744">count</span>&nbsp;<span class="op" id="5860750">:=</span>&nbsp;<span class="num" id="5860753">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860758">prev</span>&nbsp;<span class="op" id="5860763">:=</span>&nbsp;<span class="num" id="5860766">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860771">for</span>&nbsp;<span class="ident" id="5860775">_</span><span class="op" id="5860776">,</span>&nbsp;<span class="ident" id="5860778">i</span>&nbsp;<span class="op" id="5860780">:=</span>&nbsp;<span class="keyword" id="5860783">range</span>&nbsp;<span class="ident" id="5860789">indices</span>&nbsp;<span class="op" id="5860797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860803">if</span>&nbsp;<span class="ident" id="5860806">count</span>&nbsp;<span class="op" id="5860812">==</span>&nbsp;<span class="ident" id="5860815">n</span>&nbsp;<span class="op" id="5860817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860824">break</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5860834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5860840">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860893">if</span>&nbsp;<span class="ident" id="5860896">prev</span>&nbsp;<span class="op" id="5860901">&lt;=</span>&nbsp;<span class="ident" id="5860904">i</span>&nbsp;<span class="op" id="5860906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860913">j</span>&nbsp;<span class="op" id="5860915">:=</span>&nbsp;<span class="num" id="5860918">2</span>&nbsp;<span class="op" id="5860920">*</span>&nbsp;<span class="ident" id="5860922">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860933">pairs</span><span class="op" id="5860938">[</span><span class="ident" id="5860939">j</span><span class="op" id="5860940">+</span><span class="num" id="5860941">0</span><span class="op" id="5860942">]</span>&nbsp;<span class="op" id="5860944">=</span>&nbsp;<span class="ident" id="5860946">i</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860953">pairs</span><span class="op" id="5860958">[</span><span class="ident" id="5860959">j</span><span class="op" id="5860960">+</span><span class="num" id="5860961">1</span><span class="op" id="5860962">]</span>&nbsp;<span class="op" id="5860964">=</span>&nbsp;<span class="ident" id="5860966">i</span>&nbsp;<span class="op" id="5860968">+</span>&nbsp;<span class="builtinfunc" id="5860970">len</span><span class="op" id="5860973">(</span><span class="ident" id="5860974">lit</span><span class="op" id="5860977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860984">result</span><span class="op" id="5860990">[</span><span class="ident" id="5860991">count</span><span class="op" id="5860996">]</span>&nbsp;<span class="op" id="5860998">=</span>&nbsp;<span class="ident" id="5861000">pairs</span><span class="op" id="5861005">[</span><span class="ident" id="5861006">j</span>&nbsp;<span class="op" id="5861008">:</span>&nbsp;<span class="ident" id="5861010">j</span><span class="op" id="5861011">+</span><span class="num" id="5861012">2</span><span class="op" id="5861013">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861020">count</span><span class="op" id="5861025">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861033">prev</span>&nbsp;<span class="op" id="5861038">=</span>&nbsp;<span class="ident" id="5861040">i</span>&nbsp;<span class="op" id="5861042">+</span>&nbsp;<span class="builtinfunc" id="5861044">len</span><span class="op" id="5861047">(</span><span class="ident" id="5861048">lit</span><span class="op" id="5861051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861057">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861067">result</span>&nbsp;<span class="op" id="5861074">=</span>&nbsp;<span class="ident" id="5861076">result</span><span class="op" id="5861082">[</span><span class="num" id="5861083">0</span><span class="op" id="5861084">:</span><span class="ident" id="5861085">count</span><span class="op" id="5861090">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861095">if</span>&nbsp;<span class="builtinfunc" id="5861098">len</span><span class="op" id="5861101">(</span><span class="ident" id="5861102">result</span><span class="op" id="5861108">)</span>&nbsp;<span class="op" id="5861110">&gt;=</span>&nbsp;<span class="ident" id="5861113">n</span>&nbsp;<span class="op" id="5861115">||</span>&nbsp;<span class="builtinfunc" id="5861118">len</span><span class="op" id="5861121">(</span><span class="ident" id="5861122">indices</span><span class="op" id="5861129">)</span>&nbsp;<span class="op" id="5861131">!=</span>&nbsp;<span class="ident" id="5861134">n1</span>&nbsp;<span class="op" id="5861137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5861143">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5861202">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861236">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861253">if</span>&nbsp;<span class="builtinfunc" id="5861256">len</span><span class="op" id="5861259">(</span><span class="ident" id="5861260">result</span><span class="op" id="5861266">)</span>&nbsp;<span class="op" id="5861268">==</span>&nbsp;<span class="num" id="5861271">0</span>&nbsp;<span class="op" id="5861273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861278">result</span>&nbsp;<span class="op" id="5861285">=</span>&nbsp;<span class="ident" id="5861287">nil</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861297">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5861309">//&nbsp;regexp&nbsp;has&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix;&nbsp;Lookup(lit)&nbsp;computes</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5861373">//&nbsp;the&nbsp;indices&nbsp;of&nbsp;possible&nbsp;complete&nbsp;matches;&nbsp;use&nbsp;these&nbsp;as&nbsp;starting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5861441">//&nbsp;points&nbsp;for&nbsp;anchored&nbsp;searches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5861474">//&nbsp;(regexp&nbsp;&#34;^&#34;&nbsp;matches&nbsp;beginning&nbsp;of&nbsp;input,&nbsp;not&nbsp;beginning&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861541">r</span>&nbsp;<span class="op" id="5861543">=</span>&nbsp;<span class="ident" id="5861545">regexp</span><span class="op" id="5861551">.</span><span class="ident" id="5861552">MustCompile</span><span class="op" id="5861563">(</span><span class="string" id="5861564">&#34;^&#34;</span>&nbsp;<span class="op" id="5861568">+</span>&nbsp;<span class="ident" id="5861570">r</span><span class="op" id="5861571">.</span><span class="ident" id="5861572">String</span><span class="op" id="5861578">(</span><span class="op" id="5861579">)</span><span class="op" id="5861580">)</span>&nbsp;<span class="comment" id="5861582">//&nbsp;compiles&nbsp;because&nbsp;r&nbsp;compiled</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5861615">//&nbsp;same&nbsp;comment&nbsp;about&nbsp;Lookup&nbsp;applies&nbsp;here&nbsp;as&nbsp;in&nbsp;the&nbsp;loop&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861679">for</span>&nbsp;<span class="ident" id="5861683">n1</span>&nbsp;<span class="op" id="5861686">:=</span>&nbsp;<span class="ident" id="5861689">n</span><span class="op" id="5861690">;</span>&nbsp;<span class="op" id="5861692">;</span>&nbsp;<span class="ident" id="5861694">n1</span>&nbsp;<span class="op" id="5861697">+=</span>&nbsp;<span class="num" id="5861700">2</span>&nbsp;<span class="op" id="5861702">*</span>&nbsp;<span class="op" id="5861704">(</span><span class="ident" id="5861705">n</span>&nbsp;<span class="op" id="5861707">-</span>&nbsp;<span class="builtinfunc" id="5861709">len</span><span class="op" id="5861712">(</span><span class="ident" id="5861713">result</span><span class="op" id="5861719">)</span><span class="op" id="5861720">)</span>&nbsp;<span class="comment" id="5861722">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="5861740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861744">indices</span>&nbsp;<span class="op" id="5861752">:=</span>&nbsp;<span class="ident" id="5861755">x</span><span class="op" id="5861756">.</span><span class="ident" id="5861757">Lookup</span><span class="op" id="5861763">(</span><span class="ident" id="5861764">lit</span><span class="op" id="5861767">,</span>&nbsp;<span class="ident" id="5861769">n1</span><span class="op" id="5861771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861775">if</span>&nbsp;<span class="builtinfunc" id="5861778">len</span><span class="op" id="5861781">(</span><span class="ident" id="5861782">indices</span><span class="op" id="5861789">)</span>&nbsp;<span class="op" id="5861791">==</span>&nbsp;<span class="num" id="5861794">0</span>&nbsp;<span class="op" id="5861796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861801">return</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861814">sort</span><span class="op" id="5861818">.</span><span class="ident" id="5861819">Ints</span><span class="op" id="5861823">(</span><span class="ident" id="5861824">indices</span><span class="op" id="5861831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861835">result</span>&nbsp;<span class="op" id="5861842">=</span>&nbsp;<span class="ident" id="5861844">result</span><span class="op" id="5861850">[</span><span class="num" id="5861851">0</span><span class="op" id="5861852">:</span><span class="num" id="5861853">0</span><span class="op" id="5861854">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861858">prev</span>&nbsp;<span class="op" id="5861863">:=</span>&nbsp;<span class="num" id="5861866">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861870">for</span>&nbsp;<span class="ident" id="5861874">_</span><span class="op" id="5861875">,</span>&nbsp;<span class="ident" id="5861877">i</span>&nbsp;<span class="op" id="5861879">:=</span>&nbsp;<span class="keyword" id="5861882">range</span>&nbsp;<span class="ident" id="5861888">indices</span>&nbsp;<span class="op" id="5861896">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861901">if</span>&nbsp;<span class="builtinfunc" id="5861904">len</span><span class="op" id="5861907">(</span><span class="ident" id="5861908">result</span><span class="op" id="5861914">)</span>&nbsp;<span class="op" id="5861916">==</span>&nbsp;<span class="ident" id="5861919">n</span>&nbsp;<span class="op" id="5861921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861927">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861941">m</span>&nbsp;<span class="op" id="5861943">:=</span>&nbsp;<span class="ident" id="5861946">r</span><span class="op" id="5861947">.</span><span class="ident" id="5861948">FindIndex</span><span class="op" id="5861957">(</span><span class="ident" id="5861958">x</span><span class="op" id="5861959">.</span><span class="ident" id="5861960">data</span><span class="op" id="5861964">[</span><span class="ident" id="5861965">i</span><span class="op" id="5861966">:</span><span class="op" id="5861967">]</span><span class="op" id="5861968">)</span>&nbsp;<span class="comment" id="5861970">//&nbsp;anchored&nbsp;search&nbsp;-&nbsp;will&nbsp;not&nbsp;run&nbsp;off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5862011">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5862063">if</span>&nbsp;<span class="ident" id="5862066">m</span>&nbsp;<span class="op" id="5862068">!=</span>&nbsp;<span class="ident" id="5862071">nil</span>&nbsp;<span class="op" id="5862075">&amp;&amp;</span>&nbsp;<span class="ident" id="5862078">prev</span>&nbsp;<span class="op" id="5862083">&lt;=</span>&nbsp;<span class="ident" id="5862086">i</span>&nbsp;<span class="op" id="5862088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5862094">m</span><span class="op" id="5862095">[</span><span class="num" id="5862096">0</span><span class="op" id="5862097">]</span>&nbsp;<span class="op" id="5862099">=</span>&nbsp;<span class="ident" id="5862101">i</span>&nbsp;<span class="comment" id="5862103">//&nbsp;correct&nbsp;m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5862120">m</span><span class="op" id="5862121">[</span><span class="num" id="5862122">1</span><span class="op" id="5862123">]</span>&nbsp;<span class="op" id="5862125">+=</span>&nbsp;<span class="ident" id="5862128">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5862134">result</span>&nbsp;<span class="op" id="5862141">=</span>&nbsp;<span class="builtinfunc" id="5862143">append</span><span class="op" id="5862149">(</span><span class="ident" id="5862150">result</span><span class="op" id="5862156">,</span>&nbsp;<span class="ident" id="5862158">m</span><span class="op" id="5862159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5862165">prev</span>&nbsp;<span class="op" id="5862170">=</span>&nbsp;<span class="ident" id="5862172">m</span><span class="op" id="5862173">[</span><span class="num" id="5862174">1</span><span class="op" id="5862175">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5862180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5862184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5862188">if</span>&nbsp;<span class="builtinfunc" id="5862191">len</span><span class="op" id="5862194">(</span><span class="ident" id="5862195">result</span><span class="op" id="5862201">)</span>&nbsp;<span class="op" id="5862203">&gt;=</span>&nbsp;<span class="ident" id="5862206">n</span>&nbsp;<span class="op" id="5862208">||</span>&nbsp;<span class="builtinfunc" id="5862211">len</span><span class="op" id="5862214">(</span><span class="ident" id="5862215">indices</span><span class="op" id="5862222">)</span>&nbsp;<span class="op" id="5862224">!=</span>&nbsp;<span class="ident" id="5862227">n1</span>&nbsp;<span class="op" id="5862230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5862235">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5862293">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5862326">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5862334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5862337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5862340">if</span>&nbsp;<span class="builtinfunc" id="5862343">len</span><span class="op" id="5862346">(</span><span class="ident" id="5862347">result</span><span class="op" id="5862353">)</span>&nbsp;<span class="op" id="5862355">==</span>&nbsp;<span class="num" id="5862358">0</span>&nbsp;<span class="op" id="5862360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5862364">result</span>&nbsp;<span class="op" id="5862371">=</span>&nbsp;<span class="ident" id="5862373">nil</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5862378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5862381">return</span><br>
<span class="lineno"></span><span class="op" id="5862388">}</span>
</div>
</body>
</html>
