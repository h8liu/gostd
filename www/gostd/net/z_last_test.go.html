<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8392078">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8392133">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8392187">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8392238">package</span>&nbsp;<span class="ident" id="8392246">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8392251">import</span>&nbsp;<span class="op" id="8392258">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8392261">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8392269">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8392276">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8392287">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8392294">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8392297">var</span>&nbsp;<span class="ident" id="8392301">testDNSFlood</span>&nbsp;<span class="op" id="8392314">=</span>&nbsp;<span class="ident" id="8392316">flag</span><span class="op" id="8392320">.</span><span class="ident" id="8392321">Bool</span><span class="op" id="8392325">(</span><span class="string" id="8392326">&#34;dnsflood&#34;</span><span class="op" id="8392336">,</span>&nbsp;<span class="builtintype" id="8392338">false</span><span class="op" id="8392343">,</span>&nbsp;<span class="string" id="8392345">&#34;whether&nbsp;to&nbsp;test&nbsp;dns&nbsp;query&nbsp;flooding&#34;</span><span class="op" id="8392381">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8392384">func</span>&nbsp;<span class="ident" id="8392389">TestDNSThreadLimit</span><span class="op" id="8392407">(</span><span class="ident" id="8392408">t</span>&nbsp;<span class="op" id="8392410">*</span><span class="ident" id="8392411">testing</span><span class="op" id="8392418">.</span><span class="ident" id="8392419">T</span><span class="op" id="8392420">)</span>&nbsp;<span class="op" id="8392422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8392425">if</span>&nbsp;<span class="op" id="8392428">!</span><span class="op" id="8392429">*</span><span class="ident" id="8392430">testDNSFlood</span>&nbsp;<span class="op" id="8392443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392447">t</span><span class="op" id="8392448">.</span><span class="ident" id="8392449">Skip</span><span class="op" id="8392453">(</span><span class="string" id="8392454">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-dnsflood&nbsp;to&nbsp;enable&#34;</span><span class="op" id="8392494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8392497">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8392501">const</span>&nbsp;<span class="ident" id="8392507">N</span>&nbsp;<span class="op" id="8392509">=</span>&nbsp;<span class="num" id="8392511">10000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392518">c</span>&nbsp;<span class="op" id="8392520">:=</span>&nbsp;<span class="builtinfunc" id="8392523">make</span><span class="op" id="8392527">(</span><span class="keyword" id="8392528">chan</span>&nbsp;<span class="builtintype" id="8392533">int</span><span class="op" id="8392536">,</span>&nbsp;<span class="ident" id="8392538">N</span><span class="op" id="8392539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8392542">for</span>&nbsp;<span class="ident" id="8392546">i</span>&nbsp;<span class="op" id="8392548">:=</span>&nbsp;<span class="num" id="8392551">0</span><span class="op" id="8392552">;</span>&nbsp;<span class="ident" id="8392554">i</span>&nbsp;<span class="op" id="8392556">&lt;</span>&nbsp;<span class="ident" id="8392558">N</span><span class="op" id="8392559">;</span>&nbsp;<span class="ident" id="8392561">i</span><span class="op" id="8392562">++</span>&nbsp;<span class="op" id="8392565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8392569">go</span>&nbsp;<span class="keyword" id="8392572">func</span><span class="op" id="8392576">(</span><span class="ident" id="8392577">i</span>&nbsp;<span class="builtintype" id="8392579">int</span><span class="op" id="8392582">)</span>&nbsp;<span class="op" id="8392584">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392589">LookupIP</span><span class="op" id="8392597">(</span><span class="ident" id="8392598">fmt</span><span class="op" id="8392601">.</span><span class="ident" id="8392602">Sprintf</span><span class="op" id="8392609">(</span><span class="string" id="8392610">&#34;%d.net-test.golang.org&#34;</span><span class="op" id="8392634">,</span>&nbsp;<span class="ident" id="8392636">i</span><span class="op" id="8392637">)</span><span class="op" id="8392638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392643">c</span>&nbsp;<span class="op" id="8392645">&lt;-</span>&nbsp;<span class="num" id="8392648">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8392652">}</span><span class="op" id="8392653">(</span><span class="ident" id="8392654">i</span><span class="op" id="8392655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8392658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8392661">//&nbsp;Don&#39;t&nbsp;bother&nbsp;waiting&nbsp;for&nbsp;the&nbsp;stragglers;&nbsp;stop&nbsp;at&nbsp;0.9&nbsp;N.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8392721">for</span>&nbsp;<span class="ident" id="8392725">i</span>&nbsp;<span class="op" id="8392727">:=</span>&nbsp;<span class="num" id="8392730">0</span><span class="op" id="8392731">;</span>&nbsp;<span class="ident" id="8392733">i</span>&nbsp;<span class="op" id="8392735">&lt;</span>&nbsp;<span class="ident" id="8392737">N</span><span class="op" id="8392738">*</span><span class="num" id="8392739">9</span><span class="op" id="8392740">/</span><span class="num" id="8392741">10</span><span class="op" id="8392743">;</span>&nbsp;<span class="ident" id="8392745">i</span><span class="op" id="8392746">++</span>&nbsp;<span class="op" id="8392749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8392753">if</span>&nbsp;<span class="ident" id="8392756">i</span><span class="op" id="8392757">%</span><span class="num" id="8392758">100</span>&nbsp;<span class="op" id="8392762">==</span>&nbsp;<span class="num" id="8392765">0</span>&nbsp;<span class="op" id="8392767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8392772">//println(&#34;TestDNSThreadLimit:&#34;,&nbsp;i)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8392810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8392814">&lt;-</span><span class="ident" id="8392816">c</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8392819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8392823">//&nbsp;If&nbsp;we&#39;re&nbsp;still&nbsp;here,&nbsp;it&nbsp;worked.</span><br>
<span class="lineno"></span><span class="op" id="8392858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="8392861">func</span>&nbsp;<span class="ident" id="8392866">TestLookupIPDeadline</span><span class="op" id="8392886">(</span><span class="ident" id="8392887">t</span>&nbsp;<span class="op" id="8392889">*</span><span class="ident" id="8392890">testing</span><span class="op" id="8392897">.</span><span class="ident" id="8392898">T</span><span class="op" id="8392899">)</span>&nbsp;<span class="op" id="8392901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8392904">if</span>&nbsp;<span class="op" id="8392907">!</span><span class="op" id="8392908">*</span><span class="ident" id="8392909">testDNSFlood</span>&nbsp;<span class="op" id="8392922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392926">t</span><span class="op" id="8392927">.</span><span class="ident" id="8392928">Skip</span><span class="op" id="8392932">(</span><span class="string" id="8392933">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-dnsflood&nbsp;to&nbsp;enable&#34;</span><span class="op" id="8392973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8392976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8392980">const</span>&nbsp;<span class="ident" id="8392986">N</span>&nbsp;<span class="op" id="8392988">=</span>&nbsp;<span class="num" id="8392990">5000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8392996">const</span>&nbsp;<span class="ident" id="8393002">timeout</span>&nbsp;<span class="op" id="8393010">=</span>&nbsp;<span class="num" id="8393012">3</span>&nbsp;<span class="op" id="8393014">*</span>&nbsp;<span class="ident" id="8393016">time</span><span class="op" id="8393020">.</span><span class="ident" id="8393021">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393029">c</span>&nbsp;<span class="op" id="8393031">:=</span>&nbsp;<span class="builtinfunc" id="8393034">make</span><span class="op" id="8393038">(</span><span class="keyword" id="8393039">chan</span>&nbsp;<span class="builtintype" id="8393044">error</span><span class="op" id="8393049">,</span>&nbsp;<span class="num" id="8393051">2</span><span class="op" id="8393052">*</span><span class="ident" id="8393053">N</span><span class="op" id="8393054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393057">for</span>&nbsp;<span class="ident" id="8393061">i</span>&nbsp;<span class="op" id="8393063">:=</span>&nbsp;<span class="num" id="8393066">0</span><span class="op" id="8393067">;</span>&nbsp;<span class="ident" id="8393069">i</span>&nbsp;<span class="op" id="8393071">&lt;</span>&nbsp;<span class="ident" id="8393073">N</span><span class="op" id="8393074">;</span>&nbsp;<span class="ident" id="8393076">i</span><span class="op" id="8393077">++</span>&nbsp;<span class="op" id="8393080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393084">name</span>&nbsp;<span class="op" id="8393089">:=</span>&nbsp;<span class="ident" id="8393092">fmt</span><span class="op" id="8393095">.</span><span class="ident" id="8393096">Sprintf</span><span class="op" id="8393103">(</span><span class="string" id="8393104">&#34;%d.net-test.golang.org&#34;</span><span class="op" id="8393128">,</span>&nbsp;<span class="ident" id="8393130">i</span><span class="op" id="8393131">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393135">go</span>&nbsp;<span class="keyword" id="8393138">func</span><span class="op" id="8393142">(</span><span class="op" id="8393143">)</span>&nbsp;<span class="op" id="8393145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393150">_</span><span class="op" id="8393151">,</span>&nbsp;<span class="ident" id="8393153">err</span>&nbsp;<span class="op" id="8393157">:=</span>&nbsp;<span class="ident" id="8393160">lookupIPDeadline</span><span class="op" id="8393176">(</span><span class="ident" id="8393177">name</span><span class="op" id="8393181">,</span>&nbsp;<span class="ident" id="8393183">time</span><span class="op" id="8393187">.</span><span class="ident" id="8393188">Now</span><span class="op" id="8393191">(</span><span class="op" id="8393192">)</span><span class="op" id="8393193">.</span><span class="ident" id="8393194">Add</span><span class="op" id="8393197">(</span><span class="ident" id="8393198">timeout</span><span class="op" id="8393205">/</span><span class="num" id="8393206">2</span><span class="op" id="8393207">)</span><span class="op" id="8393208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393213">c</span>&nbsp;<span class="op" id="8393215">&lt;-</span>&nbsp;<span class="ident" id="8393218">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393224">}</span><span class="op" id="8393225">(</span><span class="op" id="8393226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393230">go</span>&nbsp;<span class="keyword" id="8393233">func</span><span class="op" id="8393237">(</span><span class="op" id="8393238">)</span>&nbsp;<span class="op" id="8393240">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393245">_</span><span class="op" id="8393246">,</span>&nbsp;<span class="ident" id="8393248">err</span>&nbsp;<span class="op" id="8393252">:=</span>&nbsp;<span class="ident" id="8393255">lookupIPDeadline</span><span class="op" id="8393271">(</span><span class="ident" id="8393272">name</span><span class="op" id="8393276">,</span>&nbsp;<span class="ident" id="8393278">time</span><span class="op" id="8393282">.</span><span class="ident" id="8393283">Now</span><span class="op" id="8393286">(</span><span class="op" id="8393287">)</span><span class="op" id="8393288">.</span><span class="ident" id="8393289">Add</span><span class="op" id="8393292">(</span><span class="ident" id="8393293">timeout</span><span class="op" id="8393300">)</span><span class="op" id="8393301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393306">c</span>&nbsp;<span class="op" id="8393308">&lt;-</span>&nbsp;<span class="ident" id="8393311">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393317">}</span><span class="op" id="8393318">(</span><span class="op" id="8393319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393325">qstats</span>&nbsp;<span class="op" id="8393332">:=</span>&nbsp;<span class="keyword" id="8393335">struct</span>&nbsp;<span class="op" id="8393342">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393346">succeeded</span><span class="op" id="8393355">,</span>&nbsp;<span class="ident" id="8393357">failed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8393372">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393378">timeout</span><span class="op" id="8393385">,</span>&nbsp;<span class="ident" id="8393387">temporary</span><span class="op" id="8393396">,</span>&nbsp;<span class="ident" id="8393398">other</span>&nbsp;<span class="builtintype" id="8393404">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393410">unknown</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8393436">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393441">}</span><span class="op" id="8393442">{</span><span class="op" id="8393443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393446">deadline</span>&nbsp;<span class="op" id="8393455">:=</span>&nbsp;<span class="ident" id="8393458">time</span><span class="op" id="8393462">.</span><span class="ident" id="8393463">After</span><span class="op" id="8393468">(</span><span class="ident" id="8393469">timeout</span>&nbsp;<span class="op" id="8393477">+</span>&nbsp;<span class="ident" id="8393479">time</span><span class="op" id="8393483">.</span><span class="ident" id="8393484">Second</span><span class="op" id="8393490">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393493">for</span>&nbsp;<span class="ident" id="8393497">i</span>&nbsp;<span class="op" id="8393499">:=</span>&nbsp;<span class="num" id="8393502">0</span><span class="op" id="8393503">;</span>&nbsp;<span class="ident" id="8393505">i</span>&nbsp;<span class="op" id="8393507">&lt;</span>&nbsp;<span class="num" id="8393509">2</span><span class="op" id="8393510">*</span><span class="ident" id="8393511">N</span><span class="op" id="8393512">;</span>&nbsp;<span class="ident" id="8393514">i</span><span class="op" id="8393515">++</span>&nbsp;<span class="op" id="8393518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393522">select</span>&nbsp;<span class="op" id="8393529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393533">case</span>&nbsp;<span class="op" id="8393538">&lt;-</span><span class="ident" id="8393540">deadline</span><span class="op" id="8393548">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393553">t</span><span class="op" id="8393554">.</span><span class="ident" id="8393555">Fatal</span><span class="op" id="8393560">(</span><span class="string" id="8393561">&#34;deadline&nbsp;exceeded&#34;</span><span class="op" id="8393580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393584">case</span>&nbsp;<span class="ident" id="8393589">err</span>&nbsp;<span class="op" id="8393593">:=</span>&nbsp;<span class="op" id="8393596">&lt;-</span><span class="ident" id="8393598">c</span><span class="op" id="8393599">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393604">switch</span>&nbsp;<span class="ident" id="8393611">err</span>&nbsp;<span class="op" id="8393615">:=</span>&nbsp;<span class="ident" id="8393618">err</span><span class="op" id="8393621">.</span><span class="op" id="8393622">(</span><span class="keyword" id="8393623">type</span><span class="op" id="8393627">)</span>&nbsp;<span class="op" id="8393629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393634">case</span>&nbsp;<span class="ident" id="8393639">nil</span><span class="op" id="8393642">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393648">qstats</span><span class="op" id="8393654">.</span><span class="ident" id="8393655">succeeded</span><span class="op" id="8393664">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393670">case</span>&nbsp;<span class="ident" id="8393675">Error</span><span class="op" id="8393680">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393686">qstats</span><span class="op" id="8393692">.</span><span class="ident" id="8393693">failed</span><span class="op" id="8393699">++</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393706">if</span>&nbsp;<span class="ident" id="8393709">err</span><span class="op" id="8393712">.</span><span class="ident" id="8393713">Timeout</span><span class="op" id="8393720">(</span><span class="op" id="8393721">)</span>&nbsp;<span class="op" id="8393723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393730">qstats</span><span class="op" id="8393736">.</span><span class="ident" id="8393737">timeout</span><span class="op" id="8393744">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393757">if</span>&nbsp;<span class="ident" id="8393760">err</span><span class="op" id="8393763">.</span><span class="ident" id="8393764">Temporary</span><span class="op" id="8393773">(</span><span class="op" id="8393774">)</span>&nbsp;<span class="op" id="8393776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393783">qstats</span><span class="op" id="8393789">.</span><span class="ident" id="8393790">temporary</span><span class="op" id="8393799">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393812">if</span>&nbsp;<span class="op" id="8393815">!</span><span class="ident" id="8393816">err</span><span class="op" id="8393819">.</span><span class="ident" id="8393820">Timeout</span><span class="op" id="8393827">(</span><span class="op" id="8393828">)</span>&nbsp;<span class="op" id="8393830">&amp;&amp;</span>&nbsp;<span class="op" id="8393833">!</span><span class="ident" id="8393834">err</span><span class="op" id="8393837">.</span><span class="ident" id="8393838">Temporary</span><span class="op" id="8393847">(</span><span class="op" id="8393848">)</span>&nbsp;<span class="op" id="8393850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393857">qstats</span><span class="op" id="8393863">.</span><span class="ident" id="8393864">other</span><span class="op" id="8393869">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393881">default</span><span class="op" id="8393888">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393894">qstats</span><span class="op" id="8393900">.</span><span class="ident" id="8393901">failed</span><span class="op" id="8393907">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393914">qstats</span><span class="op" id="8393920">.</span><span class="ident" id="8393921">unknown</span><span class="op" id="8393928">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393941">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8393945">//&nbsp;A&nbsp;high&nbsp;volume&nbsp;of&nbsp;DNS&nbsp;queries&nbsp;for&nbsp;sub-domain&nbsp;of&nbsp;golang.org</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8394007">//&nbsp;would&nbsp;be&nbsp;coordinated&nbsp;by&nbsp;authoritative&nbsp;or&nbsp;recursive&nbsp;server,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8394070">//&nbsp;or&nbsp;stub&nbsp;resolver&nbsp;which&nbsp;implements&nbsp;query-response&nbsp;rate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8394128">//&nbsp;limitation,&nbsp;so&nbsp;we&nbsp;can&nbsp;expect&nbsp;some&nbsp;query&nbsp;successes&nbsp;and&nbsp;more</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8394191">//&nbsp;failures&nbsp;including&nbsp;timeout,&nbsp;temporary&nbsp;and&nbsp;other&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8394249">//&nbsp;As&nbsp;a&nbsp;rule,&nbsp;unknown&nbsp;must&nbsp;not&nbsp;be&nbsp;shown&nbsp;but&nbsp;it&nbsp;might&nbsp;possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8394312">//&nbsp;happen&nbsp;due&nbsp;to&nbsp;issue&nbsp;4856&nbsp;for&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8394350">t</span><span class="op" id="8394351">.</span><span class="ident" id="8394352">Logf</span><span class="op" id="8394356">(</span><span class="string" id="8394357">&#34;%v&nbsp;succeeded,&nbsp;%v&nbsp;failed&nbsp;(%v&nbsp;timeout,&nbsp;%v&nbsp;temporary,&nbsp;%v&nbsp;other,&nbsp;%v&nbsp;unknown)&#34;</span><span class="op" id="8394431">,</span>&nbsp;<span class="ident" id="8394433">qstats</span><span class="op" id="8394439">.</span><span class="ident" id="8394440">succeeded</span><span class="op" id="8394449">,</span>&nbsp;<span class="ident" id="8394451">qstats</span><span class="op" id="8394457">.</span><span class="ident" id="8394458">failed</span><span class="op" id="8394464">,</span>&nbsp;<span class="ident" id="8394466">qstats</span><span class="op" id="8394472">.</span><span class="ident" id="8394473">timeout</span><span class="op" id="8394480">,</span>&nbsp;<span class="ident" id="8394482">qstats</span><span class="op" id="8394488">.</span><span class="ident" id="8394489">temporary</span><span class="op" id="8394498">,</span>&nbsp;<span class="ident" id="8394500">qstats</span><span class="op" id="8394506">.</span><span class="ident" id="8394507">other</span><span class="op" id="8394512">,</span>&nbsp;<span class="ident" id="8394514">qstats</span><span class="op" id="8394520">.</span><span class="ident" id="8394521">unknown</span><span class="op" id="8394528">)</span><br>
<span class="lineno"></span><span class="op" id="8394530">}</span>
</div>
</body>
</html>
