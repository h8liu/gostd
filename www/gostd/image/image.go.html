<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image</h2>
<ul>
<li><a href="/gostd/image/decode_example_test.go.html">decode_example_test.go</a></li>
<li><a href="/gostd/image/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/image/format.go.html">format.go</a></li>
<li><a href="/gostd/image/geom.go.html">geom.go</a></li>
<li><a href="/gostd/image/image.go.html">image.go</a></li>
<li><a href="/gostd/image/image_test.go.html">image_test.go</a></li>
<li><a href="/gostd/image/names.go.html">names.go</a></li>
<li><a href="/gostd/image/ycbcr.go.html">ycbcr.go</a></li>
<li><a href="/gostd/image/ycbcr_test.go.html">ycbcr_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3722338">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3722393">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3722447">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3722498">//&nbsp;Package&nbsp;image&nbsp;implements&nbsp;a&nbsp;basic&nbsp;2-D&nbsp;image&nbsp;library.</span><br>
<span class="lineno"></span><span class="comment" id="3722553">//</span><br>
<span class="lineno"></span><span class="comment" id="3722556">//&nbsp;The&nbsp;fundamental&nbsp;interface&nbsp;is&nbsp;called&nbsp;Image.&nbsp;An&nbsp;Image&nbsp;contains&nbsp;colors,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="3722634">//&nbsp;are&nbsp;described&nbsp;in&nbsp;the&nbsp;image/color&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="3722679">//</span><br>
<span class="lineno">10</span><span class="comment" id="3722682">//&nbsp;Values&nbsp;of&nbsp;the&nbsp;Image&nbsp;interface&nbsp;are&nbsp;created&nbsp;either&nbsp;by&nbsp;calling&nbsp;functions&nbsp;such</span><br>
<span class="lineno"></span><span class="comment" id="3722760">//&nbsp;as&nbsp;NewRGBA&nbsp;and&nbsp;NewPaletted,&nbsp;or&nbsp;by&nbsp;calling&nbsp;Decode&nbsp;on&nbsp;an&nbsp;io.Reader&nbsp;containing</span><br>
<span class="lineno"></span><span class="comment" id="3722839">//&nbsp;image&nbsp;data&nbsp;in&nbsp;a&nbsp;format&nbsp;such&nbsp;as&nbsp;GIF,&nbsp;JPEG&nbsp;or&nbsp;PNG.&nbsp;Decoding&nbsp;any&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="3722915">//&nbsp;image&nbsp;format&nbsp;requires&nbsp;the&nbsp;prior&nbsp;registration&nbsp;of&nbsp;a&nbsp;decoder&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="3722986">//&nbsp;Registration&nbsp;is&nbsp;typically&nbsp;automatic&nbsp;as&nbsp;a&nbsp;side&nbsp;effect&nbsp;of&nbsp;initializing&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="3723063">//&nbsp;format&#39;s&nbsp;package&nbsp;so&nbsp;that,&nbsp;to&nbsp;decode&nbsp;a&nbsp;PNG&nbsp;image,&nbsp;it&nbsp;suffices&nbsp;to&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="3723135">//&nbsp;&nbsp;&nbsp;&nbspimport&nbsp;_&nbsp;&#34;image/png&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3723159">//&nbsp;in&nbsp;a&nbsp;program&#39;s&nbsp;main&nbsp;package.&nbsp;The&nbsp;_&nbsp;means&nbsp;to&nbsp;import&nbsp;a&nbsp;package&nbsp;purely&nbsp;for&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="3723238">//&nbsp;initialization&nbsp;side&nbsp;effects.</span><br>
<span class="lineno"></span><span class="comment" id="3723270">//</span><br>
<span class="lineno">20</span><span class="comment" id="3723273">//&nbsp;See&nbsp;&#34;The&nbsp;Go&nbsp;image&nbsp;package&#34;&nbsp;for&nbsp;more&nbsp;details:</span><br>
<span class="lineno"></span><span class="comment" id="3723321">//&nbsp;http://golang.org/doc/articles/image_package.html</span><br>
<span class="lineno"></span><span class="keyword" id="3723374">package</span>&nbsp;<span class="ident" id="3723382">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3723389">import</span>&nbsp;<span class="op" id="3723396">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3723399">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="3723413">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3723416">//&nbsp;Config&nbsp;holds&nbsp;an&nbsp;image&#39;s&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions.</span><br>
<span class="lineno"></span><span class="keyword" id="3723471">type</span>&nbsp;<span class="ident" id="3723476">Config</span>&nbsp;<span class="keyword" id="3723483">struct</span>&nbsp;<span class="op" id="3723490">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723493">ColorModel</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3723507">color</span><span class="op" id="3723512">.</span><span class="ident" id="3723513">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723520">Width</span><span class="op" id="3723525">,</span>&nbsp;<span class="ident" id="3723527">Height</span>&nbsp;<span class="builtintype" id="3723534">int</span><br>
<span class="lineno"></span><span class="op" id="3723538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3723541">//&nbsp;Image&nbsp;is&nbsp;a&nbsp;finite&nbsp;rectangular&nbsp;grid&nbsp;of&nbsp;color.Color&nbsp;values&nbsp;taken&nbsp;from&nbsp;a&nbsp;color</span><br>
<span class="lineno">35</span><span class="comment" id="3723620">//&nbsp;model.</span><br>
<span class="lineno"></span><span class="keyword" id="3723630">type</span>&nbsp;<span class="ident" id="3723635">Image</span>&nbsp;<span class="keyword" id="3723641">interface</span>&nbsp;<span class="op" id="3723651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3723654">//&nbsp;ColorModel&nbsp;returns&nbsp;the&nbsp;Image&#39;s&nbsp;color&nbsp;model.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723702">ColorModel</span><span class="op" id="3723712">(</span><span class="op" id="3723713">)</span>&nbsp;<span class="ident" id="3723715">color</span><span class="op" id="3723720">.</span><span class="ident" id="3723721">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3723728">//&nbsp;Bounds&nbsp;returns&nbsp;the&nbsp;domain&nbsp;for&nbsp;which&nbsp;At&nbsp;can&nbsp;return&nbsp;non-zero&nbsp;color.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3723798">//&nbsp;The&nbsp;bounds&nbsp;do&nbsp;not&nbsp;necessarily&nbsp;contain&nbsp;the&nbsp;point&nbsp;(0,&nbsp;0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723858">Bounds</span><span class="op" id="3723864">(</span><span class="op" id="3723865">)</span>&nbsp;<span class="ident" id="3723867">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3723878">//&nbsp;At&nbsp;returns&nbsp;the&nbsp;color&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3723927">//&nbsp;At(Bounds().Min.X,&nbsp;Bounds().Min.Y)&nbsp;returns&nbsp;the&nbsp;upper-left&nbsp;pixel&nbsp;of&nbsp;the&nbsp;grid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3724008">//&nbsp;At(Bounds().Max.X-1,&nbsp;Bounds().Max.Y-1)&nbsp;returns&nbsp;the&nbsp;lower-right&nbsp;one.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724080">At</span><span class="op" id="3724082">(</span><span class="ident" id="3724083">x</span><span class="op" id="3724084">,</span>&nbsp;<span class="ident" id="3724086">y</span>&nbsp;<span class="builtintype" id="3724088">int</span><span class="op" id="3724091">)</span>&nbsp;<span class="ident" id="3724093">color</span><span class="op" id="3724098">.</span><span class="ident" id="3724099">Color</span><br>
<span class="lineno"></span><span class="op" id="3724105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3724108">//&nbsp;PalettedImage&nbsp;is&nbsp;an&nbsp;image&nbsp;whose&nbsp;colors&nbsp;may&nbsp;come&nbsp;from&nbsp;a&nbsp;limited&nbsp;palette.</span><br>
<span class="lineno"></span><span class="comment" id="3724183">//&nbsp;If&nbsp;m&nbsp;is&nbsp;a&nbsp;PalettedImage&nbsp;and&nbsp;m.ColorModel()&nbsp;returns&nbsp;a&nbsp;PalettedColorModel&nbsp;p,</span><br>
<span class="lineno">50</span><span class="comment" id="3724261">//&nbsp;then&nbsp;m.At(x,&nbsp;y)&nbsp;should&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;p[m.ColorIndexAt(x,&nbsp;y)].&nbsp;If&nbsp;m&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3724336">//&nbsp;color&nbsp;model&nbsp;is&nbsp;not&nbsp;a&nbsp;PalettedColorModel,&nbsp;then&nbsp;ColorIndexAt&#39;s&nbsp;behavior&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3724412">//&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="keyword" id="3724426">type</span>&nbsp;<span class="ident" id="3724431">PalettedImage</span>&nbsp;<span class="keyword" id="3724445">interface</span>&nbsp;<span class="op" id="3724455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3724458">//&nbsp;ColorIndexAt&nbsp;returns&nbsp;the&nbsp;palette&nbsp;index&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724525">ColorIndexAt</span><span class="op" id="3724537">(</span><span class="ident" id="3724538">x</span><span class="op" id="3724539">,</span>&nbsp;<span class="ident" id="3724541">y</span>&nbsp;<span class="builtintype" id="3724543">int</span><span class="op" id="3724546">)</span>&nbsp;<span class="builtintype" id="3724548">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724555">Image</span><br>
<span class="lineno"></span><span class="op" id="3724561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3724564">//&nbsp;RGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA&nbsp;values.</span><br>
<span class="lineno">60</span><span class="keyword" id="3724637">type</span>&nbsp;<span class="ident" id="3724642">RGBA</span>&nbsp;<span class="keyword" id="3724647">struct</span>&nbsp;<span class="op" id="3724654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3724657">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3724725">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724793">Pix</span>&nbsp;<span class="op" id="3724797">[</span><span class="op" id="3724798">]</span><span class="builtintype" id="3724799">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3724806">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724882">Stride</span>&nbsp;<span class="builtintype" id="3724889">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3724894">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724926">Rect</span>&nbsp;<span class="ident" id="3724931">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="3724941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="3724944">func</span>&nbsp;<span class="op" id="3724949">(</span><span class="ident" id="3724950">p</span>&nbsp;<span class="op" id="3724952">*</span><span class="ident" id="3724953">RGBA</span><span class="op" id="3724957">)</span>&nbsp;<span class="ident" id="3724959">ColorModel</span><span class="op" id="3724969">(</span><span class="op" id="3724970">)</span>&nbsp;<span class="ident" id="3724972">color</span><span class="op" id="3724977">.</span><span class="ident" id="3724978">Model</span>&nbsp;<span class="op" id="3724984">{</span>&nbsp;<span class="keyword" id="3724986">return</span>&nbsp;<span class="ident" id="3724993">color</span><span class="op" id="3724998">.</span><span class="ident" id="3724999">RGBAModel</span>&nbsp;<span class="op" id="3725009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3725012">func</span>&nbsp;<span class="op" id="3725017">(</span><span class="ident" id="3725018">p</span>&nbsp;<span class="op" id="3725020">*</span><span class="ident" id="3725021">RGBA</span><span class="op" id="3725025">)</span>&nbsp;<span class="ident" id="3725027">Bounds</span><span class="op" id="3725033">(</span><span class="op" id="3725034">)</span>&nbsp;<span class="ident" id="3725036">Rectangle</span>&nbsp;<span class="op" id="3725046">{</span>&nbsp;<span class="keyword" id="3725048">return</span>&nbsp;<span class="ident" id="3725055">p</span><span class="op" id="3725056">.</span><span class="ident" id="3725057">Rect</span>&nbsp;<span class="op" id="3725062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3725065">func</span>&nbsp;<span class="op" id="3725070">(</span><span class="ident" id="3725071">p</span>&nbsp;<span class="op" id="3725073">*</span><span class="ident" id="3725074">RGBA</span><span class="op" id="3725078">)</span>&nbsp;<span class="ident" id="3725080">At</span><span class="op" id="3725082">(</span><span class="ident" id="3725083">x</span><span class="op" id="3725084">,</span>&nbsp;<span class="ident" id="3725086">y</span>&nbsp;<span class="builtintype" id="3725088">int</span><span class="op" id="3725091">)</span>&nbsp;<span class="ident" id="3725093">color</span><span class="op" id="3725098">.</span><span class="ident" id="3725099">Color</span>&nbsp;<span class="op" id="3725105">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725108">return</span>&nbsp;<span class="ident" id="3725115">p</span><span class="op" id="3725116">.</span><span class="ident" id="3725117">RGBAAt</span><span class="op" id="3725123">(</span><span class="ident" id="3725124">x</span><span class="op" id="3725125">,</span>&nbsp;<span class="ident" id="3725127">y</span><span class="op" id="3725128">)</span><br>
<span class="lineno"></span><span class="op" id="3725130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3725133">func</span>&nbsp;<span class="op" id="3725138">(</span><span class="ident" id="3725139">p</span>&nbsp;<span class="op" id="3725141">*</span><span class="ident" id="3725142">RGBA</span><span class="op" id="3725146">)</span>&nbsp;<span class="ident" id="3725148">RGBAAt</span><span class="op" id="3725154">(</span><span class="ident" id="3725155">x</span><span class="op" id="3725156">,</span>&nbsp;<span class="ident" id="3725158">y</span>&nbsp;<span class="builtintype" id="3725160">int</span><span class="op" id="3725163">)</span>&nbsp;<span class="ident" id="3725165">color</span><span class="op" id="3725170">.</span><span class="ident" id="3725171">RGBA</span>&nbsp;<span class="op" id="3725176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725179">if</span>&nbsp;<span class="op" id="3725182">!</span><span class="op" id="3725183">(</span><span class="ident" id="3725184">Point</span><span class="op" id="3725189">{</span><span class="ident" id="3725190">x</span><span class="op" id="3725191">,</span>&nbsp;<span class="ident" id="3725193">y</span><span class="op" id="3725194">}</span><span class="op" id="3725195">.</span><span class="ident" id="3725196">In</span><span class="op" id="3725198">(</span><span class="ident" id="3725199">p</span><span class="op" id="3725200">.</span><span class="ident" id="3725201">Rect</span><span class="op" id="3725205">)</span><span class="op" id="3725206">)</span>&nbsp;<span class="op" id="3725208">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725212">return</span>&nbsp;<span class="ident" id="3725219">color</span><span class="op" id="3725224">.</span><span class="ident" id="3725225">RGBA</span><span class="op" id="3725229">{</span><span class="op" id="3725230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3725233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725236">i</span>&nbsp;<span class="op" id="3725238">:=</span>&nbsp;<span class="ident" id="3725241">p</span><span class="op" id="3725242">.</span><span class="ident" id="3725243">PixOffset</span><span class="op" id="3725252">(</span><span class="ident" id="3725253">x</span><span class="op" id="3725254">,</span>&nbsp;<span class="ident" id="3725256">y</span><span class="op" id="3725257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725260">return</span>&nbsp;<span class="ident" id="3725267">color</span><span class="op" id="3725272">.</span><span class="ident" id="3725273">RGBA</span><span class="op" id="3725277">{</span><span class="ident" id="3725278">p</span><span class="op" id="3725279">.</span><span class="ident" id="3725280">Pix</span><span class="op" id="3725283">[</span><span class="ident" id="3725284">i</span><span class="op" id="3725285">+</span><span class="num" id="3725286">0</span><span class="op" id="3725287">]</span><span class="op" id="3725288">,</span>&nbsp;<span class="ident" id="3725290">p</span><span class="op" id="3725291">.</span><span class="ident" id="3725292">Pix</span><span class="op" id="3725295">[</span><span class="ident" id="3725296">i</span><span class="op" id="3725297">+</span><span class="num" id="3725298">1</span><span class="op" id="3725299">]</span><span class="op" id="3725300">,</span>&nbsp;<span class="ident" id="3725302">p</span><span class="op" id="3725303">.</span><span class="ident" id="3725304">Pix</span><span class="op" id="3725307">[</span><span class="ident" id="3725308">i</span><span class="op" id="3725309">+</span><span class="num" id="3725310">2</span><span class="op" id="3725311">]</span><span class="op" id="3725312">,</span>&nbsp;<span class="ident" id="3725314">p</span><span class="op" id="3725315">.</span><span class="ident" id="3725316">Pix</span><span class="op" id="3725319">[</span><span class="ident" id="3725320">i</span><span class="op" id="3725321">+</span><span class="num" id="3725322">3</span><span class="op" id="3725323">]</span><span class="op" id="3725324">}</span><br>
<span class="lineno"></span><span class="op" id="3725326">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3725329">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3725408">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="3725432">func</span>&nbsp;<span class="op" id="3725437">(</span><span class="ident" id="3725438">p</span>&nbsp;<span class="op" id="3725440">*</span><span class="ident" id="3725441">RGBA</span><span class="op" id="3725445">)</span>&nbsp;<span class="ident" id="3725447">PixOffset</span><span class="op" id="3725456">(</span><span class="ident" id="3725457">x</span><span class="op" id="3725458">,</span>&nbsp;<span class="ident" id="3725460">y</span>&nbsp;<span class="builtintype" id="3725462">int</span><span class="op" id="3725465">)</span>&nbsp;<span class="builtintype" id="3725467">int</span>&nbsp;<span class="op" id="3725471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725474">return</span>&nbsp;<span class="op" id="3725481">(</span><span class="ident" id="3725482">y</span><span class="op" id="3725483">-</span><span class="ident" id="3725484">p</span><span class="op" id="3725485">.</span><span class="ident" id="3725486">Rect</span><span class="op" id="3725490">.</span><span class="ident" id="3725491">Min</span><span class="op" id="3725494">.</span><span class="ident" id="3725495">Y</span><span class="op" id="3725496">)</span><span class="op" id="3725497">*</span><span class="ident" id="3725498">p</span><span class="op" id="3725499">.</span><span class="ident" id="3725500">Stride</span>&nbsp;<span class="op" id="3725507">+</span>&nbsp;<span class="op" id="3725509">(</span><span class="ident" id="3725510">x</span><span class="op" id="3725511">-</span><span class="ident" id="3725512">p</span><span class="op" id="3725513">.</span><span class="ident" id="3725514">Rect</span><span class="op" id="3725518">.</span><span class="ident" id="3725519">Min</span><span class="op" id="3725522">.</span><span class="ident" id="3725523">X</span><span class="op" id="3725524">)</span><span class="op" id="3725525">*</span><span class="num" id="3725526">4</span><br>
<span class="lineno">90</span><span class="op" id="3725528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3725531">func</span>&nbsp;<span class="op" id="3725536">(</span><span class="ident" id="3725537">p</span>&nbsp;<span class="op" id="3725539">*</span><span class="ident" id="3725540">RGBA</span><span class="op" id="3725544">)</span>&nbsp;<span class="ident" id="3725546">Set</span><span class="op" id="3725549">(</span><span class="ident" id="3725550">x</span><span class="op" id="3725551">,</span>&nbsp;<span class="ident" id="3725553">y</span>&nbsp;<span class="builtintype" id="3725555">int</span><span class="op" id="3725558">,</span>&nbsp;<span class="ident" id="3725560">c</span>&nbsp;<span class="ident" id="3725562">color</span><span class="op" id="3725567">.</span><span class="ident" id="3725568">Color</span><span class="op" id="3725573">)</span>&nbsp;<span class="op" id="3725575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725578">if</span>&nbsp;<span class="op" id="3725581">!</span><span class="op" id="3725582">(</span><span class="ident" id="3725583">Point</span><span class="op" id="3725588">{</span><span class="ident" id="3725589">x</span><span class="op" id="3725590">,</span>&nbsp;<span class="ident" id="3725592">y</span><span class="op" id="3725593">}</span><span class="op" id="3725594">.</span><span class="ident" id="3725595">In</span><span class="op" id="3725597">(</span><span class="ident" id="3725598">p</span><span class="op" id="3725599">.</span><span class="ident" id="3725600">Rect</span><span class="op" id="3725604">)</span><span class="op" id="3725605">)</span>&nbsp;<span class="op" id="3725607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725611">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3725619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725622">i</span>&nbsp;<span class="op" id="3725624">:=</span>&nbsp;<span class="ident" id="3725627">p</span><span class="op" id="3725628">.</span><span class="ident" id="3725629">PixOffset</span><span class="op" id="3725638">(</span><span class="ident" id="3725639">x</span><span class="op" id="3725640">,</span>&nbsp;<span class="ident" id="3725642">y</span><span class="op" id="3725643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725646">c1</span>&nbsp;<span class="op" id="3725649">:=</span>&nbsp;<span class="ident" id="3725652">color</span><span class="op" id="3725657">.</span><span class="ident" id="3725658">RGBAModel</span><span class="op" id="3725667">.</span><span class="ident" id="3725668">Convert</span><span class="op" id="3725675">(</span><span class="ident" id="3725676">c</span><span class="op" id="3725677">)</span><span class="op" id="3725678">.</span><span class="op" id="3725679">(</span><span class="ident" id="3725680">color</span><span class="op" id="3725685">.</span><span class="ident" id="3725686">RGBA</span><span class="op" id="3725690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725693">p</span><span class="op" id="3725694">.</span><span class="ident" id="3725695">Pix</span><span class="op" id="3725698">[</span><span class="ident" id="3725699">i</span><span class="op" id="3725700">+</span><span class="num" id="3725701">0</span><span class="op" id="3725702">]</span>&nbsp;<span class="op" id="3725704">=</span>&nbsp;<span class="ident" id="3725706">c1</span><span class="op" id="3725708">.</span><span class="ident" id="3725709">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725712">p</span><span class="op" id="3725713">.</span><span class="ident" id="3725714">Pix</span><span class="op" id="3725717">[</span><span class="ident" id="3725718">i</span><span class="op" id="3725719">+</span><span class="num" id="3725720">1</span><span class="op" id="3725721">]</span>&nbsp;<span class="op" id="3725723">=</span>&nbsp;<span class="ident" id="3725725">c1</span><span class="op" id="3725727">.</span><span class="ident" id="3725728">G</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725731">p</span><span class="op" id="3725732">.</span><span class="ident" id="3725733">Pix</span><span class="op" id="3725736">[</span><span class="ident" id="3725737">i</span><span class="op" id="3725738">+</span><span class="num" id="3725739">2</span><span class="op" id="3725740">]</span>&nbsp;<span class="op" id="3725742">=</span>&nbsp;<span class="ident" id="3725744">c1</span><span class="op" id="3725746">.</span><span class="ident" id="3725747">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725750">p</span><span class="op" id="3725751">.</span><span class="ident" id="3725752">Pix</span><span class="op" id="3725755">[</span><span class="ident" id="3725756">i</span><span class="op" id="3725757">+</span><span class="num" id="3725758">3</span><span class="op" id="3725759">]</span>&nbsp;<span class="op" id="3725761">=</span>&nbsp;<span class="ident" id="3725763">c1</span><span class="op" id="3725765">.</span><span class="ident" id="3725766">A</span><br>
<span class="lineno"></span><span class="op" id="3725768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3725771">func</span>&nbsp;<span class="op" id="3725776">(</span><span class="ident" id="3725777">p</span>&nbsp;<span class="op" id="3725779">*</span><span class="ident" id="3725780">RGBA</span><span class="op" id="3725784">)</span>&nbsp;<span class="ident" id="3725786">SetRGBA</span><span class="op" id="3725793">(</span><span class="ident" id="3725794">x</span><span class="op" id="3725795">,</span>&nbsp;<span class="ident" id="3725797">y</span>&nbsp;<span class="builtintype" id="3725799">int</span><span class="op" id="3725802">,</span>&nbsp;<span class="ident" id="3725804">c</span>&nbsp;<span class="ident" id="3725806">color</span><span class="op" id="3725811">.</span><span class="ident" id="3725812">RGBA</span><span class="op" id="3725816">)</span>&nbsp;<span class="op" id="3725818">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725821">if</span>&nbsp;<span class="op" id="3725824">!</span><span class="op" id="3725825">(</span><span class="ident" id="3725826">Point</span><span class="op" id="3725831">{</span><span class="ident" id="3725832">x</span><span class="op" id="3725833">,</span>&nbsp;<span class="ident" id="3725835">y</span><span class="op" id="3725836">}</span><span class="op" id="3725837">.</span><span class="ident" id="3725838">In</span><span class="op" id="3725840">(</span><span class="ident" id="3725841">p</span><span class="op" id="3725842">.</span><span class="ident" id="3725843">Rect</span><span class="op" id="3725847">)</span><span class="op" id="3725848">)</span>&nbsp;<span class="op" id="3725850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725854">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3725862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725865">i</span>&nbsp;<span class="op" id="3725867">:=</span>&nbsp;<span class="ident" id="3725870">p</span><span class="op" id="3725871">.</span><span class="ident" id="3725872">PixOffset</span><span class="op" id="3725881">(</span><span class="ident" id="3725882">x</span><span class="op" id="3725883">,</span>&nbsp;<span class="ident" id="3725885">y</span><span class="op" id="3725886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725889">p</span><span class="op" id="3725890">.</span><span class="ident" id="3725891">Pix</span><span class="op" id="3725894">[</span><span class="ident" id="3725895">i</span><span class="op" id="3725896">+</span><span class="num" id="3725897">0</span><span class="op" id="3725898">]</span>&nbsp;<span class="op" id="3725900">=</span>&nbsp;<span class="ident" id="3725902">c</span><span class="op" id="3725903">.</span><span class="ident" id="3725904">R</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725907">p</span><span class="op" id="3725908">.</span><span class="ident" id="3725909">Pix</span><span class="op" id="3725912">[</span><span class="ident" id="3725913">i</span><span class="op" id="3725914">+</span><span class="num" id="3725915">1</span><span class="op" id="3725916">]</span>&nbsp;<span class="op" id="3725918">=</span>&nbsp;<span class="ident" id="3725920">c</span><span class="op" id="3725921">.</span><span class="ident" id="3725922">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725925">p</span><span class="op" id="3725926">.</span><span class="ident" id="3725927">Pix</span><span class="op" id="3725930">[</span><span class="ident" id="3725931">i</span><span class="op" id="3725932">+</span><span class="num" id="3725933">2</span><span class="op" id="3725934">]</span>&nbsp;<span class="op" id="3725936">=</span>&nbsp;<span class="ident" id="3725938">c</span><span class="op" id="3725939">.</span><span class="ident" id="3725940">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725943">p</span><span class="op" id="3725944">.</span><span class="ident" id="3725945">Pix</span><span class="op" id="3725948">[</span><span class="ident" id="3725949">i</span><span class="op" id="3725950">+</span><span class="num" id="3725951">3</span><span class="op" id="3725952">]</span>&nbsp;<span class="op" id="3725954">=</span>&nbsp;<span class="ident" id="3725956">c</span><span class="op" id="3725957">.</span><span class="ident" id="3725958">A</span><br>
<span class="lineno"></span><span class="op" id="3725960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="3725963">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="3726040">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="3726112">func</span>&nbsp;<span class="op" id="3726117">(</span><span class="ident" id="3726118">p</span>&nbsp;<span class="op" id="3726120">*</span><span class="ident" id="3726121">RGBA</span><span class="op" id="3726125">)</span>&nbsp;<span class="ident" id="3726127">SubImage</span><span class="op" id="3726135">(</span><span class="ident" id="3726136">r</span>&nbsp;<span class="ident" id="3726138">Rectangle</span><span class="op" id="3726147">)</span>&nbsp;<span class="ident" id="3726149">Image</span>&nbsp;<span class="op" id="3726155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726158">r</span>&nbsp;<span class="op" id="3726160">=</span>&nbsp;<span class="ident" id="3726162">r</span><span class="op" id="3726163">.</span><span class="ident" id="3726164">Intersect</span><span class="op" id="3726173">(</span><span class="ident" id="3726174">p</span><span class="op" id="3726175">.</span><span class="ident" id="3726176">Rect</span><span class="op" id="3726180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3726183">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3726264">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3726346">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726396">if</span>&nbsp;<span class="ident" id="3726399">r</span><span class="op" id="3726400">.</span><span class="ident" id="3726401">Empty</span><span class="op" id="3726406">(</span><span class="op" id="3726407">)</span>&nbsp;<span class="op" id="3726409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726413">return</span>&nbsp;<span class="op" id="3726420">&amp;</span><span class="ident" id="3726421">RGBA</span><span class="op" id="3726425">{</span><span class="op" id="3726426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3726429">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726432">i</span>&nbsp;<span class="op" id="3726434">:=</span>&nbsp;<span class="ident" id="3726437">p</span><span class="op" id="3726438">.</span><span class="ident" id="3726439">PixOffset</span><span class="op" id="3726448">(</span><span class="ident" id="3726449">r</span><span class="op" id="3726450">.</span><span class="ident" id="3726451">Min</span><span class="op" id="3726454">.</span><span class="ident" id="3726455">X</span><span class="op" id="3726456">,</span>&nbsp;<span class="ident" id="3726458">r</span><span class="op" id="3726459">.</span><span class="ident" id="3726460">Min</span><span class="op" id="3726463">.</span><span class="ident" id="3726464">Y</span><span class="op" id="3726465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726468">return</span>&nbsp;<span class="op" id="3726475">&amp;</span><span class="ident" id="3726476">RGBA</span><span class="op" id="3726480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726484">Pix</span><span class="op" id="3726487">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726492">p</span><span class="op" id="3726493">.</span><span class="ident" id="3726494">Pix</span><span class="op" id="3726497">[</span><span class="ident" id="3726498">i</span><span class="op" id="3726499">:</span><span class="op" id="3726500">]</span><span class="op" id="3726501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726505">Stride</span><span class="op" id="3726511">:</span>&nbsp;<span class="ident" id="3726513">p</span><span class="op" id="3726514">.</span><span class="ident" id="3726515">Stride</span><span class="op" id="3726521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726525">Rect</span><span class="op" id="3726529">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3726533">r</span><span class="op" id="3726534">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3726537">}</span><br>
<span class="lineno"></span><span class="op" id="3726539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3726542">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="3726615">func</span>&nbsp;<span class="op" id="3726620">(</span><span class="ident" id="3726621">p</span>&nbsp;<span class="op" id="3726623">*</span><span class="ident" id="3726624">RGBA</span><span class="op" id="3726628">)</span>&nbsp;<span class="ident" id="3726630">Opaque</span><span class="op" id="3726636">(</span><span class="op" id="3726637">)</span>&nbsp;<span class="builtintype" id="3726639">bool</span>&nbsp;<span class="op" id="3726644">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726647">if</span>&nbsp;<span class="ident" id="3726650">p</span><span class="op" id="3726651">.</span><span class="ident" id="3726652">Rect</span><span class="op" id="3726656">.</span><span class="ident" id="3726657">Empty</span><span class="op" id="3726662">(</span><span class="op" id="3726663">)</span>&nbsp;<span class="op" id="3726665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726669">return</span>&nbsp;<span class="builtintype" id="3726676">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3726682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726685">i0</span><span class="op" id="3726687">,</span>&nbsp;<span class="ident" id="3726689">i1</span>&nbsp;<span class="op" id="3726692">:=</span>&nbsp;<span class="num" id="3726695">3</span><span class="op" id="3726696">,</span>&nbsp;<span class="ident" id="3726698">p</span><span class="op" id="3726699">.</span><span class="ident" id="3726700">Rect</span><span class="op" id="3726704">.</span><span class="ident" id="3726705">Dx</span><span class="op" id="3726707">(</span><span class="op" id="3726708">)</span><span class="op" id="3726709">*</span><span class="num" id="3726710">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726713">for</span>&nbsp;<span class="ident" id="3726717">y</span>&nbsp;<span class="op" id="3726719">:=</span>&nbsp;<span class="ident" id="3726722">p</span><span class="op" id="3726723">.</span><span class="ident" id="3726724">Rect</span><span class="op" id="3726728">.</span><span class="ident" id="3726729">Min</span><span class="op" id="3726732">.</span><span class="ident" id="3726733">Y</span><span class="op" id="3726734">;</span>&nbsp;<span class="ident" id="3726736">y</span>&nbsp;<span class="op" id="3726738">&lt;</span>&nbsp;<span class="ident" id="3726740">p</span><span class="op" id="3726741">.</span><span class="ident" id="3726742">Rect</span><span class="op" id="3726746">.</span><span class="ident" id="3726747">Max</span><span class="op" id="3726750">.</span><span class="ident" id="3726751">Y</span><span class="op" id="3726752">;</span>&nbsp;<span class="ident" id="3726754">y</span><span class="op" id="3726755">++</span>&nbsp;<span class="op" id="3726758">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726762">for</span>&nbsp;<span class="ident" id="3726766">i</span>&nbsp;<span class="op" id="3726768">:=</span>&nbsp;<span class="ident" id="3726771">i0</span><span class="op" id="3726773">;</span>&nbsp;<span class="ident" id="3726775">i</span>&nbsp;<span class="op" id="3726777">&lt;</span>&nbsp;<span class="ident" id="3726779">i1</span><span class="op" id="3726781">;</span>&nbsp;<span class="ident" id="3726783">i</span>&nbsp;<span class="op" id="3726785">+=</span>&nbsp;<span class="num" id="3726788">4</span>&nbsp;<span class="op" id="3726790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726795">if</span>&nbsp;<span class="ident" id="3726798">p</span><span class="op" id="3726799">.</span><span class="ident" id="3726800">Pix</span><span class="op" id="3726803">[</span><span class="ident" id="3726804">i</span><span class="op" id="3726805">]</span>&nbsp;<span class="op" id="3726807">!=</span>&nbsp;<span class="num" id="3726810">0xff</span>&nbsp;<span class="op" id="3726815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726821">return</span>&nbsp;<span class="builtintype" id="3726828">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3726837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3726841">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726845">i0</span>&nbsp;<span class="op" id="3726848">+=</span>&nbsp;<span class="ident" id="3726851">p</span><span class="op" id="3726852">.</span><span class="ident" id="3726853">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726862">i1</span>&nbsp;<span class="op" id="3726865">+=</span>&nbsp;<span class="ident" id="3726868">p</span><span class="op" id="3726869">.</span><span class="ident" id="3726870">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3726878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726881">return</span>&nbsp;<span class="builtintype" id="3726888">true</span><br>
<span class="lineno"></span><span class="op" id="3726893">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="3726896">//&nbsp;NewRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="3726949">func</span>&nbsp;<span class="ident" id="3726954">NewRGBA</span><span class="op" id="3726961">(</span><span class="ident" id="3726962">r</span>&nbsp;<span class="ident" id="3726964">Rectangle</span><span class="op" id="3726973">)</span>&nbsp;<span class="op" id="3726975">*</span><span class="ident" id="3726976">RGBA</span>&nbsp;<span class="op" id="3726981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726984">w</span><span class="op" id="3726985">,</span>&nbsp;<span class="ident" id="3726987">h</span>&nbsp;<span class="op" id="3726989">:=</span>&nbsp;<span class="ident" id="3726992">r</span><span class="op" id="3726993">.</span><span class="ident" id="3726994">Dx</span><span class="op" id="3726996">(</span><span class="op" id="3726997">)</span><span class="op" id="3726998">,</span>&nbsp;<span class="ident" id="3727000">r</span><span class="op" id="3727001">.</span><span class="ident" id="3727002">Dy</span><span class="op" id="3727004">(</span><span class="op" id="3727005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3727008">buf</span>&nbsp;<span class="op" id="3727012">:=</span>&nbsp;<span class="builtinfunc" id="3727015">make</span><span class="op" id="3727019">(</span><span class="op" id="3727020">[</span><span class="op" id="3727021">]</span><span class="builtintype" id="3727022">uint8</span><span class="op" id="3727027">,</span>&nbsp;<span class="num" id="3727029">4</span><span class="op" id="3727030">*</span><span class="ident" id="3727031">w</span><span class="op" id="3727032">*</span><span class="ident" id="3727033">h</span><span class="op" id="3727034">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3727037">return</span>&nbsp;<span class="op" id="3727044">&amp;</span><span class="ident" id="3727045">RGBA</span><span class="op" id="3727049">{</span><span class="ident" id="3727050">buf</span><span class="op" id="3727053">,</span>&nbsp;<span class="num" id="3727055">4</span>&nbsp;<span class="op" id="3727057">*</span>&nbsp;<span class="ident" id="3727059">w</span><span class="op" id="3727060">,</span>&nbsp;<span class="ident" id="3727062">r</span><span class="op" id="3727063">}</span><br>
<span class="lineno"></span><span class="op" id="3727065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3727068">//&nbsp;RGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3727145">type</span>&nbsp;<span class="ident" id="3727150">RGBA64</span>&nbsp;<span class="keyword" id="3727157">struct</span>&nbsp;<span class="op" id="3727164">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3727167">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3727257">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3727325">Pix</span>&nbsp;<span class="op" id="3727329">[</span><span class="op" id="3727330">]</span><span class="builtintype" id="3727331">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3727338">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3727414">Stride</span>&nbsp;<span class="builtintype" id="3727421">int</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3727426">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3727458">Rect</span>&nbsp;<span class="ident" id="3727463">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="3727473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3727476">func</span>&nbsp;<span class="op" id="3727481">(</span><span class="ident" id="3727482">p</span>&nbsp;<span class="op" id="3727484">*</span><span class="ident" id="3727485">RGBA64</span><span class="op" id="3727491">)</span>&nbsp;<span class="ident" id="3727493">ColorModel</span><span class="op" id="3727503">(</span><span class="op" id="3727504">)</span>&nbsp;<span class="ident" id="3727506">color</span><span class="op" id="3727511">.</span><span class="ident" id="3727512">Model</span>&nbsp;<span class="op" id="3727518">{</span>&nbsp;<span class="keyword" id="3727520">return</span>&nbsp;<span class="ident" id="3727527">color</span><span class="op" id="3727532">.</span><span class="ident" id="3727533">RGBA64Model</span>&nbsp;<span class="op" id="3727545">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="3727548">func</span>&nbsp;<span class="op" id="3727553">(</span><span class="ident" id="3727554">p</span>&nbsp;<span class="op" id="3727556">*</span><span class="ident" id="3727557">RGBA64</span><span class="op" id="3727563">)</span>&nbsp;<span class="ident" id="3727565">Bounds</span><span class="op" id="3727571">(</span><span class="op" id="3727572">)</span>&nbsp;<span class="ident" id="3727574">Rectangle</span>&nbsp;<span class="op" id="3727584">{</span>&nbsp;<span class="keyword" id="3727586">return</span>&nbsp;<span class="ident" id="3727593">p</span><span class="op" id="3727594">.</span><span class="ident" id="3727595">Rect</span>&nbsp;<span class="op" id="3727600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3727603">func</span>&nbsp;<span class="op" id="3727608">(</span><span class="ident" id="3727609">p</span>&nbsp;<span class="op" id="3727611">*</span><span class="ident" id="3727612">RGBA64</span><span class="op" id="3727618">)</span>&nbsp;<span class="ident" id="3727620">At</span><span class="op" id="3727622">(</span><span class="ident" id="3727623">x</span><span class="op" id="3727624">,</span>&nbsp;<span class="ident" id="3727626">y</span>&nbsp;<span class="builtintype" id="3727628">int</span><span class="op" id="3727631">)</span>&nbsp;<span class="ident" id="3727633">color</span><span class="op" id="3727638">.</span><span class="ident" id="3727639">Color</span>&nbsp;<span class="op" id="3727645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3727648">return</span>&nbsp;<span class="ident" id="3727655">p</span><span class="op" id="3727656">.</span><span class="ident" id="3727657">RGBA64At</span><span class="op" id="3727665">(</span><span class="ident" id="3727666">x</span><span class="op" id="3727667">,</span>&nbsp;<span class="ident" id="3727669">y</span><span class="op" id="3727670">)</span><br>
<span class="lineno">175</span><span class="op" id="3727672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3727675">func</span>&nbsp;<span class="op" id="3727680">(</span><span class="ident" id="3727681">p</span>&nbsp;<span class="op" id="3727683">*</span><span class="ident" id="3727684">RGBA64</span><span class="op" id="3727690">)</span>&nbsp;<span class="ident" id="3727692">RGBA64At</span><span class="op" id="3727700">(</span><span class="ident" id="3727701">x</span><span class="op" id="3727702">,</span>&nbsp;<span class="ident" id="3727704">y</span>&nbsp;<span class="builtintype" id="3727706">int</span><span class="op" id="3727709">)</span>&nbsp;<span class="ident" id="3727711">color</span><span class="op" id="3727716">.</span><span class="ident" id="3727717">RGBA64</span>&nbsp;<span class="op" id="3727724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3727727">if</span>&nbsp;<span class="op" id="3727730">!</span><span class="op" id="3727731">(</span><span class="ident" id="3727732">Point</span><span class="op" id="3727737">{</span><span class="ident" id="3727738">x</span><span class="op" id="3727739">,</span>&nbsp;<span class="ident" id="3727741">y</span><span class="op" id="3727742">}</span><span class="op" id="3727743">.</span><span class="ident" id="3727744">In</span><span class="op" id="3727746">(</span><span class="ident" id="3727747">p</span><span class="op" id="3727748">.</span><span class="ident" id="3727749">Rect</span><span class="op" id="3727753">)</span><span class="op" id="3727754">)</span>&nbsp;<span class="op" id="3727756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3727760">return</span>&nbsp;<span class="ident" id="3727767">color</span><span class="op" id="3727772">.</span><span class="ident" id="3727773">RGBA64</span><span class="op" id="3727779">{</span><span class="op" id="3727780">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3727783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3727786">i</span>&nbsp;<span class="op" id="3727788">:=</span>&nbsp;<span class="ident" id="3727791">p</span><span class="op" id="3727792">.</span><span class="ident" id="3727793">PixOffset</span><span class="op" id="3727802">(</span><span class="ident" id="3727803">x</span><span class="op" id="3727804">,</span>&nbsp;<span class="ident" id="3727806">y</span><span class="op" id="3727807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3727810">return</span>&nbsp;<span class="ident" id="3727817">color</span><span class="op" id="3727822">.</span><span class="ident" id="3727823">RGBA64</span><span class="op" id="3727829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3727833">uint16</span><span class="op" id="3727839">(</span><span class="ident" id="3727840">p</span><span class="op" id="3727841">.</span><span class="ident" id="3727842">Pix</span><span class="op" id="3727845">[</span><span class="ident" id="3727846">i</span><span class="op" id="3727847">+</span><span class="num" id="3727848">0</span><span class="op" id="3727849">]</span><span class="op" id="3727850">)</span><span class="op" id="3727851">&lt;&lt;</span><span class="num" id="3727853">8</span>&nbsp;<span class="op" id="3727855">|</span>&nbsp;<span class="builtintype" id="3727857">uint16</span><span class="op" id="3727863">(</span><span class="ident" id="3727864">p</span><span class="op" id="3727865">.</span><span class="ident" id="3727866">Pix</span><span class="op" id="3727869">[</span><span class="ident" id="3727870">i</span><span class="op" id="3727871">+</span><span class="num" id="3727872">1</span><span class="op" id="3727873">]</span><span class="op" id="3727874">)</span><span class="op" id="3727875">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3727879">uint16</span><span class="op" id="3727885">(</span><span class="ident" id="3727886">p</span><span class="op" id="3727887">.</span><span class="ident" id="3727888">Pix</span><span class="op" id="3727891">[</span><span class="ident" id="3727892">i</span><span class="op" id="3727893">+</span><span class="num" id="3727894">2</span><span class="op" id="3727895">]</span><span class="op" id="3727896">)</span><span class="op" id="3727897">&lt;&lt;</span><span class="num" id="3727899">8</span>&nbsp;<span class="op" id="3727901">|</span>&nbsp;<span class="builtintype" id="3727903">uint16</span><span class="op" id="3727909">(</span><span class="ident" id="3727910">p</span><span class="op" id="3727911">.</span><span class="ident" id="3727912">Pix</span><span class="op" id="3727915">[</span><span class="ident" id="3727916">i</span><span class="op" id="3727917">+</span><span class="num" id="3727918">3</span><span class="op" id="3727919">]</span><span class="op" id="3727920">)</span><span class="op" id="3727921">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3727925">uint16</span><span class="op" id="3727931">(</span><span class="ident" id="3727932">p</span><span class="op" id="3727933">.</span><span class="ident" id="3727934">Pix</span><span class="op" id="3727937">[</span><span class="ident" id="3727938">i</span><span class="op" id="3727939">+</span><span class="num" id="3727940">4</span><span class="op" id="3727941">]</span><span class="op" id="3727942">)</span><span class="op" id="3727943">&lt;&lt;</span><span class="num" id="3727945">8</span>&nbsp;<span class="op" id="3727947">|</span>&nbsp;<span class="builtintype" id="3727949">uint16</span><span class="op" id="3727955">(</span><span class="ident" id="3727956">p</span><span class="op" id="3727957">.</span><span class="ident" id="3727958">Pix</span><span class="op" id="3727961">[</span><span class="ident" id="3727962">i</span><span class="op" id="3727963">+</span><span class="num" id="3727964">5</span><span class="op" id="3727965">]</span><span class="op" id="3727966">)</span><span class="op" id="3727967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3727971">uint16</span><span class="op" id="3727977">(</span><span class="ident" id="3727978">p</span><span class="op" id="3727979">.</span><span class="ident" id="3727980">Pix</span><span class="op" id="3727983">[</span><span class="ident" id="3727984">i</span><span class="op" id="3727985">+</span><span class="num" id="3727986">6</span><span class="op" id="3727987">]</span><span class="op" id="3727988">)</span><span class="op" id="3727989">&lt;&lt;</span><span class="num" id="3727991">8</span>&nbsp;<span class="op" id="3727993">|</span>&nbsp;<span class="builtintype" id="3727995">uint16</span><span class="op" id="3728001">(</span><span class="ident" id="3728002">p</span><span class="op" id="3728003">.</span><span class="ident" id="3728004">Pix</span><span class="op" id="3728007">[</span><span class="ident" id="3728008">i</span><span class="op" id="3728009">+</span><span class="num" id="3728010">7</span><span class="op" id="3728011">]</span><span class="op" id="3728012">)</span><span class="op" id="3728013">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3728016">}</span><br>
<span class="lineno"></span><span class="op" id="3728018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="3728021">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3728100">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="3728124">func</span>&nbsp;<span class="op" id="3728129">(</span><span class="ident" id="3728130">p</span>&nbsp;<span class="op" id="3728132">*</span><span class="ident" id="3728133">RGBA64</span><span class="op" id="3728139">)</span>&nbsp;<span class="ident" id="3728141">PixOffset</span><span class="op" id="3728150">(</span><span class="ident" id="3728151">x</span><span class="op" id="3728152">,</span>&nbsp;<span class="ident" id="3728154">y</span>&nbsp;<span class="builtintype" id="3728156">int</span><span class="op" id="3728159">)</span>&nbsp;<span class="builtintype" id="3728161">int</span>&nbsp;<span class="op" id="3728165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3728168">return</span>&nbsp;<span class="op" id="3728175">(</span><span class="ident" id="3728176">y</span><span class="op" id="3728177">-</span><span class="ident" id="3728178">p</span><span class="op" id="3728179">.</span><span class="ident" id="3728180">Rect</span><span class="op" id="3728184">.</span><span class="ident" id="3728185">Min</span><span class="op" id="3728188">.</span><span class="ident" id="3728189">Y</span><span class="op" id="3728190">)</span><span class="op" id="3728191">*</span><span class="ident" id="3728192">p</span><span class="op" id="3728193">.</span><span class="ident" id="3728194">Stride</span>&nbsp;<span class="op" id="3728201">+</span>&nbsp;<span class="op" id="3728203">(</span><span class="ident" id="3728204">x</span><span class="op" id="3728205">-</span><span class="ident" id="3728206">p</span><span class="op" id="3728207">.</span><span class="ident" id="3728208">Rect</span><span class="op" id="3728212">.</span><span class="ident" id="3728213">Min</span><span class="op" id="3728216">.</span><span class="ident" id="3728217">X</span><span class="op" id="3728218">)</span><span class="op" id="3728219">*</span><span class="num" id="3728220">8</span><br>
<span class="lineno"></span><span class="op" id="3728222">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="3728225">func</span>&nbsp;<span class="op" id="3728230">(</span><span class="ident" id="3728231">p</span>&nbsp;<span class="op" id="3728233">*</span><span class="ident" id="3728234">RGBA64</span><span class="op" id="3728240">)</span>&nbsp;<span class="ident" id="3728242">Set</span><span class="op" id="3728245">(</span><span class="ident" id="3728246">x</span><span class="op" id="3728247">,</span>&nbsp;<span class="ident" id="3728249">y</span>&nbsp;<span class="builtintype" id="3728251">int</span><span class="op" id="3728254">,</span>&nbsp;<span class="ident" id="3728256">c</span>&nbsp;<span class="ident" id="3728258">color</span><span class="op" id="3728263">.</span><span class="ident" id="3728264">Color</span><span class="op" id="3728269">)</span>&nbsp;<span class="op" id="3728271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3728274">if</span>&nbsp;<span class="op" id="3728277">!</span><span class="op" id="3728278">(</span><span class="ident" id="3728279">Point</span><span class="op" id="3728284">{</span><span class="ident" id="3728285">x</span><span class="op" id="3728286">,</span>&nbsp;<span class="ident" id="3728288">y</span><span class="op" id="3728289">}</span><span class="op" id="3728290">.</span><span class="ident" id="3728291">In</span><span class="op" id="3728293">(</span><span class="ident" id="3728294">p</span><span class="op" id="3728295">.</span><span class="ident" id="3728296">Rect</span><span class="op" id="3728300">)</span><span class="op" id="3728301">)</span>&nbsp;<span class="op" id="3728303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3728307">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3728315">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3728318">i</span>&nbsp;<span class="op" id="3728320">:=</span>&nbsp;<span class="ident" id="3728323">p</span><span class="op" id="3728324">.</span><span class="ident" id="3728325">PixOffset</span><span class="op" id="3728334">(</span><span class="ident" id="3728335">x</span><span class="op" id="3728336">,</span>&nbsp;<span class="ident" id="3728338">y</span><span class="op" id="3728339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3728342">c1</span>&nbsp;<span class="op" id="3728345">:=</span>&nbsp;<span class="ident" id="3728348">color</span><span class="op" id="3728353">.</span><span class="ident" id="3728354">RGBA64Model</span><span class="op" id="3728365">.</span><span class="ident" id="3728366">Convert</span><span class="op" id="3728373">(</span><span class="ident" id="3728374">c</span><span class="op" id="3728375">)</span><span class="op" id="3728376">.</span><span class="op" id="3728377">(</span><span class="ident" id="3728378">color</span><span class="op" id="3728383">.</span><span class="ident" id="3728384">RGBA64</span><span class="op" id="3728390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3728393">p</span><span class="op" id="3728394">.</span><span class="ident" id="3728395">Pix</span><span class="op" id="3728398">[</span><span class="ident" id="3728399">i</span><span class="op" id="3728400">+</span><span class="num" id="3728401">0</span><span class="op" id="3728402">]</span>&nbsp;<span class="op" id="3728404">=</span>&nbsp;<span class="builtintype" id="3728406">uint8</span><span class="op" id="3728411">(</span><span class="ident" id="3728412">c1</span><span class="op" id="3728414">.</span><span class="ident" id="3728415">R</span>&nbsp;<span class="op" id="3728417">&gt;&gt;</span>&nbsp;<span class="num" id="3728420">8</span><span class="op" id="3728421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3728424">p</span><span class="op" id="3728425">.</span><span class="ident" id="3728426">Pix</span><span class="op" id="3728429">[</span><span class="ident" id="3728430">i</span><span class="op" id="3728431">+</span><span class="num" id="3728432">1</span><span class="op" id="3728433">]</span>&nbsp;<span class="op" id="3728435">=</span>&nbsp;<span class="builtintype" id="3728437">uint8</span><span class="op" id="3728442">(</span><span class="ident" id="3728443">c1</span><span class="op" id="3728445">.</span><span class="ident" id="3728446">R</span><span class="op" id="3728447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3728450">p</span><span class="op" id="3728451">.</span><span class="ident" id="3728452">Pix</span><span class="op" id="3728455">[</span><span class="ident" id="3728456">i</span><span class="op" id="3728457">+</span><span class="num" id="3728458">2</span><span class="op" id="3728459">]</span>&nbsp;<span class="op" id="3728461">=</span>&nbsp;<span class="builtintype" id="3728463">uint8</span><span class="op" id="3728468">(</span><span class="ident" id="3728469">c1</span><span class="op" id="3728471">.</span><span class="ident" id="3728472">G</span>&nbsp;<span class="op" id="3728474">&gt;&gt;</span>&nbsp;<span class="num" id="3728477">8</span><span class="op" id="3728478">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3728481">p</span><span class="op" id="3728482">.</span><span class="ident" id="3728483">Pix</span><span class="op" id="3728486">[</span><span class="ident" id="3728487">i</span><span class="op" id="3728488">+</span><span class="num" id="3728489">3</span><span class="op" id="3728490">]</span>&nbsp;<span class="op" id="3728492">=</span>&nbsp;<span class="builtintype" id="3728494">uint8</span><span class="op" id="3728499">(</span><span class="ident" id="3728500">c1</span><span class="op" id="3728502">.</span><span class="ident" id="3728503">G</span><span class="op" id="3728504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3728507">p</span><span class="op" id="3728508">.</span><span class="ident" id="3728509">Pix</span><span class="op" id="3728512">[</span><span class="ident" id="3728513">i</span><span class="op" id="3728514">+</span><span class="num" id="3728515">4</span><span class="op" id="3728516">]</span>&nbsp;<span class="op" id="3728518">=</span>&nbsp;<span class="builtintype" id="3728520">uint8</span><span class="op" id="3728525">(</span><span class="ident" id="3728526">c1</span><span class="op" id="3728528">.</span><span class="ident" id="3728529">B</span>&nbsp;<span class="op" id="3728531">&gt;&gt;</span>&nbsp;<span class="num" id="3728534">8</span><span class="op" id="3728535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3728538">p</span><span class="op" id="3728539">.</span><span class="ident" id="3728540">Pix</span><span class="op" id="3728543">[</span><span class="ident" id="3728544">i</span><span class="op" id="3728545">+</span><span class="num" id="3728546">5</span><span class="op" id="3728547">]</span>&nbsp;<span class="op" id="3728549">=</span>&nbsp;<span class="builtintype" id="3728551">uint8</span><span class="op" id="3728556">(</span><span class="ident" id="3728557">c1</span><span class="op" id="3728559">.</span><span class="ident" id="3728560">B</span><span class="op" id="3728561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3728564">p</span><span class="op" id="3728565">.</span><span class="ident" id="3728566">Pix</span><span class="op" id="3728569">[</span><span class="ident" id="3728570">i</span><span class="op" id="3728571">+</span><span class="num" id="3728572">6</span><span class="op" id="3728573">]</span>&nbsp;<span class="op" id="3728575">=</span>&nbsp;<span class="builtintype" id="3728577">uint8</span><span class="op" id="3728582">(</span><span class="ident" id="3728583">c1</span><span class="op" id="3728585">.</span><span class="ident" id="3728586">A</span>&nbsp;<span class="op" id="3728588">&gt;&gt;</span>&nbsp;<span class="num" id="3728591">8</span><span class="op" id="3728592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3728595">p</span><span class="op" id="3728596">.</span><span class="ident" id="3728597">Pix</span><span class="op" id="3728600">[</span><span class="ident" id="3728601">i</span><span class="op" id="3728602">+</span><span class="num" id="3728603">7</span><span class="op" id="3728604">]</span>&nbsp;<span class="op" id="3728606">=</span>&nbsp;<span class="builtintype" id="3728608">uint8</span><span class="op" id="3728613">(</span><span class="ident" id="3728614">c1</span><span class="op" id="3728616">.</span><span class="ident" id="3728617">A</span><span class="op" id="3728618">)</span><br>
<span class="lineno">210</span><span class="op" id="3728620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3728623">func</span>&nbsp;<span class="op" id="3728628">(</span><span class="ident" id="3728629">p</span>&nbsp;<span class="op" id="3728631">*</span><span class="ident" id="3728632">RGBA64</span><span class="op" id="3728638">)</span>&nbsp;<span class="ident" id="3728640">SetRGBA64</span><span class="op" id="3728649">(</span><span class="ident" id="3728650">x</span><span class="op" id="3728651">,</span>&nbsp;<span class="ident" id="3728653">y</span>&nbsp;<span class="builtintype" id="3728655">int</span><span class="op" id="3728658">,</span>&nbsp;<span class="ident" id="3728660">c</span>&nbsp;<span class="ident" id="3728662">color</span><span class="op" id="3728667">.</span><span class="ident" id="3728668">RGBA64</span><span class="op" id="3728674">)</span>&nbsp;<span class="op" id="3728676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3728679">if</span>&nbsp;<span class="op" id="3728682">!</span><span class="op" id="3728683">(</span><span class="ident" id="3728684">Point</span><span class="op" id="3728689">{</span><span class="ident" id="3728690">x</span><span class="op" id="3728691">,</span>&nbsp;<span class="ident" id="3728693">y</span><span class="op" id="3728694">}</span><span class="op" id="3728695">.</span><span class="ident" id="3728696">In</span><span class="op" id="3728698">(</span><span class="ident" id="3728699">p</span><span class="op" id="3728700">.</span><span class="ident" id="3728701">Rect</span><span class="op" id="3728705">)</span><span class="op" id="3728706">)</span>&nbsp;<span class="op" id="3728708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3728712">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3728720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3728723">i</span>&nbsp;<span class="op" id="3728725">:=</span>&nbsp;<span class="ident" id="3728728">p</span><span class="op" id="3728729">.</span><span class="ident" id="3728730">PixOffset</span><span class="op" id="3728739">(</span><span class="ident" id="3728740">x</span><span class="op" id="3728741">,</span>&nbsp;<span class="ident" id="3728743">y</span><span class="op" id="3728744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3728747">p</span><span class="op" id="3728748">.</span><span class="ident" id="3728749">Pix</span><span class="op" id="3728752">[</span><span class="ident" id="3728753">i</span><span class="op" id="3728754">+</span><span class="num" id="3728755">0</span><span class="op" id="3728756">]</span>&nbsp;<span class="op" id="3728758">=</span>&nbsp;<span class="builtintype" id="3728760">uint8</span><span class="op" id="3728765">(</span><span class="ident" id="3728766">c</span><span class="op" id="3728767">.</span><span class="ident" id="3728768">R</span>&nbsp;<span class="op" id="3728770">&gt;&gt;</span>&nbsp;<span class="num" id="3728773">8</span><span class="op" id="3728774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3728777">p</span><span class="op" id="3728778">.</span><span class="ident" id="3728779">Pix</span><span class="op" id="3728782">[</span><span class="ident" id="3728783">i</span><span class="op" id="3728784">+</span><span class="num" id="3728785">1</span><span class="op" id="3728786">]</span>&nbsp;<span class="op" id="3728788">=</span>&nbsp;<span class="builtintype" id="3728790">uint8</span><span class="op" id="3728795">(</span><span class="ident" id="3728796">c</span><span class="op" id="3728797">.</span><span class="ident" id="3728798">R</span><span class="op" id="3728799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3728802">p</span><span class="op" id="3728803">.</span><span class="ident" id="3728804">Pix</span><span class="op" id="3728807">[</span><span class="ident" id="3728808">i</span><span class="op" id="3728809">+</span><span class="num" id="3728810">2</span><span class="op" id="3728811">]</span>&nbsp;<span class="op" id="3728813">=</span>&nbsp;<span class="builtintype" id="3728815">uint8</span><span class="op" id="3728820">(</span><span class="ident" id="3728821">c</span><span class="op" id="3728822">.</span><span class="ident" id="3728823">G</span>&nbsp;<span class="op" id="3728825">&gt;&gt;</span>&nbsp;<span class="num" id="3728828">8</span><span class="op" id="3728829">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3728832">p</span><span class="op" id="3728833">.</span><span class="ident" id="3728834">Pix</span><span class="op" id="3728837">[</span><span class="ident" id="3728838">i</span><span class="op" id="3728839">+</span><span class="num" id="3728840">3</span><span class="op" id="3728841">]</span>&nbsp;<span class="op" id="3728843">=</span>&nbsp;<span class="builtintype" id="3728845">uint8</span><span class="op" id="3728850">(</span><span class="ident" id="3728851">c</span><span class="op" id="3728852">.</span><span class="ident" id="3728853">G</span><span class="op" id="3728854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3728857">p</span><span class="op" id="3728858">.</span><span class="ident" id="3728859">Pix</span><span class="op" id="3728862">[</span><span class="ident" id="3728863">i</span><span class="op" id="3728864">+</span><span class="num" id="3728865">4</span><span class="op" id="3728866">]</span>&nbsp;<span class="op" id="3728868">=</span>&nbsp;<span class="builtintype" id="3728870">uint8</span><span class="op" id="3728875">(</span><span class="ident" id="3728876">c</span><span class="op" id="3728877">.</span><span class="ident" id="3728878">B</span>&nbsp;<span class="op" id="3728880">&gt;&gt;</span>&nbsp;<span class="num" id="3728883">8</span><span class="op" id="3728884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3728887">p</span><span class="op" id="3728888">.</span><span class="ident" id="3728889">Pix</span><span class="op" id="3728892">[</span><span class="ident" id="3728893">i</span><span class="op" id="3728894">+</span><span class="num" id="3728895">5</span><span class="op" id="3728896">]</span>&nbsp;<span class="op" id="3728898">=</span>&nbsp;<span class="builtintype" id="3728900">uint8</span><span class="op" id="3728905">(</span><span class="ident" id="3728906">c</span><span class="op" id="3728907">.</span><span class="ident" id="3728908">B</span><span class="op" id="3728909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3728912">p</span><span class="op" id="3728913">.</span><span class="ident" id="3728914">Pix</span><span class="op" id="3728917">[</span><span class="ident" id="3728918">i</span><span class="op" id="3728919">+</span><span class="num" id="3728920">6</span><span class="op" id="3728921">]</span>&nbsp;<span class="op" id="3728923">=</span>&nbsp;<span class="builtintype" id="3728925">uint8</span><span class="op" id="3728930">(</span><span class="ident" id="3728931">c</span><span class="op" id="3728932">.</span><span class="ident" id="3728933">A</span>&nbsp;<span class="op" id="3728935">&gt;&gt;</span>&nbsp;<span class="num" id="3728938">8</span><span class="op" id="3728939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3728942">p</span><span class="op" id="3728943">.</span><span class="ident" id="3728944">Pix</span><span class="op" id="3728947">[</span><span class="ident" id="3728948">i</span><span class="op" id="3728949">+</span><span class="num" id="3728950">7</span><span class="op" id="3728951">]</span>&nbsp;<span class="op" id="3728953">=</span>&nbsp;<span class="builtintype" id="3728955">uint8</span><span class="op" id="3728960">(</span><span class="ident" id="3728961">c</span><span class="op" id="3728962">.</span><span class="ident" id="3728963">A</span><span class="op" id="3728964">)</span><br>
<span class="lineno">225</span><span class="op" id="3728966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3728969">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="3729046">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="3729118">func</span>&nbsp;<span class="op" id="3729123">(</span><span class="ident" id="3729124">p</span>&nbsp;<span class="op" id="3729126">*</span><span class="ident" id="3729127">RGBA64</span><span class="op" id="3729133">)</span>&nbsp;<span class="ident" id="3729135">SubImage</span><span class="op" id="3729143">(</span><span class="ident" id="3729144">r</span>&nbsp;<span class="ident" id="3729146">Rectangle</span><span class="op" id="3729155">)</span>&nbsp;<span class="ident" id="3729157">Image</span>&nbsp;<span class="op" id="3729163">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3729166">r</span>&nbsp;<span class="op" id="3729168">=</span>&nbsp;<span class="ident" id="3729170">r</span><span class="op" id="3729171">.</span><span class="ident" id="3729172">Intersect</span><span class="op" id="3729181">(</span><span class="ident" id="3729182">p</span><span class="op" id="3729183">.</span><span class="ident" id="3729184">Rect</span><span class="op" id="3729188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3729191">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3729272">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3729354">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3729404">if</span>&nbsp;<span class="ident" id="3729407">r</span><span class="op" id="3729408">.</span><span class="ident" id="3729409">Empty</span><span class="op" id="3729414">(</span><span class="op" id="3729415">)</span>&nbsp;<span class="op" id="3729417">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3729421">return</span>&nbsp;<span class="op" id="3729428">&amp;</span><span class="ident" id="3729429">RGBA64</span><span class="op" id="3729435">{</span><span class="op" id="3729436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3729439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3729442">i</span>&nbsp;<span class="op" id="3729444">:=</span>&nbsp;<span class="ident" id="3729447">p</span><span class="op" id="3729448">.</span><span class="ident" id="3729449">PixOffset</span><span class="op" id="3729458">(</span><span class="ident" id="3729459">r</span><span class="op" id="3729460">.</span><span class="ident" id="3729461">Min</span><span class="op" id="3729464">.</span><span class="ident" id="3729465">X</span><span class="op" id="3729466">,</span>&nbsp;<span class="ident" id="3729468">r</span><span class="op" id="3729469">.</span><span class="ident" id="3729470">Min</span><span class="op" id="3729473">.</span><span class="ident" id="3729474">Y</span><span class="op" id="3729475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3729478">return</span>&nbsp;<span class="op" id="3729485">&amp;</span><span class="ident" id="3729486">RGBA64</span><span class="op" id="3729492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3729496">Pix</span><span class="op" id="3729499">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3729504">p</span><span class="op" id="3729505">.</span><span class="ident" id="3729506">Pix</span><span class="op" id="3729509">[</span><span class="ident" id="3729510">i</span><span class="op" id="3729511">:</span><span class="op" id="3729512">]</span><span class="op" id="3729513">,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3729517">Stride</span><span class="op" id="3729523">:</span>&nbsp;<span class="ident" id="3729525">p</span><span class="op" id="3729526">.</span><span class="ident" id="3729527">Stride</span><span class="op" id="3729533">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3729537">Rect</span><span class="op" id="3729541">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3729545">r</span><span class="op" id="3729546">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3729549">}</span><br>
<span class="lineno"></span><span class="op" id="3729551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="3729554">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="3729627">func</span>&nbsp;<span class="op" id="3729632">(</span><span class="ident" id="3729633">p</span>&nbsp;<span class="op" id="3729635">*</span><span class="ident" id="3729636">RGBA64</span><span class="op" id="3729642">)</span>&nbsp;<span class="ident" id="3729644">Opaque</span><span class="op" id="3729650">(</span><span class="op" id="3729651">)</span>&nbsp;<span class="builtintype" id="3729653">bool</span>&nbsp;<span class="op" id="3729658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3729661">if</span>&nbsp;<span class="ident" id="3729664">p</span><span class="op" id="3729665">.</span><span class="ident" id="3729666">Rect</span><span class="op" id="3729670">.</span><span class="ident" id="3729671">Empty</span><span class="op" id="3729676">(</span><span class="op" id="3729677">)</span>&nbsp;<span class="op" id="3729679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3729683">return</span>&nbsp;<span class="builtintype" id="3729690">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3729696">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3729699">i0</span><span class="op" id="3729701">,</span>&nbsp;<span class="ident" id="3729703">i1</span>&nbsp;<span class="op" id="3729706">:=</span>&nbsp;<span class="num" id="3729709">6</span><span class="op" id="3729710">,</span>&nbsp;<span class="ident" id="3729712">p</span><span class="op" id="3729713">.</span><span class="ident" id="3729714">Rect</span><span class="op" id="3729718">.</span><span class="ident" id="3729719">Dx</span><span class="op" id="3729721">(</span><span class="op" id="3729722">)</span><span class="op" id="3729723">*</span><span class="num" id="3729724">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3729727">for</span>&nbsp;<span class="ident" id="3729731">y</span>&nbsp;<span class="op" id="3729733">:=</span>&nbsp;<span class="ident" id="3729736">p</span><span class="op" id="3729737">.</span><span class="ident" id="3729738">Rect</span><span class="op" id="3729742">.</span><span class="ident" id="3729743">Min</span><span class="op" id="3729746">.</span><span class="ident" id="3729747">Y</span><span class="op" id="3729748">;</span>&nbsp;<span class="ident" id="3729750">y</span>&nbsp;<span class="op" id="3729752">&lt;</span>&nbsp;<span class="ident" id="3729754">p</span><span class="op" id="3729755">.</span><span class="ident" id="3729756">Rect</span><span class="op" id="3729760">.</span><span class="ident" id="3729761">Max</span><span class="op" id="3729764">.</span><span class="ident" id="3729765">Y</span><span class="op" id="3729766">;</span>&nbsp;<span class="ident" id="3729768">y</span><span class="op" id="3729769">++</span>&nbsp;<span class="op" id="3729772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3729776">for</span>&nbsp;<span class="ident" id="3729780">i</span>&nbsp;<span class="op" id="3729782">:=</span>&nbsp;<span class="ident" id="3729785">i0</span><span class="op" id="3729787">;</span>&nbsp;<span class="ident" id="3729789">i</span>&nbsp;<span class="op" id="3729791">&lt;</span>&nbsp;<span class="ident" id="3729793">i1</span><span class="op" id="3729795">;</span>&nbsp;<span class="ident" id="3729797">i</span>&nbsp;<span class="op" id="3729799">+=</span>&nbsp;<span class="num" id="3729802">8</span>&nbsp;<span class="op" id="3729804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3729809">if</span>&nbsp;<span class="ident" id="3729812">p</span><span class="op" id="3729813">.</span><span class="ident" id="3729814">Pix</span><span class="op" id="3729817">[</span><span class="ident" id="3729818">i</span><span class="op" id="3729819">+</span><span class="num" id="3729820">0</span><span class="op" id="3729821">]</span>&nbsp;<span class="op" id="3729823">!=</span>&nbsp;<span class="num" id="3729826">0xff</span>&nbsp;<span class="op" id="3729831">||</span>&nbsp;<span class="ident" id="3729834">p</span><span class="op" id="3729835">.</span><span class="ident" id="3729836">Pix</span><span class="op" id="3729839">[</span><span class="ident" id="3729840">i</span><span class="op" id="3729841">+</span><span class="num" id="3729842">1</span><span class="op" id="3729843">]</span>&nbsp;<span class="op" id="3729845">!=</span>&nbsp;<span class="num" id="3729848">0xff</span>&nbsp;<span class="op" id="3729853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3729859">return</span>&nbsp;<span class="builtintype" id="3729866">false</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3729875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3729879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3729883">i0</span>&nbsp;<span class="op" id="3729886">+=</span>&nbsp;<span class="ident" id="3729889">p</span><span class="op" id="3729890">.</span><span class="ident" id="3729891">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3729900">i1</span>&nbsp;<span class="op" id="3729903">+=</span>&nbsp;<span class="ident" id="3729906">p</span><span class="op" id="3729907">.</span><span class="ident" id="3729908">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3729916">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3729919">return</span>&nbsp;<span class="builtintype" id="3729926">true</span><br>
<span class="lineno"></span><span class="op" id="3729931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3729934">//&nbsp;NewRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="3729991">func</span>&nbsp;<span class="ident" id="3729996">NewRGBA64</span><span class="op" id="3730005">(</span><span class="ident" id="3730006">r</span>&nbsp;<span class="ident" id="3730008">Rectangle</span><span class="op" id="3730017">)</span>&nbsp;<span class="op" id="3730019">*</span><span class="ident" id="3730020">RGBA64</span>&nbsp;<span class="op" id="3730027">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3730030">w</span><span class="op" id="3730031">,</span>&nbsp;<span class="ident" id="3730033">h</span>&nbsp;<span class="op" id="3730035">:=</span>&nbsp;<span class="ident" id="3730038">r</span><span class="op" id="3730039">.</span><span class="ident" id="3730040">Dx</span><span class="op" id="3730042">(</span><span class="op" id="3730043">)</span><span class="op" id="3730044">,</span>&nbsp;<span class="ident" id="3730046">r</span><span class="op" id="3730047">.</span><span class="ident" id="3730048">Dy</span><span class="op" id="3730050">(</span><span class="op" id="3730051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3730054">pix</span>&nbsp;<span class="op" id="3730058">:=</span>&nbsp;<span class="builtinfunc" id="3730061">make</span><span class="op" id="3730065">(</span><span class="op" id="3730066">[</span><span class="op" id="3730067">]</span><span class="builtintype" id="3730068">uint8</span><span class="op" id="3730073">,</span>&nbsp;<span class="num" id="3730075">8</span><span class="op" id="3730076">*</span><span class="ident" id="3730077">w</span><span class="op" id="3730078">*</span><span class="ident" id="3730079">h</span><span class="op" id="3730080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3730083">return</span>&nbsp;<span class="op" id="3730090">&amp;</span><span class="ident" id="3730091">RGBA64</span><span class="op" id="3730097">{</span><span class="ident" id="3730098">pix</span><span class="op" id="3730101">,</span>&nbsp;<span class="num" id="3730103">8</span>&nbsp;<span class="op" id="3730105">*</span>&nbsp;<span class="ident" id="3730107">w</span><span class="op" id="3730108">,</span>&nbsp;<span class="ident" id="3730110">r</span><span class="op" id="3730111">}</span><br>
<span class="lineno"></span><span class="op" id="3730113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="3730116">//&nbsp;NRGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3730191">type</span>&nbsp;<span class="ident" id="3730196">NRGBA</span>&nbsp;<span class="keyword" id="3730202">struct</span>&nbsp;<span class="op" id="3730209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3730212">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3730280">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3730348">Pix</span>&nbsp;<span class="op" id="3730352">[</span><span class="op" id="3730353">]</span><span class="builtintype" id="3730354">uint8</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3730361">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3730437">Stride</span>&nbsp;<span class="builtintype" id="3730444">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3730449">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3730481">Rect</span>&nbsp;<span class="ident" id="3730486">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="3730496">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="3730499">func</span>&nbsp;<span class="op" id="3730504">(</span><span class="ident" id="3730505">p</span>&nbsp;<span class="op" id="3730507">*</span><span class="ident" id="3730508">NRGBA</span><span class="op" id="3730513">)</span>&nbsp;<span class="ident" id="3730515">ColorModel</span><span class="op" id="3730525">(</span><span class="op" id="3730526">)</span>&nbsp;<span class="ident" id="3730528">color</span><span class="op" id="3730533">.</span><span class="ident" id="3730534">Model</span>&nbsp;<span class="op" id="3730540">{</span>&nbsp;<span class="keyword" id="3730542">return</span>&nbsp;<span class="ident" id="3730549">color</span><span class="op" id="3730554">.</span><span class="ident" id="3730555">NRGBAModel</span>&nbsp;<span class="op" id="3730566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3730569">func</span>&nbsp;<span class="op" id="3730574">(</span><span class="ident" id="3730575">p</span>&nbsp;<span class="op" id="3730577">*</span><span class="ident" id="3730578">NRGBA</span><span class="op" id="3730583">)</span>&nbsp;<span class="ident" id="3730585">Bounds</span><span class="op" id="3730591">(</span><span class="op" id="3730592">)</span>&nbsp;<span class="ident" id="3730594">Rectangle</span>&nbsp;<span class="op" id="3730604">{</span>&nbsp;<span class="keyword" id="3730606">return</span>&nbsp;<span class="ident" id="3730613">p</span><span class="op" id="3730614">.</span><span class="ident" id="3730615">Rect</span>&nbsp;<span class="op" id="3730620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="3730623">func</span>&nbsp;<span class="op" id="3730628">(</span><span class="ident" id="3730629">p</span>&nbsp;<span class="op" id="3730631">*</span><span class="ident" id="3730632">NRGBA</span><span class="op" id="3730637">)</span>&nbsp;<span class="ident" id="3730639">At</span><span class="op" id="3730641">(</span><span class="ident" id="3730642">x</span><span class="op" id="3730643">,</span>&nbsp;<span class="ident" id="3730645">y</span>&nbsp;<span class="builtintype" id="3730647">int</span><span class="op" id="3730650">)</span>&nbsp;<span class="ident" id="3730652">color</span><span class="op" id="3730657">.</span><span class="ident" id="3730658">Color</span>&nbsp;<span class="op" id="3730664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3730667">return</span>&nbsp;<span class="ident" id="3730674">p</span><span class="op" id="3730675">.</span><span class="ident" id="3730676">NRGBAAt</span><span class="op" id="3730683">(</span><span class="ident" id="3730684">x</span><span class="op" id="3730685">,</span>&nbsp;<span class="ident" id="3730687">y</span><span class="op" id="3730688">)</span><br>
<span class="lineno"></span><span class="op" id="3730690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3730693">func</span>&nbsp;<span class="op" id="3730698">(</span><span class="ident" id="3730699">p</span>&nbsp;<span class="op" id="3730701">*</span><span class="ident" id="3730702">NRGBA</span><span class="op" id="3730707">)</span>&nbsp;<span class="ident" id="3730709">NRGBAAt</span><span class="op" id="3730716">(</span><span class="ident" id="3730717">x</span><span class="op" id="3730718">,</span>&nbsp;<span class="ident" id="3730720">y</span>&nbsp;<span class="builtintype" id="3730722">int</span><span class="op" id="3730725">)</span>&nbsp;<span class="ident" id="3730727">color</span><span class="op" id="3730732">.</span><span class="ident" id="3730733">NRGBA</span>&nbsp;<span class="op" id="3730739">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3730742">if</span>&nbsp;<span class="op" id="3730745">!</span><span class="op" id="3730746">(</span><span class="ident" id="3730747">Point</span><span class="op" id="3730752">{</span><span class="ident" id="3730753">x</span><span class="op" id="3730754">,</span>&nbsp;<span class="ident" id="3730756">y</span><span class="op" id="3730757">}</span><span class="op" id="3730758">.</span><span class="ident" id="3730759">In</span><span class="op" id="3730761">(</span><span class="ident" id="3730762">p</span><span class="op" id="3730763">.</span><span class="ident" id="3730764">Rect</span><span class="op" id="3730768">)</span><span class="op" id="3730769">)</span>&nbsp;<span class="op" id="3730771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3730775">return</span>&nbsp;<span class="ident" id="3730782">color</span><span class="op" id="3730787">.</span><span class="ident" id="3730788">NRGBA</span><span class="op" id="3730793">{</span><span class="op" id="3730794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3730797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3730800">i</span>&nbsp;<span class="op" id="3730802">:=</span>&nbsp;<span class="ident" id="3730805">p</span><span class="op" id="3730806">.</span><span class="ident" id="3730807">PixOffset</span><span class="op" id="3730816">(</span><span class="ident" id="3730817">x</span><span class="op" id="3730818">,</span>&nbsp;<span class="ident" id="3730820">y</span><span class="op" id="3730821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3730824">return</span>&nbsp;<span class="ident" id="3730831">color</span><span class="op" id="3730836">.</span><span class="ident" id="3730837">NRGBA</span><span class="op" id="3730842">{</span><span class="ident" id="3730843">p</span><span class="op" id="3730844">.</span><span class="ident" id="3730845">Pix</span><span class="op" id="3730848">[</span><span class="ident" id="3730849">i</span><span class="op" id="3730850">+</span><span class="num" id="3730851">0</span><span class="op" id="3730852">]</span><span class="op" id="3730853">,</span>&nbsp;<span class="ident" id="3730855">p</span><span class="op" id="3730856">.</span><span class="ident" id="3730857">Pix</span><span class="op" id="3730860">[</span><span class="ident" id="3730861">i</span><span class="op" id="3730862">+</span><span class="num" id="3730863">1</span><span class="op" id="3730864">]</span><span class="op" id="3730865">,</span>&nbsp;<span class="ident" id="3730867">p</span><span class="op" id="3730868">.</span><span class="ident" id="3730869">Pix</span><span class="op" id="3730872">[</span><span class="ident" id="3730873">i</span><span class="op" id="3730874">+</span><span class="num" id="3730875">2</span><span class="op" id="3730876">]</span><span class="op" id="3730877">,</span>&nbsp;<span class="ident" id="3730879">p</span><span class="op" id="3730880">.</span><span class="ident" id="3730881">Pix</span><span class="op" id="3730884">[</span><span class="ident" id="3730885">i</span><span class="op" id="3730886">+</span><span class="num" id="3730887">3</span><span class="op" id="3730888">]</span><span class="op" id="3730889">}</span><br>
<span class="lineno">295</span><span class="op" id="3730891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3730894">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3730973">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="3730997">func</span>&nbsp;<span class="op" id="3731002">(</span><span class="ident" id="3731003">p</span>&nbsp;<span class="op" id="3731005">*</span><span class="ident" id="3731006">NRGBA</span><span class="op" id="3731011">)</span>&nbsp;<span class="ident" id="3731013">PixOffset</span><span class="op" id="3731022">(</span><span class="ident" id="3731023">x</span><span class="op" id="3731024">,</span>&nbsp;<span class="ident" id="3731026">y</span>&nbsp;<span class="builtintype" id="3731028">int</span><span class="op" id="3731031">)</span>&nbsp;<span class="builtintype" id="3731033">int</span>&nbsp;<span class="op" id="3731037">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3731040">return</span>&nbsp;<span class="op" id="3731047">(</span><span class="ident" id="3731048">y</span><span class="op" id="3731049">-</span><span class="ident" id="3731050">p</span><span class="op" id="3731051">.</span><span class="ident" id="3731052">Rect</span><span class="op" id="3731056">.</span><span class="ident" id="3731057">Min</span><span class="op" id="3731060">.</span><span class="ident" id="3731061">Y</span><span class="op" id="3731062">)</span><span class="op" id="3731063">*</span><span class="ident" id="3731064">p</span><span class="op" id="3731065">.</span><span class="ident" id="3731066">Stride</span>&nbsp;<span class="op" id="3731073">+</span>&nbsp;<span class="op" id="3731075">(</span><span class="ident" id="3731076">x</span><span class="op" id="3731077">-</span><span class="ident" id="3731078">p</span><span class="op" id="3731079">.</span><span class="ident" id="3731080">Rect</span><span class="op" id="3731084">.</span><span class="ident" id="3731085">Min</span><span class="op" id="3731088">.</span><span class="ident" id="3731089">X</span><span class="op" id="3731090">)</span><span class="op" id="3731091">*</span><span class="num" id="3731092">4</span><br>
<span class="lineno"></span><span class="op" id="3731094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3731097">func</span>&nbsp;<span class="op" id="3731102">(</span><span class="ident" id="3731103">p</span>&nbsp;<span class="op" id="3731105">*</span><span class="ident" id="3731106">NRGBA</span><span class="op" id="3731111">)</span>&nbsp;<span class="ident" id="3731113">Set</span><span class="op" id="3731116">(</span><span class="ident" id="3731117">x</span><span class="op" id="3731118">,</span>&nbsp;<span class="ident" id="3731120">y</span>&nbsp;<span class="builtintype" id="3731122">int</span><span class="op" id="3731125">,</span>&nbsp;<span class="ident" id="3731127">c</span>&nbsp;<span class="ident" id="3731129">color</span><span class="op" id="3731134">.</span><span class="ident" id="3731135">Color</span><span class="op" id="3731140">)</span>&nbsp;<span class="op" id="3731142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3731145">if</span>&nbsp;<span class="op" id="3731148">!</span><span class="op" id="3731149">(</span><span class="ident" id="3731150">Point</span><span class="op" id="3731155">{</span><span class="ident" id="3731156">x</span><span class="op" id="3731157">,</span>&nbsp;<span class="ident" id="3731159">y</span><span class="op" id="3731160">}</span><span class="op" id="3731161">.</span><span class="ident" id="3731162">In</span><span class="op" id="3731164">(</span><span class="ident" id="3731165">p</span><span class="op" id="3731166">.</span><span class="ident" id="3731167">Rect</span><span class="op" id="3731171">)</span><span class="op" id="3731172">)</span>&nbsp;<span class="op" id="3731174">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3731178">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3731186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3731189">i</span>&nbsp;<span class="op" id="3731191">:=</span>&nbsp;<span class="ident" id="3731194">p</span><span class="op" id="3731195">.</span><span class="ident" id="3731196">PixOffset</span><span class="op" id="3731205">(</span><span class="ident" id="3731206">x</span><span class="op" id="3731207">,</span>&nbsp;<span class="ident" id="3731209">y</span><span class="op" id="3731210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3731213">c1</span>&nbsp;<span class="op" id="3731216">:=</span>&nbsp;<span class="ident" id="3731219">color</span><span class="op" id="3731224">.</span><span class="ident" id="3731225">NRGBAModel</span><span class="op" id="3731235">.</span><span class="ident" id="3731236">Convert</span><span class="op" id="3731243">(</span><span class="ident" id="3731244">c</span><span class="op" id="3731245">)</span><span class="op" id="3731246">.</span><span class="op" id="3731247">(</span><span class="ident" id="3731248">color</span><span class="op" id="3731253">.</span><span class="ident" id="3731254">NRGBA</span><span class="op" id="3731259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3731262">p</span><span class="op" id="3731263">.</span><span class="ident" id="3731264">Pix</span><span class="op" id="3731267">[</span><span class="ident" id="3731268">i</span><span class="op" id="3731269">+</span><span class="num" id="3731270">0</span><span class="op" id="3731271">]</span>&nbsp;<span class="op" id="3731273">=</span>&nbsp;<span class="ident" id="3731275">c1</span><span class="op" id="3731277">.</span><span class="ident" id="3731278">R</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3731281">p</span><span class="op" id="3731282">.</span><span class="ident" id="3731283">Pix</span><span class="op" id="3731286">[</span><span class="ident" id="3731287">i</span><span class="op" id="3731288">+</span><span class="num" id="3731289">1</span><span class="op" id="3731290">]</span>&nbsp;<span class="op" id="3731292">=</span>&nbsp;<span class="ident" id="3731294">c1</span><span class="op" id="3731296">.</span><span class="ident" id="3731297">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3731300">p</span><span class="op" id="3731301">.</span><span class="ident" id="3731302">Pix</span><span class="op" id="3731305">[</span><span class="ident" id="3731306">i</span><span class="op" id="3731307">+</span><span class="num" id="3731308">2</span><span class="op" id="3731309">]</span>&nbsp;<span class="op" id="3731311">=</span>&nbsp;<span class="ident" id="3731313">c1</span><span class="op" id="3731315">.</span><span class="ident" id="3731316">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3731319">p</span><span class="op" id="3731320">.</span><span class="ident" id="3731321">Pix</span><span class="op" id="3731324">[</span><span class="ident" id="3731325">i</span><span class="op" id="3731326">+</span><span class="num" id="3731327">3</span><span class="op" id="3731328">]</span>&nbsp;<span class="op" id="3731330">=</span>&nbsp;<span class="ident" id="3731332">c1</span><span class="op" id="3731334">.</span><span class="ident" id="3731335">A</span><br>
<span class="lineno"></span><span class="op" id="3731337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="3731340">func</span>&nbsp;<span class="op" id="3731345">(</span><span class="ident" id="3731346">p</span>&nbsp;<span class="op" id="3731348">*</span><span class="ident" id="3731349">NRGBA</span><span class="op" id="3731354">)</span>&nbsp;<span class="ident" id="3731356">SetNRGBA</span><span class="op" id="3731364">(</span><span class="ident" id="3731365">x</span><span class="op" id="3731366">,</span>&nbsp;<span class="ident" id="3731368">y</span>&nbsp;<span class="builtintype" id="3731370">int</span><span class="op" id="3731373">,</span>&nbsp;<span class="ident" id="3731375">c</span>&nbsp;<span class="ident" id="3731377">color</span><span class="op" id="3731382">.</span><span class="ident" id="3731383">NRGBA</span><span class="op" id="3731388">)</span>&nbsp;<span class="op" id="3731390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3731393">if</span>&nbsp;<span class="op" id="3731396">!</span><span class="op" id="3731397">(</span><span class="ident" id="3731398">Point</span><span class="op" id="3731403">{</span><span class="ident" id="3731404">x</span><span class="op" id="3731405">,</span>&nbsp;<span class="ident" id="3731407">y</span><span class="op" id="3731408">}</span><span class="op" id="3731409">.</span><span class="ident" id="3731410">In</span><span class="op" id="3731412">(</span><span class="ident" id="3731413">p</span><span class="op" id="3731414">.</span><span class="ident" id="3731415">Rect</span><span class="op" id="3731419">)</span><span class="op" id="3731420">)</span>&nbsp;<span class="op" id="3731422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3731426">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3731434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3731437">i</span>&nbsp;<span class="op" id="3731439">:=</span>&nbsp;<span class="ident" id="3731442">p</span><span class="op" id="3731443">.</span><span class="ident" id="3731444">PixOffset</span><span class="op" id="3731453">(</span><span class="ident" id="3731454">x</span><span class="op" id="3731455">,</span>&nbsp;<span class="ident" id="3731457">y</span><span class="op" id="3731458">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3731461">p</span><span class="op" id="3731462">.</span><span class="ident" id="3731463">Pix</span><span class="op" id="3731466">[</span><span class="ident" id="3731467">i</span><span class="op" id="3731468">+</span><span class="num" id="3731469">0</span><span class="op" id="3731470">]</span>&nbsp;<span class="op" id="3731472">=</span>&nbsp;<span class="ident" id="3731474">c</span><span class="op" id="3731475">.</span><span class="ident" id="3731476">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3731479">p</span><span class="op" id="3731480">.</span><span class="ident" id="3731481">Pix</span><span class="op" id="3731484">[</span><span class="ident" id="3731485">i</span><span class="op" id="3731486">+</span><span class="num" id="3731487">1</span><span class="op" id="3731488">]</span>&nbsp;<span class="op" id="3731490">=</span>&nbsp;<span class="ident" id="3731492">c</span><span class="op" id="3731493">.</span><span class="ident" id="3731494">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3731497">p</span><span class="op" id="3731498">.</span><span class="ident" id="3731499">Pix</span><span class="op" id="3731502">[</span><span class="ident" id="3731503">i</span><span class="op" id="3731504">+</span><span class="num" id="3731505">2</span><span class="op" id="3731506">]</span>&nbsp;<span class="op" id="3731508">=</span>&nbsp;<span class="ident" id="3731510">c</span><span class="op" id="3731511">.</span><span class="ident" id="3731512">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3731515">p</span><span class="op" id="3731516">.</span><span class="ident" id="3731517">Pix</span><span class="op" id="3731520">[</span><span class="ident" id="3731521">i</span><span class="op" id="3731522">+</span><span class="num" id="3731523">3</span><span class="op" id="3731524">]</span>&nbsp;<span class="op" id="3731526">=</span>&nbsp;<span class="ident" id="3731528">c</span><span class="op" id="3731529">.</span><span class="ident" id="3731530">A</span><br>
<span class="lineno"></span><span class="op" id="3731532">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="3731535">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="3731612">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="3731684">func</span>&nbsp;<span class="op" id="3731689">(</span><span class="ident" id="3731690">p</span>&nbsp;<span class="op" id="3731692">*</span><span class="ident" id="3731693">NRGBA</span><span class="op" id="3731698">)</span>&nbsp;<span class="ident" id="3731700">SubImage</span><span class="op" id="3731708">(</span><span class="ident" id="3731709">r</span>&nbsp;<span class="ident" id="3731711">Rectangle</span><span class="op" id="3731720">)</span>&nbsp;<span class="ident" id="3731722">Image</span>&nbsp;<span class="op" id="3731728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3731731">r</span>&nbsp;<span class="op" id="3731733">=</span>&nbsp;<span class="ident" id="3731735">r</span><span class="op" id="3731736">.</span><span class="ident" id="3731737">Intersect</span><span class="op" id="3731746">(</span><span class="ident" id="3731747">p</span><span class="op" id="3731748">.</span><span class="ident" id="3731749">Rect</span><span class="op" id="3731753">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3731756">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3731837">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3731919">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3731969">if</span>&nbsp;<span class="ident" id="3731972">r</span><span class="op" id="3731973">.</span><span class="ident" id="3731974">Empty</span><span class="op" id="3731979">(</span><span class="op" id="3731980">)</span>&nbsp;<span class="op" id="3731982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3731986">return</span>&nbsp;<span class="op" id="3731993">&amp;</span><span class="ident" id="3731994">NRGBA</span><span class="op" id="3731999">{</span><span class="op" id="3732000">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3732003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3732006">i</span>&nbsp;<span class="op" id="3732008">:=</span>&nbsp;<span class="ident" id="3732011">p</span><span class="op" id="3732012">.</span><span class="ident" id="3732013">PixOffset</span><span class="op" id="3732022">(</span><span class="ident" id="3732023">r</span><span class="op" id="3732024">.</span><span class="ident" id="3732025">Min</span><span class="op" id="3732028">.</span><span class="ident" id="3732029">X</span><span class="op" id="3732030">,</span>&nbsp;<span class="ident" id="3732032">r</span><span class="op" id="3732033">.</span><span class="ident" id="3732034">Min</span><span class="op" id="3732037">.</span><span class="ident" id="3732038">Y</span><span class="op" id="3732039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3732042">return</span>&nbsp;<span class="op" id="3732049">&amp;</span><span class="ident" id="3732050">NRGBA</span><span class="op" id="3732055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3732059">Pix</span><span class="op" id="3732062">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3732067">p</span><span class="op" id="3732068">.</span><span class="ident" id="3732069">Pix</span><span class="op" id="3732072">[</span><span class="ident" id="3732073">i</span><span class="op" id="3732074">:</span><span class="op" id="3732075">]</span><span class="op" id="3732076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3732080">Stride</span><span class="op" id="3732086">:</span>&nbsp;<span class="ident" id="3732088">p</span><span class="op" id="3732089">.</span><span class="ident" id="3732090">Stride</span><span class="op" id="3732096">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3732100">Rect</span><span class="op" id="3732104">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3732108">r</span><span class="op" id="3732109">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3732112">}</span><br>
<span class="lineno"></span><span class="op" id="3732114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3732117">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno">345</span><span class="keyword" id="3732190">func</span>&nbsp;<span class="op" id="3732195">(</span><span class="ident" id="3732196">p</span>&nbsp;<span class="op" id="3732198">*</span><span class="ident" id="3732199">NRGBA</span><span class="op" id="3732204">)</span>&nbsp;<span class="ident" id="3732206">Opaque</span><span class="op" id="3732212">(</span><span class="op" id="3732213">)</span>&nbsp;<span class="builtintype" id="3732215">bool</span>&nbsp;<span class="op" id="3732220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3732223">if</span>&nbsp;<span class="ident" id="3732226">p</span><span class="op" id="3732227">.</span><span class="ident" id="3732228">Rect</span><span class="op" id="3732232">.</span><span class="ident" id="3732233">Empty</span><span class="op" id="3732238">(</span><span class="op" id="3732239">)</span>&nbsp;<span class="op" id="3732241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3732245">return</span>&nbsp;<span class="builtintype" id="3732252">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3732258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3732261">i0</span><span class="op" id="3732263">,</span>&nbsp;<span class="ident" id="3732265">i1</span>&nbsp;<span class="op" id="3732268">:=</span>&nbsp;<span class="num" id="3732271">3</span><span class="op" id="3732272">,</span>&nbsp;<span class="ident" id="3732274">p</span><span class="op" id="3732275">.</span><span class="ident" id="3732276">Rect</span><span class="op" id="3732280">.</span><span class="ident" id="3732281">Dx</span><span class="op" id="3732283">(</span><span class="op" id="3732284">)</span><span class="op" id="3732285">*</span><span class="num" id="3732286">4</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3732289">for</span>&nbsp;<span class="ident" id="3732293">y</span>&nbsp;<span class="op" id="3732295">:=</span>&nbsp;<span class="ident" id="3732298">p</span><span class="op" id="3732299">.</span><span class="ident" id="3732300">Rect</span><span class="op" id="3732304">.</span><span class="ident" id="3732305">Min</span><span class="op" id="3732308">.</span><span class="ident" id="3732309">Y</span><span class="op" id="3732310">;</span>&nbsp;<span class="ident" id="3732312">y</span>&nbsp;<span class="op" id="3732314">&lt;</span>&nbsp;<span class="ident" id="3732316">p</span><span class="op" id="3732317">.</span><span class="ident" id="3732318">Rect</span><span class="op" id="3732322">.</span><span class="ident" id="3732323">Max</span><span class="op" id="3732326">.</span><span class="ident" id="3732327">Y</span><span class="op" id="3732328">;</span>&nbsp;<span class="ident" id="3732330">y</span><span class="op" id="3732331">++</span>&nbsp;<span class="op" id="3732334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3732338">for</span>&nbsp;<span class="ident" id="3732342">i</span>&nbsp;<span class="op" id="3732344">:=</span>&nbsp;<span class="ident" id="3732347">i0</span><span class="op" id="3732349">;</span>&nbsp;<span class="ident" id="3732351">i</span>&nbsp;<span class="op" id="3732353">&lt;</span>&nbsp;<span class="ident" id="3732355">i1</span><span class="op" id="3732357">;</span>&nbsp;<span class="ident" id="3732359">i</span>&nbsp;<span class="op" id="3732361">+=</span>&nbsp;<span class="num" id="3732364">4</span>&nbsp;<span class="op" id="3732366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3732371">if</span>&nbsp;<span class="ident" id="3732374">p</span><span class="op" id="3732375">.</span><span class="ident" id="3732376">Pix</span><span class="op" id="3732379">[</span><span class="ident" id="3732380">i</span><span class="op" id="3732381">]</span>&nbsp;<span class="op" id="3732383">!=</span>&nbsp;<span class="num" id="3732386">0xff</span>&nbsp;<span class="op" id="3732391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3732397">return</span>&nbsp;<span class="builtintype" id="3732404">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3732413">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3732417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3732421">i0</span>&nbsp;<span class="op" id="3732424">+=</span>&nbsp;<span class="ident" id="3732427">p</span><span class="op" id="3732428">.</span><span class="ident" id="3732429">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3732438">i1</span>&nbsp;<span class="op" id="3732441">+=</span>&nbsp;<span class="ident" id="3732444">p</span><span class="op" id="3732445">.</span><span class="ident" id="3732446">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3732454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3732457">return</span>&nbsp;<span class="builtintype" id="3732464">true</span><br>
<span class="lineno">360</span><span class="op" id="3732469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3732472">//&nbsp;NewNRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="3732527">func</span>&nbsp;<span class="ident" id="3732532">NewNRGBA</span><span class="op" id="3732540">(</span><span class="ident" id="3732541">r</span>&nbsp;<span class="ident" id="3732543">Rectangle</span><span class="op" id="3732552">)</span>&nbsp;<span class="op" id="3732554">*</span><span class="ident" id="3732555">NRGBA</span>&nbsp;<span class="op" id="3732561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3732564">w</span><span class="op" id="3732565">,</span>&nbsp;<span class="ident" id="3732567">h</span>&nbsp;<span class="op" id="3732569">:=</span>&nbsp;<span class="ident" id="3732572">r</span><span class="op" id="3732573">.</span><span class="ident" id="3732574">Dx</span><span class="op" id="3732576">(</span><span class="op" id="3732577">)</span><span class="op" id="3732578">,</span>&nbsp;<span class="ident" id="3732580">r</span><span class="op" id="3732581">.</span><span class="ident" id="3732582">Dy</span><span class="op" id="3732584">(</span><span class="op" id="3732585">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3732588">pix</span>&nbsp;<span class="op" id="3732592">:=</span>&nbsp;<span class="builtinfunc" id="3732595">make</span><span class="op" id="3732599">(</span><span class="op" id="3732600">[</span><span class="op" id="3732601">]</span><span class="builtintype" id="3732602">uint8</span><span class="op" id="3732607">,</span>&nbsp;<span class="num" id="3732609">4</span><span class="op" id="3732610">*</span><span class="ident" id="3732611">w</span><span class="op" id="3732612">*</span><span class="ident" id="3732613">h</span><span class="op" id="3732614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3732617">return</span>&nbsp;<span class="op" id="3732624">&amp;</span><span class="ident" id="3732625">NRGBA</span><span class="op" id="3732630">{</span><span class="ident" id="3732631">pix</span><span class="op" id="3732634">,</span>&nbsp;<span class="num" id="3732636">4</span>&nbsp;<span class="op" id="3732638">*</span>&nbsp;<span class="ident" id="3732640">w</span><span class="op" id="3732641">,</span>&nbsp;<span class="ident" id="3732643">r</span><span class="op" id="3732644">}</span><br>
<span class="lineno"></span><span class="op" id="3732646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3732649">//&nbsp;NRGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA64&nbsp;values.</span><br>
<span class="lineno">370</span><span class="keyword" id="3732728">type</span>&nbsp;<span class="ident" id="3732733">NRGBA64</span>&nbsp;<span class="keyword" id="3732741">struct</span>&nbsp;<span class="op" id="3732748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3732751">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3732841">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3732909">Pix</span>&nbsp;<span class="op" id="3732913">[</span><span class="op" id="3732914">]</span><span class="builtintype" id="3732915">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3732922">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3732998">Stride</span>&nbsp;<span class="builtintype" id="3733005">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3733010">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3733042">Rect</span>&nbsp;<span class="ident" id="3733047">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="3733057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="3733060">func</span>&nbsp;<span class="op" id="3733065">(</span><span class="ident" id="3733066">p</span>&nbsp;<span class="op" id="3733068">*</span><span class="ident" id="3733069">NRGBA64</span><span class="op" id="3733076">)</span>&nbsp;<span class="ident" id="3733078">ColorModel</span><span class="op" id="3733088">(</span><span class="op" id="3733089">)</span>&nbsp;<span class="ident" id="3733091">color</span><span class="op" id="3733096">.</span><span class="ident" id="3733097">Model</span>&nbsp;<span class="op" id="3733103">{</span>&nbsp;<span class="keyword" id="3733105">return</span>&nbsp;<span class="ident" id="3733112">color</span><span class="op" id="3733117">.</span><span class="ident" id="3733118">NRGBA64Model</span>&nbsp;<span class="op" id="3733131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3733134">func</span>&nbsp;<span class="op" id="3733139">(</span><span class="ident" id="3733140">p</span>&nbsp;<span class="op" id="3733142">*</span><span class="ident" id="3733143">NRGBA64</span><span class="op" id="3733150">)</span>&nbsp;<span class="ident" id="3733152">Bounds</span><span class="op" id="3733158">(</span><span class="op" id="3733159">)</span>&nbsp;<span class="ident" id="3733161">Rectangle</span>&nbsp;<span class="op" id="3733171">{</span>&nbsp;<span class="keyword" id="3733173">return</span>&nbsp;<span class="ident" id="3733180">p</span><span class="op" id="3733181">.</span><span class="ident" id="3733182">Rect</span>&nbsp;<span class="op" id="3733187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3733190">func</span>&nbsp;<span class="op" id="3733195">(</span><span class="ident" id="3733196">p</span>&nbsp;<span class="op" id="3733198">*</span><span class="ident" id="3733199">NRGBA64</span><span class="op" id="3733206">)</span>&nbsp;<span class="ident" id="3733208">At</span><span class="op" id="3733210">(</span><span class="ident" id="3733211">x</span><span class="op" id="3733212">,</span>&nbsp;<span class="ident" id="3733214">y</span>&nbsp;<span class="builtintype" id="3733216">int</span><span class="op" id="3733219">)</span>&nbsp;<span class="ident" id="3733221">color</span><span class="op" id="3733226">.</span><span class="ident" id="3733227">Color</span>&nbsp;<span class="op" id="3733233">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3733236">return</span>&nbsp;<span class="ident" id="3733243">p</span><span class="op" id="3733244">.</span><span class="ident" id="3733245">NRGBA64At</span><span class="op" id="3733254">(</span><span class="ident" id="3733255">x</span><span class="op" id="3733256">,</span>&nbsp;<span class="ident" id="3733258">y</span><span class="op" id="3733259">)</span><br>
<span class="lineno"></span><span class="op" id="3733261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3733264">func</span>&nbsp;<span class="op" id="3733269">(</span><span class="ident" id="3733270">p</span>&nbsp;<span class="op" id="3733272">*</span><span class="ident" id="3733273">NRGBA64</span><span class="op" id="3733280">)</span>&nbsp;<span class="ident" id="3733282">NRGBA64At</span><span class="op" id="3733291">(</span><span class="ident" id="3733292">x</span><span class="op" id="3733293">,</span>&nbsp;<span class="ident" id="3733295">y</span>&nbsp;<span class="builtintype" id="3733297">int</span><span class="op" id="3733300">)</span>&nbsp;<span class="ident" id="3733302">color</span><span class="op" id="3733307">.</span><span class="ident" id="3733308">NRGBA64</span>&nbsp;<span class="op" id="3733316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3733319">if</span>&nbsp;<span class="op" id="3733322">!</span><span class="op" id="3733323">(</span><span class="ident" id="3733324">Point</span><span class="op" id="3733329">{</span><span class="ident" id="3733330">x</span><span class="op" id="3733331">,</span>&nbsp;<span class="ident" id="3733333">y</span><span class="op" id="3733334">}</span><span class="op" id="3733335">.</span><span class="ident" id="3733336">In</span><span class="op" id="3733338">(</span><span class="ident" id="3733339">p</span><span class="op" id="3733340">.</span><span class="ident" id="3733341">Rect</span><span class="op" id="3733345">)</span><span class="op" id="3733346">)</span>&nbsp;<span class="op" id="3733348">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3733352">return</span>&nbsp;<span class="ident" id="3733359">color</span><span class="op" id="3733364">.</span><span class="ident" id="3733365">NRGBA64</span><span class="op" id="3733372">{</span><span class="op" id="3733373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3733376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3733379">i</span>&nbsp;<span class="op" id="3733381">:=</span>&nbsp;<span class="ident" id="3733384">p</span><span class="op" id="3733385">.</span><span class="ident" id="3733386">PixOffset</span><span class="op" id="3733395">(</span><span class="ident" id="3733396">x</span><span class="op" id="3733397">,</span>&nbsp;<span class="ident" id="3733399">y</span><span class="op" id="3733400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3733403">return</span>&nbsp;<span class="ident" id="3733410">color</span><span class="op" id="3733415">.</span><span class="ident" id="3733416">NRGBA64</span><span class="op" id="3733423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3733427">uint16</span><span class="op" id="3733433">(</span><span class="ident" id="3733434">p</span><span class="op" id="3733435">.</span><span class="ident" id="3733436">Pix</span><span class="op" id="3733439">[</span><span class="ident" id="3733440">i</span><span class="op" id="3733441">+</span><span class="num" id="3733442">0</span><span class="op" id="3733443">]</span><span class="op" id="3733444">)</span><span class="op" id="3733445">&lt;&lt;</span><span class="num" id="3733447">8</span>&nbsp;<span class="op" id="3733449">|</span>&nbsp;<span class="builtintype" id="3733451">uint16</span><span class="op" id="3733457">(</span><span class="ident" id="3733458">p</span><span class="op" id="3733459">.</span><span class="ident" id="3733460">Pix</span><span class="op" id="3733463">[</span><span class="ident" id="3733464">i</span><span class="op" id="3733465">+</span><span class="num" id="3733466">1</span><span class="op" id="3733467">]</span><span class="op" id="3733468">)</span><span class="op" id="3733469">,</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3733473">uint16</span><span class="op" id="3733479">(</span><span class="ident" id="3733480">p</span><span class="op" id="3733481">.</span><span class="ident" id="3733482">Pix</span><span class="op" id="3733485">[</span><span class="ident" id="3733486">i</span><span class="op" id="3733487">+</span><span class="num" id="3733488">2</span><span class="op" id="3733489">]</span><span class="op" id="3733490">)</span><span class="op" id="3733491">&lt;&lt;</span><span class="num" id="3733493">8</span>&nbsp;<span class="op" id="3733495">|</span>&nbsp;<span class="builtintype" id="3733497">uint16</span><span class="op" id="3733503">(</span><span class="ident" id="3733504">p</span><span class="op" id="3733505">.</span><span class="ident" id="3733506">Pix</span><span class="op" id="3733509">[</span><span class="ident" id="3733510">i</span><span class="op" id="3733511">+</span><span class="num" id="3733512">3</span><span class="op" id="3733513">]</span><span class="op" id="3733514">)</span><span class="op" id="3733515">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3733519">uint16</span><span class="op" id="3733525">(</span><span class="ident" id="3733526">p</span><span class="op" id="3733527">.</span><span class="ident" id="3733528">Pix</span><span class="op" id="3733531">[</span><span class="ident" id="3733532">i</span><span class="op" id="3733533">+</span><span class="num" id="3733534">4</span><span class="op" id="3733535">]</span><span class="op" id="3733536">)</span><span class="op" id="3733537">&lt;&lt;</span><span class="num" id="3733539">8</span>&nbsp;<span class="op" id="3733541">|</span>&nbsp;<span class="builtintype" id="3733543">uint16</span><span class="op" id="3733549">(</span><span class="ident" id="3733550">p</span><span class="op" id="3733551">.</span><span class="ident" id="3733552">Pix</span><span class="op" id="3733555">[</span><span class="ident" id="3733556">i</span><span class="op" id="3733557">+</span><span class="num" id="3733558">5</span><span class="op" id="3733559">]</span><span class="op" id="3733560">)</span><span class="op" id="3733561">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3733565">uint16</span><span class="op" id="3733571">(</span><span class="ident" id="3733572">p</span><span class="op" id="3733573">.</span><span class="ident" id="3733574">Pix</span><span class="op" id="3733577">[</span><span class="ident" id="3733578">i</span><span class="op" id="3733579">+</span><span class="num" id="3733580">6</span><span class="op" id="3733581">]</span><span class="op" id="3733582">)</span><span class="op" id="3733583">&lt;&lt;</span><span class="num" id="3733585">8</span>&nbsp;<span class="op" id="3733587">|</span>&nbsp;<span class="builtintype" id="3733589">uint16</span><span class="op" id="3733595">(</span><span class="ident" id="3733596">p</span><span class="op" id="3733597">.</span><span class="ident" id="3733598">Pix</span><span class="op" id="3733601">[</span><span class="ident" id="3733602">i</span><span class="op" id="3733603">+</span><span class="num" id="3733604">7</span><span class="op" id="3733605">]</span><span class="op" id="3733606">)</span><span class="op" id="3733607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3733610">}</span><br>
<span class="lineno"></span><span class="op" id="3733612">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="comment" id="3733615">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3733694">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="3733718">func</span>&nbsp;<span class="op" id="3733723">(</span><span class="ident" id="3733724">p</span>&nbsp;<span class="op" id="3733726">*</span><span class="ident" id="3733727">NRGBA64</span><span class="op" id="3733734">)</span>&nbsp;<span class="ident" id="3733736">PixOffset</span><span class="op" id="3733745">(</span><span class="ident" id="3733746">x</span><span class="op" id="3733747">,</span>&nbsp;<span class="ident" id="3733749">y</span>&nbsp;<span class="builtintype" id="3733751">int</span><span class="op" id="3733754">)</span>&nbsp;<span class="builtintype" id="3733756">int</span>&nbsp;<span class="op" id="3733760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3733763">return</span>&nbsp;<span class="op" id="3733770">(</span><span class="ident" id="3733771">y</span><span class="op" id="3733772">-</span><span class="ident" id="3733773">p</span><span class="op" id="3733774">.</span><span class="ident" id="3733775">Rect</span><span class="op" id="3733779">.</span><span class="ident" id="3733780">Min</span><span class="op" id="3733783">.</span><span class="ident" id="3733784">Y</span><span class="op" id="3733785">)</span><span class="op" id="3733786">*</span><span class="ident" id="3733787">p</span><span class="op" id="3733788">.</span><span class="ident" id="3733789">Stride</span>&nbsp;<span class="op" id="3733796">+</span>&nbsp;<span class="op" id="3733798">(</span><span class="ident" id="3733799">x</span><span class="op" id="3733800">-</span><span class="ident" id="3733801">p</span><span class="op" id="3733802">.</span><span class="ident" id="3733803">Rect</span><span class="op" id="3733807">.</span><span class="ident" id="3733808">Min</span><span class="op" id="3733811">.</span><span class="ident" id="3733812">X</span><span class="op" id="3733813">)</span><span class="op" id="3733814">*</span><span class="num" id="3733815">8</span><br>
<span class="lineno">405</span><span class="op" id="3733817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3733820">func</span>&nbsp;<span class="op" id="3733825">(</span><span class="ident" id="3733826">p</span>&nbsp;<span class="op" id="3733828">*</span><span class="ident" id="3733829">NRGBA64</span><span class="op" id="3733836">)</span>&nbsp;<span class="ident" id="3733838">Set</span><span class="op" id="3733841">(</span><span class="ident" id="3733842">x</span><span class="op" id="3733843">,</span>&nbsp;<span class="ident" id="3733845">y</span>&nbsp;<span class="builtintype" id="3733847">int</span><span class="op" id="3733850">,</span>&nbsp;<span class="ident" id="3733852">c</span>&nbsp;<span class="ident" id="3733854">color</span><span class="op" id="3733859">.</span><span class="ident" id="3733860">Color</span><span class="op" id="3733865">)</span>&nbsp;<span class="op" id="3733867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3733870">if</span>&nbsp;<span class="op" id="3733873">!</span><span class="op" id="3733874">(</span><span class="ident" id="3733875">Point</span><span class="op" id="3733880">{</span><span class="ident" id="3733881">x</span><span class="op" id="3733882">,</span>&nbsp;<span class="ident" id="3733884">y</span><span class="op" id="3733885">}</span><span class="op" id="3733886">.</span><span class="ident" id="3733887">In</span><span class="op" id="3733889">(</span><span class="ident" id="3733890">p</span><span class="op" id="3733891">.</span><span class="ident" id="3733892">Rect</span><span class="op" id="3733896">)</span><span class="op" id="3733897">)</span>&nbsp;<span class="op" id="3733899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3733903">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3733911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3733914">i</span>&nbsp;<span class="op" id="3733916">:=</span>&nbsp;<span class="ident" id="3733919">p</span><span class="op" id="3733920">.</span><span class="ident" id="3733921">PixOffset</span><span class="op" id="3733930">(</span><span class="ident" id="3733931">x</span><span class="op" id="3733932">,</span>&nbsp;<span class="ident" id="3733934">y</span><span class="op" id="3733935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3733938">c1</span>&nbsp;<span class="op" id="3733941">:=</span>&nbsp;<span class="ident" id="3733944">color</span><span class="op" id="3733949">.</span><span class="ident" id="3733950">NRGBA64Model</span><span class="op" id="3733962">.</span><span class="ident" id="3733963">Convert</span><span class="op" id="3733970">(</span><span class="ident" id="3733971">c</span><span class="op" id="3733972">)</span><span class="op" id="3733973">.</span><span class="op" id="3733974">(</span><span class="ident" id="3733975">color</span><span class="op" id="3733980">.</span><span class="ident" id="3733981">NRGBA64</span><span class="op" id="3733988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3733991">p</span><span class="op" id="3733992">.</span><span class="ident" id="3733993">Pix</span><span class="op" id="3733996">[</span><span class="ident" id="3733997">i</span><span class="op" id="3733998">+</span><span class="num" id="3733999">0</span><span class="op" id="3734000">]</span>&nbsp;<span class="op" id="3734002">=</span>&nbsp;<span class="builtintype" id="3734004">uint8</span><span class="op" id="3734009">(</span><span class="ident" id="3734010">c1</span><span class="op" id="3734012">.</span><span class="ident" id="3734013">R</span>&nbsp;<span class="op" id="3734015">&gt;&gt;</span>&nbsp;<span class="num" id="3734018">8</span><span class="op" id="3734019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3734022">p</span><span class="op" id="3734023">.</span><span class="ident" id="3734024">Pix</span><span class="op" id="3734027">[</span><span class="ident" id="3734028">i</span><span class="op" id="3734029">+</span><span class="num" id="3734030">1</span><span class="op" id="3734031">]</span>&nbsp;<span class="op" id="3734033">=</span>&nbsp;<span class="builtintype" id="3734035">uint8</span><span class="op" id="3734040">(</span><span class="ident" id="3734041">c1</span><span class="op" id="3734043">.</span><span class="ident" id="3734044">R</span><span class="op" id="3734045">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3734048">p</span><span class="op" id="3734049">.</span><span class="ident" id="3734050">Pix</span><span class="op" id="3734053">[</span><span class="ident" id="3734054">i</span><span class="op" id="3734055">+</span><span class="num" id="3734056">2</span><span class="op" id="3734057">]</span>&nbsp;<span class="op" id="3734059">=</span>&nbsp;<span class="builtintype" id="3734061">uint8</span><span class="op" id="3734066">(</span><span class="ident" id="3734067">c1</span><span class="op" id="3734069">.</span><span class="ident" id="3734070">G</span>&nbsp;<span class="op" id="3734072">&gt;&gt;</span>&nbsp;<span class="num" id="3734075">8</span><span class="op" id="3734076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3734079">p</span><span class="op" id="3734080">.</span><span class="ident" id="3734081">Pix</span><span class="op" id="3734084">[</span><span class="ident" id="3734085">i</span><span class="op" id="3734086">+</span><span class="num" id="3734087">3</span><span class="op" id="3734088">]</span>&nbsp;<span class="op" id="3734090">=</span>&nbsp;<span class="builtintype" id="3734092">uint8</span><span class="op" id="3734097">(</span><span class="ident" id="3734098">c1</span><span class="op" id="3734100">.</span><span class="ident" id="3734101">G</span><span class="op" id="3734102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3734105">p</span><span class="op" id="3734106">.</span><span class="ident" id="3734107">Pix</span><span class="op" id="3734110">[</span><span class="ident" id="3734111">i</span><span class="op" id="3734112">+</span><span class="num" id="3734113">4</span><span class="op" id="3734114">]</span>&nbsp;<span class="op" id="3734116">=</span>&nbsp;<span class="builtintype" id="3734118">uint8</span><span class="op" id="3734123">(</span><span class="ident" id="3734124">c1</span><span class="op" id="3734126">.</span><span class="ident" id="3734127">B</span>&nbsp;<span class="op" id="3734129">&gt;&gt;</span>&nbsp;<span class="num" id="3734132">8</span><span class="op" id="3734133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3734136">p</span><span class="op" id="3734137">.</span><span class="ident" id="3734138">Pix</span><span class="op" id="3734141">[</span><span class="ident" id="3734142">i</span><span class="op" id="3734143">+</span><span class="num" id="3734144">5</span><span class="op" id="3734145">]</span>&nbsp;<span class="op" id="3734147">=</span>&nbsp;<span class="builtintype" id="3734149">uint8</span><span class="op" id="3734154">(</span><span class="ident" id="3734155">c1</span><span class="op" id="3734157">.</span><span class="ident" id="3734158">B</span><span class="op" id="3734159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3734162">p</span><span class="op" id="3734163">.</span><span class="ident" id="3734164">Pix</span><span class="op" id="3734167">[</span><span class="ident" id="3734168">i</span><span class="op" id="3734169">+</span><span class="num" id="3734170">6</span><span class="op" id="3734171">]</span>&nbsp;<span class="op" id="3734173">=</span>&nbsp;<span class="builtintype" id="3734175">uint8</span><span class="op" id="3734180">(</span><span class="ident" id="3734181">c1</span><span class="op" id="3734183">.</span><span class="ident" id="3734184">A</span>&nbsp;<span class="op" id="3734186">&gt;&gt;</span>&nbsp;<span class="num" id="3734189">8</span><span class="op" id="3734190">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3734193">p</span><span class="op" id="3734194">.</span><span class="ident" id="3734195">Pix</span><span class="op" id="3734198">[</span><span class="ident" id="3734199">i</span><span class="op" id="3734200">+</span><span class="num" id="3734201">7</span><span class="op" id="3734202">]</span>&nbsp;<span class="op" id="3734204">=</span>&nbsp;<span class="builtintype" id="3734206">uint8</span><span class="op" id="3734211">(</span><span class="ident" id="3734212">c1</span><span class="op" id="3734214">.</span><span class="ident" id="3734215">A</span><span class="op" id="3734216">)</span><br>
<span class="lineno"></span><span class="op" id="3734218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3734221">func</span>&nbsp;<span class="op" id="3734226">(</span><span class="ident" id="3734227">p</span>&nbsp;<span class="op" id="3734229">*</span><span class="ident" id="3734230">NRGBA64</span><span class="op" id="3734237">)</span>&nbsp;<span class="ident" id="3734239">SetNRGBA64</span><span class="op" id="3734249">(</span><span class="ident" id="3734250">x</span><span class="op" id="3734251">,</span>&nbsp;<span class="ident" id="3734253">y</span>&nbsp;<span class="builtintype" id="3734255">int</span><span class="op" id="3734258">,</span>&nbsp;<span class="ident" id="3734260">c</span>&nbsp;<span class="ident" id="3734262">color</span><span class="op" id="3734267">.</span><span class="ident" id="3734268">NRGBA64</span><span class="op" id="3734275">)</span>&nbsp;<span class="op" id="3734277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3734280">if</span>&nbsp;<span class="op" id="3734283">!</span><span class="op" id="3734284">(</span><span class="ident" id="3734285">Point</span><span class="op" id="3734290">{</span><span class="ident" id="3734291">x</span><span class="op" id="3734292">,</span>&nbsp;<span class="ident" id="3734294">y</span><span class="op" id="3734295">}</span><span class="op" id="3734296">.</span><span class="ident" id="3734297">In</span><span class="op" id="3734299">(</span><span class="ident" id="3734300">p</span><span class="op" id="3734301">.</span><span class="ident" id="3734302">Rect</span><span class="op" id="3734306">)</span><span class="op" id="3734307">)</span>&nbsp;<span class="op" id="3734309">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3734313">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3734321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3734324">i</span>&nbsp;<span class="op" id="3734326">:=</span>&nbsp;<span class="ident" id="3734329">p</span><span class="op" id="3734330">.</span><span class="ident" id="3734331">PixOffset</span><span class="op" id="3734340">(</span><span class="ident" id="3734341">x</span><span class="op" id="3734342">,</span>&nbsp;<span class="ident" id="3734344">y</span><span class="op" id="3734345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3734348">p</span><span class="op" id="3734349">.</span><span class="ident" id="3734350">Pix</span><span class="op" id="3734353">[</span><span class="ident" id="3734354">i</span><span class="op" id="3734355">+</span><span class="num" id="3734356">0</span><span class="op" id="3734357">]</span>&nbsp;<span class="op" id="3734359">=</span>&nbsp;<span class="builtintype" id="3734361">uint8</span><span class="op" id="3734366">(</span><span class="ident" id="3734367">c</span><span class="op" id="3734368">.</span><span class="ident" id="3734369">R</span>&nbsp;<span class="op" id="3734371">&gt;&gt;</span>&nbsp;<span class="num" id="3734374">8</span><span class="op" id="3734375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3734378">p</span><span class="op" id="3734379">.</span><span class="ident" id="3734380">Pix</span><span class="op" id="3734383">[</span><span class="ident" id="3734384">i</span><span class="op" id="3734385">+</span><span class="num" id="3734386">1</span><span class="op" id="3734387">]</span>&nbsp;<span class="op" id="3734389">=</span>&nbsp;<span class="builtintype" id="3734391">uint8</span><span class="op" id="3734396">(</span><span class="ident" id="3734397">c</span><span class="op" id="3734398">.</span><span class="ident" id="3734399">R</span><span class="op" id="3734400">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3734403">p</span><span class="op" id="3734404">.</span><span class="ident" id="3734405">Pix</span><span class="op" id="3734408">[</span><span class="ident" id="3734409">i</span><span class="op" id="3734410">+</span><span class="num" id="3734411">2</span><span class="op" id="3734412">]</span>&nbsp;<span class="op" id="3734414">=</span>&nbsp;<span class="builtintype" id="3734416">uint8</span><span class="op" id="3734421">(</span><span class="ident" id="3734422">c</span><span class="op" id="3734423">.</span><span class="ident" id="3734424">G</span>&nbsp;<span class="op" id="3734426">&gt;&gt;</span>&nbsp;<span class="num" id="3734429">8</span><span class="op" id="3734430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3734433">p</span><span class="op" id="3734434">.</span><span class="ident" id="3734435">Pix</span><span class="op" id="3734438">[</span><span class="ident" id="3734439">i</span><span class="op" id="3734440">+</span><span class="num" id="3734441">3</span><span class="op" id="3734442">]</span>&nbsp;<span class="op" id="3734444">=</span>&nbsp;<span class="builtintype" id="3734446">uint8</span><span class="op" id="3734451">(</span><span class="ident" id="3734452">c</span><span class="op" id="3734453">.</span><span class="ident" id="3734454">G</span><span class="op" id="3734455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3734458">p</span><span class="op" id="3734459">.</span><span class="ident" id="3734460">Pix</span><span class="op" id="3734463">[</span><span class="ident" id="3734464">i</span><span class="op" id="3734465">+</span><span class="num" id="3734466">4</span><span class="op" id="3734467">]</span>&nbsp;<span class="op" id="3734469">=</span>&nbsp;<span class="builtintype" id="3734471">uint8</span><span class="op" id="3734476">(</span><span class="ident" id="3734477">c</span><span class="op" id="3734478">.</span><span class="ident" id="3734479">B</span>&nbsp;<span class="op" id="3734481">&gt;&gt;</span>&nbsp;<span class="num" id="3734484">8</span><span class="op" id="3734485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3734488">p</span><span class="op" id="3734489">.</span><span class="ident" id="3734490">Pix</span><span class="op" id="3734493">[</span><span class="ident" id="3734494">i</span><span class="op" id="3734495">+</span><span class="num" id="3734496">5</span><span class="op" id="3734497">]</span>&nbsp;<span class="op" id="3734499">=</span>&nbsp;<span class="builtintype" id="3734501">uint8</span><span class="op" id="3734506">(</span><span class="ident" id="3734507">c</span><span class="op" id="3734508">.</span><span class="ident" id="3734509">B</span><span class="op" id="3734510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3734513">p</span><span class="op" id="3734514">.</span><span class="ident" id="3734515">Pix</span><span class="op" id="3734518">[</span><span class="ident" id="3734519">i</span><span class="op" id="3734520">+</span><span class="num" id="3734521">6</span><span class="op" id="3734522">]</span>&nbsp;<span class="op" id="3734524">=</span>&nbsp;<span class="builtintype" id="3734526">uint8</span><span class="op" id="3734531">(</span><span class="ident" id="3734532">c</span><span class="op" id="3734533">.</span><span class="ident" id="3734534">A</span>&nbsp;<span class="op" id="3734536">&gt;&gt;</span>&nbsp;<span class="num" id="3734539">8</span><span class="op" id="3734540">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3734543">p</span><span class="op" id="3734544">.</span><span class="ident" id="3734545">Pix</span><span class="op" id="3734548">[</span><span class="ident" id="3734549">i</span><span class="op" id="3734550">+</span><span class="num" id="3734551">7</span><span class="op" id="3734552">]</span>&nbsp;<span class="op" id="3734554">=</span>&nbsp;<span class="builtintype" id="3734556">uint8</span><span class="op" id="3734561">(</span><span class="ident" id="3734562">c</span><span class="op" id="3734563">.</span><span class="ident" id="3734564">A</span><span class="op" id="3734565">)</span><br>
<span class="lineno"></span><span class="op" id="3734567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3734570">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="3734647">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno">440</span><span class="keyword" id="3734719">func</span>&nbsp;<span class="op" id="3734724">(</span><span class="ident" id="3734725">p</span>&nbsp;<span class="op" id="3734727">*</span><span class="ident" id="3734728">NRGBA64</span><span class="op" id="3734735">)</span>&nbsp;<span class="ident" id="3734737">SubImage</span><span class="op" id="3734745">(</span><span class="ident" id="3734746">r</span>&nbsp;<span class="ident" id="3734748">Rectangle</span><span class="op" id="3734757">)</span>&nbsp;<span class="ident" id="3734759">Image</span>&nbsp;<span class="op" id="3734765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3734768">r</span>&nbsp;<span class="op" id="3734770">=</span>&nbsp;<span class="ident" id="3734772">r</span><span class="op" id="3734773">.</span><span class="ident" id="3734774">Intersect</span><span class="op" id="3734783">(</span><span class="ident" id="3734784">p</span><span class="op" id="3734785">.</span><span class="ident" id="3734786">Rect</span><span class="op" id="3734790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3734793">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3734874">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3734956">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3735006">if</span>&nbsp;<span class="ident" id="3735009">r</span><span class="op" id="3735010">.</span><span class="ident" id="3735011">Empty</span><span class="op" id="3735016">(</span><span class="op" id="3735017">)</span>&nbsp;<span class="op" id="3735019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3735023">return</span>&nbsp;<span class="op" id="3735030">&amp;</span><span class="ident" id="3735031">NRGBA64</span><span class="op" id="3735038">{</span><span class="op" id="3735039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3735042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3735045">i</span>&nbsp;<span class="op" id="3735047">:=</span>&nbsp;<span class="ident" id="3735050">p</span><span class="op" id="3735051">.</span><span class="ident" id="3735052">PixOffset</span><span class="op" id="3735061">(</span><span class="ident" id="3735062">r</span><span class="op" id="3735063">.</span><span class="ident" id="3735064">Min</span><span class="op" id="3735067">.</span><span class="ident" id="3735068">X</span><span class="op" id="3735069">,</span>&nbsp;<span class="ident" id="3735071">r</span><span class="op" id="3735072">.</span><span class="ident" id="3735073">Min</span><span class="op" id="3735076">.</span><span class="ident" id="3735077">Y</span><span class="op" id="3735078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3735081">return</span>&nbsp;<span class="op" id="3735088">&amp;</span><span class="ident" id="3735089">NRGBA64</span><span class="op" id="3735096">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3735100">Pix</span><span class="op" id="3735103">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735108">p</span><span class="op" id="3735109">.</span><span class="ident" id="3735110">Pix</span><span class="op" id="3735113">[</span><span class="ident" id="3735114">i</span><span class="op" id="3735115">:</span><span class="op" id="3735116">]</span><span class="op" id="3735117">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3735121">Stride</span><span class="op" id="3735127">:</span>&nbsp;<span class="ident" id="3735129">p</span><span class="op" id="3735130">.</span><span class="ident" id="3735131">Stride</span><span class="op" id="3735137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3735141">Rect</span><span class="op" id="3735145">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3735149">r</span><span class="op" id="3735150">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3735153">}</span><br>
<span class="lineno"></span><span class="op" id="3735155">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="3735158">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="3735231">func</span>&nbsp;<span class="op" id="3735236">(</span><span class="ident" id="3735237">p</span>&nbsp;<span class="op" id="3735239">*</span><span class="ident" id="3735240">NRGBA64</span><span class="op" id="3735247">)</span>&nbsp;<span class="ident" id="3735249">Opaque</span><span class="op" id="3735255">(</span><span class="op" id="3735256">)</span>&nbsp;<span class="builtintype" id="3735258">bool</span>&nbsp;<span class="op" id="3735263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3735266">if</span>&nbsp;<span class="ident" id="3735269">p</span><span class="op" id="3735270">.</span><span class="ident" id="3735271">Rect</span><span class="op" id="3735275">.</span><span class="ident" id="3735276">Empty</span><span class="op" id="3735281">(</span><span class="op" id="3735282">)</span>&nbsp;<span class="op" id="3735284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3735288">return</span>&nbsp;<span class="builtintype" id="3735295">true</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3735301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3735304">i0</span><span class="op" id="3735306">,</span>&nbsp;<span class="ident" id="3735308">i1</span>&nbsp;<span class="op" id="3735311">:=</span>&nbsp;<span class="num" id="3735314">6</span><span class="op" id="3735315">,</span>&nbsp;<span class="ident" id="3735317">p</span><span class="op" id="3735318">.</span><span class="ident" id="3735319">Rect</span><span class="op" id="3735323">.</span><span class="ident" id="3735324">Dx</span><span class="op" id="3735326">(</span><span class="op" id="3735327">)</span><span class="op" id="3735328">*</span><span class="num" id="3735329">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3735332">for</span>&nbsp;<span class="ident" id="3735336">y</span>&nbsp;<span class="op" id="3735338">:=</span>&nbsp;<span class="ident" id="3735341">p</span><span class="op" id="3735342">.</span><span class="ident" id="3735343">Rect</span><span class="op" id="3735347">.</span><span class="ident" id="3735348">Min</span><span class="op" id="3735351">.</span><span class="ident" id="3735352">Y</span><span class="op" id="3735353">;</span>&nbsp;<span class="ident" id="3735355">y</span>&nbsp;<span class="op" id="3735357">&lt;</span>&nbsp;<span class="ident" id="3735359">p</span><span class="op" id="3735360">.</span><span class="ident" id="3735361">Rect</span><span class="op" id="3735365">.</span><span class="ident" id="3735366">Max</span><span class="op" id="3735369">.</span><span class="ident" id="3735370">Y</span><span class="op" id="3735371">;</span>&nbsp;<span class="ident" id="3735373">y</span><span class="op" id="3735374">++</span>&nbsp;<span class="op" id="3735377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3735381">for</span>&nbsp;<span class="ident" id="3735385">i</span>&nbsp;<span class="op" id="3735387">:=</span>&nbsp;<span class="ident" id="3735390">i0</span><span class="op" id="3735392">;</span>&nbsp;<span class="ident" id="3735394">i</span>&nbsp;<span class="op" id="3735396">&lt;</span>&nbsp;<span class="ident" id="3735398">i1</span><span class="op" id="3735400">;</span>&nbsp;<span class="ident" id="3735402">i</span>&nbsp;<span class="op" id="3735404">+=</span>&nbsp;<span class="num" id="3735407">8</span>&nbsp;<span class="op" id="3735409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3735414">if</span>&nbsp;<span class="ident" id="3735417">p</span><span class="op" id="3735418">.</span><span class="ident" id="3735419">Pix</span><span class="op" id="3735422">[</span><span class="ident" id="3735423">i</span><span class="op" id="3735424">+</span><span class="num" id="3735425">0</span><span class="op" id="3735426">]</span>&nbsp;<span class="op" id="3735428">!=</span>&nbsp;<span class="num" id="3735431">0xff</span>&nbsp;<span class="op" id="3735436">||</span>&nbsp;<span class="ident" id="3735439">p</span><span class="op" id="3735440">.</span><span class="ident" id="3735441">Pix</span><span class="op" id="3735444">[</span><span class="ident" id="3735445">i</span><span class="op" id="3735446">+</span><span class="num" id="3735447">1</span><span class="op" id="3735448">]</span>&nbsp;<span class="op" id="3735450">!=</span>&nbsp;<span class="num" id="3735453">0xff</span>&nbsp;<span class="op" id="3735458">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3735464">return</span>&nbsp;<span class="builtintype" id="3735471">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3735480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3735484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3735488">i0</span>&nbsp;<span class="op" id="3735491">+=</span>&nbsp;<span class="ident" id="3735494">p</span><span class="op" id="3735495">.</span><span class="ident" id="3735496">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3735505">i1</span>&nbsp;<span class="op" id="3735508">+=</span>&nbsp;<span class="ident" id="3735511">p</span><span class="op" id="3735512">.</span><span class="ident" id="3735513">Stride</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3735521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3735524">return</span>&nbsp;<span class="builtintype" id="3735531">true</span><br>
<span class="lineno"></span><span class="op" id="3735536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3735539">//&nbsp;NewNRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno">475</span><span class="keyword" id="3735598">func</span>&nbsp;<span class="ident" id="3735603">NewNRGBA64</span><span class="op" id="3735613">(</span><span class="ident" id="3735614">r</span>&nbsp;<span class="ident" id="3735616">Rectangle</span><span class="op" id="3735625">)</span>&nbsp;<span class="op" id="3735627">*</span><span class="ident" id="3735628">NRGBA64</span>&nbsp;<span class="op" id="3735636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3735639">w</span><span class="op" id="3735640">,</span>&nbsp;<span class="ident" id="3735642">h</span>&nbsp;<span class="op" id="3735644">:=</span>&nbsp;<span class="ident" id="3735647">r</span><span class="op" id="3735648">.</span><span class="ident" id="3735649">Dx</span><span class="op" id="3735651">(</span><span class="op" id="3735652">)</span><span class="op" id="3735653">,</span>&nbsp;<span class="ident" id="3735655">r</span><span class="op" id="3735656">.</span><span class="ident" id="3735657">Dy</span><span class="op" id="3735659">(</span><span class="op" id="3735660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3735663">pix</span>&nbsp;<span class="op" id="3735667">:=</span>&nbsp;<span class="builtinfunc" id="3735670">make</span><span class="op" id="3735674">(</span><span class="op" id="3735675">[</span><span class="op" id="3735676">]</span><span class="builtintype" id="3735677">uint8</span><span class="op" id="3735682">,</span>&nbsp;<span class="num" id="3735684">8</span><span class="op" id="3735685">*</span><span class="ident" id="3735686">w</span><span class="op" id="3735687">*</span><span class="ident" id="3735688">h</span><span class="op" id="3735689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3735692">return</span>&nbsp;<span class="op" id="3735699">&amp;</span><span class="ident" id="3735700">NRGBA64</span><span class="op" id="3735707">{</span><span class="ident" id="3735708">pix</span><span class="op" id="3735711">,</span>&nbsp;<span class="num" id="3735713">8</span>&nbsp;<span class="op" id="3735715">*</span>&nbsp;<span class="ident" id="3735717">w</span><span class="op" id="3735718">,</span>&nbsp;<span class="ident" id="3735720">r</span><span class="op" id="3735721">}</span><br>
<span class="lineno"></span><span class="op" id="3735723">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="3735726">//&nbsp;Alpha&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3735801">type</span>&nbsp;<span class="ident" id="3735806">Alpha</span>&nbsp;<span class="keyword" id="3735812">struct</span>&nbsp;<span class="op" id="3735819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3735822">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3735886">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3735954">Pix</span>&nbsp;<span class="op" id="3735958">[</span><span class="op" id="3735959">]</span><span class="builtintype" id="3735960">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3735967">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3736043">Stride</span>&nbsp;<span class="builtintype" id="3736050">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3736055">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3736087">Rect</span>&nbsp;<span class="ident" id="3736092">Rectangle</span><br>
<span class="lineno">490</span><span class="op" id="3736102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3736105">func</span>&nbsp;<span class="op" id="3736110">(</span><span class="ident" id="3736111">p</span>&nbsp;<span class="op" id="3736113">*</span><span class="ident" id="3736114">Alpha</span><span class="op" id="3736119">)</span>&nbsp;<span class="ident" id="3736121">ColorModel</span><span class="op" id="3736131">(</span><span class="op" id="3736132">)</span>&nbsp;<span class="ident" id="3736134">color</span><span class="op" id="3736139">.</span><span class="ident" id="3736140">Model</span>&nbsp;<span class="op" id="3736146">{</span>&nbsp;<span class="keyword" id="3736148">return</span>&nbsp;<span class="ident" id="3736155">color</span><span class="op" id="3736160">.</span><span class="ident" id="3736161">AlphaModel</span>&nbsp;<span class="op" id="3736172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3736175">func</span>&nbsp;<span class="op" id="3736180">(</span><span class="ident" id="3736181">p</span>&nbsp;<span class="op" id="3736183">*</span><span class="ident" id="3736184">Alpha</span><span class="op" id="3736189">)</span>&nbsp;<span class="ident" id="3736191">Bounds</span><span class="op" id="3736197">(</span><span class="op" id="3736198">)</span>&nbsp;<span class="ident" id="3736200">Rectangle</span>&nbsp;<span class="op" id="3736210">{</span>&nbsp;<span class="keyword" id="3736212">return</span>&nbsp;<span class="ident" id="3736219">p</span><span class="op" id="3736220">.</span><span class="ident" id="3736221">Rect</span>&nbsp;<span class="op" id="3736226">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="3736229">func</span>&nbsp;<span class="op" id="3736234">(</span><span class="ident" id="3736235">p</span>&nbsp;<span class="op" id="3736237">*</span><span class="ident" id="3736238">Alpha</span><span class="op" id="3736243">)</span>&nbsp;<span class="ident" id="3736245">At</span><span class="op" id="3736247">(</span><span class="ident" id="3736248">x</span><span class="op" id="3736249">,</span>&nbsp;<span class="ident" id="3736251">y</span>&nbsp;<span class="builtintype" id="3736253">int</span><span class="op" id="3736256">)</span>&nbsp;<span class="ident" id="3736258">color</span><span class="op" id="3736263">.</span><span class="ident" id="3736264">Color</span>&nbsp;<span class="op" id="3736270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3736273">return</span>&nbsp;<span class="ident" id="3736280">p</span><span class="op" id="3736281">.</span><span class="ident" id="3736282">AlphaAt</span><span class="op" id="3736289">(</span><span class="ident" id="3736290">x</span><span class="op" id="3736291">,</span>&nbsp;<span class="ident" id="3736293">y</span><span class="op" id="3736294">)</span><br>
<span class="lineno"></span><span class="op" id="3736296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="3736299">func</span>&nbsp;<span class="op" id="3736304">(</span><span class="ident" id="3736305">p</span>&nbsp;<span class="op" id="3736307">*</span><span class="ident" id="3736308">Alpha</span><span class="op" id="3736313">)</span>&nbsp;<span class="ident" id="3736315">AlphaAt</span><span class="op" id="3736322">(</span><span class="ident" id="3736323">x</span><span class="op" id="3736324">,</span>&nbsp;<span class="ident" id="3736326">y</span>&nbsp;<span class="builtintype" id="3736328">int</span><span class="op" id="3736331">)</span>&nbsp;<span class="ident" id="3736333">color</span><span class="op" id="3736338">.</span><span class="ident" id="3736339">Alpha</span>&nbsp;<span class="op" id="3736345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3736348">if</span>&nbsp;<span class="op" id="3736351">!</span><span class="op" id="3736352">(</span><span class="ident" id="3736353">Point</span><span class="op" id="3736358">{</span><span class="ident" id="3736359">x</span><span class="op" id="3736360">,</span>&nbsp;<span class="ident" id="3736362">y</span><span class="op" id="3736363">}</span><span class="op" id="3736364">.</span><span class="ident" id="3736365">In</span><span class="op" id="3736367">(</span><span class="ident" id="3736368">p</span><span class="op" id="3736369">.</span><span class="ident" id="3736370">Rect</span><span class="op" id="3736374">)</span><span class="op" id="3736375">)</span>&nbsp;<span class="op" id="3736377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3736381">return</span>&nbsp;<span class="ident" id="3736388">color</span><span class="op" id="3736393">.</span><span class="ident" id="3736394">Alpha</span><span class="op" id="3736399">{</span><span class="op" id="3736400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3736403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3736406">i</span>&nbsp;<span class="op" id="3736408">:=</span>&nbsp;<span class="ident" id="3736411">p</span><span class="op" id="3736412">.</span><span class="ident" id="3736413">PixOffset</span><span class="op" id="3736422">(</span><span class="ident" id="3736423">x</span><span class="op" id="3736424">,</span>&nbsp;<span class="ident" id="3736426">y</span><span class="op" id="3736427">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3736430">return</span>&nbsp;<span class="ident" id="3736437">color</span><span class="op" id="3736442">.</span><span class="ident" id="3736443">Alpha</span><span class="op" id="3736448">{</span><span class="ident" id="3736449">p</span><span class="op" id="3736450">.</span><span class="ident" id="3736451">Pix</span><span class="op" id="3736454">[</span><span class="ident" id="3736455">i</span><span class="op" id="3736456">]</span><span class="op" id="3736457">}</span><br>
<span class="lineno"></span><span class="op" id="3736459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3736462">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3736541">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">510</span><span class="keyword" id="3736565">func</span>&nbsp;<span class="op" id="3736570">(</span><span class="ident" id="3736571">p</span>&nbsp;<span class="op" id="3736573">*</span><span class="ident" id="3736574">Alpha</span><span class="op" id="3736579">)</span>&nbsp;<span class="ident" id="3736581">PixOffset</span><span class="op" id="3736590">(</span><span class="ident" id="3736591">x</span><span class="op" id="3736592">,</span>&nbsp;<span class="ident" id="3736594">y</span>&nbsp;<span class="builtintype" id="3736596">int</span><span class="op" id="3736599">)</span>&nbsp;<span class="builtintype" id="3736601">int</span>&nbsp;<span class="op" id="3736605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3736608">return</span>&nbsp;<span class="op" id="3736615">(</span><span class="ident" id="3736616">y</span><span class="op" id="3736617">-</span><span class="ident" id="3736618">p</span><span class="op" id="3736619">.</span><span class="ident" id="3736620">Rect</span><span class="op" id="3736624">.</span><span class="ident" id="3736625">Min</span><span class="op" id="3736628">.</span><span class="ident" id="3736629">Y</span><span class="op" id="3736630">)</span><span class="op" id="3736631">*</span><span class="ident" id="3736632">p</span><span class="op" id="3736633">.</span><span class="ident" id="3736634">Stride</span>&nbsp;<span class="op" id="3736641">+</span>&nbsp;<span class="op" id="3736643">(</span><span class="ident" id="3736644">x</span><span class="op" id="3736645">-</span><span class="ident" id="3736646">p</span><span class="op" id="3736647">.</span><span class="ident" id="3736648">Rect</span><span class="op" id="3736652">.</span><span class="ident" id="3736653">Min</span><span class="op" id="3736656">.</span><span class="ident" id="3736657">X</span><span class="op" id="3736658">)</span><span class="op" id="3736659">*</span><span class="num" id="3736660">1</span><br>
<span class="lineno"></span><span class="op" id="3736662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3736665">func</span>&nbsp;<span class="op" id="3736670">(</span><span class="ident" id="3736671">p</span>&nbsp;<span class="op" id="3736673">*</span><span class="ident" id="3736674">Alpha</span><span class="op" id="3736679">)</span>&nbsp;<span class="ident" id="3736681">Set</span><span class="op" id="3736684">(</span><span class="ident" id="3736685">x</span><span class="op" id="3736686">,</span>&nbsp;<span class="ident" id="3736688">y</span>&nbsp;<span class="builtintype" id="3736690">int</span><span class="op" id="3736693">,</span>&nbsp;<span class="ident" id="3736695">c</span>&nbsp;<span class="ident" id="3736697">color</span><span class="op" id="3736702">.</span><span class="ident" id="3736703">Color</span><span class="op" id="3736708">)</span>&nbsp;<span class="op" id="3736710">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3736713">if</span>&nbsp;<span class="op" id="3736716">!</span><span class="op" id="3736717">(</span><span class="ident" id="3736718">Point</span><span class="op" id="3736723">{</span><span class="ident" id="3736724">x</span><span class="op" id="3736725">,</span>&nbsp;<span class="ident" id="3736727">y</span><span class="op" id="3736728">}</span><span class="op" id="3736729">.</span><span class="ident" id="3736730">In</span><span class="op" id="3736732">(</span><span class="ident" id="3736733">p</span><span class="op" id="3736734">.</span><span class="ident" id="3736735">Rect</span><span class="op" id="3736739">)</span><span class="op" id="3736740">)</span>&nbsp;<span class="op" id="3736742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3736746">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3736754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3736757">i</span>&nbsp;<span class="op" id="3736759">:=</span>&nbsp;<span class="ident" id="3736762">p</span><span class="op" id="3736763">.</span><span class="ident" id="3736764">PixOffset</span><span class="op" id="3736773">(</span><span class="ident" id="3736774">x</span><span class="op" id="3736775">,</span>&nbsp;<span class="ident" id="3736777">y</span><span class="op" id="3736778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3736781">p</span><span class="op" id="3736782">.</span><span class="ident" id="3736783">Pix</span><span class="op" id="3736786">[</span><span class="ident" id="3736787">i</span><span class="op" id="3736788">]</span>&nbsp;<span class="op" id="3736790">=</span>&nbsp;<span class="ident" id="3736792">color</span><span class="op" id="3736797">.</span><span class="ident" id="3736798">AlphaModel</span><span class="op" id="3736808">.</span><span class="ident" id="3736809">Convert</span><span class="op" id="3736816">(</span><span class="ident" id="3736817">c</span><span class="op" id="3736818">)</span><span class="op" id="3736819">.</span><span class="op" id="3736820">(</span><span class="ident" id="3736821">color</span><span class="op" id="3736826">.</span><span class="ident" id="3736827">Alpha</span><span class="op" id="3736832">)</span><span class="op" id="3736833">.</span><span class="ident" id="3736834">A</span><br>
<span class="lineno">520</span><span class="op" id="3736836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3736839">func</span>&nbsp;<span class="op" id="3736844">(</span><span class="ident" id="3736845">p</span>&nbsp;<span class="op" id="3736847">*</span><span class="ident" id="3736848">Alpha</span><span class="op" id="3736853">)</span>&nbsp;<span class="ident" id="3736855">SetAlpha</span><span class="op" id="3736863">(</span><span class="ident" id="3736864">x</span><span class="op" id="3736865">,</span>&nbsp;<span class="ident" id="3736867">y</span>&nbsp;<span class="builtintype" id="3736869">int</span><span class="op" id="3736872">,</span>&nbsp;<span class="ident" id="3736874">c</span>&nbsp;<span class="ident" id="3736876">color</span><span class="op" id="3736881">.</span><span class="ident" id="3736882">Alpha</span><span class="op" id="3736887">)</span>&nbsp;<span class="op" id="3736889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3736892">if</span>&nbsp;<span class="op" id="3736895">!</span><span class="op" id="3736896">(</span><span class="ident" id="3736897">Point</span><span class="op" id="3736902">{</span><span class="ident" id="3736903">x</span><span class="op" id="3736904">,</span>&nbsp;<span class="ident" id="3736906">y</span><span class="op" id="3736907">}</span><span class="op" id="3736908">.</span><span class="ident" id="3736909">In</span><span class="op" id="3736911">(</span><span class="ident" id="3736912">p</span><span class="op" id="3736913">.</span><span class="ident" id="3736914">Rect</span><span class="op" id="3736918">)</span><span class="op" id="3736919">)</span>&nbsp;<span class="op" id="3736921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3736925">return</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3736933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3736936">i</span>&nbsp;<span class="op" id="3736938">:=</span>&nbsp;<span class="ident" id="3736941">p</span><span class="op" id="3736942">.</span><span class="ident" id="3736943">PixOffset</span><span class="op" id="3736952">(</span><span class="ident" id="3736953">x</span><span class="op" id="3736954">,</span>&nbsp;<span class="ident" id="3736956">y</span><span class="op" id="3736957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3736960">p</span><span class="op" id="3736961">.</span><span class="ident" id="3736962">Pix</span><span class="op" id="3736965">[</span><span class="ident" id="3736966">i</span><span class="op" id="3736967">]</span>&nbsp;<span class="op" id="3736969">=</span>&nbsp;<span class="ident" id="3736971">c</span><span class="op" id="3736972">.</span><span class="ident" id="3736973">A</span><br>
<span class="lineno"></span><span class="op" id="3736975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="3736978">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="3737055">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="3737127">func</span>&nbsp;<span class="op" id="3737132">(</span><span class="ident" id="3737133">p</span>&nbsp;<span class="op" id="3737135">*</span><span class="ident" id="3737136">Alpha</span><span class="op" id="3737141">)</span>&nbsp;<span class="ident" id="3737143">SubImage</span><span class="op" id="3737151">(</span><span class="ident" id="3737152">r</span>&nbsp;<span class="ident" id="3737154">Rectangle</span><span class="op" id="3737163">)</span>&nbsp;<span class="ident" id="3737165">Image</span>&nbsp;<span class="op" id="3737171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3737174">r</span>&nbsp;<span class="op" id="3737176">=</span>&nbsp;<span class="ident" id="3737178">r</span><span class="op" id="3737179">.</span><span class="ident" id="3737180">Intersect</span><span class="op" id="3737189">(</span><span class="ident" id="3737190">p</span><span class="op" id="3737191">.</span><span class="ident" id="3737192">Rect</span><span class="op" id="3737196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3737199">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3737280">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3737362">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737412">if</span>&nbsp;<span class="ident" id="3737415">r</span><span class="op" id="3737416">.</span><span class="ident" id="3737417">Empty</span><span class="op" id="3737422">(</span><span class="op" id="3737423">)</span>&nbsp;<span class="op" id="3737425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737429">return</span>&nbsp;<span class="op" id="3737436">&amp;</span><span class="ident" id="3737437">Alpha</span><span class="op" id="3737442">{</span><span class="op" id="3737443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3737446">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3737449">i</span>&nbsp;<span class="op" id="3737451">:=</span>&nbsp;<span class="ident" id="3737454">p</span><span class="op" id="3737455">.</span><span class="ident" id="3737456">PixOffset</span><span class="op" id="3737465">(</span><span class="ident" id="3737466">r</span><span class="op" id="3737467">.</span><span class="ident" id="3737468">Min</span><span class="op" id="3737471">.</span><span class="ident" id="3737472">X</span><span class="op" id="3737473">,</span>&nbsp;<span class="ident" id="3737475">r</span><span class="op" id="3737476">.</span><span class="ident" id="3737477">Min</span><span class="op" id="3737480">.</span><span class="ident" id="3737481">Y</span><span class="op" id="3737482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737485">return</span>&nbsp;<span class="op" id="3737492">&amp;</span><span class="ident" id="3737493">Alpha</span><span class="op" id="3737498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3737502">Pix</span><span class="op" id="3737505">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3737510">p</span><span class="op" id="3737511">.</span><span class="ident" id="3737512">Pix</span><span class="op" id="3737515">[</span><span class="ident" id="3737516">i</span><span class="op" id="3737517">:</span><span class="op" id="3737518">]</span><span class="op" id="3737519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3737523">Stride</span><span class="op" id="3737529">:</span>&nbsp;<span class="ident" id="3737531">p</span><span class="op" id="3737532">.</span><span class="ident" id="3737533">Stride</span><span class="op" id="3737539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3737543">Rect</span><span class="op" id="3737547">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3737551">r</span><span class="op" id="3737552">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3737555">}</span><br>
<span class="lineno"></span><span class="op" id="3737557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3737560">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="3737633">func</span>&nbsp;<span class="op" id="3737638">(</span><span class="ident" id="3737639">p</span>&nbsp;<span class="op" id="3737641">*</span><span class="ident" id="3737642">Alpha</span><span class="op" id="3737647">)</span>&nbsp;<span class="ident" id="3737649">Opaque</span><span class="op" id="3737655">(</span><span class="op" id="3737656">)</span>&nbsp;<span class="builtintype" id="3737658">bool</span>&nbsp;<span class="op" id="3737663">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737666">if</span>&nbsp;<span class="ident" id="3737669">p</span><span class="op" id="3737670">.</span><span class="ident" id="3737671">Rect</span><span class="op" id="3737675">.</span><span class="ident" id="3737676">Empty</span><span class="op" id="3737681">(</span><span class="op" id="3737682">)</span>&nbsp;<span class="op" id="3737684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737688">return</span>&nbsp;<span class="builtintype" id="3737695">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3737701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3737704">i0</span><span class="op" id="3737706">,</span>&nbsp;<span class="ident" id="3737708">i1</span>&nbsp;<span class="op" id="3737711">:=</span>&nbsp;<span class="num" id="3737714">0</span><span class="op" id="3737715">,</span>&nbsp;<span class="ident" id="3737717">p</span><span class="op" id="3737718">.</span><span class="ident" id="3737719">Rect</span><span class="op" id="3737723">.</span><span class="ident" id="3737724">Dx</span><span class="op" id="3737726">(</span><span class="op" id="3737727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737730">for</span>&nbsp;<span class="ident" id="3737734">y</span>&nbsp;<span class="op" id="3737736">:=</span>&nbsp;<span class="ident" id="3737739">p</span><span class="op" id="3737740">.</span><span class="ident" id="3737741">Rect</span><span class="op" id="3737745">.</span><span class="ident" id="3737746">Min</span><span class="op" id="3737749">.</span><span class="ident" id="3737750">Y</span><span class="op" id="3737751">;</span>&nbsp;<span class="ident" id="3737753">y</span>&nbsp;<span class="op" id="3737755">&lt;</span>&nbsp;<span class="ident" id="3737757">p</span><span class="op" id="3737758">.</span><span class="ident" id="3737759">Rect</span><span class="op" id="3737763">.</span><span class="ident" id="3737764">Max</span><span class="op" id="3737767">.</span><span class="ident" id="3737768">Y</span><span class="op" id="3737769">;</span>&nbsp;<span class="ident" id="3737771">y</span><span class="op" id="3737772">++</span>&nbsp;<span class="op" id="3737775">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737779">for</span>&nbsp;<span class="ident" id="3737783">i</span>&nbsp;<span class="op" id="3737785">:=</span>&nbsp;<span class="ident" id="3737788">i0</span><span class="op" id="3737790">;</span>&nbsp;<span class="ident" id="3737792">i</span>&nbsp;<span class="op" id="3737794">&lt;</span>&nbsp;<span class="ident" id="3737796">i1</span><span class="op" id="3737798">;</span>&nbsp;<span class="ident" id="3737800">i</span><span class="op" id="3737801">++</span>&nbsp;<span class="op" id="3737804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737809">if</span>&nbsp;<span class="ident" id="3737812">p</span><span class="op" id="3737813">.</span><span class="ident" id="3737814">Pix</span><span class="op" id="3737817">[</span><span class="ident" id="3737818">i</span><span class="op" id="3737819">]</span>&nbsp;<span class="op" id="3737821">!=</span>&nbsp;<span class="num" id="3737824">0xff</span>&nbsp;<span class="op" id="3737829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737835">return</span>&nbsp;<span class="builtintype" id="3737842">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3737851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3737855">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3737859">i0</span>&nbsp;<span class="op" id="3737862">+=</span>&nbsp;<span class="ident" id="3737865">p</span><span class="op" id="3737866">.</span><span class="ident" id="3737867">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3737876">i1</span>&nbsp;<span class="op" id="3737879">+=</span>&nbsp;<span class="ident" id="3737882">p</span><span class="op" id="3737883">.</span><span class="ident" id="3737884">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3737892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3737895">return</span>&nbsp;<span class="builtintype" id="3737902">true</span><br>
<span class="lineno"></span><span class="op" id="3737907">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="3737910">//&nbsp;NewAlpha&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="3737965">func</span>&nbsp;<span class="ident" id="3737970">NewAlpha</span><span class="op" id="3737978">(</span><span class="ident" id="3737979">r</span>&nbsp;<span class="ident" id="3737981">Rectangle</span><span class="op" id="3737990">)</span>&nbsp;<span class="op" id="3737992">*</span><span class="ident" id="3737993">Alpha</span>&nbsp;<span class="op" id="3737999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3738002">w</span><span class="op" id="3738003">,</span>&nbsp;<span class="ident" id="3738005">h</span>&nbsp;<span class="op" id="3738007">:=</span>&nbsp;<span class="ident" id="3738010">r</span><span class="op" id="3738011">.</span><span class="ident" id="3738012">Dx</span><span class="op" id="3738014">(</span><span class="op" id="3738015">)</span><span class="op" id="3738016">,</span>&nbsp;<span class="ident" id="3738018">r</span><span class="op" id="3738019">.</span><span class="ident" id="3738020">Dy</span><span class="op" id="3738022">(</span><span class="op" id="3738023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3738026">pix</span>&nbsp;<span class="op" id="3738030">:=</span>&nbsp;<span class="builtinfunc" id="3738033">make</span><span class="op" id="3738037">(</span><span class="op" id="3738038">[</span><span class="op" id="3738039">]</span><span class="builtintype" id="3738040">uint8</span><span class="op" id="3738045">,</span>&nbsp;<span class="num" id="3738047">1</span><span class="op" id="3738048">*</span><span class="ident" id="3738049">w</span><span class="op" id="3738050">*</span><span class="ident" id="3738051">h</span><span class="op" id="3738052">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3738055">return</span>&nbsp;<span class="op" id="3738062">&amp;</span><span class="ident" id="3738063">Alpha</span><span class="op" id="3738068">{</span><span class="ident" id="3738069">pix</span><span class="op" id="3738072">,</span>&nbsp;<span class="num" id="3738074">1</span>&nbsp;<span class="op" id="3738076">*</span>&nbsp;<span class="ident" id="3738078">w</span><span class="op" id="3738079">,</span>&nbsp;<span class="ident" id="3738081">r</span><span class="op" id="3738082">}</span><br>
<span class="lineno"></span><span class="op" id="3738084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3738087">//&nbsp;Alpha16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3738166">type</span>&nbsp;<span class="ident" id="3738171">Alpha16</span>&nbsp;<span class="keyword" id="3738179">struct</span>&nbsp;<span class="op" id="3738186">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3738189">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3738274">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3738342">Pix</span>&nbsp;<span class="op" id="3738346">[</span><span class="op" id="3738347">]</span><span class="builtintype" id="3738348">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3738355">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3738431">Stride</span>&nbsp;<span class="builtintype" id="3738438">int</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3738443">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3738475">Rect</span>&nbsp;<span class="ident" id="3738480">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="3738490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3738493">func</span>&nbsp;<span class="op" id="3738498">(</span><span class="ident" id="3738499">p</span>&nbsp;<span class="op" id="3738501">*</span><span class="ident" id="3738502">Alpha16</span><span class="op" id="3738509">)</span>&nbsp;<span class="ident" id="3738511">ColorModel</span><span class="op" id="3738521">(</span><span class="op" id="3738522">)</span>&nbsp;<span class="ident" id="3738524">color</span><span class="op" id="3738529">.</span><span class="ident" id="3738530">Model</span>&nbsp;<span class="op" id="3738536">{</span>&nbsp;<span class="keyword" id="3738538">return</span>&nbsp;<span class="ident" id="3738545">color</span><span class="op" id="3738550">.</span><span class="ident" id="3738551">Alpha16Model</span>&nbsp;<span class="op" id="3738564">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="keyword" id="3738567">func</span>&nbsp;<span class="op" id="3738572">(</span><span class="ident" id="3738573">p</span>&nbsp;<span class="op" id="3738575">*</span><span class="ident" id="3738576">Alpha16</span><span class="op" id="3738583">)</span>&nbsp;<span class="ident" id="3738585">Bounds</span><span class="op" id="3738591">(</span><span class="op" id="3738592">)</span>&nbsp;<span class="ident" id="3738594">Rectangle</span>&nbsp;<span class="op" id="3738604">{</span>&nbsp;<span class="keyword" id="3738606">return</span>&nbsp;<span class="ident" id="3738613">p</span><span class="op" id="3738614">.</span><span class="ident" id="3738615">Rect</span>&nbsp;<span class="op" id="3738620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3738623">func</span>&nbsp;<span class="op" id="3738628">(</span><span class="ident" id="3738629">p</span>&nbsp;<span class="op" id="3738631">*</span><span class="ident" id="3738632">Alpha16</span><span class="op" id="3738639">)</span>&nbsp;<span class="ident" id="3738641">At</span><span class="op" id="3738643">(</span><span class="ident" id="3738644">x</span><span class="op" id="3738645">,</span>&nbsp;<span class="ident" id="3738647">y</span>&nbsp;<span class="builtintype" id="3738649">int</span><span class="op" id="3738652">)</span>&nbsp;<span class="ident" id="3738654">color</span><span class="op" id="3738659">.</span><span class="ident" id="3738660">Color</span>&nbsp;<span class="op" id="3738666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3738669">return</span>&nbsp;<span class="ident" id="3738676">p</span><span class="op" id="3738677">.</span><span class="ident" id="3738678">Alpha16At</span><span class="op" id="3738687">(</span><span class="ident" id="3738688">x</span><span class="op" id="3738689">,</span>&nbsp;<span class="ident" id="3738691">y</span><span class="op" id="3738692">)</span><br>
<span class="lineno">590</span><span class="op" id="3738694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3738697">func</span>&nbsp;<span class="op" id="3738702">(</span><span class="ident" id="3738703">p</span>&nbsp;<span class="op" id="3738705">*</span><span class="ident" id="3738706">Alpha16</span><span class="op" id="3738713">)</span>&nbsp;<span class="ident" id="3738715">Alpha16At</span><span class="op" id="3738724">(</span><span class="ident" id="3738725">x</span><span class="op" id="3738726">,</span>&nbsp;<span class="ident" id="3738728">y</span>&nbsp;<span class="builtintype" id="3738730">int</span><span class="op" id="3738733">)</span>&nbsp;<span class="ident" id="3738735">color</span><span class="op" id="3738740">.</span><span class="ident" id="3738741">Alpha16</span>&nbsp;<span class="op" id="3738749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3738752">if</span>&nbsp;<span class="op" id="3738755">!</span><span class="op" id="3738756">(</span><span class="ident" id="3738757">Point</span><span class="op" id="3738762">{</span><span class="ident" id="3738763">x</span><span class="op" id="3738764">,</span>&nbsp;<span class="ident" id="3738766">y</span><span class="op" id="3738767">}</span><span class="op" id="3738768">.</span><span class="ident" id="3738769">In</span><span class="op" id="3738771">(</span><span class="ident" id="3738772">p</span><span class="op" id="3738773">.</span><span class="ident" id="3738774">Rect</span><span class="op" id="3738778">)</span><span class="op" id="3738779">)</span>&nbsp;<span class="op" id="3738781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3738785">return</span>&nbsp;<span class="ident" id="3738792">color</span><span class="op" id="3738797">.</span><span class="ident" id="3738798">Alpha16</span><span class="op" id="3738805">{</span><span class="op" id="3738806">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3738809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3738812">i</span>&nbsp;<span class="op" id="3738814">:=</span>&nbsp;<span class="ident" id="3738817">p</span><span class="op" id="3738818">.</span><span class="ident" id="3738819">PixOffset</span><span class="op" id="3738828">(</span><span class="ident" id="3738829">x</span><span class="op" id="3738830">,</span>&nbsp;<span class="ident" id="3738832">y</span><span class="op" id="3738833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3738836">return</span>&nbsp;<span class="ident" id="3738843">color</span><span class="op" id="3738848">.</span><span class="ident" id="3738849">Alpha16</span><span class="op" id="3738856">{</span><span class="builtintype" id="3738857">uint16</span><span class="op" id="3738863">(</span><span class="ident" id="3738864">p</span><span class="op" id="3738865">.</span><span class="ident" id="3738866">Pix</span><span class="op" id="3738869">[</span><span class="ident" id="3738870">i</span><span class="op" id="3738871">+</span><span class="num" id="3738872">0</span><span class="op" id="3738873">]</span><span class="op" id="3738874">)</span><span class="op" id="3738875">&lt;&lt;</span><span class="num" id="3738877">8</span>&nbsp;<span class="op" id="3738879">|</span>&nbsp;<span class="builtintype" id="3738881">uint16</span><span class="op" id="3738887">(</span><span class="ident" id="3738888">p</span><span class="op" id="3738889">.</span><span class="ident" id="3738890">Pix</span><span class="op" id="3738893">[</span><span class="ident" id="3738894">i</span><span class="op" id="3738895">+</span><span class="num" id="3738896">1</span><span class="op" id="3738897">]</span><span class="op" id="3738898">)</span><span class="op" id="3738899">}</span><br>
<span class="lineno"></span><span class="op" id="3738901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="3738904">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3738983">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="3739007">func</span>&nbsp;<span class="op" id="3739012">(</span><span class="ident" id="3739013">p</span>&nbsp;<span class="op" id="3739015">*</span><span class="ident" id="3739016">Alpha16</span><span class="op" id="3739023">)</span>&nbsp;<span class="ident" id="3739025">PixOffset</span><span class="op" id="3739034">(</span><span class="ident" id="3739035">x</span><span class="op" id="3739036">,</span>&nbsp;<span class="ident" id="3739038">y</span>&nbsp;<span class="builtintype" id="3739040">int</span><span class="op" id="3739043">)</span>&nbsp;<span class="builtintype" id="3739045">int</span>&nbsp;<span class="op" id="3739049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3739052">return</span>&nbsp;<span class="op" id="3739059">(</span><span class="ident" id="3739060">y</span><span class="op" id="3739061">-</span><span class="ident" id="3739062">p</span><span class="op" id="3739063">.</span><span class="ident" id="3739064">Rect</span><span class="op" id="3739068">.</span><span class="ident" id="3739069">Min</span><span class="op" id="3739072">.</span><span class="ident" id="3739073">Y</span><span class="op" id="3739074">)</span><span class="op" id="3739075">*</span><span class="ident" id="3739076">p</span><span class="op" id="3739077">.</span><span class="ident" id="3739078">Stride</span>&nbsp;<span class="op" id="3739085">+</span>&nbsp;<span class="op" id="3739087">(</span><span class="ident" id="3739088">x</span><span class="op" id="3739089">-</span><span class="ident" id="3739090">p</span><span class="op" id="3739091">.</span><span class="ident" id="3739092">Rect</span><span class="op" id="3739096">.</span><span class="ident" id="3739097">Min</span><span class="op" id="3739100">.</span><span class="ident" id="3739101">X</span><span class="op" id="3739102">)</span><span class="op" id="3739103">*</span><span class="num" id="3739104">2</span><br>
<span class="lineno"></span><span class="op" id="3739106">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="keyword" id="3739109">func</span>&nbsp;<span class="op" id="3739114">(</span><span class="ident" id="3739115">p</span>&nbsp;<span class="op" id="3739117">*</span><span class="ident" id="3739118">Alpha16</span><span class="op" id="3739125">)</span>&nbsp;<span class="ident" id="3739127">Set</span><span class="op" id="3739130">(</span><span class="ident" id="3739131">x</span><span class="op" id="3739132">,</span>&nbsp;<span class="ident" id="3739134">y</span>&nbsp;<span class="builtintype" id="3739136">int</span><span class="op" id="3739139">,</span>&nbsp;<span class="ident" id="3739141">c</span>&nbsp;<span class="ident" id="3739143">color</span><span class="op" id="3739148">.</span><span class="ident" id="3739149">Color</span><span class="op" id="3739154">)</span>&nbsp;<span class="op" id="3739156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3739159">if</span>&nbsp;<span class="op" id="3739162">!</span><span class="op" id="3739163">(</span><span class="ident" id="3739164">Point</span><span class="op" id="3739169">{</span><span class="ident" id="3739170">x</span><span class="op" id="3739171">,</span>&nbsp;<span class="ident" id="3739173">y</span><span class="op" id="3739174">}</span><span class="op" id="3739175">.</span><span class="ident" id="3739176">In</span><span class="op" id="3739178">(</span><span class="ident" id="3739179">p</span><span class="op" id="3739180">.</span><span class="ident" id="3739181">Rect</span><span class="op" id="3739185">)</span><span class="op" id="3739186">)</span>&nbsp;<span class="op" id="3739188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3739192">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3739200">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3739203">i</span>&nbsp;<span class="op" id="3739205">:=</span>&nbsp;<span class="ident" id="3739208">p</span><span class="op" id="3739209">.</span><span class="ident" id="3739210">PixOffset</span><span class="op" id="3739219">(</span><span class="ident" id="3739220">x</span><span class="op" id="3739221">,</span>&nbsp;<span class="ident" id="3739223">y</span><span class="op" id="3739224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3739227">c1</span>&nbsp;<span class="op" id="3739230">:=</span>&nbsp;<span class="ident" id="3739233">color</span><span class="op" id="3739238">.</span><span class="ident" id="3739239">Alpha16Model</span><span class="op" id="3739251">.</span><span class="ident" id="3739252">Convert</span><span class="op" id="3739259">(</span><span class="ident" id="3739260">c</span><span class="op" id="3739261">)</span><span class="op" id="3739262">.</span><span class="op" id="3739263">(</span><span class="ident" id="3739264">color</span><span class="op" id="3739269">.</span><span class="ident" id="3739270">Alpha16</span><span class="op" id="3739277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3739280">p</span><span class="op" id="3739281">.</span><span class="ident" id="3739282">Pix</span><span class="op" id="3739285">[</span><span class="ident" id="3739286">i</span><span class="op" id="3739287">+</span><span class="num" id="3739288">0</span><span class="op" id="3739289">]</span>&nbsp;<span class="op" id="3739291">=</span>&nbsp;<span class="builtintype" id="3739293">uint8</span><span class="op" id="3739298">(</span><span class="ident" id="3739299">c1</span><span class="op" id="3739301">.</span><span class="ident" id="3739302">A</span>&nbsp;<span class="op" id="3739304">&gt;&gt;</span>&nbsp;<span class="num" id="3739307">8</span><span class="op" id="3739308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3739311">p</span><span class="op" id="3739312">.</span><span class="ident" id="3739313">Pix</span><span class="op" id="3739316">[</span><span class="ident" id="3739317">i</span><span class="op" id="3739318">+</span><span class="num" id="3739319">1</span><span class="op" id="3739320">]</span>&nbsp;<span class="op" id="3739322">=</span>&nbsp;<span class="builtintype" id="3739324">uint8</span><span class="op" id="3739329">(</span><span class="ident" id="3739330">c1</span><span class="op" id="3739332">.</span><span class="ident" id="3739333">A</span><span class="op" id="3739334">)</span><br>
<span class="lineno"></span><span class="op" id="3739336">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="3739339">func</span>&nbsp;<span class="op" id="3739344">(</span><span class="ident" id="3739345">p</span>&nbsp;<span class="op" id="3739347">*</span><span class="ident" id="3739348">Alpha16</span><span class="op" id="3739355">)</span>&nbsp;<span class="ident" id="3739357">SetAlpha16</span><span class="op" id="3739367">(</span><span class="ident" id="3739368">x</span><span class="op" id="3739369">,</span>&nbsp;<span class="ident" id="3739371">y</span>&nbsp;<span class="builtintype" id="3739373">int</span><span class="op" id="3739376">,</span>&nbsp;<span class="ident" id="3739378">c</span>&nbsp;<span class="ident" id="3739380">color</span><span class="op" id="3739385">.</span><span class="ident" id="3739386">Alpha16</span><span class="op" id="3739393">)</span>&nbsp;<span class="op" id="3739395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3739398">if</span>&nbsp;<span class="op" id="3739401">!</span><span class="op" id="3739402">(</span><span class="ident" id="3739403">Point</span><span class="op" id="3739408">{</span><span class="ident" id="3739409">x</span><span class="op" id="3739410">,</span>&nbsp;<span class="ident" id="3739412">y</span><span class="op" id="3739413">}</span><span class="op" id="3739414">.</span><span class="ident" id="3739415">In</span><span class="op" id="3739417">(</span><span class="ident" id="3739418">p</span><span class="op" id="3739419">.</span><span class="ident" id="3739420">Rect</span><span class="op" id="3739424">)</span><span class="op" id="3739425">)</span>&nbsp;<span class="op" id="3739427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3739431">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3739439">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3739442">i</span>&nbsp;<span class="op" id="3739444">:=</span>&nbsp;<span class="ident" id="3739447">p</span><span class="op" id="3739448">.</span><span class="ident" id="3739449">PixOffset</span><span class="op" id="3739458">(</span><span class="ident" id="3739459">x</span><span class="op" id="3739460">,</span>&nbsp;<span class="ident" id="3739462">y</span><span class="op" id="3739463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3739466">p</span><span class="op" id="3739467">.</span><span class="ident" id="3739468">Pix</span><span class="op" id="3739471">[</span><span class="ident" id="3739472">i</span><span class="op" id="3739473">+</span><span class="num" id="3739474">0</span><span class="op" id="3739475">]</span>&nbsp;<span class="op" id="3739477">=</span>&nbsp;<span class="builtintype" id="3739479">uint8</span><span class="op" id="3739484">(</span><span class="ident" id="3739485">c</span><span class="op" id="3739486">.</span><span class="ident" id="3739487">A</span>&nbsp;<span class="op" id="3739489">&gt;&gt;</span>&nbsp;<span class="num" id="3739492">8</span><span class="op" id="3739493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3739496">p</span><span class="op" id="3739497">.</span><span class="ident" id="3739498">Pix</span><span class="op" id="3739501">[</span><span class="ident" id="3739502">i</span><span class="op" id="3739503">+</span><span class="num" id="3739504">1</span><span class="op" id="3739505">]</span>&nbsp;<span class="op" id="3739507">=</span>&nbsp;<span class="builtintype" id="3739509">uint8</span><span class="op" id="3739514">(</span><span class="ident" id="3739515">c</span><span class="op" id="3739516">.</span><span class="ident" id="3739517">A</span><span class="op" id="3739518">)</span><br>
<span class="lineno"></span><span class="op" id="3739520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="3739523">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="3739600">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="3739672">func</span>&nbsp;<span class="op" id="3739677">(</span><span class="ident" id="3739678">p</span>&nbsp;<span class="op" id="3739680">*</span><span class="ident" id="3739681">Alpha16</span><span class="op" id="3739688">)</span>&nbsp;<span class="ident" id="3739690">SubImage</span><span class="op" id="3739698">(</span><span class="ident" id="3739699">r</span>&nbsp;<span class="ident" id="3739701">Rectangle</span><span class="op" id="3739710">)</span>&nbsp;<span class="ident" id="3739712">Image</span>&nbsp;<span class="op" id="3739718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3739721">r</span>&nbsp;<span class="op" id="3739723">=</span>&nbsp;<span class="ident" id="3739725">r</span><span class="op" id="3739726">.</span><span class="ident" id="3739727">Intersect</span><span class="op" id="3739736">(</span><span class="ident" id="3739737">p</span><span class="op" id="3739738">.</span><span class="ident" id="3739739">Rect</span><span class="op" id="3739743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3739746">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3739827">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3739909">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3739959">if</span>&nbsp;<span class="ident" id="3739962">r</span><span class="op" id="3739963">.</span><span class="ident" id="3739964">Empty</span><span class="op" id="3739969">(</span><span class="op" id="3739970">)</span>&nbsp;<span class="op" id="3739972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3739976">return</span>&nbsp;<span class="op" id="3739983">&amp;</span><span class="ident" id="3739984">Alpha16</span><span class="op" id="3739991">{</span><span class="op" id="3739992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3739995">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3739998">i</span>&nbsp;<span class="op" id="3740000">:=</span>&nbsp;<span class="ident" id="3740003">p</span><span class="op" id="3740004">.</span><span class="ident" id="3740005">PixOffset</span><span class="op" id="3740014">(</span><span class="ident" id="3740015">r</span><span class="op" id="3740016">.</span><span class="ident" id="3740017">Min</span><span class="op" id="3740020">.</span><span class="ident" id="3740021">X</span><span class="op" id="3740022">,</span>&nbsp;<span class="ident" id="3740024">r</span><span class="op" id="3740025">.</span><span class="ident" id="3740026">Min</span><span class="op" id="3740029">.</span><span class="ident" id="3740030">Y</span><span class="op" id="3740031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3740034">return</span>&nbsp;<span class="op" id="3740041">&amp;</span><span class="ident" id="3740042">Alpha16</span><span class="op" id="3740049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3740053">Pix</span><span class="op" id="3740056">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3740061">p</span><span class="op" id="3740062">.</span><span class="ident" id="3740063">Pix</span><span class="op" id="3740066">[</span><span class="ident" id="3740067">i</span><span class="op" id="3740068">:</span><span class="op" id="3740069">]</span><span class="op" id="3740070">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3740074">Stride</span><span class="op" id="3740080">:</span>&nbsp;<span class="ident" id="3740082">p</span><span class="op" id="3740083">.</span><span class="ident" id="3740084">Stride</span><span class="op" id="3740090">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3740094">Rect</span><span class="op" id="3740098">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3740102">r</span><span class="op" id="3740103">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3740106">}</span><br>
<span class="lineno"></span><span class="op" id="3740108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3740111">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="3740184">func</span>&nbsp;<span class="op" id="3740189">(</span><span class="ident" id="3740190">p</span>&nbsp;<span class="op" id="3740192">*</span><span class="ident" id="3740193">Alpha16</span><span class="op" id="3740200">)</span>&nbsp;<span class="ident" id="3740202">Opaque</span><span class="op" id="3740208">(</span><span class="op" id="3740209">)</span>&nbsp;<span class="builtintype" id="3740211">bool</span>&nbsp;<span class="op" id="3740216">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3740219">if</span>&nbsp;<span class="ident" id="3740222">p</span><span class="op" id="3740223">.</span><span class="ident" id="3740224">Rect</span><span class="op" id="3740228">.</span><span class="ident" id="3740229">Empty</span><span class="op" id="3740234">(</span><span class="op" id="3740235">)</span>&nbsp;<span class="op" id="3740237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3740241">return</span>&nbsp;<span class="builtintype" id="3740248">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3740254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3740257">i0</span><span class="op" id="3740259">,</span>&nbsp;<span class="ident" id="3740261">i1</span>&nbsp;<span class="op" id="3740264">:=</span>&nbsp;<span class="num" id="3740267">0</span><span class="op" id="3740268">,</span>&nbsp;<span class="ident" id="3740270">p</span><span class="op" id="3740271">.</span><span class="ident" id="3740272">Rect</span><span class="op" id="3740276">.</span><span class="ident" id="3740277">Dx</span><span class="op" id="3740279">(</span><span class="op" id="3740280">)</span><span class="op" id="3740281">*</span><span class="num" id="3740282">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3740285">for</span>&nbsp;<span class="ident" id="3740289">y</span>&nbsp;<span class="op" id="3740291">:=</span>&nbsp;<span class="ident" id="3740294">p</span><span class="op" id="3740295">.</span><span class="ident" id="3740296">Rect</span><span class="op" id="3740300">.</span><span class="ident" id="3740301">Min</span><span class="op" id="3740304">.</span><span class="ident" id="3740305">Y</span><span class="op" id="3740306">;</span>&nbsp;<span class="ident" id="3740308">y</span>&nbsp;<span class="op" id="3740310">&lt;</span>&nbsp;<span class="ident" id="3740312">p</span><span class="op" id="3740313">.</span><span class="ident" id="3740314">Rect</span><span class="op" id="3740318">.</span><span class="ident" id="3740319">Max</span><span class="op" id="3740322">.</span><span class="ident" id="3740323">Y</span><span class="op" id="3740324">;</span>&nbsp;<span class="ident" id="3740326">y</span><span class="op" id="3740327">++</span>&nbsp;<span class="op" id="3740330">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3740334">for</span>&nbsp;<span class="ident" id="3740338">i</span>&nbsp;<span class="op" id="3740340">:=</span>&nbsp;<span class="ident" id="3740343">i0</span><span class="op" id="3740345">;</span>&nbsp;<span class="ident" id="3740347">i</span>&nbsp;<span class="op" id="3740349">&lt;</span>&nbsp;<span class="ident" id="3740351">i1</span><span class="op" id="3740353">;</span>&nbsp;<span class="ident" id="3740355">i</span>&nbsp;<span class="op" id="3740357">+=</span>&nbsp;<span class="num" id="3740360">2</span>&nbsp;<span class="op" id="3740362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3740367">if</span>&nbsp;<span class="ident" id="3740370">p</span><span class="op" id="3740371">.</span><span class="ident" id="3740372">Pix</span><span class="op" id="3740375">[</span><span class="ident" id="3740376">i</span><span class="op" id="3740377">+</span><span class="num" id="3740378">0</span><span class="op" id="3740379">]</span>&nbsp;<span class="op" id="3740381">!=</span>&nbsp;<span class="num" id="3740384">0xff</span>&nbsp;<span class="op" id="3740389">||</span>&nbsp;<span class="ident" id="3740392">p</span><span class="op" id="3740393">.</span><span class="ident" id="3740394">Pix</span><span class="op" id="3740397">[</span><span class="ident" id="3740398">i</span><span class="op" id="3740399">+</span><span class="num" id="3740400">1</span><span class="op" id="3740401">]</span>&nbsp;<span class="op" id="3740403">!=</span>&nbsp;<span class="num" id="3740406">0xff</span>&nbsp;<span class="op" id="3740411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3740417">return</span>&nbsp;<span class="builtintype" id="3740424">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3740433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3740437">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3740441">i0</span>&nbsp;<span class="op" id="3740444">+=</span>&nbsp;<span class="ident" id="3740447">p</span><span class="op" id="3740448">.</span><span class="ident" id="3740449">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3740458">i1</span>&nbsp;<span class="op" id="3740461">+=</span>&nbsp;<span class="ident" id="3740464">p</span><span class="op" id="3740465">.</span><span class="ident" id="3740466">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3740474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3740477">return</span>&nbsp;<span class="builtintype" id="3740484">true</span><br>
<span class="lineno"></span><span class="op" id="3740489">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="3740492">//&nbsp;NewAlpha16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="3740551">func</span>&nbsp;<span class="ident" id="3740556">NewAlpha16</span><span class="op" id="3740566">(</span><span class="ident" id="3740567">r</span>&nbsp;<span class="ident" id="3740569">Rectangle</span><span class="op" id="3740578">)</span>&nbsp;<span class="op" id="3740580">*</span><span class="ident" id="3740581">Alpha16</span>&nbsp;<span class="op" id="3740589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3740592">w</span><span class="op" id="3740593">,</span>&nbsp;<span class="ident" id="3740595">h</span>&nbsp;<span class="op" id="3740597">:=</span>&nbsp;<span class="ident" id="3740600">r</span><span class="op" id="3740601">.</span><span class="ident" id="3740602">Dx</span><span class="op" id="3740604">(</span><span class="op" id="3740605">)</span><span class="op" id="3740606">,</span>&nbsp;<span class="ident" id="3740608">r</span><span class="op" id="3740609">.</span><span class="ident" id="3740610">Dy</span><span class="op" id="3740612">(</span><span class="op" id="3740613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3740616">pix</span>&nbsp;<span class="op" id="3740620">:=</span>&nbsp;<span class="builtinfunc" id="3740623">make</span><span class="op" id="3740627">(</span><span class="op" id="3740628">[</span><span class="op" id="3740629">]</span><span class="builtintype" id="3740630">uint8</span><span class="op" id="3740635">,</span>&nbsp;<span class="num" id="3740637">2</span><span class="op" id="3740638">*</span><span class="ident" id="3740639">w</span><span class="op" id="3740640">*</span><span class="ident" id="3740641">h</span><span class="op" id="3740642">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3740645">return</span>&nbsp;<span class="op" id="3740652">&amp;</span><span class="ident" id="3740653">Alpha16</span><span class="op" id="3740660">{</span><span class="ident" id="3740661">pix</span><span class="op" id="3740664">,</span>&nbsp;<span class="num" id="3740666">2</span>&nbsp;<span class="op" id="3740668">*</span>&nbsp;<span class="ident" id="3740670">w</span><span class="op" id="3740671">,</span>&nbsp;<span class="ident" id="3740673">r</span><span class="op" id="3740674">}</span><br>
<span class="lineno"></span><span class="op" id="3740676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3740679">//&nbsp;Gray&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3740752">type</span>&nbsp;<span class="ident" id="3740757">Gray</span>&nbsp;<span class="keyword" id="3740762">struct</span>&nbsp;<span class="op" id="3740769">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3740772">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3740835">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3740903">Pix</span>&nbsp;<span class="op" id="3740907">[</span><span class="op" id="3740908">]</span><span class="builtintype" id="3740909">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3740916">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3740992">Stride</span>&nbsp;<span class="builtintype" id="3740999">int</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3741004">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3741036">Rect</span>&nbsp;<span class="ident" id="3741041">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="3741051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3741054">func</span>&nbsp;<span class="op" id="3741059">(</span><span class="ident" id="3741060">p</span>&nbsp;<span class="op" id="3741062">*</span><span class="ident" id="3741063">Gray</span><span class="op" id="3741067">)</span>&nbsp;<span class="ident" id="3741069">ColorModel</span><span class="op" id="3741079">(</span><span class="op" id="3741080">)</span>&nbsp;<span class="ident" id="3741082">color</span><span class="op" id="3741087">.</span><span class="ident" id="3741088">Model</span>&nbsp;<span class="op" id="3741094">{</span>&nbsp;<span class="keyword" id="3741096">return</span>&nbsp;<span class="ident" id="3741103">color</span><span class="op" id="3741108">.</span><span class="ident" id="3741109">GrayModel</span>&nbsp;<span class="op" id="3741119">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="3741122">func</span>&nbsp;<span class="op" id="3741127">(</span><span class="ident" id="3741128">p</span>&nbsp;<span class="op" id="3741130">*</span><span class="ident" id="3741131">Gray</span><span class="op" id="3741135">)</span>&nbsp;<span class="ident" id="3741137">Bounds</span><span class="op" id="3741143">(</span><span class="op" id="3741144">)</span>&nbsp;<span class="ident" id="3741146">Rectangle</span>&nbsp;<span class="op" id="3741156">{</span>&nbsp;<span class="keyword" id="3741158">return</span>&nbsp;<span class="ident" id="3741165">p</span><span class="op" id="3741166">.</span><span class="ident" id="3741167">Rect</span>&nbsp;<span class="op" id="3741172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3741175">func</span>&nbsp;<span class="op" id="3741180">(</span><span class="ident" id="3741181">p</span>&nbsp;<span class="op" id="3741183">*</span><span class="ident" id="3741184">Gray</span><span class="op" id="3741188">)</span>&nbsp;<span class="ident" id="3741190">At</span><span class="op" id="3741192">(</span><span class="ident" id="3741193">x</span><span class="op" id="3741194">,</span>&nbsp;<span class="ident" id="3741196">y</span>&nbsp;<span class="builtintype" id="3741198">int</span><span class="op" id="3741201">)</span>&nbsp;<span class="ident" id="3741203">color</span><span class="op" id="3741208">.</span><span class="ident" id="3741209">Color</span>&nbsp;<span class="op" id="3741215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3741218">return</span>&nbsp;<span class="ident" id="3741225">p</span><span class="op" id="3741226">.</span><span class="ident" id="3741227">GrayAt</span><span class="op" id="3741233">(</span><span class="ident" id="3741234">x</span><span class="op" id="3741235">,</span>&nbsp;<span class="ident" id="3741237">y</span><span class="op" id="3741238">)</span><br>
<span class="lineno">685</span><span class="op" id="3741240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3741243">func</span>&nbsp;<span class="op" id="3741248">(</span><span class="ident" id="3741249">p</span>&nbsp;<span class="op" id="3741251">*</span><span class="ident" id="3741252">Gray</span><span class="op" id="3741256">)</span>&nbsp;<span class="ident" id="3741258">GrayAt</span><span class="op" id="3741264">(</span><span class="ident" id="3741265">x</span><span class="op" id="3741266">,</span>&nbsp;<span class="ident" id="3741268">y</span>&nbsp;<span class="builtintype" id="3741270">int</span><span class="op" id="3741273">)</span>&nbsp;<span class="ident" id="3741275">color</span><span class="op" id="3741280">.</span><span class="ident" id="3741281">Gray</span>&nbsp;<span class="op" id="3741286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3741289">if</span>&nbsp;<span class="op" id="3741292">!</span><span class="op" id="3741293">(</span><span class="ident" id="3741294">Point</span><span class="op" id="3741299">{</span><span class="ident" id="3741300">x</span><span class="op" id="3741301">,</span>&nbsp;<span class="ident" id="3741303">y</span><span class="op" id="3741304">}</span><span class="op" id="3741305">.</span><span class="ident" id="3741306">In</span><span class="op" id="3741308">(</span><span class="ident" id="3741309">p</span><span class="op" id="3741310">.</span><span class="ident" id="3741311">Rect</span><span class="op" id="3741315">)</span><span class="op" id="3741316">)</span>&nbsp;<span class="op" id="3741318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3741322">return</span>&nbsp;<span class="ident" id="3741329">color</span><span class="op" id="3741334">.</span><span class="ident" id="3741335">Gray</span><span class="op" id="3741339">{</span><span class="op" id="3741340">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3741343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3741346">i</span>&nbsp;<span class="op" id="3741348">:=</span>&nbsp;<span class="ident" id="3741351">p</span><span class="op" id="3741352">.</span><span class="ident" id="3741353">PixOffset</span><span class="op" id="3741362">(</span><span class="ident" id="3741363">x</span><span class="op" id="3741364">,</span>&nbsp;<span class="ident" id="3741366">y</span><span class="op" id="3741367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3741370">return</span>&nbsp;<span class="ident" id="3741377">color</span><span class="op" id="3741382">.</span><span class="ident" id="3741383">Gray</span><span class="op" id="3741387">{</span><span class="ident" id="3741388">p</span><span class="op" id="3741389">.</span><span class="ident" id="3741390">Pix</span><span class="op" id="3741393">[</span><span class="ident" id="3741394">i</span><span class="op" id="3741395">]</span><span class="op" id="3741396">}</span><br>
<span class="lineno"></span><span class="op" id="3741398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="3741401">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3741480">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="3741504">func</span>&nbsp;<span class="op" id="3741509">(</span><span class="ident" id="3741510">p</span>&nbsp;<span class="op" id="3741512">*</span><span class="ident" id="3741513">Gray</span><span class="op" id="3741517">)</span>&nbsp;<span class="ident" id="3741519">PixOffset</span><span class="op" id="3741528">(</span><span class="ident" id="3741529">x</span><span class="op" id="3741530">,</span>&nbsp;<span class="ident" id="3741532">y</span>&nbsp;<span class="builtintype" id="3741534">int</span><span class="op" id="3741537">)</span>&nbsp;<span class="builtintype" id="3741539">int</span>&nbsp;<span class="op" id="3741543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3741546">return</span>&nbsp;<span class="op" id="3741553">(</span><span class="ident" id="3741554">y</span><span class="op" id="3741555">-</span><span class="ident" id="3741556">p</span><span class="op" id="3741557">.</span><span class="ident" id="3741558">Rect</span><span class="op" id="3741562">.</span><span class="ident" id="3741563">Min</span><span class="op" id="3741566">.</span><span class="ident" id="3741567">Y</span><span class="op" id="3741568">)</span><span class="op" id="3741569">*</span><span class="ident" id="3741570">p</span><span class="op" id="3741571">.</span><span class="ident" id="3741572">Stride</span>&nbsp;<span class="op" id="3741579">+</span>&nbsp;<span class="op" id="3741581">(</span><span class="ident" id="3741582">x</span><span class="op" id="3741583">-</span><span class="ident" id="3741584">p</span><span class="op" id="3741585">.</span><span class="ident" id="3741586">Rect</span><span class="op" id="3741590">.</span><span class="ident" id="3741591">Min</span><span class="op" id="3741594">.</span><span class="ident" id="3741595">X</span><span class="op" id="3741596">)</span><span class="op" id="3741597">*</span><span class="num" id="3741598">1</span><br>
<span class="lineno"></span><span class="op" id="3741600">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="keyword" id="3741603">func</span>&nbsp;<span class="op" id="3741608">(</span><span class="ident" id="3741609">p</span>&nbsp;<span class="op" id="3741611">*</span><span class="ident" id="3741612">Gray</span><span class="op" id="3741616">)</span>&nbsp;<span class="ident" id="3741618">Set</span><span class="op" id="3741621">(</span><span class="ident" id="3741622">x</span><span class="op" id="3741623">,</span>&nbsp;<span class="ident" id="3741625">y</span>&nbsp;<span class="builtintype" id="3741627">int</span><span class="op" id="3741630">,</span>&nbsp;<span class="ident" id="3741632">c</span>&nbsp;<span class="ident" id="3741634">color</span><span class="op" id="3741639">.</span><span class="ident" id="3741640">Color</span><span class="op" id="3741645">)</span>&nbsp;<span class="op" id="3741647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3741650">if</span>&nbsp;<span class="op" id="3741653">!</span><span class="op" id="3741654">(</span><span class="ident" id="3741655">Point</span><span class="op" id="3741660">{</span><span class="ident" id="3741661">x</span><span class="op" id="3741662">,</span>&nbsp;<span class="ident" id="3741664">y</span><span class="op" id="3741665">}</span><span class="op" id="3741666">.</span><span class="ident" id="3741667">In</span><span class="op" id="3741669">(</span><span class="ident" id="3741670">p</span><span class="op" id="3741671">.</span><span class="ident" id="3741672">Rect</span><span class="op" id="3741676">)</span><span class="op" id="3741677">)</span>&nbsp;<span class="op" id="3741679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3741683">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3741691">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3741694">i</span>&nbsp;<span class="op" id="3741696">:=</span>&nbsp;<span class="ident" id="3741699">p</span><span class="op" id="3741700">.</span><span class="ident" id="3741701">PixOffset</span><span class="op" id="3741710">(</span><span class="ident" id="3741711">x</span><span class="op" id="3741712">,</span>&nbsp;<span class="ident" id="3741714">y</span><span class="op" id="3741715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3741718">p</span><span class="op" id="3741719">.</span><span class="ident" id="3741720">Pix</span><span class="op" id="3741723">[</span><span class="ident" id="3741724">i</span><span class="op" id="3741725">]</span>&nbsp;<span class="op" id="3741727">=</span>&nbsp;<span class="ident" id="3741729">color</span><span class="op" id="3741734">.</span><span class="ident" id="3741735">GrayModel</span><span class="op" id="3741744">.</span><span class="ident" id="3741745">Convert</span><span class="op" id="3741752">(</span><span class="ident" id="3741753">c</span><span class="op" id="3741754">)</span><span class="op" id="3741755">.</span><span class="op" id="3741756">(</span><span class="ident" id="3741757">color</span><span class="op" id="3741762">.</span><span class="ident" id="3741763">Gray</span><span class="op" id="3741767">)</span><span class="op" id="3741768">.</span><span class="ident" id="3741769">Y</span><br>
<span class="lineno"></span><span class="op" id="3741771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3741774">func</span>&nbsp;<span class="op" id="3741779">(</span><span class="ident" id="3741780">p</span>&nbsp;<span class="op" id="3741782">*</span><span class="ident" id="3741783">Gray</span><span class="op" id="3741787">)</span>&nbsp;<span class="ident" id="3741789">SetGray</span><span class="op" id="3741796">(</span><span class="ident" id="3741797">x</span><span class="op" id="3741798">,</span>&nbsp;<span class="ident" id="3741800">y</span>&nbsp;<span class="builtintype" id="3741802">int</span><span class="op" id="3741805">,</span>&nbsp;<span class="ident" id="3741807">c</span>&nbsp;<span class="ident" id="3741809">color</span><span class="op" id="3741814">.</span><span class="ident" id="3741815">Gray</span><span class="op" id="3741819">)</span>&nbsp;<span class="op" id="3741821">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3741824">if</span>&nbsp;<span class="op" id="3741827">!</span><span class="op" id="3741828">(</span><span class="ident" id="3741829">Point</span><span class="op" id="3741834">{</span><span class="ident" id="3741835">x</span><span class="op" id="3741836">,</span>&nbsp;<span class="ident" id="3741838">y</span><span class="op" id="3741839">}</span><span class="op" id="3741840">.</span><span class="ident" id="3741841">In</span><span class="op" id="3741843">(</span><span class="ident" id="3741844">p</span><span class="op" id="3741845">.</span><span class="ident" id="3741846">Rect</span><span class="op" id="3741850">)</span><span class="op" id="3741851">)</span>&nbsp;<span class="op" id="3741853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3741857">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3741865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3741868">i</span>&nbsp;<span class="op" id="3741870">:=</span>&nbsp;<span class="ident" id="3741873">p</span><span class="op" id="3741874">.</span><span class="ident" id="3741875">PixOffset</span><span class="op" id="3741884">(</span><span class="ident" id="3741885">x</span><span class="op" id="3741886">,</span>&nbsp;<span class="ident" id="3741888">y</span><span class="op" id="3741889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3741892">p</span><span class="op" id="3741893">.</span><span class="ident" id="3741894">Pix</span><span class="op" id="3741897">[</span><span class="ident" id="3741898">i</span><span class="op" id="3741899">]</span>&nbsp;<span class="op" id="3741901">=</span>&nbsp;<span class="ident" id="3741903">c</span><span class="op" id="3741904">.</span><span class="ident" id="3741905">Y</span><br>
<span class="lineno">715</span><span class="op" id="3741907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3741910">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="3741987">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="3742059">func</span>&nbsp;<span class="op" id="3742064">(</span><span class="ident" id="3742065">p</span>&nbsp;<span class="op" id="3742067">*</span><span class="ident" id="3742068">Gray</span><span class="op" id="3742072">)</span>&nbsp;<span class="ident" id="3742074">SubImage</span><span class="op" id="3742082">(</span><span class="ident" id="3742083">r</span>&nbsp;<span class="ident" id="3742085">Rectangle</span><span class="op" id="3742094">)</span>&nbsp;<span class="ident" id="3742096">Image</span>&nbsp;<span class="op" id="3742102">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3742105">r</span>&nbsp;<span class="op" id="3742107">=</span>&nbsp;<span class="ident" id="3742109">r</span><span class="op" id="3742110">.</span><span class="ident" id="3742111">Intersect</span><span class="op" id="3742120">(</span><span class="ident" id="3742121">p</span><span class="op" id="3742122">.</span><span class="ident" id="3742123">Rect</span><span class="op" id="3742127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3742130">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3742211">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3742293">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3742343">if</span>&nbsp;<span class="ident" id="3742346">r</span><span class="op" id="3742347">.</span><span class="ident" id="3742348">Empty</span><span class="op" id="3742353">(</span><span class="op" id="3742354">)</span>&nbsp;<span class="op" id="3742356">{</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3742360">return</span>&nbsp;<span class="op" id="3742367">&amp;</span><span class="ident" id="3742368">Gray</span><span class="op" id="3742372">{</span><span class="op" id="3742373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3742376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3742379">i</span>&nbsp;<span class="op" id="3742381">:=</span>&nbsp;<span class="ident" id="3742384">p</span><span class="op" id="3742385">.</span><span class="ident" id="3742386">PixOffset</span><span class="op" id="3742395">(</span><span class="ident" id="3742396">r</span><span class="op" id="3742397">.</span><span class="ident" id="3742398">Min</span><span class="op" id="3742401">.</span><span class="ident" id="3742402">X</span><span class="op" id="3742403">,</span>&nbsp;<span class="ident" id="3742405">r</span><span class="op" id="3742406">.</span><span class="ident" id="3742407">Min</span><span class="op" id="3742410">.</span><span class="ident" id="3742411">Y</span><span class="op" id="3742412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3742415">return</span>&nbsp;<span class="op" id="3742422">&amp;</span><span class="ident" id="3742423">Gray</span><span class="op" id="3742427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3742431">Pix</span><span class="op" id="3742434">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742439">p</span><span class="op" id="3742440">.</span><span class="ident" id="3742441">Pix</span><span class="op" id="3742444">[</span><span class="ident" id="3742445">i</span><span class="op" id="3742446">:</span><span class="op" id="3742447">]</span><span class="op" id="3742448">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3742452">Stride</span><span class="op" id="3742458">:</span>&nbsp;<span class="ident" id="3742460">p</span><span class="op" id="3742461">.</span><span class="ident" id="3742462">Stride</span><span class="op" id="3742468">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3742472">Rect</span><span class="op" id="3742476">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3742480">r</span><span class="op" id="3742481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3742484">}</span><br>
<span class="lineno"></span><span class="op" id="3742486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span><span class="comment" id="3742489">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="3742562">func</span>&nbsp;<span class="op" id="3742567">(</span><span class="ident" id="3742568">p</span>&nbsp;<span class="op" id="3742570">*</span><span class="ident" id="3742571">Gray</span><span class="op" id="3742575">)</span>&nbsp;<span class="ident" id="3742577">Opaque</span><span class="op" id="3742583">(</span><span class="op" id="3742584">)</span>&nbsp;<span class="builtintype" id="3742586">bool</span>&nbsp;<span class="op" id="3742591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3742594">return</span>&nbsp;<span class="builtintype" id="3742601">true</span><br>
<span class="lineno"></span><span class="op" id="3742606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="3742609">//&nbsp;NewGray&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="3742662">func</span>&nbsp;<span class="ident" id="3742667">NewGray</span><span class="op" id="3742674">(</span><span class="ident" id="3742675">r</span>&nbsp;<span class="ident" id="3742677">Rectangle</span><span class="op" id="3742686">)</span>&nbsp;<span class="op" id="3742688">*</span><span class="ident" id="3742689">Gray</span>&nbsp;<span class="op" id="3742694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3742697">w</span><span class="op" id="3742698">,</span>&nbsp;<span class="ident" id="3742700">h</span>&nbsp;<span class="op" id="3742702">:=</span>&nbsp;<span class="ident" id="3742705">r</span><span class="op" id="3742706">.</span><span class="ident" id="3742707">Dx</span><span class="op" id="3742709">(</span><span class="op" id="3742710">)</span><span class="op" id="3742711">,</span>&nbsp;<span class="ident" id="3742713">r</span><span class="op" id="3742714">.</span><span class="ident" id="3742715">Dy</span><span class="op" id="3742717">(</span><span class="op" id="3742718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3742721">pix</span>&nbsp;<span class="op" id="3742725">:=</span>&nbsp;<span class="builtinfunc" id="3742728">make</span><span class="op" id="3742732">(</span><span class="op" id="3742733">[</span><span class="op" id="3742734">]</span><span class="builtintype" id="3742735">uint8</span><span class="op" id="3742740">,</span>&nbsp;<span class="num" id="3742742">1</span><span class="op" id="3742743">*</span><span class="ident" id="3742744">w</span><span class="op" id="3742745">*</span><span class="ident" id="3742746">h</span><span class="op" id="3742747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3742750">return</span>&nbsp;<span class="op" id="3742757">&amp;</span><span class="ident" id="3742758">Gray</span><span class="op" id="3742762">{</span><span class="ident" id="3742763">pix</span><span class="op" id="3742766">,</span>&nbsp;<span class="num" id="3742768">1</span>&nbsp;<span class="op" id="3742770">*</span>&nbsp;<span class="ident" id="3742772">w</span><span class="op" id="3742773">,</span>&nbsp;<span class="ident" id="3742775">r</span><span class="op" id="3742776">}</span><br>
<span class="lineno">745</span><span class="op" id="3742778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3742781">//&nbsp;Gray16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray16&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3742858">type</span>&nbsp;<span class="ident" id="3742863">Gray16</span>&nbsp;<span class="keyword" id="3742870">struct</span>&nbsp;<span class="op" id="3742877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3742880">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3742964">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3743032">Pix</span>&nbsp;<span class="op" id="3743036">[</span><span class="op" id="3743037">]</span><span class="builtintype" id="3743038">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3743045">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3743121">Stride</span>&nbsp;<span class="builtintype" id="3743128">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3743133">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3743165">Rect</span>&nbsp;<span class="ident" id="3743170">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="3743180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3743183">func</span>&nbsp;<span class="op" id="3743188">(</span><span class="ident" id="3743189">p</span>&nbsp;<span class="op" id="3743191">*</span><span class="ident" id="3743192">Gray16</span><span class="op" id="3743198">)</span>&nbsp;<span class="ident" id="3743200">ColorModel</span><span class="op" id="3743210">(</span><span class="op" id="3743211">)</span>&nbsp;<span class="ident" id="3743213">color</span><span class="op" id="3743218">.</span><span class="ident" id="3743219">Model</span>&nbsp;<span class="op" id="3743225">{</span>&nbsp;<span class="keyword" id="3743227">return</span>&nbsp;<span class="ident" id="3743234">color</span><span class="op" id="3743239">.</span><span class="ident" id="3743240">Gray16Model</span>&nbsp;<span class="op" id="3743252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span><span class="keyword" id="3743255">func</span>&nbsp;<span class="op" id="3743260">(</span><span class="ident" id="3743261">p</span>&nbsp;<span class="op" id="3743263">*</span><span class="ident" id="3743264">Gray16</span><span class="op" id="3743270">)</span>&nbsp;<span class="ident" id="3743272">Bounds</span><span class="op" id="3743278">(</span><span class="op" id="3743279">)</span>&nbsp;<span class="ident" id="3743281">Rectangle</span>&nbsp;<span class="op" id="3743291">{</span>&nbsp;<span class="keyword" id="3743293">return</span>&nbsp;<span class="ident" id="3743300">p</span><span class="op" id="3743301">.</span><span class="ident" id="3743302">Rect</span>&nbsp;<span class="op" id="3743307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3743310">func</span>&nbsp;<span class="op" id="3743315">(</span><span class="ident" id="3743316">p</span>&nbsp;<span class="op" id="3743318">*</span><span class="ident" id="3743319">Gray16</span><span class="op" id="3743325">)</span>&nbsp;<span class="ident" id="3743327">At</span><span class="op" id="3743329">(</span><span class="ident" id="3743330">x</span><span class="op" id="3743331">,</span>&nbsp;<span class="ident" id="3743333">y</span>&nbsp;<span class="builtintype" id="3743335">int</span><span class="op" id="3743338">)</span>&nbsp;<span class="ident" id="3743340">color</span><span class="op" id="3743345">.</span><span class="ident" id="3743346">Color</span>&nbsp;<span class="op" id="3743352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3743355">return</span>&nbsp;<span class="ident" id="3743362">p</span><span class="op" id="3743363">.</span><span class="ident" id="3743364">Gray16At</span><span class="op" id="3743372">(</span><span class="ident" id="3743373">x</span><span class="op" id="3743374">,</span>&nbsp;<span class="ident" id="3743376">y</span><span class="op" id="3743377">)</span><br>
<span class="lineno"></span><span class="op" id="3743379">}</span><br>
<span class="lineno">765</span><br>
<span class="lineno"></span><span class="keyword" id="3743382">func</span>&nbsp;<span class="op" id="3743387">(</span><span class="ident" id="3743388">p</span>&nbsp;<span class="op" id="3743390">*</span><span class="ident" id="3743391">Gray16</span><span class="op" id="3743397">)</span>&nbsp;<span class="ident" id="3743399">Gray16At</span><span class="op" id="3743407">(</span><span class="ident" id="3743408">x</span><span class="op" id="3743409">,</span>&nbsp;<span class="ident" id="3743411">y</span>&nbsp;<span class="builtintype" id="3743413">int</span><span class="op" id="3743416">)</span>&nbsp;<span class="ident" id="3743418">color</span><span class="op" id="3743423">.</span><span class="ident" id="3743424">Gray16</span>&nbsp;<span class="op" id="3743431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3743434">if</span>&nbsp;<span class="op" id="3743437">!</span><span class="op" id="3743438">(</span><span class="ident" id="3743439">Point</span><span class="op" id="3743444">{</span><span class="ident" id="3743445">x</span><span class="op" id="3743446">,</span>&nbsp;<span class="ident" id="3743448">y</span><span class="op" id="3743449">}</span><span class="op" id="3743450">.</span><span class="ident" id="3743451">In</span><span class="op" id="3743453">(</span><span class="ident" id="3743454">p</span><span class="op" id="3743455">.</span><span class="ident" id="3743456">Rect</span><span class="op" id="3743460">)</span><span class="op" id="3743461">)</span>&nbsp;<span class="op" id="3743463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3743467">return</span>&nbsp;<span class="ident" id="3743474">color</span><span class="op" id="3743479">.</span><span class="ident" id="3743480">Gray16</span><span class="op" id="3743486">{</span><span class="op" id="3743487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3743490">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3743493">i</span>&nbsp;<span class="op" id="3743495">:=</span>&nbsp;<span class="ident" id="3743498">p</span><span class="op" id="3743499">.</span><span class="ident" id="3743500">PixOffset</span><span class="op" id="3743509">(</span><span class="ident" id="3743510">x</span><span class="op" id="3743511">,</span>&nbsp;<span class="ident" id="3743513">y</span><span class="op" id="3743514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3743517">return</span>&nbsp;<span class="ident" id="3743524">color</span><span class="op" id="3743529">.</span><span class="ident" id="3743530">Gray16</span><span class="op" id="3743536">{</span><span class="builtintype" id="3743537">uint16</span><span class="op" id="3743543">(</span><span class="ident" id="3743544">p</span><span class="op" id="3743545">.</span><span class="ident" id="3743546">Pix</span><span class="op" id="3743549">[</span><span class="ident" id="3743550">i</span><span class="op" id="3743551">+</span><span class="num" id="3743552">0</span><span class="op" id="3743553">]</span><span class="op" id="3743554">)</span><span class="op" id="3743555">&lt;&lt;</span><span class="num" id="3743557">8</span>&nbsp;<span class="op" id="3743559">|</span>&nbsp;<span class="builtintype" id="3743561">uint16</span><span class="op" id="3743567">(</span><span class="ident" id="3743568">p</span><span class="op" id="3743569">.</span><span class="ident" id="3743570">Pix</span><span class="op" id="3743573">[</span><span class="ident" id="3743574">i</span><span class="op" id="3743575">+</span><span class="num" id="3743576">1</span><span class="op" id="3743577">]</span><span class="op" id="3743578">)</span><span class="op" id="3743579">}</span><br>
<span class="lineno"></span><span class="op" id="3743581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3743584">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">775</span><span class="comment" id="3743663">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="3743687">func</span>&nbsp;<span class="op" id="3743692">(</span><span class="ident" id="3743693">p</span>&nbsp;<span class="op" id="3743695">*</span><span class="ident" id="3743696">Gray16</span><span class="op" id="3743702">)</span>&nbsp;<span class="ident" id="3743704">PixOffset</span><span class="op" id="3743713">(</span><span class="ident" id="3743714">x</span><span class="op" id="3743715">,</span>&nbsp;<span class="ident" id="3743717">y</span>&nbsp;<span class="builtintype" id="3743719">int</span><span class="op" id="3743722">)</span>&nbsp;<span class="builtintype" id="3743724">int</span>&nbsp;<span class="op" id="3743728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3743731">return</span>&nbsp;<span class="op" id="3743738">(</span><span class="ident" id="3743739">y</span><span class="op" id="3743740">-</span><span class="ident" id="3743741">p</span><span class="op" id="3743742">.</span><span class="ident" id="3743743">Rect</span><span class="op" id="3743747">.</span><span class="ident" id="3743748">Min</span><span class="op" id="3743751">.</span><span class="ident" id="3743752">Y</span><span class="op" id="3743753">)</span><span class="op" id="3743754">*</span><span class="ident" id="3743755">p</span><span class="op" id="3743756">.</span><span class="ident" id="3743757">Stride</span>&nbsp;<span class="op" id="3743764">+</span>&nbsp;<span class="op" id="3743766">(</span><span class="ident" id="3743767">x</span><span class="op" id="3743768">-</span><span class="ident" id="3743769">p</span><span class="op" id="3743770">.</span><span class="ident" id="3743771">Rect</span><span class="op" id="3743775">.</span><span class="ident" id="3743776">Min</span><span class="op" id="3743779">.</span><span class="ident" id="3743780">X</span><span class="op" id="3743781">)</span><span class="op" id="3743782">*</span><span class="num" id="3743783">2</span><br>
<span class="lineno"></span><span class="op" id="3743785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">780</span><span class="keyword" id="3743788">func</span>&nbsp;<span class="op" id="3743793">(</span><span class="ident" id="3743794">p</span>&nbsp;<span class="op" id="3743796">*</span><span class="ident" id="3743797">Gray16</span><span class="op" id="3743803">)</span>&nbsp;<span class="ident" id="3743805">Set</span><span class="op" id="3743808">(</span><span class="ident" id="3743809">x</span><span class="op" id="3743810">,</span>&nbsp;<span class="ident" id="3743812">y</span>&nbsp;<span class="builtintype" id="3743814">int</span><span class="op" id="3743817">,</span>&nbsp;<span class="ident" id="3743819">c</span>&nbsp;<span class="ident" id="3743821">color</span><span class="op" id="3743826">.</span><span class="ident" id="3743827">Color</span><span class="op" id="3743832">)</span>&nbsp;<span class="op" id="3743834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3743837">if</span>&nbsp;<span class="op" id="3743840">!</span><span class="op" id="3743841">(</span><span class="ident" id="3743842">Point</span><span class="op" id="3743847">{</span><span class="ident" id="3743848">x</span><span class="op" id="3743849">,</span>&nbsp;<span class="ident" id="3743851">y</span><span class="op" id="3743852">}</span><span class="op" id="3743853">.</span><span class="ident" id="3743854">In</span><span class="op" id="3743856">(</span><span class="ident" id="3743857">p</span><span class="op" id="3743858">.</span><span class="ident" id="3743859">Rect</span><span class="op" id="3743863">)</span><span class="op" id="3743864">)</span>&nbsp;<span class="op" id="3743866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3743870">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3743878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3743881">i</span>&nbsp;<span class="op" id="3743883">:=</span>&nbsp;<span class="ident" id="3743886">p</span><span class="op" id="3743887">.</span><span class="ident" id="3743888">PixOffset</span><span class="op" id="3743897">(</span><span class="ident" id="3743898">x</span><span class="op" id="3743899">,</span>&nbsp;<span class="ident" id="3743901">y</span><span class="op" id="3743902">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3743905">c1</span>&nbsp;<span class="op" id="3743908">:=</span>&nbsp;<span class="ident" id="3743911">color</span><span class="op" id="3743916">.</span><span class="ident" id="3743917">Gray16Model</span><span class="op" id="3743928">.</span><span class="ident" id="3743929">Convert</span><span class="op" id="3743936">(</span><span class="ident" id="3743937">c</span><span class="op" id="3743938">)</span><span class="op" id="3743939">.</span><span class="op" id="3743940">(</span><span class="ident" id="3743941">color</span><span class="op" id="3743946">.</span><span class="ident" id="3743947">Gray16</span><span class="op" id="3743953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3743956">p</span><span class="op" id="3743957">.</span><span class="ident" id="3743958">Pix</span><span class="op" id="3743961">[</span><span class="ident" id="3743962">i</span><span class="op" id="3743963">+</span><span class="num" id="3743964">0</span><span class="op" id="3743965">]</span>&nbsp;<span class="op" id="3743967">=</span>&nbsp;<span class="builtintype" id="3743969">uint8</span><span class="op" id="3743974">(</span><span class="ident" id="3743975">c1</span><span class="op" id="3743977">.</span><span class="ident" id="3743978">Y</span>&nbsp;<span class="op" id="3743980">&gt;&gt;</span>&nbsp;<span class="num" id="3743983">8</span><span class="op" id="3743984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3743987">p</span><span class="op" id="3743988">.</span><span class="ident" id="3743989">Pix</span><span class="op" id="3743992">[</span><span class="ident" id="3743993">i</span><span class="op" id="3743994">+</span><span class="num" id="3743995">1</span><span class="op" id="3743996">]</span>&nbsp;<span class="op" id="3743998">=</span>&nbsp;<span class="builtintype" id="3744000">uint8</span><span class="op" id="3744005">(</span><span class="ident" id="3744006">c1</span><span class="op" id="3744008">.</span><span class="ident" id="3744009">Y</span><span class="op" id="3744010">)</span><br>
<span class="lineno"></span><span class="op" id="3744012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span><span class="keyword" id="3744015">func</span>&nbsp;<span class="op" id="3744020">(</span><span class="ident" id="3744021">p</span>&nbsp;<span class="op" id="3744023">*</span><span class="ident" id="3744024">Gray16</span><span class="op" id="3744030">)</span>&nbsp;<span class="ident" id="3744032">SetGray16</span><span class="op" id="3744041">(</span><span class="ident" id="3744042">x</span><span class="op" id="3744043">,</span>&nbsp;<span class="ident" id="3744045">y</span>&nbsp;<span class="builtintype" id="3744047">int</span><span class="op" id="3744050">,</span>&nbsp;<span class="ident" id="3744052">c</span>&nbsp;<span class="ident" id="3744054">color</span><span class="op" id="3744059">.</span><span class="ident" id="3744060">Gray16</span><span class="op" id="3744066">)</span>&nbsp;<span class="op" id="3744068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3744071">if</span>&nbsp;<span class="op" id="3744074">!</span><span class="op" id="3744075">(</span><span class="ident" id="3744076">Point</span><span class="op" id="3744081">{</span><span class="ident" id="3744082">x</span><span class="op" id="3744083">,</span>&nbsp;<span class="ident" id="3744085">y</span><span class="op" id="3744086">}</span><span class="op" id="3744087">.</span><span class="ident" id="3744088">In</span><span class="op" id="3744090">(</span><span class="ident" id="3744091">p</span><span class="op" id="3744092">.</span><span class="ident" id="3744093">Rect</span><span class="op" id="3744097">)</span><span class="op" id="3744098">)</span>&nbsp;<span class="op" id="3744100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3744104">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3744112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3744115">i</span>&nbsp;<span class="op" id="3744117">:=</span>&nbsp;<span class="ident" id="3744120">p</span><span class="op" id="3744121">.</span><span class="ident" id="3744122">PixOffset</span><span class="op" id="3744131">(</span><span class="ident" id="3744132">x</span><span class="op" id="3744133">,</span>&nbsp;<span class="ident" id="3744135">y</span><span class="op" id="3744136">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3744139">p</span><span class="op" id="3744140">.</span><span class="ident" id="3744141">Pix</span><span class="op" id="3744144">[</span><span class="ident" id="3744145">i</span><span class="op" id="3744146">+</span><span class="num" id="3744147">0</span><span class="op" id="3744148">]</span>&nbsp;<span class="op" id="3744150">=</span>&nbsp;<span class="builtintype" id="3744152">uint8</span><span class="op" id="3744157">(</span><span class="ident" id="3744158">c</span><span class="op" id="3744159">.</span><span class="ident" id="3744160">Y</span>&nbsp;<span class="op" id="3744162">&gt;&gt;</span>&nbsp;<span class="num" id="3744165">8</span><span class="op" id="3744166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3744169">p</span><span class="op" id="3744170">.</span><span class="ident" id="3744171">Pix</span><span class="op" id="3744174">[</span><span class="ident" id="3744175">i</span><span class="op" id="3744176">+</span><span class="num" id="3744177">1</span><span class="op" id="3744178">]</span>&nbsp;<span class="op" id="3744180">=</span>&nbsp;<span class="builtintype" id="3744182">uint8</span><span class="op" id="3744187">(</span><span class="ident" id="3744188">c</span><span class="op" id="3744189">.</span><span class="ident" id="3744190">Y</span><span class="op" id="3744191">)</span><br>
<span class="lineno"></span><span class="op" id="3744193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3744196">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno">800</span><span class="comment" id="3744273">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="3744345">func</span>&nbsp;<span class="op" id="3744350">(</span><span class="ident" id="3744351">p</span>&nbsp;<span class="op" id="3744353">*</span><span class="ident" id="3744354">Gray16</span><span class="op" id="3744360">)</span>&nbsp;<span class="ident" id="3744362">SubImage</span><span class="op" id="3744370">(</span><span class="ident" id="3744371">r</span>&nbsp;<span class="ident" id="3744373">Rectangle</span><span class="op" id="3744382">)</span>&nbsp;<span class="ident" id="3744384">Image</span>&nbsp;<span class="op" id="3744390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3744393">r</span>&nbsp;<span class="op" id="3744395">=</span>&nbsp;<span class="ident" id="3744397">r</span><span class="op" id="3744398">.</span><span class="ident" id="3744399">Intersect</span><span class="op" id="3744408">(</span><span class="ident" id="3744409">p</span><span class="op" id="3744410">.</span><span class="ident" id="3744411">Rect</span><span class="op" id="3744415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3744418">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3744499">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3744581">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3744631">if</span>&nbsp;<span class="ident" id="3744634">r</span><span class="op" id="3744635">.</span><span class="ident" id="3744636">Empty</span><span class="op" id="3744641">(</span><span class="op" id="3744642">)</span>&nbsp;<span class="op" id="3744644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3744648">return</span>&nbsp;<span class="op" id="3744655">&amp;</span><span class="ident" id="3744656">Gray16</span><span class="op" id="3744662">{</span><span class="op" id="3744663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3744666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3744669">i</span>&nbsp;<span class="op" id="3744671">:=</span>&nbsp;<span class="ident" id="3744674">p</span><span class="op" id="3744675">.</span><span class="ident" id="3744676">PixOffset</span><span class="op" id="3744685">(</span><span class="ident" id="3744686">r</span><span class="op" id="3744687">.</span><span class="ident" id="3744688">Min</span><span class="op" id="3744691">.</span><span class="ident" id="3744692">X</span><span class="op" id="3744693">,</span>&nbsp;<span class="ident" id="3744695">r</span><span class="op" id="3744696">.</span><span class="ident" id="3744697">Min</span><span class="op" id="3744700">.</span><span class="ident" id="3744701">Y</span><span class="op" id="3744702">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3744705">return</span>&nbsp;<span class="op" id="3744712">&amp;</span><span class="ident" id="3744713">Gray16</span><span class="op" id="3744719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3744723">Pix</span><span class="op" id="3744726">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744731">p</span><span class="op" id="3744732">.</span><span class="ident" id="3744733">Pix</span><span class="op" id="3744736">[</span><span class="ident" id="3744737">i</span><span class="op" id="3744738">:</span><span class="op" id="3744739">]</span><span class="op" id="3744740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3744744">Stride</span><span class="op" id="3744750">:</span>&nbsp;<span class="ident" id="3744752">p</span><span class="op" id="3744753">.</span><span class="ident" id="3744754">Stride</span><span class="op" id="3744760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3744764">Rect</span><span class="op" id="3744768">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3744772">r</span><span class="op" id="3744773">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3744776">}</span><br>
<span class="lineno">815</span><span class="op" id="3744778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3744781">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="3744854">func</span>&nbsp;<span class="op" id="3744859">(</span><span class="ident" id="3744860">p</span>&nbsp;<span class="op" id="3744862">*</span><span class="ident" id="3744863">Gray16</span><span class="op" id="3744869">)</span>&nbsp;<span class="ident" id="3744871">Opaque</span><span class="op" id="3744877">(</span><span class="op" id="3744878">)</span>&nbsp;<span class="builtintype" id="3744880">bool</span>&nbsp;<span class="op" id="3744885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3744888">return</span>&nbsp;<span class="builtintype" id="3744895">true</span><br>
<span class="lineno">820</span><span class="op" id="3744900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3744903">//&nbsp;NewGray16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="3744960">func</span>&nbsp;<span class="ident" id="3744965">NewGray16</span><span class="op" id="3744974">(</span><span class="ident" id="3744975">r</span>&nbsp;<span class="ident" id="3744977">Rectangle</span><span class="op" id="3744986">)</span>&nbsp;<span class="op" id="3744988">*</span><span class="ident" id="3744989">Gray16</span>&nbsp;<span class="op" id="3744996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3744999">w</span><span class="op" id="3745000">,</span>&nbsp;<span class="ident" id="3745002">h</span>&nbsp;<span class="op" id="3745004">:=</span>&nbsp;<span class="ident" id="3745007">r</span><span class="op" id="3745008">.</span><span class="ident" id="3745009">Dx</span><span class="op" id="3745011">(</span><span class="op" id="3745012">)</span><span class="op" id="3745013">,</span>&nbsp;<span class="ident" id="3745015">r</span><span class="op" id="3745016">.</span><span class="ident" id="3745017">Dy</span><span class="op" id="3745019">(</span><span class="op" id="3745020">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3745023">pix</span>&nbsp;<span class="op" id="3745027">:=</span>&nbsp;<span class="builtinfunc" id="3745030">make</span><span class="op" id="3745034">(</span><span class="op" id="3745035">[</span><span class="op" id="3745036">]</span><span class="builtintype" id="3745037">uint8</span><span class="op" id="3745042">,</span>&nbsp;<span class="num" id="3745044">2</span><span class="op" id="3745045">*</span><span class="ident" id="3745046">w</span><span class="op" id="3745047">*</span><span class="ident" id="3745048">h</span><span class="op" id="3745049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3745052">return</span>&nbsp;<span class="op" id="3745059">&amp;</span><span class="ident" id="3745060">Gray16</span><span class="op" id="3745066">{</span><span class="ident" id="3745067">pix</span><span class="op" id="3745070">,</span>&nbsp;<span class="num" id="3745072">2</span>&nbsp;<span class="op" id="3745074">*</span>&nbsp;<span class="ident" id="3745076">w</span><span class="op" id="3745077">,</span>&nbsp;<span class="ident" id="3745079">r</span><span class="op" id="3745080">}</span><br>
<span class="lineno"></span><span class="op" id="3745082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3745085">//&nbsp;Paletted&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;uint8&nbsp;indices&nbsp;into&nbsp;a&nbsp;given&nbsp;palette.</span><br>
<span class="lineno">830</span><span class="keyword" id="3745158">type</span>&nbsp;<span class="ident" id="3745163">Paletted</span>&nbsp;<span class="keyword" id="3745172">struct</span>&nbsp;<span class="op" id="3745179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3745182">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;palette&nbsp;indices.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3745249">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3745317">Pix</span>&nbsp;<span class="op" id="3745321">[</span><span class="op" id="3745322">]</span><span class="builtintype" id="3745323">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3745330">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3745406">Stride</span>&nbsp;<span class="builtintype" id="3745413">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3745418">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3745450">Rect</span>&nbsp;<span class="ident" id="3745455">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3745466">//&nbsp;Palette&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3745502">Palette</span>&nbsp;<span class="ident" id="3745510">color</span><span class="op" id="3745515">.</span><span class="ident" id="3745516">Palette</span><br>
<span class="lineno">840</span><span class="op" id="3745524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3745527">func</span>&nbsp;<span class="op" id="3745532">(</span><span class="ident" id="3745533">p</span>&nbsp;<span class="op" id="3745535">*</span><span class="ident" id="3745536">Paletted</span><span class="op" id="3745544">)</span>&nbsp;<span class="ident" id="3745546">ColorModel</span><span class="op" id="3745556">(</span><span class="op" id="3745557">)</span>&nbsp;<span class="ident" id="3745559">color</span><span class="op" id="3745564">.</span><span class="ident" id="3745565">Model</span>&nbsp;<span class="op" id="3745571">{</span>&nbsp;<span class="keyword" id="3745573">return</span>&nbsp;<span class="ident" id="3745580">p</span><span class="op" id="3745581">.</span><span class="ident" id="3745582">Palette</span>&nbsp;<span class="op" id="3745590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3745593">func</span>&nbsp;<span class="op" id="3745598">(</span><span class="ident" id="3745599">p</span>&nbsp;<span class="op" id="3745601">*</span><span class="ident" id="3745602">Paletted</span><span class="op" id="3745610">)</span>&nbsp;<span class="ident" id="3745612">Bounds</span><span class="op" id="3745618">(</span><span class="op" id="3745619">)</span>&nbsp;<span class="ident" id="3745621">Rectangle</span>&nbsp;<span class="op" id="3745631">{</span>&nbsp;<span class="keyword" id="3745633">return</span>&nbsp;<span class="ident" id="3745640">p</span><span class="op" id="3745641">.</span><span class="ident" id="3745642">Rect</span>&nbsp;<span class="op" id="3745647">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span><span class="keyword" id="3745650">func</span>&nbsp;<span class="op" id="3745655">(</span><span class="ident" id="3745656">p</span>&nbsp;<span class="op" id="3745658">*</span><span class="ident" id="3745659">Paletted</span><span class="op" id="3745667">)</span>&nbsp;<span class="ident" id="3745669">At</span><span class="op" id="3745671">(</span><span class="ident" id="3745672">x</span><span class="op" id="3745673">,</span>&nbsp;<span class="ident" id="3745675">y</span>&nbsp;<span class="builtintype" id="3745677">int</span><span class="op" id="3745680">)</span>&nbsp;<span class="ident" id="3745682">color</span><span class="op" id="3745687">.</span><span class="ident" id="3745688">Color</span>&nbsp;<span class="op" id="3745694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3745697">if</span>&nbsp;<span class="builtinfunc" id="3745700">len</span><span class="op" id="3745703">(</span><span class="ident" id="3745704">p</span><span class="op" id="3745705">.</span><span class="ident" id="3745706">Palette</span><span class="op" id="3745713">)</span>&nbsp;<span class="op" id="3745715">==</span>&nbsp;<span class="num" id="3745718">0</span>&nbsp;<span class="op" id="3745720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3745724">return</span>&nbsp;<span class="ident" id="3745731">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3745736">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3745739">if</span>&nbsp;<span class="op" id="3745742">!</span><span class="op" id="3745743">(</span><span class="ident" id="3745744">Point</span><span class="op" id="3745749">{</span><span class="ident" id="3745750">x</span><span class="op" id="3745751">,</span>&nbsp;<span class="ident" id="3745753">y</span><span class="op" id="3745754">}</span><span class="op" id="3745755">.</span><span class="ident" id="3745756">In</span><span class="op" id="3745758">(</span><span class="ident" id="3745759">p</span><span class="op" id="3745760">.</span><span class="ident" id="3745761">Rect</span><span class="op" id="3745765">)</span><span class="op" id="3745766">)</span>&nbsp;<span class="op" id="3745768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3745772">return</span>&nbsp;<span class="ident" id="3745779">p</span><span class="op" id="3745780">.</span><span class="ident" id="3745781">Palette</span><span class="op" id="3745788">[</span><span class="num" id="3745789">0</span><span class="op" id="3745790">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3745793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3745796">i</span>&nbsp;<span class="op" id="3745798">:=</span>&nbsp;<span class="ident" id="3745801">p</span><span class="op" id="3745802">.</span><span class="ident" id="3745803">PixOffset</span><span class="op" id="3745812">(</span><span class="ident" id="3745813">x</span><span class="op" id="3745814">,</span>&nbsp;<span class="ident" id="3745816">y</span><span class="op" id="3745817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3745820">return</span>&nbsp;<span class="ident" id="3745827">p</span><span class="op" id="3745828">.</span><span class="ident" id="3745829">Palette</span><span class="op" id="3745836">[</span><span class="ident" id="3745837">p</span><span class="op" id="3745838">.</span><span class="ident" id="3745839">Pix</span><span class="op" id="3745842">[</span><span class="ident" id="3745843">i</span><span class="op" id="3745844">]</span><span class="op" id="3745845">]</span><br>
<span class="lineno">855</span><span class="op" id="3745847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3745850">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3745929">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="3745953">func</span>&nbsp;<span class="op" id="3745958">(</span><span class="ident" id="3745959">p</span>&nbsp;<span class="op" id="3745961">*</span><span class="ident" id="3745962">Paletted</span><span class="op" id="3745970">)</span>&nbsp;<span class="ident" id="3745972">PixOffset</span><span class="op" id="3745981">(</span><span class="ident" id="3745982">x</span><span class="op" id="3745983">,</span>&nbsp;<span class="ident" id="3745985">y</span>&nbsp;<span class="builtintype" id="3745987">int</span><span class="op" id="3745990">)</span>&nbsp;<span class="builtintype" id="3745992">int</span>&nbsp;<span class="op" id="3745996">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3745999">return</span>&nbsp;<span class="op" id="3746006">(</span><span class="ident" id="3746007">y</span><span class="op" id="3746008">-</span><span class="ident" id="3746009">p</span><span class="op" id="3746010">.</span><span class="ident" id="3746011">Rect</span><span class="op" id="3746015">.</span><span class="ident" id="3746016">Min</span><span class="op" id="3746019">.</span><span class="ident" id="3746020">Y</span><span class="op" id="3746021">)</span><span class="op" id="3746022">*</span><span class="ident" id="3746023">p</span><span class="op" id="3746024">.</span><span class="ident" id="3746025">Stride</span>&nbsp;<span class="op" id="3746032">+</span>&nbsp;<span class="op" id="3746034">(</span><span class="ident" id="3746035">x</span><span class="op" id="3746036">-</span><span class="ident" id="3746037">p</span><span class="op" id="3746038">.</span><span class="ident" id="3746039">Rect</span><span class="op" id="3746043">.</span><span class="ident" id="3746044">Min</span><span class="op" id="3746047">.</span><span class="ident" id="3746048">X</span><span class="op" id="3746049">)</span><span class="op" id="3746050">*</span><span class="num" id="3746051">1</span><br>
<span class="lineno"></span><span class="op" id="3746053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3746056">func</span>&nbsp;<span class="op" id="3746061">(</span><span class="ident" id="3746062">p</span>&nbsp;<span class="op" id="3746064">*</span><span class="ident" id="3746065">Paletted</span><span class="op" id="3746073">)</span>&nbsp;<span class="ident" id="3746075">Set</span><span class="op" id="3746078">(</span><span class="ident" id="3746079">x</span><span class="op" id="3746080">,</span>&nbsp;<span class="ident" id="3746082">y</span>&nbsp;<span class="builtintype" id="3746084">int</span><span class="op" id="3746087">,</span>&nbsp;<span class="ident" id="3746089">c</span>&nbsp;<span class="ident" id="3746091">color</span><span class="op" id="3746096">.</span><span class="ident" id="3746097">Color</span><span class="op" id="3746102">)</span>&nbsp;<span class="op" id="3746104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3746107">if</span>&nbsp;<span class="op" id="3746110">!</span><span class="op" id="3746111">(</span><span class="ident" id="3746112">Point</span><span class="op" id="3746117">{</span><span class="ident" id="3746118">x</span><span class="op" id="3746119">,</span>&nbsp;<span class="ident" id="3746121">y</span><span class="op" id="3746122">}</span><span class="op" id="3746123">.</span><span class="ident" id="3746124">In</span><span class="op" id="3746126">(</span><span class="ident" id="3746127">p</span><span class="op" id="3746128">.</span><span class="ident" id="3746129">Rect</span><span class="op" id="3746133">)</span><span class="op" id="3746134">)</span>&nbsp;<span class="op" id="3746136">{</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3746140">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3746148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3746151">i</span>&nbsp;<span class="op" id="3746153">:=</span>&nbsp;<span class="ident" id="3746156">p</span><span class="op" id="3746157">.</span><span class="ident" id="3746158">PixOffset</span><span class="op" id="3746167">(</span><span class="ident" id="3746168">x</span><span class="op" id="3746169">,</span>&nbsp;<span class="ident" id="3746171">y</span><span class="op" id="3746172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3746175">p</span><span class="op" id="3746176">.</span><span class="ident" id="3746177">Pix</span><span class="op" id="3746180">[</span><span class="ident" id="3746181">i</span><span class="op" id="3746182">]</span>&nbsp;<span class="op" id="3746184">=</span>&nbsp;<span class="builtintype" id="3746186">uint8</span><span class="op" id="3746191">(</span><span class="ident" id="3746192">p</span><span class="op" id="3746193">.</span><span class="ident" id="3746194">Palette</span><span class="op" id="3746201">.</span><span class="ident" id="3746202">Index</span><span class="op" id="3746207">(</span><span class="ident" id="3746208">c</span><span class="op" id="3746209">)</span><span class="op" id="3746210">)</span><br>
<span class="lineno"></span><span class="op" id="3746212">}</span><br>
<span class="lineno">870</span><br>
<span class="lineno"></span><span class="keyword" id="3746215">func</span>&nbsp;<span class="op" id="3746220">(</span><span class="ident" id="3746221">p</span>&nbsp;<span class="op" id="3746223">*</span><span class="ident" id="3746224">Paletted</span><span class="op" id="3746232">)</span>&nbsp;<span class="ident" id="3746234">ColorIndexAt</span><span class="op" id="3746246">(</span><span class="ident" id="3746247">x</span><span class="op" id="3746248">,</span>&nbsp;<span class="ident" id="3746250">y</span>&nbsp;<span class="builtintype" id="3746252">int</span><span class="op" id="3746255">)</span>&nbsp;<span class="builtintype" id="3746257">uint8</span>&nbsp;<span class="op" id="3746263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3746266">if</span>&nbsp;<span class="op" id="3746269">!</span><span class="op" id="3746270">(</span><span class="ident" id="3746271">Point</span><span class="op" id="3746276">{</span><span class="ident" id="3746277">x</span><span class="op" id="3746278">,</span>&nbsp;<span class="ident" id="3746280">y</span><span class="op" id="3746281">}</span><span class="op" id="3746282">.</span><span class="ident" id="3746283">In</span><span class="op" id="3746285">(</span><span class="ident" id="3746286">p</span><span class="op" id="3746287">.</span><span class="ident" id="3746288">Rect</span><span class="op" id="3746292">)</span><span class="op" id="3746293">)</span>&nbsp;<span class="op" id="3746295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3746299">return</span>&nbsp;<span class="num" id="3746306">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3746309">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3746312">i</span>&nbsp;<span class="op" id="3746314">:=</span>&nbsp;<span class="ident" id="3746317">p</span><span class="op" id="3746318">.</span><span class="ident" id="3746319">PixOffset</span><span class="op" id="3746328">(</span><span class="ident" id="3746329">x</span><span class="op" id="3746330">,</span>&nbsp;<span class="ident" id="3746332">y</span><span class="op" id="3746333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3746336">return</span>&nbsp;<span class="ident" id="3746343">p</span><span class="op" id="3746344">.</span><span class="ident" id="3746345">Pix</span><span class="op" id="3746348">[</span><span class="ident" id="3746349">i</span><span class="op" id="3746350">]</span><br>
<span class="lineno"></span><span class="op" id="3746352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3746355">func</span>&nbsp;<span class="op" id="3746360">(</span><span class="ident" id="3746361">p</span>&nbsp;<span class="op" id="3746363">*</span><span class="ident" id="3746364">Paletted</span><span class="op" id="3746372">)</span>&nbsp;<span class="ident" id="3746374">SetColorIndex</span><span class="op" id="3746387">(</span><span class="ident" id="3746388">x</span><span class="op" id="3746389">,</span>&nbsp;<span class="ident" id="3746391">y</span>&nbsp;<span class="builtintype" id="3746393">int</span><span class="op" id="3746396">,</span>&nbsp;<span class="ident" id="3746398">index</span>&nbsp;<span class="builtintype" id="3746404">uint8</span><span class="op" id="3746409">)</span>&nbsp;<span class="op" id="3746411">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3746414">if</span>&nbsp;<span class="op" id="3746417">!</span><span class="op" id="3746418">(</span><span class="ident" id="3746419">Point</span><span class="op" id="3746424">{</span><span class="ident" id="3746425">x</span><span class="op" id="3746426">,</span>&nbsp;<span class="ident" id="3746428">y</span><span class="op" id="3746429">}</span><span class="op" id="3746430">.</span><span class="ident" id="3746431">In</span><span class="op" id="3746433">(</span><span class="ident" id="3746434">p</span><span class="op" id="3746435">.</span><span class="ident" id="3746436">Rect</span><span class="op" id="3746440">)</span><span class="op" id="3746441">)</span>&nbsp;<span class="op" id="3746443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3746447">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3746455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3746458">i</span>&nbsp;<span class="op" id="3746460">:=</span>&nbsp;<span class="ident" id="3746463">p</span><span class="op" id="3746464">.</span><span class="ident" id="3746465">PixOffset</span><span class="op" id="3746474">(</span><span class="ident" id="3746475">x</span><span class="op" id="3746476">,</span>&nbsp;<span class="ident" id="3746478">y</span><span class="op" id="3746479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3746482">p</span><span class="op" id="3746483">.</span><span class="ident" id="3746484">Pix</span><span class="op" id="3746487">[</span><span class="ident" id="3746488">i</span><span class="op" id="3746489">]</span>&nbsp;<span class="op" id="3746491">=</span>&nbsp;<span class="ident" id="3746493">index</span><br>
<span class="lineno">885</span><span class="op" id="3746499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3746502">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="3746579">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="3746651">func</span>&nbsp;<span class="op" id="3746656">(</span><span class="ident" id="3746657">p</span>&nbsp;<span class="op" id="3746659">*</span><span class="ident" id="3746660">Paletted</span><span class="op" id="3746668">)</span>&nbsp;<span class="ident" id="3746670">SubImage</span><span class="op" id="3746678">(</span><span class="ident" id="3746679">r</span>&nbsp;<span class="ident" id="3746681">Rectangle</span><span class="op" id="3746690">)</span>&nbsp;<span class="ident" id="3746692">Image</span>&nbsp;<span class="op" id="3746698">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3746701">r</span>&nbsp;<span class="op" id="3746703">=</span>&nbsp;<span class="ident" id="3746705">r</span><span class="op" id="3746706">.</span><span class="ident" id="3746707">Intersect</span><span class="op" id="3746716">(</span><span class="ident" id="3746717">p</span><span class="op" id="3746718">.</span><span class="ident" id="3746719">Rect</span><span class="op" id="3746723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3746726">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3746807">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3746889">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3746939">if</span>&nbsp;<span class="ident" id="3746942">r</span><span class="op" id="3746943">.</span><span class="ident" id="3746944">Empty</span><span class="op" id="3746949">(</span><span class="op" id="3746950">)</span>&nbsp;<span class="op" id="3746952">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3746956">return</span>&nbsp;<span class="op" id="3746963">&amp;</span><span class="ident" id="3746964">Paletted</span><span class="op" id="3746972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3746977">Palette</span><span class="op" id="3746984">:</span>&nbsp;<span class="ident" id="3746986">p</span><span class="op" id="3746987">.</span><span class="ident" id="3746988">Palette</span><span class="op" id="3746995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3746999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3747002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3747005">i</span>&nbsp;<span class="op" id="3747007">:=</span>&nbsp;<span class="ident" id="3747010">p</span><span class="op" id="3747011">.</span><span class="ident" id="3747012">PixOffset</span><span class="op" id="3747021">(</span><span class="ident" id="3747022">r</span><span class="op" id="3747023">.</span><span class="ident" id="3747024">Min</span><span class="op" id="3747027">.</span><span class="ident" id="3747028">X</span><span class="op" id="3747029">,</span>&nbsp;<span class="ident" id="3747031">r</span><span class="op" id="3747032">.</span><span class="ident" id="3747033">Min</span><span class="op" id="3747036">.</span><span class="ident" id="3747037">Y</span><span class="op" id="3747038">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3747041">return</span>&nbsp;<span class="op" id="3747048">&amp;</span><span class="ident" id="3747049">Paletted</span><span class="op" id="3747057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3747061">Pix</span><span class="op" id="3747064">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747070">p</span><span class="op" id="3747071">.</span><span class="ident" id="3747072">Pix</span><span class="op" id="3747075">[</span><span class="ident" id="3747076">i</span><span class="op" id="3747077">:</span><span class="op" id="3747078">]</span><span class="op" id="3747079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3747083">Stride</span><span class="op" id="3747089">:</span>&nbsp;&nbsp;<span class="ident" id="3747092">p</span><span class="op" id="3747093">.</span><span class="ident" id="3747094">Stride</span><span class="op" id="3747100">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3747104">Rect</span><span class="op" id="3747108">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747113">p</span><span class="op" id="3747114">.</span><span class="ident" id="3747115">Rect</span><span class="op" id="3747119">.</span><span class="ident" id="3747120">Intersect</span><span class="op" id="3747129">(</span><span class="ident" id="3747130">r</span><span class="op" id="3747131">)</span><span class="op" id="3747132">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3747136">Palette</span><span class="op" id="3747143">:</span>&nbsp;<span class="ident" id="3747145">p</span><span class="op" id="3747146">.</span><span class="ident" id="3747147">Palette</span><span class="op" id="3747154">,</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3747157">}</span><br>
<span class="lineno"></span><span class="op" id="3747159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3747162">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="3747235">func</span>&nbsp;<span class="op" id="3747240">(</span><span class="ident" id="3747241">p</span>&nbsp;<span class="op" id="3747243">*</span><span class="ident" id="3747244">Paletted</span><span class="op" id="3747252">)</span>&nbsp;<span class="ident" id="3747254">Opaque</span><span class="op" id="3747260">(</span><span class="op" id="3747261">)</span>&nbsp;<span class="builtintype" id="3747263">bool</span>&nbsp;<span class="op" id="3747268">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3747271">var</span>&nbsp;<span class="ident" id="3747275">present</span>&nbsp;<span class="op" id="3747283">[</span><span class="num" id="3747284">256</span><span class="op" id="3747287">]</span><span class="builtintype" id="3747288">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3747294">i0</span><span class="op" id="3747296">,</span>&nbsp;<span class="ident" id="3747298">i1</span>&nbsp;<span class="op" id="3747301">:=</span>&nbsp;<span class="num" id="3747304">0</span><span class="op" id="3747305">,</span>&nbsp;<span class="ident" id="3747307">p</span><span class="op" id="3747308">.</span><span class="ident" id="3747309">Rect</span><span class="op" id="3747313">.</span><span class="ident" id="3747314">Dx</span><span class="op" id="3747316">(</span><span class="op" id="3747317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3747320">for</span>&nbsp;<span class="ident" id="3747324">y</span>&nbsp;<span class="op" id="3747326">:=</span>&nbsp;<span class="ident" id="3747329">p</span><span class="op" id="3747330">.</span><span class="ident" id="3747331">Rect</span><span class="op" id="3747335">.</span><span class="ident" id="3747336">Min</span><span class="op" id="3747339">.</span><span class="ident" id="3747340">Y</span><span class="op" id="3747341">;</span>&nbsp;<span class="ident" id="3747343">y</span>&nbsp;<span class="op" id="3747345">&lt;</span>&nbsp;<span class="ident" id="3747347">p</span><span class="op" id="3747348">.</span><span class="ident" id="3747349">Rect</span><span class="op" id="3747353">.</span><span class="ident" id="3747354">Max</span><span class="op" id="3747357">.</span><span class="ident" id="3747358">Y</span><span class="op" id="3747359">;</span>&nbsp;<span class="ident" id="3747361">y</span><span class="op" id="3747362">++</span>&nbsp;<span class="op" id="3747365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3747369">for</span>&nbsp;<span class="ident" id="3747373">_</span><span class="op" id="3747374">,</span>&nbsp;<span class="ident" id="3747376">c</span>&nbsp;<span class="op" id="3747378">:=</span>&nbsp;<span class="keyword" id="3747381">range</span>&nbsp;<span class="ident" id="3747387">p</span><span class="op" id="3747388">.</span><span class="ident" id="3747389">Pix</span><span class="op" id="3747392">[</span><span class="ident" id="3747393">i0</span><span class="op" id="3747395">:</span><span class="ident" id="3747396">i1</span><span class="op" id="3747398">]</span>&nbsp;<span class="op" id="3747400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3747405">present</span><span class="op" id="3747412">[</span><span class="ident" id="3747413">c</span><span class="op" id="3747414">]</span>&nbsp;<span class="op" id="3747416">=</span>&nbsp;<span class="builtintype" id="3747418">true</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3747425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3747429">i0</span>&nbsp;<span class="op" id="3747432">+=</span>&nbsp;<span class="ident" id="3747435">p</span><span class="op" id="3747436">.</span><span class="ident" id="3747437">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3747446">i1</span>&nbsp;<span class="op" id="3747449">+=</span>&nbsp;<span class="ident" id="3747452">p</span><span class="op" id="3747453">.</span><span class="ident" id="3747454">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3747462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3747465">for</span>&nbsp;<span class="ident" id="3747469">i</span><span class="op" id="3747470">,</span>&nbsp;<span class="ident" id="3747472">c</span>&nbsp;<span class="op" id="3747474">:=</span>&nbsp;<span class="keyword" id="3747477">range</span>&nbsp;<span class="ident" id="3747483">p</span><span class="op" id="3747484">.</span><span class="ident" id="3747485">Palette</span>&nbsp;<span class="op" id="3747493">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3747497">if</span>&nbsp;<span class="op" id="3747500">!</span><span class="ident" id="3747501">present</span><span class="op" id="3747508">[</span><span class="ident" id="3747509">i</span><span class="op" id="3747510">]</span>&nbsp;<span class="op" id="3747512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3747517">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3747528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3747532">_</span><span class="op" id="3747533">,</span>&nbsp;<span class="ident" id="3747535">_</span><span class="op" id="3747536">,</span>&nbsp;<span class="ident" id="3747538">_</span><span class="op" id="3747539">,</span>&nbsp;<span class="ident" id="3747541">a</span>&nbsp;<span class="op" id="3747543">:=</span>&nbsp;<span class="ident" id="3747546">c</span><span class="op" id="3747547">.</span><span class="ident" id="3747548">RGBA</span><span class="op" id="3747552">(</span><span class="op" id="3747553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3747557">if</span>&nbsp;<span class="ident" id="3747560">a</span>&nbsp;<span class="op" id="3747562">!=</span>&nbsp;<span class="num" id="3747565">0xffff</span>&nbsp;<span class="op" id="3747572">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3747577">return</span>&nbsp;<span class="builtintype" id="3747584">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3747592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3747595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3747598">return</span>&nbsp;<span class="builtintype" id="3747605">true</span><br>
<span class="lineno"></span><span class="op" id="3747610">}</span><br>
<span class="lineno">930</span><br>
<span class="lineno"></span><span class="comment" id="3747613">//&nbsp;NewPaletted&nbsp;returns&nbsp;a&nbsp;new&nbsp;Paletted&nbsp;with&nbsp;the&nbsp;given&nbsp;width,&nbsp;height&nbsp;and&nbsp;palette.</span><br>
<span class="lineno"></span><span class="keyword" id="3747693">func</span>&nbsp;<span class="ident" id="3747698">NewPaletted</span><span class="op" id="3747709">(</span><span class="ident" id="3747710">r</span>&nbsp;<span class="ident" id="3747712">Rectangle</span><span class="op" id="3747721">,</span>&nbsp;<span class="ident" id="3747723">p</span>&nbsp;<span class="ident" id="3747725">color</span><span class="op" id="3747730">.</span><span class="ident" id="3747731">Palette</span><span class="op" id="3747738">)</span>&nbsp;<span class="op" id="3747740">*</span><span class="ident" id="3747741">Paletted</span>&nbsp;<span class="op" id="3747750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3747753">w</span><span class="op" id="3747754">,</span>&nbsp;<span class="ident" id="3747756">h</span>&nbsp;<span class="op" id="3747758">:=</span>&nbsp;<span class="ident" id="3747761">r</span><span class="op" id="3747762">.</span><span class="ident" id="3747763">Dx</span><span class="op" id="3747765">(</span><span class="op" id="3747766">)</span><span class="op" id="3747767">,</span>&nbsp;<span class="ident" id="3747769">r</span><span class="op" id="3747770">.</span><span class="ident" id="3747771">Dy</span><span class="op" id="3747773">(</span><span class="op" id="3747774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3747777">pix</span>&nbsp;<span class="op" id="3747781">:=</span>&nbsp;<span class="builtinfunc" id="3747784">make</span><span class="op" id="3747788">(</span><span class="op" id="3747789">[</span><span class="op" id="3747790">]</span><span class="builtintype" id="3747791">uint8</span><span class="op" id="3747796">,</span>&nbsp;<span class="num" id="3747798">1</span><span class="op" id="3747799">*</span><span class="ident" id="3747800">w</span><span class="op" id="3747801">*</span><span class="ident" id="3747802">h</span><span class="op" id="3747803">)</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3747806">return</span>&nbsp;<span class="op" id="3747813">&amp;</span><span class="ident" id="3747814">Paletted</span><span class="op" id="3747822">{</span><span class="ident" id="3747823">pix</span><span class="op" id="3747826">,</span>&nbsp;<span class="num" id="3747828">1</span>&nbsp;<span class="op" id="3747830">*</span>&nbsp;<span class="ident" id="3747832">w</span><span class="op" id="3747833">,</span>&nbsp;<span class="ident" id="3747835">r</span><span class="op" id="3747836">,</span>&nbsp;<span class="ident" id="3747838">p</span><span class="op" id="3747839">}</span><br>
<span class="lineno"></span><span class="op" id="3747841">}</span>
</div>
</body>
</html>
