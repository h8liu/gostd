<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html" class="current">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5338864">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5338920">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5338974">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5339025">package</span>&nbsp;<span class="ident" id="5339033">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5339041">import</span>&nbsp;<span class="op" id="5339048">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5339051">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5339059">&#34;strings&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5339070">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5339081">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5339096">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5339099">//&nbsp;An&nbsp;Error&nbsp;describes&nbsp;a&nbsp;failure&nbsp;to&nbsp;parse&nbsp;a&nbsp;regular&nbsp;expression</span><br>
<span class="lineno">15</span><span class="comment" id="5339161">//&nbsp;and&nbsp;gives&nbsp;the&nbsp;offending&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="5339200">type</span>&nbsp;<span class="ident" id="5339205">Error</span>&nbsp;<span class="keyword" id="5339211">struct</span>&nbsp;<span class="op" id="5339218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339221">Code</span>&nbsp;<span class="ident" id="5339226">ErrorCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339237">Expr</span>&nbsp;<span class="builtintype" id="5339242">string</span><br>
<span class="lineno"></span><span class="op" id="5339249">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5339252">func</span>&nbsp;<span class="op" id="5339257">(</span><span class="ident" id="5339258">e</span>&nbsp;<span class="op" id="5339260">*</span><span class="ident" id="5339261">Error</span><span class="op" id="5339266">)</span>&nbsp;<span class="ident" id="5339268">Error</span><span class="op" id="5339273">(</span><span class="op" id="5339274">)</span>&nbsp;<span class="builtintype" id="5339276">string</span>&nbsp;<span class="op" id="5339283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5339286">return</span>&nbsp;<span class="string" id="5339293">&#34;error&nbsp;parsing&nbsp;regexp:&nbsp;&#34;</span>&nbsp;<span class="op" id="5339318">+</span>&nbsp;<span class="ident" id="5339320">e</span><span class="op" id="5339321">.</span><span class="ident" id="5339322">Code</span><span class="op" id="5339326">.</span><span class="ident" id="5339327">String</span><span class="op" id="5339333">(</span><span class="op" id="5339334">)</span>&nbsp;<span class="op" id="5339336">+</span>&nbsp;<span class="string" id="5339338">&#34;:&nbsp;`&#34;</span>&nbsp;<span class="op" id="5339344">+</span>&nbsp;<span class="ident" id="5339346">e</span><span class="op" id="5339347">.</span><span class="ident" id="5339348">Expr</span>&nbsp;<span class="op" id="5339353">+</span>&nbsp;<span class="string" id="5339355">&#34;`&#34;</span><br>
<span class="lineno"></span><span class="op" id="5339359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5339362">//&nbsp;An&nbsp;ErrorCode&nbsp;describes&nbsp;a&nbsp;failure&nbsp;to&nbsp;parse&nbsp;a&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="5339429">type</span>&nbsp;<span class="ident" id="5339434">ErrorCode</span>&nbsp;<span class="builtintype" id="5339444">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5339452">const</span>&nbsp;<span class="op" id="5339458">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5339461">//&nbsp;Unexpected&nbsp;error</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339482">ErrInternalError</span>&nbsp;<span class="ident" id="5339499">ErrorCode</span>&nbsp;<span class="op" id="5339509">=</span>&nbsp;<span class="string" id="5339511">&#34;regexp/syntax:&nbsp;internal&nbsp;error&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5339545">//&nbsp;Parse&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339562">ErrInvalidCharClass</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339587">ErrorCode</span>&nbsp;<span class="op" id="5339597">=</span>&nbsp;<span class="string" id="5339599">&#34;invalid&nbsp;character&nbsp;class&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339626">ErrInvalidCharRange</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339651">ErrorCode</span>&nbsp;<span class="op" id="5339661">=</span>&nbsp;<span class="string" id="5339663">&#34;invalid&nbsp;character&nbsp;class&nbsp;range&#34;</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339696">ErrInvalidEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339721">ErrorCode</span>&nbsp;<span class="op" id="5339731">=</span>&nbsp;<span class="string" id="5339733">&#34;invalid&nbsp;escape&nbsp;sequence&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339760">ErrInvalidNamedCapture</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5339785">ErrorCode</span>&nbsp;<span class="op" id="5339795">=</span>&nbsp;<span class="string" id="5339797">&#34;invalid&nbsp;named&nbsp;capture&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339822">ErrInvalidPerlOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339847">ErrorCode</span>&nbsp;<span class="op" id="5339857">=</span>&nbsp;<span class="string" id="5339859">&#34;invalid&nbsp;or&nbsp;unsupported&nbsp;Perl&nbsp;syntax&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339897">ErrInvalidRepeatOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339922">ErrorCode</span>&nbsp;<span class="op" id="5339932">=</span>&nbsp;<span class="string" id="5339934">&#34;invalid&nbsp;nested&nbsp;repetition&nbsp;operator&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339972">ErrInvalidRepeatSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339997">ErrorCode</span>&nbsp;<span class="op" id="5340007">=</span>&nbsp;<span class="string" id="5340009">&#34;invalid&nbsp;repeat&nbsp;count&#34;</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340033">ErrInvalidUTF8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340058">ErrorCode</span>&nbsp;<span class="op" id="5340068">=</span>&nbsp;<span class="string" id="5340070">&#34;invalid&nbsp;UTF-8&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340087">ErrMissingBracket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340112">ErrorCode</span>&nbsp;<span class="op" id="5340122">=</span>&nbsp;<span class="string" id="5340124">&#34;missing&nbsp;closing&nbsp;]&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340145">ErrMissingParen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340170">ErrorCode</span>&nbsp;<span class="op" id="5340180">=</span>&nbsp;<span class="string" id="5340182">&#34;missing&nbsp;closing&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340203">ErrMissingRepeatArgument</span>&nbsp;<span class="ident" id="5340228">ErrorCode</span>&nbsp;<span class="op" id="5340238">=</span>&nbsp;<span class="string" id="5340240">&#34;missing&nbsp;argument&nbsp;to&nbsp;repetition&nbsp;operator&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340283">ErrTrailingBackslash</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340308">ErrorCode</span>&nbsp;<span class="op" id="5340318">=</span>&nbsp;<span class="string" id="5340320">&#34;trailing&nbsp;backslash&nbsp;at&nbsp;end&nbsp;of&nbsp;expression&#34;</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340363">ErrUnexpectedParen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340388">ErrorCode</span>&nbsp;<span class="op" id="5340398">=</span>&nbsp;<span class="string" id="5340400">&#34;unexpected&nbsp;)&#34;</span><br>
<span class="lineno"></span><span class="op" id="5340415">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5340418">func</span>&nbsp;<span class="op" id="5340423">(</span><span class="ident" id="5340424">e</span>&nbsp;<span class="ident" id="5340426">ErrorCode</span><span class="op" id="5340435">)</span>&nbsp;<span class="ident" id="5340437">String</span><span class="op" id="5340443">(</span><span class="op" id="5340444">)</span>&nbsp;<span class="builtintype" id="5340446">string</span>&nbsp;<span class="op" id="5340453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5340456">return</span>&nbsp;<span class="builtintype" id="5340463">string</span><span class="op" id="5340469">(</span><span class="ident" id="5340470">e</span><span class="op" id="5340471">)</span><br>
<span class="lineno">50</span><span class="op" id="5340473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5340476">//&nbsp;Flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;the&nbsp;parser&nbsp;and&nbsp;record&nbsp;information&nbsp;about&nbsp;regexp&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="5340565">type</span>&nbsp;<span class="ident" id="5340570">Flags</span>&nbsp;<span class="builtintype" id="5340576">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="5340584">const</span>&nbsp;<span class="op" id="5340590">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340593">FoldCase</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340607">Flags</span>&nbsp;<span class="op" id="5340613">=</span>&nbsp;<span class="num" id="5340615">1</span>&nbsp;<span class="op" id="5340617">&lt;&lt;</span>&nbsp;<span class="ident" id="5340620">iota</span>&nbsp;<span class="comment" id="5340625">//&nbsp;case-insensitive&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340652">Literal</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5340684">//&nbsp;treat&nbsp;pattern&nbsp;as&nbsp;literal&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340720">ClassNL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5340752">//&nbsp;allow&nbsp;character&nbsp;classes&nbsp;like&nbsp;[^a-z]&nbsp;and&nbsp;[[:space:]]&nbsp;to&nbsp;match&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340825">DotNL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5340857">//&nbsp;allow&nbsp;.&nbsp;to&nbsp;match&nbsp;newline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340886">OneLine</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5340918">//&nbsp;treat&nbsp;^&nbsp;and&nbsp;$&nbsp;as&nbsp;only&nbsp;matching&nbsp;at&nbsp;beginning&nbsp;and&nbsp;end&nbsp;of&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340982">NonGreedy</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5341014">//&nbsp;make&nbsp;repetition&nbsp;operators&nbsp;default&nbsp;to&nbsp;non-greedy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341066">PerlX</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5341098">//&nbsp;allow&nbsp;Perl&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341124">UnicodeGroups</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5341156">//&nbsp;allow&nbsp;\p{Han},&nbsp;\P{Han}&nbsp;for&nbsp;Unicode&nbsp;group&nbsp;and&nbsp;negation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341214">WasDollar</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5341246">//&nbsp;regexp&nbsp;OpEndText&nbsp;was&nbsp;$,&nbsp;not&nbsp;\z</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341281">Simple</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5341313">//&nbsp;regexp&nbsp;contains&nbsp;no&nbsp;counted&nbsp;repetition</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341356">MatchNL</span>&nbsp;<span class="op" id="5341364">=</span>&nbsp;<span class="ident" id="5341366">ClassNL</span>&nbsp;<span class="op" id="5341374">|</span>&nbsp;<span class="ident" id="5341376">DotNL</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341384">Perl</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5341396">=</span>&nbsp;<span class="ident" id="5341398">ClassNL</span>&nbsp;<span class="op" id="5341406">|</span>&nbsp;<span class="ident" id="5341408">OneLine</span>&nbsp;<span class="op" id="5341416">|</span>&nbsp;<span class="ident" id="5341418">PerlX</span>&nbsp;<span class="op" id="5341424">|</span>&nbsp;<span class="ident" id="5341426">UnicodeGroups</span>&nbsp;<span class="comment" id="5341440">//&nbsp;as&nbsp;close&nbsp;to&nbsp;Perl&nbsp;as&nbsp;possible</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341473">POSIX</span>&nbsp;<span class="ident" id="5341479">Flags</span>&nbsp;<span class="op" id="5341485">=</span>&nbsp;<span class="num" id="5341487">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5341529">//&nbsp;POSIX&nbsp;syntax</span><br>
<span class="lineno"></span><span class="op" id="5341545">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5341548">//&nbsp;Pseudo-ops&nbsp;for&nbsp;parsing&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="5341581">const</span>&nbsp;<span class="op" id="5341587">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341590">opLeftParen</span>&nbsp;<span class="op" id="5341602">=</span>&nbsp;<span class="ident" id="5341604">opPseudo</span>&nbsp;<span class="op" id="5341613">+</span>&nbsp;<span class="ident" id="5341615">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341621">opVerticalBar</span><br>
<span class="lineno"></span><span class="op" id="5341635">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5341638">type</span>&nbsp;<span class="ident" id="5341643">parser</span>&nbsp;<span class="keyword" id="5341650">struct</span>&nbsp;<span class="op" id="5341657">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341660">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341672">Flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5341682">//&nbsp;parse&nbsp;mode&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341703">stack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5341715">[</span><span class="op" id="5341716">]</span><span class="op" id="5341717">*</span><span class="ident" id="5341718">Regexp</span>&nbsp;<span class="comment" id="5341725">//&nbsp;stack&nbsp;of&nbsp;parsed&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341757">free</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5341769">*</span><span class="ident" id="5341770">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341778">numCap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5341790">int</span>&nbsp;<span class="comment" id="5341794">//&nbsp;number&nbsp;of&nbsp;capturing&nbsp;groups&nbsp;seen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341830">wholeRegexp</span>&nbsp;<span class="builtintype" id="5341842">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341850">tmpClass</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5341862">[</span><span class="op" id="5341863">]</span><span class="builtintype" id="5341864">rune</span>&nbsp;<span class="comment" id="5341869">//&nbsp;temporary&nbsp;char&nbsp;class&nbsp;work&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="5341904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5341907">func</span>&nbsp;<span class="op" id="5341912">(</span><span class="ident" id="5341913">p</span>&nbsp;<span class="op" id="5341915">*</span><span class="ident" id="5341916">parser</span><span class="op" id="5341922">)</span>&nbsp;<span class="ident" id="5341924">newRegexp</span><span class="op" id="5341933">(</span><span class="ident" id="5341934">op</span>&nbsp;<span class="ident" id="5341937">Op</span><span class="op" id="5341939">)</span>&nbsp;<span class="op" id="5341941">*</span><span class="ident" id="5341942">Regexp</span>&nbsp;<span class="op" id="5341949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341952">re</span>&nbsp;<span class="op" id="5341955">:=</span>&nbsp;<span class="ident" id="5341958">p</span><span class="op" id="5341959">.</span><span class="ident" id="5341960">free</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5341966">if</span>&nbsp;<span class="ident" id="5341969">re</span>&nbsp;<span class="op" id="5341972">!=</span>&nbsp;<span class="builtintype" id="5341975">nil</span>&nbsp;<span class="op" id="5341979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341983">p</span><span class="op" id="5341984">.</span><span class="ident" id="5341985">free</span>&nbsp;<span class="op" id="5341990">=</span>&nbsp;<span class="ident" id="5341992">re</span><span class="op" id="5341994">.</span><span class="ident" id="5341995">Sub0</span><span class="op" id="5341999">[</span><span class="num" id="5342000">0</span><span class="op" id="5342001">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5342005">*</span><span class="ident" id="5342006">re</span>&nbsp;<span class="op" id="5342009">=</span>&nbsp;<span class="ident" id="5342011">Regexp</span><span class="op" id="5342017">{</span><span class="op" id="5342018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5342021">}</span>&nbsp;<span class="keyword" id="5342023">else</span>&nbsp;<span class="op" id="5342028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342032">re</span>&nbsp;<span class="op" id="5342035">=</span>&nbsp;<span class="builtinfunc" id="5342037">new</span><span class="op" id="5342040">(</span><span class="ident" id="5342041">Regexp</span><span class="op" id="5342047">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5342050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342053">re</span><span class="op" id="5342055">.</span><span class="ident" id="5342056">Op</span>&nbsp;<span class="op" id="5342059">=</span>&nbsp;<span class="ident" id="5342061">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5342065">return</span>&nbsp;<span class="ident" id="5342072">re</span><br>
<span class="lineno"></span><span class="op" id="5342075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="5342078">func</span>&nbsp;<span class="op" id="5342083">(</span><span class="ident" id="5342084">p</span>&nbsp;<span class="op" id="5342086">*</span><span class="ident" id="5342087">parser</span><span class="op" id="5342093">)</span>&nbsp;<span class="ident" id="5342095">reuse</span><span class="op" id="5342100">(</span><span class="ident" id="5342101">re</span>&nbsp;<span class="op" id="5342104">*</span><span class="ident" id="5342105">Regexp</span><span class="op" id="5342111">)</span>&nbsp;<span class="op" id="5342113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342116">re</span><span class="op" id="5342118">.</span><span class="ident" id="5342119">Sub0</span><span class="op" id="5342123">[</span><span class="num" id="5342124">0</span><span class="op" id="5342125">]</span>&nbsp;<span class="op" id="5342127">=</span>&nbsp;<span class="ident" id="5342129">p</span><span class="op" id="5342130">.</span><span class="ident" id="5342131">free</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342137">p</span><span class="op" id="5342138">.</span><span class="ident" id="5342139">free</span>&nbsp;<span class="op" id="5342144">=</span>&nbsp;<span class="ident" id="5342146">re</span><br>
<span class="lineno"></span><span class="op" id="5342149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="5342152">//&nbsp;Parse&nbsp;stack&nbsp;manipulation.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5342182">//&nbsp;push&nbsp;pushes&nbsp;the&nbsp;regexp&nbsp;re&nbsp;onto&nbsp;the&nbsp;parse&nbsp;stack&nbsp;and&nbsp;returns&nbsp;the&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="keyword" id="5342256">func</span>&nbsp;<span class="op" id="5342261">(</span><span class="ident" id="5342262">p</span>&nbsp;<span class="op" id="5342264">*</span><span class="ident" id="5342265">parser</span><span class="op" id="5342271">)</span>&nbsp;<span class="ident" id="5342273">push</span><span class="op" id="5342277">(</span><span class="ident" id="5342278">re</span>&nbsp;<span class="op" id="5342281">*</span><span class="ident" id="5342282">Regexp</span><span class="op" id="5342288">)</span>&nbsp;<span class="op" id="5342290">*</span><span class="ident" id="5342291">Regexp</span>&nbsp;<span class="op" id="5342298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5342301">if</span>&nbsp;<span class="ident" id="5342304">re</span><span class="op" id="5342306">.</span><span class="ident" id="5342307">Op</span>&nbsp;<span class="op" id="5342310">==</span>&nbsp;<span class="ident" id="5342313">OpCharClass</span>&nbsp;<span class="op" id="5342325">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5342328">len</span><span class="op" id="5342331">(</span><span class="ident" id="5342332">re</span><span class="op" id="5342334">.</span><span class="ident" id="5342335">Rune</span><span class="op" id="5342339">)</span>&nbsp;<span class="op" id="5342341">==</span>&nbsp;<span class="num" id="5342344">2</span>&nbsp;<span class="op" id="5342346">&amp;&amp;</span>&nbsp;<span class="ident" id="5342349">re</span><span class="op" id="5342351">.</span><span class="ident" id="5342352">Rune</span><span class="op" id="5342356">[</span><span class="num" id="5342357">0</span><span class="op" id="5342358">]</span>&nbsp;<span class="op" id="5342360">==</span>&nbsp;<span class="ident" id="5342363">re</span><span class="op" id="5342365">.</span><span class="ident" id="5342366">Rune</span><span class="op" id="5342370">[</span><span class="num" id="5342371">1</span><span class="op" id="5342372">]</span>&nbsp;<span class="op" id="5342374">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5342378">//&nbsp;Single&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5342396">if</span>&nbsp;<span class="ident" id="5342399">p</span><span class="op" id="5342400">.</span><span class="ident" id="5342401">maybeConcat</span><span class="op" id="5342412">(</span><span class="ident" id="5342413">re</span><span class="op" id="5342415">.</span><span class="ident" id="5342416">Rune</span><span class="op" id="5342420">[</span><span class="num" id="5342421">0</span><span class="op" id="5342422">]</span><span class="op" id="5342423">,</span>&nbsp;<span class="ident" id="5342425">p</span><span class="op" id="5342426">.</span><span class="ident" id="5342427">flags</span><span class="op" id="5342432">&amp;^</span><span class="ident" id="5342434">FoldCase</span><span class="op" id="5342442">)</span>&nbsp;<span class="op" id="5342444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5342449">return</span>&nbsp;<span class="builtintype" id="5342456">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5342462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342466">re</span><span class="op" id="5342468">.</span><span class="ident" id="5342469">Op</span>&nbsp;<span class="op" id="5342472">=</span>&nbsp;<span class="ident" id="5342474">OpLiteral</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342486">re</span><span class="op" id="5342488">.</span><span class="ident" id="5342489">Rune</span>&nbsp;<span class="op" id="5342494">=</span>&nbsp;<span class="ident" id="5342496">re</span><span class="op" id="5342498">.</span><span class="ident" id="5342499">Rune</span><span class="op" id="5342503">[</span><span class="op" id="5342504">:</span><span class="num" id="5342505">1</span><span class="op" id="5342506">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342510">re</span><span class="op" id="5342512">.</span><span class="ident" id="5342513">Flags</span>&nbsp;<span class="op" id="5342519">=</span>&nbsp;<span class="ident" id="5342521">p</span><span class="op" id="5342522">.</span><span class="ident" id="5342523">flags</span>&nbsp;<span class="op" id="5342529">&amp;^</span>&nbsp;<span class="ident" id="5342532">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5342542">}</span>&nbsp;<span class="keyword" id="5342544">else</span>&nbsp;<span class="keyword" id="5342549">if</span>&nbsp;<span class="ident" id="5342552">re</span><span class="op" id="5342554">.</span><span class="ident" id="5342555">Op</span>&nbsp;<span class="op" id="5342558">==</span>&nbsp;<span class="ident" id="5342561">OpCharClass</span>&nbsp;<span class="op" id="5342573">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5342576">len</span><span class="op" id="5342579">(</span><span class="ident" id="5342580">re</span><span class="op" id="5342582">.</span><span class="ident" id="5342583">Rune</span><span class="op" id="5342587">)</span>&nbsp;<span class="op" id="5342589">==</span>&nbsp;<span class="num" id="5342592">4</span>&nbsp;<span class="op" id="5342594">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342599">re</span><span class="op" id="5342601">.</span><span class="ident" id="5342602">Rune</span><span class="op" id="5342606">[</span><span class="num" id="5342607">0</span><span class="op" id="5342608">]</span>&nbsp;<span class="op" id="5342610">==</span>&nbsp;<span class="ident" id="5342613">re</span><span class="op" id="5342615">.</span><span class="ident" id="5342616">Rune</span><span class="op" id="5342620">[</span><span class="num" id="5342621">1</span><span class="op" id="5342622">]</span>&nbsp;<span class="op" id="5342624">&amp;&amp;</span>&nbsp;<span class="ident" id="5342627">re</span><span class="op" id="5342629">.</span><span class="ident" id="5342630">Rune</span><span class="op" id="5342634">[</span><span class="num" id="5342635">2</span><span class="op" id="5342636">]</span>&nbsp;<span class="op" id="5342638">==</span>&nbsp;<span class="ident" id="5342641">re</span><span class="op" id="5342643">.</span><span class="ident" id="5342644">Rune</span><span class="op" id="5342648">[</span><span class="num" id="5342649">3</span><span class="op" id="5342650">]</span>&nbsp;<span class="op" id="5342652">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342657">unicode</span><span class="op" id="5342664">.</span><span class="ident" id="5342665">SimpleFold</span><span class="op" id="5342675">(</span><span class="ident" id="5342676">re</span><span class="op" id="5342678">.</span><span class="ident" id="5342679">Rune</span><span class="op" id="5342683">[</span><span class="num" id="5342684">0</span><span class="op" id="5342685">]</span><span class="op" id="5342686">)</span>&nbsp;<span class="op" id="5342688">==</span>&nbsp;<span class="ident" id="5342691">re</span><span class="op" id="5342693">.</span><span class="ident" id="5342694">Rune</span><span class="op" id="5342698">[</span><span class="num" id="5342699">2</span><span class="op" id="5342700">]</span>&nbsp;<span class="op" id="5342702">&amp;&amp;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342707">unicode</span><span class="op" id="5342714">.</span><span class="ident" id="5342715">SimpleFold</span><span class="op" id="5342725">(</span><span class="ident" id="5342726">re</span><span class="op" id="5342728">.</span><span class="ident" id="5342729">Rune</span><span class="op" id="5342733">[</span><span class="num" id="5342734">2</span><span class="op" id="5342735">]</span><span class="op" id="5342736">)</span>&nbsp;<span class="op" id="5342738">==</span>&nbsp;<span class="ident" id="5342741">re</span><span class="op" id="5342743">.</span><span class="ident" id="5342744">Rune</span><span class="op" id="5342748">[</span><span class="num" id="5342749">0</span><span class="op" id="5342750">]</span>&nbsp;<span class="op" id="5342752">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342757">re</span><span class="op" id="5342759">.</span><span class="ident" id="5342760">Op</span>&nbsp;<span class="op" id="5342763">==</span>&nbsp;<span class="ident" id="5342766">OpCharClass</span>&nbsp;<span class="op" id="5342778">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5342781">len</span><span class="op" id="5342784">(</span><span class="ident" id="5342785">re</span><span class="op" id="5342787">.</span><span class="ident" id="5342788">Rune</span><span class="op" id="5342792">)</span>&nbsp;<span class="op" id="5342794">==</span>&nbsp;<span class="num" id="5342797">2</span>&nbsp;<span class="op" id="5342799">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342805">re</span><span class="op" id="5342807">.</span><span class="ident" id="5342808">Rune</span><span class="op" id="5342812">[</span><span class="num" id="5342813">0</span><span class="op" id="5342814">]</span><span class="op" id="5342815">+</span><span class="num" id="5342816">1</span>&nbsp;<span class="op" id="5342818">==</span>&nbsp;<span class="ident" id="5342821">re</span><span class="op" id="5342823">.</span><span class="ident" id="5342824">Rune</span><span class="op" id="5342828">[</span><span class="num" id="5342829">1</span><span class="op" id="5342830">]</span>&nbsp;<span class="op" id="5342832">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342838">unicode</span><span class="op" id="5342845">.</span><span class="ident" id="5342846">SimpleFold</span><span class="op" id="5342856">(</span><span class="ident" id="5342857">re</span><span class="op" id="5342859">.</span><span class="ident" id="5342860">Rune</span><span class="op" id="5342864">[</span><span class="num" id="5342865">0</span><span class="op" id="5342866">]</span><span class="op" id="5342867">)</span>&nbsp;<span class="op" id="5342869">==</span>&nbsp;<span class="ident" id="5342872">re</span><span class="op" id="5342874">.</span><span class="ident" id="5342875">Rune</span><span class="op" id="5342879">[</span><span class="num" id="5342880">1</span><span class="op" id="5342881">]</span>&nbsp;<span class="op" id="5342883">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342889">unicode</span><span class="op" id="5342896">.</span><span class="ident" id="5342897">SimpleFold</span><span class="op" id="5342907">(</span><span class="ident" id="5342908">re</span><span class="op" id="5342910">.</span><span class="ident" id="5342911">Rune</span><span class="op" id="5342915">[</span><span class="num" id="5342916">1</span><span class="op" id="5342917">]</span><span class="op" id="5342918">)</span>&nbsp;<span class="op" id="5342920">==</span>&nbsp;<span class="ident" id="5342923">re</span><span class="op" id="5342925">.</span><span class="ident" id="5342926">Rune</span><span class="op" id="5342930">[</span><span class="num" id="5342931">0</span><span class="op" id="5342932">]</span>&nbsp;<span class="op" id="5342934">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5342938">//&nbsp;Case-insensitive&nbsp;rune&nbsp;like&nbsp;[Aa]&nbsp;or&nbsp;[Δδ].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5342986">if</span>&nbsp;<span class="ident" id="5342989">p</span><span class="op" id="5342990">.</span><span class="ident" id="5342991">maybeConcat</span><span class="op" id="5343002">(</span><span class="ident" id="5343003">re</span><span class="op" id="5343005">.</span><span class="ident" id="5343006">Rune</span><span class="op" id="5343010">[</span><span class="num" id="5343011">0</span><span class="op" id="5343012">]</span><span class="op" id="5343013">,</span>&nbsp;<span class="ident" id="5343015">p</span><span class="op" id="5343016">.</span><span class="ident" id="5343017">flags</span><span class="op" id="5343022">|</span><span class="ident" id="5343023">FoldCase</span><span class="op" id="5343031">)</span>&nbsp;<span class="op" id="5343033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5343038">return</span>&nbsp;<span class="builtintype" id="5343045">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5343051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5343056">//&nbsp;Rewrite&nbsp;as&nbsp;(case-insensitive)&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343100">re</span><span class="op" id="5343102">.</span><span class="ident" id="5343103">Op</span>&nbsp;<span class="op" id="5343106">=</span>&nbsp;<span class="ident" id="5343108">OpLiteral</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343120">re</span><span class="op" id="5343122">.</span><span class="ident" id="5343123">Rune</span>&nbsp;<span class="op" id="5343128">=</span>&nbsp;<span class="ident" id="5343130">re</span><span class="op" id="5343132">.</span><span class="ident" id="5343133">Rune</span><span class="op" id="5343137">[</span><span class="op" id="5343138">:</span><span class="num" id="5343139">1</span><span class="op" id="5343140">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343144">re</span><span class="op" id="5343146">.</span><span class="ident" id="5343147">Flags</span>&nbsp;<span class="op" id="5343153">=</span>&nbsp;<span class="ident" id="5343155">p</span><span class="op" id="5343156">.</span><span class="ident" id="5343157">flags</span>&nbsp;<span class="op" id="5343163">|</span>&nbsp;<span class="ident" id="5343165">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5343175">}</span>&nbsp;<span class="keyword" id="5343177">else</span>&nbsp;<span class="op" id="5343182">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5343186">//&nbsp;Incremental&nbsp;concatenation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343218">p</span><span class="op" id="5343219">.</span><span class="ident" id="5343220">maybeConcat</span><span class="op" id="5343231">(</span><span class="op" id="5343232">-</span><span class="num" id="5343233">1</span><span class="op" id="5343234">,</span>&nbsp;<span class="num" id="5343236">0</span><span class="op" id="5343237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5343240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343244">p</span><span class="op" id="5343245">.</span><span class="ident" id="5343246">stack</span>&nbsp;<span class="op" id="5343252">=</span>&nbsp;<span class="builtinfunc" id="5343254">append</span><span class="op" id="5343260">(</span><span class="ident" id="5343261">p</span><span class="op" id="5343262">.</span><span class="ident" id="5343263">stack</span><span class="op" id="5343268">,</span>&nbsp;<span class="ident" id="5343270">re</span><span class="op" id="5343272">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5343275">return</span>&nbsp;<span class="ident" id="5343282">re</span><br>
<span class="lineno"></span><span class="op" id="5343285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5343288">//&nbsp;maybeConcat&nbsp;implements&nbsp;incremental&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="5343340">//&nbsp;of&nbsp;literal&nbsp;runes&nbsp;into&nbsp;string&nbsp;nodes.&nbsp;&nbsp;The&nbsp;parser&nbsp;calls&nbsp;this</span><br>
<span class="lineno">145</span><span class="comment" id="5343402">//&nbsp;before&nbsp;each&nbsp;push,&nbsp;so&nbsp;only&nbsp;the&nbsp;top&nbsp;fragment&nbsp;of&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5343461">//&nbsp;might&nbsp;need&nbsp;processing.&nbsp;&nbsp;Since&nbsp;this&nbsp;is&nbsp;called&nbsp;before&nbsp;a&nbsp;push,</span><br>
<span class="lineno"></span><span class="comment" id="5343524">//&nbsp;the&nbsp;topmost&nbsp;literal&nbsp;is&nbsp;no&nbsp;longer&nbsp;subject&nbsp;to&nbsp;operators&nbsp;like&nbsp;*</span><br>
<span class="lineno"></span><span class="comment" id="5343588">//&nbsp;(Otherwise&nbsp;ab*&nbsp;would&nbsp;turn&nbsp;into&nbsp;(ab)*.)</span><br>
<span class="lineno"></span><span class="comment" id="5343630">//&nbsp;If&nbsp;r&nbsp;&gt;=&nbsp;0&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;node&nbsp;left&nbsp;over,&nbsp;maybeConcat&nbsp;uses&nbsp;it</span><br>
<span class="lineno">150</span><span class="comment" id="5343693">//&nbsp;to&nbsp;push&nbsp;r&nbsp;with&nbsp;the&nbsp;given&nbsp;flags.</span><br>
<span class="lineno"></span><span class="comment" id="5343728">//&nbsp;maybeConcat&nbsp;reports&nbsp;whether&nbsp;r&nbsp;was&nbsp;pushed.</span><br>
<span class="lineno"></span><span class="keyword" id="5343773">func</span>&nbsp;<span class="op" id="5343778">(</span><span class="ident" id="5343779">p</span>&nbsp;<span class="op" id="5343781">*</span><span class="ident" id="5343782">parser</span><span class="op" id="5343788">)</span>&nbsp;<span class="ident" id="5343790">maybeConcat</span><span class="op" id="5343801">(</span><span class="ident" id="5343802">r</span>&nbsp;<span class="builtintype" id="5343804">rune</span><span class="op" id="5343808">,</span>&nbsp;<span class="ident" id="5343810">flags</span>&nbsp;<span class="ident" id="5343816">Flags</span><span class="op" id="5343821">)</span>&nbsp;<span class="builtintype" id="5343823">bool</span>&nbsp;<span class="op" id="5343828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343831">n</span>&nbsp;<span class="op" id="5343833">:=</span>&nbsp;<span class="builtinfunc" id="5343836">len</span><span class="op" id="5343839">(</span><span class="ident" id="5343840">p</span><span class="op" id="5343841">.</span><span class="ident" id="5343842">stack</span><span class="op" id="5343847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5343850">if</span>&nbsp;<span class="ident" id="5343853">n</span>&nbsp;<span class="op" id="5343855">&lt;</span>&nbsp;<span class="num" id="5343857">2</span>&nbsp;<span class="op" id="5343859">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5343863">return</span>&nbsp;<span class="builtintype" id="5343870">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5343877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343881">re1</span>&nbsp;<span class="op" id="5343885">:=</span>&nbsp;<span class="ident" id="5343888">p</span><span class="op" id="5343889">.</span><span class="ident" id="5343890">stack</span><span class="op" id="5343895">[</span><span class="ident" id="5343896">n</span><span class="op" id="5343897">-</span><span class="num" id="5343898">1</span><span class="op" id="5343899">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343902">re2</span>&nbsp;<span class="op" id="5343906">:=</span>&nbsp;<span class="ident" id="5343909">p</span><span class="op" id="5343910">.</span><span class="ident" id="5343911">stack</span><span class="op" id="5343916">[</span><span class="ident" id="5343917">n</span><span class="op" id="5343918">-</span><span class="num" id="5343919">2</span><span class="op" id="5343920">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5343923">if</span>&nbsp;<span class="ident" id="5343926">re1</span><span class="op" id="5343929">.</span><span class="ident" id="5343930">Op</span>&nbsp;<span class="op" id="5343933">!=</span>&nbsp;<span class="ident" id="5343936">OpLiteral</span>&nbsp;<span class="op" id="5343946">||</span>&nbsp;<span class="ident" id="5343949">re2</span><span class="op" id="5343952">.</span><span class="ident" id="5343953">Op</span>&nbsp;<span class="op" id="5343956">!=</span>&nbsp;<span class="ident" id="5343959">OpLiteral</span>&nbsp;<span class="op" id="5343969">||</span>&nbsp;<span class="ident" id="5343972">re1</span><span class="op" id="5343975">.</span><span class="ident" id="5343976">Flags</span><span class="op" id="5343981">&amp;</span><span class="ident" id="5343982">FoldCase</span>&nbsp;<span class="op" id="5343991">!=</span>&nbsp;<span class="ident" id="5343994">re2</span><span class="op" id="5343997">.</span><span class="ident" id="5343998">Flags</span><span class="op" id="5344003">&amp;</span><span class="ident" id="5344004">FoldCase</span>&nbsp;<span class="op" id="5344013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344017">return</span>&nbsp;<span class="builtintype" id="5344024">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5344031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5344035">//&nbsp;Push&nbsp;re1&nbsp;into&nbsp;re2.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344058">re2</span><span class="op" id="5344061">.</span><span class="ident" id="5344062">Rune</span>&nbsp;<span class="op" id="5344067">=</span>&nbsp;<span class="builtinfunc" id="5344069">append</span><span class="op" id="5344075">(</span><span class="ident" id="5344076">re2</span><span class="op" id="5344079">.</span><span class="ident" id="5344080">Rune</span><span class="op" id="5344084">,</span>&nbsp;<span class="ident" id="5344086">re1</span><span class="op" id="5344089">.</span><span class="ident" id="5344090">Rune</span><span class="op" id="5344094">...</span><span class="op" id="5344097">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5344101">//&nbsp;Reuse&nbsp;re1&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344128">if</span>&nbsp;<span class="ident" id="5344131">r</span>&nbsp;<span class="op" id="5344133">&gt;=</span>&nbsp;<span class="num" id="5344136">0</span>&nbsp;<span class="op" id="5344138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344142">re1</span><span class="op" id="5344145">.</span><span class="ident" id="5344146">Rune</span>&nbsp;<span class="op" id="5344151">=</span>&nbsp;<span class="ident" id="5344153">re1</span><span class="op" id="5344156">.</span><span class="ident" id="5344157">Rune0</span><span class="op" id="5344162">[</span><span class="op" id="5344163">:</span><span class="num" id="5344164">1</span><span class="op" id="5344165">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344169">re1</span><span class="op" id="5344172">.</span><span class="ident" id="5344173">Rune</span><span class="op" id="5344177">[</span><span class="num" id="5344178">0</span><span class="op" id="5344179">]</span>&nbsp;<span class="op" id="5344181">=</span>&nbsp;<span class="ident" id="5344183">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344187">re1</span><span class="op" id="5344190">.</span><span class="ident" id="5344191">Flags</span>&nbsp;<span class="op" id="5344197">=</span>&nbsp;<span class="ident" id="5344199">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344207">return</span>&nbsp;<span class="builtintype" id="5344214">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5344220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344224">p</span><span class="op" id="5344225">.</span><span class="ident" id="5344226">stack</span>&nbsp;<span class="op" id="5344232">=</span>&nbsp;<span class="ident" id="5344234">p</span><span class="op" id="5344235">.</span><span class="ident" id="5344236">stack</span><span class="op" id="5344241">[</span><span class="op" id="5344242">:</span><span class="ident" id="5344243">n</span><span class="op" id="5344244">-</span><span class="num" id="5344245">1</span><span class="op" id="5344246">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344249">p</span><span class="op" id="5344250">.</span><span class="ident" id="5344251">reuse</span><span class="op" id="5344256">(</span><span class="ident" id="5344257">re1</span><span class="op" id="5344260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344263">return</span>&nbsp;<span class="builtintype" id="5344270">false</span>&nbsp;<span class="comment" id="5344276">//&nbsp;did&nbsp;not&nbsp;push&nbsp;r</span><br>
<span class="lineno"></span><span class="op" id="5344294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="5344297">//&nbsp;newLiteral&nbsp;returns&nbsp;a&nbsp;new&nbsp;OpLiteral&nbsp;Regexp&nbsp;with&nbsp;the&nbsp;given&nbsp;flags</span><br>
<span class="lineno"></span><span class="keyword" id="5344363">func</span>&nbsp;<span class="op" id="5344368">(</span><span class="ident" id="5344369">p</span>&nbsp;<span class="op" id="5344371">*</span><span class="ident" id="5344372">parser</span><span class="op" id="5344378">)</span>&nbsp;<span class="ident" id="5344380">newLiteral</span><span class="op" id="5344390">(</span><span class="ident" id="5344391">r</span>&nbsp;<span class="builtintype" id="5344393">rune</span><span class="op" id="5344397">,</span>&nbsp;<span class="ident" id="5344399">flags</span>&nbsp;<span class="ident" id="5344405">Flags</span><span class="op" id="5344410">)</span>&nbsp;<span class="op" id="5344412">*</span><span class="ident" id="5344413">Regexp</span>&nbsp;<span class="op" id="5344420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344423">re</span>&nbsp;<span class="op" id="5344426">:=</span>&nbsp;<span class="ident" id="5344429">p</span><span class="op" id="5344430">.</span><span class="ident" id="5344431">newRegexp</span><span class="op" id="5344440">(</span><span class="ident" id="5344441">OpLiteral</span><span class="op" id="5344450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344453">re</span><span class="op" id="5344455">.</span><span class="ident" id="5344456">Flags</span>&nbsp;<span class="op" id="5344462">=</span>&nbsp;<span class="ident" id="5344464">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344471">if</span>&nbsp;<span class="ident" id="5344474">flags</span><span class="op" id="5344479">&amp;</span><span class="ident" id="5344480">FoldCase</span>&nbsp;<span class="op" id="5344489">!=</span>&nbsp;<span class="num" id="5344492">0</span>&nbsp;<span class="op" id="5344494">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344498">r</span>&nbsp;<span class="op" id="5344500">=</span>&nbsp;<span class="ident" id="5344502">minFoldRune</span><span class="op" id="5344513">(</span><span class="ident" id="5344514">r</span><span class="op" id="5344515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5344518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344521">re</span><span class="op" id="5344523">.</span><span class="ident" id="5344524">Rune0</span><span class="op" id="5344529">[</span><span class="num" id="5344530">0</span><span class="op" id="5344531">]</span>&nbsp;<span class="op" id="5344533">=</span>&nbsp;<span class="ident" id="5344535">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344538">re</span><span class="op" id="5344540">.</span><span class="ident" id="5344541">Rune</span>&nbsp;<span class="op" id="5344546">=</span>&nbsp;<span class="ident" id="5344548">re</span><span class="op" id="5344550">.</span><span class="ident" id="5344551">Rune0</span><span class="op" id="5344556">[</span><span class="op" id="5344557">:</span><span class="num" id="5344558">1</span><span class="op" id="5344559">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344562">return</span>&nbsp;<span class="ident" id="5344569">re</span><br>
<span class="lineno">190</span><span class="op" id="5344572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5344575">//&nbsp;minFoldRune&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;rune&nbsp;fold-equivalent&nbsp;to&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5344637">func</span>&nbsp;<span class="ident" id="5344642">minFoldRune</span><span class="op" id="5344653">(</span><span class="ident" id="5344654">r</span>&nbsp;<span class="builtintype" id="5344656">rune</span><span class="op" id="5344660">)</span>&nbsp;<span class="builtintype" id="5344662">rune</span>&nbsp;<span class="op" id="5344667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344670">if</span>&nbsp;<span class="ident" id="5344673">r</span>&nbsp;<span class="op" id="5344675">&lt;</span>&nbsp;<span class="ident" id="5344677">minFold</span>&nbsp;<span class="op" id="5344685">||</span>&nbsp;<span class="ident" id="5344688">r</span>&nbsp;<span class="op" id="5344690">&gt;</span>&nbsp;<span class="ident" id="5344692">maxFold</span>&nbsp;<span class="op" id="5344700">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344704">return</span>&nbsp;<span class="ident" id="5344711">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5344714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344717">min</span>&nbsp;<span class="op" id="5344721">:=</span>&nbsp;<span class="ident" id="5344724">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344727">r0</span>&nbsp;<span class="op" id="5344730">:=</span>&nbsp;<span class="ident" id="5344733">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344736">for</span>&nbsp;<span class="ident" id="5344740">r</span>&nbsp;<span class="op" id="5344742">=</span>&nbsp;<span class="ident" id="5344744">unicode</span><span class="op" id="5344751">.</span><span class="ident" id="5344752">SimpleFold</span><span class="op" id="5344762">(</span><span class="ident" id="5344763">r</span><span class="op" id="5344764">)</span><span class="op" id="5344765">;</span>&nbsp;<span class="ident" id="5344767">r</span>&nbsp;<span class="op" id="5344769">!=</span>&nbsp;<span class="ident" id="5344772">r0</span><span class="op" id="5344774">;</span>&nbsp;<span class="ident" id="5344776">r</span>&nbsp;<span class="op" id="5344778">=</span>&nbsp;<span class="ident" id="5344780">unicode</span><span class="op" id="5344787">.</span><span class="ident" id="5344788">SimpleFold</span><span class="op" id="5344798">(</span><span class="ident" id="5344799">r</span><span class="op" id="5344800">)</span>&nbsp;<span class="op" id="5344802">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344806">if</span>&nbsp;<span class="ident" id="5344809">min</span>&nbsp;<span class="op" id="5344813">&gt;</span>&nbsp;<span class="ident" id="5344815">r</span>&nbsp;<span class="op" id="5344817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344822">min</span>&nbsp;<span class="op" id="5344826">=</span>&nbsp;<span class="ident" id="5344828">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5344832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5344835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344838">return</span>&nbsp;<span class="ident" id="5344845">min</span><br>
<span class="lineno">205</span><span class="op" id="5344849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5344852">//&nbsp;literal&nbsp;pushes&nbsp;a&nbsp;literal&nbsp;regexp&nbsp;for&nbsp;the&nbsp;rune&nbsp;r&nbsp;on&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5344915">//&nbsp;and&nbsp;returns&nbsp;that&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="keyword" id="5344943">func</span>&nbsp;<span class="op" id="5344948">(</span><span class="ident" id="5344949">p</span>&nbsp;<span class="op" id="5344951">*</span><span class="ident" id="5344952">parser</span><span class="op" id="5344958">)</span>&nbsp;<span class="ident" id="5344960">literal</span><span class="op" id="5344967">(</span><span class="ident" id="5344968">r</span>&nbsp;<span class="builtintype" id="5344970">rune</span><span class="op" id="5344974">)</span>&nbsp;<span class="op" id="5344976">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344979">p</span><span class="op" id="5344980">.</span><span class="ident" id="5344981">push</span><span class="op" id="5344985">(</span><span class="ident" id="5344986">p</span><span class="op" id="5344987">.</span><span class="ident" id="5344988">newLiteral</span><span class="op" id="5344998">(</span><span class="ident" id="5344999">r</span><span class="op" id="5345000">,</span>&nbsp;<span class="ident" id="5345002">p</span><span class="op" id="5345003">.</span><span class="ident" id="5345004">flags</span><span class="op" id="5345009">)</span><span class="op" id="5345010">)</span><br>
<span class="lineno"></span><span class="op" id="5345012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5345015">//&nbsp;op&nbsp;pushes&nbsp;a&nbsp;regexp&nbsp;with&nbsp;the&nbsp;given&nbsp;op&nbsp;onto&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5345070">//&nbsp;and&nbsp;returns&nbsp;that&nbsp;regexp.</span><br>
<span class="lineno">215</span><span class="keyword" id="5345098">func</span>&nbsp;<span class="op" id="5345103">(</span><span class="ident" id="5345104">p</span>&nbsp;<span class="op" id="5345106">*</span><span class="ident" id="5345107">parser</span><span class="op" id="5345113">)</span>&nbsp;<span class="ident" id="5345115">op</span><span class="op" id="5345117">(</span><span class="ident" id="5345118">op</span>&nbsp;<span class="ident" id="5345121">Op</span><span class="op" id="5345123">)</span>&nbsp;<span class="op" id="5345125">*</span><span class="ident" id="5345126">Regexp</span>&nbsp;<span class="op" id="5345133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345136">re</span>&nbsp;<span class="op" id="5345139">:=</span>&nbsp;<span class="ident" id="5345142">p</span><span class="op" id="5345143">.</span><span class="ident" id="5345144">newRegexp</span><span class="op" id="5345153">(</span><span class="ident" id="5345154">op</span><span class="op" id="5345156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345159">re</span><span class="op" id="5345161">.</span><span class="ident" id="5345162">Flags</span>&nbsp;<span class="op" id="5345168">=</span>&nbsp;<span class="ident" id="5345170">p</span><span class="op" id="5345171">.</span><span class="ident" id="5345172">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5345179">return</span>&nbsp;<span class="ident" id="5345186">p</span><span class="op" id="5345187">.</span><span class="ident" id="5345188">push</span><span class="op" id="5345192">(</span><span class="ident" id="5345193">re</span><span class="op" id="5345195">)</span><br>
<span class="lineno"></span><span class="op" id="5345197">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="5345200">//&nbsp;repeat&nbsp;replaces&nbsp;the&nbsp;top&nbsp;stack&nbsp;element&nbsp;with&nbsp;itself&nbsp;repeated&nbsp;according&nbsp;to&nbsp;op,&nbsp;min,&nbsp;max.</span><br>
<span class="lineno"></span><span class="comment" id="5345289">//&nbsp;before&nbsp;is&nbsp;the&nbsp;regexp&nbsp;suffix&nbsp;starting&nbsp;at&nbsp;the&nbsp;repetition&nbsp;operator.</span><br>
<span class="lineno"></span><span class="comment" id="5345357">//&nbsp;after&nbsp;is&nbsp;the&nbsp;regexp&nbsp;suffix&nbsp;following&nbsp;after&nbsp;the&nbsp;repetition&nbsp;operator.</span><br>
<span class="lineno"></span><span class="comment" id="5345428">//&nbsp;repeat&nbsp;returns&nbsp;an&nbsp;updated&nbsp;&#39;after&#39;&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">225</span><span class="keyword" id="5345487">func</span>&nbsp;<span class="op" id="5345492">(</span><span class="ident" id="5345493">p</span>&nbsp;<span class="op" id="5345495">*</span><span class="ident" id="5345496">parser</span><span class="op" id="5345502">)</span>&nbsp;<span class="ident" id="5345504">repeat</span><span class="op" id="5345510">(</span><span class="ident" id="5345511">op</span>&nbsp;<span class="ident" id="5345514">Op</span><span class="op" id="5345516">,</span>&nbsp;<span class="ident" id="5345518">min</span><span class="op" id="5345521">,</span>&nbsp;<span class="ident" id="5345523">max</span>&nbsp;<span class="builtintype" id="5345527">int</span><span class="op" id="5345530">,</span>&nbsp;<span class="ident" id="5345532">before</span><span class="op" id="5345538">,</span>&nbsp;<span class="ident" id="5345540">after</span><span class="op" id="5345545">,</span>&nbsp;<span class="ident" id="5345547">lastRepeat</span>&nbsp;<span class="builtintype" id="5345558">string</span><span class="op" id="5345564">)</span>&nbsp;<span class="op" id="5345566">(</span><span class="builtintype" id="5345567">string</span><span class="op" id="5345573">,</span>&nbsp;<span class="builtintype" id="5345575">error</span><span class="op" id="5345580">)</span>&nbsp;<span class="op" id="5345582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345585">flags</span>&nbsp;<span class="op" id="5345591">:=</span>&nbsp;<span class="ident" id="5345594">p</span><span class="op" id="5345595">.</span><span class="ident" id="5345596">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5345603">if</span>&nbsp;<span class="ident" id="5345606">p</span><span class="op" id="5345607">.</span><span class="ident" id="5345608">flags</span><span class="op" id="5345613">&amp;</span><span class="ident" id="5345614">PerlX</span>&nbsp;<span class="op" id="5345620">!=</span>&nbsp;<span class="num" id="5345623">0</span>&nbsp;<span class="op" id="5345625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5345629">if</span>&nbsp;<span class="builtinfunc" id="5345632">len</span><span class="op" id="5345635">(</span><span class="ident" id="5345636">after</span><span class="op" id="5345641">)</span>&nbsp;<span class="op" id="5345643">&gt;</span>&nbsp;<span class="num" id="5345645">0</span>&nbsp;<span class="op" id="5345647">&amp;&amp;</span>&nbsp;<span class="ident" id="5345650">after</span><span class="op" id="5345655">[</span><span class="num" id="5345656">0</span><span class="op" id="5345657">]</span>&nbsp;<span class="op" id="5345659">==</span>&nbsp;<span class="string" id="5345662">&#39;?&#39;</span>&nbsp;<span class="op" id="5345666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345671">after</span>&nbsp;<span class="op" id="5345677">=</span>&nbsp;<span class="ident" id="5345679">after</span><span class="op" id="5345684">[</span><span class="num" id="5345685">1</span><span class="op" id="5345686">:</span><span class="op" id="5345687">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345692">flags</span>&nbsp;<span class="op" id="5345698">^=</span>&nbsp;<span class="ident" id="5345701">NonGreedy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5345713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5345717">if</span>&nbsp;<span class="ident" id="5345720">lastRepeat</span>&nbsp;<span class="op" id="5345731">!=</span>&nbsp;<span class="string" id="5345734">&#34;&#34;</span>&nbsp;<span class="op" id="5345737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5345742">//&nbsp;In&nbsp;Perl&nbsp;it&nbsp;is&nbsp;not&nbsp;allowed&nbsp;to&nbsp;stack&nbsp;repetition&nbsp;operators:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5345805">//&nbsp;a**&nbsp;is&nbsp;a&nbsp;syntax&nbsp;error,&nbsp;not&nbsp;a&nbsp;doubled&nbsp;star,&nbsp;and&nbsp;a++&nbsp;means</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5345868">//&nbsp;something&nbsp;else&nbsp;entirely,&nbsp;which&nbsp;we&nbsp;don&#39;t&nbsp;support!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5345923">return</span>&nbsp;<span class="string" id="5345930">&#34;&#34;</span><span class="op" id="5345932">,</span>&nbsp;<span class="op" id="5345934">&amp;</span><span class="ident" id="5345935">Error</span><span class="op" id="5345940">{</span><span class="ident" id="5345941">ErrInvalidRepeatOp</span><span class="op" id="5345959">,</span>&nbsp;<span class="ident" id="5345961">lastRepeat</span><span class="op" id="5345971">[</span><span class="op" id="5345972">:</span><span class="builtinfunc" id="5345973">len</span><span class="op" id="5345976">(</span><span class="ident" id="5345977">lastRepeat</span><span class="op" id="5345987">)</span><span class="op" id="5345988">-</span><span class="builtinfunc" id="5345989">len</span><span class="op" id="5345992">(</span><span class="ident" id="5345993">after</span><span class="op" id="5345998">)</span><span class="op" id="5345999">]</span><span class="op" id="5346000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5346004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5346007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346010">n</span>&nbsp;<span class="op" id="5346012">:=</span>&nbsp;<span class="builtinfunc" id="5346015">len</span><span class="op" id="5346018">(</span><span class="ident" id="5346019">p</span><span class="op" id="5346020">.</span><span class="ident" id="5346021">stack</span><span class="op" id="5346026">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5346029">if</span>&nbsp;<span class="ident" id="5346032">n</span>&nbsp;<span class="op" id="5346034">==</span>&nbsp;<span class="num" id="5346037">0</span>&nbsp;<span class="op" id="5346039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5346043">return</span>&nbsp;<span class="string" id="5346050">&#34;&#34;</span><span class="op" id="5346052">,</span>&nbsp;<span class="op" id="5346054">&amp;</span><span class="ident" id="5346055">Error</span><span class="op" id="5346060">{</span><span class="ident" id="5346061">ErrMissingRepeatArgument</span><span class="op" id="5346085">,</span>&nbsp;<span class="ident" id="5346087">before</span><span class="op" id="5346093">[</span><span class="op" id="5346094">:</span><span class="builtinfunc" id="5346095">len</span><span class="op" id="5346098">(</span><span class="ident" id="5346099">before</span><span class="op" id="5346105">)</span><span class="op" id="5346106">-</span><span class="builtinfunc" id="5346107">len</span><span class="op" id="5346110">(</span><span class="ident" id="5346111">after</span><span class="op" id="5346116">)</span><span class="op" id="5346117">]</span><span class="op" id="5346118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5346121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346124">sub</span>&nbsp;<span class="op" id="5346128">:=</span>&nbsp;<span class="ident" id="5346131">p</span><span class="op" id="5346132">.</span><span class="ident" id="5346133">stack</span><span class="op" id="5346138">[</span><span class="ident" id="5346139">n</span><span class="op" id="5346140">-</span><span class="num" id="5346141">1</span><span class="op" id="5346142">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5346145">if</span>&nbsp;<span class="ident" id="5346148">sub</span><span class="op" id="5346151">.</span><span class="ident" id="5346152">Op</span>&nbsp;<span class="op" id="5346155">&gt;=</span>&nbsp;<span class="ident" id="5346158">opPseudo</span>&nbsp;<span class="op" id="5346167">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5346171">return</span>&nbsp;<span class="string" id="5346178">&#34;&#34;</span><span class="op" id="5346180">,</span>&nbsp;<span class="op" id="5346182">&amp;</span><span class="ident" id="5346183">Error</span><span class="op" id="5346188">{</span><span class="ident" id="5346189">ErrMissingRepeatArgument</span><span class="op" id="5346213">,</span>&nbsp;<span class="ident" id="5346215">before</span><span class="op" id="5346221">[</span><span class="op" id="5346222">:</span><span class="builtinfunc" id="5346223">len</span><span class="op" id="5346226">(</span><span class="ident" id="5346227">before</span><span class="op" id="5346233">)</span><span class="op" id="5346234">-</span><span class="builtinfunc" id="5346235">len</span><span class="op" id="5346238">(</span><span class="ident" id="5346239">after</span><span class="op" id="5346244">)</span><span class="op" id="5346245">]</span><span class="op" id="5346246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5346249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346253">re</span>&nbsp;<span class="op" id="5346256">:=</span>&nbsp;<span class="ident" id="5346259">p</span><span class="op" id="5346260">.</span><span class="ident" id="5346261">newRegexp</span><span class="op" id="5346270">(</span><span class="ident" id="5346271">op</span><span class="op" id="5346273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346276">re</span><span class="op" id="5346278">.</span><span class="ident" id="5346279">Min</span>&nbsp;<span class="op" id="5346283">=</span>&nbsp;<span class="ident" id="5346285">min</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346290">re</span><span class="op" id="5346292">.</span><span class="ident" id="5346293">Max</span>&nbsp;<span class="op" id="5346297">=</span>&nbsp;<span class="ident" id="5346299">max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346304">re</span><span class="op" id="5346306">.</span><span class="ident" id="5346307">Flags</span>&nbsp;<span class="op" id="5346313">=</span>&nbsp;<span class="ident" id="5346315">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346322">re</span><span class="op" id="5346324">.</span><span class="ident" id="5346325">Sub</span>&nbsp;<span class="op" id="5346329">=</span>&nbsp;<span class="ident" id="5346331">re</span><span class="op" id="5346333">.</span><span class="ident" id="5346334">Sub0</span><span class="op" id="5346338">[</span><span class="op" id="5346339">:</span><span class="num" id="5346340">1</span><span class="op" id="5346341">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346344">re</span><span class="op" id="5346346">.</span><span class="ident" id="5346347">Sub</span><span class="op" id="5346350">[</span><span class="num" id="5346351">0</span><span class="op" id="5346352">]</span>&nbsp;<span class="op" id="5346354">=</span>&nbsp;<span class="ident" id="5346356">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346361">p</span><span class="op" id="5346362">.</span><span class="ident" id="5346363">stack</span><span class="op" id="5346368">[</span><span class="ident" id="5346369">n</span><span class="op" id="5346370">-</span><span class="num" id="5346371">1</span><span class="op" id="5346372">]</span>&nbsp;<span class="op" id="5346374">=</span>&nbsp;<span class="ident" id="5346376">re</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5346381">if</span>&nbsp;<span class="ident" id="5346384">op</span>&nbsp;<span class="op" id="5346387">==</span>&nbsp;<span class="ident" id="5346390">OpRepeat</span>&nbsp;<span class="op" id="5346399">&amp;&amp;</span>&nbsp;<span class="op" id="5346402">(</span><span class="ident" id="5346403">min</span>&nbsp;<span class="op" id="5346407">&gt;=</span>&nbsp;<span class="num" id="5346410">2</span>&nbsp;<span class="op" id="5346412">||</span>&nbsp;<span class="ident" id="5346415">max</span>&nbsp;<span class="op" id="5346419">&gt;=</span>&nbsp;<span class="num" id="5346422">2</span><span class="op" id="5346423">)</span>&nbsp;<span class="op" id="5346425">&amp;&amp;</span>&nbsp;<span class="op" id="5346428">!</span><span class="ident" id="5346429">repeatIsValid</span><span class="op" id="5346442">(</span><span class="ident" id="5346443">re</span><span class="op" id="5346445">,</span>&nbsp;<span class="num" id="5346447">1000</span><span class="op" id="5346451">)</span>&nbsp;<span class="op" id="5346453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5346457">return</span>&nbsp;<span class="string" id="5346464">&#34;&#34;</span><span class="op" id="5346466">,</span>&nbsp;<span class="op" id="5346468">&amp;</span><span class="ident" id="5346469">Error</span><span class="op" id="5346474">{</span><span class="ident" id="5346475">ErrInvalidRepeatSize</span><span class="op" id="5346495">,</span>&nbsp;<span class="ident" id="5346497">before</span><span class="op" id="5346503">[</span><span class="op" id="5346504">:</span><span class="builtinfunc" id="5346505">len</span><span class="op" id="5346508">(</span><span class="ident" id="5346509">before</span><span class="op" id="5346515">)</span><span class="op" id="5346516">-</span><span class="builtinfunc" id="5346517">len</span><span class="op" id="5346520">(</span><span class="ident" id="5346521">after</span><span class="op" id="5346526">)</span><span class="op" id="5346527">]</span><span class="op" id="5346528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5346531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5346535">return</span>&nbsp;<span class="ident" id="5346542">after</span><span class="op" id="5346547">,</span>&nbsp;<span class="builtintype" id="5346549">nil</span><br>
<span class="lineno"></span><span class="op" id="5346553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5346556">//&nbsp;repeatIsValid&nbsp;reports&nbsp;whether&nbsp;the&nbsp;repetition&nbsp;re&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="comment" id="5346617">//&nbsp;Valid&nbsp;means&nbsp;that&nbsp;the&nbsp;combination&nbsp;of&nbsp;the&nbsp;top-level&nbsp;repetition</span><br>
<span class="lineno">265</span><span class="comment" id="5346681">//&nbsp;and&nbsp;any&nbsp;inner&nbsp;repetitions&nbsp;does&nbsp;not&nbsp;exceed&nbsp;n&nbsp;copies&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5346742">//&nbsp;innermost&nbsp;thing.</span><br>
<span class="lineno"></span><span class="comment" id="5346762">//&nbsp;This&nbsp;function&nbsp;rewalks&nbsp;the&nbsp;regexp&nbsp;tree&nbsp;and&nbsp;is&nbsp;called&nbsp;for&nbsp;every&nbsp;repetition,</span><br>
<span class="lineno"></span><span class="comment" id="5346839">//&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;worry&nbsp;about&nbsp;inducing&nbsp;quadratic&nbsp;behavior&nbsp;in&nbsp;the&nbsp;parser.</span><br>
<span class="lineno"></span><span class="comment" id="5346911">//&nbsp;We&nbsp;avoid&nbsp;this&nbsp;by&nbsp;only&nbsp;calling&nbsp;repeatIsValid&nbsp;when&nbsp;min&nbsp;or&nbsp;max&nbsp;&gt;=&nbsp;2.</span><br>
<span class="lineno">270</span><span class="comment" id="5346980">//&nbsp;In&nbsp;that&nbsp;case&nbsp;the&nbsp;depth&nbsp;of&nbsp;any&nbsp;&gt;=&nbsp;2&nbsp;nesting&nbsp;can&nbsp;only&nbsp;get&nbsp;to&nbsp;9&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="5347052">//&nbsp;triggering&nbsp;a&nbsp;parse&nbsp;error,&nbsp;so&nbsp;each&nbsp;subtree&nbsp;can&nbsp;only&nbsp;be&nbsp;rewalked&nbsp;9&nbsp;times.</span><br>
<span class="lineno"></span><span class="keyword" id="5347127">func</span>&nbsp;<span class="ident" id="5347132">repeatIsValid</span><span class="op" id="5347145">(</span><span class="ident" id="5347146">re</span>&nbsp;<span class="op" id="5347149">*</span><span class="ident" id="5347150">Regexp</span><span class="op" id="5347156">,</span>&nbsp;<span class="ident" id="5347158">n</span>&nbsp;<span class="builtintype" id="5347160">int</span><span class="op" id="5347163">)</span>&nbsp;<span class="builtintype" id="5347165">bool</span>&nbsp;<span class="op" id="5347170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347173">if</span>&nbsp;<span class="ident" id="5347176">re</span><span class="op" id="5347178">.</span><span class="ident" id="5347179">Op</span>&nbsp;<span class="op" id="5347182">==</span>&nbsp;<span class="ident" id="5347185">OpRepeat</span>&nbsp;<span class="op" id="5347194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347198">m</span>&nbsp;<span class="op" id="5347200">:=</span>&nbsp;<span class="ident" id="5347203">re</span><span class="op" id="5347205">.</span><span class="ident" id="5347206">Max</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347212">if</span>&nbsp;<span class="ident" id="5347215">m</span>&nbsp;<span class="op" id="5347217">==</span>&nbsp;<span class="num" id="5347220">0</span>&nbsp;<span class="op" id="5347222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347227">return</span>&nbsp;<span class="builtintype" id="5347234">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5347241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347245">if</span>&nbsp;<span class="ident" id="5347248">m</span>&nbsp;<span class="op" id="5347250">&lt;</span>&nbsp;<span class="num" id="5347252">0</span>&nbsp;<span class="op" id="5347254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347259">m</span>&nbsp;<span class="op" id="5347261">=</span>&nbsp;<span class="ident" id="5347263">re</span><span class="op" id="5347265">.</span><span class="ident" id="5347266">Min</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5347272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347276">if</span>&nbsp;<span class="ident" id="5347279">m</span>&nbsp;<span class="op" id="5347281">&gt;</span>&nbsp;<span class="ident" id="5347283">n</span>&nbsp;<span class="op" id="5347285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347290">return</span>&nbsp;<span class="builtintype" id="5347297">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5347305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347309">if</span>&nbsp;<span class="ident" id="5347312">m</span>&nbsp;<span class="op" id="5347314">&gt;</span>&nbsp;<span class="num" id="5347316">0</span>&nbsp;<span class="op" id="5347318">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347323">n</span>&nbsp;<span class="op" id="5347325">/=</span>&nbsp;<span class="ident" id="5347328">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5347332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5347335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347338">for</span>&nbsp;<span class="ident" id="5347342">_</span><span class="op" id="5347343">,</span>&nbsp;<span class="ident" id="5347345">sub</span>&nbsp;<span class="op" id="5347349">:=</span>&nbsp;<span class="keyword" id="5347352">range</span>&nbsp;<span class="ident" id="5347358">re</span><span class="op" id="5347360">.</span><span class="ident" id="5347361">Sub</span>&nbsp;<span class="op" id="5347365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347369">if</span>&nbsp;<span class="op" id="5347372">!</span><span class="ident" id="5347373">repeatIsValid</span><span class="op" id="5347386">(</span><span class="ident" id="5347387">sub</span><span class="op" id="5347390">,</span>&nbsp;<span class="ident" id="5347392">n</span><span class="op" id="5347393">)</span>&nbsp;<span class="op" id="5347395">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347400">return</span>&nbsp;<span class="builtintype" id="5347407">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5347415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5347418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347421">return</span>&nbsp;<span class="builtintype" id="5347428">true</span><br>
<span class="lineno"></span><span class="op" id="5347433">}</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span><span class="comment" id="5347436">//&nbsp;concat&nbsp;replaces&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;(above&nbsp;the&nbsp;topmost&nbsp;&#39;|&#39;&nbsp;or&nbsp;&#39;(&#39;)&nbsp;with&nbsp;its&nbsp;concatenation.</span><br>
<span class="lineno"></span><span class="keyword" id="5347531">func</span>&nbsp;<span class="op" id="5347536">(</span><span class="ident" id="5347537">p</span>&nbsp;<span class="op" id="5347539">*</span><span class="ident" id="5347540">parser</span><span class="op" id="5347546">)</span>&nbsp;<span class="ident" id="5347548">concat</span><span class="op" id="5347554">(</span><span class="op" id="5347555">)</span>&nbsp;<span class="op" id="5347557">*</span><span class="ident" id="5347558">Regexp</span>&nbsp;<span class="op" id="5347565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347568">p</span><span class="op" id="5347569">.</span><span class="ident" id="5347570">maybeConcat</span><span class="op" id="5347581">(</span><span class="op" id="5347582">-</span><span class="num" id="5347583">1</span><span class="op" id="5347584">,</span>&nbsp;<span class="num" id="5347586">0</span><span class="op" id="5347587">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5347591">//&nbsp;Scan&nbsp;down&nbsp;to&nbsp;find&nbsp;pseudo-operator&nbsp;|&nbsp;or&nbsp;(.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347637">i</span>&nbsp;<span class="op" id="5347639">:=</span>&nbsp;<span class="builtinfunc" id="5347642">len</span><span class="op" id="5347645">(</span><span class="ident" id="5347646">p</span><span class="op" id="5347647">.</span><span class="ident" id="5347648">stack</span><span class="op" id="5347653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347656">for</span>&nbsp;<span class="ident" id="5347660">i</span>&nbsp;<span class="op" id="5347662">&gt;</span>&nbsp;<span class="num" id="5347664">0</span>&nbsp;<span class="op" id="5347666">&amp;&amp;</span>&nbsp;<span class="ident" id="5347669">p</span><span class="op" id="5347670">.</span><span class="ident" id="5347671">stack</span><span class="op" id="5347676">[</span><span class="ident" id="5347677">i</span><span class="op" id="5347678">-</span><span class="num" id="5347679">1</span><span class="op" id="5347680">]</span><span class="op" id="5347681">.</span><span class="ident" id="5347682">Op</span>&nbsp;<span class="op" id="5347685">&lt;</span>&nbsp;<span class="ident" id="5347687">opPseudo</span>&nbsp;<span class="op" id="5347696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347700">i</span><span class="op" id="5347701">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5347705">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347708">subs</span>&nbsp;<span class="op" id="5347713">:=</span>&nbsp;<span class="ident" id="5347716">p</span><span class="op" id="5347717">.</span><span class="ident" id="5347718">stack</span><span class="op" id="5347723">[</span><span class="ident" id="5347724">i</span><span class="op" id="5347725">:</span><span class="op" id="5347726">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347729">p</span><span class="op" id="5347730">.</span><span class="ident" id="5347731">stack</span>&nbsp;<span class="op" id="5347737">=</span>&nbsp;<span class="ident" id="5347739">p</span><span class="op" id="5347740">.</span><span class="ident" id="5347741">stack</span><span class="op" id="5347746">[</span><span class="op" id="5347747">:</span><span class="ident" id="5347748">i</span><span class="op" id="5347749">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5347753">//&nbsp;Empty&nbsp;concatenation&nbsp;is&nbsp;special&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347794">if</span>&nbsp;<span class="builtinfunc" id="5347797">len</span><span class="op" id="5347800">(</span><span class="ident" id="5347801">subs</span><span class="op" id="5347805">)</span>&nbsp;<span class="op" id="5347807">==</span>&nbsp;<span class="num" id="5347810">0</span>&nbsp;<span class="op" id="5347812">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347816">return</span>&nbsp;<span class="ident" id="5347823">p</span><span class="op" id="5347824">.</span><span class="ident" id="5347825">push</span><span class="op" id="5347829">(</span><span class="ident" id="5347830">p</span><span class="op" id="5347831">.</span><span class="ident" id="5347832">newRegexp</span><span class="op" id="5347841">(</span><span class="ident" id="5347842">OpEmptyMatch</span><span class="op" id="5347854">)</span><span class="op" id="5347855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5347858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347862">return</span>&nbsp;<span class="ident" id="5347869">p</span><span class="op" id="5347870">.</span><span class="ident" id="5347871">push</span><span class="op" id="5347875">(</span><span class="ident" id="5347876">p</span><span class="op" id="5347877">.</span><span class="ident" id="5347878">collapse</span><span class="op" id="5347886">(</span><span class="ident" id="5347887">subs</span><span class="op" id="5347891">,</span>&nbsp;<span class="ident" id="5347893">OpConcat</span><span class="op" id="5347901">)</span><span class="op" id="5347902">)</span><br>
<span class="lineno"></span><span class="op" id="5347904">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="5347907">//&nbsp;alternate&nbsp;replaces&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;(above&nbsp;the&nbsp;topmost&nbsp;&#39;(&#39;)&nbsp;with&nbsp;its&nbsp;alternation.</span><br>
<span class="lineno"></span><span class="keyword" id="5347996">func</span>&nbsp;<span class="op" id="5348001">(</span><span class="ident" id="5348002">p</span>&nbsp;<span class="op" id="5348004">*</span><span class="ident" id="5348005">parser</span><span class="op" id="5348011">)</span>&nbsp;<span class="ident" id="5348013">alternate</span><span class="op" id="5348022">(</span><span class="op" id="5348023">)</span>&nbsp;<span class="op" id="5348025">*</span><span class="ident" id="5348026">Regexp</span>&nbsp;<span class="op" id="5348033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5348036">//&nbsp;Scan&nbsp;down&nbsp;to&nbsp;find&nbsp;pseudo-operator&nbsp;(.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5348077">//&nbsp;There&nbsp;are&nbsp;no&nbsp;|&nbsp;above&nbsp;(.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348105">i</span>&nbsp;<span class="op" id="5348107">:=</span>&nbsp;<span class="builtinfunc" id="5348110">len</span><span class="op" id="5348113">(</span><span class="ident" id="5348114">p</span><span class="op" id="5348115">.</span><span class="ident" id="5348116">stack</span><span class="op" id="5348121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5348124">for</span>&nbsp;<span class="ident" id="5348128">i</span>&nbsp;<span class="op" id="5348130">&gt;</span>&nbsp;<span class="num" id="5348132">0</span>&nbsp;<span class="op" id="5348134">&amp;&amp;</span>&nbsp;<span class="ident" id="5348137">p</span><span class="op" id="5348138">.</span><span class="ident" id="5348139">stack</span><span class="op" id="5348144">[</span><span class="ident" id="5348145">i</span><span class="op" id="5348146">-</span><span class="num" id="5348147">1</span><span class="op" id="5348148">]</span><span class="op" id="5348149">.</span><span class="ident" id="5348150">Op</span>&nbsp;<span class="op" id="5348153">&lt;</span>&nbsp;<span class="ident" id="5348155">opPseudo</span>&nbsp;<span class="op" id="5348164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348168">i</span><span class="op" id="5348169">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5348173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348176">subs</span>&nbsp;<span class="op" id="5348181">:=</span>&nbsp;<span class="ident" id="5348184">p</span><span class="op" id="5348185">.</span><span class="ident" id="5348186">stack</span><span class="op" id="5348191">[</span><span class="ident" id="5348192">i</span><span class="op" id="5348193">:</span><span class="op" id="5348194">]</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348197">p</span><span class="op" id="5348198">.</span><span class="ident" id="5348199">stack</span>&nbsp;<span class="op" id="5348205">=</span>&nbsp;<span class="ident" id="5348207">p</span><span class="op" id="5348208">.</span><span class="ident" id="5348209">stack</span><span class="op" id="5348214">[</span><span class="op" id="5348215">:</span><span class="ident" id="5348216">i</span><span class="op" id="5348217">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5348221">//&nbsp;Make&nbsp;sure&nbsp;top&nbsp;class&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5348255">//&nbsp;All&nbsp;the&nbsp;others&nbsp;already&nbsp;are&nbsp;(see&nbsp;swapVerticalBar).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5348309">if</span>&nbsp;<span class="builtinfunc" id="5348312">len</span><span class="op" id="5348315">(</span><span class="ident" id="5348316">subs</span><span class="op" id="5348320">)</span>&nbsp;<span class="op" id="5348322">&gt;</span>&nbsp;<span class="num" id="5348324">0</span>&nbsp;<span class="op" id="5348326">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348330">cleanAlt</span><span class="op" id="5348338">(</span><span class="ident" id="5348339">subs</span><span class="op" id="5348343">[</span><span class="builtinfunc" id="5348344">len</span><span class="op" id="5348347">(</span><span class="ident" id="5348348">subs</span><span class="op" id="5348352">)</span><span class="op" id="5348353">-</span><span class="num" id="5348354">1</span><span class="op" id="5348355">]</span><span class="op" id="5348356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5348359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5348363">//&nbsp;Empty&nbsp;alternate&nbsp;is&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5348399">//&nbsp;(shouldn&#39;t&nbsp;happen&nbsp;but&nbsp;easy&nbsp;to&nbsp;handle).</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5348442">if</span>&nbsp;<span class="builtinfunc" id="5348445">len</span><span class="op" id="5348448">(</span><span class="ident" id="5348449">subs</span><span class="op" id="5348453">)</span>&nbsp;<span class="op" id="5348455">==</span>&nbsp;<span class="num" id="5348458">0</span>&nbsp;<span class="op" id="5348460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5348464">return</span>&nbsp;<span class="ident" id="5348471">p</span><span class="op" id="5348472">.</span><span class="ident" id="5348473">push</span><span class="op" id="5348477">(</span><span class="ident" id="5348478">p</span><span class="op" id="5348479">.</span><span class="ident" id="5348480">newRegexp</span><span class="op" id="5348489">(</span><span class="ident" id="5348490">OpNoMatch</span><span class="op" id="5348499">)</span><span class="op" id="5348500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5348503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5348507">return</span>&nbsp;<span class="ident" id="5348514">p</span><span class="op" id="5348515">.</span><span class="ident" id="5348516">push</span><span class="op" id="5348520">(</span><span class="ident" id="5348521">p</span><span class="op" id="5348522">.</span><span class="ident" id="5348523">collapse</span><span class="op" id="5348531">(</span><span class="ident" id="5348532">subs</span><span class="op" id="5348536">,</span>&nbsp;<span class="ident" id="5348538">OpAlternate</span><span class="op" id="5348549">)</span><span class="op" id="5348550">)</span><br>
<span class="lineno">340</span><span class="op" id="5348552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5348555">//&nbsp;cleanAlt&nbsp;cleans&nbsp;re&nbsp;for&nbsp;eventual&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;alternation.</span><br>
<span class="lineno"></span><span class="keyword" id="5348619">func</span>&nbsp;<span class="ident" id="5348624">cleanAlt</span><span class="op" id="5348632">(</span><span class="ident" id="5348633">re</span>&nbsp;<span class="op" id="5348636">*</span><span class="ident" id="5348637">Regexp</span><span class="op" id="5348643">)</span>&nbsp;<span class="op" id="5348645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5348648">switch</span>&nbsp;<span class="ident" id="5348655">re</span><span class="op" id="5348657">.</span><span class="ident" id="5348658">Op</span>&nbsp;<span class="op" id="5348661">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5348664">case</span>&nbsp;<span class="ident" id="5348669">OpCharClass</span><span class="op" id="5348680">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348684">re</span><span class="op" id="5348686">.</span><span class="ident" id="5348687">Rune</span>&nbsp;<span class="op" id="5348692">=</span>&nbsp;<span class="ident" id="5348694">cleanClass</span><span class="op" id="5348704">(</span><span class="op" id="5348705">&amp;</span><span class="ident" id="5348706">re</span><span class="op" id="5348708">.</span><span class="ident" id="5348709">Rune</span><span class="op" id="5348713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5348717">if</span>&nbsp;<span class="builtinfunc" id="5348720">len</span><span class="op" id="5348723">(</span><span class="ident" id="5348724">re</span><span class="op" id="5348726">.</span><span class="ident" id="5348727">Rune</span><span class="op" id="5348731">)</span>&nbsp;<span class="op" id="5348733">==</span>&nbsp;<span class="num" id="5348736">2</span>&nbsp;<span class="op" id="5348738">&amp;&amp;</span>&nbsp;<span class="ident" id="5348741">re</span><span class="op" id="5348743">.</span><span class="ident" id="5348744">Rune</span><span class="op" id="5348748">[</span><span class="num" id="5348749">0</span><span class="op" id="5348750">]</span>&nbsp;<span class="op" id="5348752">==</span>&nbsp;<span class="num" id="5348755">0</span>&nbsp;<span class="op" id="5348757">&amp;&amp;</span>&nbsp;<span class="ident" id="5348760">re</span><span class="op" id="5348762">.</span><span class="ident" id="5348763">Rune</span><span class="op" id="5348767">[</span><span class="num" id="5348768">1</span><span class="op" id="5348769">]</span>&nbsp;<span class="op" id="5348771">==</span>&nbsp;<span class="ident" id="5348774">unicode</span><span class="op" id="5348781">.</span><span class="ident" id="5348782">MaxRune</span>&nbsp;<span class="op" id="5348790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348795">re</span><span class="op" id="5348797">.</span><span class="ident" id="5348798">Rune</span>&nbsp;<span class="op" id="5348803">=</span>&nbsp;<span class="builtintype" id="5348805">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348812">re</span><span class="op" id="5348814">.</span><span class="ident" id="5348815">Op</span>&nbsp;<span class="op" id="5348818">=</span>&nbsp;<span class="ident" id="5348820">OpAnyChar</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5348833">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5348842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5348846">if</span>&nbsp;<span class="builtinfunc" id="5348849">len</span><span class="op" id="5348852">(</span><span class="ident" id="5348853">re</span><span class="op" id="5348855">.</span><span class="ident" id="5348856">Rune</span><span class="op" id="5348860">)</span>&nbsp;<span class="op" id="5348862">==</span>&nbsp;<span class="num" id="5348865">4</span>&nbsp;<span class="op" id="5348867">&amp;&amp;</span>&nbsp;<span class="ident" id="5348870">re</span><span class="op" id="5348872">.</span><span class="ident" id="5348873">Rune</span><span class="op" id="5348877">[</span><span class="num" id="5348878">0</span><span class="op" id="5348879">]</span>&nbsp;<span class="op" id="5348881">==</span>&nbsp;<span class="num" id="5348884">0</span>&nbsp;<span class="op" id="5348886">&amp;&amp;</span>&nbsp;<span class="ident" id="5348889">re</span><span class="op" id="5348891">.</span><span class="ident" id="5348892">Rune</span><span class="op" id="5348896">[</span><span class="num" id="5348897">1</span><span class="op" id="5348898">]</span>&nbsp;<span class="op" id="5348900">==</span>&nbsp;<span class="string" id="5348903">&#39;\n&#39;</span><span class="op" id="5348907">-</span><span class="num" id="5348908">1</span>&nbsp;<span class="op" id="5348910">&amp;&amp;</span>&nbsp;<span class="ident" id="5348913">re</span><span class="op" id="5348915">.</span><span class="ident" id="5348916">Rune</span><span class="op" id="5348920">[</span><span class="num" id="5348921">2</span><span class="op" id="5348922">]</span>&nbsp;<span class="op" id="5348924">==</span>&nbsp;<span class="string" id="5348927">&#39;\n&#39;</span><span class="op" id="5348931">+</span><span class="num" id="5348932">1</span>&nbsp;<span class="op" id="5348934">&amp;&amp;</span>&nbsp;<span class="ident" id="5348937">re</span><span class="op" id="5348939">.</span><span class="ident" id="5348940">Rune</span><span class="op" id="5348944">[</span><span class="num" id="5348945">3</span><span class="op" id="5348946">]</span>&nbsp;<span class="op" id="5348948">==</span>&nbsp;<span class="ident" id="5348951">unicode</span><span class="op" id="5348958">.</span><span class="ident" id="5348959">MaxRune</span>&nbsp;<span class="op" id="5348967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348972">re</span><span class="op" id="5348974">.</span><span class="ident" id="5348975">Rune</span>&nbsp;<span class="op" id="5348980">=</span>&nbsp;<span class="builtintype" id="5348982">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348989">re</span><span class="op" id="5348991">.</span><span class="ident" id="5348992">Op</span>&nbsp;<span class="op" id="5348995">=</span>&nbsp;<span class="ident" id="5348997">OpAnyCharNotNL</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349015">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5349024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349028">if</span>&nbsp;<span class="builtinfunc" id="5349031">cap</span><span class="op" id="5349034">(</span><span class="ident" id="5349035">re</span><span class="op" id="5349037">.</span><span class="ident" id="5349038">Rune</span><span class="op" id="5349042">)</span><span class="op" id="5349043">-</span><span class="builtinfunc" id="5349044">len</span><span class="op" id="5349047">(</span><span class="ident" id="5349048">re</span><span class="op" id="5349050">.</span><span class="ident" id="5349051">Rune</span><span class="op" id="5349055">)</span>&nbsp;<span class="op" id="5349057">&gt;</span>&nbsp;<span class="num" id="5349059">100</span>&nbsp;<span class="op" id="5349063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5349068">//&nbsp;re.Rune&nbsp;will&nbsp;not&nbsp;grow&nbsp;any&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5349106">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;or&nbsp;inline&nbsp;to&nbsp;reclaim&nbsp;storage.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349154">re</span><span class="op" id="5349156">.</span><span class="ident" id="5349157">Rune</span>&nbsp;<span class="op" id="5349162">=</span>&nbsp;<span class="builtinfunc" id="5349164">append</span><span class="op" id="5349170">(</span><span class="ident" id="5349171">re</span><span class="op" id="5349173">.</span><span class="ident" id="5349174">Rune0</span><span class="op" id="5349179">[</span><span class="op" id="5349180">:</span><span class="num" id="5349181">0</span><span class="op" id="5349182">]</span><span class="op" id="5349183">,</span>&nbsp;<span class="ident" id="5349185">re</span><span class="op" id="5349187">.</span><span class="ident" id="5349188">Rune</span><span class="op" id="5349192">...</span><span class="op" id="5349195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5349199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5349202">}</span><br>
<span class="lineno"></span><span class="op" id="5349204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="5349207">//&nbsp;collapse&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;applying&nbsp;op&nbsp;to&nbsp;sub.</span><br>
<span class="lineno"></span><span class="comment" id="5349261">//&nbsp;If&nbsp;sub&nbsp;contains&nbsp;op&nbsp;nodes,&nbsp;they&nbsp;all&nbsp;get&nbsp;hoisted&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="5349314">//&nbsp;so&nbsp;that&nbsp;there&nbsp;is&nbsp;never&nbsp;a&nbsp;concat&nbsp;of&nbsp;a&nbsp;concat&nbsp;or&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5349367">//&nbsp;alternate&nbsp;of&nbsp;an&nbsp;alternate.</span><br>
<span class="lineno"></span><span class="keyword" id="5349397">func</span>&nbsp;<span class="op" id="5349402">(</span><span class="ident" id="5349403">p</span>&nbsp;<span class="op" id="5349405">*</span><span class="ident" id="5349406">parser</span><span class="op" id="5349412">)</span>&nbsp;<span class="ident" id="5349414">collapse</span><span class="op" id="5349422">(</span><span class="ident" id="5349423">subs</span>&nbsp;<span class="op" id="5349428">[</span><span class="op" id="5349429">]</span><span class="op" id="5349430">*</span><span class="ident" id="5349431">Regexp</span><span class="op" id="5349437">,</span>&nbsp;<span class="ident" id="5349439">op</span>&nbsp;<span class="ident" id="5349442">Op</span><span class="op" id="5349444">)</span>&nbsp;<span class="op" id="5349446">*</span><span class="ident" id="5349447">Regexp</span>&nbsp;<span class="op" id="5349454">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349457">if</span>&nbsp;<span class="builtinfunc" id="5349460">len</span><span class="op" id="5349463">(</span><span class="ident" id="5349464">subs</span><span class="op" id="5349468">)</span>&nbsp;<span class="op" id="5349470">==</span>&nbsp;<span class="num" id="5349473">1</span>&nbsp;<span class="op" id="5349475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349479">return</span>&nbsp;<span class="ident" id="5349486">subs</span><span class="op" id="5349490">[</span><span class="num" id="5349491">0</span><span class="op" id="5349492">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5349495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349498">re</span>&nbsp;<span class="op" id="5349501">:=</span>&nbsp;<span class="ident" id="5349504">p</span><span class="op" id="5349505">.</span><span class="ident" id="5349506">newRegexp</span><span class="op" id="5349515">(</span><span class="ident" id="5349516">op</span><span class="op" id="5349518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349521">re</span><span class="op" id="5349523">.</span><span class="ident" id="5349524">Sub</span>&nbsp;<span class="op" id="5349528">=</span>&nbsp;<span class="ident" id="5349530">re</span><span class="op" id="5349532">.</span><span class="ident" id="5349533">Sub0</span><span class="op" id="5349537">[</span><span class="op" id="5349538">:</span><span class="num" id="5349539">0</span><span class="op" id="5349540">]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349543">for</span>&nbsp;<span class="ident" id="5349547">_</span><span class="op" id="5349548">,</span>&nbsp;<span class="ident" id="5349550">sub</span>&nbsp;<span class="op" id="5349554">:=</span>&nbsp;<span class="keyword" id="5349557">range</span>&nbsp;<span class="ident" id="5349563">subs</span>&nbsp;<span class="op" id="5349568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349572">if</span>&nbsp;<span class="ident" id="5349575">sub</span><span class="op" id="5349578">.</span><span class="ident" id="5349579">Op</span>&nbsp;<span class="op" id="5349582">==</span>&nbsp;<span class="ident" id="5349585">op</span>&nbsp;<span class="op" id="5349588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349593">re</span><span class="op" id="5349595">.</span><span class="ident" id="5349596">Sub</span>&nbsp;<span class="op" id="5349600">=</span>&nbsp;<span class="builtinfunc" id="5349602">append</span><span class="op" id="5349608">(</span><span class="ident" id="5349609">re</span><span class="op" id="5349611">.</span><span class="ident" id="5349612">Sub</span><span class="op" id="5349615">,</span>&nbsp;<span class="ident" id="5349617">sub</span><span class="op" id="5349620">.</span><span class="ident" id="5349621">Sub</span><span class="op" id="5349624">...</span><span class="op" id="5349627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349632">p</span><span class="op" id="5349633">.</span><span class="ident" id="5349634">reuse</span><span class="op" id="5349639">(</span><span class="ident" id="5349640">sub</span><span class="op" id="5349643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5349647">}</span>&nbsp;<span class="keyword" id="5349649">else</span>&nbsp;<span class="op" id="5349654">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349659">re</span><span class="op" id="5349661">.</span><span class="ident" id="5349662">Sub</span>&nbsp;<span class="op" id="5349666">=</span>&nbsp;<span class="builtinfunc" id="5349668">append</span><span class="op" id="5349674">(</span><span class="ident" id="5349675">re</span><span class="op" id="5349677">.</span><span class="ident" id="5349678">Sub</span><span class="op" id="5349681">,</span>&nbsp;<span class="ident" id="5349683">sub</span><span class="op" id="5349686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5349690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5349693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349696">if</span>&nbsp;<span class="ident" id="5349699">op</span>&nbsp;<span class="op" id="5349702">==</span>&nbsp;<span class="ident" id="5349705">OpAlternate</span>&nbsp;<span class="op" id="5349717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349721">re</span><span class="op" id="5349723">.</span><span class="ident" id="5349724">Sub</span>&nbsp;<span class="op" id="5349728">=</span>&nbsp;<span class="ident" id="5349730">p</span><span class="op" id="5349731">.</span><span class="ident" id="5349732">factor</span><span class="op" id="5349738">(</span><span class="ident" id="5349739">re</span><span class="op" id="5349741">.</span><span class="ident" id="5349742">Sub</span><span class="op" id="5349745">,</span>&nbsp;<span class="ident" id="5349747">re</span><span class="op" id="5349749">.</span><span class="ident" id="5349750">Flags</span><span class="op" id="5349755">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349759">if</span>&nbsp;<span class="builtinfunc" id="5349762">len</span><span class="op" id="5349765">(</span><span class="ident" id="5349766">re</span><span class="op" id="5349768">.</span><span class="ident" id="5349769">Sub</span><span class="op" id="5349772">)</span>&nbsp;<span class="op" id="5349774">==</span>&nbsp;<span class="num" id="5349777">1</span>&nbsp;<span class="op" id="5349779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349784">old</span>&nbsp;<span class="op" id="5349788">:=</span>&nbsp;<span class="ident" id="5349791">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349797">re</span>&nbsp;<span class="op" id="5349800">=</span>&nbsp;<span class="ident" id="5349802">re</span><span class="op" id="5349804">.</span><span class="ident" id="5349805">Sub</span><span class="op" id="5349808">[</span><span class="num" id="5349809">0</span><span class="op" id="5349810">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349815">p</span><span class="op" id="5349816">.</span><span class="ident" id="5349817">reuse</span><span class="op" id="5349822">(</span><span class="ident" id="5349823">old</span><span class="op" id="5349826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5349830">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5349833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349836">return</span>&nbsp;<span class="ident" id="5349843">re</span><br>
<span class="lineno"></span><span class="op" id="5349846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5349849">//&nbsp;factor&nbsp;factors&nbsp;common&nbsp;prefixes&nbsp;from&nbsp;the&nbsp;alternation&nbsp;list&nbsp;sub.</span><br>
<span class="lineno">395</span><span class="comment" id="5349914">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;replacement&nbsp;list&nbsp;that&nbsp;reuses&nbsp;the&nbsp;same&nbsp;storage&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5349980">//&nbsp;frees&nbsp;(passes&nbsp;to&nbsp;p.reuse)&nbsp;any&nbsp;removed&nbsp;*Regexps.</span><br>
<span class="lineno"></span><span class="comment" id="5350031">//</span><br>
<span class="lineno"></span><span class="comment" id="5350034">//&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span><span class="comment" id="5350050">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ABC|ABD|AEF|BCX|BCY</span><br>
<span class="lineno">400</span><span class="comment" id="5350077">//&nbsp;simplifies&nbsp;by&nbsp;literal&nbsp;prefix&nbsp;extraction&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5350123">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A(B(C|D)|EF)|BC(X|Y)</span><br>
<span class="lineno"></span><span class="comment" id="5350151">//&nbsp;which&nbsp;simplifies&nbsp;by&nbsp;character&nbsp;class&nbsp;introduction&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5350206">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A(B[CD]|EF)|BC[XY]</span><br>
<span class="lineno"></span><span class="comment" id="5350232">//</span><br>
<span class="lineno">405</span><span class="keyword" id="5350235">func</span>&nbsp;<span class="op" id="5350240">(</span><span class="ident" id="5350241">p</span>&nbsp;<span class="op" id="5350243">*</span><span class="ident" id="5350244">parser</span><span class="op" id="5350250">)</span>&nbsp;<span class="ident" id="5350252">factor</span><span class="op" id="5350258">(</span><span class="ident" id="5350259">sub</span>&nbsp;<span class="op" id="5350263">[</span><span class="op" id="5350264">]</span><span class="op" id="5350265">*</span><span class="ident" id="5350266">Regexp</span><span class="op" id="5350272">,</span>&nbsp;<span class="ident" id="5350274">flags</span>&nbsp;<span class="ident" id="5350280">Flags</span><span class="op" id="5350285">)</span>&nbsp;<span class="op" id="5350287">[</span><span class="op" id="5350288">]</span><span class="op" id="5350289">*</span><span class="ident" id="5350290">Regexp</span>&nbsp;<span class="op" id="5350297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350300">if</span>&nbsp;<span class="builtinfunc" id="5350303">len</span><span class="op" id="5350306">(</span><span class="ident" id="5350307">sub</span><span class="op" id="5350310">)</span>&nbsp;<span class="op" id="5350312">&lt;</span>&nbsp;<span class="num" id="5350314">2</span>&nbsp;<span class="op" id="5350316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350320">return</span>&nbsp;<span class="ident" id="5350327">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5350332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5350336">//&nbsp;Round&nbsp;1:&nbsp;Factor&nbsp;out&nbsp;common&nbsp;literal&nbsp;prefixes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350385">var</span>&nbsp;<span class="ident" id="5350389">str</span>&nbsp;<span class="op" id="5350393">[</span><span class="op" id="5350394">]</span><span class="builtintype" id="5350395">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350401">var</span>&nbsp;<span class="ident" id="5350405">strflags</span>&nbsp;<span class="ident" id="5350414">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350421">start</span>&nbsp;<span class="op" id="5350427">:=</span>&nbsp;<span class="num" id="5350430">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350433">out</span>&nbsp;<span class="op" id="5350437">:=</span>&nbsp;<span class="ident" id="5350440">sub</span><span class="op" id="5350443">[</span><span class="op" id="5350444">:</span><span class="num" id="5350445">0</span><span class="op" id="5350446">]</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350449">for</span>&nbsp;<span class="ident" id="5350453">i</span>&nbsp;<span class="op" id="5350455">:=</span>&nbsp;<span class="num" id="5350458">0</span><span class="op" id="5350459">;</span>&nbsp;<span class="ident" id="5350461">i</span>&nbsp;<span class="op" id="5350463">&lt;=</span>&nbsp;<span class="builtinfunc" id="5350466">len</span><span class="op" id="5350469">(</span><span class="ident" id="5350470">sub</span><span class="op" id="5350473">)</span><span class="op" id="5350474">;</span>&nbsp;<span class="ident" id="5350476">i</span><span class="op" id="5350477">++</span>&nbsp;<span class="op" id="5350480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5350484">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5350548">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5350615">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5350649">//</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5350654">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;all&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5350718">//&nbsp;with&nbsp;str&nbsp;as&nbsp;modified&nbsp;by&nbsp;strflags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350757">var</span>&nbsp;<span class="ident" id="5350761">istr</span>&nbsp;<span class="op" id="5350766">[</span><span class="op" id="5350767">]</span><span class="builtintype" id="5350768">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350775">var</span>&nbsp;<span class="ident" id="5350779">iflags</span>&nbsp;<span class="ident" id="5350786">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350794">if</span>&nbsp;<span class="ident" id="5350797">i</span>&nbsp;<span class="op" id="5350799">&lt;</span>&nbsp;<span class="builtinfunc" id="5350801">len</span><span class="op" id="5350804">(</span><span class="ident" id="5350805">sub</span><span class="op" id="5350808">)</span>&nbsp;<span class="op" id="5350810">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350815">istr</span><span class="op" id="5350819">,</span>&nbsp;<span class="ident" id="5350821">iflags</span>&nbsp;<span class="op" id="5350828">=</span>&nbsp;<span class="ident" id="5350830">p</span><span class="op" id="5350831">.</span><span class="ident" id="5350832">leadingString</span><span class="op" id="5350845">(</span><span class="ident" id="5350846">sub</span><span class="op" id="5350849">[</span><span class="ident" id="5350850">i</span><span class="op" id="5350851">]</span><span class="op" id="5350852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350857">if</span>&nbsp;<span class="ident" id="5350860">iflags</span>&nbsp;<span class="op" id="5350867">==</span>&nbsp;<span class="ident" id="5350870">strflags</span>&nbsp;<span class="op" id="5350879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350885">same</span>&nbsp;<span class="op" id="5350890">:=</span>&nbsp;<span class="num" id="5350893">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350899">for</span>&nbsp;<span class="ident" id="5350903">same</span>&nbsp;<span class="op" id="5350908">&lt;</span>&nbsp;<span class="builtinfunc" id="5350910">len</span><span class="op" id="5350913">(</span><span class="ident" id="5350914">str</span><span class="op" id="5350917">)</span>&nbsp;<span class="op" id="5350919">&amp;&amp;</span>&nbsp;<span class="ident" id="5350922">same</span>&nbsp;<span class="op" id="5350927">&lt;</span>&nbsp;<span class="builtinfunc" id="5350929">len</span><span class="op" id="5350932">(</span><span class="ident" id="5350933">istr</span><span class="op" id="5350937">)</span>&nbsp;<span class="op" id="5350939">&amp;&amp;</span>&nbsp;<span class="ident" id="5350942">str</span><span class="op" id="5350945">[</span><span class="ident" id="5350946">same</span><span class="op" id="5350950">]</span>&nbsp;<span class="op" id="5350952">==</span>&nbsp;<span class="ident" id="5350955">istr</span><span class="op" id="5350959">[</span><span class="ident" id="5350960">same</span><span class="op" id="5350964">]</span>&nbsp;<span class="op" id="5350966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350973">same</span><span class="op" id="5350977">++</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5350984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350990">if</span>&nbsp;<span class="ident" id="5350993">same</span>&nbsp;<span class="op" id="5350998">&gt;</span>&nbsp;<span class="num" id="5351000">0</span>&nbsp;<span class="op" id="5351002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5351009">//&nbsp;Matches&nbsp;at&nbsp;least&nbsp;one&nbsp;rune&nbsp;in&nbsp;current&nbsp;range.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5351061">//&nbsp;Keep&nbsp;going&nbsp;around.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351088">str</span>&nbsp;<span class="op" id="5351092">=</span>&nbsp;<span class="ident" id="5351094">str</span><span class="op" id="5351097">[</span><span class="op" id="5351098">:</span><span class="ident" id="5351099">same</span><span class="op" id="5351103">]</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5351110">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5351123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5351128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5351132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5351137">//&nbsp;Found&nbsp;end&nbsp;of&nbsp;a&nbsp;run&nbsp;with&nbsp;common&nbsp;leading&nbsp;literal&nbsp;string:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5351197">//&nbsp;sub[start:i]&nbsp;all&nbsp;begin&nbsp;with&nbsp;str[0:len(str)],&nbsp;but&nbsp;sub[i]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5351258">//&nbsp;does&nbsp;not&nbsp;even&nbsp;begin&nbsp;with&nbsp;str[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5351296">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5351301">//&nbsp;Factor&nbsp;out&nbsp;common&nbsp;string&nbsp;and&nbsp;append&nbsp;factored&nbsp;expression&nbsp;to&nbsp;out.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5351370">if</span>&nbsp;<span class="ident" id="5351373">i</span>&nbsp;<span class="op" id="5351375">==</span>&nbsp;<span class="ident" id="5351378">start</span>&nbsp;<span class="op" id="5351384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5351389">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5351427">}</span>&nbsp;<span class="keyword" id="5351429">else</span>&nbsp;<span class="keyword" id="5351434">if</span>&nbsp;<span class="ident" id="5351437">i</span>&nbsp;<span class="op" id="5351439">==</span>&nbsp;<span class="ident" id="5351442">start</span><span class="op" id="5351447">+</span><span class="num" id="5351448">1</span>&nbsp;<span class="op" id="5351450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5351455">//&nbsp;Just&nbsp;one:&nbsp;don&#39;t&nbsp;bother&nbsp;factoring.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351495">out</span>&nbsp;<span class="op" id="5351499">=</span>&nbsp;<span class="builtinfunc" id="5351501">append</span><span class="op" id="5351507">(</span><span class="ident" id="5351508">out</span><span class="op" id="5351511">,</span>&nbsp;<span class="ident" id="5351513">sub</span><span class="op" id="5351516">[</span><span class="ident" id="5351517">start</span><span class="op" id="5351522">]</span><span class="op" id="5351523">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5351527">}</span>&nbsp;<span class="keyword" id="5351529">else</span>&nbsp;<span class="op" id="5351534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5351539">//&nbsp;Construct&nbsp;factored&nbsp;form:&nbsp;prefix(suffix1|suffix2|...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351598">prefix</span>&nbsp;<span class="op" id="5351605">:=</span>&nbsp;<span class="ident" id="5351608">p</span><span class="op" id="5351609">.</span><span class="ident" id="5351610">newRegexp</span><span class="op" id="5351619">(</span><span class="ident" id="5351620">OpLiteral</span><span class="op" id="5351629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351634">prefix</span><span class="op" id="5351640">.</span><span class="ident" id="5351641">Flags</span>&nbsp;<span class="op" id="5351647">=</span>&nbsp;<span class="ident" id="5351649">strflags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351661">prefix</span><span class="op" id="5351667">.</span><span class="ident" id="5351668">Rune</span>&nbsp;<span class="op" id="5351673">=</span>&nbsp;<span class="builtinfunc" id="5351675">append</span><span class="op" id="5351681">(</span><span class="ident" id="5351682">prefix</span><span class="op" id="5351688">.</span><span class="ident" id="5351689">Rune</span><span class="op" id="5351693">[</span><span class="op" id="5351694">:</span><span class="num" id="5351695">0</span><span class="op" id="5351696">]</span><span class="op" id="5351697">,</span>&nbsp;<span class="ident" id="5351699">str</span><span class="op" id="5351702">...</span><span class="op" id="5351705">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5351711">for</span>&nbsp;<span class="ident" id="5351715">j</span>&nbsp;<span class="op" id="5351717">:=</span>&nbsp;<span class="ident" id="5351720">start</span><span class="op" id="5351725">;</span>&nbsp;<span class="ident" id="5351727">j</span>&nbsp;<span class="op" id="5351729">&lt;</span>&nbsp;<span class="ident" id="5351731">i</span><span class="op" id="5351732">;</span>&nbsp;<span class="ident" id="5351734">j</span><span class="op" id="5351735">++</span>&nbsp;<span class="op" id="5351738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351744">sub</span><span class="op" id="5351747">[</span><span class="ident" id="5351748">j</span><span class="op" id="5351749">]</span>&nbsp;<span class="op" id="5351751">=</span>&nbsp;<span class="ident" id="5351753">p</span><span class="op" id="5351754">.</span><span class="ident" id="5351755">removeLeadingString</span><span class="op" id="5351774">(</span><span class="ident" id="5351775">sub</span><span class="op" id="5351778">[</span><span class="ident" id="5351779">j</span><span class="op" id="5351780">]</span><span class="op" id="5351781">,</span>&nbsp;<span class="builtinfunc" id="5351783">len</span><span class="op" id="5351786">(</span><span class="ident" id="5351787">str</span><span class="op" id="5351790">)</span><span class="op" id="5351791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5351796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351801">suffix</span>&nbsp;<span class="op" id="5351808">:=</span>&nbsp;<span class="ident" id="5351811">p</span><span class="op" id="5351812">.</span><span class="ident" id="5351813">collapse</span><span class="op" id="5351821">(</span><span class="ident" id="5351822">sub</span><span class="op" id="5351825">[</span><span class="ident" id="5351826">start</span><span class="op" id="5351831">:</span><span class="ident" id="5351832">i</span><span class="op" id="5351833">]</span><span class="op" id="5351834">,</span>&nbsp;<span class="ident" id="5351836">OpAlternate</span><span class="op" id="5351847">)</span>&nbsp;<span class="comment" id="5351849">//&nbsp;recurse</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351864">re</span>&nbsp;<span class="op" id="5351867">:=</span>&nbsp;<span class="ident" id="5351870">p</span><span class="op" id="5351871">.</span><span class="ident" id="5351872">newRegexp</span><span class="op" id="5351881">(</span><span class="ident" id="5351882">OpConcat</span><span class="op" id="5351890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351895">re</span><span class="op" id="5351897">.</span><span class="ident" id="5351898">Sub</span>&nbsp;<span class="op" id="5351902">=</span>&nbsp;<span class="builtinfunc" id="5351904">append</span><span class="op" id="5351910">(</span><span class="ident" id="5351911">re</span><span class="op" id="5351913">.</span><span class="ident" id="5351914">Sub</span><span class="op" id="5351917">[</span><span class="op" id="5351918">:</span><span class="num" id="5351919">0</span><span class="op" id="5351920">]</span><span class="op" id="5351921">,</span>&nbsp;<span class="ident" id="5351923">prefix</span><span class="op" id="5351929">,</span>&nbsp;<span class="ident" id="5351931">suffix</span><span class="op" id="5351937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351942">out</span>&nbsp;<span class="op" id="5351946">=</span>&nbsp;<span class="builtinfunc" id="5351948">append</span><span class="op" id="5351954">(</span><span class="ident" id="5351955">out</span><span class="op" id="5351958">,</span>&nbsp;<span class="ident" id="5351960">re</span><span class="op" id="5351962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5351966">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5351971">//&nbsp;Prepare&nbsp;for&nbsp;next&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5352004">start</span>&nbsp;<span class="op" id="5352010">=</span>&nbsp;<span class="ident" id="5352012">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5352016">str</span>&nbsp;<span class="op" id="5352020">=</span>&nbsp;<span class="ident" id="5352022">istr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5352029">strflags</span>&nbsp;<span class="op" id="5352038">=</span>&nbsp;<span class="ident" id="5352040">iflags</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5352048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5352051">sub</span>&nbsp;<span class="op" id="5352055">=</span>&nbsp;<span class="ident" id="5352057">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5352063">//&nbsp;Round&nbsp;2:&nbsp;Factor&nbsp;out&nbsp;common&nbsp;complex&nbsp;prefixes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5352112">//&nbsp;just&nbsp;the&nbsp;first&nbsp;piece&nbsp;of&nbsp;each&nbsp;concatenation,</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5352160">//&nbsp;whatever&nbsp;it&nbsp;is.&nbsp;&nbsp;This&nbsp;is&nbsp;good&nbsp;enough&nbsp;a&nbsp;lot&nbsp;of&nbsp;the&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5352220">start</span>&nbsp;<span class="op" id="5352226">=</span>&nbsp;<span class="num" id="5352228">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5352231">out</span>&nbsp;<span class="op" id="5352235">=</span>&nbsp;<span class="ident" id="5352237">sub</span><span class="op" id="5352240">[</span><span class="op" id="5352241">:</span><span class="num" id="5352242">0</span><span class="op" id="5352243">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5352246">var</span>&nbsp;<span class="ident" id="5352250">first</span>&nbsp;<span class="op" id="5352256">*</span><span class="ident" id="5352257">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5352265">for</span>&nbsp;<span class="ident" id="5352269">i</span>&nbsp;<span class="op" id="5352271">:=</span>&nbsp;<span class="num" id="5352274">0</span><span class="op" id="5352275">;</span>&nbsp;<span class="ident" id="5352277">i</span>&nbsp;<span class="op" id="5352279">&lt;=</span>&nbsp;<span class="builtinfunc" id="5352282">len</span><span class="op" id="5352285">(</span><span class="ident" id="5352286">sub</span><span class="op" id="5352289">)</span><span class="op" id="5352290">;</span>&nbsp;<span class="ident" id="5352292">i</span><span class="op" id="5352293">++</span>&nbsp;<span class="op" id="5352296">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5352300">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5352364">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5352431">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5352465">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5352470">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;all&nbsp;begin&nbsp;with&nbsp;ifirst.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5352547">var</span>&nbsp;<span class="ident" id="5352551">ifirst</span>&nbsp;<span class="op" id="5352558">*</span><span class="ident" id="5352559">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5352568">if</span>&nbsp;<span class="ident" id="5352571">i</span>&nbsp;<span class="op" id="5352573">&lt;</span>&nbsp;<span class="builtinfunc" id="5352575">len</span><span class="op" id="5352578">(</span><span class="ident" id="5352579">sub</span><span class="op" id="5352582">)</span>&nbsp;<span class="op" id="5352584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5352589">ifirst</span>&nbsp;<span class="op" id="5352596">=</span>&nbsp;<span class="ident" id="5352598">p</span><span class="op" id="5352599">.</span><span class="ident" id="5352600">leadingRegexp</span><span class="op" id="5352613">(</span><span class="ident" id="5352614">sub</span><span class="op" id="5352617">[</span><span class="ident" id="5352618">i</span><span class="op" id="5352619">]</span><span class="op" id="5352620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5352625">if</span>&nbsp;<span class="ident" id="5352628">first</span>&nbsp;<span class="op" id="5352634">!=</span>&nbsp;<span class="builtintype" id="5352637">nil</span>&nbsp;<span class="op" id="5352641">&amp;&amp;</span>&nbsp;<span class="ident" id="5352644">first</span><span class="op" id="5352649">.</span><span class="ident" id="5352650">Equal</span><span class="op" id="5352655">(</span><span class="ident" id="5352656">ifirst</span><span class="op" id="5352662">)</span>&nbsp;<span class="op" id="5352664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5352670">continue</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5352682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5352686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5352691">//&nbsp;Found&nbsp;end&nbsp;of&nbsp;a&nbsp;run&nbsp;with&nbsp;common&nbsp;leading&nbsp;regexp:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5352743">//&nbsp;sub[start:i]&nbsp;all&nbsp;begin&nbsp;with&nbsp;first&nbsp;but&nbsp;sub[i]&nbsp;does&nbsp;not.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5352803">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5352808">//&nbsp;Factor&nbsp;out&nbsp;common&nbsp;regexp&nbsp;and&nbsp;append&nbsp;factored&nbsp;expression&nbsp;to&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5352877">if</span>&nbsp;<span class="ident" id="5352880">i</span>&nbsp;<span class="op" id="5352882">==</span>&nbsp;<span class="ident" id="5352885">start</span>&nbsp;<span class="op" id="5352891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5352896">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5352934">}</span>&nbsp;<span class="keyword" id="5352936">else</span>&nbsp;<span class="keyword" id="5352941">if</span>&nbsp;<span class="ident" id="5352944">i</span>&nbsp;<span class="op" id="5352946">==</span>&nbsp;<span class="ident" id="5352949">start</span><span class="op" id="5352954">+</span><span class="num" id="5352955">1</span>&nbsp;<span class="op" id="5352957">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5352962">//&nbsp;Just&nbsp;one:&nbsp;don&#39;t&nbsp;bother&nbsp;factoring.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5353002">out</span>&nbsp;<span class="op" id="5353006">=</span>&nbsp;<span class="builtinfunc" id="5353008">append</span><span class="op" id="5353014">(</span><span class="ident" id="5353015">out</span><span class="op" id="5353018">,</span>&nbsp;<span class="ident" id="5353020">sub</span><span class="op" id="5353023">[</span><span class="ident" id="5353024">start</span><span class="op" id="5353029">]</span><span class="op" id="5353030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5353034">}</span>&nbsp;<span class="keyword" id="5353036">else</span>&nbsp;<span class="op" id="5353041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5353046">//&nbsp;Construct&nbsp;factored&nbsp;form:&nbsp;prefix(suffix1|suffix2|...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5353105">prefix</span>&nbsp;<span class="op" id="5353112">:=</span>&nbsp;<span class="ident" id="5353115">first</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5353124">for</span>&nbsp;<span class="ident" id="5353128">j</span>&nbsp;<span class="op" id="5353130">:=</span>&nbsp;<span class="ident" id="5353133">start</span><span class="op" id="5353138">;</span>&nbsp;<span class="ident" id="5353140">j</span>&nbsp;<span class="op" id="5353142">&lt;</span>&nbsp;<span class="ident" id="5353144">i</span><span class="op" id="5353145">;</span>&nbsp;<span class="ident" id="5353147">j</span><span class="op" id="5353148">++</span>&nbsp;<span class="op" id="5353151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5353157">reuse</span>&nbsp;<span class="op" id="5353163">:=</span>&nbsp;<span class="ident" id="5353166">j</span>&nbsp;<span class="op" id="5353168">!=</span>&nbsp;<span class="ident" id="5353171">start</span>&nbsp;<span class="comment" id="5353177">//&nbsp;prefix&nbsp;came&nbsp;from&nbsp;sub[start]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5353212">sub</span><span class="op" id="5353215">[</span><span class="ident" id="5353216">j</span><span class="op" id="5353217">]</span>&nbsp;<span class="op" id="5353219">=</span>&nbsp;<span class="ident" id="5353221">p</span><span class="op" id="5353222">.</span><span class="ident" id="5353223">removeLeadingRegexp</span><span class="op" id="5353242">(</span><span class="ident" id="5353243">sub</span><span class="op" id="5353246">[</span><span class="ident" id="5353247">j</span><span class="op" id="5353248">]</span><span class="op" id="5353249">,</span>&nbsp;<span class="ident" id="5353251">reuse</span><span class="op" id="5353256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5353261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5353266">suffix</span>&nbsp;<span class="op" id="5353273">:=</span>&nbsp;<span class="ident" id="5353276">p</span><span class="op" id="5353277">.</span><span class="ident" id="5353278">collapse</span><span class="op" id="5353286">(</span><span class="ident" id="5353287">sub</span><span class="op" id="5353290">[</span><span class="ident" id="5353291">start</span><span class="op" id="5353296">:</span><span class="ident" id="5353297">i</span><span class="op" id="5353298">]</span><span class="op" id="5353299">,</span>&nbsp;<span class="ident" id="5353301">OpAlternate</span><span class="op" id="5353312">)</span>&nbsp;<span class="comment" id="5353314">//&nbsp;recurse</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5353329">re</span>&nbsp;<span class="op" id="5353332">:=</span>&nbsp;<span class="ident" id="5353335">p</span><span class="op" id="5353336">.</span><span class="ident" id="5353337">newRegexp</span><span class="op" id="5353346">(</span><span class="ident" id="5353347">OpConcat</span><span class="op" id="5353355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5353360">re</span><span class="op" id="5353362">.</span><span class="ident" id="5353363">Sub</span>&nbsp;<span class="op" id="5353367">=</span>&nbsp;<span class="builtinfunc" id="5353369">append</span><span class="op" id="5353375">(</span><span class="ident" id="5353376">re</span><span class="op" id="5353378">.</span><span class="ident" id="5353379">Sub</span><span class="op" id="5353382">[</span><span class="op" id="5353383">:</span><span class="num" id="5353384">0</span><span class="op" id="5353385">]</span><span class="op" id="5353386">,</span>&nbsp;<span class="ident" id="5353388">prefix</span><span class="op" id="5353394">,</span>&nbsp;<span class="ident" id="5353396">suffix</span><span class="op" id="5353402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5353407">out</span>&nbsp;<span class="op" id="5353411">=</span>&nbsp;<span class="builtinfunc" id="5353413">append</span><span class="op" id="5353419">(</span><span class="ident" id="5353420">out</span><span class="op" id="5353423">,</span>&nbsp;<span class="ident" id="5353425">re</span><span class="op" id="5353427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5353431">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5353436">//&nbsp;Prepare&nbsp;for&nbsp;next&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5353469">start</span>&nbsp;<span class="op" id="5353475">=</span>&nbsp;<span class="ident" id="5353477">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5353481">first</span>&nbsp;<span class="op" id="5353487">=</span>&nbsp;<span class="ident" id="5353489">ifirst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5353497">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5353500">sub</span>&nbsp;<span class="op" id="5353504">=</span>&nbsp;<span class="ident" id="5353506">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5353512">//&nbsp;Round&nbsp;3:&nbsp;Collapse&nbsp;runs&nbsp;of&nbsp;single&nbsp;literals&nbsp;into&nbsp;character&nbsp;classes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5353582">start</span>&nbsp;<span class="op" id="5353588">=</span>&nbsp;<span class="num" id="5353590">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5353593">out</span>&nbsp;<span class="op" id="5353597">=</span>&nbsp;<span class="ident" id="5353599">sub</span><span class="op" id="5353602">[</span><span class="op" id="5353603">:</span><span class="num" id="5353604">0</span><span class="op" id="5353605">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5353608">for</span>&nbsp;<span class="ident" id="5353612">i</span>&nbsp;<span class="op" id="5353614">:=</span>&nbsp;<span class="num" id="5353617">0</span><span class="op" id="5353618">;</span>&nbsp;<span class="ident" id="5353620">i</span>&nbsp;<span class="op" id="5353622">&lt;=</span>&nbsp;<span class="builtinfunc" id="5353625">len</span><span class="op" id="5353628">(</span><span class="ident" id="5353629">sub</span><span class="op" id="5353632">)</span><span class="op" id="5353633">;</span>&nbsp;<span class="ident" id="5353635">i</span><span class="op" id="5353636">++</span>&nbsp;<span class="op" id="5353639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5353643">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5353707">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5353774">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5353808">//</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5353813">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;are&nbsp;either</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5353878">//&nbsp;literal&nbsp;runes&nbsp;or&nbsp;character&nbsp;classes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5353919">if</span>&nbsp;<span class="ident" id="5353922">i</span>&nbsp;<span class="op" id="5353924">&lt;</span>&nbsp;<span class="builtinfunc" id="5353926">len</span><span class="op" id="5353929">(</span><span class="ident" id="5353930">sub</span><span class="op" id="5353933">)</span>&nbsp;<span class="op" id="5353935">&amp;&amp;</span>&nbsp;<span class="ident" id="5353938">isCharClass</span><span class="op" id="5353949">(</span><span class="ident" id="5353950">sub</span><span class="op" id="5353953">[</span><span class="ident" id="5353954">i</span><span class="op" id="5353955">]</span><span class="op" id="5353956">)</span>&nbsp;<span class="op" id="5353958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5353963">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5353974">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5353979">//&nbsp;sub[i]&nbsp;is&nbsp;not&nbsp;a&nbsp;char&nbsp;or&nbsp;char&nbsp;class;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5354020">//&nbsp;emit&nbsp;char&nbsp;class&nbsp;for&nbsp;sub[start:i]...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5354061">if</span>&nbsp;<span class="ident" id="5354064">i</span>&nbsp;<span class="op" id="5354066">==</span>&nbsp;<span class="ident" id="5354069">start</span>&nbsp;<span class="op" id="5354075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5354080">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5354118">}</span>&nbsp;<span class="keyword" id="5354120">else</span>&nbsp;<span class="keyword" id="5354125">if</span>&nbsp;<span class="ident" id="5354128">i</span>&nbsp;<span class="op" id="5354130">==</span>&nbsp;<span class="ident" id="5354133">start</span><span class="op" id="5354138">+</span><span class="num" id="5354139">1</span>&nbsp;<span class="op" id="5354141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5354146">out</span>&nbsp;<span class="op" id="5354150">=</span>&nbsp;<span class="builtinfunc" id="5354152">append</span><span class="op" id="5354158">(</span><span class="ident" id="5354159">out</span><span class="op" id="5354162">,</span>&nbsp;<span class="ident" id="5354164">sub</span><span class="op" id="5354167">[</span><span class="ident" id="5354168">start</span><span class="op" id="5354173">]</span><span class="op" id="5354174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5354178">}</span>&nbsp;<span class="keyword" id="5354180">else</span>&nbsp;<span class="op" id="5354185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5354190">//&nbsp;Make&nbsp;new&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5354217">//&nbsp;Start&nbsp;with&nbsp;most&nbsp;complex&nbsp;regexp&nbsp;in&nbsp;sub[start].</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5354269">max</span>&nbsp;<span class="op" id="5354273">:=</span>&nbsp;<span class="ident" id="5354276">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5354285">for</span>&nbsp;<span class="ident" id="5354289">j</span>&nbsp;<span class="op" id="5354291">:=</span>&nbsp;<span class="ident" id="5354294">start</span>&nbsp;<span class="op" id="5354300">+</span>&nbsp;<span class="num" id="5354302">1</span><span class="op" id="5354303">;</span>&nbsp;<span class="ident" id="5354305">j</span>&nbsp;<span class="op" id="5354307">&lt;</span>&nbsp;<span class="ident" id="5354309">i</span><span class="op" id="5354310">;</span>&nbsp;<span class="ident" id="5354312">j</span><span class="op" id="5354313">++</span>&nbsp;<span class="op" id="5354316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5354322">if</span>&nbsp;<span class="ident" id="5354325">sub</span><span class="op" id="5354328">[</span><span class="ident" id="5354329">max</span><span class="op" id="5354332">]</span><span class="op" id="5354333">.</span><span class="ident" id="5354334">Op</span>&nbsp;<span class="op" id="5354337">&lt;</span>&nbsp;<span class="ident" id="5354339">sub</span><span class="op" id="5354342">[</span><span class="ident" id="5354343">j</span><span class="op" id="5354344">]</span><span class="op" id="5354345">.</span><span class="ident" id="5354346">Op</span>&nbsp;<span class="op" id="5354349">||</span>&nbsp;<span class="ident" id="5354352">sub</span><span class="op" id="5354355">[</span><span class="ident" id="5354356">max</span><span class="op" id="5354359">]</span><span class="op" id="5354360">.</span><span class="ident" id="5354361">Op</span>&nbsp;<span class="op" id="5354364">==</span>&nbsp;<span class="ident" id="5354367">sub</span><span class="op" id="5354370">[</span><span class="ident" id="5354371">j</span><span class="op" id="5354372">]</span><span class="op" id="5354373">.</span><span class="ident" id="5354374">Op</span>&nbsp;<span class="op" id="5354377">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5354380">len</span><span class="op" id="5354383">(</span><span class="ident" id="5354384">sub</span><span class="op" id="5354387">[</span><span class="ident" id="5354388">max</span><span class="op" id="5354391">]</span><span class="op" id="5354392">.</span><span class="ident" id="5354393">Rune</span><span class="op" id="5354397">)</span>&nbsp;<span class="op" id="5354399">&lt;</span>&nbsp;<span class="builtinfunc" id="5354401">len</span><span class="op" id="5354404">(</span><span class="ident" id="5354405">sub</span><span class="op" id="5354408">[</span><span class="ident" id="5354409">j</span><span class="op" id="5354410">]</span><span class="op" id="5354411">.</span><span class="ident" id="5354412">Rune</span><span class="op" id="5354416">)</span>&nbsp;<span class="op" id="5354418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5354425">max</span>&nbsp;<span class="op" id="5354429">=</span>&nbsp;<span class="ident" id="5354431">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5354437">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5354442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5354447">sub</span><span class="op" id="5354450">[</span><span class="ident" id="5354451">start</span><span class="op" id="5354456">]</span><span class="op" id="5354457">,</span>&nbsp;<span class="ident" id="5354459">sub</span><span class="op" id="5354462">[</span><span class="ident" id="5354463">max</span><span class="op" id="5354466">]</span>&nbsp;<span class="op" id="5354468">=</span>&nbsp;<span class="ident" id="5354470">sub</span><span class="op" id="5354473">[</span><span class="ident" id="5354474">max</span><span class="op" id="5354477">]</span><span class="op" id="5354478">,</span>&nbsp;<span class="ident" id="5354480">sub</span><span class="op" id="5354483">[</span><span class="ident" id="5354484">start</span><span class="op" id="5354489">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5354495">for</span>&nbsp;<span class="ident" id="5354499">j</span>&nbsp;<span class="op" id="5354501">:=</span>&nbsp;<span class="ident" id="5354504">start</span>&nbsp;<span class="op" id="5354510">+</span>&nbsp;<span class="num" id="5354512">1</span><span class="op" id="5354513">;</span>&nbsp;<span class="ident" id="5354515">j</span>&nbsp;<span class="op" id="5354517">&lt;</span>&nbsp;<span class="ident" id="5354519">i</span><span class="op" id="5354520">;</span>&nbsp;<span class="ident" id="5354522">j</span><span class="op" id="5354523">++</span>&nbsp;<span class="op" id="5354526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5354532">mergeCharClass</span><span class="op" id="5354546">(</span><span class="ident" id="5354547">sub</span><span class="op" id="5354550">[</span><span class="ident" id="5354551">start</span><span class="op" id="5354556">]</span><span class="op" id="5354557">,</span>&nbsp;<span class="ident" id="5354559">sub</span><span class="op" id="5354562">[</span><span class="ident" id="5354563">j</span><span class="op" id="5354564">]</span><span class="op" id="5354565">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5354571">p</span><span class="op" id="5354572">.</span><span class="ident" id="5354573">reuse</span><span class="op" id="5354578">(</span><span class="ident" id="5354579">sub</span><span class="op" id="5354582">[</span><span class="ident" id="5354583">j</span><span class="op" id="5354584">]</span><span class="op" id="5354585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5354590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5354595">cleanAlt</span><span class="op" id="5354603">(</span><span class="ident" id="5354604">sub</span><span class="op" id="5354607">[</span><span class="ident" id="5354608">start</span><span class="op" id="5354613">]</span><span class="op" id="5354614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5354619">out</span>&nbsp;<span class="op" id="5354623">=</span>&nbsp;<span class="builtinfunc" id="5354625">append</span><span class="op" id="5354631">(</span><span class="ident" id="5354632">out</span><span class="op" id="5354635">,</span>&nbsp;<span class="ident" id="5354637">sub</span><span class="op" id="5354640">[</span><span class="ident" id="5354641">start</span><span class="op" id="5354646">]</span><span class="op" id="5354647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5354651">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5354656">//&nbsp;...&nbsp;and&nbsp;then&nbsp;emit&nbsp;sub[i].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5354687">if</span>&nbsp;<span class="ident" id="5354690">i</span>&nbsp;<span class="op" id="5354692">&lt;</span>&nbsp;<span class="builtinfunc" id="5354694">len</span><span class="op" id="5354697">(</span><span class="ident" id="5354698">sub</span><span class="op" id="5354701">)</span>&nbsp;<span class="op" id="5354703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5354708">out</span>&nbsp;<span class="op" id="5354712">=</span>&nbsp;<span class="builtinfunc" id="5354714">append</span><span class="op" id="5354720">(</span><span class="ident" id="5354721">out</span><span class="op" id="5354724">,</span>&nbsp;<span class="ident" id="5354726">sub</span><span class="op" id="5354729">[</span><span class="ident" id="5354730">i</span><span class="op" id="5354731">]</span><span class="op" id="5354732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5354736">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5354740">start</span>&nbsp;<span class="op" id="5354746">=</span>&nbsp;<span class="ident" id="5354748">i</span>&nbsp;<span class="op" id="5354750">+</span>&nbsp;<span class="num" id="5354752">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5354755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5354758">sub</span>&nbsp;<span class="op" id="5354762">=</span>&nbsp;<span class="ident" id="5354764">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5354770">//&nbsp;Round&nbsp;4:&nbsp;Collapse&nbsp;runs&nbsp;of&nbsp;empty&nbsp;matches&nbsp;into&nbsp;a&nbsp;single&nbsp;empty&nbsp;match.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5354841">start</span>&nbsp;<span class="op" id="5354847">=</span>&nbsp;<span class="num" id="5354849">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5354852">out</span>&nbsp;<span class="op" id="5354856">=</span>&nbsp;<span class="ident" id="5354858">sub</span><span class="op" id="5354861">[</span><span class="op" id="5354862">:</span><span class="num" id="5354863">0</span><span class="op" id="5354864">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5354867">for</span>&nbsp;<span class="ident" id="5354871">i</span>&nbsp;<span class="op" id="5354873">:=</span>&nbsp;<span class="keyword" id="5354876">range</span>&nbsp;<span class="ident" id="5354882">sub</span>&nbsp;<span class="op" id="5354886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5354890">if</span>&nbsp;<span class="ident" id="5354893">i</span><span class="op" id="5354894">+</span><span class="num" id="5354895">1</span>&nbsp;<span class="op" id="5354897">&lt;</span>&nbsp;<span class="builtinfunc" id="5354899">len</span><span class="op" id="5354902">(</span><span class="ident" id="5354903">sub</span><span class="op" id="5354906">)</span>&nbsp;<span class="op" id="5354908">&amp;&amp;</span>&nbsp;<span class="ident" id="5354911">sub</span><span class="op" id="5354914">[</span><span class="ident" id="5354915">i</span><span class="op" id="5354916">]</span><span class="op" id="5354917">.</span><span class="ident" id="5354918">Op</span>&nbsp;<span class="op" id="5354921">==</span>&nbsp;<span class="ident" id="5354924">OpEmptyMatch</span>&nbsp;<span class="op" id="5354937">&amp;&amp;</span>&nbsp;<span class="ident" id="5354940">sub</span><span class="op" id="5354943">[</span><span class="ident" id="5354944">i</span><span class="op" id="5354945">+</span><span class="num" id="5354946">1</span><span class="op" id="5354947">]</span><span class="op" id="5354948">.</span><span class="ident" id="5354949">Op</span>&nbsp;<span class="op" id="5354952">==</span>&nbsp;<span class="ident" id="5354955">OpEmptyMatch</span>&nbsp;<span class="op" id="5354968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5354973">continue</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5354984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5354988">out</span>&nbsp;<span class="op" id="5354992">=</span>&nbsp;<span class="builtinfunc" id="5354994">append</span><span class="op" id="5355000">(</span><span class="ident" id="5355001">out</span><span class="op" id="5355004">,</span>&nbsp;<span class="ident" id="5355006">sub</span><span class="op" id="5355009">[</span><span class="ident" id="5355010">i</span><span class="op" id="5355011">]</span><span class="op" id="5355012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5355015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355018">sub</span>&nbsp;<span class="op" id="5355022">=</span>&nbsp;<span class="ident" id="5355024">out</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5355030">return</span>&nbsp;<span class="ident" id="5355037">sub</span><br>
<span class="lineno"></span><span class="op" id="5355041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5355044">//&nbsp;leadingString&nbsp;returns&nbsp;the&nbsp;leading&nbsp;literal&nbsp;string&nbsp;that&nbsp;re&nbsp;begins&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="5355117">//&nbsp;The&nbsp;string&nbsp;refers&nbsp;to&nbsp;storage&nbsp;in&nbsp;re&nbsp;or&nbsp;its&nbsp;children.</span><br>
<span class="lineno">585</span><span class="keyword" id="5355172">func</span>&nbsp;<span class="op" id="5355177">(</span><span class="ident" id="5355178">p</span>&nbsp;<span class="op" id="5355180">*</span><span class="ident" id="5355181">parser</span><span class="op" id="5355187">)</span>&nbsp;<span class="ident" id="5355189">leadingString</span><span class="op" id="5355202">(</span><span class="ident" id="5355203">re</span>&nbsp;<span class="op" id="5355206">*</span><span class="ident" id="5355207">Regexp</span><span class="op" id="5355213">)</span>&nbsp;<span class="op" id="5355215">(</span><span class="op" id="5355216">[</span><span class="op" id="5355217">]</span><span class="builtintype" id="5355218">rune</span><span class="op" id="5355222">,</span>&nbsp;<span class="ident" id="5355224">Flags</span><span class="op" id="5355229">)</span>&nbsp;<span class="op" id="5355231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5355234">if</span>&nbsp;<span class="ident" id="5355237">re</span><span class="op" id="5355239">.</span><span class="ident" id="5355240">Op</span>&nbsp;<span class="op" id="5355243">==</span>&nbsp;<span class="ident" id="5355246">OpConcat</span>&nbsp;<span class="op" id="5355255">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5355258">len</span><span class="op" id="5355261">(</span><span class="ident" id="5355262">re</span><span class="op" id="5355264">.</span><span class="ident" id="5355265">Sub</span><span class="op" id="5355268">)</span>&nbsp;<span class="op" id="5355270">&gt;</span>&nbsp;<span class="num" id="5355272">0</span>&nbsp;<span class="op" id="5355274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355278">re</span>&nbsp;<span class="op" id="5355281">=</span>&nbsp;<span class="ident" id="5355283">re</span><span class="op" id="5355285">.</span><span class="ident" id="5355286">Sub</span><span class="op" id="5355289">[</span><span class="num" id="5355290">0</span><span class="op" id="5355291">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5355294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5355297">if</span>&nbsp;<span class="ident" id="5355300">re</span><span class="op" id="5355302">.</span><span class="ident" id="5355303">Op</span>&nbsp;<span class="op" id="5355306">!=</span>&nbsp;<span class="ident" id="5355309">OpLiteral</span>&nbsp;<span class="op" id="5355319">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5355323">return</span>&nbsp;<span class="builtintype" id="5355330">nil</span><span class="op" id="5355333">,</span>&nbsp;<span class="num" id="5355335">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5355338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5355341">return</span>&nbsp;<span class="ident" id="5355348">re</span><span class="op" id="5355350">.</span><span class="ident" id="5355351">Rune</span><span class="op" id="5355355">,</span>&nbsp;<span class="ident" id="5355357">re</span><span class="op" id="5355359">.</span><span class="ident" id="5355360">Flags</span>&nbsp;<span class="op" id="5355366">&amp;</span>&nbsp;<span class="ident" id="5355368">FoldCase</span><br>
<span class="lineno"></span><span class="op" id="5355377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="5355380">//&nbsp;removeLeadingString&nbsp;removes&nbsp;the&nbsp;first&nbsp;n&nbsp;leading&nbsp;runes</span><br>
<span class="lineno"></span><span class="comment" id="5355437">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;re.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;replacement&nbsp;for&nbsp;re.</span><br>
<span class="lineno"></span><span class="keyword" id="5355502">func</span>&nbsp;<span class="op" id="5355507">(</span><span class="ident" id="5355508">p</span>&nbsp;<span class="op" id="5355510">*</span><span class="ident" id="5355511">parser</span><span class="op" id="5355517">)</span>&nbsp;<span class="ident" id="5355519">removeLeadingString</span><span class="op" id="5355538">(</span><span class="ident" id="5355539">re</span>&nbsp;<span class="op" id="5355542">*</span><span class="ident" id="5355543">Regexp</span><span class="op" id="5355549">,</span>&nbsp;<span class="ident" id="5355551">n</span>&nbsp;<span class="builtintype" id="5355553">int</span><span class="op" id="5355556">)</span>&nbsp;<span class="op" id="5355558">*</span><span class="ident" id="5355559">Regexp</span>&nbsp;<span class="op" id="5355566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5355569">if</span>&nbsp;<span class="ident" id="5355572">re</span><span class="op" id="5355574">.</span><span class="ident" id="5355575">Op</span>&nbsp;<span class="op" id="5355578">==</span>&nbsp;<span class="ident" id="5355581">OpConcat</span>&nbsp;<span class="op" id="5355590">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5355593">len</span><span class="op" id="5355596">(</span><span class="ident" id="5355597">re</span><span class="op" id="5355599">.</span><span class="ident" id="5355600">Sub</span><span class="op" id="5355603">)</span>&nbsp;<span class="op" id="5355605">&gt;</span>&nbsp;<span class="num" id="5355607">0</span>&nbsp;<span class="op" id="5355609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5355613">//&nbsp;Removing&nbsp;a&nbsp;leading&nbsp;string&nbsp;in&nbsp;a&nbsp;concatenation</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5355663">//&nbsp;might&nbsp;simplify&nbsp;the&nbsp;concatenation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355702">sub</span>&nbsp;<span class="op" id="5355706">:=</span>&nbsp;<span class="ident" id="5355709">re</span><span class="op" id="5355711">.</span><span class="ident" id="5355712">Sub</span><span class="op" id="5355715">[</span><span class="num" id="5355716">0</span><span class="op" id="5355717">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355721">sub</span>&nbsp;<span class="op" id="5355725">=</span>&nbsp;<span class="ident" id="5355727">p</span><span class="op" id="5355728">.</span><span class="ident" id="5355729">removeLeadingString</span><span class="op" id="5355748">(</span><span class="ident" id="5355749">sub</span><span class="op" id="5355752">,</span>&nbsp;<span class="ident" id="5355754">n</span><span class="op" id="5355755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355759">re</span><span class="op" id="5355761">.</span><span class="ident" id="5355762">Sub</span><span class="op" id="5355765">[</span><span class="num" id="5355766">0</span><span class="op" id="5355767">]</span>&nbsp;<span class="op" id="5355769">=</span>&nbsp;<span class="ident" id="5355771">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5355777">if</span>&nbsp;<span class="ident" id="5355780">sub</span><span class="op" id="5355783">.</span><span class="ident" id="5355784">Op</span>&nbsp;<span class="op" id="5355787">==</span>&nbsp;<span class="ident" id="5355790">OpEmptyMatch</span>&nbsp;<span class="op" id="5355803">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355808">p</span><span class="op" id="5355809">.</span><span class="ident" id="5355810">reuse</span><span class="op" id="5355815">(</span><span class="ident" id="5355816">sub</span><span class="op" id="5355819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5355824">switch</span>&nbsp;<span class="builtinfunc" id="5355831">len</span><span class="op" id="5355834">(</span><span class="ident" id="5355835">re</span><span class="op" id="5355837">.</span><span class="ident" id="5355838">Sub</span><span class="op" id="5355841">)</span>&nbsp;<span class="op" id="5355843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5355848">case</span>&nbsp;<span class="num" id="5355853">0</span><span class="op" id="5355854">,</span>&nbsp;<span class="num" id="5355856">1</span><span class="op" id="5355857">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5355863">//&nbsp;Impossible&nbsp;but&nbsp;handle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355893">re</span><span class="op" id="5355895">.</span><span class="ident" id="5355896">Op</span>&nbsp;<span class="op" id="5355899">=</span>&nbsp;<span class="ident" id="5355901">OpEmptyMatch</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355918">re</span><span class="op" id="5355920">.</span><span class="ident" id="5355921">Sub</span>&nbsp;<span class="op" id="5355925">=</span>&nbsp;<span class="builtintype" id="5355927">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5355934">case</span>&nbsp;<span class="num" id="5355939">2</span><span class="op" id="5355940">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355946">old</span>&nbsp;<span class="op" id="5355950">:=</span>&nbsp;<span class="ident" id="5355953">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355960">re</span>&nbsp;<span class="op" id="5355963">=</span>&nbsp;<span class="ident" id="5355965">re</span><span class="op" id="5355967">.</span><span class="ident" id="5355968">Sub</span><span class="op" id="5355971">[</span><span class="num" id="5355972">1</span><span class="op" id="5355973">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5355979">p</span><span class="op" id="5355980">.</span><span class="ident" id="5355981">reuse</span><span class="op" id="5355986">(</span><span class="ident" id="5355987">old</span><span class="op" id="5355990">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5355995">default</span><span class="op" id="5356002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5356008">copy</span><span class="op" id="5356012">(</span><span class="ident" id="5356013">re</span><span class="op" id="5356015">.</span><span class="ident" id="5356016">Sub</span><span class="op" id="5356019">,</span>&nbsp;<span class="ident" id="5356021">re</span><span class="op" id="5356023">.</span><span class="ident" id="5356024">Sub</span><span class="op" id="5356027">[</span><span class="num" id="5356028">1</span><span class="op" id="5356029">:</span><span class="op" id="5356030">]</span><span class="op" id="5356031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356037">re</span><span class="op" id="5356039">.</span><span class="ident" id="5356040">Sub</span>&nbsp;<span class="op" id="5356044">=</span>&nbsp;<span class="ident" id="5356046">re</span><span class="op" id="5356048">.</span><span class="ident" id="5356049">Sub</span><span class="op" id="5356052">[</span><span class="op" id="5356053">:</span><span class="builtinfunc" id="5356054">len</span><span class="op" id="5356057">(</span><span class="ident" id="5356058">re</span><span class="op" id="5356060">.</span><span class="ident" id="5356061">Sub</span><span class="op" id="5356064">)</span><span class="op" id="5356065">-</span><span class="num" id="5356066">1</span><span class="op" id="5356067">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5356072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5356076">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356080">return</span>&nbsp;<span class="ident" id="5356087">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5356091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356095">if</span>&nbsp;<span class="ident" id="5356098">re</span><span class="op" id="5356100">.</span><span class="ident" id="5356101">Op</span>&nbsp;<span class="op" id="5356104">==</span>&nbsp;<span class="ident" id="5356107">OpLiteral</span>&nbsp;<span class="op" id="5356117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356121">re</span><span class="op" id="5356123">.</span><span class="ident" id="5356124">Rune</span>&nbsp;<span class="op" id="5356129">=</span>&nbsp;<span class="ident" id="5356131">re</span><span class="op" id="5356133">.</span><span class="ident" id="5356134">Rune</span><span class="op" id="5356138">[</span><span class="op" id="5356139">:</span><span class="builtinfunc" id="5356140">copy</span><span class="op" id="5356144">(</span><span class="ident" id="5356145">re</span><span class="op" id="5356147">.</span><span class="ident" id="5356148">Rune</span><span class="op" id="5356152">,</span>&nbsp;<span class="ident" id="5356154">re</span><span class="op" id="5356156">.</span><span class="ident" id="5356157">Rune</span><span class="op" id="5356161">[</span><span class="ident" id="5356162">n</span><span class="op" id="5356163">:</span><span class="op" id="5356164">]</span><span class="op" id="5356165">)</span><span class="op" id="5356166">]</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356170">if</span>&nbsp;<span class="builtinfunc" id="5356173">len</span><span class="op" id="5356176">(</span><span class="ident" id="5356177">re</span><span class="op" id="5356179">.</span><span class="ident" id="5356180">Rune</span><span class="op" id="5356184">)</span>&nbsp;<span class="op" id="5356186">==</span>&nbsp;<span class="num" id="5356189">0</span>&nbsp;<span class="op" id="5356191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356196">re</span><span class="op" id="5356198">.</span><span class="ident" id="5356199">Op</span>&nbsp;<span class="op" id="5356202">=</span>&nbsp;<span class="ident" id="5356204">OpEmptyMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5356219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5356222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356225">return</span>&nbsp;<span class="ident" id="5356232">re</span><br>
<span class="lineno">630</span><span class="op" id="5356235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5356238">//&nbsp;leadingRegexp&nbsp;returns&nbsp;the&nbsp;leading&nbsp;regexp&nbsp;that&nbsp;re&nbsp;begins&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="5356303">//&nbsp;The&nbsp;regexp&nbsp;refers&nbsp;to&nbsp;storage&nbsp;in&nbsp;re&nbsp;or&nbsp;its&nbsp;children.</span><br>
<span class="lineno"></span><span class="keyword" id="5356358">func</span>&nbsp;<span class="op" id="5356363">(</span><span class="ident" id="5356364">p</span>&nbsp;<span class="op" id="5356366">*</span><span class="ident" id="5356367">parser</span><span class="op" id="5356373">)</span>&nbsp;<span class="ident" id="5356375">leadingRegexp</span><span class="op" id="5356388">(</span><span class="ident" id="5356389">re</span>&nbsp;<span class="op" id="5356392">*</span><span class="ident" id="5356393">Regexp</span><span class="op" id="5356399">)</span>&nbsp;<span class="op" id="5356401">*</span><span class="ident" id="5356402">Regexp</span>&nbsp;<span class="op" id="5356409">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356412">if</span>&nbsp;<span class="ident" id="5356415">re</span><span class="op" id="5356417">.</span><span class="ident" id="5356418">Op</span>&nbsp;<span class="op" id="5356421">==</span>&nbsp;<span class="ident" id="5356424">OpEmptyMatch</span>&nbsp;<span class="op" id="5356437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356441">return</span>&nbsp;<span class="builtintype" id="5356448">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5356453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356456">if</span>&nbsp;<span class="ident" id="5356459">re</span><span class="op" id="5356461">.</span><span class="ident" id="5356462">Op</span>&nbsp;<span class="op" id="5356465">==</span>&nbsp;<span class="ident" id="5356468">OpConcat</span>&nbsp;<span class="op" id="5356477">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5356480">len</span><span class="op" id="5356483">(</span><span class="ident" id="5356484">re</span><span class="op" id="5356486">.</span><span class="ident" id="5356487">Sub</span><span class="op" id="5356490">)</span>&nbsp;<span class="op" id="5356492">&gt;</span>&nbsp;<span class="num" id="5356494">0</span>&nbsp;<span class="op" id="5356496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356500">sub</span>&nbsp;<span class="op" id="5356504">:=</span>&nbsp;<span class="ident" id="5356507">re</span><span class="op" id="5356509">.</span><span class="ident" id="5356510">Sub</span><span class="op" id="5356513">[</span><span class="num" id="5356514">0</span><span class="op" id="5356515">]</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356519">if</span>&nbsp;<span class="ident" id="5356522">sub</span><span class="op" id="5356525">.</span><span class="ident" id="5356526">Op</span>&nbsp;<span class="op" id="5356529">==</span>&nbsp;<span class="ident" id="5356532">OpEmptyMatch</span>&nbsp;<span class="op" id="5356545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356550">return</span>&nbsp;<span class="builtintype" id="5356557">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5356563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356567">return</span>&nbsp;<span class="ident" id="5356574">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5356579">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356582">return</span>&nbsp;<span class="ident" id="5356589">re</span><br>
<span class="lineno"></span><span class="op" id="5356592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5356595">//&nbsp;removeLeadingRegexp&nbsp;removes&nbsp;the&nbsp;leading&nbsp;regexp&nbsp;in&nbsp;re.</span><br>
<span class="lineno"></span><span class="comment" id="5356652">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;replacement&nbsp;for&nbsp;re.</span><br>
<span class="lineno">650</span><span class="comment" id="5356690">//&nbsp;If&nbsp;reuse&nbsp;is&nbsp;true,&nbsp;it&nbsp;passes&nbsp;the&nbsp;removed&nbsp;regexp&nbsp;(if&nbsp;no&nbsp;longer&nbsp;needed)&nbsp;to&nbsp;p.reuse.</span><br>
<span class="lineno"></span><span class="keyword" id="5356774">func</span>&nbsp;<span class="op" id="5356779">(</span><span class="ident" id="5356780">p</span>&nbsp;<span class="op" id="5356782">*</span><span class="ident" id="5356783">parser</span><span class="op" id="5356789">)</span>&nbsp;<span class="ident" id="5356791">removeLeadingRegexp</span><span class="op" id="5356810">(</span><span class="ident" id="5356811">re</span>&nbsp;<span class="op" id="5356814">*</span><span class="ident" id="5356815">Regexp</span><span class="op" id="5356821">,</span>&nbsp;<span class="ident" id="5356823">reuse</span>&nbsp;<span class="builtintype" id="5356829">bool</span><span class="op" id="5356833">)</span>&nbsp;<span class="op" id="5356835">*</span><span class="ident" id="5356836">Regexp</span>&nbsp;<span class="op" id="5356843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356846">if</span>&nbsp;<span class="ident" id="5356849">re</span><span class="op" id="5356851">.</span><span class="ident" id="5356852">Op</span>&nbsp;<span class="op" id="5356855">==</span>&nbsp;<span class="ident" id="5356858">OpConcat</span>&nbsp;<span class="op" id="5356867">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5356870">len</span><span class="op" id="5356873">(</span><span class="ident" id="5356874">re</span><span class="op" id="5356876">.</span><span class="ident" id="5356877">Sub</span><span class="op" id="5356880">)</span>&nbsp;<span class="op" id="5356882">&gt;</span>&nbsp;<span class="num" id="5356884">0</span>&nbsp;<span class="op" id="5356886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356890">if</span>&nbsp;<span class="ident" id="5356893">reuse</span>&nbsp;<span class="op" id="5356899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356904">p</span><span class="op" id="5356905">.</span><span class="ident" id="5356906">reuse</span><span class="op" id="5356911">(</span><span class="ident" id="5356912">re</span><span class="op" id="5356914">.</span><span class="ident" id="5356915">Sub</span><span class="op" id="5356918">[</span><span class="num" id="5356919">0</span><span class="op" id="5356920">]</span><span class="op" id="5356921">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5356925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5356929">re</span><span class="op" id="5356931">.</span><span class="ident" id="5356932">Sub</span>&nbsp;<span class="op" id="5356936">=</span>&nbsp;<span class="ident" id="5356938">re</span><span class="op" id="5356940">.</span><span class="ident" id="5356941">Sub</span><span class="op" id="5356944">[</span><span class="op" id="5356945">:</span><span class="builtinfunc" id="5356946">copy</span><span class="op" id="5356950">(</span><span class="ident" id="5356951">re</span><span class="op" id="5356953">.</span><span class="ident" id="5356954">Sub</span><span class="op" id="5356957">,</span>&nbsp;<span class="ident" id="5356959">re</span><span class="op" id="5356961">.</span><span class="ident" id="5356962">Sub</span><span class="op" id="5356965">[</span><span class="num" id="5356966">1</span><span class="op" id="5356967">:</span><span class="op" id="5356968">]</span><span class="op" id="5356969">)</span><span class="op" id="5356970">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356974">switch</span>&nbsp;<span class="builtinfunc" id="5356981">len</span><span class="op" id="5356984">(</span><span class="ident" id="5356985">re</span><span class="op" id="5356987">.</span><span class="ident" id="5356988">Sub</span><span class="op" id="5356991">)</span>&nbsp;<span class="op" id="5356993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5356997">case</span>&nbsp;<span class="num" id="5357002">0</span><span class="op" id="5357003">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357008">re</span><span class="op" id="5357010">.</span><span class="ident" id="5357011">Op</span>&nbsp;<span class="op" id="5357014">=</span>&nbsp;<span class="ident" id="5357016">OpEmptyMatch</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357032">re</span><span class="op" id="5357034">.</span><span class="ident" id="5357035">Sub</span>&nbsp;<span class="op" id="5357039">=</span>&nbsp;<span class="builtintype" id="5357041">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357047">case</span>&nbsp;<span class="num" id="5357052">1</span><span class="op" id="5357053">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357058">old</span>&nbsp;<span class="op" id="5357062">:=</span>&nbsp;<span class="ident" id="5357065">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357071">re</span>&nbsp;<span class="op" id="5357074">=</span>&nbsp;<span class="ident" id="5357076">re</span><span class="op" id="5357078">.</span><span class="ident" id="5357079">Sub</span><span class="op" id="5357082">[</span><span class="num" id="5357083">0</span><span class="op" id="5357084">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357089">p</span><span class="op" id="5357090">.</span><span class="ident" id="5357091">reuse</span><span class="op" id="5357096">(</span><span class="ident" id="5357097">old</span><span class="op" id="5357100">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5357104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357108">return</span>&nbsp;<span class="ident" id="5357115">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5357119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357122">if</span>&nbsp;<span class="ident" id="5357125">reuse</span>&nbsp;<span class="op" id="5357131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357135">p</span><span class="op" id="5357136">.</span><span class="ident" id="5357137">reuse</span><span class="op" id="5357142">(</span><span class="ident" id="5357143">re</span><span class="op" id="5357145">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5357148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357151">return</span>&nbsp;<span class="ident" id="5357158">p</span><span class="op" id="5357159">.</span><span class="ident" id="5357160">newRegexp</span><span class="op" id="5357169">(</span><span class="ident" id="5357170">OpEmptyMatch</span><span class="op" id="5357182">)</span><br>
<span class="lineno"></span><span class="op" id="5357184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5357187">func</span>&nbsp;<span class="ident" id="5357192">literalRegexp</span><span class="op" id="5357205">(</span><span class="ident" id="5357206">s</span>&nbsp;<span class="builtintype" id="5357208">string</span><span class="op" id="5357214">,</span>&nbsp;<span class="ident" id="5357216">flags</span>&nbsp;<span class="ident" id="5357222">Flags</span><span class="op" id="5357227">)</span>&nbsp;<span class="op" id="5357229">*</span><span class="ident" id="5357230">Regexp</span>&nbsp;<span class="op" id="5357237">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357240">re</span>&nbsp;<span class="op" id="5357243">:=</span>&nbsp;<span class="op" id="5357246">&amp;</span><span class="ident" id="5357247">Regexp</span><span class="op" id="5357253">{</span><span class="ident" id="5357254">Op</span><span class="op" id="5357256">:</span>&nbsp;<span class="ident" id="5357258">OpLiteral</span><span class="op" id="5357267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357270">re</span><span class="op" id="5357272">.</span><span class="ident" id="5357273">Flags</span>&nbsp;<span class="op" id="5357279">=</span>&nbsp;<span class="ident" id="5357281">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357288">re</span><span class="op" id="5357290">.</span><span class="ident" id="5357291">Rune</span>&nbsp;<span class="op" id="5357296">=</span>&nbsp;<span class="ident" id="5357298">re</span><span class="op" id="5357300">.</span><span class="ident" id="5357301">Rune0</span><span class="op" id="5357306">[</span><span class="op" id="5357307">:</span><span class="num" id="5357308">0</span><span class="op" id="5357309">]</span>&nbsp;<span class="comment" id="5357311">//&nbsp;use&nbsp;local&nbsp;storage&nbsp;for&nbsp;small&nbsp;strings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357351">for</span>&nbsp;<span class="ident" id="5357355">_</span><span class="op" id="5357356">,</span>&nbsp;<span class="ident" id="5357358">c</span>&nbsp;<span class="op" id="5357360">:=</span>&nbsp;<span class="keyword" id="5357363">range</span>&nbsp;<span class="ident" id="5357369">s</span>&nbsp;<span class="op" id="5357371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357375">if</span>&nbsp;<span class="builtinfunc" id="5357378">len</span><span class="op" id="5357381">(</span><span class="ident" id="5357382">re</span><span class="op" id="5357384">.</span><span class="ident" id="5357385">Rune</span><span class="op" id="5357389">)</span>&nbsp;<span class="op" id="5357391">&gt;=</span>&nbsp;<span class="builtinfunc" id="5357394">cap</span><span class="op" id="5357397">(</span><span class="ident" id="5357398">re</span><span class="op" id="5357400">.</span><span class="ident" id="5357401">Rune</span><span class="op" id="5357405">)</span>&nbsp;<span class="op" id="5357407">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5357412">//&nbsp;string&nbsp;is&nbsp;too&nbsp;long&nbsp;to&nbsp;fit&nbsp;in&nbsp;Rune0.&nbsp;&nbsp;let&nbsp;Go&nbsp;handle&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357472">re</span><span class="op" id="5357474">.</span><span class="ident" id="5357475">Rune</span>&nbsp;<span class="op" id="5357480">=</span>&nbsp;<span class="op" id="5357482">[</span><span class="op" id="5357483">]</span><span class="builtintype" id="5357484">rune</span><span class="op" id="5357488">(</span><span class="ident" id="5357489">s</span><span class="op" id="5357490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357495">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5357503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5357507">re</span><span class="op" id="5357509">.</span><span class="ident" id="5357510">Rune</span>&nbsp;<span class="op" id="5357515">=</span>&nbsp;<span class="builtinfunc" id="5357517">append</span><span class="op" id="5357523">(</span><span class="ident" id="5357524">re</span><span class="op" id="5357526">.</span><span class="ident" id="5357527">Rune</span><span class="op" id="5357531">,</span>&nbsp;<span class="ident" id="5357533">c</span><span class="op" id="5357534">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5357537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357540">return</span>&nbsp;<span class="ident" id="5357547">re</span><br>
<span class="lineno"></span><span class="op" id="5357550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5357553">//&nbsp;Parsing.</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="comment" id="5357566">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;regular&nbsp;expression&nbsp;string&nbsp;s,&nbsp;controlled&nbsp;by&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="5357641">//&nbsp;Flags,&nbsp;and&nbsp;returns&nbsp;a&nbsp;regular&nbsp;expression&nbsp;parse&nbsp;tree.&nbsp;The&nbsp;syntax&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5357710">//&nbsp;described&nbsp;in&nbsp;the&nbsp;top-level&nbsp;comment.</span><br>
<span class="lineno"></span><span class="keyword" id="5357749">func</span>&nbsp;<span class="ident" id="5357754">Parse</span><span class="op" id="5357759">(</span><span class="ident" id="5357760">s</span>&nbsp;<span class="builtintype" id="5357762">string</span><span class="op" id="5357768">,</span>&nbsp;<span class="ident" id="5357770">flags</span>&nbsp;<span class="ident" id="5357776">Flags</span><span class="op" id="5357781">)</span>&nbsp;<span class="op" id="5357783">(</span><span class="op" id="5357784">*</span><span class="ident" id="5357785">Regexp</span><span class="op" id="5357791">,</span>&nbsp;<span class="builtintype" id="5357793">error</span><span class="op" id="5357798">)</span>&nbsp;<span class="op" id="5357800">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357803">if</span>&nbsp;<span class="ident" id="5357806">flags</span><span class="op" id="5357811">&amp;</span><span class="ident" id="5357812">Literal</span>&nbsp;<span class="op" id="5357820">!=</span>&nbsp;<span class="num" id="5357823">0</span>&nbsp;<span class="op" id="5357825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5357829">//&nbsp;Trivial&nbsp;parser&nbsp;for&nbsp;literal&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357869">if</span>&nbsp;<span class="ident" id="5357872">err</span>&nbsp;<span class="op" id="5357876">:=</span>&nbsp;<span class="ident" id="5357879">checkUTF8</span><span class="op" id="5357888">(</span><span class="ident" id="5357889">s</span><span class="op" id="5357890">)</span><span class="op" id="5357891">;</span>&nbsp;<span class="ident" id="5357893">err</span>&nbsp;<span class="op" id="5357897">!=</span>&nbsp;<span class="builtintype" id="5357900">nil</span>&nbsp;<span class="op" id="5357904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357909">return</span>&nbsp;<span class="builtintype" id="5357916">nil</span><span class="op" id="5357919">,</span>&nbsp;<span class="ident" id="5357921">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5357927">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5357931">return</span>&nbsp;<span class="ident" id="5357938">literalRegexp</span><span class="op" id="5357951">(</span><span class="ident" id="5357952">s</span><span class="op" id="5357953">,</span>&nbsp;<span class="ident" id="5357955">flags</span><span class="op" id="5357960">)</span><span class="op" id="5357961">,</span>&nbsp;<span class="builtintype" id="5357963">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5357968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5357972">//&nbsp;Otherwise,&nbsp;must&nbsp;do&nbsp;real&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358006">var</span>&nbsp;<span class="op" id="5358010">(</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358014">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358025">parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358034">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5358045">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358053">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5358064">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358071">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358082">Op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358087">lastRepeat</span>&nbsp;<span class="builtintype" id="5358098">string</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358109">p</span><span class="op" id="5358110">.</span><span class="ident" id="5358111">flags</span>&nbsp;<span class="op" id="5358117">=</span>&nbsp;<span class="ident" id="5358119">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358126">p</span><span class="op" id="5358127">.</span><span class="ident" id="5358128">wholeRegexp</span>&nbsp;<span class="op" id="5358140">=</span>&nbsp;<span class="ident" id="5358142">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358145">t</span>&nbsp;<span class="op" id="5358147">:=</span>&nbsp;<span class="ident" id="5358150">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358153">for</span>&nbsp;<span class="ident" id="5358157">t</span>&nbsp;<span class="op" id="5358159">!=</span>&nbsp;<span class="string" id="5358162">&#34;&#34;</span>&nbsp;<span class="op" id="5358165">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358169">repeat</span>&nbsp;<span class="op" id="5358176">:=</span>&nbsp;<span class="string" id="5358179">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358183">BigSwitch</span><span class="op" id="5358192">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358196">switch</span>&nbsp;<span class="ident" id="5358203">t</span><span class="op" id="5358204">[</span><span class="num" id="5358205">0</span><span class="op" id="5358206">]</span>&nbsp;<span class="op" id="5358208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358212">default</span><span class="op" id="5358219">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358224">if</span>&nbsp;<span class="ident" id="5358227">c</span><span class="op" id="5358228">,</span>&nbsp;<span class="ident" id="5358230">t</span><span class="op" id="5358231">,</span>&nbsp;<span class="ident" id="5358233">err</span>&nbsp;<span class="op" id="5358237">=</span>&nbsp;<span class="ident" id="5358239">nextRune</span><span class="op" id="5358247">(</span><span class="ident" id="5358248">t</span><span class="op" id="5358249">)</span><span class="op" id="5358250">;</span>&nbsp;<span class="ident" id="5358252">err</span>&nbsp;<span class="op" id="5358256">!=</span>&nbsp;<span class="builtintype" id="5358259">nil</span>&nbsp;<span class="op" id="5358263">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358269">return</span>&nbsp;<span class="builtintype" id="5358276">nil</span><span class="op" id="5358279">,</span>&nbsp;<span class="ident" id="5358281">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358293">p</span><span class="op" id="5358294">.</span><span class="ident" id="5358295">literal</span><span class="op" id="5358302">(</span><span class="ident" id="5358303">c</span><span class="op" id="5358304">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358309">case</span>&nbsp;<span class="string" id="5358314">&#39;(&#39;</span><span class="op" id="5358317">:</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358322">if</span>&nbsp;<span class="ident" id="5358325">p</span><span class="op" id="5358326">.</span><span class="ident" id="5358327">flags</span><span class="op" id="5358332">&amp;</span><span class="ident" id="5358333">PerlX</span>&nbsp;<span class="op" id="5358339">!=</span>&nbsp;<span class="num" id="5358342">0</span>&nbsp;<span class="op" id="5358344">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5358347">len</span><span class="op" id="5358350">(</span><span class="ident" id="5358351">t</span><span class="op" id="5358352">)</span>&nbsp;<span class="op" id="5358354">&gt;=</span>&nbsp;<span class="num" id="5358357">2</span>&nbsp;<span class="op" id="5358359">&amp;&amp;</span>&nbsp;<span class="ident" id="5358362">t</span><span class="op" id="5358363">[</span><span class="num" id="5358364">1</span><span class="op" id="5358365">]</span>&nbsp;<span class="op" id="5358367">==</span>&nbsp;<span class="string" id="5358370">&#39;?&#39;</span>&nbsp;<span class="op" id="5358374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5358380">//&nbsp;Flag&nbsp;changes&nbsp;and&nbsp;non-capturing&nbsp;groups.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358426">if</span>&nbsp;<span class="ident" id="5358429">t</span><span class="op" id="5358430">,</span>&nbsp;<span class="ident" id="5358432">err</span>&nbsp;<span class="op" id="5358436">=</span>&nbsp;<span class="ident" id="5358438">p</span><span class="op" id="5358439">.</span><span class="ident" id="5358440">parsePerlFlags</span><span class="op" id="5358454">(</span><span class="ident" id="5358455">t</span><span class="op" id="5358456">)</span><span class="op" id="5358457">;</span>&nbsp;<span class="ident" id="5358459">err</span>&nbsp;<span class="op" id="5358463">!=</span>&nbsp;<span class="builtintype" id="5358466">nil</span>&nbsp;<span class="op" id="5358470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358477">return</span>&nbsp;<span class="builtintype" id="5358484">nil</span><span class="op" id="5358487">,</span>&nbsp;<span class="ident" id="5358489">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358497">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358503">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358517">p</span><span class="op" id="5358518">.</span><span class="ident" id="5358519">numCap</span><span class="op" id="5358525">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358531">p</span><span class="op" id="5358532">.</span><span class="ident" id="5358533">op</span><span class="op" id="5358535">(</span><span class="ident" id="5358536">opLeftParen</span><span class="op" id="5358547">)</span><span class="op" id="5358548">.</span><span class="ident" id="5358549">Cap</span>&nbsp;<span class="op" id="5358553">=</span>&nbsp;<span class="ident" id="5358555">p</span><span class="op" id="5358556">.</span><span class="ident" id="5358557">numCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358567">t</span>&nbsp;<span class="op" id="5358569">=</span>&nbsp;<span class="ident" id="5358571">t</span><span class="op" id="5358572">[</span><span class="num" id="5358573">1</span><span class="op" id="5358574">:</span><span class="op" id="5358575">]</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358579">case</span>&nbsp;<span class="string" id="5358584">&#39;|&#39;</span><span class="op" id="5358587">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358592">if</span>&nbsp;<span class="ident" id="5358595">err</span>&nbsp;<span class="op" id="5358599">=</span>&nbsp;<span class="ident" id="5358601">p</span><span class="op" id="5358602">.</span><span class="ident" id="5358603">parseVerticalBar</span><span class="op" id="5358619">(</span><span class="op" id="5358620">)</span><span class="op" id="5358621">;</span>&nbsp;<span class="ident" id="5358623">err</span>&nbsp;<span class="op" id="5358627">!=</span>&nbsp;<span class="builtintype" id="5358630">nil</span>&nbsp;<span class="op" id="5358634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358640">return</span>&nbsp;<span class="builtintype" id="5358647">nil</span><span class="op" id="5358650">,</span>&nbsp;<span class="ident" id="5358652">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358664">t</span>&nbsp;<span class="op" id="5358666">=</span>&nbsp;<span class="ident" id="5358668">t</span><span class="op" id="5358669">[</span><span class="num" id="5358670">1</span><span class="op" id="5358671">:</span><span class="op" id="5358672">]</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358676">case</span>&nbsp;<span class="string" id="5358681">&#39;)&#39;</span><span class="op" id="5358684">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358689">if</span>&nbsp;<span class="ident" id="5358692">err</span>&nbsp;<span class="op" id="5358696">=</span>&nbsp;<span class="ident" id="5358698">p</span><span class="op" id="5358699">.</span><span class="ident" id="5358700">parseRightParen</span><span class="op" id="5358715">(</span><span class="op" id="5358716">)</span><span class="op" id="5358717">;</span>&nbsp;<span class="ident" id="5358719">err</span>&nbsp;<span class="op" id="5358723">!=</span>&nbsp;<span class="builtintype" id="5358726">nil</span>&nbsp;<span class="op" id="5358730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358736">return</span>&nbsp;<span class="builtintype" id="5358743">nil</span><span class="op" id="5358746">,</span>&nbsp;<span class="ident" id="5358748">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358760">t</span>&nbsp;<span class="op" id="5358762">=</span>&nbsp;<span class="ident" id="5358764">t</span><span class="op" id="5358765">[</span><span class="num" id="5358766">1</span><span class="op" id="5358767">:</span><span class="op" id="5358768">]</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358772">case</span>&nbsp;<span class="string" id="5358777">&#39;^&#39;</span><span class="op" id="5358780">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358785">if</span>&nbsp;<span class="ident" id="5358788">p</span><span class="op" id="5358789">.</span><span class="ident" id="5358790">flags</span><span class="op" id="5358795">&amp;</span><span class="ident" id="5358796">OneLine</span>&nbsp;<span class="op" id="5358804">!=</span>&nbsp;<span class="num" id="5358807">0</span>&nbsp;<span class="op" id="5358809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358815">p</span><span class="op" id="5358816">.</span><span class="ident" id="5358817">op</span><span class="op" id="5358819">(</span><span class="ident" id="5358820">OpBeginText</span><span class="op" id="5358831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358836">}</span>&nbsp;<span class="keyword" id="5358838">else</span>&nbsp;<span class="op" id="5358843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358849">p</span><span class="op" id="5358850">.</span><span class="ident" id="5358851">op</span><span class="op" id="5358853">(</span><span class="ident" id="5358854">OpBeginLine</span><span class="op" id="5358865">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358875">t</span>&nbsp;<span class="op" id="5358877">=</span>&nbsp;<span class="ident" id="5358879">t</span><span class="op" id="5358880">[</span><span class="num" id="5358881">1</span><span class="op" id="5358882">:</span><span class="op" id="5358883">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358887">case</span>&nbsp;<span class="string" id="5358892">&#39;$&#39;</span><span class="op" id="5358895">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5358900">if</span>&nbsp;<span class="ident" id="5358903">p</span><span class="op" id="5358904">.</span><span class="ident" id="5358905">flags</span><span class="op" id="5358910">&amp;</span><span class="ident" id="5358911">OneLine</span>&nbsp;<span class="op" id="5358919">!=</span>&nbsp;<span class="num" id="5358922">0</span>&nbsp;<span class="op" id="5358924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358930">p</span><span class="op" id="5358931">.</span><span class="ident" id="5358932">op</span><span class="op" id="5358934">(</span><span class="ident" id="5358935">OpEndText</span><span class="op" id="5358944">)</span><span class="op" id="5358945">.</span><span class="ident" id="5358946">Flags</span>&nbsp;<span class="op" id="5358952">|=</span>&nbsp;<span class="ident" id="5358955">WasDollar</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5358968">}</span>&nbsp;<span class="keyword" id="5358970">else</span>&nbsp;<span class="op" id="5358975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5358981">p</span><span class="op" id="5358982">.</span><span class="ident" id="5358983">op</span><span class="op" id="5358985">(</span><span class="ident" id="5358986">OpEndLine</span><span class="op" id="5358995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5359000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359005">t</span>&nbsp;<span class="op" id="5359007">=</span>&nbsp;<span class="ident" id="5359009">t</span><span class="op" id="5359010">[</span><span class="num" id="5359011">1</span><span class="op" id="5359012">:</span><span class="op" id="5359013">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359017">case</span>&nbsp;<span class="string" id="5359022">&#39;.&#39;</span><span class="op" id="5359025">:</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359030">if</span>&nbsp;<span class="ident" id="5359033">p</span><span class="op" id="5359034">.</span><span class="ident" id="5359035">flags</span><span class="op" id="5359040">&amp;</span><span class="ident" id="5359041">DotNL</span>&nbsp;<span class="op" id="5359047">!=</span>&nbsp;<span class="num" id="5359050">0</span>&nbsp;<span class="op" id="5359052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359058">p</span><span class="op" id="5359059">.</span><span class="ident" id="5359060">op</span><span class="op" id="5359062">(</span><span class="ident" id="5359063">OpAnyChar</span><span class="op" id="5359072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5359077">}</span>&nbsp;<span class="keyword" id="5359079">else</span>&nbsp;<span class="op" id="5359084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359090">p</span><span class="op" id="5359091">.</span><span class="ident" id="5359092">op</span><span class="op" id="5359094">(</span><span class="ident" id="5359095">OpAnyCharNotNL</span><span class="op" id="5359109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5359114">}</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359119">t</span>&nbsp;<span class="op" id="5359121">=</span>&nbsp;<span class="ident" id="5359123">t</span><span class="op" id="5359124">[</span><span class="num" id="5359125">1</span><span class="op" id="5359126">:</span><span class="op" id="5359127">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359131">case</span>&nbsp;<span class="string" id="5359136">&#39;[&#39;</span><span class="op" id="5359139">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359144">if</span>&nbsp;<span class="ident" id="5359147">t</span><span class="op" id="5359148">,</span>&nbsp;<span class="ident" id="5359150">err</span>&nbsp;<span class="op" id="5359154">=</span>&nbsp;<span class="ident" id="5359156">p</span><span class="op" id="5359157">.</span><span class="ident" id="5359158">parseClass</span><span class="op" id="5359168">(</span><span class="ident" id="5359169">t</span><span class="op" id="5359170">)</span><span class="op" id="5359171">;</span>&nbsp;<span class="ident" id="5359173">err</span>&nbsp;<span class="op" id="5359177">!=</span>&nbsp;<span class="builtintype" id="5359180">nil</span>&nbsp;<span class="op" id="5359184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359190">return</span>&nbsp;<span class="builtintype" id="5359197">nil</span><span class="op" id="5359200">,</span>&nbsp;<span class="ident" id="5359202">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5359209">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359213">case</span>&nbsp;<span class="string" id="5359218">&#39;*&#39;</span><span class="op" id="5359221">,</span>&nbsp;<span class="string" id="5359223">&#39;+&#39;</span><span class="op" id="5359226">,</span>&nbsp;<span class="string" id="5359228">&#39;?&#39;</span><span class="op" id="5359231">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359236">before</span>&nbsp;<span class="op" id="5359243">:=</span>&nbsp;<span class="ident" id="5359246">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359251">switch</span>&nbsp;<span class="ident" id="5359258">t</span><span class="op" id="5359259">[</span><span class="num" id="5359260">0</span><span class="op" id="5359261">]</span>&nbsp;<span class="op" id="5359263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359268">case</span>&nbsp;<span class="string" id="5359273">&#39;*&#39;</span><span class="op" id="5359276">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359282">op</span>&nbsp;<span class="op" id="5359285">=</span>&nbsp;<span class="ident" id="5359287">OpStar</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359297">case</span>&nbsp;<span class="string" id="5359302">&#39;+&#39;</span><span class="op" id="5359305">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359311">op</span>&nbsp;<span class="op" id="5359314">=</span>&nbsp;<span class="ident" id="5359316">OpPlus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359326">case</span>&nbsp;<span class="string" id="5359331">&#39;?&#39;</span><span class="op" id="5359334">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359340">op</span>&nbsp;<span class="op" id="5359343">=</span>&nbsp;<span class="ident" id="5359345">OpQuest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5359356">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359361">after</span>&nbsp;<span class="op" id="5359367">:=</span>&nbsp;<span class="ident" id="5359370">t</span><span class="op" id="5359371">[</span><span class="num" id="5359372">1</span><span class="op" id="5359373">:</span><span class="op" id="5359374">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359379">if</span>&nbsp;<span class="ident" id="5359382">after</span><span class="op" id="5359387">,</span>&nbsp;<span class="ident" id="5359389">err</span>&nbsp;<span class="op" id="5359393">=</span>&nbsp;<span class="ident" id="5359395">p</span><span class="op" id="5359396">.</span><span class="ident" id="5359397">repeat</span><span class="op" id="5359403">(</span><span class="ident" id="5359404">op</span><span class="op" id="5359406">,</span>&nbsp;<span class="num" id="5359408">0</span><span class="op" id="5359409">,</span>&nbsp;<span class="num" id="5359411">0</span><span class="op" id="5359412">,</span>&nbsp;<span class="ident" id="5359414">before</span><span class="op" id="5359420">,</span>&nbsp;<span class="ident" id="5359422">after</span><span class="op" id="5359427">,</span>&nbsp;<span class="ident" id="5359429">lastRepeat</span><span class="op" id="5359439">)</span><span class="op" id="5359440">;</span>&nbsp;<span class="ident" id="5359442">err</span>&nbsp;<span class="op" id="5359446">!=</span>&nbsp;<span class="builtintype" id="5359449">nil</span>&nbsp;<span class="op" id="5359453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359459">return</span>&nbsp;<span class="builtintype" id="5359466">nil</span><span class="op" id="5359469">,</span>&nbsp;<span class="ident" id="5359471">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5359478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359483">repeat</span>&nbsp;<span class="op" id="5359490">=</span>&nbsp;<span class="ident" id="5359492">before</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359502">t</span>&nbsp;<span class="op" id="5359504">=</span>&nbsp;<span class="ident" id="5359506">after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359514">case</span>&nbsp;<span class="string" id="5359519">&#39;{&#39;</span><span class="op" id="5359522">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359527">op</span>&nbsp;<span class="op" id="5359530">=</span>&nbsp;<span class="ident" id="5359532">OpRepeat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359544">before</span>&nbsp;<span class="op" id="5359551">:=</span>&nbsp;<span class="ident" id="5359554">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359559">min</span><span class="op" id="5359562">,</span>&nbsp;<span class="ident" id="5359564">max</span><span class="op" id="5359567">,</span>&nbsp;<span class="ident" id="5359569">after</span><span class="op" id="5359574">,</span>&nbsp;<span class="ident" id="5359576">ok</span>&nbsp;<span class="op" id="5359579">:=</span>&nbsp;<span class="ident" id="5359582">p</span><span class="op" id="5359583">.</span><span class="ident" id="5359584">parseRepeat</span><span class="op" id="5359595">(</span><span class="ident" id="5359596">t</span><span class="op" id="5359597">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359602">if</span>&nbsp;<span class="op" id="5359605">!</span><span class="ident" id="5359606">ok</span>&nbsp;<span class="op" id="5359609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5359615">//&nbsp;If&nbsp;the&nbsp;repeat&nbsp;cannot&nbsp;be&nbsp;parsed,&nbsp;{&nbsp;is&nbsp;a&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359670">p</span><span class="op" id="5359671">.</span><span class="ident" id="5359672">literal</span><span class="op" id="5359679">(</span><span class="string" id="5359680">&#39;{&#39;</span><span class="op" id="5359683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5359689">t</span>&nbsp;<span class="op" id="5359691">=</span>&nbsp;<span class="ident" id="5359693">t</span><span class="op" id="5359694">[</span><span class="num" id="5359695">1</span><span class="op" id="5359696">:</span><span class="op" id="5359697">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359703">break</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5359712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359717">if</span>&nbsp;<span class="ident" id="5359720">min</span>&nbsp;<span class="op" id="5359724">&lt;</span>&nbsp;<span class="num" id="5359726">0</span>&nbsp;<span class="op" id="5359728">||</span>&nbsp;<span class="ident" id="5359731">min</span>&nbsp;<span class="op" id="5359735">&gt;</span>&nbsp;<span class="num" id="5359737">1000</span>&nbsp;<span class="op" id="5359742">||</span>&nbsp;<span class="ident" id="5359745">max</span>&nbsp;<span class="op" id="5359749">&gt;</span>&nbsp;<span class="num" id="5359751">1000</span>&nbsp;<span class="op" id="5359756">||</span>&nbsp;<span class="ident" id="5359759">max</span>&nbsp;<span class="op" id="5359763">&gt;=</span>&nbsp;<span class="num" id="5359766">0</span>&nbsp;<span class="op" id="5359768">&amp;&amp;</span>&nbsp;<span class="ident" id="5359771">min</span>&nbsp;<span class="op" id="5359775">&gt;</span>&nbsp;<span class="ident" id="5359777">max</span>&nbsp;<span class="op" id="5359781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5359787">//&nbsp;Numbers&nbsp;were&nbsp;too&nbsp;big,&nbsp;or&nbsp;max&nbsp;is&nbsp;present&nbsp;and&nbsp;min&nbsp;&gt;&nbsp;max.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359849">return</span>&nbsp;<span class="builtintype" id="5359856">nil</span><span class="op" id="5359859">,</span>&nbsp;<span class="op" id="5359861">&amp;</span><span class="ident" id="5359862">Error</span><span class="op" id="5359867">{</span><span class="ident" id="5359868">ErrInvalidRepeatSize</span><span class="op" id="5359888">,</span>&nbsp;<span class="ident" id="5359890">before</span><span class="op" id="5359896">[</span><span class="op" id="5359897">:</span><span class="builtinfunc" id="5359898">len</span><span class="op" id="5359901">(</span><span class="ident" id="5359902">before</span><span class="op" id="5359908">)</span><span class="op" id="5359909">-</span><span class="builtinfunc" id="5359910">len</span><span class="op" id="5359913">(</span><span class="ident" id="5359914">after</span><span class="op" id="5359919">)</span><span class="op" id="5359920">]</span><span class="op" id="5359921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5359926">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5359931">if</span>&nbsp;<span class="ident" id="5359934">after</span><span class="op" id="5359939">,</span>&nbsp;<span class="ident" id="5359941">err</span>&nbsp;<span class="op" id="5359945">=</span>&nbsp;<span class="ident" id="5359947">p</span><span class="op" id="5359948">.</span><span class="ident" id="5359949">repeat</span><span class="op" id="5359955">(</span><span class="ident" id="5359956">op</span><span class="op" id="5359958">,</span>&nbsp;<span class="ident" id="5359960">min</span><span class="op" id="5359963">,</span>&nbsp;<span class="ident" id="5359965">max</span><span class="op" id="5359968">,</span>&nbsp;<span class="ident" id="5359970">before</span><span class="op" id="5359976">,</span>&nbsp;<span class="ident" id="5359978">after</span><span class="op" id="5359983">,</span>&nbsp;<span class="ident" id="5359985">lastRepeat</span><span class="op" id="5359995">)</span><span class="op" id="5359996">;</span>&nbsp;<span class="ident" id="5359998">err</span>&nbsp;<span class="op" id="5360002">!=</span>&nbsp;<span class="builtintype" id="5360005">nil</span>&nbsp;<span class="op" id="5360009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360015">return</span>&nbsp;<span class="builtintype" id="5360022">nil</span><span class="op" id="5360025">,</span>&nbsp;<span class="ident" id="5360027">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360039">repeat</span>&nbsp;<span class="op" id="5360046">=</span>&nbsp;<span class="ident" id="5360048">before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360058">t</span>&nbsp;<span class="op" id="5360060">=</span>&nbsp;<span class="ident" id="5360062">after</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360070">case</span>&nbsp;<span class="string" id="5360075">&#39;\\&#39;</span><span class="op" id="5360079">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360084">if</span>&nbsp;<span class="ident" id="5360087">p</span><span class="op" id="5360088">.</span><span class="ident" id="5360089">flags</span><span class="op" id="5360094">&amp;</span><span class="ident" id="5360095">PerlX</span>&nbsp;<span class="op" id="5360101">!=</span>&nbsp;<span class="num" id="5360104">0</span>&nbsp;<span class="op" id="5360106">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5360109">len</span><span class="op" id="5360112">(</span><span class="ident" id="5360113">t</span><span class="op" id="5360114">)</span>&nbsp;<span class="op" id="5360116">&gt;=</span>&nbsp;<span class="num" id="5360119">2</span>&nbsp;<span class="op" id="5360121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360127">switch</span>&nbsp;<span class="ident" id="5360134">t</span><span class="op" id="5360135">[</span><span class="num" id="5360136">1</span><span class="op" id="5360137">]</span>&nbsp;<span class="op" id="5360139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360145">case</span>&nbsp;<span class="string" id="5360150">&#39;A&#39;</span><span class="op" id="5360153">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360160">p</span><span class="op" id="5360161">.</span><span class="ident" id="5360162">op</span><span class="op" id="5360164">(</span><span class="ident" id="5360165">OpBeginText</span><span class="op" id="5360176">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360183">t</span>&nbsp;<span class="op" id="5360185">=</span>&nbsp;<span class="ident" id="5360187">t</span><span class="op" id="5360188">[</span><span class="num" id="5360189">2</span><span class="op" id="5360190">:</span><span class="op" id="5360191">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360198">break</span>&nbsp;<span class="ident" id="5360204">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360218">case</span>&nbsp;<span class="string" id="5360223">&#39;b&#39;</span><span class="op" id="5360226">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360233">p</span><span class="op" id="5360234">.</span><span class="ident" id="5360235">op</span><span class="op" id="5360237">(</span><span class="ident" id="5360238">OpWordBoundary</span><span class="op" id="5360252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360259">t</span>&nbsp;<span class="op" id="5360261">=</span>&nbsp;<span class="ident" id="5360263">t</span><span class="op" id="5360264">[</span><span class="num" id="5360265">2</span><span class="op" id="5360266">:</span><span class="op" id="5360267">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360274">break</span>&nbsp;<span class="ident" id="5360280">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360294">case</span>&nbsp;<span class="string" id="5360299">&#39;B&#39;</span><span class="op" id="5360302">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360309">p</span><span class="op" id="5360310">.</span><span class="ident" id="5360311">op</span><span class="op" id="5360313">(</span><span class="ident" id="5360314">OpNoWordBoundary</span><span class="op" id="5360330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360337">t</span>&nbsp;<span class="op" id="5360339">=</span>&nbsp;<span class="ident" id="5360341">t</span><span class="op" id="5360342">[</span><span class="num" id="5360343">2</span><span class="op" id="5360344">:</span><span class="op" id="5360345">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360352">break</span>&nbsp;<span class="ident" id="5360358">BigSwitch</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360372">case</span>&nbsp;<span class="string" id="5360377">&#39;C&#39;</span><span class="op" id="5360380">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5360387">//&nbsp;any&nbsp;byte;&nbsp;not&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360419">return</span>&nbsp;<span class="builtintype" id="5360426">nil</span><span class="op" id="5360429">,</span>&nbsp;<span class="op" id="5360431">&amp;</span><span class="ident" id="5360432">Error</span><span class="op" id="5360437">{</span><span class="ident" id="5360438">ErrInvalidEscape</span><span class="op" id="5360454">,</span>&nbsp;<span class="ident" id="5360456">t</span><span class="op" id="5360457">[</span><span class="op" id="5360458">:</span><span class="num" id="5360459">2</span><span class="op" id="5360460">]</span><span class="op" id="5360461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360467">case</span>&nbsp;<span class="string" id="5360472">&#39;Q&#39;</span><span class="op" id="5360475">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5360482">//&nbsp;\Q&nbsp;...&nbsp;\E:&nbsp;the&nbsp;...&nbsp;is&nbsp;always&nbsp;literals</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360528">var</span>&nbsp;<span class="ident" id="5360532">lit</span>&nbsp;<span class="builtintype" id="5360536">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360548">if</span>&nbsp;<span class="ident" id="5360551">i</span>&nbsp;<span class="op" id="5360553">:=</span>&nbsp;<span class="ident" id="5360556">strings</span><span class="op" id="5360563">.</span><span class="ident" id="5360564">Index</span><span class="op" id="5360569">(</span><span class="ident" id="5360570">t</span><span class="op" id="5360571">,</span>&nbsp;<span class="string" id="5360573">`\E`</span><span class="op" id="5360577">)</span><span class="op" id="5360578">;</span>&nbsp;<span class="ident" id="5360580">i</span>&nbsp;<span class="op" id="5360582">&lt;</span>&nbsp;<span class="num" id="5360584">0</span>&nbsp;<span class="op" id="5360586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360594">lit</span>&nbsp;<span class="op" id="5360598">=</span>&nbsp;<span class="ident" id="5360600">t</span><span class="op" id="5360601">[</span><span class="num" id="5360602">2</span><span class="op" id="5360603">:</span><span class="op" id="5360604">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360612">t</span>&nbsp;<span class="op" id="5360614">=</span>&nbsp;<span class="string" id="5360616">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360624">}</span>&nbsp;<span class="keyword" id="5360626">else</span>&nbsp;<span class="op" id="5360631">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360639">lit</span>&nbsp;<span class="op" id="5360643">=</span>&nbsp;<span class="ident" id="5360645">t</span><span class="op" id="5360646">[</span><span class="num" id="5360647">2</span><span class="op" id="5360648">:</span><span class="ident" id="5360649">i</span><span class="op" id="5360650">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360658">t</span>&nbsp;<span class="op" id="5360660">=</span>&nbsp;<span class="ident" id="5360662">t</span><span class="op" id="5360663">[</span><span class="ident" id="5360664">i</span><span class="op" id="5360665">+</span><span class="num" id="5360666">2</span><span class="op" id="5360667">:</span><span class="op" id="5360668">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360682">p</span><span class="op" id="5360683">.</span><span class="ident" id="5360684">push</span><span class="op" id="5360688">(</span><span class="ident" id="5360689">literalRegexp</span><span class="op" id="5360702">(</span><span class="ident" id="5360703">lit</span><span class="op" id="5360706">,</span>&nbsp;<span class="ident" id="5360708">p</span><span class="op" id="5360709">.</span><span class="ident" id="5360710">flags</span><span class="op" id="5360715">)</span><span class="op" id="5360716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360723">break</span>&nbsp;<span class="ident" id="5360729">BigSwitch</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360743">case</span>&nbsp;<span class="string" id="5360748">&#39;z&#39;</span><span class="op" id="5360751">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360758">p</span><span class="op" id="5360759">.</span><span class="ident" id="5360760">op</span><span class="op" id="5360762">(</span><span class="ident" id="5360763">OpEndText</span><span class="op" id="5360772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360779">t</span>&nbsp;<span class="op" id="5360781">=</span>&nbsp;<span class="ident" id="5360783">t</span><span class="op" id="5360784">[</span><span class="num" id="5360785">2</span><span class="op" id="5360786">:</span><span class="op" id="5360787">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360794">break</span>&nbsp;<span class="ident" id="5360800">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360814">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5360819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360825">re</span>&nbsp;<span class="op" id="5360828">:=</span>&nbsp;<span class="ident" id="5360831">p</span><span class="op" id="5360832">.</span><span class="ident" id="5360833">newRegexp</span><span class="op" id="5360842">(</span><span class="ident" id="5360843">OpCharClass</span><span class="op" id="5360854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360859">re</span><span class="op" id="5360861">.</span><span class="ident" id="5360862">Flags</span>&nbsp;<span class="op" id="5360868">=</span>&nbsp;<span class="ident" id="5360870">p</span><span class="op" id="5360871">.</span><span class="ident" id="5360872">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5360882">//&nbsp;Look&nbsp;for&nbsp;Unicode&nbsp;character&nbsp;group&nbsp;like&nbsp;\p{Han}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5360934">if</span>&nbsp;<span class="builtinfunc" id="5360937">len</span><span class="op" id="5360940">(</span><span class="ident" id="5360941">t</span><span class="op" id="5360942">)</span>&nbsp;<span class="op" id="5360944">&gt;=</span>&nbsp;<span class="num" id="5360947">2</span>&nbsp;<span class="op" id="5360949">&amp;&amp;</span>&nbsp;<span class="op" id="5360952">(</span><span class="ident" id="5360953">t</span><span class="op" id="5360954">[</span><span class="num" id="5360955">1</span><span class="op" id="5360956">]</span>&nbsp;<span class="op" id="5360958">==</span>&nbsp;<span class="string" id="5360961">&#39;p&#39;</span>&nbsp;<span class="op" id="5360965">||</span>&nbsp;<span class="ident" id="5360968">t</span><span class="op" id="5360969">[</span><span class="num" id="5360970">1</span><span class="op" id="5360971">]</span>&nbsp;<span class="op" id="5360973">==</span>&nbsp;<span class="string" id="5360976">&#39;P&#39;</span><span class="op" id="5360979">)</span>&nbsp;<span class="op" id="5360981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360987">r</span><span class="op" id="5360988">,</span>&nbsp;<span class="ident" id="5360990">rest</span><span class="op" id="5360994">,</span>&nbsp;<span class="ident" id="5360996">err</span>&nbsp;<span class="op" id="5361000">:=</span>&nbsp;<span class="ident" id="5361003">p</span><span class="op" id="5361004">.</span><span class="ident" id="5361005">parseUnicodeClass</span><span class="op" id="5361022">(</span><span class="ident" id="5361023">t</span><span class="op" id="5361024">,</span>&nbsp;<span class="ident" id="5361026">re</span><span class="op" id="5361028">.</span><span class="ident" id="5361029">Rune0</span><span class="op" id="5361034">[</span><span class="op" id="5361035">:</span><span class="num" id="5361036">0</span><span class="op" id="5361037">]</span><span class="op" id="5361038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361044">if</span>&nbsp;<span class="ident" id="5361047">err</span>&nbsp;<span class="op" id="5361051">!=</span>&nbsp;<span class="builtintype" id="5361054">nil</span>&nbsp;<span class="op" id="5361058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361065">return</span>&nbsp;<span class="builtintype" id="5361072">nil</span><span class="op" id="5361075">,</span>&nbsp;<span class="ident" id="5361077">err</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5361085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361091">if</span>&nbsp;<span class="ident" id="5361094">r</span>&nbsp;<span class="op" id="5361096">!=</span>&nbsp;<span class="builtintype" id="5361099">nil</span>&nbsp;<span class="op" id="5361103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361110">re</span><span class="op" id="5361112">.</span><span class="ident" id="5361113">Rune</span>&nbsp;<span class="op" id="5361118">=</span>&nbsp;<span class="ident" id="5361120">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361127">t</span>&nbsp;<span class="op" id="5361129">=</span>&nbsp;<span class="ident" id="5361131">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361141">p</span><span class="op" id="5361142">.</span><span class="ident" id="5361143">push</span><span class="op" id="5361147">(</span><span class="ident" id="5361148">re</span><span class="op" id="5361150">)</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361157">break</span>&nbsp;<span class="ident" id="5361163">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5361177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5361182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5361188">//&nbsp;Perl&nbsp;character&nbsp;class&nbsp;escape.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361223">if</span>&nbsp;<span class="ident" id="5361226">r</span><span class="op" id="5361227">,</span>&nbsp;<span class="ident" id="5361229">rest</span>&nbsp;<span class="op" id="5361234">:=</span>&nbsp;<span class="ident" id="5361237">p</span><span class="op" id="5361238">.</span><span class="ident" id="5361239">parsePerlClassEscape</span><span class="op" id="5361259">(</span><span class="ident" id="5361260">t</span><span class="op" id="5361261">,</span>&nbsp;<span class="ident" id="5361263">re</span><span class="op" id="5361265">.</span><span class="ident" id="5361266">Rune0</span><span class="op" id="5361271">[</span><span class="op" id="5361272">:</span><span class="num" id="5361273">0</span><span class="op" id="5361274">]</span><span class="op" id="5361275">)</span><span class="op" id="5361276">;</span>&nbsp;<span class="ident" id="5361278">r</span>&nbsp;<span class="op" id="5361280">!=</span>&nbsp;<span class="builtintype" id="5361283">nil</span>&nbsp;<span class="op" id="5361287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361293">re</span><span class="op" id="5361295">.</span><span class="ident" id="5361296">Rune</span>&nbsp;<span class="op" id="5361301">=</span>&nbsp;<span class="ident" id="5361303">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361309">t</span>&nbsp;<span class="op" id="5361311">=</span>&nbsp;<span class="ident" id="5361313">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361322">p</span><span class="op" id="5361323">.</span><span class="ident" id="5361324">push</span><span class="op" id="5361328">(</span><span class="ident" id="5361329">re</span><span class="op" id="5361331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361337">break</span>&nbsp;<span class="ident" id="5361343">BigSwitch</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5361356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361361">p</span><span class="op" id="5361362">.</span><span class="ident" id="5361363">reuse</span><span class="op" id="5361368">(</span><span class="ident" id="5361369">re</span><span class="op" id="5361371">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5361377">//&nbsp;Ordinary&nbsp;single-character&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361417">if</span>&nbsp;<span class="ident" id="5361420">c</span><span class="op" id="5361421">,</span>&nbsp;<span class="ident" id="5361423">t</span><span class="op" id="5361424">,</span>&nbsp;<span class="ident" id="5361426">err</span>&nbsp;<span class="op" id="5361430">=</span>&nbsp;<span class="ident" id="5361432">p</span><span class="op" id="5361433">.</span><span class="ident" id="5361434">parseEscape</span><span class="op" id="5361445">(</span><span class="ident" id="5361446">t</span><span class="op" id="5361447">)</span><span class="op" id="5361448">;</span>&nbsp;<span class="ident" id="5361450">err</span>&nbsp;<span class="op" id="5361454">!=</span>&nbsp;<span class="builtintype" id="5361457">nil</span>&nbsp;<span class="op" id="5361461">{</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361467">return</span>&nbsp;<span class="builtintype" id="5361474">nil</span><span class="op" id="5361477">,</span>&nbsp;<span class="ident" id="5361479">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5361486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361491">p</span><span class="op" id="5361492">.</span><span class="ident" id="5361493">literal</span><span class="op" id="5361500">(</span><span class="ident" id="5361501">c</span><span class="op" id="5361502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5361506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361510">lastRepeat</span>&nbsp;<span class="op" id="5361521">=</span>&nbsp;<span class="ident" id="5361523">repeat</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5361531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361535">p</span><span class="op" id="5361536">.</span><span class="ident" id="5361537">concat</span><span class="op" id="5361543">(</span><span class="op" id="5361544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361547">if</span>&nbsp;<span class="ident" id="5361550">p</span><span class="op" id="5361551">.</span><span class="ident" id="5361552">swapVerticalBar</span><span class="op" id="5361567">(</span><span class="op" id="5361568">)</span>&nbsp;<span class="op" id="5361570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5361574">//&nbsp;pop&nbsp;vertical&nbsp;bar</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361596">p</span><span class="op" id="5361597">.</span><span class="ident" id="5361598">stack</span>&nbsp;<span class="op" id="5361604">=</span>&nbsp;<span class="ident" id="5361606">p</span><span class="op" id="5361607">.</span><span class="ident" id="5361608">stack</span><span class="op" id="5361613">[</span><span class="op" id="5361614">:</span><span class="builtinfunc" id="5361615">len</span><span class="op" id="5361618">(</span><span class="ident" id="5361619">p</span><span class="op" id="5361620">.</span><span class="ident" id="5361621">stack</span><span class="op" id="5361626">)</span><span class="op" id="5361627">-</span><span class="num" id="5361628">1</span><span class="op" id="5361629">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5361632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361635">p</span><span class="op" id="5361636">.</span><span class="ident" id="5361637">alternate</span><span class="op" id="5361646">(</span><span class="op" id="5361647">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5361651">n</span>&nbsp;<span class="op" id="5361653">:=</span>&nbsp;<span class="builtinfunc" id="5361656">len</span><span class="op" id="5361659">(</span><span class="ident" id="5361660">p</span><span class="op" id="5361661">.</span><span class="ident" id="5361662">stack</span><span class="op" id="5361667">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361670">if</span>&nbsp;<span class="ident" id="5361673">n</span>&nbsp;<span class="op" id="5361675">!=</span>&nbsp;<span class="num" id="5361678">1</span>&nbsp;<span class="op" id="5361680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361684">return</span>&nbsp;<span class="builtintype" id="5361691">nil</span><span class="op" id="5361694">,</span>&nbsp;<span class="op" id="5361696">&amp;</span><span class="ident" id="5361697">Error</span><span class="op" id="5361702">{</span><span class="ident" id="5361703">ErrMissingParen</span><span class="op" id="5361718">,</span>&nbsp;<span class="ident" id="5361720">s</span><span class="op" id="5361721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5361724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5361727">return</span>&nbsp;<span class="ident" id="5361734">p</span><span class="op" id="5361735">.</span><span class="ident" id="5361736">stack</span><span class="op" id="5361741">[</span><span class="num" id="5361742">0</span><span class="op" id="5361743">]</span><span class="op" id="5361744">,</span>&nbsp;<span class="builtintype" id="5361746">nil</span><br>
<span class="lineno"></span><span class="op" id="5361750">}</span><br>
<span class="lineno">890</span><br>
<span class="lineno"></span><span class="comment" id="5361753">//&nbsp;parseRepeat&nbsp;parses&nbsp;{min}&nbsp;(max=min)&nbsp;or&nbsp;{min,}&nbsp;(max=-1)&nbsp;or&nbsp;{min,max}.</span><br>
<span class="lineno"></span><span class="comment" id="5361824">//&nbsp;If&nbsp;s&nbsp;is&nbsp;not&nbsp;of&nbsp;that&nbsp;form,&nbsp;it&nbsp;returns&nbsp;ok&nbsp;==&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5361877">//&nbsp;If&nbsp;s&nbsp;has&nbsp;the&nbsp;right&nbsp;form&nbsp;but&nbsp;the&nbsp;values&nbsp;are&nbsp;too&nbsp;big,&nbsp;it&nbsp;returns&nbsp;min&nbsp;==&nbsp;-1,&nbsp;ok&nbsp;==&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5361966">func</span>&nbsp;<span class="op" id="5361971">(</span><span class="ident" id="5361972">p</span>&nbsp;<span class="op" id="5361974">*</span><span class="ident" id="5361975">parser</span><span class="op" id="5361981">)</span>&nbsp;<span class="ident" id="5361983">parseRepeat</span><span class="op" id="5361994">(</span><span class="ident" id="5361995">s</span>&nbsp;<span class="builtintype" id="5361997">string</span><span class="op" id="5362003">)</span>&nbsp;<span class="op" id="5362005">(</span><span class="ident" id="5362006">min</span><span class="op" id="5362009">,</span>&nbsp;<span class="ident" id="5362011">max</span>&nbsp;<span class="builtintype" id="5362015">int</span><span class="op" id="5362018">,</span>&nbsp;<span class="ident" id="5362020">rest</span>&nbsp;<span class="builtintype" id="5362025">string</span><span class="op" id="5362031">,</span>&nbsp;<span class="ident" id="5362033">ok</span>&nbsp;<span class="builtintype" id="5362036">bool</span><span class="op" id="5362040">)</span>&nbsp;<span class="op" id="5362042">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362045">if</span>&nbsp;<span class="ident" id="5362048">s</span>&nbsp;<span class="op" id="5362050">==</span>&nbsp;<span class="string" id="5362053">&#34;&#34;</span>&nbsp;<span class="op" id="5362056">||</span>&nbsp;<span class="ident" id="5362059">s</span><span class="op" id="5362060">[</span><span class="num" id="5362061">0</span><span class="op" id="5362062">]</span>&nbsp;<span class="op" id="5362064">!=</span>&nbsp;<span class="string" id="5362067">&#39;{&#39;</span>&nbsp;<span class="op" id="5362071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362075">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362086">s</span>&nbsp;<span class="op" id="5362088">=</span>&nbsp;<span class="ident" id="5362090">s</span><span class="op" id="5362091">[</span><span class="num" id="5362092">1</span><span class="op" id="5362093">:</span><span class="op" id="5362094">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362097">var</span>&nbsp;<span class="ident" id="5362101">ok1</span>&nbsp;<span class="builtintype" id="5362105">bool</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362111">if</span>&nbsp;<span class="ident" id="5362114">min</span><span class="op" id="5362117">,</span>&nbsp;<span class="ident" id="5362119">s</span><span class="op" id="5362120">,</span>&nbsp;<span class="ident" id="5362122">ok1</span>&nbsp;<span class="op" id="5362126">=</span>&nbsp;<span class="ident" id="5362128">p</span><span class="op" id="5362129">.</span><span class="ident" id="5362130">parseInt</span><span class="op" id="5362138">(</span><span class="ident" id="5362139">s</span><span class="op" id="5362140">)</span><span class="op" id="5362141">;</span>&nbsp;<span class="op" id="5362143">!</span><span class="ident" id="5362144">ok1</span>&nbsp;<span class="op" id="5362148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362152">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362163">if</span>&nbsp;<span class="ident" id="5362166">s</span>&nbsp;<span class="op" id="5362168">==</span>&nbsp;<span class="string" id="5362171">&#34;&#34;</span>&nbsp;<span class="op" id="5362174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362178">return</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362189">if</span>&nbsp;<span class="ident" id="5362192">s</span><span class="op" id="5362193">[</span><span class="num" id="5362194">0</span><span class="op" id="5362195">]</span>&nbsp;<span class="op" id="5362197">!=</span>&nbsp;<span class="string" id="5362200">&#39;,&#39;</span>&nbsp;<span class="op" id="5362204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362208">max</span>&nbsp;<span class="op" id="5362212">=</span>&nbsp;<span class="ident" id="5362214">min</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362219">}</span>&nbsp;<span class="keyword" id="5362221">else</span>&nbsp;<span class="op" id="5362226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362230">s</span>&nbsp;<span class="op" id="5362232">=</span>&nbsp;<span class="ident" id="5362234">s</span><span class="op" id="5362235">[</span><span class="num" id="5362236">1</span><span class="op" id="5362237">:</span><span class="op" id="5362238">]</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362242">if</span>&nbsp;<span class="ident" id="5362245">s</span>&nbsp;<span class="op" id="5362247">==</span>&nbsp;<span class="string" id="5362250">&#34;&#34;</span>&nbsp;<span class="op" id="5362253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362258">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362271">if</span>&nbsp;<span class="ident" id="5362274">s</span><span class="op" id="5362275">[</span><span class="num" id="5362276">0</span><span class="op" id="5362277">]</span>&nbsp;<span class="op" id="5362279">==</span>&nbsp;<span class="string" id="5362282">&#39;}&#39;</span>&nbsp;<span class="op" id="5362286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362291">max</span>&nbsp;<span class="op" id="5362295">=</span>&nbsp;<span class="op" id="5362297">-</span><span class="num" id="5362298">1</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362302">}</span>&nbsp;<span class="keyword" id="5362304">else</span>&nbsp;<span class="keyword" id="5362309">if</span>&nbsp;<span class="ident" id="5362312">max</span><span class="op" id="5362315">,</span>&nbsp;<span class="ident" id="5362317">s</span><span class="op" id="5362318">,</span>&nbsp;<span class="ident" id="5362320">ok1</span>&nbsp;<span class="op" id="5362324">=</span>&nbsp;<span class="ident" id="5362326">p</span><span class="op" id="5362327">.</span><span class="ident" id="5362328">parseInt</span><span class="op" id="5362336">(</span><span class="ident" id="5362337">s</span><span class="op" id="5362338">)</span><span class="op" id="5362339">;</span>&nbsp;<span class="op" id="5362341">!</span><span class="ident" id="5362342">ok1</span>&nbsp;<span class="op" id="5362346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362351">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362360">}</span>&nbsp;<span class="keyword" id="5362362">else</span>&nbsp;<span class="keyword" id="5362367">if</span>&nbsp;<span class="ident" id="5362370">max</span>&nbsp;<span class="op" id="5362374">&lt;</span>&nbsp;<span class="num" id="5362376">0</span>&nbsp;<span class="op" id="5362378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5362383">//&nbsp;parseInt&nbsp;found&nbsp;too&nbsp;big&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362421">min</span>&nbsp;<span class="op" id="5362425">=</span>&nbsp;<span class="op" id="5362427">-</span><span class="num" id="5362428">1</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362438">if</span>&nbsp;<span class="ident" id="5362441">s</span>&nbsp;<span class="op" id="5362443">==</span>&nbsp;<span class="string" id="5362446">&#34;&#34;</span>&nbsp;<span class="op" id="5362449">||</span>&nbsp;<span class="ident" id="5362452">s</span><span class="op" id="5362453">[</span><span class="num" id="5362454">0</span><span class="op" id="5362455">]</span>&nbsp;<span class="op" id="5362457">!=</span>&nbsp;<span class="string" id="5362460">&#39;}&#39;</span>&nbsp;<span class="op" id="5362464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362468">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5362476">}</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362479">rest</span>&nbsp;<span class="op" id="5362484">=</span>&nbsp;<span class="ident" id="5362486">s</span><span class="op" id="5362487">[</span><span class="num" id="5362488">1</span><span class="op" id="5362489">:</span><span class="op" id="5362490">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362493">ok</span>&nbsp;<span class="op" id="5362496">=</span>&nbsp;<span class="builtintype" id="5362498">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5362504">return</span><br>
<span class="lineno"></span><span class="op" id="5362511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span><span class="comment" id="5362514">//&nbsp;parsePerlFlags&nbsp;parses&nbsp;a&nbsp;Perl&nbsp;flag&nbsp;setting&nbsp;or&nbsp;non-capturing&nbsp;group&nbsp;or&nbsp;both,</span><br>
<span class="lineno"></span><span class="comment" id="5362591">//&nbsp;like&nbsp;(?i)&nbsp;or&nbsp;(?:&nbsp;or&nbsp;(?i:.&nbsp;&nbsp;It&nbsp;removes&nbsp;the&nbsp;prefix&nbsp;from&nbsp;s&nbsp;and&nbsp;updates&nbsp;the&nbsp;parse&nbsp;state.</span><br>
<span class="lineno"></span><span class="comment" id="5362679">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;have&nbsp;ensured&nbsp;that&nbsp;s&nbsp;begins&nbsp;with&nbsp;&#34;(?&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5362736">func</span>&nbsp;<span class="op" id="5362741">(</span><span class="ident" id="5362742">p</span>&nbsp;<span class="op" id="5362744">*</span><span class="ident" id="5362745">parser</span><span class="op" id="5362751">)</span>&nbsp;<span class="ident" id="5362753">parsePerlFlags</span><span class="op" id="5362767">(</span><span class="ident" id="5362768">s</span>&nbsp;<span class="builtintype" id="5362770">string</span><span class="op" id="5362776">)</span>&nbsp;<span class="op" id="5362778">(</span><span class="ident" id="5362779">rest</span>&nbsp;<span class="builtintype" id="5362784">string</span><span class="op" id="5362790">,</span>&nbsp;<span class="ident" id="5362792">err</span>&nbsp;<span class="builtintype" id="5362796">error</span><span class="op" id="5362801">)</span>&nbsp;<span class="op" id="5362803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5362806">t</span>&nbsp;<span class="op" id="5362808">:=</span>&nbsp;<span class="ident" id="5362811">s</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5362815">//&nbsp;Check&nbsp;for&nbsp;named&nbsp;captures,&nbsp;first&nbsp;introduced&nbsp;in&nbsp;Python&#39;s&nbsp;regexp&nbsp;library.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5362890">//&nbsp;As&nbsp;usual,&nbsp;there&nbsp;are&nbsp;three&nbsp;slightly&nbsp;different&nbsp;syntaxes:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5362949">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5362953">//&nbsp;&nbsp;&nbsp;(?P&lt;name&gt;expr)&nbsp;&nbsp;&nbsp;the&nbsp;original,&nbsp;introduced&nbsp;by&nbsp;Python</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5363011">//&nbsp;&nbsp;&nbsp;(?&lt;name&gt;expr)&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;.NET&nbsp;alteration,&nbsp;adopted&nbsp;by&nbsp;Perl&nbsp;5.10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5363076">//&nbsp;&nbsp;&nbsp;(?&#39;name&#39;expr)&nbsp;&nbsp;&nbsp;&nbsp;another&nbsp;.NET&nbsp;alteration,&nbsp;adopted&nbsp;by&nbsp;Perl&nbsp;5.10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5363145">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5363149">//&nbsp;Perl&nbsp;5.10&nbsp;gave&nbsp;in&nbsp;and&nbsp;implemented&nbsp;the&nbsp;Python&nbsp;version&nbsp;too,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5363211">//&nbsp;but&nbsp;they&nbsp;claim&nbsp;that&nbsp;the&nbsp;last&nbsp;two&nbsp;are&nbsp;the&nbsp;preferred&nbsp;forms.</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5363273">//&nbsp;PCRE&nbsp;and&nbsp;languages&nbsp;based&nbsp;on&nbsp;it&nbsp;(specifically,&nbsp;PHP&nbsp;and&nbsp;Ruby)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5363337">//&nbsp;support&nbsp;all&nbsp;three&nbsp;as&nbsp;well.&nbsp;&nbsp;EcmaScript&nbsp;4&nbsp;uses&nbsp;only&nbsp;the&nbsp;Python&nbsp;form.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5363409">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5363413">//&nbsp;In&nbsp;both&nbsp;the&nbsp;open&nbsp;source&nbsp;world&nbsp;(via&nbsp;Code&nbsp;Search)&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5363473">//&nbsp;Google&nbsp;source&nbsp;tree,&nbsp;(?P&lt;expr&gt;name)&nbsp;is&nbsp;the&nbsp;dominant&nbsp;form,</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5363534">//&nbsp;so&nbsp;that&#39;s&nbsp;the&nbsp;one&nbsp;we&nbsp;implement.&nbsp;&nbsp;One&nbsp;is&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363586">if</span>&nbsp;<span class="builtinfunc" id="5363589">len</span><span class="op" id="5363592">(</span><span class="ident" id="5363593">t</span><span class="op" id="5363594">)</span>&nbsp;<span class="op" id="5363596">&gt;</span>&nbsp;<span class="num" id="5363598">4</span>&nbsp;<span class="op" id="5363600">&amp;&amp;</span>&nbsp;<span class="ident" id="5363603">t</span><span class="op" id="5363604">[</span><span class="num" id="5363605">2</span><span class="op" id="5363606">]</span>&nbsp;<span class="op" id="5363608">==</span>&nbsp;<span class="string" id="5363611">&#39;P&#39;</span>&nbsp;<span class="op" id="5363615">&amp;&amp;</span>&nbsp;<span class="ident" id="5363618">t</span><span class="op" id="5363619">[</span><span class="num" id="5363620">3</span><span class="op" id="5363621">]</span>&nbsp;<span class="op" id="5363623">==</span>&nbsp;<span class="string" id="5363626">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="5363630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5363634">//&nbsp;Pull&nbsp;out&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5363654">end</span>&nbsp;<span class="op" id="5363658">:=</span>&nbsp;<span class="ident" id="5363661">strings</span><span class="op" id="5363668">.</span><span class="ident" id="5363669">IndexRune</span><span class="op" id="5363678">(</span><span class="ident" id="5363679">t</span><span class="op" id="5363680">,</span>&nbsp;<span class="string" id="5363682">&#39;&gt;&#39;</span><span class="op" id="5363685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363689">if</span>&nbsp;<span class="ident" id="5363692">end</span>&nbsp;<span class="op" id="5363696">&lt;</span>&nbsp;<span class="num" id="5363698">0</span>&nbsp;<span class="op" id="5363700">{</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363705">if</span>&nbsp;<span class="ident" id="5363708">err</span>&nbsp;<span class="op" id="5363712">=</span>&nbsp;<span class="ident" id="5363714">checkUTF8</span><span class="op" id="5363723">(</span><span class="ident" id="5363724">t</span><span class="op" id="5363725">)</span><span class="op" id="5363726">;</span>&nbsp;<span class="ident" id="5363728">err</span>&nbsp;<span class="op" id="5363732">!=</span>&nbsp;<span class="builtintype" id="5363735">nil</span>&nbsp;<span class="op" id="5363739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363745">return</span>&nbsp;<span class="string" id="5363752">&#34;&#34;</span><span class="op" id="5363754">,</span>&nbsp;<span class="ident" id="5363756">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5363763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363768">return</span>&nbsp;<span class="string" id="5363775">&#34;&#34;</span><span class="op" id="5363777">,</span>&nbsp;<span class="op" id="5363779">&amp;</span><span class="ident" id="5363780">Error</span><span class="op" id="5363785">{</span><span class="ident" id="5363786">ErrInvalidNamedCapture</span><span class="op" id="5363808">,</span>&nbsp;<span class="ident" id="5363810">s</span><span class="op" id="5363811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5363815">}</span><br>
<span class="lineno">960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5363820">capture</span>&nbsp;<span class="op" id="5363828">:=</span>&nbsp;<span class="ident" id="5363831">t</span><span class="op" id="5363832">[</span><span class="op" id="5363833">:</span><span class="ident" id="5363834">end</span><span class="op" id="5363837">+</span><span class="num" id="5363838">1</span><span class="op" id="5363839">]</span>&nbsp;<span class="comment" id="5363841">//&nbsp;&#34;(?P&lt;name&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5363858">name</span>&nbsp;<span class="op" id="5363863">:=</span>&nbsp;<span class="ident" id="5363866">t</span><span class="op" id="5363867">[</span><span class="num" id="5363868">4</span><span class="op" id="5363869">:</span><span class="ident" id="5363870">end</span><span class="op" id="5363873">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5363879">//&nbsp;&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363891">if</span>&nbsp;<span class="ident" id="5363894">err</span>&nbsp;<span class="op" id="5363898">=</span>&nbsp;<span class="ident" id="5363900">checkUTF8</span><span class="op" id="5363909">(</span><span class="ident" id="5363910">name</span><span class="op" id="5363914">)</span><span class="op" id="5363915">;</span>&nbsp;<span class="ident" id="5363917">err</span>&nbsp;<span class="op" id="5363921">!=</span>&nbsp;<span class="builtintype" id="5363924">nil</span>&nbsp;<span class="op" id="5363928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363933">return</span>&nbsp;<span class="string" id="5363940">&#34;&#34;</span><span class="op" id="5363942">,</span>&nbsp;<span class="ident" id="5363944">err</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5363950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363954">if</span>&nbsp;<span class="op" id="5363957">!</span><span class="ident" id="5363958">isValidCaptureName</span><span class="op" id="5363976">(</span><span class="ident" id="5363977">name</span><span class="op" id="5363981">)</span>&nbsp;<span class="op" id="5363983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5363988">return</span>&nbsp;<span class="string" id="5363995">&#34;&#34;</span><span class="op" id="5363997">,</span>&nbsp;<span class="op" id="5363999">&amp;</span><span class="ident" id="5364000">Error</span><span class="op" id="5364005">{</span><span class="ident" id="5364006">ErrInvalidNamedCapture</span><span class="op" id="5364028">,</span>&nbsp;<span class="ident" id="5364030">capture</span><span class="op" id="5364037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5364041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5364046">//&nbsp;Like&nbsp;ordinary&nbsp;capture,&nbsp;but&nbsp;named.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364085">p</span><span class="op" id="5364086">.</span><span class="ident" id="5364087">numCap</span><span class="op" id="5364093">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364098">re</span>&nbsp;<span class="op" id="5364101">:=</span>&nbsp;<span class="ident" id="5364104">p</span><span class="op" id="5364105">.</span><span class="ident" id="5364106">op</span><span class="op" id="5364108">(</span><span class="ident" id="5364109">opLeftParen</span><span class="op" id="5364120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364124">re</span><span class="op" id="5364126">.</span><span class="ident" id="5364127">Cap</span>&nbsp;<span class="op" id="5364131">=</span>&nbsp;<span class="ident" id="5364133">p</span><span class="op" id="5364134">.</span><span class="ident" id="5364135">numCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364144">re</span><span class="op" id="5364146">.</span><span class="ident" id="5364147">Name</span>&nbsp;<span class="op" id="5364152">=</span>&nbsp;<span class="ident" id="5364154">name</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364161">return</span>&nbsp;<span class="ident" id="5364168">t</span><span class="op" id="5364169">[</span><span class="ident" id="5364170">end</span><span class="op" id="5364173">+</span><span class="num" id="5364174">1</span><span class="op" id="5364175">:</span><span class="op" id="5364176">]</span><span class="op" id="5364177">,</span>&nbsp;<span class="builtintype" id="5364179">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5364184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5364188">//&nbsp;Non-capturing&nbsp;group.&nbsp;&nbsp;Might&nbsp;also&nbsp;twiddle&nbsp;Perl&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364245">var</span>&nbsp;<span class="ident" id="5364249">c</span>&nbsp;<span class="builtintype" id="5364251">rune</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364257">t</span>&nbsp;<span class="op" id="5364259">=</span>&nbsp;<span class="ident" id="5364261">t</span><span class="op" id="5364262">[</span><span class="num" id="5364263">2</span><span class="op" id="5364264">:</span><span class="op" id="5364265">]</span>&nbsp;<span class="comment" id="5364267">//&nbsp;skip&nbsp;(?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364279">flags</span>&nbsp;<span class="op" id="5364285">:=</span>&nbsp;<span class="ident" id="5364288">p</span><span class="op" id="5364289">.</span><span class="ident" id="5364290">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364297">sign</span>&nbsp;<span class="op" id="5364302">:=</span>&nbsp;<span class="op" id="5364305">+</span><span class="num" id="5364306">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364309">sawFlag</span>&nbsp;<span class="op" id="5364317">:=</span>&nbsp;<span class="builtintype" id="5364320">false</span><br>
<span class="lineno"></span><span class="ident" id="5364326">Loop</span><span class="op" id="5364330">:</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364333">for</span>&nbsp;<span class="ident" id="5364337">t</span>&nbsp;<span class="op" id="5364339">!=</span>&nbsp;<span class="string" id="5364342">&#34;&#34;</span>&nbsp;<span class="op" id="5364345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364349">if</span>&nbsp;<span class="ident" id="5364352">c</span><span class="op" id="5364353">,</span>&nbsp;<span class="ident" id="5364355">t</span><span class="op" id="5364356">,</span>&nbsp;<span class="ident" id="5364358">err</span>&nbsp;<span class="op" id="5364362">=</span>&nbsp;<span class="ident" id="5364364">nextRune</span><span class="op" id="5364372">(</span><span class="ident" id="5364373">t</span><span class="op" id="5364374">)</span><span class="op" id="5364375">;</span>&nbsp;<span class="ident" id="5364377">err</span>&nbsp;<span class="op" id="5364381">!=</span>&nbsp;<span class="builtintype" id="5364384">nil</span>&nbsp;<span class="op" id="5364388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364393">return</span>&nbsp;<span class="string" id="5364400">&#34;&#34;</span><span class="op" id="5364402">,</span>&nbsp;<span class="ident" id="5364404">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5364410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364414">switch</span>&nbsp;<span class="ident" id="5364421">c</span>&nbsp;<span class="op" id="5364423">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364427">default</span><span class="op" id="5364434">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364439">break</span>&nbsp;<span class="ident" id="5364445">Loop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5364453">//&nbsp;Flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364465">case</span>&nbsp;<span class="string" id="5364470">&#39;i&#39;</span><span class="op" id="5364473">:</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364478">flags</span>&nbsp;<span class="op" id="5364484">|=</span>&nbsp;<span class="ident" id="5364487">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364499">sawFlag</span>&nbsp;<span class="op" id="5364507">=</span>&nbsp;<span class="builtintype" id="5364509">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364516">case</span>&nbsp;<span class="string" id="5364521">&#39;m&#39;</span><span class="op" id="5364524">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364529">flags</span>&nbsp;<span class="op" id="5364535">&amp;^=</span>&nbsp;<span class="ident" id="5364539">OneLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364550">sawFlag</span>&nbsp;<span class="op" id="5364558">=</span>&nbsp;<span class="builtintype" id="5364560">true</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364567">case</span>&nbsp;<span class="string" id="5364572">&#39;s&#39;</span><span class="op" id="5364575">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364580">flags</span>&nbsp;<span class="op" id="5364586">|=</span>&nbsp;<span class="ident" id="5364589">DotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364598">sawFlag</span>&nbsp;<span class="op" id="5364606">=</span>&nbsp;<span class="builtintype" id="5364608">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364615">case</span>&nbsp;<span class="string" id="5364620">&#39;U&#39;</span><span class="op" id="5364623">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364628">flags</span>&nbsp;<span class="op" id="5364634">|=</span>&nbsp;<span class="ident" id="5364637">NonGreedy</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364650">sawFlag</span>&nbsp;<span class="op" id="5364658">=</span>&nbsp;<span class="builtintype" id="5364660">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5364668">//&nbsp;Switch&nbsp;to&nbsp;negation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364693">case</span>&nbsp;<span class="string" id="5364698">&#39;-&#39;</span><span class="op" id="5364701">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364706">if</span>&nbsp;<span class="ident" id="5364709">sign</span>&nbsp;<span class="op" id="5364714">&lt;</span>&nbsp;<span class="num" id="5364716">0</span>&nbsp;<span class="op" id="5364718">{</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364724">break</span>&nbsp;<span class="ident" id="5364730">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5364738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364743">sign</span>&nbsp;<span class="op" id="5364748">=</span>&nbsp;<span class="op" id="5364750">-</span><span class="num" id="5364751">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5364756">//&nbsp;Invert&nbsp;flags&nbsp;so&nbsp;that&nbsp;|&nbsp;above&nbsp;turn&nbsp;into&nbsp;&amp;^&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5364820">//&nbsp;We&#39;ll&nbsp;invert&nbsp;flags&nbsp;again&nbsp;before&nbsp;using&nbsp;it&nbsp;below.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364874">flags</span>&nbsp;<span class="op" id="5364880">=</span>&nbsp;<span class="op" id="5364882">^</span><span class="ident" id="5364883">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5364892">sawFlag</span>&nbsp;<span class="op" id="5364900">=</span>&nbsp;<span class="builtintype" id="5364902">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5364911">//&nbsp;End&nbsp;of&nbsp;flags,&nbsp;starting&nbsp;group&nbsp;or&nbsp;not.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364953">case</span>&nbsp;<span class="string" id="5364958">&#39;:&#39;</span><span class="op" id="5364961">,</span>&nbsp;<span class="string" id="5364963">&#39;)&#39;</span><span class="op" id="5364966">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364971">if</span>&nbsp;<span class="ident" id="5364974">sign</span>&nbsp;<span class="op" id="5364979">&lt;</span>&nbsp;<span class="num" id="5364981">0</span>&nbsp;<span class="op" id="5364983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5364989">if</span>&nbsp;<span class="op" id="5364992">!</span><span class="ident" id="5364993">sawFlag</span>&nbsp;<span class="op" id="5365001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365008">break</span>&nbsp;<span class="ident" id="5365014">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365029">flags</span>&nbsp;<span class="op" id="5365035">=</span>&nbsp;<span class="op" id="5365037">^</span><span class="ident" id="5365038">flags</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365052">if</span>&nbsp;<span class="ident" id="5365055">c</span>&nbsp;<span class="op" id="5365057">==</span>&nbsp;<span class="string" id="5365060">&#39;:&#39;</span>&nbsp;<span class="op" id="5365064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5365070">//&nbsp;Open&nbsp;new&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365092">p</span><span class="op" id="5365093">.</span><span class="ident" id="5365094">op</span><span class="op" id="5365096">(</span><span class="ident" id="5365097">opLeftParen</span><span class="op" id="5365108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365113">}</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365118">p</span><span class="op" id="5365119">.</span><span class="ident" id="5365120">flags</span>&nbsp;<span class="op" id="5365126">=</span>&nbsp;<span class="ident" id="5365128">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365137">return</span>&nbsp;<span class="ident" id="5365144">t</span><span class="op" id="5365145">,</span>&nbsp;<span class="builtintype" id="5365147">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365160">return</span>&nbsp;<span class="string" id="5365167">&#34;&#34;</span><span class="op" id="5365169">,</span>&nbsp;<span class="op" id="5365171">&amp;</span><span class="ident" id="5365172">Error</span><span class="op" id="5365177">{</span><span class="ident" id="5365178">ErrInvalidPerlOp</span><span class="op" id="5365194">,</span>&nbsp;<span class="ident" id="5365196">s</span><span class="op" id="5365197">[</span><span class="op" id="5365198">:</span><span class="builtinfunc" id="5365199">len</span><span class="op" id="5365202">(</span><span class="ident" id="5365203">s</span><span class="op" id="5365204">)</span><span class="op" id="5365205">-</span><span class="builtinfunc" id="5365206">len</span><span class="op" id="5365209">(</span><span class="ident" id="5365210">t</span><span class="op" id="5365211">)</span><span class="op" id="5365212">]</span><span class="op" id="5365213">}</span><br>
<span class="lineno"></span><span class="op" id="5365215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5365218">//&nbsp;isValidCaptureName&nbsp;reports&nbsp;whether&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5365261">//&nbsp;is&nbsp;a&nbsp;valid&nbsp;capture&nbsp;name:&nbsp;[A-Za-z0-9_]+.</span><br>
<span class="lineno">1040</span><span class="comment" id="5365304">//&nbsp;PCRE&nbsp;limits&nbsp;names&nbsp;to&nbsp;32&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="5365338">//&nbsp;Python&nbsp;rejects&nbsp;names&nbsp;starting&nbsp;with&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="5365384">//&nbsp;We&nbsp;don&#39;t&nbsp;enforce&nbsp;either&nbsp;of&nbsp;those.</span><br>
<span class="lineno"></span><span class="keyword" id="5365421">func</span>&nbsp;<span class="ident" id="5365426">isValidCaptureName</span><span class="op" id="5365444">(</span><span class="ident" id="5365445">name</span>&nbsp;<span class="builtintype" id="5365450">string</span><span class="op" id="5365456">)</span>&nbsp;<span class="builtintype" id="5365458">bool</span>&nbsp;<span class="op" id="5365463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365466">if</span>&nbsp;<span class="ident" id="5365469">name</span>&nbsp;<span class="op" id="5365474">==</span>&nbsp;<span class="string" id="5365477">&#34;&#34;</span>&nbsp;<span class="op" id="5365480">{</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365484">return</span>&nbsp;<span class="builtintype" id="5365491">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365501">for</span>&nbsp;<span class="ident" id="5365505">_</span><span class="op" id="5365506">,</span>&nbsp;<span class="ident" id="5365508">c</span>&nbsp;<span class="op" id="5365510">:=</span>&nbsp;<span class="keyword" id="5365513">range</span>&nbsp;<span class="ident" id="5365519">name</span>&nbsp;<span class="op" id="5365524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365528">if</span>&nbsp;<span class="ident" id="5365531">c</span>&nbsp;<span class="op" id="5365533">!=</span>&nbsp;<span class="string" id="5365536">&#39;_&#39;</span>&nbsp;<span class="op" id="5365540">&amp;&amp;</span>&nbsp;<span class="op" id="5365543">!</span><span class="ident" id="5365544">isalnum</span><span class="op" id="5365551">(</span><span class="ident" id="5365552">c</span><span class="op" id="5365553">)</span>&nbsp;<span class="op" id="5365555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365560">return</span>&nbsp;<span class="builtintype" id="5365567">false</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365581">return</span>&nbsp;<span class="builtintype" id="5365588">true</span><br>
<span class="lineno"></span><span class="op" id="5365593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1055</span><span class="comment" id="5365596">//&nbsp;parseInt&nbsp;parses&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="5365634">func</span>&nbsp;<span class="op" id="5365639">(</span><span class="ident" id="5365640">p</span>&nbsp;<span class="op" id="5365642">*</span><span class="ident" id="5365643">parser</span><span class="op" id="5365649">)</span>&nbsp;<span class="ident" id="5365651">parseInt</span><span class="op" id="5365659">(</span><span class="ident" id="5365660">s</span>&nbsp;<span class="builtintype" id="5365662">string</span><span class="op" id="5365668">)</span>&nbsp;<span class="op" id="5365670">(</span><span class="ident" id="5365671">n</span>&nbsp;<span class="builtintype" id="5365673">int</span><span class="op" id="5365676">,</span>&nbsp;<span class="ident" id="5365678">rest</span>&nbsp;<span class="builtintype" id="5365683">string</span><span class="op" id="5365689">,</span>&nbsp;<span class="ident" id="5365691">ok</span>&nbsp;<span class="builtintype" id="5365694">bool</span><span class="op" id="5365698">)</span>&nbsp;<span class="op" id="5365700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365703">if</span>&nbsp;<span class="ident" id="5365706">s</span>&nbsp;<span class="op" id="5365708">==</span>&nbsp;<span class="string" id="5365711">&#34;&#34;</span>&nbsp;<span class="op" id="5365714">||</span>&nbsp;<span class="ident" id="5365717">s</span><span class="op" id="5365718">[</span><span class="num" id="5365719">0</span><span class="op" id="5365720">]</span>&nbsp;<span class="op" id="5365722">&lt;</span>&nbsp;<span class="string" id="5365724">&#39;0&#39;</span>&nbsp;<span class="op" id="5365728">||</span>&nbsp;<span class="string" id="5365731">&#39;9&#39;</span>&nbsp;<span class="op" id="5365735">&lt;</span>&nbsp;<span class="ident" id="5365737">s</span><span class="op" id="5365738">[</span><span class="num" id="5365739">0</span><span class="op" id="5365740">]</span>&nbsp;<span class="op" id="5365742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365746">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365754">}</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5365757">//&nbsp;Disallow&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365785">if</span>&nbsp;<span class="builtinfunc" id="5365788">len</span><span class="op" id="5365791">(</span><span class="ident" id="5365792">s</span><span class="op" id="5365793">)</span>&nbsp;<span class="op" id="5365795">&gt;=</span>&nbsp;<span class="num" id="5365798">2</span>&nbsp;<span class="op" id="5365800">&amp;&amp;</span>&nbsp;<span class="ident" id="5365803">s</span><span class="op" id="5365804">[</span><span class="num" id="5365805">0</span><span class="op" id="5365806">]</span>&nbsp;<span class="op" id="5365808">==</span>&nbsp;<span class="string" id="5365811">&#39;0&#39;</span>&nbsp;<span class="op" id="5365815">&amp;&amp;</span>&nbsp;<span class="string" id="5365818">&#39;0&#39;</span>&nbsp;<span class="op" id="5365822">&lt;=</span>&nbsp;<span class="ident" id="5365825">s</span><span class="op" id="5365826">[</span><span class="num" id="5365827">1</span><span class="op" id="5365828">]</span>&nbsp;<span class="op" id="5365830">&amp;&amp;</span>&nbsp;<span class="ident" id="5365833">s</span><span class="op" id="5365834">[</span><span class="num" id="5365835">1</span><span class="op" id="5365836">]</span>&nbsp;<span class="op" id="5365838">&lt;=</span>&nbsp;<span class="string" id="5365841">&#39;9&#39;</span>&nbsp;<span class="op" id="5365845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365849">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365860">t</span>&nbsp;<span class="op" id="5365862">:=</span>&nbsp;<span class="ident" id="5365865">s</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5365868">for</span>&nbsp;<span class="ident" id="5365872">s</span>&nbsp;<span class="op" id="5365874">!=</span>&nbsp;<span class="string" id="5365877">&#34;&#34;</span>&nbsp;<span class="op" id="5365880">&amp;&amp;</span>&nbsp;<span class="string" id="5365883">&#39;0&#39;</span>&nbsp;<span class="op" id="5365887">&lt;=</span>&nbsp;<span class="ident" id="5365890">s</span><span class="op" id="5365891">[</span><span class="num" id="5365892">0</span><span class="op" id="5365893">]</span>&nbsp;<span class="op" id="5365895">&amp;&amp;</span>&nbsp;<span class="ident" id="5365898">s</span><span class="op" id="5365899">[</span><span class="num" id="5365900">0</span><span class="op" id="5365901">]</span>&nbsp;<span class="op" id="5365903">&lt;=</span>&nbsp;<span class="string" id="5365906">&#39;9&#39;</span>&nbsp;<span class="op" id="5365910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365914">s</span>&nbsp;<span class="op" id="5365916">=</span>&nbsp;<span class="ident" id="5365918">s</span><span class="op" id="5365919">[</span><span class="num" id="5365920">1</span><span class="op" id="5365921">:</span><span class="op" id="5365922">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5365925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365928">rest</span>&nbsp;<span class="op" id="5365933">=</span>&nbsp;<span class="ident" id="5365935">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365938">ok</span>&nbsp;<span class="op" id="5365941">=</span>&nbsp;<span class="builtintype" id="5365943">true</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5365949">//&nbsp;Have&nbsp;digits,&nbsp;compute&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5365981">t</span>&nbsp;<span class="op" id="5365983">=</span>&nbsp;<span class="ident" id="5365985">t</span><span class="op" id="5365986">[</span><span class="op" id="5365987">:</span><span class="builtinfunc" id="5365988">len</span><span class="op" id="5365991">(</span><span class="ident" id="5365992">t</span><span class="op" id="5365993">)</span><span class="op" id="5365994">-</span><span class="builtinfunc" id="5365995">len</span><span class="op" id="5365998">(</span><span class="ident" id="5365999">s</span><span class="op" id="5366000">)</span><span class="op" id="5366001">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366004">for</span>&nbsp;<span class="ident" id="5366008">i</span>&nbsp;<span class="op" id="5366010">:=</span>&nbsp;<span class="num" id="5366013">0</span><span class="op" id="5366014">;</span>&nbsp;<span class="ident" id="5366016">i</span>&nbsp;<span class="op" id="5366018">&lt;</span>&nbsp;<span class="builtinfunc" id="5366020">len</span><span class="op" id="5366023">(</span><span class="ident" id="5366024">t</span><span class="op" id="5366025">)</span><span class="op" id="5366026">;</span>&nbsp;<span class="ident" id="5366028">i</span><span class="op" id="5366029">++</span>&nbsp;<span class="op" id="5366032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5366036">//&nbsp;Avoid&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366057">if</span>&nbsp;<span class="ident" id="5366060">n</span>&nbsp;<span class="op" id="5366062">&gt;=</span>&nbsp;<span class="num" id="5366065">1e8</span>&nbsp;<span class="op" id="5366069">{</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366074">n</span>&nbsp;<span class="op" id="5366076">=</span>&nbsp;<span class="op" id="5366078">-</span><span class="num" id="5366079">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366084">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5366092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366096">n</span>&nbsp;<span class="op" id="5366098">=</span>&nbsp;<span class="ident" id="5366100">n</span><span class="op" id="5366101">*</span><span class="num" id="5366102">10</span>&nbsp;<span class="op" id="5366105">+</span>&nbsp;<span class="builtintype" id="5366107">int</span><span class="op" id="5366110">(</span><span class="ident" id="5366111">t</span><span class="op" id="5366112">[</span><span class="ident" id="5366113">i</span><span class="op" id="5366114">]</span><span class="op" id="5366115">)</span>&nbsp;<span class="op" id="5366117">-</span>&nbsp;<span class="string" id="5366119">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5366124">}</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366127">return</span><br>
<span class="lineno"></span><span class="op" id="5366134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5366137">//&nbsp;can&nbsp;this&nbsp;be&nbsp;represented&nbsp;as&nbsp;a&nbsp;character&nbsp;class?</span><br>
<span class="lineno"></span><span class="comment" id="5366186">//&nbsp;single-rune&nbsp;literal&nbsp;string,&nbsp;char&nbsp;class,&nbsp;.,&nbsp;and&nbsp;.|\n.</span><br>
<span class="lineno">1085</span><span class="keyword" id="5366242">func</span>&nbsp;<span class="ident" id="5366247">isCharClass</span><span class="op" id="5366258">(</span><span class="ident" id="5366259">re</span>&nbsp;<span class="op" id="5366262">*</span><span class="ident" id="5366263">Regexp</span><span class="op" id="5366269">)</span>&nbsp;<span class="builtintype" id="5366271">bool</span>&nbsp;<span class="op" id="5366276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366279">return</span>&nbsp;<span class="ident" id="5366286">re</span><span class="op" id="5366288">.</span><span class="ident" id="5366289">Op</span>&nbsp;<span class="op" id="5366292">==</span>&nbsp;<span class="ident" id="5366295">OpLiteral</span>&nbsp;<span class="op" id="5366305">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5366308">len</span><span class="op" id="5366311">(</span><span class="ident" id="5366312">re</span><span class="op" id="5366314">.</span><span class="ident" id="5366315">Rune</span><span class="op" id="5366319">)</span>&nbsp;<span class="op" id="5366321">==</span>&nbsp;<span class="num" id="5366324">1</span>&nbsp;<span class="op" id="5366326">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366331">re</span><span class="op" id="5366333">.</span><span class="ident" id="5366334">Op</span>&nbsp;<span class="op" id="5366337">==</span>&nbsp;<span class="ident" id="5366340">OpCharClass</span>&nbsp;<span class="op" id="5366352">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366357">re</span><span class="op" id="5366359">.</span><span class="ident" id="5366360">Op</span>&nbsp;<span class="op" id="5366363">==</span>&nbsp;<span class="ident" id="5366366">OpAnyCharNotNL</span>&nbsp;<span class="op" id="5366381">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366386">re</span><span class="op" id="5366388">.</span><span class="ident" id="5366389">Op</span>&nbsp;<span class="op" id="5366392">==</span>&nbsp;<span class="ident" id="5366395">OpAnyChar</span><br>
<span class="lineno">1090</span><span class="op" id="5366405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5366408">//&nbsp;does&nbsp;re&nbsp;match&nbsp;r?</span><br>
<span class="lineno"></span><span class="keyword" id="5366428">func</span>&nbsp;<span class="ident" id="5366433">matchRune</span><span class="op" id="5366442">(</span><span class="ident" id="5366443">re</span>&nbsp;<span class="op" id="5366446">*</span><span class="ident" id="5366447">Regexp</span><span class="op" id="5366453">,</span>&nbsp;<span class="ident" id="5366455">r</span>&nbsp;<span class="builtintype" id="5366457">rune</span><span class="op" id="5366461">)</span>&nbsp;<span class="builtintype" id="5366463">bool</span>&nbsp;<span class="op" id="5366468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366471">switch</span>&nbsp;<span class="ident" id="5366478">re</span><span class="op" id="5366480">.</span><span class="ident" id="5366481">Op</span>&nbsp;<span class="op" id="5366484">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366487">case</span>&nbsp;<span class="ident" id="5366492">OpLiteral</span><span class="op" id="5366501">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366505">return</span>&nbsp;<span class="builtinfunc" id="5366512">len</span><span class="op" id="5366515">(</span><span class="ident" id="5366516">re</span><span class="op" id="5366518">.</span><span class="ident" id="5366519">Rune</span><span class="op" id="5366523">)</span>&nbsp;<span class="op" id="5366525">==</span>&nbsp;<span class="num" id="5366528">1</span>&nbsp;<span class="op" id="5366530">&amp;&amp;</span>&nbsp;<span class="ident" id="5366533">re</span><span class="op" id="5366535">.</span><span class="ident" id="5366536">Rune</span><span class="op" id="5366540">[</span><span class="num" id="5366541">0</span><span class="op" id="5366542">]</span>&nbsp;<span class="op" id="5366544">==</span>&nbsp;<span class="ident" id="5366547">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366550">case</span>&nbsp;<span class="ident" id="5366555">OpCharClass</span><span class="op" id="5366566">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366570">for</span>&nbsp;<span class="ident" id="5366574">i</span>&nbsp;<span class="op" id="5366576">:=</span>&nbsp;<span class="num" id="5366579">0</span><span class="op" id="5366580">;</span>&nbsp;<span class="ident" id="5366582">i</span>&nbsp;<span class="op" id="5366584">&lt;</span>&nbsp;<span class="builtinfunc" id="5366586">len</span><span class="op" id="5366589">(</span><span class="ident" id="5366590">re</span><span class="op" id="5366592">.</span><span class="ident" id="5366593">Rune</span><span class="op" id="5366597">)</span><span class="op" id="5366598">;</span>&nbsp;<span class="ident" id="5366600">i</span>&nbsp;<span class="op" id="5366602">+=</span>&nbsp;<span class="num" id="5366605">2</span>&nbsp;<span class="op" id="5366607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366612">if</span>&nbsp;<span class="ident" id="5366615">re</span><span class="op" id="5366617">.</span><span class="ident" id="5366618">Rune</span><span class="op" id="5366622">[</span><span class="ident" id="5366623">i</span><span class="op" id="5366624">]</span>&nbsp;<span class="op" id="5366626">&lt;=</span>&nbsp;<span class="ident" id="5366629">r</span>&nbsp;<span class="op" id="5366631">&amp;&amp;</span>&nbsp;<span class="ident" id="5366634">r</span>&nbsp;<span class="op" id="5366636">&lt;=</span>&nbsp;<span class="ident" id="5366639">re</span><span class="op" id="5366641">.</span><span class="ident" id="5366642">Rune</span><span class="op" id="5366646">[</span><span class="ident" id="5366647">i</span><span class="op" id="5366648">+</span><span class="num" id="5366649">1</span><span class="op" id="5366650">]</span>&nbsp;<span class="op" id="5366652">{</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366658">return</span>&nbsp;<span class="builtintype" id="5366665">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5366673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5366677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366681">return</span>&nbsp;<span class="builtintype" id="5366688">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366695">case</span>&nbsp;<span class="ident" id="5366700">OpAnyCharNotNL</span><span class="op" id="5366714">:</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366718">return</span>&nbsp;<span class="ident" id="5366725">r</span>&nbsp;<span class="op" id="5366727">!=</span>&nbsp;<span class="string" id="5366730">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366736">case</span>&nbsp;<span class="ident" id="5366741">OpAnyChar</span><span class="op" id="5366750">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366754">return</span>&nbsp;<span class="builtintype" id="5366761">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5366767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366770">return</span>&nbsp;<span class="builtintype" id="5366777">false</span><br>
<span class="lineno">1110</span><span class="op" id="5366783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5366786">//&nbsp;parseVerticalBar&nbsp;handles&nbsp;a&nbsp;|&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5366832">func</span>&nbsp;<span class="op" id="5366837">(</span><span class="ident" id="5366838">p</span>&nbsp;<span class="op" id="5366840">*</span><span class="ident" id="5366841">parser</span><span class="op" id="5366847">)</span>&nbsp;<span class="ident" id="5366849">parseVerticalBar</span><span class="op" id="5366865">(</span><span class="op" id="5366866">)</span>&nbsp;<span class="builtintype" id="5366868">error</span>&nbsp;<span class="op" id="5366874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5366877">p</span><span class="op" id="5366878">.</span><span class="ident" id="5366879">concat</span><span class="op" id="5366885">(</span><span class="op" id="5366886">)</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5366890">//&nbsp;The&nbsp;concatenation&nbsp;we&nbsp;just&nbsp;parsed&nbsp;is&nbsp;on&nbsp;top&nbsp;of&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5366951">//&nbsp;If&nbsp;it&nbsp;sits&nbsp;above&nbsp;an&nbsp;opVerticalBar,&nbsp;swap&nbsp;it&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5367004">//&nbsp;(things&nbsp;below&nbsp;an&nbsp;opVerticalBar&nbsp;become&nbsp;an&nbsp;alternation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5367063">//&nbsp;Otherwise,&nbsp;push&nbsp;a&nbsp;new&nbsp;vertical&nbsp;bar.</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5367103">if</span>&nbsp;<span class="op" id="5367106">!</span><span class="ident" id="5367107">p</span><span class="op" id="5367108">.</span><span class="ident" id="5367109">swapVerticalBar</span><span class="op" id="5367124">(</span><span class="op" id="5367125">)</span>&nbsp;<span class="op" id="5367127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367131">p</span><span class="op" id="5367132">.</span><span class="ident" id="5367133">op</span><span class="op" id="5367135">(</span><span class="ident" id="5367136">opVerticalBar</span><span class="op" id="5367149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5367152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5367156">return</span>&nbsp;<span class="builtintype" id="5367163">nil</span><br>
<span class="lineno">1125</span><span class="op" id="5367167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5367170">//&nbsp;mergeCharClass&nbsp;makes&nbsp;dst&nbsp;=&nbsp;dst|src.</span><br>
<span class="lineno"></span><span class="comment" id="5367209">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;ensure&nbsp;that&nbsp;dst.Op&nbsp;&gt;=&nbsp;src.Op,</span><br>
<span class="lineno"></span><span class="comment" id="5367258">//&nbsp;to&nbsp;reduce&nbsp;the&nbsp;amount&nbsp;of&nbsp;copying.</span><br>
<span class="lineno">1130</span><span class="keyword" id="5367294">func</span>&nbsp;<span class="ident" id="5367299">mergeCharClass</span><span class="op" id="5367313">(</span><span class="ident" id="5367314">dst</span><span class="op" id="5367317">,</span>&nbsp;<span class="ident" id="5367319">src</span>&nbsp;<span class="op" id="5367323">*</span><span class="ident" id="5367324">Regexp</span><span class="op" id="5367330">)</span>&nbsp;<span class="op" id="5367332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5367335">switch</span>&nbsp;<span class="ident" id="5367342">dst</span><span class="op" id="5367345">.</span><span class="ident" id="5367346">Op</span>&nbsp;<span class="op" id="5367349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5367352">case</span>&nbsp;<span class="ident" id="5367357">OpAnyChar</span><span class="op" id="5367366">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5367370">//&nbsp;src&nbsp;doesn&#39;t&nbsp;add&nbsp;anything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5367400">case</span>&nbsp;<span class="ident" id="5367405">OpAnyCharNotNL</span><span class="op" id="5367419">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5367423">//&nbsp;src&nbsp;might&nbsp;add&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5367445">if</span>&nbsp;<span class="ident" id="5367448">matchRune</span><span class="op" id="5367457">(</span><span class="ident" id="5367458">src</span><span class="op" id="5367461">,</span>&nbsp;<span class="string" id="5367463">&#39;\n&#39;</span><span class="op" id="5367467">)</span>&nbsp;<span class="op" id="5367469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367474">dst</span><span class="op" id="5367477">.</span><span class="ident" id="5367478">Op</span>&nbsp;<span class="op" id="5367481">=</span>&nbsp;<span class="ident" id="5367483">OpAnyChar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5367495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5367498">case</span>&nbsp;<span class="ident" id="5367503">OpCharClass</span><span class="op" id="5367514">:</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5367518">//&nbsp;src&nbsp;is&nbsp;simpler,&nbsp;so&nbsp;either&nbsp;literal&nbsp;or&nbsp;char&nbsp;class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5367571">if</span>&nbsp;<span class="ident" id="5367574">src</span><span class="op" id="5367577">.</span><span class="ident" id="5367578">Op</span>&nbsp;<span class="op" id="5367581">==</span>&nbsp;<span class="ident" id="5367584">OpLiteral</span>&nbsp;<span class="op" id="5367594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367599">dst</span><span class="op" id="5367602">.</span><span class="ident" id="5367603">Rune</span>&nbsp;<span class="op" id="5367608">=</span>&nbsp;<span class="ident" id="5367610">appendLiteral</span><span class="op" id="5367623">(</span><span class="ident" id="5367624">dst</span><span class="op" id="5367627">.</span><span class="ident" id="5367628">Rune</span><span class="op" id="5367632">,</span>&nbsp;<span class="ident" id="5367634">src</span><span class="op" id="5367637">.</span><span class="ident" id="5367638">Rune</span><span class="op" id="5367642">[</span><span class="num" id="5367643">0</span><span class="op" id="5367644">]</span><span class="op" id="5367645">,</span>&nbsp;<span class="ident" id="5367647">src</span><span class="op" id="5367650">.</span><span class="ident" id="5367651">Flags</span><span class="op" id="5367656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5367660">}</span>&nbsp;<span class="keyword" id="5367662">else</span>&nbsp;<span class="op" id="5367667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367672">dst</span><span class="op" id="5367675">.</span><span class="ident" id="5367676">Rune</span>&nbsp;<span class="op" id="5367681">=</span>&nbsp;<span class="ident" id="5367683">appendClass</span><span class="op" id="5367694">(</span><span class="ident" id="5367695">dst</span><span class="op" id="5367698">.</span><span class="ident" id="5367699">Rune</span><span class="op" id="5367703">,</span>&nbsp;<span class="ident" id="5367705">src</span><span class="op" id="5367708">.</span><span class="ident" id="5367709">Rune</span><span class="op" id="5367713">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5367717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5367720">case</span>&nbsp;<span class="ident" id="5367725">OpLiteral</span><span class="op" id="5367734">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5367738">//&nbsp;both&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5367756">if</span>&nbsp;<span class="ident" id="5367759">src</span><span class="op" id="5367762">.</span><span class="ident" id="5367763">Rune</span><span class="op" id="5367767">[</span><span class="num" id="5367768">0</span><span class="op" id="5367769">]</span>&nbsp;<span class="op" id="5367771">==</span>&nbsp;<span class="ident" id="5367774">dst</span><span class="op" id="5367777">.</span><span class="ident" id="5367778">Rune</span><span class="op" id="5367782">[</span><span class="num" id="5367783">0</span><span class="op" id="5367784">]</span>&nbsp;<span class="op" id="5367786">&amp;&amp;</span>&nbsp;<span class="ident" id="5367789">src</span><span class="op" id="5367792">.</span><span class="ident" id="5367793">Flags</span>&nbsp;<span class="op" id="5367799">==</span>&nbsp;<span class="ident" id="5367802">dst</span><span class="op" id="5367805">.</span><span class="ident" id="5367806">Flags</span>&nbsp;<span class="op" id="5367812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5367817">break</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5367825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367829">dst</span><span class="op" id="5367832">.</span><span class="ident" id="5367833">Op</span>&nbsp;<span class="op" id="5367836">=</span>&nbsp;<span class="ident" id="5367838">OpCharClass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367852">dst</span><span class="op" id="5367855">.</span><span class="ident" id="5367856">Rune</span>&nbsp;<span class="op" id="5367861">=</span>&nbsp;<span class="ident" id="5367863">appendLiteral</span><span class="op" id="5367876">(</span><span class="ident" id="5367877">dst</span><span class="op" id="5367880">.</span><span class="ident" id="5367881">Rune</span><span class="op" id="5367885">[</span><span class="op" id="5367886">:</span><span class="num" id="5367887">0</span><span class="op" id="5367888">]</span><span class="op" id="5367889">,</span>&nbsp;<span class="ident" id="5367891">dst</span><span class="op" id="5367894">.</span><span class="ident" id="5367895">Rune</span><span class="op" id="5367899">[</span><span class="num" id="5367900">0</span><span class="op" id="5367901">]</span><span class="op" id="5367902">,</span>&nbsp;<span class="ident" id="5367904">dst</span><span class="op" id="5367907">.</span><span class="ident" id="5367908">Flags</span><span class="op" id="5367913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367917">dst</span><span class="op" id="5367920">.</span><span class="ident" id="5367921">Rune</span>&nbsp;<span class="op" id="5367926">=</span>&nbsp;<span class="ident" id="5367928">appendLiteral</span><span class="op" id="5367941">(</span><span class="ident" id="5367942">dst</span><span class="op" id="5367945">.</span><span class="ident" id="5367946">Rune</span><span class="op" id="5367950">,</span>&nbsp;<span class="ident" id="5367952">src</span><span class="op" id="5367955">.</span><span class="ident" id="5367956">Rune</span><span class="op" id="5367960">[</span><span class="num" id="5367961">0</span><span class="op" id="5367962">]</span><span class="op" id="5367963">,</span>&nbsp;<span class="ident" id="5367965">src</span><span class="op" id="5367968">.</span><span class="ident" id="5367969">Flags</span><span class="op" id="5367974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5367977">}</span><br>
<span class="lineno">1155</span><span class="op" id="5367979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5367982">//&nbsp;If&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;is&nbsp;an&nbsp;element&nbsp;followed&nbsp;by&nbsp;an&nbsp;opVerticalBar</span><br>
<span class="lineno"></span><span class="comment" id="5368052">//&nbsp;swapVerticalBar&nbsp;swaps&nbsp;the&nbsp;two&nbsp;and&nbsp;returns&nbsp;true.</span><br>
<span class="lineno"></span><span class="comment" id="5368103">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;false.</span><br>
<span class="lineno">1160</span><span class="keyword" id="5368134">func</span>&nbsp;<span class="op" id="5368139">(</span><span class="ident" id="5368140">p</span>&nbsp;<span class="op" id="5368142">*</span><span class="ident" id="5368143">parser</span><span class="op" id="5368149">)</span>&nbsp;<span class="ident" id="5368151">swapVerticalBar</span><span class="op" id="5368166">(</span><span class="op" id="5368167">)</span>&nbsp;<span class="builtintype" id="5368169">bool</span>&nbsp;<span class="op" id="5368174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5368177">//&nbsp;If&nbsp;above&nbsp;and&nbsp;below&nbsp;vertical&nbsp;bar&nbsp;are&nbsp;literal&nbsp;or&nbsp;char&nbsp;class,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5368240">//&nbsp;can&nbsp;merge&nbsp;into&nbsp;a&nbsp;single&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368280">n</span>&nbsp;<span class="op" id="5368282">:=</span>&nbsp;<span class="builtinfunc" id="5368285">len</span><span class="op" id="5368288">(</span><span class="ident" id="5368289">p</span><span class="op" id="5368290">.</span><span class="ident" id="5368291">stack</span><span class="op" id="5368296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5368299">if</span>&nbsp;<span class="ident" id="5368302">n</span>&nbsp;<span class="op" id="5368304">&gt;=</span>&nbsp;<span class="num" id="5368307">3</span>&nbsp;<span class="op" id="5368309">&amp;&amp;</span>&nbsp;<span class="ident" id="5368312">p</span><span class="op" id="5368313">.</span><span class="ident" id="5368314">stack</span><span class="op" id="5368319">[</span><span class="ident" id="5368320">n</span><span class="op" id="5368321">-</span><span class="num" id="5368322">2</span><span class="op" id="5368323">]</span><span class="op" id="5368324">.</span><span class="ident" id="5368325">Op</span>&nbsp;<span class="op" id="5368328">==</span>&nbsp;<span class="ident" id="5368331">opVerticalBar</span>&nbsp;<span class="op" id="5368345">&amp;&amp;</span>&nbsp;<span class="ident" id="5368348">isCharClass</span><span class="op" id="5368359">(</span><span class="ident" id="5368360">p</span><span class="op" id="5368361">.</span><span class="ident" id="5368362">stack</span><span class="op" id="5368367">[</span><span class="ident" id="5368368">n</span><span class="op" id="5368369">-</span><span class="num" id="5368370">1</span><span class="op" id="5368371">]</span><span class="op" id="5368372">)</span>&nbsp;<span class="op" id="5368374">&amp;&amp;</span>&nbsp;<span class="ident" id="5368377">isCharClass</span><span class="op" id="5368388">(</span><span class="ident" id="5368389">p</span><span class="op" id="5368390">.</span><span class="ident" id="5368391">stack</span><span class="op" id="5368396">[</span><span class="ident" id="5368397">n</span><span class="op" id="5368398">-</span><span class="num" id="5368399">3</span><span class="op" id="5368400">]</span><span class="op" id="5368401">)</span>&nbsp;<span class="op" id="5368403">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368407">re1</span>&nbsp;<span class="op" id="5368411">:=</span>&nbsp;<span class="ident" id="5368414">p</span><span class="op" id="5368415">.</span><span class="ident" id="5368416">stack</span><span class="op" id="5368421">[</span><span class="ident" id="5368422">n</span><span class="op" id="5368423">-</span><span class="num" id="5368424">1</span><span class="op" id="5368425">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368429">re3</span>&nbsp;<span class="op" id="5368433">:=</span>&nbsp;<span class="ident" id="5368436">p</span><span class="op" id="5368437">.</span><span class="ident" id="5368438">stack</span><span class="op" id="5368443">[</span><span class="ident" id="5368444">n</span><span class="op" id="5368445">-</span><span class="num" id="5368446">3</span><span class="op" id="5368447">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5368451">//&nbsp;Make&nbsp;re3&nbsp;the&nbsp;more&nbsp;complex&nbsp;of&nbsp;the&nbsp;two.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5368494">if</span>&nbsp;<span class="ident" id="5368497">re1</span><span class="op" id="5368500">.</span><span class="ident" id="5368501">Op</span>&nbsp;<span class="op" id="5368504">&gt;</span>&nbsp;<span class="ident" id="5368506">re3</span><span class="op" id="5368509">.</span><span class="ident" id="5368510">Op</span>&nbsp;<span class="op" id="5368513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368518">re1</span><span class="op" id="5368521">,</span>&nbsp;<span class="ident" id="5368523">re3</span>&nbsp;<span class="op" id="5368527">=</span>&nbsp;<span class="ident" id="5368529">re3</span><span class="op" id="5368532">,</span>&nbsp;<span class="ident" id="5368534">re1</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368541">p</span><span class="op" id="5368542">.</span><span class="ident" id="5368543">stack</span><span class="op" id="5368548">[</span><span class="ident" id="5368549">n</span><span class="op" id="5368550">-</span><span class="num" id="5368551">3</span><span class="op" id="5368552">]</span>&nbsp;<span class="op" id="5368554">=</span>&nbsp;<span class="ident" id="5368556">re3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5368562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368566">mergeCharClass</span><span class="op" id="5368580">(</span><span class="ident" id="5368581">re3</span><span class="op" id="5368584">,</span>&nbsp;<span class="ident" id="5368586">re1</span><span class="op" id="5368589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368593">p</span><span class="op" id="5368594">.</span><span class="ident" id="5368595">reuse</span><span class="op" id="5368600">(</span><span class="ident" id="5368601">re1</span><span class="op" id="5368604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368608">p</span><span class="op" id="5368609">.</span><span class="ident" id="5368610">stack</span>&nbsp;<span class="op" id="5368616">=</span>&nbsp;<span class="ident" id="5368618">p</span><span class="op" id="5368619">.</span><span class="ident" id="5368620">stack</span><span class="op" id="5368625">[</span><span class="op" id="5368626">:</span><span class="ident" id="5368627">n</span><span class="op" id="5368628">-</span><span class="num" id="5368629">1</span><span class="op" id="5368630">]</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5368634">return</span>&nbsp;<span class="builtintype" id="5368641">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5368647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5368651">if</span>&nbsp;<span class="ident" id="5368654">n</span>&nbsp;<span class="op" id="5368656">&gt;=</span>&nbsp;<span class="num" id="5368659">2</span>&nbsp;<span class="op" id="5368661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368665">re1</span>&nbsp;<span class="op" id="5368669">:=</span>&nbsp;<span class="ident" id="5368672">p</span><span class="op" id="5368673">.</span><span class="ident" id="5368674">stack</span><span class="op" id="5368679">[</span><span class="ident" id="5368680">n</span><span class="op" id="5368681">-</span><span class="num" id="5368682">1</span><span class="op" id="5368683">]</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368687">re2</span>&nbsp;<span class="op" id="5368691">:=</span>&nbsp;<span class="ident" id="5368694">p</span><span class="op" id="5368695">.</span><span class="ident" id="5368696">stack</span><span class="op" id="5368701">[</span><span class="ident" id="5368702">n</span><span class="op" id="5368703">-</span><span class="num" id="5368704">2</span><span class="op" id="5368705">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5368709">if</span>&nbsp;<span class="ident" id="5368712">re2</span><span class="op" id="5368715">.</span><span class="ident" id="5368716">Op</span>&nbsp;<span class="op" id="5368719">==</span>&nbsp;<span class="ident" id="5368722">opVerticalBar</span>&nbsp;<span class="op" id="5368736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5368741">if</span>&nbsp;<span class="ident" id="5368744">n</span>&nbsp;<span class="op" id="5368746">&gt;=</span>&nbsp;<span class="num" id="5368749">3</span>&nbsp;<span class="op" id="5368751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5368757">//&nbsp;Now&nbsp;out&nbsp;of&nbsp;reach.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5368782">//&nbsp;Clean&nbsp;opportunistically.</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368814">cleanAlt</span><span class="op" id="5368822">(</span><span class="ident" id="5368823">p</span><span class="op" id="5368824">.</span><span class="ident" id="5368825">stack</span><span class="op" id="5368830">[</span><span class="ident" id="5368831">n</span><span class="op" id="5368832">-</span><span class="num" id="5368833">3</span><span class="op" id="5368834">]</span><span class="op" id="5368835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5368840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368845">p</span><span class="op" id="5368846">.</span><span class="ident" id="5368847">stack</span><span class="op" id="5368852">[</span><span class="ident" id="5368853">n</span><span class="op" id="5368854">-</span><span class="num" id="5368855">2</span><span class="op" id="5368856">]</span>&nbsp;<span class="op" id="5368858">=</span>&nbsp;<span class="ident" id="5368860">re1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5368867">p</span><span class="op" id="5368868">.</span><span class="ident" id="5368869">stack</span><span class="op" id="5368874">[</span><span class="ident" id="5368875">n</span><span class="op" id="5368876">-</span><span class="num" id="5368877">1</span><span class="op" id="5368878">]</span>&nbsp;<span class="op" id="5368880">=</span>&nbsp;<span class="ident" id="5368882">re2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5368889">return</span>&nbsp;<span class="builtintype" id="5368896">true</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5368903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5368906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5368909">return</span>&nbsp;<span class="builtintype" id="5368916">false</span><br>
<span class="lineno"></span><span class="op" id="5368922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1195</span><span class="comment" id="5368925">//&nbsp;parseRightParen&nbsp;handles&nbsp;a&nbsp;)&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5368970">func</span>&nbsp;<span class="op" id="5368975">(</span><span class="ident" id="5368976">p</span>&nbsp;<span class="op" id="5368978">*</span><span class="ident" id="5368979">parser</span><span class="op" id="5368985">)</span>&nbsp;<span class="ident" id="5368987">parseRightParen</span><span class="op" id="5369002">(</span><span class="op" id="5369003">)</span>&nbsp;<span class="builtintype" id="5369005">error</span>&nbsp;<span class="op" id="5369011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369014">p</span><span class="op" id="5369015">.</span><span class="ident" id="5369016">concat</span><span class="op" id="5369022">(</span><span class="op" id="5369023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369026">if</span>&nbsp;<span class="ident" id="5369029">p</span><span class="op" id="5369030">.</span><span class="ident" id="5369031">swapVerticalBar</span><span class="op" id="5369046">(</span><span class="op" id="5369047">)</span>&nbsp;<span class="op" id="5369049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5369053">//&nbsp;pop&nbsp;vertical&nbsp;bar</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369075">p</span><span class="op" id="5369076">.</span><span class="ident" id="5369077">stack</span>&nbsp;<span class="op" id="5369083">=</span>&nbsp;<span class="ident" id="5369085">p</span><span class="op" id="5369086">.</span><span class="ident" id="5369087">stack</span><span class="op" id="5369092">[</span><span class="op" id="5369093">:</span><span class="builtinfunc" id="5369094">len</span><span class="op" id="5369097">(</span><span class="ident" id="5369098">p</span><span class="op" id="5369099">.</span><span class="ident" id="5369100">stack</span><span class="op" id="5369105">)</span><span class="op" id="5369106">-</span><span class="num" id="5369107">1</span><span class="op" id="5369108">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5369111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369114">p</span><span class="op" id="5369115">.</span><span class="ident" id="5369116">alternate</span><span class="op" id="5369125">(</span><span class="op" id="5369126">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369130">n</span>&nbsp;<span class="op" id="5369132">:=</span>&nbsp;<span class="builtinfunc" id="5369135">len</span><span class="op" id="5369138">(</span><span class="ident" id="5369139">p</span><span class="op" id="5369140">.</span><span class="ident" id="5369141">stack</span><span class="op" id="5369146">)</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369149">if</span>&nbsp;<span class="ident" id="5369152">n</span>&nbsp;<span class="op" id="5369154">&lt;</span>&nbsp;<span class="num" id="5369156">2</span>&nbsp;<span class="op" id="5369158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369162">return</span>&nbsp;<span class="op" id="5369169">&amp;</span><span class="ident" id="5369170">Error</span><span class="op" id="5369175">{</span><span class="ident" id="5369176">ErrUnexpectedParen</span><span class="op" id="5369194">,</span>&nbsp;<span class="ident" id="5369196">p</span><span class="op" id="5369197">.</span><span class="ident" id="5369198">wholeRegexp</span><span class="op" id="5369209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5369212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369215">re1</span>&nbsp;<span class="op" id="5369219">:=</span>&nbsp;<span class="ident" id="5369222">p</span><span class="op" id="5369223">.</span><span class="ident" id="5369224">stack</span><span class="op" id="5369229">[</span><span class="ident" id="5369230">n</span><span class="op" id="5369231">-</span><span class="num" id="5369232">1</span><span class="op" id="5369233">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369236">re2</span>&nbsp;<span class="op" id="5369240">:=</span>&nbsp;<span class="ident" id="5369243">p</span><span class="op" id="5369244">.</span><span class="ident" id="5369245">stack</span><span class="op" id="5369250">[</span><span class="ident" id="5369251">n</span><span class="op" id="5369252">-</span><span class="num" id="5369253">2</span><span class="op" id="5369254">]</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369257">p</span><span class="op" id="5369258">.</span><span class="ident" id="5369259">stack</span>&nbsp;<span class="op" id="5369265">=</span>&nbsp;<span class="ident" id="5369267">p</span><span class="op" id="5369268">.</span><span class="ident" id="5369269">stack</span><span class="op" id="5369274">[</span><span class="op" id="5369275">:</span><span class="ident" id="5369276">n</span><span class="op" id="5369277">-</span><span class="num" id="5369278">2</span><span class="op" id="5369279">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369282">if</span>&nbsp;<span class="ident" id="5369285">re2</span><span class="op" id="5369288">.</span><span class="ident" id="5369289">Op</span>&nbsp;<span class="op" id="5369292">!=</span>&nbsp;<span class="ident" id="5369295">opLeftParen</span>&nbsp;<span class="op" id="5369307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369311">return</span>&nbsp;<span class="op" id="5369318">&amp;</span><span class="ident" id="5369319">Error</span><span class="op" id="5369324">{</span><span class="ident" id="5369325">ErrUnexpectedParen</span><span class="op" id="5369343">,</span>&nbsp;<span class="ident" id="5369345">p</span><span class="op" id="5369346">.</span><span class="ident" id="5369347">wholeRegexp</span><span class="op" id="5369358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5369361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5369364">//&nbsp;Restore&nbsp;flags&nbsp;at&nbsp;time&nbsp;of&nbsp;paren.</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369400">p</span><span class="op" id="5369401">.</span><span class="ident" id="5369402">flags</span>&nbsp;<span class="op" id="5369408">=</span>&nbsp;<span class="ident" id="5369410">re2</span><span class="op" id="5369413">.</span><span class="ident" id="5369414">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369421">if</span>&nbsp;<span class="ident" id="5369424">re2</span><span class="op" id="5369427">.</span><span class="ident" id="5369428">Cap</span>&nbsp;<span class="op" id="5369432">==</span>&nbsp;<span class="num" id="5369435">0</span>&nbsp;<span class="op" id="5369437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5369441">//&nbsp;Just&nbsp;for&nbsp;grouping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369465">p</span><span class="op" id="5369466">.</span><span class="ident" id="5369467">push</span><span class="op" id="5369471">(</span><span class="ident" id="5369472">re1</span><span class="op" id="5369475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5369478">}</span>&nbsp;<span class="keyword" id="5369480">else</span>&nbsp;<span class="op" id="5369485">{</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369489">re2</span><span class="op" id="5369492">.</span><span class="ident" id="5369493">Op</span>&nbsp;<span class="op" id="5369496">=</span>&nbsp;<span class="ident" id="5369498">OpCapture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369510">re2</span><span class="op" id="5369513">.</span><span class="ident" id="5369514">Sub</span>&nbsp;<span class="op" id="5369518">=</span>&nbsp;<span class="ident" id="5369520">re2</span><span class="op" id="5369523">.</span><span class="ident" id="5369524">Sub0</span><span class="op" id="5369528">[</span><span class="op" id="5369529">:</span><span class="num" id="5369530">1</span><span class="op" id="5369531">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369535">re2</span><span class="op" id="5369538">.</span><span class="ident" id="5369539">Sub</span><span class="op" id="5369542">[</span><span class="num" id="5369543">0</span><span class="op" id="5369544">]</span>&nbsp;<span class="op" id="5369546">=</span>&nbsp;<span class="ident" id="5369548">re1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369554">p</span><span class="op" id="5369555">.</span><span class="ident" id="5369556">push</span><span class="op" id="5369560">(</span><span class="ident" id="5369561">re2</span><span class="op" id="5369564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5369567">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369570">return</span>&nbsp;<span class="builtintype" id="5369577">nil</span><br>
<span class="lineno"></span><span class="op" id="5369581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5369584">//&nbsp;parseEscape&nbsp;parses&nbsp;an&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5369647">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune.</span><br>
<span class="lineno">1230</span><span class="keyword" id="5369672">func</span>&nbsp;<span class="op" id="5369677">(</span><span class="ident" id="5369678">p</span>&nbsp;<span class="op" id="5369680">*</span><span class="ident" id="5369681">parser</span><span class="op" id="5369687">)</span>&nbsp;<span class="ident" id="5369689">parseEscape</span><span class="op" id="5369700">(</span><span class="ident" id="5369701">s</span>&nbsp;<span class="builtintype" id="5369703">string</span><span class="op" id="5369709">)</span>&nbsp;<span class="op" id="5369711">(</span><span class="ident" id="5369712">r</span>&nbsp;<span class="builtintype" id="5369714">rune</span><span class="op" id="5369718">,</span>&nbsp;<span class="ident" id="5369720">rest</span>&nbsp;<span class="builtintype" id="5369725">string</span><span class="op" id="5369731">,</span>&nbsp;<span class="ident" id="5369733">err</span>&nbsp;<span class="builtintype" id="5369737">error</span><span class="op" id="5369742">)</span>&nbsp;<span class="op" id="5369744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369747">t</span>&nbsp;<span class="op" id="5369749">:=</span>&nbsp;<span class="ident" id="5369752">s</span><span class="op" id="5369753">[</span><span class="num" id="5369754">1</span><span class="op" id="5369755">:</span><span class="op" id="5369756">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369759">if</span>&nbsp;<span class="ident" id="5369762">t</span>&nbsp;<span class="op" id="5369764">==</span>&nbsp;<span class="string" id="5369767">&#34;&#34;</span>&nbsp;<span class="op" id="5369770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369774">return</span>&nbsp;<span class="num" id="5369781">0</span><span class="op" id="5369782">,</span>&nbsp;<span class="string" id="5369784">&#34;&#34;</span><span class="op" id="5369786">,</span>&nbsp;<span class="op" id="5369788">&amp;</span><span class="ident" id="5369789">Error</span><span class="op" id="5369794">{</span><span class="ident" id="5369795">ErrTrailingBackslash</span><span class="op" id="5369815">,</span>&nbsp;<span class="string" id="5369817">&#34;&#34;</span><span class="op" id="5369819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5369822">}</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5369825">c</span><span class="op" id="5369826">,</span>&nbsp;<span class="ident" id="5369828">t</span><span class="op" id="5369829">,</span>&nbsp;<span class="ident" id="5369831">err</span>&nbsp;<span class="op" id="5369835">:=</span>&nbsp;<span class="ident" id="5369838">nextRune</span><span class="op" id="5369846">(</span><span class="ident" id="5369847">t</span><span class="op" id="5369848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369851">if</span>&nbsp;<span class="ident" id="5369854">err</span>&nbsp;<span class="op" id="5369858">!=</span>&nbsp;<span class="builtintype" id="5369861">nil</span>&nbsp;<span class="op" id="5369865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369869">return</span>&nbsp;<span class="num" id="5369876">0</span><span class="op" id="5369877">,</span>&nbsp;<span class="string" id="5369879">&#34;&#34;</span><span class="op" id="5369881">,</span>&nbsp;<span class="ident" id="5369883">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5369888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1240</span><span class="ident" id="5369891">Switch</span><span class="op" id="5369897">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369900">switch</span>&nbsp;<span class="ident" id="5369907">c</span>&nbsp;<span class="op" id="5369909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369912">default</span><span class="op" id="5369919">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5369923">if</span>&nbsp;<span class="ident" id="5369926">c</span>&nbsp;<span class="op" id="5369928">&lt;</span>&nbsp;<span class="ident" id="5369930">utf8</span><span class="op" id="5369934">.</span><span class="ident" id="5369935">RuneSelf</span>&nbsp;<span class="op" id="5369944">&amp;&amp;</span>&nbsp;<span class="op" id="5369947">!</span><span class="ident" id="5369948">isalnum</span><span class="op" id="5369955">(</span><span class="ident" id="5369956">c</span><span class="op" id="5369957">)</span>&nbsp;<span class="op" id="5369959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5369964">//&nbsp;Escaped&nbsp;non-word&nbsp;characters&nbsp;are&nbsp;always&nbsp;themselves.</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5370021">//&nbsp;PCRE&nbsp;is&nbsp;not&nbsp;quite&nbsp;so&nbsp;rigorous:&nbsp;it&nbsp;accepts&nbsp;things&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5370081">//&nbsp;\q,&nbsp;but&nbsp;we&nbsp;don&#39;t.&nbsp;&nbsp;We&nbsp;once&nbsp;rejected&nbsp;\_,&nbsp;but&nbsp;too&nbsp;many</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5370140">//&nbsp;programs&nbsp;and&nbsp;people&nbsp;insist&nbsp;on&nbsp;using&nbsp;it,&nbsp;so&nbsp;allow&nbsp;\_.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370199">return</span>&nbsp;<span class="ident" id="5370206">c</span><span class="op" id="5370207">,</span>&nbsp;<span class="ident" id="5370209">t</span><span class="op" id="5370210">,</span>&nbsp;<span class="builtintype" id="5370212">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5370218">}</span><br>
<span class="lineno">1250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5370222">//&nbsp;Octal&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370241">case</span>&nbsp;<span class="string" id="5370246">&#39;1&#39;</span><span class="op" id="5370249">,</span>&nbsp;<span class="string" id="5370251">&#39;2&#39;</span><span class="op" id="5370254">,</span>&nbsp;<span class="string" id="5370256">&#39;3&#39;</span><span class="op" id="5370259">,</span>&nbsp;<span class="string" id="5370261">&#39;4&#39;</span><span class="op" id="5370264">,</span>&nbsp;<span class="string" id="5370266">&#39;5&#39;</span><span class="op" id="5370269">,</span>&nbsp;<span class="string" id="5370271">&#39;6&#39;</span><span class="op" id="5370274">,</span>&nbsp;<span class="string" id="5370276">&#39;7&#39;</span><span class="op" id="5370279">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5370283">//&nbsp;Single&nbsp;non-zero&nbsp;digit&nbsp;is&nbsp;a&nbsp;backreference;&nbsp;not&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370344">if</span>&nbsp;<span class="ident" id="5370347">t</span>&nbsp;<span class="op" id="5370349">==</span>&nbsp;<span class="string" id="5370352">&#34;&#34;</span>&nbsp;<span class="op" id="5370355">||</span>&nbsp;<span class="ident" id="5370358">t</span><span class="op" id="5370359">[</span><span class="num" id="5370360">0</span><span class="op" id="5370361">]</span>&nbsp;<span class="op" id="5370363">&lt;</span>&nbsp;<span class="string" id="5370365">&#39;0&#39;</span>&nbsp;<span class="op" id="5370369">||</span>&nbsp;<span class="ident" id="5370372">t</span><span class="op" id="5370373">[</span><span class="num" id="5370374">0</span><span class="op" id="5370375">]</span>&nbsp;<span class="op" id="5370377">&gt;</span>&nbsp;<span class="string" id="5370379">&#39;7&#39;</span>&nbsp;<span class="op" id="5370383">{</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370388">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5370396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370400">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370413">case</span>&nbsp;<span class="string" id="5370418">&#39;0&#39;</span><span class="op" id="5370421">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5370425">//&nbsp;Consume&nbsp;up&nbsp;to&nbsp;three&nbsp;octal&nbsp;digits;&nbsp;already&nbsp;have&nbsp;one.</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5370482">r</span>&nbsp;<span class="op" id="5370484">=</span>&nbsp;<span class="ident" id="5370486">c</span>&nbsp;<span class="op" id="5370488">-</span>&nbsp;<span class="string" id="5370490">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370496">for</span>&nbsp;<span class="ident" id="5370500">i</span>&nbsp;<span class="op" id="5370502">:=</span>&nbsp;<span class="num" id="5370505">1</span><span class="op" id="5370506">;</span>&nbsp;<span class="ident" id="5370508">i</span>&nbsp;<span class="op" id="5370510">&lt;</span>&nbsp;<span class="num" id="5370512">3</span><span class="op" id="5370513">;</span>&nbsp;<span class="ident" id="5370515">i</span><span class="op" id="5370516">++</span>&nbsp;<span class="op" id="5370519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370524">if</span>&nbsp;<span class="ident" id="5370527">t</span>&nbsp;<span class="op" id="5370529">==</span>&nbsp;<span class="string" id="5370532">&#34;&#34;</span>&nbsp;<span class="op" id="5370535">||</span>&nbsp;<span class="ident" id="5370538">t</span><span class="op" id="5370539">[</span><span class="num" id="5370540">0</span><span class="op" id="5370541">]</span>&nbsp;<span class="op" id="5370543">&lt;</span>&nbsp;<span class="string" id="5370545">&#39;0&#39;</span>&nbsp;<span class="op" id="5370549">||</span>&nbsp;<span class="ident" id="5370552">t</span><span class="op" id="5370553">[</span><span class="num" id="5370554">0</span><span class="op" id="5370555">]</span>&nbsp;<span class="op" id="5370557">&gt;</span>&nbsp;<span class="string" id="5370559">&#39;7&#39;</span>&nbsp;<span class="op" id="5370563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370569">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5370578">}</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5370583">r</span>&nbsp;<span class="op" id="5370585">=</span>&nbsp;<span class="ident" id="5370587">r</span><span class="op" id="5370588">*</span><span class="num" id="5370589">8</span>&nbsp;<span class="op" id="5370591">+</span>&nbsp;<span class="builtintype" id="5370593">rune</span><span class="op" id="5370597">(</span><span class="ident" id="5370598">t</span><span class="op" id="5370599">[</span><span class="num" id="5370600">0</span><span class="op" id="5370601">]</span><span class="op" id="5370602">)</span>&nbsp;<span class="op" id="5370604">-</span>&nbsp;<span class="string" id="5370606">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5370613">t</span>&nbsp;<span class="op" id="5370615">=</span>&nbsp;<span class="ident" id="5370617">t</span><span class="op" id="5370618">[</span><span class="num" id="5370619">1</span><span class="op" id="5370620">:</span><span class="op" id="5370621">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5370625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370629">return</span>&nbsp;<span class="ident" id="5370636">r</span><span class="op" id="5370637">,</span>&nbsp;<span class="ident" id="5370639">t</span><span class="op" id="5370640">,</span>&nbsp;<span class="builtintype" id="5370642">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5370648">//&nbsp;Hexadecimal&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370673">case</span>&nbsp;<span class="string" id="5370678">&#39;x&#39;</span><span class="op" id="5370681">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370685">if</span>&nbsp;<span class="ident" id="5370688">t</span>&nbsp;<span class="op" id="5370690">==</span>&nbsp;<span class="string" id="5370693">&#34;&#34;</span>&nbsp;<span class="op" id="5370696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370701">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5370709">}</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370713">if</span>&nbsp;<span class="ident" id="5370716">c</span><span class="op" id="5370717">,</span>&nbsp;<span class="ident" id="5370719">t</span><span class="op" id="5370720">,</span>&nbsp;<span class="ident" id="5370722">err</span>&nbsp;<span class="op" id="5370726">=</span>&nbsp;<span class="ident" id="5370728">nextRune</span><span class="op" id="5370736">(</span><span class="ident" id="5370737">t</span><span class="op" id="5370738">)</span><span class="op" id="5370739">;</span>&nbsp;<span class="ident" id="5370741">err</span>&nbsp;<span class="op" id="5370745">!=</span>&nbsp;<span class="builtintype" id="5370748">nil</span>&nbsp;<span class="op" id="5370752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370757">return</span>&nbsp;<span class="num" id="5370764">0</span><span class="op" id="5370765">,</span>&nbsp;<span class="string" id="5370767">&#34;&#34;</span><span class="op" id="5370769">,</span>&nbsp;<span class="ident" id="5370771">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5370777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5370781">if</span>&nbsp;<span class="ident" id="5370784">c</span>&nbsp;<span class="op" id="5370786">==</span>&nbsp;<span class="string" id="5370789">&#39;{&#39;</span>&nbsp;<span class="op" id="5370793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5370798">//&nbsp;Any&nbsp;number&nbsp;of&nbsp;digits&nbsp;in&nbsp;braces.</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5370836">//&nbsp;Perl&nbsp;accepts&nbsp;any&nbsp;text&nbsp;at&nbsp;all;&nbsp;it&nbsp;ignores&nbsp;all&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5370892">//&nbsp;after&nbsp;the&nbsp;first&nbsp;non-hex&nbsp;digit.&nbsp;&nbsp;We&nbsp;require&nbsp;only&nbsp;hex&nbsp;digits,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5370958">//&nbsp;and&nbsp;at&nbsp;least&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5370982">nhex</span>&nbsp;<span class="op" id="5370987">:=</span>&nbsp;<span class="num" id="5370990">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5370995">r</span>&nbsp;<span class="op" id="5370997">=</span>&nbsp;<span class="num" id="5370999">0</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371004">for</span>&nbsp;<span class="op" id="5371008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371014">if</span>&nbsp;<span class="ident" id="5371017">t</span>&nbsp;<span class="op" id="5371019">==</span>&nbsp;<span class="string" id="5371022">&#34;&#34;</span>&nbsp;<span class="op" id="5371025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371032">break</span>&nbsp;<span class="ident" id="5371038">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5371049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371055">if</span>&nbsp;<span class="ident" id="5371058">c</span><span class="op" id="5371059">,</span>&nbsp;<span class="ident" id="5371061">t</span><span class="op" id="5371062">,</span>&nbsp;<span class="ident" id="5371064">err</span>&nbsp;<span class="op" id="5371068">=</span>&nbsp;<span class="ident" id="5371070">nextRune</span><span class="op" id="5371078">(</span><span class="ident" id="5371079">t</span><span class="op" id="5371080">)</span><span class="op" id="5371081">;</span>&nbsp;<span class="ident" id="5371083">err</span>&nbsp;<span class="op" id="5371087">!=</span>&nbsp;<span class="builtintype" id="5371090">nil</span>&nbsp;<span class="op" id="5371094">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371101">return</span>&nbsp;<span class="num" id="5371108">0</span><span class="op" id="5371109">,</span>&nbsp;<span class="string" id="5371111">&#34;&#34;</span><span class="op" id="5371113">,</span>&nbsp;<span class="ident" id="5371115">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5371123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371129">if</span>&nbsp;<span class="ident" id="5371132">c</span>&nbsp;<span class="op" id="5371134">==</span>&nbsp;<span class="string" id="5371137">&#39;}&#39;</span>&nbsp;<span class="op" id="5371141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371148">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5371158">}</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5371164">v</span>&nbsp;<span class="op" id="5371166">:=</span>&nbsp;<span class="ident" id="5371169">unhex</span><span class="op" id="5371174">(</span><span class="ident" id="5371175">c</span><span class="op" id="5371176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371182">if</span>&nbsp;<span class="ident" id="5371185">v</span>&nbsp;<span class="op" id="5371187">&lt;</span>&nbsp;<span class="num" id="5371189">0</span>&nbsp;<span class="op" id="5371191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371198">break</span>&nbsp;<span class="ident" id="5371204">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5371215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5371221">r</span>&nbsp;<span class="op" id="5371223">=</span>&nbsp;<span class="ident" id="5371225">r</span><span class="op" id="5371226">*</span><span class="num" id="5371227">16</span>&nbsp;<span class="op" id="5371230">+</span>&nbsp;<span class="ident" id="5371232">v</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371238">if</span>&nbsp;<span class="ident" id="5371241">r</span>&nbsp;<span class="op" id="5371243">&gt;</span>&nbsp;<span class="ident" id="5371245">unicode</span><span class="op" id="5371252">.</span><span class="ident" id="5371253">MaxRune</span>&nbsp;<span class="op" id="5371261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371268">break</span>&nbsp;<span class="ident" id="5371274">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5371285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5371291">nhex</span><span class="op" id="5371295">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5371301">}</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371306">if</span>&nbsp;<span class="ident" id="5371309">nhex</span>&nbsp;<span class="op" id="5371314">==</span>&nbsp;<span class="num" id="5371317">0</span>&nbsp;<span class="op" id="5371319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371325">break</span>&nbsp;<span class="ident" id="5371331">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5371341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371346">return</span>&nbsp;<span class="ident" id="5371353">r</span><span class="op" id="5371354">,</span>&nbsp;<span class="ident" id="5371356">t</span><span class="op" id="5371357">,</span>&nbsp;<span class="builtintype" id="5371359">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5371365">}</span><br>
<span class="lineno">1310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5371370">//&nbsp;Easy&nbsp;case:&nbsp;two&nbsp;hex&nbsp;digits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5371402">x</span>&nbsp;<span class="op" id="5371404">:=</span>&nbsp;<span class="ident" id="5371407">unhex</span><span class="op" id="5371412">(</span><span class="ident" id="5371413">c</span><span class="op" id="5371414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371418">if</span>&nbsp;<span class="ident" id="5371421">c</span><span class="op" id="5371422">,</span>&nbsp;<span class="ident" id="5371424">t</span><span class="op" id="5371425">,</span>&nbsp;<span class="ident" id="5371427">err</span>&nbsp;<span class="op" id="5371431">=</span>&nbsp;<span class="ident" id="5371433">nextRune</span><span class="op" id="5371441">(</span><span class="ident" id="5371442">t</span><span class="op" id="5371443">)</span><span class="op" id="5371444">;</span>&nbsp;<span class="ident" id="5371446">err</span>&nbsp;<span class="op" id="5371450">!=</span>&nbsp;<span class="builtintype" id="5371453">nil</span>&nbsp;<span class="op" id="5371457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371462">return</span>&nbsp;<span class="num" id="5371469">0</span><span class="op" id="5371470">,</span>&nbsp;<span class="string" id="5371472">&#34;&#34;</span><span class="op" id="5371474">,</span>&nbsp;<span class="ident" id="5371476">err</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5371482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5371486">y</span>&nbsp;<span class="op" id="5371488">:=</span>&nbsp;<span class="ident" id="5371491">unhex</span><span class="op" id="5371496">(</span><span class="ident" id="5371497">c</span><span class="op" id="5371498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371502">if</span>&nbsp;<span class="ident" id="5371505">x</span>&nbsp;<span class="op" id="5371507">&lt;</span>&nbsp;<span class="num" id="5371509">0</span>&nbsp;<span class="op" id="5371511">||</span>&nbsp;<span class="ident" id="5371514">y</span>&nbsp;<span class="op" id="5371516">&lt;</span>&nbsp;<span class="num" id="5371518">0</span>&nbsp;<span class="op" id="5371520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371525">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5371533">}</span><br>
<span class="lineno">1320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371537">return</span>&nbsp;<span class="ident" id="5371544">x</span><span class="op" id="5371545">*</span><span class="num" id="5371546">16</span>&nbsp;<span class="op" id="5371549">+</span>&nbsp;<span class="ident" id="5371551">y</span><span class="op" id="5371552">,</span>&nbsp;<span class="ident" id="5371554">t</span><span class="op" id="5371555">,</span>&nbsp;<span class="builtintype" id="5371557">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5371563">//&nbsp;C&nbsp;escapes.&nbsp;&nbsp;There&nbsp;is&nbsp;no&nbsp;case&nbsp;&#39;b&#39;,&nbsp;to&nbsp;avoid&nbsp;misparsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5371621">//&nbsp;the&nbsp;Perl&nbsp;word-boundary&nbsp;\b&nbsp;as&nbsp;the&nbsp;C&nbsp;backspace&nbsp;\b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5371673">//&nbsp;when&nbsp;in&nbsp;POSIX&nbsp;mode.&nbsp;&nbsp;In&nbsp;Perl,&nbsp;/\b/&nbsp;means&nbsp;word-boundary</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5371732">//&nbsp;but&nbsp;/[\b]/&nbsp;means&nbsp;backspace.&nbsp;&nbsp;We&nbsp;don&#39;t&nbsp;support&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5371788">//&nbsp;If&nbsp;you&nbsp;want&nbsp;a&nbsp;backspace,&nbsp;embed&nbsp;a&nbsp;literal&nbsp;backspace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5371843">//&nbsp;character&nbsp;or&nbsp;use&nbsp;\x08.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371870">case</span>&nbsp;<span class="string" id="5371875">&#39;a&#39;</span><span class="op" id="5371878">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371882">return</span>&nbsp;<span class="string" id="5371889">&#39;\a&#39;</span><span class="op" id="5371893">,</span>&nbsp;<span class="ident" id="5371895">t</span><span class="op" id="5371896">,</span>&nbsp;<span class="ident" id="5371898">err</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371903">case</span>&nbsp;<span class="string" id="5371908">&#39;f&#39;</span><span class="op" id="5371911">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371915">return</span>&nbsp;<span class="string" id="5371922">&#39;\f&#39;</span><span class="op" id="5371926">,</span>&nbsp;<span class="ident" id="5371928">t</span><span class="op" id="5371929">,</span>&nbsp;<span class="ident" id="5371931">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371936">case</span>&nbsp;<span class="string" id="5371941">&#39;n&#39;</span><span class="op" id="5371944">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371948">return</span>&nbsp;<span class="string" id="5371955">&#39;\n&#39;</span><span class="op" id="5371959">,</span>&nbsp;<span class="ident" id="5371961">t</span><span class="op" id="5371962">,</span>&nbsp;<span class="ident" id="5371964">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371969">case</span>&nbsp;<span class="string" id="5371974">&#39;r&#39;</span><span class="op" id="5371977">:</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5371981">return</span>&nbsp;<span class="string" id="5371988">&#39;\r&#39;</span><span class="op" id="5371992">,</span>&nbsp;<span class="ident" id="5371994">t</span><span class="op" id="5371995">,</span>&nbsp;<span class="ident" id="5371997">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5372002">case</span>&nbsp;<span class="string" id="5372007">&#39;t&#39;</span><span class="op" id="5372010">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5372014">return</span>&nbsp;<span class="string" id="5372021">&#39;\t&#39;</span><span class="op" id="5372025">,</span>&nbsp;<span class="ident" id="5372027">t</span><span class="op" id="5372028">,</span>&nbsp;<span class="ident" id="5372030">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5372035">case</span>&nbsp;<span class="string" id="5372040">&#39;v&#39;</span><span class="op" id="5372043">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5372047">return</span>&nbsp;<span class="string" id="5372054">&#39;\v&#39;</span><span class="op" id="5372058">,</span>&nbsp;<span class="ident" id="5372060">t</span><span class="op" id="5372061">,</span>&nbsp;<span class="ident" id="5372063">err</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5372068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5372071">return</span>&nbsp;<span class="num" id="5372078">0</span><span class="op" id="5372079">,</span>&nbsp;<span class="string" id="5372081">&#34;&#34;</span><span class="op" id="5372083">,</span>&nbsp;<span class="op" id="5372085">&amp;</span><span class="ident" id="5372086">Error</span><span class="op" id="5372091">{</span><span class="ident" id="5372092">ErrInvalidEscape</span><span class="op" id="5372108">,</span>&nbsp;<span class="ident" id="5372110">s</span><span class="op" id="5372111">[</span><span class="op" id="5372112">:</span><span class="builtinfunc" id="5372113">len</span><span class="op" id="5372116">(</span><span class="ident" id="5372117">s</span><span class="op" id="5372118">)</span><span class="op" id="5372119">-</span><span class="builtinfunc" id="5372120">len</span><span class="op" id="5372123">(</span><span class="ident" id="5372124">t</span><span class="op" id="5372125">)</span><span class="op" id="5372126">]</span><span class="op" id="5372127">}</span><br>
<span class="lineno"></span><span class="op" id="5372129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5372132">//&nbsp;parseClassChar&nbsp;parses&nbsp;a&nbsp;character&nbsp;class&nbsp;character&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno">1345</span><span class="comment" id="5372207">//&nbsp;and&nbsp;returns&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5372226">func</span>&nbsp;<span class="op" id="5372231">(</span><span class="ident" id="5372232">p</span>&nbsp;<span class="op" id="5372234">*</span><span class="ident" id="5372235">parser</span><span class="op" id="5372241">)</span>&nbsp;<span class="ident" id="5372243">parseClassChar</span><span class="op" id="5372257">(</span><span class="ident" id="5372258">s</span><span class="op" id="5372259">,</span>&nbsp;<span class="ident" id="5372261">wholeClass</span>&nbsp;<span class="builtintype" id="5372272">string</span><span class="op" id="5372278">)</span>&nbsp;<span class="op" id="5372280">(</span><span class="ident" id="5372281">r</span>&nbsp;<span class="builtintype" id="5372283">rune</span><span class="op" id="5372287">,</span>&nbsp;<span class="ident" id="5372289">rest</span>&nbsp;<span class="builtintype" id="5372294">string</span><span class="op" id="5372300">,</span>&nbsp;<span class="ident" id="5372302">err</span>&nbsp;<span class="builtintype" id="5372306">error</span><span class="op" id="5372311">)</span>&nbsp;<span class="op" id="5372313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5372316">if</span>&nbsp;<span class="ident" id="5372319">s</span>&nbsp;<span class="op" id="5372321">==</span>&nbsp;<span class="string" id="5372324">&#34;&#34;</span>&nbsp;<span class="op" id="5372327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5372331">return</span>&nbsp;<span class="num" id="5372338">0</span><span class="op" id="5372339">,</span>&nbsp;<span class="string" id="5372341">&#34;&#34;</span><span class="op" id="5372343">,</span>&nbsp;<span class="op" id="5372345">&amp;</span><span class="ident" id="5372346">Error</span><span class="op" id="5372351">{</span><span class="ident" id="5372352">Code</span><span class="op" id="5372356">:</span>&nbsp;<span class="ident" id="5372358">ErrMissingBracket</span><span class="op" id="5372375">,</span>&nbsp;<span class="ident" id="5372377">Expr</span><span class="op" id="5372381">:</span>&nbsp;<span class="ident" id="5372383">wholeClass</span><span class="op" id="5372393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5372396">}</span><br>
<span class="lineno">1350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5372400">//&nbsp;Allow&nbsp;regular&nbsp;escape&nbsp;sequences&nbsp;even&nbsp;though</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5372447">//&nbsp;many&nbsp;need&nbsp;not&nbsp;be&nbsp;escaped&nbsp;in&nbsp;this&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5372493">if</span>&nbsp;<span class="ident" id="5372496">s</span><span class="op" id="5372497">[</span><span class="num" id="5372498">0</span><span class="op" id="5372499">]</span>&nbsp;<span class="op" id="5372501">==</span>&nbsp;<span class="string" id="5372504">&#39;\\&#39;</span>&nbsp;<span class="op" id="5372509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5372513">return</span>&nbsp;<span class="ident" id="5372520">p</span><span class="op" id="5372521">.</span><span class="ident" id="5372522">parseEscape</span><span class="op" id="5372533">(</span><span class="ident" id="5372534">s</span><span class="op" id="5372535">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5372538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5372542">return</span>&nbsp;<span class="ident" id="5372549">nextRune</span><span class="op" id="5372557">(</span><span class="ident" id="5372558">s</span><span class="op" id="5372559">)</span><br>
<span class="lineno"></span><span class="op" id="5372561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1360</span><span class="keyword" id="5372564">type</span>&nbsp;<span class="ident" id="5372569">charGroup</span>&nbsp;<span class="keyword" id="5372579">struct</span>&nbsp;<span class="op" id="5372586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5372589">sign</span>&nbsp;&nbsp;<span class="builtintype" id="5372595">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5372600">class</span>&nbsp;<span class="op" id="5372606">[</span><span class="op" id="5372607">]</span><span class="builtintype" id="5372608">rune</span><br>
<span class="lineno"></span><span class="op" id="5372613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1365</span><span class="comment" id="5372616">//&nbsp;parsePerlClassEscape&nbsp;parses&nbsp;a&nbsp;leading&nbsp;Perl&nbsp;character&nbsp;class&nbsp;escape&nbsp;like&nbsp;\d</span><br>
<span class="lineno"></span><span class="comment" id="5372693">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="5372772">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5372836">func</span>&nbsp;<span class="op" id="5372841">(</span><span class="ident" id="5372842">p</span>&nbsp;<span class="op" id="5372844">*</span><span class="ident" id="5372845">parser</span><span class="op" id="5372851">)</span>&nbsp;<span class="ident" id="5372853">parsePerlClassEscape</span><span class="op" id="5372873">(</span><span class="ident" id="5372874">s</span>&nbsp;<span class="builtintype" id="5372876">string</span><span class="op" id="5372882">,</span>&nbsp;<span class="ident" id="5372884">r</span>&nbsp;<span class="op" id="5372886">[</span><span class="op" id="5372887">]</span><span class="builtintype" id="5372888">rune</span><span class="op" id="5372892">)</span>&nbsp;<span class="op" id="5372894">(</span><span class="ident" id="5372895">out</span>&nbsp;<span class="op" id="5372899">[</span><span class="op" id="5372900">]</span><span class="builtintype" id="5372901">rune</span><span class="op" id="5372905">,</span>&nbsp;<span class="ident" id="5372907">rest</span>&nbsp;<span class="builtintype" id="5372912">string</span><span class="op" id="5372918">)</span>&nbsp;<span class="op" id="5372920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5372923">if</span>&nbsp;<span class="ident" id="5372926">p</span><span class="op" id="5372927">.</span><span class="ident" id="5372928">flags</span><span class="op" id="5372933">&amp;</span><span class="ident" id="5372934">PerlX</span>&nbsp;<span class="op" id="5372940">==</span>&nbsp;<span class="num" id="5372943">0</span>&nbsp;<span class="op" id="5372945">||</span>&nbsp;<span class="builtinfunc" id="5372948">len</span><span class="op" id="5372951">(</span><span class="ident" id="5372952">s</span><span class="op" id="5372953">)</span>&nbsp;<span class="op" id="5372955">&lt;</span>&nbsp;<span class="num" id="5372957">2</span>&nbsp;<span class="op" id="5372959">||</span>&nbsp;<span class="ident" id="5372962">s</span><span class="op" id="5372963">[</span><span class="num" id="5372964">0</span><span class="op" id="5372965">]</span>&nbsp;<span class="op" id="5372967">!=</span>&nbsp;<span class="string" id="5372970">&#39;\\&#39;</span>&nbsp;<span class="op" id="5372975">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5372979">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5372987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5372990">g</span>&nbsp;<span class="op" id="5372992">:=</span>&nbsp;<span class="ident" id="5372995">perlGroup</span><span class="op" id="5373004">[</span><span class="ident" id="5373005">s</span><span class="op" id="5373006">[</span><span class="num" id="5373007">0</span><span class="op" id="5373008">:</span><span class="num" id="5373009">2</span><span class="op" id="5373010">]</span><span class="op" id="5373011">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373014">if</span>&nbsp;<span class="ident" id="5373017">g</span><span class="op" id="5373018">.</span><span class="ident" id="5373019">sign</span>&nbsp;<span class="op" id="5373024">==</span>&nbsp;<span class="num" id="5373027">0</span>&nbsp;<span class="op" id="5373029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373033">return</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5373041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373044">return</span>&nbsp;<span class="ident" id="5373051">p</span><span class="op" id="5373052">.</span><span class="ident" id="5373053">appendGroup</span><span class="op" id="5373064">(</span><span class="ident" id="5373065">r</span><span class="op" id="5373066">,</span>&nbsp;<span class="ident" id="5373068">g</span><span class="op" id="5373069">)</span><span class="op" id="5373070">,</span>&nbsp;<span class="ident" id="5373072">s</span><span class="op" id="5373073">[</span><span class="num" id="5373074">2</span><span class="op" id="5373075">:</span><span class="op" id="5373076">]</span><br>
<span class="lineno"></span><span class="op" id="5373078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5373081">//&nbsp;parseNamedClass&nbsp;parses&nbsp;a&nbsp;leading&nbsp;POSIX&nbsp;named&nbsp;character&nbsp;class&nbsp;like&nbsp;[:alnum:]</span><br>
<span class="lineno">1380</span><span class="comment" id="5373160">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="5373239">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5373303">func</span>&nbsp;<span class="op" id="5373308">(</span><span class="ident" id="5373309">p</span>&nbsp;<span class="op" id="5373311">*</span><span class="ident" id="5373312">parser</span><span class="op" id="5373318">)</span>&nbsp;<span class="ident" id="5373320">parseNamedClass</span><span class="op" id="5373335">(</span><span class="ident" id="5373336">s</span>&nbsp;<span class="builtintype" id="5373338">string</span><span class="op" id="5373344">,</span>&nbsp;<span class="ident" id="5373346">r</span>&nbsp;<span class="op" id="5373348">[</span><span class="op" id="5373349">]</span><span class="builtintype" id="5373350">rune</span><span class="op" id="5373354">)</span>&nbsp;<span class="op" id="5373356">(</span><span class="ident" id="5373357">out</span>&nbsp;<span class="op" id="5373361">[</span><span class="op" id="5373362">]</span><span class="builtintype" id="5373363">rune</span><span class="op" id="5373367">,</span>&nbsp;<span class="ident" id="5373369">rest</span>&nbsp;<span class="builtintype" id="5373374">string</span><span class="op" id="5373380">,</span>&nbsp;<span class="ident" id="5373382">err</span>&nbsp;<span class="builtintype" id="5373386">error</span><span class="op" id="5373391">)</span>&nbsp;<span class="op" id="5373393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373396">if</span>&nbsp;<span class="builtinfunc" id="5373399">len</span><span class="op" id="5373402">(</span><span class="ident" id="5373403">s</span><span class="op" id="5373404">)</span>&nbsp;<span class="op" id="5373406">&lt;</span>&nbsp;<span class="num" id="5373408">2</span>&nbsp;<span class="op" id="5373410">||</span>&nbsp;<span class="ident" id="5373413">s</span><span class="op" id="5373414">[</span><span class="num" id="5373415">0</span><span class="op" id="5373416">]</span>&nbsp;<span class="op" id="5373418">!=</span>&nbsp;<span class="string" id="5373421">&#39;[&#39;</span>&nbsp;<span class="op" id="5373425">||</span>&nbsp;<span class="ident" id="5373428">s</span><span class="op" id="5373429">[</span><span class="num" id="5373430">1</span><span class="op" id="5373431">]</span>&nbsp;<span class="op" id="5373433">!=</span>&nbsp;<span class="string" id="5373436">&#39;:&#39;</span>&nbsp;<span class="op" id="5373440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373444">return</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5373452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373456">i</span>&nbsp;<span class="op" id="5373458">:=</span>&nbsp;<span class="ident" id="5373461">strings</span><span class="op" id="5373468">.</span><span class="ident" id="5373469">Index</span><span class="op" id="5373474">(</span><span class="ident" id="5373475">s</span><span class="op" id="5373476">[</span><span class="num" id="5373477">2</span><span class="op" id="5373478">:</span><span class="op" id="5373479">]</span><span class="op" id="5373480">,</span>&nbsp;<span class="string" id="5373482">&#34;:]&#34;</span><span class="op" id="5373486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373489">if</span>&nbsp;<span class="ident" id="5373492">i</span>&nbsp;<span class="op" id="5373494">&lt;</span>&nbsp;<span class="num" id="5373496">0</span>&nbsp;<span class="op" id="5373498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373502">return</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5373510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373513">i</span>&nbsp;<span class="op" id="5373515">+=</span>&nbsp;<span class="num" id="5373518">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373521">name</span><span class="op" id="5373525">,</span>&nbsp;<span class="ident" id="5373527">s</span>&nbsp;<span class="op" id="5373529">:=</span>&nbsp;<span class="ident" id="5373532">s</span><span class="op" id="5373533">[</span><span class="num" id="5373534">0</span><span class="op" id="5373535">:</span><span class="ident" id="5373536">i</span><span class="op" id="5373537">+</span><span class="num" id="5373538">2</span><span class="op" id="5373539">]</span><span class="op" id="5373540">,</span>&nbsp;<span class="ident" id="5373542">s</span><span class="op" id="5373543">[</span><span class="ident" id="5373544">i</span><span class="op" id="5373545">+</span><span class="num" id="5373546">2</span><span class="op" id="5373547">:</span><span class="op" id="5373548">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373551">g</span>&nbsp;<span class="op" id="5373553">:=</span>&nbsp;<span class="ident" id="5373556">posixGroup</span><span class="op" id="5373566">[</span><span class="ident" id="5373567">name</span><span class="op" id="5373571">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373574">if</span>&nbsp;<span class="ident" id="5373577">g</span><span class="op" id="5373578">.</span><span class="ident" id="5373579">sign</span>&nbsp;<span class="op" id="5373584">==</span>&nbsp;<span class="num" id="5373587">0</span>&nbsp;<span class="op" id="5373589">{</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373593">return</span>&nbsp;<span class="builtintype" id="5373600">nil</span><span class="op" id="5373603">,</span>&nbsp;<span class="string" id="5373605">&#34;&#34;</span><span class="op" id="5373607">,</span>&nbsp;<span class="op" id="5373609">&amp;</span><span class="ident" id="5373610">Error</span><span class="op" id="5373615">{</span><span class="ident" id="5373616">ErrInvalidCharRange</span><span class="op" id="5373635">,</span>&nbsp;<span class="ident" id="5373637">name</span><span class="op" id="5373641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5373644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373647">return</span>&nbsp;<span class="ident" id="5373654">p</span><span class="op" id="5373655">.</span><span class="ident" id="5373656">appendGroup</span><span class="op" id="5373667">(</span><span class="ident" id="5373668">r</span><span class="op" id="5373669">,</span>&nbsp;<span class="ident" id="5373671">g</span><span class="op" id="5373672">)</span><span class="op" id="5373673">,</span>&nbsp;<span class="ident" id="5373675">s</span><span class="op" id="5373676">,</span>&nbsp;<span class="builtintype" id="5373678">nil</span><br>
<span class="lineno"></span><span class="op" id="5373682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1400</span><span class="keyword" id="5373685">func</span>&nbsp;<span class="op" id="5373690">(</span><span class="ident" id="5373691">p</span>&nbsp;<span class="op" id="5373693">*</span><span class="ident" id="5373694">parser</span><span class="op" id="5373700">)</span>&nbsp;<span class="ident" id="5373702">appendGroup</span><span class="op" id="5373713">(</span><span class="ident" id="5373714">r</span>&nbsp;<span class="op" id="5373716">[</span><span class="op" id="5373717">]</span><span class="builtintype" id="5373718">rune</span><span class="op" id="5373722">,</span>&nbsp;<span class="ident" id="5373724">g</span>&nbsp;<span class="ident" id="5373726">charGroup</span><span class="op" id="5373735">)</span>&nbsp;<span class="op" id="5373737">[</span><span class="op" id="5373738">]</span><span class="builtintype" id="5373739">rune</span>&nbsp;<span class="op" id="5373744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373747">if</span>&nbsp;<span class="ident" id="5373750">p</span><span class="op" id="5373751">.</span><span class="ident" id="5373752">flags</span><span class="op" id="5373757">&amp;</span><span class="ident" id="5373758">FoldCase</span>&nbsp;<span class="op" id="5373767">==</span>&nbsp;<span class="num" id="5373770">0</span>&nbsp;<span class="op" id="5373772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5373776">if</span>&nbsp;<span class="ident" id="5373779">g</span><span class="op" id="5373780">.</span><span class="ident" id="5373781">sign</span>&nbsp;<span class="op" id="5373786">&lt;</span>&nbsp;<span class="num" id="5373788">0</span>&nbsp;<span class="op" id="5373790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373795">r</span>&nbsp;<span class="op" id="5373797">=</span>&nbsp;<span class="ident" id="5373799">appendNegatedClass</span><span class="op" id="5373817">(</span><span class="ident" id="5373818">r</span><span class="op" id="5373819">,</span>&nbsp;<span class="ident" id="5373821">g</span><span class="op" id="5373822">.</span><span class="ident" id="5373823">class</span><span class="op" id="5373828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5373832">}</span>&nbsp;<span class="keyword" id="5373834">else</span>&nbsp;<span class="op" id="5373839">{</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373844">r</span>&nbsp;<span class="op" id="5373846">=</span>&nbsp;<span class="ident" id="5373848">appendClass</span><span class="op" id="5373859">(</span><span class="ident" id="5373860">r</span><span class="op" id="5373861">,</span>&nbsp;<span class="ident" id="5373863">g</span><span class="op" id="5373864">.</span><span class="ident" id="5373865">class</span><span class="op" id="5373870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5373874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5373877">}</span>&nbsp;<span class="keyword" id="5373879">else</span>&nbsp;<span class="op" id="5373884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373888">tmp</span>&nbsp;<span class="op" id="5373892">:=</span>&nbsp;<span class="ident" id="5373895">p</span><span class="op" id="5373896">.</span><span class="ident" id="5373897">tmpClass</span><span class="op" id="5373905">[</span><span class="op" id="5373906">:</span><span class="num" id="5373907">0</span><span class="op" id="5373908">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373912">tmp</span>&nbsp;<span class="op" id="5373916">=</span>&nbsp;<span class="ident" id="5373918">appendFoldedClass</span><span class="op" id="5373935">(</span><span class="ident" id="5373936">tmp</span><span class="op" id="5373939">,</span>&nbsp;<span class="ident" id="5373941">g</span><span class="op" id="5373942">.</span><span class="ident" id="5373943">class</span><span class="op" id="5373948">)</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373952">p</span><span class="op" id="5373953">.</span><span class="ident" id="5373954">tmpClass</span>&nbsp;<span class="op" id="5373963">=</span>&nbsp;<span class="ident" id="5373965">tmp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5373971">tmp</span>&nbsp;<span class="op" id="5373975">=</span>&nbsp;<span class="ident" id="5373977">cleanClass</span><span class="op" id="5373987">(</span><span class="op" id="5373988">&amp;</span><span class="ident" id="5373989">p</span><span class="op" id="5373990">.</span><span class="ident" id="5373991">tmpClass</span><span class="op" id="5373999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374003">if</span>&nbsp;<span class="ident" id="5374006">g</span><span class="op" id="5374007">.</span><span class="ident" id="5374008">sign</span>&nbsp;<span class="op" id="5374013">&lt;</span>&nbsp;<span class="num" id="5374015">0</span>&nbsp;<span class="op" id="5374017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5374022">r</span>&nbsp;<span class="op" id="5374024">=</span>&nbsp;<span class="ident" id="5374026">appendNegatedClass</span><span class="op" id="5374044">(</span><span class="ident" id="5374045">r</span><span class="op" id="5374046">,</span>&nbsp;<span class="ident" id="5374048">tmp</span><span class="op" id="5374051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5374055">}</span>&nbsp;<span class="keyword" id="5374057">else</span>&nbsp;<span class="op" id="5374062">{</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5374067">r</span>&nbsp;<span class="op" id="5374069">=</span>&nbsp;<span class="ident" id="5374071">appendClass</span><span class="op" id="5374082">(</span><span class="ident" id="5374083">r</span><span class="op" id="5374084">,</span>&nbsp;<span class="ident" id="5374086">tmp</span><span class="op" id="5374089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5374093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5374096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374099">return</span>&nbsp;<span class="ident" id="5374106">r</span><br>
<span class="lineno"></span><span class="op" id="5374108">}</span><br>
<span class="lineno">1420</span><br>
<span class="lineno"></span><span class="keyword" id="5374111">var</span>&nbsp;<span class="ident" id="5374115">anyTable</span>&nbsp;<span class="op" id="5374124">=</span>&nbsp;<span class="op" id="5374126">&amp;</span><span class="ident" id="5374127">unicode</span><span class="op" id="5374134">.</span><span class="ident" id="5374135">RangeTable</span><span class="op" id="5374145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5374148">R16</span><span class="op" id="5374151">:</span>&nbsp;<span class="op" id="5374153">[</span><span class="op" id="5374154">]</span><span class="ident" id="5374155">unicode</span><span class="op" id="5374162">.</span><span class="ident" id="5374163">Range16</span><span class="op" id="5374170">{</span><span class="op" id="5374171">{</span><span class="ident" id="5374172">Lo</span><span class="op" id="5374174">:</span>&nbsp;<span class="num" id="5374176">0</span><span class="op" id="5374177">,</span>&nbsp;<span class="ident" id="5374179">Hi</span><span class="op" id="5374181">:</span>&nbsp;<span class="num" id="5374183">1</span><span class="op" id="5374184">&lt;&lt;</span><span class="num" id="5374186">16</span>&nbsp;<span class="op" id="5374189">-</span>&nbsp;<span class="num" id="5374191">1</span><span class="op" id="5374192">,</span>&nbsp;<span class="ident" id="5374194">Stride</span><span class="op" id="5374200">:</span>&nbsp;<span class="num" id="5374202">1</span><span class="op" id="5374203">}</span><span class="op" id="5374204">}</span><span class="op" id="5374205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5374208">R32</span><span class="op" id="5374211">:</span>&nbsp;<span class="op" id="5374213">[</span><span class="op" id="5374214">]</span><span class="ident" id="5374215">unicode</span><span class="op" id="5374222">.</span><span class="ident" id="5374223">Range32</span><span class="op" id="5374230">{</span><span class="op" id="5374231">{</span><span class="ident" id="5374232">Lo</span><span class="op" id="5374234">:</span>&nbsp;<span class="num" id="5374236">1</span>&nbsp;<span class="op" id="5374238">&lt;&lt;</span>&nbsp;<span class="num" id="5374241">16</span><span class="op" id="5374243">,</span>&nbsp;<span class="ident" id="5374245">Hi</span><span class="op" id="5374247">:</span>&nbsp;<span class="ident" id="5374249">unicode</span><span class="op" id="5374256">.</span><span class="ident" id="5374257">MaxRune</span><span class="op" id="5374264">,</span>&nbsp;<span class="ident" id="5374266">Stride</span><span class="op" id="5374272">:</span>&nbsp;<span class="num" id="5374274">1</span><span class="op" id="5374275">}</span><span class="op" id="5374276">}</span><span class="op" id="5374277">,</span><br>
<span class="lineno"></span><span class="op" id="5374279">}</span><br>
<span class="lineno">1425</span><br>
<span class="lineno"></span><span class="comment" id="5374282">//&nbsp;unicodeTable&nbsp;returns&nbsp;the&nbsp;unicode.RangeTable&nbsp;identified&nbsp;by&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5374348">//&nbsp;and&nbsp;the&nbsp;table&nbsp;of&nbsp;additional&nbsp;fold-equivalent&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="keyword" id="5374408">func</span>&nbsp;<span class="ident" id="5374413">unicodeTable</span><span class="op" id="5374425">(</span><span class="ident" id="5374426">name</span>&nbsp;<span class="builtintype" id="5374431">string</span><span class="op" id="5374437">)</span>&nbsp;<span class="op" id="5374439">(</span><span class="op" id="5374440">*</span><span class="ident" id="5374441">unicode</span><span class="op" id="5374448">.</span><span class="ident" id="5374449">RangeTable</span><span class="op" id="5374459">,</span>&nbsp;<span class="op" id="5374461">*</span><span class="ident" id="5374462">unicode</span><span class="op" id="5374469">.</span><span class="ident" id="5374470">RangeTable</span><span class="op" id="5374480">)</span>&nbsp;<span class="op" id="5374482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5374485">//&nbsp;Special&nbsp;case:&nbsp;&#34;Any&#34;&nbsp;means&nbsp;any.</span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374520">if</span>&nbsp;<span class="ident" id="5374523">name</span>&nbsp;<span class="op" id="5374528">==</span>&nbsp;<span class="string" id="5374531">&#34;Any&#34;</span>&nbsp;<span class="op" id="5374537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374541">return</span>&nbsp;<span class="ident" id="5374548">anyTable</span><span class="op" id="5374556">,</span>&nbsp;<span class="ident" id="5374558">anyTable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5374568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374571">if</span>&nbsp;<span class="ident" id="5374574">t</span>&nbsp;<span class="op" id="5374576">:=</span>&nbsp;<span class="ident" id="5374579">unicode</span><span class="op" id="5374586">.</span><span class="ident" id="5374587">Categories</span><span class="op" id="5374597">[</span><span class="ident" id="5374598">name</span><span class="op" id="5374602">]</span><span class="op" id="5374603">;</span>&nbsp;<span class="ident" id="5374605">t</span>&nbsp;<span class="op" id="5374607">!=</span>&nbsp;<span class="builtintype" id="5374610">nil</span>&nbsp;<span class="op" id="5374614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374618">return</span>&nbsp;<span class="ident" id="5374625">t</span><span class="op" id="5374626">,</span>&nbsp;<span class="ident" id="5374628">unicode</span><span class="op" id="5374635">.</span><span class="ident" id="5374636">FoldCategory</span><span class="op" id="5374648">[</span><span class="ident" id="5374649">name</span><span class="op" id="5374653">]</span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5374656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374659">if</span>&nbsp;<span class="ident" id="5374662">t</span>&nbsp;<span class="op" id="5374664">:=</span>&nbsp;<span class="ident" id="5374667">unicode</span><span class="op" id="5374674">.</span><span class="ident" id="5374675">Scripts</span><span class="op" id="5374682">[</span><span class="ident" id="5374683">name</span><span class="op" id="5374687">]</span><span class="op" id="5374688">;</span>&nbsp;<span class="ident" id="5374690">t</span>&nbsp;<span class="op" id="5374692">!=</span>&nbsp;<span class="builtintype" id="5374695">nil</span>&nbsp;<span class="op" id="5374699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374703">return</span>&nbsp;<span class="ident" id="5374710">t</span><span class="op" id="5374711">,</span>&nbsp;<span class="ident" id="5374713">unicode</span><span class="op" id="5374720">.</span><span class="ident" id="5374721">FoldScript</span><span class="op" id="5374731">[</span><span class="ident" id="5374732">name</span><span class="op" id="5374736">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5374739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5374742">return</span>&nbsp;<span class="builtintype" id="5374749">nil</span><span class="op" id="5374752">,</span>&nbsp;<span class="builtintype" id="5374754">nil</span><br>
<span class="lineno">1440</span><span class="op" id="5374758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5374761">//&nbsp;parseUnicodeClass&nbsp;parses&nbsp;a&nbsp;leading&nbsp;Unicode&nbsp;character&nbsp;class&nbsp;like&nbsp;\p{Han}</span><br>
<span class="lineno"></span><span class="comment" id="5374836">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="5374915">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno">1445</span><span class="keyword" id="5374979">func</span>&nbsp;<span class="op" id="5374984">(</span><span class="ident" id="5374985">p</span>&nbsp;<span class="op" id="5374987">*</span><span class="ident" id="5374988">parser</span><span class="op" id="5374994">)</span>&nbsp;<span class="ident" id="5374996">parseUnicodeClass</span><span class="op" id="5375013">(</span><span class="ident" id="5375014">s</span>&nbsp;<span class="builtintype" id="5375016">string</span><span class="op" id="5375022">,</span>&nbsp;<span class="ident" id="5375024">r</span>&nbsp;<span class="op" id="5375026">[</span><span class="op" id="5375027">]</span><span class="builtintype" id="5375028">rune</span><span class="op" id="5375032">)</span>&nbsp;<span class="op" id="5375034">(</span><span class="ident" id="5375035">out</span>&nbsp;<span class="op" id="5375039">[</span><span class="op" id="5375040">]</span><span class="builtintype" id="5375041">rune</span><span class="op" id="5375045">,</span>&nbsp;<span class="ident" id="5375047">rest</span>&nbsp;<span class="builtintype" id="5375052">string</span><span class="op" id="5375058">,</span>&nbsp;<span class="ident" id="5375060">err</span>&nbsp;<span class="builtintype" id="5375064">error</span><span class="op" id="5375069">)</span>&nbsp;<span class="op" id="5375071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375074">if</span>&nbsp;<span class="ident" id="5375077">p</span><span class="op" id="5375078">.</span><span class="ident" id="5375079">flags</span><span class="op" id="5375084">&amp;</span><span class="ident" id="5375085">UnicodeGroups</span>&nbsp;<span class="op" id="5375099">==</span>&nbsp;<span class="num" id="5375102">0</span>&nbsp;<span class="op" id="5375104">||</span>&nbsp;<span class="builtinfunc" id="5375107">len</span><span class="op" id="5375110">(</span><span class="ident" id="5375111">s</span><span class="op" id="5375112">)</span>&nbsp;<span class="op" id="5375114">&lt;</span>&nbsp;<span class="num" id="5375116">2</span>&nbsp;<span class="op" id="5375118">||</span>&nbsp;<span class="ident" id="5375121">s</span><span class="op" id="5375122">[</span><span class="num" id="5375123">0</span><span class="op" id="5375124">]</span>&nbsp;<span class="op" id="5375126">!=</span>&nbsp;<span class="string" id="5375129">&#39;\\&#39;</span>&nbsp;<span class="op" id="5375134">||</span>&nbsp;<span class="ident" id="5375137">s</span><span class="op" id="5375138">[</span><span class="num" id="5375139">1</span><span class="op" id="5375140">]</span>&nbsp;<span class="op" id="5375142">!=</span>&nbsp;<span class="string" id="5375145">&#39;p&#39;</span>&nbsp;<span class="op" id="5375149">&amp;&amp;</span>&nbsp;<span class="ident" id="5375152">s</span><span class="op" id="5375153">[</span><span class="num" id="5375154">1</span><span class="op" id="5375155">]</span>&nbsp;<span class="op" id="5375157">!=</span>&nbsp;<span class="string" id="5375160">&#39;P&#39;</span>&nbsp;<span class="op" id="5375164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375168">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5375176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5375180">//&nbsp;Committed&nbsp;to&nbsp;parse&nbsp;or&nbsp;return&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375220">sign</span>&nbsp;<span class="op" id="5375225">:=</span>&nbsp;<span class="op" id="5375228">+</span><span class="num" id="5375229">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375232">if</span>&nbsp;<span class="ident" id="5375235">s</span><span class="op" id="5375236">[</span><span class="num" id="5375237">1</span><span class="op" id="5375238">]</span>&nbsp;<span class="op" id="5375240">==</span>&nbsp;<span class="string" id="5375243">&#39;P&#39;</span>&nbsp;<span class="op" id="5375247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375251">sign</span>&nbsp;<span class="op" id="5375256">=</span>&nbsp;<span class="op" id="5375258">-</span><span class="num" id="5375259">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5375262">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375265">t</span>&nbsp;<span class="op" id="5375267">:=</span>&nbsp;<span class="ident" id="5375270">s</span><span class="op" id="5375271">[</span><span class="num" id="5375272">2</span><span class="op" id="5375273">:</span><span class="op" id="5375274">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375277">c</span><span class="op" id="5375278">,</span>&nbsp;<span class="ident" id="5375280">t</span><span class="op" id="5375281">,</span>&nbsp;<span class="ident" id="5375283">err</span>&nbsp;<span class="op" id="5375287">:=</span>&nbsp;<span class="ident" id="5375290">nextRune</span><span class="op" id="5375298">(</span><span class="ident" id="5375299">t</span><span class="op" id="5375300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375303">if</span>&nbsp;<span class="ident" id="5375306">err</span>&nbsp;<span class="op" id="5375310">!=</span>&nbsp;<span class="builtintype" id="5375313">nil</span>&nbsp;<span class="op" id="5375317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375321">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5375329">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375332">var</span>&nbsp;<span class="ident" id="5375336">seq</span><span class="op" id="5375339">,</span>&nbsp;<span class="ident" id="5375341">name</span>&nbsp;<span class="builtintype" id="5375346">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375354">if</span>&nbsp;<span class="ident" id="5375357">c</span>&nbsp;<span class="op" id="5375359">!=</span>&nbsp;<span class="string" id="5375362">&#39;{&#39;</span>&nbsp;<span class="op" id="5375366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5375370">//&nbsp;Single-letter&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375395">seq</span>&nbsp;<span class="op" id="5375399">=</span>&nbsp;<span class="ident" id="5375401">s</span><span class="op" id="5375402">[</span><span class="op" id="5375403">:</span><span class="builtinfunc" id="5375404">len</span><span class="op" id="5375407">(</span><span class="ident" id="5375408">s</span><span class="op" id="5375409">)</span><span class="op" id="5375410">-</span><span class="builtinfunc" id="5375411">len</span><span class="op" id="5375414">(</span><span class="ident" id="5375415">t</span><span class="op" id="5375416">)</span><span class="op" id="5375417">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375421">name</span>&nbsp;<span class="op" id="5375426">=</span>&nbsp;<span class="ident" id="5375428">seq</span><span class="op" id="5375431">[</span><span class="num" id="5375432">2</span><span class="op" id="5375433">:</span><span class="op" id="5375434">]</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5375437">}</span>&nbsp;<span class="keyword" id="5375439">else</span>&nbsp;<span class="op" id="5375444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5375448">//&nbsp;Name&nbsp;is&nbsp;in&nbsp;braces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375472">end</span>&nbsp;<span class="op" id="5375476">:=</span>&nbsp;<span class="ident" id="5375479">strings</span><span class="op" id="5375486">.</span><span class="ident" id="5375487">IndexRune</span><span class="op" id="5375496">(</span><span class="ident" id="5375497">s</span><span class="op" id="5375498">,</span>&nbsp;<span class="string" id="5375500">&#39;}&#39;</span><span class="op" id="5375503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375507">if</span>&nbsp;<span class="ident" id="5375510">end</span>&nbsp;<span class="op" id="5375514">&lt;</span>&nbsp;<span class="num" id="5375516">0</span>&nbsp;<span class="op" id="5375518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375523">if</span>&nbsp;<span class="ident" id="5375526">err</span>&nbsp;<span class="op" id="5375530">=</span>&nbsp;<span class="ident" id="5375532">checkUTF8</span><span class="op" id="5375541">(</span><span class="ident" id="5375542">s</span><span class="op" id="5375543">)</span><span class="op" id="5375544">;</span>&nbsp;<span class="ident" id="5375546">err</span>&nbsp;<span class="op" id="5375550">!=</span>&nbsp;<span class="builtintype" id="5375553">nil</span>&nbsp;<span class="op" id="5375557">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375563">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5375573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375578">return</span>&nbsp;<span class="builtintype" id="5375585">nil</span><span class="op" id="5375588">,</span>&nbsp;<span class="string" id="5375590">&#34;&#34;</span><span class="op" id="5375592">,</span>&nbsp;<span class="op" id="5375594">&amp;</span><span class="ident" id="5375595">Error</span><span class="op" id="5375600">{</span><span class="ident" id="5375601">ErrInvalidCharRange</span><span class="op" id="5375620">,</span>&nbsp;<span class="ident" id="5375622">s</span><span class="op" id="5375623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5375627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375631">seq</span><span class="op" id="5375634">,</span>&nbsp;<span class="ident" id="5375636">t</span>&nbsp;<span class="op" id="5375638">=</span>&nbsp;<span class="ident" id="5375640">s</span><span class="op" id="5375641">[</span><span class="op" id="5375642">:</span><span class="ident" id="5375643">end</span><span class="op" id="5375646">+</span><span class="num" id="5375647">1</span><span class="op" id="5375648">]</span><span class="op" id="5375649">,</span>&nbsp;<span class="ident" id="5375651">s</span><span class="op" id="5375652">[</span><span class="ident" id="5375653">end</span><span class="op" id="5375656">+</span><span class="num" id="5375657">1</span><span class="op" id="5375658">:</span><span class="op" id="5375659">]</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375663">name</span>&nbsp;<span class="op" id="5375668">=</span>&nbsp;<span class="ident" id="5375670">s</span><span class="op" id="5375671">[</span><span class="num" id="5375672">3</span><span class="op" id="5375673">:</span><span class="ident" id="5375674">end</span><span class="op" id="5375677">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375681">if</span>&nbsp;<span class="ident" id="5375684">err</span>&nbsp;<span class="op" id="5375688">=</span>&nbsp;<span class="ident" id="5375690">checkUTF8</span><span class="op" id="5375699">(</span><span class="ident" id="5375700">name</span><span class="op" id="5375704">)</span><span class="op" id="5375705">;</span>&nbsp;<span class="ident" id="5375707">err</span>&nbsp;<span class="op" id="5375711">!=</span>&nbsp;<span class="builtintype" id="5375714">nil</span>&nbsp;<span class="op" id="5375718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375723">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5375732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5375735">}</span><br>
<span class="lineno">1480</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5375739">//&nbsp;Group&nbsp;can&nbsp;have&nbsp;leading&nbsp;negation&nbsp;too.&nbsp;&nbsp;\p{^Han}&nbsp;==&nbsp;\P{Han},&nbsp;\P{^Han}&nbsp;==&nbsp;\p{Han}.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375823">if</span>&nbsp;<span class="ident" id="5375826">name</span>&nbsp;<span class="op" id="5375831">!=</span>&nbsp;<span class="string" id="5375834">&#34;&#34;</span>&nbsp;<span class="op" id="5375837">&amp;&amp;</span>&nbsp;<span class="ident" id="5375840">name</span><span class="op" id="5375844">[</span><span class="num" id="5375845">0</span><span class="op" id="5375846">]</span>&nbsp;<span class="op" id="5375848">==</span>&nbsp;<span class="string" id="5375851">&#39;^&#39;</span>&nbsp;<span class="op" id="5375855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375859">sign</span>&nbsp;<span class="op" id="5375864">=</span>&nbsp;<span class="op" id="5375866">-</span><span class="ident" id="5375867">sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375874">name</span>&nbsp;<span class="op" id="5375879">=</span>&nbsp;<span class="ident" id="5375881">name</span><span class="op" id="5375885">[</span><span class="num" id="5375886">1</span><span class="op" id="5375887">:</span><span class="op" id="5375888">]</span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5375891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5375895">tab</span><span class="op" id="5375898">,</span>&nbsp;<span class="ident" id="5375900">fold</span>&nbsp;<span class="op" id="5375905">:=</span>&nbsp;<span class="ident" id="5375908">unicodeTable</span><span class="op" id="5375920">(</span><span class="ident" id="5375921">name</span><span class="op" id="5375925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375928">if</span>&nbsp;<span class="ident" id="5375931">tab</span>&nbsp;<span class="op" id="5375935">==</span>&nbsp;<span class="builtintype" id="5375938">nil</span>&nbsp;<span class="op" id="5375942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5375946">return</span>&nbsp;<span class="builtintype" id="5375953">nil</span><span class="op" id="5375956">,</span>&nbsp;<span class="string" id="5375958">&#34;&#34;</span><span class="op" id="5375960">,</span>&nbsp;<span class="op" id="5375962">&amp;</span><span class="ident" id="5375963">Error</span><span class="op" id="5375968">{</span><span class="ident" id="5375969">ErrInvalidCharRange</span><span class="op" id="5375988">,</span>&nbsp;<span class="ident" id="5375990">seq</span><span class="op" id="5375993">}</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5375996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5376000">if</span>&nbsp;<span class="ident" id="5376003">p</span><span class="op" id="5376004">.</span><span class="ident" id="5376005">flags</span><span class="op" id="5376010">&amp;</span><span class="ident" id="5376011">FoldCase</span>&nbsp;<span class="op" id="5376020">==</span>&nbsp;<span class="num" id="5376023">0</span>&nbsp;<span class="op" id="5376025">||</span>&nbsp;<span class="ident" id="5376028">fold</span>&nbsp;<span class="op" id="5376033">==</span>&nbsp;<span class="builtintype" id="5376036">nil</span>&nbsp;<span class="op" id="5376040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5376044">if</span>&nbsp;<span class="ident" id="5376047">sign</span>&nbsp;<span class="op" id="5376052">&gt;</span>&nbsp;<span class="num" id="5376054">0</span>&nbsp;<span class="op" id="5376056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376061">r</span>&nbsp;<span class="op" id="5376063">=</span>&nbsp;<span class="ident" id="5376065">appendTable</span><span class="op" id="5376076">(</span><span class="ident" id="5376077">r</span><span class="op" id="5376078">,</span>&nbsp;<span class="ident" id="5376080">tab</span><span class="op" id="5376083">)</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5376087">}</span>&nbsp;<span class="keyword" id="5376089">else</span>&nbsp;<span class="op" id="5376094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376099">r</span>&nbsp;<span class="op" id="5376101">=</span>&nbsp;<span class="ident" id="5376103">appendNegatedTable</span><span class="op" id="5376121">(</span><span class="ident" id="5376122">r</span><span class="op" id="5376123">,</span>&nbsp;<span class="ident" id="5376125">tab</span><span class="op" id="5376128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5376132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5376135">}</span>&nbsp;<span class="keyword" id="5376137">else</span>&nbsp;<span class="op" id="5376142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5376146">//&nbsp;Merge&nbsp;and&nbsp;clean&nbsp;tab&nbsp;and&nbsp;fold&nbsp;in&nbsp;a&nbsp;temporary&nbsp;buffer.</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5376203">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;for&nbsp;the&nbsp;negative&nbsp;case&nbsp;and&nbsp;just&nbsp;tidy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5376262">//&nbsp;for&nbsp;the&nbsp;positive&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376290">tmp</span>&nbsp;<span class="op" id="5376294">:=</span>&nbsp;<span class="ident" id="5376297">p</span><span class="op" id="5376298">.</span><span class="ident" id="5376299">tmpClass</span><span class="op" id="5376307">[</span><span class="op" id="5376308">:</span><span class="num" id="5376309">0</span><span class="op" id="5376310">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376314">tmp</span>&nbsp;<span class="op" id="5376318">=</span>&nbsp;<span class="ident" id="5376320">appendTable</span><span class="op" id="5376331">(</span><span class="ident" id="5376332">tmp</span><span class="op" id="5376335">,</span>&nbsp;<span class="ident" id="5376337">tab</span><span class="op" id="5376340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376344">tmp</span>&nbsp;<span class="op" id="5376348">=</span>&nbsp;<span class="ident" id="5376350">appendTable</span><span class="op" id="5376361">(</span><span class="ident" id="5376362">tmp</span><span class="op" id="5376365">,</span>&nbsp;<span class="ident" id="5376367">fold</span><span class="op" id="5376371">)</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376375">p</span><span class="op" id="5376376">.</span><span class="ident" id="5376377">tmpClass</span>&nbsp;<span class="op" id="5376386">=</span>&nbsp;<span class="ident" id="5376388">tmp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376394">tmp</span>&nbsp;<span class="op" id="5376398">=</span>&nbsp;<span class="ident" id="5376400">cleanClass</span><span class="op" id="5376410">(</span><span class="op" id="5376411">&amp;</span><span class="ident" id="5376412">p</span><span class="op" id="5376413">.</span><span class="ident" id="5376414">tmpClass</span><span class="op" id="5376422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5376426">if</span>&nbsp;<span class="ident" id="5376429">sign</span>&nbsp;<span class="op" id="5376434">&gt;</span>&nbsp;<span class="num" id="5376436">0</span>&nbsp;<span class="op" id="5376438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376443">r</span>&nbsp;<span class="op" id="5376445">=</span>&nbsp;<span class="ident" id="5376447">appendClass</span><span class="op" id="5376458">(</span><span class="ident" id="5376459">r</span><span class="op" id="5376460">,</span>&nbsp;<span class="ident" id="5376462">tmp</span><span class="op" id="5376465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5376469">}</span>&nbsp;<span class="keyword" id="5376471">else</span>&nbsp;<span class="op" id="5376476">{</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376481">r</span>&nbsp;<span class="op" id="5376483">=</span>&nbsp;<span class="ident" id="5376485">appendNegatedClass</span><span class="op" id="5376503">(</span><span class="ident" id="5376504">r</span><span class="op" id="5376505">,</span>&nbsp;<span class="ident" id="5376507">tmp</span><span class="op" id="5376510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5376514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5376517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5376520">return</span>&nbsp;<span class="ident" id="5376527">r</span><span class="op" id="5376528">,</span>&nbsp;<span class="ident" id="5376530">t</span><span class="op" id="5376531">,</span>&nbsp;<span class="builtintype" id="5376533">nil</span><br>
<span class="lineno"></span><span class="op" id="5376537">}</span><br>
<span class="lineno">1515</span><br>
<span class="lineno"></span><span class="comment" id="5376540">//&nbsp;parseClass&nbsp;parses&nbsp;a&nbsp;character&nbsp;class&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5376601">//&nbsp;and&nbsp;pushes&nbsp;it&nbsp;onto&nbsp;the&nbsp;parse&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="5376640">func</span>&nbsp;<span class="op" id="5376645">(</span><span class="ident" id="5376646">p</span>&nbsp;<span class="op" id="5376648">*</span><span class="ident" id="5376649">parser</span><span class="op" id="5376655">)</span>&nbsp;<span class="ident" id="5376657">parseClass</span><span class="op" id="5376667">(</span><span class="ident" id="5376668">s</span>&nbsp;<span class="builtintype" id="5376670">string</span><span class="op" id="5376676">)</span>&nbsp;<span class="op" id="5376678">(</span><span class="ident" id="5376679">rest</span>&nbsp;<span class="builtintype" id="5376684">string</span><span class="op" id="5376690">,</span>&nbsp;<span class="ident" id="5376692">err</span>&nbsp;<span class="builtintype" id="5376696">error</span><span class="op" id="5376701">)</span>&nbsp;<span class="op" id="5376703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376706">t</span>&nbsp;<span class="op" id="5376708">:=</span>&nbsp;<span class="ident" id="5376711">s</span><span class="op" id="5376712">[</span><span class="num" id="5376713">1</span><span class="op" id="5376714">:</span><span class="op" id="5376715">]</span>&nbsp;<span class="comment" id="5376717">//&nbsp;chop&nbsp;[</span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376728">re</span>&nbsp;<span class="op" id="5376731">:=</span>&nbsp;<span class="ident" id="5376734">p</span><span class="op" id="5376735">.</span><span class="ident" id="5376736">newRegexp</span><span class="op" id="5376745">(</span><span class="ident" id="5376746">OpCharClass</span><span class="op" id="5376757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376760">re</span><span class="op" id="5376762">.</span><span class="ident" id="5376763">Flags</span>&nbsp;<span class="op" id="5376769">=</span>&nbsp;<span class="ident" id="5376771">p</span><span class="op" id="5376772">.</span><span class="ident" id="5376773">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376780">re</span><span class="op" id="5376782">.</span><span class="ident" id="5376783">Rune</span>&nbsp;<span class="op" id="5376788">=</span>&nbsp;<span class="ident" id="5376790">re</span><span class="op" id="5376792">.</span><span class="ident" id="5376793">Rune0</span><span class="op" id="5376798">[</span><span class="op" id="5376799">:</span><span class="num" id="5376800">0</span><span class="op" id="5376801">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376805">sign</span>&nbsp;<span class="op" id="5376810">:=</span>&nbsp;<span class="op" id="5376813">+</span><span class="num" id="5376814">1</span><br>
<span class="lineno">1525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5376817">if</span>&nbsp;<span class="ident" id="5376820">t</span>&nbsp;<span class="op" id="5376822">!=</span>&nbsp;<span class="string" id="5376825">&#34;&#34;</span>&nbsp;<span class="op" id="5376828">&amp;&amp;</span>&nbsp;<span class="ident" id="5376831">t</span><span class="op" id="5376832">[</span><span class="num" id="5376833">0</span><span class="op" id="5376834">]</span>&nbsp;<span class="op" id="5376836">==</span>&nbsp;<span class="string" id="5376839">&#39;^&#39;</span>&nbsp;<span class="op" id="5376843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376847">sign</span>&nbsp;<span class="op" id="5376852">=</span>&nbsp;<span class="op" id="5376854">-</span><span class="num" id="5376855">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5376859">t</span>&nbsp;<span class="op" id="5376861">=</span>&nbsp;<span class="ident" id="5376863">t</span><span class="op" id="5376864">[</span><span class="num" id="5376865">1</span><span class="op" id="5376866">:</span><span class="op" id="5376867">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5376872">//&nbsp;If&nbsp;character&nbsp;class&nbsp;does&nbsp;not&nbsp;match&nbsp;\n,&nbsp;add&nbsp;it&nbsp;here,</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5376928">//&nbsp;so&nbsp;that&nbsp;negation&nbsp;later&nbsp;will&nbsp;do&nbsp;the&nbsp;right&nbsp;thing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5376981">if</span>&nbsp;<span class="ident" id="5376984">p</span><span class="op" id="5376985">.</span><span class="ident" id="5376986">flags</span><span class="op" id="5376991">&amp;</span><span class="ident" id="5376992">ClassNL</span>&nbsp;<span class="op" id="5377000">==</span>&nbsp;<span class="num" id="5377003">0</span>&nbsp;<span class="op" id="5377005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5377010">re</span><span class="op" id="5377012">.</span><span class="ident" id="5377013">Rune</span>&nbsp;<span class="op" id="5377018">=</span>&nbsp;<span class="builtinfunc" id="5377020">append</span><span class="op" id="5377026">(</span><span class="ident" id="5377027">re</span><span class="op" id="5377029">.</span><span class="ident" id="5377030">Rune</span><span class="op" id="5377034">,</span>&nbsp;<span class="string" id="5377036">&#39;\n&#39;</span><span class="op" id="5377040">,</span>&nbsp;<span class="string" id="5377042">&#39;\n&#39;</span><span class="op" id="5377046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5377050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5377053">}</span><br>
<span class="lineno">1535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5377057">class</span>&nbsp;<span class="op" id="5377063">:=</span>&nbsp;<span class="ident" id="5377066">re</span><span class="op" id="5377068">.</span><span class="ident" id="5377069">Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5377075">first</span>&nbsp;<span class="op" id="5377081">:=</span>&nbsp;<span class="builtintype" id="5377084">true</span>&nbsp;<span class="comment" id="5377089">//&nbsp;]&nbsp;and&nbsp;-&nbsp;are&nbsp;okay&nbsp;as&nbsp;first&nbsp;char&nbsp;in&nbsp;class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377133">for</span>&nbsp;<span class="ident" id="5377137">t</span>&nbsp;<span class="op" id="5377139">==</span>&nbsp;<span class="string" id="5377142">&#34;&#34;</span>&nbsp;<span class="op" id="5377145">||</span>&nbsp;<span class="ident" id="5377148">t</span><span class="op" id="5377149">[</span><span class="num" id="5377150">0</span><span class="op" id="5377151">]</span>&nbsp;<span class="op" id="5377153">!=</span>&nbsp;<span class="string" id="5377156">&#39;]&#39;</span>&nbsp;<span class="op" id="5377160">||</span>&nbsp;<span class="ident" id="5377163">first</span>&nbsp;<span class="op" id="5377169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5377173">//&nbsp;POSIX:&nbsp;-&nbsp;is&nbsp;only&nbsp;okay&nbsp;unescaped&nbsp;as&nbsp;first&nbsp;or&nbsp;last&nbsp;in&nbsp;class.</span><br>
<span class="lineno">1540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5377237">//&nbsp;Perl:&nbsp;-&nbsp;is&nbsp;okay&nbsp;anywhere.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377268">if</span>&nbsp;<span class="ident" id="5377271">t</span>&nbsp;<span class="op" id="5377273">!=</span>&nbsp;<span class="string" id="5377276">&#34;&#34;</span>&nbsp;<span class="op" id="5377279">&amp;&amp;</span>&nbsp;<span class="ident" id="5377282">t</span><span class="op" id="5377283">[</span><span class="num" id="5377284">0</span><span class="op" id="5377285">]</span>&nbsp;<span class="op" id="5377287">==</span>&nbsp;<span class="string" id="5377290">&#39;-&#39;</span>&nbsp;<span class="op" id="5377294">&amp;&amp;</span>&nbsp;<span class="ident" id="5377297">p</span><span class="op" id="5377298">.</span><span class="ident" id="5377299">flags</span><span class="op" id="5377304">&amp;</span><span class="ident" id="5377305">PerlX</span>&nbsp;<span class="op" id="5377311">==</span>&nbsp;<span class="num" id="5377314">0</span>&nbsp;<span class="op" id="5377316">&amp;&amp;</span>&nbsp;<span class="op" id="5377319">!</span><span class="ident" id="5377320">first</span>&nbsp;<span class="op" id="5377326">&amp;&amp;</span>&nbsp;<span class="op" id="5377329">(</span><span class="builtinfunc" id="5377330">len</span><span class="op" id="5377333">(</span><span class="ident" id="5377334">t</span><span class="op" id="5377335">)</span>&nbsp;<span class="op" id="5377337">==</span>&nbsp;<span class="num" id="5377340">1</span>&nbsp;<span class="op" id="5377342">||</span>&nbsp;<span class="ident" id="5377345">t</span><span class="op" id="5377346">[</span><span class="num" id="5377347">1</span><span class="op" id="5377348">]</span>&nbsp;<span class="op" id="5377350">!=</span>&nbsp;<span class="string" id="5377353">&#39;]&#39;</span><span class="op" id="5377356">)</span>&nbsp;<span class="op" id="5377358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5377363">_</span><span class="op" id="5377364">,</span>&nbsp;<span class="ident" id="5377366">size</span>&nbsp;<span class="op" id="5377371">:=</span>&nbsp;<span class="ident" id="5377374">utf8</span><span class="op" id="5377378">.</span><span class="ident" id="5377379">DecodeRuneInString</span><span class="op" id="5377397">(</span><span class="ident" id="5377398">t</span><span class="op" id="5377399">[</span><span class="num" id="5377400">1</span><span class="op" id="5377401">:</span><span class="op" id="5377402">]</span><span class="op" id="5377403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377408">return</span>&nbsp;<span class="string" id="5377415">&#34;&#34;</span><span class="op" id="5377417">,</span>&nbsp;<span class="op" id="5377419">&amp;</span><span class="ident" id="5377420">Error</span><span class="op" id="5377425">{</span><span class="ident" id="5377426">Code</span><span class="op" id="5377430">:</span>&nbsp;<span class="ident" id="5377432">ErrInvalidCharRange</span><span class="op" id="5377451">,</span>&nbsp;<span class="ident" id="5377453">Expr</span><span class="op" id="5377457">:</span>&nbsp;<span class="ident" id="5377459">t</span><span class="op" id="5377460">[</span><span class="op" id="5377461">:</span><span class="num" id="5377462">1</span><span class="op" id="5377463">+</span><span class="ident" id="5377464">size</span><span class="op" id="5377468">]</span><span class="op" id="5377469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5377473">}</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5377477">first</span>&nbsp;<span class="op" id="5377483">=</span>&nbsp;<span class="builtintype" id="5377485">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5377494">//&nbsp;Look&nbsp;for&nbsp;POSIX&nbsp;[:alnum:]&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377529">if</span>&nbsp;<span class="builtinfunc" id="5377532">len</span><span class="op" id="5377535">(</span><span class="ident" id="5377536">t</span><span class="op" id="5377537">)</span>&nbsp;<span class="op" id="5377539">&gt;</span>&nbsp;<span class="num" id="5377541">2</span>&nbsp;<span class="op" id="5377543">&amp;&amp;</span>&nbsp;<span class="ident" id="5377546">t</span><span class="op" id="5377547">[</span><span class="num" id="5377548">0</span><span class="op" id="5377549">]</span>&nbsp;<span class="op" id="5377551">==</span>&nbsp;<span class="string" id="5377554">&#39;[&#39;</span>&nbsp;<span class="op" id="5377558">&amp;&amp;</span>&nbsp;<span class="ident" id="5377561">t</span><span class="op" id="5377562">[</span><span class="num" id="5377563">1</span><span class="op" id="5377564">]</span>&nbsp;<span class="op" id="5377566">==</span>&nbsp;<span class="string" id="5377569">&#39;:&#39;</span>&nbsp;<span class="op" id="5377573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5377578">nclass</span><span class="op" id="5377584">,</span>&nbsp;<span class="ident" id="5377586">nt</span><span class="op" id="5377588">,</span>&nbsp;<span class="ident" id="5377590">err</span>&nbsp;<span class="op" id="5377594">:=</span>&nbsp;<span class="ident" id="5377597">p</span><span class="op" id="5377598">.</span><span class="ident" id="5377599">parseNamedClass</span><span class="op" id="5377614">(</span><span class="ident" id="5377615">t</span><span class="op" id="5377616">,</span>&nbsp;<span class="ident" id="5377618">class</span><span class="op" id="5377623">)</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377628">if</span>&nbsp;<span class="ident" id="5377631">err</span>&nbsp;<span class="op" id="5377635">!=</span>&nbsp;<span class="builtintype" id="5377638">nil</span>&nbsp;<span class="op" id="5377642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377648">return</span>&nbsp;<span class="string" id="5377655">&#34;&#34;</span><span class="op" id="5377657">,</span>&nbsp;<span class="ident" id="5377659">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5377666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377671">if</span>&nbsp;<span class="ident" id="5377674">nclass</span>&nbsp;<span class="op" id="5377681">!=</span>&nbsp;<span class="builtintype" id="5377684">nil</span>&nbsp;<span class="op" id="5377688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5377694">class</span><span class="op" id="5377699">,</span>&nbsp;<span class="ident" id="5377701">t</span>&nbsp;<span class="op" id="5377703">=</span>&nbsp;<span class="ident" id="5377705">nclass</span><span class="op" id="5377711">,</span>&nbsp;<span class="ident" id="5377713">nt</span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377720">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5377732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5377736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5377741">//&nbsp;Look&nbsp;for&nbsp;Unicode&nbsp;character&nbsp;group&nbsp;like&nbsp;\p{Han}.</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5377793">nclass</span><span class="op" id="5377799">,</span>&nbsp;<span class="ident" id="5377801">nt</span><span class="op" id="5377803">,</span>&nbsp;<span class="ident" id="5377805">err</span>&nbsp;<span class="op" id="5377809">:=</span>&nbsp;<span class="ident" id="5377812">p</span><span class="op" id="5377813">.</span><span class="ident" id="5377814">parseUnicodeClass</span><span class="op" id="5377831">(</span><span class="ident" id="5377832">t</span><span class="op" id="5377833">,</span>&nbsp;<span class="ident" id="5377835">class</span><span class="op" id="5377840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377844">if</span>&nbsp;<span class="ident" id="5377847">err</span>&nbsp;<span class="op" id="5377851">!=</span>&nbsp;<span class="builtintype" id="5377854">nil</span>&nbsp;<span class="op" id="5377858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377863">return</span>&nbsp;<span class="string" id="5377870">&#34;&#34;</span><span class="op" id="5377872">,</span>&nbsp;<span class="ident" id="5377874">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5377880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377884">if</span>&nbsp;<span class="ident" id="5377887">nclass</span>&nbsp;<span class="op" id="5377894">!=</span>&nbsp;<span class="builtintype" id="5377897">nil</span>&nbsp;<span class="op" id="5377901">{</span><br>
<span class="lineno">1565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5377906">class</span><span class="op" id="5377911">,</span>&nbsp;<span class="ident" id="5377913">t</span>&nbsp;<span class="op" id="5377915">=</span>&nbsp;<span class="ident" id="5377917">nclass</span><span class="op" id="5377923">,</span>&nbsp;<span class="ident" id="5377925">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5377931">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5377942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5377947">//&nbsp;Look&nbsp;for&nbsp;Perl&nbsp;character&nbsp;class&nbsp;symbols&nbsp;(extension).</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378003">if</span>&nbsp;<span class="ident" id="5378006">nclass</span><span class="op" id="5378012">,</span>&nbsp;<span class="ident" id="5378014">nt</span>&nbsp;<span class="op" id="5378017">:=</span>&nbsp;<span class="ident" id="5378020">p</span><span class="op" id="5378021">.</span><span class="ident" id="5378022">parsePerlClassEscape</span><span class="op" id="5378042">(</span><span class="ident" id="5378043">t</span><span class="op" id="5378044">,</span>&nbsp;<span class="ident" id="5378046">class</span><span class="op" id="5378051">)</span><span class="op" id="5378052">;</span>&nbsp;<span class="ident" id="5378054">nclass</span>&nbsp;<span class="op" id="5378061">!=</span>&nbsp;<span class="builtintype" id="5378064">nil</span>&nbsp;<span class="op" id="5378068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378073">class</span><span class="op" id="5378078">,</span>&nbsp;<span class="ident" id="5378080">t</span>&nbsp;<span class="op" id="5378082">=</span>&nbsp;<span class="ident" id="5378084">nclass</span><span class="op" id="5378090">,</span>&nbsp;<span class="ident" id="5378092">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378098">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5378109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5378114">//&nbsp;Single&nbsp;character&nbsp;or&nbsp;simple&nbsp;range.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378153">rng</span>&nbsp;<span class="op" id="5378157">:=</span>&nbsp;<span class="ident" id="5378160">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378164">var</span>&nbsp;<span class="ident" id="5378168">lo</span><span class="op" id="5378170">,</span>&nbsp;<span class="ident" id="5378172">hi</span>&nbsp;<span class="builtintype" id="5378175">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378182">if</span>&nbsp;<span class="ident" id="5378185">lo</span><span class="op" id="5378187">,</span>&nbsp;<span class="ident" id="5378189">t</span><span class="op" id="5378190">,</span>&nbsp;<span class="ident" id="5378192">err</span>&nbsp;<span class="op" id="5378196">=</span>&nbsp;<span class="ident" id="5378198">p</span><span class="op" id="5378199">.</span><span class="ident" id="5378200">parseClassChar</span><span class="op" id="5378214">(</span><span class="ident" id="5378215">t</span><span class="op" id="5378216">,</span>&nbsp;<span class="ident" id="5378218">s</span><span class="op" id="5378219">)</span><span class="op" id="5378220">;</span>&nbsp;<span class="ident" id="5378222">err</span>&nbsp;<span class="op" id="5378226">!=</span>&nbsp;<span class="builtintype" id="5378229">nil</span>&nbsp;<span class="op" id="5378233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378238">return</span>&nbsp;<span class="string" id="5378245">&#34;&#34;</span><span class="op" id="5378247">,</span>&nbsp;<span class="ident" id="5378249">err</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5378255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378259">hi</span>&nbsp;<span class="op" id="5378262">=</span>&nbsp;<span class="ident" id="5378264">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5378269">//&nbsp;[a-]&nbsp;means&nbsp;(a|-)&nbsp;so&nbsp;check&nbsp;for&nbsp;final&nbsp;].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378313">if</span>&nbsp;<span class="builtinfunc" id="5378316">len</span><span class="op" id="5378319">(</span><span class="ident" id="5378320">t</span><span class="op" id="5378321">)</span>&nbsp;<span class="op" id="5378323">&gt;=</span>&nbsp;<span class="num" id="5378326">2</span>&nbsp;<span class="op" id="5378328">&amp;&amp;</span>&nbsp;<span class="ident" id="5378331">t</span><span class="op" id="5378332">[</span><span class="num" id="5378333">0</span><span class="op" id="5378334">]</span>&nbsp;<span class="op" id="5378336">==</span>&nbsp;<span class="string" id="5378339">&#39;-&#39;</span>&nbsp;<span class="op" id="5378343">&amp;&amp;</span>&nbsp;<span class="ident" id="5378346">t</span><span class="op" id="5378347">[</span><span class="num" id="5378348">1</span><span class="op" id="5378349">]</span>&nbsp;<span class="op" id="5378351">!=</span>&nbsp;<span class="string" id="5378354">&#39;]&#39;</span>&nbsp;<span class="op" id="5378358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378363">t</span>&nbsp;<span class="op" id="5378365">=</span>&nbsp;<span class="ident" id="5378367">t</span><span class="op" id="5378368">[</span><span class="num" id="5378369">1</span><span class="op" id="5378370">:</span><span class="op" id="5378371">]</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378376">if</span>&nbsp;<span class="ident" id="5378379">hi</span><span class="op" id="5378381">,</span>&nbsp;<span class="ident" id="5378383">t</span><span class="op" id="5378384">,</span>&nbsp;<span class="ident" id="5378386">err</span>&nbsp;<span class="op" id="5378390">=</span>&nbsp;<span class="ident" id="5378392">p</span><span class="op" id="5378393">.</span><span class="ident" id="5378394">parseClassChar</span><span class="op" id="5378408">(</span><span class="ident" id="5378409">t</span><span class="op" id="5378410">,</span>&nbsp;<span class="ident" id="5378412">s</span><span class="op" id="5378413">)</span><span class="op" id="5378414">;</span>&nbsp;<span class="ident" id="5378416">err</span>&nbsp;<span class="op" id="5378420">!=</span>&nbsp;<span class="builtintype" id="5378423">nil</span>&nbsp;<span class="op" id="5378427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378433">return</span>&nbsp;<span class="string" id="5378440">&#34;&#34;</span><span class="op" id="5378442">,</span>&nbsp;<span class="ident" id="5378444">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5378451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378456">if</span>&nbsp;<span class="ident" id="5378459">hi</span>&nbsp;<span class="op" id="5378462">&lt;</span>&nbsp;<span class="ident" id="5378464">lo</span>&nbsp;<span class="op" id="5378467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378473">rng</span>&nbsp;<span class="op" id="5378477">=</span>&nbsp;<span class="ident" id="5378479">rng</span><span class="op" id="5378482">[</span><span class="op" id="5378483">:</span><span class="builtinfunc" id="5378484">len</span><span class="op" id="5378487">(</span><span class="ident" id="5378488">rng</span><span class="op" id="5378491">)</span><span class="op" id="5378492">-</span><span class="builtinfunc" id="5378493">len</span><span class="op" id="5378496">(</span><span class="ident" id="5378497">t</span><span class="op" id="5378498">)</span><span class="op" id="5378499">]</span><br>
<span class="lineno">1590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378505">return</span>&nbsp;<span class="string" id="5378512">&#34;&#34;</span><span class="op" id="5378514">,</span>&nbsp;<span class="op" id="5378516">&amp;</span><span class="ident" id="5378517">Error</span><span class="op" id="5378522">{</span><span class="ident" id="5378523">Code</span><span class="op" id="5378527">:</span>&nbsp;<span class="ident" id="5378529">ErrInvalidCharRange</span><span class="op" id="5378548">,</span>&nbsp;<span class="ident" id="5378550">Expr</span><span class="op" id="5378554">:</span>&nbsp;<span class="ident" id="5378556">rng</span><span class="op" id="5378559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5378564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5378568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378572">if</span>&nbsp;<span class="ident" id="5378575">p</span><span class="op" id="5378576">.</span><span class="ident" id="5378577">flags</span><span class="op" id="5378582">&amp;</span><span class="ident" id="5378583">FoldCase</span>&nbsp;<span class="op" id="5378592">==</span>&nbsp;<span class="num" id="5378595">0</span>&nbsp;<span class="op" id="5378597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378602">class</span>&nbsp;<span class="op" id="5378608">=</span>&nbsp;<span class="ident" id="5378610">appendRange</span><span class="op" id="5378621">(</span><span class="ident" id="5378622">class</span><span class="op" id="5378627">,</span>&nbsp;<span class="ident" id="5378629">lo</span><span class="op" id="5378631">,</span>&nbsp;<span class="ident" id="5378633">hi</span><span class="op" id="5378635">)</span><br>
<span class="lineno">1595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5378639">}</span>&nbsp;<span class="keyword" id="5378641">else</span>&nbsp;<span class="op" id="5378646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378651">class</span>&nbsp;<span class="op" id="5378657">=</span>&nbsp;<span class="ident" id="5378659">appendFoldedRange</span><span class="op" id="5378676">(</span><span class="ident" id="5378677">class</span><span class="op" id="5378682">,</span>&nbsp;<span class="ident" id="5378684">lo</span><span class="op" id="5378686">,</span>&nbsp;<span class="ident" id="5378688">hi</span><span class="op" id="5378690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5378694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5378697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378700">t</span>&nbsp;<span class="op" id="5378702">=</span>&nbsp;<span class="ident" id="5378704">t</span><span class="op" id="5378705">[</span><span class="num" id="5378706">1</span><span class="op" id="5378707">:</span><span class="op" id="5378708">]</span>&nbsp;<span class="comment" id="5378710">//&nbsp;chop&nbsp;]</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5378722">//&nbsp;Use&nbsp;&amp;re.Rune&nbsp;instead&nbsp;of&nbsp;&amp;class&nbsp;to&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378778">re</span><span class="op" id="5378780">.</span><span class="ident" id="5378781">Rune</span>&nbsp;<span class="op" id="5378786">=</span>&nbsp;<span class="ident" id="5378788">class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378795">class</span>&nbsp;<span class="op" id="5378801">=</span>&nbsp;<span class="ident" id="5378803">cleanClass</span><span class="op" id="5378813">(</span><span class="op" id="5378814">&amp;</span><span class="ident" id="5378815">re</span><span class="op" id="5378817">.</span><span class="ident" id="5378818">Rune</span><span class="op" id="5378822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378825">if</span>&nbsp;<span class="ident" id="5378828">sign</span>&nbsp;<span class="op" id="5378833">&lt;</span>&nbsp;<span class="num" id="5378835">0</span>&nbsp;<span class="op" id="5378837">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378841">class</span>&nbsp;<span class="op" id="5378847">=</span>&nbsp;<span class="ident" id="5378849">negateClass</span><span class="op" id="5378860">(</span><span class="ident" id="5378861">class</span><span class="op" id="5378866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5378869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378872">re</span><span class="op" id="5378874">.</span><span class="ident" id="5378875">Rune</span>&nbsp;<span class="op" id="5378880">=</span>&nbsp;<span class="ident" id="5378882">class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5378889">p</span><span class="op" id="5378890">.</span><span class="ident" id="5378891">push</span><span class="op" id="5378895">(</span><span class="ident" id="5378896">re</span><span class="op" id="5378898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5378901">return</span>&nbsp;<span class="ident" id="5378908">t</span><span class="op" id="5378909">,</span>&nbsp;<span class="builtintype" id="5378911">nil</span><br>
<span class="lineno">1610</span><span class="op" id="5378915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5378918">//&nbsp;cleanClass&nbsp;sorts&nbsp;the&nbsp;ranges&nbsp;(pairs&nbsp;of&nbsp;elements&nbsp;of&nbsp;r),</span><br>
<span class="lineno"></span><span class="comment" id="5378975">//&nbsp;merges&nbsp;them,&nbsp;and&nbsp;eliminates&nbsp;duplicates.</span><br>
<span class="lineno"></span><span class="keyword" id="5379018">func</span>&nbsp;<span class="ident" id="5379023">cleanClass</span><span class="op" id="5379033">(</span><span class="ident" id="5379034">rp</span>&nbsp;<span class="op" id="5379037">*</span><span class="op" id="5379038">[</span><span class="op" id="5379039">]</span><span class="builtintype" id="5379040">rune</span><span class="op" id="5379044">)</span>&nbsp;<span class="op" id="5379046">[</span><span class="op" id="5379047">]</span><span class="builtintype" id="5379048">rune</span>&nbsp;<span class="op" id="5379053">{</span><br>
<span class="lineno">1615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5379057">//&nbsp;Sort&nbsp;by&nbsp;lo&nbsp;increasing,&nbsp;hi&nbsp;decreasing&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379113">sort</span><span class="op" id="5379117">.</span><span class="ident" id="5379118">Sort</span><span class="op" id="5379122">(</span><span class="ident" id="5379123">ranges</span><span class="op" id="5379129">{</span><span class="ident" id="5379130">rp</span><span class="op" id="5379132">}</span><span class="op" id="5379133">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379137">r</span>&nbsp;<span class="op" id="5379139">:=</span>&nbsp;<span class="op" id="5379142">*</span><span class="ident" id="5379143">rp</span><br>
<span class="lineno">1620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5379147">if</span>&nbsp;<span class="builtinfunc" id="5379150">len</span><span class="op" id="5379153">(</span><span class="ident" id="5379154">r</span><span class="op" id="5379155">)</span>&nbsp;<span class="op" id="5379157">&lt;</span>&nbsp;<span class="num" id="5379159">2</span>&nbsp;<span class="op" id="5379161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5379165">return</span>&nbsp;<span class="ident" id="5379172">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5379175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5379179">//&nbsp;Merge&nbsp;abutting,&nbsp;overlapping.</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379212">w</span>&nbsp;<span class="op" id="5379214">:=</span>&nbsp;<span class="num" id="5379217">2</span>&nbsp;<span class="comment" id="5379219">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5379235">for</span>&nbsp;<span class="ident" id="5379239">i</span>&nbsp;<span class="op" id="5379241">:=</span>&nbsp;<span class="num" id="5379244">2</span><span class="op" id="5379245">;</span>&nbsp;<span class="ident" id="5379247">i</span>&nbsp;<span class="op" id="5379249">&lt;</span>&nbsp;<span class="builtinfunc" id="5379251">len</span><span class="op" id="5379254">(</span><span class="ident" id="5379255">r</span><span class="op" id="5379256">)</span><span class="op" id="5379257">;</span>&nbsp;<span class="ident" id="5379259">i</span>&nbsp;<span class="op" id="5379261">+=</span>&nbsp;<span class="num" id="5379264">2</span>&nbsp;<span class="op" id="5379266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379270">lo</span><span class="op" id="5379272">,</span>&nbsp;<span class="ident" id="5379274">hi</span>&nbsp;<span class="op" id="5379277">:=</span>&nbsp;<span class="ident" id="5379280">r</span><span class="op" id="5379281">[</span><span class="ident" id="5379282">i</span><span class="op" id="5379283">]</span><span class="op" id="5379284">,</span>&nbsp;<span class="ident" id="5379286">r</span><span class="op" id="5379287">[</span><span class="ident" id="5379288">i</span><span class="op" id="5379289">+</span><span class="num" id="5379290">1</span><span class="op" id="5379291">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5379295">if</span>&nbsp;<span class="ident" id="5379298">lo</span>&nbsp;<span class="op" id="5379301">&lt;=</span>&nbsp;<span class="ident" id="5379304">r</span><span class="op" id="5379305">[</span><span class="ident" id="5379306">w</span><span class="op" id="5379307">-</span><span class="num" id="5379308">1</span><span class="op" id="5379309">]</span><span class="op" id="5379310">+</span><span class="num" id="5379311">1</span>&nbsp;<span class="op" id="5379313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5379318">//&nbsp;merge&nbsp;with&nbsp;previous&nbsp;range</span><br>
<span class="lineno">1630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5379350">if</span>&nbsp;<span class="ident" id="5379353">hi</span>&nbsp;<span class="op" id="5379356">&gt;</span>&nbsp;<span class="ident" id="5379358">r</span><span class="op" id="5379359">[</span><span class="ident" id="5379360">w</span><span class="op" id="5379361">-</span><span class="num" id="5379362">1</span><span class="op" id="5379363">]</span>&nbsp;<span class="op" id="5379365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379371">r</span><span class="op" id="5379372">[</span><span class="ident" id="5379373">w</span><span class="op" id="5379374">-</span><span class="num" id="5379375">1</span><span class="op" id="5379376">]</span>&nbsp;<span class="op" id="5379378">=</span>&nbsp;<span class="ident" id="5379380">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5379386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5379391">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5379402">}</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5379406">//&nbsp;new&nbsp;disjoint&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379430">r</span><span class="op" id="5379431">[</span><span class="ident" id="5379432">w</span><span class="op" id="5379433">]</span>&nbsp;<span class="op" id="5379435">=</span>&nbsp;<span class="ident" id="5379437">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379442">r</span><span class="op" id="5379443">[</span><span class="ident" id="5379444">w</span><span class="op" id="5379445">+</span><span class="num" id="5379446">1</span><span class="op" id="5379447">]</span>&nbsp;<span class="op" id="5379449">=</span>&nbsp;<span class="ident" id="5379451">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5379456">w</span>&nbsp;<span class="op" id="5379458">+=</span>&nbsp;<span class="num" id="5379461">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5379464">}</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5379468">return</span>&nbsp;<span class="ident" id="5379475">r</span><span class="op" id="5379476">[</span><span class="op" id="5379477">:</span><span class="ident" id="5379478">w</span><span class="op" id="5379479">]</span><br>
<span class="lineno"></span><span class="op" id="5379481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5379484">//&nbsp;appendLiteral&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;literal&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno">1645</span><span class="keyword" id="5379563">func</span>&nbsp;<span class="ident" id="5379568">appendLiteral</span><span class="op" id="5379581">(</span><span class="ident" id="5379582">r</span>&nbsp;<span class="op" id="5379584">[</span><span class="op" id="5379585">]</span><span class="builtintype" id="5379586">rune</span><span class="op" id="5379590">,</span>&nbsp;<span class="ident" id="5379592">x</span>&nbsp;<span class="builtintype" id="5379594">rune</span><span class="op" id="5379598">,</span>&nbsp;<span class="ident" id="5379600">flags</span>&nbsp;<span class="ident" id="5379606">Flags</span><span class="op" id="5379611">)</span>&nbsp;<span class="op" id="5379613">[</span><span class="op" id="5379614">]</span><span class="builtintype" id="5379615">rune</span>&nbsp;<span class="op" id="5379620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5379623">if</span>&nbsp;<span class="ident" id="5379626">flags</span><span class="op" id="5379631">&amp;</span><span class="ident" id="5379632">FoldCase</span>&nbsp;<span class="op" id="5379641">!=</span>&nbsp;<span class="num" id="5379644">0</span>&nbsp;<span class="op" id="5379646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5379650">return</span>&nbsp;<span class="ident" id="5379657">appendFoldedRange</span><span class="op" id="5379674">(</span><span class="ident" id="5379675">r</span><span class="op" id="5379676">,</span>&nbsp;<span class="ident" id="5379678">x</span><span class="op" id="5379679">,</span>&nbsp;<span class="ident" id="5379681">x</span><span class="op" id="5379682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5379685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5379688">return</span>&nbsp;<span class="ident" id="5379695">appendRange</span><span class="op" id="5379706">(</span><span class="ident" id="5379707">r</span><span class="op" id="5379708">,</span>&nbsp;<span class="ident" id="5379710">x</span><span class="op" id="5379711">,</span>&nbsp;<span class="ident" id="5379713">x</span><span class="op" id="5379714">)</span><br>
<span class="lineno">1650</span><span class="op" id="5379716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5379719">//&nbsp;appendRange&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;range&nbsp;lo-hi&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5379798">func</span>&nbsp;<span class="ident" id="5379803">appendRange</span><span class="op" id="5379814">(</span><span class="ident" id="5379815">r</span>&nbsp;<span class="op" id="5379817">[</span><span class="op" id="5379818">]</span><span class="builtintype" id="5379819">rune</span><span class="op" id="5379823">,</span>&nbsp;<span class="ident" id="5379825">lo</span><span class="op" id="5379827">,</span>&nbsp;<span class="ident" id="5379829">hi</span>&nbsp;<span class="builtintype" id="5379832">rune</span><span class="op" id="5379836">)</span>&nbsp;<span class="op" id="5379838">[</span><span class="op" id="5379839">]</span><span class="builtintype" id="5379840">rune</span>&nbsp;<span class="op" id="5379845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5379848">//&nbsp;Expand&nbsp;last&nbsp;range&nbsp;or&nbsp;next&nbsp;to&nbsp;last&nbsp;range&nbsp;if&nbsp;it&nbsp;overlaps&nbsp;or&nbsp;abuts.</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5379917">//&nbsp;Checking&nbsp;two&nbsp;ranges&nbsp;helps&nbsp;when&nbsp;appending&nbsp;case-folded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5379974">//&nbsp;alphabets,&nbsp;so&nbsp;that&nbsp;one&nbsp;range&nbsp;can&nbsp;be&nbsp;expanding&nbsp;A-Z&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5380036">//&nbsp;other&nbsp;expanding&nbsp;a-z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5380061">n</span>&nbsp;<span class="op" id="5380063">:=</span>&nbsp;<span class="builtinfunc" id="5380066">len</span><span class="op" id="5380069">(</span><span class="ident" id="5380070">r</span><span class="op" id="5380071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5380074">for</span>&nbsp;<span class="ident" id="5380078">i</span>&nbsp;<span class="op" id="5380080">:=</span>&nbsp;<span class="num" id="5380083">2</span><span class="op" id="5380084">;</span>&nbsp;<span class="ident" id="5380086">i</span>&nbsp;<span class="op" id="5380088">&lt;=</span>&nbsp;<span class="num" id="5380091">4</span><span class="op" id="5380092">;</span>&nbsp;<span class="ident" id="5380094">i</span>&nbsp;<span class="op" id="5380096">+=</span>&nbsp;<span class="num" id="5380099">2</span>&nbsp;<span class="op" id="5380101">{</span>&nbsp;<span class="comment" id="5380103">//&nbsp;twice,&nbsp;using&nbsp;i=2,&nbsp;i=4</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5380130">if</span>&nbsp;<span class="ident" id="5380133">n</span>&nbsp;<span class="op" id="5380135">&gt;=</span>&nbsp;<span class="ident" id="5380138">i</span>&nbsp;<span class="op" id="5380140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5380145">rlo</span><span class="op" id="5380148">,</span>&nbsp;<span class="ident" id="5380150">rhi</span>&nbsp;<span class="op" id="5380154">:=</span>&nbsp;<span class="ident" id="5380157">r</span><span class="op" id="5380158">[</span><span class="ident" id="5380159">n</span><span class="op" id="5380160">-</span><span class="ident" id="5380161">i</span><span class="op" id="5380162">]</span><span class="op" id="5380163">,</span>&nbsp;<span class="ident" id="5380165">r</span><span class="op" id="5380166">[</span><span class="ident" id="5380167">n</span><span class="op" id="5380168">-</span><span class="ident" id="5380169">i</span><span class="op" id="5380170">+</span><span class="num" id="5380171">1</span><span class="op" id="5380172">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5380177">if</span>&nbsp;<span class="ident" id="5380180">lo</span>&nbsp;<span class="op" id="5380183">&lt;=</span>&nbsp;<span class="ident" id="5380186">rhi</span><span class="op" id="5380189">+</span><span class="num" id="5380190">1</span>&nbsp;<span class="op" id="5380192">&amp;&amp;</span>&nbsp;<span class="ident" id="5380195">rlo</span>&nbsp;<span class="op" id="5380199">&lt;=</span>&nbsp;<span class="ident" id="5380202">hi</span><span class="op" id="5380204">+</span><span class="num" id="5380205">1</span>&nbsp;<span class="op" id="5380207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5380213">if</span>&nbsp;<span class="ident" id="5380216">lo</span>&nbsp;<span class="op" id="5380219">&lt;</span>&nbsp;<span class="ident" id="5380221">rlo</span>&nbsp;<span class="op" id="5380225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5380232">r</span><span class="op" id="5380233">[</span><span class="ident" id="5380234">n</span><span class="op" id="5380235">-</span><span class="ident" id="5380236">i</span><span class="op" id="5380237">]</span>&nbsp;<span class="op" id="5380239">=</span>&nbsp;<span class="ident" id="5380241">lo</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5380248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5380254">if</span>&nbsp;<span class="ident" id="5380257">hi</span>&nbsp;<span class="op" id="5380260">&gt;</span>&nbsp;<span class="ident" id="5380262">rhi</span>&nbsp;<span class="op" id="5380266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5380273">r</span><span class="op" id="5380274">[</span><span class="ident" id="5380275">n</span><span class="op" id="5380276">-</span><span class="ident" id="5380277">i</span><span class="op" id="5380278">+</span><span class="num" id="5380279">1</span><span class="op" id="5380280">]</span>&nbsp;<span class="op" id="5380282">=</span>&nbsp;<span class="ident" id="5380284">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5380291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5380297">return</span>&nbsp;<span class="ident" id="5380304">r</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5380309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5380313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5380316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5380320">return</span>&nbsp;<span class="builtinfunc" id="5380327">append</span><span class="op" id="5380333">(</span><span class="ident" id="5380334">r</span><span class="op" id="5380335">,</span>&nbsp;<span class="ident" id="5380337">lo</span><span class="op" id="5380339">,</span>&nbsp;<span class="ident" id="5380341">hi</span><span class="op" id="5380343">)</span><br>
<span class="lineno">1675</span><span class="op" id="5380345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5380348">const</span>&nbsp;<span class="op" id="5380354">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5380357">//&nbsp;minimum&nbsp;and&nbsp;maximum&nbsp;runes&nbsp;involved&nbsp;in&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5380408">//&nbsp;checked&nbsp;during&nbsp;test.</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5380433">minFold</span>&nbsp;<span class="op" id="5380441">=</span>&nbsp;<span class="num" id="5380443">0x0041</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5380451">maxFold</span>&nbsp;<span class="op" id="5380459">=</span>&nbsp;<span class="num" id="5380461">0x118df</span><br>
<span class="lineno"></span><span class="op" id="5380469">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5380472">//&nbsp;appendFoldedRange&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;range&nbsp;lo-hi</span><br>
<span class="lineno">1685</span><span class="comment" id="5380541">//&nbsp;and&nbsp;its&nbsp;case&nbsp;folding-equivalent&nbsp;runes&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5380598">func</span>&nbsp;<span class="ident" id="5380603">appendFoldedRange</span><span class="op" id="5380620">(</span><span class="ident" id="5380621">r</span>&nbsp;<span class="op" id="5380623">[</span><span class="op" id="5380624">]</span><span class="builtintype" id="5380625">rune</span><span class="op" id="5380629">,</span>&nbsp;<span class="ident" id="5380631">lo</span><span class="op" id="5380633">,</span>&nbsp;<span class="ident" id="5380635">hi</span>&nbsp;<span class="builtintype" id="5380638">rune</span><span class="op" id="5380642">)</span>&nbsp;<span class="op" id="5380644">[</span><span class="op" id="5380645">]</span><span class="builtintype" id="5380646">rune</span>&nbsp;<span class="op" id="5380651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5380654">//&nbsp;Optimizations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5380673">if</span>&nbsp;<span class="ident" id="5380676">lo</span>&nbsp;<span class="op" id="5380679">&lt;=</span>&nbsp;<span class="ident" id="5380682">minFold</span>&nbsp;<span class="op" id="5380690">&amp;&amp;</span>&nbsp;<span class="ident" id="5380693">hi</span>&nbsp;<span class="op" id="5380696">&gt;=</span>&nbsp;<span class="ident" id="5380699">maxFold</span>&nbsp;<span class="op" id="5380707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5380711">//&nbsp;Range&nbsp;is&nbsp;full:&nbsp;folding&nbsp;can&#39;t&nbsp;add&nbsp;more.</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5380755">return</span>&nbsp;<span class="ident" id="5380762">appendRange</span><span class="op" id="5380773">(</span><span class="ident" id="5380774">r</span><span class="op" id="5380775">,</span>&nbsp;<span class="ident" id="5380777">lo</span><span class="op" id="5380779">,</span>&nbsp;<span class="ident" id="5380781">hi</span><span class="op" id="5380783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5380786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5380789">if</span>&nbsp;<span class="ident" id="5380792">hi</span>&nbsp;<span class="op" id="5380795">&lt;</span>&nbsp;<span class="ident" id="5380797">minFold</span>&nbsp;<span class="op" id="5380805">||</span>&nbsp;<span class="ident" id="5380808">lo</span>&nbsp;<span class="op" id="5380811">&gt;</span>&nbsp;<span class="ident" id="5380813">maxFold</span>&nbsp;<span class="op" id="5380821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5380825">//&nbsp;Range&nbsp;is&nbsp;outside&nbsp;folding&nbsp;possibilities.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5380870">return</span>&nbsp;<span class="ident" id="5380877">appendRange</span><span class="op" id="5380888">(</span><span class="ident" id="5380889">r</span><span class="op" id="5380890">,</span>&nbsp;<span class="ident" id="5380892">lo</span><span class="op" id="5380894">,</span>&nbsp;<span class="ident" id="5380896">hi</span><span class="op" id="5380898">)</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5380901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5380904">if</span>&nbsp;<span class="ident" id="5380907">lo</span>&nbsp;<span class="op" id="5380910">&lt;</span>&nbsp;<span class="ident" id="5380912">minFold</span>&nbsp;<span class="op" id="5380920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5380924">//&nbsp;[lo,&nbsp;minFold-1]&nbsp;needs&nbsp;no&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5380963">r</span>&nbsp;<span class="op" id="5380965">=</span>&nbsp;<span class="ident" id="5380967">appendRange</span><span class="op" id="5380978">(</span><span class="ident" id="5380979">r</span><span class="op" id="5380980">,</span>&nbsp;<span class="ident" id="5380982">lo</span><span class="op" id="5380984">,</span>&nbsp;<span class="ident" id="5380986">minFold</span><span class="op" id="5380993">-</span><span class="num" id="5380994">1</span><span class="op" id="5380995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5380999">lo</span>&nbsp;<span class="op" id="5381002">=</span>&nbsp;<span class="ident" id="5381004">minFold</span><br>
<span class="lineno">1700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5381013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381016">if</span>&nbsp;<span class="ident" id="5381019">hi</span>&nbsp;<span class="op" id="5381022">&gt;</span>&nbsp;<span class="ident" id="5381024">maxFold</span>&nbsp;<span class="op" id="5381032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5381036">//&nbsp;[maxFold+1,&nbsp;hi]&nbsp;needs&nbsp;no&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381075">r</span>&nbsp;<span class="op" id="5381077">=</span>&nbsp;<span class="ident" id="5381079">appendRange</span><span class="op" id="5381090">(</span><span class="ident" id="5381091">r</span><span class="op" id="5381092">,</span>&nbsp;<span class="ident" id="5381094">maxFold</span><span class="op" id="5381101">+</span><span class="num" id="5381102">1</span><span class="op" id="5381103">,</span>&nbsp;<span class="ident" id="5381105">hi</span><span class="op" id="5381107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381111">hi</span>&nbsp;<span class="op" id="5381114">=</span>&nbsp;<span class="ident" id="5381116">maxFold</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5381125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5381129">//&nbsp;Brute&nbsp;force.&nbsp;&nbsp;Depend&nbsp;on&nbsp;appendRange&nbsp;to&nbsp;coalesce&nbsp;ranges&nbsp;on&nbsp;the&nbsp;fly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381200">for</span>&nbsp;<span class="ident" id="5381204">c</span>&nbsp;<span class="op" id="5381206">:=</span>&nbsp;<span class="ident" id="5381209">lo</span><span class="op" id="5381211">;</span>&nbsp;<span class="ident" id="5381213">c</span>&nbsp;<span class="op" id="5381215">&lt;=</span>&nbsp;<span class="ident" id="5381218">hi</span><span class="op" id="5381220">;</span>&nbsp;<span class="ident" id="5381222">c</span><span class="op" id="5381223">++</span>&nbsp;<span class="op" id="5381226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381230">r</span>&nbsp;<span class="op" id="5381232">=</span>&nbsp;<span class="ident" id="5381234">appendRange</span><span class="op" id="5381245">(</span><span class="ident" id="5381246">r</span><span class="op" id="5381247">,</span>&nbsp;<span class="ident" id="5381249">c</span><span class="op" id="5381250">,</span>&nbsp;<span class="ident" id="5381252">c</span><span class="op" id="5381253">)</span><br>
<span class="lineno">1710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381257">f</span>&nbsp;<span class="op" id="5381259">:=</span>&nbsp;<span class="ident" id="5381262">unicode</span><span class="op" id="5381269">.</span><span class="ident" id="5381270">SimpleFold</span><span class="op" id="5381280">(</span><span class="ident" id="5381281">c</span><span class="op" id="5381282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381286">for</span>&nbsp;<span class="ident" id="5381290">f</span>&nbsp;<span class="op" id="5381292">!=</span>&nbsp;<span class="ident" id="5381295">c</span>&nbsp;<span class="op" id="5381297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381302">r</span>&nbsp;<span class="op" id="5381304">=</span>&nbsp;<span class="ident" id="5381306">appendRange</span><span class="op" id="5381317">(</span><span class="ident" id="5381318">r</span><span class="op" id="5381319">,</span>&nbsp;<span class="ident" id="5381321">f</span><span class="op" id="5381322">,</span>&nbsp;<span class="ident" id="5381324">f</span><span class="op" id="5381325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381330">f</span>&nbsp;<span class="op" id="5381332">=</span>&nbsp;<span class="ident" id="5381334">unicode</span><span class="op" id="5381341">.</span><span class="ident" id="5381342">SimpleFold</span><span class="op" id="5381352">(</span><span class="ident" id="5381353">f</span><span class="op" id="5381354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5381358">}</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5381361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381364">return</span>&nbsp;<span class="ident" id="5381371">r</span><br>
<span class="lineno"></span><span class="op" id="5381373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5381376">//&nbsp;appendClass&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno">1720</span><span class="comment" id="5381451">//&nbsp;It&nbsp;assume&nbsp;x&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="5381476">func</span>&nbsp;<span class="ident" id="5381481">appendClass</span><span class="op" id="5381492">(</span><span class="ident" id="5381493">r</span>&nbsp;<span class="op" id="5381495">[</span><span class="op" id="5381496">]</span><span class="builtintype" id="5381497">rune</span><span class="op" id="5381501">,</span>&nbsp;<span class="ident" id="5381503">x</span>&nbsp;<span class="op" id="5381505">[</span><span class="op" id="5381506">]</span><span class="builtintype" id="5381507">rune</span><span class="op" id="5381511">)</span>&nbsp;<span class="op" id="5381513">[</span><span class="op" id="5381514">]</span><span class="builtintype" id="5381515">rune</span>&nbsp;<span class="op" id="5381520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381523">for</span>&nbsp;<span class="ident" id="5381527">i</span>&nbsp;<span class="op" id="5381529">:=</span>&nbsp;<span class="num" id="5381532">0</span><span class="op" id="5381533">;</span>&nbsp;<span class="ident" id="5381535">i</span>&nbsp;<span class="op" id="5381537">&lt;</span>&nbsp;<span class="builtinfunc" id="5381539">len</span><span class="op" id="5381542">(</span><span class="ident" id="5381543">x</span><span class="op" id="5381544">)</span><span class="op" id="5381545">;</span>&nbsp;<span class="ident" id="5381547">i</span>&nbsp;<span class="op" id="5381549">+=</span>&nbsp;<span class="num" id="5381552">2</span>&nbsp;<span class="op" id="5381554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381558">r</span>&nbsp;<span class="op" id="5381560">=</span>&nbsp;<span class="ident" id="5381562">appendRange</span><span class="op" id="5381573">(</span><span class="ident" id="5381574">r</span><span class="op" id="5381575">,</span>&nbsp;<span class="ident" id="5381577">x</span><span class="op" id="5381578">[</span><span class="ident" id="5381579">i</span><span class="op" id="5381580">]</span><span class="op" id="5381581">,</span>&nbsp;<span class="ident" id="5381583">x</span><span class="op" id="5381584">[</span><span class="ident" id="5381585">i</span><span class="op" id="5381586">+</span><span class="num" id="5381587">1</span><span class="op" id="5381588">]</span><span class="op" id="5381589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5381592">}</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381595">return</span>&nbsp;<span class="ident" id="5381602">r</span><br>
<span class="lineno"></span><span class="op" id="5381604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5381607">//&nbsp;appendFolded&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;case&nbsp;folding&nbsp;of&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5381703">func</span>&nbsp;<span class="ident" id="5381708">appendFoldedClass</span><span class="op" id="5381725">(</span><span class="ident" id="5381726">r</span>&nbsp;<span class="op" id="5381728">[</span><span class="op" id="5381729">]</span><span class="builtintype" id="5381730">rune</span><span class="op" id="5381734">,</span>&nbsp;<span class="ident" id="5381736">x</span>&nbsp;<span class="op" id="5381738">[</span><span class="op" id="5381739">]</span><span class="builtintype" id="5381740">rune</span><span class="op" id="5381744">)</span>&nbsp;<span class="op" id="5381746">[</span><span class="op" id="5381747">]</span><span class="builtintype" id="5381748">rune</span>&nbsp;<span class="op" id="5381753">{</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381756">for</span>&nbsp;<span class="ident" id="5381760">i</span>&nbsp;<span class="op" id="5381762">:=</span>&nbsp;<span class="num" id="5381765">0</span><span class="op" id="5381766">;</span>&nbsp;<span class="ident" id="5381768">i</span>&nbsp;<span class="op" id="5381770">&lt;</span>&nbsp;<span class="builtinfunc" id="5381772">len</span><span class="op" id="5381775">(</span><span class="ident" id="5381776">x</span><span class="op" id="5381777">)</span><span class="op" id="5381778">;</span>&nbsp;<span class="ident" id="5381780">i</span>&nbsp;<span class="op" id="5381782">+=</span>&nbsp;<span class="num" id="5381785">2</span>&nbsp;<span class="op" id="5381787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5381791">r</span>&nbsp;<span class="op" id="5381793">=</span>&nbsp;<span class="ident" id="5381795">appendFoldedRange</span><span class="op" id="5381812">(</span><span class="ident" id="5381813">r</span><span class="op" id="5381814">,</span>&nbsp;<span class="ident" id="5381816">x</span><span class="op" id="5381817">[</span><span class="ident" id="5381818">i</span><span class="op" id="5381819">]</span><span class="op" id="5381820">,</span>&nbsp;<span class="ident" id="5381822">x</span><span class="op" id="5381823">[</span><span class="ident" id="5381824">i</span><span class="op" id="5381825">+</span><span class="num" id="5381826">1</span><span class="op" id="5381827">]</span><span class="op" id="5381828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5381831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5381834">return</span>&nbsp;<span class="ident" id="5381841">r</span><br>
<span class="lineno"></span><span class="op" id="5381843">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span><span class="comment" id="5381846">//&nbsp;appendNegatedClass&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;negation&nbsp;of&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5381944">//&nbsp;It&nbsp;assumes&nbsp;x&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="5381970">func</span>&nbsp;<span class="ident" id="5381975">appendNegatedClass</span><span class="op" id="5381993">(</span><span class="ident" id="5381994">r</span>&nbsp;<span class="op" id="5381996">[</span><span class="op" id="5381997">]</span><span class="builtintype" id="5381998">rune</span><span class="op" id="5382002">,</span>&nbsp;<span class="ident" id="5382004">x</span>&nbsp;<span class="op" id="5382006">[</span><span class="op" id="5382007">]</span><span class="builtintype" id="5382008">rune</span><span class="op" id="5382012">)</span>&nbsp;<span class="op" id="5382014">[</span><span class="op" id="5382015">]</span><span class="builtintype" id="5382016">rune</span>&nbsp;<span class="op" id="5382021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382024">nextLo</span>&nbsp;<span class="op" id="5382031">:=</span>&nbsp;<span class="string" id="5382034">&#39;\u0000&#39;</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382044">for</span>&nbsp;<span class="ident" id="5382048">i</span>&nbsp;<span class="op" id="5382050">:=</span>&nbsp;<span class="num" id="5382053">0</span><span class="op" id="5382054">;</span>&nbsp;<span class="ident" id="5382056">i</span>&nbsp;<span class="op" id="5382058">&lt;</span>&nbsp;<span class="builtinfunc" id="5382060">len</span><span class="op" id="5382063">(</span><span class="ident" id="5382064">x</span><span class="op" id="5382065">)</span><span class="op" id="5382066">;</span>&nbsp;<span class="ident" id="5382068">i</span>&nbsp;<span class="op" id="5382070">+=</span>&nbsp;<span class="num" id="5382073">2</span>&nbsp;<span class="op" id="5382075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382079">lo</span><span class="op" id="5382081">,</span>&nbsp;<span class="ident" id="5382083">hi</span>&nbsp;<span class="op" id="5382086">:=</span>&nbsp;<span class="ident" id="5382089">x</span><span class="op" id="5382090">[</span><span class="ident" id="5382091">i</span><span class="op" id="5382092">]</span><span class="op" id="5382093">,</span>&nbsp;<span class="ident" id="5382095">x</span><span class="op" id="5382096">[</span><span class="ident" id="5382097">i</span><span class="op" id="5382098">+</span><span class="num" id="5382099">1</span><span class="op" id="5382100">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382104">if</span>&nbsp;<span class="ident" id="5382107">nextLo</span>&nbsp;<span class="op" id="5382114">&lt;=</span>&nbsp;<span class="ident" id="5382117">lo</span><span class="op" id="5382119">-</span><span class="num" id="5382120">1</span>&nbsp;<span class="op" id="5382122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382127">r</span>&nbsp;<span class="op" id="5382129">=</span>&nbsp;<span class="ident" id="5382131">appendRange</span><span class="op" id="5382142">(</span><span class="ident" id="5382143">r</span><span class="op" id="5382144">,</span>&nbsp;<span class="ident" id="5382146">nextLo</span><span class="op" id="5382152">,</span>&nbsp;<span class="ident" id="5382154">lo</span><span class="op" id="5382156">-</span><span class="num" id="5382157">1</span><span class="op" id="5382158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382162">}</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382166">nextLo</span>&nbsp;<span class="op" id="5382173">=</span>&nbsp;<span class="ident" id="5382175">hi</span>&nbsp;<span class="op" id="5382178">+</span>&nbsp;<span class="num" id="5382180">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382186">if</span>&nbsp;<span class="ident" id="5382189">nextLo</span>&nbsp;<span class="op" id="5382196">&lt;=</span>&nbsp;<span class="ident" id="5382199">unicode</span><span class="op" id="5382206">.</span><span class="ident" id="5382207">MaxRune</span>&nbsp;<span class="op" id="5382215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382219">r</span>&nbsp;<span class="op" id="5382221">=</span>&nbsp;<span class="ident" id="5382223">appendRange</span><span class="op" id="5382234">(</span><span class="ident" id="5382235">r</span><span class="op" id="5382236">,</span>&nbsp;<span class="ident" id="5382238">nextLo</span><span class="op" id="5382244">,</span>&nbsp;<span class="ident" id="5382246">unicode</span><span class="op" id="5382253">.</span><span class="ident" id="5382254">MaxRune</span><span class="op" id="5382261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382264">}</span><br>
<span class="lineno">1750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382267">return</span>&nbsp;<span class="ident" id="5382274">r</span><br>
<span class="lineno"></span><span class="op" id="5382276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5382279">//&nbsp;appendTable&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5382344">func</span>&nbsp;<span class="ident" id="5382349">appendTable</span><span class="op" id="5382360">(</span><span class="ident" id="5382361">r</span>&nbsp;<span class="op" id="5382363">[</span><span class="op" id="5382364">]</span><span class="builtintype" id="5382365">rune</span><span class="op" id="5382369">,</span>&nbsp;<span class="ident" id="5382371">x</span>&nbsp;<span class="op" id="5382373">*</span><span class="ident" id="5382374">unicode</span><span class="op" id="5382381">.</span><span class="ident" id="5382382">RangeTable</span><span class="op" id="5382392">)</span>&nbsp;<span class="op" id="5382394">[</span><span class="op" id="5382395">]</span><span class="builtintype" id="5382396">rune</span>&nbsp;<span class="op" id="5382401">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382404">for</span>&nbsp;<span class="ident" id="5382408">_</span><span class="op" id="5382409">,</span>&nbsp;<span class="ident" id="5382411">xr</span>&nbsp;<span class="op" id="5382414">:=</span>&nbsp;<span class="keyword" id="5382417">range</span>&nbsp;<span class="ident" id="5382423">x</span><span class="op" id="5382424">.</span><span class="ident" id="5382425">R16</span>&nbsp;<span class="op" id="5382429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382433">lo</span><span class="op" id="5382435">,</span>&nbsp;<span class="ident" id="5382437">hi</span><span class="op" id="5382439">,</span>&nbsp;<span class="ident" id="5382441">stride</span>&nbsp;<span class="op" id="5382448">:=</span>&nbsp;<span class="builtintype" id="5382451">rune</span><span class="op" id="5382455">(</span><span class="ident" id="5382456">xr</span><span class="op" id="5382458">.</span><span class="ident" id="5382459">Lo</span><span class="op" id="5382461">)</span><span class="op" id="5382462">,</span>&nbsp;<span class="builtintype" id="5382464">rune</span><span class="op" id="5382468">(</span><span class="ident" id="5382469">xr</span><span class="op" id="5382471">.</span><span class="ident" id="5382472">Hi</span><span class="op" id="5382474">)</span><span class="op" id="5382475">,</span>&nbsp;<span class="builtintype" id="5382477">rune</span><span class="op" id="5382481">(</span><span class="ident" id="5382482">xr</span><span class="op" id="5382484">.</span><span class="ident" id="5382485">Stride</span><span class="op" id="5382491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382495">if</span>&nbsp;<span class="ident" id="5382498">stride</span>&nbsp;<span class="op" id="5382505">==</span>&nbsp;<span class="num" id="5382508">1</span>&nbsp;<span class="op" id="5382510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382515">r</span>&nbsp;<span class="op" id="5382517">=</span>&nbsp;<span class="ident" id="5382519">appendRange</span><span class="op" id="5382530">(</span><span class="ident" id="5382531">r</span><span class="op" id="5382532">,</span>&nbsp;<span class="ident" id="5382534">lo</span><span class="op" id="5382536">,</span>&nbsp;<span class="ident" id="5382538">hi</span><span class="op" id="5382540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382545">continue</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382560">for</span>&nbsp;<span class="ident" id="5382564">c</span>&nbsp;<span class="op" id="5382566">:=</span>&nbsp;<span class="ident" id="5382569">lo</span><span class="op" id="5382571">;</span>&nbsp;<span class="ident" id="5382573">c</span>&nbsp;<span class="op" id="5382575">&lt;=</span>&nbsp;<span class="ident" id="5382578">hi</span><span class="op" id="5382580">;</span>&nbsp;<span class="ident" id="5382582">c</span>&nbsp;<span class="op" id="5382584">+=</span>&nbsp;<span class="ident" id="5382587">stride</span>&nbsp;<span class="op" id="5382594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382599">r</span>&nbsp;<span class="op" id="5382601">=</span>&nbsp;<span class="ident" id="5382603">appendRange</span><span class="op" id="5382614">(</span><span class="ident" id="5382615">r</span><span class="op" id="5382616">,</span>&nbsp;<span class="ident" id="5382618">c</span><span class="op" id="5382619">,</span>&nbsp;<span class="ident" id="5382621">c</span><span class="op" id="5382622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382629">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382632">for</span>&nbsp;<span class="ident" id="5382636">_</span><span class="op" id="5382637">,</span>&nbsp;<span class="ident" id="5382639">xr</span>&nbsp;<span class="op" id="5382642">:=</span>&nbsp;<span class="keyword" id="5382645">range</span>&nbsp;<span class="ident" id="5382651">x</span><span class="op" id="5382652">.</span><span class="ident" id="5382653">R32</span>&nbsp;<span class="op" id="5382657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382661">lo</span><span class="op" id="5382663">,</span>&nbsp;<span class="ident" id="5382665">hi</span><span class="op" id="5382667">,</span>&nbsp;<span class="ident" id="5382669">stride</span>&nbsp;<span class="op" id="5382676">:=</span>&nbsp;<span class="builtintype" id="5382679">rune</span><span class="op" id="5382683">(</span><span class="ident" id="5382684">xr</span><span class="op" id="5382686">.</span><span class="ident" id="5382687">Lo</span><span class="op" id="5382689">)</span><span class="op" id="5382690">,</span>&nbsp;<span class="builtintype" id="5382692">rune</span><span class="op" id="5382696">(</span><span class="ident" id="5382697">xr</span><span class="op" id="5382699">.</span><span class="ident" id="5382700">Hi</span><span class="op" id="5382702">)</span><span class="op" id="5382703">,</span>&nbsp;<span class="builtintype" id="5382705">rune</span><span class="op" id="5382709">(</span><span class="ident" id="5382710">xr</span><span class="op" id="5382712">.</span><span class="ident" id="5382713">Stride</span><span class="op" id="5382719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382723">if</span>&nbsp;<span class="ident" id="5382726">stride</span>&nbsp;<span class="op" id="5382733">==</span>&nbsp;<span class="num" id="5382736">1</span>&nbsp;<span class="op" id="5382738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382743">r</span>&nbsp;<span class="op" id="5382745">=</span>&nbsp;<span class="ident" id="5382747">appendRange</span><span class="op" id="5382758">(</span><span class="ident" id="5382759">r</span><span class="op" id="5382760">,</span>&nbsp;<span class="ident" id="5382762">lo</span><span class="op" id="5382764">,</span>&nbsp;<span class="ident" id="5382766">hi</span><span class="op" id="5382768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382773">continue</span><br>
<span class="lineno">1770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382788">for</span>&nbsp;<span class="ident" id="5382792">c</span>&nbsp;<span class="op" id="5382794">:=</span>&nbsp;<span class="ident" id="5382797">lo</span><span class="op" id="5382799">;</span>&nbsp;<span class="ident" id="5382801">c</span>&nbsp;<span class="op" id="5382803">&lt;=</span>&nbsp;<span class="ident" id="5382806">hi</span><span class="op" id="5382808">;</span>&nbsp;<span class="ident" id="5382810">c</span>&nbsp;<span class="op" id="5382812">+=</span>&nbsp;<span class="ident" id="5382815">stride</span>&nbsp;<span class="op" id="5382822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5382827">r</span>&nbsp;<span class="op" id="5382829">=</span>&nbsp;<span class="ident" id="5382831">appendRange</span><span class="op" id="5382842">(</span><span class="ident" id="5382843">r</span><span class="op" id="5382844">,</span>&nbsp;<span class="ident" id="5382846">c</span><span class="op" id="5382847">,</span>&nbsp;<span class="ident" id="5382849">c</span><span class="op" id="5382850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5382857">}</span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5382860">return</span>&nbsp;<span class="ident" id="5382867">r</span><br>
<span class="lineno"></span><span class="op" id="5382869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5382872">//&nbsp;appendNegatedTable&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;negation&nbsp;of&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5382960">func</span>&nbsp;<span class="ident" id="5382965">appendNegatedTable</span><span class="op" id="5382983">(</span><span class="ident" id="5382984">r</span>&nbsp;<span class="op" id="5382986">[</span><span class="op" id="5382987">]</span><span class="builtintype" id="5382988">rune</span><span class="op" id="5382992">,</span>&nbsp;<span class="ident" id="5382994">x</span>&nbsp;<span class="op" id="5382996">*</span><span class="ident" id="5382997">unicode</span><span class="op" id="5383004">.</span><span class="ident" id="5383005">RangeTable</span><span class="op" id="5383015">)</span>&nbsp;<span class="op" id="5383017">[</span><span class="op" id="5383018">]</span><span class="builtintype" id="5383019">rune</span>&nbsp;<span class="op" id="5383024">{</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383027">nextLo</span>&nbsp;<span class="op" id="5383034">:=</span>&nbsp;<span class="string" id="5383037">&#39;\u0000&#39;</span>&nbsp;<span class="comment" id="5383046">//&nbsp;lo&nbsp;end&nbsp;of&nbsp;next&nbsp;class&nbsp;to&nbsp;add</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383078">for</span>&nbsp;<span class="ident" id="5383082">_</span><span class="op" id="5383083">,</span>&nbsp;<span class="ident" id="5383085">xr</span>&nbsp;<span class="op" id="5383088">:=</span>&nbsp;<span class="keyword" id="5383091">range</span>&nbsp;<span class="ident" id="5383097">x</span><span class="op" id="5383098">.</span><span class="ident" id="5383099">R16</span>&nbsp;<span class="op" id="5383103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383107">lo</span><span class="op" id="5383109">,</span>&nbsp;<span class="ident" id="5383111">hi</span><span class="op" id="5383113">,</span>&nbsp;<span class="ident" id="5383115">stride</span>&nbsp;<span class="op" id="5383122">:=</span>&nbsp;<span class="builtintype" id="5383125">rune</span><span class="op" id="5383129">(</span><span class="ident" id="5383130">xr</span><span class="op" id="5383132">.</span><span class="ident" id="5383133">Lo</span><span class="op" id="5383135">)</span><span class="op" id="5383136">,</span>&nbsp;<span class="builtintype" id="5383138">rune</span><span class="op" id="5383142">(</span><span class="ident" id="5383143">xr</span><span class="op" id="5383145">.</span><span class="ident" id="5383146">Hi</span><span class="op" id="5383148">)</span><span class="op" id="5383149">,</span>&nbsp;<span class="builtintype" id="5383151">rune</span><span class="op" id="5383155">(</span><span class="ident" id="5383156">xr</span><span class="op" id="5383158">.</span><span class="ident" id="5383159">Stride</span><span class="op" id="5383165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383169">if</span>&nbsp;<span class="ident" id="5383172">stride</span>&nbsp;<span class="op" id="5383179">==</span>&nbsp;<span class="num" id="5383182">1</span>&nbsp;<span class="op" id="5383184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383189">if</span>&nbsp;<span class="ident" id="5383192">nextLo</span>&nbsp;<span class="op" id="5383199">&lt;=</span>&nbsp;<span class="ident" id="5383202">lo</span><span class="op" id="5383204">-</span><span class="num" id="5383205">1</span>&nbsp;<span class="op" id="5383207">{</span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383213">r</span>&nbsp;<span class="op" id="5383215">=</span>&nbsp;<span class="ident" id="5383217">appendRange</span><span class="op" id="5383228">(</span><span class="ident" id="5383229">r</span><span class="op" id="5383230">,</span>&nbsp;<span class="ident" id="5383232">nextLo</span><span class="op" id="5383238">,</span>&nbsp;<span class="ident" id="5383240">lo</span><span class="op" id="5383242">-</span><span class="num" id="5383243">1</span><span class="op" id="5383244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5383249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383254">nextLo</span>&nbsp;<span class="op" id="5383261">=</span>&nbsp;<span class="ident" id="5383263">hi</span>&nbsp;<span class="op" id="5383266">+</span>&nbsp;<span class="num" id="5383268">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383273">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5383284">}</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383288">for</span>&nbsp;<span class="ident" id="5383292">c</span>&nbsp;<span class="op" id="5383294">:=</span>&nbsp;<span class="ident" id="5383297">lo</span><span class="op" id="5383299">;</span>&nbsp;<span class="ident" id="5383301">c</span>&nbsp;<span class="op" id="5383303">&lt;=</span>&nbsp;<span class="ident" id="5383306">hi</span><span class="op" id="5383308">;</span>&nbsp;<span class="ident" id="5383310">c</span>&nbsp;<span class="op" id="5383312">+=</span>&nbsp;<span class="ident" id="5383315">stride</span>&nbsp;<span class="op" id="5383322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383327">if</span>&nbsp;<span class="ident" id="5383330">nextLo</span>&nbsp;<span class="op" id="5383337">&lt;=</span>&nbsp;<span class="ident" id="5383340">c</span><span class="op" id="5383341">-</span><span class="num" id="5383342">1</span>&nbsp;<span class="op" id="5383344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383350">r</span>&nbsp;<span class="op" id="5383352">=</span>&nbsp;<span class="ident" id="5383354">appendRange</span><span class="op" id="5383365">(</span><span class="ident" id="5383366">r</span><span class="op" id="5383367">,</span>&nbsp;<span class="ident" id="5383369">nextLo</span><span class="op" id="5383375">,</span>&nbsp;<span class="ident" id="5383377">c</span><span class="op" id="5383378">-</span><span class="num" id="5383379">1</span><span class="op" id="5383380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5383385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383390">nextLo</span>&nbsp;<span class="op" id="5383397">=</span>&nbsp;<span class="ident" id="5383399">c</span>&nbsp;<span class="op" id="5383401">+</span>&nbsp;<span class="num" id="5383403">1</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5383407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5383410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383413">for</span>&nbsp;<span class="ident" id="5383417">_</span><span class="op" id="5383418">,</span>&nbsp;<span class="ident" id="5383420">xr</span>&nbsp;<span class="op" id="5383423">:=</span>&nbsp;<span class="keyword" id="5383426">range</span>&nbsp;<span class="ident" id="5383432">x</span><span class="op" id="5383433">.</span><span class="ident" id="5383434">R32</span>&nbsp;<span class="op" id="5383438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383442">lo</span><span class="op" id="5383444">,</span>&nbsp;<span class="ident" id="5383446">hi</span><span class="op" id="5383448">,</span>&nbsp;<span class="ident" id="5383450">stride</span>&nbsp;<span class="op" id="5383457">:=</span>&nbsp;<span class="builtintype" id="5383460">rune</span><span class="op" id="5383464">(</span><span class="ident" id="5383465">xr</span><span class="op" id="5383467">.</span><span class="ident" id="5383468">Lo</span><span class="op" id="5383470">)</span><span class="op" id="5383471">,</span>&nbsp;<span class="builtintype" id="5383473">rune</span><span class="op" id="5383477">(</span><span class="ident" id="5383478">xr</span><span class="op" id="5383480">.</span><span class="ident" id="5383481">Hi</span><span class="op" id="5383483">)</span><span class="op" id="5383484">,</span>&nbsp;<span class="builtintype" id="5383486">rune</span><span class="op" id="5383490">(</span><span class="ident" id="5383491">xr</span><span class="op" id="5383493">.</span><span class="ident" id="5383494">Stride</span><span class="op" id="5383500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383504">if</span>&nbsp;<span class="ident" id="5383507">stride</span>&nbsp;<span class="op" id="5383514">==</span>&nbsp;<span class="num" id="5383517">1</span>&nbsp;<span class="op" id="5383519">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383524">if</span>&nbsp;<span class="ident" id="5383527">nextLo</span>&nbsp;<span class="op" id="5383534">&lt;=</span>&nbsp;<span class="ident" id="5383537">lo</span><span class="op" id="5383539">-</span><span class="num" id="5383540">1</span>&nbsp;<span class="op" id="5383542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383548">r</span>&nbsp;<span class="op" id="5383550">=</span>&nbsp;<span class="ident" id="5383552">appendRange</span><span class="op" id="5383563">(</span><span class="ident" id="5383564">r</span><span class="op" id="5383565">,</span>&nbsp;<span class="ident" id="5383567">nextLo</span><span class="op" id="5383573">,</span>&nbsp;<span class="ident" id="5383575">lo</span><span class="op" id="5383577">-</span><span class="num" id="5383578">1</span><span class="op" id="5383579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5383584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383589">nextLo</span>&nbsp;<span class="op" id="5383596">=</span>&nbsp;<span class="ident" id="5383598">hi</span>&nbsp;<span class="op" id="5383601">+</span>&nbsp;<span class="num" id="5383603">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383608">continue</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5383619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383623">for</span>&nbsp;<span class="ident" id="5383627">c</span>&nbsp;<span class="op" id="5383629">:=</span>&nbsp;<span class="ident" id="5383632">lo</span><span class="op" id="5383634">;</span>&nbsp;<span class="ident" id="5383636">c</span>&nbsp;<span class="op" id="5383638">&lt;=</span>&nbsp;<span class="ident" id="5383641">hi</span><span class="op" id="5383643">;</span>&nbsp;<span class="ident" id="5383645">c</span>&nbsp;<span class="op" id="5383647">+=</span>&nbsp;<span class="ident" id="5383650">stride</span>&nbsp;<span class="op" id="5383657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383662">if</span>&nbsp;<span class="ident" id="5383665">nextLo</span>&nbsp;<span class="op" id="5383672">&lt;=</span>&nbsp;<span class="ident" id="5383675">c</span><span class="op" id="5383676">-</span><span class="num" id="5383677">1</span>&nbsp;<span class="op" id="5383679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383685">r</span>&nbsp;<span class="op" id="5383687">=</span>&nbsp;<span class="ident" id="5383689">appendRange</span><span class="op" id="5383700">(</span><span class="ident" id="5383701">r</span><span class="op" id="5383702">,</span>&nbsp;<span class="ident" id="5383704">nextLo</span><span class="op" id="5383710">,</span>&nbsp;<span class="ident" id="5383712">c</span><span class="op" id="5383713">-</span><span class="num" id="5383714">1</span><span class="op" id="5383715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5383720">}</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383725">nextLo</span>&nbsp;<span class="op" id="5383732">=</span>&nbsp;<span class="ident" id="5383734">c</span>&nbsp;<span class="op" id="5383736">+</span>&nbsp;<span class="num" id="5383738">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5383742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5383745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383748">if</span>&nbsp;<span class="ident" id="5383751">nextLo</span>&nbsp;<span class="op" id="5383758">&lt;=</span>&nbsp;<span class="ident" id="5383761">unicode</span><span class="op" id="5383768">.</span><span class="ident" id="5383769">MaxRune</span>&nbsp;<span class="op" id="5383777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383781">r</span>&nbsp;<span class="op" id="5383783">=</span>&nbsp;<span class="ident" id="5383785">appendRange</span><span class="op" id="5383796">(</span><span class="ident" id="5383797">r</span><span class="op" id="5383798">,</span>&nbsp;<span class="ident" id="5383800">nextLo</span><span class="op" id="5383806">,</span>&nbsp;<span class="ident" id="5383808">unicode</span><span class="op" id="5383815">.</span><span class="ident" id="5383816">MaxRune</span><span class="op" id="5383823">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5383826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5383829">return</span>&nbsp;<span class="ident" id="5383836">r</span><br>
<span class="lineno"></span><span class="op" id="5383838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5383841">//&nbsp;negateClass&nbsp;overwrites&nbsp;r&nbsp;and&nbsp;returns&nbsp;r&#39;s&nbsp;negation.</span><br>
<span class="lineno">1820</span><span class="comment" id="5383895">//&nbsp;It&nbsp;assumes&nbsp;the&nbsp;class&nbsp;r&nbsp;is&nbsp;already&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="5383939">func</span>&nbsp;<span class="ident" id="5383944">negateClass</span><span class="op" id="5383955">(</span><span class="ident" id="5383956">r</span>&nbsp;<span class="op" id="5383958">[</span><span class="op" id="5383959">]</span><span class="builtintype" id="5383960">rune</span><span class="op" id="5383964">)</span>&nbsp;<span class="op" id="5383966">[</span><span class="op" id="5383967">]</span><span class="builtintype" id="5383968">rune</span>&nbsp;<span class="op" id="5383973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5383976">nextLo</span>&nbsp;<span class="op" id="5383983">:=</span>&nbsp;<span class="string" id="5383986">&#39;\u0000&#39;</span>&nbsp;<span class="comment" id="5383995">//&nbsp;lo&nbsp;end&nbsp;of&nbsp;next&nbsp;class&nbsp;to&nbsp;add</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384027">w</span>&nbsp;<span class="op" id="5384029">:=</span>&nbsp;<span class="num" id="5384032">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5384046">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5384062">for</span>&nbsp;<span class="ident" id="5384066">i</span>&nbsp;<span class="op" id="5384068">:=</span>&nbsp;<span class="num" id="5384071">0</span><span class="op" id="5384072">;</span>&nbsp;<span class="ident" id="5384074">i</span>&nbsp;<span class="op" id="5384076">&lt;</span>&nbsp;<span class="builtinfunc" id="5384078">len</span><span class="op" id="5384081">(</span><span class="ident" id="5384082">r</span><span class="op" id="5384083">)</span><span class="op" id="5384084">;</span>&nbsp;<span class="ident" id="5384086">i</span>&nbsp;<span class="op" id="5384088">+=</span>&nbsp;<span class="num" id="5384091">2</span>&nbsp;<span class="op" id="5384093">{</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384097">lo</span><span class="op" id="5384099">,</span>&nbsp;<span class="ident" id="5384101">hi</span>&nbsp;<span class="op" id="5384104">:=</span>&nbsp;<span class="ident" id="5384107">r</span><span class="op" id="5384108">[</span><span class="ident" id="5384109">i</span><span class="op" id="5384110">]</span><span class="op" id="5384111">,</span>&nbsp;<span class="ident" id="5384113">r</span><span class="op" id="5384114">[</span><span class="ident" id="5384115">i</span><span class="op" id="5384116">+</span><span class="num" id="5384117">1</span><span class="op" id="5384118">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5384122">if</span>&nbsp;<span class="ident" id="5384125">nextLo</span>&nbsp;<span class="op" id="5384132">&lt;=</span>&nbsp;<span class="ident" id="5384135">lo</span><span class="op" id="5384137">-</span><span class="num" id="5384138">1</span>&nbsp;<span class="op" id="5384140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384145">r</span><span class="op" id="5384146">[</span><span class="ident" id="5384147">w</span><span class="op" id="5384148">]</span>&nbsp;<span class="op" id="5384150">=</span>&nbsp;<span class="ident" id="5384152">nextLo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384162">r</span><span class="op" id="5384163">[</span><span class="ident" id="5384164">w</span><span class="op" id="5384165">+</span><span class="num" id="5384166">1</span><span class="op" id="5384167">]</span>&nbsp;<span class="op" id="5384169">=</span>&nbsp;<span class="ident" id="5384171">lo</span>&nbsp;<span class="op" id="5384174">-</span>&nbsp;<span class="num" id="5384176">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384181">w</span>&nbsp;<span class="op" id="5384183">+=</span>&nbsp;<span class="num" id="5384186">2</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5384190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384194">nextLo</span>&nbsp;<span class="op" id="5384201">=</span>&nbsp;<span class="ident" id="5384203">hi</span>&nbsp;<span class="op" id="5384206">+</span>&nbsp;<span class="num" id="5384208">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5384211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384214">r</span>&nbsp;<span class="op" id="5384216">=</span>&nbsp;<span class="ident" id="5384218">r</span><span class="op" id="5384219">[</span><span class="op" id="5384220">:</span><span class="ident" id="5384221">w</span><span class="op" id="5384222">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5384225">if</span>&nbsp;<span class="ident" id="5384228">nextLo</span>&nbsp;<span class="op" id="5384235">&lt;=</span>&nbsp;<span class="ident" id="5384238">unicode</span><span class="op" id="5384245">.</span><span class="ident" id="5384246">MaxRune</span>&nbsp;<span class="op" id="5384254">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5384258">//&nbsp;It&#39;s&nbsp;possible&nbsp;for&nbsp;the&nbsp;negation&nbsp;to&nbsp;have&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5384311">//&nbsp;range&nbsp;-&nbsp;this&nbsp;one&nbsp;-&nbsp;than&nbsp;the&nbsp;original&nbsp;class,&nbsp;so&nbsp;use&nbsp;append.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384375">r</span>&nbsp;<span class="op" id="5384377">=</span>&nbsp;<span class="builtinfunc" id="5384379">append</span><span class="op" id="5384385">(</span><span class="ident" id="5384386">r</span><span class="op" id="5384387">,</span>&nbsp;<span class="ident" id="5384389">nextLo</span><span class="op" id="5384395">,</span>&nbsp;<span class="ident" id="5384397">unicode</span><span class="op" id="5384404">.</span><span class="ident" id="5384405">MaxRune</span><span class="op" id="5384412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5384415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5384418">return</span>&nbsp;<span class="ident" id="5384425">r</span><br>
<span class="lineno">1840</span><span class="op" id="5384427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5384430">//&nbsp;ranges&nbsp;implements&nbsp;sort.Interface&nbsp;on&nbsp;a&nbsp;[]rune.</span><br>
<span class="lineno"></span><span class="comment" id="5384479">//&nbsp;The&nbsp;choice&nbsp;of&nbsp;receiver&nbsp;type&nbsp;definition&nbsp;is&nbsp;strange</span><br>
<span class="lineno"></span><span class="comment" id="5384532">//&nbsp;but&nbsp;avoids&nbsp;an&nbsp;allocation&nbsp;since&nbsp;we&nbsp;already&nbsp;have</span><br>
<span class="lineno">1845</span><span class="comment" id="5384582">//&nbsp;a&nbsp;*[]rune.</span><br>
<span class="lineno"></span><span class="keyword" id="5384596">type</span>&nbsp;<span class="ident" id="5384601">ranges</span>&nbsp;<span class="keyword" id="5384608">struct</span>&nbsp;<span class="op" id="5384615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384618">p</span>&nbsp;<span class="op" id="5384620">*</span><span class="op" id="5384621">[</span><span class="op" id="5384622">]</span><span class="builtintype" id="5384623">rune</span><br>
<span class="lineno"></span><span class="op" id="5384628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1850</span><span class="keyword" id="5384631">func</span>&nbsp;<span class="op" id="5384636">(</span><span class="ident" id="5384637">ra</span>&nbsp;<span class="ident" id="5384640">ranges</span><span class="op" id="5384646">)</span>&nbsp;<span class="ident" id="5384648">Less</span><span class="op" id="5384652">(</span><span class="ident" id="5384653">i</span><span class="op" id="5384654">,</span>&nbsp;<span class="ident" id="5384656">j</span>&nbsp;<span class="builtintype" id="5384658">int</span><span class="op" id="5384661">)</span>&nbsp;<span class="builtintype" id="5384663">bool</span>&nbsp;<span class="op" id="5384668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384671">p</span>&nbsp;<span class="op" id="5384673">:=</span>&nbsp;<span class="op" id="5384676">*</span><span class="ident" id="5384677">ra</span><span class="op" id="5384679">.</span><span class="ident" id="5384680">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384683">i</span>&nbsp;<span class="op" id="5384685">*=</span>&nbsp;<span class="num" id="5384688">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384691">j</span>&nbsp;<span class="op" id="5384693">*=</span>&nbsp;<span class="num" id="5384696">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5384699">return</span>&nbsp;<span class="ident" id="5384706">p</span><span class="op" id="5384707">[</span><span class="ident" id="5384708">i</span><span class="op" id="5384709">]</span>&nbsp;<span class="op" id="5384711">&lt;</span>&nbsp;<span class="ident" id="5384713">p</span><span class="op" id="5384714">[</span><span class="ident" id="5384715">j</span><span class="op" id="5384716">]</span>&nbsp;<span class="op" id="5384718">||</span>&nbsp;<span class="ident" id="5384721">p</span><span class="op" id="5384722">[</span><span class="ident" id="5384723">i</span><span class="op" id="5384724">]</span>&nbsp;<span class="op" id="5384726">==</span>&nbsp;<span class="ident" id="5384729">p</span><span class="op" id="5384730">[</span><span class="ident" id="5384731">j</span><span class="op" id="5384732">]</span>&nbsp;<span class="op" id="5384734">&amp;&amp;</span>&nbsp;<span class="ident" id="5384737">p</span><span class="op" id="5384738">[</span><span class="ident" id="5384739">i</span><span class="op" id="5384740">+</span><span class="num" id="5384741">1</span><span class="op" id="5384742">]</span>&nbsp;<span class="op" id="5384744">&gt;</span>&nbsp;<span class="ident" id="5384746">p</span><span class="op" id="5384747">[</span><span class="ident" id="5384748">j</span><span class="op" id="5384749">+</span><span class="num" id="5384750">1</span><span class="op" id="5384751">]</span><br>
<span class="lineno">1855</span><span class="op" id="5384753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5384756">func</span>&nbsp;<span class="op" id="5384761">(</span><span class="ident" id="5384762">ra</span>&nbsp;<span class="ident" id="5384765">ranges</span><span class="op" id="5384771">)</span>&nbsp;<span class="ident" id="5384773">Len</span><span class="op" id="5384776">(</span><span class="op" id="5384777">)</span>&nbsp;<span class="builtintype" id="5384779">int</span>&nbsp;<span class="op" id="5384783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5384786">return</span>&nbsp;<span class="builtinfunc" id="5384793">len</span><span class="op" id="5384796">(</span><span class="op" id="5384797">*</span><span class="ident" id="5384798">ra</span><span class="op" id="5384800">.</span><span class="ident" id="5384801">p</span><span class="op" id="5384802">)</span>&nbsp;<span class="op" id="5384804">/</span>&nbsp;<span class="num" id="5384806">2</span><br>
<span class="lineno"></span><span class="op" id="5384808">}</span><br>
<span class="lineno">1860</span><br>
<span class="lineno"></span><span class="keyword" id="5384811">func</span>&nbsp;<span class="op" id="5384816">(</span><span class="ident" id="5384817">ra</span>&nbsp;<span class="ident" id="5384820">ranges</span><span class="op" id="5384826">)</span>&nbsp;<span class="ident" id="5384828">Swap</span><span class="op" id="5384832">(</span><span class="ident" id="5384833">i</span><span class="op" id="5384834">,</span>&nbsp;<span class="ident" id="5384836">j</span>&nbsp;<span class="builtintype" id="5384838">int</span><span class="op" id="5384841">)</span>&nbsp;<span class="op" id="5384843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384846">p</span>&nbsp;<span class="op" id="5384848">:=</span>&nbsp;<span class="op" id="5384851">*</span><span class="ident" id="5384852">ra</span><span class="op" id="5384854">.</span><span class="ident" id="5384855">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384858">i</span>&nbsp;<span class="op" id="5384860">*=</span>&nbsp;<span class="num" id="5384863">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384866">j</span>&nbsp;<span class="op" id="5384868">*=</span>&nbsp;<span class="num" id="5384871">2</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5384874">p</span><span class="op" id="5384875">[</span><span class="ident" id="5384876">i</span><span class="op" id="5384877">]</span><span class="op" id="5384878">,</span>&nbsp;<span class="ident" id="5384880">p</span><span class="op" id="5384881">[</span><span class="ident" id="5384882">i</span><span class="op" id="5384883">+</span><span class="num" id="5384884">1</span><span class="op" id="5384885">]</span><span class="op" id="5384886">,</span>&nbsp;<span class="ident" id="5384888">p</span><span class="op" id="5384889">[</span><span class="ident" id="5384890">j</span><span class="op" id="5384891">]</span><span class="op" id="5384892">,</span>&nbsp;<span class="ident" id="5384894">p</span><span class="op" id="5384895">[</span><span class="ident" id="5384896">j</span><span class="op" id="5384897">+</span><span class="num" id="5384898">1</span><span class="op" id="5384899">]</span>&nbsp;<span class="op" id="5384901">=</span>&nbsp;<span class="ident" id="5384903">p</span><span class="op" id="5384904">[</span><span class="ident" id="5384905">j</span><span class="op" id="5384906">]</span><span class="op" id="5384907">,</span>&nbsp;<span class="ident" id="5384909">p</span><span class="op" id="5384910">[</span><span class="ident" id="5384911">j</span><span class="op" id="5384912">+</span><span class="num" id="5384913">1</span><span class="op" id="5384914">]</span><span class="op" id="5384915">,</span>&nbsp;<span class="ident" id="5384917">p</span><span class="op" id="5384918">[</span><span class="ident" id="5384919">i</span><span class="op" id="5384920">]</span><span class="op" id="5384921">,</span>&nbsp;<span class="ident" id="5384923">p</span><span class="op" id="5384924">[</span><span class="ident" id="5384925">i</span><span class="op" id="5384926">+</span><span class="num" id="5384927">1</span><span class="op" id="5384928">]</span><br>
<span class="lineno"></span><span class="op" id="5384930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5384933">func</span>&nbsp;<span class="ident" id="5384938">checkUTF8</span><span class="op" id="5384947">(</span><span class="ident" id="5384948">s</span>&nbsp;<span class="builtintype" id="5384950">string</span><span class="op" id="5384956">)</span>&nbsp;<span class="builtintype" id="5384958">error</span>&nbsp;<span class="op" id="5384964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5384967">for</span>&nbsp;<span class="ident" id="5384971">s</span>&nbsp;<span class="op" id="5384973">!=</span>&nbsp;<span class="string" id="5384976">&#34;&#34;</span>&nbsp;<span class="op" id="5384979">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5384983">rune</span><span class="op" id="5384987">,</span>&nbsp;<span class="ident" id="5384989">size</span>&nbsp;<span class="op" id="5384994">:=</span>&nbsp;<span class="ident" id="5384997">utf8</span><span class="op" id="5385001">.</span><span class="ident" id="5385002">DecodeRuneInString</span><span class="op" id="5385020">(</span><span class="ident" id="5385021">s</span><span class="op" id="5385022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5385026">if</span>&nbsp;<span class="builtintype" id="5385029">rune</span>&nbsp;<span class="op" id="5385034">==</span>&nbsp;<span class="ident" id="5385037">utf8</span><span class="op" id="5385041">.</span><span class="ident" id="5385042">RuneError</span>&nbsp;<span class="op" id="5385052">&amp;&amp;</span>&nbsp;<span class="ident" id="5385055">size</span>&nbsp;<span class="op" id="5385060">==</span>&nbsp;<span class="num" id="5385063">1</span>&nbsp;<span class="op" id="5385065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5385070">return</span>&nbsp;<span class="op" id="5385077">&amp;</span><span class="ident" id="5385078">Error</span><span class="op" id="5385083">{</span><span class="ident" id="5385084">Code</span><span class="op" id="5385088">:</span>&nbsp;<span class="ident" id="5385090">ErrInvalidUTF8</span><span class="op" id="5385104">,</span>&nbsp;<span class="ident" id="5385106">Expr</span><span class="op" id="5385110">:</span>&nbsp;<span class="ident" id="5385112">s</span><span class="op" id="5385113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5385117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5385121">s</span>&nbsp;<span class="op" id="5385123">=</span>&nbsp;<span class="ident" id="5385125">s</span><span class="op" id="5385126">[</span><span class="ident" id="5385127">size</span><span class="op" id="5385131">:</span><span class="op" id="5385132">]</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5385135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5385138">return</span>&nbsp;<span class="builtintype" id="5385145">nil</span><br>
<span class="lineno"></span><span class="op" id="5385149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5385152">func</span>&nbsp;<span class="ident" id="5385157">nextRune</span><span class="op" id="5385165">(</span><span class="ident" id="5385166">s</span>&nbsp;<span class="builtintype" id="5385168">string</span><span class="op" id="5385174">)</span>&nbsp;<span class="op" id="5385176">(</span><span class="ident" id="5385177">c</span>&nbsp;<span class="builtintype" id="5385179">rune</span><span class="op" id="5385183">,</span>&nbsp;<span class="ident" id="5385185">t</span>&nbsp;<span class="builtintype" id="5385187">string</span><span class="op" id="5385193">,</span>&nbsp;<span class="ident" id="5385195">err</span>&nbsp;<span class="builtintype" id="5385199">error</span><span class="op" id="5385204">)</span>&nbsp;<span class="op" id="5385206">{</span><br>
<span class="lineno">1880</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5385209">c</span><span class="op" id="5385210">,</span>&nbsp;<span class="ident" id="5385212">size</span>&nbsp;<span class="op" id="5385217">:=</span>&nbsp;<span class="ident" id="5385220">utf8</span><span class="op" id="5385224">.</span><span class="ident" id="5385225">DecodeRuneInString</span><span class="op" id="5385243">(</span><span class="ident" id="5385244">s</span><span class="op" id="5385245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5385248">if</span>&nbsp;<span class="ident" id="5385251">c</span>&nbsp;<span class="op" id="5385253">==</span>&nbsp;<span class="ident" id="5385256">utf8</span><span class="op" id="5385260">.</span><span class="ident" id="5385261">RuneError</span>&nbsp;<span class="op" id="5385271">&amp;&amp;</span>&nbsp;<span class="ident" id="5385274">size</span>&nbsp;<span class="op" id="5385279">==</span>&nbsp;<span class="num" id="5385282">1</span>&nbsp;<span class="op" id="5385284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5385288">return</span>&nbsp;<span class="num" id="5385295">0</span><span class="op" id="5385296">,</span>&nbsp;<span class="string" id="5385298">&#34;&#34;</span><span class="op" id="5385300">,</span>&nbsp;<span class="op" id="5385302">&amp;</span><span class="ident" id="5385303">Error</span><span class="op" id="5385308">{</span><span class="ident" id="5385309">Code</span><span class="op" id="5385313">:</span>&nbsp;<span class="ident" id="5385315">ErrInvalidUTF8</span><span class="op" id="5385329">,</span>&nbsp;<span class="ident" id="5385331">Expr</span><span class="op" id="5385335">:</span>&nbsp;<span class="ident" id="5385337">s</span><span class="op" id="5385338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5385341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5385344">return</span>&nbsp;<span class="ident" id="5385351">c</span><span class="op" id="5385352">,</span>&nbsp;<span class="ident" id="5385354">s</span><span class="op" id="5385355">[</span><span class="ident" id="5385356">size</span><span class="op" id="5385360">:</span><span class="op" id="5385361">]</span><span class="op" id="5385362">,</span>&nbsp;<span class="builtintype" id="5385364">nil</span><br>
<span class="lineno">1885</span><span class="op" id="5385368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5385371">func</span>&nbsp;<span class="ident" id="5385376">isalnum</span><span class="op" id="5385383">(</span><span class="ident" id="5385384">c</span>&nbsp;<span class="builtintype" id="5385386">rune</span><span class="op" id="5385390">)</span>&nbsp;<span class="builtintype" id="5385392">bool</span>&nbsp;<span class="op" id="5385397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5385400">return</span>&nbsp;<span class="string" id="5385407">&#39;0&#39;</span>&nbsp;<span class="op" id="5385411">&lt;=</span>&nbsp;<span class="ident" id="5385414">c</span>&nbsp;<span class="op" id="5385416">&amp;&amp;</span>&nbsp;<span class="ident" id="5385419">c</span>&nbsp;<span class="op" id="5385421">&lt;=</span>&nbsp;<span class="string" id="5385424">&#39;9&#39;</span>&nbsp;<span class="op" id="5385428">||</span>&nbsp;<span class="string" id="5385431">&#39;A&#39;</span>&nbsp;<span class="op" id="5385435">&lt;=</span>&nbsp;<span class="ident" id="5385438">c</span>&nbsp;<span class="op" id="5385440">&amp;&amp;</span>&nbsp;<span class="ident" id="5385443">c</span>&nbsp;<span class="op" id="5385445">&lt;=</span>&nbsp;<span class="string" id="5385448">&#39;Z&#39;</span>&nbsp;<span class="op" id="5385452">||</span>&nbsp;<span class="string" id="5385455">&#39;a&#39;</span>&nbsp;<span class="op" id="5385459">&lt;=</span>&nbsp;<span class="ident" id="5385462">c</span>&nbsp;<span class="op" id="5385464">&amp;&amp;</span>&nbsp;<span class="ident" id="5385467">c</span>&nbsp;<span class="op" id="5385469">&lt;=</span>&nbsp;<span class="string" id="5385472">&#39;z&#39;</span><br>
<span class="lineno"></span><span class="op" id="5385476">}</span><br>
<span class="lineno">1890</span><br>
<span class="lineno"></span><span class="keyword" id="5385479">func</span>&nbsp;<span class="ident" id="5385484">unhex</span><span class="op" id="5385489">(</span><span class="ident" id="5385490">c</span>&nbsp;<span class="builtintype" id="5385492">rune</span><span class="op" id="5385496">)</span>&nbsp;<span class="builtintype" id="5385498">rune</span>&nbsp;<span class="op" id="5385503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5385506">if</span>&nbsp;<span class="string" id="5385509">&#39;0&#39;</span>&nbsp;<span class="op" id="5385513">&lt;=</span>&nbsp;<span class="ident" id="5385516">c</span>&nbsp;<span class="op" id="5385518">&amp;&amp;</span>&nbsp;<span class="ident" id="5385521">c</span>&nbsp;<span class="op" id="5385523">&lt;=</span>&nbsp;<span class="string" id="5385526">&#39;9&#39;</span>&nbsp;<span class="op" id="5385530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5385534">return</span>&nbsp;<span class="ident" id="5385541">c</span>&nbsp;<span class="op" id="5385543">-</span>&nbsp;<span class="string" id="5385545">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5385550">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5385553">if</span>&nbsp;<span class="string" id="5385556">&#39;a&#39;</span>&nbsp;<span class="op" id="5385560">&lt;=</span>&nbsp;<span class="ident" id="5385563">c</span>&nbsp;<span class="op" id="5385565">&amp;&amp;</span>&nbsp;<span class="ident" id="5385568">c</span>&nbsp;<span class="op" id="5385570">&lt;=</span>&nbsp;<span class="string" id="5385573">&#39;f&#39;</span>&nbsp;<span class="op" id="5385577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5385581">return</span>&nbsp;<span class="ident" id="5385588">c</span>&nbsp;<span class="op" id="5385590">-</span>&nbsp;<span class="string" id="5385592">&#39;a&#39;</span>&nbsp;<span class="op" id="5385596">+</span>&nbsp;<span class="num" id="5385598">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5385602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5385605">if</span>&nbsp;<span class="string" id="5385608">&#39;A&#39;</span>&nbsp;<span class="op" id="5385612">&lt;=</span>&nbsp;<span class="ident" id="5385615">c</span>&nbsp;<span class="op" id="5385617">&amp;&amp;</span>&nbsp;<span class="ident" id="5385620">c</span>&nbsp;<span class="op" id="5385622">&lt;=</span>&nbsp;<span class="string" id="5385625">&#39;F&#39;</span>&nbsp;<span class="op" id="5385629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5385633">return</span>&nbsp;<span class="ident" id="5385640">c</span>&nbsp;<span class="op" id="5385642">-</span>&nbsp;<span class="string" id="5385644">&#39;A&#39;</span>&nbsp;<span class="op" id="5385648">+</span>&nbsp;<span class="num" id="5385650">10</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5385654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5385657">return</span>&nbsp;<span class="op" id="5385664">-</span><span class="num" id="5385665">1</span><br>
<span class="lineno"></span><span class="op" id="5385667">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
