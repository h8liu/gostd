<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3490004">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3490059">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3490113">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3490164">//&nbsp;HTTP&nbsp;client&nbsp;implementation.&nbsp;See&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="3490209">//</span><br>
<span class="lineno"></span><span class="comment" id="3490212">//&nbsp;This&nbsp;is&nbsp;the&nbsp;low-level&nbsp;Transport&nbsp;implementation&nbsp;of&nbsp;RoundTripper.</span><br>
<span class="lineno"></span><span class="comment" id="3490279">//&nbsp;The&nbsp;high-level&nbsp;interface&nbsp;is&nbsp;in&nbsp;client.go.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3490325">package</span>&nbsp;<span class="ident" id="3490333">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3490339">import</span>&nbsp;<span class="op" id="3490346">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3490349">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3490358">&#34;compress/gzip&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3490375">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3490389">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3490399">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3490406">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3490412">&#34;log&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3490419">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3490426">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3490437">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3490443">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3490454">&#34;sync&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3490462">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3490469">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3490472">//&nbsp;DefaultTransport&nbsp;is&nbsp;the&nbsp;default&nbsp;implementation&nbsp;of&nbsp;Transport&nbsp;and&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3490542">//&nbsp;used&nbsp;by&nbsp;DefaultClient.&nbsp;It&nbsp;establishes&nbsp;network&nbsp;connections&nbsp;as&nbsp;needed</span><br>
<span class="lineno">30</span><span class="comment" id="3490613">//&nbsp;and&nbsp;caches&nbsp;them&nbsp;for&nbsp;reuse&nbsp;by&nbsp;subsequent&nbsp;calls.&nbsp;It&nbsp;uses&nbsp;HTTP&nbsp;proxies</span><br>
<span class="lineno"></span><span class="comment" id="3490684">//&nbsp;as&nbsp;directed&nbsp;by&nbsp;the&nbsp;$HTTP_PROXY&nbsp;and&nbsp;$NO_PROXY&nbsp;(or&nbsp;$http_proxy&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3490752">//&nbsp;$no_proxy)&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><span class="keyword" id="3490789">var</span>&nbsp;<span class="ident" id="3490793">DefaultTransport</span>&nbsp;<span class="ident" id="3490810"><a href="/net/http/client.go.html#3313167">RoundTripper</a></span>&nbsp;<span class="op" id="3490823">=</span>&nbsp;<span class="op" id="3490825">&amp;</span><span class="ident" id="3490826"><a href="/net/http/transport.go.html#3491333">Transport</a></span><span class="op" id="3490835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3490838">Proxy</span><span class="op" id="3490843">:</span>&nbsp;<span class="ident" id="3490845"><a href="/net/http/transport.go.html#3494814">ProxyFromEnvironment</a></span><span class="op" id="3490865">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3490868">Dial</span><span class="op" id="3490872">:</span>&nbsp;<span class="op" id="3490874">(</span><span class="op" id="3490875">&amp;</span><span class="ident" id="3490876"><a href="/net/http/transport.go.html#3490419">net</a></span><span class="op" id="3490879">.</span><span class="ident" id="3490880">Dialer</span><span class="op" id="3490886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3490890">Timeout</span><span class="op" id="3490897">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="3490901">30</span>&nbsp;<span class="op" id="3490904">*</span>&nbsp;<span class="ident" id="3490906"><a href="/net/http/transport.go.html#3490462">time</a></span><span class="op" id="3490910">.</span><span class="ident" id="3490911">Second</span><span class="op" id="3490917">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3490921">KeepAlive</span><span class="op" id="3490930">:</span>&nbsp;<span class="num" id="3490932">30</span>&nbsp;<span class="op" id="3490935">*</span>&nbsp;<span class="ident" id="3490937"><a href="/net/http/transport.go.html#3490462">time</a></span><span class="op" id="3490941">.</span><span class="ident" id="3490942">Second</span><span class="op" id="3490948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3490951">}</span><span class="op" id="3490952">)</span><span class="op" id="3490953">.</span><span class="ident" id="3490954">Dial</span><span class="op" id="3490958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3490961">TLSHandshakeTimeout</span><span class="op" id="3490980">:</span>&nbsp;<span class="num" id="3490982">10</span>&nbsp;<span class="op" id="3490985">*</span>&nbsp;<span class="ident" id="3490987"><a href="/net/http/transport.go.html#3490462">time</a></span><span class="op" id="3490991">.</span><span class="ident" id="3490992">Second</span><span class="op" id="3490998">,</span><br>
<span class="lineno">40</span><span class="op" id="3491000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3491003">//&nbsp;DefaultMaxIdleConnsPerHost&nbsp;is&nbsp;the&nbsp;default&nbsp;value&nbsp;of&nbsp;Transport&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3491069">//&nbsp;MaxIdleConnsPerHost.</span><br>
<span class="lineno"></span><span class="keyword" id="3491093">const</span>&nbsp;<span class="ident" id="3491099">DefaultMaxIdleConnsPerHost</span>&nbsp;<span class="op" id="3491126">=</span>&nbsp;<span class="num" id="3491128">2</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3491131">//&nbsp;Transport&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;RoundTripper&nbsp;that&nbsp;supports&nbsp;HTTP,</span><br>
<span class="lineno"></span><span class="comment" id="3491201">//&nbsp;HTTPS,&nbsp;and&nbsp;HTTP&nbsp;proxies&nbsp;(for&nbsp;either&nbsp;HTTP&nbsp;or&nbsp;HTTPS&nbsp;with&nbsp;CONNECT).</span><br>
<span class="lineno"></span><span class="comment" id="3491269">//&nbsp;Transport&nbsp;can&nbsp;also&nbsp;cache&nbsp;connections&nbsp;for&nbsp;future&nbsp;re-use.</span><br>
<span class="lineno"></span><span class="keyword" id="3491328">type</span>&nbsp;<span class="ident" id="3491333">Transport</span>&nbsp;<span class="keyword" id="3491343">struct</span>&nbsp;<span class="op" id="3491350">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491353">idleMu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491364"><a href="/net/http/transport.go.html#3490454">sync</a></span><span class="op" id="3491368">.</span><span class="ident" id="3491369">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491376">wantIdle</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3491387">bool</span>&nbsp;<span class="comment" id="3491392">//&nbsp;user&nbsp;has&nbsp;requested&nbsp;to&nbsp;close&nbsp;all&nbsp;idle&nbsp;conns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491439">idleConn</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491450">map</span><span class="op" id="3491453">[</span><span class="ident" id="3491454"><a href="/net/http/transport.go.html#3510813">connectMethodKey</a></span><span class="op" id="3491470">]</span><span class="op" id="3491471">[</span><span class="op" id="3491472">]</span><span class="op" id="3491473">*</span><span class="ident" id="3491474"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491487">idleConnCh</span>&nbsp;<span class="keyword" id="3491498">map</span><span class="op" id="3491501">[</span><span class="ident" id="3491502"><a href="/net/http/transport.go.html#3510813">connectMethodKey</a></span><span class="op" id="3491518">]</span><span class="keyword" id="3491519">chan</span>&nbsp;<span class="op" id="3491524">*</span><span class="ident" id="3491525"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491539">reqMu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491551"><a href="/net/http/transport.go.html#3490454">sync</a></span><span class="op" id="3491555">.</span><span class="ident" id="3491556">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491563">reqCanceler</span>&nbsp;<span class="keyword" id="3491575">map</span><span class="op" id="3491578">[</span><span class="op" id="3491579">*</span><span class="ident" id="3491580"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3491587">]</span><span class="keyword" id="3491588">func</span><span class="op" id="3491592">(</span><span class="op" id="3491593">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491597">altMu</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491606"><a href="/net/http/transport.go.html#3490454">sync</a></span><span class="op" id="3491610">.</span><span class="ident" id="3491611">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491620">altProto</span>&nbsp;<span class="keyword" id="3491629">map</span><span class="op" id="3491632">[</span><span class="builtintype" id="3491633">string</span><span class="op" id="3491639">]</span><span class="ident" id="3491640"><a href="/net/http/client.go.html#3313167">RoundTripper</a></span>&nbsp;<span class="comment" id="3491653">//&nbsp;nil&nbsp;or&nbsp;map&nbsp;of&nbsp;URI&nbsp;scheme&nbsp;=&gt;&nbsp;RoundTripper</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3491699">//&nbsp;Proxy&nbsp;specifies&nbsp;a&nbsp;function&nbsp;to&nbsp;return&nbsp;a&nbsp;proxy&nbsp;for&nbsp;a&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3491760">//&nbsp;Request.&nbsp;If&nbsp;the&nbsp;function&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3491818">//&nbsp;request&nbsp;is&nbsp;aborted&nbsp;with&nbsp;the&nbsp;provided&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3491866">//&nbsp;If&nbsp;Proxy&nbsp;is&nbsp;nil&nbsp;or&nbsp;returns&nbsp;a&nbsp;nil&nbsp;*URL,&nbsp;no&nbsp;proxy&nbsp;is&nbsp;used.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491927">Proxy</span>&nbsp;<span class="keyword" id="3491933">func</span><span class="op" id="3491937">(</span><span class="op" id="3491938">*</span><span class="ident" id="3491939"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3491946">)</span>&nbsp;<span class="op" id="3491948">(</span><span class="op" id="3491949">*</span><span class="ident" id="3491950"><a href="/net/http/transport.go.html#3490426">url</a></span><span class="op" id="3491953">.</span><span class="ident" id="3491954">URL</span><span class="op" id="3491957">,</span>&nbsp;<span class="builtintype" id="3491959">error</span><span class="op" id="3491964">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3491968">//&nbsp;Dial&nbsp;specifies&nbsp;the&nbsp;dial&nbsp;function&nbsp;for&nbsp;creating&nbsp;unencrypted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3492030">//&nbsp;TCP&nbsp;connections.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3492051">//&nbsp;If&nbsp;Dial&nbsp;is&nbsp;nil,&nbsp;net.Dial&nbsp;is&nbsp;used.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492089">Dial</span>&nbsp;<span class="keyword" id="3492094">func</span><span class="op" id="3492098">(</span><span class="ident" id="3492099">network</span><span class="op" id="3492106">,</span>&nbsp;<span class="ident" id="3492108">addr</span>&nbsp;<span class="builtintype" id="3492113">string</span><span class="op" id="3492119">)</span>&nbsp;<span class="op" id="3492121">(</span><span class="ident" id="3492122"><a href="/net/http/transport.go.html#3490419">net</a></span><span class="op" id="3492125">.</span><span class="ident" id="3492126">Conn</span><span class="op" id="3492130">,</span>&nbsp;<span class="builtintype" id="3492132">error</span><span class="op" id="3492137">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3492141">//&nbsp;DialTLS&nbsp;specifies&nbsp;an&nbsp;optional&nbsp;dial&nbsp;function&nbsp;for&nbsp;creating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3492202">//&nbsp;TLS&nbsp;connections&nbsp;for&nbsp;non-proxied&nbsp;HTTPS&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3492254">//</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3492258">//&nbsp;If&nbsp;DialTLS&nbsp;is&nbsp;nil,&nbsp;Dial&nbsp;and&nbsp;TLSClientConfig&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3492316">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3492320">//&nbsp;If&nbsp;DialTLS&nbsp;is&nbsp;set,&nbsp;the&nbsp;Dial&nbsp;hook&nbsp;is&nbsp;not&nbsp;used&nbsp;for&nbsp;HTTPS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3492379">//&nbsp;requests&nbsp;and&nbsp;the&nbsp;TLSClientConfig&nbsp;and&nbsp;TLSHandshakeTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3492440">//&nbsp;are&nbsp;ignored.&nbsp;The&nbsp;returned&nbsp;net.Conn&nbsp;is&nbsp;assumed&nbsp;to&nbsp;already&nbsp;be</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3492504">//&nbsp;past&nbsp;the&nbsp;TLS&nbsp;handshake.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492532">DialTLS</span>&nbsp;<span class="keyword" id="3492540">func</span><span class="op" id="3492544">(</span><span class="ident" id="3492545">network</span><span class="op" id="3492552">,</span>&nbsp;<span class="ident" id="3492554">addr</span>&nbsp;<span class="builtintype" id="3492559">string</span><span class="op" id="3492565">)</span>&nbsp;<span class="op" id="3492567">(</span><span class="ident" id="3492568"><a href="/net/http/transport.go.html#3490419">net</a></span><span class="op" id="3492571">.</span><span class="ident" id="3492572">Conn</span><span class="op" id="3492576">,</span>&nbsp;<span class="builtintype" id="3492578">error</span><span class="op" id="3492583">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3492587">//&nbsp;TLSClientConfig&nbsp;specifies&nbsp;the&nbsp;TLS&nbsp;configuration&nbsp;to&nbsp;use&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3492651">//&nbsp;tls.Client.&nbsp;If&nbsp;nil,&nbsp;the&nbsp;default&nbsp;configuration&nbsp;is&nbsp;used.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492710">TLSClientConfig</span>&nbsp;<span class="op" id="3492726">*</span><span class="ident" id="3492727"><a href="/net/http/transport.go.html#3490375">tls</a></span><span class="op" id="3492730">.</span><span class="ident" id="3492731">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3492740">//&nbsp;TLSHandshakeTimeout&nbsp;specifies&nbsp;the&nbsp;maximum&nbsp;amount&nbsp;of&nbsp;time&nbsp;waiting&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3492812">//&nbsp;wait&nbsp;for&nbsp;a&nbsp;TLS&nbsp;handshake.&nbsp;Zero&nbsp;means&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492865">TLSHandshakeTimeout</span>&nbsp;<span class="ident" id="3492885"><a href="/net/http/transport.go.html#3490462">time</a></span><span class="op" id="3492889">.</span><span class="ident" id="3492890">Duration</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3492901">//&nbsp;DisableKeepAlives,&nbsp;if&nbsp;true,&nbsp;prevents&nbsp;re-use&nbsp;of&nbsp;TCP&nbsp;connections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3492968">//&nbsp;between&nbsp;different&nbsp;HTTP&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493005">DisableKeepAlives</span>&nbsp;<span class="builtintype" id="3493023">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3493030">//&nbsp;DisableCompression,&nbsp;if&nbsp;true,&nbsp;prevents&nbsp;the&nbsp;Transport&nbsp;from</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3493091">//&nbsp;requesting&nbsp;compression&nbsp;with&nbsp;an&nbsp;&#34;Accept-Encoding:&nbsp;gzip&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3493150">//&nbsp;request&nbsp;header&nbsp;when&nbsp;the&nbsp;Request&nbsp;contains&nbsp;no&nbsp;existing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3493207">//&nbsp;Accept-Encoding&nbsp;value.&nbsp;If&nbsp;the&nbsp;Transport&nbsp;requests&nbsp;gzip&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3493268">//&nbsp;its&nbsp;own&nbsp;and&nbsp;gets&nbsp;a&nbsp;gzipped&nbsp;response,&nbsp;it&#39;s&nbsp;transparently</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3493328">//&nbsp;decoded&nbsp;in&nbsp;the&nbsp;Response.Body.&nbsp;However,&nbsp;if&nbsp;the&nbsp;user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3493383">//&nbsp;explicitly&nbsp;requested&nbsp;gzip&nbsp;it&nbsp;is&nbsp;not&nbsp;automatically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3493437">//&nbsp;uncompressed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493455">DisableCompression</span>&nbsp;<span class="builtintype" id="3493474">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3493481">//&nbsp;MaxIdleConnsPerHost,&nbsp;if&nbsp;non-zero,&nbsp;controls&nbsp;the&nbsp;maximum&nbsp;idle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3493545">//&nbsp;(keep-alive)&nbsp;to&nbsp;keep&nbsp;per-host.&nbsp;&nbsp;If&nbsp;zero,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3493590">//&nbsp;DefaultMaxIdleConnsPerHost&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493630">MaxIdleConnsPerHost</span>&nbsp;<span class="builtintype" id="3493650">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3493656">//&nbsp;ResponseHeaderTimeout,&nbsp;if&nbsp;non-zero,&nbsp;specifies&nbsp;the&nbsp;amount&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3493720">//&nbsp;time&nbsp;to&nbsp;wait&nbsp;for&nbsp;a&nbsp;server&#39;s&nbsp;response&nbsp;headers&nbsp;after&nbsp;fully</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3493781">//&nbsp;writing&nbsp;the&nbsp;request&nbsp;(including&nbsp;its&nbsp;body,&nbsp;if&nbsp;any).&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3493840">//&nbsp;time&nbsp;does&nbsp;not&nbsp;include&nbsp;the&nbsp;time&nbsp;to&nbsp;read&nbsp;the&nbsp;response&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493902">ResponseHeaderTimeout</span>&nbsp;<span class="ident" id="3493924"><a href="/net/http/transport.go.html#3490462">time</a></span><span class="op" id="3493928">.</span><span class="ident" id="3493929">Duration</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3493940">//&nbsp;TODO:&nbsp;tunable&nbsp;on&nbsp;global&nbsp;max&nbsp;cached&nbsp;connections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3493991">//&nbsp;TODO:&nbsp;tunable&nbsp;on&nbsp;timeout&nbsp;on&nbsp;cached&nbsp;connections</span><br>
<span class="lineno"></span><span class="op" id="3494041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="3494044">//&nbsp;ProxyFromEnvironment&nbsp;returns&nbsp;the&nbsp;URL&nbsp;of&nbsp;the&nbsp;proxy&nbsp;to&nbsp;use&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3494110">//&nbsp;given&nbsp;request,&nbsp;as&nbsp;indicated&nbsp;by&nbsp;the&nbsp;environment&nbsp;variables</span><br>
<span class="lineno"></span><span class="comment" id="3494170">//&nbsp;HTTP_PROXY,&nbsp;HTTPS_PROXY&nbsp;and&nbsp;NO_PROXY&nbsp;(or&nbsp;the&nbsp;lowercase&nbsp;versions</span><br>
<span class="lineno"></span><span class="comment" id="3494237">//&nbsp;thereof).&nbsp;HTTPS_PROXY&nbsp;takes&nbsp;precedence&nbsp;over&nbsp;HTTP_PROXY&nbsp;for&nbsp;https</span><br>
<span class="lineno"></span><span class="comment" id="3494305">//&nbsp;requests.</span><br>
<span class="lineno">125</span><span class="comment" id="3494318">//</span><br>
<span class="lineno"></span><span class="comment" id="3494321">//&nbsp;The&nbsp;environment&nbsp;values&nbsp;may&nbsp;be&nbsp;either&nbsp;a&nbsp;complete&nbsp;URL&nbsp;or&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3494381">//&nbsp;&#34;host[:port]&#34;,&nbsp;in&nbsp;which&nbsp;case&nbsp;the&nbsp;&#34;http&#34;&nbsp;scheme&nbsp;is&nbsp;assumed.</span><br>
<span class="lineno"></span><span class="comment" id="3494443">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;the&nbsp;value&nbsp;is&nbsp;a&nbsp;different&nbsp;form.</span><br>
<span class="lineno"></span><span class="comment" id="3494501">//</span><br>
<span class="lineno">130</span><span class="comment" id="3494504">//&nbsp;A&nbsp;nil&nbsp;URL&nbsp;and&nbsp;nil&nbsp;error&nbsp;are&nbsp;returned&nbsp;if&nbsp;no&nbsp;proxy&nbsp;is&nbsp;defined&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3494574">//&nbsp;environment,&nbsp;or&nbsp;a&nbsp;proxy&nbsp;should&nbsp;not&nbsp;be&nbsp;used&nbsp;for&nbsp;the&nbsp;given&nbsp;request,</span><br>
<span class="lineno"></span><span class="comment" id="3494643">//&nbsp;as&nbsp;defined&nbsp;by&nbsp;NO_PROXY.</span><br>
<span class="lineno"></span><span class="comment" id="3494670">//</span><br>
<span class="lineno"></span><span class="comment" id="3494673">//&nbsp;As&nbsp;a&nbsp;special&nbsp;case,&nbsp;if&nbsp;req.URL.Host&nbsp;is&nbsp;&#34;localhost&#34;&nbsp;(with&nbsp;or&nbsp;without</span><br>
<span class="lineno">135</span><span class="comment" id="3494743">//&nbsp;a&nbsp;port&nbsp;number),&nbsp;then&nbsp;a&nbsp;nil&nbsp;URL&nbsp;and&nbsp;nil&nbsp;error&nbsp;will&nbsp;be&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="3494809">func</span>&nbsp;<span class="ident" id="3494814">ProxyFromEnvironment</span><span class="op" id="3494834">(</span><span class="ident" id="3494835">req</span>&nbsp;<span class="op" id="3494839">*</span><span class="ident" id="3494840"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3494847">)</span>&nbsp;<span class="op" id="3494849">(</span><span class="op" id="3494850">*</span><span class="ident" id="3494851"><a href="/net/http/transport.go.html#3490426">url</a></span><span class="op" id="3494854">.</span><span class="ident" id="3494855">URL</span><span class="op" id="3494858">,</span>&nbsp;<span class="builtintype" id="3494860">error</span><span class="op" id="3494865">)</span>&nbsp;<span class="op" id="3494867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494870">var</span>&nbsp;<span class="ident" id="3494874">proxy</span>&nbsp;<span class="builtintype" id="3494880">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494888">if</span>&nbsp;<span class="ident" id="3494891"><a href="/net/http/transport.go.html#3494835">req</a></span><span class="op" id="3494894">.</span><span class="ident" id="3494895">URL</span><span class="op" id="3494898">.</span><span class="ident" id="3494899">Scheme</span>&nbsp;<span class="op" id="3494906">==</span>&nbsp;<span class="string" id="3494909">&#34;https&#34;</span>&nbsp;<span class="op" id="3494917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494921"><a href="/net/http/transport.go.html#3494874">proxy</a></span>&nbsp;<span class="op" id="3494927">=</span>&nbsp;<span class="ident" id="3494929"><a href="/net/http/transport.go.html#3499103">httpsProxyEnv</a></span><span class="op" id="3494942">.</span><span class="ident" id="3494943">Get</span><span class="op" id="3494946">(</span><span class="op" id="3494947">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3494950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494953">if</span>&nbsp;<span class="ident" id="3494956"><a href="/net/http/transport.go.html#3494874">proxy</a></span>&nbsp;<span class="op" id="3494962">==</span>&nbsp;<span class="string" id="3494965">&#34;&#34;</span>&nbsp;<span class="op" id="3494968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494972"><a href="/net/http/transport.go.html#3494874">proxy</a></span>&nbsp;<span class="op" id="3494978">=</span>&nbsp;<span class="ident" id="3494980"><a href="/net/http/transport.go.html#3499027">httpProxyEnv</a></span><span class="op" id="3494992">.</span><span class="ident" id="3494993">Get</span><span class="op" id="3494996">(</span><span class="op" id="3494997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3495000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495003">if</span>&nbsp;<span class="ident" id="3495006"><a href="/net/http/transport.go.html#3494874">proxy</a></span>&nbsp;<span class="op" id="3495012">==</span>&nbsp;<span class="string" id="3495015">&#34;&#34;</span>&nbsp;<span class="op" id="3495018">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495022">return</span>&nbsp;<span class="ident" id="3495029">nil</span><span class="op" id="3495032">,</span>&nbsp;<span class="ident" id="3495034">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3495039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495042">if</span>&nbsp;<span class="op" id="3495045">!</span><span class="ident" id="3495046"><a href="/net/http/transport.go.html#3508060">useProxy</a></span><span class="op" id="3495054">(</span><span class="ident" id="3495055"><a href="/net/http/transport.go.html#3521703">canonicalAddr</a></span><span class="op" id="3495068">(</span><span class="ident" id="3495069"><a href="/net/http/transport.go.html#3494835">req</a></span><span class="op" id="3495072">.</span><span class="ident" id="3495073">URL</span><span class="op" id="3495076">)</span><span class="op" id="3495077">)</span>&nbsp;<span class="op" id="3495079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495083">return</span>&nbsp;<span class="ident" id="3495090">nil</span><span class="op" id="3495093">,</span>&nbsp;<span class="ident" id="3495095">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3495100">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3495103">proxyURL</span><span class="op" id="3495111">,</span>&nbsp;<span class="ident" id="3495113">err</span>&nbsp;<span class="op" id="3495117">:=</span>&nbsp;<span class="ident" id="3495120"><a href="/net/http/transport.go.html#3490426">url</a></span><span class="op" id="3495123">.</span><span class="ident" id="3495124">Parse</span><span class="op" id="3495129">(</span><span class="ident" id="3495130"><a href="/net/http/transport.go.html#3494874">proxy</a></span><span class="op" id="3495135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495138">if</span>&nbsp;<span class="ident" id="3495141"><a href="/net/http/transport.go.html#3495113">err</a></span>&nbsp;<span class="op" id="3495145">!=</span>&nbsp;<span class="ident" id="3495148">nil</span>&nbsp;<span class="op" id="3495152">||</span>&nbsp;<span class="op" id="3495155">!</span><span class="ident" id="3495156"><a href="/net/http/transport.go.html#3490443">strings</a></span><span class="op" id="3495163">.</span><span class="ident" id="3495164">HasPrefix</span><span class="op" id="3495173">(</span><span class="ident" id="3495174"><a href="/net/http/transport.go.html#3495103">proxyURL</a></span><span class="op" id="3495182">.</span><span class="ident" id="3495183">Scheme</span><span class="op" id="3495189">,</span>&nbsp;<span class="string" id="3495191">&#34;http&#34;</span><span class="op" id="3495197">)</span>&nbsp;<span class="op" id="3495199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3495203">//&nbsp;proxy&nbsp;was&nbsp;bogus.&nbsp;Try&nbsp;prepending&nbsp;&#34;http://&#34;&nbsp;to&nbsp;it&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3495260">//&nbsp;see&nbsp;if&nbsp;that&nbsp;parses&nbsp;correctly.&nbsp;If&nbsp;not,&nbsp;we&nbsp;fall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3495311">//&nbsp;through&nbsp;and&nbsp;complain&nbsp;about&nbsp;the&nbsp;original&nbsp;one.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495361">if</span>&nbsp;<span class="ident" id="3495364">proxyURL</span><span class="op" id="3495372">,</span>&nbsp;<span class="ident" id="3495374">err</span>&nbsp;<span class="op" id="3495378">:=</span>&nbsp;<span class="ident" id="3495381"><a href="/net/http/transport.go.html#3490426">url</a></span><span class="op" id="3495384">.</span><span class="ident" id="3495385">Parse</span><span class="op" id="3495390">(</span><span class="string" id="3495391">&#34;http://&#34;</span>&nbsp;<span class="op" id="3495401">+</span>&nbsp;<span class="ident" id="3495403"><a href="/net/http/transport.go.html#3494874">proxy</a></span><span class="op" id="3495408">)</span><span class="op" id="3495409">;</span>&nbsp;<span class="ident" id="3495411"><a href="/net/http/transport.go.html#3495374">err</a></span>&nbsp;<span class="op" id="3495415">==</span>&nbsp;<span class="ident" id="3495418">nil</span>&nbsp;<span class="op" id="3495422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495427">return</span>&nbsp;<span class="ident" id="3495434"><a href="/net/http/transport.go.html#3495364">proxyURL</a></span><span class="op" id="3495442">,</span>&nbsp;<span class="ident" id="3495444">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3495450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3495453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495456">if</span>&nbsp;<span class="ident" id="3495459"><a href="/net/http/transport.go.html#3495113">err</a></span>&nbsp;<span class="op" id="3495463">!=</span>&nbsp;<span class="ident" id="3495466">nil</span>&nbsp;<span class="op" id="3495470">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495474">return</span>&nbsp;<span class="ident" id="3495481">nil</span><span class="op" id="3495484">,</span>&nbsp;<span class="ident" id="3495486"><a href="/net/http/transport.go.html#3490399">fmt</a></span><span class="op" id="3495489">.</span><span class="ident" id="3495490">Errorf</span><span class="op" id="3495496">(</span><span class="string" id="3495497">&#34;invalid&nbsp;proxy&nbsp;address&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="3495527">,</span>&nbsp;<span class="ident" id="3495529"><a href="/net/http/transport.go.html#3494874">proxy</a></span><span class="op" id="3495534">,</span>&nbsp;<span class="ident" id="3495536"><a href="/net/http/transport.go.html#3495113">err</a></span><span class="op" id="3495539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3495542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495545">return</span>&nbsp;<span class="ident" id="3495552"><a href="/net/http/transport.go.html#3495103">proxyURL</a></span><span class="op" id="3495560">,</span>&nbsp;<span class="ident" id="3495562">nil</span><br>
<span class="lineno"></span><span class="op" id="3495566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3495569">//&nbsp;ProxyURL&nbsp;returns&nbsp;a&nbsp;proxy&nbsp;function&nbsp;(for&nbsp;use&nbsp;in&nbsp;a&nbsp;Transport)</span><br>
<span class="lineno"></span><span class="comment" id="3495631">//&nbsp;that&nbsp;always&nbsp;returns&nbsp;the&nbsp;same&nbsp;URL.</span><br>
<span class="lineno"></span><span class="keyword" id="3495668">func</span>&nbsp;<span class="ident" id="3495673">ProxyURL</span><span class="op" id="3495681">(</span><span class="ident" id="3495682">fixedURL</span>&nbsp;<span class="op" id="3495691">*</span><span class="ident" id="3495692"><a href="/net/http/transport.go.html#3490426">url</a></span><span class="op" id="3495695">.</span><span class="ident" id="3495696">URL</span><span class="op" id="3495699">)</span>&nbsp;<span class="keyword" id="3495701">func</span><span class="op" id="3495705">(</span><span class="op" id="3495706">*</span><span class="ident" id="3495707"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3495714">)</span>&nbsp;<span class="op" id="3495716">(</span><span class="op" id="3495717">*</span><span class="ident" id="3495718"><a href="/net/http/transport.go.html#3490426">url</a></span><span class="op" id="3495721">.</span><span class="ident" id="3495722">URL</span><span class="op" id="3495725">,</span>&nbsp;<span class="builtintype" id="3495727">error</span><span class="op" id="3495732">)</span>&nbsp;<span class="op" id="3495734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495737">return</span>&nbsp;<span class="keyword" id="3495744">func</span><span class="op" id="3495748">(</span><span class="op" id="3495749">*</span><span class="ident" id="3495750"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3495757">)</span>&nbsp;<span class="op" id="3495759">(</span><span class="op" id="3495760">*</span><span class="ident" id="3495761"><a href="/net/http/transport.go.html#3490426">url</a></span><span class="op" id="3495764">.</span><span class="ident" id="3495765">URL</span><span class="op" id="3495768">,</span>&nbsp;<span class="builtintype" id="3495770">error</span><span class="op" id="3495775">)</span>&nbsp;<span class="op" id="3495777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495781">return</span>&nbsp;<span class="ident" id="3495788"><a href="/net/http/transport.go.html#3495682">fixedURL</a></span><span class="op" id="3495796">,</span>&nbsp;<span class="ident" id="3495798">nil</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3495803">}</span><br>
<span class="lineno"></span><span class="op" id="3495805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3495808">//&nbsp;transportRequest&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;a&nbsp;*Request&nbsp;that&nbsp;adds</span><br>
<span class="lineno"></span><span class="comment" id="3495869">//&nbsp;optional&nbsp;extra&nbsp;headers&nbsp;to&nbsp;write.</span><br>
<span class="lineno">175</span><span class="keyword" id="3495905">type</span>&nbsp;<span class="ident" id="3495910">transportRequest</span>&nbsp;<span class="keyword" id="3495927">struct</span>&nbsp;<span class="op" id="3495934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3495937">*</span><span class="ident" id="3495938"><a href="/net/http/request.go.html#3366486">Request</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3495953">//&nbsp;original&nbsp;request,&nbsp;not&nbsp;to&nbsp;be&nbsp;mutated</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3495993">extra</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3496002"><a href="/net/http/header.go.html#3356649">Header</a></span>&nbsp;<span class="comment" id="3496009">//&nbsp;extra&nbsp;headers&nbsp;to&nbsp;write,&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span><span class="op" id="3496043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="3496046">func</span>&nbsp;<span class="op" id="3496051">(</span><span class="ident" id="3496052">tr</span>&nbsp;<span class="op" id="3496055">*</span><span class="ident" id="3496056"><a href="/net/http/transport.go.html#3495910">transportRequest</a></span><span class="op" id="3496072">)</span>&nbsp;<span class="ident" id="3496074">extraHeaders</span><span class="op" id="3496086">(</span><span class="op" id="3496087">)</span>&nbsp;<span class="ident" id="3496089"><a href="/net/http/header.go.html#3356649">Header</a></span>&nbsp;<span class="op" id="3496096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496099">if</span>&nbsp;<span class="ident" id="3496102"><a href="/net/http/transport.go.html#3496052">tr</a></span><span class="op" id="3496104">.</span><span class="ident" id="3496105">extra</span>&nbsp;<span class="op" id="3496111">==</span>&nbsp;<span class="ident" id="3496114">nil</span>&nbsp;<span class="op" id="3496118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496122"><a href="/net/http/transport.go.html#3496052">tr</a></span><span class="op" id="3496124">.</span><span class="ident" id="3496125">extra</span>&nbsp;<span class="op" id="3496131">=</span>&nbsp;<span class="builtinfunc" id="3496133">make</span><span class="op" id="3496137">(</span><span class="ident" id="3496138"><a href="/net/http/header.go.html#3356649">Header</a></span><span class="op" id="3496144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3496147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496150">return</span>&nbsp;<span class="ident" id="3496157"><a href="/net/http/transport.go.html#3496052">tr</a></span><span class="op" id="3496159">.</span><span class="ident" id="3496160">extra</span><br>
<span class="lineno">185</span><span class="op" id="3496166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3496169">//&nbsp;RoundTrip&nbsp;implements&nbsp;the&nbsp;RoundTripper&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="3496221">//</span><br>
<span class="lineno"></span><span class="comment" id="3496224">//&nbsp;For&nbsp;higher-level&nbsp;HTTP&nbsp;client&nbsp;support&nbsp;(such&nbsp;as&nbsp;handling&nbsp;of&nbsp;cookies</span><br>
<span class="lineno">190</span><span class="comment" id="3496293">//&nbsp;and&nbsp;redirects),&nbsp;see&nbsp;Get,&nbsp;Post,&nbsp;and&nbsp;the&nbsp;Client&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="3496348">func</span>&nbsp;<span class="op" id="3496353">(</span><span class="ident" id="3496354">t</span>&nbsp;<span class="op" id="3496356">*</span><span class="ident" id="3496357"><a href="/net/http/transport.go.html#3491333">Transport</a></span><span class="op" id="3496366">)</span>&nbsp;<span class="ident" id="3496368">RoundTrip</span><span class="op" id="3496377">(</span><span class="ident" id="3496378">req</span>&nbsp;<span class="op" id="3496382">*</span><span class="ident" id="3496383"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3496390">)</span>&nbsp;<span class="op" id="3496392">(</span><span class="ident" id="3496393">resp</span>&nbsp;<span class="op" id="3496398">*</span><span class="ident" id="3496399"><a href="/net/http/response.go.html#3392041">Response</a></span><span class="op" id="3496407">,</span>&nbsp;<span class="ident" id="3496409">err</span>&nbsp;<span class="builtintype" id="3496413">error</span><span class="op" id="3496418">)</span>&nbsp;<span class="op" id="3496420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496423">if</span>&nbsp;<span class="ident" id="3496426"><a href="/net/http/transport.go.html#3496378">req</a></span><span class="op" id="3496429">.</span><span class="ident" id="3496430">URL</span>&nbsp;<span class="op" id="3496434">==</span>&nbsp;<span class="ident" id="3496437">nil</span>&nbsp;<span class="op" id="3496441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496445"><a href="/net/http/transport.go.html#3496378">req</a></span><span class="op" id="3496448">.</span><span class="ident" id="3496449">closeBody</span><span class="op" id="3496458">(</span><span class="op" id="3496459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496463">return</span>&nbsp;<span class="ident" id="3496470">nil</span><span class="op" id="3496473">,</span>&nbsp;<span class="ident" id="3496475"><a href="/net/http/transport.go.html#3490389">errors</a></span><span class="op" id="3496481">.</span><span class="ident" id="3496482">New</span><span class="op" id="3496485">(</span><span class="string" id="3496486">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="3496509">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3496512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496515">if</span>&nbsp;<span class="ident" id="3496518"><a href="/net/http/transport.go.html#3496378">req</a></span><span class="op" id="3496521">.</span><span class="ident" id="3496522">Header</span>&nbsp;<span class="op" id="3496529">==</span>&nbsp;<span class="ident" id="3496532">nil</span>&nbsp;<span class="op" id="3496536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496540"><a href="/net/http/transport.go.html#3496378">req</a></span><span class="op" id="3496543">.</span><span class="ident" id="3496544">closeBody</span><span class="op" id="3496553">(</span><span class="op" id="3496554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496558">return</span>&nbsp;<span class="ident" id="3496565">nil</span><span class="op" id="3496568">,</span>&nbsp;<span class="ident" id="3496570"><a href="/net/http/transport.go.html#3490389">errors</a></span><span class="op" id="3496576">.</span><span class="ident" id="3496577">New</span><span class="op" id="3496580">(</span><span class="string" id="3496581">&#34;http:&nbsp;nil&nbsp;Request.Header&#34;</span><span class="op" id="3496607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3496610">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496613">if</span>&nbsp;<span class="ident" id="3496616"><a href="/net/http/transport.go.html#3496378">req</a></span><span class="op" id="3496619">.</span><span class="ident" id="3496620">URL</span><span class="op" id="3496623">.</span><span class="ident" id="3496624">Scheme</span>&nbsp;<span class="op" id="3496631">!=</span>&nbsp;<span class="string" id="3496634">&#34;http&#34;</span>&nbsp;<span class="op" id="3496641">&amp;&amp;</span>&nbsp;<span class="ident" id="3496644"><a href="/net/http/transport.go.html#3496378">req</a></span><span class="op" id="3496647">.</span><span class="ident" id="3496648">URL</span><span class="op" id="3496651">.</span><span class="ident" id="3496652">Scheme</span>&nbsp;<span class="op" id="3496659">!=</span>&nbsp;<span class="string" id="3496662">&#34;https&#34;</span>&nbsp;<span class="op" id="3496670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496674"><a href="/net/http/transport.go.html#3496354">t</a></span><span class="op" id="3496675">.</span><span class="ident" id="3496676">altMu</span><span class="op" id="3496681">.</span><span class="ident" id="3496682">RLock</span><span class="op" id="3496687">(</span><span class="op" id="3496688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496692">var</span>&nbsp;<span class="ident" id="3496696">rt</span>&nbsp;<span class="ident" id="3496699"><a href="/net/http/client.go.html#3313167">RoundTripper</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496714">if</span>&nbsp;<span class="ident" id="3496717"><a href="/net/http/transport.go.html#3496354">t</a></span><span class="op" id="3496718">.</span><span class="ident" id="3496719">altProto</span>&nbsp;<span class="op" id="3496728">!=</span>&nbsp;<span class="ident" id="3496731">nil</span>&nbsp;<span class="op" id="3496735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496740"><a href="/net/http/transport.go.html#3496696">rt</a></span>&nbsp;<span class="op" id="3496743">=</span>&nbsp;<span class="ident" id="3496745"><a href="/net/http/transport.go.html#3496354">t</a></span><span class="op" id="3496746">.</span><span class="ident" id="3496747">altProto</span><span class="op" id="3496755">[</span><span class="ident" id="3496756"><a href="/net/http/transport.go.html#3496378">req</a></span><span class="op" id="3496759">.</span><span class="ident" id="3496760">URL</span><span class="op" id="3496763">.</span><span class="ident" id="3496764">Scheme</span><span class="op" id="3496770">]</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3496774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496778"><a href="/net/http/transport.go.html#3496354">t</a></span><span class="op" id="3496779">.</span><span class="ident" id="3496780">altMu</span><span class="op" id="3496785">.</span><span class="ident" id="3496786">RUnlock</span><span class="op" id="3496793">(</span><span class="op" id="3496794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496798">if</span>&nbsp;<span class="ident" id="3496801"><a href="/net/http/transport.go.html#3496696">rt</a></span>&nbsp;<span class="op" id="3496804">==</span>&nbsp;<span class="ident" id="3496807">nil</span>&nbsp;<span class="op" id="3496811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496816"><a href="/net/http/transport.go.html#3496378">req</a></span><span class="op" id="3496819">.</span><span class="ident" id="3496820">closeBody</span><span class="op" id="3496829">(</span><span class="op" id="3496830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496835">return</span>&nbsp;<span class="ident" id="3496842">nil</span><span class="op" id="3496845">,</span>&nbsp;<span class="op" id="3496847">&amp;</span><span class="ident" id="3496848"><a href="/net/http/request.go.html#3365780">badStringError</a></span><span class="op" id="3496862">{</span><span class="string" id="3496863">&#34;unsupported&nbsp;protocol&nbsp;scheme&#34;</span><span class="op" id="3496892">,</span>&nbsp;<span class="ident" id="3496894"><a href="/net/http/transport.go.html#3496378">req</a></span><span class="op" id="3496897">.</span><span class="ident" id="3496898">URL</span><span class="op" id="3496901">.</span><span class="ident" id="3496902">Scheme</span><span class="op" id="3496908">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3496912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496916">return</span>&nbsp;<span class="ident" id="3496923"><a href="/net/http/transport.go.html#3496696">rt</a></span><span class="op" id="3496925">.</span><span class="ident" id="3496926">RoundTrip</span><span class="op" id="3496935">(</span><span class="ident" id="3496936"><a href="/net/http/transport.go.html#3496378">req</a></span><span class="op" id="3496939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3496942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496945">if</span>&nbsp;<span class="ident" id="3496948"><a href="/net/http/transport.go.html#3496378">req</a></span><span class="op" id="3496951">.</span><span class="ident" id="3496952">URL</span><span class="op" id="3496955">.</span><span class="ident" id="3496956">Host</span>&nbsp;<span class="op" id="3496961">==</span>&nbsp;<span class="string" id="3496964">&#34;&#34;</span>&nbsp;<span class="op" id="3496967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496971"><a href="/net/http/transport.go.html#3496378">req</a></span><span class="op" id="3496974">.</span><span class="ident" id="3496975">closeBody</span><span class="op" id="3496984">(</span><span class="op" id="3496985">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496989">return</span>&nbsp;<span class="ident" id="3496996">nil</span><span class="op" id="3496999">,</span>&nbsp;<span class="ident" id="3497001"><a href="/net/http/transport.go.html#3490389">errors</a></span><span class="op" id="3497007">.</span><span class="ident" id="3497008">New</span><span class="op" id="3497011">(</span><span class="string" id="3497012">&#34;http:&nbsp;no&nbsp;Host&nbsp;in&nbsp;request&nbsp;URL&#34;</span><span class="op" id="3497042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3497045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3497048">treq</span>&nbsp;<span class="op" id="3497053">:=</span>&nbsp;<span class="op" id="3497056">&amp;</span><span class="ident" id="3497057"><a href="/net/http/transport.go.html#3495910">transportRequest</a></span><span class="op" id="3497073">{</span><span class="ident" id="3497074">Request</span><span class="op" id="3497081">:</span>&nbsp;<span class="ident" id="3497083"><a href="/net/http/transport.go.html#3496378">req</a></span><span class="op" id="3497086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3497089">cm</span><span class="op" id="3497091">,</span>&nbsp;<span class="ident" id="3497093"><a href="/net/http/transport.go.html#3496409">err</a></span>&nbsp;<span class="op" id="3497097">:=</span>&nbsp;<span class="ident" id="3497100"><a href="/net/http/transport.go.html#3496354">t</a></span><span class="op" id="3497101">.</span><span class="ident" id="3497102">connectMethodForRequest</span><span class="op" id="3497125">(</span><span class="ident" id="3497126"><a href="/net/http/transport.go.html#3497048">treq</a></span><span class="op" id="3497130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3497133">if</span>&nbsp;<span class="ident" id="3497136"><a href="/net/http/transport.go.html#3496409">err</a></span>&nbsp;<span class="op" id="3497140">!=</span>&nbsp;<span class="ident" id="3497143">nil</span>&nbsp;<span class="op" id="3497147">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3497151"><a href="/net/http/transport.go.html#3496378">req</a></span><span class="op" id="3497154">.</span><span class="ident" id="3497155">closeBody</span><span class="op" id="3497164">(</span><span class="op" id="3497165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3497169">return</span>&nbsp;<span class="ident" id="3497176">nil</span><span class="op" id="3497179">,</span>&nbsp;<span class="ident" id="3497181"><a href="/net/http/transport.go.html#3496409">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3497186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3497190">//&nbsp;Get&nbsp;the&nbsp;cached&nbsp;or&nbsp;newly-created&nbsp;connection&nbsp;to&nbsp;either&nbsp;the</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3497251">//&nbsp;host&nbsp;(for&nbsp;http&nbsp;or&nbsp;https),&nbsp;the&nbsp;http&nbsp;proxy,&nbsp;or&nbsp;the&nbsp;http&nbsp;proxy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3497315">//&nbsp;pre-CONNECTed&nbsp;to&nbsp;https&nbsp;server.&nbsp;&nbsp;In&nbsp;any&nbsp;case,&nbsp;we&#39;ll&nbsp;be&nbsp;ready</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3497379">//&nbsp;to&nbsp;send&nbsp;it&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3497404">pconn</span><span class="op" id="3497409">,</span>&nbsp;<span class="ident" id="3497411"><a href="/net/http/transport.go.html#3496409">err</a></span>&nbsp;<span class="op" id="3497415">:=</span>&nbsp;<span class="ident" id="3497418"><a href="/net/http/transport.go.html#3496354">t</a></span><span class="op" id="3497419">.</span><span class="ident" id="3497420">getConn</span><span class="op" id="3497427">(</span><span class="ident" id="3497428"><a href="/net/http/transport.go.html#3496378">req</a></span><span class="op" id="3497431">,</span>&nbsp;<span class="ident" id="3497433"><a href="/net/http/transport.go.html#3497089">cm</a></span><span class="op" id="3497435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3497438">if</span>&nbsp;<span class="ident" id="3497441"><a href="/net/http/transport.go.html#3496409">err</a></span>&nbsp;<span class="op" id="3497445">!=</span>&nbsp;<span class="ident" id="3497448">nil</span>&nbsp;<span class="op" id="3497452">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3497456"><a href="/net/http/transport.go.html#3496354">t</a></span><span class="op" id="3497457">.</span><span class="ident" id="3497458">setReqCanceler</span><span class="op" id="3497472">(</span><span class="ident" id="3497473"><a href="/net/http/transport.go.html#3496378">req</a></span><span class="op" id="3497476">,</span>&nbsp;<span class="ident" id="3497478">nil</span><span class="op" id="3497481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3497485"><a href="/net/http/transport.go.html#3496378">req</a></span><span class="op" id="3497488">.</span><span class="ident" id="3497489">closeBody</span><span class="op" id="3497498">(</span><span class="op" id="3497499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3497503">return</span>&nbsp;<span class="ident" id="3497510">nil</span><span class="op" id="3497513">,</span>&nbsp;<span class="ident" id="3497515"><a href="/net/http/transport.go.html#3496409">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3497520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3497524">return</span>&nbsp;<span class="ident" id="3497531"><a href="/net/http/transport.go.html#3497404">pconn</a></span><span class="op" id="3497536">.</span><span class="ident" id="3497537">roundTrip</span><span class="op" id="3497546">(</span><span class="ident" id="3497547"><a href="/net/http/transport.go.html#3497048">treq</a></span><span class="op" id="3497551">)</span><br>
<span class="lineno"></span><span class="op" id="3497553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3497556">//&nbsp;RegisterProtocol&nbsp;registers&nbsp;a&nbsp;new&nbsp;protocol&nbsp;with&nbsp;scheme.</span><br>
<span class="lineno"></span><span class="comment" id="3497614">//&nbsp;The&nbsp;Transport&nbsp;will&nbsp;pass&nbsp;requests&nbsp;using&nbsp;the&nbsp;given&nbsp;scheme&nbsp;to&nbsp;rt.</span><br>
<span class="lineno">240</span><span class="comment" id="3497680">//&nbsp;It&nbsp;is&nbsp;rt&#39;s&nbsp;responsibility&nbsp;to&nbsp;simulate&nbsp;HTTP&nbsp;request&nbsp;semantics.</span><br>
<span class="lineno"></span><span class="comment" id="3497745">//</span><br>
<span class="lineno"></span><span class="comment" id="3497748">//&nbsp;RegisterProtocol&nbsp;can&nbsp;be&nbsp;used&nbsp;by&nbsp;other&nbsp;packages&nbsp;to&nbsp;provide</span><br>
<span class="lineno"></span><span class="comment" id="3497809">//&nbsp;implementations&nbsp;of&nbsp;protocol&nbsp;schemes&nbsp;like&nbsp;&#34;ftp&#34;&nbsp;or&nbsp;&#34;file&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3497870">func</span>&nbsp;<span class="op" id="3497875">(</span><span class="ident" id="3497876">t</span>&nbsp;<span class="op" id="3497878">*</span><span class="ident" id="3497879"><a href="/net/http/transport.go.html#3491333">Transport</a></span><span class="op" id="3497888">)</span>&nbsp;<span class="ident" id="3497890">RegisterProtocol</span><span class="op" id="3497906">(</span><span class="ident" id="3497907">scheme</span>&nbsp;<span class="builtintype" id="3497914">string</span><span class="op" id="3497920">,</span>&nbsp;<span class="ident" id="3497922">rt</span>&nbsp;<span class="ident" id="3497925"><a href="/net/http/client.go.html#3313167">RoundTripper</a></span><span class="op" id="3497937">)</span>&nbsp;<span class="op" id="3497939">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3497942">if</span>&nbsp;<span class="ident" id="3497945"><a href="/net/http/transport.go.html#3497907">scheme</a></span>&nbsp;<span class="op" id="3497952">==</span>&nbsp;<span class="string" id="3497955">&#34;http&#34;</span>&nbsp;<span class="op" id="3497962">||</span>&nbsp;<span class="ident" id="3497965"><a href="/net/http/transport.go.html#3497907">scheme</a></span>&nbsp;<span class="op" id="3497972">==</span>&nbsp;<span class="string" id="3497975">&#34;https&#34;</span>&nbsp;<span class="op" id="3497983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3497987">panic</span><span class="op" id="3497992">(</span><span class="string" id="3497993">&#34;protocol&nbsp;&#34;</span>&nbsp;<span class="op" id="3498005">+</span>&nbsp;<span class="ident" id="3498007"><a href="/net/http/transport.go.html#3497907">scheme</a></span>&nbsp;<span class="op" id="3498014">+</span>&nbsp;<span class="string" id="3498016">&#34;&nbsp;already&nbsp;registered&#34;</span><span class="op" id="3498037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3498040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498043"><a href="/net/http/transport.go.html#3497876">t</a></span><span class="op" id="3498044">.</span><span class="ident" id="3498045">altMu</span><span class="op" id="3498050">.</span><span class="ident" id="3498051">Lock</span><span class="op" id="3498055">(</span><span class="op" id="3498056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498059">defer</span>&nbsp;<span class="ident" id="3498065"><a href="/net/http/transport.go.html#3497876">t</a></span><span class="op" id="3498066">.</span><span class="ident" id="3498067">altMu</span><span class="op" id="3498072">.</span><span class="ident" id="3498073">Unlock</span><span class="op" id="3498079">(</span><span class="op" id="3498080">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498083">if</span>&nbsp;<span class="ident" id="3498086"><a href="/net/http/transport.go.html#3497876">t</a></span><span class="op" id="3498087">.</span><span class="ident" id="3498088">altProto</span>&nbsp;<span class="op" id="3498097">==</span>&nbsp;<span class="ident" id="3498100">nil</span>&nbsp;<span class="op" id="3498104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498108"><a href="/net/http/transport.go.html#3497876">t</a></span><span class="op" id="3498109">.</span><span class="ident" id="3498110">altProto</span>&nbsp;<span class="op" id="3498119">=</span>&nbsp;<span class="builtinfunc" id="3498121">make</span><span class="op" id="3498125">(</span><span class="keyword" id="3498126">map</span><span class="op" id="3498129">[</span><span class="builtintype" id="3498130">string</span><span class="op" id="3498136">]</span><span class="ident" id="3498137"><a href="/net/http/client.go.html#3313167">RoundTripper</a></span><span class="op" id="3498149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3498152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498155">if</span>&nbsp;<span class="ident" id="3498158">_</span><span class="op" id="3498159">,</span>&nbsp;<span class="ident" id="3498161">exists</span>&nbsp;<span class="op" id="3498168">:=</span>&nbsp;<span class="ident" id="3498171"><a href="/net/http/transport.go.html#3497876">t</a></span><span class="op" id="3498172">.</span><span class="ident" id="3498173">altProto</span><span class="op" id="3498181">[</span><span class="ident" id="3498182"><a href="/net/http/transport.go.html#3497907">scheme</a></span><span class="op" id="3498188">]</span><span class="op" id="3498189">;</span>&nbsp;<span class="ident" id="3498191"><a href="/net/http/transport.go.html#3498161">exists</a></span>&nbsp;<span class="op" id="3498198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3498202">panic</span><span class="op" id="3498207">(</span><span class="string" id="3498208">&#34;protocol&nbsp;&#34;</span>&nbsp;<span class="op" id="3498220">+</span>&nbsp;<span class="ident" id="3498222"><a href="/net/http/transport.go.html#3497907">scheme</a></span>&nbsp;<span class="op" id="3498229">+</span>&nbsp;<span class="string" id="3498231">&#34;&nbsp;already&nbsp;registered&#34;</span><span class="op" id="3498252">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3498255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498258"><a href="/net/http/transport.go.html#3497876">t</a></span><span class="op" id="3498259">.</span><span class="ident" id="3498260">altProto</span><span class="op" id="3498268">[</span><span class="ident" id="3498269"><a href="/net/http/transport.go.html#3497907">scheme</a></span><span class="op" id="3498275">]</span>&nbsp;<span class="op" id="3498277">=</span>&nbsp;<span class="ident" id="3498279"><a href="/net/http/transport.go.html#3497922">rt</a></span><br>
<span class="lineno"></span><span class="op" id="3498282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3498285">//&nbsp;CloseIdleConnections&nbsp;closes&nbsp;any&nbsp;connections&nbsp;which&nbsp;were&nbsp;previously</span><br>
<span class="lineno">260</span><span class="comment" id="3498354">//&nbsp;connected&nbsp;from&nbsp;previous&nbsp;requests&nbsp;but&nbsp;are&nbsp;now&nbsp;sitting&nbsp;idle&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3498418">//&nbsp;a&nbsp;&#34;keep-alive&#34;&nbsp;state.&nbsp;It&nbsp;does&nbsp;not&nbsp;interrupt&nbsp;any&nbsp;connections&nbsp;currently</span><br>
<span class="lineno"></span><span class="comment" id="3498491">//&nbsp;in&nbsp;use.</span><br>
<span class="lineno"></span><span class="keyword" id="3498502">func</span>&nbsp;<span class="op" id="3498507">(</span><span class="ident" id="3498508">t</span>&nbsp;<span class="op" id="3498510">*</span><span class="ident" id="3498511"><a href="/net/http/transport.go.html#3491333">Transport</a></span><span class="op" id="3498520">)</span>&nbsp;<span class="ident" id="3498522">CloseIdleConnections</span><span class="op" id="3498542">(</span><span class="op" id="3498543">)</span>&nbsp;<span class="op" id="3498545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498548"><a href="/net/http/transport.go.html#3498508">t</a></span><span class="op" id="3498549">.</span><span class="ident" id="3498550">idleMu</span><span class="op" id="3498556">.</span><span class="ident" id="3498557">Lock</span><span class="op" id="3498561">(</span><span class="op" id="3498562">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498565">m</span>&nbsp;<span class="op" id="3498567">:=</span>&nbsp;<span class="ident" id="3498570"><a href="/net/http/transport.go.html#3498508">t</a></span><span class="op" id="3498571">.</span><span class="ident" id="3498572">idleConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498582"><a href="/net/http/transport.go.html#3498508">t</a></span><span class="op" id="3498583">.</span><span class="ident" id="3498584">idleConn</span>&nbsp;<span class="op" id="3498593">=</span>&nbsp;<span class="ident" id="3498595">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498600"><a href="/net/http/transport.go.html#3498508">t</a></span><span class="op" id="3498601">.</span><span class="ident" id="3498602">idleConnCh</span>&nbsp;<span class="op" id="3498613">=</span>&nbsp;<span class="ident" id="3498615">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498620"><a href="/net/http/transport.go.html#3498508">t</a></span><span class="op" id="3498621">.</span><span class="ident" id="3498622">wantIdle</span>&nbsp;<span class="op" id="3498631">=</span>&nbsp;<span class="builtintype" id="3498633">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498639"><a href="/net/http/transport.go.html#3498508">t</a></span><span class="op" id="3498640">.</span><span class="ident" id="3498641">idleMu</span><span class="op" id="3498647">.</span><span class="ident" id="3498648">Unlock</span><span class="op" id="3498654">(</span><span class="op" id="3498655">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498658">for</span>&nbsp;<span class="ident" id="3498662">_</span><span class="op" id="3498663">,</span>&nbsp;<span class="ident" id="3498665">conns</span>&nbsp;<span class="op" id="3498671">:=</span>&nbsp;<span class="keyword" id="3498674">range</span>&nbsp;<span class="ident" id="3498680"><a href="/net/http/transport.go.html#3498565">m</a></span>&nbsp;<span class="op" id="3498682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498686">for</span>&nbsp;<span class="ident" id="3498690">_</span><span class="op" id="3498691">,</span>&nbsp;<span class="ident" id="3498693">pconn</span>&nbsp;<span class="op" id="3498699">:=</span>&nbsp;<span class="keyword" id="3498702">range</span>&nbsp;<span class="ident" id="3498708"><a href="/net/http/transport.go.html#3498665">conns</a></span>&nbsp;<span class="op" id="3498714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498719"><a href="/net/http/transport.go.html#3498693">pconn</a></span><span class="op" id="3498724">.</span><span class="builtinfunc" id="3498725">close</span><span class="op" id="3498730">(</span><span class="op" id="3498731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3498735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3498738">}</span><br>
<span class="lineno">275</span><span class="op" id="3498740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3498743">//&nbsp;CancelRequest&nbsp;cancels&nbsp;an&nbsp;in-flight&nbsp;request&nbsp;by&nbsp;closing&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="3498804">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3498819">func</span>&nbsp;<span class="op" id="3498824">(</span><span class="ident" id="3498825">t</span>&nbsp;<span class="op" id="3498827">*</span><span class="ident" id="3498828"><a href="/net/http/transport.go.html#3491333">Transport</a></span><span class="op" id="3498837">)</span>&nbsp;<span class="ident" id="3498839">CancelRequest</span><span class="op" id="3498852">(</span><span class="ident" id="3498853">req</span>&nbsp;<span class="op" id="3498857">*</span><span class="ident" id="3498858"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3498865">)</span>&nbsp;<span class="op" id="3498867">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498870"><a href="/net/http/transport.go.html#3498825">t</a></span><span class="op" id="3498871">.</span><span class="ident" id="3498872">reqMu</span><span class="op" id="3498877">.</span><span class="ident" id="3498878">Lock</span><span class="op" id="3498882">(</span><span class="op" id="3498883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498886">cancel</span>&nbsp;<span class="op" id="3498893">:=</span>&nbsp;<span class="ident" id="3498896"><a href="/net/http/transport.go.html#3498825">t</a></span><span class="op" id="3498897">.</span><span class="ident" id="3498898">reqCanceler</span><span class="op" id="3498909">[</span><span class="ident" id="3498910"><a href="/net/http/transport.go.html#3498853">req</a></span><span class="op" id="3498913">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498916"><a href="/net/http/transport.go.html#3498825">t</a></span><span class="op" id="3498917">.</span><span class="ident" id="3498918">reqMu</span><span class="op" id="3498923">.</span><span class="ident" id="3498924">Unlock</span><span class="op" id="3498930">(</span><span class="op" id="3498931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498934">if</span>&nbsp;<span class="ident" id="3498937"><a href="/net/http/transport.go.html#3498886">cancel</a></span>&nbsp;<span class="op" id="3498944">!=</span>&nbsp;<span class="ident" id="3498947">nil</span>&nbsp;<span class="op" id="3498951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498955"><a href="/net/http/transport.go.html#3498886">cancel</a></span><span class="op" id="3498961">(</span><span class="op" id="3498962">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3498965">}</span><br>
<span class="lineno"></span><span class="op" id="3498967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3498970">//</span><br>
<span class="lineno"></span><span class="comment" id="3498973">//&nbsp;Private&nbsp;implementation&nbsp;past&nbsp;this&nbsp;point.</span><br>
<span class="lineno">290</span><span class="comment" id="3499016">//</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3499020">var</span>&nbsp;<span class="op" id="3499024">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499027">httpProxyEnv</span>&nbsp;<span class="op" id="3499040">=</span>&nbsp;<span class="op" id="3499042">&amp;</span><span class="ident" id="3499043"><a href="/net/http/transport.go.html#3499411">envOnce</a></span><span class="op" id="3499050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499054">names</span><span class="op" id="3499059">:</span>&nbsp;<span class="op" id="3499061">[</span><span class="op" id="3499062">]</span><span class="builtintype" id="3499063">string</span><span class="op" id="3499069">{</span><span class="string" id="3499070">&#34;HTTP_PROXY&#34;</span><span class="op" id="3499082">,</span>&nbsp;<span class="string" id="3499084">&#34;http_proxy&#34;</span><span class="op" id="3499096">}</span><span class="op" id="3499097">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3499100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499103">httpsProxyEnv</span>&nbsp;<span class="op" id="3499117">=</span>&nbsp;<span class="op" id="3499119">&amp;</span><span class="ident" id="3499120"><a href="/net/http/transport.go.html#3499411">envOnce</a></span><span class="op" id="3499127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499131">names</span><span class="op" id="3499136">:</span>&nbsp;<span class="op" id="3499138">[</span><span class="op" id="3499139">]</span><span class="builtintype" id="3499140">string</span><span class="op" id="3499146">{</span><span class="string" id="3499147">&#34;HTTPS_PROXY&#34;</span><span class="op" id="3499160">,</span>&nbsp;<span class="string" id="3499162">&#34;https_proxy&#34;</span><span class="op" id="3499175">}</span><span class="op" id="3499176">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3499179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499182">noProxyEnv</span>&nbsp;<span class="op" id="3499193">=</span>&nbsp;<span class="op" id="3499195">&amp;</span><span class="ident" id="3499196"><a href="/net/http/transport.go.html#3499411">envOnce</a></span><span class="op" id="3499203">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499207">names</span><span class="op" id="3499212">:</span>&nbsp;<span class="op" id="3499214">[</span><span class="op" id="3499215">]</span><span class="builtintype" id="3499216">string</span><span class="op" id="3499222">{</span><span class="string" id="3499223">&#34;NO_PROXY&#34;</span><span class="op" id="3499233">,</span>&nbsp;<span class="string" id="3499235">&#34;no_proxy&#34;</span><span class="op" id="3499245">}</span><span class="op" id="3499246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3499249">}</span><br>
<span class="lineno"></span><span class="op" id="3499251">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3499254">//&nbsp;envOnce&nbsp;looks&nbsp;up&nbsp;an&nbsp;environment&nbsp;variable&nbsp;(optionally&nbsp;by&nbsp;multiple</span><br>
<span class="lineno">305</span><span class="comment" id="3499322">//&nbsp;names)&nbsp;once.&nbsp;It&nbsp;mitigates&nbsp;expensive&nbsp;lookups&nbsp;on&nbsp;some&nbsp;platforms</span><br>
<span class="lineno"></span><span class="comment" id="3499387">//&nbsp;(e.g.&nbsp;Windows).</span><br>
<span class="lineno"></span><span class="keyword" id="3499406">type</span>&nbsp;<span class="ident" id="3499411">envOnce</span>&nbsp;<span class="keyword" id="3499419">struct</span>&nbsp;<span class="op" id="3499426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499429">names</span>&nbsp;<span class="op" id="3499435">[</span><span class="op" id="3499436">]</span><span class="builtintype" id="3499437">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499445">once</span>&nbsp;&nbsp;<span class="ident" id="3499451"><a href="/net/http/transport.go.html#3490454">sync</a></span><span class="op" id="3499455">.</span><span class="ident" id="3499456">Once</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499462">val</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3499468">string</span><br>
<span class="lineno"></span><span class="op" id="3499475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3499478">func</span>&nbsp;<span class="op" id="3499483">(</span><span class="ident" id="3499484">e</span>&nbsp;<span class="op" id="3499486">*</span><span class="ident" id="3499487"><a href="/net/http/transport.go.html#3499411">envOnce</a></span><span class="op" id="3499494">)</span>&nbsp;<span class="ident" id="3499496">Get</span><span class="op" id="3499499">(</span><span class="op" id="3499500">)</span>&nbsp;<span class="builtintype" id="3499502">string</span>&nbsp;<span class="op" id="3499509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499512"><a href="/net/http/transport.go.html#3499484">e</a></span><span class="op" id="3499513">.</span><span class="ident" id="3499514">once</span><span class="op" id="3499518">.</span><span class="ident" id="3499519">Do</span><span class="op" id="3499521">(</span><span class="ident" id="3499522"><a href="/net/http/transport.go.html#3499484">e</a></span><span class="op" id="3499523">.</span><span class="ident" id="3499524">init</span><span class="op" id="3499528">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3499531">return</span>&nbsp;<span class="ident" id="3499538"><a href="/net/http/transport.go.html#3499484">e</a></span><span class="op" id="3499539">.</span><span class="ident" id="3499540">val</span><br>
<span class="lineno"></span><span class="op" id="3499544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3499547">func</span>&nbsp;<span class="op" id="3499552">(</span><span class="ident" id="3499553">e</span>&nbsp;<span class="op" id="3499555">*</span><span class="ident" id="3499556"><a href="/net/http/transport.go.html#3499411">envOnce</a></span><span class="op" id="3499563">)</span>&nbsp;<span class="ident" id="3499565">init</span><span class="op" id="3499569">(</span><span class="op" id="3499570">)</span>&nbsp;<span class="op" id="3499572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3499575">for</span>&nbsp;<span class="ident" id="3499579">_</span><span class="op" id="3499580">,</span>&nbsp;<span class="ident" id="3499582">n</span>&nbsp;<span class="op" id="3499584">:=</span>&nbsp;<span class="keyword" id="3499587">range</span>&nbsp;<span class="ident" id="3499593"><a href="/net/http/transport.go.html#3499553">e</a></span><span class="op" id="3499594">.</span><span class="ident" id="3499595">names</span>&nbsp;<span class="op" id="3499601">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499605"><a href="/net/http/transport.go.html#3499553">e</a></span><span class="op" id="3499606">.</span><span class="ident" id="3499607">val</span>&nbsp;<span class="op" id="3499611">=</span>&nbsp;<span class="ident" id="3499613"><a href="/net/http/transport.go.html#3490437">os</a></span><span class="op" id="3499615">.</span><span class="ident" id="3499616">Getenv</span><span class="op" id="3499622">(</span><span class="ident" id="3499623"><a href="/net/http/transport.go.html#3499582">n</a></span><span class="op" id="3499624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3499628">if</span>&nbsp;<span class="ident" id="3499631"><a href="/net/http/transport.go.html#3499553">e</a></span><span class="op" id="3499632">.</span><span class="ident" id="3499633">val</span>&nbsp;<span class="op" id="3499637">!=</span>&nbsp;<span class="string" id="3499640">&#34;&#34;</span>&nbsp;<span class="op" id="3499643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3499648">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3499657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3499660">}</span><br>
<span class="lineno">325</span><span class="op" id="3499662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3499665">//&nbsp;reset&nbsp;is&nbsp;used&nbsp;by&nbsp;tests</span><br>
<span class="lineno"></span><span class="keyword" id="3499691">func</span>&nbsp;<span class="op" id="3499696">(</span><span class="ident" id="3499697">e</span>&nbsp;<span class="op" id="3499699">*</span><span class="ident" id="3499700"><a href="/net/http/transport.go.html#3499411">envOnce</a></span><span class="op" id="3499707">)</span>&nbsp;<span class="ident" id="3499709">reset</span><span class="op" id="3499714">(</span><span class="op" id="3499715">)</span>&nbsp;<span class="op" id="3499717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499720"><a href="/net/http/transport.go.html#3499697">e</a></span><span class="op" id="3499721">.</span><span class="ident" id="3499722">once</span>&nbsp;<span class="op" id="3499727">=</span>&nbsp;<span class="ident" id="3499729"><a href="/net/http/transport.go.html#3490454">sync</a></span><span class="op" id="3499733">.</span><span class="ident" id="3499734">Once</span><span class="op" id="3499738">{</span><span class="op" id="3499739">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499742"><a href="/net/http/transport.go.html#3499697">e</a></span><span class="op" id="3499743">.</span><span class="ident" id="3499744">val</span>&nbsp;<span class="op" id="3499748">=</span>&nbsp;<span class="string" id="3499750">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3499753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3499756">func</span>&nbsp;<span class="op" id="3499761">(</span><span class="ident" id="3499762">t</span>&nbsp;<span class="op" id="3499764">*</span><span class="ident" id="3499765"><a href="/net/http/transport.go.html#3491333">Transport</a></span><span class="op" id="3499774">)</span>&nbsp;<span class="ident" id="3499776">connectMethodForRequest</span><span class="op" id="3499799">(</span><span class="ident" id="3499800">treq</span>&nbsp;<span class="op" id="3499805">*</span><span class="ident" id="3499806"><a href="/net/http/transport.go.html#3495910">transportRequest</a></span><span class="op" id="3499822">)</span>&nbsp;<span class="op" id="3499824">(</span><span class="ident" id="3499825">cm</span>&nbsp;<span class="ident" id="3499828"><a href="/net/http/transport.go.html#3509705">connectMethod</a></span><span class="op" id="3499841">,</span>&nbsp;<span class="ident" id="3499843">err</span>&nbsp;<span class="builtintype" id="3499847">error</span><span class="op" id="3499852">)</span>&nbsp;<span class="op" id="3499854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499857"><a href="/net/http/transport.go.html#3499825">cm</a></span><span class="op" id="3499859">.</span><span class="ident" id="3499860">targetScheme</span>&nbsp;<span class="op" id="3499873">=</span>&nbsp;<span class="ident" id="3499875"><a href="/net/http/transport.go.html#3499800">treq</a></span><span class="op" id="3499879">.</span><span class="ident" id="3499880">URL</span><span class="op" id="3499883">.</span><span class="ident" id="3499884">Scheme</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499892"><a href="/net/http/transport.go.html#3499825">cm</a></span><span class="op" id="3499894">.</span><span class="ident" id="3499895">targetAddr</span>&nbsp;<span class="op" id="3499906">=</span>&nbsp;<span class="ident" id="3499908"><a href="/net/http/transport.go.html#3521703">canonicalAddr</a></span><span class="op" id="3499921">(</span><span class="ident" id="3499922"><a href="/net/http/transport.go.html#3499800">treq</a></span><span class="op" id="3499926">.</span><span class="ident" id="3499927">URL</span><span class="op" id="3499930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3499933">if</span>&nbsp;<span class="ident" id="3499936"><a href="/net/http/transport.go.html#3499762">t</a></span><span class="op" id="3499937">.</span><span class="ident" id="3499938">Proxy</span>&nbsp;<span class="op" id="3499944">!=</span>&nbsp;<span class="ident" id="3499947">nil</span>&nbsp;<span class="op" id="3499951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499955"><a href="/net/http/transport.go.html#3499825">cm</a></span><span class="op" id="3499957">.</span><span class="ident" id="3499958">proxyURL</span><span class="op" id="3499966">,</span>&nbsp;<span class="ident" id="3499968"><a href="/net/http/transport.go.html#3499843">err</a></span>&nbsp;<span class="op" id="3499972">=</span>&nbsp;<span class="ident" id="3499974"><a href="/net/http/transport.go.html#3499762">t</a></span><span class="op" id="3499975">.</span><span class="ident" id="3499976">Proxy</span><span class="op" id="3499981">(</span><span class="ident" id="3499982"><a href="/net/http/transport.go.html#3499800">treq</a></span><span class="op" id="3499986">.</span><span class="ident" id="3499987">Request</span><span class="op" id="3499994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3499997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500000">return</span>&nbsp;<span class="ident" id="3500007"><a href="/net/http/transport.go.html#3499825">cm</a></span><span class="op" id="3500009">,</span>&nbsp;<span class="ident" id="3500011"><a href="/net/http/transport.go.html#3499843">err</a></span><br>
<span class="lineno">340</span><span class="op" id="3500015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3500018">//&nbsp;proxyAuth&nbsp;returns&nbsp;the&nbsp;Proxy-Authorization&nbsp;header&nbsp;to&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="3500077">//&nbsp;on&nbsp;requests,&nbsp;if&nbsp;applicable.</span><br>
<span class="lineno"></span><span class="keyword" id="3500108">func</span>&nbsp;<span class="op" id="3500113">(</span><span class="ident" id="3500114">cm</span>&nbsp;<span class="op" id="3500117">*</span><span class="ident" id="3500118"><a href="/net/http/transport.go.html#3509705">connectMethod</a></span><span class="op" id="3500131">)</span>&nbsp;<span class="ident" id="3500133">proxyAuth</span><span class="op" id="3500142">(</span><span class="op" id="3500143">)</span>&nbsp;<span class="builtintype" id="3500145">string</span>&nbsp;<span class="op" id="3500152">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500155">if</span>&nbsp;<span class="ident" id="3500158"><a href="/net/http/transport.go.html#3500114">cm</a></span><span class="op" id="3500160">.</span><span class="ident" id="3500161">proxyURL</span>&nbsp;<span class="op" id="3500170">==</span>&nbsp;<span class="ident" id="3500173">nil</span>&nbsp;<span class="op" id="3500177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500181">return</span>&nbsp;<span class="string" id="3500188">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3500192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500195">if</span>&nbsp;<span class="ident" id="3500198">u</span>&nbsp;<span class="op" id="3500200">:=</span>&nbsp;<span class="ident" id="3500203"><a href="/net/http/transport.go.html#3500114">cm</a></span><span class="op" id="3500205">.</span><span class="ident" id="3500206">proxyURL</span><span class="op" id="3500214">.</span><span class="ident" id="3500215">User</span><span class="op" id="3500219">;</span>&nbsp;<span class="ident" id="3500221"><a href="/net/http/transport.go.html#3500198">u</a></span>&nbsp;<span class="op" id="3500223">!=</span>&nbsp;<span class="ident" id="3500226">nil</span>&nbsp;<span class="op" id="3500230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3500234">username</span>&nbsp;<span class="op" id="3500243">:=</span>&nbsp;<span class="ident" id="3500246"><a href="/net/http/transport.go.html#3500198">u</a></span><span class="op" id="3500247">.</span><span class="ident" id="3500248">Username</span><span class="op" id="3500256">(</span><span class="op" id="3500257">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3500261">password</span><span class="op" id="3500269">,</span>&nbsp;<span class="ident" id="3500271">_</span>&nbsp;<span class="op" id="3500273">:=</span>&nbsp;<span class="ident" id="3500276"><a href="/net/http/transport.go.html#3500198">u</a></span><span class="op" id="3500277">.</span><span class="ident" id="3500278">Password</span><span class="op" id="3500286">(</span><span class="op" id="3500287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500291">return</span>&nbsp;<span class="string" id="3500298">&#34;Basic&nbsp;&#34;</span>&nbsp;<span class="op" id="3500307">+</span>&nbsp;<span class="ident" id="3500309"><a href="/net/http/client.go.html#3318213">basicAuth</a></span><span class="op" id="3500318">(</span><span class="ident" id="3500319"><a href="/net/http/transport.go.html#3500234">username</a></span><span class="op" id="3500327">,</span>&nbsp;<span class="ident" id="3500329"><a href="/net/http/transport.go.html#3500261">password</a></span><span class="op" id="3500337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3500340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500343">return</span>&nbsp;<span class="string" id="3500350">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3500353">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="comment" id="3500356">//&nbsp;putIdleConn&nbsp;adds&nbsp;pconn&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;idle&nbsp;persistent&nbsp;connections&nbsp;awaiting</span><br>
<span class="lineno"></span><span class="comment" id="3500434">//&nbsp;a&nbsp;new&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3500452">//&nbsp;If&nbsp;pconn&nbsp;is&nbsp;no&nbsp;longer&nbsp;needed&nbsp;or&nbsp;not&nbsp;in&nbsp;a&nbsp;good&nbsp;state,&nbsp;putIdleConn</span><br>
<span class="lineno"></span><span class="comment" id="3500520">//&nbsp;returns&nbsp;false.</span><br>
<span class="lineno">360</span><span class="keyword" id="3500538">func</span>&nbsp;<span class="op" id="3500543">(</span><span class="ident" id="3500544">t</span>&nbsp;<span class="op" id="3500546">*</span><span class="ident" id="3500547"><a href="/net/http/transport.go.html#3491333">Transport</a></span><span class="op" id="3500556">)</span>&nbsp;<span class="ident" id="3500558">putIdleConn</span><span class="op" id="3500569">(</span><span class="ident" id="3500570">pconn</span>&nbsp;<span class="op" id="3500576">*</span><span class="ident" id="3500577"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><span class="op" id="3500588">)</span>&nbsp;<span class="builtintype" id="3500590">bool</span>&nbsp;<span class="op" id="3500595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500598">if</span>&nbsp;<span class="ident" id="3500601"><a href="/net/http/transport.go.html#3500544">t</a></span><span class="op" id="3500602">.</span><span class="ident" id="3500603">DisableKeepAlives</span>&nbsp;<span class="op" id="3500621">||</span>&nbsp;<span class="ident" id="3500624"><a href="/net/http/transport.go.html#3500544">t</a></span><span class="op" id="3500625">.</span><span class="ident" id="3500626">MaxIdleConnsPerHost</span>&nbsp;<span class="op" id="3500646">&lt;</span>&nbsp;<span class="num" id="3500648">0</span>&nbsp;<span class="op" id="3500650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3500654"><a href="/net/http/transport.go.html#3500570">pconn</a></span><span class="op" id="3500659">.</span><span class="builtinfunc" id="3500660">close</span><span class="op" id="3500665">(</span><span class="op" id="3500666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500670">return</span>&nbsp;<span class="builtintype" id="3500677">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3500684">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500687">if</span>&nbsp;<span class="ident" id="3500690"><a href="/net/http/transport.go.html#3500570">pconn</a></span><span class="op" id="3500695">.</span><span class="ident" id="3500696">isBroken</span><span class="op" id="3500704">(</span><span class="op" id="3500705">)</span>&nbsp;<span class="op" id="3500707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500711">return</span>&nbsp;<span class="builtintype" id="3500718">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3500725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3500728">key</span>&nbsp;<span class="op" id="3500732">:=</span>&nbsp;<span class="ident" id="3500735"><a href="/net/http/transport.go.html#3500570">pconn</a></span><span class="op" id="3500740">.</span><span class="ident" id="3500741">cacheKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3500751">max</span>&nbsp;<span class="op" id="3500755">:=</span>&nbsp;<span class="ident" id="3500758"><a href="/net/http/transport.go.html#3500544">t</a></span><span class="op" id="3500759">.</span><span class="ident" id="3500760">MaxIdleConnsPerHost</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500781">if</span>&nbsp;<span class="ident" id="3500784"><a href="/net/http/transport.go.html#3500751">max</a></span>&nbsp;<span class="op" id="3500788">==</span>&nbsp;<span class="num" id="3500791">0</span>&nbsp;<span class="op" id="3500793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3500797"><a href="/net/http/transport.go.html#3500751">max</a></span>&nbsp;<span class="op" id="3500801">=</span>&nbsp;<span class="ident" id="3500803"><a href="/net/http/transport.go.html#3491099">DefaultMaxIdleConnsPerHost</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3500831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3500834"><a href="/net/http/transport.go.html#3500544">t</a></span><span class="op" id="3500835">.</span><span class="ident" id="3500836">idleMu</span><span class="op" id="3500842">.</span><span class="ident" id="3500843">Lock</span><span class="op" id="3500847">(</span><span class="op" id="3500848">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3500852">waitingDialer</span>&nbsp;<span class="op" id="3500866">:=</span>&nbsp;<span class="ident" id="3500869"><a href="/net/http/transport.go.html#3500544">t</a></span><span class="op" id="3500870">.</span><span class="ident" id="3500871">idleConnCh</span><span class="op" id="3500881">[</span><span class="ident" id="3500882"><a href="/net/http/transport.go.html#3500728">key</a></span><span class="op" id="3500885">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500888">select</span>&nbsp;<span class="op" id="3500895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500898">case</span>&nbsp;<span class="ident" id="3500903"><a href="/net/http/transport.go.html#3500852">waitingDialer</a></span>&nbsp;<span class="op" id="3500917">&lt;-</span>&nbsp;<span class="ident" id="3500920"><a href="/net/http/transport.go.html#3500570">pconn</a></span><span class="op" id="3500925">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3500929">//&nbsp;We&#39;re&nbsp;done&nbsp;with&nbsp;this&nbsp;pconn&nbsp;and&nbsp;somebody&nbsp;else&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3500982">//&nbsp;currently&nbsp;waiting&nbsp;for&nbsp;a&nbsp;conn&nbsp;of&nbsp;this&nbsp;type&nbsp;(they&#39;re</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3501038">//&nbsp;actively&nbsp;dialing,&nbsp;but&nbsp;this&nbsp;conn&nbsp;is&nbsp;ready</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3501084">//&nbsp;first).&nbsp;Chrome&nbsp;calls&nbsp;this&nbsp;socket&nbsp;late&nbsp;binding.&nbsp;&nbsp;See</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3501141">//&nbsp;https://insouciant.org/tech/connection-management-in-chromium/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501209"><a href="/net/http/transport.go.html#3500544">t</a></span><span class="op" id="3501210">.</span><span class="ident" id="3501211">idleMu</span><span class="op" id="3501217">.</span><span class="ident" id="3501218">Unlock</span><span class="op" id="3501224">(</span><span class="op" id="3501225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501229">return</span>&nbsp;<span class="builtintype" id="3501236">true</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501242">default</span><span class="op" id="3501249">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501253">if</span>&nbsp;<span class="ident" id="3501256"><a href="/net/http/transport.go.html#3500852">waitingDialer</a></span>&nbsp;<span class="op" id="3501270">!=</span>&nbsp;<span class="ident" id="3501273">nil</span>&nbsp;<span class="op" id="3501277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3501282">//&nbsp;They&nbsp;had&nbsp;populated&nbsp;this,&nbsp;but&nbsp;their&nbsp;dial&nbsp;won</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3501332">//&nbsp;first,&nbsp;so&nbsp;we&nbsp;can&nbsp;clean&nbsp;up&nbsp;this&nbsp;map&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3501380">delete</span><span class="op" id="3501386">(</span><span class="ident" id="3501387"><a href="/net/http/transport.go.html#3500544">t</a></span><span class="op" id="3501388">.</span><span class="ident" id="3501389">idleConnCh</span><span class="op" id="3501399">,</span>&nbsp;<span class="ident" id="3501401"><a href="/net/http/transport.go.html#3500728">key</a></span><span class="op" id="3501404">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3501408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3501411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501414">if</span>&nbsp;<span class="ident" id="3501417"><a href="/net/http/transport.go.html#3500544">t</a></span><span class="op" id="3501418">.</span><span class="ident" id="3501419">wantIdle</span>&nbsp;<span class="op" id="3501428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501432"><a href="/net/http/transport.go.html#3500544">t</a></span><span class="op" id="3501433">.</span><span class="ident" id="3501434">idleMu</span><span class="op" id="3501440">.</span><span class="ident" id="3501441">Unlock</span><span class="op" id="3501447">(</span><span class="op" id="3501448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501452"><a href="/net/http/transport.go.html#3500570">pconn</a></span><span class="op" id="3501457">.</span><span class="builtinfunc" id="3501458">close</span><span class="op" id="3501463">(</span><span class="op" id="3501464">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501468">return</span>&nbsp;<span class="builtintype" id="3501475">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3501482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501485">if</span>&nbsp;<span class="ident" id="3501488"><a href="/net/http/transport.go.html#3500544">t</a></span><span class="op" id="3501489">.</span><span class="ident" id="3501490">idleConn</span>&nbsp;<span class="op" id="3501499">==</span>&nbsp;<span class="ident" id="3501502">nil</span>&nbsp;<span class="op" id="3501506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501510"><a href="/net/http/transport.go.html#3500544">t</a></span><span class="op" id="3501511">.</span><span class="ident" id="3501512">idleConn</span>&nbsp;<span class="op" id="3501521">=</span>&nbsp;<span class="builtinfunc" id="3501523">make</span><span class="op" id="3501527">(</span><span class="keyword" id="3501528">map</span><span class="op" id="3501531">[</span><span class="ident" id="3501532"><a href="/net/http/transport.go.html#3510813">connectMethodKey</a></span><span class="op" id="3501548">]</span><span class="op" id="3501549">[</span><span class="op" id="3501550">]</span><span class="op" id="3501551">*</span><span class="ident" id="3501552"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><span class="op" id="3501563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3501566">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501569">if</span>&nbsp;<span class="builtinfunc" id="3501572">len</span><span class="op" id="3501575">(</span><span class="ident" id="3501576"><a href="/net/http/transport.go.html#3500544">t</a></span><span class="op" id="3501577">.</span><span class="ident" id="3501578">idleConn</span><span class="op" id="3501586">[</span><span class="ident" id="3501587"><a href="/net/http/transport.go.html#3500728">key</a></span><span class="op" id="3501590">]</span><span class="op" id="3501591">)</span>&nbsp;<span class="op" id="3501593">&gt;=</span>&nbsp;<span class="ident" id="3501596"><a href="/net/http/transport.go.html#3500751">max</a></span>&nbsp;<span class="op" id="3501600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501604"><a href="/net/http/transport.go.html#3500544">t</a></span><span class="op" id="3501605">.</span><span class="ident" id="3501606">idleMu</span><span class="op" id="3501612">.</span><span class="ident" id="3501613">Unlock</span><span class="op" id="3501619">(</span><span class="op" id="3501620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501624"><a href="/net/http/transport.go.html#3500570">pconn</a></span><span class="op" id="3501629">.</span><span class="builtinfunc" id="3501630">close</span><span class="op" id="3501635">(</span><span class="op" id="3501636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501640">return</span>&nbsp;<span class="builtintype" id="3501647">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3501654">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501657">for</span>&nbsp;<span class="ident" id="3501661">_</span><span class="op" id="3501662">,</span>&nbsp;<span class="ident" id="3501664">exist</span>&nbsp;<span class="op" id="3501670">:=</span>&nbsp;<span class="keyword" id="3501673">range</span>&nbsp;<span class="ident" id="3501679"><a href="/net/http/transport.go.html#3500544">t</a></span><span class="op" id="3501680">.</span><span class="ident" id="3501681">idleConn</span><span class="op" id="3501689">[</span><span class="ident" id="3501690"><a href="/net/http/transport.go.html#3500728">key</a></span><span class="op" id="3501693">]</span>&nbsp;<span class="op" id="3501695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501699">if</span>&nbsp;<span class="ident" id="3501702"><a href="/net/http/transport.go.html#3501664">exist</a></span>&nbsp;<span class="op" id="3501708">==</span>&nbsp;<span class="ident" id="3501711"><a href="/net/http/transport.go.html#3500570">pconn</a></span>&nbsp;<span class="op" id="3501717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501722"><a href="/net/http/transport.go.html#3490412">log</a></span><span class="op" id="3501725">.</span><span class="ident" id="3501726">Fatalf</span><span class="op" id="3501732">(</span><span class="string" id="3501733">&#34;dup&nbsp;idle&nbsp;pconn&nbsp;%p&nbsp;in&nbsp;freelist&#34;</span><span class="op" id="3501764">,</span>&nbsp;<span class="ident" id="3501766"><a href="/net/http/transport.go.html#3500570">pconn</a></span><span class="op" id="3501771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3501775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3501778">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501781"><a href="/net/http/transport.go.html#3500544">t</a></span><span class="op" id="3501782">.</span><span class="ident" id="3501783">idleConn</span><span class="op" id="3501791">[</span><span class="ident" id="3501792"><a href="/net/http/transport.go.html#3500728">key</a></span><span class="op" id="3501795">]</span>&nbsp;<span class="op" id="3501797">=</span>&nbsp;<span class="builtinfunc" id="3501799">append</span><span class="op" id="3501805">(</span><span class="ident" id="3501806"><a href="/net/http/transport.go.html#3500544">t</a></span><span class="op" id="3501807">.</span><span class="ident" id="3501808">idleConn</span><span class="op" id="3501816">[</span><span class="ident" id="3501817"><a href="/net/http/transport.go.html#3500728">key</a></span><span class="op" id="3501820">]</span><span class="op" id="3501821">,</span>&nbsp;<span class="ident" id="3501823"><a href="/net/http/transport.go.html#3500570">pconn</a></span><span class="op" id="3501828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501831"><a href="/net/http/transport.go.html#3500544">t</a></span><span class="op" id="3501832">.</span><span class="ident" id="3501833">idleMu</span><span class="op" id="3501839">.</span><span class="ident" id="3501840">Unlock</span><span class="op" id="3501846">(</span><span class="op" id="3501847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501850">return</span>&nbsp;<span class="builtintype" id="3501857">true</span><br>
<span class="lineno"></span><span class="op" id="3501862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="3501865">//&nbsp;getIdleConnCh&nbsp;returns&nbsp;a&nbsp;channel&nbsp;to&nbsp;receive&nbsp;and&nbsp;return&nbsp;idle</span><br>
<span class="lineno"></span><span class="comment" id="3501927">//&nbsp;persistent&nbsp;connection&nbsp;for&nbsp;the&nbsp;given&nbsp;connectMethod.</span><br>
<span class="lineno"></span><span class="comment" id="3501981">//&nbsp;It&nbsp;may&nbsp;return&nbsp;nil,&nbsp;if&nbsp;persistent&nbsp;connections&nbsp;are&nbsp;not&nbsp;being&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3502049">func</span>&nbsp;<span class="op" id="3502054">(</span><span class="ident" id="3502055">t</span>&nbsp;<span class="op" id="3502057">*</span><span class="ident" id="3502058"><a href="/net/http/transport.go.html#3491333">Transport</a></span><span class="op" id="3502067">)</span>&nbsp;<span class="ident" id="3502069">getIdleConnCh</span><span class="op" id="3502082">(</span><span class="ident" id="3502083">cm</span>&nbsp;<span class="ident" id="3502086"><a href="/net/http/transport.go.html#3509705">connectMethod</a></span><span class="op" id="3502099">)</span>&nbsp;<span class="keyword" id="3502101">chan</span>&nbsp;<span class="op" id="3502106">*</span><span class="ident" id="3502107"><a href="/net/http/transport.go.html#3511122">persistConn</a></span>&nbsp;<span class="op" id="3502119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502122">if</span>&nbsp;<span class="ident" id="3502125"><a href="/net/http/transport.go.html#3502055">t</a></span><span class="op" id="3502126">.</span><span class="ident" id="3502127">DisableKeepAlives</span>&nbsp;<span class="op" id="3502145">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502149">return</span>&nbsp;<span class="ident" id="3502156">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3502161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502164">key</span>&nbsp;<span class="op" id="3502168">:=</span>&nbsp;<span class="ident" id="3502171"><a href="/net/http/transport.go.html#3502083">cm</a></span><span class="op" id="3502173">.</span><span class="ident" id="3502174">key</span><span class="op" id="3502177">(</span><span class="op" id="3502178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502181"><a href="/net/http/transport.go.html#3502055">t</a></span><span class="op" id="3502182">.</span><span class="ident" id="3502183">idleMu</span><span class="op" id="3502189">.</span><span class="ident" id="3502190">Lock</span><span class="op" id="3502194">(</span><span class="op" id="3502195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502198">defer</span>&nbsp;<span class="ident" id="3502204"><a href="/net/http/transport.go.html#3502055">t</a></span><span class="op" id="3502205">.</span><span class="ident" id="3502206">idleMu</span><span class="op" id="3502212">.</span><span class="ident" id="3502213">Unlock</span><span class="op" id="3502219">(</span><span class="op" id="3502220">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502223"><a href="/net/http/transport.go.html#3502055">t</a></span><span class="op" id="3502224">.</span><span class="ident" id="3502225">wantIdle</span>&nbsp;<span class="op" id="3502234">=</span>&nbsp;<span class="builtintype" id="3502236">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502243">if</span>&nbsp;<span class="ident" id="3502246"><a href="/net/http/transport.go.html#3502055">t</a></span><span class="op" id="3502247">.</span><span class="ident" id="3502248">idleConnCh</span>&nbsp;<span class="op" id="3502259">==</span>&nbsp;<span class="ident" id="3502262">nil</span>&nbsp;<span class="op" id="3502266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502270"><a href="/net/http/transport.go.html#3502055">t</a></span><span class="op" id="3502271">.</span><span class="ident" id="3502272">idleConnCh</span>&nbsp;<span class="op" id="3502283">=</span>&nbsp;<span class="builtinfunc" id="3502285">make</span><span class="op" id="3502289">(</span><span class="keyword" id="3502290">map</span><span class="op" id="3502293">[</span><span class="ident" id="3502294"><a href="/net/http/transport.go.html#3510813">connectMethodKey</a></span><span class="op" id="3502310">]</span><span class="keyword" id="3502311">chan</span>&nbsp;<span class="op" id="3502316">*</span><span class="ident" id="3502317"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><span class="op" id="3502328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3502331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502334">ch</span><span class="op" id="3502336">,</span>&nbsp;<span class="ident" id="3502338">ok</span>&nbsp;<span class="op" id="3502341">:=</span>&nbsp;<span class="ident" id="3502344"><a href="/net/http/transport.go.html#3502055">t</a></span><span class="op" id="3502345">.</span><span class="ident" id="3502346">idleConnCh</span><span class="op" id="3502356">[</span><span class="ident" id="3502357"><a href="/net/http/transport.go.html#3502164">key</a></span><span class="op" id="3502360">]</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502363">if</span>&nbsp;<span class="op" id="3502366">!</span><span class="ident" id="3502367"><a href="/net/http/transport.go.html#3502338">ok</a></span>&nbsp;<span class="op" id="3502370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502374"><a href="/net/http/transport.go.html#3502334">ch</a></span>&nbsp;<span class="op" id="3502377">=</span>&nbsp;<span class="builtinfunc" id="3502379">make</span><span class="op" id="3502383">(</span><span class="keyword" id="3502384">chan</span>&nbsp;<span class="op" id="3502389">*</span><span class="ident" id="3502390"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><span class="op" id="3502401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502405"><a href="/net/http/transport.go.html#3502055">t</a></span><span class="op" id="3502406">.</span><span class="ident" id="3502407">idleConnCh</span><span class="op" id="3502417">[</span><span class="ident" id="3502418"><a href="/net/http/transport.go.html#3502164">key</a></span><span class="op" id="3502421">]</span>&nbsp;<span class="op" id="3502423">=</span>&nbsp;<span class="ident" id="3502425"><a href="/net/http/transport.go.html#3502334">ch</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3502429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502432">return</span>&nbsp;<span class="ident" id="3502439"><a href="/net/http/transport.go.html#3502334">ch</a></span><br>
<span class="lineno">435</span><span class="op" id="3502442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3502445">func</span>&nbsp;<span class="op" id="3502450">(</span><span class="ident" id="3502451">t</span>&nbsp;<span class="op" id="3502453">*</span><span class="ident" id="3502454"><a href="/net/http/transport.go.html#3491333">Transport</a></span><span class="op" id="3502463">)</span>&nbsp;<span class="ident" id="3502465">getIdleConn</span><span class="op" id="3502476">(</span><span class="ident" id="3502477">cm</span>&nbsp;<span class="ident" id="3502480"><a href="/net/http/transport.go.html#3509705">connectMethod</a></span><span class="op" id="3502493">)</span>&nbsp;<span class="op" id="3502495">(</span><span class="ident" id="3502496">pconn</span>&nbsp;<span class="op" id="3502502">*</span><span class="ident" id="3502503"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><span class="op" id="3502514">)</span>&nbsp;<span class="op" id="3502516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502519">key</span>&nbsp;<span class="op" id="3502523">:=</span>&nbsp;<span class="ident" id="3502526"><a href="/net/http/transport.go.html#3502477">cm</a></span><span class="op" id="3502528">.</span><span class="ident" id="3502529">key</span><span class="op" id="3502532">(</span><span class="op" id="3502533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502536"><a href="/net/http/transport.go.html#3502451">t</a></span><span class="op" id="3502537">.</span><span class="ident" id="3502538">idleMu</span><span class="op" id="3502544">.</span><span class="ident" id="3502545">Lock</span><span class="op" id="3502549">(</span><span class="op" id="3502550">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502553">defer</span>&nbsp;<span class="ident" id="3502559"><a href="/net/http/transport.go.html#3502451">t</a></span><span class="op" id="3502560">.</span><span class="ident" id="3502561">idleMu</span><span class="op" id="3502567">.</span><span class="ident" id="3502568">Unlock</span><span class="op" id="3502574">(</span><span class="op" id="3502575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502578">if</span>&nbsp;<span class="ident" id="3502581"><a href="/net/http/transport.go.html#3502451">t</a></span><span class="op" id="3502582">.</span><span class="ident" id="3502583">idleConn</span>&nbsp;<span class="op" id="3502592">==</span>&nbsp;<span class="ident" id="3502595">nil</span>&nbsp;<span class="op" id="3502599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502603">return</span>&nbsp;<span class="ident" id="3502610">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3502615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502618">for</span>&nbsp;<span class="op" id="3502622">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502626">pconns</span><span class="op" id="3502632">,</span>&nbsp;<span class="ident" id="3502634">ok</span>&nbsp;<span class="op" id="3502637">:=</span>&nbsp;<span class="ident" id="3502640"><a href="/net/http/transport.go.html#3502451">t</a></span><span class="op" id="3502641">.</span><span class="ident" id="3502642">idleConn</span><span class="op" id="3502650">[</span><span class="ident" id="3502651"><a href="/net/http/transport.go.html#3502519">key</a></span><span class="op" id="3502654">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502658">if</span>&nbsp;<span class="op" id="3502661">!</span><span class="ident" id="3502662"><a href="/net/http/transport.go.html#3502634">ok</a></span>&nbsp;<span class="op" id="3502665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502670">return</span>&nbsp;<span class="ident" id="3502677">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3502683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502687">if</span>&nbsp;<span class="builtinfunc" id="3502690">len</span><span class="op" id="3502693">(</span><span class="ident" id="3502694"><a href="/net/http/transport.go.html#3502626">pconns</a></span><span class="op" id="3502700">)</span>&nbsp;<span class="op" id="3502702">==</span>&nbsp;<span class="num" id="3502705">1</span>&nbsp;<span class="op" id="3502707">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502712"><a href="/net/http/transport.go.html#3502496">pconn</a></span>&nbsp;<span class="op" id="3502718">=</span>&nbsp;<span class="ident" id="3502720"><a href="/net/http/transport.go.html#3502626">pconns</a></span><span class="op" id="3502726">[</span><span class="num" id="3502727">0</span><span class="op" id="3502728">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3502733">delete</span><span class="op" id="3502739">(</span><span class="ident" id="3502740"><a href="/net/http/transport.go.html#3502451">t</a></span><span class="op" id="3502741">.</span><span class="ident" id="3502742">idleConn</span><span class="op" id="3502750">,</span>&nbsp;<span class="ident" id="3502752"><a href="/net/http/transport.go.html#3502519">key</a></span><span class="op" id="3502755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3502759">}</span>&nbsp;<span class="keyword" id="3502761">else</span>&nbsp;<span class="op" id="3502766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3502771">//&nbsp;2&nbsp;or&nbsp;more&nbsp;cached&nbsp;connections;&nbsp;pop&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3502816">//&nbsp;TODO:&nbsp;queue?</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502835"><a href="/net/http/transport.go.html#3502496">pconn</a></span>&nbsp;<span class="op" id="3502841">=</span>&nbsp;<span class="ident" id="3502843"><a href="/net/http/transport.go.html#3502626">pconns</a></span><span class="op" id="3502849">[</span><span class="builtinfunc" id="3502850">len</span><span class="op" id="3502853">(</span><span class="ident" id="3502854"><a href="/net/http/transport.go.html#3502626">pconns</a></span><span class="op" id="3502860">)</span><span class="op" id="3502861">-</span><span class="num" id="3502862">1</span><span class="op" id="3502863">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502868"><a href="/net/http/transport.go.html#3502451">t</a></span><span class="op" id="3502869">.</span><span class="ident" id="3502870">idleConn</span><span class="op" id="3502878">[</span><span class="ident" id="3502879"><a href="/net/http/transport.go.html#3502519">key</a></span><span class="op" id="3502882">]</span>&nbsp;<span class="op" id="3502884">=</span>&nbsp;<span class="ident" id="3502886"><a href="/net/http/transport.go.html#3502626">pconns</a></span><span class="op" id="3502892">[</span><span class="op" id="3502893">:</span><span class="builtinfunc" id="3502894">len</span><span class="op" id="3502897">(</span><span class="ident" id="3502898"><a href="/net/http/transport.go.html#3502626">pconns</a></span><span class="op" id="3502904">)</span><span class="op" id="3502905">-</span><span class="num" id="3502906">1</span><span class="op" id="3502907">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3502911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502915">if</span>&nbsp;<span class="op" id="3502918">!</span><span class="ident" id="3502919"><a href="/net/http/transport.go.html#3502496">pconn</a></span><span class="op" id="3502924">.</span><span class="ident" id="3502925">isBroken</span><span class="op" id="3502933">(</span><span class="op" id="3502934">)</span>&nbsp;<span class="op" id="3502936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502941">return</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3502950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3502953">}</span><br>
<span class="lineno"></span><span class="op" id="3502955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3502958">func</span>&nbsp;<span class="op" id="3502963">(</span><span class="ident" id="3502964">t</span>&nbsp;<span class="op" id="3502966">*</span><span class="ident" id="3502967"><a href="/net/http/transport.go.html#3491333">Transport</a></span><span class="op" id="3502976">)</span>&nbsp;<span class="ident" id="3502978">setReqCanceler</span><span class="op" id="3502992">(</span><span class="ident" id="3502993">r</span>&nbsp;<span class="op" id="3502995">*</span><span class="ident" id="3502996"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3503003">,</span>&nbsp;<span class="ident" id="3503005">fn</span>&nbsp;<span class="keyword" id="3503008">func</span><span class="op" id="3503012">(</span><span class="op" id="3503013">)</span><span class="op" id="3503014">)</span>&nbsp;<span class="op" id="3503016">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503019"><a href="/net/http/transport.go.html#3502964">t</a></span><span class="op" id="3503020">.</span><span class="ident" id="3503021">reqMu</span><span class="op" id="3503026">.</span><span class="ident" id="3503027">Lock</span><span class="op" id="3503031">(</span><span class="op" id="3503032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503035">defer</span>&nbsp;<span class="ident" id="3503041"><a href="/net/http/transport.go.html#3502964">t</a></span><span class="op" id="3503042">.</span><span class="ident" id="3503043">reqMu</span><span class="op" id="3503048">.</span><span class="ident" id="3503049">Unlock</span><span class="op" id="3503055">(</span><span class="op" id="3503056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503059">if</span>&nbsp;<span class="ident" id="3503062"><a href="/net/http/transport.go.html#3502964">t</a></span><span class="op" id="3503063">.</span><span class="ident" id="3503064">reqCanceler</span>&nbsp;<span class="op" id="3503076">==</span>&nbsp;<span class="ident" id="3503079">nil</span>&nbsp;<span class="op" id="3503083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503087"><a href="/net/http/transport.go.html#3502964">t</a></span><span class="op" id="3503088">.</span><span class="ident" id="3503089">reqCanceler</span>&nbsp;<span class="op" id="3503101">=</span>&nbsp;<span class="builtinfunc" id="3503103">make</span><span class="op" id="3503107">(</span><span class="keyword" id="3503108">map</span><span class="op" id="3503111">[</span><span class="op" id="3503112">*</span><span class="ident" id="3503113"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3503120">]</span><span class="keyword" id="3503121">func</span><span class="op" id="3503125">(</span><span class="op" id="3503126">)</span><span class="op" id="3503127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503130">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503133">if</span>&nbsp;<span class="ident" id="3503136"><a href="/net/http/transport.go.html#3503005">fn</a></span>&nbsp;<span class="op" id="3503139">!=</span>&nbsp;<span class="ident" id="3503142">nil</span>&nbsp;<span class="op" id="3503146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503150"><a href="/net/http/transport.go.html#3502964">t</a></span><span class="op" id="3503151">.</span><span class="ident" id="3503152">reqCanceler</span><span class="op" id="3503163">[</span><span class="ident" id="3503164"><a href="/net/http/transport.go.html#3502993">r</a></span><span class="op" id="3503165">]</span>&nbsp;<span class="op" id="3503167">=</span>&nbsp;<span class="ident" id="3503169"><a href="/net/http/transport.go.html#3503005">fn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503173">}</span>&nbsp;<span class="keyword" id="3503175">else</span>&nbsp;<span class="op" id="3503180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3503184">delete</span><span class="op" id="3503190">(</span><span class="ident" id="3503191"><a href="/net/http/transport.go.html#3502964">t</a></span><span class="op" id="3503192">.</span><span class="ident" id="3503193">reqCanceler</span><span class="op" id="3503204">,</span>&nbsp;<span class="ident" id="3503206"><a href="/net/http/transport.go.html#3502993">r</a></span><span class="op" id="3503207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503210">}</span><br>
<span class="lineno">475</span><span class="op" id="3503212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3503215">func</span>&nbsp;<span class="op" id="3503220">(</span><span class="ident" id="3503221">t</span>&nbsp;<span class="op" id="3503223">*</span><span class="ident" id="3503224"><a href="/net/http/transport.go.html#3491333">Transport</a></span><span class="op" id="3503233">)</span>&nbsp;<span class="ident" id="3503235">dial</span><span class="op" id="3503239">(</span><span class="ident" id="3503240">network</span><span class="op" id="3503247">,</span>&nbsp;<span class="ident" id="3503249">addr</span>&nbsp;<span class="builtintype" id="3503254">string</span><span class="op" id="3503260">)</span>&nbsp;<span class="op" id="3503262">(</span><span class="ident" id="3503263">c</span>&nbsp;<span class="ident" id="3503265"><a href="/net/http/transport.go.html#3490419">net</a></span><span class="op" id="3503268">.</span><span class="ident" id="3503269">Conn</span><span class="op" id="3503273">,</span>&nbsp;<span class="ident" id="3503275">err</span>&nbsp;<span class="builtintype" id="3503279">error</span><span class="op" id="3503284">)</span>&nbsp;<span class="op" id="3503286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503289">if</span>&nbsp;<span class="ident" id="3503292"><a href="/net/http/transport.go.html#3503221">t</a></span><span class="op" id="3503293">.</span><span class="ident" id="3503294">Dial</span>&nbsp;<span class="op" id="3503299">!=</span>&nbsp;<span class="ident" id="3503302">nil</span>&nbsp;<span class="op" id="3503306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503310">return</span>&nbsp;<span class="ident" id="3503317"><a href="/net/http/transport.go.html#3503221">t</a></span><span class="op" id="3503318">.</span><span class="ident" id="3503319">Dial</span><span class="op" id="3503323">(</span><span class="ident" id="3503324"><a href="/net/http/transport.go.html#3503240">network</a></span><span class="op" id="3503331">,</span>&nbsp;<span class="ident" id="3503333"><a href="/net/http/transport.go.html#3503249">addr</a></span><span class="op" id="3503337">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503343">return</span>&nbsp;<span class="ident" id="3503350"><a href="/net/http/transport.go.html#3490419">net</a></span><span class="op" id="3503353">.</span><span class="ident" id="3503354">Dial</span><span class="op" id="3503358">(</span><span class="ident" id="3503359"><a href="/net/http/transport.go.html#3503240">network</a></span><span class="op" id="3503366">,</span>&nbsp;<span class="ident" id="3503368"><a href="/net/http/transport.go.html#3503249">addr</a></span><span class="op" id="3503372">)</span><br>
<span class="lineno"></span><span class="op" id="3503374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3503377">//&nbsp;Testing&nbsp;hooks:</span><br>
<span class="lineno">485</span><span class="keyword" id="3503395">var</span>&nbsp;<span class="ident" id="3503399">prePendingDial</span><span class="op" id="3503413">,</span>&nbsp;<span class="ident" id="3503415">postPendingDial</span>&nbsp;<span class="keyword" id="3503431">func</span><span class="op" id="3503435">(</span><span class="op" id="3503436">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3503439">//&nbsp;getConn&nbsp;dials&nbsp;and&nbsp;creates&nbsp;a&nbsp;new&nbsp;persistConn&nbsp;to&nbsp;the&nbsp;target&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3503503">//&nbsp;specified&nbsp;in&nbsp;the&nbsp;connectMethod.&nbsp;&nbsp;This&nbsp;includes&nbsp;doing&nbsp;a&nbsp;proxy&nbsp;CONNECT</span><br>
<span class="lineno"></span><span class="comment" id="3503575">//&nbsp;and/or&nbsp;setting&nbsp;up&nbsp;TLS.&nbsp;&nbsp;If&nbsp;this&nbsp;doesn&#39;t&nbsp;return&nbsp;an&nbsp;error,&nbsp;the&nbsp;persistConn</span><br>
<span class="lineno">490</span><span class="comment" id="3503651">//&nbsp;is&nbsp;ready&nbsp;to&nbsp;write&nbsp;requests&nbsp;to.</span><br>
<span class="lineno"></span><span class="keyword" id="3503685">func</span>&nbsp;<span class="op" id="3503690">(</span><span class="ident" id="3503691">t</span>&nbsp;<span class="op" id="3503693">*</span><span class="ident" id="3503694"><a href="/net/http/transport.go.html#3491333">Transport</a></span><span class="op" id="3503703">)</span>&nbsp;<span class="ident" id="3503705">getConn</span><span class="op" id="3503712">(</span><span class="ident" id="3503713">req</span>&nbsp;<span class="op" id="3503717">*</span><span class="ident" id="3503718"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3503725">,</span>&nbsp;<span class="ident" id="3503727">cm</span>&nbsp;<span class="ident" id="3503730"><a href="/net/http/transport.go.html#3509705">connectMethod</a></span><span class="op" id="3503743">)</span>&nbsp;<span class="op" id="3503745">(</span><span class="op" id="3503746">*</span><span class="ident" id="3503747"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><span class="op" id="3503758">,</span>&nbsp;<span class="builtintype" id="3503760">error</span><span class="op" id="3503765">)</span>&nbsp;<span class="op" id="3503767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503770">if</span>&nbsp;<span class="ident" id="3503773">pc</span>&nbsp;<span class="op" id="3503776">:=</span>&nbsp;<span class="ident" id="3503779"><a href="/net/http/transport.go.html#3503691">t</a></span><span class="op" id="3503780">.</span><span class="ident" id="3503781">getIdleConn</span><span class="op" id="3503792">(</span><span class="ident" id="3503793"><a href="/net/http/transport.go.html#3503727">cm</a></span><span class="op" id="3503795">)</span><span class="op" id="3503796">;</span>&nbsp;<span class="ident" id="3503798"><a href="/net/http/transport.go.html#3503773">pc</a></span>&nbsp;<span class="op" id="3503801">!=</span>&nbsp;<span class="ident" id="3503804">nil</span>&nbsp;<span class="op" id="3503808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503812">return</span>&nbsp;<span class="ident" id="3503819"><a href="/net/http/transport.go.html#3503773">pc</a></span><span class="op" id="3503821">,</span>&nbsp;<span class="ident" id="3503823">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503828">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503832">type</span>&nbsp;<span class="ident" id="3503837">dialRes</span>&nbsp;<span class="keyword" id="3503845">struct</span>&nbsp;<span class="op" id="3503852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503856">pc</span>&nbsp;&nbsp;<span class="op" id="3503860">*</span><span class="ident" id="3503861"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503875">err</span>&nbsp;<span class="builtintype" id="3503879">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503886">}</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503889">dialc</span>&nbsp;<span class="op" id="3503895">:=</span>&nbsp;<span class="builtinfunc" id="3503898">make</span><span class="op" id="3503902">(</span><span class="keyword" id="3503903">chan</span>&nbsp;<span class="ident" id="3503908"><a href="/net/http/transport.go.html#3503837">dialRes</a></span><span class="op" id="3503915">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503919">handlePendingDial</span>&nbsp;<span class="op" id="3503937">:=</span>&nbsp;<span class="keyword" id="3503940">func</span><span class="op" id="3503944">(</span><span class="op" id="3503945">)</span>&nbsp;<span class="op" id="3503947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503951">if</span>&nbsp;<span class="ident" id="3503954"><a href="/net/http/transport.go.html#3503399">prePendingDial</a></span>&nbsp;<span class="op" id="3503969">!=</span>&nbsp;<span class="ident" id="3503972">nil</span>&nbsp;<span class="op" id="3503976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503981"><a href="/net/http/transport.go.html#3503399">prePendingDial</a></span><span class="op" id="3503995">(</span><span class="op" id="3503996">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3504000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504004">go</span>&nbsp;<span class="keyword" id="3504007">func</span><span class="op" id="3504011">(</span><span class="op" id="3504012">)</span>&nbsp;<span class="op" id="3504014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504019">if</span>&nbsp;<span class="ident" id="3504022">v</span>&nbsp;<span class="op" id="3504024">:=</span>&nbsp;<span class="op" id="3504027">&lt;-</span><span class="ident" id="3504029"><a href="/net/http/transport.go.html#3503889">dialc</a></span><span class="op" id="3504034">;</span>&nbsp;<span class="ident" id="3504036"><a href="/net/http/transport.go.html#3504022">v</a></span><span class="op" id="3504037">.</span><span class="ident" id="3504038">err</span>&nbsp;<span class="op" id="3504042">==</span>&nbsp;<span class="ident" id="3504045">nil</span>&nbsp;<span class="op" id="3504049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3504055"><a href="/net/http/transport.go.html#3503691">t</a></span><span class="op" id="3504056">.</span><span class="ident" id="3504057">putIdleConn</span><span class="op" id="3504068">(</span><span class="ident" id="3504069"><a href="/net/http/transport.go.html#3504022">v</a></span><span class="op" id="3504070">.</span><span class="ident" id="3504071">pc</span><span class="op" id="3504073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3504078">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504083">if</span>&nbsp;<span class="ident" id="3504086"><a href="/net/http/transport.go.html#3503415">postPendingDial</a></span>&nbsp;<span class="op" id="3504102">!=</span>&nbsp;<span class="ident" id="3504105">nil</span>&nbsp;<span class="op" id="3504109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3504115"><a href="/net/http/transport.go.html#3503415">postPendingDial</a></span><span class="op" id="3504130">(</span><span class="op" id="3504131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3504136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3504140">}</span><span class="op" id="3504141">(</span><span class="op" id="3504142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3504145">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3504149">cancelc</span>&nbsp;<span class="op" id="3504157">:=</span>&nbsp;<span class="builtinfunc" id="3504160">make</span><span class="op" id="3504164">(</span><span class="keyword" id="3504165">chan</span>&nbsp;<span class="keyword" id="3504170">struct</span><span class="op" id="3504176">{</span><span class="op" id="3504177">}</span><span class="op" id="3504178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3504181"><a href="/net/http/transport.go.html#3503691">t</a></span><span class="op" id="3504182">.</span><span class="ident" id="3504183">setReqCanceler</span><span class="op" id="3504197">(</span><span class="ident" id="3504198"><a href="/net/http/transport.go.html#3503713">req</a></span><span class="op" id="3504201">,</span>&nbsp;<span class="keyword" id="3504203">func</span><span class="op" id="3504207">(</span><span class="op" id="3504208">)</span>&nbsp;<span class="op" id="3504210">{</span>&nbsp;<span class="builtinfunc" id="3504212">close</span><span class="op" id="3504217">(</span><span class="ident" id="3504218"><a href="/net/http/transport.go.html#3504149">cancelc</a></span><span class="op" id="3504225">)</span>&nbsp;<span class="op" id="3504227">}</span><span class="op" id="3504228">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504232">go</span>&nbsp;<span class="keyword" id="3504235">func</span><span class="op" id="3504239">(</span><span class="op" id="3504240">)</span>&nbsp;<span class="op" id="3504242">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3504246">pc</span><span class="op" id="3504248">,</span>&nbsp;<span class="ident" id="3504250">err</span>&nbsp;<span class="op" id="3504254">:=</span>&nbsp;<span class="ident" id="3504257"><a href="/net/http/transport.go.html#3503691">t</a></span><span class="op" id="3504258">.</span><span class="ident" id="3504259">dialConn</span><span class="op" id="3504267">(</span><span class="ident" id="3504268"><a href="/net/http/transport.go.html#3503727">cm</a></span><span class="op" id="3504270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3504274"><a href="/net/http/transport.go.html#3503889">dialc</a></span>&nbsp;<span class="op" id="3504280">&lt;-</span>&nbsp;<span class="ident" id="3504283"><a href="/net/http/transport.go.html#3503837">dialRes</a></span><span class="op" id="3504290">{</span><span class="ident" id="3504291"><a href="/net/http/transport.go.html#3504246">pc</a></span><span class="op" id="3504293">,</span>&nbsp;<span class="ident" id="3504295"><a href="/net/http/transport.go.html#3504250">err</a></span><span class="op" id="3504298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3504301">}</span><span class="op" id="3504302">(</span><span class="op" id="3504303">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3504307">idleConnCh</span>&nbsp;<span class="op" id="3504318">:=</span>&nbsp;<span class="ident" id="3504321"><a href="/net/http/transport.go.html#3503691">t</a></span><span class="op" id="3504322">.</span><span class="ident" id="3504323">getIdleConnCh</span><span class="op" id="3504336">(</span><span class="ident" id="3504337"><a href="/net/http/transport.go.html#3503727">cm</a></span><span class="op" id="3504339">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504342">select</span>&nbsp;<span class="op" id="3504349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504352">case</span>&nbsp;<span class="ident" id="3504357">v</span>&nbsp;<span class="op" id="3504359">:=</span>&nbsp;<span class="op" id="3504362">&lt;-</span><span class="ident" id="3504364"><a href="/net/http/transport.go.html#3503889">dialc</a></span><span class="op" id="3504369">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3504373">//&nbsp;Our&nbsp;dial&nbsp;finished.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504397">return</span>&nbsp;<span class="ident" id="3504404"><a href="/net/http/transport.go.html#3504357">v</a></span><span class="op" id="3504405">.</span><span class="ident" id="3504406">pc</span><span class="op" id="3504408">,</span>&nbsp;<span class="ident" id="3504410"><a href="/net/http/transport.go.html#3504357">v</a></span><span class="op" id="3504411">.</span><span class="ident" id="3504412">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504417">case</span>&nbsp;<span class="ident" id="3504422">pc</span>&nbsp;<span class="op" id="3504425">:=</span>&nbsp;<span class="op" id="3504428">&lt;-</span><span class="ident" id="3504430"><a href="/net/http/transport.go.html#3504307">idleConnCh</a></span><span class="op" id="3504440">:</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3504444">//&nbsp;Another&nbsp;request&nbsp;finished&nbsp;first&nbsp;and&nbsp;its&nbsp;net.Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3504497">//&nbsp;became&nbsp;available&nbsp;before&nbsp;our&nbsp;dial.&nbsp;Or&nbsp;somebody</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3504548">//&nbsp;else&#39;s&nbsp;dial&nbsp;that&nbsp;they&nbsp;didn&#39;t&nbsp;use.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3504587">//&nbsp;But&nbsp;our&nbsp;dial&nbsp;is&nbsp;still&nbsp;going,&nbsp;so&nbsp;give&nbsp;it&nbsp;away</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3504637">//&nbsp;when&nbsp;it&nbsp;finishes:</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3504660"><a href="/net/http/transport.go.html#3503919">handlePendingDial</a></span><span class="op" id="3504677">(</span><span class="op" id="3504678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504682">return</span>&nbsp;<span class="ident" id="3504689"><a href="/net/http/transport.go.html#3504422">pc</a></span><span class="op" id="3504691">,</span>&nbsp;<span class="ident" id="3504693">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504698">case</span>&nbsp;<span class="op" id="3504703">&lt;-</span><span class="ident" id="3504705"><a href="/net/http/transport.go.html#3504149">cancelc</a></span><span class="op" id="3504712">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3504716"><a href="/net/http/transport.go.html#3503919">handlePendingDial</a></span><span class="op" id="3504733">(</span><span class="op" id="3504734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3504738">return</span>&nbsp;<span class="ident" id="3504745">nil</span><span class="op" id="3504748">,</span>&nbsp;<span class="ident" id="3504750"><a href="/net/http/transport.go.html#3490389">errors</a></span><span class="op" id="3504756">.</span><span class="ident" id="3504757">New</span><span class="op" id="3504760">(</span><span class="string" id="3504761">&#34;net/http:&nbsp;request&nbsp;canceled&nbsp;while&nbsp;waiting&nbsp;for&nbsp;connection&#34;</span><span class="op" id="3504818">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3504821">}</span><br>
<span class="lineno"></span><span class="op" id="3504823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3504826">func</span>&nbsp;<span class="op" id="3504831">(</span><span class="ident" id="3504832">t</span>&nbsp;<span class="op" id="3504834">*</span><span class="ident" id="3504835"><a href="/net/http/transport.go.html#3491333">Transport</a></span><span class="op" id="3504844">)</span>&nbsp;<span class="ident" id="3504846">dialConn</span><span class="op" id="3504854">(</span><span class="ident" id="3504855">cm</span>&nbsp;<span class="ident" id="3504858"><a href="/net/http/transport.go.html#3509705">connectMethod</a></span><span class="op" id="3504871">)</span>&nbsp;<span class="op" id="3504873">(</span><span class="op" id="3504874">*</span><span class="ident" id="3504875"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><span class="op" id="3504886">,</span>&nbsp;<span class="builtintype" id="3504888">error</span><span class="op" id="3504893">)</span>&nbsp;<span class="op" id="3504895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3504898">pconn</span>&nbsp;<span class="op" id="3504904">:=</span>&nbsp;<span class="op" id="3504907">&amp;</span><span class="ident" id="3504908"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><span class="op" id="3504919">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3504923">t</span><span class="op" id="3504924">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504935"><a href="/net/http/transport.go.html#3504832">t</a></span><span class="op" id="3504936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3504940">cacheKey</span><span class="op" id="3504948">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3504952"><a href="/net/http/transport.go.html#3504855">cm</a></span><span class="op" id="3504954">.</span><span class="ident" id="3504955">key</span><span class="op" id="3504958">(</span><span class="op" id="3504959">)</span><span class="op" id="3504960">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3504964">reqch</span><span class="op" id="3504969">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3504976">make</span><span class="op" id="3504980">(</span><span class="keyword" id="3504981">chan</span>&nbsp;<span class="ident" id="3504986"><a href="/net/http/transport.go.html#3517002">requestAndChan</a></span><span class="op" id="3505000">,</span>&nbsp;<span class="num" id="3505002">1</span><span class="op" id="3505003">)</span><span class="op" id="3505004">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505008">writech</span><span class="op" id="3505015">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3505020">make</span><span class="op" id="3505024">(</span><span class="keyword" id="3505025">chan</span>&nbsp;<span class="ident" id="3505030"><a href="/net/http/transport.go.html#3517449">writeRequest</a></span><span class="op" id="3505042">,</span>&nbsp;<span class="num" id="3505044">1</span><span class="op" id="3505045">)</span><span class="op" id="3505046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505050">closech</span><span class="op" id="3505057">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3505062">make</span><span class="op" id="3505066">(</span><span class="keyword" id="3505067">chan</span>&nbsp;<span class="keyword" id="3505072">struct</span><span class="op" id="3505078">{</span><span class="op" id="3505079">}</span><span class="op" id="3505080">)</span><span class="op" id="3505081">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505085">writeErrCh</span><span class="op" id="3505095">:</span>&nbsp;<span class="builtinfunc" id="3505097">make</span><span class="op" id="3505101">(</span><span class="keyword" id="3505102">chan</span>&nbsp;<span class="builtintype" id="3505107">error</span><span class="op" id="3505112">,</span>&nbsp;<span class="num" id="3505114">1</span><span class="op" id="3505115">)</span><span class="op" id="3505116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3505119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505122">tlsDial</span>&nbsp;<span class="op" id="3505130">:=</span>&nbsp;<span class="ident" id="3505133"><a href="/net/http/transport.go.html#3504832">t</a></span><span class="op" id="3505134">.</span><span class="ident" id="3505135">DialTLS</span>&nbsp;<span class="op" id="3505143">!=</span>&nbsp;<span class="ident" id="3505146">nil</span>&nbsp;<span class="op" id="3505150">&amp;&amp;</span>&nbsp;<span class="ident" id="3505153"><a href="/net/http/transport.go.html#3504855">cm</a></span><span class="op" id="3505155">.</span><span class="ident" id="3505156">targetScheme</span>&nbsp;<span class="op" id="3505169">==</span>&nbsp;<span class="string" id="3505172">&#34;https&#34;</span>&nbsp;<span class="op" id="3505180">&amp;&amp;</span>&nbsp;<span class="ident" id="3505183"><a href="/net/http/transport.go.html#3504855">cm</a></span><span class="op" id="3505185">.</span><span class="ident" id="3505186">proxyURL</span>&nbsp;<span class="op" id="3505195">==</span>&nbsp;<span class="ident" id="3505198">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505203">if</span>&nbsp;<span class="ident" id="3505206"><a href="/net/http/transport.go.html#3505122">tlsDial</a></span>&nbsp;<span class="op" id="3505214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505218">var</span>&nbsp;<span class="ident" id="3505222">err</span>&nbsp;<span class="builtintype" id="3505226">error</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505234"><a href="/net/http/transport.go.html#3504898">pconn</a></span><span class="op" id="3505239">.</span><span class="ident" id="3505240">conn</span><span class="op" id="3505244">,</span>&nbsp;<span class="ident" id="3505246"><a href="/net/http/transport.go.html#3505222">err</a></span>&nbsp;<span class="op" id="3505250">=</span>&nbsp;<span class="ident" id="3505252"><a href="/net/http/transport.go.html#3504832">t</a></span><span class="op" id="3505253">.</span><span class="ident" id="3505254">DialTLS</span><span class="op" id="3505261">(</span><span class="string" id="3505262">&#34;tcp&#34;</span><span class="op" id="3505267">,</span>&nbsp;<span class="ident" id="3505269"><a href="/net/http/transport.go.html#3504855">cm</a></span><span class="op" id="3505271">.</span><span class="ident" id="3505272">addr</span><span class="op" id="3505276">(</span><span class="op" id="3505277">)</span><span class="op" id="3505278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505282">if</span>&nbsp;<span class="ident" id="3505285"><a href="/net/http/transport.go.html#3505222">err</a></span>&nbsp;<span class="op" id="3505289">!=</span>&nbsp;<span class="ident" id="3505292">nil</span>&nbsp;<span class="op" id="3505296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505301">return</span>&nbsp;<span class="ident" id="3505308">nil</span><span class="op" id="3505311">,</span>&nbsp;<span class="ident" id="3505313"><a href="/net/http/transport.go.html#3505222">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3505319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505323">if</span>&nbsp;<span class="ident" id="3505326">tc</span><span class="op" id="3505328">,</span>&nbsp;<span class="ident" id="3505330">ok</span>&nbsp;<span class="op" id="3505333">:=</span>&nbsp;<span class="ident" id="3505336"><a href="/net/http/transport.go.html#3504898">pconn</a></span><span class="op" id="3505341">.</span><span class="ident" id="3505342">conn</span><span class="op" id="3505346">.</span><span class="op" id="3505347">(</span><span class="op" id="3505348">*</span><span class="ident" id="3505349"><a href="/net/http/transport.go.html#3490375">tls</a></span><span class="op" id="3505352">.</span><span class="ident" id="3505353">Conn</span><span class="op" id="3505357">)</span><span class="op" id="3505358">;</span>&nbsp;<span class="ident" id="3505360"><a href="/net/http/transport.go.html#3505330">ok</a></span>&nbsp;<span class="op" id="3505363">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505368">cs</span>&nbsp;<span class="op" id="3505371">:=</span>&nbsp;<span class="ident" id="3505374"><a href="/net/http/transport.go.html#3505326">tc</a></span><span class="op" id="3505376">.</span><span class="ident" id="3505377">ConnectionState</span><span class="op" id="3505392">(</span><span class="op" id="3505393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505398"><a href="/net/http/transport.go.html#3504898">pconn</a></span><span class="op" id="3505403">.</span><span class="ident" id="3505404">tlsState</span>&nbsp;<span class="op" id="3505413">=</span>&nbsp;<span class="op" id="3505415">&amp;</span><span class="ident" id="3505416"><a href="/net/http/transport.go.html#3505368">cs</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3505421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3505424">}</span>&nbsp;<span class="keyword" id="3505426">else</span>&nbsp;<span class="op" id="3505431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505435">conn</span><span class="op" id="3505439">,</span>&nbsp;<span class="ident" id="3505441">err</span>&nbsp;<span class="op" id="3505445">:=</span>&nbsp;<span class="ident" id="3505448"><a href="/net/http/transport.go.html#3504832">t</a></span><span class="op" id="3505449">.</span><span class="ident" id="3505450">dial</span><span class="op" id="3505454">(</span><span class="string" id="3505455">&#34;tcp&#34;</span><span class="op" id="3505460">,</span>&nbsp;<span class="ident" id="3505462"><a href="/net/http/transport.go.html#3504855">cm</a></span><span class="op" id="3505464">.</span><span class="ident" id="3505465">addr</span><span class="op" id="3505469">(</span><span class="op" id="3505470">)</span><span class="op" id="3505471">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505475">if</span>&nbsp;<span class="ident" id="3505478"><a href="/net/http/transport.go.html#3505441">err</a></span>&nbsp;<span class="op" id="3505482">!=</span>&nbsp;<span class="ident" id="3505485">nil</span>&nbsp;<span class="op" id="3505489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505494">if</span>&nbsp;<span class="ident" id="3505497"><a href="/net/http/transport.go.html#3504855">cm</a></span><span class="op" id="3505499">.</span><span class="ident" id="3505500">proxyURL</span>&nbsp;<span class="op" id="3505509">!=</span>&nbsp;<span class="ident" id="3505512">nil</span>&nbsp;<span class="op" id="3505516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505522"><a href="/net/http/transport.go.html#3505441">err</a></span>&nbsp;<span class="op" id="3505526">=</span>&nbsp;<span class="ident" id="3505528"><a href="/net/http/transport.go.html#3490399">fmt</a></span><span class="op" id="3505531">.</span><span class="ident" id="3505532">Errorf</span><span class="op" id="3505538">(</span><span class="string" id="3505539">&#34;http:&nbsp;error&nbsp;connecting&nbsp;to&nbsp;proxy&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="3505579">,</span>&nbsp;<span class="ident" id="3505581"><a href="/net/http/transport.go.html#3504855">cm</a></span><span class="op" id="3505583">.</span><span class="ident" id="3505584">proxyURL</span><span class="op" id="3505592">,</span>&nbsp;<span class="ident" id="3505594"><a href="/net/http/transport.go.html#3505441">err</a></span><span class="op" id="3505597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3505602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505607">return</span>&nbsp;<span class="ident" id="3505614">nil</span><span class="op" id="3505617">,</span>&nbsp;<span class="ident" id="3505619"><a href="/net/http/transport.go.html#3505441">err</a></span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3505625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505629"><a href="/net/http/transport.go.html#3504898">pconn</a></span><span class="op" id="3505634">.</span><span class="ident" id="3505635">conn</span>&nbsp;<span class="op" id="3505640">=</span>&nbsp;<span class="ident" id="3505642"><a href="/net/http/transport.go.html#3505435">conn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3505648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3505652">//&nbsp;Proxy&nbsp;setup.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505669">switch</span>&nbsp;<span class="op" id="3505676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505679">case</span>&nbsp;<span class="ident" id="3505684"><a href="/net/http/transport.go.html#3504855">cm</a></span><span class="op" id="3505686">.</span><span class="ident" id="3505687">proxyURL</span>&nbsp;<span class="op" id="3505696">==</span>&nbsp;<span class="ident" id="3505699">nil</span><span class="op" id="3505702">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3505706">//&nbsp;Do&nbsp;nothing.&nbsp;Not&nbsp;using&nbsp;a&nbsp;proxy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505741">case</span>&nbsp;<span class="ident" id="3505746"><a href="/net/http/transport.go.html#3504855">cm</a></span><span class="op" id="3505748">.</span><span class="ident" id="3505749">targetScheme</span>&nbsp;<span class="op" id="3505762">==</span>&nbsp;<span class="string" id="3505765">&#34;http&#34;</span><span class="op" id="3505771">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505775"><a href="/net/http/transport.go.html#3504898">pconn</a></span><span class="op" id="3505780">.</span><span class="ident" id="3505781">isProxy</span>&nbsp;<span class="op" id="3505789">=</span>&nbsp;<span class="builtintype" id="3505791">true</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505798">if</span>&nbsp;<span class="ident" id="3505801">pa</span>&nbsp;<span class="op" id="3505804">:=</span>&nbsp;<span class="ident" id="3505807"><a href="/net/http/transport.go.html#3504855">cm</a></span><span class="op" id="3505809">.</span><span class="ident" id="3505810">proxyAuth</span><span class="op" id="3505819">(</span><span class="op" id="3505820">)</span><span class="op" id="3505821">;</span>&nbsp;<span class="ident" id="3505823"><a href="/net/http/transport.go.html#3505801">pa</a></span>&nbsp;<span class="op" id="3505826">!=</span>&nbsp;<span class="string" id="3505829">&#34;&#34;</span>&nbsp;<span class="op" id="3505832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505837"><a href="/net/http/transport.go.html#3504898">pconn</a></span><span class="op" id="3505842">.</span><span class="ident" id="3505843">mutateHeaderFunc</span>&nbsp;<span class="op" id="3505860">=</span>&nbsp;<span class="keyword" id="3505862">func</span><span class="op" id="3505866">(</span><span class="ident" id="3505867">h</span>&nbsp;<span class="ident" id="3505869"><a href="/net/http/header.go.html#3356649">Header</a></span><span class="op" id="3505875">)</span>&nbsp;<span class="op" id="3505877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505883"><a href="/net/http/transport.go.html#3505867">h</a></span><span class="op" id="3505884">.</span><span class="ident" id="3505885">Set</span><span class="op" id="3505888">(</span><span class="string" id="3505889">&#34;Proxy-Authorization&#34;</span><span class="op" id="3505910">,</span>&nbsp;<span class="ident" id="3505912"><a href="/net/http/transport.go.html#3505801">pa</a></span><span class="op" id="3505914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3505919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3505923">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3505926">case</span>&nbsp;<span class="ident" id="3505931"><a href="/net/http/transport.go.html#3504855">cm</a></span><span class="op" id="3505933">.</span><span class="ident" id="3505934">targetScheme</span>&nbsp;<span class="op" id="3505947">==</span>&nbsp;<span class="string" id="3505950">&#34;https&#34;</span><span class="op" id="3505957">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505961">conn</span>&nbsp;<span class="op" id="3505966">:=</span>&nbsp;<span class="ident" id="3505969"><a href="/net/http/transport.go.html#3504898">pconn</a></span><span class="op" id="3505974">.</span><span class="ident" id="3505975">conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3505982">connectReq</span>&nbsp;<span class="op" id="3505993">:=</span>&nbsp;<span class="op" id="3505996">&amp;</span><span class="ident" id="3505997"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3506004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3506009">Method</span><span class="op" id="3506015">:</span>&nbsp;<span class="string" id="3506017">&#34;CONNECT&#34;</span><span class="op" id="3506026">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3506031">URL</span><span class="op" id="3506034">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3506039">&amp;</span><span class="ident" id="3506040"><a href="/net/http/transport.go.html#3490426">url</a></span><span class="op" id="3506043">.</span><span class="ident" id="3506044">URL</span><span class="op" id="3506047">{</span><span class="ident" id="3506048">Opaque</span><span class="op" id="3506054">:</span>&nbsp;<span class="ident" id="3506056"><a href="/net/http/transport.go.html#3504855">cm</a></span><span class="op" id="3506058">.</span><span class="ident" id="3506059">targetAddr</span><span class="op" id="3506069">}</span><span class="op" id="3506070">,</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3506075">Host</span><span class="op" id="3506079">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3506083"><a href="/net/http/transport.go.html#3504855">cm</a></span><span class="op" id="3506085">.</span><span class="ident" id="3506086">targetAddr</span><span class="op" id="3506096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3506101">Header</span><span class="op" id="3506107">:</span>&nbsp;<span class="builtinfunc" id="3506109">make</span><span class="op" id="3506113">(</span><span class="ident" id="3506114"><a href="/net/http/header.go.html#3356649">Header</a></span><span class="op" id="3506120">)</span><span class="op" id="3506121">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3506125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3506129">if</span>&nbsp;<span class="ident" id="3506132">pa</span>&nbsp;<span class="op" id="3506135">:=</span>&nbsp;<span class="ident" id="3506138"><a href="/net/http/transport.go.html#3504855">cm</a></span><span class="op" id="3506140">.</span><span class="ident" id="3506141">proxyAuth</span><span class="op" id="3506150">(</span><span class="op" id="3506151">)</span><span class="op" id="3506152">;</span>&nbsp;<span class="ident" id="3506154"><a href="/net/http/transport.go.html#3506132">pa</a></span>&nbsp;<span class="op" id="3506157">!=</span>&nbsp;<span class="string" id="3506160">&#34;&#34;</span>&nbsp;<span class="op" id="3506163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3506168"><a href="/net/http/transport.go.html#3505982">connectReq</a></span><span class="op" id="3506178">.</span><span class="ident" id="3506179">Header</span><span class="op" id="3506185">.</span><span class="ident" id="3506186">Set</span><span class="op" id="3506189">(</span><span class="string" id="3506190">&#34;Proxy-Authorization&#34;</span><span class="op" id="3506211">,</span>&nbsp;<span class="ident" id="3506213"><a href="/net/http/transport.go.html#3506132">pa</a></span><span class="op" id="3506215">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3506219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3506223"><a href="/net/http/transport.go.html#3505982">connectReq</a></span><span class="op" id="3506233">.</span><span class="ident" id="3506234">Write</span><span class="op" id="3506239">(</span><span class="ident" id="3506240"><a href="/net/http/transport.go.html#3505961">conn</a></span><span class="op" id="3506244">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3506249">//&nbsp;Read&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3506269">//&nbsp;Okay&nbsp;to&nbsp;use&nbsp;and&nbsp;discard&nbsp;buffered&nbsp;reader&nbsp;here,&nbsp;because</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3506328">//&nbsp;TLS&nbsp;server&nbsp;will&nbsp;not&nbsp;speak&nbsp;until&nbsp;spoken&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3506376">br</span>&nbsp;<span class="op" id="3506379">:=</span>&nbsp;<span class="ident" id="3506382"><a href="/net/http/transport.go.html#3490349">bufio</a></span><span class="op" id="3506387">.</span><span class="ident" id="3506388">NewReader</span><span class="op" id="3506397">(</span><span class="ident" id="3506398"><a href="/net/http/transport.go.html#3505961">conn</a></span><span class="op" id="3506402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3506406">resp</span><span class="op" id="3506410">,</span>&nbsp;<span class="ident" id="3506412">err</span>&nbsp;<span class="op" id="3506416">:=</span>&nbsp;<span class="ident" id="3506419"><a href="/net/http/response.go.html#3395244">ReadResponse</a></span><span class="op" id="3506431">(</span><span class="ident" id="3506432"><a href="/net/http/transport.go.html#3506376">br</a></span><span class="op" id="3506434">,</span>&nbsp;<span class="ident" id="3506436"><a href="/net/http/transport.go.html#3505982">connectReq</a></span><span class="op" id="3506446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3506450">if</span>&nbsp;<span class="ident" id="3506453"><a href="/net/http/transport.go.html#3506412">err</a></span>&nbsp;<span class="op" id="3506457">!=</span>&nbsp;<span class="ident" id="3506460">nil</span>&nbsp;<span class="op" id="3506464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3506469"><a href="/net/http/transport.go.html#3505961">conn</a></span><span class="op" id="3506473">.</span><span class="ident" id="3506474">Close</span><span class="op" id="3506479">(</span><span class="op" id="3506480">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3506485">return</span>&nbsp;<span class="ident" id="3506492">nil</span><span class="op" id="3506495">,</span>&nbsp;<span class="ident" id="3506497"><a href="/net/http/transport.go.html#3506412">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3506503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3506507">if</span>&nbsp;<span class="ident" id="3506510"><a href="/net/http/transport.go.html#3506406">resp</a></span><span class="op" id="3506514">.</span><span class="ident" id="3506515">StatusCode</span>&nbsp;<span class="op" id="3506526">!=</span>&nbsp;<span class="num" id="3506529">200</span>&nbsp;<span class="op" id="3506533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3506538">f</span>&nbsp;<span class="op" id="3506540">:=</span>&nbsp;<span class="ident" id="3506543"><a href="/net/http/transport.go.html#3490443">strings</a></span><span class="op" id="3506550">.</span><span class="ident" id="3506551">SplitN</span><span class="op" id="3506557">(</span><span class="ident" id="3506558"><a href="/net/http/transport.go.html#3506406">resp</a></span><span class="op" id="3506562">.</span><span class="ident" id="3506563">Status</span><span class="op" id="3506569">,</span>&nbsp;<span class="string" id="3506571">&#34;&nbsp;&#34;</span><span class="op" id="3506574">,</span>&nbsp;<span class="num" id="3506576">2</span><span class="op" id="3506577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3506582"><a href="/net/http/transport.go.html#3505961">conn</a></span><span class="op" id="3506586">.</span><span class="ident" id="3506587">Close</span><span class="op" id="3506592">(</span><span class="op" id="3506593">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3506598">return</span>&nbsp;<span class="ident" id="3506605">nil</span><span class="op" id="3506608">,</span>&nbsp;<span class="ident" id="3506610"><a href="/net/http/transport.go.html#3490389">errors</a></span><span class="op" id="3506616">.</span><span class="ident" id="3506617">New</span><span class="op" id="3506620">(</span><span class="ident" id="3506621"><a href="/net/http/transport.go.html#3506538">f</a></span><span class="op" id="3506622">[</span><span class="num" id="3506623">1</span><span class="op" id="3506624">]</span><span class="op" id="3506625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3506629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3506632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3506636">if</span>&nbsp;<span class="ident" id="3506639"><a href="/net/http/transport.go.html#3504855">cm</a></span><span class="op" id="3506641">.</span><span class="ident" id="3506642">targetScheme</span>&nbsp;<span class="op" id="3506655">==</span>&nbsp;<span class="string" id="3506658">&#34;https&#34;</span>&nbsp;<span class="op" id="3506666">&amp;&amp;</span>&nbsp;<span class="op" id="3506669">!</span><span class="ident" id="3506670"><a href="/net/http/transport.go.html#3505122">tlsDial</a></span>&nbsp;<span class="op" id="3506678">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3506682">//&nbsp;Initiate&nbsp;TLS&nbsp;and&nbsp;check&nbsp;remote&nbsp;host&nbsp;name&nbsp;against&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3506748">cfg</span>&nbsp;<span class="op" id="3506752">:=</span>&nbsp;<span class="ident" id="3506755"><a href="/net/http/transport.go.html#3504832">t</a></span><span class="op" id="3506756">.</span><span class="ident" id="3506757">TLSClientConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3506775">if</span>&nbsp;<span class="ident" id="3506778"><a href="/net/http/transport.go.html#3506748">cfg</a></span>&nbsp;<span class="op" id="3506782">==</span>&nbsp;<span class="ident" id="3506785">nil</span>&nbsp;<span class="op" id="3506789">||</span>&nbsp;<span class="ident" id="3506792"><a href="/net/http/transport.go.html#3506748">cfg</a></span><span class="op" id="3506795">.</span><span class="ident" id="3506796">ServerName</span>&nbsp;<span class="op" id="3506807">==</span>&nbsp;<span class="string" id="3506810">&#34;&#34;</span>&nbsp;<span class="op" id="3506813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3506818">host</span>&nbsp;<span class="op" id="3506823">:=</span>&nbsp;<span class="ident" id="3506826"><a href="/net/http/transport.go.html#3504855">cm</a></span><span class="op" id="3506828">.</span><span class="ident" id="3506829">tlsHost</span><span class="op" id="3506836">(</span><span class="op" id="3506837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3506842">if</span>&nbsp;<span class="ident" id="3506845"><a href="/net/http/transport.go.html#3506748">cfg</a></span>&nbsp;<span class="op" id="3506849">==</span>&nbsp;<span class="ident" id="3506852">nil</span>&nbsp;<span class="op" id="3506856">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3506862"><a href="/net/http/transport.go.html#3506748">cfg</a></span>&nbsp;<span class="op" id="3506866">=</span>&nbsp;<span class="op" id="3506868">&amp;</span><span class="ident" id="3506869"><a href="/net/http/transport.go.html#3490375">tls</a></span><span class="op" id="3506872">.</span><span class="ident" id="3506873">Config</span><span class="op" id="3506879">{</span><span class="ident" id="3506880">ServerName</span><span class="op" id="3506890">:</span>&nbsp;<span class="ident" id="3506892"><a href="/net/http/transport.go.html#3506818">host</a></span><span class="op" id="3506896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3506901">}</span>&nbsp;<span class="keyword" id="3506903">else</span>&nbsp;<span class="op" id="3506908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3506914">clone</span>&nbsp;<span class="op" id="3506920">:=</span>&nbsp;<span class="op" id="3506923">*</span><span class="ident" id="3506924"><a href="/net/http/transport.go.html#3506748">cfg</a></span>&nbsp;<span class="comment" id="3506928">//&nbsp;shallow&nbsp;clone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3506949"><a href="/net/http/transport.go.html#3506914">clone</a></span><span class="op" id="3506954">.</span><span class="ident" id="3506955">ServerName</span>&nbsp;<span class="op" id="3506966">=</span>&nbsp;<span class="ident" id="3506968"><a href="/net/http/transport.go.html#3506818">host</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3506977"><a href="/net/http/transport.go.html#3506748">cfg</a></span>&nbsp;<span class="op" id="3506981">=</span>&nbsp;<span class="op" id="3506983">&amp;</span><span class="ident" id="3506984"><a href="/net/http/transport.go.html#3506914">clone</a></span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3506993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3506997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3507001">plainConn</span>&nbsp;<span class="op" id="3507011">:=</span>&nbsp;<span class="ident" id="3507014"><a href="/net/http/transport.go.html#3504898">pconn</a></span><span class="op" id="3507019">.</span><span class="ident" id="3507020">conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3507027">tlsConn</span>&nbsp;<span class="op" id="3507035">:=</span>&nbsp;<span class="ident" id="3507038"><a href="/net/http/transport.go.html#3490375">tls</a></span><span class="op" id="3507041">.</span><span class="ident" id="3507042">Client</span><span class="op" id="3507048">(</span><span class="ident" id="3507049"><a href="/net/http/transport.go.html#3507001">plainConn</a></span><span class="op" id="3507058">,</span>&nbsp;<span class="ident" id="3507060"><a href="/net/http/transport.go.html#3506748">cfg</a></span><span class="op" id="3507063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3507067">errc</span>&nbsp;<span class="op" id="3507072">:=</span>&nbsp;<span class="builtinfunc" id="3507075">make</span><span class="op" id="3507079">(</span><span class="keyword" id="3507080">chan</span>&nbsp;<span class="builtintype" id="3507085">error</span><span class="op" id="3507090">,</span>&nbsp;<span class="num" id="3507092">2</span><span class="op" id="3507093">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3507097">var</span>&nbsp;<span class="ident" id="3507101">timer</span>&nbsp;<span class="op" id="3507107">*</span><span class="ident" id="3507108"><a href="/net/http/transport.go.html#3490462">time</a></span><span class="op" id="3507112">.</span><span class="ident" id="3507113">Timer</span>&nbsp;<span class="comment" id="3507119">//&nbsp;for&nbsp;canceling&nbsp;TLS&nbsp;handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3507152">if</span>&nbsp;<span class="ident" id="3507155">d</span>&nbsp;<span class="op" id="3507157">:=</span>&nbsp;<span class="ident" id="3507160"><a href="/net/http/transport.go.html#3504832">t</a></span><span class="op" id="3507161">.</span><span class="ident" id="3507162">TLSHandshakeTimeout</span><span class="op" id="3507181">;</span>&nbsp;<span class="ident" id="3507183"><a href="/net/http/transport.go.html#3507155">d</a></span>&nbsp;<span class="op" id="3507185">!=</span>&nbsp;<span class="num" id="3507188">0</span>&nbsp;<span class="op" id="3507190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3507195"><a href="/net/http/transport.go.html#3507101">timer</a></span>&nbsp;<span class="op" id="3507201">=</span>&nbsp;<span class="ident" id="3507203"><a href="/net/http/transport.go.html#3490462">time</a></span><span class="op" id="3507207">.</span><span class="ident" id="3507208">AfterFunc</span><span class="op" id="3507217">(</span><span class="ident" id="3507218"><a href="/net/http/transport.go.html#3507155">d</a></span><span class="op" id="3507219">,</span>&nbsp;<span class="keyword" id="3507221">func</span><span class="op" id="3507225">(</span><span class="op" id="3507226">)</span>&nbsp;<span class="op" id="3507228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3507234"><a href="/net/http/transport.go.html#3507067">errc</a></span>&nbsp;<span class="op" id="3507239">&lt;-</span>&nbsp;<span class="ident" id="3507242"><a href="/net/http/transport.go.html#3523887">tlsHandshakeTimeoutError</a></span><span class="op" id="3507266">{</span><span class="op" id="3507267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3507272">}</span><span class="op" id="3507273">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3507277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3507281">go</span>&nbsp;<span class="keyword" id="3507284">func</span><span class="op" id="3507288">(</span><span class="op" id="3507289">)</span>&nbsp;<span class="op" id="3507291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3507296">err</span>&nbsp;<span class="op" id="3507300">:=</span>&nbsp;<span class="ident" id="3507303"><a href="/net/http/transport.go.html#3507027">tlsConn</a></span><span class="op" id="3507310">.</span><span class="ident" id="3507311">Handshake</span><span class="op" id="3507320">(</span><span class="op" id="3507321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3507326">if</span>&nbsp;<span class="ident" id="3507329"><a href="/net/http/transport.go.html#3507101">timer</a></span>&nbsp;<span class="op" id="3507335">!=</span>&nbsp;<span class="ident" id="3507338">nil</span>&nbsp;<span class="op" id="3507342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3507348"><a href="/net/http/transport.go.html#3507101">timer</a></span><span class="op" id="3507353">.</span><span class="ident" id="3507354">Stop</span><span class="op" id="3507358">(</span><span class="op" id="3507359">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3507364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3507369"><a href="/net/http/transport.go.html#3507067">errc</a></span>&nbsp;<span class="op" id="3507374">&lt;-</span>&nbsp;<span class="ident" id="3507377"><a href="/net/http/transport.go.html#3507296">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3507383">}</span><span class="op" id="3507384">(</span><span class="op" id="3507385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3507389">if</span>&nbsp;<span class="ident" id="3507392">err</span>&nbsp;<span class="op" id="3507396">:=</span>&nbsp;<span class="op" id="3507399">&lt;-</span><span class="ident" id="3507401"><a href="/net/http/transport.go.html#3507067">errc</a></span><span class="op" id="3507405">;</span>&nbsp;<span class="ident" id="3507407"><a href="/net/http/transport.go.html#3507392">err</a></span>&nbsp;<span class="op" id="3507411">!=</span>&nbsp;<span class="ident" id="3507414">nil</span>&nbsp;<span class="op" id="3507418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3507423"><a href="/net/http/transport.go.html#3507001">plainConn</a></span><span class="op" id="3507432">.</span><span class="ident" id="3507433">Close</span><span class="op" id="3507438">(</span><span class="op" id="3507439">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3507444">return</span>&nbsp;<span class="ident" id="3507451">nil</span><span class="op" id="3507454">,</span>&nbsp;<span class="ident" id="3507456"><a href="/net/http/transport.go.html#3507392">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3507462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3507466">if</span>&nbsp;<span class="op" id="3507469">!</span><span class="ident" id="3507470"><a href="/net/http/transport.go.html#3506748">cfg</a></span><span class="op" id="3507473">.</span><span class="ident" id="3507474">InsecureSkipVerify</span>&nbsp;<span class="op" id="3507493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3507498">if</span>&nbsp;<span class="ident" id="3507501">err</span>&nbsp;<span class="op" id="3507505">:=</span>&nbsp;<span class="ident" id="3507508"><a href="/net/http/transport.go.html#3507027">tlsConn</a></span><span class="op" id="3507515">.</span><span class="ident" id="3507516">VerifyHostname</span><span class="op" id="3507530">(</span><span class="ident" id="3507531"><a href="/net/http/transport.go.html#3506748">cfg</a></span><span class="op" id="3507534">.</span><span class="ident" id="3507535">ServerName</span><span class="op" id="3507545">)</span><span class="op" id="3507546">;</span>&nbsp;<span class="ident" id="3507548"><a href="/net/http/transport.go.html#3507501">err</a></span>&nbsp;<span class="op" id="3507552">!=</span>&nbsp;<span class="ident" id="3507555">nil</span>&nbsp;<span class="op" id="3507559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3507565"><a href="/net/http/transport.go.html#3507001">plainConn</a></span><span class="op" id="3507574">.</span><span class="ident" id="3507575">Close</span><span class="op" id="3507580">(</span><span class="op" id="3507581">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3507587">return</span>&nbsp;<span class="ident" id="3507594">nil</span><span class="op" id="3507597">,</span>&nbsp;<span class="ident" id="3507599"><a href="/net/http/transport.go.html#3507501">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3507606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3507610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3507614">cs</span>&nbsp;<span class="op" id="3507617">:=</span>&nbsp;<span class="ident" id="3507620"><a href="/net/http/transport.go.html#3507027">tlsConn</a></span><span class="op" id="3507627">.</span><span class="ident" id="3507628">ConnectionState</span><span class="op" id="3507643">(</span><span class="op" id="3507644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3507648"><a href="/net/http/transport.go.html#3504898">pconn</a></span><span class="op" id="3507653">.</span><span class="ident" id="3507654">tlsState</span>&nbsp;<span class="op" id="3507663">=</span>&nbsp;<span class="op" id="3507665">&amp;</span><span class="ident" id="3507666"><a href="/net/http/transport.go.html#3507614">cs</a></span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3507671"><a href="/net/http/transport.go.html#3504898">pconn</a></span><span class="op" id="3507676">.</span><span class="ident" id="3507677">conn</span>&nbsp;<span class="op" id="3507682">=</span>&nbsp;<span class="ident" id="3507684"><a href="/net/http/transport.go.html#3507027">tlsConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3507693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3507697"><a href="/net/http/transport.go.html#3504898">pconn</a></span><span class="op" id="3507702">.</span><span class="ident" id="3507703">br</span>&nbsp;<span class="op" id="3507706">=</span>&nbsp;<span class="ident" id="3507708"><a href="/net/http/transport.go.html#3490349">bufio</a></span><span class="op" id="3507713">.</span><span class="ident" id="3507714">NewReader</span><span class="op" id="3507723">(</span><span class="ident" id="3507724"><a href="/net/http/transport.go.html#3524152">noteEOFReader</a></span><span class="op" id="3507737">{</span><span class="ident" id="3507738"><a href="/net/http/transport.go.html#3504898">pconn</a></span><span class="op" id="3507743">.</span><span class="ident" id="3507744">conn</span><span class="op" id="3507748">,</span>&nbsp;<span class="op" id="3507750">&amp;</span><span class="ident" id="3507751"><a href="/net/http/transport.go.html#3504898">pconn</a></span><span class="op" id="3507756">.</span><span class="ident" id="3507757">sawEOF</span><span class="op" id="3507763">}</span><span class="op" id="3507764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3507767"><a href="/net/http/transport.go.html#3504898">pconn</a></span><span class="op" id="3507772">.</span><span class="ident" id="3507773">bw</span>&nbsp;<span class="op" id="3507776">=</span>&nbsp;<span class="ident" id="3507778"><a href="/net/http/transport.go.html#3490349">bufio</a></span><span class="op" id="3507783">.</span><span class="ident" id="3507784">NewWriter</span><span class="op" id="3507793">(</span><span class="ident" id="3507794"><a href="/net/http/transport.go.html#3504898">pconn</a></span><span class="op" id="3507799">.</span><span class="ident" id="3507800">conn</span><span class="op" id="3507804">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3507807">go</span>&nbsp;<span class="ident" id="3507810"><a href="/net/http/transport.go.html#3504898">pconn</a></span><span class="op" id="3507815">.</span><span class="ident" id="3507816">readLoop</span><span class="op" id="3507824">(</span><span class="op" id="3507825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3507828">go</span>&nbsp;<span class="ident" id="3507831"><a href="/net/http/transport.go.html#3504898">pconn</a></span><span class="op" id="3507836">.</span><span class="ident" id="3507837">writeLoop</span><span class="op" id="3507846">(</span><span class="op" id="3507847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3507850">return</span>&nbsp;<span class="ident" id="3507857"><a href="/net/http/transport.go.html#3504898">pconn</a></span><span class="op" id="3507862">,</span>&nbsp;<span class="ident" id="3507864">nil</span><br>
<span class="lineno"></span><span class="op" id="3507868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">665</span><span class="comment" id="3507871">//&nbsp;useProxy&nbsp;returns&nbsp;true&nbsp;if&nbsp;requests&nbsp;to&nbsp;addr&nbsp;should&nbsp;use&nbsp;a&nbsp;proxy,</span><br>
<span class="lineno"></span><span class="comment" id="3507936">//&nbsp;according&nbsp;to&nbsp;the&nbsp;NO_PROXY&nbsp;or&nbsp;no_proxy&nbsp;environment&nbsp;variable.</span><br>
<span class="lineno"></span><span class="comment" id="3507999">//&nbsp;addr&nbsp;is&nbsp;always&nbsp;a&nbsp;canonicalAddr&nbsp;with&nbsp;a&nbsp;host&nbsp;and&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="3508055">func</span>&nbsp;<span class="ident" id="3508060">useProxy</span><span class="op" id="3508068">(</span><span class="ident" id="3508069">addr</span>&nbsp;<span class="builtintype" id="3508074">string</span><span class="op" id="3508080">)</span>&nbsp;<span class="builtintype" id="3508082">bool</span>&nbsp;<span class="op" id="3508087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508090">if</span>&nbsp;<span class="builtinfunc" id="3508093">len</span><span class="op" id="3508096">(</span><span class="ident" id="3508097"><a href="/net/http/transport.go.html#3508069">addr</a></span><span class="op" id="3508101">)</span>&nbsp;<span class="op" id="3508103">==</span>&nbsp;<span class="num" id="3508106">0</span>&nbsp;<span class="op" id="3508108">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508112">return</span>&nbsp;<span class="builtintype" id="3508119">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3508125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3508128">host</span><span class="op" id="3508132">,</span>&nbsp;<span class="ident" id="3508134">_</span><span class="op" id="3508135">,</span>&nbsp;<span class="ident" id="3508137">err</span>&nbsp;<span class="op" id="3508141">:=</span>&nbsp;<span class="ident" id="3508144"><a href="/net/http/transport.go.html#3490419">net</a></span><span class="op" id="3508147">.</span><span class="ident" id="3508148">SplitHostPort</span><span class="op" id="3508161">(</span><span class="ident" id="3508162"><a href="/net/http/transport.go.html#3508069">addr</a></span><span class="op" id="3508166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508169">if</span>&nbsp;<span class="ident" id="3508172"><a href="/net/http/transport.go.html#3508137">err</a></span>&nbsp;<span class="op" id="3508176">!=</span>&nbsp;<span class="ident" id="3508179">nil</span>&nbsp;<span class="op" id="3508183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508187">return</span>&nbsp;<span class="builtintype" id="3508194">false</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3508201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508204">if</span>&nbsp;<span class="ident" id="3508207"><a href="/net/http/transport.go.html#3508128">host</a></span>&nbsp;<span class="op" id="3508212">==</span>&nbsp;<span class="string" id="3508215">&#34;localhost&#34;</span>&nbsp;<span class="op" id="3508227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508231">return</span>&nbsp;<span class="builtintype" id="3508238">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3508245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508248">if</span>&nbsp;<span class="ident" id="3508251">ip</span>&nbsp;<span class="op" id="3508254">:=</span>&nbsp;<span class="ident" id="3508257"><a href="/net/http/transport.go.html#3490419">net</a></span><span class="op" id="3508260">.</span><span class="ident" id="3508261">ParseIP</span><span class="op" id="3508268">(</span><span class="ident" id="3508269"><a href="/net/http/transport.go.html#3508128">host</a></span><span class="op" id="3508273">)</span><span class="op" id="3508274">;</span>&nbsp;<span class="ident" id="3508276"><a href="/net/http/transport.go.html#3508251">ip</a></span>&nbsp;<span class="op" id="3508279">!=</span>&nbsp;<span class="ident" id="3508282">nil</span>&nbsp;<span class="op" id="3508286">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508290">if</span>&nbsp;<span class="ident" id="3508293"><a href="/net/http/transport.go.html#3508251">ip</a></span><span class="op" id="3508295">.</span><span class="ident" id="3508296">IsLoopback</span><span class="op" id="3508306">(</span><span class="op" id="3508307">)</span>&nbsp;<span class="op" id="3508309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508314">return</span>&nbsp;<span class="builtintype" id="3508321">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3508329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3508332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3508336">no_proxy</span>&nbsp;<span class="op" id="3508345">:=</span>&nbsp;<span class="ident" id="3508348"><a href="/net/http/transport.go.html#3499182">noProxyEnv</a></span><span class="op" id="3508358">.</span><span class="ident" id="3508359">Get</span><span class="op" id="3508362">(</span><span class="op" id="3508363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508366">if</span>&nbsp;<span class="ident" id="3508369"><a href="/net/http/transport.go.html#3508336">no_proxy</a></span>&nbsp;<span class="op" id="3508378">==</span>&nbsp;<span class="string" id="3508381">&#34;*&#34;</span>&nbsp;<span class="op" id="3508385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508389">return</span>&nbsp;<span class="builtintype" id="3508396">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3508403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3508407"><a href="/net/http/transport.go.html#3508069">addr</a></span>&nbsp;<span class="op" id="3508412">=</span>&nbsp;<span class="ident" id="3508414"><a href="/net/http/transport.go.html#3490443">strings</a></span><span class="op" id="3508421">.</span><span class="ident" id="3508422">ToLower</span><span class="op" id="3508429">(</span><span class="ident" id="3508430"><a href="/net/http/transport.go.html#3490443">strings</a></span><span class="op" id="3508437">.</span><span class="ident" id="3508438">TrimSpace</span><span class="op" id="3508447">(</span><span class="ident" id="3508448"><a href="/net/http/transport.go.html#3508069">addr</a></span><span class="op" id="3508452">)</span><span class="op" id="3508453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508456">if</span>&nbsp;<span class="ident" id="3508459"><a href="/net/http/client.go.html#3314060">hasPort</a></span><span class="op" id="3508466">(</span><span class="ident" id="3508467"><a href="/net/http/transport.go.html#3508069">addr</a></span><span class="op" id="3508471">)</span>&nbsp;<span class="op" id="3508473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3508477"><a href="/net/http/transport.go.html#3508069">addr</a></span>&nbsp;<span class="op" id="3508482">=</span>&nbsp;<span class="ident" id="3508484"><a href="/net/http/transport.go.html#3508069">addr</a></span><span class="op" id="3508488">[</span><span class="op" id="3508489">:</span><span class="ident" id="3508490"><a href="/net/http/transport.go.html#3490443">strings</a></span><span class="op" id="3508497">.</span><span class="ident" id="3508498">LastIndex</span><span class="op" id="3508507">(</span><span class="ident" id="3508508"><a href="/net/http/transport.go.html#3508069">addr</a></span><span class="op" id="3508512">,</span>&nbsp;<span class="string" id="3508514">&#34;:&#34;</span><span class="op" id="3508517">)</span><span class="op" id="3508518">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3508521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508525">for</span>&nbsp;<span class="ident" id="3508529">_</span><span class="op" id="3508530">,</span>&nbsp;<span class="ident" id="3508532">p</span>&nbsp;<span class="op" id="3508534">:=</span>&nbsp;<span class="keyword" id="3508537">range</span>&nbsp;<span class="ident" id="3508543"><a href="/net/http/transport.go.html#3490443">strings</a></span><span class="op" id="3508550">.</span><span class="ident" id="3508551">Split</span><span class="op" id="3508556">(</span><span class="ident" id="3508557"><a href="/net/http/transport.go.html#3508336">no_proxy</a></span><span class="op" id="3508565">,</span>&nbsp;<span class="string" id="3508567">&#34;,&#34;</span><span class="op" id="3508570">)</span>&nbsp;<span class="op" id="3508572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3508576"><a href="/net/http/transport.go.html#3508532">p</a></span>&nbsp;<span class="op" id="3508578">=</span>&nbsp;<span class="ident" id="3508580"><a href="/net/http/transport.go.html#3490443">strings</a></span><span class="op" id="3508587">.</span><span class="ident" id="3508588">ToLower</span><span class="op" id="3508595">(</span><span class="ident" id="3508596"><a href="/net/http/transport.go.html#3490443">strings</a></span><span class="op" id="3508603">.</span><span class="ident" id="3508604">TrimSpace</span><span class="op" id="3508613">(</span><span class="ident" id="3508614"><a href="/net/http/transport.go.html#3508532">p</a></span><span class="op" id="3508615">)</span><span class="op" id="3508616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508620">if</span>&nbsp;<span class="builtinfunc" id="3508623">len</span><span class="op" id="3508626">(</span><span class="ident" id="3508627"><a href="/net/http/transport.go.html#3508532">p</a></span><span class="op" id="3508628">)</span>&nbsp;<span class="op" id="3508630">==</span>&nbsp;<span class="num" id="3508633">0</span>&nbsp;<span class="op" id="3508635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508640">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3508651">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508655">if</span>&nbsp;<span class="ident" id="3508658"><a href="/net/http/client.go.html#3314060">hasPort</a></span><span class="op" id="3508665">(</span><span class="ident" id="3508666"><a href="/net/http/transport.go.html#3508532">p</a></span><span class="op" id="3508667">)</span>&nbsp;<span class="op" id="3508669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3508674"><a href="/net/http/transport.go.html#3508532">p</a></span>&nbsp;<span class="op" id="3508676">=</span>&nbsp;<span class="ident" id="3508678"><a href="/net/http/transport.go.html#3508532">p</a></span><span class="op" id="3508679">[</span><span class="op" id="3508680">:</span><span class="ident" id="3508681"><a href="/net/http/transport.go.html#3490443">strings</a></span><span class="op" id="3508688">.</span><span class="ident" id="3508689">LastIndex</span><span class="op" id="3508698">(</span><span class="ident" id="3508699"><a href="/net/http/transport.go.html#3508532">p</a></span><span class="op" id="3508700">,</span>&nbsp;<span class="string" id="3508702">&#34;:&#34;</span><span class="op" id="3508705">)</span><span class="op" id="3508706">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3508710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508714">if</span>&nbsp;<span class="ident" id="3508717"><a href="/net/http/transport.go.html#3508069">addr</a></span>&nbsp;<span class="op" id="3508722">==</span>&nbsp;<span class="ident" id="3508725"><a href="/net/http/transport.go.html#3508532">p</a></span>&nbsp;<span class="op" id="3508727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508732">return</span>&nbsp;<span class="builtintype" id="3508739">false</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3508747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508751">if</span>&nbsp;<span class="ident" id="3508754"><a href="/net/http/transport.go.html#3508532">p</a></span><span class="op" id="3508755">[</span><span class="num" id="3508756">0</span><span class="op" id="3508757">]</span>&nbsp;<span class="op" id="3508759">==</span>&nbsp;<span class="string" id="3508762">&#39;.&#39;</span>&nbsp;<span class="op" id="3508766">&amp;&amp;</span>&nbsp;<span class="op" id="3508769">(</span><span class="ident" id="3508770"><a href="/net/http/transport.go.html#3490443">strings</a></span><span class="op" id="3508777">.</span><span class="ident" id="3508778">HasSuffix</span><span class="op" id="3508787">(</span><span class="ident" id="3508788"><a href="/net/http/transport.go.html#3508069">addr</a></span><span class="op" id="3508792">,</span>&nbsp;<span class="ident" id="3508794"><a href="/net/http/transport.go.html#3508532">p</a></span><span class="op" id="3508795">)</span>&nbsp;<span class="op" id="3508797">||</span>&nbsp;<span class="ident" id="3508800"><a href="/net/http/transport.go.html#3508069">addr</a></span>&nbsp;<span class="op" id="3508805">==</span>&nbsp;<span class="ident" id="3508808"><a href="/net/http/transport.go.html#3508532">p</a></span><span class="op" id="3508809">[</span><span class="num" id="3508810">1</span><span class="op" id="3508811">:</span><span class="op" id="3508812">]</span><span class="op" id="3508813">)</span>&nbsp;<span class="op" id="3508815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3508820">//&nbsp;no_proxy&nbsp;&#34;.foo.com&#34;&nbsp;matches&nbsp;&#34;bar.foo.com&#34;&nbsp;or&nbsp;&#34;foo.com&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508881">return</span>&nbsp;<span class="builtintype" id="3508888">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3508896">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3508900">if</span>&nbsp;<span class="ident" id="3508903"><a href="/net/http/transport.go.html#3508532">p</a></span><span class="op" id="3508904">[</span><span class="num" id="3508905">0</span><span class="op" id="3508906">]</span>&nbsp;<span class="op" id="3508908">!=</span>&nbsp;<span class="string" id="3508911">&#39;.&#39;</span>&nbsp;<span class="op" id="3508915">&amp;&amp;</span>&nbsp;<span class="ident" id="3508918"><a href="/net/http/transport.go.html#3490443">strings</a></span><span class="op" id="3508925">.</span><span class="ident" id="3508926">HasSuffix</span><span class="op" id="3508935">(</span><span class="ident" id="3508936"><a href="/net/http/transport.go.html#3508069">addr</a></span><span class="op" id="3508940">,</span>&nbsp;<span class="ident" id="3508942"><a href="/net/http/transport.go.html#3508532">p</a></span><span class="op" id="3508943">)</span>&nbsp;<span class="op" id="3508945">&amp;&amp;</span>&nbsp;<span class="ident" id="3508948"><a href="/net/http/transport.go.html#3508069">addr</a></span><span class="op" id="3508952">[</span><span class="builtinfunc" id="3508953">len</span><span class="op" id="3508956">(</span><span class="ident" id="3508957"><a href="/net/http/transport.go.html#3508069">addr</a></span><span class="op" id="3508961">)</span><span class="op" id="3508962">-</span><span class="builtinfunc" id="3508963">len</span><span class="op" id="3508966">(</span><span class="ident" id="3508967"><a href="/net/http/transport.go.html#3508532">p</a></span><span class="op" id="3508968">)</span><span class="op" id="3508969">-</span><span class="num" id="3508970">1</span><span class="op" id="3508971">]</span>&nbsp;<span class="op" id="3508973">==</span>&nbsp;<span class="string" id="3508976">&#39;.&#39;</span>&nbsp;<span class="op" id="3508980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3508985">//&nbsp;no_proxy&nbsp;&#34;foo.com&#34;&nbsp;matches&nbsp;&#34;bar.foo.com&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3509032">return</span>&nbsp;<span class="builtintype" id="3509039">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3509047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3509050">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3509053">return</span>&nbsp;<span class="builtintype" id="3509060">true</span><br>
<span class="lineno"></span><span class="op" id="3509065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3509068">//&nbsp;connectMethod&nbsp;is&nbsp;the&nbsp;map&nbsp;key&nbsp;(in&nbsp;its&nbsp;String&nbsp;form)&nbsp;for&nbsp;keeping&nbsp;persistent</span><br>
<span class="lineno"></span><span class="comment" id="3509144">//&nbsp;TCP&nbsp;connections&nbsp;alive&nbsp;for&nbsp;subsequent&nbsp;HTTP&nbsp;requests.</span><br>
<span class="lineno">720</span><span class="comment" id="3509199">//</span><br>
<span class="lineno"></span><span class="comment" id="3509202">//&nbsp;A&nbsp;connect&nbsp;method&nbsp;may&nbsp;be&nbsp;of&nbsp;the&nbsp;following&nbsp;types:</span><br>
<span class="lineno"></span><span class="comment" id="3509253">//</span><br>
<span class="lineno"></span><span class="comment" id="3509256">//&nbsp;Cache&nbsp;key&nbsp;form&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Description</span><br>
<span class="lineno"></span><span class="comment" id="3509301">//&nbsp;-----------------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-------------------------</span><br>
<span class="lineno">725</span><span class="comment" id="3509360">//&nbsp;|http|foo.com&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http&nbsp;directly&nbsp;to&nbsp;server,&nbsp;no&nbsp;proxy</span><br>
<span class="lineno"></span><span class="comment" id="3509427">//&nbsp;|https|foo.com&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https&nbsp;directly&nbsp;to&nbsp;server,&nbsp;no&nbsp;proxy</span><br>
<span class="lineno"></span><span class="comment" id="3509495">//&nbsp;http://proxy.com|https|foo.com&nbsp;&nbsp;http&nbsp;to&nbsp;proxy,&nbsp;then&nbsp;CONNECT&nbsp;to&nbsp;foo.com</span><br>
<span class="lineno"></span><span class="comment" id="3509569">//&nbsp;http://proxy.com|http&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http&nbsp;to&nbsp;proxy,&nbsp;http&nbsp;to&nbsp;anywhere&nbsp;after&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3509647">//</span><br>
<span class="lineno">730</span><span class="comment" id="3509650">//&nbsp;Note:&nbsp;no&nbsp;support&nbsp;to&nbsp;https&nbsp;to&nbsp;the&nbsp;proxy&nbsp;yet.</span><br>
<span class="lineno"></span><span class="comment" id="3509697">//</span><br>
<span class="lineno"></span><span class="keyword" id="3509700">type</span>&nbsp;<span class="ident" id="3509705">connectMethod</span>&nbsp;<span class="keyword" id="3509719">struct</span>&nbsp;<span class="op" id="3509726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3509729">proxyURL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3509742">*</span><span class="ident" id="3509743"><a href="/net/http/transport.go.html#3490426">url</a></span><span class="op" id="3509746">.</span><span class="ident" id="3509747">URL</span>&nbsp;<span class="comment" id="3509751">//&nbsp;nil&nbsp;for&nbsp;no&nbsp;proxy,&nbsp;else&nbsp;full&nbsp;proxy&nbsp;URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3509793">targetScheme</span>&nbsp;<span class="builtintype" id="3509806">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3509815">//&nbsp;&#34;http&#34;&nbsp;or&nbsp;&#34;https&#34;</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3509837">targetAddr</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3509850">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3509859">//&nbsp;Not&nbsp;used&nbsp;if&nbsp;proxy&nbsp;+&nbsp;http&nbsp;targetScheme&nbsp;(4th&nbsp;example&nbsp;in&nbsp;table)</span><br>
<span class="lineno"></span><span class="op" id="3509923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3509926">func</span>&nbsp;<span class="op" id="3509931">(</span><span class="ident" id="3509932">cm</span>&nbsp;<span class="op" id="3509935">*</span><span class="ident" id="3509936"><a href="/net/http/transport.go.html#3509705">connectMethod</a></span><span class="op" id="3509949">)</span>&nbsp;<span class="ident" id="3509951">key</span><span class="op" id="3509954">(</span><span class="op" id="3509955">)</span>&nbsp;<span class="ident" id="3509957"><a href="/net/http/transport.go.html#3510813">connectMethodKey</a></span>&nbsp;<span class="op" id="3509974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3509977">proxyStr</span>&nbsp;<span class="op" id="3509986">:=</span>&nbsp;<span class="string" id="3509989">&#34;&#34;</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3509993">targetAddr</span>&nbsp;<span class="op" id="3510004">:=</span>&nbsp;<span class="ident" id="3510007"><a href="/net/http/transport.go.html#3509932">cm</a></span><span class="op" id="3510009">.</span><span class="ident" id="3510010">targetAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3510022">if</span>&nbsp;<span class="ident" id="3510025"><a href="/net/http/transport.go.html#3509932">cm</a></span><span class="op" id="3510027">.</span><span class="ident" id="3510028">proxyURL</span>&nbsp;<span class="op" id="3510037">!=</span>&nbsp;<span class="ident" id="3510040">nil</span>&nbsp;<span class="op" id="3510044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3510048"><a href="/net/http/transport.go.html#3509977">proxyStr</a></span>&nbsp;<span class="op" id="3510057">=</span>&nbsp;<span class="ident" id="3510059"><a href="/net/http/transport.go.html#3509932">cm</a></span><span class="op" id="3510061">.</span><span class="ident" id="3510062">proxyURL</span><span class="op" id="3510070">.</span><span class="ident" id="3510071">String</span><span class="op" id="3510077">(</span><span class="op" id="3510078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3510082">if</span>&nbsp;<span class="ident" id="3510085"><a href="/net/http/transport.go.html#3509932">cm</a></span><span class="op" id="3510087">.</span><span class="ident" id="3510088">targetScheme</span>&nbsp;<span class="op" id="3510101">==</span>&nbsp;<span class="string" id="3510104">&#34;http&#34;</span>&nbsp;<span class="op" id="3510111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3510116"><a href="/net/http/transport.go.html#3509993">targetAddr</a></span>&nbsp;<span class="op" id="3510127">=</span>&nbsp;<span class="string" id="3510129">&#34;&#34;</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3510134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3510137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3510140">return</span>&nbsp;<span class="ident" id="3510147"><a href="/net/http/transport.go.html#3510813">connectMethodKey</a></span><span class="op" id="3510163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3510167">proxy</span><span class="op" id="3510172">:</span>&nbsp;&nbsp;<span class="ident" id="3510175"><a href="/net/http/transport.go.html#3509977">proxyStr</a></span><span class="op" id="3510183">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3510187">scheme</span><span class="op" id="3510193">:</span>&nbsp;<span class="ident" id="3510195"><a href="/net/http/transport.go.html#3509932">cm</a></span><span class="op" id="3510197">.</span><span class="ident" id="3510198">targetScheme</span><span class="op" id="3510210">,</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3510214">addr</span><span class="op" id="3510218">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3510222"><a href="/net/http/transport.go.html#3509993">targetAddr</a></span><span class="op" id="3510232">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3510235">}</span><br>
<span class="lineno"></span><span class="op" id="3510237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3510240">//&nbsp;addr&nbsp;returns&nbsp;the&nbsp;first&nbsp;hop&nbsp;&#34;host:port&#34;&nbsp;to&nbsp;which&nbsp;we&nbsp;need&nbsp;to&nbsp;TCP&nbsp;connect.</span><br>
<span class="lineno">755</span><span class="keyword" id="3510315">func</span>&nbsp;<span class="op" id="3510320">(</span><span class="ident" id="3510321">cm</span>&nbsp;<span class="op" id="3510324">*</span><span class="ident" id="3510325"><a href="/net/http/transport.go.html#3509705">connectMethod</a></span><span class="op" id="3510338">)</span>&nbsp;<span class="ident" id="3510340">addr</span><span class="op" id="3510344">(</span><span class="op" id="3510345">)</span>&nbsp;<span class="builtintype" id="3510347">string</span>&nbsp;<span class="op" id="3510354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3510357">if</span>&nbsp;<span class="ident" id="3510360"><a href="/net/http/transport.go.html#3510321">cm</a></span><span class="op" id="3510362">.</span><span class="ident" id="3510363">proxyURL</span>&nbsp;<span class="op" id="3510372">!=</span>&nbsp;<span class="ident" id="3510375">nil</span>&nbsp;<span class="op" id="3510379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3510383">return</span>&nbsp;<span class="ident" id="3510390"><a href="/net/http/transport.go.html#3521703">canonicalAddr</a></span><span class="op" id="3510403">(</span><span class="ident" id="3510404"><a href="/net/http/transport.go.html#3510321">cm</a></span><span class="op" id="3510406">.</span><span class="ident" id="3510407">proxyURL</span><span class="op" id="3510415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3510418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3510421">return</span>&nbsp;<span class="ident" id="3510428"><a href="/net/http/transport.go.html#3510321">cm</a></span><span class="op" id="3510430">.</span><span class="ident" id="3510431">targetAddr</span><br>
<span class="lineno">760</span><span class="op" id="3510442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3510445">//&nbsp;tlsHost&nbsp;returns&nbsp;the&nbsp;host&nbsp;name&nbsp;to&nbsp;match&nbsp;against&nbsp;the&nbsp;peer&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3510506">//&nbsp;TLS&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="3510526">func</span>&nbsp;<span class="op" id="3510531">(</span><span class="ident" id="3510532">cm</span>&nbsp;<span class="op" id="3510535">*</span><span class="ident" id="3510536"><a href="/net/http/transport.go.html#3509705">connectMethod</a></span><span class="op" id="3510549">)</span>&nbsp;<span class="ident" id="3510551">tlsHost</span><span class="op" id="3510558">(</span><span class="op" id="3510559">)</span>&nbsp;<span class="builtintype" id="3510561">string</span>&nbsp;<span class="op" id="3510568">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3510571">h</span>&nbsp;<span class="op" id="3510573">:=</span>&nbsp;<span class="ident" id="3510576"><a href="/net/http/transport.go.html#3510532">cm</a></span><span class="op" id="3510578">.</span><span class="ident" id="3510579">targetAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3510591">if</span>&nbsp;<span class="ident" id="3510594"><a href="/net/http/client.go.html#3314060">hasPort</a></span><span class="op" id="3510601">(</span><span class="ident" id="3510602"><a href="/net/http/transport.go.html#3510571">h</a></span><span class="op" id="3510603">)</span>&nbsp;<span class="op" id="3510605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3510609"><a href="/net/http/transport.go.html#3510571">h</a></span>&nbsp;<span class="op" id="3510611">=</span>&nbsp;<span class="ident" id="3510613"><a href="/net/http/transport.go.html#3510571">h</a></span><span class="op" id="3510614">[</span><span class="op" id="3510615">:</span><span class="ident" id="3510616"><a href="/net/http/transport.go.html#3490443">strings</a></span><span class="op" id="3510623">.</span><span class="ident" id="3510624">LastIndex</span><span class="op" id="3510633">(</span><span class="ident" id="3510634"><a href="/net/http/transport.go.html#3510571">h</a></span><span class="op" id="3510635">,</span>&nbsp;<span class="string" id="3510637">&#34;:&#34;</span><span class="op" id="3510640">)</span><span class="op" id="3510641">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3510644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3510647">return</span>&nbsp;<span class="ident" id="3510654"><a href="/net/http/transport.go.html#3510571">h</a></span><br>
<span class="lineno">770</span><span class="op" id="3510656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3510659">//&nbsp;connectMethodKey&nbsp;is&nbsp;the&nbsp;map&nbsp;key&nbsp;version&nbsp;of&nbsp;connectMethod,&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3510727">//&nbsp;stringified&nbsp;proxy&nbsp;URL&nbsp;(or&nbsp;the&nbsp;empty&nbsp;string)&nbsp;instead&nbsp;of&nbsp;a&nbsp;pointer&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3510798">//&nbsp;a&nbsp;URL.</span><br>
<span class="lineno">775</span><span class="keyword" id="3510808">type</span>&nbsp;<span class="ident" id="3510813">connectMethodKey</span>&nbsp;<span class="keyword" id="3510830">struct</span>&nbsp;<span class="op" id="3510837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3510840">proxy</span><span class="op" id="3510845">,</span>&nbsp;<span class="ident" id="3510847">scheme</span><span class="op" id="3510853">,</span>&nbsp;<span class="ident" id="3510855">addr</span>&nbsp;<span class="builtintype" id="3510860">string</span><br>
<span class="lineno"></span><span class="op" id="3510867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3510870">func</span>&nbsp;<span class="op" id="3510875">(</span><span class="ident" id="3510876">k</span>&nbsp;<span class="ident" id="3510878"><a href="/net/http/transport.go.html#3510813">connectMethodKey</a></span><span class="op" id="3510894">)</span>&nbsp;<span class="ident" id="3510896">String</span><span class="op" id="3510902">(</span><span class="op" id="3510903">)</span>&nbsp;<span class="builtintype" id="3510905">string</span>&nbsp;<span class="op" id="3510912">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3510915">//&nbsp;Only&nbsp;used&nbsp;by&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3510939">return</span>&nbsp;<span class="ident" id="3510946"><a href="/net/http/transport.go.html#3490399">fmt</a></span><span class="op" id="3510949">.</span><span class="ident" id="3510950">Sprintf</span><span class="op" id="3510957">(</span><span class="string" id="3510958">&#34;%s|%s|%s&#34;</span><span class="op" id="3510968">,</span>&nbsp;<span class="ident" id="3510970"><a href="/net/http/transport.go.html#3510876">k</a></span><span class="op" id="3510971">.</span><span class="ident" id="3510972">proxy</span><span class="op" id="3510977">,</span>&nbsp;<span class="ident" id="3510979"><a href="/net/http/transport.go.html#3510876">k</a></span><span class="op" id="3510980">.</span><span class="ident" id="3510981">scheme</span><span class="op" id="3510987">,</span>&nbsp;<span class="ident" id="3510989"><a href="/net/http/transport.go.html#3510876">k</a></span><span class="op" id="3510990">.</span><span class="ident" id="3510991">addr</span><span class="op" id="3510995">)</span><br>
<span class="lineno"></span><span class="op" id="3510997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3511000">//&nbsp;persistConn&nbsp;wraps&nbsp;a&nbsp;connection,&nbsp;usually&nbsp;a&nbsp;persistent&nbsp;one</span><br>
<span class="lineno">785</span><span class="comment" id="3511060">//&nbsp;(but&nbsp;may&nbsp;be&nbsp;used&nbsp;for&nbsp;non-keep-alive&nbsp;requests&nbsp;as&nbsp;well)</span><br>
<span class="lineno"></span><span class="keyword" id="3511117">type</span>&nbsp;<span class="ident" id="3511122">persistConn</span>&nbsp;<span class="keyword" id="3511134">struct</span>&nbsp;<span class="op" id="3511141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511144">t</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3511153">*</span><span class="ident" id="3511154"><a href="/net/http/transport.go.html#3491333">Transport</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511165">cacheKey</span>&nbsp;<span class="ident" id="3511174"><a href="/net/http/transport.go.html#3510813">connectMethodKey</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511192">conn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3511201"><a href="/net/http/transport.go.html#3490419">net</a></span><span class="op" id="3511204">.</span><span class="ident" id="3511205">Conn</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511211">tlsState</span>&nbsp;<span class="op" id="3511220">*</span><span class="ident" id="3511221"><a href="/net/http/transport.go.html#3490375">tls</a></span><span class="op" id="3511224">.</span><span class="ident" id="3511225">ConnectionState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511242">br</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3511251">*</span><span class="ident" id="3511252"><a href="/net/http/transport.go.html#3490349">bufio</a></span><span class="op" id="3511257">.</span><span class="ident" id="3511258">Reader</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3511271">//&nbsp;from&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511285">sawEOF</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3511294">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3511314">//&nbsp;whether&nbsp;we&#39;ve&nbsp;seen&nbsp;EOF&nbsp;from&nbsp;conn;&nbsp;owned&nbsp;by&nbsp;readLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511370">bw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3511379">*</span><span class="ident" id="3511380"><a href="/net/http/transport.go.html#3490349">bufio</a></span><span class="op" id="3511385">.</span><span class="ident" id="3511386">Writer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3511399">//&nbsp;to&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511411">reqch</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3511420">chan</span>&nbsp;<span class="ident" id="3511425"><a href="/net/http/transport.go.html#3517002">requestAndChan</a></span>&nbsp;<span class="comment" id="3511440">//&nbsp;written&nbsp;by&nbsp;roundTrip;&nbsp;read&nbsp;by&nbsp;readLoop</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511483">writech</span>&nbsp;&nbsp;<span class="keyword" id="3511492">chan</span>&nbsp;<span class="ident" id="3511497"><a href="/net/http/transport.go.html#3517449">writeRequest</a></span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3511512">//&nbsp;written&nbsp;by&nbsp;roundTrip;&nbsp;read&nbsp;by&nbsp;writeLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511556">closech</span>&nbsp;&nbsp;<span class="keyword" id="3511565">chan</span>&nbsp;<span class="keyword" id="3511570">struct</span><span class="op" id="3511576">{</span><span class="op" id="3511577">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3511585">//&nbsp;closed&nbsp;when&nbsp;conn&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511613">isProxy</span>&nbsp;&nbsp;<span class="builtintype" id="3511622">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3511628">//&nbsp;writeErrCh&nbsp;passes&nbsp;the&nbsp;request&nbsp;write&nbsp;error&nbsp;(usually&nbsp;nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3511688">//&nbsp;from&nbsp;the&nbsp;writeLoop&nbsp;goroutine&nbsp;to&nbsp;the&nbsp;readLoop&nbsp;which&nbsp;passes</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3511750">//&nbsp;it&nbsp;off&nbsp;to&nbsp;the&nbsp;res.Body&nbsp;reader,&nbsp;which&nbsp;then&nbsp;uses&nbsp;it&nbsp;to&nbsp;decide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3511814">//&nbsp;whether&nbsp;or&nbsp;not&nbsp;a&nbsp;connection&nbsp;can&nbsp;be&nbsp;reused.&nbsp;Issue&nbsp;7569.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511873">writeErrCh</span>&nbsp;<span class="keyword" id="3511884">chan</span>&nbsp;<span class="builtintype" id="3511889">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511897">lk</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3511918"><a href="/net/http/transport.go.html#3490454">sync</a></span><span class="op" id="3511922">.</span><span class="ident" id="3511923">Mutex</span>&nbsp;<span class="comment" id="3511929">//&nbsp;guards&nbsp;following&nbsp;fields</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511957">numExpectedResponses</span>&nbsp;<span class="builtintype" id="3511978">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511983">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3512004">bool</span>&nbsp;<span class="comment" id="3512009">//&nbsp;whether&nbsp;conn&nbsp;has&nbsp;been&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512042">broken</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3512063">bool</span>&nbsp;<span class="comment" id="3512068">//&nbsp;an&nbsp;error&nbsp;has&nbsp;happened&nbsp;on&nbsp;this&nbsp;connection;&nbsp;marked&nbsp;broken&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;reused.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3512148">//&nbsp;mutateHeaderFunc&nbsp;is&nbsp;an&nbsp;optional&nbsp;func&nbsp;to&nbsp;modify&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3512205">//&nbsp;headers&nbsp;on&nbsp;each&nbsp;outbound&nbsp;request&nbsp;before&nbsp;it&#39;s&nbsp;written.&nbsp;(the</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3512268">//&nbsp;original&nbsp;Request&nbsp;given&nbsp;to&nbsp;RoundTrip&nbsp;is&nbsp;not&nbsp;modified)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512325">mutateHeaderFunc</span>&nbsp;<span class="keyword" id="3512342">func</span><span class="op" id="3512346">(</span><span class="ident" id="3512347"><a href="/net/http/header.go.html#3356649">Header</a></span><span class="op" id="3512353">)</span><br>
<span class="lineno"></span><span class="op" id="3512355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3512358">//&nbsp;isBroken&nbsp;reports&nbsp;whether&nbsp;this&nbsp;connection&nbsp;is&nbsp;in&nbsp;a&nbsp;known&nbsp;broken&nbsp;state.</span><br>
<span class="lineno">815</span><span class="keyword" id="3512430">func</span>&nbsp;<span class="op" id="3512435">(</span><span class="ident" id="3512436">pc</span>&nbsp;<span class="op" id="3512439">*</span><span class="ident" id="3512440"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><span class="op" id="3512451">)</span>&nbsp;<span class="ident" id="3512453">isBroken</span><span class="op" id="3512461">(</span><span class="op" id="3512462">)</span>&nbsp;<span class="builtintype" id="3512464">bool</span>&nbsp;<span class="op" id="3512469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512472"><a href="/net/http/transport.go.html#3512436">pc</a></span><span class="op" id="3512474">.</span><span class="ident" id="3512475">lk</span><span class="op" id="3512477">.</span><span class="ident" id="3512478">Lock</span><span class="op" id="3512482">(</span><span class="op" id="3512483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512486">b</span>&nbsp;<span class="op" id="3512488">:=</span>&nbsp;<span class="ident" id="3512491"><a href="/net/http/transport.go.html#3512436">pc</a></span><span class="op" id="3512493">.</span><span class="ident" id="3512494">broken</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512502"><a href="/net/http/transport.go.html#3512436">pc</a></span><span class="op" id="3512504">.</span><span class="ident" id="3512505">lk</span><span class="op" id="3512507">.</span><span class="ident" id="3512508">Unlock</span><span class="op" id="3512514">(</span><span class="op" id="3512515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512518">return</span>&nbsp;<span class="ident" id="3512525"><a href="/net/http/transport.go.html#3512486">b</a></span><br>
<span class="lineno">820</span><span class="op" id="3512527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3512530">func</span>&nbsp;<span class="op" id="3512535">(</span><span class="ident" id="3512536">pc</span>&nbsp;<span class="op" id="3512539">*</span><span class="ident" id="3512540"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><span class="op" id="3512551">)</span>&nbsp;<span class="ident" id="3512553">cancelRequest</span><span class="op" id="3512566">(</span><span class="op" id="3512567">)</span>&nbsp;<span class="op" id="3512569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512572"><a href="/net/http/transport.go.html#3512536">pc</a></span><span class="op" id="3512574">.</span><span class="ident" id="3512575">conn</span><span class="op" id="3512579">.</span><span class="ident" id="3512580">Close</span><span class="op" id="3512585">(</span><span class="op" id="3512586">)</span><br>
<span class="lineno"></span><span class="op" id="3512588">}</span><br>
<span class="lineno">825</span><br>
<span class="lineno"></span><span class="keyword" id="3512591">var</span>&nbsp;<span class="ident" id="3512595">remoteSideClosedFunc</span>&nbsp;<span class="keyword" id="3512616">func</span><span class="op" id="3512620">(</span><span class="builtintype" id="3512621">error</span><span class="op" id="3512626">)</span>&nbsp;<span class="builtintype" id="3512628">bool</span>&nbsp;<span class="comment" id="3512633">//&nbsp;or&nbsp;nil&nbsp;to&nbsp;use&nbsp;default</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3512659">func</span>&nbsp;<span class="ident" id="3512664">remoteSideClosed</span><span class="op" id="3512680">(</span><span class="ident" id="3512681">err</span>&nbsp;<span class="builtintype" id="3512685">error</span><span class="op" id="3512690">)</span>&nbsp;<span class="builtintype" id="3512692">bool</span>&nbsp;<span class="op" id="3512697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512700">if</span>&nbsp;<span class="ident" id="3512703"><a href="/net/http/transport.go.html#3512681">err</a></span>&nbsp;<span class="op" id="3512707">==</span>&nbsp;<span class="ident" id="3512710"><a href="/net/http/transport.go.html#3490406">io</a></span><span class="op" id="3512712">.</span><span class="ident" id="3512713">EOF</span>&nbsp;<span class="op" id="3512717">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512721">return</span>&nbsp;<span class="builtintype" id="3512728">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3512734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512737">if</span>&nbsp;<span class="ident" id="3512740"><a href="/net/http/transport.go.html#3512595">remoteSideClosedFunc</a></span>&nbsp;<span class="op" id="3512761">!=</span>&nbsp;<span class="ident" id="3512764">nil</span>&nbsp;<span class="op" id="3512768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512772">return</span>&nbsp;<span class="ident" id="3512779"><a href="/net/http/transport.go.html#3512595">remoteSideClosedFunc</a></span><span class="op" id="3512799">(</span><span class="ident" id="3512800"><a href="/net/http/transport.go.html#3512681">err</a></span><span class="op" id="3512803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3512806">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512809">return</span>&nbsp;<span class="builtintype" id="3512816">false</span><br>
<span class="lineno"></span><span class="op" id="3512822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3512825">func</span>&nbsp;<span class="op" id="3512830">(</span><span class="ident" id="3512831">pc</span>&nbsp;<span class="op" id="3512834">*</span><span class="ident" id="3512835"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><span class="op" id="3512846">)</span>&nbsp;<span class="ident" id="3512848">readLoop</span><span class="op" id="3512856">(</span><span class="op" id="3512857">)</span>&nbsp;<span class="op" id="3512859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512862">alive</span>&nbsp;<span class="op" id="3512868">:=</span>&nbsp;<span class="builtintype" id="3512871">true</span><br>
<span class="lineno">840</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512878">for</span>&nbsp;<span class="ident" id="3512882"><a href="/net/http/transport.go.html#3512862">alive</a></span>&nbsp;<span class="op" id="3512888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512892">pb</span><span class="op" id="3512894">,</span>&nbsp;<span class="ident" id="3512896">err</span>&nbsp;<span class="op" id="3512900">:=</span>&nbsp;<span class="ident" id="3512903"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3512905">.</span><span class="ident" id="3512906">br</span><span class="op" id="3512908">.</span><span class="ident" id="3512909">Peek</span><span class="op" id="3512913">(</span><span class="num" id="3512914">1</span><span class="op" id="3512915">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512920"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3512922">.</span><span class="ident" id="3512923">lk</span><span class="op" id="3512925">.</span><span class="ident" id="3512926">Lock</span><span class="op" id="3512930">(</span><span class="op" id="3512931">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512935">if</span>&nbsp;<span class="ident" id="3512938"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3512940">.</span><span class="ident" id="3512941">numExpectedResponses</span>&nbsp;<span class="op" id="3512962">==</span>&nbsp;<span class="num" id="3512965">0</span>&nbsp;<span class="op" id="3512967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512972">if</span>&nbsp;<span class="op" id="3512975">!</span><span class="ident" id="3512976"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3512978">.</span><span class="ident" id="3512979">closed</span>&nbsp;<span class="op" id="3512986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512992"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3512994">.</span><span class="ident" id="3512995">closeLocked</span><span class="op" id="3513006">(</span><span class="op" id="3513007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3513013">if</span>&nbsp;<span class="builtinfunc" id="3513016">len</span><span class="op" id="3513019">(</span><span class="ident" id="3513020"><a href="/net/http/transport.go.html#3512892">pb</a></span><span class="op" id="3513022">)</span>&nbsp;<span class="op" id="3513024">&gt;</span>&nbsp;<span class="num" id="3513026">0</span>&nbsp;<span class="op" id="3513028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3513035"><a href="/net/http/transport.go.html#3490412">log</a></span><span class="op" id="3513038">.</span><span class="ident" id="3513039">Printf</span><span class="op" id="3513045">(</span><span class="string" id="3513046">&#34;Unsolicited&nbsp;response&nbsp;received&nbsp;on&nbsp;idle&nbsp;HTTP&nbsp;channel&nbsp;starting&nbsp;with&nbsp;%q;&nbsp;err=%v&#34;</span><span class="op" id="3513123">,</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3513131">string</span><span class="op" id="3513137">(</span><span class="ident" id="3513138"><a href="/net/http/transport.go.html#3512892">pb</a></span><span class="op" id="3513140">)</span><span class="op" id="3513141">,</span>&nbsp;<span class="ident" id="3513143"><a href="/net/http/transport.go.html#3512896">err</a></span><span class="op" id="3513146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3513152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3513157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3513162"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3513164">.</span><span class="ident" id="3513165">lk</span><span class="op" id="3513167">.</span><span class="ident" id="3513168">Unlock</span><span class="op" id="3513174">(</span><span class="op" id="3513175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3513180">return</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3513189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3513193"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3513195">.</span><span class="ident" id="3513196">lk</span><span class="op" id="3513198">.</span><span class="ident" id="3513199">Unlock</span><span class="op" id="3513205">(</span><span class="op" id="3513206">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3513211">rc</span>&nbsp;<span class="op" id="3513214">:=</span>&nbsp;<span class="op" id="3513217">&lt;-</span><span class="ident" id="3513219"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3513221">.</span><span class="ident" id="3513222">reqch</span><br>
<span class="lineno"></span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3513231">var</span>&nbsp;<span class="ident" id="3513235">resp</span>&nbsp;<span class="op" id="3513240">*</span><span class="ident" id="3513241"><a href="/net/http/response.go.html#3392041">Response</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3513252">if</span>&nbsp;<span class="ident" id="3513255"><a href="/net/http/transport.go.html#3512896">err</a></span>&nbsp;<span class="op" id="3513259">==</span>&nbsp;<span class="ident" id="3513262">nil</span>&nbsp;<span class="op" id="3513266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3513271"><a href="/net/http/transport.go.html#3513235">resp</a></span><span class="op" id="3513275">,</span>&nbsp;<span class="ident" id="3513277"><a href="/net/http/transport.go.html#3512896">err</a></span>&nbsp;<span class="op" id="3513281">=</span>&nbsp;<span class="ident" id="3513283"><a href="/net/http/response.go.html#3395244">ReadResponse</a></span><span class="op" id="3513295">(</span><span class="ident" id="3513296"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3513298">.</span><span class="ident" id="3513299">br</span><span class="op" id="3513301">,</span>&nbsp;<span class="ident" id="3513303"><a href="/net/http/transport.go.html#3513211">rc</a></span><span class="op" id="3513305">.</span><span class="ident" id="3513306">req</span><span class="op" id="3513309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3513314">if</span>&nbsp;<span class="ident" id="3513317"><a href="/net/http/transport.go.html#3512896">err</a></span>&nbsp;<span class="op" id="3513321">==</span>&nbsp;<span class="ident" id="3513324">nil</span>&nbsp;<span class="op" id="3513328">&amp;&amp;</span>&nbsp;<span class="ident" id="3513331"><a href="/net/http/transport.go.html#3513235">resp</a></span><span class="op" id="3513335">.</span><span class="ident" id="3513336">StatusCode</span>&nbsp;<span class="op" id="3513347">==</span>&nbsp;<span class="num" id="3513350">100</span>&nbsp;<span class="op" id="3513354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3513360">//&nbsp;Skip&nbsp;any&nbsp;100-continue&nbsp;for&nbsp;now.</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3513398">//&nbsp;TODO(bradfitz):&nbsp;if&nbsp;rc.req&nbsp;had&nbsp;&#34;Expect:&nbsp;100-continue&#34;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3513459">//&nbsp;actually&nbsp;block&nbsp;the&nbsp;request&nbsp;body&nbsp;write&nbsp;and&nbsp;signal&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3513519">//&nbsp;writeLoop&nbsp;now&nbsp;to&nbsp;begin&nbsp;sending&nbsp;it.&nbsp;(Issue&nbsp;2184)&nbsp;For&nbsp;now&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3513585">//&nbsp;eat&nbsp;it,&nbsp;since&nbsp;we&#39;re&nbsp;never&nbsp;expecting&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3513633"><a href="/net/http/transport.go.html#3513235">resp</a></span><span class="op" id="3513637">,</span>&nbsp;<span class="ident" id="3513639"><a href="/net/http/transport.go.html#3512896">err</a></span>&nbsp;<span class="op" id="3513643">=</span>&nbsp;<span class="ident" id="3513645"><a href="/net/http/response.go.html#3395244">ReadResponse</a></span><span class="op" id="3513657">(</span><span class="ident" id="3513658"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3513660">.</span><span class="ident" id="3513661">br</span><span class="op" id="3513663">,</span>&nbsp;<span class="ident" id="3513665"><a href="/net/http/transport.go.html#3513211">rc</a></span><span class="op" id="3513667">.</span><span class="ident" id="3513668">req</span><span class="op" id="3513671">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3513676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3513680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3513685">if</span>&nbsp;<span class="ident" id="3513688"><a href="/net/http/transport.go.html#3513235">resp</a></span>&nbsp;<span class="op" id="3513693">!=</span>&nbsp;<span class="ident" id="3513696">nil</span>&nbsp;<span class="op" id="3513700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3513705"><a href="/net/http/transport.go.html#3513235">resp</a></span><span class="op" id="3513709">.</span><span class="ident" id="3513710">TLS</span>&nbsp;<span class="op" id="3513714">=</span>&nbsp;<span class="ident" id="3513716"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3513718">.</span><span class="ident" id="3513719">tlsState</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3513730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3513735">hasBody</span>&nbsp;<span class="op" id="3513743">:=</span>&nbsp;<span class="ident" id="3513746"><a href="/net/http/transport.go.html#3513235">resp</a></span>&nbsp;<span class="op" id="3513751">!=</span>&nbsp;<span class="ident" id="3513754">nil</span>&nbsp;<span class="op" id="3513758">&amp;&amp;</span>&nbsp;<span class="ident" id="3513761"><a href="/net/http/transport.go.html#3513211">rc</a></span><span class="op" id="3513763">.</span><span class="ident" id="3513764">req</span><span class="op" id="3513767">.</span><span class="ident" id="3513768">Method</span>&nbsp;<span class="op" id="3513775">!=</span>&nbsp;<span class="string" id="3513778">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="3513785">&amp;&amp;</span>&nbsp;<span class="ident" id="3513788"><a href="/net/http/transport.go.html#3513235">resp</a></span><span class="op" id="3513792">.</span><span class="ident" id="3513793">ContentLength</span>&nbsp;<span class="op" id="3513807">!=</span>&nbsp;<span class="num" id="3513810">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3513815">if</span>&nbsp;<span class="ident" id="3513818"><a href="/net/http/transport.go.html#3512896">err</a></span>&nbsp;<span class="op" id="3513822">!=</span>&nbsp;<span class="ident" id="3513825">nil</span>&nbsp;<span class="op" id="3513829">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3513834"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3513836">.</span><span class="builtinfunc" id="3513837">close</span><span class="op" id="3513842">(</span><span class="op" id="3513843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3513847">}</span>&nbsp;<span class="keyword" id="3513849">else</span>&nbsp;<span class="op" id="3513854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3513859">if</span>&nbsp;<span class="ident" id="3513862"><a href="/net/http/transport.go.html#3513211">rc</a></span><span class="op" id="3513864">.</span><span class="ident" id="3513865">addedGzip</span>&nbsp;<span class="op" id="3513875">&amp;&amp;</span>&nbsp;<span class="ident" id="3513878"><a href="/net/http/transport.go.html#3513735">hasBody</a></span>&nbsp;<span class="op" id="3513886">&amp;&amp;</span>&nbsp;<span class="ident" id="3513889"><a href="/net/http/transport.go.html#3513235">resp</a></span><span class="op" id="3513893">.</span><span class="ident" id="3513894">Header</span><span class="op" id="3513900">.</span><span class="ident" id="3513901">Get</span><span class="op" id="3513904">(</span><span class="string" id="3513905">&#34;Content-Encoding&#34;</span><span class="op" id="3513923">)</span>&nbsp;<span class="op" id="3513925">==</span>&nbsp;<span class="string" id="3513928">&#34;gzip&#34;</span>&nbsp;<span class="op" id="3513935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3513941"><a href="/net/http/transport.go.html#3513235">resp</a></span><span class="op" id="3513945">.</span><span class="ident" id="3513946">Header</span><span class="op" id="3513952">.</span><span class="ident" id="3513953">Del</span><span class="op" id="3513956">(</span><span class="string" id="3513957">&#34;Content-Encoding&#34;</span><span class="op" id="3513975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3513981"><a href="/net/http/transport.go.html#3513235">resp</a></span><span class="op" id="3513985">.</span><span class="ident" id="3513986">Header</span><span class="op" id="3513992">.</span><span class="ident" id="3513993">Del</span><span class="op" id="3513996">(</span><span class="string" id="3513997">&#34;Content-Length&#34;</span><span class="op" id="3514013">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514019"><a href="/net/http/transport.go.html#3513235">resp</a></span><span class="op" id="3514023">.</span><span class="ident" id="3514024">ContentLength</span>&nbsp;<span class="op" id="3514038">=</span>&nbsp;<span class="op" id="3514040">-</span><span class="num" id="3514041">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514047"><a href="/net/http/transport.go.html#3513235">resp</a></span><span class="op" id="3514051">.</span><span class="ident" id="3514052">Body</span>&nbsp;<span class="op" id="3514057">=</span>&nbsp;<span class="op" id="3514059">&amp;</span><span class="ident" id="3514060"><a href="/net/http/transport.go.html#3523454">gzipReader</a></span><span class="op" id="3514070">{</span><span class="ident" id="3514071">body</span><span class="op" id="3514075">:</span>&nbsp;<span class="ident" id="3514077"><a href="/net/http/transport.go.html#3513235">resp</a></span><span class="op" id="3514081">.</span><span class="ident" id="3514082">Body</span><span class="op" id="3514086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3514091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514096"><a href="/net/http/transport.go.html#3513235">resp</a></span><span class="op" id="3514100">.</span><span class="ident" id="3514101">Body</span>&nbsp;<span class="op" id="3514106">=</span>&nbsp;<span class="op" id="3514108">&amp;</span><span class="ident" id="3514109"><a href="/net/http/transport.go.html#3522162">bodyEOFSignal</a></span><span class="op" id="3514122">{</span><span class="ident" id="3514123">body</span><span class="op" id="3514127">:</span>&nbsp;<span class="ident" id="3514129"><a href="/net/http/transport.go.html#3513235">resp</a></span><span class="op" id="3514133">.</span><span class="ident" id="3514134">Body</span><span class="op" id="3514138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3514142">}</span><br>
<span class="lineno">890</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3514147">if</span>&nbsp;<span class="ident" id="3514150"><a href="/net/http/transport.go.html#3512896">err</a></span>&nbsp;<span class="op" id="3514154">!=</span>&nbsp;<span class="ident" id="3514157">nil</span>&nbsp;<span class="op" id="3514161">||</span>&nbsp;<span class="ident" id="3514164"><a href="/net/http/transport.go.html#3513235">resp</a></span><span class="op" id="3514168">.</span><span class="ident" id="3514169">Close</span>&nbsp;<span class="op" id="3514175">||</span>&nbsp;<span class="ident" id="3514178"><a href="/net/http/transport.go.html#3513211">rc</a></span><span class="op" id="3514180">.</span><span class="ident" id="3514181">req</span><span class="op" id="3514184">.</span><span class="ident" id="3514185">Close</span>&nbsp;<span class="op" id="3514191">||</span>&nbsp;<span class="ident" id="3514194"><a href="/net/http/transport.go.html#3513235">resp</a></span><span class="op" id="3514198">.</span><span class="ident" id="3514199">StatusCode</span>&nbsp;<span class="op" id="3514210">&lt;=</span>&nbsp;<span class="num" id="3514213">199</span>&nbsp;<span class="op" id="3514217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3514222">//&nbsp;Don&#39;t&nbsp;do&nbsp;keep-alive&nbsp;on&nbsp;error&nbsp;if&nbsp;either&nbsp;party&nbsp;requested&nbsp;a&nbsp;close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3514291">//&nbsp;or&nbsp;we&nbsp;get&nbsp;an&nbsp;unexpected&nbsp;informational&nbsp;(1xx)&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3514351">//&nbsp;StatusCode&nbsp;100&nbsp;is&nbsp;already&nbsp;handled&nbsp;above.</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514398"><a href="/net/http/transport.go.html#3512862">alive</a></span>&nbsp;<span class="op" id="3514404">=</span>&nbsp;<span class="builtintype" id="3514406">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3514414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3514419">var</span>&nbsp;<span class="ident" id="3514423">waitForBodyRead</span>&nbsp;<span class="keyword" id="3514439">chan</span>&nbsp;<span class="builtintype" id="3514444">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3514451">if</span>&nbsp;<span class="ident" id="3514454"><a href="/net/http/transport.go.html#3513735">hasBody</a></span>&nbsp;<span class="op" id="3514462">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514467"><a href="/net/http/transport.go.html#3514423">waitForBodyRead</a></span>&nbsp;<span class="op" id="3514483">=</span>&nbsp;<span class="builtinfunc" id="3514485">make</span><span class="op" id="3514489">(</span><span class="keyword" id="3514490">chan</span>&nbsp;<span class="builtintype" id="3514495">bool</span><span class="op" id="3514499">,</span>&nbsp;<span class="num" id="3514501">2</span><span class="op" id="3514502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514507"><a href="/net/http/transport.go.html#3513235">resp</a></span><span class="op" id="3514511">.</span><span class="ident" id="3514512">Body</span><span class="op" id="3514516">.</span><span class="op" id="3514517">(</span><span class="op" id="3514518">*</span><span class="ident" id="3514519"><a href="/net/http/transport.go.html#3522162">bodyEOFSignal</a></span><span class="op" id="3514532">)</span><span class="op" id="3514533">.</span><span class="ident" id="3514534">earlyCloseFn</span>&nbsp;<span class="op" id="3514547">=</span>&nbsp;<span class="keyword" id="3514549">func</span><span class="op" id="3514553">(</span><span class="op" id="3514554">)</span>&nbsp;<span class="builtintype" id="3514556">error</span>&nbsp;<span class="op" id="3514562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3514568">//&nbsp;Sending&nbsp;false&nbsp;here&nbsp;sets&nbsp;alive&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3514608">//&nbsp;false&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3514647">//&nbsp;below.</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514661"><a href="/net/http/transport.go.html#3514423">waitForBodyRead</a></span>&nbsp;<span class="op" id="3514677">&lt;-</span>&nbsp;<span class="builtintype" id="3514680">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3514690">return</span>&nbsp;<span class="ident" id="3514697">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3514704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514709"><a href="/net/http/transport.go.html#3513235">resp</a></span><span class="op" id="3514713">.</span><span class="ident" id="3514714">Body</span><span class="op" id="3514718">.</span><span class="op" id="3514719">(</span><span class="op" id="3514720">*</span><span class="ident" id="3514721"><a href="/net/http/transport.go.html#3522162">bodyEOFSignal</a></span><span class="op" id="3514734">)</span><span class="op" id="3514735">.</span><span class="ident" id="3514736">fn</span>&nbsp;<span class="op" id="3514739">=</span>&nbsp;<span class="keyword" id="3514741">func</span><span class="op" id="3514745">(</span><span class="ident" id="3514746">err</span>&nbsp;<span class="builtintype" id="3514750">error</span><span class="op" id="3514755">)</span>&nbsp;<span class="op" id="3514757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514763"><a href="/net/http/transport.go.html#3514423">waitForBodyRead</a></span>&nbsp;<span class="op" id="3514779">&lt;-</span>&nbsp;<span class="ident" id="3514782"><a href="/net/http/transport.go.html#3512862">alive</a></span>&nbsp;<span class="op" id="3514788">&amp;&amp;</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514796"><a href="/net/http/transport.go.html#3514746">err</a></span>&nbsp;<span class="op" id="3514800">==</span>&nbsp;<span class="ident" id="3514803">nil</span>&nbsp;<span class="op" id="3514807">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3514815">!</span><span class="ident" id="3514816"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3514818">.</span><span class="ident" id="3514819">sawEOF</span>&nbsp;<span class="op" id="3514826">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514834"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3514836">.</span><span class="ident" id="3514837">wroteRequest</span><span class="op" id="3514849">(</span><span class="op" id="3514850">)</span>&nbsp;<span class="op" id="3514852">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514860"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3514862">.</span><span class="ident" id="3514863">t</span><span class="op" id="3514864">.</span><span class="ident" id="3514865">putIdleConn</span><span class="op" id="3514876">(</span><span class="ident" id="3514877"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3514879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3514884">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3514888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3514893">if</span>&nbsp;<span class="ident" id="3514896"><a href="/net/http/transport.go.html#3512862">alive</a></span>&nbsp;<span class="op" id="3514902">&amp;&amp;</span>&nbsp;<span class="op" id="3514905">!</span><span class="ident" id="3514906"><a href="/net/http/transport.go.html#3513735">hasBody</a></span>&nbsp;<span class="op" id="3514914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514919"><a href="/net/http/transport.go.html#3512862">alive</a></span>&nbsp;<span class="op" id="3514925">=</span>&nbsp;<span class="op" id="3514927">!</span><span class="ident" id="3514928"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3514930">.</span><span class="ident" id="3514931">sawEOF</span>&nbsp;<span class="op" id="3514938">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514945"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3514947">.</span><span class="ident" id="3514948">wroteRequest</span><span class="op" id="3514960">(</span><span class="op" id="3514961">)</span>&nbsp;<span class="op" id="3514963">&amp;&amp;</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514970"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3514972">.</span><span class="ident" id="3514973">t</span><span class="op" id="3514974">.</span><span class="ident" id="3514975">putIdleConn</span><span class="op" id="3514986">(</span><span class="ident" id="3514987"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3514989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3514993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514998"><a href="/net/http/transport.go.html#3513211">rc</a></span><span class="op" id="3515000">.</span><span class="ident" id="3515001">ch</span>&nbsp;<span class="op" id="3515004">&lt;-</span>&nbsp;<span class="ident" id="3515007"><a href="/net/http/transport.go.html#3516942">responseAndError</a></span><span class="op" id="3515023">{</span><span class="ident" id="3515024"><a href="/net/http/transport.go.html#3513235">resp</a></span><span class="op" id="3515028">,</span>&nbsp;<span class="ident" id="3515030"><a href="/net/http/transport.go.html#3512896">err</a></span><span class="op" id="3515033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3515038">//&nbsp;Wait&nbsp;for&nbsp;the&nbsp;just-returned&nbsp;response&nbsp;body&nbsp;to&nbsp;be&nbsp;fully&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3515105">//&nbsp;before&nbsp;we&nbsp;race&nbsp;and&nbsp;peek&nbsp;on&nbsp;the&nbsp;underlying&nbsp;bufio&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515166">if</span>&nbsp;<span class="ident" id="3515169"><a href="/net/http/transport.go.html#3514423">waitForBodyRead</a></span>&nbsp;<span class="op" id="3515185">!=</span>&nbsp;<span class="ident" id="3515188">nil</span>&nbsp;<span class="op" id="3515192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515197">select</span>&nbsp;<span class="op" id="3515204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515209">case</span>&nbsp;<span class="ident" id="3515214"><a href="/net/http/transport.go.html#3512862">alive</a></span>&nbsp;<span class="op" id="3515220">=</span>&nbsp;<span class="op" id="3515222">&lt;-</span><span class="ident" id="3515224"><a href="/net/http/transport.go.html#3514423">waitForBodyRead</a></span><span class="op" id="3515239">:</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515244">case</span>&nbsp;<span class="op" id="3515249">&lt;-</span><span class="ident" id="3515251"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3515253">.</span><span class="ident" id="3515254">closech</span><span class="op" id="3515261">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515267"><a href="/net/http/transport.go.html#3512862">alive</a></span>&nbsp;<span class="op" id="3515273">=</span>&nbsp;<span class="builtintype" id="3515275">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515293"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3515295">.</span><span class="ident" id="3515296">t</span><span class="op" id="3515297">.</span><span class="ident" id="3515298">setReqCanceler</span><span class="op" id="3515312">(</span><span class="ident" id="3515313"><a href="/net/http/transport.go.html#3513211">rc</a></span><span class="op" id="3515315">.</span><span class="ident" id="3515316">req</span><span class="op" id="3515319">,</span>&nbsp;<span class="ident" id="3515321">nil</span><span class="op" id="3515324">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515329">if</span>&nbsp;<span class="op" id="3515332">!</span><span class="ident" id="3515333"><a href="/net/http/transport.go.html#3512862">alive</a></span>&nbsp;<span class="op" id="3515339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515344"><a href="/net/http/transport.go.html#3512831">pc</a></span><span class="op" id="3515346">.</span><span class="builtinfunc" id="3515347">close</span><span class="op" id="3515352">(</span><span class="op" id="3515353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515357">}</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515360">}</span><br>
<span class="lineno"></span><span class="op" id="3515362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3515365">func</span>&nbsp;<span class="op" id="3515370">(</span><span class="ident" id="3515371">pc</span>&nbsp;<span class="op" id="3515374">*</span><span class="ident" id="3515375"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><span class="op" id="3515386">)</span>&nbsp;<span class="ident" id="3515388">writeLoop</span><span class="op" id="3515397">(</span><span class="op" id="3515398">)</span>&nbsp;<span class="op" id="3515400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515403">for</span>&nbsp;<span class="op" id="3515407">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515411">select</span>&nbsp;<span class="op" id="3515418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515422">case</span>&nbsp;<span class="ident" id="3515427">wr</span>&nbsp;<span class="op" id="3515430">:=</span>&nbsp;<span class="op" id="3515433">&lt;-</span><span class="ident" id="3515435"><a href="/net/http/transport.go.html#3515371">pc</a></span><span class="op" id="3515437">.</span><span class="ident" id="3515438">writech</span><span class="op" id="3515445">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515450">if</span>&nbsp;<span class="ident" id="3515453"><a href="/net/http/transport.go.html#3515371">pc</a></span><span class="op" id="3515455">.</span><span class="ident" id="3515456">isBroken</span><span class="op" id="3515464">(</span><span class="op" id="3515465">)</span>&nbsp;<span class="op" id="3515467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515473"><a href="/net/http/transport.go.html#3515427">wr</a></span><span class="op" id="3515475">.</span><span class="ident" id="3515476">ch</span>&nbsp;<span class="op" id="3515479">&lt;-</span>&nbsp;<span class="ident" id="3515482"><a href="/net/http/transport.go.html#3490389">errors</a></span><span class="op" id="3515488">.</span><span class="ident" id="3515489">New</span><span class="op" id="3515492">(</span><span class="string" id="3515493">&#34;http:&nbsp;can&#39;t&nbsp;write&nbsp;HTTP&nbsp;request&nbsp;on&nbsp;broken&nbsp;connection&#34;</span><span class="op" id="3515546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515552">continue</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515569">err</span>&nbsp;<span class="op" id="3515573">:=</span>&nbsp;<span class="ident" id="3515576"><a href="/net/http/transport.go.html#3515427">wr</a></span><span class="op" id="3515578">.</span><span class="ident" id="3515579">req</span><span class="op" id="3515582">.</span><span class="ident" id="3515583">Request</span><span class="op" id="3515590">.</span><span class="ident" id="3515591">write</span><span class="op" id="3515596">(</span><span class="ident" id="3515597"><a href="/net/http/transport.go.html#3515371">pc</a></span><span class="op" id="3515599">.</span><span class="ident" id="3515600">bw</span><span class="op" id="3515602">,</span>&nbsp;<span class="ident" id="3515604"><a href="/net/http/transport.go.html#3515371">pc</a></span><span class="op" id="3515606">.</span><span class="ident" id="3515607">isProxy</span><span class="op" id="3515614">,</span>&nbsp;<span class="ident" id="3515616"><a href="/net/http/transport.go.html#3515427">wr</a></span><span class="op" id="3515618">.</span><span class="ident" id="3515619">req</span><span class="op" id="3515622">.</span><span class="ident" id="3515623">extra</span><span class="op" id="3515628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515633">if</span>&nbsp;<span class="ident" id="3515636"><a href="/net/http/transport.go.html#3515569">err</a></span>&nbsp;<span class="op" id="3515640">==</span>&nbsp;<span class="ident" id="3515643">nil</span>&nbsp;<span class="op" id="3515647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515653"><a href="/net/http/transport.go.html#3515569">err</a></span>&nbsp;<span class="op" id="3515657">=</span>&nbsp;<span class="ident" id="3515659"><a href="/net/http/transport.go.html#3515371">pc</a></span><span class="op" id="3515661">.</span><span class="ident" id="3515662">bw</span><span class="op" id="3515664">.</span><span class="ident" id="3515665">Flush</span><span class="op" id="3515670">(</span><span class="op" id="3515671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515676">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515681">if</span>&nbsp;<span class="ident" id="3515684"><a href="/net/http/transport.go.html#3515569">err</a></span>&nbsp;<span class="op" id="3515688">!=</span>&nbsp;<span class="ident" id="3515691">nil</span>&nbsp;<span class="op" id="3515695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515701"><a href="/net/http/transport.go.html#3515371">pc</a></span><span class="op" id="3515703">.</span><span class="ident" id="3515704">markBroken</span><span class="op" id="3515714">(</span><span class="op" id="3515715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515721"><a href="/net/http/transport.go.html#3515427">wr</a></span><span class="op" id="3515723">.</span><span class="ident" id="3515724">req</span><span class="op" id="3515727">.</span><span class="ident" id="3515728">Request</span><span class="op" id="3515735">.</span><span class="ident" id="3515736">closeBody</span><span class="op" id="3515745">(</span><span class="op" id="3515746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515756"><a href="/net/http/transport.go.html#3515371">pc</a></span><span class="op" id="3515758">.</span><span class="ident" id="3515759">writeErrCh</span>&nbsp;<span class="op" id="3515770">&lt;-</span>&nbsp;<span class="ident" id="3515773"><a href="/net/http/transport.go.html#3515569">err</a></span>&nbsp;<span class="comment" id="3515777">//&nbsp;to&nbsp;the&nbsp;body&nbsp;reader,&nbsp;which&nbsp;might&nbsp;recycle&nbsp;us</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515826"><a href="/net/http/transport.go.html#3515427">wr</a></span><span class="op" id="3515828">.</span><span class="ident" id="3515829">ch</span>&nbsp;<span class="op" id="3515832">&lt;-</span>&nbsp;<span class="ident" id="3515835"><a href="/net/http/transport.go.html#3515569">err</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3515847">//&nbsp;to&nbsp;the&nbsp;roundTrip&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515878">case</span>&nbsp;<span class="op" id="3515883">&lt;-</span><span class="ident" id="3515885"><a href="/net/http/transport.go.html#3515371">pc</a></span><span class="op" id="3515887">.</span><span class="ident" id="3515888">closech</span><span class="op" id="3515895">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515900">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515912">}</span><br>
<span class="lineno">965</span><span class="op" id="3515914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3515917">//&nbsp;wroteRequest&nbsp;is&nbsp;a&nbsp;check&nbsp;before&nbsp;recycling&nbsp;a&nbsp;connection&nbsp;that&nbsp;the&nbsp;previous&nbsp;write</span><br>
<span class="lineno"></span><span class="comment" id="3515998">//&nbsp;(from&nbsp;writeLoop&nbsp;above)&nbsp;happened&nbsp;and&nbsp;was&nbsp;successful.</span><br>
<span class="lineno"></span><span class="keyword" id="3516053">func</span>&nbsp;<span class="op" id="3516058">(</span><span class="ident" id="3516059">pc</span>&nbsp;<span class="op" id="3516062">*</span><span class="ident" id="3516063"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><span class="op" id="3516074">)</span>&nbsp;<span class="ident" id="3516076">wroteRequest</span><span class="op" id="3516088">(</span><span class="op" id="3516089">)</span>&nbsp;<span class="builtintype" id="3516091">bool</span>&nbsp;<span class="op" id="3516096">{</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3516099">select</span>&nbsp;<span class="op" id="3516106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3516109">case</span>&nbsp;<span class="ident" id="3516114">err</span>&nbsp;<span class="op" id="3516118">:=</span>&nbsp;<span class="op" id="3516121">&lt;-</span><span class="ident" id="3516123"><a href="/net/http/transport.go.html#3516059">pc</a></span><span class="op" id="3516125">.</span><span class="ident" id="3516126">writeErrCh</span><span class="op" id="3516136">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3516140">//&nbsp;Common&nbsp;case:&nbsp;the&nbsp;write&nbsp;happened&nbsp;well&nbsp;before&nbsp;the&nbsp;response,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3516206">//&nbsp;avoid&nbsp;creating&nbsp;a&nbsp;timer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3516235">return</span>&nbsp;<span class="ident" id="3516242"><a href="/net/http/transport.go.html#3516114">err</a></span>&nbsp;<span class="op" id="3516246">==</span>&nbsp;<span class="ident" id="3516249">nil</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3516254">default</span><span class="op" id="3516261">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3516265">//&nbsp;Rare&nbsp;case:&nbsp;the&nbsp;request&nbsp;was&nbsp;written&nbsp;in&nbsp;writeLoop&nbsp;above&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3516328">//&nbsp;before&nbsp;it&nbsp;could&nbsp;send&nbsp;to&nbsp;pc.writeErrCh,&nbsp;the&nbsp;reader&nbsp;read&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3516391">//&nbsp;all,&nbsp;processed&nbsp;it,&nbsp;and&nbsp;called&nbsp;us&nbsp;here.&nbsp;In&nbsp;this&nbsp;case,&nbsp;give&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3516458">//&nbsp;write&nbsp;goroutine&nbsp;a&nbsp;bit&nbsp;of&nbsp;time&nbsp;to&nbsp;finish&nbsp;its&nbsp;send.</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3516513">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3516518">//&nbsp;Less&nbsp;rare&nbsp;case:&nbsp;We&nbsp;also&nbsp;get&nbsp;here&nbsp;in&nbsp;the&nbsp;legitimate&nbsp;case&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3516582">//&nbsp;Issue&nbsp;7569,&nbsp;where&nbsp;the&nbsp;writer&nbsp;is&nbsp;still&nbsp;writing&nbsp;(or&nbsp;stalled),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3516647">//&nbsp;but&nbsp;the&nbsp;server&nbsp;has&nbsp;already&nbsp;replied.&nbsp;In&nbsp;this&nbsp;case,&nbsp;we&nbsp;don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3516711">//&nbsp;want&nbsp;to&nbsp;wait&nbsp;too&nbsp;long,&nbsp;and&nbsp;we&nbsp;want&nbsp;to&nbsp;return&nbsp;false&nbsp;so&nbsp;this</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3516775">//&nbsp;connection&nbsp;isn&#39;t&nbsp;re-used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3516806">select</span>&nbsp;<span class="op" id="3516813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3516817">case</span>&nbsp;<span class="ident" id="3516822">err</span>&nbsp;<span class="op" id="3516826">:=</span>&nbsp;<span class="op" id="3516829">&lt;-</span><span class="ident" id="3516831"><a href="/net/http/transport.go.html#3516059">pc</a></span><span class="op" id="3516833">.</span><span class="ident" id="3516834">writeErrCh</span><span class="op" id="3516844">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3516849">return</span>&nbsp;<span class="ident" id="3516856"><a href="/net/http/transport.go.html#3516822">err</a></span>&nbsp;<span class="op" id="3516860">==</span>&nbsp;<span class="ident" id="3516863">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3516869">case</span>&nbsp;<span class="op" id="3516874">&lt;-</span><span class="ident" id="3516876"><a href="/net/http/transport.go.html#3490462">time</a></span><span class="op" id="3516880">.</span><span class="ident" id="3516881">After</span><span class="op" id="3516886">(</span><span class="num" id="3516887">50</span>&nbsp;<span class="op" id="3516890">*</span>&nbsp;<span class="ident" id="3516892"><a href="/net/http/transport.go.html#3490462">time</a></span><span class="op" id="3516896">.</span><span class="ident" id="3516897">Millisecond</span><span class="op" id="3516908">)</span><span class="op" id="3516909">:</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3516914">return</span>&nbsp;<span class="builtintype" id="3516921">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3516929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3516932">}</span><br>
<span class="lineno"></span><span class="op" id="3516934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">995</span><span class="keyword" id="3516937">type</span>&nbsp;<span class="ident" id="3516942">responseAndError</span>&nbsp;<span class="keyword" id="3516959">struct</span>&nbsp;<span class="op" id="3516966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3516969">res</span>&nbsp;<span class="op" id="3516973">*</span><span class="ident" id="3516974"><a href="/net/http/response.go.html#3392041">Response</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3516984">err</span>&nbsp;<span class="builtintype" id="3516988">error</span><br>
<span class="lineno"></span><span class="op" id="3516994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1000</span><span class="keyword" id="3516997">type</span>&nbsp;<span class="ident" id="3517002">requestAndChan</span>&nbsp;<span class="keyword" id="3517017">struct</span>&nbsp;<span class="op" id="3517024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3517027">req</span>&nbsp;<span class="op" id="3517031">*</span><span class="ident" id="3517032"><a href="/net/http/request.go.html#3366486">Request</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3517041">ch</span>&nbsp;&nbsp;<span class="keyword" id="3517045">chan</span>&nbsp;<span class="ident" id="3517050"><a href="/net/http/transport.go.html#3516942">responseAndError</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3517069">//&nbsp;did&nbsp;the&nbsp;Transport&nbsp;(as&nbsp;opposed&nbsp;to&nbsp;the&nbsp;client&nbsp;code)&nbsp;add&nbsp;an</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3517130">//&nbsp;Accept-Encoding&nbsp;gzip&nbsp;header?&nbsp;only&nbsp;if&nbsp;it&nbsp;we&nbsp;set&nbsp;it&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3517187">//&nbsp;we&nbsp;transparently&nbsp;decode&nbsp;the&nbsp;gzip.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3517225">addedGzip</span>&nbsp;<span class="builtintype" id="3517235">bool</span><br>
<span class="lineno"></span><span class="op" id="3517240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1010</span><span class="comment" id="3517243">//&nbsp;A&nbsp;writeRequest&nbsp;is&nbsp;sent&nbsp;by&nbsp;the&nbsp;readLoop&#39;s&nbsp;goroutine&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3517304">//&nbsp;writeLoop&#39;s&nbsp;goroutine&nbsp;to&nbsp;write&nbsp;a&nbsp;request&nbsp;while&nbsp;the&nbsp;read&nbsp;loop</span><br>
<span class="lineno"></span><span class="comment" id="3517368">//&nbsp;concurrently&nbsp;waits&nbsp;on&nbsp;both&nbsp;the&nbsp;write&nbsp;response&nbsp;and&nbsp;the&nbsp;server&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3517434">//&nbsp;reply.</span><br>
<span class="lineno"></span><span class="keyword" id="3517444">type</span>&nbsp;<span class="ident" id="3517449">writeRequest</span>&nbsp;<span class="keyword" id="3517462">struct</span>&nbsp;<span class="op" id="3517469">{</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3517472">req</span>&nbsp;<span class="op" id="3517476">*</span><span class="ident" id="3517477"><a href="/net/http/transport.go.html#3495910">transportRequest</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3517495">ch</span>&nbsp;&nbsp;<span class="keyword" id="3517499">chan</span><span class="op" id="3517503">&lt;-</span>&nbsp;<span class="builtintype" id="3517506">error</span><br>
<span class="lineno"></span><span class="op" id="3517512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3517515">type</span>&nbsp;<span class="ident" id="3517520">httpError</span>&nbsp;<span class="keyword" id="3517530">struct</span>&nbsp;<span class="op" id="3517537">{</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3517540">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3517548">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3517556">timeout</span>&nbsp;<span class="builtintype" id="3517564">bool</span><br>
<span class="lineno"></span><span class="op" id="3517569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3517572">func</span>&nbsp;<span class="op" id="3517577">(</span><span class="ident" id="3517578">e</span>&nbsp;<span class="op" id="3517580">*</span><span class="ident" id="3517581"><a href="/net/http/transport.go.html#3517520">httpError</a></span><span class="op" id="3517590">)</span>&nbsp;<span class="ident" id="3517592">Error</span><span class="op" id="3517597">(</span><span class="op" id="3517598">)</span>&nbsp;<span class="builtintype" id="3517600">string</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3517609">{</span>&nbsp;<span class="keyword" id="3517611">return</span>&nbsp;<span class="ident" id="3517618"><a href="/net/http/transport.go.html#3517578">e</a></span><span class="op" id="3517619">.</span><span class="ident" id="3517620">err</span>&nbsp;<span class="op" id="3517624">}</span><br>
<span class="lineno">1025</span><span class="keyword" id="3517626">func</span>&nbsp;<span class="op" id="3517631">(</span><span class="ident" id="3517632">e</span>&nbsp;<span class="op" id="3517634">*</span><span class="ident" id="3517635"><a href="/net/http/transport.go.html#3517520">httpError</a></span><span class="op" id="3517644">)</span>&nbsp;<span class="ident" id="3517646">Timeout</span><span class="op" id="3517653">(</span><span class="op" id="3517654">)</span>&nbsp;<span class="builtintype" id="3517656">bool</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3517663">{</span>&nbsp;<span class="keyword" id="3517665">return</span>&nbsp;<span class="ident" id="3517672"><a href="/net/http/transport.go.html#3517632">e</a></span><span class="op" id="3517673">.</span><span class="ident" id="3517674">timeout</span>&nbsp;<span class="op" id="3517682">}</span><br>
<span class="lineno"></span><span class="keyword" id="3517684">func</span>&nbsp;<span class="op" id="3517689">(</span><span class="ident" id="3517690">e</span>&nbsp;<span class="op" id="3517692">*</span><span class="ident" id="3517693"><a href="/net/http/transport.go.html#3517520">httpError</a></span><span class="op" id="3517702">)</span>&nbsp;<span class="ident" id="3517704">Temporary</span><span class="op" id="3517713">(</span><span class="op" id="3517714">)</span>&nbsp;<span class="builtintype" id="3517716">bool</span>&nbsp;<span class="op" id="3517721">{</span>&nbsp;<span class="keyword" id="3517723">return</span>&nbsp;<span class="builtintype" id="3517730">true</span>&nbsp;<span class="op" id="3517735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3517738">var</span>&nbsp;<span class="ident" id="3517742">errTimeout</span>&nbsp;<span class="builtintype" id="3517753">error</span>&nbsp;<span class="op" id="3517759">=</span>&nbsp;<span class="op" id="3517761">&amp;</span><span class="ident" id="3517762"><a href="/net/http/transport.go.html#3517520">httpError</a></span><span class="op" id="3517771">{</span><span class="ident" id="3517772">err</span><span class="op" id="3517775">:</span>&nbsp;<span class="string" id="3517777">&#34;net/http:&nbsp;timeout&nbsp;awaiting&nbsp;response&nbsp;headers&#34;</span><span class="op" id="3517822">,</span>&nbsp;<span class="ident" id="3517824">timeout</span><span class="op" id="3517831">:</span>&nbsp;<span class="builtintype" id="3517833">true</span><span class="op" id="3517837">}</span><br>
<span class="lineno"></span><span class="keyword" id="3517839">var</span>&nbsp;<span class="ident" id="3517843">errClosed</span>&nbsp;<span class="builtintype" id="3517853">error</span>&nbsp;<span class="op" id="3517859">=</span>&nbsp;<span class="op" id="3517861">&amp;</span><span class="ident" id="3517862"><a href="/net/http/transport.go.html#3517520">httpError</a></span><span class="op" id="3517871">{</span><span class="ident" id="3517872">err</span><span class="op" id="3517875">:</span>&nbsp;<span class="string" id="3517877">&#34;net/http:&nbsp;transport&nbsp;closed&nbsp;before&nbsp;response&nbsp;was&nbsp;received&#34;</span><span class="op" id="3517934">}</span><br>
<span class="lineno">1030</span><br>
<span class="lineno"></span><span class="keyword" id="3517937">func</span>&nbsp;<span class="op" id="3517942">(</span><span class="ident" id="3517943">pc</span>&nbsp;<span class="op" id="3517946">*</span><span class="ident" id="3517947"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><span class="op" id="3517958">)</span>&nbsp;<span class="ident" id="3517960">roundTrip</span><span class="op" id="3517969">(</span><span class="ident" id="3517970">req</span>&nbsp;<span class="op" id="3517974">*</span><span class="ident" id="3517975"><a href="/net/http/transport.go.html#3495910">transportRequest</a></span><span class="op" id="3517991">)</span>&nbsp;<span class="op" id="3517993">(</span><span class="ident" id="3517994">resp</span>&nbsp;<span class="op" id="3517999">*</span><span class="ident" id="3518000"><a href="/net/http/response.go.html#3392041">Response</a></span><span class="op" id="3518008">,</span>&nbsp;<span class="ident" id="3518010">err</span>&nbsp;<span class="builtintype" id="3518014">error</span><span class="op" id="3518019">)</span>&nbsp;<span class="op" id="3518021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3518024"><a href="/net/http/transport.go.html#3517943">pc</a></span><span class="op" id="3518026">.</span><span class="ident" id="3518027">t</span><span class="op" id="3518028">.</span><span class="ident" id="3518029">setReqCanceler</span><span class="op" id="3518043">(</span><span class="ident" id="3518044"><a href="/net/http/transport.go.html#3517970">req</a></span><span class="op" id="3518047">.</span><span class="ident" id="3518048">Request</span><span class="op" id="3518055">,</span>&nbsp;<span class="ident" id="3518057"><a href="/net/http/transport.go.html#3517943">pc</a></span><span class="op" id="3518059">.</span><span class="ident" id="3518060">cancelRequest</span><span class="op" id="3518073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3518076"><a href="/net/http/transport.go.html#3517943">pc</a></span><span class="op" id="3518078">.</span><span class="ident" id="3518079">lk</span><span class="op" id="3518081">.</span><span class="ident" id="3518082">Lock</span><span class="op" id="3518086">(</span><span class="op" id="3518087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3518090"><a href="/net/http/transport.go.html#3517943">pc</a></span><span class="op" id="3518092">.</span><span class="ident" id="3518093">numExpectedResponses</span><span class="op" id="3518113">++</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3518117">headerFn</span>&nbsp;<span class="op" id="3518126">:=</span>&nbsp;<span class="ident" id="3518129"><a href="/net/http/transport.go.html#3517943">pc</a></span><span class="op" id="3518131">.</span><span class="ident" id="3518132">mutateHeaderFunc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3518150"><a href="/net/http/transport.go.html#3517943">pc</a></span><span class="op" id="3518152">.</span><span class="ident" id="3518153">lk</span><span class="op" id="3518155">.</span><span class="ident" id="3518156">Unlock</span><span class="op" id="3518162">(</span><span class="op" id="3518163">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3518167">if</span>&nbsp;<span class="ident" id="3518170"><a href="/net/http/transport.go.html#3518117">headerFn</a></span>&nbsp;<span class="op" id="3518179">!=</span>&nbsp;<span class="ident" id="3518182">nil</span>&nbsp;<span class="op" id="3518186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3518190"><a href="/net/http/transport.go.html#3518117">headerFn</a></span><span class="op" id="3518198">(</span><span class="ident" id="3518199"><a href="/net/http/transport.go.html#3517970">req</a></span><span class="op" id="3518202">.</span><span class="ident" id="3518203">extraHeaders</span><span class="op" id="3518215">(</span><span class="op" id="3518216">)</span><span class="op" id="3518217">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3518220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518224">//&nbsp;Ask&nbsp;for&nbsp;a&nbsp;compressed&nbsp;version&nbsp;if&nbsp;the&nbsp;caller&nbsp;didn&#39;t&nbsp;set&nbsp;their</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518288">//&nbsp;own&nbsp;value&nbsp;for&nbsp;Accept-Encoding.&nbsp;We&nbsp;only&nbsp;attempt&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518342">//&nbsp;uncompress&nbsp;the&nbsp;gzip&nbsp;stream&nbsp;if&nbsp;we&nbsp;were&nbsp;the&nbsp;layer&nbsp;that</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518399">//&nbsp;requested&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3518417">requestedGzip</span>&nbsp;<span class="op" id="3518431">:=</span>&nbsp;<span class="builtintype" id="3518434">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3518441">if</span>&nbsp;<span class="op" id="3518444">!</span><span class="ident" id="3518445"><a href="/net/http/transport.go.html#3517943">pc</a></span><span class="op" id="3518447">.</span><span class="ident" id="3518448">t</span><span class="op" id="3518449">.</span><span class="ident" id="3518450">DisableCompression</span>&nbsp;<span class="op" id="3518469">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3518474"><a href="/net/http/transport.go.html#3517970">req</a></span><span class="op" id="3518477">.</span><span class="ident" id="3518478">Header</span><span class="op" id="3518484">.</span><span class="ident" id="3518485">Get</span><span class="op" id="3518488">(</span><span class="string" id="3518489">&#34;Accept-Encoding&#34;</span><span class="op" id="3518506">)</span>&nbsp;<span class="op" id="3518508">==</span>&nbsp;<span class="string" id="3518511">&#34;&#34;</span>&nbsp;<span class="op" id="3518514">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3518519"><a href="/net/http/transport.go.html#3517970">req</a></span><span class="op" id="3518522">.</span><span class="ident" id="3518523">Header</span><span class="op" id="3518529">.</span><span class="ident" id="3518530">Get</span><span class="op" id="3518533">(</span><span class="string" id="3518534">&#34;Range&#34;</span><span class="op" id="3518541">)</span>&nbsp;<span class="op" id="3518543">==</span>&nbsp;<span class="string" id="3518546">&#34;&#34;</span>&nbsp;<span class="op" id="3518549">&amp;&amp;</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3518554"><a href="/net/http/transport.go.html#3517970">req</a></span><span class="op" id="3518557">.</span><span class="ident" id="3518558">Method</span>&nbsp;<span class="op" id="3518565">!=</span>&nbsp;<span class="string" id="3518568">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="3518575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518579">//&nbsp;Request&nbsp;gzip&nbsp;only,&nbsp;not&nbsp;deflate.&nbsp;Deflate&nbsp;is&nbsp;ambiguous&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518641">//&nbsp;not&nbsp;as&nbsp;universally&nbsp;supported&nbsp;anyway.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518683">//&nbsp;See:&nbsp;http://www.gzip.org/zlib/zlib_faq.html#faq38</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518738">//</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518743">//&nbsp;Note&nbsp;that&nbsp;we&nbsp;don&#39;t&nbsp;request&nbsp;this&nbsp;for&nbsp;HEAD&nbsp;requests,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518799">//&nbsp;due&nbsp;to&nbsp;a&nbsp;bug&nbsp;in&nbsp;nginx:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518827">//&nbsp;&nbsp;&nbsp;http://trac.nginx.org/nginx/ticket/358</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518873">//&nbsp;&nbsp;&nbsp;http://golang.org/issue/5522</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518909">//</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518914">//&nbsp;We&nbsp;don&#39;t&nbsp;request&nbsp;gzip&nbsp;if&nbsp;the&nbsp;request&nbsp;is&nbsp;for&nbsp;a&nbsp;range,&nbsp;since</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518978">//&nbsp;auto-decoding&nbsp;a&nbsp;portion&nbsp;of&nbsp;a&nbsp;gzipped&nbsp;document&nbsp;will&nbsp;just&nbsp;fail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519044">//&nbsp;anyway.&nbsp;See&nbsp;http://golang.org/issue/8923</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3519090"><a href="/net/http/transport.go.html#3518417">requestedGzip</a></span>&nbsp;<span class="op" id="3519104">=</span>&nbsp;<span class="builtintype" id="3519106">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3519113"><a href="/net/http/transport.go.html#3517970">req</a></span><span class="op" id="3519116">.</span><span class="ident" id="3519117">extraHeaders</span><span class="op" id="3519129">(</span><span class="op" id="3519130">)</span><span class="op" id="3519131">.</span><span class="ident" id="3519132">Set</span><span class="op" id="3519135">(</span><span class="string" id="3519136">&#34;Accept-Encoding&#34;</span><span class="op" id="3519153">,</span>&nbsp;<span class="string" id="3519155">&#34;gzip&#34;</span><span class="op" id="3519161">)</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3519164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519168">//&nbsp;Write&nbsp;the&nbsp;request&nbsp;concurrently&nbsp;with&nbsp;waiting&nbsp;for&nbsp;a&nbsp;response,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519232">//&nbsp;in&nbsp;case&nbsp;the&nbsp;server&nbsp;decides&nbsp;to&nbsp;reply&nbsp;before&nbsp;reading&nbsp;our&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519296">//&nbsp;request&nbsp;body.</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3519314">writeErrCh</span>&nbsp;<span class="op" id="3519325">:=</span>&nbsp;<span class="builtinfunc" id="3519328">make</span><span class="op" id="3519332">(</span><span class="keyword" id="3519333">chan</span>&nbsp;<span class="builtintype" id="3519338">error</span><span class="op" id="3519343">,</span>&nbsp;<span class="num" id="3519345">1</span><span class="op" id="3519346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3519349"><a href="/net/http/transport.go.html#3517943">pc</a></span><span class="op" id="3519351">.</span><span class="ident" id="3519352">writech</span>&nbsp;<span class="op" id="3519360">&lt;-</span>&nbsp;<span class="ident" id="3519363"><a href="/net/http/transport.go.html#3517449">writeRequest</a></span><span class="op" id="3519375">{</span><span class="ident" id="3519376"><a href="/net/http/transport.go.html#3517970">req</a></span><span class="op" id="3519379">,</span>&nbsp;<span class="ident" id="3519381"><a href="/net/http/transport.go.html#3519314">writeErrCh</a></span><span class="op" id="3519391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3519395">resc</span>&nbsp;<span class="op" id="3519400">:=</span>&nbsp;<span class="builtinfunc" id="3519403">make</span><span class="op" id="3519407">(</span><span class="keyword" id="3519408">chan</span>&nbsp;<span class="ident" id="3519413"><a href="/net/http/transport.go.html#3516942">responseAndError</a></span><span class="op" id="3519429">,</span>&nbsp;<span class="num" id="3519431">1</span><span class="op" id="3519432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3519435"><a href="/net/http/transport.go.html#3517943">pc</a></span><span class="op" id="3519437">.</span><span class="ident" id="3519438">reqch</span>&nbsp;<span class="op" id="3519444">&lt;-</span>&nbsp;<span class="ident" id="3519447"><a href="/net/http/transport.go.html#3517002">requestAndChan</a></span><span class="op" id="3519461">{</span><span class="ident" id="3519462"><a href="/net/http/transport.go.html#3517970">req</a></span><span class="op" id="3519465">.</span><span class="ident" id="3519466">Request</span><span class="op" id="3519473">,</span>&nbsp;<span class="ident" id="3519475"><a href="/net/http/transport.go.html#3519395">resc</a></span><span class="op" id="3519479">,</span>&nbsp;<span class="ident" id="3519481"><a href="/net/http/transport.go.html#3518417">requestedGzip</a></span><span class="op" id="3519494">}</span><br>
<span class="lineno">1075</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519498">var</span>&nbsp;<span class="ident" id="3519502">re</span>&nbsp;<span class="ident" id="3519505"><a href="/net/http/transport.go.html#3516942">responseAndError</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519523">var</span>&nbsp;<span class="ident" id="3519527">pconnDeadCh</span>&nbsp;<span class="op" id="3519539">=</span>&nbsp;<span class="ident" id="3519541"><a href="/net/http/transport.go.html#3517943">pc</a></span><span class="op" id="3519543">.</span><span class="ident" id="3519544">closech</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519553">var</span>&nbsp;<span class="ident" id="3519557">failTicker</span>&nbsp;<span class="op" id="3519568">&lt;-</span><span class="keyword" id="3519570">chan</span>&nbsp;<span class="ident" id="3519575"><a href="/net/http/transport.go.html#3490462">time</a></span><span class="op" id="3519579">.</span><span class="ident" id="3519580">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519586">var</span>&nbsp;<span class="ident" id="3519590">respHeaderTimer</span>&nbsp;<span class="op" id="3519606">&lt;-</span><span class="keyword" id="3519608">chan</span>&nbsp;<span class="ident" id="3519613"><a href="/net/http/transport.go.html#3490462">time</a></span><span class="op" id="3519617">.</span><span class="ident" id="3519618">Time</span><br>
<span class="lineno">1080</span><span class="ident" id="3519623">WaitResponse</span><span class="op" id="3519635">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519638">for</span>&nbsp;<span class="op" id="3519642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519646">select</span>&nbsp;<span class="op" id="3519653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519657">case</span>&nbsp;<span class="ident" id="3519662">err</span>&nbsp;<span class="op" id="3519666">:=</span>&nbsp;<span class="op" id="3519669">&lt;-</span><span class="ident" id="3519671"><a href="/net/http/transport.go.html#3519314">writeErrCh</a></span><span class="op" id="3519681">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519686">if</span>&nbsp;<span class="ident" id="3519689"><a href="/net/http/transport.go.html#3519662">err</a></span>&nbsp;<span class="op" id="3519693">!=</span>&nbsp;<span class="ident" id="3519696">nil</span>&nbsp;<span class="op" id="3519700">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3519706"><a href="/net/http/transport.go.html#3519502">re</a></span>&nbsp;<span class="op" id="3519709">=</span>&nbsp;<span class="ident" id="3519711"><a href="/net/http/transport.go.html#3516942">responseAndError</a></span><span class="op" id="3519727">{</span><span class="ident" id="3519728">nil</span><span class="op" id="3519731">,</span>&nbsp;<span class="ident" id="3519733"><a href="/net/http/transport.go.html#3519662">err</a></span><span class="op" id="3519736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3519742"><a href="/net/http/transport.go.html#3517943">pc</a></span><span class="op" id="3519744">.</span><span class="builtinfunc" id="3519745">close</span><span class="op" id="3519750">(</span><span class="op" id="3519751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519757">break</span>&nbsp;<span class="ident" id="3519763">WaitResponse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3519779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519784">if</span>&nbsp;<span class="ident" id="3519787">d</span>&nbsp;<span class="op" id="3519789">:=</span>&nbsp;<span class="ident" id="3519792"><a href="/net/http/transport.go.html#3517943">pc</a></span><span class="op" id="3519794">.</span><span class="ident" id="3519795">t</span><span class="op" id="3519796">.</span><span class="ident" id="3519797">ResponseHeaderTimeout</span><span class="op" id="3519818">;</span>&nbsp;<span class="ident" id="3519820"><a href="/net/http/transport.go.html#3519787">d</a></span>&nbsp;<span class="op" id="3519822">&gt;</span>&nbsp;<span class="num" id="3519824">0</span>&nbsp;<span class="op" id="3519826">{</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3519832"><a href="/net/http/transport.go.html#3519590">respHeaderTimer</a></span>&nbsp;<span class="op" id="3519848">=</span>&nbsp;<span class="ident" id="3519850"><a href="/net/http/transport.go.html#3490462">time</a></span><span class="op" id="3519854">.</span><span class="ident" id="3519855">After</span><span class="op" id="3519860">(</span><span class="ident" id="3519861"><a href="/net/http/transport.go.html#3519787">d</a></span><span class="op" id="3519862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3519867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519871">case</span>&nbsp;<span class="op" id="3519876">&lt;-</span><span class="ident" id="3519878"><a href="/net/http/transport.go.html#3519527">pconnDeadCh</a></span><span class="op" id="3519889">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519894">//&nbsp;The&nbsp;persist&nbsp;connection&nbsp;is&nbsp;dead.&nbsp;This&nbsp;shouldn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519947">//&nbsp;usually&nbsp;happen&nbsp;(only&nbsp;with&nbsp;Connection:&nbsp;close&nbsp;responses</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3520007">//&nbsp;with&nbsp;no&nbsp;response&nbsp;bodies),&nbsp;but&nbsp;if&nbsp;it&nbsp;does&nbsp;happen&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3520064">//&nbsp;means&nbsp;either&nbsp;a)&nbsp;the&nbsp;remote&nbsp;server&nbsp;hung&nbsp;up&nbsp;on&nbsp;us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3520118">//&nbsp;prematurely,&nbsp;or&nbsp;b)&nbsp;the&nbsp;readLoop&nbsp;sent&nbsp;us&nbsp;a&nbsp;response&nbsp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3520177">//&nbsp;closed&nbsp;its&nbsp;closech&nbsp;at&nbsp;roughly&nbsp;the&nbsp;same&nbsp;time,&nbsp;and&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3520235">//&nbsp;selected&nbsp;this&nbsp;case&nbsp;first,&nbsp;in&nbsp;which&nbsp;case&nbsp;a&nbsp;response</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3520292">//&nbsp;might&nbsp;still&nbsp;be&nbsp;coming&nbsp;soon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3520326">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3520332">//&nbsp;We&nbsp;can&#39;t&nbsp;avoid&nbsp;the&nbsp;select&nbsp;race&nbsp;in&nbsp;b)&nbsp;by&nbsp;using&nbsp;a&nbsp;unbuffered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3520397">//&nbsp;resc&nbsp;channel&nbsp;instead,&nbsp;because&nbsp;then&nbsp;goroutines&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3520453">//&nbsp;leak&nbsp;if&nbsp;we&nbsp;exit&nbsp;due&nbsp;to&nbsp;other&nbsp;errors.</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3520496"><a href="/net/http/transport.go.html#3519527">pconnDeadCh</a></span>&nbsp;<span class="op" id="3520508">=</span>&nbsp;<span class="ident" id="3520510">nil</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3520544">//&nbsp;avoid&nbsp;spinning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3520565"><a href="/net/http/transport.go.html#3519557">failTicker</a></span>&nbsp;<span class="op" id="3520576">=</span>&nbsp;<span class="ident" id="3520578"><a href="/net/http/transport.go.html#3490462">time</a></span><span class="op" id="3520582">.</span><span class="ident" id="3520583">After</span><span class="op" id="3520588">(</span><span class="num" id="3520589">100</span>&nbsp;<span class="op" id="3520593">*</span>&nbsp;<span class="ident" id="3520595"><a href="/net/http/transport.go.html#3490462">time</a></span><span class="op" id="3520599">.</span><span class="ident" id="3520600">Millisecond</span><span class="op" id="3520611">)</span>&nbsp;<span class="comment" id="3520613">//&nbsp;arbitrary&nbsp;time&nbsp;to&nbsp;wait&nbsp;for&nbsp;resc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3520650">case</span>&nbsp;<span class="op" id="3520655">&lt;-</span><span class="ident" id="3520657"><a href="/net/http/transport.go.html#3519557">failTicker</a></span><span class="op" id="3520667">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3520672"><a href="/net/http/transport.go.html#3519502">re</a></span>&nbsp;<span class="op" id="3520675">=</span>&nbsp;<span class="ident" id="3520677"><a href="/net/http/transport.go.html#3516942">responseAndError</a></span><span class="op" id="3520693">{</span><span class="ident" id="3520694">err</span><span class="op" id="3520697">:</span>&nbsp;<span class="ident" id="3520699"><a href="/net/http/transport.go.html#3517843">errClosed</a></span><span class="op" id="3520708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3520713">break</span>&nbsp;<span class="ident" id="3520719">WaitResponse</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3520734">case</span>&nbsp;<span class="op" id="3520739">&lt;-</span><span class="ident" id="3520741"><a href="/net/http/transport.go.html#3519590">respHeaderTimer</a></span><span class="op" id="3520756">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3520761"><a href="/net/http/transport.go.html#3517943">pc</a></span><span class="op" id="3520763">.</span><span class="builtinfunc" id="3520764">close</span><span class="op" id="3520769">(</span><span class="op" id="3520770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3520775"><a href="/net/http/transport.go.html#3519502">re</a></span>&nbsp;<span class="op" id="3520778">=</span>&nbsp;<span class="ident" id="3520780"><a href="/net/http/transport.go.html#3516942">responseAndError</a></span><span class="op" id="3520796">{</span><span class="ident" id="3520797">err</span><span class="op" id="3520800">:</span>&nbsp;<span class="ident" id="3520802"><a href="/net/http/transport.go.html#3517742">errTimeout</a></span><span class="op" id="3520812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3520817">break</span>&nbsp;<span class="ident" id="3520823">WaitResponse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3520838">case</span>&nbsp;<span class="ident" id="3520843"><a href="/net/http/transport.go.html#3519502">re</a></span>&nbsp;<span class="op" id="3520846">=</span>&nbsp;<span class="op" id="3520848">&lt;-</span><span class="ident" id="3520850"><a href="/net/http/transport.go.html#3519395">resc</a></span><span class="op" id="3520854">:</span><br>
<span class="lineno">1115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3520859">break</span>&nbsp;<span class="ident" id="3520865">WaitResponse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3520880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3520883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3520887"><a href="/net/http/transport.go.html#3517943">pc</a></span><span class="op" id="3520889">.</span><span class="ident" id="3520890">lk</span><span class="op" id="3520892">.</span><span class="ident" id="3520893">Lock</span><span class="op" id="3520897">(</span><span class="op" id="3520898">)</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3520901"><a href="/net/http/transport.go.html#3517943">pc</a></span><span class="op" id="3520903">.</span><span class="ident" id="3520904">numExpectedResponses</span><span class="op" id="3520924">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3520928"><a href="/net/http/transport.go.html#3517943">pc</a></span><span class="op" id="3520930">.</span><span class="ident" id="3520931">lk</span><span class="op" id="3520933">.</span><span class="ident" id="3520934">Unlock</span><span class="op" id="3520940">(</span><span class="op" id="3520941">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3520945">if</span>&nbsp;<span class="ident" id="3520948"><a href="/net/http/transport.go.html#3519502">re</a></span><span class="op" id="3520950">.</span><span class="ident" id="3520951">err</span>&nbsp;<span class="op" id="3520955">!=</span>&nbsp;<span class="ident" id="3520958">nil</span>&nbsp;<span class="op" id="3520962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3520966"><a href="/net/http/transport.go.html#3517943">pc</a></span><span class="op" id="3520968">.</span><span class="ident" id="3520969">t</span><span class="op" id="3520970">.</span><span class="ident" id="3520971">setReqCanceler</span><span class="op" id="3520985">(</span><span class="ident" id="3520986"><a href="/net/http/transport.go.html#3517970">req</a></span><span class="op" id="3520989">.</span><span class="ident" id="3520990">Request</span><span class="op" id="3520997">,</span>&nbsp;<span class="ident" id="3520999">nil</span><span class="op" id="3521002">)</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3521005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521008">return</span>&nbsp;<span class="ident" id="3521015"><a href="/net/http/transport.go.html#3519502">re</a></span><span class="op" id="3521017">.</span><span class="ident" id="3521018">res</span><span class="op" id="3521021">,</span>&nbsp;<span class="ident" id="3521023"><a href="/net/http/transport.go.html#3519502">re</a></span><span class="op" id="3521025">.</span><span class="ident" id="3521026">err</span><br>
<span class="lineno"></span><span class="op" id="3521030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3521033">//&nbsp;markBroken&nbsp;marks&nbsp;a&nbsp;connection&nbsp;as&nbsp;broken&nbsp;(so&nbsp;it&#39;s&nbsp;not&nbsp;reused).</span><br>
<span class="lineno">1130</span><span class="comment" id="3521098">//&nbsp;It&nbsp;differs&nbsp;from&nbsp;close&nbsp;in&nbsp;that&nbsp;it&nbsp;doesn&#39;t&nbsp;close&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="3521163">//&nbsp;connection&nbsp;for&nbsp;use&nbsp;when&nbsp;it&#39;s&nbsp;still&nbsp;being&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="3521213">func</span>&nbsp;<span class="op" id="3521218">(</span><span class="ident" id="3521219">pc</span>&nbsp;<span class="op" id="3521222">*</span><span class="ident" id="3521223"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><span class="op" id="3521234">)</span>&nbsp;<span class="ident" id="3521236">markBroken</span><span class="op" id="3521246">(</span><span class="op" id="3521247">)</span>&nbsp;<span class="op" id="3521249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521252"><a href="/net/http/transport.go.html#3521219">pc</a></span><span class="op" id="3521254">.</span><span class="ident" id="3521255">lk</span><span class="op" id="3521257">.</span><span class="ident" id="3521258">Lock</span><span class="op" id="3521262">(</span><span class="op" id="3521263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521266">defer</span>&nbsp;<span class="ident" id="3521272"><a href="/net/http/transport.go.html#3521219">pc</a></span><span class="op" id="3521274">.</span><span class="ident" id="3521275">lk</span><span class="op" id="3521277">.</span><span class="ident" id="3521278">Unlock</span><span class="op" id="3521284">(</span><span class="op" id="3521285">)</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521288"><a href="/net/http/transport.go.html#3521219">pc</a></span><span class="op" id="3521290">.</span><span class="ident" id="3521291">broken</span>&nbsp;<span class="op" id="3521298">=</span>&nbsp;<span class="builtintype" id="3521300">true</span><br>
<span class="lineno"></span><span class="op" id="3521305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3521308">func</span>&nbsp;<span class="op" id="3521313">(</span><span class="ident" id="3521314">pc</span>&nbsp;<span class="op" id="3521317">*</span><span class="ident" id="3521318"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><span class="op" id="3521329">)</span>&nbsp;<span class="builtinfunc" id="3521331">close</span><span class="op" id="3521336">(</span><span class="op" id="3521337">)</span>&nbsp;<span class="op" id="3521339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521342"><a href="/net/http/transport.go.html#3521314">pc</a></span><span class="op" id="3521344">.</span><span class="ident" id="3521345">lk</span><span class="op" id="3521347">.</span><span class="ident" id="3521348">Lock</span><span class="op" id="3521352">(</span><span class="op" id="3521353">)</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521356">defer</span>&nbsp;<span class="ident" id="3521362"><a href="/net/http/transport.go.html#3521314">pc</a></span><span class="op" id="3521364">.</span><span class="ident" id="3521365">lk</span><span class="op" id="3521367">.</span><span class="ident" id="3521368">Unlock</span><span class="op" id="3521374">(</span><span class="op" id="3521375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521378"><a href="/net/http/transport.go.html#3521314">pc</a></span><span class="op" id="3521380">.</span><span class="ident" id="3521381">closeLocked</span><span class="op" id="3521392">(</span><span class="op" id="3521393">)</span><br>
<span class="lineno"></span><span class="op" id="3521395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3521398">func</span>&nbsp;<span class="op" id="3521403">(</span><span class="ident" id="3521404">pc</span>&nbsp;<span class="op" id="3521407">*</span><span class="ident" id="3521408"><a href="/net/http/transport.go.html#3511122">persistConn</a></span><span class="op" id="3521419">)</span>&nbsp;<span class="ident" id="3521421">closeLocked</span><span class="op" id="3521432">(</span><span class="op" id="3521433">)</span>&nbsp;<span class="op" id="3521435">{</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521438"><a href="/net/http/transport.go.html#3521404">pc</a></span><span class="op" id="3521440">.</span><span class="ident" id="3521441">broken</span>&nbsp;<span class="op" id="3521448">=</span>&nbsp;<span class="builtintype" id="3521450">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521456">if</span>&nbsp;<span class="op" id="3521459">!</span><span class="ident" id="3521460"><a href="/net/http/transport.go.html#3521404">pc</a></span><span class="op" id="3521462">.</span><span class="ident" id="3521463">closed</span>&nbsp;<span class="op" id="3521470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521474"><a href="/net/http/transport.go.html#3521404">pc</a></span><span class="op" id="3521476">.</span><span class="ident" id="3521477">conn</span><span class="op" id="3521481">.</span><span class="ident" id="3521482">Close</span><span class="op" id="3521487">(</span><span class="op" id="3521488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521492"><a href="/net/http/transport.go.html#3521404">pc</a></span><span class="op" id="3521494">.</span><span class="ident" id="3521495">closed</span>&nbsp;<span class="op" id="3521502">=</span>&nbsp;<span class="builtintype" id="3521504">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3521511">close</span><span class="op" id="3521516">(</span><span class="ident" id="3521517"><a href="/net/http/transport.go.html#3521404">pc</a></span><span class="op" id="3521519">.</span><span class="ident" id="3521520">closech</span><span class="op" id="3521527">)</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3521530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521533"><a href="/net/http/transport.go.html#3521404">pc</a></span><span class="op" id="3521535">.</span><span class="ident" id="3521536">mutateHeaderFunc</span>&nbsp;<span class="op" id="3521553">=</span>&nbsp;<span class="ident" id="3521555">nil</span><br>
<span class="lineno"></span><span class="op" id="3521559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3521562">var</span>&nbsp;<span class="ident" id="3521566">portMap</span>&nbsp;<span class="op" id="3521574">=</span>&nbsp;<span class="keyword" id="3521576">map</span><span class="op" id="3521579">[</span><span class="builtintype" id="3521580">string</span><span class="op" id="3521586">]</span><span class="builtintype" id="3521587">string</span><span class="op" id="3521593">{</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3521596">&#34;http&#34;</span><span class="op" id="3521602">:</span>&nbsp;&nbsp;<span class="string" id="3521605">&#34;80&#34;</span><span class="op" id="3521609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3521612">&#34;https&#34;</span><span class="op" id="3521619">:</span>&nbsp;<span class="string" id="3521621">&#34;443&#34;</span><span class="op" id="3521626">,</span><br>
<span class="lineno"></span><span class="op" id="3521628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3521631">//&nbsp;canonicalAddr&nbsp;returns&nbsp;url.Host&nbsp;but&nbsp;always&nbsp;with&nbsp;a&nbsp;&#34;:port&#34;&nbsp;suffix</span><br>
<span class="lineno">1160</span><span class="keyword" id="3521698">func</span>&nbsp;<span class="ident" id="3521703">canonicalAddr</span><span class="op" id="3521716">(</span><span class="ident" id="3521717">url</span>&nbsp;<span class="op" id="3521721">*</span><span class="ident" id="3521722"><a href="/net/http/transport.go.html#3490426">url</a></span><span class="op" id="3521725">.</span><span class="ident" id="3521726">URL</span><span class="op" id="3521729">)</span>&nbsp;<span class="builtintype" id="3521731">string</span>&nbsp;<span class="op" id="3521738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521741">addr</span>&nbsp;<span class="op" id="3521746">:=</span>&nbsp;<span class="ident" id="3521749"><a href="/net/http/transport.go.html#3521717">url</a></span><span class="op" id="3521752">.</span><span class="ident" id="3521753">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521759">if</span>&nbsp;<span class="op" id="3521762">!</span><span class="ident" id="3521763"><a href="/net/http/client.go.html#3314060">hasPort</a></span><span class="op" id="3521770">(</span><span class="ident" id="3521771"><a href="/net/http/transport.go.html#3521741">addr</a></span><span class="op" id="3521775">)</span>&nbsp;<span class="op" id="3521777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521781">return</span>&nbsp;<span class="ident" id="3521788"><a href="/net/http/transport.go.html#3521741">addr</a></span>&nbsp;<span class="op" id="3521793">+</span>&nbsp;<span class="string" id="3521795">&#34;:&#34;</span>&nbsp;<span class="op" id="3521799">+</span>&nbsp;<span class="ident" id="3521801"><a href="/net/http/transport.go.html#3521566">portMap</a></span><span class="op" id="3521808">[</span><span class="ident" id="3521809"><a href="/net/http/transport.go.html#3521717">url</a></span><span class="op" id="3521812">.</span><span class="ident" id="3521813">Scheme</span><span class="op" id="3521819">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3521822">}</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521825">return</span>&nbsp;<span class="ident" id="3521832"><a href="/net/http/transport.go.html#3521741">addr</a></span><br>
<span class="lineno"></span><span class="op" id="3521837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3521840">//&nbsp;bodyEOFSignal&nbsp;wraps&nbsp;a&nbsp;ReadCloser&nbsp;but&nbsp;runs&nbsp;fn&nbsp;(if&nbsp;non-nil)&nbsp;at&nbsp;most</span><br>
<span class="lineno"></span><span class="comment" id="3521909">//&nbsp;once,&nbsp;right&nbsp;before&nbsp;its&nbsp;final&nbsp;(error-producing)&nbsp;Read&nbsp;or&nbsp;Close&nbsp;call</span><br>
<span class="lineno">1170</span><span class="comment" id="3521978">//&nbsp;returns.&nbsp;If&nbsp;earlyCloseFn&nbsp;is&nbsp;non-nil&nbsp;and&nbsp;Close&nbsp;is&nbsp;called&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="3522044">//&nbsp;io.EOF&nbsp;is&nbsp;seen,&nbsp;earlyCloseFn&nbsp;is&nbsp;called&nbsp;instead&nbsp;of&nbsp;fn,&nbsp;and&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="3522109">//&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;return&nbsp;value&nbsp;from&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3522157">type</span>&nbsp;<span class="ident" id="3522162">bodyEOFSignal</span>&nbsp;<span class="keyword" id="3522176">struct</span>&nbsp;<span class="op" id="3522183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522186">body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3522199"><a href="/net/http/transport.go.html#3490406">io</a></span><span class="op" id="3522201">.</span><span class="ident" id="3522202">ReadCloser</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522214">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3522227"><a href="/net/http/transport.go.html#3490454">sync</a></span><span class="op" id="3522231">.</span><span class="ident" id="3522232">Mutex</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3522240">//&nbsp;guards&nbsp;following&nbsp;4&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522270">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3522283">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3522296">//&nbsp;whether&nbsp;Close&nbsp;has&nbsp;been&nbsp;called</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522330">rerr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3522343">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3522356">//&nbsp;sticky&nbsp;Read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522378">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3522391">func</span><span class="op" id="3522395">(</span><span class="builtintype" id="3522396">error</span><span class="op" id="3522401">)</span>&nbsp;&nbsp;<span class="comment" id="3522404">//&nbsp;error&nbsp;will&nbsp;be&nbsp;nil&nbsp;on&nbsp;Read&nbsp;io.EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522441">earlyCloseFn</span>&nbsp;<span class="keyword" id="3522454">func</span><span class="op" id="3522458">(</span><span class="op" id="3522459">)</span>&nbsp;<span class="builtintype" id="3522461">error</span>&nbsp;<span class="comment" id="3522467">//&nbsp;optional&nbsp;alt&nbsp;Close&nbsp;func&nbsp;used&nbsp;if&nbsp;io.EOF&nbsp;not&nbsp;seen</span><br>
<span class="lineno">1180</span><span class="op" id="3522518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3522521">func</span>&nbsp;<span class="op" id="3522526">(</span><span class="ident" id="3522527">es</span>&nbsp;<span class="op" id="3522530">*</span><span class="ident" id="3522531"><a href="/net/http/transport.go.html#3522162">bodyEOFSignal</a></span><span class="op" id="3522544">)</span>&nbsp;<span class="ident" id="3522546">Read</span><span class="op" id="3522550">(</span><span class="ident" id="3522551">p</span>&nbsp;<span class="op" id="3522553">[</span><span class="op" id="3522554">]</span><span class="builtintype" id="3522555">byte</span><span class="op" id="3522559">)</span>&nbsp;<span class="op" id="3522561">(</span><span class="ident" id="3522562">n</span>&nbsp;<span class="builtintype" id="3522564">int</span><span class="op" id="3522567">,</span>&nbsp;<span class="ident" id="3522569">err</span>&nbsp;<span class="builtintype" id="3522573">error</span><span class="op" id="3522578">)</span>&nbsp;<span class="op" id="3522580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522583"><a href="/net/http/transport.go.html#3522527">es</a></span><span class="op" id="3522585">.</span><span class="ident" id="3522586">mu</span><span class="op" id="3522588">.</span><span class="ident" id="3522589">Lock</span><span class="op" id="3522593">(</span><span class="op" id="3522594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522597">closed</span><span class="op" id="3522603">,</span>&nbsp;<span class="ident" id="3522605">rerr</span>&nbsp;<span class="op" id="3522610">:=</span>&nbsp;<span class="ident" id="3522613"><a href="/net/http/transport.go.html#3522527">es</a></span><span class="op" id="3522615">.</span><span class="ident" id="3522616">closed</span><span class="op" id="3522622">,</span>&nbsp;<span class="ident" id="3522624"><a href="/net/http/transport.go.html#3522527">es</a></span><span class="op" id="3522626">.</span><span class="ident" id="3522627">rerr</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522633"><a href="/net/http/transport.go.html#3522527">es</a></span><span class="op" id="3522635">.</span><span class="ident" id="3522636">mu</span><span class="op" id="3522638">.</span><span class="ident" id="3522639">Unlock</span><span class="op" id="3522645">(</span><span class="op" id="3522646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522649">if</span>&nbsp;<span class="ident" id="3522652"><a href="/net/http/transport.go.html#3522597">closed</a></span>&nbsp;<span class="op" id="3522659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522663">return</span>&nbsp;<span class="num" id="3522670">0</span><span class="op" id="3522671">,</span>&nbsp;<span class="ident" id="3522673"><a href="/net/http/transport.go.html#3490389">errors</a></span><span class="op" id="3522679">.</span><span class="ident" id="3522680">New</span><span class="op" id="3522683">(</span><span class="string" id="3522684">&#34;http:&nbsp;read&nbsp;on&nbsp;closed&nbsp;response&nbsp;body&#34;</span><span class="op" id="3522720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522726">if</span>&nbsp;<span class="ident" id="3522729"><a href="/net/http/transport.go.html#3522605">rerr</a></span>&nbsp;<span class="op" id="3522734">!=</span>&nbsp;<span class="ident" id="3522737">nil</span>&nbsp;<span class="op" id="3522741">{</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522745">return</span>&nbsp;<span class="num" id="3522752">0</span><span class="op" id="3522753">,</span>&nbsp;<span class="ident" id="3522755"><a href="/net/http/transport.go.html#3522605">rerr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522765"><a href="/net/http/transport.go.html#3522562">n</a></span><span class="op" id="3522766">,</span>&nbsp;<span class="ident" id="3522768"><a href="/net/http/transport.go.html#3522569">err</a></span>&nbsp;<span class="op" id="3522772">=</span>&nbsp;<span class="ident" id="3522774"><a href="/net/http/transport.go.html#3522527">es</a></span><span class="op" id="3522776">.</span><span class="ident" id="3522777">body</span><span class="op" id="3522781">.</span><span class="ident" id="3522782">Read</span><span class="op" id="3522786">(</span><span class="ident" id="3522787"><a href="/net/http/transport.go.html#3522551">p</a></span><span class="op" id="3522788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522791">if</span>&nbsp;<span class="ident" id="3522794"><a href="/net/http/transport.go.html#3522569">err</a></span>&nbsp;<span class="op" id="3522798">!=</span>&nbsp;<span class="ident" id="3522801">nil</span>&nbsp;<span class="op" id="3522805">{</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522809"><a href="/net/http/transport.go.html#3522527">es</a></span><span class="op" id="3522811">.</span><span class="ident" id="3522812">mu</span><span class="op" id="3522814">.</span><span class="ident" id="3522815">Lock</span><span class="op" id="3522819">(</span><span class="op" id="3522820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522824">defer</span>&nbsp;<span class="ident" id="3522830"><a href="/net/http/transport.go.html#3522527">es</a></span><span class="op" id="3522832">.</span><span class="ident" id="3522833">mu</span><span class="op" id="3522835">.</span><span class="ident" id="3522836">Unlock</span><span class="op" id="3522842">(</span><span class="op" id="3522843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522847">if</span>&nbsp;<span class="ident" id="3522850"><a href="/net/http/transport.go.html#3522527">es</a></span><span class="op" id="3522852">.</span><span class="ident" id="3522853">rerr</span>&nbsp;<span class="op" id="3522858">==</span>&nbsp;<span class="ident" id="3522861">nil</span>&nbsp;<span class="op" id="3522865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522870"><a href="/net/http/transport.go.html#3522527">es</a></span><span class="op" id="3522872">.</span><span class="ident" id="3522873">rerr</span>&nbsp;<span class="op" id="3522878">=</span>&nbsp;<span class="ident" id="3522880"><a href="/net/http/transport.go.html#3522569">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522886">}</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522890"><a href="/net/http/transport.go.html#3522527">es</a></span><span class="op" id="3522892">.</span><span class="ident" id="3522893">condfn</span><span class="op" id="3522899">(</span><span class="ident" id="3522900"><a href="/net/http/transport.go.html#3522569">err</a></span><span class="op" id="3522903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522909">return</span><br>
<span class="lineno"></span><span class="op" id="3522916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1205</span><span class="keyword" id="3522919">func</span>&nbsp;<span class="op" id="3522924">(</span><span class="ident" id="3522925">es</span>&nbsp;<span class="op" id="3522928">*</span><span class="ident" id="3522929"><a href="/net/http/transport.go.html#3522162">bodyEOFSignal</a></span><span class="op" id="3522942">)</span>&nbsp;<span class="ident" id="3522944">Close</span><span class="op" id="3522949">(</span><span class="op" id="3522950">)</span>&nbsp;<span class="builtintype" id="3522952">error</span>&nbsp;<span class="op" id="3522958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522961"><a href="/net/http/transport.go.html#3522925">es</a></span><span class="op" id="3522963">.</span><span class="ident" id="3522964">mu</span><span class="op" id="3522966">.</span><span class="ident" id="3522967">Lock</span><span class="op" id="3522971">(</span><span class="op" id="3522972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522975">defer</span>&nbsp;<span class="ident" id="3522981"><a href="/net/http/transport.go.html#3522925">es</a></span><span class="op" id="3522983">.</span><span class="ident" id="3522984">mu</span><span class="op" id="3522986">.</span><span class="ident" id="3522987">Unlock</span><span class="op" id="3522993">(</span><span class="op" id="3522994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522997">if</span>&nbsp;<span class="ident" id="3523000"><a href="/net/http/transport.go.html#3522925">es</a></span><span class="op" id="3523002">.</span><span class="ident" id="3523003">closed</span>&nbsp;<span class="op" id="3523010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523014">return</span>&nbsp;<span class="ident" id="3523021">nil</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3523026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3523029"><a href="/net/http/transport.go.html#3522925">es</a></span><span class="op" id="3523031">.</span><span class="ident" id="3523032">closed</span>&nbsp;<span class="op" id="3523039">=</span>&nbsp;<span class="builtintype" id="3523041">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523047">if</span>&nbsp;<span class="ident" id="3523050"><a href="/net/http/transport.go.html#3522925">es</a></span><span class="op" id="3523052">.</span><span class="ident" id="3523053">earlyCloseFn</span>&nbsp;<span class="op" id="3523066">!=</span>&nbsp;<span class="ident" id="3523069">nil</span>&nbsp;<span class="op" id="3523073">&amp;&amp;</span>&nbsp;<span class="ident" id="3523076"><a href="/net/http/transport.go.html#3522925">es</a></span><span class="op" id="3523078">.</span><span class="ident" id="3523079">rerr</span>&nbsp;<span class="op" id="3523084">!=</span>&nbsp;<span class="ident" id="3523087"><a href="/net/http/transport.go.html#3490406">io</a></span><span class="op" id="3523089">.</span><span class="ident" id="3523090">EOF</span>&nbsp;<span class="op" id="3523094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523098">return</span>&nbsp;<span class="ident" id="3523105"><a href="/net/http/transport.go.html#3522925">es</a></span><span class="op" id="3523107">.</span><span class="ident" id="3523108">earlyCloseFn</span><span class="op" id="3523120">(</span><span class="op" id="3523121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3523124">}</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3523127">err</span>&nbsp;<span class="op" id="3523131">:=</span>&nbsp;<span class="ident" id="3523134"><a href="/net/http/transport.go.html#3522925">es</a></span><span class="op" id="3523136">.</span><span class="ident" id="3523137">body</span><span class="op" id="3523141">.</span><span class="ident" id="3523142">Close</span><span class="op" id="3523147">(</span><span class="op" id="3523148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3523151"><a href="/net/http/transport.go.html#3522925">es</a></span><span class="op" id="3523153">.</span><span class="ident" id="3523154">condfn</span><span class="op" id="3523160">(</span><span class="ident" id="3523161"><a href="/net/http/transport.go.html#3523127">err</a></span><span class="op" id="3523164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523167">return</span>&nbsp;<span class="ident" id="3523174"><a href="/net/http/transport.go.html#3523127">err</a></span><br>
<span class="lineno"></span><span class="op" id="3523178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1220</span><span class="comment" id="3523181">//&nbsp;caller&nbsp;must&nbsp;hold&nbsp;es.mu.</span><br>
<span class="lineno"></span><span class="keyword" id="3523208">func</span>&nbsp;<span class="op" id="3523213">(</span><span class="ident" id="3523214">es</span>&nbsp;<span class="op" id="3523217">*</span><span class="ident" id="3523218"><a href="/net/http/transport.go.html#3522162">bodyEOFSignal</a></span><span class="op" id="3523231">)</span>&nbsp;<span class="ident" id="3523233">condfn</span><span class="op" id="3523239">(</span><span class="ident" id="3523240">err</span>&nbsp;<span class="builtintype" id="3523244">error</span><span class="op" id="3523249">)</span>&nbsp;<span class="op" id="3523251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523254">if</span>&nbsp;<span class="ident" id="3523257"><a href="/net/http/transport.go.html#3523214">es</a></span><span class="op" id="3523259">.</span><span class="ident" id="3523260">fn</span>&nbsp;<span class="op" id="3523263">==</span>&nbsp;<span class="ident" id="3523266">nil</span>&nbsp;<span class="op" id="3523270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523274">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3523282">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523285">if</span>&nbsp;<span class="ident" id="3523288"><a href="/net/http/transport.go.html#3523240">err</a></span>&nbsp;<span class="op" id="3523292">==</span>&nbsp;<span class="ident" id="3523295"><a href="/net/http/transport.go.html#3490406">io</a></span><span class="op" id="3523297">.</span><span class="ident" id="3523298">EOF</span>&nbsp;<span class="op" id="3523302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3523306"><a href="/net/http/transport.go.html#3523240">err</a></span>&nbsp;<span class="op" id="3523310">=</span>&nbsp;<span class="ident" id="3523312">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3523317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3523320"><a href="/net/http/transport.go.html#3523214">es</a></span><span class="op" id="3523322">.</span><span class="ident" id="3523323">fn</span><span class="op" id="3523325">(</span><span class="ident" id="3523326"><a href="/net/http/transport.go.html#3523240">err</a></span><span class="op" id="3523329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3523332"><a href="/net/http/transport.go.html#3523214">es</a></span><span class="op" id="3523334">.</span><span class="ident" id="3523335">fn</span>&nbsp;<span class="op" id="3523338">=</span>&nbsp;<span class="ident" id="3523340">nil</span><br>
<span class="lineno">1230</span><span class="op" id="3523344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3523347">//&nbsp;gzipReader&nbsp;wraps&nbsp;a&nbsp;response&nbsp;body&nbsp;so&nbsp;it&nbsp;can&nbsp;lazily</span><br>
<span class="lineno"></span><span class="comment" id="3523400">//&nbsp;call&nbsp;gzip.NewReader&nbsp;on&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Read</span><br>
<span class="lineno"></span><span class="keyword" id="3523449">type</span>&nbsp;<span class="ident" id="3523454">gzipReader</span>&nbsp;<span class="keyword" id="3523465">struct</span>&nbsp;<span class="op" id="3523472">{</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3523475">body</span>&nbsp;<span class="ident" id="3523480"><a href="/net/http/transport.go.html#3490406">io</a></span><span class="op" id="3523482">.</span><span class="ident" id="3523483">ReadCloser</span>&nbsp;<span class="comment" id="3523494">//&nbsp;underlying&nbsp;Response.Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3523523">zr</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3523528"><a href="/net/http/transport.go.html#3490406">io</a></span><span class="op" id="3523530">.</span><span class="ident" id="3523531">Reader</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3523542">//&nbsp;lazily-initialized&nbsp;gzip&nbsp;reader</span><br>
<span class="lineno"></span><span class="op" id="3523576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3523579">func</span>&nbsp;<span class="op" id="3523584">(</span><span class="ident" id="3523585">gz</span>&nbsp;<span class="op" id="3523588">*</span><span class="ident" id="3523589"><a href="/net/http/transport.go.html#3523454">gzipReader</a></span><span class="op" id="3523599">)</span>&nbsp;<span class="ident" id="3523601">Read</span><span class="op" id="3523605">(</span><span class="ident" id="3523606">p</span>&nbsp;<span class="op" id="3523608">[</span><span class="op" id="3523609">]</span><span class="builtintype" id="3523610">byte</span><span class="op" id="3523614">)</span>&nbsp;<span class="op" id="3523616">(</span><span class="ident" id="3523617">n</span>&nbsp;<span class="builtintype" id="3523619">int</span><span class="op" id="3523622">,</span>&nbsp;<span class="ident" id="3523624">err</span>&nbsp;<span class="builtintype" id="3523628">error</span><span class="op" id="3523633">)</span>&nbsp;<span class="op" id="3523635">{</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523638">if</span>&nbsp;<span class="ident" id="3523641"><a href="/net/http/transport.go.html#3523585">gz</a></span><span class="op" id="3523643">.</span><span class="ident" id="3523644">zr</span>&nbsp;<span class="op" id="3523647">==</span>&nbsp;<span class="ident" id="3523650">nil</span>&nbsp;<span class="op" id="3523654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3523658"><a href="/net/http/transport.go.html#3523585">gz</a></span><span class="op" id="3523660">.</span><span class="ident" id="3523661">zr</span><span class="op" id="3523663">,</span>&nbsp;<span class="ident" id="3523665"><a href="/net/http/transport.go.html#3523624">err</a></span>&nbsp;<span class="op" id="3523669">=</span>&nbsp;<span class="ident" id="3523671"><a href="/net/http/transport.go.html#3490358">gzip</a></span><span class="op" id="3523675">.</span><span class="ident" id="3523676">NewReader</span><span class="op" id="3523685">(</span><span class="ident" id="3523686"><a href="/net/http/transport.go.html#3523585">gz</a></span><span class="op" id="3523688">.</span><span class="ident" id="3523689">body</span><span class="op" id="3523693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523697">if</span>&nbsp;<span class="ident" id="3523700"><a href="/net/http/transport.go.html#3523624">err</a></span>&nbsp;<span class="op" id="3523704">!=</span>&nbsp;<span class="ident" id="3523707">nil</span>&nbsp;<span class="op" id="3523711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523716">return</span>&nbsp;<span class="num" id="3523723">0</span><span class="op" id="3523724">,</span>&nbsp;<span class="ident" id="3523726"><a href="/net/http/transport.go.html#3523624">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3523732">}</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3523735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523738">return</span>&nbsp;<span class="ident" id="3523745"><a href="/net/http/transport.go.html#3523585">gz</a></span><span class="op" id="3523747">.</span><span class="ident" id="3523748">zr</span><span class="op" id="3523750">.</span><span class="ident" id="3523751">Read</span><span class="op" id="3523755">(</span><span class="ident" id="3523756"><a href="/net/http/transport.go.html#3523606">p</a></span><span class="op" id="3523757">)</span><br>
<span class="lineno"></span><span class="op" id="3523759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3523762">func</span>&nbsp;<span class="op" id="3523767">(</span><span class="ident" id="3523768">gz</span>&nbsp;<span class="op" id="3523771">*</span><span class="ident" id="3523772"><a href="/net/http/transport.go.html#3523454">gzipReader</a></span><span class="op" id="3523782">)</span>&nbsp;<span class="ident" id="3523784">Close</span><span class="op" id="3523789">(</span><span class="op" id="3523790">)</span>&nbsp;<span class="builtintype" id="3523792">error</span>&nbsp;<span class="op" id="3523798">{</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523801">return</span>&nbsp;<span class="ident" id="3523808"><a href="/net/http/transport.go.html#3523768">gz</a></span><span class="op" id="3523810">.</span><span class="ident" id="3523811">body</span><span class="op" id="3523815">.</span><span class="ident" id="3523816">Close</span><span class="op" id="3523821">(</span><span class="op" id="3523822">)</span><br>
<span class="lineno"></span><span class="op" id="3523824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3523827">type</span>&nbsp;<span class="ident" id="3523832">readerAndCloser</span>&nbsp;<span class="keyword" id="3523848">struct</span>&nbsp;<span class="op" id="3523855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3523858"><a href="/net/http/transport.go.html#3490406">io</a></span><span class="op" id="3523860">.</span><span class="ident" id="3523861">Reader</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3523869"><a href="/net/http/transport.go.html#3490406">io</a></span><span class="op" id="3523871">.</span><span class="ident" id="3523872">Closer</span><br>
<span class="lineno"></span><span class="op" id="3523879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3523882">type</span>&nbsp;<span class="ident" id="3523887">tlsHandshakeTimeoutError</span>&nbsp;<span class="keyword" id="3523912">struct</span><span class="op" id="3523918">{</span><span class="op" id="3523919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1260</span><span class="keyword" id="3523922">func</span>&nbsp;<span class="op" id="3523927">(</span><span class="ident" id="3523928"><a href="/net/http/transport.go.html#3523887">tlsHandshakeTimeoutError</a></span><span class="op" id="3523952">)</span>&nbsp;<span class="ident" id="3523954">Timeout</span><span class="op" id="3523961">(</span><span class="op" id="3523962">)</span>&nbsp;<span class="builtintype" id="3523964">bool</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3523971">{</span>&nbsp;<span class="keyword" id="3523973">return</span>&nbsp;<span class="builtintype" id="3523980">true</span>&nbsp;<span class="op" id="3523985">}</span><br>
<span class="lineno"></span><span class="keyword" id="3523987">func</span>&nbsp;<span class="op" id="3523992">(</span><span class="ident" id="3523993"><a href="/net/http/transport.go.html#3523887">tlsHandshakeTimeoutError</a></span><span class="op" id="3524017">)</span>&nbsp;<span class="ident" id="3524019">Temporary</span><span class="op" id="3524028">(</span><span class="op" id="3524029">)</span>&nbsp;<span class="builtintype" id="3524031">bool</span>&nbsp;<span class="op" id="3524036">{</span>&nbsp;<span class="keyword" id="3524038">return</span>&nbsp;<span class="builtintype" id="3524045">true</span>&nbsp;<span class="op" id="3524050">}</span><br>
<span class="lineno"></span><span class="keyword" id="3524052">func</span>&nbsp;<span class="op" id="3524057">(</span><span class="ident" id="3524058"><a href="/net/http/transport.go.html#3523887">tlsHandshakeTimeoutError</a></span><span class="op" id="3524082">)</span>&nbsp;<span class="ident" id="3524084">Error</span><span class="op" id="3524089">(</span><span class="op" id="3524090">)</span>&nbsp;<span class="builtintype" id="3524092">string</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3524101">{</span>&nbsp;<span class="keyword" id="3524103">return</span>&nbsp;<span class="string" id="3524110">&#34;net/http:&nbsp;TLS&nbsp;handshake&nbsp;timeout&#34;</span>&nbsp;<span class="op" id="3524144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3524147">type</span>&nbsp;<span class="ident" id="3524152">noteEOFReader</span>&nbsp;<span class="keyword" id="3524166">struct</span>&nbsp;<span class="op" id="3524173">{</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524176">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3524183"><a href="/net/http/transport.go.html#3490406">io</a></span><span class="op" id="3524185">.</span><span class="ident" id="3524186">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524194">sawEOF</span>&nbsp;<span class="op" id="3524201">*</span><span class="builtintype" id="3524202">bool</span><br>
<span class="lineno"></span><span class="op" id="3524207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3524210">func</span>&nbsp;<span class="op" id="3524215">(</span><span class="ident" id="3524216">nr</span>&nbsp;<span class="ident" id="3524219"><a href="/net/http/transport.go.html#3524152">noteEOFReader</a></span><span class="op" id="3524232">)</span>&nbsp;<span class="ident" id="3524234">Read</span><span class="op" id="3524238">(</span><span class="ident" id="3524239">p</span>&nbsp;<span class="op" id="3524241">[</span><span class="op" id="3524242">]</span><span class="builtintype" id="3524243">byte</span><span class="op" id="3524247">)</span>&nbsp;<span class="op" id="3524249">(</span><span class="ident" id="3524250">n</span>&nbsp;<span class="builtintype" id="3524252">int</span><span class="op" id="3524255">,</span>&nbsp;<span class="ident" id="3524257">err</span>&nbsp;<span class="builtintype" id="3524261">error</span><span class="op" id="3524266">)</span>&nbsp;<span class="op" id="3524268">{</span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524271"><a href="/net/http/transport.go.html#3524250">n</a></span><span class="op" id="3524272">,</span>&nbsp;<span class="ident" id="3524274"><a href="/net/http/transport.go.html#3524257">err</a></span>&nbsp;<span class="op" id="3524278">=</span>&nbsp;<span class="ident" id="3524280"><a href="/net/http/transport.go.html#3524216">nr</a></span><span class="op" id="3524282">.</span><span class="ident" id="3524283">r</span><span class="op" id="3524284">.</span><span class="ident" id="3524285">Read</span><span class="op" id="3524289">(</span><span class="ident" id="3524290"><a href="/net/http/transport.go.html#3524239">p</a></span><span class="op" id="3524291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524294">if</span>&nbsp;<span class="ident" id="3524297"><a href="/net/http/transport.go.html#3524257">err</a></span>&nbsp;<span class="op" id="3524301">==</span>&nbsp;<span class="ident" id="3524304"><a href="/net/http/transport.go.html#3490406">io</a></span><span class="op" id="3524306">.</span><span class="ident" id="3524307">EOF</span>&nbsp;<span class="op" id="3524311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3524315">*</span><span class="ident" id="3524316"><a href="/net/http/transport.go.html#3524216">nr</a></span><span class="op" id="3524318">.</span><span class="ident" id="3524319">sawEOF</span>&nbsp;<span class="op" id="3524326">=</span>&nbsp;<span class="builtintype" id="3524328">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3524334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524337">return</span><br>
<span class="lineno">1275</span><span class="op" id="3524344">}</span>
</div>
</body>
</html>
