<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>io</h2>
<ul>
<li><a href="/gostd/io/io.go.html">io.go</a></li>
<li><a href="/gostd/io/io_test.go.html">io_test.go</a></li>
<li><a href="/gostd/io/multi.go.html">multi.go</a></li>
<li><a href="/gostd/io/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/io/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/io/pipe_test.go.html">pipe_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1391933">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1391988">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1392042">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1392093">//&nbsp;Pipe&nbsp;adapter&nbsp;to&nbsp;connect&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Reader</span><br>
<span class="lineno"></span><span class="comment" id="1392148">//&nbsp;with&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1392186">package</span>&nbsp;<span class="ident" id="1392194">io</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="1392198">import</span>&nbsp;<span class="op" id="1392205">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1392208">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1392218">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="1392225">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1392228">//&nbsp;ErrClosedPipe&nbsp;is&nbsp;the&nbsp;error&nbsp;used&nbsp;for&nbsp;read&nbsp;or&nbsp;write&nbsp;operations&nbsp;on&nbsp;a&nbsp;closed&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1392310">var</span>&nbsp;<span class="ident" id="1392314">ErrClosedPipe</span>&nbsp;<span class="op" id="1392328">=</span>&nbsp;<span class="ident" id="1392330">errors</span><span class="op" id="1392336">.</span><span class="ident" id="1392337">New</span><span class="op" id="1392340">(</span><span class="string" id="1392341">&#34;io:&nbsp;read/write&nbsp;on&nbsp;closed&nbsp;pipe&#34;</span><span class="op" id="1392372">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1392375">type</span>&nbsp;<span class="ident" id="1392380">pipeResult</span>&nbsp;<span class="keyword" id="1392391">struct</span>&nbsp;<span class="op" id="1392398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392401">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1392405">int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392410">err</span>&nbsp;<span class="builtintype" id="1392414">error</span><br>
<span class="lineno"></span><span class="op" id="1392420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1392423">//&nbsp;A&nbsp;pipe&nbsp;is&nbsp;the&nbsp;shared&nbsp;pipe&nbsp;structure&nbsp;underlying&nbsp;PipeReader&nbsp;and&nbsp;PipeWriter.</span><br>
<span class="lineno"></span><span class="keyword" id="1392500">type</span>&nbsp;<span class="ident" id="1392505">pipe</span>&nbsp;<span class="keyword" id="1392510">struct</span>&nbsp;<span class="op" id="1392517">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392520">rl</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1392526">sync</span><span class="op" id="1392530">.</span><span class="ident" id="1392531">Mutex</span>&nbsp;<span class="comment" id="1392537">//&nbsp;gates&nbsp;readers&nbsp;one&nbsp;at&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392569">wl</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1392575">sync</span><span class="op" id="1392579">.</span><span class="ident" id="1392580">Mutex</span>&nbsp;<span class="comment" id="1392586">//&nbsp;gates&nbsp;writers&nbsp;one&nbsp;at&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392618">l</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1392624">sync</span><span class="op" id="1392628">.</span><span class="ident" id="1392629">Mutex</span>&nbsp;<span class="comment" id="1392635">//&nbsp;protects&nbsp;remaining&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392665">data</span>&nbsp;&nbsp;<span class="op" id="1392671">[</span><span class="op" id="1392672">]</span><span class="builtintype" id="1392673">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1392682">//&nbsp;data&nbsp;remaining&nbsp;in&nbsp;pending&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392718">rwait</span>&nbsp;<span class="ident" id="1392724">sync</span><span class="op" id="1392728">.</span><span class="ident" id="1392729">Cond</span>&nbsp;&nbsp;<span class="comment" id="1392735">//&nbsp;waiting&nbsp;reader</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392754">wwait</span>&nbsp;<span class="ident" id="1392760">sync</span><span class="op" id="1392764">.</span><span class="ident" id="1392765">Cond</span>&nbsp;&nbsp;<span class="comment" id="1392771">//&nbsp;waiting&nbsp;writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392790">rerr</span>&nbsp;&nbsp;<span class="builtintype" id="1392796">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1392807">//&nbsp;if&nbsp;reader&nbsp;closed,&nbsp;error&nbsp;to&nbsp;give&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392850">werr</span>&nbsp;&nbsp;<span class="builtintype" id="1392856">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1392867">//&nbsp;if&nbsp;writer&nbsp;closed,&nbsp;error&nbsp;to&nbsp;give&nbsp;reads</span><br>
<span class="lineno"></span><span class="op" id="1392908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="1392911">func</span>&nbsp;<span class="op" id="1392916">(</span><span class="ident" id="1392917">p</span>&nbsp;<span class="op" id="1392919">*</span><span class="ident" id="1392920">pipe</span><span class="op" id="1392924">)</span>&nbsp;<span class="ident" id="1392926">read</span><span class="op" id="1392930">(</span><span class="ident" id="1392931">b</span>&nbsp;<span class="op" id="1392933">[</span><span class="op" id="1392934">]</span><span class="builtintype" id="1392935">byte</span><span class="op" id="1392939">)</span>&nbsp;<span class="op" id="1392941">(</span><span class="ident" id="1392942">n</span>&nbsp;<span class="builtintype" id="1392944">int</span><span class="op" id="1392947">,</span>&nbsp;<span class="ident" id="1392949">err</span>&nbsp;<span class="builtintype" id="1392953">error</span><span class="op" id="1392958">)</span>&nbsp;<span class="op" id="1392960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1392963">//&nbsp;One&nbsp;reader&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392989">p</span><span class="op" id="1392990">.</span><span class="ident" id="1392991">rl</span><span class="op" id="1392993">.</span><span class="ident" id="1392994">Lock</span><span class="op" id="1392998">(</span><span class="op" id="1392999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393002">defer</span>&nbsp;<span class="ident" id="1393008">p</span><span class="op" id="1393009">.</span><span class="ident" id="1393010">rl</span><span class="op" id="1393012">.</span><span class="ident" id="1393013">Unlock</span><span class="op" id="1393019">(</span><span class="op" id="1393020">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393024">p</span><span class="op" id="1393025">.</span><span class="ident" id="1393026">l</span><span class="op" id="1393027">.</span><span class="ident" id="1393028">Lock</span><span class="op" id="1393032">(</span><span class="op" id="1393033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393036">defer</span>&nbsp;<span class="ident" id="1393042">p</span><span class="op" id="1393043">.</span><span class="ident" id="1393044">l</span><span class="op" id="1393045">.</span><span class="ident" id="1393046">Unlock</span><span class="op" id="1393052">(</span><span class="op" id="1393053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393056">for</span>&nbsp;<span class="op" id="1393060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393064">if</span>&nbsp;<span class="ident" id="1393067">p</span><span class="op" id="1393068">.</span><span class="ident" id="1393069">rerr</span>&nbsp;<span class="op" id="1393074">!=</span>&nbsp;<span class="ident" id="1393077">nil</span>&nbsp;<span class="op" id="1393081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393086">return</span>&nbsp;<span class="num" id="1393093">0</span><span class="op" id="1393094">,</span>&nbsp;<span class="ident" id="1393096">ErrClosedPipe</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393116">if</span>&nbsp;<span class="ident" id="1393119">p</span><span class="op" id="1393120">.</span><span class="ident" id="1393121">data</span>&nbsp;<span class="op" id="1393126">!=</span>&nbsp;<span class="ident" id="1393129">nil</span>&nbsp;<span class="op" id="1393133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393138">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393150">if</span>&nbsp;<span class="ident" id="1393153">p</span><span class="op" id="1393154">.</span><span class="ident" id="1393155">werr</span>&nbsp;<span class="op" id="1393160">!=</span>&nbsp;<span class="ident" id="1393163">nil</span>&nbsp;<span class="op" id="1393167">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393172">return</span>&nbsp;<span class="num" id="1393179">0</span><span class="op" id="1393180">,</span>&nbsp;<span class="ident" id="1393182">p</span><span class="op" id="1393183">.</span><span class="ident" id="1393184">werr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393195">p</span><span class="op" id="1393196">.</span><span class="ident" id="1393197">rwait</span><span class="op" id="1393202">.</span><span class="ident" id="1393203">Wait</span><span class="op" id="1393207">(</span><span class="op" id="1393208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393214">n</span>&nbsp;<span class="op" id="1393216">=</span>&nbsp;<span class="builtinfunc" id="1393218">copy</span><span class="op" id="1393222">(</span><span class="ident" id="1393223">b</span><span class="op" id="1393224">,</span>&nbsp;<span class="ident" id="1393226">p</span><span class="op" id="1393227">.</span><span class="ident" id="1393228">data</span><span class="op" id="1393232">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393235">p</span><span class="op" id="1393236">.</span><span class="ident" id="1393237">data</span>&nbsp;<span class="op" id="1393242">=</span>&nbsp;<span class="ident" id="1393244">p</span><span class="op" id="1393245">.</span><span class="ident" id="1393246">data</span><span class="op" id="1393250">[</span><span class="ident" id="1393251">n</span><span class="op" id="1393252">:</span><span class="op" id="1393253">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393256">if</span>&nbsp;<span class="builtinfunc" id="1393259">len</span><span class="op" id="1393262">(</span><span class="ident" id="1393263">p</span><span class="op" id="1393264">.</span><span class="ident" id="1393265">data</span><span class="op" id="1393269">)</span>&nbsp;<span class="op" id="1393271">==</span>&nbsp;<span class="num" id="1393274">0</span>&nbsp;<span class="op" id="1393276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393280">p</span><span class="op" id="1393281">.</span><span class="ident" id="1393282">data</span>&nbsp;<span class="op" id="1393287">=</span>&nbsp;<span class="ident" id="1393289">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393295">p</span><span class="op" id="1393296">.</span><span class="ident" id="1393297">wwait</span><span class="op" id="1393302">.</span><span class="ident" id="1393303">Signal</span><span class="op" id="1393309">(</span><span class="op" id="1393310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393313">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393316">return</span><br>
<span class="lineno"></span><span class="op" id="1393323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1393326">var</span>&nbsp;<span class="ident" id="1393330">zero</span>&nbsp;<span class="op" id="1393335">[</span><span class="num" id="1393336">0</span><span class="op" id="1393337">]</span><span class="builtintype" id="1393338">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="1393344">func</span>&nbsp;<span class="op" id="1393349">(</span><span class="ident" id="1393350">p</span>&nbsp;<span class="op" id="1393352">*</span><span class="ident" id="1393353">pipe</span><span class="op" id="1393357">)</span>&nbsp;<span class="ident" id="1393359">write</span><span class="op" id="1393364">(</span><span class="ident" id="1393365">b</span>&nbsp;<span class="op" id="1393367">[</span><span class="op" id="1393368">]</span><span class="builtintype" id="1393369">byte</span><span class="op" id="1393373">)</span>&nbsp;<span class="op" id="1393375">(</span><span class="ident" id="1393376">n</span>&nbsp;<span class="builtintype" id="1393378">int</span><span class="op" id="1393381">,</span>&nbsp;<span class="ident" id="1393383">err</span>&nbsp;<span class="builtintype" id="1393387">error</span><span class="op" id="1393392">)</span>&nbsp;<span class="op" id="1393394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1393397">//&nbsp;pipe&nbsp;uses&nbsp;nil&nbsp;to&nbsp;mean&nbsp;not&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393437">if</span>&nbsp;<span class="ident" id="1393440">b</span>&nbsp;<span class="op" id="1393442">==</span>&nbsp;<span class="ident" id="1393445">nil</span>&nbsp;<span class="op" id="1393449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393453">b</span>&nbsp;<span class="op" id="1393455">=</span>&nbsp;<span class="ident" id="1393457">zero</span><span class="op" id="1393461">[</span><span class="op" id="1393462">:</span><span class="op" id="1393463">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393466">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1393470">//&nbsp;One&nbsp;writer&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393496">p</span><span class="op" id="1393497">.</span><span class="ident" id="1393498">wl</span><span class="op" id="1393500">.</span><span class="ident" id="1393501">Lock</span><span class="op" id="1393505">(</span><span class="op" id="1393506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393509">defer</span>&nbsp;<span class="ident" id="1393515">p</span><span class="op" id="1393516">.</span><span class="ident" id="1393517">wl</span><span class="op" id="1393519">.</span><span class="ident" id="1393520">Unlock</span><span class="op" id="1393526">(</span><span class="op" id="1393527">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393531">p</span><span class="op" id="1393532">.</span><span class="ident" id="1393533">l</span><span class="op" id="1393534">.</span><span class="ident" id="1393535">Lock</span><span class="op" id="1393539">(</span><span class="op" id="1393540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393543">defer</span>&nbsp;<span class="ident" id="1393549">p</span><span class="op" id="1393550">.</span><span class="ident" id="1393551">l</span><span class="op" id="1393552">.</span><span class="ident" id="1393553">Unlock</span><span class="op" id="1393559">(</span><span class="op" id="1393560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393563">if</span>&nbsp;<span class="ident" id="1393566">p</span><span class="op" id="1393567">.</span><span class="ident" id="1393568">werr</span>&nbsp;<span class="op" id="1393573">!=</span>&nbsp;<span class="ident" id="1393576">nil</span>&nbsp;<span class="op" id="1393580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393584">err</span>&nbsp;<span class="op" id="1393588">=</span>&nbsp;<span class="ident" id="1393590">ErrClosedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393606">return</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393617">p</span><span class="op" id="1393618">.</span><span class="ident" id="1393619">data</span>&nbsp;<span class="op" id="1393624">=</span>&nbsp;<span class="ident" id="1393626">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393629">p</span><span class="op" id="1393630">.</span><span class="ident" id="1393631">rwait</span><span class="op" id="1393636">.</span><span class="ident" id="1393637">Signal</span><span class="op" id="1393643">(</span><span class="op" id="1393644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393647">for</span>&nbsp;<span class="op" id="1393651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393655">if</span>&nbsp;<span class="ident" id="1393658">p</span><span class="op" id="1393659">.</span><span class="ident" id="1393660">data</span>&nbsp;<span class="op" id="1393665">==</span>&nbsp;<span class="ident" id="1393668">nil</span>&nbsp;<span class="op" id="1393672">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393677">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393689">if</span>&nbsp;<span class="ident" id="1393692">p</span><span class="op" id="1393693">.</span><span class="ident" id="1393694">rerr</span>&nbsp;<span class="op" id="1393699">!=</span>&nbsp;<span class="ident" id="1393702">nil</span>&nbsp;<span class="op" id="1393706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393711">err</span>&nbsp;<span class="op" id="1393715">=</span>&nbsp;<span class="ident" id="1393717">p</span><span class="op" id="1393718">.</span><span class="ident" id="1393719">rerr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393727">break</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393739">if</span>&nbsp;<span class="ident" id="1393742">p</span><span class="op" id="1393743">.</span><span class="ident" id="1393744">werr</span>&nbsp;<span class="op" id="1393749">!=</span>&nbsp;<span class="ident" id="1393752">nil</span>&nbsp;<span class="op" id="1393756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393761">err</span>&nbsp;<span class="op" id="1393765">=</span>&nbsp;<span class="ident" id="1393767">ErrClosedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393787">p</span><span class="op" id="1393788">.</span><span class="ident" id="1393789">wwait</span><span class="op" id="1393794">.</span><span class="ident" id="1393795">Wait</span><span class="op" id="1393799">(</span><span class="op" id="1393800">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393806">n</span>&nbsp;<span class="op" id="1393808">=</span>&nbsp;<span class="builtinfunc" id="1393810">len</span><span class="op" id="1393813">(</span><span class="ident" id="1393814">b</span><span class="op" id="1393815">)</span>&nbsp;<span class="op" id="1393817">-</span>&nbsp;<span class="builtinfunc" id="1393819">len</span><span class="op" id="1393822">(</span><span class="ident" id="1393823">p</span><span class="op" id="1393824">.</span><span class="ident" id="1393825">data</span><span class="op" id="1393829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393832">p</span><span class="op" id="1393833">.</span><span class="ident" id="1393834">data</span>&nbsp;<span class="op" id="1393839">=</span>&nbsp;<span class="ident" id="1393841">nil</span>&nbsp;<span class="comment" id="1393845">//&nbsp;in&nbsp;case&nbsp;of&nbsp;rerr&nbsp;or&nbsp;werr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393873">return</span><br>
<span class="lineno"></span><span class="op" id="1393880">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="1393883">func</span>&nbsp;<span class="op" id="1393888">(</span><span class="ident" id="1393889">p</span>&nbsp;<span class="op" id="1393891">*</span><span class="ident" id="1393892">pipe</span><span class="op" id="1393896">)</span>&nbsp;<span class="ident" id="1393898">rclose</span><span class="op" id="1393904">(</span><span class="ident" id="1393905">err</span>&nbsp;<span class="builtintype" id="1393909">error</span><span class="op" id="1393914">)</span>&nbsp;<span class="op" id="1393916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393919">if</span>&nbsp;<span class="ident" id="1393922">err</span>&nbsp;<span class="op" id="1393926">==</span>&nbsp;<span class="ident" id="1393929">nil</span>&nbsp;<span class="op" id="1393933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393937">err</span>&nbsp;<span class="op" id="1393941">=</span>&nbsp;<span class="ident" id="1393943">ErrClosedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393958">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393961">p</span><span class="op" id="1393962">.</span><span class="ident" id="1393963">l</span><span class="op" id="1393964">.</span><span class="ident" id="1393965">Lock</span><span class="op" id="1393969">(</span><span class="op" id="1393970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393973">defer</span>&nbsp;<span class="ident" id="1393979">p</span><span class="op" id="1393980">.</span><span class="ident" id="1393981">l</span><span class="op" id="1393982">.</span><span class="ident" id="1393983">Unlock</span><span class="op" id="1393989">(</span><span class="op" id="1393990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393993">p</span><span class="op" id="1393994">.</span><span class="ident" id="1393995">rerr</span>&nbsp;<span class="op" id="1394000">=</span>&nbsp;<span class="ident" id="1394002">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394007">p</span><span class="op" id="1394008">.</span><span class="ident" id="1394009">rwait</span><span class="op" id="1394014">.</span><span class="ident" id="1394015">Signal</span><span class="op" id="1394021">(</span><span class="op" id="1394022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394025">p</span><span class="op" id="1394026">.</span><span class="ident" id="1394027">wwait</span><span class="op" id="1394032">.</span><span class="ident" id="1394033">Signal</span><span class="op" id="1394039">(</span><span class="op" id="1394040">)</span><br>
<span class="lineno">110</span><span class="op" id="1394042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1394045">func</span>&nbsp;<span class="op" id="1394050">(</span><span class="ident" id="1394051">p</span>&nbsp;<span class="op" id="1394053">*</span><span class="ident" id="1394054">pipe</span><span class="op" id="1394058">)</span>&nbsp;<span class="ident" id="1394060">wclose</span><span class="op" id="1394066">(</span><span class="ident" id="1394067">err</span>&nbsp;<span class="builtintype" id="1394071">error</span><span class="op" id="1394076">)</span>&nbsp;<span class="op" id="1394078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394081">if</span>&nbsp;<span class="ident" id="1394084">err</span>&nbsp;<span class="op" id="1394088">==</span>&nbsp;<span class="ident" id="1394091">nil</span>&nbsp;<span class="op" id="1394095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394099">err</span>&nbsp;<span class="op" id="1394103">=</span>&nbsp;<span class="ident" id="1394105">EOF</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394113">p</span><span class="op" id="1394114">.</span><span class="ident" id="1394115">l</span><span class="op" id="1394116">.</span><span class="ident" id="1394117">Lock</span><span class="op" id="1394121">(</span><span class="op" id="1394122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394125">defer</span>&nbsp;<span class="ident" id="1394131">p</span><span class="op" id="1394132">.</span><span class="ident" id="1394133">l</span><span class="op" id="1394134">.</span><span class="ident" id="1394135">Unlock</span><span class="op" id="1394141">(</span><span class="op" id="1394142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394145">p</span><span class="op" id="1394146">.</span><span class="ident" id="1394147">werr</span>&nbsp;<span class="op" id="1394152">=</span>&nbsp;<span class="ident" id="1394154">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394159">p</span><span class="op" id="1394160">.</span><span class="ident" id="1394161">rwait</span><span class="op" id="1394166">.</span><span class="ident" id="1394167">Signal</span><span class="op" id="1394173">(</span><span class="op" id="1394174">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394177">p</span><span class="op" id="1394178">.</span><span class="ident" id="1394179">wwait</span><span class="op" id="1394184">.</span><span class="ident" id="1394185">Signal</span><span class="op" id="1394191">(</span><span class="op" id="1394192">)</span><br>
<span class="lineno"></span><span class="op" id="1394194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1394197">//&nbsp;A&nbsp;PipeReader&nbsp;is&nbsp;the&nbsp;read&nbsp;half&nbsp;of&nbsp;a&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1394241">type</span>&nbsp;<span class="ident" id="1394246">PipeReader</span>&nbsp;<span class="keyword" id="1394257">struct</span>&nbsp;<span class="op" id="1394264">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394267">p</span>&nbsp;<span class="op" id="1394269">*</span><span class="ident" id="1394270">pipe</span><br>
<span class="lineno"></span><span class="op" id="1394275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1394278">//&nbsp;Read&nbsp;implements&nbsp;the&nbsp;standard&nbsp;Read&nbsp;interface:</span><br>
<span class="lineno"></span><span class="comment" id="1394326">//&nbsp;it&nbsp;reads&nbsp;data&nbsp;from&nbsp;the&nbsp;pipe,&nbsp;blocking&nbsp;until&nbsp;a&nbsp;writer</span><br>
<span class="lineno">130</span><span class="comment" id="1394382">//&nbsp;arrives&nbsp;or&nbsp;the&nbsp;write&nbsp;end&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="1394421">//&nbsp;If&nbsp;the&nbsp;write&nbsp;end&nbsp;is&nbsp;closed&nbsp;with&nbsp;an&nbsp;error,&nbsp;that&nbsp;error&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1394480">//&nbsp;returned&nbsp;as&nbsp;err;&nbsp;otherwise&nbsp;err&nbsp;is&nbsp;EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1394522">func</span>&nbsp;<span class="op" id="1394527">(</span><span class="ident" id="1394528">r</span>&nbsp;<span class="op" id="1394530">*</span><span class="ident" id="1394531">PipeReader</span><span class="op" id="1394541">)</span>&nbsp;<span class="ident" id="1394543">Read</span><span class="op" id="1394547">(</span><span class="ident" id="1394548">data</span>&nbsp;<span class="op" id="1394553">[</span><span class="op" id="1394554">]</span><span class="builtintype" id="1394555">byte</span><span class="op" id="1394559">)</span>&nbsp;<span class="op" id="1394561">(</span><span class="ident" id="1394562">n</span>&nbsp;<span class="builtintype" id="1394564">int</span><span class="op" id="1394567">,</span>&nbsp;<span class="ident" id="1394569">err</span>&nbsp;<span class="builtintype" id="1394573">error</span><span class="op" id="1394578">)</span>&nbsp;<span class="op" id="1394580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394583">return</span>&nbsp;<span class="ident" id="1394590">r</span><span class="op" id="1394591">.</span><span class="ident" id="1394592">p</span><span class="op" id="1394593">.</span><span class="ident" id="1394594">read</span><span class="op" id="1394598">(</span><span class="ident" id="1394599">data</span><span class="op" id="1394603">)</span><br>
<span class="lineno">135</span><span class="op" id="1394605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1394608">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;reader;&nbsp;subsequent&nbsp;writes&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1394661">//&nbsp;write&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;the&nbsp;error&nbsp;ErrClosedPipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1394724">func</span>&nbsp;<span class="op" id="1394729">(</span><span class="ident" id="1394730">r</span>&nbsp;<span class="op" id="1394732">*</span><span class="ident" id="1394733">PipeReader</span><span class="op" id="1394743">)</span>&nbsp;<span class="ident" id="1394745">Close</span><span class="op" id="1394750">(</span><span class="op" id="1394751">)</span>&nbsp;<span class="builtintype" id="1394753">error</span>&nbsp;<span class="op" id="1394759">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394762">return</span>&nbsp;<span class="ident" id="1394769">r</span><span class="op" id="1394770">.</span><span class="ident" id="1394771">CloseWithError</span><span class="op" id="1394785">(</span><span class="ident" id="1394786">nil</span><span class="op" id="1394789">)</span><br>
<span class="lineno"></span><span class="op" id="1394791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1394794">//&nbsp;CloseWithError&nbsp;closes&nbsp;the&nbsp;reader;&nbsp;subsequent&nbsp;writes</span><br>
<span class="lineno"></span><span class="comment" id="1394849">//&nbsp;to&nbsp;the&nbsp;write&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;the&nbsp;error&nbsp;err.</span><br>
<span class="lineno">145</span><span class="keyword" id="1394909">func</span>&nbsp;<span class="op" id="1394914">(</span><span class="ident" id="1394915">r</span>&nbsp;<span class="op" id="1394917">*</span><span class="ident" id="1394918">PipeReader</span><span class="op" id="1394928">)</span>&nbsp;<span class="ident" id="1394930">CloseWithError</span><span class="op" id="1394944">(</span><span class="ident" id="1394945">err</span>&nbsp;<span class="builtintype" id="1394949">error</span><span class="op" id="1394954">)</span>&nbsp;<span class="builtintype" id="1394956">error</span>&nbsp;<span class="op" id="1394962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394965">r</span><span class="op" id="1394966">.</span><span class="ident" id="1394967">p</span><span class="op" id="1394968">.</span><span class="ident" id="1394969">rclose</span><span class="op" id="1394975">(</span><span class="ident" id="1394976">err</span><span class="op" id="1394979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394982">return</span>&nbsp;<span class="ident" id="1394989">nil</span><br>
<span class="lineno"></span><span class="op" id="1394993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="1394996">//&nbsp;A&nbsp;PipeWriter&nbsp;is&nbsp;the&nbsp;write&nbsp;half&nbsp;of&nbsp;a&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1395041">type</span>&nbsp;<span class="ident" id="1395046">PipeWriter</span>&nbsp;<span class="keyword" id="1395057">struct</span>&nbsp;<span class="op" id="1395064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1395067">p</span>&nbsp;<span class="op" id="1395069">*</span><span class="ident" id="1395070">pipe</span><br>
<span class="lineno"></span><span class="op" id="1395075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="1395078">//&nbsp;Write&nbsp;implements&nbsp;the&nbsp;standard&nbsp;Write&nbsp;interface:</span><br>
<span class="lineno"></span><span class="comment" id="1395128">//&nbsp;it&nbsp;writes&nbsp;data&nbsp;to&nbsp;the&nbsp;pipe,&nbsp;blocking&nbsp;until&nbsp;readers</span><br>
<span class="lineno"></span><span class="comment" id="1395182">//&nbsp;have&nbsp;consumed&nbsp;all&nbsp;the&nbsp;data&nbsp;or&nbsp;the&nbsp;read&nbsp;end&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="1395239">//&nbsp;If&nbsp;the&nbsp;read&nbsp;end&nbsp;is&nbsp;closed&nbsp;with&nbsp;an&nbsp;error,&nbsp;that&nbsp;err&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1395295">//&nbsp;returned&nbsp;as&nbsp;err;&nbsp;otherwise&nbsp;err&nbsp;is&nbsp;ErrClosedPipe.</span><br>
<span class="lineno">160</span><span class="keyword" id="1395347">func</span>&nbsp;<span class="op" id="1395352">(</span><span class="ident" id="1395353">w</span>&nbsp;<span class="op" id="1395355">*</span><span class="ident" id="1395356">PipeWriter</span><span class="op" id="1395366">)</span>&nbsp;<span class="ident" id="1395368">Write</span><span class="op" id="1395373">(</span><span class="ident" id="1395374">data</span>&nbsp;<span class="op" id="1395379">[</span><span class="op" id="1395380">]</span><span class="builtintype" id="1395381">byte</span><span class="op" id="1395385">)</span>&nbsp;<span class="op" id="1395387">(</span><span class="ident" id="1395388">n</span>&nbsp;<span class="builtintype" id="1395390">int</span><span class="op" id="1395393">,</span>&nbsp;<span class="ident" id="1395395">err</span>&nbsp;<span class="builtintype" id="1395399">error</span><span class="op" id="1395404">)</span>&nbsp;<span class="op" id="1395406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395409">return</span>&nbsp;<span class="ident" id="1395416">w</span><span class="op" id="1395417">.</span><span class="ident" id="1395418">p</span><span class="op" id="1395419">.</span><span class="ident" id="1395420">write</span><span class="op" id="1395425">(</span><span class="ident" id="1395426">data</span><span class="op" id="1395430">)</span><br>
<span class="lineno"></span><span class="op" id="1395432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1395435">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;writer;&nbsp;subsequent&nbsp;reads&nbsp;from&nbsp;the</span><br>
<span class="lineno">165</span><span class="comment" id="1395489">//&nbsp;read&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;no&nbsp;bytes&nbsp;and&nbsp;EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1395544">func</span>&nbsp;<span class="op" id="1395549">(</span><span class="ident" id="1395550">w</span>&nbsp;<span class="op" id="1395552">*</span><span class="ident" id="1395553">PipeWriter</span><span class="op" id="1395563">)</span>&nbsp;<span class="ident" id="1395565">Close</span><span class="op" id="1395570">(</span><span class="op" id="1395571">)</span>&nbsp;<span class="builtintype" id="1395573">error</span>&nbsp;<span class="op" id="1395579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395582">return</span>&nbsp;<span class="ident" id="1395589">w</span><span class="op" id="1395590">.</span><span class="ident" id="1395591">CloseWithError</span><span class="op" id="1395605">(</span><span class="ident" id="1395606">nil</span><span class="op" id="1395609">)</span><br>
<span class="lineno"></span><span class="op" id="1395611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="1395614">//&nbsp;CloseWithError&nbsp;closes&nbsp;the&nbsp;writer;&nbsp;subsequent&nbsp;reads&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1395677">//&nbsp;read&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;no&nbsp;bytes&nbsp;and&nbsp;the&nbsp;error&nbsp;err.</span><br>
<span class="lineno"></span><span class="keyword" id="1395742">func</span>&nbsp;<span class="op" id="1395747">(</span><span class="ident" id="1395748">w</span>&nbsp;<span class="op" id="1395750">*</span><span class="ident" id="1395751">PipeWriter</span><span class="op" id="1395761">)</span>&nbsp;<span class="ident" id="1395763">CloseWithError</span><span class="op" id="1395777">(</span><span class="ident" id="1395778">err</span>&nbsp;<span class="builtintype" id="1395782">error</span><span class="op" id="1395787">)</span>&nbsp;<span class="builtintype" id="1395789">error</span>&nbsp;<span class="op" id="1395795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1395798">w</span><span class="op" id="1395799">.</span><span class="ident" id="1395800">p</span><span class="op" id="1395801">.</span><span class="ident" id="1395802">wclose</span><span class="op" id="1395808">(</span><span class="ident" id="1395809">err</span><span class="op" id="1395812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395815">return</span>&nbsp;<span class="ident" id="1395822">nil</span><br>
<span class="lineno">175</span><span class="op" id="1395826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1395829">//&nbsp;Pipe&nbsp;creates&nbsp;a&nbsp;synchronous&nbsp;in-memory&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="comment" id="1395875">//&nbsp;It&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;connect&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Reader</span><br>
<span class="lineno"></span><span class="comment" id="1395932">//&nbsp;with&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno">180</span><span class="comment" id="1395969">//&nbsp;Reads&nbsp;on&nbsp;one&nbsp;end&nbsp;are&nbsp;matched&nbsp;with&nbsp;writes&nbsp;on&nbsp;the&nbsp;other,</span><br>
<span class="lineno"></span><span class="comment" id="1396027">//&nbsp;copying&nbsp;data&nbsp;directly&nbsp;between&nbsp;the&nbsp;two;&nbsp;there&nbsp;is&nbsp;no&nbsp;internal&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="comment" id="1396101">//&nbsp;It&nbsp;is&nbsp;safe&nbsp;to&nbsp;call&nbsp;Read&nbsp;and&nbsp;Write&nbsp;in&nbsp;parallel&nbsp;with&nbsp;each&nbsp;other&nbsp;or&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="1396174">//&nbsp;Close.&nbsp;Close&nbsp;will&nbsp;complete&nbsp;once&nbsp;pending&nbsp;I/O&nbsp;is&nbsp;done.&nbsp;Parallel&nbsp;calls&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1396248">//&nbsp;Read,&nbsp;and&nbsp;parallel&nbsp;calls&nbsp;to&nbsp;Write,&nbsp;are&nbsp;also&nbsp;safe:</span><br>
<span class="lineno">185</span><span class="comment" id="1396301">//&nbsp;the&nbsp;individual&nbsp;calls&nbsp;will&nbsp;be&nbsp;gated&nbsp;sequentially.</span><br>
<span class="lineno"></span><span class="keyword" id="1396353">func</span>&nbsp;<span class="ident" id="1396358">Pipe</span><span class="op" id="1396362">(</span><span class="op" id="1396363">)</span>&nbsp;<span class="op" id="1396365">(</span><span class="op" id="1396366">*</span><span class="ident" id="1396367">PipeReader</span><span class="op" id="1396377">,</span>&nbsp;<span class="op" id="1396379">*</span><span class="ident" id="1396380">PipeWriter</span><span class="op" id="1396390">)</span>&nbsp;<span class="op" id="1396392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1396395">p</span>&nbsp;<span class="op" id="1396397">:=</span>&nbsp;<span class="builtinfunc" id="1396400">new</span><span class="op" id="1396403">(</span><span class="ident" id="1396404">pipe</span><span class="op" id="1396408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1396411">p</span><span class="op" id="1396412">.</span><span class="ident" id="1396413">rwait</span><span class="op" id="1396418">.</span><span class="ident" id="1396419">L</span>&nbsp;<span class="op" id="1396421">=</span>&nbsp;<span class="op" id="1396423">&amp;</span><span class="ident" id="1396424">p</span><span class="op" id="1396425">.</span><span class="ident" id="1396426">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1396429">p</span><span class="op" id="1396430">.</span><span class="ident" id="1396431">wwait</span><span class="op" id="1396436">.</span><span class="ident" id="1396437">L</span>&nbsp;<span class="op" id="1396439">=</span>&nbsp;<span class="op" id="1396441">&amp;</span><span class="ident" id="1396442">p</span><span class="op" id="1396443">.</span><span class="ident" id="1396444">l</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1396447">r</span>&nbsp;<span class="op" id="1396449">:=</span>&nbsp;<span class="op" id="1396452">&amp;</span><span class="ident" id="1396453">PipeReader</span><span class="op" id="1396463">{</span><span class="ident" id="1396464">p</span><span class="op" id="1396465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1396468">w</span>&nbsp;<span class="op" id="1396470">:=</span>&nbsp;<span class="op" id="1396473">&amp;</span><span class="ident" id="1396474">PipeWriter</span><span class="op" id="1396484">{</span><span class="ident" id="1396485">p</span><span class="op" id="1396486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396489">return</span>&nbsp;<span class="ident" id="1396496">r</span><span class="op" id="1396497">,</span>&nbsp;<span class="ident" id="1396499">w</span><br>
<span class="lineno"></span><span class="op" id="1396501">}</span>
</div>
</body>
</html>
