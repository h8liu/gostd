<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html" class="current">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4692821">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4692876">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4692930">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4692981">package</span>&nbsp;<span class="ident" id="4692989">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4692996">import</span>&nbsp;<span class="op" id="4693003">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4693006">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4693014">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4693021">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4693024">type</span>&nbsp;<span class="ident" id="4693029">huffmanEncoder</span>&nbsp;<span class="keyword" id="4693044">struct</span>&nbsp;<span class="op" id="4693051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4693054">codeBits</span>&nbsp;<span class="op" id="4693063">[</span><span class="op" id="4693064">]</span><span class="builtintype" id="4693065">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4693072">code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4693081">[</span><span class="op" id="4693082">]</span><span class="builtintype" id="4693083">uint16</span><br>
<span class="lineno">15</span><span class="op" id="4693090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4693093">type</span>&nbsp;<span class="ident" id="4693098">literalNode</span>&nbsp;<span class="keyword" id="4693110">struct</span>&nbsp;<span class="op" id="4693117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4693120">literal</span>&nbsp;<span class="builtintype" id="4693128">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4693136">freq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4693144">int32</span><br>
<span class="lineno">20</span><span class="op" id="4693150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4693153">//&nbsp;A&nbsp;levelInfo&nbsp;describes&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;constructed&nbsp;tree&nbsp;for&nbsp;a&nbsp;given&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="4693231">type</span>&nbsp;<span class="ident" id="4693236">levelInfo</span>&nbsp;<span class="keyword" id="4693246">struct</span>&nbsp;<span class="op" id="4693253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4693256">//&nbsp;Our&nbsp;level.&nbsp;&nbsp;for&nbsp;better&nbsp;printing</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4693292">level</span>&nbsp;<span class="builtintype" id="4693298">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4693306">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;last&nbsp;node&nbsp;at&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4693355">lastFreq</span>&nbsp;<span class="builtintype" id="4693364">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4693372">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;character&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4693433">nextCharFreq</span>&nbsp;<span class="builtintype" id="4693446">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4693454">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;pair&nbsp;(from&nbsp;level&nbsp;below)&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4693530">//&nbsp;Only&nbsp;valid&nbsp;if&nbsp;the&nbsp;&#34;needed&#34;&nbsp;value&nbsp;of&nbsp;the&nbsp;next&nbsp;lower&nbsp;level&nbsp;is&nbsp;0.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4693597">nextPairFreq</span>&nbsp;<span class="builtintype" id="4693610">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4693618">//&nbsp;The&nbsp;number&nbsp;of&nbsp;chains&nbsp;remaining&nbsp;to&nbsp;generate&nbsp;for&nbsp;this&nbsp;level&nbsp;before&nbsp;moving</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4693694">//&nbsp;up&nbsp;to&nbsp;the&nbsp;next&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4693719">needed</span>&nbsp;<span class="builtintype" id="4693726">int32</span><br>
<span class="lineno">40</span><span class="op" id="4693732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4693735">func</span>&nbsp;<span class="ident" id="4693740">maxNode</span><span class="op" id="4693747">(</span><span class="op" id="4693748">)</span>&nbsp;<span class="ident" id="4693750">literalNode</span>&nbsp;<span class="op" id="4693762">{</span>&nbsp;<span class="keyword" id="4693764">return</span>&nbsp;<span class="ident" id="4693771">literalNode</span><span class="op" id="4693782">{</span><span class="ident" id="4693783">math</span><span class="op" id="4693787">.</span><span class="ident" id="4693788">MaxUint16</span><span class="op" id="4693797">,</span>&nbsp;<span class="ident" id="4693799">math</span><span class="op" id="4693803">.</span><span class="ident" id="4693804">MaxInt32</span><span class="op" id="4693812">}</span>&nbsp;<span class="op" id="4693814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4693817">func</span>&nbsp;<span class="ident" id="4693822">newHuffmanEncoder</span><span class="op" id="4693839">(</span><span class="ident" id="4693840">size</span>&nbsp;<span class="builtintype" id="4693845">int</span><span class="op" id="4693848">)</span>&nbsp;<span class="op" id="4693850">*</span><span class="ident" id="4693851">huffmanEncoder</span>&nbsp;<span class="op" id="4693866">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4693869">return</span>&nbsp;<span class="op" id="4693876">&amp;</span><span class="ident" id="4693877">huffmanEncoder</span><span class="op" id="4693891">{</span><span class="builtinfunc" id="4693892">make</span><span class="op" id="4693896">(</span><span class="op" id="4693897">[</span><span class="op" id="4693898">]</span><span class="builtintype" id="4693899">uint8</span><span class="op" id="4693904">,</span>&nbsp;<span class="ident" id="4693906">size</span><span class="op" id="4693910">)</span><span class="op" id="4693911">,</span>&nbsp;<span class="builtinfunc" id="4693913">make</span><span class="op" id="4693917">(</span><span class="op" id="4693918">[</span><span class="op" id="4693919">]</span><span class="builtintype" id="4693920">uint16</span><span class="op" id="4693926">,</span>&nbsp;<span class="ident" id="4693928">size</span><span class="op" id="4693932">)</span><span class="op" id="4693933">}</span><br>
<span class="lineno"></span><span class="op" id="4693935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4693938">//&nbsp;Generates&nbsp;a&nbsp;HuffmanCode&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;fixed&nbsp;literal&nbsp;table</span><br>
<span class="lineno"></span><span class="keyword" id="4694006">func</span>&nbsp;<span class="ident" id="4694011">generateFixedLiteralEncoding</span><span class="op" id="4694039">(</span><span class="op" id="4694040">)</span>&nbsp;<span class="op" id="4694042">*</span><span class="ident" id="4694043">huffmanEncoder</span>&nbsp;<span class="op" id="4694058">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4694061">h</span>&nbsp;<span class="op" id="4694063">:=</span>&nbsp;<span class="ident" id="4694066">newHuffmanEncoder</span><span class="op" id="4694083">(</span><span class="ident" id="4694084">maxLit</span><span class="op" id="4694090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4694093">codeBits</span>&nbsp;<span class="op" id="4694102">:=</span>&nbsp;<span class="ident" id="4694105">h</span><span class="op" id="4694106">.</span><span class="ident" id="4694107">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4694117">code</span>&nbsp;<span class="op" id="4694122">:=</span>&nbsp;<span class="ident" id="4694125">h</span><span class="op" id="4694126">.</span><span class="ident" id="4694127">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4694133">var</span>&nbsp;<span class="ident" id="4694137">ch</span>&nbsp;<span class="builtintype" id="4694140">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4694148">for</span>&nbsp;<span class="ident" id="4694152">ch</span>&nbsp;<span class="op" id="4694155">=</span>&nbsp;<span class="num" id="4694157">0</span><span class="op" id="4694158">;</span>&nbsp;<span class="ident" id="4694160">ch</span>&nbsp;<span class="op" id="4694163">&lt;</span>&nbsp;<span class="ident" id="4694165">maxLit</span><span class="op" id="4694171">;</span>&nbsp;<span class="ident" id="4694173">ch</span><span class="op" id="4694175">++</span>&nbsp;<span class="op" id="4694178">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4694182">var</span>&nbsp;<span class="ident" id="4694186">bits</span>&nbsp;<span class="builtintype" id="4694191">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4694200">var</span>&nbsp;<span class="ident" id="4694204">size</span>&nbsp;<span class="builtintype" id="4694209">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4694217">switch</span>&nbsp;<span class="op" id="4694224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4694228">case</span>&nbsp;<span class="ident" id="4694233">ch</span>&nbsp;<span class="op" id="4694236">&lt;</span>&nbsp;<span class="num" id="4694238">144</span><span class="op" id="4694241">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4694246">//&nbsp;size&nbsp;8,&nbsp;000110000&nbsp;&nbsp;..&nbsp;10111111</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4694283">bits</span>&nbsp;<span class="op" id="4694288">=</span>&nbsp;<span class="ident" id="4694290">ch</span>&nbsp;<span class="op" id="4694293">+</span>&nbsp;<span class="num" id="4694295">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4694301">size</span>&nbsp;<span class="op" id="4694306">=</span>&nbsp;<span class="num" id="4694308">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4694313">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4694321">case</span>&nbsp;<span class="ident" id="4694326">ch</span>&nbsp;<span class="op" id="4694329">&lt;</span>&nbsp;<span class="num" id="4694331">256</span><span class="op" id="4694334">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4694339">//&nbsp;size&nbsp;9,&nbsp;110010000&nbsp;..&nbsp;111111111</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4694376">bits</span>&nbsp;<span class="op" id="4694381">=</span>&nbsp;<span class="ident" id="4694383">ch</span>&nbsp;<span class="op" id="4694386">+</span>&nbsp;<span class="num" id="4694388">400</span>&nbsp;<span class="op" id="4694392">-</span>&nbsp;<span class="num" id="4694394">144</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4694401">size</span>&nbsp;<span class="op" id="4694406">=</span>&nbsp;<span class="num" id="4694408">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4694413">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4694421">case</span>&nbsp;<span class="ident" id="4694426">ch</span>&nbsp;<span class="op" id="4694429">&lt;</span>&nbsp;<span class="num" id="4694431">280</span><span class="op" id="4694434">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4694439">//&nbsp;size&nbsp;7,&nbsp;0000000&nbsp;..&nbsp;0010111</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4694472">bits</span>&nbsp;<span class="op" id="4694477">=</span>&nbsp;<span class="ident" id="4694479">ch</span>&nbsp;<span class="op" id="4694482">-</span>&nbsp;<span class="num" id="4694484">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4694491">size</span>&nbsp;<span class="op" id="4694496">=</span>&nbsp;<span class="num" id="4694498">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4694503">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4694511">default</span><span class="op" id="4694518">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4694523">//&nbsp;size&nbsp;8,&nbsp;11000000&nbsp;..&nbsp;11000111</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4694558">bits</span>&nbsp;<span class="op" id="4694563">=</span>&nbsp;<span class="ident" id="4694565">ch</span>&nbsp;<span class="op" id="4694568">+</span>&nbsp;<span class="num" id="4694570">192</span>&nbsp;<span class="op" id="4694574">-</span>&nbsp;<span class="num" id="4694576">280</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4694583">size</span>&nbsp;<span class="op" id="4694588">=</span>&nbsp;<span class="num" id="4694590">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4694594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4694598">codeBits</span><span class="op" id="4694606">[</span><span class="ident" id="4694607">ch</span><span class="op" id="4694609">]</span>&nbsp;<span class="op" id="4694611">=</span>&nbsp;<span class="ident" id="4694613">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4694620">code</span><span class="op" id="4694624">[</span><span class="ident" id="4694625">ch</span><span class="op" id="4694627">]</span>&nbsp;<span class="op" id="4694629">=</span>&nbsp;<span class="ident" id="4694631">reverseBits</span><span class="op" id="4694642">(</span><span class="ident" id="4694643">bits</span><span class="op" id="4694647">,</span>&nbsp;<span class="ident" id="4694649">size</span><span class="op" id="4694653">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4694656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4694659">return</span>&nbsp;<span class="ident" id="4694666">h</span><br>
<span class="lineno"></span><span class="op" id="4694668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4694671">func</span>&nbsp;<span class="ident" id="4694676">generateFixedOffsetEncoding</span><span class="op" id="4694703">(</span><span class="op" id="4694704">)</span>&nbsp;<span class="op" id="4694706">*</span><span class="ident" id="4694707">huffmanEncoder</span>&nbsp;<span class="op" id="4694722">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4694725">h</span>&nbsp;<span class="op" id="4694727">:=</span>&nbsp;<span class="ident" id="4694730">newHuffmanEncoder</span><span class="op" id="4694747">(</span><span class="num" id="4694748">30</span><span class="op" id="4694750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4694753">codeBits</span>&nbsp;<span class="op" id="4694762">:=</span>&nbsp;<span class="ident" id="4694765">h</span><span class="op" id="4694766">.</span><span class="ident" id="4694767">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4694777">code</span>&nbsp;<span class="op" id="4694782">:=</span>&nbsp;<span class="ident" id="4694785">h</span><span class="op" id="4694786">.</span><span class="ident" id="4694787">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4694793">for</span>&nbsp;<span class="ident" id="4694797">ch</span>&nbsp;<span class="op" id="4694800">:=</span>&nbsp;<span class="builtintype" id="4694803">uint16</span><span class="op" id="4694809">(</span><span class="num" id="4694810">0</span><span class="op" id="4694811">)</span><span class="op" id="4694812">;</span>&nbsp;<span class="ident" id="4694814">ch</span>&nbsp;<span class="op" id="4694817">&lt;</span>&nbsp;<span class="num" id="4694819">30</span><span class="op" id="4694821">;</span>&nbsp;<span class="ident" id="4694823">ch</span><span class="op" id="4694825">++</span>&nbsp;<span class="op" id="4694828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4694832">codeBits</span><span class="op" id="4694840">[</span><span class="ident" id="4694841">ch</span><span class="op" id="4694843">]</span>&nbsp;<span class="op" id="4694845">=</span>&nbsp;<span class="num" id="4694847">5</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4694851">code</span><span class="op" id="4694855">[</span><span class="ident" id="4694856">ch</span><span class="op" id="4694858">]</span>&nbsp;<span class="op" id="4694860">=</span>&nbsp;<span class="ident" id="4694862">reverseBits</span><span class="op" id="4694873">(</span><span class="ident" id="4694874">ch</span><span class="op" id="4694876">,</span>&nbsp;<span class="num" id="4694878">5</span><span class="op" id="4694879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4694882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4694885">return</span>&nbsp;<span class="ident" id="4694892">h</span><br>
<span class="lineno"></span><span class="op" id="4694894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4694897">var</span>&nbsp;<span class="ident" id="4694901">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4694922">*</span><span class="ident" id="4694923">huffmanEncoder</span>&nbsp;<span class="op" id="4694938">=</span>&nbsp;<span class="ident" id="4694940">generateFixedLiteralEncoding</span><span class="op" id="4694968">(</span><span class="op" id="4694969">)</span><br>
<span class="lineno"></span><span class="keyword" id="4694971">var</span>&nbsp;<span class="ident" id="4694975">fixedOffsetEncoding</span>&nbsp;<span class="op" id="4694995">*</span><span class="ident" id="4694996">huffmanEncoder</span>&nbsp;<span class="op" id="4695011">=</span>&nbsp;<span class="ident" id="4695013">generateFixedOffsetEncoding</span><span class="op" id="4695040">(</span><span class="op" id="4695041">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4695044">func</span>&nbsp;<span class="op" id="4695049">(</span><span class="ident" id="4695050">h</span>&nbsp;<span class="op" id="4695052">*</span><span class="ident" id="4695053">huffmanEncoder</span><span class="op" id="4695067">)</span>&nbsp;<span class="ident" id="4695069">bitLength</span><span class="op" id="4695078">(</span><span class="ident" id="4695079">freq</span>&nbsp;<span class="op" id="4695084">[</span><span class="op" id="4695085">]</span><span class="builtintype" id="4695086">int32</span><span class="op" id="4695091">)</span>&nbsp;<span class="builtintype" id="4695093">int64</span>&nbsp;<span class="op" id="4695099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4695102">var</span>&nbsp;<span class="ident" id="4695106">total</span>&nbsp;<span class="builtintype" id="4695112">int64</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4695119">for</span>&nbsp;<span class="ident" id="4695123">i</span><span class="op" id="4695124">,</span>&nbsp;<span class="ident" id="4695126">f</span>&nbsp;<span class="op" id="4695128">:=</span>&nbsp;<span class="keyword" id="4695131">range</span>&nbsp;<span class="ident" id="4695137">freq</span>&nbsp;<span class="op" id="4695142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4695146">if</span>&nbsp;<span class="ident" id="4695149">f</span>&nbsp;<span class="op" id="4695151">!=</span>&nbsp;<span class="num" id="4695154">0</span>&nbsp;<span class="op" id="4695156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4695161">total</span>&nbsp;<span class="op" id="4695167">+=</span>&nbsp;<span class="builtintype" id="4695170">int64</span><span class="op" id="4695175">(</span><span class="ident" id="4695176">f</span><span class="op" id="4695177">)</span>&nbsp;<span class="op" id="4695179">*</span>&nbsp;<span class="builtintype" id="4695181">int64</span><span class="op" id="4695186">(</span><span class="ident" id="4695187">h</span><span class="op" id="4695188">.</span><span class="ident" id="4695189">codeBits</span><span class="op" id="4695197">[</span><span class="ident" id="4695198">i</span><span class="op" id="4695199">]</span><span class="op" id="4695200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4695204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4695207">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4695210">return</span>&nbsp;<span class="ident" id="4695217">total</span><br>
<span class="lineno"></span><span class="op" id="4695223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4695226">const</span>&nbsp;<span class="ident" id="4695232">maxBitsLimit</span>&nbsp;<span class="op" id="4695245">=</span>&nbsp;<span class="num" id="4695247">16</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="4695251">//&nbsp;Return&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;assigned&nbsp;to&nbsp;each&nbsp;bit&nbsp;size&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="4695334">//</span><br>
<span class="lineno"></span><span class="comment" id="4695337">//&nbsp;This&nbsp;method&nbsp;is&nbsp;only&nbsp;called&nbsp;when&nbsp;list.length&nbsp;&gt;=&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="4695389">//&nbsp;The&nbsp;cases&nbsp;of&nbsp;0,&nbsp;1,&nbsp;and&nbsp;2&nbsp;literals&nbsp;are&nbsp;handled&nbsp;by&nbsp;special&nbsp;case&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4695460">//</span><br>
<span class="lineno">115</span><span class="comment" id="4695463">//&nbsp;list&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;the&nbsp;literals&nbsp;with&nbsp;non-zero&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4695523">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;their&nbsp;associated&nbsp;frequencies.&nbsp;&nbsp;The&nbsp;array&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing</span><br>
<span class="lineno"></span><span class="comment" id="4695609">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frequency,&nbsp;and&nbsp;has&nbsp;as&nbsp;its&nbsp;last&nbsp;element&nbsp;a&nbsp;special&nbsp;element&nbsp;with&nbsp;frequency</span><br>
<span class="lineno"></span><span class="comment" id="4695696">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MaxInt32</span><br>
<span class="lineno"></span><span class="comment" id="4695720">//&nbsp;maxBits&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;that&nbsp;should&nbsp;be&nbsp;used&nbsp;to&nbsp;encode&nbsp;any&nbsp;literal.</span><br>
<span class="lineno">120</span><span class="comment" id="4695805">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Must&nbsp;be&nbsp;less&nbsp;than&nbsp;16.</span><br>
<span class="lineno"></span><span class="comment" id="4695842">//&nbsp;return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;An&nbsp;integer&nbsp;array&nbsp;in&nbsp;which&nbsp;array[i]&nbsp;indicates&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span><span class="comment" id="4695925">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;should&nbsp;be&nbsp;encoded&nbsp;in&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4695974">func</span>&nbsp;<span class="op" id="4695979">(</span><span class="ident" id="4695980">h</span>&nbsp;<span class="op" id="4695982">*</span><span class="ident" id="4695983">huffmanEncoder</span><span class="op" id="4695997">)</span>&nbsp;<span class="ident" id="4695999">bitCounts</span><span class="op" id="4696008">(</span><span class="ident" id="4696009">list</span>&nbsp;<span class="op" id="4696014">[</span><span class="op" id="4696015">]</span><span class="ident" id="4696016">literalNode</span><span class="op" id="4696027">,</span>&nbsp;<span class="ident" id="4696029">maxBits</span>&nbsp;<span class="builtintype" id="4696037">int32</span><span class="op" id="4696042">)</span>&nbsp;<span class="op" id="4696044">[</span><span class="op" id="4696045">]</span><span class="builtintype" id="4696046">int32</span>&nbsp;<span class="op" id="4696052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4696055">if</span>&nbsp;<span class="ident" id="4696058">maxBits</span>&nbsp;<span class="op" id="4696066">&gt;=</span>&nbsp;<span class="ident" id="4696069">maxBitsLimit</span>&nbsp;<span class="op" id="4696082">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4696086">panic</span><span class="op" id="4696091">(</span><span class="string" id="4696092">&#34;flate:&nbsp;maxBits&nbsp;too&nbsp;large&#34;</span><span class="op" id="4696118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4696121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4696124">n</span>&nbsp;<span class="op" id="4696126">:=</span>&nbsp;<span class="builtintype" id="4696129">int32</span><span class="op" id="4696134">(</span><span class="builtinfunc" id="4696135">len</span><span class="op" id="4696138">(</span><span class="ident" id="4696139">list</span><span class="op" id="4696143">)</span><span class="op" id="4696144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4696147">list</span>&nbsp;<span class="op" id="4696152">=</span>&nbsp;<span class="ident" id="4696154">list</span><span class="op" id="4696158">[</span><span class="num" id="4696159">0</span>&nbsp;<span class="op" id="4696161">:</span>&nbsp;<span class="ident" id="4696163">n</span><span class="op" id="4696164">+</span><span class="num" id="4696165">1</span><span class="op" id="4696166">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4696169">list</span><span class="op" id="4696173">[</span><span class="ident" id="4696174">n</span><span class="op" id="4696175">]</span>&nbsp;<span class="op" id="4696177">=</span>&nbsp;<span class="ident" id="4696179">maxNode</span><span class="op" id="4696186">(</span><span class="op" id="4696187">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4696191">//&nbsp;The&nbsp;tree&nbsp;can&#39;t&nbsp;have&nbsp;greater&nbsp;depth&nbsp;than&nbsp;n&nbsp;-&nbsp;1,&nbsp;no&nbsp;matter&nbsp;what.&nbsp;&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4696263">//&nbsp;saves&nbsp;a&nbsp;little&nbsp;bit&nbsp;of&nbsp;work&nbsp;in&nbsp;some&nbsp;small&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4696314">if</span>&nbsp;<span class="ident" id="4696317">maxBits</span>&nbsp;<span class="op" id="4696325">&gt;</span>&nbsp;<span class="ident" id="4696327">n</span><span class="op" id="4696328">-</span><span class="num" id="4696329">1</span>&nbsp;<span class="op" id="4696331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4696335">maxBits</span>&nbsp;<span class="op" id="4696343">=</span>&nbsp;<span class="ident" id="4696345">n</span>&nbsp;<span class="op" id="4696347">-</span>&nbsp;<span class="num" id="4696349">1</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4696352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4696356">//&nbsp;Create&nbsp;information&nbsp;about&nbsp;each&nbsp;of&nbsp;the&nbsp;levels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4696405">//&nbsp;A&nbsp;bogus&nbsp;&#34;Level&nbsp;0&#34;&nbsp;whose&nbsp;sole&nbsp;purpose&nbsp;is&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4696457">//&nbsp;level1.prev.needed==0.&nbsp;&nbsp;This&nbsp;makes&nbsp;level1.nextPairFreq</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4696516">//&nbsp;be&nbsp;a&nbsp;legitimate&nbsp;value&nbsp;that&nbsp;never&nbsp;gets&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4696566">var</span>&nbsp;<span class="ident" id="4696570">levels</span>&nbsp;<span class="op" id="4696577">[</span><span class="ident" id="4696578">maxBitsLimit</span><span class="op" id="4696590">]</span><span class="ident" id="4696591">levelInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4696602">//&nbsp;leafCounts[i]&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4696662">//&nbsp;of&nbsp;ancestors&nbsp;of&nbsp;the&nbsp;rightmost&nbsp;node&nbsp;at&nbsp;level&nbsp;i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4696713">//&nbsp;leafCounts[i][j]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4696772">//&nbsp;of&nbsp;the&nbsp;level&nbsp;j&nbsp;ancestor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4696801">var</span>&nbsp;<span class="ident" id="4696805">leafCounts</span>&nbsp;<span class="op" id="4696816">[</span><span class="ident" id="4696817">maxBitsLimit</span><span class="op" id="4696829">]</span><span class="op" id="4696830">[</span><span class="ident" id="4696831">maxBitsLimit</span><span class="op" id="4696843">]</span><span class="builtintype" id="4696844">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4696852">for</span>&nbsp;<span class="ident" id="4696856">level</span>&nbsp;<span class="op" id="4696862">:=</span>&nbsp;<span class="builtintype" id="4696865">int32</span><span class="op" id="4696870">(</span><span class="num" id="4696871">1</span><span class="op" id="4696872">)</span><span class="op" id="4696873">;</span>&nbsp;<span class="ident" id="4696875">level</span>&nbsp;<span class="op" id="4696881">&lt;=</span>&nbsp;<span class="ident" id="4696884">maxBits</span><span class="op" id="4696891">;</span>&nbsp;<span class="ident" id="4696893">level</span><span class="op" id="4696898">++</span>&nbsp;<span class="op" id="4696901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4696905">//&nbsp;For&nbsp;every&nbsp;level,&nbsp;the&nbsp;first&nbsp;two&nbsp;items&nbsp;are&nbsp;the&nbsp;first&nbsp;two&nbsp;characters.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4696977">//&nbsp;We&nbsp;initialize&nbsp;the&nbsp;levels&nbsp;as&nbsp;if&nbsp;we&nbsp;had&nbsp;already&nbsp;figured&nbsp;this&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4697046">levels</span><span class="op" id="4697052">[</span><span class="ident" id="4697053">level</span><span class="op" id="4697058">]</span>&nbsp;<span class="op" id="4697060">=</span>&nbsp;<span class="ident" id="4697062">levelInfo</span><span class="op" id="4697071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4697076">level</span><span class="op" id="4697081">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4697090">level</span><span class="op" id="4697095">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4697100">lastFreq</span><span class="op" id="4697108">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4697114">list</span><span class="op" id="4697118">[</span><span class="num" id="4697119">1</span><span class="op" id="4697120">]</span><span class="op" id="4697121">.</span><span class="ident" id="4697122">freq</span><span class="op" id="4697126">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4697131">nextCharFreq</span><span class="op" id="4697143">:</span>&nbsp;<span class="ident" id="4697145">list</span><span class="op" id="4697149">[</span><span class="num" id="4697150">2</span><span class="op" id="4697151">]</span><span class="op" id="4697152">.</span><span class="ident" id="4697153">freq</span><span class="op" id="4697157">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4697162">nextPairFreq</span><span class="op" id="4697174">:</span>&nbsp;<span class="ident" id="4697176">list</span><span class="op" id="4697180">[</span><span class="num" id="4697181">0</span><span class="op" id="4697182">]</span><span class="op" id="4697183">.</span><span class="ident" id="4697184">freq</span>&nbsp;<span class="op" id="4697189">+</span>&nbsp;<span class="ident" id="4697191">list</span><span class="op" id="4697195">[</span><span class="num" id="4697196">1</span><span class="op" id="4697197">]</span><span class="op" id="4697198">.</span><span class="ident" id="4697199">freq</span><span class="op" id="4697203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4697207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4697211">leafCounts</span><span class="op" id="4697221">[</span><span class="ident" id="4697222">level</span><span class="op" id="4697227">]</span><span class="op" id="4697228">[</span><span class="ident" id="4697229">level</span><span class="op" id="4697234">]</span>&nbsp;<span class="op" id="4697236">=</span>&nbsp;<span class="num" id="4697238">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4697242">if</span>&nbsp;<span class="ident" id="4697245">level</span>&nbsp;<span class="op" id="4697251">==</span>&nbsp;<span class="num" id="4697254">1</span>&nbsp;<span class="op" id="4697256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4697261">levels</span><span class="op" id="4697267">[</span><span class="ident" id="4697268">level</span><span class="op" id="4697273">]</span><span class="op" id="4697274">.</span><span class="ident" id="4697275">nextPairFreq</span>&nbsp;<span class="op" id="4697288">=</span>&nbsp;<span class="ident" id="4697290">math</span><span class="op" id="4697294">.</span><span class="ident" id="4697295">MaxInt32</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4697306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4697309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4697313">//&nbsp;We&nbsp;need&nbsp;a&nbsp;total&nbsp;of&nbsp;2*n&nbsp;-&nbsp;2&nbsp;items&nbsp;at&nbsp;top&nbsp;level&nbsp;and&nbsp;have&nbsp;already&nbsp;generated&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4697393">levels</span><span class="op" id="4697399">[</span><span class="ident" id="4697400">maxBits</span><span class="op" id="4697407">]</span><span class="op" id="4697408">.</span><span class="ident" id="4697409">needed</span>&nbsp;<span class="op" id="4697416">=</span>&nbsp;<span class="num" id="4697418">2</span><span class="op" id="4697419">*</span><span class="ident" id="4697420">n</span>&nbsp;<span class="op" id="4697422">-</span>&nbsp;<span class="num" id="4697424">4</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4697428">level</span>&nbsp;<span class="op" id="4697434">:=</span>&nbsp;<span class="ident" id="4697437">maxBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4697446">for</span>&nbsp;<span class="op" id="4697450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4697454">l</span>&nbsp;<span class="op" id="4697456">:=</span>&nbsp;<span class="op" id="4697459">&amp;</span><span class="ident" id="4697460">levels</span><span class="op" id="4697466">[</span><span class="ident" id="4697467">level</span><span class="op" id="4697472">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4697476">if</span>&nbsp;<span class="ident" id="4697479">l</span><span class="op" id="4697480">.</span><span class="ident" id="4697481">nextPairFreq</span>&nbsp;<span class="op" id="4697494">==</span>&nbsp;<span class="ident" id="4697497">math</span><span class="op" id="4697501">.</span><span class="ident" id="4697502">MaxInt32</span>&nbsp;<span class="op" id="4697511">&amp;&amp;</span>&nbsp;<span class="ident" id="4697514">l</span><span class="op" id="4697515">.</span><span class="ident" id="4697516">nextCharFreq</span>&nbsp;<span class="op" id="4697529">==</span>&nbsp;<span class="ident" id="4697532">math</span><span class="op" id="4697536">.</span><span class="ident" id="4697537">MaxInt32</span>&nbsp;<span class="op" id="4697546">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4697551">//&nbsp;We&#39;ve&nbsp;run&nbsp;out&nbsp;of&nbsp;both&nbsp;leafs&nbsp;and&nbsp;pairs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4697596">//&nbsp;End&nbsp;all&nbsp;calculations&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4697639">//&nbsp;To&nbsp;make&nbsp;sure&nbsp;we&nbsp;never&nbsp;come&nbsp;back&nbsp;to&nbsp;this&nbsp;level&nbsp;or&nbsp;any&nbsp;lower&nbsp;level,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4697711">//&nbsp;set&nbsp;nextPairFreq&nbsp;impossibly&nbsp;large.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4697752">l</span><span class="op" id="4697753">.</span><span class="ident" id="4697754">needed</span>&nbsp;<span class="op" id="4697761">=</span>&nbsp;<span class="num" id="4697763">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4697768">levels</span><span class="op" id="4697774">[</span><span class="ident" id="4697775">level</span><span class="op" id="4697780">+</span><span class="num" id="4697781">1</span><span class="op" id="4697782">]</span><span class="op" id="4697783">.</span><span class="ident" id="4697784">nextPairFreq</span>&nbsp;<span class="op" id="4697797">=</span>&nbsp;<span class="ident" id="4697799">math</span><span class="op" id="4697803">.</span><span class="ident" id="4697804">MaxInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4697816">level</span><span class="op" id="4697821">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4697827">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4697838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4697843">prevFreq</span>&nbsp;<span class="op" id="4697852">:=</span>&nbsp;<span class="ident" id="4697855">l</span><span class="op" id="4697856">.</span><span class="ident" id="4697857">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4697868">if</span>&nbsp;<span class="ident" id="4697871">l</span><span class="op" id="4697872">.</span><span class="ident" id="4697873">nextCharFreq</span>&nbsp;<span class="op" id="4697886">&lt;</span>&nbsp;<span class="ident" id="4697888">l</span><span class="op" id="4697889">.</span><span class="ident" id="4697890">nextPairFreq</span>&nbsp;<span class="op" id="4697903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4697908">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;leaf&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4697956">n</span>&nbsp;<span class="op" id="4697958">:=</span>&nbsp;<span class="ident" id="4697961">leafCounts</span><span class="op" id="4697971">[</span><span class="ident" id="4697972">level</span><span class="op" id="4697977">]</span><span class="op" id="4697978">[</span><span class="ident" id="4697979">level</span><span class="op" id="4697984">]</span>&nbsp;<span class="op" id="4697986">+</span>&nbsp;<span class="num" id="4697988">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4697993">l</span><span class="op" id="4697994">.</span><span class="ident" id="4697995">lastFreq</span>&nbsp;<span class="op" id="4698004">=</span>&nbsp;<span class="ident" id="4698006">l</span><span class="op" id="4698007">.</span><span class="ident" id="4698008">nextCharFreq</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4698024">//&nbsp;Lower&nbsp;leafCounts&nbsp;are&nbsp;the&nbsp;same&nbsp;of&nbsp;the&nbsp;previous&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4698082">leafCounts</span><span class="op" id="4698092">[</span><span class="ident" id="4698093">level</span><span class="op" id="4698098">]</span><span class="op" id="4698099">[</span><span class="ident" id="4698100">level</span><span class="op" id="4698105">]</span>&nbsp;<span class="op" id="4698107">=</span>&nbsp;<span class="ident" id="4698109">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4698114">l</span><span class="op" id="4698115">.</span><span class="ident" id="4698116">nextCharFreq</span>&nbsp;<span class="op" id="4698129">=</span>&nbsp;<span class="ident" id="4698131">list</span><span class="op" id="4698135">[</span><span class="ident" id="4698136">n</span><span class="op" id="4698137">]</span><span class="op" id="4698138">.</span><span class="ident" id="4698139">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4698146">}</span>&nbsp;<span class="keyword" id="4698148">else</span>&nbsp;<span class="op" id="4698153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4698158">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;pair&nbsp;from&nbsp;the&nbsp;previous&nbsp;row.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4698223">//&nbsp;nextPairFreq&nbsp;isn&#39;t&nbsp;valid&nbsp;until&nbsp;we&nbsp;generate&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4698276">//&nbsp;more&nbsp;values&nbsp;in&nbsp;the&nbsp;level&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4698313">l</span><span class="op" id="4698314">.</span><span class="ident" id="4698315">lastFreq</span>&nbsp;<span class="op" id="4698324">=</span>&nbsp;<span class="ident" id="4698326">l</span><span class="op" id="4698327">.</span><span class="ident" id="4698328">nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4698344">//&nbsp;Take&nbsp;leaf&nbsp;counts&nbsp;from&nbsp;the&nbsp;lower&nbsp;level,&nbsp;except&nbsp;counts[level]&nbsp;remains&nbsp;the&nbsp;same.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4698428">copy</span><span class="op" id="4698432">(</span><span class="ident" id="4698433">leafCounts</span><span class="op" id="4698443">[</span><span class="ident" id="4698444">level</span><span class="op" id="4698449">]</span><span class="op" id="4698450">[</span><span class="op" id="4698451">:</span><span class="ident" id="4698452">level</span><span class="op" id="4698457">]</span><span class="op" id="4698458">,</span>&nbsp;<span class="ident" id="4698460">leafCounts</span><span class="op" id="4698470">[</span><span class="ident" id="4698471">level</span><span class="op" id="4698476">-</span><span class="num" id="4698477">1</span><span class="op" id="4698478">]</span><span class="op" id="4698479">[</span><span class="op" id="4698480">:</span><span class="ident" id="4698481">level</span><span class="op" id="4698486">]</span><span class="op" id="4698487">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4698492">levels</span><span class="op" id="4698498">[</span><span class="ident" id="4698499">l</span><span class="op" id="4698500">.</span><span class="ident" id="4698501">level</span><span class="op" id="4698506">-</span><span class="num" id="4698507">1</span><span class="op" id="4698508">]</span><span class="op" id="4698509">.</span><span class="ident" id="4698510">needed</span>&nbsp;<span class="op" id="4698517">=</span>&nbsp;<span class="num" id="4698519">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4698523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4698528">if</span>&nbsp;<span class="ident" id="4698531">l</span><span class="op" id="4698532">.</span><span class="ident" id="4698533">needed</span><span class="op" id="4698539">--</span><span class="op" id="4698541">;</span>&nbsp;<span class="ident" id="4698543">l</span><span class="op" id="4698544">.</span><span class="ident" id="4698545">needed</span>&nbsp;<span class="op" id="4698552">==</span>&nbsp;<span class="num" id="4698555">0</span>&nbsp;<span class="op" id="4698557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4698562">//&nbsp;We&#39;ve&nbsp;done&nbsp;everything&nbsp;we&nbsp;need&nbsp;to&nbsp;do&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4698620">//&nbsp;Continue&nbsp;calculating&nbsp;one&nbsp;level&nbsp;up.&nbsp;&nbsp;Fill&nbsp;in&nbsp;nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4698683">//&nbsp;of&nbsp;that&nbsp;level&nbsp;with&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;two&nbsp;nodes&nbsp;we&#39;ve&nbsp;just&nbsp;calculated&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4698758">//&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4698776">if</span>&nbsp;<span class="ident" id="4698779">l</span><span class="op" id="4698780">.</span><span class="ident" id="4698781">level</span>&nbsp;<span class="op" id="4698787">==</span>&nbsp;<span class="ident" id="4698790">maxBits</span>&nbsp;<span class="op" id="4698798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4698804">//&nbsp;All&nbsp;done!</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4698821">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4698830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4698835">levels</span><span class="op" id="4698841">[</span><span class="ident" id="4698842">l</span><span class="op" id="4698843">.</span><span class="ident" id="4698844">level</span><span class="op" id="4698849">+</span><span class="num" id="4698850">1</span><span class="op" id="4698851">]</span><span class="op" id="4698852">.</span><span class="ident" id="4698853">nextPairFreq</span>&nbsp;<span class="op" id="4698866">=</span>&nbsp;<span class="ident" id="4698868">prevFreq</span>&nbsp;<span class="op" id="4698877">+</span>&nbsp;<span class="ident" id="4698879">l</span><span class="op" id="4698880">.</span><span class="ident" id="4698881">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4698893">level</span><span class="op" id="4698898">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4698903">}</span>&nbsp;<span class="keyword" id="4698905">else</span>&nbsp;<span class="op" id="4698910">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4698915">//&nbsp;If&nbsp;we&nbsp;stole&nbsp;from&nbsp;below,&nbsp;move&nbsp;down&nbsp;temporarily&nbsp;to&nbsp;replenish&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4698984">for</span>&nbsp;<span class="ident" id="4698988">levels</span><span class="op" id="4698994">[</span><span class="ident" id="4698995">level</span><span class="op" id="4699000">-</span><span class="num" id="4699001">1</span><span class="op" id="4699002">]</span><span class="op" id="4699003">.</span><span class="ident" id="4699004">needed</span>&nbsp;<span class="op" id="4699011">&gt;</span>&nbsp;<span class="num" id="4699013">0</span>&nbsp;<span class="op" id="4699015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4699021">level</span><span class="op" id="4699026">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4699032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4699036">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4699039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4699043">//&nbsp;Somethings&nbsp;is&nbsp;wrong&nbsp;if&nbsp;at&nbsp;the&nbsp;end,&nbsp;the&nbsp;top&nbsp;level&nbsp;is&nbsp;null&nbsp;or&nbsp;hasn&#39;t&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4699119">//&nbsp;all&nbsp;of&nbsp;the&nbsp;leaves.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4699142">if</span>&nbsp;<span class="ident" id="4699145">leafCounts</span><span class="op" id="4699155">[</span><span class="ident" id="4699156">maxBits</span><span class="op" id="4699163">]</span><span class="op" id="4699164">[</span><span class="ident" id="4699165">maxBits</span><span class="op" id="4699172">]</span>&nbsp;<span class="op" id="4699174">!=</span>&nbsp;<span class="ident" id="4699177">n</span>&nbsp;<span class="op" id="4699179">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4699183">panic</span><span class="op" id="4699188">(</span><span class="string" id="4699189">&#34;leafCounts[maxBits][maxBits]&nbsp;!=&nbsp;n&#34;</span><span class="op" id="4699224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4699227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4699231">bitCount</span>&nbsp;<span class="op" id="4699240">:=</span>&nbsp;<span class="builtinfunc" id="4699243">make</span><span class="op" id="4699247">(</span><span class="op" id="4699248">[</span><span class="op" id="4699249">]</span><span class="builtintype" id="4699250">int32</span><span class="op" id="4699255">,</span>&nbsp;<span class="ident" id="4699257">maxBits</span><span class="op" id="4699264">+</span><span class="num" id="4699265">1</span><span class="op" id="4699266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4699269">bits</span>&nbsp;<span class="op" id="4699274">:=</span>&nbsp;<span class="num" id="4699277">1</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4699280">counts</span>&nbsp;<span class="op" id="4699287">:=</span>&nbsp;<span class="op" id="4699290">&amp;</span><span class="ident" id="4699291">leafCounts</span><span class="op" id="4699301">[</span><span class="ident" id="4699302">maxBits</span><span class="op" id="4699309">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4699312">for</span>&nbsp;<span class="ident" id="4699316">level</span>&nbsp;<span class="op" id="4699322">:=</span>&nbsp;<span class="ident" id="4699325">maxBits</span><span class="op" id="4699332">;</span>&nbsp;<span class="ident" id="4699334">level</span>&nbsp;<span class="op" id="4699340">&gt;</span>&nbsp;<span class="num" id="4699342">0</span><span class="op" id="4699343">;</span>&nbsp;<span class="ident" id="4699345">level</span><span class="op" id="4699350">--</span>&nbsp;<span class="op" id="4699353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4699357">//&nbsp;chain.leafCount&nbsp;gives&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;requiring&nbsp;at&nbsp;least&nbsp;&#34;bits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4699433">//&nbsp;bits&nbsp;to&nbsp;encode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4699454">bitCount</span><span class="op" id="4699462">[</span><span class="ident" id="4699463">bits</span><span class="op" id="4699467">]</span>&nbsp;<span class="op" id="4699469">=</span>&nbsp;<span class="ident" id="4699471">counts</span><span class="op" id="4699477">[</span><span class="ident" id="4699478">level</span><span class="op" id="4699483">]</span>&nbsp;<span class="op" id="4699485">-</span>&nbsp;<span class="ident" id="4699487">counts</span><span class="op" id="4699493">[</span><span class="ident" id="4699494">level</span><span class="op" id="4699499">-</span><span class="num" id="4699500">1</span><span class="op" id="4699501">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4699505">bits</span><span class="op" id="4699509">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4699513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4699516">return</span>&nbsp;<span class="ident" id="4699523">bitCount</span><br>
<span class="lineno"></span><span class="op" id="4699532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="4699535">//&nbsp;Look&nbsp;at&nbsp;the&nbsp;leaves&nbsp;and&nbsp;assign&nbsp;them&nbsp;a&nbsp;bit&nbsp;count&nbsp;and&nbsp;an&nbsp;encoding&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="4699614">//&nbsp;in&nbsp;RFC&nbsp;1951&nbsp;3.2.2</span><br>
<span class="lineno"></span><span class="keyword" id="4699635">func</span>&nbsp;<span class="op" id="4699640">(</span><span class="ident" id="4699641">h</span>&nbsp;<span class="op" id="4699643">*</span><span class="ident" id="4699644">huffmanEncoder</span><span class="op" id="4699658">)</span>&nbsp;<span class="ident" id="4699660">assignEncodingAndSize</span><span class="op" id="4699681">(</span><span class="ident" id="4699682">bitCount</span>&nbsp;<span class="op" id="4699691">[</span><span class="op" id="4699692">]</span><span class="builtintype" id="4699693">int32</span><span class="op" id="4699698">,</span>&nbsp;<span class="ident" id="4699700">list</span>&nbsp;<span class="op" id="4699705">[</span><span class="op" id="4699706">]</span><span class="ident" id="4699707">literalNode</span><span class="op" id="4699718">)</span>&nbsp;<span class="op" id="4699720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4699723">code</span>&nbsp;<span class="op" id="4699728">:=</span>&nbsp;<span class="builtintype" id="4699731">uint16</span><span class="op" id="4699737">(</span><span class="num" id="4699738">0</span><span class="op" id="4699739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4699742">for</span>&nbsp;<span class="ident" id="4699746">n</span><span class="op" id="4699747">,</span>&nbsp;<span class="ident" id="4699749">bits</span>&nbsp;<span class="op" id="4699754">:=</span>&nbsp;<span class="keyword" id="4699757">range</span>&nbsp;<span class="ident" id="4699763">bitCount</span>&nbsp;<span class="op" id="4699772">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4699776">code</span>&nbsp;<span class="op" id="4699781">&lt;&lt;=</span>&nbsp;<span class="num" id="4699785">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4699789">if</span>&nbsp;<span class="ident" id="4699792">n</span>&nbsp;<span class="op" id="4699794">==</span>&nbsp;<span class="num" id="4699797">0</span>&nbsp;<span class="op" id="4699799">||</span>&nbsp;<span class="ident" id="4699802">bits</span>&nbsp;<span class="op" id="4699807">==</span>&nbsp;<span class="num" id="4699810">0</span>&nbsp;<span class="op" id="4699812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4699817">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4699828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4699832">//&nbsp;The&nbsp;literals&nbsp;list[len(list)-bits]&nbsp;..&nbsp;list[len(list)-bits]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4699895">//&nbsp;are&nbsp;encoded&nbsp;using&nbsp;&#34;bits&#34;&nbsp;bits,&nbsp;and&nbsp;get&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4699950">//&nbsp;code,&nbsp;code&nbsp;+&nbsp;1,&nbsp;....&nbsp;&nbsp;The&nbsp;code&nbsp;values&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4699997">//&nbsp;assigned&nbsp;in&nbsp;literal&nbsp;order&nbsp;(not&nbsp;frequency&nbsp;order).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4700051">chunk</span>&nbsp;<span class="op" id="4700057">:=</span>&nbsp;<span class="ident" id="4700060">list</span><span class="op" id="4700064">[</span><span class="builtinfunc" id="4700065">len</span><span class="op" id="4700068">(</span><span class="ident" id="4700069">list</span><span class="op" id="4700073">)</span><span class="op" id="4700074">-</span><span class="builtintype" id="4700075">int</span><span class="op" id="4700078">(</span><span class="ident" id="4700079">bits</span><span class="op" id="4700083">)</span><span class="op" id="4700084">:</span><span class="op" id="4700085">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4700089">sortByLiteral</span><span class="op" id="4700102">(</span><span class="ident" id="4700103">chunk</span><span class="op" id="4700108">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4700112">for</span>&nbsp;<span class="ident" id="4700116">_</span><span class="op" id="4700117">,</span>&nbsp;<span class="ident" id="4700119">node</span>&nbsp;<span class="op" id="4700124">:=</span>&nbsp;<span class="keyword" id="4700127">range</span>&nbsp;<span class="ident" id="4700133">chunk</span>&nbsp;<span class="op" id="4700139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4700144">h</span><span class="op" id="4700145">.</span><span class="ident" id="4700146">codeBits</span><span class="op" id="4700154">[</span><span class="ident" id="4700155">node</span><span class="op" id="4700159">.</span><span class="ident" id="4700160">literal</span><span class="op" id="4700167">]</span>&nbsp;<span class="op" id="4700169">=</span>&nbsp;<span class="builtintype" id="4700171">uint8</span><span class="op" id="4700176">(</span><span class="ident" id="4700177">n</span><span class="op" id="4700178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4700183">h</span><span class="op" id="4700184">.</span><span class="ident" id="4700185">code</span><span class="op" id="4700189">[</span><span class="ident" id="4700190">node</span><span class="op" id="4700194">.</span><span class="ident" id="4700195">literal</span><span class="op" id="4700202">]</span>&nbsp;<span class="op" id="4700204">=</span>&nbsp;<span class="ident" id="4700206">reverseBits</span><span class="op" id="4700217">(</span><span class="ident" id="4700218">code</span><span class="op" id="4700222">,</span>&nbsp;<span class="builtintype" id="4700224">uint8</span><span class="op" id="4700229">(</span><span class="ident" id="4700230">n</span><span class="op" id="4700231">)</span><span class="op" id="4700232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4700237">code</span><span class="op" id="4700241">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4700246">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4700250">list</span>&nbsp;<span class="op" id="4700255">=</span>&nbsp;<span class="ident" id="4700257">list</span><span class="op" id="4700261">[</span><span class="num" id="4700262">0</span>&nbsp;<span class="op" id="4700264">:</span>&nbsp;<span class="builtinfunc" id="4700266">len</span><span class="op" id="4700269">(</span><span class="ident" id="4700270">list</span><span class="op" id="4700274">)</span><span class="op" id="4700275">-</span><span class="builtintype" id="4700276">int</span><span class="op" id="4700279">(</span><span class="ident" id="4700280">bits</span><span class="op" id="4700284">)</span><span class="op" id="4700285">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4700288">}</span><br>
<span class="lineno"></span><span class="op" id="4700290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4700293">//&nbsp;Update&nbsp;this&nbsp;Huffman&nbsp;Code&nbsp;object&nbsp;to&nbsp;be&nbsp;the&nbsp;minimum&nbsp;code&nbsp;for&nbsp;the&nbsp;specified&nbsp;frequency&nbsp;count.</span><br>
<span class="lineno">260</span><span class="comment" id="4700386">//</span><br>
<span class="lineno"></span><span class="comment" id="4700389">//&nbsp;freq&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;frequencies,&nbsp;in&nbsp;which&nbsp;frequency[i]&nbsp;gives&nbsp;the&nbsp;frequency&nbsp;of&nbsp;literal&nbsp;i.</span><br>
<span class="lineno"></span><span class="comment" id="4700479">//&nbsp;maxBits&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;to&nbsp;use&nbsp;for&nbsp;any&nbsp;literal.</span><br>
<span class="lineno"></span><span class="keyword" id="4700542">func</span>&nbsp;<span class="op" id="4700547">(</span><span class="ident" id="4700548">h</span>&nbsp;<span class="op" id="4700550">*</span><span class="ident" id="4700551">huffmanEncoder</span><span class="op" id="4700565">)</span>&nbsp;<span class="ident" id="4700567">generate</span><span class="op" id="4700575">(</span><span class="ident" id="4700576">freq</span>&nbsp;<span class="op" id="4700581">[</span><span class="op" id="4700582">]</span><span class="builtintype" id="4700583">int32</span><span class="op" id="4700588">,</span>&nbsp;<span class="ident" id="4700590">maxBits</span>&nbsp;<span class="builtintype" id="4700598">int32</span><span class="op" id="4700603">)</span>&nbsp;<span class="op" id="4700605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4700608">list</span>&nbsp;<span class="op" id="4700613">:=</span>&nbsp;<span class="builtinfunc" id="4700616">make</span><span class="op" id="4700620">(</span><span class="op" id="4700621">[</span><span class="op" id="4700622">]</span><span class="ident" id="4700623">literalNode</span><span class="op" id="4700634">,</span>&nbsp;<span class="builtinfunc" id="4700636">len</span><span class="op" id="4700639">(</span><span class="ident" id="4700640">freq</span><span class="op" id="4700644">)</span><span class="op" id="4700645">+</span><span class="num" id="4700646">1</span><span class="op" id="4700647">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4700650">//&nbsp;Number&nbsp;of&nbsp;non-zero&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4700682">count</span>&nbsp;<span class="op" id="4700688">:=</span>&nbsp;<span class="num" id="4700691">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4700694">//&nbsp;Set&nbsp;list&nbsp;to&nbsp;be&nbsp;the&nbsp;set&nbsp;of&nbsp;all&nbsp;non-zero&nbsp;literals&nbsp;and&nbsp;their&nbsp;frequencies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4700768">for</span>&nbsp;<span class="ident" id="4700772">i</span><span class="op" id="4700773">,</span>&nbsp;<span class="ident" id="4700775">f</span>&nbsp;<span class="op" id="4700777">:=</span>&nbsp;<span class="keyword" id="4700780">range</span>&nbsp;<span class="ident" id="4700786">freq</span>&nbsp;<span class="op" id="4700791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4700795">if</span>&nbsp;<span class="ident" id="4700798">f</span>&nbsp;<span class="op" id="4700800">!=</span>&nbsp;<span class="num" id="4700803">0</span>&nbsp;<span class="op" id="4700805">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4700810">list</span><span class="op" id="4700814">[</span><span class="ident" id="4700815">count</span><span class="op" id="4700820">]</span>&nbsp;<span class="op" id="4700822">=</span>&nbsp;<span class="ident" id="4700824">literalNode</span><span class="op" id="4700835">{</span><span class="builtintype" id="4700836">uint16</span><span class="op" id="4700842">(</span><span class="ident" id="4700843">i</span><span class="op" id="4700844">)</span><span class="op" id="4700845">,</span>&nbsp;<span class="ident" id="4700847">f</span><span class="op" id="4700848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4700853">count</span><span class="op" id="4700858">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4700863">}</span>&nbsp;<span class="keyword" id="4700865">else</span>&nbsp;<span class="op" id="4700870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4700875">h</span><span class="op" id="4700876">.</span><span class="ident" id="4700877">codeBits</span><span class="op" id="4700885">[</span><span class="ident" id="4700886">i</span><span class="op" id="4700887">]</span>&nbsp;<span class="op" id="4700889">=</span>&nbsp;<span class="num" id="4700891">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4700895">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4700898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4700901">//&nbsp;If&nbsp;freq[]&nbsp;is&nbsp;shorter&nbsp;than&nbsp;codeBits[],&nbsp;fill&nbsp;rest&nbsp;of&nbsp;codeBits[]&nbsp;with&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4700978">h</span><span class="op" id="4700979">.</span><span class="ident" id="4700980">codeBits</span>&nbsp;<span class="op" id="4700989">=</span>&nbsp;<span class="ident" id="4700991">h</span><span class="op" id="4700992">.</span><span class="ident" id="4700993">codeBits</span><span class="op" id="4701001">[</span><span class="num" id="4701002">0</span><span class="op" id="4701003">:</span><span class="builtinfunc" id="4701004">len</span><span class="op" id="4701007">(</span><span class="ident" id="4701008">freq</span><span class="op" id="4701012">)</span><span class="op" id="4701013">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4701016">list</span>&nbsp;<span class="op" id="4701021">=</span>&nbsp;<span class="ident" id="4701023">list</span><span class="op" id="4701027">[</span><span class="num" id="4701028">0</span><span class="op" id="4701029">:</span><span class="ident" id="4701030">count</span><span class="op" id="4701035">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4701038">if</span>&nbsp;<span class="ident" id="4701041">count</span>&nbsp;<span class="op" id="4701047">&lt;=</span>&nbsp;<span class="num" id="4701050">2</span>&nbsp;<span class="op" id="4701052">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4701056">//&nbsp;Handle&nbsp;the&nbsp;small&nbsp;cases&nbsp;here,&nbsp;because&nbsp;they&nbsp;are&nbsp;awkward&nbsp;for&nbsp;the&nbsp;general&nbsp;case&nbsp;code.&nbsp;&nbsp;With</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4701148">//&nbsp;two&nbsp;or&nbsp;fewer&nbsp;literals,&nbsp;everything&nbsp;has&nbsp;bit&nbsp;length&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4701205">for</span>&nbsp;<span class="ident" id="4701209">i</span><span class="op" id="4701210">,</span>&nbsp;<span class="ident" id="4701212">node</span>&nbsp;<span class="op" id="4701217">:=</span>&nbsp;<span class="keyword" id="4701220">range</span>&nbsp;<span class="ident" id="4701226">list</span>&nbsp;<span class="op" id="4701231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4701236">//&nbsp;&#34;list&#34;&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing&nbsp;literal&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4701290">h</span><span class="op" id="4701291">.</span><span class="ident" id="4701292">codeBits</span><span class="op" id="4701300">[</span><span class="ident" id="4701301">node</span><span class="op" id="4701305">.</span><span class="ident" id="4701306">literal</span><span class="op" id="4701313">]</span>&nbsp;<span class="op" id="4701315">=</span>&nbsp;<span class="num" id="4701317">1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4701322">h</span><span class="op" id="4701323">.</span><span class="ident" id="4701324">code</span><span class="op" id="4701328">[</span><span class="ident" id="4701329">node</span><span class="op" id="4701333">.</span><span class="ident" id="4701334">literal</span><span class="op" id="4701341">]</span>&nbsp;<span class="op" id="4701343">=</span>&nbsp;<span class="builtintype" id="4701345">uint16</span><span class="op" id="4701351">(</span><span class="ident" id="4701352">i</span><span class="op" id="4701353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4701357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4701361">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4701369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4701372">sortByFreq</span><span class="op" id="4701382">(</span><span class="ident" id="4701383">list</span><span class="op" id="4701387">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4701391">//&nbsp;Get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;for&nbsp;each&nbsp;bit&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4701441">bitCount</span>&nbsp;<span class="op" id="4701450">:=</span>&nbsp;<span class="ident" id="4701453">h</span><span class="op" id="4701454">.</span><span class="ident" id="4701455">bitCounts</span><span class="op" id="4701464">(</span><span class="ident" id="4701465">list</span><span class="op" id="4701469">,</span>&nbsp;<span class="ident" id="4701471">maxBits</span><span class="op" id="4701478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4701481">//&nbsp;And&nbsp;do&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4701507">h</span><span class="op" id="4701508">.</span><span class="ident" id="4701509">assignEncodingAndSize</span><span class="op" id="4701530">(</span><span class="ident" id="4701531">bitCount</span><span class="op" id="4701539">,</span>&nbsp;<span class="ident" id="4701541">list</span><span class="op" id="4701545">)</span><br>
<span class="lineno">295</span><span class="op" id="4701547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4701550">type</span>&nbsp;<span class="ident" id="4701555">literalNodeSorter</span>&nbsp;<span class="keyword" id="4701573">struct</span>&nbsp;<span class="op" id="4701580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4701583">a</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4701588">[</span><span class="op" id="4701589">]</span><span class="ident" id="4701590">literalNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4701603">less</span>&nbsp;<span class="keyword" id="4701608">func</span><span class="op" id="4701612">(</span><span class="ident" id="4701613">i</span><span class="op" id="4701614">,</span>&nbsp;<span class="ident" id="4701616">j</span>&nbsp;<span class="builtintype" id="4701618">int</span><span class="op" id="4701621">)</span>&nbsp;<span class="builtintype" id="4701623">bool</span><br>
<span class="lineno">300</span><span class="op" id="4701628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4701631">func</span>&nbsp;<span class="op" id="4701636">(</span><span class="ident" id="4701637">s</span>&nbsp;<span class="ident" id="4701639">literalNodeSorter</span><span class="op" id="4701656">)</span>&nbsp;<span class="ident" id="4701658">Len</span><span class="op" id="4701661">(</span><span class="op" id="4701662">)</span>&nbsp;<span class="builtintype" id="4701664">int</span>&nbsp;<span class="op" id="4701668">{</span>&nbsp;<span class="keyword" id="4701670">return</span>&nbsp;<span class="builtinfunc" id="4701677">len</span><span class="op" id="4701680">(</span><span class="ident" id="4701681">s</span><span class="op" id="4701682">.</span><span class="ident" id="4701683">a</span><span class="op" id="4701684">)</span>&nbsp;<span class="op" id="4701686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4701689">func</span>&nbsp;<span class="op" id="4701694">(</span><span class="ident" id="4701695">s</span>&nbsp;<span class="ident" id="4701697">literalNodeSorter</span><span class="op" id="4701714">)</span>&nbsp;<span class="ident" id="4701716">Less</span><span class="op" id="4701720">(</span><span class="ident" id="4701721">i</span><span class="op" id="4701722">,</span>&nbsp;<span class="ident" id="4701724">j</span>&nbsp;<span class="builtintype" id="4701726">int</span><span class="op" id="4701729">)</span>&nbsp;<span class="builtintype" id="4701731">bool</span>&nbsp;<span class="op" id="4701736">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4701739">return</span>&nbsp;<span class="ident" id="4701746">s</span><span class="op" id="4701747">.</span><span class="ident" id="4701748">less</span><span class="op" id="4701752">(</span><span class="ident" id="4701753">i</span><span class="op" id="4701754">,</span>&nbsp;<span class="ident" id="4701756">j</span><span class="op" id="4701757">)</span><br>
<span class="lineno"></span><span class="op" id="4701759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4701762">func</span>&nbsp;<span class="op" id="4701767">(</span><span class="ident" id="4701768">s</span>&nbsp;<span class="ident" id="4701770">literalNodeSorter</span><span class="op" id="4701787">)</span>&nbsp;<span class="ident" id="4701789">Swap</span><span class="op" id="4701793">(</span><span class="ident" id="4701794">i</span><span class="op" id="4701795">,</span>&nbsp;<span class="ident" id="4701797">j</span>&nbsp;<span class="builtintype" id="4701799">int</span><span class="op" id="4701802">)</span>&nbsp;<span class="op" id="4701804">{</span>&nbsp;<span class="ident" id="4701806">s</span><span class="op" id="4701807">.</span><span class="ident" id="4701808">a</span><span class="op" id="4701809">[</span><span class="ident" id="4701810">i</span><span class="op" id="4701811">]</span><span class="op" id="4701812">,</span>&nbsp;<span class="ident" id="4701814">s</span><span class="op" id="4701815">.</span><span class="ident" id="4701816">a</span><span class="op" id="4701817">[</span><span class="ident" id="4701818">j</span><span class="op" id="4701819">]</span>&nbsp;<span class="op" id="4701821">=</span>&nbsp;<span class="ident" id="4701823">s</span><span class="op" id="4701824">.</span><span class="ident" id="4701825">a</span><span class="op" id="4701826">[</span><span class="ident" id="4701827">j</span><span class="op" id="4701828">]</span><span class="op" id="4701829">,</span>&nbsp;<span class="ident" id="4701831">s</span><span class="op" id="4701832">.</span><span class="ident" id="4701833">a</span><span class="op" id="4701834">[</span><span class="ident" id="4701835">i</span><span class="op" id="4701836">]</span>&nbsp;<span class="op" id="4701838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="keyword" id="4701841">func</span>&nbsp;<span class="ident" id="4701846">sortByFreq</span><span class="op" id="4701856">(</span><span class="ident" id="4701857">a</span>&nbsp;<span class="op" id="4701859">[</span><span class="op" id="4701860">]</span><span class="ident" id="4701861">literalNode</span><span class="op" id="4701872">)</span>&nbsp;<span class="op" id="4701874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4701877">s</span>&nbsp;<span class="op" id="4701879">:=</span>&nbsp;<span class="op" id="4701882">&amp;</span><span class="ident" id="4701883">literalNodeSorter</span><span class="op" id="4701900">{</span><span class="ident" id="4701901">a</span><span class="op" id="4701902">,</span>&nbsp;<span class="keyword" id="4701904">func</span><span class="op" id="4701908">(</span><span class="ident" id="4701909">i</span><span class="op" id="4701910">,</span>&nbsp;<span class="ident" id="4701912">j</span>&nbsp;<span class="builtintype" id="4701914">int</span><span class="op" id="4701917">)</span>&nbsp;<span class="builtintype" id="4701919">bool</span>&nbsp;<span class="op" id="4701924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4701928">if</span>&nbsp;<span class="ident" id="4701931">a</span><span class="op" id="4701932">[</span><span class="ident" id="4701933">i</span><span class="op" id="4701934">]</span><span class="op" id="4701935">.</span><span class="ident" id="4701936">freq</span>&nbsp;<span class="op" id="4701941">==</span>&nbsp;<span class="ident" id="4701944">a</span><span class="op" id="4701945">[</span><span class="ident" id="4701946">j</span><span class="op" id="4701947">]</span><span class="op" id="4701948">.</span><span class="ident" id="4701949">freq</span>&nbsp;<span class="op" id="4701954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4701959">return</span>&nbsp;<span class="ident" id="4701966">a</span><span class="op" id="4701967">[</span><span class="ident" id="4701968">i</span><span class="op" id="4701969">]</span><span class="op" id="4701970">.</span><span class="ident" id="4701971">literal</span>&nbsp;<span class="op" id="4701979">&lt;</span>&nbsp;<span class="ident" id="4701981">a</span><span class="op" id="4701982">[</span><span class="ident" id="4701983">j</span><span class="op" id="4701984">]</span><span class="op" id="4701985">.</span><span class="ident" id="4701986">literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4701996">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4702000">return</span>&nbsp;<span class="ident" id="4702007">a</span><span class="op" id="4702008">[</span><span class="ident" id="4702009">i</span><span class="op" id="4702010">]</span><span class="op" id="4702011">.</span><span class="ident" id="4702012">freq</span>&nbsp;<span class="op" id="4702017">&lt;</span>&nbsp;<span class="ident" id="4702019">a</span><span class="op" id="4702020">[</span><span class="ident" id="4702021">j</span><span class="op" id="4702022">]</span><span class="op" id="4702023">.</span><span class="ident" id="4702024">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4702030">}</span><span class="op" id="4702031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4702034">sort</span><span class="op" id="4702038">.</span><span class="ident" id="4702039">Sort</span><span class="op" id="4702043">(</span><span class="ident" id="4702044">s</span><span class="op" id="4702045">)</span><br>
<span class="lineno"></span><span class="op" id="4702047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="keyword" id="4702050">func</span>&nbsp;<span class="ident" id="4702055">sortByLiteral</span><span class="op" id="4702068">(</span><span class="ident" id="4702069">a</span>&nbsp;<span class="op" id="4702071">[</span><span class="op" id="4702072">]</span><span class="ident" id="4702073">literalNode</span><span class="op" id="4702084">)</span>&nbsp;<span class="op" id="4702086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4702089">s</span>&nbsp;<span class="op" id="4702091">:=</span>&nbsp;<span class="op" id="4702094">&amp;</span><span class="ident" id="4702095">literalNodeSorter</span><span class="op" id="4702112">{</span><span class="ident" id="4702113">a</span><span class="op" id="4702114">,</span>&nbsp;<span class="keyword" id="4702116">func</span><span class="op" id="4702120">(</span><span class="ident" id="4702121">i</span><span class="op" id="4702122">,</span>&nbsp;<span class="ident" id="4702124">j</span>&nbsp;<span class="builtintype" id="4702126">int</span><span class="op" id="4702129">)</span>&nbsp;<span class="builtintype" id="4702131">bool</span>&nbsp;<span class="op" id="4702136">{</span>&nbsp;<span class="keyword" id="4702138">return</span>&nbsp;<span class="ident" id="4702145">a</span><span class="op" id="4702146">[</span><span class="ident" id="4702147">i</span><span class="op" id="4702148">]</span><span class="op" id="4702149">.</span><span class="ident" id="4702150">literal</span>&nbsp;<span class="op" id="4702158">&lt;</span>&nbsp;<span class="ident" id="4702160">a</span><span class="op" id="4702161">[</span><span class="ident" id="4702162">j</span><span class="op" id="4702163">]</span><span class="op" id="4702164">.</span><span class="ident" id="4702165">literal</span>&nbsp;<span class="op" id="4702173">}</span><span class="op" id="4702174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4702177">sort</span><span class="op" id="4702181">.</span><span class="ident" id="4702182">Sort</span><span class="op" id="4702186">(</span><span class="ident" id="4702187">s</span><span class="op" id="4702188">)</span><br>
<span class="lineno"></span><span class="op" id="4702190">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
