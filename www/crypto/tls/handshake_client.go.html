<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3870572">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3870627">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3870681">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3870732">package</span>&nbsp;<span class="ident" id="3870740">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3870745">import</span>&nbsp;<span class="op" id="3870752">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3870755">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3870764">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3870774">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3870790">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3870804">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3870821">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3870836">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3870846">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3870853">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3870859">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3870866">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="3870876">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3870879">type</span>&nbsp;<span class="ident" id="3870884">clientHandshakeState</span>&nbsp;<span class="keyword" id="3870905">struct</span>&nbsp;<span class="op" id="3870912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870915">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3870928">*</span><span class="ident" id="3870929"><a href="/crypto/tls/conn.go.html#3842235">Conn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870935">serverHello</span>&nbsp;&nbsp;<span class="op" id="3870948">*</span><span class="ident" id="3870949"><a href="/crypto/tls/handshake_messages.go.html#3899714">serverHelloMsg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870965">hello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3870978">*</span><span class="ident" id="3870979"><a href="/crypto/tls/handshake_messages.go.html#3888598">clientHelloMsg</a></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870995">suite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3871008">*</span><span class="ident" id="3871009"><a href="/crypto/tls/cipher_suites.go.html#3815009">cipherSuite</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871022">finishedHash</span>&nbsp;<span class="ident" id="3871035"><a href="/crypto/tls/prf.go.html#3956115">finishedHash</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871049">masterSecret</span>&nbsp;<span class="op" id="3871062">[</span><span class="op" id="3871063">]</span><span class="builtintype" id="3871064">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871070">session</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3871083">*</span><span class="ident" id="3871084"><a href="/crypto/tls/common.go.html#3828491">ClientSessionState</a></span><br>
<span class="lineno"></span><span class="op" id="3871103">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="3871106">func</span>&nbsp;<span class="op" id="3871111">(</span><span class="ident" id="3871112">c</span>&nbsp;<span class="op" id="3871114">*</span><span class="ident" id="3871115"><a href="/crypto/tls/conn.go.html#3842235">Conn</a></span><span class="op" id="3871119">)</span>&nbsp;<span class="ident" id="3871121">clientHandshake</span><span class="op" id="3871136">(</span><span class="op" id="3871137">)</span>&nbsp;<span class="builtintype" id="3871139">error</span>&nbsp;<span class="op" id="3871145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3871148">if</span>&nbsp;<span class="ident" id="3871151"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3871152">.</span><span class="ident" id="3871153">config</span>&nbsp;<span class="op" id="3871160">==</span>&nbsp;<span class="ident" id="3871163">nil</span>&nbsp;<span class="op" id="3871167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871171"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3871172">.</span><span class="ident" id="3871173">config</span>&nbsp;<span class="op" id="3871180">=</span>&nbsp;<span class="ident" id="3871182"><a href="/crypto/tls/common.go.html#3841230">defaultConfig</a></span><span class="op" id="3871195">(</span><span class="op" id="3871196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3871199">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3871203">if</span>&nbsp;<span class="builtinfunc" id="3871206">len</span><span class="op" id="3871209">(</span><span class="ident" id="3871210"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3871211">.</span><span class="ident" id="3871212">config</span><span class="op" id="3871218">.</span><span class="ident" id="3871219">ServerName</span><span class="op" id="3871229">)</span>&nbsp;<span class="op" id="3871231">==</span>&nbsp;<span class="num" id="3871234">0</span>&nbsp;<span class="op" id="3871236">&amp;&amp;</span>&nbsp;<span class="op" id="3871239">!</span><span class="ident" id="3871240"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3871241">.</span><span class="ident" id="3871242">config</span><span class="op" id="3871248">.</span><span class="ident" id="3871249">InsecureSkipVerify</span>&nbsp;<span class="op" id="3871268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3871272">return</span>&nbsp;<span class="ident" id="3871279"><a href="/crypto/tls/handshake_client.go.html#3870836">errors</a></span><span class="op" id="3871285">.</span><span class="ident" id="3871286">New</span><span class="op" id="3871289">(</span><span class="string" id="3871290">&#34;tls:&nbsp;either&nbsp;ServerName&nbsp;or&nbsp;InsecureSkipVerify&nbsp;must&nbsp;be&nbsp;specified&nbsp;in&nbsp;the&nbsp;tls.Config&#34;</span><span class="op" id="3871372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3871375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871379">nextProtosLength</span>&nbsp;<span class="op" id="3871396">:=</span>&nbsp;<span class="num" id="3871399">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3871402">for</span>&nbsp;<span class="ident" id="3871406">_</span><span class="op" id="3871407">,</span>&nbsp;<span class="ident" id="3871409">proto</span>&nbsp;<span class="op" id="3871415">:=</span>&nbsp;<span class="keyword" id="3871418">range</span>&nbsp;<span class="ident" id="3871424"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3871425">.</span><span class="ident" id="3871426">config</span><span class="op" id="3871432">.</span><span class="ident" id="3871433">NextProtos</span>&nbsp;<span class="op" id="3871444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3871448">if</span>&nbsp;<span class="ident" id="3871451">l</span>&nbsp;<span class="op" id="3871453">:=</span>&nbsp;<span class="builtinfunc" id="3871456">len</span><span class="op" id="3871459">(</span><span class="ident" id="3871460"><a href="/crypto/tls/handshake_client.go.html#3871409">proto</a></span><span class="op" id="3871465">)</span><span class="op" id="3871466">;</span>&nbsp;<span class="ident" id="3871468"><a href="/crypto/tls/handshake_client.go.html#3871451">l</a></span>&nbsp;<span class="op" id="3871470">==</span>&nbsp;<span class="num" id="3871473">0</span>&nbsp;<span class="op" id="3871475">||</span>&nbsp;<span class="ident" id="3871478"><a href="/crypto/tls/handshake_client.go.html#3871451">l</a></span>&nbsp;<span class="op" id="3871480">&gt;</span>&nbsp;<span class="num" id="3871482">255</span>&nbsp;<span class="op" id="3871486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3871491">return</span>&nbsp;<span class="ident" id="3871498"><a href="/crypto/tls/handshake_client.go.html#3870836">errors</a></span><span class="op" id="3871504">.</span><span class="ident" id="3871505">New</span><span class="op" id="3871508">(</span><span class="string" id="3871509">&#34;tls:&nbsp;invalid&nbsp;NextProtos&nbsp;value&#34;</span><span class="op" id="3871540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3871544">}</span>&nbsp;<span class="keyword" id="3871546">else</span>&nbsp;<span class="op" id="3871551">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871556"><a href="/crypto/tls/handshake_client.go.html#3871379">nextProtosLength</a></span>&nbsp;<span class="op" id="3871573">+=</span>&nbsp;<span class="num" id="3871576">1</span>&nbsp;<span class="op" id="3871578">+</span>&nbsp;<span class="ident" id="3871580"><a href="/crypto/tls/handshake_client.go.html#3871451">l</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3871584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3871587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3871590">if</span>&nbsp;<span class="ident" id="3871593"><a href="/crypto/tls/handshake_client.go.html#3871379">nextProtosLength</a></span>&nbsp;<span class="op" id="3871610">&gt;</span>&nbsp;<span class="num" id="3871612">0xffff</span>&nbsp;<span class="op" id="3871619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3871623">return</span>&nbsp;<span class="ident" id="3871630"><a href="/crypto/tls/handshake_client.go.html#3870836">errors</a></span><span class="op" id="3871636">.</span><span class="ident" id="3871637">New</span><span class="op" id="3871640">(</span><span class="string" id="3871641">&#34;tls:&nbsp;NextProtos&nbsp;values&nbsp;too&nbsp;large&#34;</span><span class="op" id="3871675">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3871678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871682">hello</span>&nbsp;<span class="op" id="3871688">:=</span>&nbsp;<span class="op" id="3871691">&amp;</span><span class="ident" id="3871692"><a href="/crypto/tls/handshake_messages.go.html#3888598">clientHelloMsg</a></span><span class="op" id="3871706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871710">vers</span><span class="op" id="3871714">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3871731"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3871732">.</span><span class="ident" id="3871733">config</span><span class="op" id="3871739">.</span><span class="ident" id="3871740">maxVersion</span><span class="op" id="3871750">(</span><span class="op" id="3871751">)</span><span class="op" id="3871752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871756">compressionMethods</span><span class="op" id="3871774">:</span>&nbsp;&nbsp;<span class="op" id="3871777">[</span><span class="op" id="3871778">]</span><span class="builtintype" id="3871779">uint8</span><span class="op" id="3871784">{</span><span class="ident" id="3871785"><a href="/crypto/tls/common.go.html#3823960">compressionNone</a></span><span class="op" id="3871800">}</span><span class="op" id="3871801">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871805">random</span><span class="op" id="3871811">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3871826">make</span><span class="op" id="3871830">(</span><span class="op" id="3871831">[</span><span class="op" id="3871832">]</span><span class="builtintype" id="3871833">byte</span><span class="op" id="3871837">,</span>&nbsp;<span class="num" id="3871839">32</span><span class="op" id="3871841">)</span><span class="op" id="3871842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871846">ocspStapling</span><span class="op" id="3871858">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3871867">true</span><span class="op" id="3871871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871875">serverName</span><span class="op" id="3871885">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3871896"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3871897">.</span><span class="ident" id="3871898">config</span><span class="op" id="3871904">.</span><span class="ident" id="3871905">ServerName</span><span class="op" id="3871915">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871919">supportedCurves</span><span class="op" id="3871934">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3871940"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3871941">.</span><span class="ident" id="3871942">config</span><span class="op" id="3871948">.</span><span class="ident" id="3871949">curvePreferences</span><span class="op" id="3871965">(</span><span class="op" id="3871966">)</span><span class="op" id="3871967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871971">supportedPoints</span><span class="op" id="3871986">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3871992">[</span><span class="op" id="3871993">]</span><span class="builtintype" id="3871994">uint8</span><span class="op" id="3871999">{</span><span class="ident" id="3872000"><a href="/crypto/tls/common.go.html#3824903">pointFormatUncompressed</a></span><span class="op" id="3872023">}</span><span class="op" id="3872024">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872028">nextProtoNeg</span><span class="op" id="3872040">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3872049">len</span><span class="op" id="3872052">(</span><span class="ident" id="3872053"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3872054">.</span><span class="ident" id="3872055">config</span><span class="op" id="3872061">.</span><span class="ident" id="3872062">NextProtos</span><span class="op" id="3872072">)</span>&nbsp;<span class="op" id="3872074">&gt;</span>&nbsp;<span class="num" id="3872076">0</span><span class="op" id="3872077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872081">secureRenegotiation</span><span class="op" id="3872100">:</span>&nbsp;<span class="builtintype" id="3872102">true</span><span class="op" id="3872106">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872110">alpnProtocols</span><span class="op" id="3872123">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3872131"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3872132">.</span><span class="ident" id="3872133">config</span><span class="op" id="3872139">.</span><span class="ident" id="3872140">NextProtos</span><span class="op" id="3872150">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3872153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872157">possibleCipherSuites</span>&nbsp;<span class="op" id="3872178">:=</span>&nbsp;<span class="ident" id="3872181"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3872182">.</span><span class="ident" id="3872183">config</span><span class="op" id="3872189">.</span><span class="ident" id="3872190">cipherSuites</span><span class="op" id="3872202">(</span><span class="op" id="3872203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872206"><a href="/crypto/tls/handshake_client.go.html#3871682">hello</a></span><span class="op" id="3872211">.</span><span class="ident" id="3872212">cipherSuites</span>&nbsp;<span class="op" id="3872225">=</span>&nbsp;<span class="builtinfunc" id="3872227">make</span><span class="op" id="3872231">(</span><span class="op" id="3872232">[</span><span class="op" id="3872233">]</span><span class="builtintype" id="3872234">uint16</span><span class="op" id="3872240">,</span>&nbsp;<span class="num" id="3872242">0</span><span class="op" id="3872243">,</span>&nbsp;<span class="builtinfunc" id="3872245">len</span><span class="op" id="3872248">(</span><span class="ident" id="3872249"><a href="/crypto/tls/handshake_client.go.html#3872157">possibleCipherSuites</a></span><span class="op" id="3872269">)</span><span class="op" id="3872270">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3872273">NextCipherSuite</span><span class="op" id="3872288">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872291">for</span>&nbsp;<span class="ident" id="3872295">_</span><span class="op" id="3872296">,</span>&nbsp;<span class="ident" id="3872298">suiteId</span>&nbsp;<span class="op" id="3872306">:=</span>&nbsp;<span class="keyword" id="3872309">range</span>&nbsp;<span class="ident" id="3872315"><a href="/crypto/tls/handshake_client.go.html#3872157">possibleCipherSuites</a></span>&nbsp;<span class="op" id="3872336">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872340">for</span>&nbsp;<span class="ident" id="3872344">_</span><span class="op" id="3872345">,</span>&nbsp;<span class="ident" id="3872347">suite</span>&nbsp;<span class="op" id="3872353">:=</span>&nbsp;<span class="keyword" id="3872356">range</span>&nbsp;<span class="ident" id="3872362"><a href="/crypto/tls/cipher_suites.go.html#3815423">cipherSuites</a></span>&nbsp;<span class="op" id="3872375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872380">if</span>&nbsp;<span class="ident" id="3872383"><a href="/crypto/tls/handshake_client.go.html#3872347">suite</a></span><span class="op" id="3872388">.</span><span class="ident" id="3872389">id</span>&nbsp;<span class="op" id="3872392">!=</span>&nbsp;<span class="ident" id="3872395"><a href="/crypto/tls/handshake_client.go.html#3872298">suiteId</a></span>&nbsp;<span class="op" id="3872403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872409">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3872421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3872426">//&nbsp;Don&#39;t&nbsp;advertise&nbsp;TLS&nbsp;1.2-only&nbsp;cipher&nbsp;suites&nbsp;unless</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3872482">//&nbsp;we&#39;re&nbsp;attempting&nbsp;TLS&nbsp;1.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872514">if</span>&nbsp;<span class="ident" id="3872517"><a href="/crypto/tls/handshake_client.go.html#3871682">hello</a></span><span class="op" id="3872522">.</span><span class="ident" id="3872523">vers</span>&nbsp;<span class="op" id="3872528">&lt;</span>&nbsp;<span class="ident" id="3872530"><a href="/crypto/tls/common.go.html#3822841">VersionTLS12</a></span>&nbsp;<span class="op" id="3872543">&amp;&amp;</span>&nbsp;<span class="ident" id="3872546"><a href="/crypto/tls/handshake_client.go.html#3872347">suite</a></span><span class="op" id="3872551">.</span><span class="ident" id="3872552">flags</span><span class="op" id="3872557">&amp;</span><span class="ident" id="3872558"><a href="/crypto/tls/cipher_suites.go.html#3814847">suiteTLS12</a></span>&nbsp;<span class="op" id="3872569">!=</span>&nbsp;<span class="num" id="3872572">0</span>&nbsp;<span class="op" id="3872574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872580">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3872592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872597"><a href="/crypto/tls/handshake_client.go.html#3871682">hello</a></span><span class="op" id="3872602">.</span><span class="ident" id="3872603">cipherSuites</span>&nbsp;<span class="op" id="3872616">=</span>&nbsp;<span class="builtinfunc" id="3872618">append</span><span class="op" id="3872624">(</span><span class="ident" id="3872625"><a href="/crypto/tls/handshake_client.go.html#3871682">hello</a></span><span class="op" id="3872630">.</span><span class="ident" id="3872631">cipherSuites</span><span class="op" id="3872643">,</span>&nbsp;<span class="ident" id="3872645"><a href="/crypto/tls/handshake_client.go.html#3872298">suiteId</a></span><span class="op" id="3872652">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872657">continue</span>&nbsp;<span class="ident" id="3872666">NextCipherSuite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3872684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3872687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872691">_</span><span class="op" id="3872692">,</span>&nbsp;<span class="ident" id="3872694">err</span>&nbsp;<span class="op" id="3872698">:=</span>&nbsp;<span class="ident" id="3872701"><a href="/crypto/tls/handshake_client.go.html#3870853">io</a></span><span class="op" id="3872703">.</span><span class="ident" id="3872704">ReadFull</span><span class="op" id="3872712">(</span><span class="ident" id="3872713"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3872714">.</span><span class="ident" id="3872715">config</span><span class="op" id="3872721">.</span><span class="ident" id="3872722">rand</span><span class="op" id="3872726">(</span><span class="op" id="3872727">)</span><span class="op" id="3872728">,</span>&nbsp;<span class="ident" id="3872730"><a href="/crypto/tls/handshake_client.go.html#3871682">hello</a></span><span class="op" id="3872735">.</span><span class="ident" id="3872736">random</span><span class="op" id="3872742">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872745">if</span>&nbsp;<span class="ident" id="3872748"><a href="/crypto/tls/handshake_client.go.html#3872694">err</a></span>&nbsp;<span class="op" id="3872752">!=</span>&nbsp;<span class="ident" id="3872755">nil</span>&nbsp;<span class="op" id="3872759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872763"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3872764">.</span><span class="ident" id="3872765">sendAlert</span><span class="op" id="3872774">(</span><span class="ident" id="3872775"><a href="/crypto/tls/alert.go.html#3811348">alertInternalError</a></span><span class="op" id="3872793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872797">return</span>&nbsp;<span class="ident" id="3872804"><a href="/crypto/tls/handshake_client.go.html#3870836">errors</a></span><span class="op" id="3872810">.</span><span class="ident" id="3872811">New</span><span class="op" id="3872814">(</span><span class="string" id="3872815">&#34;tls:&nbsp;short&nbsp;read&nbsp;from&nbsp;Rand:&nbsp;&#34;</span>&nbsp;<span class="op" id="3872845">+</span>&nbsp;<span class="ident" id="3872847"><a href="/crypto/tls/handshake_client.go.html#3872694">err</a></span><span class="op" id="3872850">.</span><span class="ident" id="3872851">Error</span><span class="op" id="3872856">(</span><span class="op" id="3872857">)</span><span class="op" id="3872858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3872861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872865">if</span>&nbsp;<span class="ident" id="3872868"><a href="/crypto/tls/handshake_client.go.html#3871682">hello</a></span><span class="op" id="3872873">.</span><span class="ident" id="3872874">vers</span>&nbsp;<span class="op" id="3872879">&gt;=</span>&nbsp;<span class="ident" id="3872882"><a href="/crypto/tls/common.go.html#3822841">VersionTLS12</a></span>&nbsp;<span class="op" id="3872895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872899"><a href="/crypto/tls/handshake_client.go.html#3871682">hello</a></span><span class="op" id="3872904">.</span><span class="ident" id="3872905">signatureAndHashes</span>&nbsp;<span class="op" id="3872924">=</span>&nbsp;<span class="ident" id="3872926"><a href="/crypto/tls/common.go.html#3826291">supportedSKXSignatureAlgorithms</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3872959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872963">var</span>&nbsp;<span class="ident" id="3872967">session</span>&nbsp;<span class="op" id="3872975">*</span><span class="ident" id="3872976"><a href="/crypto/tls/common.go.html#3828491">ClientSessionState</a></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872996">var</span>&nbsp;<span class="ident" id="3873000">cacheKey</span>&nbsp;<span class="builtintype" id="3873009">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873017">sessionCache</span>&nbsp;<span class="op" id="3873030">:=</span>&nbsp;<span class="ident" id="3873033"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3873034">.</span><span class="ident" id="3873035">config</span><span class="op" id="3873041">.</span><span class="ident" id="3873042">ClientSessionCache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873062">if</span>&nbsp;<span class="ident" id="3873065"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3873066">.</span><span class="ident" id="3873067">config</span><span class="op" id="3873073">.</span><span class="ident" id="3873074">SessionTicketsDisabled</span>&nbsp;<span class="op" id="3873097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873101"><a href="/crypto/tls/handshake_client.go.html#3873017">sessionCache</a></span>&nbsp;<span class="op" id="3873114">=</span>&nbsp;<span class="ident" id="3873116">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873121">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873125">if</span>&nbsp;<span class="ident" id="3873128"><a href="/crypto/tls/handshake_client.go.html#3873017">sessionCache</a></span>&nbsp;<span class="op" id="3873141">!=</span>&nbsp;<span class="ident" id="3873144">nil</span>&nbsp;<span class="op" id="3873148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873152"><a href="/crypto/tls/handshake_client.go.html#3871682">hello</a></span><span class="op" id="3873157">.</span><span class="ident" id="3873158">ticketSupported</span>&nbsp;<span class="op" id="3873174">=</span>&nbsp;<span class="builtintype" id="3873176">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3873184">//&nbsp;Try&nbsp;to&nbsp;resume&nbsp;a&nbsp;previously&nbsp;negotiated&nbsp;TLS&nbsp;session,&nbsp;if</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3873243">//&nbsp;available.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873259"><a href="/crypto/tls/handshake_client.go.html#3873000">cacheKey</a></span>&nbsp;<span class="op" id="3873268">=</span>&nbsp;<span class="ident" id="3873270"><a href="/crypto/tls/handshake_client.go.html#3887750">clientSessionCacheKey</a></span><span class="op" id="3873291">(</span><span class="ident" id="3873292"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3873293">.</span><span class="ident" id="3873294">conn</span><span class="op" id="3873298">.</span><span class="ident" id="3873299">RemoteAddr</span><span class="op" id="3873309">(</span><span class="op" id="3873310">)</span><span class="op" id="3873311">,</span>&nbsp;<span class="ident" id="3873313"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3873314">.</span><span class="ident" id="3873315">config</span><span class="op" id="3873321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873325">candidateSession</span><span class="op" id="3873341">,</span>&nbsp;<span class="ident" id="3873343">ok</span>&nbsp;<span class="op" id="3873346">:=</span>&nbsp;<span class="ident" id="3873349"><a href="/crypto/tls/handshake_client.go.html#3873017">sessionCache</a></span><span class="op" id="3873361">.</span><span class="ident" id="3873362">Get</span><span class="op" id="3873365">(</span><span class="ident" id="3873366"><a href="/crypto/tls/handshake_client.go.html#3873000">cacheKey</a></span><span class="op" id="3873374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873378">if</span>&nbsp;<span class="ident" id="3873381"><a href="/crypto/tls/handshake_client.go.html#3873343">ok</a></span>&nbsp;<span class="op" id="3873384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3873389">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;ciphersuite/version&nbsp;used&nbsp;for&nbsp;the</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3873443">//&nbsp;previous&nbsp;session&nbsp;are&nbsp;still&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873483">cipherSuiteOk</span>&nbsp;<span class="op" id="3873497">:=</span>&nbsp;<span class="builtintype" id="3873500">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873509">for</span>&nbsp;<span class="ident" id="3873513">_</span><span class="op" id="3873514">,</span>&nbsp;<span class="ident" id="3873516">id</span>&nbsp;<span class="op" id="3873519">:=</span>&nbsp;<span class="keyword" id="3873522">range</span>&nbsp;<span class="ident" id="3873528"><a href="/crypto/tls/handshake_client.go.html#3871682">hello</a></span><span class="op" id="3873533">.</span><span class="ident" id="3873534">cipherSuites</span>&nbsp;<span class="op" id="3873547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873553">if</span>&nbsp;<span class="ident" id="3873556"><a href="/crypto/tls/handshake_client.go.html#3873516">id</a></span>&nbsp;<span class="op" id="3873559">==</span>&nbsp;<span class="ident" id="3873562"><a href="/crypto/tls/handshake_client.go.html#3873325">candidateSession</a></span><span class="op" id="3873578">.</span><span class="ident" id="3873579">cipherSuite</span>&nbsp;<span class="op" id="3873591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873598"><a href="/crypto/tls/handshake_client.go.html#3873483">cipherSuiteOk</a></span>&nbsp;<span class="op" id="3873612">=</span>&nbsp;<span class="builtintype" id="3873614">true</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873624">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873645">versOk</span>&nbsp;<span class="op" id="3873652">:=</span>&nbsp;<span class="ident" id="3873655"><a href="/crypto/tls/handshake_client.go.html#3873325">candidateSession</a></span><span class="op" id="3873671">.</span><span class="ident" id="3873672">vers</span>&nbsp;<span class="op" id="3873677">&gt;=</span>&nbsp;<span class="ident" id="3873680"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3873681">.</span><span class="ident" id="3873682">config</span><span class="op" id="3873688">.</span><span class="ident" id="3873689">minVersion</span><span class="op" id="3873699">(</span><span class="op" id="3873700">)</span>&nbsp;<span class="op" id="3873702">&amp;&amp;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873709"><a href="/crypto/tls/handshake_client.go.html#3873325">candidateSession</a></span><span class="op" id="3873725">.</span><span class="ident" id="3873726">vers</span>&nbsp;<span class="op" id="3873731">&lt;=</span>&nbsp;<span class="ident" id="3873734"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3873735">.</span><span class="ident" id="3873736">config</span><span class="op" id="3873742">.</span><span class="ident" id="3873743">maxVersion</span><span class="op" id="3873753">(</span><span class="op" id="3873754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873759">if</span>&nbsp;<span class="ident" id="3873762"><a href="/crypto/tls/handshake_client.go.html#3873645">versOk</a></span>&nbsp;<span class="op" id="3873769">&amp;&amp;</span>&nbsp;<span class="ident" id="3873772"><a href="/crypto/tls/handshake_client.go.html#3873483">cipherSuiteOk</a></span>&nbsp;<span class="op" id="3873786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873792"><a href="/crypto/tls/handshake_client.go.html#3872967">session</a></span>&nbsp;<span class="op" id="3873800">=</span>&nbsp;<span class="ident" id="3873802"><a href="/crypto/tls/handshake_client.go.html#3873325">candidateSession</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873826">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873833">if</span>&nbsp;<span class="ident" id="3873836"><a href="/crypto/tls/handshake_client.go.html#3872967">session</a></span>&nbsp;<span class="op" id="3873844">!=</span>&nbsp;<span class="ident" id="3873847">nil</span>&nbsp;<span class="op" id="3873851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873855"><a href="/crypto/tls/handshake_client.go.html#3871682">hello</a></span><span class="op" id="3873860">.</span><span class="ident" id="3873861">sessionTicket</span>&nbsp;<span class="op" id="3873875">=</span>&nbsp;<span class="ident" id="3873877"><a href="/crypto/tls/handshake_client.go.html#3872967">session</a></span><span class="op" id="3873884">.</span><span class="ident" id="3873885">sessionTicket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3873901">//&nbsp;A&nbsp;random&nbsp;session&nbsp;ID&nbsp;is&nbsp;used&nbsp;to&nbsp;detect&nbsp;when&nbsp;the</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3873953">//&nbsp;server&nbsp;accepted&nbsp;the&nbsp;ticket&nbsp;and&nbsp;is&nbsp;resuming&nbsp;a&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3874011">//&nbsp;(see&nbsp;RFC&nbsp;5077).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3874032"><a href="/crypto/tls/handshake_client.go.html#3871682">hello</a></span><span class="op" id="3874037">.</span><span class="ident" id="3874038">sessionId</span>&nbsp;<span class="op" id="3874048">=</span>&nbsp;<span class="builtinfunc" id="3874050">make</span><span class="op" id="3874054">(</span><span class="op" id="3874055">[</span><span class="op" id="3874056">]</span><span class="builtintype" id="3874057">byte</span><span class="op" id="3874061">,</span>&nbsp;<span class="num" id="3874063">16</span><span class="op" id="3874065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3874069">if</span>&nbsp;<span class="ident" id="3874072">_</span><span class="op" id="3874073">,</span>&nbsp;<span class="ident" id="3874075">err</span>&nbsp;<span class="op" id="3874079">:=</span>&nbsp;<span class="ident" id="3874082"><a href="/crypto/tls/handshake_client.go.html#3870853">io</a></span><span class="op" id="3874084">.</span><span class="ident" id="3874085">ReadFull</span><span class="op" id="3874093">(</span><span class="ident" id="3874094"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3874095">.</span><span class="ident" id="3874096">config</span><span class="op" id="3874102">.</span><span class="ident" id="3874103">rand</span><span class="op" id="3874107">(</span><span class="op" id="3874108">)</span><span class="op" id="3874109">,</span>&nbsp;<span class="ident" id="3874111"><a href="/crypto/tls/handshake_client.go.html#3871682">hello</a></span><span class="op" id="3874116">.</span><span class="ident" id="3874117">sessionId</span><span class="op" id="3874126">)</span><span class="op" id="3874127">;</span>&nbsp;<span class="ident" id="3874129"><a href="/crypto/tls/handshake_client.go.html#3874075">err</a></span>&nbsp;<span class="op" id="3874133">!=</span>&nbsp;<span class="ident" id="3874136">nil</span>&nbsp;<span class="op" id="3874140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3874145"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3874146">.</span><span class="ident" id="3874147">sendAlert</span><span class="op" id="3874156">(</span><span class="ident" id="3874157"><a href="/crypto/tls/alert.go.html#3811348">alertInternalError</a></span><span class="op" id="3874175">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3874180">return</span>&nbsp;<span class="ident" id="3874187"><a href="/crypto/tls/handshake_client.go.html#3870836">errors</a></span><span class="op" id="3874193">.</span><span class="ident" id="3874194">New</span><span class="op" id="3874197">(</span><span class="string" id="3874198">&#34;tls:&nbsp;short&nbsp;read&nbsp;from&nbsp;Rand:&nbsp;&#34;</span>&nbsp;<span class="op" id="3874228">+</span>&nbsp;<span class="ident" id="3874230"><a href="/crypto/tls/handshake_client.go.html#3874075">err</a></span><span class="op" id="3874233">.</span><span class="ident" id="3874234">Error</span><span class="op" id="3874239">(</span><span class="op" id="3874240">)</span><span class="op" id="3874241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3874245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3874248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3874252"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3874253">.</span><span class="ident" id="3874254">writeRecord</span><span class="op" id="3874265">(</span><span class="ident" id="3874266"><a href="/crypto/tls/common.go.html#3823354">recordTypeHandshake</a></span><span class="op" id="3874285">,</span>&nbsp;<span class="ident" id="3874287"><a href="/crypto/tls/handshake_client.go.html#3871682">hello</a></span><span class="op" id="3874292">.</span><span class="ident" id="3874293">marshal</span><span class="op" id="3874300">(</span><span class="op" id="3874301">)</span><span class="op" id="3874302">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3874306">msg</span><span class="op" id="3874309">,</span>&nbsp;<span class="ident" id="3874311"><a href="/crypto/tls/handshake_client.go.html#3872694">err</a></span>&nbsp;<span class="op" id="3874315">:=</span>&nbsp;<span class="ident" id="3874318"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3874319">.</span><span class="ident" id="3874320">readHandshake</span><span class="op" id="3874333">(</span><span class="op" id="3874334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3874337">if</span>&nbsp;<span class="ident" id="3874340"><a href="/crypto/tls/handshake_client.go.html#3872694">err</a></span>&nbsp;<span class="op" id="3874344">!=</span>&nbsp;<span class="ident" id="3874347">nil</span>&nbsp;<span class="op" id="3874351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3874355">return</span>&nbsp;<span class="ident" id="3874362"><a href="/crypto/tls/handshake_client.go.html#3872694">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3874367">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3874370">serverHello</span><span class="op" id="3874381">,</span>&nbsp;<span class="ident" id="3874383">ok</span>&nbsp;<span class="op" id="3874386">:=</span>&nbsp;<span class="ident" id="3874389"><a href="/crypto/tls/handshake_client.go.html#3874306">msg</a></span><span class="op" id="3874392">.</span><span class="op" id="3874393">(</span><span class="op" id="3874394">*</span><span class="ident" id="3874395"><a href="/crypto/tls/handshake_messages.go.html#3899714">serverHelloMsg</a></span><span class="op" id="3874409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3874412">if</span>&nbsp;<span class="op" id="3874415">!</span><span class="ident" id="3874416"><a href="/crypto/tls/handshake_client.go.html#3874383">ok</a></span>&nbsp;<span class="op" id="3874419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3874423"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3874424">.</span><span class="ident" id="3874425">sendAlert</span><span class="op" id="3874434">(</span><span class="ident" id="3874435"><a href="/crypto/tls/alert.go.html#3810628">alertUnexpectedMessage</a></span><span class="op" id="3874457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3874461">return</span>&nbsp;<span class="ident" id="3874468"><a href="/crypto/tls/common.go.html#3841643">unexpectedMessageError</a></span><span class="op" id="3874490">(</span><span class="ident" id="3874491"><a href="/crypto/tls/handshake_client.go.html#3874370">serverHello</a></span><span class="op" id="3874502">,</span>&nbsp;<span class="ident" id="3874504"><a href="/crypto/tls/handshake_client.go.html#3874306">msg</a></span><span class="op" id="3874507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3874510">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3874514">vers</span><span class="op" id="3874518">,</span>&nbsp;<span class="ident" id="3874520"><a href="/crypto/tls/handshake_client.go.html#3874383">ok</a></span>&nbsp;<span class="op" id="3874523">:=</span>&nbsp;<span class="ident" id="3874526"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3874527">.</span><span class="ident" id="3874528">config</span><span class="op" id="3874534">.</span><span class="ident" id="3874535">mutualVersion</span><span class="op" id="3874548">(</span><span class="ident" id="3874549"><a href="/crypto/tls/handshake_client.go.html#3874370">serverHello</a></span><span class="op" id="3874560">.</span><span class="ident" id="3874561">vers</span><span class="op" id="3874565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3874568">if</span>&nbsp;<span class="op" id="3874571">!</span><span class="ident" id="3874572"><a href="/crypto/tls/handshake_client.go.html#3874383">ok</a></span>&nbsp;<span class="op" id="3874575">||</span>&nbsp;<span class="ident" id="3874578"><a href="/crypto/tls/handshake_client.go.html#3874514">vers</a></span>&nbsp;<span class="op" id="3874583">&lt;</span>&nbsp;<span class="ident" id="3874585"><a href="/crypto/tls/common.go.html#3822795">VersionTLS10</a></span>&nbsp;<span class="op" id="3874598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3874602">//&nbsp;TLS&nbsp;1.0&nbsp;is&nbsp;the&nbsp;minimum&nbsp;version&nbsp;supported&nbsp;as&nbsp;a&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3874661"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3874662">.</span><span class="ident" id="3874663">sendAlert</span><span class="op" id="3874672">(</span><span class="ident" id="3874673"><a href="/crypto/tls/alert.go.html#3811268">alertProtocolVersion</a></span><span class="op" id="3874693">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3874697">return</span>&nbsp;<span class="ident" id="3874704"><a href="/crypto/tls/handshake_client.go.html#3870846">fmt</a></span><span class="op" id="3874707">.</span><span class="ident" id="3874708">Errorf</span><span class="op" id="3874714">(</span><span class="string" id="3874715">&#34;tls:&nbsp;server&nbsp;selected&nbsp;unsupported&nbsp;protocol&nbsp;version&nbsp;%x&#34;</span><span class="op" id="3874769">,</span>&nbsp;<span class="ident" id="3874771"><a href="/crypto/tls/handshake_client.go.html#3874370">serverHello</a></span><span class="op" id="3874782">.</span><span class="ident" id="3874783">vers</span><span class="op" id="3874787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3874790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3874793"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3874794">.</span><span class="ident" id="3874795">vers</span>&nbsp;<span class="op" id="3874800">=</span>&nbsp;<span class="ident" id="3874802"><a href="/crypto/tls/handshake_client.go.html#3874514">vers</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3874808"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3874809">.</span><span class="ident" id="3874810">haveVers</span>&nbsp;<span class="op" id="3874819">=</span>&nbsp;<span class="builtintype" id="3874821">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3874828">suite</span>&nbsp;<span class="op" id="3874834">:=</span>&nbsp;<span class="ident" id="3874837"><a href="/crypto/tls/cipher_suites.go.html#3821133">mutualCipherSuite</a></span><span class="op" id="3874854">(</span><span class="ident" id="3874855"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3874856">.</span><span class="ident" id="3874857">config</span><span class="op" id="3874863">.</span><span class="ident" id="3874864">cipherSuites</span><span class="op" id="3874876">(</span><span class="op" id="3874877">)</span><span class="op" id="3874878">,</span>&nbsp;<span class="ident" id="3874880"><a href="/crypto/tls/handshake_client.go.html#3874370">serverHello</a></span><span class="op" id="3874891">.</span><span class="ident" id="3874892">cipherSuite</span><span class="op" id="3874903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3874906">if</span>&nbsp;<span class="ident" id="3874909"><a href="/crypto/tls/handshake_client.go.html#3874828">suite</a></span>&nbsp;<span class="op" id="3874915">==</span>&nbsp;<span class="ident" id="3874918">nil</span>&nbsp;<span class="op" id="3874922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3874926"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3874927">.</span><span class="ident" id="3874928">sendAlert</span><span class="op" id="3874937">(</span><span class="ident" id="3874938"><a href="/crypto/tls/alert.go.html#3810828">alertHandshakeFailure</a></span><span class="op" id="3874959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3874963">return</span>&nbsp;<span class="ident" id="3874970"><a href="/crypto/tls/handshake_client.go.html#3870846">fmt</a></span><span class="op" id="3874973">.</span><span class="ident" id="3874974">Errorf</span><span class="op" id="3874980">(</span><span class="string" id="3874981">&#34;tls:&nbsp;server&nbsp;selected&nbsp;an&nbsp;unsupported&nbsp;cipher&nbsp;suite&#34;</span><span class="op" id="3875031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3875034">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3875038">hs</span>&nbsp;<span class="op" id="3875041">:=</span>&nbsp;<span class="op" id="3875044">&amp;</span><span class="ident" id="3875045"><a href="/crypto/tls/handshake_client.go.html#3870884">clientHandshakeState</a></span><span class="op" id="3875065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3875069">c</span><span class="op" id="3875070">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3875083"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3875084">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3875088">serverHello</span><span class="op" id="3875099">:</span>&nbsp;&nbsp;<span class="ident" id="3875102"><a href="/crypto/tls/handshake_client.go.html#3874370">serverHello</a></span><span class="op" id="3875113">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3875117">hello</span><span class="op" id="3875122">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3875131"><a href="/crypto/tls/handshake_client.go.html#3871682">hello</a></span><span class="op" id="3875136">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3875140">suite</span><span class="op" id="3875145">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3875154"><a href="/crypto/tls/handshake_client.go.html#3874828">suite</a></span><span class="op" id="3875159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3875163">finishedHash</span><span class="op" id="3875175">:</span>&nbsp;<span class="ident" id="3875177"><a href="/crypto/tls/prf.go.html#3955764">newFinishedHash</a></span><span class="op" id="3875192">(</span><span class="ident" id="3875193"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3875194">.</span><span class="ident" id="3875195">vers</span><span class="op" id="3875199">)</span><span class="op" id="3875200">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3875204">session</span><span class="op" id="3875211">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3875218"><a href="/crypto/tls/handshake_client.go.html#3872967">session</a></span><span class="op" id="3875225">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3875228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3875232"><a href="/crypto/tls/handshake_client.go.html#3875038">hs</a></span><span class="op" id="3875234">.</span><span class="ident" id="3875235">finishedHash</span><span class="op" id="3875247">.</span><span class="ident" id="3875248">Write</span><span class="op" id="3875253">(</span><span class="ident" id="3875254"><a href="/crypto/tls/handshake_client.go.html#3875038">hs</a></span><span class="op" id="3875256">.</span><span class="ident" id="3875257">hello</span><span class="op" id="3875262">.</span><span class="ident" id="3875263">marshal</span><span class="op" id="3875270">(</span><span class="op" id="3875271">)</span><span class="op" id="3875272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3875275"><a href="/crypto/tls/handshake_client.go.html#3875038">hs</a></span><span class="op" id="3875277">.</span><span class="ident" id="3875278">finishedHash</span><span class="op" id="3875290">.</span><span class="ident" id="3875291">Write</span><span class="op" id="3875296">(</span><span class="ident" id="3875297"><a href="/crypto/tls/handshake_client.go.html#3875038">hs</a></span><span class="op" id="3875299">.</span><span class="ident" id="3875300">serverHello</span><span class="op" id="3875311">.</span><span class="ident" id="3875312">marshal</span><span class="op" id="3875319">(</span><span class="op" id="3875320">)</span><span class="op" id="3875321">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3875325">isResume</span><span class="op" id="3875333">,</span>&nbsp;<span class="ident" id="3875335"><a href="/crypto/tls/handshake_client.go.html#3872694">err</a></span>&nbsp;<span class="op" id="3875339">:=</span>&nbsp;<span class="ident" id="3875342"><a href="/crypto/tls/handshake_client.go.html#3875038">hs</a></span><span class="op" id="3875344">.</span><span class="ident" id="3875345">processServerHello</span><span class="op" id="3875363">(</span><span class="op" id="3875364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875367">if</span>&nbsp;<span class="ident" id="3875370"><a href="/crypto/tls/handshake_client.go.html#3872694">err</a></span>&nbsp;<span class="op" id="3875374">!=</span>&nbsp;<span class="ident" id="3875377">nil</span>&nbsp;<span class="op" id="3875381">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875385">return</span>&nbsp;<span class="ident" id="3875392"><a href="/crypto/tls/handshake_client.go.html#3872694">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3875397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875401">if</span>&nbsp;<span class="ident" id="3875404"><a href="/crypto/tls/handshake_client.go.html#3875325">isResume</a></span>&nbsp;<span class="op" id="3875413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875417">if</span>&nbsp;<span class="ident" id="3875420">err</span>&nbsp;<span class="op" id="3875424">:=</span>&nbsp;<span class="ident" id="3875427"><a href="/crypto/tls/handshake_client.go.html#3875038">hs</a></span><span class="op" id="3875429">.</span><span class="ident" id="3875430">establishKeys</span><span class="op" id="3875443">(</span><span class="op" id="3875444">)</span><span class="op" id="3875445">;</span>&nbsp;<span class="ident" id="3875447"><a href="/crypto/tls/handshake_client.go.html#3875420">err</a></span>&nbsp;<span class="op" id="3875451">!=</span>&nbsp;<span class="ident" id="3875454">nil</span>&nbsp;<span class="op" id="3875458">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875463">return</span>&nbsp;<span class="ident" id="3875470"><a href="/crypto/tls/handshake_client.go.html#3875420">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3875476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875480">if</span>&nbsp;<span class="ident" id="3875483">err</span>&nbsp;<span class="op" id="3875487">:=</span>&nbsp;<span class="ident" id="3875490"><a href="/crypto/tls/handshake_client.go.html#3875038">hs</a></span><span class="op" id="3875492">.</span><span class="ident" id="3875493">readSessionTicket</span><span class="op" id="3875510">(</span><span class="op" id="3875511">)</span><span class="op" id="3875512">;</span>&nbsp;<span class="ident" id="3875514"><a href="/crypto/tls/handshake_client.go.html#3875483">err</a></span>&nbsp;<span class="op" id="3875518">!=</span>&nbsp;<span class="ident" id="3875521">nil</span>&nbsp;<span class="op" id="3875525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875530">return</span>&nbsp;<span class="ident" id="3875537"><a href="/crypto/tls/handshake_client.go.html#3875483">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3875543">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875547">if</span>&nbsp;<span class="ident" id="3875550">err</span>&nbsp;<span class="op" id="3875554">:=</span>&nbsp;<span class="ident" id="3875557"><a href="/crypto/tls/handshake_client.go.html#3875038">hs</a></span><span class="op" id="3875559">.</span><span class="ident" id="3875560">readFinished</span><span class="op" id="3875572">(</span><span class="ident" id="3875573"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3875574">.</span><span class="ident" id="3875575">firstFinished</span><span class="op" id="3875588">[</span><span class="op" id="3875589">:</span><span class="op" id="3875590">]</span><span class="op" id="3875591">)</span><span class="op" id="3875592">;</span>&nbsp;<span class="ident" id="3875594"><a href="/crypto/tls/handshake_client.go.html#3875550">err</a></span>&nbsp;<span class="op" id="3875598">!=</span>&nbsp;<span class="ident" id="3875601">nil</span>&nbsp;<span class="op" id="3875605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875610">return</span>&nbsp;<span class="ident" id="3875617"><a href="/crypto/tls/handshake_client.go.html#3875550">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3875623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875627">if</span>&nbsp;<span class="ident" id="3875630">err</span>&nbsp;<span class="op" id="3875634">:=</span>&nbsp;<span class="ident" id="3875637"><a href="/crypto/tls/handshake_client.go.html#3875038">hs</a></span><span class="op" id="3875639">.</span><span class="ident" id="3875640">sendFinished</span><span class="op" id="3875652">(</span><span class="ident" id="3875653">nil</span><span class="op" id="3875656">)</span><span class="op" id="3875657">;</span>&nbsp;<span class="ident" id="3875659"><a href="/crypto/tls/handshake_client.go.html#3875630">err</a></span>&nbsp;<span class="op" id="3875663">!=</span>&nbsp;<span class="ident" id="3875666">nil</span>&nbsp;<span class="op" id="3875670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875675">return</span>&nbsp;<span class="ident" id="3875682"><a href="/crypto/tls/handshake_client.go.html#3875630">err</a></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3875688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3875691">}</span>&nbsp;<span class="keyword" id="3875693">else</span>&nbsp;<span class="op" id="3875698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875702">if</span>&nbsp;<span class="ident" id="3875705">err</span>&nbsp;<span class="op" id="3875709">:=</span>&nbsp;<span class="ident" id="3875712"><a href="/crypto/tls/handshake_client.go.html#3875038">hs</a></span><span class="op" id="3875714">.</span><span class="ident" id="3875715">doFullHandshake</span><span class="op" id="3875730">(</span><span class="op" id="3875731">)</span><span class="op" id="3875732">;</span>&nbsp;<span class="ident" id="3875734"><a href="/crypto/tls/handshake_client.go.html#3875705">err</a></span>&nbsp;<span class="op" id="3875738">!=</span>&nbsp;<span class="ident" id="3875741">nil</span>&nbsp;<span class="op" id="3875745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875750">return</span>&nbsp;<span class="ident" id="3875757"><a href="/crypto/tls/handshake_client.go.html#3875705">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3875763">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875767">if</span>&nbsp;<span class="ident" id="3875770">err</span>&nbsp;<span class="op" id="3875774">:=</span>&nbsp;<span class="ident" id="3875777"><a href="/crypto/tls/handshake_client.go.html#3875038">hs</a></span><span class="op" id="3875779">.</span><span class="ident" id="3875780">establishKeys</span><span class="op" id="3875793">(</span><span class="op" id="3875794">)</span><span class="op" id="3875795">;</span>&nbsp;<span class="ident" id="3875797"><a href="/crypto/tls/handshake_client.go.html#3875770">err</a></span>&nbsp;<span class="op" id="3875801">!=</span>&nbsp;<span class="ident" id="3875804">nil</span>&nbsp;<span class="op" id="3875808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875813">return</span>&nbsp;<span class="ident" id="3875820"><a href="/crypto/tls/handshake_client.go.html#3875770">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3875826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875830">if</span>&nbsp;<span class="ident" id="3875833">err</span>&nbsp;<span class="op" id="3875837">:=</span>&nbsp;<span class="ident" id="3875840"><a href="/crypto/tls/handshake_client.go.html#3875038">hs</a></span><span class="op" id="3875842">.</span><span class="ident" id="3875843">sendFinished</span><span class="op" id="3875855">(</span><span class="ident" id="3875856"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3875857">.</span><span class="ident" id="3875858">firstFinished</span><span class="op" id="3875871">[</span><span class="op" id="3875872">:</span><span class="op" id="3875873">]</span><span class="op" id="3875874">)</span><span class="op" id="3875875">;</span>&nbsp;<span class="ident" id="3875877"><a href="/crypto/tls/handshake_client.go.html#3875833">err</a></span>&nbsp;<span class="op" id="3875881">!=</span>&nbsp;<span class="ident" id="3875884">nil</span>&nbsp;<span class="op" id="3875888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875893">return</span>&nbsp;<span class="ident" id="3875900"><a href="/crypto/tls/handshake_client.go.html#3875833">err</a></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3875906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875910">if</span>&nbsp;<span class="ident" id="3875913">err</span>&nbsp;<span class="op" id="3875917">:=</span>&nbsp;<span class="ident" id="3875920"><a href="/crypto/tls/handshake_client.go.html#3875038">hs</a></span><span class="op" id="3875922">.</span><span class="ident" id="3875923">readSessionTicket</span><span class="op" id="3875940">(</span><span class="op" id="3875941">)</span><span class="op" id="3875942">;</span>&nbsp;<span class="ident" id="3875944"><a href="/crypto/tls/handshake_client.go.html#3875913">err</a></span>&nbsp;<span class="op" id="3875948">!=</span>&nbsp;<span class="ident" id="3875951">nil</span>&nbsp;<span class="op" id="3875955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875960">return</span>&nbsp;<span class="ident" id="3875967"><a href="/crypto/tls/handshake_client.go.html#3875913">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3875973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3875977">if</span>&nbsp;<span class="ident" id="3875980">err</span>&nbsp;<span class="op" id="3875984">:=</span>&nbsp;<span class="ident" id="3875987"><a href="/crypto/tls/handshake_client.go.html#3875038">hs</a></span><span class="op" id="3875989">.</span><span class="ident" id="3875990">readFinished</span><span class="op" id="3876002">(</span><span class="ident" id="3876003">nil</span><span class="op" id="3876006">)</span><span class="op" id="3876007">;</span>&nbsp;<span class="ident" id="3876009"><a href="/crypto/tls/handshake_client.go.html#3875980">err</a></span>&nbsp;<span class="op" id="3876013">!=</span>&nbsp;<span class="ident" id="3876016">nil</span>&nbsp;<span class="op" id="3876020">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876025">return</span>&nbsp;<span class="ident" id="3876032"><a href="/crypto/tls/handshake_client.go.html#3875980">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3876038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3876041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876045">if</span>&nbsp;<span class="ident" id="3876048"><a href="/crypto/tls/handshake_client.go.html#3873017">sessionCache</a></span>&nbsp;<span class="op" id="3876061">!=</span>&nbsp;<span class="ident" id="3876064">nil</span>&nbsp;<span class="op" id="3876068">&amp;&amp;</span>&nbsp;<span class="ident" id="3876071"><a href="/crypto/tls/handshake_client.go.html#3875038">hs</a></span><span class="op" id="3876073">.</span><span class="ident" id="3876074">session</span>&nbsp;<span class="op" id="3876082">!=</span>&nbsp;<span class="ident" id="3876085">nil</span>&nbsp;<span class="op" id="3876089">&amp;&amp;</span>&nbsp;<span class="ident" id="3876092"><a href="/crypto/tls/handshake_client.go.html#3872967">session</a></span>&nbsp;<span class="op" id="3876100">!=</span>&nbsp;<span class="ident" id="3876103"><a href="/crypto/tls/handshake_client.go.html#3875038">hs</a></span><span class="op" id="3876105">.</span><span class="ident" id="3876106">session</span>&nbsp;<span class="op" id="3876114">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876118"><a href="/crypto/tls/handshake_client.go.html#3873017">sessionCache</a></span><span class="op" id="3876130">.</span><span class="ident" id="3876131">Put</span><span class="op" id="3876134">(</span><span class="ident" id="3876135"><a href="/crypto/tls/handshake_client.go.html#3873000">cacheKey</a></span><span class="op" id="3876143">,</span>&nbsp;<span class="ident" id="3876145"><a href="/crypto/tls/handshake_client.go.html#3875038">hs</a></span><span class="op" id="3876147">.</span><span class="ident" id="3876148">session</span><span class="op" id="3876155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3876158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876162"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3876163">.</span><span class="ident" id="3876164">didResume</span>&nbsp;<span class="op" id="3876174">=</span>&nbsp;<span class="ident" id="3876176"><a href="/crypto/tls/handshake_client.go.html#3875325">isResume</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876186"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3876187">.</span><span class="ident" id="3876188">handshakeComplete</span>&nbsp;<span class="op" id="3876206">=</span>&nbsp;<span class="builtintype" id="3876208">true</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876214"><a href="/crypto/tls/handshake_client.go.html#3871112">c</a></span><span class="op" id="3876215">.</span><span class="ident" id="3876216">cipherSuite</span>&nbsp;<span class="op" id="3876228">=</span>&nbsp;<span class="ident" id="3876230"><a href="/crypto/tls/handshake_client.go.html#3874828">suite</a></span><span class="op" id="3876235">.</span><span class="ident" id="3876236">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876240">return</span>&nbsp;<span class="ident" id="3876247">nil</span><br>
<span class="lineno"></span><span class="op" id="3876251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3876254">func</span>&nbsp;<span class="op" id="3876259">(</span><span class="ident" id="3876260">hs</span>&nbsp;<span class="op" id="3876263">*</span><span class="ident" id="3876264"><a href="/crypto/tls/handshake_client.go.html#3870884">clientHandshakeState</a></span><span class="op" id="3876284">)</span>&nbsp;<span class="ident" id="3876286">doFullHandshake</span><span class="op" id="3876301">(</span><span class="op" id="3876302">)</span>&nbsp;<span class="builtintype" id="3876304">error</span>&nbsp;<span class="op" id="3876310">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876313">c</span>&nbsp;<span class="op" id="3876315">:=</span>&nbsp;<span class="ident" id="3876318"><a href="/crypto/tls/handshake_client.go.html#3876260">hs</a></span><span class="op" id="3876320">.</span><span class="ident" id="3876321">c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876325">msg</span><span class="op" id="3876328">,</span>&nbsp;<span class="ident" id="3876330">err</span>&nbsp;<span class="op" id="3876334">:=</span>&nbsp;<span class="ident" id="3876337"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3876338">.</span><span class="ident" id="3876339">readHandshake</span><span class="op" id="3876352">(</span><span class="op" id="3876353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876356">if</span>&nbsp;<span class="ident" id="3876359"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3876363">!=</span>&nbsp;<span class="ident" id="3876366">nil</span>&nbsp;<span class="op" id="3876370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876374">return</span>&nbsp;<span class="ident" id="3876381"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3876386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876389">certMsg</span><span class="op" id="3876396">,</span>&nbsp;<span class="ident" id="3876398">ok</span>&nbsp;<span class="op" id="3876401">:=</span>&nbsp;<span class="ident" id="3876404"><a href="/crypto/tls/handshake_client.go.html#3876325">msg</a></span><span class="op" id="3876407">.</span><span class="op" id="3876408">(</span><span class="op" id="3876409">*</span><span class="ident" id="3876410"><a href="/crypto/tls/handshake_messages.go.html#3905092">certificateMsg</a></span><span class="op" id="3876424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876427">if</span>&nbsp;<span class="op" id="3876430">!</span><span class="ident" id="3876431"><a href="/crypto/tls/handshake_client.go.html#3876398">ok</a></span>&nbsp;<span class="op" id="3876434">||</span>&nbsp;<span class="builtinfunc" id="3876437">len</span><span class="op" id="3876440">(</span><span class="ident" id="3876441"><a href="/crypto/tls/handshake_client.go.html#3876389">certMsg</a></span><span class="op" id="3876448">.</span><span class="ident" id="3876449">certificates</span><span class="op" id="3876461">)</span>&nbsp;<span class="op" id="3876463">==</span>&nbsp;<span class="num" id="3876466">0</span>&nbsp;<span class="op" id="3876468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876472"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3876473">.</span><span class="ident" id="3876474">sendAlert</span><span class="op" id="3876483">(</span><span class="ident" id="3876484"><a href="/crypto/tls/alert.go.html#3810628">alertUnexpectedMessage</a></span><span class="op" id="3876506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876510">return</span>&nbsp;<span class="ident" id="3876517"><a href="/crypto/tls/common.go.html#3841643">unexpectedMessageError</a></span><span class="op" id="3876539">(</span><span class="ident" id="3876540"><a href="/crypto/tls/handshake_client.go.html#3876389">certMsg</a></span><span class="op" id="3876547">,</span>&nbsp;<span class="ident" id="3876549"><a href="/crypto/tls/handshake_client.go.html#3876325">msg</a></span><span class="op" id="3876552">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3876555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876558"><a href="/crypto/tls/handshake_client.go.html#3876260">hs</a></span><span class="op" id="3876560">.</span><span class="ident" id="3876561">finishedHash</span><span class="op" id="3876573">.</span><span class="ident" id="3876574">Write</span><span class="op" id="3876579">(</span><span class="ident" id="3876580"><a href="/crypto/tls/handshake_client.go.html#3876389">certMsg</a></span><span class="op" id="3876587">.</span><span class="ident" id="3876588">marshal</span><span class="op" id="3876595">(</span><span class="op" id="3876596">)</span><span class="op" id="3876597">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876601">certs</span>&nbsp;<span class="op" id="3876607">:=</span>&nbsp;<span class="builtinfunc" id="3876610">make</span><span class="op" id="3876614">(</span><span class="op" id="3876615">[</span><span class="op" id="3876616">]</span><span class="op" id="3876617">*</span><span class="ident" id="3876618"><a href="/crypto/tls/handshake_client.go.html#3870821">x509</a></span><span class="op" id="3876622">.</span><span class="ident" id="3876623">Certificate</span><span class="op" id="3876634">,</span>&nbsp;<span class="builtinfunc" id="3876636">len</span><span class="op" id="3876639">(</span><span class="ident" id="3876640"><a href="/crypto/tls/handshake_client.go.html#3876389">certMsg</a></span><span class="op" id="3876647">.</span><span class="ident" id="3876648">certificates</span><span class="op" id="3876660">)</span><span class="op" id="3876661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876664">for</span>&nbsp;<span class="ident" id="3876668">i</span><span class="op" id="3876669">,</span>&nbsp;<span class="ident" id="3876671">asn1Data</span>&nbsp;<span class="op" id="3876680">:=</span>&nbsp;<span class="keyword" id="3876683">range</span>&nbsp;<span class="ident" id="3876689"><a href="/crypto/tls/handshake_client.go.html#3876389">certMsg</a></span><span class="op" id="3876696">.</span><span class="ident" id="3876697">certificates</span>&nbsp;<span class="op" id="3876710">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876714">cert</span><span class="op" id="3876718">,</span>&nbsp;<span class="ident" id="3876720">err</span>&nbsp;<span class="op" id="3876724">:=</span>&nbsp;<span class="ident" id="3876727"><a href="/crypto/tls/handshake_client.go.html#3870821">x509</a></span><span class="op" id="3876731">.</span><span class="ident" id="3876732">ParseCertificate</span><span class="op" id="3876748">(</span><span class="ident" id="3876749"><a href="/crypto/tls/handshake_client.go.html#3876671">asn1Data</a></span><span class="op" id="3876757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876761">if</span>&nbsp;<span class="ident" id="3876764"><a href="/crypto/tls/handshake_client.go.html#3876720">err</a></span>&nbsp;<span class="op" id="3876768">!=</span>&nbsp;<span class="ident" id="3876771">nil</span>&nbsp;<span class="op" id="3876775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876780"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3876781">.</span><span class="ident" id="3876782">sendAlert</span><span class="op" id="3876791">(</span><span class="ident" id="3876792"><a href="/crypto/tls/alert.go.html#3810868">alertBadCertificate</a></span><span class="op" id="3876811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876816">return</span>&nbsp;<span class="ident" id="3876823"><a href="/crypto/tls/handshake_client.go.html#3870836">errors</a></span><span class="op" id="3876829">.</span><span class="ident" id="3876830">New</span><span class="op" id="3876833">(</span><span class="string" id="3876834">&#34;tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;certificate&nbsp;from&nbsp;server:&nbsp;&#34;</span>&nbsp;<span class="op" id="3876883">+</span>&nbsp;<span class="ident" id="3876885"><a href="/crypto/tls/handshake_client.go.html#3876720">err</a></span><span class="op" id="3876888">.</span><span class="ident" id="3876889">Error</span><span class="op" id="3876894">(</span><span class="op" id="3876895">)</span><span class="op" id="3876896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3876900">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876904"><a href="/crypto/tls/handshake_client.go.html#3876601">certs</a></span><span class="op" id="3876909">[</span><span class="ident" id="3876910"><a href="/crypto/tls/handshake_client.go.html#3876668">i</a></span><span class="op" id="3876911">]</span>&nbsp;<span class="op" id="3876913">=</span>&nbsp;<span class="ident" id="3876915"><a href="/crypto/tls/handshake_client.go.html#3876714">cert</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3876921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3876925">if</span>&nbsp;<span class="op" id="3876928">!</span><span class="ident" id="3876929"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3876930">.</span><span class="ident" id="3876931">config</span><span class="op" id="3876937">.</span><span class="ident" id="3876938">InsecureSkipVerify</span>&nbsp;<span class="op" id="3876957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876961">opts</span>&nbsp;<span class="op" id="3876966">:=</span>&nbsp;<span class="ident" id="3876969"><a href="/crypto/tls/handshake_client.go.html#3870821">x509</a></span><span class="op" id="3876973">.</span><span class="ident" id="3876974">VerifyOptions</span><span class="op" id="3876987">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3876992">Roots</span><span class="op" id="3876997">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3877007"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3877008">.</span><span class="ident" id="3877009">config</span><span class="op" id="3877015">.</span><span class="ident" id="3877016">RootCAs</span><span class="op" id="3877023">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3877028">CurrentTime</span><span class="op" id="3877039">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3877043"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3877044">.</span><span class="ident" id="3877045">config</span><span class="op" id="3877051">.</span><span class="ident" id="3877052">time</span><span class="op" id="3877056">(</span><span class="op" id="3877057">)</span><span class="op" id="3877058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3877063">DNSName</span><span class="op" id="3877070">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3877078"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3877079">.</span><span class="ident" id="3877080">config</span><span class="op" id="3877086">.</span><span class="ident" id="3877087">ServerName</span><span class="op" id="3877097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3877102">Intermediates</span><span class="op" id="3877115">:</span>&nbsp;<span class="ident" id="3877117"><a href="/crypto/tls/handshake_client.go.html#3870821">x509</a></span><span class="op" id="3877121">.</span><span class="ident" id="3877122">NewCertPool</span><span class="op" id="3877133">(</span><span class="op" id="3877134">)</span><span class="op" id="3877135">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3877139">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3877144">for</span>&nbsp;<span class="ident" id="3877148">i</span><span class="op" id="3877149">,</span>&nbsp;<span class="ident" id="3877151">cert</span>&nbsp;<span class="op" id="3877156">:=</span>&nbsp;<span class="keyword" id="3877159">range</span>&nbsp;<span class="ident" id="3877165"><a href="/crypto/tls/handshake_client.go.html#3876601">certs</a></span>&nbsp;<span class="op" id="3877171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3877176">if</span>&nbsp;<span class="ident" id="3877179"><a href="/crypto/tls/handshake_client.go.html#3877148">i</a></span>&nbsp;<span class="op" id="3877181">==</span>&nbsp;<span class="num" id="3877184">0</span>&nbsp;<span class="op" id="3877186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3877192">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3877204">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3877209"><a href="/crypto/tls/handshake_client.go.html#3876961">opts</a></span><span class="op" id="3877213">.</span><span class="ident" id="3877214">Intermediates</span><span class="op" id="3877227">.</span><span class="ident" id="3877228">AddCert</span><span class="op" id="3877235">(</span><span class="ident" id="3877236"><a href="/crypto/tls/handshake_client.go.html#3877151">cert</a></span><span class="op" id="3877240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3877244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3877248"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3877249">.</span><span class="ident" id="3877250">verifiedChains</span><span class="op" id="3877264">,</span>&nbsp;<span class="ident" id="3877266"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3877270">=</span>&nbsp;<span class="ident" id="3877272"><a href="/crypto/tls/handshake_client.go.html#3876601">certs</a></span><span class="op" id="3877277">[</span><span class="num" id="3877278">0</span><span class="op" id="3877279">]</span><span class="op" id="3877280">.</span><span class="ident" id="3877281">Verify</span><span class="op" id="3877287">(</span><span class="ident" id="3877288"><a href="/crypto/tls/handshake_client.go.html#3876961">opts</a></span><span class="op" id="3877292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3877296">if</span>&nbsp;<span class="ident" id="3877299"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3877303">!=</span>&nbsp;<span class="ident" id="3877306">nil</span>&nbsp;<span class="op" id="3877310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3877315"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3877316">.</span><span class="ident" id="3877317">sendAlert</span><span class="op" id="3877326">(</span><span class="ident" id="3877327"><a href="/crypto/tls/alert.go.html#3810868">alertBadCertificate</a></span><span class="op" id="3877346">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3877351">return</span>&nbsp;<span class="ident" id="3877358"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3877364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3877367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3877371">switch</span>&nbsp;<span class="ident" id="3877378"><a href="/crypto/tls/handshake_client.go.html#3876601">certs</a></span><span class="op" id="3877383">[</span><span class="num" id="3877384">0</span><span class="op" id="3877385">]</span><span class="op" id="3877386">.</span><span class="ident" id="3877387">PublicKey</span><span class="op" id="3877396">.</span><span class="op" id="3877397">(</span><span class="keyword" id="3877398">type</span><span class="op" id="3877402">)</span>&nbsp;<span class="op" id="3877404">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3877407">case</span>&nbsp;<span class="op" id="3877412">*</span><span class="ident" id="3877413"><a href="/crypto/tls/handshake_client.go.html#3870790">rsa</a></span><span class="op" id="3877416">.</span><span class="ident" id="3877417">PublicKey</span><span class="op" id="3877426">,</span>&nbsp;<span class="op" id="3877428">*</span><span class="ident" id="3877429"><a href="/crypto/tls/handshake_client.go.html#3870774">ecdsa</a></span><span class="op" id="3877434">.</span><span class="ident" id="3877435">PublicKey</span><span class="op" id="3877444">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3877448">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3877455">default</span><span class="op" id="3877462">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3877466"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3877467">.</span><span class="ident" id="3877468">sendAlert</span><span class="op" id="3877477">(</span><span class="ident" id="3877478"><a href="/crypto/tls/alert.go.html#3810908">alertUnsupportedCertificate</a></span><span class="op" id="3877505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3877509">return</span>&nbsp;<span class="ident" id="3877516"><a href="/crypto/tls/handshake_client.go.html#3870846">fmt</a></span><span class="op" id="3877519">.</span><span class="ident" id="3877520">Errorf</span><span class="op" id="3877526">(</span><span class="string" id="3877527">&#34;tls:&nbsp;server&#39;s&nbsp;certificate&nbsp;contains&nbsp;an&nbsp;unsupported&nbsp;type&nbsp;of&nbsp;public&nbsp;key:&nbsp;%T&#34;</span><span class="op" id="3877601">,</span>&nbsp;<span class="ident" id="3877603"><a href="/crypto/tls/handshake_client.go.html#3876601">certs</a></span><span class="op" id="3877608">[</span><span class="num" id="3877609">0</span><span class="op" id="3877610">]</span><span class="op" id="3877611">.</span><span class="ident" id="3877612">PublicKey</span><span class="op" id="3877621">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3877624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3877628"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3877629">.</span><span class="ident" id="3877630">peerCertificates</span>&nbsp;<span class="op" id="3877647">=</span>&nbsp;<span class="ident" id="3877649"><a href="/crypto/tls/handshake_client.go.html#3876601">certs</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3877657">if</span>&nbsp;<span class="ident" id="3877660"><a href="/crypto/tls/handshake_client.go.html#3876260">hs</a></span><span class="op" id="3877662">.</span><span class="ident" id="3877663">serverHello</span><span class="op" id="3877674">.</span><span class="ident" id="3877675">ocspStapling</span>&nbsp;<span class="op" id="3877688">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3877692"><a href="/crypto/tls/handshake_client.go.html#3876325">msg</a></span><span class="op" id="3877695">,</span>&nbsp;<span class="ident" id="3877697"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3877701">=</span>&nbsp;<span class="ident" id="3877703"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3877704">.</span><span class="ident" id="3877705">readHandshake</span><span class="op" id="3877718">(</span><span class="op" id="3877719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3877723">if</span>&nbsp;<span class="ident" id="3877726"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3877730">!=</span>&nbsp;<span class="ident" id="3877733">nil</span>&nbsp;<span class="op" id="3877737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3877742">return</span>&nbsp;<span class="ident" id="3877749"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3877755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3877759">cs</span><span class="op" id="3877761">,</span>&nbsp;<span class="ident" id="3877763">ok</span>&nbsp;<span class="op" id="3877766">:=</span>&nbsp;<span class="ident" id="3877769"><a href="/crypto/tls/handshake_client.go.html#3876325">msg</a></span><span class="op" id="3877772">.</span><span class="op" id="3877773">(</span><span class="op" id="3877774">*</span><span class="ident" id="3877775"><a href="/crypto/tls/handshake_messages.go.html#3907489">certificateStatusMsg</a></span><span class="op" id="3877795">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3877799">if</span>&nbsp;<span class="op" id="3877802">!</span><span class="ident" id="3877803"><a href="/crypto/tls/handshake_client.go.html#3877763">ok</a></span>&nbsp;<span class="op" id="3877806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3877811"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3877812">.</span><span class="ident" id="3877813">sendAlert</span><span class="op" id="3877822">(</span><span class="ident" id="3877823"><a href="/crypto/tls/alert.go.html#3810628">alertUnexpectedMessage</a></span><span class="op" id="3877845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3877850">return</span>&nbsp;<span class="ident" id="3877857"><a href="/crypto/tls/common.go.html#3841643">unexpectedMessageError</a></span><span class="op" id="3877879">(</span><span class="ident" id="3877880"><a href="/crypto/tls/handshake_client.go.html#3877759">cs</a></span><span class="op" id="3877882">,</span>&nbsp;<span class="ident" id="3877884"><a href="/crypto/tls/handshake_client.go.html#3876325">msg</a></span><span class="op" id="3877887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3877891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3877895"><a href="/crypto/tls/handshake_client.go.html#3876260">hs</a></span><span class="op" id="3877897">.</span><span class="ident" id="3877898">finishedHash</span><span class="op" id="3877910">.</span><span class="ident" id="3877911">Write</span><span class="op" id="3877916">(</span><span class="ident" id="3877917"><a href="/crypto/tls/handshake_client.go.html#3877759">cs</a></span><span class="op" id="3877919">.</span><span class="ident" id="3877920">marshal</span><span class="op" id="3877927">(</span><span class="op" id="3877928">)</span><span class="op" id="3877929">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3877934">if</span>&nbsp;<span class="ident" id="3877937"><a href="/crypto/tls/handshake_client.go.html#3877759">cs</a></span><span class="op" id="3877939">.</span><span class="ident" id="3877940">statusType</span>&nbsp;<span class="op" id="3877951">==</span>&nbsp;<span class="ident" id="3877954"><a href="/crypto/tls/common.go.html#3824989">statusTypeOCSP</a></span>&nbsp;<span class="op" id="3877969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3877974"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3877975">.</span><span class="ident" id="3877976">ocspResponse</span>&nbsp;<span class="op" id="3877989">=</span>&nbsp;<span class="ident" id="3877991"><a href="/crypto/tls/handshake_client.go.html#3877759">cs</a></span><span class="op" id="3877993">.</span><span class="ident" id="3877994">response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3878005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3878008">}</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3878012"><a href="/crypto/tls/handshake_client.go.html#3876325">msg</a></span><span class="op" id="3878015">,</span>&nbsp;<span class="ident" id="3878017"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3878021">=</span>&nbsp;<span class="ident" id="3878023"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3878024">.</span><span class="ident" id="3878025">readHandshake</span><span class="op" id="3878038">(</span><span class="op" id="3878039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3878042">if</span>&nbsp;<span class="ident" id="3878045"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3878049">!=</span>&nbsp;<span class="ident" id="3878052">nil</span>&nbsp;<span class="op" id="3878056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3878060">return</span>&nbsp;<span class="ident" id="3878067"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3878072">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3878076">keyAgreement</span>&nbsp;<span class="op" id="3878089">:=</span>&nbsp;<span class="ident" id="3878092"><a href="/crypto/tls/handshake_client.go.html#3876260">hs</a></span><span class="op" id="3878094">.</span><span class="ident" id="3878095">suite</span><span class="op" id="3878100">.</span><span class="ident" id="3878101">ka</span><span class="op" id="3878103">(</span><span class="ident" id="3878104"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3878105">.</span><span class="ident" id="3878106">vers</span><span class="op" id="3878110">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3878114">skx</span><span class="op" id="3878117">,</span>&nbsp;<span class="ident" id="3878119"><a href="/crypto/tls/handshake_client.go.html#3876398">ok</a></span>&nbsp;<span class="op" id="3878122">:=</span>&nbsp;<span class="ident" id="3878125"><a href="/crypto/tls/handshake_client.go.html#3876325">msg</a></span><span class="op" id="3878128">.</span><span class="op" id="3878129">(</span><span class="op" id="3878130">*</span><span class="ident" id="3878131"><a href="/crypto/tls/handshake_messages.go.html#3906795">serverKeyExchangeMsg</a></span><span class="op" id="3878151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3878154">if</span>&nbsp;<span class="ident" id="3878157"><a href="/crypto/tls/handshake_client.go.html#3876398">ok</a></span>&nbsp;<span class="op" id="3878160">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3878164"><a href="/crypto/tls/handshake_client.go.html#3876260">hs</a></span><span class="op" id="3878166">.</span><span class="ident" id="3878167">finishedHash</span><span class="op" id="3878179">.</span><span class="ident" id="3878180">Write</span><span class="op" id="3878185">(</span><span class="ident" id="3878186"><a href="/crypto/tls/handshake_client.go.html#3878114">skx</a></span><span class="op" id="3878189">.</span><span class="ident" id="3878190">marshal</span><span class="op" id="3878197">(</span><span class="op" id="3878198">)</span><span class="op" id="3878199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3878203"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3878207">=</span>&nbsp;<span class="ident" id="3878209"><a href="/crypto/tls/handshake_client.go.html#3878076">keyAgreement</a></span><span class="op" id="3878221">.</span><span class="ident" id="3878222">processServerKeyExchange</span><span class="op" id="3878246">(</span><span class="ident" id="3878247"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3878248">.</span><span class="ident" id="3878249">config</span><span class="op" id="3878255">,</span>&nbsp;<span class="ident" id="3878257"><a href="/crypto/tls/handshake_client.go.html#3876260">hs</a></span><span class="op" id="3878259">.</span><span class="ident" id="3878260">hello</span><span class="op" id="3878265">,</span>&nbsp;<span class="ident" id="3878267"><a href="/crypto/tls/handshake_client.go.html#3876260">hs</a></span><span class="op" id="3878269">.</span><span class="ident" id="3878270">serverHello</span><span class="op" id="3878281">,</span>&nbsp;<span class="ident" id="3878283"><a href="/crypto/tls/handshake_client.go.html#3876601">certs</a></span><span class="op" id="3878288">[</span><span class="num" id="3878289">0</span><span class="op" id="3878290">]</span><span class="op" id="3878291">,</span>&nbsp;<span class="ident" id="3878293"><a href="/crypto/tls/handshake_client.go.html#3878114">skx</a></span><span class="op" id="3878296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3878300">if</span>&nbsp;<span class="ident" id="3878303"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3878307">!=</span>&nbsp;<span class="ident" id="3878310">nil</span>&nbsp;<span class="op" id="3878314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3878319"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3878320">.</span><span class="ident" id="3878321">sendAlert</span><span class="op" id="3878330">(</span><span class="ident" id="3878331"><a href="/crypto/tls/alert.go.html#3810628">alertUnexpectedMessage</a></span><span class="op" id="3878353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3878358">return</span>&nbsp;<span class="ident" id="3878365"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3878371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3878376"><a href="/crypto/tls/handshake_client.go.html#3876325">msg</a></span><span class="op" id="3878379">,</span>&nbsp;<span class="ident" id="3878381"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3878385">=</span>&nbsp;<span class="ident" id="3878387"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3878388">.</span><span class="ident" id="3878389">readHandshake</span><span class="op" id="3878402">(</span><span class="op" id="3878403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3878407">if</span>&nbsp;<span class="ident" id="3878410"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3878414">!=</span>&nbsp;<span class="ident" id="3878417">nil</span>&nbsp;<span class="op" id="3878421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3878426">return</span>&nbsp;<span class="ident" id="3878433"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3878439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3878442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3878446">var</span>&nbsp;<span class="ident" id="3878450">chainToSend</span>&nbsp;<span class="op" id="3878462">*</span><span class="ident" id="3878463"><a href="/crypto/tls/common.go.html#3838319">Certificate</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3878476">var</span>&nbsp;<span class="ident" id="3878480">certRequested</span>&nbsp;<span class="builtintype" id="3878494">bool</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3878500">certReq</span><span class="op" id="3878507">,</span>&nbsp;<span class="ident" id="3878509"><a href="/crypto/tls/handshake_client.go.html#3876398">ok</a></span>&nbsp;<span class="op" id="3878512">:=</span>&nbsp;<span class="ident" id="3878515"><a href="/crypto/tls/handshake_client.go.html#3876325">msg</a></span><span class="op" id="3878518">.</span><span class="op" id="3878519">(</span><span class="op" id="3878520">*</span><span class="ident" id="3878521"><a href="/crypto/tls/handshake_messages.go.html#3911637">certificateRequestMsg</a></span><span class="op" id="3878542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3878545">if</span>&nbsp;<span class="ident" id="3878548"><a href="/crypto/tls/handshake_client.go.html#3876398">ok</a></span>&nbsp;<span class="op" id="3878551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3878555"><a href="/crypto/tls/handshake_client.go.html#3878480">certRequested</a></span>&nbsp;<span class="op" id="3878569">=</span>&nbsp;<span class="builtintype" id="3878571">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3878579">//&nbsp;RFC&nbsp;4346&nbsp;on&nbsp;the&nbsp;certificateAuthorities&nbsp;field:</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3878630">//&nbsp;A&nbsp;list&nbsp;of&nbsp;the&nbsp;distinguished&nbsp;names&nbsp;of&nbsp;acceptable&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3878695">//&nbsp;authorities.&nbsp;These&nbsp;distinguished&nbsp;names&nbsp;may&nbsp;specify&nbsp;a&nbsp;desired</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3878761">//&nbsp;distinguished&nbsp;name&nbsp;for&nbsp;a&nbsp;root&nbsp;CA&nbsp;or&nbsp;for&nbsp;a&nbsp;subordinate&nbsp;CA;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3878824">//&nbsp;thus,&nbsp;this&nbsp;message&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;describe&nbsp;both&nbsp;known&nbsp;roots</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3878889">//&nbsp;and&nbsp;a&nbsp;desired&nbsp;authorization&nbsp;space.&nbsp;If&nbsp;the</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3878936">//&nbsp;certificate_authorities&nbsp;list&nbsp;is&nbsp;empty&nbsp;then&nbsp;the&nbsp;client&nbsp;MAY</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3878999">//&nbsp;send&nbsp;any&nbsp;certificate&nbsp;of&nbsp;the&nbsp;appropriate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3879044">//&nbsp;ClientCertificateType,&nbsp;unless&nbsp;there&nbsp;is&nbsp;some&nbsp;external</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3879102">//&nbsp;arrangement&nbsp;to&nbsp;the&nbsp;contrary.</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3879137"><a href="/crypto/tls/handshake_client.go.html#3876260">hs</a></span><span class="op" id="3879139">.</span><span class="ident" id="3879140">finishedHash</span><span class="op" id="3879152">.</span><span class="ident" id="3879153">Write</span><span class="op" id="3879158">(</span><span class="ident" id="3879159"><a href="/crypto/tls/handshake_client.go.html#3878500">certReq</a></span><span class="op" id="3879166">.</span><span class="ident" id="3879167">marshal</span><span class="op" id="3879174">(</span><span class="op" id="3879175">)</span><span class="op" id="3879176">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3879181">var</span>&nbsp;<span class="ident" id="3879185">rsaAvail</span><span class="op" id="3879193">,</span>&nbsp;<span class="ident" id="3879195">ecdsaAvail</span>&nbsp;<span class="builtintype" id="3879206">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3879213">for</span>&nbsp;<span class="ident" id="3879217">_</span><span class="op" id="3879218">,</span>&nbsp;<span class="ident" id="3879220">certType</span>&nbsp;<span class="op" id="3879229">:=</span>&nbsp;<span class="keyword" id="3879232">range</span>&nbsp;<span class="ident" id="3879238"><a href="/crypto/tls/handshake_client.go.html#3878500">certReq</a></span><span class="op" id="3879245">.</span><span class="ident" id="3879246">certificateTypes</span>&nbsp;<span class="op" id="3879263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3879268">switch</span>&nbsp;<span class="ident" id="3879275"><a href="/crypto/tls/handshake_client.go.html#3879220">certType</a></span>&nbsp;<span class="op" id="3879284">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3879289">case</span>&nbsp;<span class="ident" id="3879294"><a href="/crypto/tls/common.go.html#3825075">certTypeRSASign</a></span><span class="op" id="3879309">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3879315"><a href="/crypto/tls/handshake_client.go.html#3879185">rsaAvail</a></span>&nbsp;<span class="op" id="3879324">=</span>&nbsp;<span class="builtintype" id="3879326">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3879334">case</span>&nbsp;<span class="ident" id="3879339"><a href="/crypto/tls/common.go.html#3825373">certTypeECDSASign</a></span><span class="op" id="3879356">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3879362"><a href="/crypto/tls/handshake_client.go.html#3879195">ecdsaAvail</a></span>&nbsp;<span class="op" id="3879373">=</span>&nbsp;<span class="builtintype" id="3879375">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3879383">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3879387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3879392">//&nbsp;We&nbsp;need&nbsp;to&nbsp;search&nbsp;our&nbsp;list&nbsp;of&nbsp;client&nbsp;certs&nbsp;for&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3879448">//&nbsp;where&nbsp;SignatureAlgorithm&nbsp;is&nbsp;acceptable&nbsp;to&nbsp;the&nbsp;server&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3879514">//&nbsp;Issuer&nbsp;is&nbsp;in&nbsp;certReq.certificateAuthorities</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3879562">findCert</span><span class="op" id="3879570">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3879574">for</span>&nbsp;<span class="ident" id="3879578">i</span><span class="op" id="3879579">,</span>&nbsp;<span class="ident" id="3879581">chain</span>&nbsp;<span class="op" id="3879587">:=</span>&nbsp;<span class="keyword" id="3879590">range</span>&nbsp;<span class="ident" id="3879596"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3879597">.</span><span class="ident" id="3879598">config</span><span class="op" id="3879604">.</span><span class="ident" id="3879605">Certificates</span>&nbsp;<span class="op" id="3879618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3879623">if</span>&nbsp;<span class="op" id="3879626">!</span><span class="ident" id="3879627"><a href="/crypto/tls/handshake_client.go.html#3879185">rsaAvail</a></span>&nbsp;<span class="op" id="3879636">&amp;&amp;</span>&nbsp;<span class="op" id="3879639">!</span><span class="ident" id="3879640"><a href="/crypto/tls/handshake_client.go.html#3879195">ecdsaAvail</a></span>&nbsp;<span class="op" id="3879651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3879657">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3879669">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3879675">for</span>&nbsp;<span class="ident" id="3879679">j</span><span class="op" id="3879680">,</span>&nbsp;<span class="ident" id="3879682">cert</span>&nbsp;<span class="op" id="3879687">:=</span>&nbsp;<span class="keyword" id="3879690">range</span>&nbsp;<span class="ident" id="3879696"><a href="/crypto/tls/handshake_client.go.html#3879581">chain</a></span><span class="op" id="3879701">.</span><span class="ident" id="3879702">Certificate</span>&nbsp;<span class="op" id="3879714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3879720">x509Cert</span>&nbsp;<span class="op" id="3879729">:=</span>&nbsp;<span class="ident" id="3879732"><a href="/crypto/tls/handshake_client.go.html#3879581">chain</a></span><span class="op" id="3879737">.</span><span class="ident" id="3879738">Leaf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3879747">//&nbsp;parse&nbsp;the&nbsp;certificate&nbsp;if&nbsp;this&nbsp;isn&#39;t&nbsp;the&nbsp;leaf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3879799">//&nbsp;node,&nbsp;or&nbsp;if&nbsp;chain.Leaf&nbsp;was&nbsp;nil</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3879837">if</span>&nbsp;<span class="ident" id="3879840"><a href="/crypto/tls/handshake_client.go.html#3879679">j</a></span>&nbsp;<span class="op" id="3879842">!=</span>&nbsp;<span class="num" id="3879845">0</span>&nbsp;<span class="op" id="3879847">||</span>&nbsp;<span class="ident" id="3879850"><a href="/crypto/tls/handshake_client.go.html#3879720">x509Cert</a></span>&nbsp;<span class="op" id="3879859">==</span>&nbsp;<span class="ident" id="3879862">nil</span>&nbsp;<span class="op" id="3879866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3879873">if</span>&nbsp;<span class="ident" id="3879876"><a href="/crypto/tls/handshake_client.go.html#3879720">x509Cert</a></span><span class="op" id="3879884">,</span>&nbsp;<span class="ident" id="3879886"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3879890">=</span>&nbsp;<span class="ident" id="3879892"><a href="/crypto/tls/handshake_client.go.html#3870821">x509</a></span><span class="op" id="3879896">.</span><span class="ident" id="3879897">ParseCertificate</span><span class="op" id="3879913">(</span><span class="ident" id="3879914"><a href="/crypto/tls/handshake_client.go.html#3879682">cert</a></span><span class="op" id="3879918">)</span><span class="op" id="3879919">;</span>&nbsp;<span class="ident" id="3879921"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3879925">!=</span>&nbsp;<span class="ident" id="3879928">nil</span>&nbsp;<span class="op" id="3879932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3879940"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3879941">.</span><span class="ident" id="3879942">sendAlert</span><span class="op" id="3879951">(</span><span class="ident" id="3879952"><a href="/crypto/tls/alert.go.html#3811348">alertInternalError</a></span><span class="op" id="3879970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3879978">return</span>&nbsp;<span class="ident" id="3879985"><a href="/crypto/tls/handshake_client.go.html#3870836">errors</a></span><span class="op" id="3879991">.</span><span class="ident" id="3879992">New</span><span class="op" id="3879995">(</span><span class="string" id="3879996">&#34;tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;client&nbsp;certificate&nbsp;#&#34;</span>&nbsp;<span class="op" id="3880040">+</span>&nbsp;<span class="ident" id="3880042"><a href="/crypto/tls/handshake_client.go.html#3870866">strconv</a></span><span class="op" id="3880049">.</span><span class="ident" id="3880050">Itoa</span><span class="op" id="3880054">(</span><span class="ident" id="3880055"><a href="/crypto/tls/handshake_client.go.html#3879578">i</a></span><span class="op" id="3880056">)</span>&nbsp;<span class="op" id="3880058">+</span>&nbsp;<span class="string" id="3880060">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3880065">+</span>&nbsp;<span class="ident" id="3880067"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span><span class="op" id="3880070">.</span><span class="ident" id="3880071">Error</span><span class="op" id="3880076">(</span><span class="op" id="3880077">)</span><span class="op" id="3880078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3880085">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3880091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880098">switch</span>&nbsp;<span class="op" id="3880105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880111">case</span>&nbsp;<span class="ident" id="3880116"><a href="/crypto/tls/handshake_client.go.html#3879185">rsaAvail</a></span>&nbsp;<span class="op" id="3880125">&amp;&amp;</span>&nbsp;<span class="ident" id="3880128"><a href="/crypto/tls/handshake_client.go.html#3879720">x509Cert</a></span><span class="op" id="3880136">.</span><span class="ident" id="3880137">PublicKeyAlgorithm</span>&nbsp;<span class="op" id="3880156">==</span>&nbsp;<span class="ident" id="3880159"><a href="/crypto/tls/handshake_client.go.html#3870821">x509</a></span><span class="op" id="3880163">.</span><span class="ident" id="3880164">RSA</span><span class="op" id="3880167">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880173">case</span>&nbsp;<span class="ident" id="3880178"><a href="/crypto/tls/handshake_client.go.html#3879195">ecdsaAvail</a></span>&nbsp;<span class="op" id="3880189">&amp;&amp;</span>&nbsp;<span class="ident" id="3880192"><a href="/crypto/tls/handshake_client.go.html#3879720">x509Cert</a></span><span class="op" id="3880200">.</span><span class="ident" id="3880201">PublicKeyAlgorithm</span>&nbsp;<span class="op" id="3880220">==</span>&nbsp;<span class="ident" id="3880223"><a href="/crypto/tls/handshake_client.go.html#3870821">x509</a></span><span class="op" id="3880227">.</span><span class="ident" id="3880228">ECDSA</span><span class="op" id="3880233">:</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880239">default</span><span class="op" id="3880246">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880253">continue</span>&nbsp;<span class="ident" id="3880262">findCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3880275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880282">if</span>&nbsp;<span class="builtinfunc" id="3880285">len</span><span class="op" id="3880288">(</span><span class="ident" id="3880289"><a href="/crypto/tls/handshake_client.go.html#3878500">certReq</a></span><span class="op" id="3880296">.</span><span class="ident" id="3880297">certificateAuthorities</span><span class="op" id="3880319">)</span>&nbsp;<span class="op" id="3880321">==</span>&nbsp;<span class="num" id="3880324">0</span>&nbsp;<span class="op" id="3880326">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3880333">//&nbsp;they&nbsp;gave&nbsp;us&nbsp;an&nbsp;empty&nbsp;list,&nbsp;so&nbsp;just&nbsp;take&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3880386">//&nbsp;first&nbsp;cert&nbsp;from&nbsp;c.config.Certificates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3880432"><a href="/crypto/tls/handshake_client.go.html#3878450">chainToSend</a></span>&nbsp;<span class="op" id="3880444">=</span>&nbsp;<span class="op" id="3880446">&amp;</span><span class="ident" id="3880447"><a href="/crypto/tls/handshake_client.go.html#3879581">chain</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880458">break</span>&nbsp;<span class="ident" id="3880464">findCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3880477">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880484">for</span>&nbsp;<span class="ident" id="3880488">_</span><span class="op" id="3880489">,</span>&nbsp;<span class="ident" id="3880491">ca</span>&nbsp;<span class="op" id="3880494">:=</span>&nbsp;<span class="keyword" id="3880497">range</span>&nbsp;<span class="ident" id="3880503"><a href="/crypto/tls/handshake_client.go.html#3878500">certReq</a></span><span class="op" id="3880510">.</span><span class="ident" id="3880511">certificateAuthorities</span>&nbsp;<span class="op" id="3880534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880541">if</span>&nbsp;<span class="ident" id="3880544"><a href="/crypto/tls/handshake_client.go.html#3870755">bytes</a></span><span class="op" id="3880549">.</span><span class="ident" id="3880550">Equal</span><span class="op" id="3880555">(</span><span class="ident" id="3880556"><a href="/crypto/tls/handshake_client.go.html#3879720">x509Cert</a></span><span class="op" id="3880564">.</span><span class="ident" id="3880565">RawIssuer</span><span class="op" id="3880574">,</span>&nbsp;<span class="ident" id="3880576"><a href="/crypto/tls/handshake_client.go.html#3880491">ca</a></span><span class="op" id="3880578">)</span>&nbsp;<span class="op" id="3880580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3880588"><a href="/crypto/tls/handshake_client.go.html#3878450">chainToSend</a></span>&nbsp;<span class="op" id="3880600">=</span>&nbsp;<span class="op" id="3880602">&amp;</span><span class="ident" id="3880603"><a href="/crypto/tls/handshake_client.go.html#3879581">chain</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880615">break</span>&nbsp;<span class="ident" id="3880621">findCert</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3880635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3880641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3880646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3880650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3880655"><a href="/crypto/tls/handshake_client.go.html#3876325">msg</a></span><span class="op" id="3880658">,</span>&nbsp;<span class="ident" id="3880660"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3880664">=</span>&nbsp;<span class="ident" id="3880666"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3880667">.</span><span class="ident" id="3880668">readHandshake</span><span class="op" id="3880681">(</span><span class="op" id="3880682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880686">if</span>&nbsp;<span class="ident" id="3880689"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3880693">!=</span>&nbsp;<span class="ident" id="3880696">nil</span>&nbsp;<span class="op" id="3880700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880705">return</span>&nbsp;<span class="ident" id="3880712"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3880718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3880721">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3880725">shd</span><span class="op" id="3880728">,</span>&nbsp;<span class="ident" id="3880730"><a href="/crypto/tls/handshake_client.go.html#3876398">ok</a></span>&nbsp;<span class="op" id="3880733">:=</span>&nbsp;<span class="ident" id="3880736"><a href="/crypto/tls/handshake_client.go.html#3876325">msg</a></span><span class="op" id="3880739">.</span><span class="op" id="3880740">(</span><span class="op" id="3880741">*</span><span class="ident" id="3880742"><a href="/crypto/tls/handshake_messages.go.html#3908750">serverHelloDoneMsg</a></span><span class="op" id="3880760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880763">if</span>&nbsp;<span class="op" id="3880766">!</span><span class="ident" id="3880767"><a href="/crypto/tls/handshake_client.go.html#3876398">ok</a></span>&nbsp;<span class="op" id="3880770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3880774"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3880775">.</span><span class="ident" id="3880776">sendAlert</span><span class="op" id="3880785">(</span><span class="ident" id="3880786"><a href="/crypto/tls/alert.go.html#3810628">alertUnexpectedMessage</a></span><span class="op" id="3880808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880812">return</span>&nbsp;<span class="ident" id="3880819"><a href="/crypto/tls/common.go.html#3841643">unexpectedMessageError</a></span><span class="op" id="3880841">(</span><span class="ident" id="3880842"><a href="/crypto/tls/handshake_client.go.html#3880725">shd</a></span><span class="op" id="3880845">,</span>&nbsp;<span class="ident" id="3880847"><a href="/crypto/tls/handshake_client.go.html#3876325">msg</a></span><span class="op" id="3880850">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3880853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3880856"><a href="/crypto/tls/handshake_client.go.html#3876260">hs</a></span><span class="op" id="3880858">.</span><span class="ident" id="3880859">finishedHash</span><span class="op" id="3880871">.</span><span class="ident" id="3880872">Write</span><span class="op" id="3880877">(</span><span class="ident" id="3880878"><a href="/crypto/tls/handshake_client.go.html#3880725">shd</a></span><span class="op" id="3880881">.</span><span class="ident" id="3880882">marshal</span><span class="op" id="3880889">(</span><span class="op" id="3880890">)</span><span class="op" id="3880891">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3880895">//&nbsp;If&nbsp;the&nbsp;server&nbsp;requested&nbsp;a&nbsp;certificate&nbsp;then&nbsp;we&nbsp;have&nbsp;to&nbsp;send&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3880960">//&nbsp;Certificate&nbsp;message,&nbsp;even&nbsp;if&nbsp;it&#39;s&nbsp;empty&nbsp;because&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3881028">//&nbsp;certificate&nbsp;to&nbsp;send.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3881053">if</span>&nbsp;<span class="ident" id="3881056"><a href="/crypto/tls/handshake_client.go.html#3878480">certRequested</a></span>&nbsp;<span class="op" id="3881070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3881074"><a href="/crypto/tls/handshake_client.go.html#3876389">certMsg</a></span>&nbsp;<span class="op" id="3881082">=</span>&nbsp;<span class="builtinfunc" id="3881084">new</span><span class="op" id="3881087">(</span><span class="ident" id="3881088"><a href="/crypto/tls/handshake_messages.go.html#3905092">certificateMsg</a></span><span class="op" id="3881102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3881106">if</span>&nbsp;<span class="ident" id="3881109"><a href="/crypto/tls/handshake_client.go.html#3878450">chainToSend</a></span>&nbsp;<span class="op" id="3881121">!=</span>&nbsp;<span class="ident" id="3881124">nil</span>&nbsp;<span class="op" id="3881128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3881133"><a href="/crypto/tls/handshake_client.go.html#3876389">certMsg</a></span><span class="op" id="3881140">.</span><span class="ident" id="3881141">certificates</span>&nbsp;<span class="op" id="3881154">=</span>&nbsp;<span class="ident" id="3881156"><a href="/crypto/tls/handshake_client.go.html#3878450">chainToSend</a></span><span class="op" id="3881167">.</span><span class="ident" id="3881168">Certificate</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3881182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3881186"><a href="/crypto/tls/handshake_client.go.html#3876260">hs</a></span><span class="op" id="3881188">.</span><span class="ident" id="3881189">finishedHash</span><span class="op" id="3881201">.</span><span class="ident" id="3881202">Write</span><span class="op" id="3881207">(</span><span class="ident" id="3881208"><a href="/crypto/tls/handshake_client.go.html#3876389">certMsg</a></span><span class="op" id="3881215">.</span><span class="ident" id="3881216">marshal</span><span class="op" id="3881223">(</span><span class="op" id="3881224">)</span><span class="op" id="3881225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3881229"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3881230">.</span><span class="ident" id="3881231">writeRecord</span><span class="op" id="3881242">(</span><span class="ident" id="3881243"><a href="/crypto/tls/common.go.html#3823354">recordTypeHandshake</a></span><span class="op" id="3881262">,</span>&nbsp;<span class="ident" id="3881264"><a href="/crypto/tls/handshake_client.go.html#3876389">certMsg</a></span><span class="op" id="3881271">.</span><span class="ident" id="3881272">marshal</span><span class="op" id="3881279">(</span><span class="op" id="3881280">)</span><span class="op" id="3881281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3881284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3881288">preMasterSecret</span><span class="op" id="3881303">,</span>&nbsp;<span class="ident" id="3881305">ckx</span><span class="op" id="3881308">,</span>&nbsp;<span class="ident" id="3881310"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3881314">:=</span>&nbsp;<span class="ident" id="3881317"><a href="/crypto/tls/handshake_client.go.html#3878076">keyAgreement</a></span><span class="op" id="3881329">.</span><span class="ident" id="3881330">generateClientKeyExchange</span><span class="op" id="3881355">(</span><span class="ident" id="3881356"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3881357">.</span><span class="ident" id="3881358">config</span><span class="op" id="3881364">,</span>&nbsp;<span class="ident" id="3881366"><a href="/crypto/tls/handshake_client.go.html#3876260">hs</a></span><span class="op" id="3881368">.</span><span class="ident" id="3881369">hello</span><span class="op" id="3881374">,</span>&nbsp;<span class="ident" id="3881376"><a href="/crypto/tls/handshake_client.go.html#3876601">certs</a></span><span class="op" id="3881381">[</span><span class="num" id="3881382">0</span><span class="op" id="3881383">]</span><span class="op" id="3881384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3881387">if</span>&nbsp;<span class="ident" id="3881390"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3881394">!=</span>&nbsp;<span class="ident" id="3881397">nil</span>&nbsp;<span class="op" id="3881401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3881405"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3881406">.</span><span class="ident" id="3881407">sendAlert</span><span class="op" id="3881416">(</span><span class="ident" id="3881417"><a href="/crypto/tls/alert.go.html#3811348">alertInternalError</a></span><span class="op" id="3881435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3881439">return</span>&nbsp;<span class="ident" id="3881446"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3881451">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3881454">if</span>&nbsp;<span class="ident" id="3881457"><a href="/crypto/tls/handshake_client.go.html#3881305">ckx</a></span>&nbsp;<span class="op" id="3881461">!=</span>&nbsp;<span class="ident" id="3881464">nil</span>&nbsp;<span class="op" id="3881468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3881472"><a href="/crypto/tls/handshake_client.go.html#3876260">hs</a></span><span class="op" id="3881474">.</span><span class="ident" id="3881475">finishedHash</span><span class="op" id="3881487">.</span><span class="ident" id="3881488">Write</span><span class="op" id="3881493">(</span><span class="ident" id="3881494"><a href="/crypto/tls/handshake_client.go.html#3881305">ckx</a></span><span class="op" id="3881497">.</span><span class="ident" id="3881498">marshal</span><span class="op" id="3881505">(</span><span class="op" id="3881506">)</span><span class="op" id="3881507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3881511"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3881512">.</span><span class="ident" id="3881513">writeRecord</span><span class="op" id="3881524">(</span><span class="ident" id="3881525"><a href="/crypto/tls/common.go.html#3823354">recordTypeHandshake</a></span><span class="op" id="3881544">,</span>&nbsp;<span class="ident" id="3881546"><a href="/crypto/tls/handshake_client.go.html#3881305">ckx</a></span><span class="op" id="3881549">.</span><span class="ident" id="3881550">marshal</span><span class="op" id="3881557">(</span><span class="op" id="3881558">)</span><span class="op" id="3881559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3881562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3881566">if</span>&nbsp;<span class="ident" id="3881569"><a href="/crypto/tls/handshake_client.go.html#3878450">chainToSend</a></span>&nbsp;<span class="op" id="3881581">!=</span>&nbsp;<span class="ident" id="3881584">nil</span>&nbsp;<span class="op" id="3881588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3881592">var</span>&nbsp;<span class="ident" id="3881596">signed</span>&nbsp;<span class="op" id="3881603">[</span><span class="op" id="3881604">]</span><span class="builtintype" id="3881605">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3881612">certVerify</span>&nbsp;<span class="op" id="3881623">:=</span>&nbsp;<span class="op" id="3881626">&amp;</span><span class="ident" id="3881627"><a href="/crypto/tls/handshake_messages.go.html#3915062">certificateVerifyMsg</a></span><span class="op" id="3881647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3881652">hasSignatureAndHash</span><span class="op" id="3881671">:</span>&nbsp;<span class="ident" id="3881673"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3881674">.</span><span class="ident" id="3881675">vers</span>&nbsp;<span class="op" id="3881680">&gt;=</span>&nbsp;<span class="ident" id="3881683"><a href="/crypto/tls/common.go.html#3822841">VersionTLS12</a></span><span class="op" id="3881695">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3881699">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3881704">key</span><span class="op" id="3881707">,</span>&nbsp;<span class="ident" id="3881709">ok</span>&nbsp;<span class="op" id="3881712">:=</span>&nbsp;<span class="ident" id="3881715"><a href="/crypto/tls/handshake_client.go.html#3878450">chainToSend</a></span><span class="op" id="3881726">.</span><span class="ident" id="3881727">PrivateKey</span><span class="op" id="3881737">.</span><span class="op" id="3881738">(</span><span class="ident" id="3881739"><a href="/crypto/tls/handshake_client.go.html#3870764">crypto</a></span><span class="op" id="3881745">.</span><span class="ident" id="3881746">Signer</span><span class="op" id="3881752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3881756">if</span>&nbsp;<span class="op" id="3881759">!</span><span class="ident" id="3881760"><a href="/crypto/tls/handshake_client.go.html#3881709">ok</a></span>&nbsp;<span class="op" id="3881763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3881768"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3881769">.</span><span class="ident" id="3881770">sendAlert</span><span class="op" id="3881779">(</span><span class="ident" id="3881780"><a href="/crypto/tls/alert.go.html#3811348">alertInternalError</a></span><span class="op" id="3881798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3881803">return</span>&nbsp;<span class="ident" id="3881810"><a href="/crypto/tls/handshake_client.go.html#3870846">fmt</a></span><span class="op" id="3881813">.</span><span class="ident" id="3881814">Errorf</span><span class="op" id="3881820">(</span><span class="string" id="3881821">&#34;tls:&nbsp;client&nbsp;certificate&nbsp;private&nbsp;key&nbsp;of&nbsp;type&nbsp;%T&nbsp;does&nbsp;not&nbsp;implement&nbsp;crypto.Signer&#34;</span><span class="op" id="3881902">,</span>&nbsp;<span class="ident" id="3881904"><a href="/crypto/tls/handshake_client.go.html#3878450">chainToSend</a></span><span class="op" id="3881915">.</span><span class="ident" id="3881916">PrivateKey</span><span class="op" id="3881926">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3881930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3881934">switch</span>&nbsp;<span class="ident" id="3881941"><a href="/crypto/tls/handshake_client.go.html#3881704">key</a></span><span class="op" id="3881944">.</span><span class="ident" id="3881945">Public</span><span class="op" id="3881951">(</span><span class="op" id="3881952">)</span><span class="op" id="3881953">.</span><span class="op" id="3881954">(</span><span class="keyword" id="3881955">type</span><span class="op" id="3881959">)</span>&nbsp;<span class="op" id="3881961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3881965">case</span>&nbsp;<span class="op" id="3881970">*</span><span class="ident" id="3881971"><a href="/crypto/tls/handshake_client.go.html#3870774">ecdsa</a></span><span class="op" id="3881976">.</span><span class="ident" id="3881977">PublicKey</span><span class="op" id="3881986">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3881991">digest</span><span class="op" id="3881997">,</span>&nbsp;<span class="ident" id="3881999">hashFunc</span><span class="op" id="3882007">,</span>&nbsp;<span class="ident" id="3882009">hashId</span>&nbsp;<span class="op" id="3882016">:=</span>&nbsp;<span class="ident" id="3882019"><a href="/crypto/tls/handshake_client.go.html#3876260">hs</a></span><span class="op" id="3882021">.</span><span class="ident" id="3882022">finishedHash</span><span class="op" id="3882034">.</span><span class="ident" id="3882035">hashForClientCertificate</span><span class="op" id="3882059">(</span><span class="ident" id="3882060"><a href="/crypto/tls/common.go.html#3825950">signatureECDSA</a></span><span class="op" id="3882074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882079"><a href="/crypto/tls/handshake_client.go.html#3881596">signed</a></span><span class="op" id="3882085">,</span>&nbsp;<span class="ident" id="3882087"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3882091">=</span>&nbsp;<span class="ident" id="3882093"><a href="/crypto/tls/handshake_client.go.html#3881704">key</a></span><span class="op" id="3882096">.</span><span class="ident" id="3882097">Sign</span><span class="op" id="3882101">(</span><span class="ident" id="3882102"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3882103">.</span><span class="ident" id="3882104">config</span><span class="op" id="3882110">.</span><span class="ident" id="3882111">rand</span><span class="op" id="3882115">(</span><span class="op" id="3882116">)</span><span class="op" id="3882117">,</span>&nbsp;<span class="ident" id="3882119"><a href="/crypto/tls/handshake_client.go.html#3881991">digest</a></span><span class="op" id="3882125">,</span>&nbsp;<span class="ident" id="3882127"><a href="/crypto/tls/handshake_client.go.html#3881999">hashFunc</a></span><span class="op" id="3882135">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882140"><a href="/crypto/tls/handshake_client.go.html#3881612">certVerify</a></span><span class="op" id="3882150">.</span><span class="ident" id="3882151">signatureAndHash</span><span class="op" id="3882167">.</span><span class="ident" id="3882168">signature</span>&nbsp;<span class="op" id="3882178">=</span>&nbsp;<span class="ident" id="3882180"><a href="/crypto/tls/common.go.html#3825950">signatureECDSA</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882198"><a href="/crypto/tls/handshake_client.go.html#3881612">certVerify</a></span><span class="op" id="3882208">.</span><span class="ident" id="3882209">signatureAndHash</span><span class="op" id="3882225">.</span><span class="ident" id="3882226">hash</span>&nbsp;<span class="op" id="3882231">=</span>&nbsp;<span class="ident" id="3882233"><a href="/crypto/tls/handshake_client.go.html#3882009">hashId</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3882242">case</span>&nbsp;<span class="op" id="3882247">*</span><span class="ident" id="3882248"><a href="/crypto/tls/handshake_client.go.html#3870790">rsa</a></span><span class="op" id="3882251">.</span><span class="ident" id="3882252">PublicKey</span><span class="op" id="3882261">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882266">digest</span><span class="op" id="3882272">,</span>&nbsp;<span class="ident" id="3882274">hashFunc</span><span class="op" id="3882282">,</span>&nbsp;<span class="ident" id="3882284">hashId</span>&nbsp;<span class="op" id="3882291">:=</span>&nbsp;<span class="ident" id="3882294"><a href="/crypto/tls/handshake_client.go.html#3876260">hs</a></span><span class="op" id="3882296">.</span><span class="ident" id="3882297">finishedHash</span><span class="op" id="3882309">.</span><span class="ident" id="3882310">hashForClientCertificate</span><span class="op" id="3882334">(</span><span class="ident" id="3882335"><a href="/crypto/tls/common.go.html#3825924">signatureRSA</a></span><span class="op" id="3882347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882352"><a href="/crypto/tls/handshake_client.go.html#3881596">signed</a></span><span class="op" id="3882358">,</span>&nbsp;<span class="ident" id="3882360"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3882364">=</span>&nbsp;<span class="ident" id="3882366"><a href="/crypto/tls/handshake_client.go.html#3881704">key</a></span><span class="op" id="3882369">.</span><span class="ident" id="3882370">Sign</span><span class="op" id="3882374">(</span><span class="ident" id="3882375"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3882376">.</span><span class="ident" id="3882377">config</span><span class="op" id="3882383">.</span><span class="ident" id="3882384">rand</span><span class="op" id="3882388">(</span><span class="op" id="3882389">)</span><span class="op" id="3882390">,</span>&nbsp;<span class="ident" id="3882392"><a href="/crypto/tls/handshake_client.go.html#3882266">digest</a></span><span class="op" id="3882398">,</span>&nbsp;<span class="ident" id="3882400"><a href="/crypto/tls/handshake_client.go.html#3882274">hashFunc</a></span><span class="op" id="3882408">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882413"><a href="/crypto/tls/handshake_client.go.html#3881612">certVerify</a></span><span class="op" id="3882423">.</span><span class="ident" id="3882424">signatureAndHash</span><span class="op" id="3882440">.</span><span class="ident" id="3882441">signature</span>&nbsp;<span class="op" id="3882451">=</span>&nbsp;<span class="ident" id="3882453"><a href="/crypto/tls/common.go.html#3825924">signatureRSA</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882469"><a href="/crypto/tls/handshake_client.go.html#3881612">certVerify</a></span><span class="op" id="3882479">.</span><span class="ident" id="3882480">signatureAndHash</span><span class="op" id="3882496">.</span><span class="ident" id="3882497">hash</span>&nbsp;<span class="op" id="3882502">=</span>&nbsp;<span class="ident" id="3882504"><a href="/crypto/tls/handshake_client.go.html#3882284">hashId</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3882513">default</span><span class="op" id="3882520">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882525"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3882529">=</span>&nbsp;<span class="ident" id="3882531"><a href="/crypto/tls/handshake_client.go.html#3870846">fmt</a></span><span class="op" id="3882534">.</span><span class="ident" id="3882535">Errorf</span><span class="op" id="3882541">(</span><span class="string" id="3882542">&#34;tls:&nbsp;unknown&nbsp;client&nbsp;certificate&nbsp;key&nbsp;type:&nbsp;%T&#34;</span><span class="op" id="3882588">,</span>&nbsp;<span class="ident" id="3882590"><a href="/crypto/tls/handshake_client.go.html#3881704">key</a></span><span class="op" id="3882593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3882597">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3882601">if</span>&nbsp;<span class="ident" id="3882604"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span>&nbsp;<span class="op" id="3882608">!=</span>&nbsp;<span class="ident" id="3882611">nil</span>&nbsp;<span class="op" id="3882615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882620"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3882621">.</span><span class="ident" id="3882622">sendAlert</span><span class="op" id="3882631">(</span><span class="ident" id="3882632"><a href="/crypto/tls/alert.go.html#3811348">alertInternalError</a></span><span class="op" id="3882650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3882655">return</span>&nbsp;<span class="ident" id="3882662"><a href="/crypto/tls/handshake_client.go.html#3870836">errors</a></span><span class="op" id="3882668">.</span><span class="ident" id="3882669">New</span><span class="op" id="3882672">(</span><span class="string" id="3882673">&#34;tls:&nbsp;failed&nbsp;to&nbsp;sign&nbsp;handshake&nbsp;with&nbsp;client&nbsp;certificate:&nbsp;&#34;</span>&nbsp;<span class="op" id="3882731">+</span>&nbsp;<span class="ident" id="3882733"><a href="/crypto/tls/handshake_client.go.html#3876330">err</a></span><span class="op" id="3882736">.</span><span class="ident" id="3882737">Error</span><span class="op" id="3882742">(</span><span class="op" id="3882743">)</span><span class="op" id="3882744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3882748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882752"><a href="/crypto/tls/handshake_client.go.html#3881612">certVerify</a></span><span class="op" id="3882762">.</span><span class="ident" id="3882763">signature</span>&nbsp;<span class="op" id="3882773">=</span>&nbsp;<span class="ident" id="3882775"><a href="/crypto/tls/handshake_client.go.html#3881596">signed</a></span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882785"><a href="/crypto/tls/handshake_client.go.html#3876260">hs</a></span><span class="op" id="3882787">.</span><span class="ident" id="3882788">finishedHash</span><span class="op" id="3882800">.</span><span class="ident" id="3882801">Write</span><span class="op" id="3882806">(</span><span class="ident" id="3882807"><a href="/crypto/tls/handshake_client.go.html#3881612">certVerify</a></span><span class="op" id="3882817">.</span><span class="ident" id="3882818">marshal</span><span class="op" id="3882825">(</span><span class="op" id="3882826">)</span><span class="op" id="3882827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882831"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3882832">.</span><span class="ident" id="3882833">writeRecord</span><span class="op" id="3882844">(</span><span class="ident" id="3882845"><a href="/crypto/tls/common.go.html#3823354">recordTypeHandshake</a></span><span class="op" id="3882864">,</span>&nbsp;<span class="ident" id="3882866"><a href="/crypto/tls/handshake_client.go.html#3881612">certVerify</a></span><span class="op" id="3882876">.</span><span class="ident" id="3882877">marshal</span><span class="op" id="3882884">(</span><span class="op" id="3882885">)</span><span class="op" id="3882886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3882889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882893"><a href="/crypto/tls/handshake_client.go.html#3876260">hs</a></span><span class="op" id="3882895">.</span><span class="ident" id="3882896">masterSecret</span>&nbsp;<span class="op" id="3882909">=</span>&nbsp;<span class="ident" id="3882911"><a href="/crypto/tls/prf.go.html#3954335">masterFromPreMasterSecret</a></span><span class="op" id="3882936">(</span><span class="ident" id="3882937"><a href="/crypto/tls/handshake_client.go.html#3876313">c</a></span><span class="op" id="3882938">.</span><span class="ident" id="3882939">vers</span><span class="op" id="3882943">,</span>&nbsp;<span class="ident" id="3882945"><a href="/crypto/tls/handshake_client.go.html#3881288">preMasterSecret</a></span><span class="op" id="3882960">,</span>&nbsp;<span class="ident" id="3882962"><a href="/crypto/tls/handshake_client.go.html#3876260">hs</a></span><span class="op" id="3882964">.</span><span class="ident" id="3882965">hello</span><span class="op" id="3882970">.</span><span class="ident" id="3882971">random</span><span class="op" id="3882977">,</span>&nbsp;<span class="ident" id="3882979"><a href="/crypto/tls/handshake_client.go.html#3876260">hs</a></span><span class="op" id="3882981">.</span><span class="ident" id="3882982">serverHello</span><span class="op" id="3882993">.</span><span class="ident" id="3882994">random</span><span class="op" id="3883000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3883003">return</span>&nbsp;<span class="ident" id="3883010">nil</span><br>
<span class="lineno"></span><span class="op" id="3883014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3883017">func</span>&nbsp;<span class="op" id="3883022">(</span><span class="ident" id="3883023">hs</span>&nbsp;<span class="op" id="3883026">*</span><span class="ident" id="3883027"><a href="/crypto/tls/handshake_client.go.html#3870884">clientHandshakeState</a></span><span class="op" id="3883047">)</span>&nbsp;<span class="ident" id="3883049">establishKeys</span><span class="op" id="3883062">(</span><span class="op" id="3883063">)</span>&nbsp;<span class="builtintype" id="3883065">error</span>&nbsp;<span class="op" id="3883071">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883074">c</span>&nbsp;<span class="op" id="3883076">:=</span>&nbsp;<span class="ident" id="3883079"><a href="/crypto/tls/handshake_client.go.html#3883023">hs</a></span><span class="op" id="3883081">.</span><span class="ident" id="3883082">c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883086">clientMAC</span><span class="op" id="3883095">,</span>&nbsp;<span class="ident" id="3883097">serverMAC</span><span class="op" id="3883106">,</span>&nbsp;<span class="ident" id="3883108">clientKey</span><span class="op" id="3883117">,</span>&nbsp;<span class="ident" id="3883119">serverKey</span><span class="op" id="3883128">,</span>&nbsp;<span class="ident" id="3883130">clientIV</span><span class="op" id="3883138">,</span>&nbsp;<span class="ident" id="3883140">serverIV</span>&nbsp;<span class="op" id="3883149">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883154"><a href="/crypto/tls/prf.go.html#3954904">keysFromMasterSecret</a></span><span class="op" id="3883174">(</span><span class="ident" id="3883175"><a href="/crypto/tls/handshake_client.go.html#3883074">c</a></span><span class="op" id="3883176">.</span><span class="ident" id="3883177">vers</span><span class="op" id="3883181">,</span>&nbsp;<span class="ident" id="3883183"><a href="/crypto/tls/handshake_client.go.html#3883023">hs</a></span><span class="op" id="3883185">.</span><span class="ident" id="3883186">masterSecret</span><span class="op" id="3883198">,</span>&nbsp;<span class="ident" id="3883200"><a href="/crypto/tls/handshake_client.go.html#3883023">hs</a></span><span class="op" id="3883202">.</span><span class="ident" id="3883203">hello</span><span class="op" id="3883208">.</span><span class="ident" id="3883209">random</span><span class="op" id="3883215">,</span>&nbsp;<span class="ident" id="3883217"><a href="/crypto/tls/handshake_client.go.html#3883023">hs</a></span><span class="op" id="3883219">.</span><span class="ident" id="3883220">serverHello</span><span class="op" id="3883231">.</span><span class="ident" id="3883232">random</span><span class="op" id="3883238">,</span>&nbsp;<span class="ident" id="3883240"><a href="/crypto/tls/handshake_client.go.html#3883023">hs</a></span><span class="op" id="3883242">.</span><span class="ident" id="3883243">suite</span><span class="op" id="3883248">.</span><span class="ident" id="3883249">macLen</span><span class="op" id="3883255">,</span>&nbsp;<span class="ident" id="3883257"><a href="/crypto/tls/handshake_client.go.html#3883023">hs</a></span><span class="op" id="3883259">.</span><span class="ident" id="3883260">suite</span><span class="op" id="3883265">.</span><span class="ident" id="3883266">keyLen</span><span class="op" id="3883272">,</span>&nbsp;<span class="ident" id="3883274"><a href="/crypto/tls/handshake_client.go.html#3883023">hs</a></span><span class="op" id="3883276">.</span><span class="ident" id="3883277">suite</span><span class="op" id="3883282">.</span><span class="ident" id="3883283">ivLen</span><span class="op" id="3883288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3883291">var</span>&nbsp;<span class="ident" id="3883295">clientCipher</span><span class="op" id="3883307">,</span>&nbsp;<span class="ident" id="3883309">serverCipher</span>&nbsp;<span class="keyword" id="3883322">interface</span><span class="op" id="3883331">{</span><span class="op" id="3883332">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3883335">var</span>&nbsp;<span class="ident" id="3883339">clientHash</span><span class="op" id="3883349">,</span>&nbsp;<span class="ident" id="3883351">serverHash</span>&nbsp;<span class="ident" id="3883362"><a href="/crypto/tls/cipher_suites.go.html#3817704">macFunction</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3883375">if</span>&nbsp;<span class="ident" id="3883378"><a href="/crypto/tls/handshake_client.go.html#3883023">hs</a></span><span class="op" id="3883380">.</span><span class="ident" id="3883381">suite</span><span class="op" id="3883386">.</span><span class="ident" id="3883387">cipher</span>&nbsp;<span class="op" id="3883394">!=</span>&nbsp;<span class="ident" id="3883397">nil</span>&nbsp;<span class="op" id="3883401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883405"><a href="/crypto/tls/handshake_client.go.html#3883295">clientCipher</a></span>&nbsp;<span class="op" id="3883418">=</span>&nbsp;<span class="ident" id="3883420"><a href="/crypto/tls/handshake_client.go.html#3883023">hs</a></span><span class="op" id="3883422">.</span><span class="ident" id="3883423">suite</span><span class="op" id="3883428">.</span><span class="ident" id="3883429">cipher</span><span class="op" id="3883435">(</span><span class="ident" id="3883436"><a href="/crypto/tls/handshake_client.go.html#3883108">clientKey</a></span><span class="op" id="3883445">,</span>&nbsp;<span class="ident" id="3883447"><a href="/crypto/tls/handshake_client.go.html#3883130">clientIV</a></span><span class="op" id="3883455">,</span>&nbsp;<span class="builtintype" id="3883457">false</span>&nbsp;<span class="comment" id="3883463">/*&nbsp;not&nbsp;for&nbsp;reading&nbsp;*/</span><span class="op" id="3883484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883488"><a href="/crypto/tls/handshake_client.go.html#3883339">clientHash</a></span>&nbsp;<span class="op" id="3883499">=</span>&nbsp;<span class="ident" id="3883501"><a href="/crypto/tls/handshake_client.go.html#3883023">hs</a></span><span class="op" id="3883503">.</span><span class="ident" id="3883504">suite</span><span class="op" id="3883509">.</span><span class="ident" id="3883510">mac</span><span class="op" id="3883513">(</span><span class="ident" id="3883514"><a href="/crypto/tls/handshake_client.go.html#3883074">c</a></span><span class="op" id="3883515">.</span><span class="ident" id="3883516">vers</span><span class="op" id="3883520">,</span>&nbsp;<span class="ident" id="3883522"><a href="/crypto/tls/handshake_client.go.html#3883086">clientMAC</a></span><span class="op" id="3883531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883535"><a href="/crypto/tls/handshake_client.go.html#3883309">serverCipher</a></span>&nbsp;<span class="op" id="3883548">=</span>&nbsp;<span class="ident" id="3883550"><a href="/crypto/tls/handshake_client.go.html#3883023">hs</a></span><span class="op" id="3883552">.</span><span class="ident" id="3883553">suite</span><span class="op" id="3883558">.</span><span class="ident" id="3883559">cipher</span><span class="op" id="3883565">(</span><span class="ident" id="3883566"><a href="/crypto/tls/handshake_client.go.html#3883119">serverKey</a></span><span class="op" id="3883575">,</span>&nbsp;<span class="ident" id="3883577"><a href="/crypto/tls/handshake_client.go.html#3883140">serverIV</a></span><span class="op" id="3883585">,</span>&nbsp;<span class="builtintype" id="3883587">true</span>&nbsp;<span class="comment" id="3883592">/*&nbsp;for&nbsp;reading&nbsp;*/</span><span class="op" id="3883609">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883613"><a href="/crypto/tls/handshake_client.go.html#3883351">serverHash</a></span>&nbsp;<span class="op" id="3883624">=</span>&nbsp;<span class="ident" id="3883626"><a href="/crypto/tls/handshake_client.go.html#3883023">hs</a></span><span class="op" id="3883628">.</span><span class="ident" id="3883629">suite</span><span class="op" id="3883634">.</span><span class="ident" id="3883635">mac</span><span class="op" id="3883638">(</span><span class="ident" id="3883639"><a href="/crypto/tls/handshake_client.go.html#3883074">c</a></span><span class="op" id="3883640">.</span><span class="ident" id="3883641">vers</span><span class="op" id="3883645">,</span>&nbsp;<span class="ident" id="3883647"><a href="/crypto/tls/handshake_client.go.html#3883097">serverMAC</a></span><span class="op" id="3883656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3883659">}</span>&nbsp;<span class="keyword" id="3883661">else</span>&nbsp;<span class="op" id="3883666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883670"><a href="/crypto/tls/handshake_client.go.html#3883295">clientCipher</a></span>&nbsp;<span class="op" id="3883683">=</span>&nbsp;<span class="ident" id="3883685"><a href="/crypto/tls/handshake_client.go.html#3883023">hs</a></span><span class="op" id="3883687">.</span><span class="ident" id="3883688">suite</span><span class="op" id="3883693">.</span><span class="ident" id="3883694">aead</span><span class="op" id="3883698">(</span><span class="ident" id="3883699"><a href="/crypto/tls/handshake_client.go.html#3883108">clientKey</a></span><span class="op" id="3883708">,</span>&nbsp;<span class="ident" id="3883710"><a href="/crypto/tls/handshake_client.go.html#3883130">clientIV</a></span><span class="op" id="3883718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883722"><a href="/crypto/tls/handshake_client.go.html#3883309">serverCipher</a></span>&nbsp;<span class="op" id="3883735">=</span>&nbsp;<span class="ident" id="3883737"><a href="/crypto/tls/handshake_client.go.html#3883023">hs</a></span><span class="op" id="3883739">.</span><span class="ident" id="3883740">suite</span><span class="op" id="3883745">.</span><span class="ident" id="3883746">aead</span><span class="op" id="3883750">(</span><span class="ident" id="3883751"><a href="/crypto/tls/handshake_client.go.html#3883119">serverKey</a></span><span class="op" id="3883760">,</span>&nbsp;<span class="ident" id="3883762"><a href="/crypto/tls/handshake_client.go.html#3883140">serverIV</a></span><span class="op" id="3883770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3883773">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883777"><a href="/crypto/tls/handshake_client.go.html#3883074">c</a></span><span class="op" id="3883778">.</span><span class="ident" id="3883779">in</span><span class="op" id="3883781">.</span><span class="ident" id="3883782">prepareCipherSpec</span><span class="op" id="3883799">(</span><span class="ident" id="3883800"><a href="/crypto/tls/handshake_client.go.html#3883074">c</a></span><span class="op" id="3883801">.</span><span class="ident" id="3883802">vers</span><span class="op" id="3883806">,</span>&nbsp;<span class="ident" id="3883808"><a href="/crypto/tls/handshake_client.go.html#3883309">serverCipher</a></span><span class="op" id="3883820">,</span>&nbsp;<span class="ident" id="3883822"><a href="/crypto/tls/handshake_client.go.html#3883351">serverHash</a></span><span class="op" id="3883832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883835"><a href="/crypto/tls/handshake_client.go.html#3883074">c</a></span><span class="op" id="3883836">.</span><span class="ident" id="3883837">out</span><span class="op" id="3883840">.</span><span class="ident" id="3883841">prepareCipherSpec</span><span class="op" id="3883858">(</span><span class="ident" id="3883859"><a href="/crypto/tls/handshake_client.go.html#3883074">c</a></span><span class="op" id="3883860">.</span><span class="ident" id="3883861">vers</span><span class="op" id="3883865">,</span>&nbsp;<span class="ident" id="3883867"><a href="/crypto/tls/handshake_client.go.html#3883295">clientCipher</a></span><span class="op" id="3883879">,</span>&nbsp;<span class="ident" id="3883881"><a href="/crypto/tls/handshake_client.go.html#3883339">clientHash</a></span><span class="op" id="3883891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3883894">return</span>&nbsp;<span class="ident" id="3883901">nil</span><br>
<span class="lineno"></span><span class="op" id="3883905">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="keyword" id="3883908">func</span>&nbsp;<span class="op" id="3883913">(</span><span class="ident" id="3883914">hs</span>&nbsp;<span class="op" id="3883917">*</span><span class="ident" id="3883918"><a href="/crypto/tls/handshake_client.go.html#3870884">clientHandshakeState</a></span><span class="op" id="3883938">)</span>&nbsp;<span class="ident" id="3883940">serverResumedSession</span><span class="op" id="3883960">(</span><span class="op" id="3883961">)</span>&nbsp;<span class="builtintype" id="3883963">bool</span>&nbsp;<span class="op" id="3883968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3883971">//&nbsp;If&nbsp;the&nbsp;server&nbsp;responded&nbsp;with&nbsp;the&nbsp;same&nbsp;sessionId&nbsp;then&nbsp;it&nbsp;means&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3884041">//&nbsp;sessionTicket&nbsp;is&nbsp;being&nbsp;used&nbsp;to&nbsp;resume&nbsp;a&nbsp;TLS&nbsp;session.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3884098">return</span>&nbsp;<span class="ident" id="3884105"><a href="/crypto/tls/handshake_client.go.html#3883914">hs</a></span><span class="op" id="3884107">.</span><span class="ident" id="3884108">session</span>&nbsp;<span class="op" id="3884116">!=</span>&nbsp;<span class="ident" id="3884119">nil</span>&nbsp;<span class="op" id="3884123">&amp;&amp;</span>&nbsp;<span class="ident" id="3884126"><a href="/crypto/tls/handshake_client.go.html#3883914">hs</a></span><span class="op" id="3884128">.</span><span class="ident" id="3884129">hello</span><span class="op" id="3884134">.</span><span class="ident" id="3884135">sessionId</span>&nbsp;<span class="op" id="3884145">!=</span>&nbsp;<span class="ident" id="3884148">nil</span>&nbsp;<span class="op" id="3884152">&amp;&amp;</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884157"><a href="/crypto/tls/handshake_client.go.html#3870755">bytes</a></span><span class="op" id="3884162">.</span><span class="ident" id="3884163">Equal</span><span class="op" id="3884168">(</span><span class="ident" id="3884169"><a href="/crypto/tls/handshake_client.go.html#3883914">hs</a></span><span class="op" id="3884171">.</span><span class="ident" id="3884172">serverHello</span><span class="op" id="3884183">.</span><span class="ident" id="3884184">sessionId</span><span class="op" id="3884193">,</span>&nbsp;<span class="ident" id="3884195"><a href="/crypto/tls/handshake_client.go.html#3883914">hs</a></span><span class="op" id="3884197">.</span><span class="ident" id="3884198">hello</span><span class="op" id="3884203">.</span><span class="ident" id="3884204">sessionId</span><span class="op" id="3884213">)</span><br>
<span class="lineno"></span><span class="op" id="3884215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3884218">func</span>&nbsp;<span class="op" id="3884223">(</span><span class="ident" id="3884224">hs</span>&nbsp;<span class="op" id="3884227">*</span><span class="ident" id="3884228"><a href="/crypto/tls/handshake_client.go.html#3870884">clientHandshakeState</a></span><span class="op" id="3884248">)</span>&nbsp;<span class="ident" id="3884250">processServerHello</span><span class="op" id="3884268">(</span><span class="op" id="3884269">)</span>&nbsp;<span class="op" id="3884271">(</span><span class="builtintype" id="3884272">bool</span><span class="op" id="3884276">,</span>&nbsp;<span class="builtintype" id="3884278">error</span><span class="op" id="3884283">)</span>&nbsp;<span class="op" id="3884285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884288">c</span>&nbsp;<span class="op" id="3884290">:=</span>&nbsp;<span class="ident" id="3884293"><a href="/crypto/tls/handshake_client.go.html#3884224">hs</a></span><span class="op" id="3884295">.</span><span class="ident" id="3884296">c</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3884300">if</span>&nbsp;<span class="ident" id="3884303"><a href="/crypto/tls/handshake_client.go.html#3884224">hs</a></span><span class="op" id="3884305">.</span><span class="ident" id="3884306">serverHello</span><span class="op" id="3884317">.</span><span class="ident" id="3884318">compressionMethod</span>&nbsp;<span class="op" id="3884336">!=</span>&nbsp;<span class="ident" id="3884339"><a href="/crypto/tls/common.go.html#3823960">compressionNone</a></span>&nbsp;<span class="op" id="3884355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884359"><a href="/crypto/tls/handshake_client.go.html#3884288">c</a></span><span class="op" id="3884360">.</span><span class="ident" id="3884361">sendAlert</span><span class="op" id="3884370">(</span><span class="ident" id="3884371"><a href="/crypto/tls/alert.go.html#3810628">alertUnexpectedMessage</a></span><span class="op" id="3884393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3884397">return</span>&nbsp;<span class="builtintype" id="3884404">false</span><span class="op" id="3884409">,</span>&nbsp;<span class="ident" id="3884411"><a href="/crypto/tls/handshake_client.go.html#3870836">errors</a></span><span class="op" id="3884417">.</span><span class="ident" id="3884418">New</span><span class="op" id="3884421">(</span><span class="string" id="3884422">&#34;tls:&nbsp;server&nbsp;selected&nbsp;unsupported&nbsp;compression&nbsp;format&#34;</span><span class="op" id="3884475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3884478">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884482">clientDidNPN</span>&nbsp;<span class="op" id="3884495">:=</span>&nbsp;<span class="ident" id="3884498"><a href="/crypto/tls/handshake_client.go.html#3884224">hs</a></span><span class="op" id="3884500">.</span><span class="ident" id="3884501">hello</span><span class="op" id="3884506">.</span><span class="ident" id="3884507">nextProtoNeg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884521">clientDidALPN</span>&nbsp;<span class="op" id="3884535">:=</span>&nbsp;<span class="builtinfunc" id="3884538">len</span><span class="op" id="3884541">(</span><span class="ident" id="3884542"><a href="/crypto/tls/handshake_client.go.html#3884224">hs</a></span><span class="op" id="3884544">.</span><span class="ident" id="3884545">hello</span><span class="op" id="3884550">.</span><span class="ident" id="3884551">alpnProtocols</span><span class="op" id="3884564">)</span>&nbsp;<span class="op" id="3884566">&gt;</span>&nbsp;<span class="num" id="3884568">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884571">serverHasNPN</span>&nbsp;<span class="op" id="3884584">:=</span>&nbsp;<span class="ident" id="3884587"><a href="/crypto/tls/handshake_client.go.html#3884224">hs</a></span><span class="op" id="3884589">.</span><span class="ident" id="3884590">serverHello</span><span class="op" id="3884601">.</span><span class="ident" id="3884602">nextProtoNeg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884616">serverHasALPN</span>&nbsp;<span class="op" id="3884630">:=</span>&nbsp;<span class="builtinfunc" id="3884633">len</span><span class="op" id="3884636">(</span><span class="ident" id="3884637"><a href="/crypto/tls/handshake_client.go.html#3884224">hs</a></span><span class="op" id="3884639">.</span><span class="ident" id="3884640">serverHello</span><span class="op" id="3884651">.</span><span class="ident" id="3884652">alpnProtocol</span><span class="op" id="3884664">)</span>&nbsp;<span class="op" id="3884666">&gt;</span>&nbsp;<span class="num" id="3884668">0</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3884672">if</span>&nbsp;<span class="op" id="3884675">!</span><span class="ident" id="3884676"><a href="/crypto/tls/handshake_client.go.html#3884482">clientDidNPN</a></span>&nbsp;<span class="op" id="3884689">&amp;&amp;</span>&nbsp;<span class="ident" id="3884692"><a href="/crypto/tls/handshake_client.go.html#3884571">serverHasNPN</a></span>&nbsp;<span class="op" id="3884705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884709"><a href="/crypto/tls/handshake_client.go.html#3884288">c</a></span><span class="op" id="3884710">.</span><span class="ident" id="3884711">sendAlert</span><span class="op" id="3884720">(</span><span class="ident" id="3884721"><a href="/crypto/tls/alert.go.html#3810828">alertHandshakeFailure</a></span><span class="op" id="3884742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3884746">return</span>&nbsp;<span class="builtintype" id="3884753">false</span><span class="op" id="3884758">,</span>&nbsp;<span class="ident" id="3884760"><a href="/crypto/tls/handshake_client.go.html#3870836">errors</a></span><span class="op" id="3884766">.</span><span class="ident" id="3884767">New</span><span class="op" id="3884770">(</span><span class="string" id="3884771">&#34;server&nbsp;advertised&nbsp;unrequested&nbsp;NPN&nbsp;extension&#34;</span><span class="op" id="3884816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3884819">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3884823">if</span>&nbsp;<span class="op" id="3884826">!</span><span class="ident" id="3884827"><a href="/crypto/tls/handshake_client.go.html#3884521">clientDidALPN</a></span>&nbsp;<span class="op" id="3884841">&amp;&amp;</span>&nbsp;<span class="ident" id="3884844"><a href="/crypto/tls/handshake_client.go.html#3884616">serverHasALPN</a></span>&nbsp;<span class="op" id="3884858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884862"><a href="/crypto/tls/handshake_client.go.html#3884288">c</a></span><span class="op" id="3884863">.</span><span class="ident" id="3884864">sendAlert</span><span class="op" id="3884873">(</span><span class="ident" id="3884874"><a href="/crypto/tls/alert.go.html#3810828">alertHandshakeFailure</a></span><span class="op" id="3884895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3884899">return</span>&nbsp;<span class="builtintype" id="3884906">false</span><span class="op" id="3884911">,</span>&nbsp;<span class="ident" id="3884913"><a href="/crypto/tls/handshake_client.go.html#3870836">errors</a></span><span class="op" id="3884919">.</span><span class="ident" id="3884920">New</span><span class="op" id="3884923">(</span><span class="string" id="3884924">&#34;server&nbsp;advertised&nbsp;unrequested&nbsp;ALPN&nbsp;extension&#34;</span><span class="op" id="3884970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3884973">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3884977">if</span>&nbsp;<span class="ident" id="3884980"><a href="/crypto/tls/handshake_client.go.html#3884571">serverHasNPN</a></span>&nbsp;<span class="op" id="3884993">&amp;&amp;</span>&nbsp;<span class="ident" id="3884996"><a href="/crypto/tls/handshake_client.go.html#3884616">serverHasALPN</a></span>&nbsp;<span class="op" id="3885010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885014"><a href="/crypto/tls/handshake_client.go.html#3884288">c</a></span><span class="op" id="3885015">.</span><span class="ident" id="3885016">sendAlert</span><span class="op" id="3885025">(</span><span class="ident" id="3885026"><a href="/crypto/tls/alert.go.html#3810828">alertHandshakeFailure</a></span><span class="op" id="3885047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3885051">return</span>&nbsp;<span class="builtintype" id="3885058">false</span><span class="op" id="3885063">,</span>&nbsp;<span class="ident" id="3885065"><a href="/crypto/tls/handshake_client.go.html#3870836">errors</a></span><span class="op" id="3885071">.</span><span class="ident" id="3885072">New</span><span class="op" id="3885075">(</span><span class="string" id="3885076">&#34;server&nbsp;advertised&nbsp;both&nbsp;NPN&nbsp;and&nbsp;ALPN&nbsp;extensions&#34;</span><span class="op" id="3885124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3885127">}</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3885131">if</span>&nbsp;<span class="ident" id="3885134"><a href="/crypto/tls/handshake_client.go.html#3884616">serverHasALPN</a></span>&nbsp;<span class="op" id="3885148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885152"><a href="/crypto/tls/handshake_client.go.html#3884288">c</a></span><span class="op" id="3885153">.</span><span class="ident" id="3885154">clientProtocol</span>&nbsp;<span class="op" id="3885169">=</span>&nbsp;<span class="ident" id="3885171"><a href="/crypto/tls/handshake_client.go.html#3884224">hs</a></span><span class="op" id="3885173">.</span><span class="ident" id="3885174">serverHello</span><span class="op" id="3885185">.</span><span class="ident" id="3885186">alpnProtocol</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885201"><a href="/crypto/tls/handshake_client.go.html#3884288">c</a></span><span class="op" id="3885202">.</span><span class="ident" id="3885203">clientProtocolFallback</span>&nbsp;<span class="op" id="3885226">=</span>&nbsp;<span class="builtintype" id="3885228">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3885235">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3885239">if</span>&nbsp;<span class="ident" id="3885242"><a href="/crypto/tls/handshake_client.go.html#3884224">hs</a></span><span class="op" id="3885244">.</span><span class="ident" id="3885245">serverResumedSession</span><span class="op" id="3885265">(</span><span class="op" id="3885266">)</span>&nbsp;<span class="op" id="3885268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3885272">//&nbsp;Restore&nbsp;masterSecret&nbsp;and&nbsp;peerCerts&nbsp;from&nbsp;previous&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885332"><a href="/crypto/tls/handshake_client.go.html#3884224">hs</a></span><span class="op" id="3885334">.</span><span class="ident" id="3885335">masterSecret</span>&nbsp;<span class="op" id="3885348">=</span>&nbsp;<span class="ident" id="3885350"><a href="/crypto/tls/handshake_client.go.html#3884224">hs</a></span><span class="op" id="3885352">.</span><span class="ident" id="3885353">session</span><span class="op" id="3885360">.</span><span class="ident" id="3885361">masterSecret</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885376"><a href="/crypto/tls/handshake_client.go.html#3884288">c</a></span><span class="op" id="3885377">.</span><span class="ident" id="3885378">peerCertificates</span>&nbsp;<span class="op" id="3885395">=</span>&nbsp;<span class="ident" id="3885397"><a href="/crypto/tls/handshake_client.go.html#3884224">hs</a></span><span class="op" id="3885399">.</span><span class="ident" id="3885400">session</span><span class="op" id="3885407">.</span><span class="ident" id="3885408">serverCertificates</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3885429">return</span>&nbsp;<span class="builtintype" id="3885436">true</span><span class="op" id="3885440">,</span>&nbsp;<span class="ident" id="3885442">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3885447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3885450">return</span>&nbsp;<span class="builtintype" id="3885457">false</span><span class="op" id="3885462">,</span>&nbsp;<span class="ident" id="3885464">nil</span><br>
<span class="lineno"></span><span class="op" id="3885468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="3885471">func</span>&nbsp;<span class="op" id="3885476">(</span><span class="ident" id="3885477">hs</span>&nbsp;<span class="op" id="3885480">*</span><span class="ident" id="3885481"><a href="/crypto/tls/handshake_client.go.html#3870884">clientHandshakeState</a></span><span class="op" id="3885501">)</span>&nbsp;<span class="ident" id="3885503">readFinished</span><span class="op" id="3885515">(</span><span class="ident" id="3885516">out</span>&nbsp;<span class="op" id="3885520">[</span><span class="op" id="3885521">]</span><span class="builtintype" id="3885522">byte</span><span class="op" id="3885526">)</span>&nbsp;<span class="builtintype" id="3885528">error</span>&nbsp;<span class="op" id="3885534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885537">c</span>&nbsp;<span class="op" id="3885539">:=</span>&nbsp;<span class="ident" id="3885542"><a href="/crypto/tls/handshake_client.go.html#3885477">hs</a></span><span class="op" id="3885544">.</span><span class="ident" id="3885545">c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885549"><a href="/crypto/tls/handshake_client.go.html#3885537">c</a></span><span class="op" id="3885550">.</span><span class="ident" id="3885551">readRecord</span><span class="op" id="3885561">(</span><span class="ident" id="3885562"><a href="/crypto/tls/common.go.html#3823266">recordTypeChangeCipherSpec</a></span><span class="op" id="3885588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3885591">if</span>&nbsp;<span class="ident" id="3885594">err</span>&nbsp;<span class="op" id="3885598">:=</span>&nbsp;<span class="ident" id="3885601"><a href="/crypto/tls/handshake_client.go.html#3885537">c</a></span><span class="op" id="3885602">.</span><span class="ident" id="3885603">in</span><span class="op" id="3885605">.</span><span class="builtintype" id="3885606">error</span><span class="op" id="3885611">(</span><span class="op" id="3885612">)</span><span class="op" id="3885613">;</span>&nbsp;<span class="ident" id="3885615"><a href="/crypto/tls/handshake_client.go.html#3885594">err</a></span>&nbsp;<span class="op" id="3885619">!=</span>&nbsp;<span class="ident" id="3885622">nil</span>&nbsp;<span class="op" id="3885626">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3885630">return</span>&nbsp;<span class="ident" id="3885637"><a href="/crypto/tls/handshake_client.go.html#3885594">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3885642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885646">msg</span><span class="op" id="3885649">,</span>&nbsp;<span class="ident" id="3885651">err</span>&nbsp;<span class="op" id="3885655">:=</span>&nbsp;<span class="ident" id="3885658"><a href="/crypto/tls/handshake_client.go.html#3885537">c</a></span><span class="op" id="3885659">.</span><span class="ident" id="3885660">readHandshake</span><span class="op" id="3885673">(</span><span class="op" id="3885674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3885677">if</span>&nbsp;<span class="ident" id="3885680"><a href="/crypto/tls/handshake_client.go.html#3885651">err</a></span>&nbsp;<span class="op" id="3885684">!=</span>&nbsp;<span class="ident" id="3885687">nil</span>&nbsp;<span class="op" id="3885691">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3885695">return</span>&nbsp;<span class="ident" id="3885702"><a href="/crypto/tls/handshake_client.go.html#3885651">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3885707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885710">serverFinished</span><span class="op" id="3885724">,</span>&nbsp;<span class="ident" id="3885726">ok</span>&nbsp;<span class="op" id="3885729">:=</span>&nbsp;<span class="ident" id="3885732"><a href="/crypto/tls/handshake_client.go.html#3885646">msg</a></span><span class="op" id="3885735">.</span><span class="op" id="3885736">(</span><span class="op" id="3885737">*</span><span class="ident" id="3885738"><a href="/crypto/tls/handshake_messages.go.html#3909925">finishedMsg</a></span><span class="op" id="3885749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3885752">if</span>&nbsp;<span class="op" id="3885755">!</span><span class="ident" id="3885756"><a href="/crypto/tls/handshake_client.go.html#3885726">ok</a></span>&nbsp;<span class="op" id="3885759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885763"><a href="/crypto/tls/handshake_client.go.html#3885537">c</a></span><span class="op" id="3885764">.</span><span class="ident" id="3885765">sendAlert</span><span class="op" id="3885774">(</span><span class="ident" id="3885775"><a href="/crypto/tls/alert.go.html#3810628">alertUnexpectedMessage</a></span><span class="op" id="3885797">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3885801">return</span>&nbsp;<span class="ident" id="3885808"><a href="/crypto/tls/common.go.html#3841643">unexpectedMessageError</a></span><span class="op" id="3885830">(</span><span class="ident" id="3885831"><a href="/crypto/tls/handshake_client.go.html#3885710">serverFinished</a></span><span class="op" id="3885845">,</span>&nbsp;<span class="ident" id="3885847"><a href="/crypto/tls/handshake_client.go.html#3885646">msg</a></span><span class="op" id="3885850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3885853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885857">verify</span>&nbsp;<span class="op" id="3885864">:=</span>&nbsp;<span class="ident" id="3885867"><a href="/crypto/tls/handshake_client.go.html#3885477">hs</a></span><span class="op" id="3885869">.</span><span class="ident" id="3885870">finishedHash</span><span class="op" id="3885882">.</span><span class="ident" id="3885883">serverSum</span><span class="op" id="3885892">(</span><span class="ident" id="3885893"><a href="/crypto/tls/handshake_client.go.html#3885477">hs</a></span><span class="op" id="3885895">.</span><span class="ident" id="3885896">masterSecret</span><span class="op" id="3885908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3885911">if</span>&nbsp;<span class="builtinfunc" id="3885914">len</span><span class="op" id="3885917">(</span><span class="ident" id="3885918"><a href="/crypto/tls/handshake_client.go.html#3885857">verify</a></span><span class="op" id="3885924">)</span>&nbsp;<span class="op" id="3885926">!=</span>&nbsp;<span class="builtinfunc" id="3885929">len</span><span class="op" id="3885932">(</span><span class="ident" id="3885933"><a href="/crypto/tls/handshake_client.go.html#3885710">serverFinished</a></span><span class="op" id="3885947">.</span><span class="ident" id="3885948">verifyData</span><span class="op" id="3885958">)</span>&nbsp;<span class="op" id="3885960">||</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885965"><a href="/crypto/tls/handshake_client.go.html#3870804">subtle</a></span><span class="op" id="3885971">.</span><span class="ident" id="3885972">ConstantTimeCompare</span><span class="op" id="3885991">(</span><span class="ident" id="3885992"><a href="/crypto/tls/handshake_client.go.html#3885857">verify</a></span><span class="op" id="3885998">,</span>&nbsp;<span class="ident" id="3886000"><a href="/crypto/tls/handshake_client.go.html#3885710">serverFinished</a></span><span class="op" id="3886014">.</span><span class="ident" id="3886015">verifyData</span><span class="op" id="3886025">)</span>&nbsp;<span class="op" id="3886027">!=</span>&nbsp;<span class="num" id="3886030">1</span>&nbsp;<span class="op" id="3886032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886036"><a href="/crypto/tls/handshake_client.go.html#3885537">c</a></span><span class="op" id="3886037">.</span><span class="ident" id="3886038">sendAlert</span><span class="op" id="3886047">(</span><span class="ident" id="3886048"><a href="/crypto/tls/alert.go.html#3810828">alertHandshakeFailure</a></span><span class="op" id="3886069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3886073">return</span>&nbsp;<span class="ident" id="3886080"><a href="/crypto/tls/handshake_client.go.html#3870836">errors</a></span><span class="op" id="3886086">.</span><span class="ident" id="3886087">New</span><span class="op" id="3886090">(</span><span class="string" id="3886091">&#34;tls:&nbsp;server&#39;s&nbsp;Finished&nbsp;message&nbsp;was&nbsp;incorrect&#34;</span><span class="op" id="3886137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3886140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886143"><a href="/crypto/tls/handshake_client.go.html#3885477">hs</a></span><span class="op" id="3886145">.</span><span class="ident" id="3886146">finishedHash</span><span class="op" id="3886158">.</span><span class="ident" id="3886159">Write</span><span class="op" id="3886164">(</span><span class="ident" id="3886165"><a href="/crypto/tls/handshake_client.go.html#3885710">serverFinished</a></span><span class="op" id="3886179">.</span><span class="ident" id="3886180">marshal</span><span class="op" id="3886187">(</span><span class="op" id="3886188">)</span><span class="op" id="3886189">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3886192">copy</span><span class="op" id="3886196">(</span><span class="ident" id="3886197"><a href="/crypto/tls/handshake_client.go.html#3885516">out</a></span><span class="op" id="3886200">,</span>&nbsp;<span class="ident" id="3886202"><a href="/crypto/tls/handshake_client.go.html#3885857">verify</a></span><span class="op" id="3886208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3886211">return</span>&nbsp;<span class="ident" id="3886218">nil</span><br>
<span class="lineno"></span><span class="op" id="3886222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3886225">func</span>&nbsp;<span class="op" id="3886230">(</span><span class="ident" id="3886231">hs</span>&nbsp;<span class="op" id="3886234">*</span><span class="ident" id="3886235"><a href="/crypto/tls/handshake_client.go.html#3870884">clientHandshakeState</a></span><span class="op" id="3886255">)</span>&nbsp;<span class="ident" id="3886257">readSessionTicket</span><span class="op" id="3886274">(</span><span class="op" id="3886275">)</span>&nbsp;<span class="builtintype" id="3886277">error</span>&nbsp;<span class="op" id="3886283">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3886286">if</span>&nbsp;<span class="op" id="3886289">!</span><span class="ident" id="3886290"><a href="/crypto/tls/handshake_client.go.html#3886231">hs</a></span><span class="op" id="3886292">.</span><span class="ident" id="3886293">serverHello</span><span class="op" id="3886304">.</span><span class="ident" id="3886305">ticketSupported</span>&nbsp;<span class="op" id="3886321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3886325">return</span>&nbsp;<span class="ident" id="3886332">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3886337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886341">c</span>&nbsp;<span class="op" id="3886343">:=</span>&nbsp;<span class="ident" id="3886346"><a href="/crypto/tls/handshake_client.go.html#3886231">hs</a></span><span class="op" id="3886348">.</span><span class="ident" id="3886349">c</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886352">msg</span><span class="op" id="3886355">,</span>&nbsp;<span class="ident" id="3886357">err</span>&nbsp;<span class="op" id="3886361">:=</span>&nbsp;<span class="ident" id="3886364"><a href="/crypto/tls/handshake_client.go.html#3886341">c</a></span><span class="op" id="3886365">.</span><span class="ident" id="3886366">readHandshake</span><span class="op" id="3886379">(</span><span class="op" id="3886380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3886383">if</span>&nbsp;<span class="ident" id="3886386"><a href="/crypto/tls/handshake_client.go.html#3886357">err</a></span>&nbsp;<span class="op" id="3886390">!=</span>&nbsp;<span class="ident" id="3886393">nil</span>&nbsp;<span class="op" id="3886397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3886401">return</span>&nbsp;<span class="ident" id="3886408"><a href="/crypto/tls/handshake_client.go.html#3886357">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3886413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886416">sessionTicketMsg</span><span class="op" id="3886432">,</span>&nbsp;<span class="ident" id="3886434">ok</span>&nbsp;<span class="op" id="3886437">:=</span>&nbsp;<span class="ident" id="3886440"><a href="/crypto/tls/handshake_client.go.html#3886352">msg</a></span><span class="op" id="3886443">.</span><span class="op" id="3886444">(</span><span class="op" id="3886445">*</span><span class="ident" id="3886446"><a href="/crypto/tls/handshake_messages.go.html#3916789">newSessionTicketMsg</a></span><span class="op" id="3886465">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3886468">if</span>&nbsp;<span class="op" id="3886471">!</span><span class="ident" id="3886472"><a href="/crypto/tls/handshake_client.go.html#3886434">ok</a></span>&nbsp;<span class="op" id="3886475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886479"><a href="/crypto/tls/handshake_client.go.html#3886341">c</a></span><span class="op" id="3886480">.</span><span class="ident" id="3886481">sendAlert</span><span class="op" id="3886490">(</span><span class="ident" id="3886491"><a href="/crypto/tls/alert.go.html#3810628">alertUnexpectedMessage</a></span><span class="op" id="3886513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3886517">return</span>&nbsp;<span class="ident" id="3886524"><a href="/crypto/tls/common.go.html#3841643">unexpectedMessageError</a></span><span class="op" id="3886546">(</span><span class="ident" id="3886547"><a href="/crypto/tls/handshake_client.go.html#3886416">sessionTicketMsg</a></span><span class="op" id="3886563">,</span>&nbsp;<span class="ident" id="3886565"><a href="/crypto/tls/handshake_client.go.html#3886352">msg</a></span><span class="op" id="3886568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3886571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886574"><a href="/crypto/tls/handshake_client.go.html#3886231">hs</a></span><span class="op" id="3886576">.</span><span class="ident" id="3886577">finishedHash</span><span class="op" id="3886589">.</span><span class="ident" id="3886590">Write</span><span class="op" id="3886595">(</span><span class="ident" id="3886596"><a href="/crypto/tls/handshake_client.go.html#3886416">sessionTicketMsg</a></span><span class="op" id="3886612">.</span><span class="ident" id="3886613">marshal</span><span class="op" id="3886620">(</span><span class="op" id="3886621">)</span><span class="op" id="3886622">)</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886626"><a href="/crypto/tls/handshake_client.go.html#3886231">hs</a></span><span class="op" id="3886628">.</span><span class="ident" id="3886629">session</span>&nbsp;<span class="op" id="3886637">=</span>&nbsp;<span class="op" id="3886639">&amp;</span><span class="ident" id="3886640"><a href="/crypto/tls/common.go.html#3828491">ClientSessionState</a></span><span class="op" id="3886658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886662">sessionTicket</span><span class="op" id="3886675">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3886682"><a href="/crypto/tls/handshake_client.go.html#3886416">sessionTicketMsg</a></span><span class="op" id="3886698">.</span><span class="ident" id="3886699">ticket</span><span class="op" id="3886705">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886709">vers</span><span class="op" id="3886713">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3886729"><a href="/crypto/tls/handshake_client.go.html#3886341">c</a></span><span class="op" id="3886730">.</span><span class="ident" id="3886731">vers</span><span class="op" id="3886735">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886739">cipherSuite</span><span class="op" id="3886750">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3886759"><a href="/crypto/tls/handshake_client.go.html#3886231">hs</a></span><span class="op" id="3886761">.</span><span class="ident" id="3886762">suite</span><span class="op" id="3886767">.</span><span class="ident" id="3886768">id</span><span class="op" id="3886770">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886774">masterSecret</span><span class="op" id="3886786">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3886794"><a href="/crypto/tls/handshake_client.go.html#3886231">hs</a></span><span class="op" id="3886796">.</span><span class="ident" id="3886797">masterSecret</span><span class="op" id="3886809">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886813">serverCertificates</span><span class="op" id="3886831">:</span>&nbsp;<span class="ident" id="3886833"><a href="/crypto/tls/handshake_client.go.html#3886341">c</a></span><span class="op" id="3886834">.</span><span class="ident" id="3886835">peerCertificates</span><span class="op" id="3886851">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3886854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3886858">return</span>&nbsp;<span class="ident" id="3886865">nil</span><br>
<span class="lineno">590</span><span class="op" id="3886869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3886872">func</span>&nbsp;<span class="op" id="3886877">(</span><span class="ident" id="3886878">hs</span>&nbsp;<span class="op" id="3886881">*</span><span class="ident" id="3886882"><a href="/crypto/tls/handshake_client.go.html#3870884">clientHandshakeState</a></span><span class="op" id="3886902">)</span>&nbsp;<span class="ident" id="3886904">sendFinished</span><span class="op" id="3886916">(</span><span class="ident" id="3886917">out</span>&nbsp;<span class="op" id="3886921">[</span><span class="op" id="3886922">]</span><span class="builtintype" id="3886923">byte</span><span class="op" id="3886927">)</span>&nbsp;<span class="builtintype" id="3886929">error</span>&nbsp;<span class="op" id="3886935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886938">c</span>&nbsp;<span class="op" id="3886940">:=</span>&nbsp;<span class="ident" id="3886943"><a href="/crypto/tls/handshake_client.go.html#3886878">hs</a></span><span class="op" id="3886945">.</span><span class="ident" id="3886946">c</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886950"><a href="/crypto/tls/handshake_client.go.html#3886938">c</a></span><span class="op" id="3886951">.</span><span class="ident" id="3886952">writeRecord</span><span class="op" id="3886963">(</span><span class="ident" id="3886964"><a href="/crypto/tls/common.go.html#3823266">recordTypeChangeCipherSpec</a></span><span class="op" id="3886990">,</span>&nbsp;<span class="op" id="3886992">[</span><span class="op" id="3886993">]</span><span class="builtintype" id="3886994">byte</span><span class="op" id="3886998">{</span><span class="num" id="3886999">1</span><span class="op" id="3887000">}</span><span class="op" id="3887001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3887004">if</span>&nbsp;<span class="ident" id="3887007"><a href="/crypto/tls/handshake_client.go.html#3886878">hs</a></span><span class="op" id="3887009">.</span><span class="ident" id="3887010">serverHello</span><span class="op" id="3887021">.</span><span class="ident" id="3887022">nextProtoNeg</span>&nbsp;<span class="op" id="3887035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887039">nextProto</span>&nbsp;<span class="op" id="3887049">:=</span>&nbsp;<span class="builtinfunc" id="3887052">new</span><span class="op" id="3887055">(</span><span class="ident" id="3887056"><a href="/crypto/tls/handshake_messages.go.html#3910552">nextProtoMsg</a></span><span class="op" id="3887068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887072">proto</span><span class="op" id="3887077">,</span>&nbsp;<span class="ident" id="3887079">fallback</span>&nbsp;<span class="op" id="3887088">:=</span>&nbsp;<span class="ident" id="3887091"><a href="/crypto/tls/handshake_client.go.html#3888195">mutualProtocol</a></span><span class="op" id="3887105">(</span><span class="ident" id="3887106"><a href="/crypto/tls/handshake_client.go.html#3886938">c</a></span><span class="op" id="3887107">.</span><span class="ident" id="3887108">config</span><span class="op" id="3887114">.</span><span class="ident" id="3887115">NextProtos</span><span class="op" id="3887125">,</span>&nbsp;<span class="ident" id="3887127"><a href="/crypto/tls/handshake_client.go.html#3886878">hs</a></span><span class="op" id="3887129">.</span><span class="ident" id="3887130">serverHello</span><span class="op" id="3887141">.</span><span class="ident" id="3887142">nextProtos</span><span class="op" id="3887152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887156"><a href="/crypto/tls/handshake_client.go.html#3887039">nextProto</a></span><span class="op" id="3887165">.</span><span class="ident" id="3887166">proto</span>&nbsp;<span class="op" id="3887172">=</span>&nbsp;<span class="ident" id="3887174"><a href="/crypto/tls/handshake_client.go.html#3887072">proto</a></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887182"><a href="/crypto/tls/handshake_client.go.html#3886938">c</a></span><span class="op" id="3887183">.</span><span class="ident" id="3887184">clientProtocol</span>&nbsp;<span class="op" id="3887199">=</span>&nbsp;<span class="ident" id="3887201"><a href="/crypto/tls/handshake_client.go.html#3887072">proto</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887209"><a href="/crypto/tls/handshake_client.go.html#3886938">c</a></span><span class="op" id="3887210">.</span><span class="ident" id="3887211">clientProtocolFallback</span>&nbsp;<span class="op" id="3887234">=</span>&nbsp;<span class="ident" id="3887236"><a href="/crypto/tls/handshake_client.go.html#3887079">fallback</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887248"><a href="/crypto/tls/handshake_client.go.html#3886878">hs</a></span><span class="op" id="3887250">.</span><span class="ident" id="3887251">finishedHash</span><span class="op" id="3887263">.</span><span class="ident" id="3887264">Write</span><span class="op" id="3887269">(</span><span class="ident" id="3887270"><a href="/crypto/tls/handshake_client.go.html#3887039">nextProto</a></span><span class="op" id="3887279">.</span><span class="ident" id="3887280">marshal</span><span class="op" id="3887287">(</span><span class="op" id="3887288">)</span><span class="op" id="3887289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887293"><a href="/crypto/tls/handshake_client.go.html#3886938">c</a></span><span class="op" id="3887294">.</span><span class="ident" id="3887295">writeRecord</span><span class="op" id="3887306">(</span><span class="ident" id="3887307"><a href="/crypto/tls/common.go.html#3823354">recordTypeHandshake</a></span><span class="op" id="3887326">,</span>&nbsp;<span class="ident" id="3887328"><a href="/crypto/tls/handshake_client.go.html#3887039">nextProto</a></span><span class="op" id="3887337">.</span><span class="ident" id="3887338">marshal</span><span class="op" id="3887345">(</span><span class="op" id="3887346">)</span><span class="op" id="3887347">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3887350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887354">finished</span>&nbsp;<span class="op" id="3887363">:=</span>&nbsp;<span class="builtinfunc" id="3887366">new</span><span class="op" id="3887369">(</span><span class="ident" id="3887370"><a href="/crypto/tls/handshake_messages.go.html#3909925">finishedMsg</a></span><span class="op" id="3887381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887384"><a href="/crypto/tls/handshake_client.go.html#3887354">finished</a></span><span class="op" id="3887392">.</span><span class="ident" id="3887393">verifyData</span>&nbsp;<span class="op" id="3887404">=</span>&nbsp;<span class="ident" id="3887406"><a href="/crypto/tls/handshake_client.go.html#3886878">hs</a></span><span class="op" id="3887408">.</span><span class="ident" id="3887409">finishedHash</span><span class="op" id="3887421">.</span><span class="ident" id="3887422">clientSum</span><span class="op" id="3887431">(</span><span class="ident" id="3887432"><a href="/crypto/tls/handshake_client.go.html#3886878">hs</a></span><span class="op" id="3887434">.</span><span class="ident" id="3887435">masterSecret</span><span class="op" id="3887447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887450"><a href="/crypto/tls/handshake_client.go.html#3886878">hs</a></span><span class="op" id="3887452">.</span><span class="ident" id="3887453">finishedHash</span><span class="op" id="3887465">.</span><span class="ident" id="3887466">Write</span><span class="op" id="3887471">(</span><span class="ident" id="3887472"><a href="/crypto/tls/handshake_client.go.html#3887354">finished</a></span><span class="op" id="3887480">.</span><span class="ident" id="3887481">marshal</span><span class="op" id="3887488">(</span><span class="op" id="3887489">)</span><span class="op" id="3887490">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887493"><a href="/crypto/tls/handshake_client.go.html#3886938">c</a></span><span class="op" id="3887494">.</span><span class="ident" id="3887495">writeRecord</span><span class="op" id="3887506">(</span><span class="ident" id="3887507"><a href="/crypto/tls/common.go.html#3823354">recordTypeHandshake</a></span><span class="op" id="3887526">,</span>&nbsp;<span class="ident" id="3887528"><a href="/crypto/tls/handshake_client.go.html#3887354">finished</a></span><span class="op" id="3887536">.</span><span class="ident" id="3887537">marshal</span><span class="op" id="3887544">(</span><span class="op" id="3887545">)</span><span class="op" id="3887546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3887549">copy</span><span class="op" id="3887553">(</span><span class="ident" id="3887554"><a href="/crypto/tls/handshake_client.go.html#3886917">out</a></span><span class="op" id="3887557">,</span>&nbsp;<span class="ident" id="3887559"><a href="/crypto/tls/handshake_client.go.html#3887354">finished</a></span><span class="op" id="3887567">.</span><span class="ident" id="3887568">verifyData</span><span class="op" id="3887578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3887581">return</span>&nbsp;<span class="ident" id="3887588">nil</span><br>
<span class="lineno"></span><span class="op" id="3887592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span><span class="comment" id="3887595">//&nbsp;clientSessionCacheKey&nbsp;returns&nbsp;a&nbsp;key&nbsp;used&nbsp;to&nbsp;cache&nbsp;sessionTickets&nbsp;that&nbsp;could</span><br>
<span class="lineno"></span><span class="comment" id="3887674">//&nbsp;be&nbsp;used&nbsp;to&nbsp;resume&nbsp;previously&nbsp;negotiated&nbsp;TLS&nbsp;sessions&nbsp;with&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="3887745">func</span>&nbsp;<span class="ident" id="3887750">clientSessionCacheKey</span><span class="op" id="3887771">(</span><span class="ident" id="3887772">serverAddr</span>&nbsp;<span class="ident" id="3887783"><a href="/crypto/tls/handshake_client.go.html#3870859">net</a></span><span class="op" id="3887786">.</span><span class="ident" id="3887787">Addr</span><span class="op" id="3887791">,</span>&nbsp;<span class="ident" id="3887793">config</span>&nbsp;<span class="op" id="3887800">*</span><span class="ident" id="3887801"><a href="/crypto/tls/common.go.html#3830813">Config</a></span><span class="op" id="3887807">)</span>&nbsp;<span class="builtintype" id="3887809">string</span>&nbsp;<span class="op" id="3887816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3887819">if</span>&nbsp;<span class="builtinfunc" id="3887822">len</span><span class="op" id="3887825">(</span><span class="ident" id="3887826"><a href="/crypto/tls/handshake_client.go.html#3887793">config</a></span><span class="op" id="3887832">.</span><span class="ident" id="3887833">ServerName</span><span class="op" id="3887843">)</span>&nbsp;<span class="op" id="3887845">&gt;</span>&nbsp;<span class="num" id="3887847">0</span>&nbsp;<span class="op" id="3887849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3887853">return</span>&nbsp;<span class="ident" id="3887860"><a href="/crypto/tls/handshake_client.go.html#3887793">config</a></span><span class="op" id="3887866">.</span><span class="ident" id="3887867">ServerName</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3887879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3887882">return</span>&nbsp;<span class="ident" id="3887889"><a href="/crypto/tls/handshake_client.go.html#3887772">serverAddr</a></span><span class="op" id="3887899">.</span><span class="ident" id="3887900">String</span><span class="op" id="3887906">(</span><span class="op" id="3887907">)</span><br>
<span class="lineno"></span><span class="op" id="3887909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3887912">//&nbsp;mutualProtocol&nbsp;finds&nbsp;the&nbsp;mutual&nbsp;Next&nbsp;Protocol&nbsp;Negotiation&nbsp;or&nbsp;ALPN&nbsp;protocol</span><br>
<span class="lineno">625</span><span class="comment" id="3887990">//&nbsp;given&nbsp;list&nbsp;of&nbsp;possible&nbsp;protocols&nbsp;and&nbsp;a&nbsp;list&nbsp;of&nbsp;the&nbsp;preference&nbsp;order.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="3888066">//&nbsp;first&nbsp;list&nbsp;must&nbsp;not&nbsp;be&nbsp;empty.&nbsp;It&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;protocol&nbsp;and&nbsp;flag</span><br>
<span class="lineno"></span><span class="comment" id="3888142">//&nbsp;indicating&nbsp;if&nbsp;the&nbsp;fallback&nbsp;case&nbsp;was&nbsp;reached.</span><br>
<span class="lineno"></span><span class="keyword" id="3888190">func</span>&nbsp;<span class="ident" id="3888195">mutualProtocol</span><span class="op" id="3888209">(</span><span class="ident" id="3888210">protos</span><span class="op" id="3888216">,</span>&nbsp;<span class="ident" id="3888218">preferenceProtos</span>&nbsp;<span class="op" id="3888235">[</span><span class="op" id="3888236">]</span><span class="builtintype" id="3888237">string</span><span class="op" id="3888243">)</span>&nbsp;<span class="op" id="3888245">(</span><span class="builtintype" id="3888246">string</span><span class="op" id="3888252">,</span>&nbsp;<span class="builtintype" id="3888254">bool</span><span class="op" id="3888258">)</span>&nbsp;<span class="op" id="3888260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3888263">for</span>&nbsp;<span class="ident" id="3888267">_</span><span class="op" id="3888268">,</span>&nbsp;<span class="ident" id="3888270">s</span>&nbsp;<span class="op" id="3888272">:=</span>&nbsp;<span class="keyword" id="3888275">range</span>&nbsp;<span class="ident" id="3888281"><a href="/crypto/tls/handshake_client.go.html#3888218">preferenceProtos</a></span>&nbsp;<span class="op" id="3888298">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3888302">for</span>&nbsp;<span class="ident" id="3888306">_</span><span class="op" id="3888307">,</span>&nbsp;<span class="ident" id="3888309">c</span>&nbsp;<span class="op" id="3888311">:=</span>&nbsp;<span class="keyword" id="3888314">range</span>&nbsp;<span class="ident" id="3888320"><a href="/crypto/tls/handshake_client.go.html#3888210">protos</a></span>&nbsp;<span class="op" id="3888327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3888332">if</span>&nbsp;<span class="ident" id="3888335"><a href="/crypto/tls/handshake_client.go.html#3888270">s</a></span>&nbsp;<span class="op" id="3888337">==</span>&nbsp;<span class="ident" id="3888340"><a href="/crypto/tls/handshake_client.go.html#3888309">c</a></span>&nbsp;<span class="op" id="3888342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3888348">return</span>&nbsp;<span class="ident" id="3888355"><a href="/crypto/tls/handshake_client.go.html#3888270">s</a></span><span class="op" id="3888356">,</span>&nbsp;<span class="builtintype" id="3888358">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3888367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3888371">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3888374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3888378">return</span>&nbsp;<span class="ident" id="3888385"><a href="/crypto/tls/handshake_client.go.html#3888210">protos</a></span><span class="op" id="3888391">[</span><span class="num" id="3888392">0</span><span class="op" id="3888393">]</span><span class="op" id="3888394">,</span>&nbsp;<span class="builtintype" id="3888396">true</span><br>
<span class="lineno"></span><span class="op" id="3888401">}</span>
</div>
</body>
</html>
