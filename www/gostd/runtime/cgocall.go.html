<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html" class="current">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1446958">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1447014">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1447068">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1447119">//&nbsp;Cgo&nbsp;call&nbsp;and&nbsp;callback&nbsp;support.</span><br>
<span class="lineno"></span><span class="comment" id="1447153">//</span><br>
<span class="lineno"></span><span class="comment" id="1447156">//&nbsp;To&nbsp;call&nbsp;into&nbsp;the&nbsp;C&nbsp;function&nbsp;f&nbsp;from&nbsp;Go,&nbsp;the&nbsp;cgo-generated&nbsp;code&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1447227">//&nbsp;runtime.cgocall(_cgo_Cfunc_f,&nbsp;frame),&nbsp;where&nbsp;_cgo_Cfunc_f&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1447292">//&nbsp;gcc-compiled&nbsp;function&nbsp;written&nbsp;by&nbsp;cgo.</span><br>
<span class="lineno">10</span><span class="comment" id="1447333">//</span><br>
<span class="lineno"></span><span class="comment" id="1447336">//&nbsp;runtime.cgocall&nbsp;(below)&nbsp;locks&nbsp;g&nbsp;to&nbsp;m,&nbsp;calls&nbsp;entersyscall</span><br>
<span class="lineno"></span><span class="comment" id="1447396">//&nbsp;so&nbsp;as&nbsp;not&nbsp;to&nbsp;block&nbsp;other&nbsp;goroutines&nbsp;or&nbsp;the&nbsp;garbage&nbsp;collector,</span><br>
<span class="lineno"></span><span class="comment" id="1447461">//&nbsp;and&nbsp;then&nbsp;calls&nbsp;runtime.asmcgocall(_cgo_Cfunc_f,&nbsp;frame).</span><br>
<span class="lineno"></span><span class="comment" id="1447520">//</span><br>
<span class="lineno">15</span><span class="comment" id="1447523">//&nbsp;runtime.asmcgocall&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;to&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1447592">//&nbsp;(assumed&nbsp;to&nbsp;be&nbsp;an&nbsp;operating&nbsp;system-allocated&nbsp;stack,&nbsp;so&nbsp;safe&nbsp;to&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="1447662">//&nbsp;gcc-compiled&nbsp;code&nbsp;on)&nbsp;and&nbsp;calls&nbsp;_cgo_Cfunc_f(frame).</span><br>
<span class="lineno"></span><span class="comment" id="1447718">//</span><br>
<span class="lineno"></span><span class="comment" id="1447721">//&nbsp;_cgo_Cfunc_f&nbsp;invokes&nbsp;the&nbsp;actual&nbsp;C&nbsp;function&nbsp;f&nbsp;with&nbsp;arguments</span><br>
<span class="lineno">20</span><span class="comment" id="1447784">//&nbsp;taken&nbsp;from&nbsp;the&nbsp;frame&nbsp;structure,&nbsp;records&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;frame,</span><br>
<span class="lineno"></span><span class="comment" id="1447853">//&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.asmcgocall.</span><br>
<span class="lineno"></span><span class="comment" id="1447891">//</span><br>
<span class="lineno"></span><span class="comment" id="1447894">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.asmcgocall&nbsp;switches&nbsp;back&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1447963">//&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocall.</span><br>
<span class="lineno">25</span><span class="comment" id="1448027">//</span><br>
<span class="lineno"></span><span class="comment" id="1448030">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocall&nbsp;calls&nbsp;exitsyscall,&nbsp;which&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="1448107">//&nbsp;until&nbsp;this&nbsp;m&nbsp;can&nbsp;run&nbsp;Go&nbsp;code&nbsp;without&nbsp;violating&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit,</span><br>
<span class="lineno"></span><span class="comment" id="1448180">//&nbsp;and&nbsp;then&nbsp;unlocks&nbsp;g&nbsp;from&nbsp;m.</span><br>
<span class="lineno"></span><span class="comment" id="1448210">//</span><br>
<span class="lineno">30</span><span class="comment" id="1448213">//&nbsp;The&nbsp;above&nbsp;description&nbsp;skipped&nbsp;over&nbsp;the&nbsp;possibility&nbsp;of&nbsp;the&nbsp;gcc-compiled</span><br>
<span class="lineno"></span><span class="comment" id="1448287">//&nbsp;function&nbsp;f&nbsp;calling&nbsp;back&nbsp;into&nbsp;Go.&nbsp;&nbsp;If&nbsp;that&nbsp;happens,&nbsp;we&nbsp;continue&nbsp;down</span><br>
<span class="lineno"></span><span class="comment" id="1448358">//&nbsp;the&nbsp;rabbit&nbsp;hole&nbsp;during&nbsp;the&nbsp;execution&nbsp;of&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="1448404">//</span><br>
<span class="lineno"></span><span class="comment" id="1448407">//&nbsp;To&nbsp;make&nbsp;it&nbsp;possible&nbsp;for&nbsp;gcc-compiled&nbsp;C&nbsp;code&nbsp;to&nbsp;call&nbsp;a&nbsp;Go&nbsp;function&nbsp;p.GoF,</span><br>
<span class="lineno">35</span><span class="comment" id="1448483">//&nbsp;cgo&nbsp;writes&nbsp;a&nbsp;gcc-compiled&nbsp;function&nbsp;named&nbsp;GoF&nbsp;(not&nbsp;p.GoF,&nbsp;since&nbsp;gcc&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="1448561">//&nbsp;know&nbsp;about&nbsp;packages).&nbsp;&nbsp;The&nbsp;gcc-compiled&nbsp;C&nbsp;function&nbsp;f&nbsp;calls&nbsp;GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1448628">//</span><br>
<span class="lineno"></span><span class="comment" id="1448631">//&nbsp;GoF&nbsp;calls&nbsp;crosscall2(_cgoexp_GoF,&nbsp;frame,&nbsp;framesize).&nbsp;&nbsp;Crosscall2</span><br>
<span class="lineno"></span><span class="comment" id="1448699">//&nbsp;(in&nbsp;cgo/gcc_$GOARCH.S,&nbsp;a&nbsp;gcc-compiled&nbsp;assembly&nbsp;file)&nbsp;is&nbsp;a&nbsp;two-argument</span><br>
<span class="lineno">40</span><span class="comment" id="1448773">//&nbsp;adapter&nbsp;from&nbsp;the&nbsp;gcc&nbsp;function&nbsp;call&nbsp;ABI&nbsp;to&nbsp;the&nbsp;6c&nbsp;function&nbsp;call&nbsp;ABI.</span><br>
<span class="lineno"></span><span class="comment" id="1448844">//&nbsp;It&nbsp;is&nbsp;called&nbsp;from&nbsp;gcc&nbsp;to&nbsp;call&nbsp;6c&nbsp;functions.&nbsp;&nbsp;In&nbsp;this&nbsp;case&nbsp;it&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1448914">//&nbsp;_cgoexp_GoF(frame,&nbsp;framesize),&nbsp;still&nbsp;running&nbsp;on&nbsp;m-&gt;g0&#39;s&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1448979">//&nbsp;and&nbsp;outside&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit.&nbsp;&nbsp;Thus,&nbsp;this&nbsp;code&nbsp;cannot&nbsp;yet</span><br>
<span class="lineno"></span><span class="comment" id="1449045">//&nbsp;call&nbsp;arbitrary&nbsp;Go&nbsp;code&nbsp;directly&nbsp;and&nbsp;must&nbsp;be&nbsp;careful&nbsp;not&nbsp;to&nbsp;allocate</span><br>
<span class="lineno">45</span><span class="comment" id="1449116">//&nbsp;memory&nbsp;or&nbsp;use&nbsp;up&nbsp;m-&gt;g0&#39;s&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="1449151">//</span><br>
<span class="lineno"></span><span class="comment" id="1449154">//&nbsp;_cgoexp_GoF&nbsp;calls&nbsp;runtime.cgocallback(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1449221">//&nbsp;(The&nbsp;reason&nbsp;for&nbsp;having&nbsp;_cgoexp_GoF&nbsp;instead&nbsp;of&nbsp;writing&nbsp;a&nbsp;crosscall3</span><br>
<span class="lineno"></span><span class="comment" id="1449291">//&nbsp;to&nbsp;make&nbsp;this&nbsp;call&nbsp;directly&nbsp;is&nbsp;that&nbsp;_cgoexp_GoF,&nbsp;because&nbsp;it&nbsp;is&nbsp;compiled</span><br>
<span class="lineno">50</span><span class="comment" id="1449365">//&nbsp;with&nbsp;6c&nbsp;instead&nbsp;of&nbsp;gcc,&nbsp;can&nbsp;refer&nbsp;to&nbsp;dotted&nbsp;names&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="1449423">//&nbsp;runtime.cgocallback&nbsp;and&nbsp;p.GoF.)</span><br>
<span class="lineno"></span><span class="comment" id="1449458">//</span><br>
<span class="lineno"></span><span class="comment" id="1449461">//&nbsp;runtime.cgocallback&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;from&nbsp;m-&gt;g0&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1449525">//&nbsp;stack&nbsp;to&nbsp;the&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack,&nbsp;on&nbsp;which&nbsp;it&nbsp;calls</span><br>
<span class="lineno">55</span><span class="comment" id="1449589">//&nbsp;runtime.cgocallbackg(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1449639">//&nbsp;As&nbsp;part&nbsp;of&nbsp;the&nbsp;stack&nbsp;switch,&nbsp;runtime.cgocallback&nbsp;saves&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="1449709">//&nbsp;SP&nbsp;as&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;so&nbsp;that&nbsp;any&nbsp;use&nbsp;of&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;during&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1449779">//&nbsp;execution&nbsp;of&nbsp;the&nbsp;callback&nbsp;will&nbsp;be&nbsp;done&nbsp;below&nbsp;the&nbsp;existing&nbsp;stack&nbsp;frames.</span><br>
<span class="lineno"></span><span class="comment" id="1449854">//&nbsp;Before&nbsp;overwriting&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;it&nbsp;pushes&nbsp;the&nbsp;old&nbsp;value&nbsp;on&nbsp;the</span><br>
<span class="lineno">60</span><span class="comment" id="1449924">//&nbsp;m-&gt;g0&nbsp;stack,&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;restored&nbsp;later.</span><br>
<span class="lineno"></span><span class="comment" id="1449974">//</span><br>
<span class="lineno"></span><span class="comment" id="1449977">//&nbsp;runtime.cgocallbackg&nbsp;(below)&nbsp;is&nbsp;now&nbsp;running&nbsp;on&nbsp;a&nbsp;real&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="1450044">//&nbsp;stack&nbsp;(not&nbsp;an&nbsp;m-&gt;g0&nbsp;stack).&nbsp;&nbsp;First&nbsp;it&nbsp;calls&nbsp;runtime.exitsyscall,&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="1450123">//&nbsp;block&nbsp;until&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit&nbsp;allows&nbsp;running&nbsp;this&nbsp;goroutine.</span><br>
<span class="lineno">65</span><span class="comment" id="1450191">//&nbsp;Once&nbsp;exitsyscall&nbsp;has&nbsp;returned,&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;do&nbsp;things&nbsp;like&nbsp;call&nbsp;the&nbsp;memory</span><br>
<span class="lineno"></span><span class="comment" id="1450270">//&nbsp;allocator&nbsp;or&nbsp;invoke&nbsp;the&nbsp;Go&nbsp;callback&nbsp;function&nbsp;p.GoF.&nbsp;&nbsp;runtime.cgocallbackg</span><br>
<span class="lineno"></span><span class="comment" id="1450347">//&nbsp;first&nbsp;defers&nbsp;a&nbsp;function&nbsp;to&nbsp;unwind&nbsp;m-&gt;g0.sched.sp,&nbsp;so&nbsp;that&nbsp;if&nbsp;p.GoF</span><br>
<span class="lineno"></span><span class="comment" id="1450417">//&nbsp;panics,&nbsp;m-&gt;g0.sched.sp&nbsp;will&nbsp;be&nbsp;restored&nbsp;to&nbsp;its&nbsp;old&nbsp;value:&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1450494">//&nbsp;and&nbsp;the&nbsp;m-&gt;curg&nbsp;stack&nbsp;will&nbsp;be&nbsp;unwound&nbsp;in&nbsp;lock&nbsp;step.</span><br>
<span class="lineno">70</span><span class="comment" id="1450549">//&nbsp;Then&nbsp;it&nbsp;calls&nbsp;p.GoF.&nbsp;&nbsp;Finally&nbsp;it&nbsp;pops&nbsp;but&nbsp;does&nbsp;not&nbsp;execute&nbsp;the&nbsp;deferred</span><br>
<span class="lineno"></span><span class="comment" id="1450624">//&nbsp;function,&nbsp;calls&nbsp;runtime.entersyscall,&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocallback.</span><br>
<span class="lineno"></span><span class="comment" id="1450701">//</span><br>
<span class="lineno"></span><span class="comment" id="1450704">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocallback&nbsp;switches&nbsp;back&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1450770">//&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;(the&nbsp;pointer&nbsp;is&nbsp;still&nbsp;in&nbsp;m-&gt;g0.sched.sp),&nbsp;restores&nbsp;the&nbsp;old</span><br>
<span class="lineno">75</span><span class="comment" id="1450846">//&nbsp;m-&gt;g0.sched.sp&nbsp;value&nbsp;from&nbsp;the&nbsp;stack,&nbsp;and&nbsp;returns&nbsp;to&nbsp;_cgoexp_GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1450914">//</span><br>
<span class="lineno"></span><span class="comment" id="1450917">//&nbsp;_cgoexp_GoF&nbsp;immediately&nbsp;returns&nbsp;to&nbsp;crosscall2,&nbsp;which&nbsp;restores&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1450986">//&nbsp;callee-save&nbsp;registers&nbsp;for&nbsp;gcc&nbsp;and&nbsp;returns&nbsp;to&nbsp;GoF,&nbsp;which&nbsp;returns&nbsp;to&nbsp;f.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="1451060">package</span>&nbsp;<span class="ident" id="1451068">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1451077">import</span>&nbsp;<span class="string" id="1451084">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1451094">//&nbsp;Call&nbsp;from&nbsp;Go&nbsp;to&nbsp;C.</span><br>
<span class="lineno">85</span><span class="comment" id="1451116">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1451129">func</span>&nbsp;<span class="ident" id="1451134">cgocall</span><span class="op" id="1451141">(</span><span class="ident" id="1451142">fn</span><span class="op" id="1451144">,</span>&nbsp;<span class="ident" id="1451146">arg</span>&nbsp;<span class="ident" id="1451150">unsafe</span><span class="op" id="1451156">.</span><span class="ident" id="1451157">Pointer</span><span class="op" id="1451164">)</span>&nbsp;<span class="op" id="1451166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1451169">cgocall_errno</span><span class="op" id="1451182">(</span><span class="ident" id="1451183">fn</span><span class="op" id="1451185">,</span>&nbsp;<span class="ident" id="1451187">arg</span><span class="op" id="1451190">)</span><br>
<span class="lineno"></span><span class="op" id="1451192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="1451195">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1451208">func</span>&nbsp;<span class="ident" id="1451213">cgocall_errno</span><span class="op" id="1451226">(</span><span class="ident" id="1451227">fn</span><span class="op" id="1451229">,</span>&nbsp;<span class="ident" id="1451231">arg</span>&nbsp;<span class="ident" id="1451235">unsafe</span><span class="op" id="1451241">.</span><span class="ident" id="1451242">Pointer</span><span class="op" id="1451249">)</span>&nbsp;<span class="builtintype" id="1451251">int32</span>&nbsp;<span class="op" id="1451257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1451260">if</span>&nbsp;<span class="op" id="1451263">!</span><span class="ident" id="1451264">iscgo</span>&nbsp;<span class="op" id="1451270">&amp;&amp;</span>&nbsp;<span class="ident" id="1451273">GOOS</span>&nbsp;<span class="op" id="1451278">!=</span>&nbsp;<span class="string" id="1451281">&#34;solaris&#34;</span>&nbsp;<span class="op" id="1451291">&amp;&amp;</span>&nbsp;<span class="ident" id="1451294">GOOS</span>&nbsp;<span class="op" id="1451299">!=</span>&nbsp;<span class="string" id="1451302">&#34;windows&#34;</span>&nbsp;<span class="op" id="1451312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1451316">gothrow</span><span class="op" id="1451323">(</span><span class="string" id="1451324">&#34;cgocall&nbsp;unavailable&#34;</span><span class="op" id="1451345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1451348">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1451352">if</span>&nbsp;<span class="ident" id="1451355">fn</span>&nbsp;<span class="op" id="1451358">==</span>&nbsp;<span class="builtintype" id="1451361">nil</span>&nbsp;<span class="op" id="1451365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1451369">gothrow</span><span class="op" id="1451376">(</span><span class="string" id="1451377">&#34;cgocall&nbsp;nil&#34;</span><span class="op" id="1451390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1451393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1451397">if</span>&nbsp;<span class="ident" id="1451400">raceenabled</span>&nbsp;<span class="op" id="1451412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1451416">racereleasemerge</span><span class="op" id="1451432">(</span><span class="ident" id="1451433">unsafe</span><span class="op" id="1451439">.</span><span class="ident" id="1451440">Pointer</span><span class="op" id="1451447">(</span><span class="op" id="1451448">&amp;</span><span class="ident" id="1451449">racecgosync</span><span class="op" id="1451460">)</span><span class="op" id="1451461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1451464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1451468">//&nbsp;Create&nbsp;an&nbsp;extra&nbsp;M&nbsp;for&nbsp;callbacks&nbsp;on&nbsp;threads&nbsp;not&nbsp;created&nbsp;by&nbsp;Go&nbsp;on&nbsp;first&nbsp;cgo&nbsp;call.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1451552">if</span>&nbsp;<span class="ident" id="1451555">needextram</span>&nbsp;<span class="op" id="1451566">==</span>&nbsp;<span class="num" id="1451569">1</span>&nbsp;<span class="op" id="1451571">&amp;&amp;</span>&nbsp;<span class="ident" id="1451574">cas</span><span class="op" id="1451577">(</span><span class="op" id="1451578">&amp;</span><span class="ident" id="1451579">needextram</span><span class="op" id="1451589">,</span>&nbsp;<span class="num" id="1451591">1</span><span class="op" id="1451592">,</span>&nbsp;<span class="num" id="1451594">0</span><span class="op" id="1451595">)</span>&nbsp;<span class="op" id="1451597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1451601">onM</span><span class="op" id="1451604">(</span><span class="ident" id="1451605">newextram</span><span class="op" id="1451614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1451617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1451621">/*<br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Lock&nbsp;g&nbsp;to&nbsp;m&nbsp;to&nbsp;ensure&nbsp;we&nbsp;stay&nbsp;on&nbsp;the&nbsp;same&nbsp;stack&nbsp;if&nbsp;we&nbsp;do&nbsp;a<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;cgo&nbsp;callback.&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1451754">lockOSThread</span><span class="op" id="1451766">(</span><span class="op" id="1451767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1451770">mp</span>&nbsp;<span class="op" id="1451773">:=</span>&nbsp;<span class="ident" id="1451776">getg</span><span class="op" id="1451780">(</span><span class="op" id="1451781">)</span><span class="op" id="1451782">.</span><span class="ident" id="1451783">m</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1451786">mp</span><span class="op" id="1451788">.</span><span class="ident" id="1451789">ncgocall</span><span class="op" id="1451797">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1451801">mp</span><span class="op" id="1451803">.</span><span class="ident" id="1451804">ncgo</span><span class="op" id="1451808">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1451812">defer</span>&nbsp;<span class="ident" id="1451818">endcgo</span><span class="op" id="1451824">(</span><span class="ident" id="1451825">mp</span><span class="op" id="1451827">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1451831">/*<br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Announce&nbsp;we&nbsp;are&nbsp;entering&nbsp;a&nbsp;system&nbsp;call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;so&nbsp;that&nbsp;the&nbsp;scheduler&nbsp;knows&nbsp;to&nbsp;create&nbsp;another<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;M&nbsp;to&nbsp;run&nbsp;goroutines&nbsp;while&nbsp;we&nbsp;are&nbsp;in&nbsp;the<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;foreign&nbsp;code.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;call&nbsp;to&nbsp;asmcgocall&nbsp;is&nbsp;guaranteed&nbsp;not&nbsp;to<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;split&nbsp;the&nbsp;stack&nbsp;and&nbsp;does&nbsp;not&nbsp;allocate&nbsp;memory,<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;so&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;call&nbsp;while&nbsp;&#34;in&nbsp;a&nbsp;system&nbsp;call&#34;,&nbsp;outside<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;$GOMAXPROCS&nbsp;accounting.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452189">entersyscall</span><span class="op" id="1452201">(</span><span class="op" id="1452202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452205">errno</span>&nbsp;<span class="op" id="1452211">:=</span>&nbsp;<span class="ident" id="1452214">asmcgocall_errno</span><span class="op" id="1452230">(</span><span class="ident" id="1452231">fn</span><span class="op" id="1452233">,</span>&nbsp;<span class="ident" id="1452235">arg</span><span class="op" id="1452238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452241">exitsyscall</span><span class="op" id="1452252">(</span><span class="op" id="1452253">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1452257">return</span>&nbsp;<span class="ident" id="1452264">errno</span><br>
<span class="lineno">135</span><span class="op" id="1452270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1452273">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1452286">func</span>&nbsp;<span class="ident" id="1452291">endcgo</span><span class="op" id="1452297">(</span><span class="ident" id="1452298">mp</span>&nbsp;<span class="op" id="1452301">*</span><span class="ident" id="1452302">m</span><span class="op" id="1452303">)</span>&nbsp;<span class="op" id="1452305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452308">mp</span><span class="op" id="1452310">.</span><span class="ident" id="1452311">ncgo</span><span class="op" id="1452315">--</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1452319">if</span>&nbsp;<span class="ident" id="1452322">mp</span><span class="op" id="1452324">.</span><span class="ident" id="1452325">ncgo</span>&nbsp;<span class="op" id="1452330">==</span>&nbsp;<span class="num" id="1452333">0</span>&nbsp;<span class="op" id="1452335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1452339">//&nbsp;We&nbsp;are&nbsp;going&nbsp;back&nbsp;to&nbsp;Go&nbsp;and&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;recursive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1452395">//&nbsp;call.&nbsp;&nbsp;Let&nbsp;the&nbsp;GC&nbsp;collect&nbsp;any&nbsp;memory&nbsp;allocated&nbsp;via</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1452451">//&nbsp;_cgo_allocate&nbsp;that&nbsp;is&nbsp;no&nbsp;longer&nbsp;referenced.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452500">mp</span><span class="op" id="1452502">.</span><span class="ident" id="1452503">cgomal</span>&nbsp;<span class="op" id="1452510">=</span>&nbsp;<span class="builtintype" id="1452512">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1452517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1452521">if</span>&nbsp;<span class="ident" id="1452524">raceenabled</span>&nbsp;<span class="op" id="1452536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452540">raceacquire</span><span class="op" id="1452551">(</span><span class="ident" id="1452552">unsafe</span><span class="op" id="1452558">.</span><span class="ident" id="1452559">Pointer</span><span class="op" id="1452566">(</span><span class="op" id="1452567">&amp;</span><span class="ident" id="1452568">racecgosync</span><span class="op" id="1452579">)</span><span class="op" id="1452580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1452583">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452587">unlockOSThread</span><span class="op" id="1452601">(</span><span class="op" id="1452602">)</span>&nbsp;<span class="comment" id="1452604">//&nbsp;invalidates&nbsp;mp</span><br>
<span class="lineno"></span><span class="op" id="1452622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1452625">//&nbsp;Helper&nbsp;functions&nbsp;for&nbsp;cgo&nbsp;code.</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="1452660">//&nbsp;Filled&nbsp;by&nbsp;schedinit&nbsp;from&nbsp;corresponding&nbsp;C&nbsp;variables,</span><br>
<span class="lineno"></span><span class="comment" id="1452715">//&nbsp;which&nbsp;are&nbsp;in&nbsp;turn&nbsp;filled&nbsp;in&nbsp;by&nbsp;dynamic&nbsp;linker&nbsp;when&nbsp;Cgo&nbsp;is&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="1452787">var</span>&nbsp;<span class="ident" id="1452791">cgoMalloc</span><span class="op" id="1452800">,</span>&nbsp;<span class="ident" id="1452802">cgoFree</span>&nbsp;<span class="ident" id="1452810">unsafe</span><span class="op" id="1452816">.</span><span class="ident" id="1452817">Pointer</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="keyword" id="1452826">func</span>&nbsp;<span class="ident" id="1452831">cmalloc</span><span class="op" id="1452838">(</span><span class="ident" id="1452839">n</span>&nbsp;<span class="builtintype" id="1452841">uintptr</span><span class="op" id="1452848">)</span>&nbsp;<span class="ident" id="1452850">unsafe</span><span class="op" id="1452856">.</span><span class="ident" id="1452857">Pointer</span>&nbsp;<span class="op" id="1452865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1452868">var</span>&nbsp;<span class="ident" id="1452872">args</span>&nbsp;<span class="keyword" id="1452877">struct</span>&nbsp;<span class="op" id="1452884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452888">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1452892">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452901">ret</span>&nbsp;<span class="ident" id="1452905">unsafe</span><span class="op" id="1452911">.</span><span class="ident" id="1452912">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1452921">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452924">args</span><span class="op" id="1452928">.</span><span class="ident" id="1452929">n</span>&nbsp;<span class="op" id="1452931">=</span>&nbsp;<span class="ident" id="1452933">uint64</span><span class="op" id="1452939">(</span><span class="ident" id="1452940">n</span><span class="op" id="1452941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1452944">cgocall</span><span class="op" id="1452951">(</span><span class="ident" id="1452952">cgoMalloc</span><span class="op" id="1452961">,</span>&nbsp;<span class="ident" id="1452963">unsafe</span><span class="op" id="1452969">.</span><span class="ident" id="1452970">Pointer</span><span class="op" id="1452977">(</span><span class="op" id="1452978">&amp;</span><span class="ident" id="1452979">args</span><span class="op" id="1452983">)</span><span class="op" id="1452984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1452987">if</span>&nbsp;<span class="ident" id="1452990">args</span><span class="op" id="1452994">.</span><span class="ident" id="1452995">ret</span>&nbsp;<span class="op" id="1452999">==</span>&nbsp;<span class="builtintype" id="1453002">nil</span>&nbsp;<span class="op" id="1453006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453010">gothrow</span><span class="op" id="1453017">(</span><span class="string" id="1453018">&#34;C&nbsp;malloc&nbsp;failed&#34;</span><span class="op" id="1453035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1453038">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1453041">return</span>&nbsp;<span class="ident" id="1453048">args</span><span class="op" id="1453052">.</span><span class="ident" id="1453053">ret</span><br>
<span class="lineno"></span><span class="op" id="1453057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1453060">func</span>&nbsp;<span class="ident" id="1453065">cfree</span><span class="op" id="1453070">(</span><span class="ident" id="1453071">p</span>&nbsp;<span class="ident" id="1453073">unsafe</span><span class="op" id="1453079">.</span><span class="ident" id="1453080">Pointer</span><span class="op" id="1453087">)</span>&nbsp;<span class="op" id="1453089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453092">cgocall</span><span class="op" id="1453099">(</span><span class="ident" id="1453100">cgoFree</span><span class="op" id="1453107">,</span>&nbsp;<span class="ident" id="1453109">p</span><span class="op" id="1453110">)</span><br>
<span class="lineno">175</span><span class="op" id="1453112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1453115">//&nbsp;Call&nbsp;from&nbsp;C&nbsp;back&nbsp;to&nbsp;Go.</span><br>
<span class="lineno"></span><span class="comment" id="1453142">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1453155">func</span>&nbsp;<span class="ident" id="1453160">cgocallbackg</span><span class="op" id="1453172">(</span><span class="op" id="1453173">)</span>&nbsp;<span class="op" id="1453175">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453178">gp</span>&nbsp;<span class="op" id="1453181">:=</span>&nbsp;<span class="ident" id="1453184">getg</span><span class="op" id="1453188">(</span><span class="op" id="1453189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1453192">if</span>&nbsp;<span class="ident" id="1453195">gp</span>&nbsp;<span class="op" id="1453198">!=</span>&nbsp;<span class="ident" id="1453201">gp</span><span class="op" id="1453203">.</span><span class="ident" id="1453204">m</span><span class="op" id="1453205">.</span><span class="ident" id="1453206">curg</span>&nbsp;<span class="op" id="1453211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1453215">println</span><span class="op" id="1453222">(</span><span class="string" id="1453223">&#34;runtime:&nbsp;bad&nbsp;g&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1453254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453258">exit</span><span class="op" id="1453262">(</span><span class="num" id="1453263">2</span><span class="op" id="1453264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1453267">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1453271">//&nbsp;entersyscall&nbsp;saves&nbsp;the&nbsp;caller&#39;s&nbsp;SP&nbsp;to&nbsp;allow&nbsp;the&nbsp;GC&nbsp;to&nbsp;trace&nbsp;the&nbsp;Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1453342">//&nbsp;stack.&nbsp;However,&nbsp;since&nbsp;we&#39;re&nbsp;returning&nbsp;to&nbsp;an&nbsp;earlier&nbsp;stack&nbsp;frame&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1453414">//&nbsp;need&nbsp;to&nbsp;pair&nbsp;with&nbsp;the&nbsp;entersyscall()&nbsp;call&nbsp;made&nbsp;by&nbsp;cgocall,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1453485">//&nbsp;save&nbsp;syscall*&nbsp;and&nbsp;let&nbsp;reentersyscall&nbsp;restore&nbsp;them.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453540">savedsp</span>&nbsp;<span class="op" id="1453548">:=</span>&nbsp;<span class="ident" id="1453551">unsafe</span><span class="op" id="1453557">.</span><span class="ident" id="1453558">Pointer</span><span class="op" id="1453565">(</span><span class="ident" id="1453566">gp</span><span class="op" id="1453568">.</span><span class="ident" id="1453569">syscallsp</span><span class="op" id="1453578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453581">savedpc</span>&nbsp;<span class="op" id="1453589">:=</span>&nbsp;<span class="ident" id="1453592">gp</span><span class="op" id="1453594">.</span><span class="ident" id="1453595">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453606">exitsyscall</span><span class="op" id="1453617">(</span><span class="op" id="1453618">)</span>&nbsp;<span class="comment" id="1453620">//&nbsp;coming&nbsp;out&nbsp;of&nbsp;cgo&nbsp;call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453647">cgocallbackg1</span><span class="op" id="1453660">(</span><span class="op" id="1453661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1453664">//&nbsp;going&nbsp;back&nbsp;to&nbsp;cgo&nbsp;call</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453691">reentersyscall</span><span class="op" id="1453705">(</span><span class="ident" id="1453706">savedpc</span><span class="op" id="1453713">,</span>&nbsp;<span class="ident" id="1453715">savedsp</span><span class="op" id="1453722">)</span><br>
<span class="lineno"></span><span class="op" id="1453724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1453727">func</span>&nbsp;<span class="ident" id="1453732">cgocallbackg1</span><span class="op" id="1453745">(</span><span class="op" id="1453746">)</span>&nbsp;<span class="op" id="1453748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453751">gp</span>&nbsp;<span class="op" id="1453754">:=</span>&nbsp;<span class="ident" id="1453757">getg</span><span class="op" id="1453761">(</span><span class="op" id="1453762">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1453765">if</span>&nbsp;<span class="ident" id="1453768">gp</span><span class="op" id="1453770">.</span><span class="ident" id="1453771">m</span><span class="op" id="1453772">.</span><span class="ident" id="1453773">needextram</span>&nbsp;<span class="op" id="1453784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453788">gp</span><span class="op" id="1453790">.</span><span class="ident" id="1453791">m</span><span class="op" id="1453792">.</span><span class="ident" id="1453793">needextram</span>&nbsp;<span class="op" id="1453804">=</span>&nbsp;<span class="builtintype" id="1453806">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453814">onM</span><span class="op" id="1453817">(</span><span class="ident" id="1453818">newextram</span><span class="op" id="1453827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1453830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1453834">//&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453881">restore</span>&nbsp;<span class="op" id="1453889">:=</span>&nbsp;<span class="builtintype" id="1453892">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1453898">defer</span>&nbsp;<span class="ident" id="1453904">unwindm</span><span class="op" id="1453911">(</span><span class="op" id="1453912">&amp;</span><span class="ident" id="1453913">restore</span><span class="op" id="1453920">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1453924">if</span>&nbsp;<span class="ident" id="1453927">raceenabled</span>&nbsp;<span class="op" id="1453939">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1453943">raceacquire</span><span class="op" id="1453954">(</span><span class="ident" id="1453955">unsafe</span><span class="op" id="1453961">.</span><span class="ident" id="1453962">Pointer</span><span class="op" id="1453969">(</span><span class="op" id="1453970">&amp;</span><span class="ident" id="1453971">racecgosync</span><span class="op" id="1453982">)</span><span class="op" id="1453983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1453986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1453990">type</span>&nbsp;<span class="ident" id="1453995">args</span>&nbsp;<span class="keyword" id="1454000">struct</span>&nbsp;<span class="op" id="1454007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1454011">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1454019">*</span><span class="ident" id="1454020">funcval</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1454030">arg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1454038">unsafe</span><span class="op" id="1454044">.</span><span class="ident" id="1454045">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1454055">argsize</span>&nbsp;<span class="builtintype" id="1454063">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1454072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1454075">var</span>&nbsp;<span class="ident" id="1454079">cb</span>&nbsp;<span class="op" id="1454082">*</span><span class="ident" id="1454083">args</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1454090">//&nbsp;Location&nbsp;of&nbsp;callback&nbsp;arguments&nbsp;depends&nbsp;on&nbsp;stack&nbsp;frame&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1454155">//&nbsp;and&nbsp;size&nbsp;of&nbsp;stack&nbsp;frame&nbsp;of&nbsp;cgocallback_gofunc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1454206">sp</span>&nbsp;<span class="op" id="1454209">:=</span>&nbsp;<span class="ident" id="1454212">gp</span><span class="op" id="1454214">.</span><span class="ident" id="1454215">m</span><span class="op" id="1454216">.</span><span class="ident" id="1454217">g0</span><span class="op" id="1454219">.</span><span class="ident" id="1454220">sched</span><span class="op" id="1454225">.</span><span class="ident" id="1454226">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1454230">switch</span>&nbsp;<span class="ident" id="1454237">GOARCH</span>&nbsp;<span class="op" id="1454244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1454247">default</span><span class="op" id="1454254">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1454258">gothrow</span><span class="op" id="1454265">(</span><span class="string" id="1454266">&#34;cgocallbackg&nbsp;is&nbsp;unimplemented&nbsp;on&nbsp;arch&#34;</span><span class="op" id="1454305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1454308">case</span>&nbsp;<span class="string" id="1454313">&#34;arm&#34;</span><span class="op" id="1454318">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1454322">//&nbsp;On&nbsp;arm,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;two&nbsp;words&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;saved&nbsp;LR&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1454391">//&nbsp;SP&nbsp;and&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;between&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;the&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1454466">cb</span>&nbsp;<span class="op" id="1454469">=</span>&nbsp;<span class="op" id="1454471">(</span><span class="op" id="1454472">*</span><span class="ident" id="1454473">args</span><span class="op" id="1454477">)</span><span class="op" id="1454478">(</span><span class="ident" id="1454479">unsafe</span><span class="op" id="1454485">.</span><span class="ident" id="1454486">Pointer</span><span class="op" id="1454493">(</span><span class="ident" id="1454494">sp</span>&nbsp;<span class="op" id="1454497">+</span>&nbsp;<span class="num" id="1454499">4</span><span class="op" id="1454500">*</span><span class="ident" id="1454501">ptrSize</span><span class="op" id="1454508">)</span><span class="op" id="1454509">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1454512">case</span>&nbsp;<span class="string" id="1454517">&#34;amd64&#34;</span><span class="op" id="1454524">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1454528">//&nbsp;On&nbsp;amd64,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;one&nbsp;word,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1454584">cb</span>&nbsp;<span class="op" id="1454587">=</span>&nbsp;<span class="op" id="1454589">(</span><span class="op" id="1454590">*</span><span class="ident" id="1454591">args</span><span class="op" id="1454595">)</span><span class="op" id="1454596">(</span><span class="ident" id="1454597">unsafe</span><span class="op" id="1454603">.</span><span class="ident" id="1454604">Pointer</span><span class="op" id="1454611">(</span><span class="ident" id="1454612">sp</span>&nbsp;<span class="op" id="1454615">+</span>&nbsp;<span class="num" id="1454617">2</span><span class="op" id="1454618">*</span><span class="ident" id="1454619">ptrSize</span><span class="op" id="1454626">)</span><span class="op" id="1454627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1454630">case</span>&nbsp;<span class="string" id="1454635">&#34;386&#34;</span><span class="op" id="1454640">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1454644">//&nbsp;On&nbsp;386,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;three&nbsp;words,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1454701">cb</span>&nbsp;<span class="op" id="1454704">=</span>&nbsp;<span class="op" id="1454706">(</span><span class="op" id="1454707">*</span><span class="ident" id="1454708">args</span><span class="op" id="1454712">)</span><span class="op" id="1454713">(</span><span class="ident" id="1454714">unsafe</span><span class="op" id="1454720">.</span><span class="ident" id="1454721">Pointer</span><span class="op" id="1454728">(</span><span class="ident" id="1454729">sp</span>&nbsp;<span class="op" id="1454732">+</span>&nbsp;<span class="num" id="1454734">4</span><span class="op" id="1454735">*</span><span class="ident" id="1454736">ptrSize</span><span class="op" id="1454743">)</span><span class="op" id="1454744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1454747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1454751">//&nbsp;Invoke&nbsp;callback.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1454772">reflectcall</span><span class="op" id="1454783">(</span><span class="ident" id="1454784">unsafe</span><span class="op" id="1454790">.</span><span class="ident" id="1454791">Pointer</span><span class="op" id="1454798">(</span><span class="ident" id="1454799">cb</span><span class="op" id="1454801">.</span><span class="ident" id="1454802">fn</span><span class="op" id="1454804">)</span><span class="op" id="1454805">,</span>&nbsp;<span class="ident" id="1454807">unsafe</span><span class="op" id="1454813">.</span><span class="ident" id="1454814">Pointer</span><span class="op" id="1454821">(</span><span class="ident" id="1454822">cb</span><span class="op" id="1454824">.</span><span class="ident" id="1454825">arg</span><span class="op" id="1454828">)</span><span class="op" id="1454829">,</span>&nbsp;<span class="builtintype" id="1454831">uint32</span><span class="op" id="1454837">(</span><span class="ident" id="1454838">cb</span><span class="op" id="1454840">.</span><span class="ident" id="1454841">argsize</span><span class="op" id="1454848">)</span><span class="op" id="1454849">,</span>&nbsp;<span class="num" id="1454851">0</span><span class="op" id="1454852">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1454856">if</span>&nbsp;<span class="ident" id="1454859">raceenabled</span>&nbsp;<span class="op" id="1454871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1454875">racereleasemerge</span><span class="op" id="1454891">(</span><span class="ident" id="1454892">unsafe</span><span class="op" id="1454898">.</span><span class="ident" id="1454899">Pointer</span><span class="op" id="1454906">(</span><span class="op" id="1454907">&amp;</span><span class="ident" id="1454908">racecgosync</span><span class="op" id="1454919">)</span><span class="op" id="1454920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1454923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1454927">//&nbsp;Do&nbsp;not&nbsp;unwind&nbsp;m-&gt;g0-&gt;sched.sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1454962">//&nbsp;Our&nbsp;caller,&nbsp;cgocallback,&nbsp;will&nbsp;do&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1455005">restore</span>&nbsp;<span class="op" id="1455013">=</span>&nbsp;<span class="builtintype" id="1455015">false</span><br>
<span class="lineno"></span><span class="op" id="1455021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="1455024">func</span>&nbsp;<span class="ident" id="1455029">unwindm</span><span class="op" id="1455036">(</span><span class="ident" id="1455037">restore</span>&nbsp;<span class="op" id="1455045">*</span><span class="builtintype" id="1455046">bool</span><span class="op" id="1455050">)</span>&nbsp;<span class="op" id="1455052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1455055">if</span>&nbsp;<span class="op" id="1455058">!</span><span class="op" id="1455059">*</span><span class="ident" id="1455060">restore</span>&nbsp;<span class="op" id="1455068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1455072">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1455080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1455083">//&nbsp;Restore&nbsp;sp&nbsp;saved&nbsp;by&nbsp;cgocallback&nbsp;during</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1455126">//&nbsp;unwind&nbsp;of&nbsp;g&#39;s&nbsp;stack&nbsp;(see&nbsp;comment&nbsp;at&nbsp;top&nbsp;of&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1455180">mp</span>&nbsp;<span class="op" id="1455183">:=</span>&nbsp;<span class="ident" id="1455186">acquirem</span><span class="op" id="1455194">(</span><span class="op" id="1455195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1455198">sched</span>&nbsp;<span class="op" id="1455204">:=</span>&nbsp;<span class="op" id="1455207">&amp;</span><span class="ident" id="1455208">mp</span><span class="op" id="1455210">.</span><span class="ident" id="1455211">g0</span><span class="op" id="1455213">.</span><span class="ident" id="1455214">sched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1455221">switch</span>&nbsp;<span class="ident" id="1455228">GOARCH</span>&nbsp;<span class="op" id="1455235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1455238">default</span><span class="op" id="1455245">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1455249">gothrow</span><span class="op" id="1455256">(</span><span class="string" id="1455257">&#34;unwindm&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1455282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1455285">case</span>&nbsp;<span class="string" id="1455290">&#34;386&#34;</span><span class="op" id="1455295">,</span>&nbsp;<span class="string" id="1455297">&#34;amd64&#34;</span><span class="op" id="1455304">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1455308">sched</span><span class="op" id="1455313">.</span><span class="ident" id="1455314">sp</span>&nbsp;<span class="op" id="1455317">=</span>&nbsp;<span class="op" id="1455319">*</span><span class="op" id="1455320">(</span><span class="op" id="1455321">*</span><span class="builtintype" id="1455322">uintptr</span><span class="op" id="1455329">)</span><span class="op" id="1455330">(</span><span class="ident" id="1455331">unsafe</span><span class="op" id="1455337">.</span><span class="ident" id="1455338">Pointer</span><span class="op" id="1455345">(</span><span class="ident" id="1455346">sched</span><span class="op" id="1455351">.</span><span class="ident" id="1455352">sp</span><span class="op" id="1455354">)</span><span class="op" id="1455355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1455358">case</span>&nbsp;<span class="string" id="1455363">&#34;arm&#34;</span><span class="op" id="1455368">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1455372">sched</span><span class="op" id="1455377">.</span><span class="ident" id="1455378">sp</span>&nbsp;<span class="op" id="1455381">=</span>&nbsp;<span class="op" id="1455383">*</span><span class="op" id="1455384">(</span><span class="op" id="1455385">*</span><span class="builtintype" id="1455386">uintptr</span><span class="op" id="1455393">)</span><span class="op" id="1455394">(</span><span class="ident" id="1455395">unsafe</span><span class="op" id="1455401">.</span><span class="ident" id="1455402">Pointer</span><span class="op" id="1455409">(</span><span class="ident" id="1455410">sched</span><span class="op" id="1455415">.</span><span class="ident" id="1455416">sp</span>&nbsp;<span class="op" id="1455419">+</span>&nbsp;<span class="num" id="1455421">4</span><span class="op" id="1455422">)</span><span class="op" id="1455423">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1455426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1455429">releasem</span><span class="op" id="1455437">(</span><span class="ident" id="1455438">mp</span><span class="op" id="1455440">)</span><br>
<span class="lineno"></span><span class="op" id="1455442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1455445">//&nbsp;called&nbsp;from&nbsp;assembly</span><br>
<span class="lineno">270</span><span class="keyword" id="1455469">func</span>&nbsp;<span class="ident" id="1455474">badcgocallback</span><span class="op" id="1455488">(</span><span class="op" id="1455489">)</span>&nbsp;<span class="op" id="1455491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1455494">gothrow</span><span class="op" id="1455501">(</span><span class="string" id="1455502">&#34;misaligned&nbsp;stack&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1455535">)</span><br>
<span class="lineno"></span><span class="op" id="1455537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1455540">//&nbsp;called&nbsp;from&nbsp;(incomplete)&nbsp;assembly</span><br>
<span class="lineno">275</span><span class="keyword" id="1455577">func</span>&nbsp;<span class="ident" id="1455582">cgounimpl</span><span class="op" id="1455591">(</span><span class="op" id="1455592">)</span>&nbsp;<span class="op" id="1455594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1455597">gothrow</span><span class="op" id="1455604">(</span><span class="string" id="1455605">&#34;cgo&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1455626">)</span><br>
<span class="lineno"></span><span class="op" id="1455628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1455631">var</span>&nbsp;<span class="ident" id="1455635">racecgosync</span>&nbsp;<span class="ident" id="1455647">uint64</span>&nbsp;<span class="comment" id="1455654">//&nbsp;represents&nbsp;possible&nbsp;synchronization&nbsp;in&nbsp;C&nbsp;code</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
