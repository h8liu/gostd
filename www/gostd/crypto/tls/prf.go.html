<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4543509">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4543564">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4543618">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4543669">package</span>&nbsp;<span class="ident" id="4543677">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4543682">import</span>&nbsp;<span class="op" id="4543689">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4543692">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4543702">&#34;crypto/hmac&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4543717">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4543731">&#34;crypto/sha1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4543746">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4543763">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4543770">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4543773">//&nbsp;Split&nbsp;a&nbsp;premaster&nbsp;secret&nbsp;in&nbsp;two&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4543845">func</span>&nbsp;<span class="ident" id="4543850">splitPreMasterSecret</span><span class="op" id="4543870">(</span><span class="ident" id="4543871">secret</span>&nbsp;<span class="op" id="4543878">[</span><span class="op" id="4543879">]</span><span class="builtintype" id="4543880">byte</span><span class="op" id="4543884">)</span>&nbsp;<span class="op" id="4543886">(</span><span class="ident" id="4543887">s1</span><span class="op" id="4543889">,</span>&nbsp;<span class="ident" id="4543891">s2</span>&nbsp;<span class="op" id="4543894">[</span><span class="op" id="4543895">]</span><span class="builtintype" id="4543896">byte</span><span class="op" id="4543900">)</span>&nbsp;<span class="op" id="4543902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4543905">s1</span>&nbsp;<span class="op" id="4543908">=</span>&nbsp;<span class="ident" id="4543910">secret</span><span class="op" id="4543916">[</span><span class="num" id="4543917">0</span>&nbsp;<span class="op" id="4543919">:</span>&nbsp;<span class="op" id="4543921">(</span><span class="builtinfunc" id="4543922">len</span><span class="op" id="4543925">(</span><span class="ident" id="4543926">secret</span><span class="op" id="4543932">)</span><span class="op" id="4543933">+</span><span class="num" id="4543934">1</span><span class="op" id="4543935">)</span><span class="op" id="4543936">/</span><span class="num" id="4543937">2</span><span class="op" id="4543938">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4543941">s2</span>&nbsp;<span class="op" id="4543944">=</span>&nbsp;<span class="ident" id="4543946">secret</span><span class="op" id="4543952">[</span><span class="builtinfunc" id="4543953">len</span><span class="op" id="4543956">(</span><span class="ident" id="4543957">secret</span><span class="op" id="4543963">)</span><span class="op" id="4543964">/</span><span class="num" id="4543965">2</span><span class="op" id="4543966">:</span><span class="op" id="4543967">]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4543970">return</span><br>
<span class="lineno"></span><span class="op" id="4543977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4543980">//&nbsp;pHash&nbsp;implements&nbsp;the&nbsp;P_hash&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4544056">func</span>&nbsp;<span class="ident" id="4544061">pHash</span><span class="op" id="4544066">(</span><span class="ident" id="4544067">result</span><span class="op" id="4544073">,</span>&nbsp;<span class="ident" id="4544075">secret</span><span class="op" id="4544081">,</span>&nbsp;<span class="ident" id="4544083">seed</span>&nbsp;<span class="op" id="4544088">[</span><span class="op" id="4544089">]</span><span class="builtintype" id="4544090">byte</span><span class="op" id="4544094">,</span>&nbsp;<span class="ident" id="4544096">hash</span>&nbsp;<span class="keyword" id="4544101">func</span><span class="op" id="4544105">(</span><span class="op" id="4544106">)</span>&nbsp;<span class="ident" id="4544108">hash</span><span class="op" id="4544112">.</span><span class="ident" id="4544113">Hash</span><span class="op" id="4544117">)</span>&nbsp;<span class="op" id="4544119">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544122">h</span>&nbsp;<span class="op" id="4544124">:=</span>&nbsp;<span class="ident" id="4544127">hmac</span><span class="op" id="4544131">.</span><span class="ident" id="4544132">New</span><span class="op" id="4544135">(</span><span class="ident" id="4544136">hash</span><span class="op" id="4544140">,</span>&nbsp;<span class="ident" id="4544142">secret</span><span class="op" id="4544148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544151">h</span><span class="op" id="4544152">.</span><span class="ident" id="4544153">Write</span><span class="op" id="4544158">(</span><span class="ident" id="4544159">seed</span><span class="op" id="4544163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544166">a</span>&nbsp;<span class="op" id="4544168">:=</span>&nbsp;<span class="ident" id="4544171">h</span><span class="op" id="4544172">.</span><span class="ident" id="4544173">Sum</span><span class="op" id="4544176">(</span><span class="ident" id="4544177">nil</span><span class="op" id="4544180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544184">j</span>&nbsp;<span class="op" id="4544186">:=</span>&nbsp;<span class="num" id="4544189">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4544192">for</span>&nbsp;<span class="ident" id="4544196">j</span>&nbsp;<span class="op" id="4544198">&lt;</span>&nbsp;<span class="builtinfunc" id="4544200">len</span><span class="op" id="4544203">(</span><span class="ident" id="4544204">result</span><span class="op" id="4544210">)</span>&nbsp;<span class="op" id="4544212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544216">h</span><span class="op" id="4544217">.</span><span class="ident" id="4544218">Reset</span><span class="op" id="4544223">(</span><span class="op" id="4544224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544228">h</span><span class="op" id="4544229">.</span><span class="ident" id="4544230">Write</span><span class="op" id="4544235">(</span><span class="ident" id="4544236">a</span><span class="op" id="4544237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544241">h</span><span class="op" id="4544242">.</span><span class="ident" id="4544243">Write</span><span class="op" id="4544248">(</span><span class="ident" id="4544249">seed</span><span class="op" id="4544253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544257">b</span>&nbsp;<span class="op" id="4544259">:=</span>&nbsp;<span class="ident" id="4544262">h</span><span class="op" id="4544263">.</span><span class="ident" id="4544264">Sum</span><span class="op" id="4544267">(</span><span class="ident" id="4544268">nil</span><span class="op" id="4544271">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544275">todo</span>&nbsp;<span class="op" id="4544280">:=</span>&nbsp;<span class="builtinfunc" id="4544283">len</span><span class="op" id="4544286">(</span><span class="ident" id="4544287">b</span><span class="op" id="4544288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4544292">if</span>&nbsp;<span class="ident" id="4544295">j</span><span class="op" id="4544296">+</span><span class="ident" id="4544297">todo</span>&nbsp;<span class="op" id="4544302">&gt;</span>&nbsp;<span class="builtinfunc" id="4544304">len</span><span class="op" id="4544307">(</span><span class="ident" id="4544308">result</span><span class="op" id="4544314">)</span>&nbsp;<span class="op" id="4544316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544321">todo</span>&nbsp;<span class="op" id="4544326">=</span>&nbsp;<span class="builtinfunc" id="4544328">len</span><span class="op" id="4544331">(</span><span class="ident" id="4544332">result</span><span class="op" id="4544338">)</span>&nbsp;<span class="op" id="4544340">-</span>&nbsp;<span class="ident" id="4544342">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4544346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4544350">copy</span><span class="op" id="4544354">(</span><span class="ident" id="4544355">result</span><span class="op" id="4544361">[</span><span class="ident" id="4544362">j</span><span class="op" id="4544363">:</span><span class="ident" id="4544364">j</span><span class="op" id="4544365">+</span><span class="ident" id="4544366">todo</span><span class="op" id="4544370">]</span><span class="op" id="4544371">,</span>&nbsp;<span class="ident" id="4544373">b</span><span class="op" id="4544374">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544378">j</span>&nbsp;<span class="op" id="4544380">+=</span>&nbsp;<span class="ident" id="4544383">todo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544391">h</span><span class="op" id="4544392">.</span><span class="ident" id="4544393">Reset</span><span class="op" id="4544398">(</span><span class="op" id="4544399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544403">h</span><span class="op" id="4544404">.</span><span class="ident" id="4544405">Write</span><span class="op" id="4544410">(</span><span class="ident" id="4544411">a</span><span class="op" id="4544412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544416">a</span>&nbsp;<span class="op" id="4544418">=</span>&nbsp;<span class="ident" id="4544420">h</span><span class="op" id="4544421">.</span><span class="ident" id="4544422">Sum</span><span class="op" id="4544425">(</span><span class="ident" id="4544426">nil</span><span class="op" id="4544429">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4544432">}</span><br>
<span class="lineno"></span><span class="op" id="4544434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4544437">//&nbsp;prf10&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4544528">func</span>&nbsp;<span class="ident" id="4544533">prf10</span><span class="op" id="4544538">(</span><span class="ident" id="4544539">result</span><span class="op" id="4544545">,</span>&nbsp;<span class="ident" id="4544547">secret</span><span class="op" id="4544553">,</span>&nbsp;<span class="ident" id="4544555">label</span><span class="op" id="4544560">,</span>&nbsp;<span class="ident" id="4544562">seed</span>&nbsp;<span class="op" id="4544567">[</span><span class="op" id="4544568">]</span><span class="builtintype" id="4544569">byte</span><span class="op" id="4544573">)</span>&nbsp;<span class="op" id="4544575">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544578">hashSHA1</span>&nbsp;<span class="op" id="4544587">:=</span>&nbsp;<span class="ident" id="4544590">sha1</span><span class="op" id="4544594">.</span><span class="ident" id="4544595">New</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544600">hashMD5</span>&nbsp;<span class="op" id="4544608">:=</span>&nbsp;<span class="ident" id="4544611">md5</span><span class="op" id="4544614">.</span><span class="ident" id="4544615">New</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544621">labelAndSeed</span>&nbsp;<span class="op" id="4544634">:=</span>&nbsp;<span class="builtinfunc" id="4544637">make</span><span class="op" id="4544641">(</span><span class="op" id="4544642">[</span><span class="op" id="4544643">]</span><span class="builtintype" id="4544644">byte</span><span class="op" id="4544648">,</span>&nbsp;<span class="builtinfunc" id="4544650">len</span><span class="op" id="4544653">(</span><span class="ident" id="4544654">label</span><span class="op" id="4544659">)</span><span class="op" id="4544660">+</span><span class="builtinfunc" id="4544661">len</span><span class="op" id="4544664">(</span><span class="ident" id="4544665">seed</span><span class="op" id="4544669">)</span><span class="op" id="4544670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4544673">copy</span><span class="op" id="4544677">(</span><span class="ident" id="4544678">labelAndSeed</span><span class="op" id="4544690">,</span>&nbsp;<span class="ident" id="4544692">label</span><span class="op" id="4544697">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4544700">copy</span><span class="op" id="4544704">(</span><span class="ident" id="4544705">labelAndSeed</span><span class="op" id="4544717">[</span><span class="builtinfunc" id="4544718">len</span><span class="op" id="4544721">(</span><span class="ident" id="4544722">label</span><span class="op" id="4544727">)</span><span class="op" id="4544728">:</span><span class="op" id="4544729">]</span><span class="op" id="4544730">,</span>&nbsp;<span class="ident" id="4544732">seed</span><span class="op" id="4544736">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544740">s1</span><span class="op" id="4544742">,</span>&nbsp;<span class="ident" id="4544744">s2</span>&nbsp;<span class="op" id="4544747">:=</span>&nbsp;<span class="ident" id="4544750">splitPreMasterSecret</span><span class="op" id="4544770">(</span><span class="ident" id="4544771">secret</span><span class="op" id="4544777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544780">pHash</span><span class="op" id="4544785">(</span><span class="ident" id="4544786">result</span><span class="op" id="4544792">,</span>&nbsp;<span class="ident" id="4544794">s1</span><span class="op" id="4544796">,</span>&nbsp;<span class="ident" id="4544798">labelAndSeed</span><span class="op" id="4544810">,</span>&nbsp;<span class="ident" id="4544812">hashMD5</span><span class="op" id="4544819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544822">result2</span>&nbsp;<span class="op" id="4544830">:=</span>&nbsp;<span class="builtinfunc" id="4544833">make</span><span class="op" id="4544837">(</span><span class="op" id="4544838">[</span><span class="op" id="4544839">]</span><span class="builtintype" id="4544840">byte</span><span class="op" id="4544844">,</span>&nbsp;<span class="builtinfunc" id="4544846">len</span><span class="op" id="4544849">(</span><span class="ident" id="4544850">result</span><span class="op" id="4544856">)</span><span class="op" id="4544857">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544860">pHash</span><span class="op" id="4544865">(</span><span class="ident" id="4544866">result2</span><span class="op" id="4544873">,</span>&nbsp;<span class="ident" id="4544875">s2</span><span class="op" id="4544877">,</span>&nbsp;<span class="ident" id="4544879">labelAndSeed</span><span class="op" id="4544891">,</span>&nbsp;<span class="ident" id="4544893">hashSHA1</span><span class="op" id="4544901">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4544905">for</span>&nbsp;<span class="ident" id="4544909">i</span><span class="op" id="4544910">,</span>&nbsp;<span class="ident" id="4544912">b</span>&nbsp;<span class="op" id="4544914">:=</span>&nbsp;<span class="keyword" id="4544917">range</span>&nbsp;<span class="ident" id="4544923">result2</span>&nbsp;<span class="op" id="4544931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4544935">result</span><span class="op" id="4544941">[</span><span class="ident" id="4544942">i</span><span class="op" id="4544943">]</span>&nbsp;<span class="op" id="4544945">^=</span>&nbsp;<span class="ident" id="4544948">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4544951">}</span><br>
<span class="lineno">65</span><span class="op" id="4544953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4544956">//&nbsp;prf12&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.2&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4545047">func</span>&nbsp;<span class="ident" id="4545052">prf12</span><span class="op" id="4545057">(</span><span class="ident" id="4545058">result</span><span class="op" id="4545064">,</span>&nbsp;<span class="ident" id="4545066">secret</span><span class="op" id="4545072">,</span>&nbsp;<span class="ident" id="4545074">label</span><span class="op" id="4545079">,</span>&nbsp;<span class="ident" id="4545081">seed</span>&nbsp;<span class="op" id="4545086">[</span><span class="op" id="4545087">]</span><span class="builtintype" id="4545088">byte</span><span class="op" id="4545092">)</span>&nbsp;<span class="op" id="4545094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545097">labelAndSeed</span>&nbsp;<span class="op" id="4545110">:=</span>&nbsp;<span class="builtinfunc" id="4545113">make</span><span class="op" id="4545117">(</span><span class="op" id="4545118">[</span><span class="op" id="4545119">]</span><span class="builtintype" id="4545120">byte</span><span class="op" id="4545124">,</span>&nbsp;<span class="builtinfunc" id="4545126">len</span><span class="op" id="4545129">(</span><span class="ident" id="4545130">label</span><span class="op" id="4545135">)</span><span class="op" id="4545136">+</span><span class="builtinfunc" id="4545137">len</span><span class="op" id="4545140">(</span><span class="ident" id="4545141">seed</span><span class="op" id="4545145">)</span><span class="op" id="4545146">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4545149">copy</span><span class="op" id="4545153">(</span><span class="ident" id="4545154">labelAndSeed</span><span class="op" id="4545166">,</span>&nbsp;<span class="ident" id="4545168">label</span><span class="op" id="4545173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4545176">copy</span><span class="op" id="4545180">(</span><span class="ident" id="4545181">labelAndSeed</span><span class="op" id="4545193">[</span><span class="builtinfunc" id="4545194">len</span><span class="op" id="4545197">(</span><span class="ident" id="4545198">label</span><span class="op" id="4545203">)</span><span class="op" id="4545204">:</span><span class="op" id="4545205">]</span><span class="op" id="4545206">,</span>&nbsp;<span class="ident" id="4545208">seed</span><span class="op" id="4545212">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545216">pHash</span><span class="op" id="4545221">(</span><span class="ident" id="4545222">result</span><span class="op" id="4545228">,</span>&nbsp;<span class="ident" id="4545230">secret</span><span class="op" id="4545236">,</span>&nbsp;<span class="ident" id="4545238">labelAndSeed</span><span class="op" id="4545250">,</span>&nbsp;<span class="ident" id="4545252">sha256</span><span class="op" id="4545258">.</span><span class="ident" id="4545259">New</span><span class="op" id="4545262">)</span><br>
<span class="lineno"></span><span class="op" id="4545264">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4545267">//&nbsp;prf30&nbsp;implements&nbsp;the&nbsp;SSL&nbsp;3.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4545337">//&nbsp;www.mozilla.org/projects/security/pki/nss/ssl/draft302.txt&nbsp;section&nbsp;6.</span><br>
<span class="lineno"></span><span class="keyword" id="4545410">func</span>&nbsp;<span class="ident" id="4545415">prf30</span><span class="op" id="4545420">(</span><span class="ident" id="4545421">result</span><span class="op" id="4545427">,</span>&nbsp;<span class="ident" id="4545429">secret</span><span class="op" id="4545435">,</span>&nbsp;<span class="ident" id="4545437">label</span><span class="op" id="4545442">,</span>&nbsp;<span class="ident" id="4545444">seed</span>&nbsp;<span class="op" id="4545449">[</span><span class="op" id="4545450">]</span><span class="builtintype" id="4545451">byte</span><span class="op" id="4545455">)</span>&nbsp;<span class="op" id="4545457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545460">hashSHA1</span>&nbsp;<span class="op" id="4545469">:=</span>&nbsp;<span class="ident" id="4545472">sha1</span><span class="op" id="4545476">.</span><span class="ident" id="4545477">New</span><span class="op" id="4545480">(</span><span class="op" id="4545481">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545484">hashMD5</span>&nbsp;<span class="op" id="4545492">:=</span>&nbsp;<span class="ident" id="4545495">md5</span><span class="op" id="4545498">.</span><span class="ident" id="4545499">New</span><span class="op" id="4545502">(</span><span class="op" id="4545503">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545507">done</span>&nbsp;<span class="op" id="4545512">:=</span>&nbsp;<span class="num" id="4545515">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545518">i</span>&nbsp;<span class="op" id="4545520">:=</span>&nbsp;<span class="num" id="4545523">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4545526">//&nbsp;RFC5246&nbsp;section&nbsp;6.3&nbsp;says&nbsp;that&nbsp;the&nbsp;largest&nbsp;PRF&nbsp;output&nbsp;needed&nbsp;is&nbsp;128</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4545597">//&nbsp;bytes.&nbsp;Since&nbsp;no&nbsp;more&nbsp;ciphersuites&nbsp;will&nbsp;be&nbsp;added&nbsp;to&nbsp;SSLv3,&nbsp;this&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4545669">//&nbsp;remain&nbsp;true.&nbsp;Each&nbsp;iteration&nbsp;gives&nbsp;us&nbsp;16&nbsp;bytes&nbsp;so&nbsp;10&nbsp;iterations&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4545741">//&nbsp;be&nbsp;sufficient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4545760">var</span>&nbsp;<span class="ident" id="4545764">b</span>&nbsp;<span class="op" id="4545766">[</span><span class="num" id="4545767">11</span><span class="op" id="4545769">]</span><span class="builtintype" id="4545770">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4545776">for</span>&nbsp;<span class="ident" id="4545780">done</span>&nbsp;<span class="op" id="4545785">&lt;</span>&nbsp;<span class="builtinfunc" id="4545787">len</span><span class="op" id="4545790">(</span><span class="ident" id="4545791">result</span><span class="op" id="4545797">)</span>&nbsp;<span class="op" id="4545799">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4545803">for</span>&nbsp;<span class="ident" id="4545807">j</span>&nbsp;<span class="op" id="4545809">:=</span>&nbsp;<span class="num" id="4545812">0</span><span class="op" id="4545813">;</span>&nbsp;<span class="ident" id="4545815">j</span>&nbsp;<span class="op" id="4545817">&lt;=</span>&nbsp;<span class="ident" id="4545820">i</span><span class="op" id="4545821">;</span>&nbsp;<span class="ident" id="4545823">j</span><span class="op" id="4545824">++</span>&nbsp;<span class="op" id="4545827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545832">b</span><span class="op" id="4545833">[</span><span class="ident" id="4545834">j</span><span class="op" id="4545835">]</span>&nbsp;<span class="op" id="4545837">=</span>&nbsp;<span class="string" id="4545839">&#39;A&#39;</span>&nbsp;<span class="op" id="4545843">+</span>&nbsp;<span class="builtintype" id="4545845">byte</span><span class="op" id="4545849">(</span><span class="ident" id="4545850">i</span><span class="op" id="4545851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4545855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545860">hashSHA1</span><span class="op" id="4545868">.</span><span class="ident" id="4545869">Reset</span><span class="op" id="4545874">(</span><span class="op" id="4545875">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545879">hashSHA1</span><span class="op" id="4545887">.</span><span class="ident" id="4545888">Write</span><span class="op" id="4545893">(</span><span class="ident" id="4545894">b</span><span class="op" id="4545895">[</span><span class="op" id="4545896">:</span><span class="ident" id="4545897">i</span><span class="op" id="4545898">+</span><span class="num" id="4545899">1</span><span class="op" id="4545900">]</span><span class="op" id="4545901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545905">hashSHA1</span><span class="op" id="4545913">.</span><span class="ident" id="4545914">Write</span><span class="op" id="4545919">(</span><span class="ident" id="4545920">secret</span><span class="op" id="4545926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545930">hashSHA1</span><span class="op" id="4545938">.</span><span class="ident" id="4545939">Write</span><span class="op" id="4545944">(</span><span class="ident" id="4545945">seed</span><span class="op" id="4545949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545953">digest</span>&nbsp;<span class="op" id="4545960">:=</span>&nbsp;<span class="ident" id="4545963">hashSHA1</span><span class="op" id="4545971">.</span><span class="ident" id="4545972">Sum</span><span class="op" id="4545975">(</span><span class="ident" id="4545976">nil</span><span class="op" id="4545979">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4545984">hashMD5</span><span class="op" id="4545991">.</span><span class="ident" id="4545992">Reset</span><span class="op" id="4545997">(</span><span class="op" id="4545998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4546002">hashMD5</span><span class="op" id="4546009">.</span><span class="ident" id="4546010">Write</span><span class="op" id="4546015">(</span><span class="ident" id="4546016">secret</span><span class="op" id="4546022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4546026">hashMD5</span><span class="op" id="4546033">.</span><span class="ident" id="4546034">Write</span><span class="op" id="4546039">(</span><span class="ident" id="4546040">digest</span><span class="op" id="4546046">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4546051">done</span>&nbsp;<span class="op" id="4546056">+=</span>&nbsp;<span class="builtinfunc" id="4546059">copy</span><span class="op" id="4546063">(</span><span class="ident" id="4546064">result</span><span class="op" id="4546070">[</span><span class="ident" id="4546071">done</span><span class="op" id="4546075">:</span><span class="op" id="4546076">]</span><span class="op" id="4546077">,</span>&nbsp;<span class="ident" id="4546079">hashMD5</span><span class="op" id="4546086">.</span><span class="ident" id="4546087">Sum</span><span class="op" id="4546090">(</span><span class="ident" id="4546091">nil</span><span class="op" id="4546094">)</span><span class="op" id="4546095">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4546099">i</span><span class="op" id="4546100">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4546104">}</span><br>
<span class="lineno"></span><span class="op" id="4546106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4546109">const</span>&nbsp;<span class="op" id="4546115">(</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4546118">tlsRandomLength</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4546139">=</span>&nbsp;<span class="num" id="4546141">32</span>&nbsp;<span class="comment" id="4546144">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;random&nbsp;nonce&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4546185">masterSecretLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4546206">=</span>&nbsp;<span class="num" id="4546208">48</span>&nbsp;<span class="comment" id="4546211">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;master&nbsp;secret&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4546253">finishedVerifyLength</span>&nbsp;<span class="op" id="4546274">=</span>&nbsp;<span class="num" id="4546276">12</span>&nbsp;<span class="comment" id="4546279">//&nbsp;Length&nbsp;of&nbsp;verify_data&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="op" id="4546327">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="4546330">var</span>&nbsp;<span class="ident" id="4546334">masterSecretLabel</span>&nbsp;<span class="op" id="4546352">=</span>&nbsp;<span class="op" id="4546354">[</span><span class="op" id="4546355">]</span><span class="builtintype" id="4546356">byte</span><span class="op" id="4546360">(</span><span class="string" id="4546361">&#34;master&nbsp;secret&#34;</span><span class="op" id="4546376">)</span><br>
<span class="lineno"></span><span class="keyword" id="4546378">var</span>&nbsp;<span class="ident" id="4546382">keyExpansionLabel</span>&nbsp;<span class="op" id="4546400">=</span>&nbsp;<span class="op" id="4546402">[</span><span class="op" id="4546403">]</span><span class="builtintype" id="4546404">byte</span><span class="op" id="4546408">(</span><span class="string" id="4546409">&#34;key&nbsp;expansion&#34;</span><span class="op" id="4546424">)</span><br>
<span class="lineno"></span><span class="keyword" id="4546426">var</span>&nbsp;<span class="ident" id="4546430">clientFinishedLabel</span>&nbsp;<span class="op" id="4546450">=</span>&nbsp;<span class="op" id="4546452">[</span><span class="op" id="4546453">]</span><span class="builtintype" id="4546454">byte</span><span class="op" id="4546458">(</span><span class="string" id="4546459">&#34;client&nbsp;finished&#34;</span><span class="op" id="4546476">)</span><br>
<span class="lineno"></span><span class="keyword" id="4546478">var</span>&nbsp;<span class="ident" id="4546482">serverFinishedLabel</span>&nbsp;<span class="op" id="4546502">=</span>&nbsp;<span class="op" id="4546504">[</span><span class="op" id="4546505">]</span><span class="builtintype" id="4546506">byte</span><span class="op" id="4546510">(</span><span class="string" id="4546511">&#34;server&nbsp;finished&#34;</span><span class="op" id="4546528">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="4546531">func</span>&nbsp;<span class="ident" id="4546536">prfForVersion</span><span class="op" id="4546549">(</span><span class="ident" id="4546550">version</span>&nbsp;<span class="builtintype" id="4546558">uint16</span><span class="op" id="4546564">)</span>&nbsp;<span class="keyword" id="4546566">func</span><span class="op" id="4546570">(</span><span class="ident" id="4546571">result</span><span class="op" id="4546577">,</span>&nbsp;<span class="ident" id="4546579">secret</span><span class="op" id="4546585">,</span>&nbsp;<span class="ident" id="4546587">label</span><span class="op" id="4546592">,</span>&nbsp;<span class="ident" id="4546594">seed</span>&nbsp;<span class="op" id="4546599">[</span><span class="op" id="4546600">]</span><span class="builtintype" id="4546601">byte</span><span class="op" id="4546605">)</span>&nbsp;<span class="op" id="4546607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546610">switch</span>&nbsp;<span class="ident" id="4546617">version</span>&nbsp;<span class="op" id="4546625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546628">case</span>&nbsp;<span class="ident" id="4546633">VersionSSL30</span><span class="op" id="4546645">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546649">return</span>&nbsp;<span class="ident" id="4546656">prf30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546663">case</span>&nbsp;<span class="ident" id="4546668">VersionTLS10</span><span class="op" id="4546680">,</span>&nbsp;<span class="ident" id="4546682">VersionTLS11</span><span class="op" id="4546694">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546698">return</span>&nbsp;<span class="ident" id="4546705">prf10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546712">case</span>&nbsp;<span class="ident" id="4546717">VersionTLS12</span><span class="op" id="4546729">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546733">return</span>&nbsp;<span class="ident" id="4546740">prf12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4546747">default</span><span class="op" id="4546754">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4546758">panic</span><span class="op" id="4546763">(</span><span class="string" id="4546764">&#34;unknown&nbsp;version&#34;</span><span class="op" id="4546781">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4546784">}</span><br>
<span class="lineno"></span><span class="op" id="4546786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4546789">//&nbsp;masterFromPreMasterSecret&nbsp;generates&nbsp;the&nbsp;master&nbsp;secret&nbsp;from&nbsp;the&nbsp;pre-master</span><br>
<span class="lineno"></span><span class="comment" id="4546866">//&nbsp;secret.&nbsp;See&nbsp;http://tools.ietf.org/html/rfc5246#section-8.1</span><br>
<span class="lineno">135</span><span class="keyword" id="4546928">func</span>&nbsp;<span class="ident" id="4546933">masterFromPreMasterSecret</span><span class="op" id="4546958">(</span><span class="ident" id="4546959">version</span>&nbsp;<span class="builtintype" id="4546967">uint16</span><span class="op" id="4546973">,</span>&nbsp;<span class="ident" id="4546975">preMasterSecret</span><span class="op" id="4546990">,</span>&nbsp;<span class="ident" id="4546992">clientRandom</span><span class="op" id="4547004">,</span>&nbsp;<span class="ident" id="4547006">serverRandom</span>&nbsp;<span class="op" id="4547019">[</span><span class="op" id="4547020">]</span><span class="builtintype" id="4547021">byte</span><span class="op" id="4547025">)</span>&nbsp;<span class="op" id="4547027">[</span><span class="op" id="4547028">]</span><span class="builtintype" id="4547029">byte</span>&nbsp;<span class="op" id="4547034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4547037">var</span>&nbsp;<span class="ident" id="4547041">seed</span>&nbsp;<span class="op" id="4547046">[</span><span class="ident" id="4547047">tlsRandomLength</span>&nbsp;<span class="op" id="4547063">*</span>&nbsp;<span class="num" id="4547065">2</span><span class="op" id="4547066">]</span><span class="builtintype" id="4547067">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4547073">copy</span><span class="op" id="4547077">(</span><span class="ident" id="4547078">seed</span><span class="op" id="4547082">[</span><span class="num" id="4547083">0</span><span class="op" id="4547084">:</span><span class="builtinfunc" id="4547085">len</span><span class="op" id="4547088">(</span><span class="ident" id="4547089">clientRandom</span><span class="op" id="4547101">)</span><span class="op" id="4547102">]</span><span class="op" id="4547103">,</span>&nbsp;<span class="ident" id="4547105">clientRandom</span><span class="op" id="4547117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4547120">copy</span><span class="op" id="4547124">(</span><span class="ident" id="4547125">seed</span><span class="op" id="4547129">[</span><span class="builtinfunc" id="4547130">len</span><span class="op" id="4547133">(</span><span class="ident" id="4547134">clientRandom</span><span class="op" id="4547146">)</span><span class="op" id="4547147">:</span><span class="op" id="4547148">]</span><span class="op" id="4547149">,</span>&nbsp;<span class="ident" id="4547151">serverRandom</span><span class="op" id="4547163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4547166">masterSecret</span>&nbsp;<span class="op" id="4547179">:=</span>&nbsp;<span class="builtinfunc" id="4547182">make</span><span class="op" id="4547186">(</span><span class="op" id="4547187">[</span><span class="op" id="4547188">]</span><span class="builtintype" id="4547189">byte</span><span class="op" id="4547193">,</span>&nbsp;<span class="ident" id="4547195">masterSecretLength</span><span class="op" id="4547213">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4547216">prfForVersion</span><span class="op" id="4547229">(</span><span class="ident" id="4547230">version</span><span class="op" id="4547237">)</span><span class="op" id="4547238">(</span><span class="ident" id="4547239">masterSecret</span><span class="op" id="4547251">,</span>&nbsp;<span class="ident" id="4547253">preMasterSecret</span><span class="op" id="4547268">,</span>&nbsp;<span class="ident" id="4547270">masterSecretLabel</span><span class="op" id="4547287">,</span>&nbsp;<span class="ident" id="4547289">seed</span><span class="op" id="4547293">[</span><span class="num" id="4547294">0</span><span class="op" id="4547295">:</span><span class="op" id="4547296">]</span><span class="op" id="4547297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4547300">return</span>&nbsp;<span class="ident" id="4547307">masterSecret</span><br>
<span class="lineno"></span><span class="op" id="4547320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4547323">//&nbsp;keysFromMasterSecret&nbsp;generates&nbsp;the&nbsp;connection&nbsp;keys&nbsp;from&nbsp;the&nbsp;master</span><br>
<span class="lineno">145</span><span class="comment" id="4547393">//&nbsp;secret,&nbsp;given&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MAC&nbsp;key,&nbsp;cipher&nbsp;key&nbsp;and&nbsp;IV,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4547471">//&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;6.3.</span><br>
<span class="lineno"></span><span class="keyword" id="4547497">func</span>&nbsp;<span class="ident" id="4547502">keysFromMasterSecret</span><span class="op" id="4547522">(</span><span class="ident" id="4547523">version</span>&nbsp;<span class="builtintype" id="4547531">uint16</span><span class="op" id="4547537">,</span>&nbsp;<span class="ident" id="4547539">masterSecret</span><span class="op" id="4547551">,</span>&nbsp;<span class="ident" id="4547553">clientRandom</span><span class="op" id="4547565">,</span>&nbsp;<span class="ident" id="4547567">serverRandom</span>&nbsp;<span class="op" id="4547580">[</span><span class="op" id="4547581">]</span><span class="builtintype" id="4547582">byte</span><span class="op" id="4547586">,</span>&nbsp;<span class="ident" id="4547588">macLen</span><span class="op" id="4547594">,</span>&nbsp;<span class="ident" id="4547596">keyLen</span><span class="op" id="4547602">,</span>&nbsp;<span class="ident" id="4547604">ivLen</span>&nbsp;<span class="builtintype" id="4547610">int</span><span class="op" id="4547613">)</span>&nbsp;<span class="op" id="4547615">(</span><span class="ident" id="4547616">clientMAC</span><span class="op" id="4547625">,</span>&nbsp;<span class="ident" id="4547627">serverMAC</span><span class="op" id="4547636">,</span>&nbsp;<span class="ident" id="4547638">clientKey</span><span class="op" id="4547647">,</span>&nbsp;<span class="ident" id="4547649">serverKey</span><span class="op" id="4547658">,</span>&nbsp;<span class="ident" id="4547660">clientIV</span><span class="op" id="4547668">,</span>&nbsp;<span class="ident" id="4547670">serverIV</span>&nbsp;<span class="op" id="4547679">[</span><span class="op" id="4547680">]</span><span class="builtintype" id="4547681">byte</span><span class="op" id="4547685">)</span>&nbsp;<span class="op" id="4547687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4547690">var</span>&nbsp;<span class="ident" id="4547694">seed</span>&nbsp;<span class="op" id="4547699">[</span><span class="ident" id="4547700">tlsRandomLength</span>&nbsp;<span class="op" id="4547716">*</span>&nbsp;<span class="num" id="4547718">2</span><span class="op" id="4547719">]</span><span class="builtintype" id="4547720">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4547726">copy</span><span class="op" id="4547730">(</span><span class="ident" id="4547731">seed</span><span class="op" id="4547735">[</span><span class="num" id="4547736">0</span><span class="op" id="4547737">:</span><span class="builtinfunc" id="4547738">len</span><span class="op" id="4547741">(</span><span class="ident" id="4547742">clientRandom</span><span class="op" id="4547754">)</span><span class="op" id="4547755">]</span><span class="op" id="4547756">,</span>&nbsp;<span class="ident" id="4547758">serverRandom</span><span class="op" id="4547770">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4547773">copy</span><span class="op" id="4547777">(</span><span class="ident" id="4547778">seed</span><span class="op" id="4547782">[</span><span class="builtinfunc" id="4547783">len</span><span class="op" id="4547786">(</span><span class="ident" id="4547787">serverRandom</span><span class="op" id="4547799">)</span><span class="op" id="4547800">:</span><span class="op" id="4547801">]</span><span class="op" id="4547802">,</span>&nbsp;<span class="ident" id="4547804">clientRandom</span><span class="op" id="4547816">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4547820">n</span>&nbsp;<span class="op" id="4547822">:=</span>&nbsp;<span class="num" id="4547825">2</span><span class="op" id="4547826">*</span><span class="ident" id="4547827">macLen</span>&nbsp;<span class="op" id="4547834">+</span>&nbsp;<span class="num" id="4547836">2</span><span class="op" id="4547837">*</span><span class="ident" id="4547838">keyLen</span>&nbsp;<span class="op" id="4547845">+</span>&nbsp;<span class="num" id="4547847">2</span><span class="op" id="4547848">*</span><span class="ident" id="4547849">ivLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4547856">keyMaterial</span>&nbsp;<span class="op" id="4547868">:=</span>&nbsp;<span class="builtinfunc" id="4547871">make</span><span class="op" id="4547875">(</span><span class="op" id="4547876">[</span><span class="op" id="4547877">]</span><span class="builtintype" id="4547878">byte</span><span class="op" id="4547882">,</span>&nbsp;<span class="ident" id="4547884">n</span><span class="op" id="4547885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4547888">prfForVersion</span><span class="op" id="4547901">(</span><span class="ident" id="4547902">version</span><span class="op" id="4547909">)</span><span class="op" id="4547910">(</span><span class="ident" id="4547911">keyMaterial</span><span class="op" id="4547922">,</span>&nbsp;<span class="ident" id="4547924">masterSecret</span><span class="op" id="4547936">,</span>&nbsp;<span class="ident" id="4547938">keyExpansionLabel</span><span class="op" id="4547955">,</span>&nbsp;<span class="ident" id="4547957">seed</span><span class="op" id="4547961">[</span><span class="num" id="4547962">0</span><span class="op" id="4547963">:</span><span class="op" id="4547964">]</span><span class="op" id="4547965">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4547968">clientMAC</span>&nbsp;<span class="op" id="4547978">=</span>&nbsp;<span class="ident" id="4547980">keyMaterial</span><span class="op" id="4547991">[</span><span class="op" id="4547992">:</span><span class="ident" id="4547993">macLen</span><span class="op" id="4547999">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4548002">keyMaterial</span>&nbsp;<span class="op" id="4548014">=</span>&nbsp;<span class="ident" id="4548016">keyMaterial</span><span class="op" id="4548027">[</span><span class="ident" id="4548028">macLen</span><span class="op" id="4548034">:</span><span class="op" id="4548035">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4548038">serverMAC</span>&nbsp;<span class="op" id="4548048">=</span>&nbsp;<span class="ident" id="4548050">keyMaterial</span><span class="op" id="4548061">[</span><span class="op" id="4548062">:</span><span class="ident" id="4548063">macLen</span><span class="op" id="4548069">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4548072">keyMaterial</span>&nbsp;<span class="op" id="4548084">=</span>&nbsp;<span class="ident" id="4548086">keyMaterial</span><span class="op" id="4548097">[</span><span class="ident" id="4548098">macLen</span><span class="op" id="4548104">:</span><span class="op" id="4548105">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4548108">clientKey</span>&nbsp;<span class="op" id="4548118">=</span>&nbsp;<span class="ident" id="4548120">keyMaterial</span><span class="op" id="4548131">[</span><span class="op" id="4548132">:</span><span class="ident" id="4548133">keyLen</span><span class="op" id="4548139">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4548142">keyMaterial</span>&nbsp;<span class="op" id="4548154">=</span>&nbsp;<span class="ident" id="4548156">keyMaterial</span><span class="op" id="4548167">[</span><span class="ident" id="4548168">keyLen</span><span class="op" id="4548174">:</span><span class="op" id="4548175">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4548178">serverKey</span>&nbsp;<span class="op" id="4548188">=</span>&nbsp;<span class="ident" id="4548190">keyMaterial</span><span class="op" id="4548201">[</span><span class="op" id="4548202">:</span><span class="ident" id="4548203">keyLen</span><span class="op" id="4548209">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4548212">keyMaterial</span>&nbsp;<span class="op" id="4548224">=</span>&nbsp;<span class="ident" id="4548226">keyMaterial</span><span class="op" id="4548237">[</span><span class="ident" id="4548238">keyLen</span><span class="op" id="4548244">:</span><span class="op" id="4548245">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4548248">clientIV</span>&nbsp;<span class="op" id="4548257">=</span>&nbsp;<span class="ident" id="4548259">keyMaterial</span><span class="op" id="4548270">[</span><span class="op" id="4548271">:</span><span class="ident" id="4548272">ivLen</span><span class="op" id="4548277">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4548280">keyMaterial</span>&nbsp;<span class="op" id="4548292">=</span>&nbsp;<span class="ident" id="4548294">keyMaterial</span><span class="op" id="4548305">[</span><span class="ident" id="4548306">ivLen</span><span class="op" id="4548311">:</span><span class="op" id="4548312">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4548315">serverIV</span>&nbsp;<span class="op" id="4548324">=</span>&nbsp;<span class="ident" id="4548326">keyMaterial</span><span class="op" id="4548337">[</span><span class="op" id="4548338">:</span><span class="ident" id="4548339">ivLen</span><span class="op" id="4548344">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4548347">return</span><br>
<span class="lineno"></span><span class="op" id="4548354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4548357">func</span>&nbsp;<span class="ident" id="4548362">newFinishedHash</span><span class="op" id="4548377">(</span><span class="ident" id="4548378">version</span>&nbsp;<span class="builtintype" id="4548386">uint16</span><span class="op" id="4548392">)</span>&nbsp;<span class="ident" id="4548394">finishedHash</span>&nbsp;<span class="op" id="4548407">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4548410">if</span>&nbsp;<span class="ident" id="4548413">version</span>&nbsp;<span class="op" id="4548421">&gt;=</span>&nbsp;<span class="ident" id="4548424">VersionTLS12</span>&nbsp;<span class="op" id="4548437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4548441">return</span>&nbsp;<span class="ident" id="4548448">finishedHash</span><span class="op" id="4548460">{</span><span class="ident" id="4548461">sha256</span><span class="op" id="4548467">.</span><span class="ident" id="4548468">New</span><span class="op" id="4548471">(</span><span class="op" id="4548472">)</span><span class="op" id="4548473">,</span>&nbsp;<span class="ident" id="4548475">sha256</span><span class="op" id="4548481">.</span><span class="ident" id="4548482">New</span><span class="op" id="4548485">(</span><span class="op" id="4548486">)</span><span class="op" id="4548487">,</span>&nbsp;<span class="ident" id="4548489">nil</span><span class="op" id="4548492">,</span>&nbsp;<span class="ident" id="4548494">nil</span><span class="op" id="4548497">,</span>&nbsp;<span class="ident" id="4548499">version</span><span class="op" id="4548506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4548509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4548512">return</span>&nbsp;<span class="ident" id="4548519">finishedHash</span><span class="op" id="4548531">{</span><span class="ident" id="4548532">sha1</span><span class="op" id="4548536">.</span><span class="ident" id="4548537">New</span><span class="op" id="4548540">(</span><span class="op" id="4548541">)</span><span class="op" id="4548542">,</span>&nbsp;<span class="ident" id="4548544">sha1</span><span class="op" id="4548548">.</span><span class="ident" id="4548549">New</span><span class="op" id="4548552">(</span><span class="op" id="4548553">)</span><span class="op" id="4548554">,</span>&nbsp;<span class="ident" id="4548556">md5</span><span class="op" id="4548559">.</span><span class="ident" id="4548560">New</span><span class="op" id="4548563">(</span><span class="op" id="4548564">)</span><span class="op" id="4548565">,</span>&nbsp;<span class="ident" id="4548567">md5</span><span class="op" id="4548570">.</span><span class="ident" id="4548571">New</span><span class="op" id="4548574">(</span><span class="op" id="4548575">)</span><span class="op" id="4548576">,</span>&nbsp;<span class="ident" id="4548578">version</span><span class="op" id="4548585">}</span><br>
<span class="lineno"></span><span class="op" id="4548587">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4548590">//&nbsp;A&nbsp;finishedHash&nbsp;calculates&nbsp;the&nbsp;hash&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake&nbsp;messages&nbsp;suitable</span><br>
<span class="lineno"></span><span class="comment" id="4548668">//&nbsp;for&nbsp;including&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4548708">type</span>&nbsp;<span class="ident" id="4548713">finishedHash</span>&nbsp;<span class="keyword" id="4548726">struct</span>&nbsp;<span class="op" id="4548733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4548736">client</span>&nbsp;<span class="ident" id="4548743">hash</span><span class="op" id="4548747">.</span><span class="ident" id="4548748">Hash</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4548754">server</span>&nbsp;<span class="ident" id="4548761">hash</span><span class="op" id="4548765">.</span><span class="ident" id="4548766">Hash</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4548773">//&nbsp;Prior&nbsp;to&nbsp;TLS&nbsp;1.2,&nbsp;an&nbsp;additional&nbsp;MD5&nbsp;hash&nbsp;is&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4548831">clientMD5</span>&nbsp;<span class="ident" id="4548841">hash</span><span class="op" id="4548845">.</span><span class="ident" id="4548846">Hash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4548852">serverMD5</span>&nbsp;<span class="ident" id="4548862">hash</span><span class="op" id="4548866">.</span><span class="ident" id="4548867">Hash</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4548874">version</span>&nbsp;<span class="builtintype" id="4548882">uint16</span><br>
<span class="lineno"></span><span class="op" id="4548889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4548892">func</span>&nbsp;<span class="op" id="4548897">(</span><span class="ident" id="4548898">h</span>&nbsp;<span class="ident" id="4548900">finishedHash</span><span class="op" id="4548912">)</span>&nbsp;<span class="ident" id="4548914">Write</span><span class="op" id="4548919">(</span><span class="ident" id="4548920">msg</span>&nbsp;<span class="op" id="4548924">[</span><span class="op" id="4548925">]</span><span class="builtintype" id="4548926">byte</span><span class="op" id="4548930">)</span>&nbsp;<span class="op" id="4548932">(</span><span class="ident" id="4548933">n</span>&nbsp;<span class="builtintype" id="4548935">int</span><span class="op" id="4548938">,</span>&nbsp;<span class="ident" id="4548940">err</span>&nbsp;<span class="builtintype" id="4548944">error</span><span class="op" id="4548949">)</span>&nbsp;<span class="op" id="4548951">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4548954">h</span><span class="op" id="4548955">.</span><span class="ident" id="4548956">client</span><span class="op" id="4548962">.</span><span class="ident" id="4548963">Write</span><span class="op" id="4548968">(</span><span class="ident" id="4548969">msg</span><span class="op" id="4548972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4548975">h</span><span class="op" id="4548976">.</span><span class="ident" id="4548977">server</span><span class="op" id="4548983">.</span><span class="ident" id="4548984">Write</span><span class="op" id="4548989">(</span><span class="ident" id="4548990">msg</span><span class="op" id="4548993">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4548997">if</span>&nbsp;<span class="ident" id="4549000">h</span><span class="op" id="4549001">.</span><span class="ident" id="4549002">version</span>&nbsp;<span class="op" id="4549010">&lt;</span>&nbsp;<span class="ident" id="4549012">VersionTLS12</span>&nbsp;<span class="op" id="4549025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549029">h</span><span class="op" id="4549030">.</span><span class="ident" id="4549031">clientMD5</span><span class="op" id="4549040">.</span><span class="ident" id="4549041">Write</span><span class="op" id="4549046">(</span><span class="ident" id="4549047">msg</span><span class="op" id="4549050">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549054">h</span><span class="op" id="4549055">.</span><span class="ident" id="4549056">serverMD5</span><span class="op" id="4549065">.</span><span class="ident" id="4549066">Write</span><span class="op" id="4549071">(</span><span class="ident" id="4549072">msg</span><span class="op" id="4549075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4549078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4549081">return</span>&nbsp;<span class="builtinfunc" id="4549088">len</span><span class="op" id="4549091">(</span><span class="ident" id="4549092">msg</span><span class="op" id="4549095">)</span><span class="op" id="4549096">,</span>&nbsp;<span class="ident" id="4549098">nil</span><br>
<span class="lineno"></span><span class="op" id="4549102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="4549105">//&nbsp;finishedSum30&nbsp;calculates&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;SSLv3</span><br>
<span class="lineno"></span><span class="comment" id="4549183">//&nbsp;Finished&nbsp;message&nbsp;given&nbsp;the&nbsp;MD5&nbsp;and&nbsp;SHA1&nbsp;hashes&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake</span><br>
<span class="lineno"></span><span class="comment" id="4549255">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="4549268">func</span>&nbsp;<span class="ident" id="4549273">finishedSum30</span><span class="op" id="4549286">(</span><span class="ident" id="4549287">md5</span><span class="op" id="4549290">,</span>&nbsp;<span class="ident" id="4549292">sha1</span>&nbsp;<span class="ident" id="4549297">hash</span><span class="op" id="4549301">.</span><span class="ident" id="4549302">Hash</span><span class="op" id="4549306">,</span>&nbsp;<span class="ident" id="4549308">masterSecret</span>&nbsp;<span class="op" id="4549321">[</span><span class="op" id="4549322">]</span><span class="builtintype" id="4549323">byte</span><span class="op" id="4549327">,</span>&nbsp;<span class="ident" id="4549329">magic</span>&nbsp;<span class="op" id="4549335">[</span><span class="num" id="4549336">4</span><span class="op" id="4549337">]</span><span class="builtintype" id="4549338">byte</span><span class="op" id="4549342">)</span>&nbsp;<span class="op" id="4549344">[</span><span class="op" id="4549345">]</span><span class="builtintype" id="4549346">byte</span>&nbsp;<span class="op" id="4549351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549354">md5</span><span class="op" id="4549357">.</span><span class="ident" id="4549358">Write</span><span class="op" id="4549363">(</span><span class="ident" id="4549364">magic</span><span class="op" id="4549369">[</span><span class="op" id="4549370">:</span><span class="op" id="4549371">]</span><span class="op" id="4549372">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549375">md5</span><span class="op" id="4549378">.</span><span class="ident" id="4549379">Write</span><span class="op" id="4549384">(</span><span class="ident" id="4549385">masterSecret</span><span class="op" id="4549397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549400">md5</span><span class="op" id="4549403">.</span><span class="ident" id="4549404">Write</span><span class="op" id="4549409">(</span><span class="ident" id="4549410">ssl30Pad1</span><span class="op" id="4549419">[</span><span class="op" id="4549420">:</span><span class="op" id="4549421">]</span><span class="op" id="4549422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549425">md5Digest</span>&nbsp;<span class="op" id="4549435">:=</span>&nbsp;<span class="ident" id="4549438">md5</span><span class="op" id="4549441">.</span><span class="ident" id="4549442">Sum</span><span class="op" id="4549445">(</span><span class="ident" id="4549446">nil</span><span class="op" id="4549449">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549453">md5</span><span class="op" id="4549456">.</span><span class="ident" id="4549457">Reset</span><span class="op" id="4549462">(</span><span class="op" id="4549463">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549466">md5</span><span class="op" id="4549469">.</span><span class="ident" id="4549470">Write</span><span class="op" id="4549475">(</span><span class="ident" id="4549476">masterSecret</span><span class="op" id="4549488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549491">md5</span><span class="op" id="4549494">.</span><span class="ident" id="4549495">Write</span><span class="op" id="4549500">(</span><span class="ident" id="4549501">ssl30Pad2</span><span class="op" id="4549510">[</span><span class="op" id="4549511">:</span><span class="op" id="4549512">]</span><span class="op" id="4549513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549516">md5</span><span class="op" id="4549519">.</span><span class="ident" id="4549520">Write</span><span class="op" id="4549525">(</span><span class="ident" id="4549526">md5Digest</span><span class="op" id="4549535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549538">md5Digest</span>&nbsp;<span class="op" id="4549548">=</span>&nbsp;<span class="ident" id="4549550">md5</span><span class="op" id="4549553">.</span><span class="ident" id="4549554">Sum</span><span class="op" id="4549557">(</span><span class="ident" id="4549558">nil</span><span class="op" id="4549561">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549565">sha1</span><span class="op" id="4549569">.</span><span class="ident" id="4549570">Write</span><span class="op" id="4549575">(</span><span class="ident" id="4549576">magic</span><span class="op" id="4549581">[</span><span class="op" id="4549582">:</span><span class="op" id="4549583">]</span><span class="op" id="4549584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549587">sha1</span><span class="op" id="4549591">.</span><span class="ident" id="4549592">Write</span><span class="op" id="4549597">(</span><span class="ident" id="4549598">masterSecret</span><span class="op" id="4549610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549613">sha1</span><span class="op" id="4549617">.</span><span class="ident" id="4549618">Write</span><span class="op" id="4549623">(</span><span class="ident" id="4549624">ssl30Pad1</span><span class="op" id="4549633">[</span><span class="op" id="4549634">:</span><span class="num" id="4549635">40</span><span class="op" id="4549637">]</span><span class="op" id="4549638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549641">sha1Digest</span>&nbsp;<span class="op" id="4549652">:=</span>&nbsp;<span class="ident" id="4549655">sha1</span><span class="op" id="4549659">.</span><span class="ident" id="4549660">Sum</span><span class="op" id="4549663">(</span><span class="ident" id="4549664">nil</span><span class="op" id="4549667">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549671">sha1</span><span class="op" id="4549675">.</span><span class="ident" id="4549676">Reset</span><span class="op" id="4549681">(</span><span class="op" id="4549682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549685">sha1</span><span class="op" id="4549689">.</span><span class="ident" id="4549690">Write</span><span class="op" id="4549695">(</span><span class="ident" id="4549696">masterSecret</span><span class="op" id="4549708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549711">sha1</span><span class="op" id="4549715">.</span><span class="ident" id="4549716">Write</span><span class="op" id="4549721">(</span><span class="ident" id="4549722">ssl30Pad2</span><span class="op" id="4549731">[</span><span class="op" id="4549732">:</span><span class="num" id="4549733">40</span><span class="op" id="4549735">]</span><span class="op" id="4549736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549739">sha1</span><span class="op" id="4549743">.</span><span class="ident" id="4549744">Write</span><span class="op" id="4549749">(</span><span class="ident" id="4549750">sha1Digest</span><span class="op" id="4549760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549763">sha1Digest</span>&nbsp;<span class="op" id="4549774">=</span>&nbsp;<span class="ident" id="4549776">sha1</span><span class="op" id="4549780">.</span><span class="ident" id="4549781">Sum</span><span class="op" id="4549784">(</span><span class="ident" id="4549785">nil</span><span class="op" id="4549788">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4549792">ret</span>&nbsp;<span class="op" id="4549796">:=</span>&nbsp;<span class="builtinfunc" id="4549799">make</span><span class="op" id="4549803">(</span><span class="op" id="4549804">[</span><span class="op" id="4549805">]</span><span class="builtintype" id="4549806">byte</span><span class="op" id="4549810">,</span>&nbsp;<span class="builtinfunc" id="4549812">len</span><span class="op" id="4549815">(</span><span class="ident" id="4549816">md5Digest</span><span class="op" id="4549825">)</span><span class="op" id="4549826">+</span><span class="builtinfunc" id="4549827">len</span><span class="op" id="4549830">(</span><span class="ident" id="4549831">sha1Digest</span><span class="op" id="4549841">)</span><span class="op" id="4549842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4549845">copy</span><span class="op" id="4549849">(</span><span class="ident" id="4549850">ret</span><span class="op" id="4549853">,</span>&nbsp;<span class="ident" id="4549855">md5Digest</span><span class="op" id="4549864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4549867">copy</span><span class="op" id="4549871">(</span><span class="ident" id="4549872">ret</span><span class="op" id="4549875">[</span><span class="builtinfunc" id="4549876">len</span><span class="op" id="4549879">(</span><span class="ident" id="4549880">md5Digest</span><span class="op" id="4549889">)</span><span class="op" id="4549890">:</span><span class="op" id="4549891">]</span><span class="op" id="4549892">,</span>&nbsp;<span class="ident" id="4549894">sha1Digest</span><span class="op" id="4549904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4549907">return</span>&nbsp;<span class="ident" id="4549914">ret</span><br>
<span class="lineno">230</span><span class="op" id="4549918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4549921">var</span>&nbsp;<span class="ident" id="4549925">ssl3ClientFinishedMagic</span>&nbsp;<span class="op" id="4549949">=</span>&nbsp;<span class="op" id="4549951">[</span><span class="num" id="4549952">4</span><span class="op" id="4549953">]</span><span class="builtintype" id="4549954">byte</span><span class="op" id="4549958">{</span><span class="num" id="4549959">0x43</span><span class="op" id="4549963">,</span>&nbsp;<span class="num" id="4549965">0x4c</span><span class="op" id="4549969">,</span>&nbsp;<span class="num" id="4549971">0x4e</span><span class="op" id="4549975">,</span>&nbsp;<span class="num" id="4549977">0x54</span><span class="op" id="4549981">}</span><br>
<span class="lineno"></span><span class="keyword" id="4549983">var</span>&nbsp;<span class="ident" id="4549987">ssl3ServerFinishedMagic</span>&nbsp;<span class="op" id="4550011">=</span>&nbsp;<span class="op" id="4550013">[</span><span class="num" id="4550014">4</span><span class="op" id="4550015">]</span><span class="builtintype" id="4550016">byte</span><span class="op" id="4550020">{</span><span class="num" id="4550021">0x53</span><span class="op" id="4550025">,</span>&nbsp;<span class="num" id="4550027">0x52</span><span class="op" id="4550031">,</span>&nbsp;<span class="num" id="4550033">0x56</span><span class="op" id="4550037">,</span>&nbsp;<span class="num" id="4550039">0x52</span><span class="op" id="4550043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="4550046">//&nbsp;clientSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;client&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4550120">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4550141">func</span>&nbsp;<span class="op" id="4550146">(</span><span class="ident" id="4550147">h</span>&nbsp;<span class="ident" id="4550149">finishedHash</span><span class="op" id="4550161">)</span>&nbsp;<span class="ident" id="4550163">clientSum</span><span class="op" id="4550172">(</span><span class="ident" id="4550173">masterSecret</span>&nbsp;<span class="op" id="4550186">[</span><span class="op" id="4550187">]</span><span class="builtintype" id="4550188">byte</span><span class="op" id="4550192">)</span>&nbsp;<span class="op" id="4550194">[</span><span class="op" id="4550195">]</span><span class="builtintype" id="4550196">byte</span>&nbsp;<span class="op" id="4550201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4550204">if</span>&nbsp;<span class="ident" id="4550207">h</span><span class="op" id="4550208">.</span><span class="ident" id="4550209">version</span>&nbsp;<span class="op" id="4550217">==</span>&nbsp;<span class="ident" id="4550220">VersionSSL30</span>&nbsp;<span class="op" id="4550233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4550237">return</span>&nbsp;<span class="ident" id="4550244">finishedSum30</span><span class="op" id="4550257">(</span><span class="ident" id="4550258">h</span><span class="op" id="4550259">.</span><span class="ident" id="4550260">clientMD5</span><span class="op" id="4550269">,</span>&nbsp;<span class="ident" id="4550271">h</span><span class="op" id="4550272">.</span><span class="ident" id="4550273">client</span><span class="op" id="4550279">,</span>&nbsp;<span class="ident" id="4550281">masterSecret</span><span class="op" id="4550293">,</span>&nbsp;<span class="ident" id="4550295">ssl3ClientFinishedMagic</span><span class="op" id="4550318">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4550321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4550325">out</span>&nbsp;<span class="op" id="4550329">:=</span>&nbsp;<span class="builtinfunc" id="4550332">make</span><span class="op" id="4550336">(</span><span class="op" id="4550337">[</span><span class="op" id="4550338">]</span><span class="builtintype" id="4550339">byte</span><span class="op" id="4550343">,</span>&nbsp;<span class="ident" id="4550345">finishedVerifyLength</span><span class="op" id="4550365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4550368">if</span>&nbsp;<span class="ident" id="4550371">h</span><span class="op" id="4550372">.</span><span class="ident" id="4550373">version</span>&nbsp;<span class="op" id="4550381">&gt;=</span>&nbsp;<span class="ident" id="4550384">VersionTLS12</span>&nbsp;<span class="op" id="4550397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4550401">seed</span>&nbsp;<span class="op" id="4550406">:=</span>&nbsp;<span class="ident" id="4550409">h</span><span class="op" id="4550410">.</span><span class="ident" id="4550411">client</span><span class="op" id="4550417">.</span><span class="ident" id="4550418">Sum</span><span class="op" id="4550421">(</span><span class="ident" id="4550422">nil</span><span class="op" id="4550425">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4550429">prf12</span><span class="op" id="4550434">(</span><span class="ident" id="4550435">out</span><span class="op" id="4550438">,</span>&nbsp;<span class="ident" id="4550440">masterSecret</span><span class="op" id="4550452">,</span>&nbsp;<span class="ident" id="4550454">clientFinishedLabel</span><span class="op" id="4550473">,</span>&nbsp;<span class="ident" id="4550475">seed</span><span class="op" id="4550479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4550482">}</span>&nbsp;<span class="keyword" id="4550484">else</span>&nbsp;<span class="op" id="4550489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4550493">seed</span>&nbsp;<span class="op" id="4550498">:=</span>&nbsp;<span class="builtinfunc" id="4550501">make</span><span class="op" id="4550505">(</span><span class="op" id="4550506">[</span><span class="op" id="4550507">]</span><span class="builtintype" id="4550508">byte</span><span class="op" id="4550512">,</span>&nbsp;<span class="num" id="4550514">0</span><span class="op" id="4550515">,</span>&nbsp;<span class="ident" id="4550517">md5</span><span class="op" id="4550520">.</span><span class="ident" id="4550521">Size</span><span class="op" id="4550525">+</span><span class="ident" id="4550526">sha1</span><span class="op" id="4550530">.</span><span class="ident" id="4550531">Size</span><span class="op" id="4550535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4550539">seed</span>&nbsp;<span class="op" id="4550544">=</span>&nbsp;<span class="ident" id="4550546">h</span><span class="op" id="4550547">.</span><span class="ident" id="4550548">clientMD5</span><span class="op" id="4550557">.</span><span class="ident" id="4550558">Sum</span><span class="op" id="4550561">(</span><span class="ident" id="4550562">seed</span><span class="op" id="4550566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4550570">seed</span>&nbsp;<span class="op" id="4550575">=</span>&nbsp;<span class="ident" id="4550577">h</span><span class="op" id="4550578">.</span><span class="ident" id="4550579">client</span><span class="op" id="4550585">.</span><span class="ident" id="4550586">Sum</span><span class="op" id="4550589">(</span><span class="ident" id="4550590">seed</span><span class="op" id="4550594">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4550598">prf10</span><span class="op" id="4550603">(</span><span class="ident" id="4550604">out</span><span class="op" id="4550607">,</span>&nbsp;<span class="ident" id="4550609">masterSecret</span><span class="op" id="4550621">,</span>&nbsp;<span class="ident" id="4550623">clientFinishedLabel</span><span class="op" id="4550642">,</span>&nbsp;<span class="ident" id="4550644">seed</span><span class="op" id="4550648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4550651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4550654">return</span>&nbsp;<span class="ident" id="4550661">out</span><br>
<span class="lineno"></span><span class="op" id="4550665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="4550668">//&nbsp;serverSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;server&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4550742">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4550763">func</span>&nbsp;<span class="op" id="4550768">(</span><span class="ident" id="4550769">h</span>&nbsp;<span class="ident" id="4550771">finishedHash</span><span class="op" id="4550783">)</span>&nbsp;<span class="ident" id="4550785">serverSum</span><span class="op" id="4550794">(</span><span class="ident" id="4550795">masterSecret</span>&nbsp;<span class="op" id="4550808">[</span><span class="op" id="4550809">]</span><span class="builtintype" id="4550810">byte</span><span class="op" id="4550814">)</span>&nbsp;<span class="op" id="4550816">[</span><span class="op" id="4550817">]</span><span class="builtintype" id="4550818">byte</span>&nbsp;<span class="op" id="4550823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4550826">if</span>&nbsp;<span class="ident" id="4550829">h</span><span class="op" id="4550830">.</span><span class="ident" id="4550831">version</span>&nbsp;<span class="op" id="4550839">==</span>&nbsp;<span class="ident" id="4550842">VersionSSL30</span>&nbsp;<span class="op" id="4550855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4550859">return</span>&nbsp;<span class="ident" id="4550866">finishedSum30</span><span class="op" id="4550879">(</span><span class="ident" id="4550880">h</span><span class="op" id="4550881">.</span><span class="ident" id="4550882">serverMD5</span><span class="op" id="4550891">,</span>&nbsp;<span class="ident" id="4550893">h</span><span class="op" id="4550894">.</span><span class="ident" id="4550895">server</span><span class="op" id="4550901">,</span>&nbsp;<span class="ident" id="4550903">masterSecret</span><span class="op" id="4550915">,</span>&nbsp;<span class="ident" id="4550917">ssl3ServerFinishedMagic</span><span class="op" id="4550940">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4550943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4550947">out</span>&nbsp;<span class="op" id="4550951">:=</span>&nbsp;<span class="builtinfunc" id="4550954">make</span><span class="op" id="4550958">(</span><span class="op" id="4550959">[</span><span class="op" id="4550960">]</span><span class="builtintype" id="4550961">byte</span><span class="op" id="4550965">,</span>&nbsp;<span class="ident" id="4550967">finishedVerifyLength</span><span class="op" id="4550987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4550990">if</span>&nbsp;<span class="ident" id="4550993">h</span><span class="op" id="4550994">.</span><span class="ident" id="4550995">version</span>&nbsp;<span class="op" id="4551003">&gt;=</span>&nbsp;<span class="ident" id="4551006">VersionTLS12</span>&nbsp;<span class="op" id="4551019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551023">seed</span>&nbsp;<span class="op" id="4551028">:=</span>&nbsp;<span class="ident" id="4551031">h</span><span class="op" id="4551032">.</span><span class="ident" id="4551033">server</span><span class="op" id="4551039">.</span><span class="ident" id="4551040">Sum</span><span class="op" id="4551043">(</span><span class="ident" id="4551044">nil</span><span class="op" id="4551047">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551051">prf12</span><span class="op" id="4551056">(</span><span class="ident" id="4551057">out</span><span class="op" id="4551060">,</span>&nbsp;<span class="ident" id="4551062">masterSecret</span><span class="op" id="4551074">,</span>&nbsp;<span class="ident" id="4551076">serverFinishedLabel</span><span class="op" id="4551095">,</span>&nbsp;<span class="ident" id="4551097">seed</span><span class="op" id="4551101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4551104">}</span>&nbsp;<span class="keyword" id="4551106">else</span>&nbsp;<span class="op" id="4551111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551115">seed</span>&nbsp;<span class="op" id="4551120">:=</span>&nbsp;<span class="builtinfunc" id="4551123">make</span><span class="op" id="4551127">(</span><span class="op" id="4551128">[</span><span class="op" id="4551129">]</span><span class="builtintype" id="4551130">byte</span><span class="op" id="4551134">,</span>&nbsp;<span class="num" id="4551136">0</span><span class="op" id="4551137">,</span>&nbsp;<span class="ident" id="4551139">md5</span><span class="op" id="4551142">.</span><span class="ident" id="4551143">Size</span><span class="op" id="4551147">+</span><span class="ident" id="4551148">sha1</span><span class="op" id="4551152">.</span><span class="ident" id="4551153">Size</span><span class="op" id="4551157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551161">seed</span>&nbsp;<span class="op" id="4551166">=</span>&nbsp;<span class="ident" id="4551168">h</span><span class="op" id="4551169">.</span><span class="ident" id="4551170">serverMD5</span><span class="op" id="4551179">.</span><span class="ident" id="4551180">Sum</span><span class="op" id="4551183">(</span><span class="ident" id="4551184">seed</span><span class="op" id="4551188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551192">seed</span>&nbsp;<span class="op" id="4551197">=</span>&nbsp;<span class="ident" id="4551199">h</span><span class="op" id="4551200">.</span><span class="ident" id="4551201">server</span><span class="op" id="4551207">.</span><span class="ident" id="4551208">Sum</span><span class="op" id="4551211">(</span><span class="ident" id="4551212">seed</span><span class="op" id="4551216">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551220">prf10</span><span class="op" id="4551225">(</span><span class="ident" id="4551226">out</span><span class="op" id="4551229">,</span>&nbsp;<span class="ident" id="4551231">masterSecret</span><span class="op" id="4551243">,</span>&nbsp;<span class="ident" id="4551245">serverFinishedLabel</span><span class="op" id="4551264">,</span>&nbsp;<span class="ident" id="4551266">seed</span><span class="op" id="4551270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4551273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4551276">return</span>&nbsp;<span class="ident" id="4551283">out</span><br>
<span class="lineno"></span><span class="op" id="4551287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="comment" id="4551290">//&nbsp;hashForClientCertificate&nbsp;returns&nbsp;a&nbsp;digest,&nbsp;hash&nbsp;function,&nbsp;and&nbsp;TLS&nbsp;1.2&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="4551368">//&nbsp;id&nbsp;suitable&nbsp;for&nbsp;signing&nbsp;by&nbsp;a&nbsp;TLS&nbsp;client&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="4551424">func</span>&nbsp;<span class="op" id="4551429">(</span><span class="ident" id="4551430">h</span>&nbsp;<span class="ident" id="4551432">finishedHash</span><span class="op" id="4551444">)</span>&nbsp;<span class="ident" id="4551446">hashForClientCertificate</span><span class="op" id="4551470">(</span><span class="ident" id="4551471">sigType</span>&nbsp;<span class="builtintype" id="4551479">uint8</span><span class="op" id="4551484">)</span>&nbsp;<span class="op" id="4551486">(</span><span class="op" id="4551487">[</span><span class="op" id="4551488">]</span><span class="builtintype" id="4551489">byte</span><span class="op" id="4551493">,</span>&nbsp;<span class="ident" id="4551495">crypto</span><span class="op" id="4551501">.</span><span class="ident" id="4551502">Hash</span><span class="op" id="4551506">,</span>&nbsp;<span class="builtintype" id="4551508">uint8</span><span class="op" id="4551513">)</span>&nbsp;<span class="op" id="4551515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4551518">if</span>&nbsp;<span class="ident" id="4551521">h</span><span class="op" id="4551522">.</span><span class="ident" id="4551523">version</span>&nbsp;<span class="op" id="4551531">&gt;=</span>&nbsp;<span class="ident" id="4551534">VersionTLS12</span>&nbsp;<span class="op" id="4551547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551551">digest</span>&nbsp;<span class="op" id="4551558">:=</span>&nbsp;<span class="ident" id="4551561">h</span><span class="op" id="4551562">.</span><span class="ident" id="4551563">server</span><span class="op" id="4551569">.</span><span class="ident" id="4551570">Sum</span><span class="op" id="4551573">(</span><span class="ident" id="4551574">nil</span><span class="op" id="4551577">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4551581">return</span>&nbsp;<span class="ident" id="4551588">digest</span><span class="op" id="4551594">,</span>&nbsp;<span class="ident" id="4551596">crypto</span><span class="op" id="4551602">.</span><span class="ident" id="4551603">SHA256</span><span class="op" id="4551609">,</span>&nbsp;<span class="ident" id="4551611">hashSHA256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4551623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4551626">if</span>&nbsp;<span class="ident" id="4551629">sigType</span>&nbsp;<span class="op" id="4551637">==</span>&nbsp;<span class="ident" id="4551640">signatureECDSA</span>&nbsp;<span class="op" id="4551655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551659">digest</span>&nbsp;<span class="op" id="4551666">:=</span>&nbsp;<span class="ident" id="4551669">h</span><span class="op" id="4551670">.</span><span class="ident" id="4551671">server</span><span class="op" id="4551677">.</span><span class="ident" id="4551678">Sum</span><span class="op" id="4551681">(</span><span class="ident" id="4551682">nil</span><span class="op" id="4551685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4551689">return</span>&nbsp;<span class="ident" id="4551696">digest</span><span class="op" id="4551702">,</span>&nbsp;<span class="ident" id="4551704">crypto</span><span class="op" id="4551710">.</span><span class="ident" id="4551711">SHA1</span><span class="op" id="4551715">,</span>&nbsp;<span class="ident" id="4551717">hashSHA1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4551727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551731">digest</span>&nbsp;<span class="op" id="4551738">:=</span>&nbsp;<span class="builtinfunc" id="4551741">make</span><span class="op" id="4551745">(</span><span class="op" id="4551746">[</span><span class="op" id="4551747">]</span><span class="builtintype" id="4551748">byte</span><span class="op" id="4551752">,</span>&nbsp;<span class="num" id="4551754">0</span><span class="op" id="4551755">,</span>&nbsp;<span class="num" id="4551757">36</span><span class="op" id="4551759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551762">digest</span>&nbsp;<span class="op" id="4551769">=</span>&nbsp;<span class="ident" id="4551771">h</span><span class="op" id="4551772">.</span><span class="ident" id="4551773">serverMD5</span><span class="op" id="4551782">.</span><span class="ident" id="4551783">Sum</span><span class="op" id="4551786">(</span><span class="ident" id="4551787">digest</span><span class="op" id="4551793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551796">digest</span>&nbsp;<span class="op" id="4551803">=</span>&nbsp;<span class="ident" id="4551805">h</span><span class="op" id="4551806">.</span><span class="ident" id="4551807">server</span><span class="op" id="4551813">.</span><span class="ident" id="4551814">Sum</span><span class="op" id="4551817">(</span><span class="ident" id="4551818">digest</span><span class="op" id="4551824">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4551827">return</span>&nbsp;<span class="ident" id="4551834">digest</span><span class="op" id="4551840">,</span>&nbsp;<span class="ident" id="4551842">crypto</span><span class="op" id="4551848">.</span><span class="ident" id="4551849">MD5SHA1</span><span class="op" id="4551856">,</span>&nbsp;<span class="num" id="4551858">0</span>&nbsp;<span class="comment" id="4551860">/*&nbsp;not&nbsp;specified&nbsp;in&nbsp;TLS&nbsp;1.2.&nbsp;*/</span><br>
<span class="lineno"></span><span class="op" id="4551892">}</span>
</div>
</body>
</html>
