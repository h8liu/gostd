<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/lzw</h2>
<ul>
<li><a href="/gostd/compress/lzw/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/compress/lzw/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/lzw/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/lzw/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5572550">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5572605">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5572659">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5572710">//&nbsp;Package&nbsp;lzw&nbsp;implements&nbsp;the&nbsp;Lempel-Ziv-Welch&nbsp;compressed&nbsp;data&nbsp;format,</span><br>
<span class="lineno"></span><span class="comment" id="5572781">//&nbsp;described&nbsp;in&nbsp;T.&nbsp;A.&nbsp;Welch,&nbsp;``A&nbsp;Technique&nbsp;for&nbsp;High-Performance&nbsp;Data</span><br>
<span class="lineno"></span><span class="comment" id="5572850">//&nbsp;Compression&#39;&#39;,&nbsp;Computer,&nbsp;17(6)&nbsp;(June&nbsp;1984),&nbsp;pp&nbsp;8-19.</span><br>
<span class="lineno"></span><span class="comment" id="5572906">//</span><br>
<span class="lineno"></span><span class="comment" id="5572909">//&nbsp;In&nbsp;particular,&nbsp;it&nbsp;implements&nbsp;LZW&nbsp;as&nbsp;used&nbsp;by&nbsp;the&nbsp;GIF&nbsp;and&nbsp;PDF&nbsp;file</span><br>
<span class="lineno">10</span><span class="comment" id="5572977">//&nbsp;formats,&nbsp;which&nbsp;means&nbsp;variable-width&nbsp;codes&nbsp;up&nbsp;to&nbsp;12&nbsp;bits&nbsp;and&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="5573050">//&nbsp;two&nbsp;non-literal&nbsp;codes&nbsp;are&nbsp;a&nbsp;clear&nbsp;code&nbsp;and&nbsp;an&nbsp;EOF&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="5573109">//</span><br>
<span class="lineno"></span><span class="comment" id="5573112">//&nbsp;The&nbsp;TIFF&nbsp;file&nbsp;format&nbsp;uses&nbsp;a&nbsp;similar&nbsp;but&nbsp;incompatible&nbsp;version&nbsp;of&nbsp;the&nbsp;LZW</span><br>
<span class="lineno"></span><span class="comment" id="5573187">//&nbsp;algorithm.&nbsp;See&nbsp;the&nbsp;golang.org/x/image/tiff/lzw&nbsp;package&nbsp;for&nbsp;an</span><br>
<span class="lineno">15</span><span class="comment" id="5573252">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="5573271">package</span>&nbsp;<span class="ident" id="5573279">lzw</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5573284">//&nbsp;TODO(nigeltao):&nbsp;check&nbsp;that&nbsp;PDF&nbsp;uses&nbsp;LZW&nbsp;in&nbsp;the&nbsp;same&nbsp;way&nbsp;as&nbsp;GIF,</span><br>
<span class="lineno"></span><span class="comment" id="5573351">//&nbsp;modulo&nbsp;LSB/MSB&nbsp;packing&nbsp;order.</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5573385">import</span>&nbsp;<span class="op" id="5573392">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5573395">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5573404">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5573414">&#34;fmt&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5573421">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5573426">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5573429">//&nbsp;Order&nbsp;specifies&nbsp;the&nbsp;bit&nbsp;ordering&nbsp;in&nbsp;an&nbsp;LZW&nbsp;data&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="5573488">type</span>&nbsp;<span class="ident" id="5573493">Order</span>&nbsp;<span class="builtintype" id="5573499">int</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="5573504">const</span>&nbsp;<span class="op" id="5573510">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5573513">//&nbsp;LSB&nbsp;means&nbsp;Least&nbsp;Significant&nbsp;Bits&nbsp;first,&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;GIF&nbsp;file&nbsp;format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5573589">LSB</span>&nbsp;<span class="ident" id="5573593">Order</span>&nbsp;<span class="op" id="5573599">=</span>&nbsp;<span class="ident" id="5573601">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5573607">//&nbsp;MSB&nbsp;means&nbsp;Most&nbsp;Significant&nbsp;Bits&nbsp;first,&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;TIFF&nbsp;and&nbsp;PDF</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5573678">//&nbsp;file&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5573696">MSB</span><br>
<span class="lineno"></span><span class="op" id="5573700">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5573703">const</span>&nbsp;<span class="op" id="5573709">(</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5573712">maxWidth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5573731">=</span>&nbsp;<span class="num" id="5573733">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5573737">decoderInvalidCode</span>&nbsp;<span class="op" id="5573756">=</span>&nbsp;<span class="num" id="5573758">0xffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5573766">flushBuffer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5573785">=</span>&nbsp;<span class="num" id="5573787">1</span>&nbsp;<span class="op" id="5573789">&lt;&lt;</span>&nbsp;<span class="ident" id="5573792">maxWidth</span><br>
<span class="lineno"></span><span class="op" id="5573801">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5573804">//&nbsp;decoder&nbsp;is&nbsp;the&nbsp;state&nbsp;from&nbsp;which&nbsp;the&nbsp;readXxx&nbsp;method&nbsp;converts&nbsp;a&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="5573874">//&nbsp;stream&nbsp;into&nbsp;a&nbsp;code&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="5573904">type</span>&nbsp;<span class="ident" id="5573909">decoder</span>&nbsp;<span class="keyword" id="5573917">struct</span>&nbsp;<span class="op" id="5573924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5573927">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5573936">io</span><span class="op" id="5573938">.</span><span class="ident" id="5573939">ByteReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5573951">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5573960">uint32</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5573968">nBits</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5573977">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5573983">width</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5573992">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5573998">read</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5574007">func</span><span class="op" id="5574011">(</span><span class="op" id="5574012">*</span><span class="ident" id="5574013">decoder</span><span class="op" id="5574020">)</span>&nbsp;<span class="op" id="5574022">(</span><span class="builtintype" id="5574023">uint16</span><span class="op" id="5574029">,</span>&nbsp;<span class="builtintype" id="5574031">error</span><span class="op" id="5574036">)</span>&nbsp;<span class="comment" id="5574038">//&nbsp;readLSB&nbsp;or&nbsp;readMSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574061">litWidth</span>&nbsp;<span class="builtintype" id="5574070">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574101">//&nbsp;width&nbsp;in&nbsp;bits&nbsp;of&nbsp;literal&nbsp;codes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574136">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5574145">error</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574153">//&nbsp;The&nbsp;first&nbsp;1&lt;&lt;litWidth&nbsp;codes&nbsp;are&nbsp;literal&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574204">//&nbsp;The&nbsp;next&nbsp;two&nbsp;codes&nbsp;mean&nbsp;clear&nbsp;and&nbsp;EOF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574247">//&nbsp;Other&nbsp;valid&nbsp;codes&nbsp;are&nbsp;in&nbsp;the&nbsp;range&nbsp;[lo,&nbsp;hi]&nbsp;where&nbsp;lo&nbsp;:=&nbsp;clear&nbsp;+&nbsp;2,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574318">//&nbsp;with&nbsp;the&nbsp;upper&nbsp;bound&nbsp;incrementing&nbsp;on&nbsp;each&nbsp;code&nbsp;seen.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574375">//&nbsp;overflow&nbsp;is&nbsp;the&nbsp;code&nbsp;at&nbsp;which&nbsp;hi&nbsp;overflows&nbsp;the&nbsp;code&nbsp;width.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574438">//&nbsp;last&nbsp;is&nbsp;the&nbsp;most&nbsp;recently&nbsp;seen&nbsp;code,&nbsp;or&nbsp;decoderInvalidCode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574502">clear</span><span class="op" id="5574507">,</span>&nbsp;<span class="ident" id="5574509">eof</span><span class="op" id="5574512">,</span>&nbsp;<span class="ident" id="5574514">hi</span><span class="op" id="5574516">,</span>&nbsp;<span class="ident" id="5574518">overflow</span><span class="op" id="5574526">,</span>&nbsp;<span class="ident" id="5574528">last</span>&nbsp;<span class="builtintype" id="5574533">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574542">//&nbsp;Each&nbsp;code&nbsp;c&nbsp;in&nbsp;[lo,&nbsp;hi]&nbsp;expands&nbsp;to&nbsp;two&nbsp;or&nbsp;more&nbsp;bytes.&nbsp;For&nbsp;c&nbsp;!=&nbsp;hi:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574613">//&nbsp;&nbsp;&nbsp;suffix[c]&nbsp;is&nbsp;the&nbsp;last&nbsp;of&nbsp;these&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574657">//&nbsp;&nbsp;&nbsp;prefix[c]&nbsp;is&nbsp;the&nbsp;code&nbsp;for&nbsp;all&nbsp;but&nbsp;the&nbsp;last&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574712">//&nbsp;&nbsp;&nbsp;This&nbsp;code&nbsp;can&nbsp;either&nbsp;be&nbsp;a&nbsp;literal&nbsp;code&nbsp;or&nbsp;another&nbsp;code&nbsp;in&nbsp;[lo,&nbsp;c).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574785">//&nbsp;The&nbsp;c&nbsp;==&nbsp;hi&nbsp;case&nbsp;is&nbsp;a&nbsp;special&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574825">suffix</span>&nbsp;<span class="op" id="5574832">[</span><span class="num" id="5574833">1</span>&nbsp;<span class="op" id="5574835">&lt;&lt;</span>&nbsp;<span class="ident" id="5574838">maxWidth</span><span class="op" id="5574846">]</span><span class="builtintype" id="5574847">uint8</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574854">prefix</span>&nbsp;<span class="op" id="5574861">[</span><span class="num" id="5574862">1</span>&nbsp;<span class="op" id="5574864">&lt;&lt;</span>&nbsp;<span class="ident" id="5574867">maxWidth</span><span class="op" id="5574875">]</span><span class="builtintype" id="5574876">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574885">//&nbsp;output&nbsp;is&nbsp;the&nbsp;temporary&nbsp;output&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574928">//&nbsp;Literal&nbsp;codes&nbsp;are&nbsp;accumulated&nbsp;from&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574992">//&nbsp;Non-literal&nbsp;codes&nbsp;decode&nbsp;to&nbsp;a&nbsp;sequence&nbsp;of&nbsp;suffixes&nbsp;that&nbsp;are&nbsp;first</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5575062">//&nbsp;written&nbsp;right-to-left&nbsp;from&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;buffer&nbsp;before&nbsp;being&nbsp;copied</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5575135">//&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5575167">//&nbsp;It&nbsp;is&nbsp;flushed&nbsp;when&nbsp;it&nbsp;contains&nbsp;&gt;=&nbsp;1&lt;&lt;maxWidth&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5575224">//&nbsp;so&nbsp;that&nbsp;there&nbsp;is&nbsp;always&nbsp;room&nbsp;to&nbsp;decode&nbsp;an&nbsp;entire&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575283">output</span>&nbsp;<span class="op" id="5575290">[</span><span class="num" id="5575291">2</span>&nbsp;<span class="op" id="5575293">*</span>&nbsp;<span class="num" id="5575295">1</span>&nbsp;<span class="op" id="5575297">&lt;&lt;</span>&nbsp;<span class="ident" id="5575300">maxWidth</span><span class="op" id="5575308">]</span><span class="builtintype" id="5575309">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575315">o</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5575322">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5575329">//&nbsp;write&nbsp;index&nbsp;into&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575357">toRead</span>&nbsp;<span class="op" id="5575364">[</span><span class="op" id="5575365">]</span><span class="builtintype" id="5575366">byte</span>&nbsp;<span class="comment" id="5575371">//&nbsp;bytes&nbsp;to&nbsp;return&nbsp;from&nbsp;Read</span><br>
<span class="lineno"></span><span class="op" id="5575400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5575403">//&nbsp;readLSB&nbsp;returns&nbsp;the&nbsp;next&nbsp;code&nbsp;for&nbsp;&#34;Least&nbsp;Significant&nbsp;Bits&nbsp;first&#34;&nbsp;data.</span><br>
<span class="lineno">85</span><span class="keyword" id="5575477">func</span>&nbsp;<span class="op" id="5575482">(</span><span class="ident" id="5575483">d</span>&nbsp;<span class="op" id="5575485">*</span><span class="ident" id="5575486">decoder</span><span class="op" id="5575493">)</span>&nbsp;<span class="ident" id="5575495">readLSB</span><span class="op" id="5575502">(</span><span class="op" id="5575503">)</span>&nbsp;<span class="op" id="5575505">(</span><span class="builtintype" id="5575506">uint16</span><span class="op" id="5575512">,</span>&nbsp;<span class="builtintype" id="5575514">error</span><span class="op" id="5575519">)</span>&nbsp;<span class="op" id="5575521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5575524">for</span>&nbsp;<span class="ident" id="5575528">d</span><span class="op" id="5575529">.</span><span class="ident" id="5575530">nBits</span>&nbsp;<span class="op" id="5575536">&lt;</span>&nbsp;<span class="ident" id="5575538">d</span><span class="op" id="5575539">.</span><span class="ident" id="5575540">width</span>&nbsp;<span class="op" id="5575546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575550">x</span><span class="op" id="5575551">,</span>&nbsp;<span class="ident" id="5575553">err</span>&nbsp;<span class="op" id="5575557">:=</span>&nbsp;<span class="ident" id="5575560">d</span><span class="op" id="5575561">.</span><span class="ident" id="5575562">r</span><span class="op" id="5575563">.</span><span class="ident" id="5575564">ReadByte</span><span class="op" id="5575572">(</span><span class="op" id="5575573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5575577">if</span>&nbsp;<span class="ident" id="5575580">err</span>&nbsp;<span class="op" id="5575584">!=</span>&nbsp;<span class="ident" id="5575587">nil</span>&nbsp;<span class="op" id="5575591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5575596">return</span>&nbsp;<span class="num" id="5575603">0</span><span class="op" id="5575604">,</span>&nbsp;<span class="ident" id="5575606">err</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5575612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575616">d</span><span class="op" id="5575617">.</span><span class="ident" id="5575618">bits</span>&nbsp;<span class="op" id="5575623">|=</span>&nbsp;<span class="builtintype" id="5575626">uint32</span><span class="op" id="5575632">(</span><span class="ident" id="5575633">x</span><span class="op" id="5575634">)</span>&nbsp;<span class="op" id="5575636">&lt;&lt;</span>&nbsp;<span class="ident" id="5575639">d</span><span class="op" id="5575640">.</span><span class="ident" id="5575641">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575649">d</span><span class="op" id="5575650">.</span><span class="ident" id="5575651">nBits</span>&nbsp;<span class="op" id="5575657">+=</span>&nbsp;<span class="num" id="5575660">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5575663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575666">code</span>&nbsp;<span class="op" id="5575671">:=</span>&nbsp;<span class="builtintype" id="5575674">uint16</span><span class="op" id="5575680">(</span><span class="ident" id="5575681">d</span><span class="op" id="5575682">.</span><span class="ident" id="5575683">bits</span>&nbsp;<span class="op" id="5575688">&amp;</span>&nbsp;<span class="op" id="5575690">(</span><span class="num" id="5575691">1</span><span class="op" id="5575692">&lt;&lt;</span><span class="ident" id="5575694">d</span><span class="op" id="5575695">.</span><span class="ident" id="5575696">width</span>&nbsp;<span class="op" id="5575702">-</span>&nbsp;<span class="num" id="5575704">1</span><span class="op" id="5575705">)</span><span class="op" id="5575706">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575709">d</span><span class="op" id="5575710">.</span><span class="ident" id="5575711">bits</span>&nbsp;<span class="op" id="5575716">&gt;&gt;=</span>&nbsp;<span class="ident" id="5575720">d</span><span class="op" id="5575721">.</span><span class="ident" id="5575722">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575729">d</span><span class="op" id="5575730">.</span><span class="ident" id="5575731">nBits</span>&nbsp;<span class="op" id="5575737">-=</span>&nbsp;<span class="ident" id="5575740">d</span><span class="op" id="5575741">.</span><span class="ident" id="5575742">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5575749">return</span>&nbsp;<span class="ident" id="5575756">code</span><span class="op" id="5575760">,</span>&nbsp;<span class="ident" id="5575762">nil</span><br>
<span class="lineno"></span><span class="op" id="5575766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="5575769">//&nbsp;readMSB&nbsp;returns&nbsp;the&nbsp;next&nbsp;code&nbsp;for&nbsp;&#34;Most&nbsp;Significant&nbsp;Bits&nbsp;first&#34;&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5575842">func</span>&nbsp;<span class="op" id="5575847">(</span><span class="ident" id="5575848">d</span>&nbsp;<span class="op" id="5575850">*</span><span class="ident" id="5575851">decoder</span><span class="op" id="5575858">)</span>&nbsp;<span class="ident" id="5575860">readMSB</span><span class="op" id="5575867">(</span><span class="op" id="5575868">)</span>&nbsp;<span class="op" id="5575870">(</span><span class="builtintype" id="5575871">uint16</span><span class="op" id="5575877">,</span>&nbsp;<span class="builtintype" id="5575879">error</span><span class="op" id="5575884">)</span>&nbsp;<span class="op" id="5575886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5575889">for</span>&nbsp;<span class="ident" id="5575893">d</span><span class="op" id="5575894">.</span><span class="ident" id="5575895">nBits</span>&nbsp;<span class="op" id="5575901">&lt;</span>&nbsp;<span class="ident" id="5575903">d</span><span class="op" id="5575904">.</span><span class="ident" id="5575905">width</span>&nbsp;<span class="op" id="5575911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575915">x</span><span class="op" id="5575916">,</span>&nbsp;<span class="ident" id="5575918">err</span>&nbsp;<span class="op" id="5575922">:=</span>&nbsp;<span class="ident" id="5575925">d</span><span class="op" id="5575926">.</span><span class="ident" id="5575927">r</span><span class="op" id="5575928">.</span><span class="ident" id="5575929">ReadByte</span><span class="op" id="5575937">(</span><span class="op" id="5575938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5575942">if</span>&nbsp;<span class="ident" id="5575945">err</span>&nbsp;<span class="op" id="5575949">!=</span>&nbsp;<span class="ident" id="5575952">nil</span>&nbsp;<span class="op" id="5575956">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5575961">return</span>&nbsp;<span class="num" id="5575968">0</span><span class="op" id="5575969">,</span>&nbsp;<span class="ident" id="5575971">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5575977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575981">d</span><span class="op" id="5575982">.</span><span class="ident" id="5575983">bits</span>&nbsp;<span class="op" id="5575988">|=</span>&nbsp;<span class="builtintype" id="5575991">uint32</span><span class="op" id="5575997">(</span><span class="ident" id="5575998">x</span><span class="op" id="5575999">)</span>&nbsp;<span class="op" id="5576001">&lt;&lt;</span>&nbsp;<span class="op" id="5576004">(</span><span class="num" id="5576005">24</span>&nbsp;<span class="op" id="5576008">-</span>&nbsp;<span class="ident" id="5576010">d</span><span class="op" id="5576011">.</span><span class="ident" id="5576012">nBits</span><span class="op" id="5576017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576021">d</span><span class="op" id="5576022">.</span><span class="ident" id="5576023">nBits</span>&nbsp;<span class="op" id="5576029">+=</span>&nbsp;<span class="num" id="5576032">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5576035">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576038">code</span>&nbsp;<span class="op" id="5576043">:=</span>&nbsp;<span class="builtintype" id="5576046">uint16</span><span class="op" id="5576052">(</span><span class="ident" id="5576053">d</span><span class="op" id="5576054">.</span><span class="ident" id="5576055">bits</span>&nbsp;<span class="op" id="5576060">&gt;&gt;</span>&nbsp;<span class="op" id="5576063">(</span><span class="num" id="5576064">32</span>&nbsp;<span class="op" id="5576067">-</span>&nbsp;<span class="ident" id="5576069">d</span><span class="op" id="5576070">.</span><span class="ident" id="5576071">width</span><span class="op" id="5576076">)</span><span class="op" id="5576077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576080">d</span><span class="op" id="5576081">.</span><span class="ident" id="5576082">bits</span>&nbsp;<span class="op" id="5576087">&lt;&lt;=</span>&nbsp;<span class="ident" id="5576091">d</span><span class="op" id="5576092">.</span><span class="ident" id="5576093">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576100">d</span><span class="op" id="5576101">.</span><span class="ident" id="5576102">nBits</span>&nbsp;<span class="op" id="5576108">-=</span>&nbsp;<span class="ident" id="5576111">d</span><span class="op" id="5576112">.</span><span class="ident" id="5576113">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576120">return</span>&nbsp;<span class="ident" id="5576127">code</span><span class="op" id="5576131">,</span>&nbsp;<span class="ident" id="5576133">nil</span><br>
<span class="lineno"></span><span class="op" id="5576137">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="5576140">func</span>&nbsp;<span class="op" id="5576145">(</span><span class="ident" id="5576146">d</span>&nbsp;<span class="op" id="5576148">*</span><span class="ident" id="5576149">decoder</span><span class="op" id="5576156">)</span>&nbsp;<span class="ident" id="5576158">Read</span><span class="op" id="5576162">(</span><span class="ident" id="5576163">b</span>&nbsp;<span class="op" id="5576165">[</span><span class="op" id="5576166">]</span><span class="builtintype" id="5576167">byte</span><span class="op" id="5576171">)</span>&nbsp;<span class="op" id="5576173">(</span><span class="builtintype" id="5576174">int</span><span class="op" id="5576177">,</span>&nbsp;<span class="builtintype" id="5576179">error</span><span class="op" id="5576184">)</span>&nbsp;<span class="op" id="5576186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576189">for</span>&nbsp;<span class="op" id="5576193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576197">if</span>&nbsp;<span class="builtinfunc" id="5576200">len</span><span class="op" id="5576203">(</span><span class="ident" id="5576204">d</span><span class="op" id="5576205">.</span><span class="ident" id="5576206">toRead</span><span class="op" id="5576212">)</span>&nbsp;<span class="op" id="5576214">&gt;</span>&nbsp;<span class="num" id="5576216">0</span>&nbsp;<span class="op" id="5576218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576223">n</span>&nbsp;<span class="op" id="5576225">:=</span>&nbsp;<span class="builtinfunc" id="5576228">copy</span><span class="op" id="5576232">(</span><span class="ident" id="5576233">b</span><span class="op" id="5576234">,</span>&nbsp;<span class="ident" id="5576236">d</span><span class="op" id="5576237">.</span><span class="ident" id="5576238">toRead</span><span class="op" id="5576244">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576249">d</span><span class="op" id="5576250">.</span><span class="ident" id="5576251">toRead</span>&nbsp;<span class="op" id="5576258">=</span>&nbsp;<span class="ident" id="5576260">d</span><span class="op" id="5576261">.</span><span class="ident" id="5576262">toRead</span><span class="op" id="5576268">[</span><span class="ident" id="5576269">n</span><span class="op" id="5576270">:</span><span class="op" id="5576271">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576276">return</span>&nbsp;<span class="ident" id="5576283">n</span><span class="op" id="5576284">,</span>&nbsp;<span class="ident" id="5576286">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5576292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576296">if</span>&nbsp;<span class="ident" id="5576299">d</span><span class="op" id="5576300">.</span><span class="ident" id="5576301">err</span>&nbsp;<span class="op" id="5576305">!=</span>&nbsp;<span class="ident" id="5576308">nil</span>&nbsp;<span class="op" id="5576312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576317">return</span>&nbsp;<span class="num" id="5576324">0</span><span class="op" id="5576325">,</span>&nbsp;<span class="ident" id="5576327">d</span><span class="op" id="5576328">.</span><span class="ident" id="5576329">err</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5576335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576339">d</span><span class="op" id="5576340">.</span><span class="ident" id="5576341">decode</span><span class="op" id="5576347">(</span><span class="op" id="5576348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5576351">}</span><br>
<span class="lineno"></span><span class="op" id="5576353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5576356">//&nbsp;decode&nbsp;decompresses&nbsp;bytes&nbsp;from&nbsp;r&nbsp;and&nbsp;leaves&nbsp;them&nbsp;in&nbsp;d.toRead.</span><br>
<span class="lineno"></span><span class="comment" id="5576421">//&nbsp;read&nbsp;specifies&nbsp;how&nbsp;to&nbsp;decode&nbsp;bytes&nbsp;into&nbsp;codes.</span><br>
<span class="lineno"></span><span class="comment" id="5576471">//&nbsp;litWidth&nbsp;is&nbsp;the&nbsp;width&nbsp;in&nbsp;bits&nbsp;of&nbsp;literal&nbsp;codes.</span><br>
<span class="lineno"></span><span class="keyword" id="5576522">func</span>&nbsp;<span class="op" id="5576527">(</span><span class="ident" id="5576528">d</span>&nbsp;<span class="op" id="5576530">*</span><span class="ident" id="5576531">decoder</span><span class="op" id="5576538">)</span>&nbsp;<span class="ident" id="5576540">decode</span><span class="op" id="5576546">(</span><span class="op" id="5576547">)</span>&nbsp;<span class="op" id="5576549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5576552">//&nbsp;Loop&nbsp;over&nbsp;the&nbsp;code&nbsp;stream,&nbsp;converting&nbsp;codes&nbsp;into&nbsp;decompressed&nbsp;bytes.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576625">for</span>&nbsp;<span class="op" id="5576629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576633">code</span><span class="op" id="5576637">,</span>&nbsp;<span class="ident" id="5576639">err</span>&nbsp;<span class="op" id="5576643">:=</span>&nbsp;<span class="ident" id="5576646">d</span><span class="op" id="5576647">.</span><span class="ident" id="5576648">read</span><span class="op" id="5576652">(</span><span class="ident" id="5576653">d</span><span class="op" id="5576654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576658">if</span>&nbsp;<span class="ident" id="5576661">err</span>&nbsp;<span class="op" id="5576665">!=</span>&nbsp;<span class="ident" id="5576668">nil</span>&nbsp;<span class="op" id="5576672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576677">if</span>&nbsp;<span class="ident" id="5576680">err</span>&nbsp;<span class="op" id="5576684">==</span>&nbsp;<span class="ident" id="5576687">io</span><span class="op" id="5576689">.</span><span class="ident" id="5576690">EOF</span>&nbsp;<span class="op" id="5576694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576700">err</span>&nbsp;<span class="op" id="5576704">=</span>&nbsp;<span class="ident" id="5576706">io</span><span class="op" id="5576708">.</span><span class="ident" id="5576709">ErrUnexpectedEOF</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5576729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576734">d</span><span class="op" id="5576735">.</span><span class="ident" id="5576736">err</span>&nbsp;<span class="op" id="5576740">=</span>&nbsp;<span class="ident" id="5576742">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576749">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5576758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576762">switch</span>&nbsp;<span class="op" id="5576769">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576773">case</span>&nbsp;<span class="ident" id="5576778">code</span>&nbsp;<span class="op" id="5576783">&lt;</span>&nbsp;<span class="ident" id="5576785">d</span><span class="op" id="5576786">.</span><span class="ident" id="5576787">clear</span><span class="op" id="5576792">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5576797">//&nbsp;We&nbsp;have&nbsp;a&nbsp;literal&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576827">d</span><span class="op" id="5576828">.</span><span class="ident" id="5576829">output</span><span class="op" id="5576835">[</span><span class="ident" id="5576836">d</span><span class="op" id="5576837">.</span><span class="ident" id="5576838">o</span><span class="op" id="5576839">]</span>&nbsp;<span class="op" id="5576841">=</span>&nbsp;<span class="builtintype" id="5576843">uint8</span><span class="op" id="5576848">(</span><span class="ident" id="5576849">code</span><span class="op" id="5576853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576858">d</span><span class="op" id="5576859">.</span><span class="ident" id="5576860">o</span><span class="op" id="5576861">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576867">if</span>&nbsp;<span class="ident" id="5576870">d</span><span class="op" id="5576871">.</span><span class="ident" id="5576872">last</span>&nbsp;<span class="op" id="5576877">!=</span>&nbsp;<span class="ident" id="5576880">decoderInvalidCode</span>&nbsp;<span class="op" id="5576899">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5576905">//&nbsp;Save&nbsp;what&nbsp;the&nbsp;hi&nbsp;code&nbsp;expands&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576946">d</span><span class="op" id="5576947">.</span><span class="ident" id="5576948">suffix</span><span class="op" id="5576954">[</span><span class="ident" id="5576955">d</span><span class="op" id="5576956">.</span><span class="ident" id="5576957">hi</span><span class="op" id="5576959">]</span>&nbsp;<span class="op" id="5576961">=</span>&nbsp;<span class="builtintype" id="5576963">uint8</span><span class="op" id="5576968">(</span><span class="ident" id="5576969">code</span><span class="op" id="5576973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576979">d</span><span class="op" id="5576980">.</span><span class="ident" id="5576981">prefix</span><span class="op" id="5576987">[</span><span class="ident" id="5576988">d</span><span class="op" id="5576989">.</span><span class="ident" id="5576990">hi</span><span class="op" id="5576992">]</span>&nbsp;<span class="op" id="5576994">=</span>&nbsp;<span class="ident" id="5576996">d</span><span class="op" id="5576997">.</span><span class="ident" id="5576998">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5577006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5577010">case</span>&nbsp;<span class="ident" id="5577015">code</span>&nbsp;<span class="op" id="5577020">==</span>&nbsp;<span class="ident" id="5577023">d</span><span class="op" id="5577024">.</span><span class="ident" id="5577025">clear</span><span class="op" id="5577030">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577035">d</span><span class="op" id="5577036">.</span><span class="ident" id="5577037">width</span>&nbsp;<span class="op" id="5577043">=</span>&nbsp;<span class="num" id="5577045">1</span>&nbsp;<span class="op" id="5577047">+</span>&nbsp;<span class="builtintype" id="5577049">uint</span><span class="op" id="5577053">(</span><span class="ident" id="5577054">d</span><span class="op" id="5577055">.</span><span class="ident" id="5577056">litWidth</span><span class="op" id="5577064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577069">d</span><span class="op" id="5577070">.</span><span class="ident" id="5577071">hi</span>&nbsp;<span class="op" id="5577074">=</span>&nbsp;<span class="ident" id="5577076">d</span><span class="op" id="5577077">.</span><span class="ident" id="5577078">eof</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577085">d</span><span class="op" id="5577086">.</span><span class="ident" id="5577087">overflow</span>&nbsp;<span class="op" id="5577096">=</span>&nbsp;<span class="num" id="5577098">1</span>&nbsp;<span class="op" id="5577100">&lt;&lt;</span>&nbsp;<span class="ident" id="5577103">d</span><span class="op" id="5577104">.</span><span class="ident" id="5577105">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577114">d</span><span class="op" id="5577115">.</span><span class="ident" id="5577116">last</span>&nbsp;<span class="op" id="5577121">=</span>&nbsp;<span class="ident" id="5577123">decoderInvalidCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5577145">continue</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5577156">case</span>&nbsp;<span class="ident" id="5577161">code</span>&nbsp;<span class="op" id="5577166">==</span>&nbsp;<span class="ident" id="5577169">d</span><span class="op" id="5577170">.</span><span class="ident" id="5577171">eof</span><span class="op" id="5577174">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577179">d</span><span class="op" id="5577180">.</span><span class="ident" id="5577181">flush</span><span class="op" id="5577186">(</span><span class="op" id="5577187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577192">d</span><span class="op" id="5577193">.</span><span class="ident" id="5577194">err</span>&nbsp;<span class="op" id="5577198">=</span>&nbsp;<span class="ident" id="5577200">io</span><span class="op" id="5577202">.</span><span class="ident" id="5577203">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5577210">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5577219">case</span>&nbsp;<span class="ident" id="5577224">code</span>&nbsp;<span class="op" id="5577229">&lt;=</span>&nbsp;<span class="ident" id="5577232">d</span><span class="op" id="5577233">.</span><span class="ident" id="5577234">hi</span><span class="op" id="5577236">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577241">c</span><span class="op" id="5577242">,</span>&nbsp;<span class="ident" id="5577244">i</span>&nbsp;<span class="op" id="5577246">:=</span>&nbsp;<span class="ident" id="5577249">code</span><span class="op" id="5577253">,</span>&nbsp;<span class="builtinfunc" id="5577255">len</span><span class="op" id="5577258">(</span><span class="ident" id="5577259">d</span><span class="op" id="5577260">.</span><span class="ident" id="5577261">output</span><span class="op" id="5577267">)</span><span class="op" id="5577268">-</span><span class="num" id="5577269">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5577274">if</span>&nbsp;<span class="ident" id="5577277">code</span>&nbsp;<span class="op" id="5577282">==</span>&nbsp;<span class="ident" id="5577285">d</span><span class="op" id="5577286">.</span><span class="ident" id="5577287">hi</span>&nbsp;<span class="op" id="5577290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5577296">//&nbsp;code&nbsp;==&nbsp;hi&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;which&nbsp;expands&nbsp;to&nbsp;the&nbsp;last&nbsp;expansion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5577368">//&nbsp;followed&nbsp;by&nbsp;the&nbsp;head&nbsp;of&nbsp;the&nbsp;last&nbsp;expansion.&nbsp;To&nbsp;find&nbsp;the&nbsp;head,&nbsp;we&nbsp;walk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5577445">//&nbsp;the&nbsp;prefix&nbsp;chain&nbsp;until&nbsp;we&nbsp;find&nbsp;a&nbsp;literal&nbsp;code.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577499">c</span>&nbsp;<span class="op" id="5577501">=</span>&nbsp;<span class="ident" id="5577503">d</span><span class="op" id="5577504">.</span><span class="ident" id="5577505">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5577514">for</span>&nbsp;<span class="ident" id="5577518">c</span>&nbsp;<span class="op" id="5577520">&gt;=</span>&nbsp;<span class="ident" id="5577523">d</span><span class="op" id="5577524">.</span><span class="ident" id="5577525">clear</span>&nbsp;<span class="op" id="5577531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577538">c</span>&nbsp;<span class="op" id="5577540">=</span>&nbsp;<span class="ident" id="5577542">d</span><span class="op" id="5577543">.</span><span class="ident" id="5577544">prefix</span><span class="op" id="5577550">[</span><span class="ident" id="5577551">c</span><span class="op" id="5577552">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5577558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577564">d</span><span class="op" id="5577565">.</span><span class="ident" id="5577566">output</span><span class="op" id="5577572">[</span><span class="ident" id="5577573">i</span><span class="op" id="5577574">]</span>&nbsp;<span class="op" id="5577576">=</span>&nbsp;<span class="builtintype" id="5577578">uint8</span><span class="op" id="5577583">(</span><span class="ident" id="5577584">c</span><span class="op" id="5577585">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577591">i</span><span class="op" id="5577592">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577599">c</span>&nbsp;<span class="op" id="5577601">=</span>&nbsp;<span class="ident" id="5577603">d</span><span class="op" id="5577604">.</span><span class="ident" id="5577605">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5577613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5577618">//&nbsp;Copy&nbsp;the&nbsp;suffix&nbsp;chain&nbsp;into&nbsp;output&nbsp;and&nbsp;then&nbsp;write&nbsp;that&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5577684">for</span>&nbsp;<span class="ident" id="5577688">c</span>&nbsp;<span class="op" id="5577690">&gt;=</span>&nbsp;<span class="ident" id="5577693">d</span><span class="op" id="5577694">.</span><span class="ident" id="5577695">clear</span>&nbsp;<span class="op" id="5577701">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577707">d</span><span class="op" id="5577708">.</span><span class="ident" id="5577709">output</span><span class="op" id="5577715">[</span><span class="ident" id="5577716">i</span><span class="op" id="5577717">]</span>&nbsp;<span class="op" id="5577719">=</span>&nbsp;<span class="ident" id="5577721">d</span><span class="op" id="5577722">.</span><span class="ident" id="5577723">suffix</span><span class="op" id="5577729">[</span><span class="ident" id="5577730">c</span><span class="op" id="5577731">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577737">i</span><span class="op" id="5577738">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577745">c</span>&nbsp;<span class="op" id="5577747">=</span>&nbsp;<span class="ident" id="5577749">d</span><span class="op" id="5577750">.</span><span class="ident" id="5577751">prefix</span><span class="op" id="5577757">[</span><span class="ident" id="5577758">c</span><span class="op" id="5577759">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5577764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577769">d</span><span class="op" id="5577770">.</span><span class="ident" id="5577771">output</span><span class="op" id="5577777">[</span><span class="ident" id="5577778">i</span><span class="op" id="5577779">]</span>&nbsp;<span class="op" id="5577781">=</span>&nbsp;<span class="builtintype" id="5577783">uint8</span><span class="op" id="5577788">(</span><span class="ident" id="5577789">c</span><span class="op" id="5577790">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577795">d</span><span class="op" id="5577796">.</span><span class="ident" id="5577797">o</span>&nbsp;<span class="op" id="5577799">+=</span>&nbsp;<span class="builtinfunc" id="5577802">copy</span><span class="op" id="5577806">(</span><span class="ident" id="5577807">d</span><span class="op" id="5577808">.</span><span class="ident" id="5577809">output</span><span class="op" id="5577815">[</span><span class="ident" id="5577816">d</span><span class="op" id="5577817">.</span><span class="ident" id="5577818">o</span><span class="op" id="5577819">:</span><span class="op" id="5577820">]</span><span class="op" id="5577821">,</span>&nbsp;<span class="ident" id="5577823">d</span><span class="op" id="5577824">.</span><span class="ident" id="5577825">output</span><span class="op" id="5577831">[</span><span class="ident" id="5577832">i</span><span class="op" id="5577833">:</span><span class="op" id="5577834">]</span><span class="op" id="5577835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5577840">if</span>&nbsp;<span class="ident" id="5577843">d</span><span class="op" id="5577844">.</span><span class="ident" id="5577845">last</span>&nbsp;<span class="op" id="5577850">!=</span>&nbsp;<span class="ident" id="5577853">decoderInvalidCode</span>&nbsp;<span class="op" id="5577872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5577878">//&nbsp;Save&nbsp;what&nbsp;the&nbsp;hi&nbsp;code&nbsp;expands&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577919">d</span><span class="op" id="5577920">.</span><span class="ident" id="5577921">suffix</span><span class="op" id="5577927">[</span><span class="ident" id="5577928">d</span><span class="op" id="5577929">.</span><span class="ident" id="5577930">hi</span><span class="op" id="5577932">]</span>&nbsp;<span class="op" id="5577934">=</span>&nbsp;<span class="builtintype" id="5577936">uint8</span><span class="op" id="5577941">(</span><span class="ident" id="5577942">c</span><span class="op" id="5577943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577949">d</span><span class="op" id="5577950">.</span><span class="ident" id="5577951">prefix</span><span class="op" id="5577957">[</span><span class="ident" id="5577958">d</span><span class="op" id="5577959">.</span><span class="ident" id="5577960">hi</span><span class="op" id="5577962">]</span>&nbsp;<span class="op" id="5577964">=</span>&nbsp;<span class="ident" id="5577966">d</span><span class="op" id="5577967">.</span><span class="ident" id="5577968">last</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5577976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5577980">default</span><span class="op" id="5577987">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577992">d</span><span class="op" id="5577993">.</span><span class="ident" id="5577994">err</span>&nbsp;<span class="op" id="5577998">=</span>&nbsp;<span class="ident" id="5578000">errors</span><span class="op" id="5578006">.</span><span class="ident" id="5578007">New</span><span class="op" id="5578010">(</span><span class="string" id="5578011">&#34;lzw:&nbsp;invalid&nbsp;code&#34;</span><span class="op" id="5578030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578035">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578044">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578048">d</span><span class="op" id="5578049">.</span><span class="ident" id="5578050">last</span><span class="op" id="5578054">,</span>&nbsp;<span class="ident" id="5578056">d</span><span class="op" id="5578057">.</span><span class="ident" id="5578058">hi</span>&nbsp;<span class="op" id="5578061">=</span>&nbsp;<span class="ident" id="5578063">code</span><span class="op" id="5578067">,</span>&nbsp;<span class="ident" id="5578069">d</span><span class="op" id="5578070">.</span><span class="ident" id="5578071">hi</span><span class="op" id="5578073">+</span><span class="num" id="5578074">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578078">if</span>&nbsp;<span class="ident" id="5578081">d</span><span class="op" id="5578082">.</span><span class="ident" id="5578083">hi</span>&nbsp;<span class="op" id="5578086">&gt;=</span>&nbsp;<span class="ident" id="5578089">d</span><span class="op" id="5578090">.</span><span class="ident" id="5578091">overflow</span>&nbsp;<span class="op" id="5578100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578105">if</span>&nbsp;<span class="ident" id="5578108">d</span><span class="op" id="5578109">.</span><span class="ident" id="5578110">width</span>&nbsp;<span class="op" id="5578116">==</span>&nbsp;<span class="ident" id="5578119">maxWidth</span>&nbsp;<span class="op" id="5578128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578134">d</span><span class="op" id="5578135">.</span><span class="ident" id="5578136">last</span>&nbsp;<span class="op" id="5578141">=</span>&nbsp;<span class="ident" id="5578143">decoderInvalidCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578165">}</span>&nbsp;<span class="keyword" id="5578167">else</span>&nbsp;<span class="op" id="5578172">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578178">d</span><span class="op" id="5578179">.</span><span class="ident" id="5578180">width</span><span class="op" id="5578185">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578192">d</span><span class="op" id="5578193">.</span><span class="ident" id="5578194">overflow</span>&nbsp;<span class="op" id="5578203">&lt;&lt;=</span>&nbsp;<span class="num" id="5578207">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578220">if</span>&nbsp;<span class="ident" id="5578223">d</span><span class="op" id="5578224">.</span><span class="ident" id="5578225">o</span>&nbsp;<span class="op" id="5578227">&gt;=</span>&nbsp;<span class="ident" id="5578230">flushBuffer</span>&nbsp;<span class="op" id="5578242">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578247">d</span><span class="op" id="5578248">.</span><span class="ident" id="5578249">flush</span><span class="op" id="5578254">(</span><span class="op" id="5578255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578260">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578272">}</span><br>
<span class="lineno"></span><span class="op" id="5578274">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="5578277">func</span>&nbsp;<span class="op" id="5578282">(</span><span class="ident" id="5578283">d</span>&nbsp;<span class="op" id="5578285">*</span><span class="ident" id="5578286">decoder</span><span class="op" id="5578293">)</span>&nbsp;<span class="ident" id="5578295">flush</span><span class="op" id="5578300">(</span><span class="op" id="5578301">)</span>&nbsp;<span class="op" id="5578303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578306">d</span><span class="op" id="5578307">.</span><span class="ident" id="5578308">toRead</span>&nbsp;<span class="op" id="5578315">=</span>&nbsp;<span class="ident" id="5578317">d</span><span class="op" id="5578318">.</span><span class="ident" id="5578319">output</span><span class="op" id="5578325">[</span><span class="op" id="5578326">:</span><span class="ident" id="5578327">d</span><span class="op" id="5578328">.</span><span class="ident" id="5578329">o</span><span class="op" id="5578330">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578333">d</span><span class="op" id="5578334">.</span><span class="ident" id="5578335">o</span>&nbsp;<span class="op" id="5578337">=</span>&nbsp;<span class="num" id="5578339">0</span><br>
<span class="lineno"></span><span class="op" id="5578341">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="5578344">var</span>&nbsp;<span class="ident" id="5578348">errClosed</span>&nbsp;<span class="op" id="5578358">=</span>&nbsp;<span class="ident" id="5578360">errors</span><span class="op" id="5578366">.</span><span class="ident" id="5578367">New</span><span class="op" id="5578370">(</span><span class="string" id="5578371">&#34;compress/lzw:&nbsp;reader/writer&nbsp;is&nbsp;closed&#34;</span><span class="op" id="5578410">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5578413">func</span>&nbsp;<span class="op" id="5578418">(</span><span class="ident" id="5578419">d</span>&nbsp;<span class="op" id="5578421">*</span><span class="ident" id="5578422">decoder</span><span class="op" id="5578429">)</span>&nbsp;<span class="ident" id="5578431">Close</span><span class="op" id="5578436">(</span><span class="op" id="5578437">)</span>&nbsp;<span class="builtintype" id="5578439">error</span>&nbsp;<span class="op" id="5578445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578448">d</span><span class="op" id="5578449">.</span><span class="ident" id="5578450">err</span>&nbsp;<span class="op" id="5578454">=</span>&nbsp;<span class="ident" id="5578456">errClosed</span>&nbsp;<span class="comment" id="5578466">//&nbsp;in&nbsp;case&nbsp;any&nbsp;Reads&nbsp;come&nbsp;along</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578499">return</span>&nbsp;<span class="ident" id="5578506">nil</span><br>
<span class="lineno"></span><span class="op" id="5578510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5578513">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;io.ReadCloser.</span><br>
<span class="lineno"></span><span class="comment" id="5578555">//&nbsp;Reads&nbsp;from&nbsp;the&nbsp;returned&nbsp;io.ReadCloser&nbsp;read&nbsp;and&nbsp;decompress&nbsp;data&nbsp;from&nbsp;r.</span><br>
<span class="lineno">225</span><span class="comment" id="5578629">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="5578676">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5578738">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;ReadCloser&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="5578812">//&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="comment" id="5578833">//&nbsp;The&nbsp;number&nbsp;of&nbsp;bits&nbsp;to&nbsp;use&nbsp;for&nbsp;literal&nbsp;codes,&nbsp;litWidth,&nbsp;must&nbsp;be&nbsp;in&nbsp;the</span><br>
<span class="lineno">230</span><span class="comment" id="5578906">//&nbsp;range&nbsp;[2,8]&nbsp;and&nbsp;is&nbsp;typically&nbsp;8.</span><br>
<span class="lineno"></span><span class="keyword" id="5578941">func</span>&nbsp;<span class="ident" id="5578946">NewReader</span><span class="op" id="5578955">(</span><span class="ident" id="5578956">r</span>&nbsp;<span class="ident" id="5578958">io</span><span class="op" id="5578960">.</span><span class="ident" id="5578961">Reader</span><span class="op" id="5578967">,</span>&nbsp;<span class="ident" id="5578969">order</span>&nbsp;<span class="ident" id="5578975">Order</span><span class="op" id="5578980">,</span>&nbsp;<span class="ident" id="5578982">litWidth</span>&nbsp;<span class="builtintype" id="5578991">int</span><span class="op" id="5578994">)</span>&nbsp;<span class="ident" id="5578996">io</span><span class="op" id="5578998">.</span><span class="ident" id="5578999">ReadCloser</span>&nbsp;<span class="op" id="5579010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579013">d</span>&nbsp;<span class="op" id="5579015">:=</span>&nbsp;<span class="builtinfunc" id="5579018">new</span><span class="op" id="5579021">(</span><span class="ident" id="5579022">decoder</span><span class="op" id="5579029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579032">switch</span>&nbsp;<span class="ident" id="5579039">order</span>&nbsp;<span class="op" id="5579045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579048">case</span>&nbsp;<span class="ident" id="5579053">LSB</span><span class="op" id="5579056">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579060">d</span><span class="op" id="5579061">.</span><span class="ident" id="5579062">read</span>&nbsp;<span class="op" id="5579067">=</span>&nbsp;<span class="op" id="5579069">(</span><span class="op" id="5579070">*</span><span class="ident" id="5579071">decoder</span><span class="op" id="5579078">)</span><span class="op" id="5579079">.</span><span class="ident" id="5579080">readLSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579089">case</span>&nbsp;<span class="ident" id="5579094">MSB</span><span class="op" id="5579097">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579101">d</span><span class="op" id="5579102">.</span><span class="ident" id="5579103">read</span>&nbsp;<span class="op" id="5579108">=</span>&nbsp;<span class="op" id="5579110">(</span><span class="op" id="5579111">*</span><span class="ident" id="5579112">decoder</span><span class="op" id="5579119">)</span><span class="op" id="5579120">.</span><span class="ident" id="5579121">readMSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579130">default</span><span class="op" id="5579137">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579141">d</span><span class="op" id="5579142">.</span><span class="ident" id="5579143">err</span>&nbsp;<span class="op" id="5579147">=</span>&nbsp;<span class="ident" id="5579149">errors</span><span class="op" id="5579155">.</span><span class="ident" id="5579156">New</span><span class="op" id="5579159">(</span><span class="string" id="5579160">&#34;lzw:&nbsp;unknown&nbsp;order&#34;</span><span class="op" id="5579180">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579184">return</span>&nbsp;<span class="ident" id="5579191">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5579194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579197">if</span>&nbsp;<span class="ident" id="5579200">litWidth</span>&nbsp;<span class="op" id="5579209">&lt;</span>&nbsp;<span class="num" id="5579211">2</span>&nbsp;<span class="op" id="5579213">||</span>&nbsp;<span class="num" id="5579216">8</span>&nbsp;<span class="op" id="5579218">&lt;</span>&nbsp;<span class="ident" id="5579220">litWidth</span>&nbsp;<span class="op" id="5579229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579233">d</span><span class="op" id="5579234">.</span><span class="ident" id="5579235">err</span>&nbsp;<span class="op" id="5579239">=</span>&nbsp;<span class="ident" id="5579241">fmt</span><span class="op" id="5579244">.</span><span class="ident" id="5579245">Errorf</span><span class="op" id="5579251">(</span><span class="string" id="5579252">&#34;lzw:&nbsp;litWidth&nbsp;%d&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="5579283">,</span>&nbsp;<span class="ident" id="5579285">litWidth</span><span class="op" id="5579293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579297">return</span>&nbsp;<span class="ident" id="5579304">d</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5579307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579310">if</span>&nbsp;<span class="ident" id="5579313">br</span><span class="op" id="5579315">,</span>&nbsp;<span class="ident" id="5579317">ok</span>&nbsp;<span class="op" id="5579320">:=</span>&nbsp;<span class="ident" id="5579323">r</span><span class="op" id="5579324">.</span><span class="op" id="5579325">(</span><span class="ident" id="5579326">io</span><span class="op" id="5579328">.</span><span class="ident" id="5579329">ByteReader</span><span class="op" id="5579339">)</span><span class="op" id="5579340">;</span>&nbsp;<span class="ident" id="5579342">ok</span>&nbsp;<span class="op" id="5579345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579349">d</span><span class="op" id="5579350">.</span><span class="ident" id="5579351">r</span>&nbsp;<span class="op" id="5579353">=</span>&nbsp;<span class="ident" id="5579355">br</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5579359">}</span>&nbsp;<span class="keyword" id="5579361">else</span>&nbsp;<span class="op" id="5579366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579370">d</span><span class="op" id="5579371">.</span><span class="ident" id="5579372">r</span>&nbsp;<span class="op" id="5579374">=</span>&nbsp;<span class="ident" id="5579376">bufio</span><span class="op" id="5579381">.</span><span class="ident" id="5579382">NewReader</span><span class="op" id="5579391">(</span><span class="ident" id="5579392">r</span><span class="op" id="5579393">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5579396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579399">d</span><span class="op" id="5579400">.</span><span class="ident" id="5579401">litWidth</span>&nbsp;<span class="op" id="5579410">=</span>&nbsp;<span class="ident" id="5579412">litWidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579422">d</span><span class="op" id="5579423">.</span><span class="ident" id="5579424">width</span>&nbsp;<span class="op" id="5579430">=</span>&nbsp;<span class="num" id="5579432">1</span>&nbsp;<span class="op" id="5579434">+</span>&nbsp;<span class="builtintype" id="5579436">uint</span><span class="op" id="5579440">(</span><span class="ident" id="5579441">litWidth</span><span class="op" id="5579449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579452">d</span><span class="op" id="5579453">.</span><span class="ident" id="5579454">clear</span>&nbsp;<span class="op" id="5579460">=</span>&nbsp;<span class="builtintype" id="5579462">uint16</span><span class="op" id="5579468">(</span><span class="num" id="5579469">1</span><span class="op" id="5579470">)</span>&nbsp;<span class="op" id="5579472">&lt;&lt;</span>&nbsp;<span class="builtintype" id="5579475">uint</span><span class="op" id="5579479">(</span><span class="ident" id="5579480">litWidth</span><span class="op" id="5579488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579491">d</span><span class="op" id="5579492">.</span><span class="ident" id="5579493">eof</span><span class="op" id="5579496">,</span>&nbsp;<span class="ident" id="5579498">d</span><span class="op" id="5579499">.</span><span class="ident" id="5579500">hi</span>&nbsp;<span class="op" id="5579503">=</span>&nbsp;<span class="ident" id="5579505">d</span><span class="op" id="5579506">.</span><span class="ident" id="5579507">clear</span><span class="op" id="5579512">+</span><span class="num" id="5579513">1</span><span class="op" id="5579514">,</span>&nbsp;<span class="ident" id="5579516">d</span><span class="op" id="5579517">.</span><span class="ident" id="5579518">clear</span><span class="op" id="5579523">+</span><span class="num" id="5579524">1</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579527">d</span><span class="op" id="5579528">.</span><span class="ident" id="5579529">overflow</span>&nbsp;<span class="op" id="5579538">=</span>&nbsp;<span class="builtintype" id="5579540">uint16</span><span class="op" id="5579546">(</span><span class="num" id="5579547">1</span><span class="op" id="5579548">)</span>&nbsp;<span class="op" id="5579550">&lt;&lt;</span>&nbsp;<span class="ident" id="5579553">d</span><span class="op" id="5579554">.</span><span class="ident" id="5579555">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579562">d</span><span class="op" id="5579563">.</span><span class="ident" id="5579564">last</span>&nbsp;<span class="op" id="5579569">=</span>&nbsp;<span class="ident" id="5579571">decoderInvalidCode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579592">return</span>&nbsp;<span class="ident" id="5579599">d</span><br>
<span class="lineno"></span><span class="op" id="5579601">}</span>
</div>
</body>
</html>
