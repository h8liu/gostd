<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="874962">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="875018">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="875072">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="875123">//&nbsp;Futex&nbsp;is&nbsp;only&nbsp;available&nbsp;on&nbsp;DragonFly&nbsp;BSD,&nbsp;FreeBSD&nbsp;and&nbsp;Linux.</span><br>
<span class="lineno"></span><span class="comment" id="875187">//&nbsp;The&nbsp;race&nbsp;detector&nbsp;emits&nbsp;calls&nbsp;to&nbsp;split&nbsp;stack&nbsp;functions&nbsp;so&nbsp;it&nbsp;breaks</span><br>
<span class="lineno"></span><span class="comment" id="875258">//&nbsp;the&nbsp;test.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="875272">//&nbsp;+build&nbsp;dragonfly&nbsp;freebsd&nbsp;linux</span><br>
<span class="lineno">10</span><span class="comment" id="875306">//&nbsp;+build&nbsp;!race</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="875323">package</span>&nbsp;<span class="ident" id="875331">runtime_test</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="875345">import</span>&nbsp;<span class="op" id="875352">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="875355">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="875366">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="875377">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="875384">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="875387">type</span>&nbsp;<span class="ident" id="875392">futexsleepTest</span>&nbsp;<span class="keyword" id="875407">struct</span>&nbsp;<span class="op" id="875414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="875417">mtx</span>&nbsp;<span class="builtintype" id="875421">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="875429">ns</span>&nbsp;&nbsp;<span class="ident" id="875433">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="875440">msg</span>&nbsp;<span class="builtintype" id="875444">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="875452">ch</span>&nbsp;&nbsp;<span class="keyword" id="875456">chan</span>&nbsp;<span class="ident" id="875461">futexsleepTest</span><br>
<span class="lineno">25</span><span class="op" id="875476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="875479">var</span>&nbsp;<span class="ident" id="875483">futexsleepTests</span>&nbsp;<span class="op" id="875499">=</span>&nbsp;<span class="op" id="875501">[</span><span class="op" id="875502">]</span><span class="ident" id="875503">futexsleepTest</span><span class="op" id="875517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="875520">beforeY2038</span><span class="op" id="875531">:</span>&nbsp;<span class="op" id="875533">{</span><span class="ident" id="875534">mtx</span><span class="op" id="875537">:</span>&nbsp;<span class="num" id="875539">0</span><span class="op" id="875540">,</span>&nbsp;<span class="ident" id="875542">ns</span><span class="op" id="875544">:</span>&nbsp;<span class="num" id="875546">86400</span>&nbsp;<span class="op" id="875552">*</span>&nbsp;<span class="num" id="875554">1e9</span><span class="op" id="875557">,</span>&nbsp;<span class="ident" id="875559">msg</span><span class="op" id="875562">:</span>&nbsp;<span class="string" id="875564">&#34;before&nbsp;the&nbsp;year&nbsp;2038&#34;</span><span class="op" id="875586">,</span>&nbsp;<span class="ident" id="875588">ch</span><span class="op" id="875590">:</span>&nbsp;<span class="builtinfunc" id="875592">make</span><span class="op" id="875596">(</span><span class="keyword" id="875597">chan</span>&nbsp;<span class="ident" id="875602">futexsleepTest</span><span class="op" id="875616">,</span>&nbsp;<span class="num" id="875618">1</span><span class="op" id="875619">)</span><span class="op" id="875620">}</span><span class="op" id="875621">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="875624">afterY2038</span><span class="op" id="875634">:</span>&nbsp;&nbsp;<span class="op" id="875637">{</span><span class="ident" id="875638">mtx</span><span class="op" id="875641">:</span>&nbsp;<span class="num" id="875643">0</span><span class="op" id="875644">,</span>&nbsp;<span class="ident" id="875646">ns</span><span class="op" id="875648">:</span>&nbsp;<span class="op" id="875650">(</span><span class="num" id="875651">1</span><span class="op" id="875652">&lt;&lt;</span><span class="num" id="875654">31</span>&nbsp;<span class="op" id="875657">+</span>&nbsp;<span class="num" id="875659">100</span><span class="op" id="875662">)</span>&nbsp;<span class="op" id="875664">*</span>&nbsp;<span class="num" id="875666">1e9</span><span class="op" id="875669">,</span>&nbsp;<span class="ident" id="875671">msg</span><span class="op" id="875674">:</span>&nbsp;<span class="string" id="875676">&#34;after&nbsp;the&nbsp;year&nbsp;2038&#34;</span><span class="op" id="875697">,</span>&nbsp;<span class="ident" id="875699">ch</span><span class="op" id="875701">:</span>&nbsp;<span class="builtinfunc" id="875703">make</span><span class="op" id="875707">(</span><span class="keyword" id="875708">chan</span>&nbsp;<span class="ident" id="875713">futexsleepTest</span><span class="op" id="875727">,</span>&nbsp;<span class="num" id="875729">1</span><span class="op" id="875730">)</span><span class="op" id="875731">}</span><span class="op" id="875732">,</span><br>
<span class="lineno">30</span><span class="op" id="875734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="875737">const</span>&nbsp;<span class="op" id="875743">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="875746">beforeY2038</span>&nbsp;<span class="op" id="875758">=</span>&nbsp;<span class="ident" id="875760">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="875766">afterY2038</span><br>
<span class="lineno">35</span><span class="op" id="875777">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="875780">func</span>&nbsp;<span class="ident" id="875785">TestFutexsleep</span><span class="op" id="875799">(</span><span class="ident" id="875800">t</span>&nbsp;<span class="op" id="875802">*</span><span class="ident" id="875803">testing</span><span class="op" id="875810">.</span><span class="ident" id="875811">T</span><span class="op" id="875812">)</span>&nbsp;<span class="op" id="875814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="875817">if</span>&nbsp;<span class="ident" id="875820">runtime</span><span class="op" id="875827">.</span><span class="ident" id="875828">GOMAXPROCS</span><span class="op" id="875838">(</span><span class="num" id="875839">0</span><span class="op" id="875840">)</span>&nbsp;<span class="op" id="875842">&gt;</span>&nbsp;<span class="num" id="875844">1</span>&nbsp;<span class="op" id="875846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="875850">//&nbsp;futexsleep&nbsp;doesn&#39;t&nbsp;handle&nbsp;EINTR&nbsp;or&nbsp;other&nbsp;signals,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="875905">//&nbsp;so&nbsp;spurious&nbsp;wakeups&nbsp;may&nbsp;happen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="875942">t</span><span class="op" id="875943">.</span><span class="ident" id="875944">Skip</span><span class="op" id="875948">(</span><span class="string" id="875949">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="875973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="875976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="875980">start</span>&nbsp;<span class="op" id="875986">:=</span>&nbsp;<span class="ident" id="875989">time</span><span class="op" id="875993">.</span><span class="ident" id="875994">Now</span><span class="op" id="875997">(</span><span class="op" id="875998">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="876001">for</span>&nbsp;<span class="ident" id="876005">_</span><span class="op" id="876006">,</span>&nbsp;<span class="ident" id="876008">tt</span>&nbsp;<span class="op" id="876011">:=</span>&nbsp;<span class="keyword" id="876014">range</span>&nbsp;<span class="ident" id="876020">futexsleepTests</span>&nbsp;<span class="op" id="876036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="876040">go</span>&nbsp;<span class="keyword" id="876043">func</span><span class="op" id="876047">(</span><span class="ident" id="876048">tt</span>&nbsp;<span class="ident" id="876051">futexsleepTest</span><span class="op" id="876065">)</span>&nbsp;<span class="op" id="876067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="876072">runtime</span><span class="op" id="876079">.</span><span class="ident" id="876080">Entersyscall</span><span class="op" id="876092">(</span><span class="op" id="876093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="876098">runtime</span><span class="op" id="876105">.</span><span class="ident" id="876106">Futexsleep</span><span class="op" id="876116">(</span><span class="op" id="876117">&amp;</span><span class="ident" id="876118">tt</span><span class="op" id="876120">.</span><span class="ident" id="876121">mtx</span><span class="op" id="876124">,</span>&nbsp;<span class="ident" id="876126">tt</span><span class="op" id="876128">.</span><span class="ident" id="876129">mtx</span><span class="op" id="876132">,</span>&nbsp;<span class="ident" id="876134">tt</span><span class="op" id="876136">.</span><span class="ident" id="876137">ns</span><span class="op" id="876139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="876144">runtime</span><span class="op" id="876151">.</span><span class="ident" id="876152">Exitsyscall</span><span class="op" id="876163">(</span><span class="op" id="876164">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="876169">tt</span><span class="op" id="876171">.</span><span class="ident" id="876172">ch</span>&nbsp;<span class="op" id="876175">&lt;-</span>&nbsp;<span class="ident" id="876178">tt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="876183">}</span><span class="op" id="876184">(</span><span class="ident" id="876185">tt</span><span class="op" id="876187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="876190">}</span><br>
<span class="lineno"></span><span class="ident" id="876192">loop</span><span class="op" id="876196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="876199">for</span>&nbsp;<span class="op" id="876203">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="876207">select</span>&nbsp;<span class="op" id="876214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="876218">case</span>&nbsp;<span class="ident" id="876223">tt</span>&nbsp;<span class="op" id="876226">:=</span>&nbsp;<span class="op" id="876229">&lt;-</span><span class="ident" id="876231">futexsleepTests</span><span class="op" id="876246">[</span><span class="ident" id="876247">beforeY2038</span><span class="op" id="876258">]</span><span class="op" id="876259">.</span><span class="ident" id="876260">ch</span><span class="op" id="876262">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="876267">t</span><span class="op" id="876268">.</span><span class="ident" id="876269">Errorf</span><span class="op" id="876275">(</span><span class="string" id="876276">&#34;futexsleep&nbsp;test&nbsp;%q&nbsp;finished&nbsp;early&nbsp;after&nbsp;%s&#34;</span><span class="op" id="876320">,</span>&nbsp;<span class="ident" id="876322">tt</span><span class="op" id="876324">.</span><span class="ident" id="876325">msg</span><span class="op" id="876328">,</span>&nbsp;<span class="ident" id="876330">time</span><span class="op" id="876334">.</span><span class="ident" id="876335">Since</span><span class="op" id="876340">(</span><span class="ident" id="876341">start</span><span class="op" id="876346">)</span><span class="op" id="876347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="876352">break</span>&nbsp;<span class="ident" id="876358">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="876365">case</span>&nbsp;<span class="ident" id="876370">tt</span>&nbsp;<span class="op" id="876373">:=</span>&nbsp;<span class="op" id="876376">&lt;-</span><span class="ident" id="876378">futexsleepTests</span><span class="op" id="876393">[</span><span class="ident" id="876394">afterY2038</span><span class="op" id="876404">]</span><span class="op" id="876405">.</span><span class="ident" id="876406">ch</span><span class="op" id="876408">:</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="876413">//&nbsp;Looks&nbsp;like&nbsp;FreeBSD&nbsp;10&nbsp;kernel&nbsp;has&nbsp;changed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="876460">//&nbsp;the&nbsp;semantics&nbsp;of&nbsp;timedwait&nbsp;on&nbsp;userspace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="876506">//&nbsp;mutex&nbsp;to&nbsp;make&nbsp;broken&nbsp;stuff&nbsp;look&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="876552">switch</span>&nbsp;<span class="op" id="876559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="876564">case</span>&nbsp;<span class="ident" id="876569">runtime</span><span class="op" id="876576">.</span><span class="ident" id="876577">GOOS</span>&nbsp;<span class="op" id="876582">==</span>&nbsp;<span class="string" id="876585">&#34;freebsd&#34;</span>&nbsp;<span class="op" id="876595">&amp;&amp;</span>&nbsp;<span class="ident" id="876598">runtime</span><span class="op" id="876605">.</span><span class="ident" id="876606">GOARCH</span>&nbsp;<span class="op" id="876613">==</span>&nbsp;<span class="string" id="876616">&#34;386&#34;</span><span class="op" id="876621">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="876627">t</span><span class="op" id="876628">.</span><span class="ident" id="876629">Log</span><span class="op" id="876632">(</span><span class="string" id="876633">&#34;freebsd/386&nbsp;may&nbsp;not&nbsp;work&nbsp;correctly&nbsp;after&nbsp;the&nbsp;year&nbsp;2038,&nbsp;see&nbsp;golang.org/issue/7194&#34;</span><span class="op" id="876716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="876721">default</span><span class="op" id="876728">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="876734">t</span><span class="op" id="876735">.</span><span class="ident" id="876736">Errorf</span><span class="op" id="876742">(</span><span class="string" id="876743">&#34;futexsleep&nbsp;test&nbsp;%q&nbsp;finished&nbsp;early&nbsp;after&nbsp;%s&#34;</span><span class="op" id="876787">,</span>&nbsp;<span class="ident" id="876789">tt</span><span class="op" id="876791">.</span><span class="ident" id="876792">msg</span><span class="op" id="876795">,</span>&nbsp;<span class="ident" id="876797">time</span><span class="op" id="876801">.</span><span class="ident" id="876802">Since</span><span class="op" id="876807">(</span><span class="ident" id="876808">start</span><span class="op" id="876813">)</span><span class="op" id="876814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="876820">break</span>&nbsp;<span class="ident" id="876826">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="876834">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="876838">case</span>&nbsp;<span class="op" id="876843">&lt;-</span><span class="ident" id="876845">time</span><span class="op" id="876849">.</span><span class="ident" id="876850">After</span><span class="op" id="876855">(</span><span class="ident" id="876856">time</span><span class="op" id="876860">.</span><span class="ident" id="876861">Second</span><span class="op" id="876867">)</span><span class="op" id="876868">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="876873">break</span>&nbsp;<span class="ident" id="876879">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="876886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="876889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="876892">for</span>&nbsp;<span class="ident" id="876896">_</span><span class="op" id="876897">,</span>&nbsp;<span class="ident" id="876899">tt</span>&nbsp;<span class="op" id="876902">:=</span>&nbsp;<span class="keyword" id="876905">range</span>&nbsp;<span class="ident" id="876911">futexsleepTests</span>&nbsp;<span class="op" id="876927">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="876931">runtime</span><span class="op" id="876938">.</span><span class="ident" id="876939">Futexwakeup</span><span class="op" id="876950">(</span><span class="op" id="876951">&amp;</span><span class="ident" id="876952">tt</span><span class="op" id="876954">.</span><span class="ident" id="876955">mtx</span><span class="op" id="876958">,</span>&nbsp;<span class="num" id="876960">1</span><span class="op" id="876961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="876964">}</span><br>
<span class="lineno"></span><span class="op" id="876966">}</span>
</div>
</body>
</html>
