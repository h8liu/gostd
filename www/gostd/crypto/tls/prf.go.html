<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html" class="current">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4300690">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4300745">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4300799">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4300850">package</span>&nbsp;<span class="ident" id="4300858">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4300863">import</span>&nbsp;<span class="op" id="4300870">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4300873">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4300883">&#34;crypto/hmac&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4300898">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4300912">&#34;crypto/sha1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4300927">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4300944">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4300951">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4300954">//&nbsp;Split&nbsp;a&nbsp;premaster&nbsp;secret&nbsp;in&nbsp;two&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4301026">func</span>&nbsp;<span class="ident" id="4301031">splitPreMasterSecret</span><span class="op" id="4301051">(</span><span class="ident" id="4301052">secret</span>&nbsp;<span class="op" id="4301059">[</span><span class="op" id="4301060">]</span><span class="builtintype" id="4301061">byte</span><span class="op" id="4301065">)</span>&nbsp;<span class="op" id="4301067">(</span><span class="ident" id="4301068">s1</span><span class="op" id="4301070">,</span>&nbsp;<span class="ident" id="4301072">s2</span>&nbsp;<span class="op" id="4301075">[</span><span class="op" id="4301076">]</span><span class="builtintype" id="4301077">byte</span><span class="op" id="4301081">)</span>&nbsp;<span class="op" id="4301083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301086">s1</span>&nbsp;<span class="op" id="4301089">=</span>&nbsp;<span class="ident" id="4301091">secret</span><span class="op" id="4301097">[</span><span class="num" id="4301098">0</span>&nbsp;<span class="op" id="4301100">:</span>&nbsp;<span class="op" id="4301102">(</span><span class="builtinfunc" id="4301103">len</span><span class="op" id="4301106">(</span><span class="ident" id="4301107">secret</span><span class="op" id="4301113">)</span><span class="op" id="4301114">+</span><span class="num" id="4301115">1</span><span class="op" id="4301116">)</span><span class="op" id="4301117">/</span><span class="num" id="4301118">2</span><span class="op" id="4301119">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301122">s2</span>&nbsp;<span class="op" id="4301125">=</span>&nbsp;<span class="ident" id="4301127">secret</span><span class="op" id="4301133">[</span><span class="builtinfunc" id="4301134">len</span><span class="op" id="4301137">(</span><span class="ident" id="4301138">secret</span><span class="op" id="4301144">)</span><span class="op" id="4301145">/</span><span class="num" id="4301146">2</span><span class="op" id="4301147">:</span><span class="op" id="4301148">]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4301151">return</span><br>
<span class="lineno"></span><span class="op" id="4301158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4301161">//&nbsp;pHash&nbsp;implements&nbsp;the&nbsp;P_hash&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4301237">func</span>&nbsp;<span class="ident" id="4301242">pHash</span><span class="op" id="4301247">(</span><span class="ident" id="4301248">result</span><span class="op" id="4301254">,</span>&nbsp;<span class="ident" id="4301256">secret</span><span class="op" id="4301262">,</span>&nbsp;<span class="ident" id="4301264">seed</span>&nbsp;<span class="op" id="4301269">[</span><span class="op" id="4301270">]</span><span class="builtintype" id="4301271">byte</span><span class="op" id="4301275">,</span>&nbsp;<span class="ident" id="4301277">hash</span>&nbsp;<span class="keyword" id="4301282">func</span><span class="op" id="4301286">(</span><span class="op" id="4301287">)</span>&nbsp;<span class="ident" id="4301289">hash</span><span class="op" id="4301293">.</span><span class="ident" id="4301294">Hash</span><span class="op" id="4301298">)</span>&nbsp;<span class="op" id="4301300">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301303">h</span>&nbsp;<span class="op" id="4301305">:=</span>&nbsp;<span class="ident" id="4301308">hmac</span><span class="op" id="4301312">.</span><span class="ident" id="4301313">New</span><span class="op" id="4301316">(</span><span class="ident" id="4301317">hash</span><span class="op" id="4301321">,</span>&nbsp;<span class="ident" id="4301323">secret</span><span class="op" id="4301329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301332">h</span><span class="op" id="4301333">.</span><span class="ident" id="4301334">Write</span><span class="op" id="4301339">(</span><span class="ident" id="4301340">seed</span><span class="op" id="4301344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301347">a</span>&nbsp;<span class="op" id="4301349">:=</span>&nbsp;<span class="ident" id="4301352">h</span><span class="op" id="4301353">.</span><span class="ident" id="4301354">Sum</span><span class="op" id="4301357">(</span><span class="builtintype" id="4301358">nil</span><span class="op" id="4301361">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301365">j</span>&nbsp;<span class="op" id="4301367">:=</span>&nbsp;<span class="num" id="4301370">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4301373">for</span>&nbsp;<span class="ident" id="4301377">j</span>&nbsp;<span class="op" id="4301379">&lt;</span>&nbsp;<span class="builtinfunc" id="4301381">len</span><span class="op" id="4301384">(</span><span class="ident" id="4301385">result</span><span class="op" id="4301391">)</span>&nbsp;<span class="op" id="4301393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301397">h</span><span class="op" id="4301398">.</span><span class="ident" id="4301399">Reset</span><span class="op" id="4301404">(</span><span class="op" id="4301405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301409">h</span><span class="op" id="4301410">.</span><span class="ident" id="4301411">Write</span><span class="op" id="4301416">(</span><span class="ident" id="4301417">a</span><span class="op" id="4301418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301422">h</span><span class="op" id="4301423">.</span><span class="ident" id="4301424">Write</span><span class="op" id="4301429">(</span><span class="ident" id="4301430">seed</span><span class="op" id="4301434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301438">b</span>&nbsp;<span class="op" id="4301440">:=</span>&nbsp;<span class="ident" id="4301443">h</span><span class="op" id="4301444">.</span><span class="ident" id="4301445">Sum</span><span class="op" id="4301448">(</span><span class="builtintype" id="4301449">nil</span><span class="op" id="4301452">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301456">todo</span>&nbsp;<span class="op" id="4301461">:=</span>&nbsp;<span class="builtinfunc" id="4301464">len</span><span class="op" id="4301467">(</span><span class="ident" id="4301468">b</span><span class="op" id="4301469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4301473">if</span>&nbsp;<span class="ident" id="4301476">j</span><span class="op" id="4301477">+</span><span class="ident" id="4301478">todo</span>&nbsp;<span class="op" id="4301483">&gt;</span>&nbsp;<span class="builtinfunc" id="4301485">len</span><span class="op" id="4301488">(</span><span class="ident" id="4301489">result</span><span class="op" id="4301495">)</span>&nbsp;<span class="op" id="4301497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301502">todo</span>&nbsp;<span class="op" id="4301507">=</span>&nbsp;<span class="builtinfunc" id="4301509">len</span><span class="op" id="4301512">(</span><span class="ident" id="4301513">result</span><span class="op" id="4301519">)</span>&nbsp;<span class="op" id="4301521">-</span>&nbsp;<span class="ident" id="4301523">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4301527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4301531">copy</span><span class="op" id="4301535">(</span><span class="ident" id="4301536">result</span><span class="op" id="4301542">[</span><span class="ident" id="4301543">j</span><span class="op" id="4301544">:</span><span class="ident" id="4301545">j</span><span class="op" id="4301546">+</span><span class="ident" id="4301547">todo</span><span class="op" id="4301551">]</span><span class="op" id="4301552">,</span>&nbsp;<span class="ident" id="4301554">b</span><span class="op" id="4301555">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301559">j</span>&nbsp;<span class="op" id="4301561">+=</span>&nbsp;<span class="ident" id="4301564">todo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301572">h</span><span class="op" id="4301573">.</span><span class="ident" id="4301574">Reset</span><span class="op" id="4301579">(</span><span class="op" id="4301580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301584">h</span><span class="op" id="4301585">.</span><span class="ident" id="4301586">Write</span><span class="op" id="4301591">(</span><span class="ident" id="4301592">a</span><span class="op" id="4301593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301597">a</span>&nbsp;<span class="op" id="4301599">=</span>&nbsp;<span class="ident" id="4301601">h</span><span class="op" id="4301602">.</span><span class="ident" id="4301603">Sum</span><span class="op" id="4301606">(</span><span class="builtintype" id="4301607">nil</span><span class="op" id="4301610">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4301613">}</span><br>
<span class="lineno"></span><span class="op" id="4301615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4301618">//&nbsp;prf10&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4301709">func</span>&nbsp;<span class="ident" id="4301714">prf10</span><span class="op" id="4301719">(</span><span class="ident" id="4301720">result</span><span class="op" id="4301726">,</span>&nbsp;<span class="ident" id="4301728">secret</span><span class="op" id="4301734">,</span>&nbsp;<span class="ident" id="4301736">label</span><span class="op" id="4301741">,</span>&nbsp;<span class="ident" id="4301743">seed</span>&nbsp;<span class="op" id="4301748">[</span><span class="op" id="4301749">]</span><span class="builtintype" id="4301750">byte</span><span class="op" id="4301754">)</span>&nbsp;<span class="op" id="4301756">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301759">hashSHA1</span>&nbsp;<span class="op" id="4301768">:=</span>&nbsp;<span class="ident" id="4301771">sha1</span><span class="op" id="4301775">.</span><span class="ident" id="4301776">New</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301781">hashMD5</span>&nbsp;<span class="op" id="4301789">:=</span>&nbsp;<span class="ident" id="4301792">md5</span><span class="op" id="4301795">.</span><span class="ident" id="4301796">New</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301802">labelAndSeed</span>&nbsp;<span class="op" id="4301815">:=</span>&nbsp;<span class="builtinfunc" id="4301818">make</span><span class="op" id="4301822">(</span><span class="op" id="4301823">[</span><span class="op" id="4301824">]</span><span class="builtintype" id="4301825">byte</span><span class="op" id="4301829">,</span>&nbsp;<span class="builtinfunc" id="4301831">len</span><span class="op" id="4301834">(</span><span class="ident" id="4301835">label</span><span class="op" id="4301840">)</span><span class="op" id="4301841">+</span><span class="builtinfunc" id="4301842">len</span><span class="op" id="4301845">(</span><span class="ident" id="4301846">seed</span><span class="op" id="4301850">)</span><span class="op" id="4301851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4301854">copy</span><span class="op" id="4301858">(</span><span class="ident" id="4301859">labelAndSeed</span><span class="op" id="4301871">,</span>&nbsp;<span class="ident" id="4301873">label</span><span class="op" id="4301878">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4301881">copy</span><span class="op" id="4301885">(</span><span class="ident" id="4301886">labelAndSeed</span><span class="op" id="4301898">[</span><span class="builtinfunc" id="4301899">len</span><span class="op" id="4301902">(</span><span class="ident" id="4301903">label</span><span class="op" id="4301908">)</span><span class="op" id="4301909">:</span><span class="op" id="4301910">]</span><span class="op" id="4301911">,</span>&nbsp;<span class="ident" id="4301913">seed</span><span class="op" id="4301917">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301921">s1</span><span class="op" id="4301923">,</span>&nbsp;<span class="ident" id="4301925">s2</span>&nbsp;<span class="op" id="4301928">:=</span>&nbsp;<span class="ident" id="4301931">splitPreMasterSecret</span><span class="op" id="4301951">(</span><span class="ident" id="4301952">secret</span><span class="op" id="4301958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301961">pHash</span><span class="op" id="4301966">(</span><span class="ident" id="4301967">result</span><span class="op" id="4301973">,</span>&nbsp;<span class="ident" id="4301975">s1</span><span class="op" id="4301977">,</span>&nbsp;<span class="ident" id="4301979">labelAndSeed</span><span class="op" id="4301991">,</span>&nbsp;<span class="ident" id="4301993">hashMD5</span><span class="op" id="4302000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4302003">result2</span>&nbsp;<span class="op" id="4302011">:=</span>&nbsp;<span class="builtinfunc" id="4302014">make</span><span class="op" id="4302018">(</span><span class="op" id="4302019">[</span><span class="op" id="4302020">]</span><span class="builtintype" id="4302021">byte</span><span class="op" id="4302025">,</span>&nbsp;<span class="builtinfunc" id="4302027">len</span><span class="op" id="4302030">(</span><span class="ident" id="4302031">result</span><span class="op" id="4302037">)</span><span class="op" id="4302038">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4302041">pHash</span><span class="op" id="4302046">(</span><span class="ident" id="4302047">result2</span><span class="op" id="4302054">,</span>&nbsp;<span class="ident" id="4302056">s2</span><span class="op" id="4302058">,</span>&nbsp;<span class="ident" id="4302060">labelAndSeed</span><span class="op" id="4302072">,</span>&nbsp;<span class="ident" id="4302074">hashSHA1</span><span class="op" id="4302082">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4302086">for</span>&nbsp;<span class="ident" id="4302090">i</span><span class="op" id="4302091">,</span>&nbsp;<span class="ident" id="4302093">b</span>&nbsp;<span class="op" id="4302095">:=</span>&nbsp;<span class="keyword" id="4302098">range</span>&nbsp;<span class="ident" id="4302104">result2</span>&nbsp;<span class="op" id="4302112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4302116">result</span><span class="op" id="4302122">[</span><span class="ident" id="4302123">i</span><span class="op" id="4302124">]</span>&nbsp;<span class="op" id="4302126">^=</span>&nbsp;<span class="ident" id="4302129">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4302132">}</span><br>
<span class="lineno">65</span><span class="op" id="4302134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4302137">//&nbsp;prf12&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.2&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4302228">func</span>&nbsp;<span class="ident" id="4302233">prf12</span><span class="op" id="4302238">(</span><span class="ident" id="4302239">result</span><span class="op" id="4302245">,</span>&nbsp;<span class="ident" id="4302247">secret</span><span class="op" id="4302253">,</span>&nbsp;<span class="ident" id="4302255">label</span><span class="op" id="4302260">,</span>&nbsp;<span class="ident" id="4302262">seed</span>&nbsp;<span class="op" id="4302267">[</span><span class="op" id="4302268">]</span><span class="builtintype" id="4302269">byte</span><span class="op" id="4302273">)</span>&nbsp;<span class="op" id="4302275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4302278">labelAndSeed</span>&nbsp;<span class="op" id="4302291">:=</span>&nbsp;<span class="builtinfunc" id="4302294">make</span><span class="op" id="4302298">(</span><span class="op" id="4302299">[</span><span class="op" id="4302300">]</span><span class="builtintype" id="4302301">byte</span><span class="op" id="4302305">,</span>&nbsp;<span class="builtinfunc" id="4302307">len</span><span class="op" id="4302310">(</span><span class="ident" id="4302311">label</span><span class="op" id="4302316">)</span><span class="op" id="4302317">+</span><span class="builtinfunc" id="4302318">len</span><span class="op" id="4302321">(</span><span class="ident" id="4302322">seed</span><span class="op" id="4302326">)</span><span class="op" id="4302327">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4302330">copy</span><span class="op" id="4302334">(</span><span class="ident" id="4302335">labelAndSeed</span><span class="op" id="4302347">,</span>&nbsp;<span class="ident" id="4302349">label</span><span class="op" id="4302354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4302357">copy</span><span class="op" id="4302361">(</span><span class="ident" id="4302362">labelAndSeed</span><span class="op" id="4302374">[</span><span class="builtinfunc" id="4302375">len</span><span class="op" id="4302378">(</span><span class="ident" id="4302379">label</span><span class="op" id="4302384">)</span><span class="op" id="4302385">:</span><span class="op" id="4302386">]</span><span class="op" id="4302387">,</span>&nbsp;<span class="ident" id="4302389">seed</span><span class="op" id="4302393">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4302397">pHash</span><span class="op" id="4302402">(</span><span class="ident" id="4302403">result</span><span class="op" id="4302409">,</span>&nbsp;<span class="ident" id="4302411">secret</span><span class="op" id="4302417">,</span>&nbsp;<span class="ident" id="4302419">labelAndSeed</span><span class="op" id="4302431">,</span>&nbsp;<span class="ident" id="4302433">sha256</span><span class="op" id="4302439">.</span><span class="ident" id="4302440">New</span><span class="op" id="4302443">)</span><br>
<span class="lineno"></span><span class="op" id="4302445">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4302448">//&nbsp;prf30&nbsp;implements&nbsp;the&nbsp;SSL&nbsp;3.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4302518">//&nbsp;www.mozilla.org/projects/security/pki/nss/ssl/draft302.txt&nbsp;section&nbsp;6.</span><br>
<span class="lineno"></span><span class="keyword" id="4302591">func</span>&nbsp;<span class="ident" id="4302596">prf30</span><span class="op" id="4302601">(</span><span class="ident" id="4302602">result</span><span class="op" id="4302608">,</span>&nbsp;<span class="ident" id="4302610">secret</span><span class="op" id="4302616">,</span>&nbsp;<span class="ident" id="4302618">label</span><span class="op" id="4302623">,</span>&nbsp;<span class="ident" id="4302625">seed</span>&nbsp;<span class="op" id="4302630">[</span><span class="op" id="4302631">]</span><span class="builtintype" id="4302632">byte</span><span class="op" id="4302636">)</span>&nbsp;<span class="op" id="4302638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4302641">hashSHA1</span>&nbsp;<span class="op" id="4302650">:=</span>&nbsp;<span class="ident" id="4302653">sha1</span><span class="op" id="4302657">.</span><span class="ident" id="4302658">New</span><span class="op" id="4302661">(</span><span class="op" id="4302662">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4302665">hashMD5</span>&nbsp;<span class="op" id="4302673">:=</span>&nbsp;<span class="ident" id="4302676">md5</span><span class="op" id="4302679">.</span><span class="ident" id="4302680">New</span><span class="op" id="4302683">(</span><span class="op" id="4302684">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4302688">done</span>&nbsp;<span class="op" id="4302693">:=</span>&nbsp;<span class="num" id="4302696">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4302699">i</span>&nbsp;<span class="op" id="4302701">:=</span>&nbsp;<span class="num" id="4302704">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4302707">//&nbsp;RFC5246&nbsp;section&nbsp;6.3&nbsp;says&nbsp;that&nbsp;the&nbsp;largest&nbsp;PRF&nbsp;output&nbsp;needed&nbsp;is&nbsp;128</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4302778">//&nbsp;bytes.&nbsp;Since&nbsp;no&nbsp;more&nbsp;ciphersuites&nbsp;will&nbsp;be&nbsp;added&nbsp;to&nbsp;SSLv3,&nbsp;this&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4302850">//&nbsp;remain&nbsp;true.&nbsp;Each&nbsp;iteration&nbsp;gives&nbsp;us&nbsp;16&nbsp;bytes&nbsp;so&nbsp;10&nbsp;iterations&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4302922">//&nbsp;be&nbsp;sufficient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4302941">var</span>&nbsp;<span class="ident" id="4302945">b</span>&nbsp;<span class="op" id="4302947">[</span><span class="num" id="4302948">11</span><span class="op" id="4302950">]</span><span class="builtintype" id="4302951">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4302957">for</span>&nbsp;<span class="ident" id="4302961">done</span>&nbsp;<span class="op" id="4302966">&lt;</span>&nbsp;<span class="builtinfunc" id="4302968">len</span><span class="op" id="4302971">(</span><span class="ident" id="4302972">result</span><span class="op" id="4302978">)</span>&nbsp;<span class="op" id="4302980">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4302984">for</span>&nbsp;<span class="ident" id="4302988">j</span>&nbsp;<span class="op" id="4302990">:=</span>&nbsp;<span class="num" id="4302993">0</span><span class="op" id="4302994">;</span>&nbsp;<span class="ident" id="4302996">j</span>&nbsp;<span class="op" id="4302998">&lt;=</span>&nbsp;<span class="ident" id="4303001">i</span><span class="op" id="4303002">;</span>&nbsp;<span class="ident" id="4303004">j</span><span class="op" id="4303005">++</span>&nbsp;<span class="op" id="4303008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303013">b</span><span class="op" id="4303014">[</span><span class="ident" id="4303015">j</span><span class="op" id="4303016">]</span>&nbsp;<span class="op" id="4303018">=</span>&nbsp;<span class="string" id="4303020">&#39;A&#39;</span>&nbsp;<span class="op" id="4303024">+</span>&nbsp;<span class="builtintype" id="4303026">byte</span><span class="op" id="4303030">(</span><span class="ident" id="4303031">i</span><span class="op" id="4303032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4303036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303041">hashSHA1</span><span class="op" id="4303049">.</span><span class="ident" id="4303050">Reset</span><span class="op" id="4303055">(</span><span class="op" id="4303056">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303060">hashSHA1</span><span class="op" id="4303068">.</span><span class="ident" id="4303069">Write</span><span class="op" id="4303074">(</span><span class="ident" id="4303075">b</span><span class="op" id="4303076">[</span><span class="op" id="4303077">:</span><span class="ident" id="4303078">i</span><span class="op" id="4303079">+</span><span class="num" id="4303080">1</span><span class="op" id="4303081">]</span><span class="op" id="4303082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303086">hashSHA1</span><span class="op" id="4303094">.</span><span class="ident" id="4303095">Write</span><span class="op" id="4303100">(</span><span class="ident" id="4303101">secret</span><span class="op" id="4303107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303111">hashSHA1</span><span class="op" id="4303119">.</span><span class="ident" id="4303120">Write</span><span class="op" id="4303125">(</span><span class="ident" id="4303126">seed</span><span class="op" id="4303130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303134">digest</span>&nbsp;<span class="op" id="4303141">:=</span>&nbsp;<span class="ident" id="4303144">hashSHA1</span><span class="op" id="4303152">.</span><span class="ident" id="4303153">Sum</span><span class="op" id="4303156">(</span><span class="builtintype" id="4303157">nil</span><span class="op" id="4303160">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303165">hashMD5</span><span class="op" id="4303172">.</span><span class="ident" id="4303173">Reset</span><span class="op" id="4303178">(</span><span class="op" id="4303179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303183">hashMD5</span><span class="op" id="4303190">.</span><span class="ident" id="4303191">Write</span><span class="op" id="4303196">(</span><span class="ident" id="4303197">secret</span><span class="op" id="4303203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303207">hashMD5</span><span class="op" id="4303214">.</span><span class="ident" id="4303215">Write</span><span class="op" id="4303220">(</span><span class="ident" id="4303221">digest</span><span class="op" id="4303227">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303232">done</span>&nbsp;<span class="op" id="4303237">+=</span>&nbsp;<span class="builtinfunc" id="4303240">copy</span><span class="op" id="4303244">(</span><span class="ident" id="4303245">result</span><span class="op" id="4303251">[</span><span class="ident" id="4303252">done</span><span class="op" id="4303256">:</span><span class="op" id="4303257">]</span><span class="op" id="4303258">,</span>&nbsp;<span class="ident" id="4303260">hashMD5</span><span class="op" id="4303267">.</span><span class="ident" id="4303268">Sum</span><span class="op" id="4303271">(</span><span class="builtintype" id="4303272">nil</span><span class="op" id="4303275">)</span><span class="op" id="4303276">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303280">i</span><span class="op" id="4303281">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4303285">}</span><br>
<span class="lineno"></span><span class="op" id="4303287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4303290">const</span>&nbsp;<span class="op" id="4303296">(</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303299">tlsRandomLength</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4303320">=</span>&nbsp;<span class="num" id="4303322">32</span>&nbsp;<span class="comment" id="4303325">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;random&nbsp;nonce&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303366">masterSecretLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4303387">=</span>&nbsp;<span class="num" id="4303389">48</span>&nbsp;<span class="comment" id="4303392">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;master&nbsp;secret&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303434">finishedVerifyLength</span>&nbsp;<span class="op" id="4303455">=</span>&nbsp;<span class="num" id="4303457">12</span>&nbsp;<span class="comment" id="4303460">//&nbsp;Length&nbsp;of&nbsp;verify_data&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="op" id="4303508">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="4303511">var</span>&nbsp;<span class="ident" id="4303515">masterSecretLabel</span>&nbsp;<span class="op" id="4303533">=</span>&nbsp;<span class="op" id="4303535">[</span><span class="op" id="4303536">]</span><span class="builtintype" id="4303537">byte</span><span class="op" id="4303541">(</span><span class="string" id="4303542">&#34;master&nbsp;secret&#34;</span><span class="op" id="4303557">)</span><br>
<span class="lineno"></span><span class="keyword" id="4303559">var</span>&nbsp;<span class="ident" id="4303563">keyExpansionLabel</span>&nbsp;<span class="op" id="4303581">=</span>&nbsp;<span class="op" id="4303583">[</span><span class="op" id="4303584">]</span><span class="builtintype" id="4303585">byte</span><span class="op" id="4303589">(</span><span class="string" id="4303590">&#34;key&nbsp;expansion&#34;</span><span class="op" id="4303605">)</span><br>
<span class="lineno"></span><span class="keyword" id="4303607">var</span>&nbsp;<span class="ident" id="4303611">clientFinishedLabel</span>&nbsp;<span class="op" id="4303631">=</span>&nbsp;<span class="op" id="4303633">[</span><span class="op" id="4303634">]</span><span class="builtintype" id="4303635">byte</span><span class="op" id="4303639">(</span><span class="string" id="4303640">&#34;client&nbsp;finished&#34;</span><span class="op" id="4303657">)</span><br>
<span class="lineno"></span><span class="keyword" id="4303659">var</span>&nbsp;<span class="ident" id="4303663">serverFinishedLabel</span>&nbsp;<span class="op" id="4303683">=</span>&nbsp;<span class="op" id="4303685">[</span><span class="op" id="4303686">]</span><span class="builtintype" id="4303687">byte</span><span class="op" id="4303691">(</span><span class="string" id="4303692">&#34;server&nbsp;finished&#34;</span><span class="op" id="4303709">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="4303712">func</span>&nbsp;<span class="ident" id="4303717">prfForVersion</span><span class="op" id="4303730">(</span><span class="ident" id="4303731">version</span>&nbsp;<span class="builtintype" id="4303739">uint16</span><span class="op" id="4303745">)</span>&nbsp;<span class="keyword" id="4303747">func</span><span class="op" id="4303751">(</span><span class="ident" id="4303752">result</span><span class="op" id="4303758">,</span>&nbsp;<span class="ident" id="4303760">secret</span><span class="op" id="4303766">,</span>&nbsp;<span class="ident" id="4303768">label</span><span class="op" id="4303773">,</span>&nbsp;<span class="ident" id="4303775">seed</span>&nbsp;<span class="op" id="4303780">[</span><span class="op" id="4303781">]</span><span class="builtintype" id="4303782">byte</span><span class="op" id="4303786">)</span>&nbsp;<span class="op" id="4303788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4303791">switch</span>&nbsp;<span class="ident" id="4303798">version</span>&nbsp;<span class="op" id="4303806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4303809">case</span>&nbsp;<span class="ident" id="4303814">VersionSSL30</span><span class="op" id="4303826">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4303830">return</span>&nbsp;<span class="ident" id="4303837">prf30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4303844">case</span>&nbsp;<span class="ident" id="4303849">VersionTLS10</span><span class="op" id="4303861">,</span>&nbsp;<span class="ident" id="4303863">VersionTLS11</span><span class="op" id="4303875">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4303879">return</span>&nbsp;<span class="ident" id="4303886">prf10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4303893">case</span>&nbsp;<span class="ident" id="4303898">VersionTLS12</span><span class="op" id="4303910">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4303914">return</span>&nbsp;<span class="ident" id="4303921">prf12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4303928">default</span><span class="op" id="4303935">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4303939">panic</span><span class="op" id="4303944">(</span><span class="string" id="4303945">&#34;unknown&nbsp;version&#34;</span><span class="op" id="4303962">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4303965">}</span><br>
<span class="lineno"></span><span class="op" id="4303967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4303970">//&nbsp;masterFromPreMasterSecret&nbsp;generates&nbsp;the&nbsp;master&nbsp;secret&nbsp;from&nbsp;the&nbsp;pre-master</span><br>
<span class="lineno"></span><span class="comment" id="4304047">//&nbsp;secret.&nbsp;See&nbsp;http://tools.ietf.org/html/rfc5246#section-8.1</span><br>
<span class="lineno">135</span><span class="keyword" id="4304109">func</span>&nbsp;<span class="ident" id="4304114">masterFromPreMasterSecret</span><span class="op" id="4304139">(</span><span class="ident" id="4304140">version</span>&nbsp;<span class="builtintype" id="4304148">uint16</span><span class="op" id="4304154">,</span>&nbsp;<span class="ident" id="4304156">preMasterSecret</span><span class="op" id="4304171">,</span>&nbsp;<span class="ident" id="4304173">clientRandom</span><span class="op" id="4304185">,</span>&nbsp;<span class="ident" id="4304187">serverRandom</span>&nbsp;<span class="op" id="4304200">[</span><span class="op" id="4304201">]</span><span class="builtintype" id="4304202">byte</span><span class="op" id="4304206">)</span>&nbsp;<span class="op" id="4304208">[</span><span class="op" id="4304209">]</span><span class="builtintype" id="4304210">byte</span>&nbsp;<span class="op" id="4304215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4304218">var</span>&nbsp;<span class="ident" id="4304222">seed</span>&nbsp;<span class="op" id="4304227">[</span><span class="ident" id="4304228">tlsRandomLength</span>&nbsp;<span class="op" id="4304244">*</span>&nbsp;<span class="num" id="4304246">2</span><span class="op" id="4304247">]</span><span class="builtintype" id="4304248">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4304254">copy</span><span class="op" id="4304258">(</span><span class="ident" id="4304259">seed</span><span class="op" id="4304263">[</span><span class="num" id="4304264">0</span><span class="op" id="4304265">:</span><span class="builtinfunc" id="4304266">len</span><span class="op" id="4304269">(</span><span class="ident" id="4304270">clientRandom</span><span class="op" id="4304282">)</span><span class="op" id="4304283">]</span><span class="op" id="4304284">,</span>&nbsp;<span class="ident" id="4304286">clientRandom</span><span class="op" id="4304298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4304301">copy</span><span class="op" id="4304305">(</span><span class="ident" id="4304306">seed</span><span class="op" id="4304310">[</span><span class="builtinfunc" id="4304311">len</span><span class="op" id="4304314">(</span><span class="ident" id="4304315">clientRandom</span><span class="op" id="4304327">)</span><span class="op" id="4304328">:</span><span class="op" id="4304329">]</span><span class="op" id="4304330">,</span>&nbsp;<span class="ident" id="4304332">serverRandom</span><span class="op" id="4304344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4304347">masterSecret</span>&nbsp;<span class="op" id="4304360">:=</span>&nbsp;<span class="builtinfunc" id="4304363">make</span><span class="op" id="4304367">(</span><span class="op" id="4304368">[</span><span class="op" id="4304369">]</span><span class="builtintype" id="4304370">byte</span><span class="op" id="4304374">,</span>&nbsp;<span class="ident" id="4304376">masterSecretLength</span><span class="op" id="4304394">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4304397">prfForVersion</span><span class="op" id="4304410">(</span><span class="ident" id="4304411">version</span><span class="op" id="4304418">)</span><span class="op" id="4304419">(</span><span class="ident" id="4304420">masterSecret</span><span class="op" id="4304432">,</span>&nbsp;<span class="ident" id="4304434">preMasterSecret</span><span class="op" id="4304449">,</span>&nbsp;<span class="ident" id="4304451">masterSecretLabel</span><span class="op" id="4304468">,</span>&nbsp;<span class="ident" id="4304470">seed</span><span class="op" id="4304474">[</span><span class="num" id="4304475">0</span><span class="op" id="4304476">:</span><span class="op" id="4304477">]</span><span class="op" id="4304478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4304481">return</span>&nbsp;<span class="ident" id="4304488">masterSecret</span><br>
<span class="lineno"></span><span class="op" id="4304501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4304504">//&nbsp;keysFromMasterSecret&nbsp;generates&nbsp;the&nbsp;connection&nbsp;keys&nbsp;from&nbsp;the&nbsp;master</span><br>
<span class="lineno">145</span><span class="comment" id="4304574">//&nbsp;secret,&nbsp;given&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MAC&nbsp;key,&nbsp;cipher&nbsp;key&nbsp;and&nbsp;IV,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4304652">//&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;6.3.</span><br>
<span class="lineno"></span><span class="keyword" id="4304678">func</span>&nbsp;<span class="ident" id="4304683">keysFromMasterSecret</span><span class="op" id="4304703">(</span><span class="ident" id="4304704">version</span>&nbsp;<span class="builtintype" id="4304712">uint16</span><span class="op" id="4304718">,</span>&nbsp;<span class="ident" id="4304720">masterSecret</span><span class="op" id="4304732">,</span>&nbsp;<span class="ident" id="4304734">clientRandom</span><span class="op" id="4304746">,</span>&nbsp;<span class="ident" id="4304748">serverRandom</span>&nbsp;<span class="op" id="4304761">[</span><span class="op" id="4304762">]</span><span class="builtintype" id="4304763">byte</span><span class="op" id="4304767">,</span>&nbsp;<span class="ident" id="4304769">macLen</span><span class="op" id="4304775">,</span>&nbsp;<span class="ident" id="4304777">keyLen</span><span class="op" id="4304783">,</span>&nbsp;<span class="ident" id="4304785">ivLen</span>&nbsp;<span class="builtintype" id="4304791">int</span><span class="op" id="4304794">)</span>&nbsp;<span class="op" id="4304796">(</span><span class="ident" id="4304797">clientMAC</span><span class="op" id="4304806">,</span>&nbsp;<span class="ident" id="4304808">serverMAC</span><span class="op" id="4304817">,</span>&nbsp;<span class="ident" id="4304819">clientKey</span><span class="op" id="4304828">,</span>&nbsp;<span class="ident" id="4304830">serverKey</span><span class="op" id="4304839">,</span>&nbsp;<span class="ident" id="4304841">clientIV</span><span class="op" id="4304849">,</span>&nbsp;<span class="ident" id="4304851">serverIV</span>&nbsp;<span class="op" id="4304860">[</span><span class="op" id="4304861">]</span><span class="builtintype" id="4304862">byte</span><span class="op" id="4304866">)</span>&nbsp;<span class="op" id="4304868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4304871">var</span>&nbsp;<span class="ident" id="4304875">seed</span>&nbsp;<span class="op" id="4304880">[</span><span class="ident" id="4304881">tlsRandomLength</span>&nbsp;<span class="op" id="4304897">*</span>&nbsp;<span class="num" id="4304899">2</span><span class="op" id="4304900">]</span><span class="builtintype" id="4304901">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4304907">copy</span><span class="op" id="4304911">(</span><span class="ident" id="4304912">seed</span><span class="op" id="4304916">[</span><span class="num" id="4304917">0</span><span class="op" id="4304918">:</span><span class="builtinfunc" id="4304919">len</span><span class="op" id="4304922">(</span><span class="ident" id="4304923">clientRandom</span><span class="op" id="4304935">)</span><span class="op" id="4304936">]</span><span class="op" id="4304937">,</span>&nbsp;<span class="ident" id="4304939">serverRandom</span><span class="op" id="4304951">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4304954">copy</span><span class="op" id="4304958">(</span><span class="ident" id="4304959">seed</span><span class="op" id="4304963">[</span><span class="builtinfunc" id="4304964">len</span><span class="op" id="4304967">(</span><span class="ident" id="4304968">serverRandom</span><span class="op" id="4304980">)</span><span class="op" id="4304981">:</span><span class="op" id="4304982">]</span><span class="op" id="4304983">,</span>&nbsp;<span class="ident" id="4304985">clientRandom</span><span class="op" id="4304997">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305001">n</span>&nbsp;<span class="op" id="4305003">:=</span>&nbsp;<span class="num" id="4305006">2</span><span class="op" id="4305007">*</span><span class="ident" id="4305008">macLen</span>&nbsp;<span class="op" id="4305015">+</span>&nbsp;<span class="num" id="4305017">2</span><span class="op" id="4305018">*</span><span class="ident" id="4305019">keyLen</span>&nbsp;<span class="op" id="4305026">+</span>&nbsp;<span class="num" id="4305028">2</span><span class="op" id="4305029">*</span><span class="ident" id="4305030">ivLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305037">keyMaterial</span>&nbsp;<span class="op" id="4305049">:=</span>&nbsp;<span class="builtinfunc" id="4305052">make</span><span class="op" id="4305056">(</span><span class="op" id="4305057">[</span><span class="op" id="4305058">]</span><span class="builtintype" id="4305059">byte</span><span class="op" id="4305063">,</span>&nbsp;<span class="ident" id="4305065">n</span><span class="op" id="4305066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305069">prfForVersion</span><span class="op" id="4305082">(</span><span class="ident" id="4305083">version</span><span class="op" id="4305090">)</span><span class="op" id="4305091">(</span><span class="ident" id="4305092">keyMaterial</span><span class="op" id="4305103">,</span>&nbsp;<span class="ident" id="4305105">masterSecret</span><span class="op" id="4305117">,</span>&nbsp;<span class="ident" id="4305119">keyExpansionLabel</span><span class="op" id="4305136">,</span>&nbsp;<span class="ident" id="4305138">seed</span><span class="op" id="4305142">[</span><span class="num" id="4305143">0</span><span class="op" id="4305144">:</span><span class="op" id="4305145">]</span><span class="op" id="4305146">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305149">clientMAC</span>&nbsp;<span class="op" id="4305159">=</span>&nbsp;<span class="ident" id="4305161">keyMaterial</span><span class="op" id="4305172">[</span><span class="op" id="4305173">:</span><span class="ident" id="4305174">macLen</span><span class="op" id="4305180">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305183">keyMaterial</span>&nbsp;<span class="op" id="4305195">=</span>&nbsp;<span class="ident" id="4305197">keyMaterial</span><span class="op" id="4305208">[</span><span class="ident" id="4305209">macLen</span><span class="op" id="4305215">:</span><span class="op" id="4305216">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305219">serverMAC</span>&nbsp;<span class="op" id="4305229">=</span>&nbsp;<span class="ident" id="4305231">keyMaterial</span><span class="op" id="4305242">[</span><span class="op" id="4305243">:</span><span class="ident" id="4305244">macLen</span><span class="op" id="4305250">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305253">keyMaterial</span>&nbsp;<span class="op" id="4305265">=</span>&nbsp;<span class="ident" id="4305267">keyMaterial</span><span class="op" id="4305278">[</span><span class="ident" id="4305279">macLen</span><span class="op" id="4305285">:</span><span class="op" id="4305286">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305289">clientKey</span>&nbsp;<span class="op" id="4305299">=</span>&nbsp;<span class="ident" id="4305301">keyMaterial</span><span class="op" id="4305312">[</span><span class="op" id="4305313">:</span><span class="ident" id="4305314">keyLen</span><span class="op" id="4305320">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305323">keyMaterial</span>&nbsp;<span class="op" id="4305335">=</span>&nbsp;<span class="ident" id="4305337">keyMaterial</span><span class="op" id="4305348">[</span><span class="ident" id="4305349">keyLen</span><span class="op" id="4305355">:</span><span class="op" id="4305356">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305359">serverKey</span>&nbsp;<span class="op" id="4305369">=</span>&nbsp;<span class="ident" id="4305371">keyMaterial</span><span class="op" id="4305382">[</span><span class="op" id="4305383">:</span><span class="ident" id="4305384">keyLen</span><span class="op" id="4305390">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305393">keyMaterial</span>&nbsp;<span class="op" id="4305405">=</span>&nbsp;<span class="ident" id="4305407">keyMaterial</span><span class="op" id="4305418">[</span><span class="ident" id="4305419">keyLen</span><span class="op" id="4305425">:</span><span class="op" id="4305426">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305429">clientIV</span>&nbsp;<span class="op" id="4305438">=</span>&nbsp;<span class="ident" id="4305440">keyMaterial</span><span class="op" id="4305451">[</span><span class="op" id="4305452">:</span><span class="ident" id="4305453">ivLen</span><span class="op" id="4305458">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305461">keyMaterial</span>&nbsp;<span class="op" id="4305473">=</span>&nbsp;<span class="ident" id="4305475">keyMaterial</span><span class="op" id="4305486">[</span><span class="ident" id="4305487">ivLen</span><span class="op" id="4305492">:</span><span class="op" id="4305493">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305496">serverIV</span>&nbsp;<span class="op" id="4305505">=</span>&nbsp;<span class="ident" id="4305507">keyMaterial</span><span class="op" id="4305518">[</span><span class="op" id="4305519">:</span><span class="ident" id="4305520">ivLen</span><span class="op" id="4305525">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4305528">return</span><br>
<span class="lineno"></span><span class="op" id="4305535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4305538">func</span>&nbsp;<span class="ident" id="4305543">newFinishedHash</span><span class="op" id="4305558">(</span><span class="ident" id="4305559">version</span>&nbsp;<span class="builtintype" id="4305567">uint16</span><span class="op" id="4305573">)</span>&nbsp;<span class="ident" id="4305575">finishedHash</span>&nbsp;<span class="op" id="4305588">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4305591">if</span>&nbsp;<span class="ident" id="4305594">version</span>&nbsp;<span class="op" id="4305602">&gt;=</span>&nbsp;<span class="ident" id="4305605">VersionTLS12</span>&nbsp;<span class="op" id="4305618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4305622">return</span>&nbsp;<span class="ident" id="4305629">finishedHash</span><span class="op" id="4305641">{</span><span class="ident" id="4305642">sha256</span><span class="op" id="4305648">.</span><span class="ident" id="4305649">New</span><span class="op" id="4305652">(</span><span class="op" id="4305653">)</span><span class="op" id="4305654">,</span>&nbsp;<span class="ident" id="4305656">sha256</span><span class="op" id="4305662">.</span><span class="ident" id="4305663">New</span><span class="op" id="4305666">(</span><span class="op" id="4305667">)</span><span class="op" id="4305668">,</span>&nbsp;<span class="builtintype" id="4305670">nil</span><span class="op" id="4305673">,</span>&nbsp;<span class="builtintype" id="4305675">nil</span><span class="op" id="4305678">,</span>&nbsp;<span class="ident" id="4305680">version</span><span class="op" id="4305687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4305690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4305693">return</span>&nbsp;<span class="ident" id="4305700">finishedHash</span><span class="op" id="4305712">{</span><span class="ident" id="4305713">sha1</span><span class="op" id="4305717">.</span><span class="ident" id="4305718">New</span><span class="op" id="4305721">(</span><span class="op" id="4305722">)</span><span class="op" id="4305723">,</span>&nbsp;<span class="ident" id="4305725">sha1</span><span class="op" id="4305729">.</span><span class="ident" id="4305730">New</span><span class="op" id="4305733">(</span><span class="op" id="4305734">)</span><span class="op" id="4305735">,</span>&nbsp;<span class="ident" id="4305737">md5</span><span class="op" id="4305740">.</span><span class="ident" id="4305741">New</span><span class="op" id="4305744">(</span><span class="op" id="4305745">)</span><span class="op" id="4305746">,</span>&nbsp;<span class="ident" id="4305748">md5</span><span class="op" id="4305751">.</span><span class="ident" id="4305752">New</span><span class="op" id="4305755">(</span><span class="op" id="4305756">)</span><span class="op" id="4305757">,</span>&nbsp;<span class="ident" id="4305759">version</span><span class="op" id="4305766">}</span><br>
<span class="lineno"></span><span class="op" id="4305768">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4305771">//&nbsp;A&nbsp;finishedHash&nbsp;calculates&nbsp;the&nbsp;hash&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake&nbsp;messages&nbsp;suitable</span><br>
<span class="lineno"></span><span class="comment" id="4305849">//&nbsp;for&nbsp;including&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4305889">type</span>&nbsp;<span class="ident" id="4305894">finishedHash</span>&nbsp;<span class="keyword" id="4305907">struct</span>&nbsp;<span class="op" id="4305914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305917">client</span>&nbsp;<span class="ident" id="4305924">hash</span><span class="op" id="4305928">.</span><span class="ident" id="4305929">Hash</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305935">server</span>&nbsp;<span class="ident" id="4305942">hash</span><span class="op" id="4305946">.</span><span class="ident" id="4305947">Hash</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4305954">//&nbsp;Prior&nbsp;to&nbsp;TLS&nbsp;1.2,&nbsp;an&nbsp;additional&nbsp;MD5&nbsp;hash&nbsp;is&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306012">clientMD5</span>&nbsp;<span class="ident" id="4306022">hash</span><span class="op" id="4306026">.</span><span class="ident" id="4306027">Hash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306033">serverMD5</span>&nbsp;<span class="ident" id="4306043">hash</span><span class="op" id="4306047">.</span><span class="ident" id="4306048">Hash</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306055">version</span>&nbsp;<span class="builtintype" id="4306063">uint16</span><br>
<span class="lineno"></span><span class="op" id="4306070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4306073">func</span>&nbsp;<span class="op" id="4306078">(</span><span class="ident" id="4306079">h</span>&nbsp;<span class="ident" id="4306081">finishedHash</span><span class="op" id="4306093">)</span>&nbsp;<span class="ident" id="4306095">Write</span><span class="op" id="4306100">(</span><span class="ident" id="4306101">msg</span>&nbsp;<span class="op" id="4306105">[</span><span class="op" id="4306106">]</span><span class="builtintype" id="4306107">byte</span><span class="op" id="4306111">)</span>&nbsp;<span class="op" id="4306113">(</span><span class="ident" id="4306114">n</span>&nbsp;<span class="builtintype" id="4306116">int</span><span class="op" id="4306119">,</span>&nbsp;<span class="ident" id="4306121">err</span>&nbsp;<span class="builtintype" id="4306125">error</span><span class="op" id="4306130">)</span>&nbsp;<span class="op" id="4306132">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306135">h</span><span class="op" id="4306136">.</span><span class="ident" id="4306137">client</span><span class="op" id="4306143">.</span><span class="ident" id="4306144">Write</span><span class="op" id="4306149">(</span><span class="ident" id="4306150">msg</span><span class="op" id="4306153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306156">h</span><span class="op" id="4306157">.</span><span class="ident" id="4306158">server</span><span class="op" id="4306164">.</span><span class="ident" id="4306165">Write</span><span class="op" id="4306170">(</span><span class="ident" id="4306171">msg</span><span class="op" id="4306174">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4306178">if</span>&nbsp;<span class="ident" id="4306181">h</span><span class="op" id="4306182">.</span><span class="ident" id="4306183">version</span>&nbsp;<span class="op" id="4306191">&lt;</span>&nbsp;<span class="ident" id="4306193">VersionTLS12</span>&nbsp;<span class="op" id="4306206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306210">h</span><span class="op" id="4306211">.</span><span class="ident" id="4306212">clientMD5</span><span class="op" id="4306221">.</span><span class="ident" id="4306222">Write</span><span class="op" id="4306227">(</span><span class="ident" id="4306228">msg</span><span class="op" id="4306231">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306235">h</span><span class="op" id="4306236">.</span><span class="ident" id="4306237">serverMD5</span><span class="op" id="4306246">.</span><span class="ident" id="4306247">Write</span><span class="op" id="4306252">(</span><span class="ident" id="4306253">msg</span><span class="op" id="4306256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4306259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4306262">return</span>&nbsp;<span class="builtinfunc" id="4306269">len</span><span class="op" id="4306272">(</span><span class="ident" id="4306273">msg</span><span class="op" id="4306276">)</span><span class="op" id="4306277">,</span>&nbsp;<span class="builtintype" id="4306279">nil</span><br>
<span class="lineno"></span><span class="op" id="4306283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="4306286">//&nbsp;finishedSum30&nbsp;calculates&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;SSLv3</span><br>
<span class="lineno"></span><span class="comment" id="4306364">//&nbsp;Finished&nbsp;message&nbsp;given&nbsp;the&nbsp;MD5&nbsp;and&nbsp;SHA1&nbsp;hashes&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake</span><br>
<span class="lineno"></span><span class="comment" id="4306436">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="4306449">func</span>&nbsp;<span class="ident" id="4306454">finishedSum30</span><span class="op" id="4306467">(</span><span class="ident" id="4306468">md5</span><span class="op" id="4306471">,</span>&nbsp;<span class="ident" id="4306473">sha1</span>&nbsp;<span class="ident" id="4306478">hash</span><span class="op" id="4306482">.</span><span class="ident" id="4306483">Hash</span><span class="op" id="4306487">,</span>&nbsp;<span class="ident" id="4306489">masterSecret</span>&nbsp;<span class="op" id="4306502">[</span><span class="op" id="4306503">]</span><span class="builtintype" id="4306504">byte</span><span class="op" id="4306508">,</span>&nbsp;<span class="ident" id="4306510">magic</span>&nbsp;<span class="op" id="4306516">[</span><span class="num" id="4306517">4</span><span class="op" id="4306518">]</span><span class="builtintype" id="4306519">byte</span><span class="op" id="4306523">)</span>&nbsp;<span class="op" id="4306525">[</span><span class="op" id="4306526">]</span><span class="builtintype" id="4306527">byte</span>&nbsp;<span class="op" id="4306532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306535">md5</span><span class="op" id="4306538">.</span><span class="ident" id="4306539">Write</span><span class="op" id="4306544">(</span><span class="ident" id="4306545">magic</span><span class="op" id="4306550">[</span><span class="op" id="4306551">:</span><span class="op" id="4306552">]</span><span class="op" id="4306553">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306556">md5</span><span class="op" id="4306559">.</span><span class="ident" id="4306560">Write</span><span class="op" id="4306565">(</span><span class="ident" id="4306566">masterSecret</span><span class="op" id="4306578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306581">md5</span><span class="op" id="4306584">.</span><span class="ident" id="4306585">Write</span><span class="op" id="4306590">(</span><span class="ident" id="4306591">ssl30Pad1</span><span class="op" id="4306600">[</span><span class="op" id="4306601">:</span><span class="op" id="4306602">]</span><span class="op" id="4306603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306606">md5Digest</span>&nbsp;<span class="op" id="4306616">:=</span>&nbsp;<span class="ident" id="4306619">md5</span><span class="op" id="4306622">.</span><span class="ident" id="4306623">Sum</span><span class="op" id="4306626">(</span><span class="builtintype" id="4306627">nil</span><span class="op" id="4306630">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306634">md5</span><span class="op" id="4306637">.</span><span class="ident" id="4306638">Reset</span><span class="op" id="4306643">(</span><span class="op" id="4306644">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306647">md5</span><span class="op" id="4306650">.</span><span class="ident" id="4306651">Write</span><span class="op" id="4306656">(</span><span class="ident" id="4306657">masterSecret</span><span class="op" id="4306669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306672">md5</span><span class="op" id="4306675">.</span><span class="ident" id="4306676">Write</span><span class="op" id="4306681">(</span><span class="ident" id="4306682">ssl30Pad2</span><span class="op" id="4306691">[</span><span class="op" id="4306692">:</span><span class="op" id="4306693">]</span><span class="op" id="4306694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306697">md5</span><span class="op" id="4306700">.</span><span class="ident" id="4306701">Write</span><span class="op" id="4306706">(</span><span class="ident" id="4306707">md5Digest</span><span class="op" id="4306716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306719">md5Digest</span>&nbsp;<span class="op" id="4306729">=</span>&nbsp;<span class="ident" id="4306731">md5</span><span class="op" id="4306734">.</span><span class="ident" id="4306735">Sum</span><span class="op" id="4306738">(</span><span class="builtintype" id="4306739">nil</span><span class="op" id="4306742">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306746">sha1</span><span class="op" id="4306750">.</span><span class="ident" id="4306751">Write</span><span class="op" id="4306756">(</span><span class="ident" id="4306757">magic</span><span class="op" id="4306762">[</span><span class="op" id="4306763">:</span><span class="op" id="4306764">]</span><span class="op" id="4306765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306768">sha1</span><span class="op" id="4306772">.</span><span class="ident" id="4306773">Write</span><span class="op" id="4306778">(</span><span class="ident" id="4306779">masterSecret</span><span class="op" id="4306791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306794">sha1</span><span class="op" id="4306798">.</span><span class="ident" id="4306799">Write</span><span class="op" id="4306804">(</span><span class="ident" id="4306805">ssl30Pad1</span><span class="op" id="4306814">[</span><span class="op" id="4306815">:</span><span class="num" id="4306816">40</span><span class="op" id="4306818">]</span><span class="op" id="4306819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306822">sha1Digest</span>&nbsp;<span class="op" id="4306833">:=</span>&nbsp;<span class="ident" id="4306836">sha1</span><span class="op" id="4306840">.</span><span class="ident" id="4306841">Sum</span><span class="op" id="4306844">(</span><span class="builtintype" id="4306845">nil</span><span class="op" id="4306848">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306852">sha1</span><span class="op" id="4306856">.</span><span class="ident" id="4306857">Reset</span><span class="op" id="4306862">(</span><span class="op" id="4306863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306866">sha1</span><span class="op" id="4306870">.</span><span class="ident" id="4306871">Write</span><span class="op" id="4306876">(</span><span class="ident" id="4306877">masterSecret</span><span class="op" id="4306889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306892">sha1</span><span class="op" id="4306896">.</span><span class="ident" id="4306897">Write</span><span class="op" id="4306902">(</span><span class="ident" id="4306903">ssl30Pad2</span><span class="op" id="4306912">[</span><span class="op" id="4306913">:</span><span class="num" id="4306914">40</span><span class="op" id="4306916">]</span><span class="op" id="4306917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306920">sha1</span><span class="op" id="4306924">.</span><span class="ident" id="4306925">Write</span><span class="op" id="4306930">(</span><span class="ident" id="4306931">sha1Digest</span><span class="op" id="4306941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306944">sha1Digest</span>&nbsp;<span class="op" id="4306955">=</span>&nbsp;<span class="ident" id="4306957">sha1</span><span class="op" id="4306961">.</span><span class="ident" id="4306962">Sum</span><span class="op" id="4306965">(</span><span class="builtintype" id="4306966">nil</span><span class="op" id="4306969">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306973">ret</span>&nbsp;<span class="op" id="4306977">:=</span>&nbsp;<span class="builtinfunc" id="4306980">make</span><span class="op" id="4306984">(</span><span class="op" id="4306985">[</span><span class="op" id="4306986">]</span><span class="builtintype" id="4306987">byte</span><span class="op" id="4306991">,</span>&nbsp;<span class="builtinfunc" id="4306993">len</span><span class="op" id="4306996">(</span><span class="ident" id="4306997">md5Digest</span><span class="op" id="4307006">)</span><span class="op" id="4307007">+</span><span class="builtinfunc" id="4307008">len</span><span class="op" id="4307011">(</span><span class="ident" id="4307012">sha1Digest</span><span class="op" id="4307022">)</span><span class="op" id="4307023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4307026">copy</span><span class="op" id="4307030">(</span><span class="ident" id="4307031">ret</span><span class="op" id="4307034">,</span>&nbsp;<span class="ident" id="4307036">md5Digest</span><span class="op" id="4307045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4307048">copy</span><span class="op" id="4307052">(</span><span class="ident" id="4307053">ret</span><span class="op" id="4307056">[</span><span class="builtinfunc" id="4307057">len</span><span class="op" id="4307060">(</span><span class="ident" id="4307061">md5Digest</span><span class="op" id="4307070">)</span><span class="op" id="4307071">:</span><span class="op" id="4307072">]</span><span class="op" id="4307073">,</span>&nbsp;<span class="ident" id="4307075">sha1Digest</span><span class="op" id="4307085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4307088">return</span>&nbsp;<span class="ident" id="4307095">ret</span><br>
<span class="lineno">230</span><span class="op" id="4307099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4307102">var</span>&nbsp;<span class="ident" id="4307106">ssl3ClientFinishedMagic</span>&nbsp;<span class="op" id="4307130">=</span>&nbsp;<span class="op" id="4307132">[</span><span class="num" id="4307133">4</span><span class="op" id="4307134">]</span><span class="builtintype" id="4307135">byte</span><span class="op" id="4307139">{</span><span class="num" id="4307140">0x43</span><span class="op" id="4307144">,</span>&nbsp;<span class="num" id="4307146">0x4c</span><span class="op" id="4307150">,</span>&nbsp;<span class="num" id="4307152">0x4e</span><span class="op" id="4307156">,</span>&nbsp;<span class="num" id="4307158">0x54</span><span class="op" id="4307162">}</span><br>
<span class="lineno"></span><span class="keyword" id="4307164">var</span>&nbsp;<span class="ident" id="4307168">ssl3ServerFinishedMagic</span>&nbsp;<span class="op" id="4307192">=</span>&nbsp;<span class="op" id="4307194">[</span><span class="num" id="4307195">4</span><span class="op" id="4307196">]</span><span class="builtintype" id="4307197">byte</span><span class="op" id="4307201">{</span><span class="num" id="4307202">0x53</span><span class="op" id="4307206">,</span>&nbsp;<span class="num" id="4307208">0x52</span><span class="op" id="4307212">,</span>&nbsp;<span class="num" id="4307214">0x56</span><span class="op" id="4307218">,</span>&nbsp;<span class="num" id="4307220">0x52</span><span class="op" id="4307224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="4307227">//&nbsp;clientSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;client&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4307301">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4307322">func</span>&nbsp;<span class="op" id="4307327">(</span><span class="ident" id="4307328">h</span>&nbsp;<span class="ident" id="4307330">finishedHash</span><span class="op" id="4307342">)</span>&nbsp;<span class="ident" id="4307344">clientSum</span><span class="op" id="4307353">(</span><span class="ident" id="4307354">masterSecret</span>&nbsp;<span class="op" id="4307367">[</span><span class="op" id="4307368">]</span><span class="builtintype" id="4307369">byte</span><span class="op" id="4307373">)</span>&nbsp;<span class="op" id="4307375">[</span><span class="op" id="4307376">]</span><span class="builtintype" id="4307377">byte</span>&nbsp;<span class="op" id="4307382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4307385">if</span>&nbsp;<span class="ident" id="4307388">h</span><span class="op" id="4307389">.</span><span class="ident" id="4307390">version</span>&nbsp;<span class="op" id="4307398">==</span>&nbsp;<span class="ident" id="4307401">VersionSSL30</span>&nbsp;<span class="op" id="4307414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4307418">return</span>&nbsp;<span class="ident" id="4307425">finishedSum30</span><span class="op" id="4307438">(</span><span class="ident" id="4307439">h</span><span class="op" id="4307440">.</span><span class="ident" id="4307441">clientMD5</span><span class="op" id="4307450">,</span>&nbsp;<span class="ident" id="4307452">h</span><span class="op" id="4307453">.</span><span class="ident" id="4307454">client</span><span class="op" id="4307460">,</span>&nbsp;<span class="ident" id="4307462">masterSecret</span><span class="op" id="4307474">,</span>&nbsp;<span class="ident" id="4307476">ssl3ClientFinishedMagic</span><span class="op" id="4307499">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4307502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4307506">out</span>&nbsp;<span class="op" id="4307510">:=</span>&nbsp;<span class="builtinfunc" id="4307513">make</span><span class="op" id="4307517">(</span><span class="op" id="4307518">[</span><span class="op" id="4307519">]</span><span class="builtintype" id="4307520">byte</span><span class="op" id="4307524">,</span>&nbsp;<span class="ident" id="4307526">finishedVerifyLength</span><span class="op" id="4307546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4307549">if</span>&nbsp;<span class="ident" id="4307552">h</span><span class="op" id="4307553">.</span><span class="ident" id="4307554">version</span>&nbsp;<span class="op" id="4307562">&gt;=</span>&nbsp;<span class="ident" id="4307565">VersionTLS12</span>&nbsp;<span class="op" id="4307578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4307582">seed</span>&nbsp;<span class="op" id="4307587">:=</span>&nbsp;<span class="ident" id="4307590">h</span><span class="op" id="4307591">.</span><span class="ident" id="4307592">client</span><span class="op" id="4307598">.</span><span class="ident" id="4307599">Sum</span><span class="op" id="4307602">(</span><span class="builtintype" id="4307603">nil</span><span class="op" id="4307606">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4307610">prf12</span><span class="op" id="4307615">(</span><span class="ident" id="4307616">out</span><span class="op" id="4307619">,</span>&nbsp;<span class="ident" id="4307621">masterSecret</span><span class="op" id="4307633">,</span>&nbsp;<span class="ident" id="4307635">clientFinishedLabel</span><span class="op" id="4307654">,</span>&nbsp;<span class="ident" id="4307656">seed</span><span class="op" id="4307660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4307663">}</span>&nbsp;<span class="keyword" id="4307665">else</span>&nbsp;<span class="op" id="4307670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4307674">seed</span>&nbsp;<span class="op" id="4307679">:=</span>&nbsp;<span class="builtinfunc" id="4307682">make</span><span class="op" id="4307686">(</span><span class="op" id="4307687">[</span><span class="op" id="4307688">]</span><span class="builtintype" id="4307689">byte</span><span class="op" id="4307693">,</span>&nbsp;<span class="num" id="4307695">0</span><span class="op" id="4307696">,</span>&nbsp;<span class="ident" id="4307698">md5</span><span class="op" id="4307701">.</span><span class="ident" id="4307702">Size</span><span class="op" id="4307706">+</span><span class="ident" id="4307707">sha1</span><span class="op" id="4307711">.</span><span class="ident" id="4307712">Size</span><span class="op" id="4307716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4307720">seed</span>&nbsp;<span class="op" id="4307725">=</span>&nbsp;<span class="ident" id="4307727">h</span><span class="op" id="4307728">.</span><span class="ident" id="4307729">clientMD5</span><span class="op" id="4307738">.</span><span class="ident" id="4307739">Sum</span><span class="op" id="4307742">(</span><span class="ident" id="4307743">seed</span><span class="op" id="4307747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4307751">seed</span>&nbsp;<span class="op" id="4307756">=</span>&nbsp;<span class="ident" id="4307758">h</span><span class="op" id="4307759">.</span><span class="ident" id="4307760">client</span><span class="op" id="4307766">.</span><span class="ident" id="4307767">Sum</span><span class="op" id="4307770">(</span><span class="ident" id="4307771">seed</span><span class="op" id="4307775">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4307779">prf10</span><span class="op" id="4307784">(</span><span class="ident" id="4307785">out</span><span class="op" id="4307788">,</span>&nbsp;<span class="ident" id="4307790">masterSecret</span><span class="op" id="4307802">,</span>&nbsp;<span class="ident" id="4307804">clientFinishedLabel</span><span class="op" id="4307823">,</span>&nbsp;<span class="ident" id="4307825">seed</span><span class="op" id="4307829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4307832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4307835">return</span>&nbsp;<span class="ident" id="4307842">out</span><br>
<span class="lineno"></span><span class="op" id="4307846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="4307849">//&nbsp;serverSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;server&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4307923">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4307944">func</span>&nbsp;<span class="op" id="4307949">(</span><span class="ident" id="4307950">h</span>&nbsp;<span class="ident" id="4307952">finishedHash</span><span class="op" id="4307964">)</span>&nbsp;<span class="ident" id="4307966">serverSum</span><span class="op" id="4307975">(</span><span class="ident" id="4307976">masterSecret</span>&nbsp;<span class="op" id="4307989">[</span><span class="op" id="4307990">]</span><span class="builtintype" id="4307991">byte</span><span class="op" id="4307995">)</span>&nbsp;<span class="op" id="4307997">[</span><span class="op" id="4307998">]</span><span class="builtintype" id="4307999">byte</span>&nbsp;<span class="op" id="4308004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4308007">if</span>&nbsp;<span class="ident" id="4308010">h</span><span class="op" id="4308011">.</span><span class="ident" id="4308012">version</span>&nbsp;<span class="op" id="4308020">==</span>&nbsp;<span class="ident" id="4308023">VersionSSL30</span>&nbsp;<span class="op" id="4308036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4308040">return</span>&nbsp;<span class="ident" id="4308047">finishedSum30</span><span class="op" id="4308060">(</span><span class="ident" id="4308061">h</span><span class="op" id="4308062">.</span><span class="ident" id="4308063">serverMD5</span><span class="op" id="4308072">,</span>&nbsp;<span class="ident" id="4308074">h</span><span class="op" id="4308075">.</span><span class="ident" id="4308076">server</span><span class="op" id="4308082">,</span>&nbsp;<span class="ident" id="4308084">masterSecret</span><span class="op" id="4308096">,</span>&nbsp;<span class="ident" id="4308098">ssl3ServerFinishedMagic</span><span class="op" id="4308121">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4308124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4308128">out</span>&nbsp;<span class="op" id="4308132">:=</span>&nbsp;<span class="builtinfunc" id="4308135">make</span><span class="op" id="4308139">(</span><span class="op" id="4308140">[</span><span class="op" id="4308141">]</span><span class="builtintype" id="4308142">byte</span><span class="op" id="4308146">,</span>&nbsp;<span class="ident" id="4308148">finishedVerifyLength</span><span class="op" id="4308168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4308171">if</span>&nbsp;<span class="ident" id="4308174">h</span><span class="op" id="4308175">.</span><span class="ident" id="4308176">version</span>&nbsp;<span class="op" id="4308184">&gt;=</span>&nbsp;<span class="ident" id="4308187">VersionTLS12</span>&nbsp;<span class="op" id="4308200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4308204">seed</span>&nbsp;<span class="op" id="4308209">:=</span>&nbsp;<span class="ident" id="4308212">h</span><span class="op" id="4308213">.</span><span class="ident" id="4308214">server</span><span class="op" id="4308220">.</span><span class="ident" id="4308221">Sum</span><span class="op" id="4308224">(</span><span class="builtintype" id="4308225">nil</span><span class="op" id="4308228">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4308232">prf12</span><span class="op" id="4308237">(</span><span class="ident" id="4308238">out</span><span class="op" id="4308241">,</span>&nbsp;<span class="ident" id="4308243">masterSecret</span><span class="op" id="4308255">,</span>&nbsp;<span class="ident" id="4308257">serverFinishedLabel</span><span class="op" id="4308276">,</span>&nbsp;<span class="ident" id="4308278">seed</span><span class="op" id="4308282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4308285">}</span>&nbsp;<span class="keyword" id="4308287">else</span>&nbsp;<span class="op" id="4308292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4308296">seed</span>&nbsp;<span class="op" id="4308301">:=</span>&nbsp;<span class="builtinfunc" id="4308304">make</span><span class="op" id="4308308">(</span><span class="op" id="4308309">[</span><span class="op" id="4308310">]</span><span class="builtintype" id="4308311">byte</span><span class="op" id="4308315">,</span>&nbsp;<span class="num" id="4308317">0</span><span class="op" id="4308318">,</span>&nbsp;<span class="ident" id="4308320">md5</span><span class="op" id="4308323">.</span><span class="ident" id="4308324">Size</span><span class="op" id="4308328">+</span><span class="ident" id="4308329">sha1</span><span class="op" id="4308333">.</span><span class="ident" id="4308334">Size</span><span class="op" id="4308338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4308342">seed</span>&nbsp;<span class="op" id="4308347">=</span>&nbsp;<span class="ident" id="4308349">h</span><span class="op" id="4308350">.</span><span class="ident" id="4308351">serverMD5</span><span class="op" id="4308360">.</span><span class="ident" id="4308361">Sum</span><span class="op" id="4308364">(</span><span class="ident" id="4308365">seed</span><span class="op" id="4308369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4308373">seed</span>&nbsp;<span class="op" id="4308378">=</span>&nbsp;<span class="ident" id="4308380">h</span><span class="op" id="4308381">.</span><span class="ident" id="4308382">server</span><span class="op" id="4308388">.</span><span class="ident" id="4308389">Sum</span><span class="op" id="4308392">(</span><span class="ident" id="4308393">seed</span><span class="op" id="4308397">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4308401">prf10</span><span class="op" id="4308406">(</span><span class="ident" id="4308407">out</span><span class="op" id="4308410">,</span>&nbsp;<span class="ident" id="4308412">masterSecret</span><span class="op" id="4308424">,</span>&nbsp;<span class="ident" id="4308426">serverFinishedLabel</span><span class="op" id="4308445">,</span>&nbsp;<span class="ident" id="4308447">seed</span><span class="op" id="4308451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4308454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4308457">return</span>&nbsp;<span class="ident" id="4308464">out</span><br>
<span class="lineno"></span><span class="op" id="4308468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="comment" id="4308471">//&nbsp;hashForClientCertificate&nbsp;returns&nbsp;a&nbsp;digest,&nbsp;hash&nbsp;function,&nbsp;and&nbsp;TLS&nbsp;1.2&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="4308549">//&nbsp;id&nbsp;suitable&nbsp;for&nbsp;signing&nbsp;by&nbsp;a&nbsp;TLS&nbsp;client&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="4308605">func</span>&nbsp;<span class="op" id="4308610">(</span><span class="ident" id="4308611">h</span>&nbsp;<span class="ident" id="4308613">finishedHash</span><span class="op" id="4308625">)</span>&nbsp;<span class="ident" id="4308627">hashForClientCertificate</span><span class="op" id="4308651">(</span><span class="ident" id="4308652">sigType</span>&nbsp;<span class="builtintype" id="4308660">uint8</span><span class="op" id="4308665">)</span>&nbsp;<span class="op" id="4308667">(</span><span class="op" id="4308668">[</span><span class="op" id="4308669">]</span><span class="builtintype" id="4308670">byte</span><span class="op" id="4308674">,</span>&nbsp;<span class="ident" id="4308676">crypto</span><span class="op" id="4308682">.</span><span class="ident" id="4308683">Hash</span><span class="op" id="4308687">,</span>&nbsp;<span class="builtintype" id="4308689">uint8</span><span class="op" id="4308694">)</span>&nbsp;<span class="op" id="4308696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4308699">if</span>&nbsp;<span class="ident" id="4308702">h</span><span class="op" id="4308703">.</span><span class="ident" id="4308704">version</span>&nbsp;<span class="op" id="4308712">&gt;=</span>&nbsp;<span class="ident" id="4308715">VersionTLS12</span>&nbsp;<span class="op" id="4308728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4308732">digest</span>&nbsp;<span class="op" id="4308739">:=</span>&nbsp;<span class="ident" id="4308742">h</span><span class="op" id="4308743">.</span><span class="ident" id="4308744">server</span><span class="op" id="4308750">.</span><span class="ident" id="4308751">Sum</span><span class="op" id="4308754">(</span><span class="builtintype" id="4308755">nil</span><span class="op" id="4308758">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4308762">return</span>&nbsp;<span class="ident" id="4308769">digest</span><span class="op" id="4308775">,</span>&nbsp;<span class="ident" id="4308777">crypto</span><span class="op" id="4308783">.</span><span class="ident" id="4308784">SHA256</span><span class="op" id="4308790">,</span>&nbsp;<span class="ident" id="4308792">hashSHA256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4308804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4308807">if</span>&nbsp;<span class="ident" id="4308810">sigType</span>&nbsp;<span class="op" id="4308818">==</span>&nbsp;<span class="ident" id="4308821">signatureECDSA</span>&nbsp;<span class="op" id="4308836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4308840">digest</span>&nbsp;<span class="op" id="4308847">:=</span>&nbsp;<span class="ident" id="4308850">h</span><span class="op" id="4308851">.</span><span class="ident" id="4308852">server</span><span class="op" id="4308858">.</span><span class="ident" id="4308859">Sum</span><span class="op" id="4308862">(</span><span class="builtintype" id="4308863">nil</span><span class="op" id="4308866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4308870">return</span>&nbsp;<span class="ident" id="4308877">digest</span><span class="op" id="4308883">,</span>&nbsp;<span class="ident" id="4308885">crypto</span><span class="op" id="4308891">.</span><span class="ident" id="4308892">SHA1</span><span class="op" id="4308896">,</span>&nbsp;<span class="ident" id="4308898">hashSHA1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4308908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4308912">digest</span>&nbsp;<span class="op" id="4308919">:=</span>&nbsp;<span class="builtinfunc" id="4308922">make</span><span class="op" id="4308926">(</span><span class="op" id="4308927">[</span><span class="op" id="4308928">]</span><span class="builtintype" id="4308929">byte</span><span class="op" id="4308933">,</span>&nbsp;<span class="num" id="4308935">0</span><span class="op" id="4308936">,</span>&nbsp;<span class="num" id="4308938">36</span><span class="op" id="4308940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4308943">digest</span>&nbsp;<span class="op" id="4308950">=</span>&nbsp;<span class="ident" id="4308952">h</span><span class="op" id="4308953">.</span><span class="ident" id="4308954">serverMD5</span><span class="op" id="4308963">.</span><span class="ident" id="4308964">Sum</span><span class="op" id="4308967">(</span><span class="ident" id="4308968">digest</span><span class="op" id="4308974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4308977">digest</span>&nbsp;<span class="op" id="4308984">=</span>&nbsp;<span class="ident" id="4308986">h</span><span class="op" id="4308987">.</span><span class="ident" id="4308988">server</span><span class="op" id="4308994">.</span><span class="ident" id="4308995">Sum</span><span class="op" id="4308998">(</span><span class="ident" id="4308999">digest</span><span class="op" id="4309005">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4309008">return</span>&nbsp;<span class="ident" id="4309015">digest</span><span class="op" id="4309021">,</span>&nbsp;<span class="ident" id="4309023">crypto</span><span class="op" id="4309029">.</span><span class="ident" id="4309030">MD5SHA1</span><span class="op" id="4309037">,</span>&nbsp;<span class="num" id="4309039">0</span>&nbsp;<span class="comment" id="4309041">/*&nbsp;not&nbsp;specified&nbsp;in&nbsp;TLS&nbsp;1.2.&nbsp;*/</span><br>
<span class="lineno"></span><span class="op" id="4309073">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
