<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4730232">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4730287">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4730341">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4730392">//&nbsp;HTTP&nbsp;client.&nbsp;See&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="4730422">//</span><br>
<span class="lineno"></span><span class="comment" id="4730425">//&nbsp;This&nbsp;is&nbsp;the&nbsp;high-level&nbsp;Client&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="4730469">//&nbsp;The&nbsp;low-level&nbsp;implementation&nbsp;is&nbsp;in&nbsp;transport.go.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4730522">package</span>&nbsp;<span class="ident" id="4730530">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4730536">import</span>&nbsp;<span class="op" id="4730543">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4730546">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4730565">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4730575">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4730582">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4730588">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4730601">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4730608">&#34;net/url&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4730619">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4730630">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4730638">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4730645">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4730648">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;an&nbsp;HTTP&nbsp;client.&nbsp;Its&nbsp;zero&nbsp;value&nbsp;(DefaultClient)&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4730715">//&nbsp;usable&nbsp;client&nbsp;that&nbsp;uses&nbsp;DefaultTransport.</span><br>
<span class="lineno"></span><span class="comment" id="4730760">//</span><br>
<span class="lineno"></span><span class="comment" id="4730763">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;typically&nbsp;has&nbsp;internal&nbsp;state&nbsp;(cached&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="4730830">//&nbsp;connections),&nbsp;so&nbsp;Clients&nbsp;should&nbsp;be&nbsp;reused&nbsp;instead&nbsp;of&nbsp;created&nbsp;as</span><br>
<span class="lineno">30</span><span class="comment" id="4730897">//&nbsp;needed.&nbsp;Clients&nbsp;are&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="4730968">//</span><br>
<span class="lineno"></span><span class="comment" id="4730971">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;higher-level&nbsp;than&nbsp;a&nbsp;RoundTripper&nbsp;(such&nbsp;as&nbsp;Transport)</span><br>
<span class="lineno"></span><span class="comment" id="4731039">//&nbsp;and&nbsp;additionally&nbsp;handles&nbsp;HTTP&nbsp;details&nbsp;such&nbsp;as&nbsp;cookies&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4731100">//&nbsp;redirects.</span><br>
<span class="lineno">35</span><span class="keyword" id="4731114">type</span>&nbsp;<span class="ident" id="4731119">Client</span>&nbsp;<span class="keyword" id="4731126">struct</span>&nbsp;<span class="op" id="4731133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4731136">//&nbsp;Transport&nbsp;specifies&nbsp;the&nbsp;mechanism&nbsp;by&nbsp;which&nbsp;individual</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4731194">//&nbsp;HTTP&nbsp;requests&nbsp;are&nbsp;made.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4731222">//&nbsp;If&nbsp;nil,&nbsp;DefaultTransport&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4731260">Transport</span>&nbsp;<span class="ident" id="4731270">RoundTripper</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4731285">//&nbsp;CheckRedirect&nbsp;specifies&nbsp;the&nbsp;policy&nbsp;for&nbsp;handling&nbsp;redirects.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4731348">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;not&nbsp;nil,&nbsp;the&nbsp;client&nbsp;calls&nbsp;it&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4731408">//&nbsp;following&nbsp;an&nbsp;HTTP&nbsp;redirect.&nbsp;The&nbsp;arguments&nbsp;req&nbsp;and&nbsp;via&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4731470">//&nbsp;the&nbsp;upcoming&nbsp;request&nbsp;and&nbsp;the&nbsp;requests&nbsp;made&nbsp;already,&nbsp;oldest</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4731533">//&nbsp;first.&nbsp;If&nbsp;CheckRedirect&nbsp;returns&nbsp;an&nbsp;error,&nbsp;the&nbsp;Client&#39;s&nbsp;Get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4731596">//&nbsp;method&nbsp;returns&nbsp;both&nbsp;the&nbsp;previous&nbsp;Response&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4731646">//&nbsp;CheckRedirect&#39;s&nbsp;error&nbsp;(wrapped&nbsp;in&nbsp;a&nbsp;url.Error)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4731708">//&nbsp;issuing&nbsp;the&nbsp;Request&nbsp;req.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4731737">//</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4731741">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;nil,&nbsp;the&nbsp;Client&nbsp;uses&nbsp;its&nbsp;default&nbsp;policy,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4731806">//&nbsp;which&nbsp;is&nbsp;to&nbsp;stop&nbsp;after&nbsp;10&nbsp;consecutive&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4731858">CheckRedirect</span>&nbsp;<span class="keyword" id="4731872">func</span><span class="op" id="4731876">(</span><span class="ident" id="4731877">req</span>&nbsp;<span class="op" id="4731881">*</span><span class="ident" id="4731882">Request</span><span class="op" id="4731889">,</span>&nbsp;<span class="ident" id="4731891">via</span>&nbsp;<span class="op" id="4731895">[</span><span class="op" id="4731896">]</span><span class="op" id="4731897">*</span><span class="ident" id="4731898">Request</span><span class="op" id="4731905">)</span>&nbsp;<span class="builtintype" id="4731907">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4731915">//&nbsp;Jar&nbsp;specifies&nbsp;the&nbsp;cookie&nbsp;jar.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4731949">//&nbsp;If&nbsp;Jar&nbsp;is&nbsp;nil,&nbsp;cookies&nbsp;are&nbsp;not&nbsp;sent&nbsp;in&nbsp;requests&nbsp;and&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4732013">//&nbsp;in&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732031">Jar</span>&nbsp;<span class="ident" id="4732035">CookieJar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4732047">//&nbsp;Timeout&nbsp;specifies&nbsp;a&nbsp;time&nbsp;limit&nbsp;for&nbsp;requests&nbsp;made&nbsp;by&nbsp;this</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4732108">//&nbsp;Client.&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;connection&nbsp;time,&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4732162">//&nbsp;redirects,&nbsp;and&nbsp;reading&nbsp;the&nbsp;response&nbsp;body.&nbsp;The&nbsp;timer&nbsp;remains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4732226">//&nbsp;running&nbsp;after&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do&nbsp;return&nbsp;and&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4732283">//&nbsp;interrupt&nbsp;reading&nbsp;of&nbsp;the&nbsp;Response.Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4732327">//</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4732331">//&nbsp;A&nbsp;Timeout&nbsp;of&nbsp;zero&nbsp;means&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4732371">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4732375">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;must&nbsp;support&nbsp;the&nbsp;CancelRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4732433">//&nbsp;method&nbsp;or&nbsp;Client&nbsp;will&nbsp;return&nbsp;errors&nbsp;when&nbsp;attempting&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4732497">//&nbsp;a&nbsp;request&nbsp;with&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do.&nbsp;Client&#39;s&nbsp;default</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4732557">//&nbsp;Transport&nbsp;(DefaultTransport)&nbsp;supports&nbsp;CancelRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732614">Timeout</span>&nbsp;<span class="ident" id="4732622">time</span><span class="op" id="4732626">.</span><span class="ident" id="4732627">Duration</span><br>
<span class="lineno"></span><span class="op" id="4732636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4732639">//&nbsp;DefaultClient&nbsp;is&nbsp;the&nbsp;default&nbsp;Client&nbsp;and&nbsp;is&nbsp;used&nbsp;by&nbsp;Get,&nbsp;Head,&nbsp;and&nbsp;Post.</span><br>
<span class="lineno">75</span><span class="keyword" id="4732714">var</span>&nbsp;<span class="ident" id="4732718">DefaultClient</span>&nbsp;<span class="op" id="4732732">=</span>&nbsp;<span class="op" id="4732734">&amp;</span><span class="ident" id="4732735">Client</span><span class="op" id="4732741">{</span><span class="op" id="4732742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4732745">//&nbsp;RoundTripper&nbsp;is&nbsp;an&nbsp;interface&nbsp;representing&nbsp;the&nbsp;ability&nbsp;to&nbsp;execute&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4732815">//&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;obtaining&nbsp;the&nbsp;Response&nbsp;for&nbsp;a&nbsp;given&nbsp;Request.</span><br>
<span class="lineno"></span><span class="comment" id="4732887">//</span><br>
<span class="lineno">80</span><span class="comment" id="4732890">//&nbsp;A&nbsp;RoundTripper&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple</span><br>
<span class="lineno"></span><span class="comment" id="4732952">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="4732967">type</span>&nbsp;<span class="ident" id="4732972">RoundTripper</span>&nbsp;<span class="keyword" id="4732985">interface</span>&nbsp;<span class="op" id="4732995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4732998">//&nbsp;RoundTrip&nbsp;executes&nbsp;a&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;returning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4733058">//&nbsp;the&nbsp;Response&nbsp;for&nbsp;the&nbsp;request&nbsp;req.&nbsp;&nbsp;RoundTrip&nbsp;should&nbsp;not</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4733118">//&nbsp;attempt&nbsp;to&nbsp;interpret&nbsp;the&nbsp;response.&nbsp;&nbsp;In&nbsp;particular,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4733173">//&nbsp;RoundTrip&nbsp;must&nbsp;return&nbsp;err&nbsp;==&nbsp;nil&nbsp;if&nbsp;it&nbsp;obtained&nbsp;a&nbsp;response,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4733237">//&nbsp;regardless&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;HTTP&nbsp;status&nbsp;code.&nbsp;&nbsp;A&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4733299">//&nbsp;err&nbsp;should&nbsp;be&nbsp;reserved&nbsp;for&nbsp;failure&nbsp;to&nbsp;obtain&nbsp;a&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4733360">//&nbsp;Similarly,&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;attempt&nbsp;to&nbsp;handle</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4733414">//&nbsp;higher-level&nbsp;protocol&nbsp;details&nbsp;such&nbsp;as&nbsp;redirects,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4733467">//&nbsp;authentication,&nbsp;or&nbsp;cookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4733499">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4733503">//&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;modify&nbsp;the&nbsp;request,&nbsp;except&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4733559">//&nbsp;consuming&nbsp;and&nbsp;closing&nbsp;the&nbsp;Body,&nbsp;including&nbsp;on&nbsp;errors.&nbsp;The</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4733620">//&nbsp;request&#39;s&nbsp;URL&nbsp;and&nbsp;Header&nbsp;fields&nbsp;are&nbsp;guaranteed&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4733677">//&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4733694">RoundTrip</span><span class="op" id="4733703">(</span><span class="op" id="4733704">*</span><span class="ident" id="4733705">Request</span><span class="op" id="4733712">)</span>&nbsp;<span class="op" id="4733714">(</span><span class="op" id="4733715">*</span><span class="ident" id="4733716">Response</span><span class="op" id="4733724">,</span>&nbsp;<span class="builtintype" id="4733726">error</span><span class="op" id="4733731">)</span><br>
<span class="lineno"></span><span class="op" id="4733733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="4733736">//&nbsp;Given&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host&#34;,&nbsp;&#34;host:port&#34;,&nbsp;or&nbsp;&#34;[ipv6::address]:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4733814">//&nbsp;return&nbsp;true&nbsp;if&nbsp;the&nbsp;string&nbsp;includes&nbsp;a&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="4733860">func</span>&nbsp;<span class="ident" id="4733865">hasPort</span><span class="op" id="4733872">(</span><span class="ident" id="4733873">s</span>&nbsp;<span class="builtintype" id="4733875">string</span><span class="op" id="4733881">)</span>&nbsp;<span class="builtintype" id="4733883">bool</span>&nbsp;<span class="op" id="4733888">{</span>&nbsp;<span class="keyword" id="4733890">return</span>&nbsp;<span class="ident" id="4733897">strings</span><span class="op" id="4733904">.</span><span class="ident" id="4733905">LastIndex</span><span class="op" id="4733914">(</span><span class="ident" id="4733915">s</span><span class="op" id="4733916">,</span>&nbsp;<span class="string" id="4733918">&#34;:&#34;</span><span class="op" id="4733921">)</span>&nbsp;<span class="op" id="4733923">&gt;</span>&nbsp;<span class="ident" id="4733925">strings</span><span class="op" id="4733932">.</span><span class="ident" id="4733933">LastIndex</span><span class="op" id="4733942">(</span><span class="ident" id="4733943">s</span><span class="op" id="4733944">,</span>&nbsp;<span class="string" id="4733946">&#34;]&#34;</span><span class="op" id="4733949">)</span>&nbsp;<span class="op" id="4733951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4733954">//&nbsp;refererForURL&nbsp;returns&nbsp;a&nbsp;referer&nbsp;without&nbsp;any&nbsp;authentication&nbsp;info&nbsp;or</span><br>
<span class="lineno">105</span><span class="comment" id="4734024">//&nbsp;an&nbsp;empty&nbsp;string&nbsp;if&nbsp;lastReq&nbsp;scheme&nbsp;is&nbsp;https&nbsp;and&nbsp;newReq&nbsp;scheme&nbsp;is&nbsp;http.</span><br>
<span class="lineno"></span><span class="keyword" id="4734097">func</span>&nbsp;<span class="ident" id="4734102">refererForURL</span><span class="op" id="4734115">(</span><span class="ident" id="4734116">lastReq</span><span class="op" id="4734123">,</span>&nbsp;<span class="ident" id="4734125">newReq</span>&nbsp;<span class="op" id="4734132">*</span><span class="ident" id="4734133">url</span><span class="op" id="4734136">.</span><span class="ident" id="4734137">URL</span><span class="op" id="4734140">)</span>&nbsp;<span class="builtintype" id="4734142">string</span>&nbsp;<span class="op" id="4734149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4734152">//&nbsp;https://tools.ietf.org/html/rfc7231#section-5.5.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4734206">//&nbsp;&nbsp;&nbsp;&#34;Clients&nbsp;SHOULD&nbsp;NOT&nbsp;include&nbsp;a&nbsp;Referer&nbsp;header&nbsp;field&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4734268">//&nbsp;&nbsp;&nbsp;&nbsp;(non-secure)&nbsp;HTTP&nbsp;request&nbsp;if&nbsp;the&nbsp;referring&nbsp;page&nbsp;was</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4734327">//&nbsp;&nbsp;&nbsp;&nbsp;transferred&nbsp;with&nbsp;a&nbsp;secure&nbsp;protocol.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4734371">if</span>&nbsp;<span class="ident" id="4734374">lastReq</span><span class="op" id="4734381">.</span><span class="ident" id="4734382">Scheme</span>&nbsp;<span class="op" id="4734389">==</span>&nbsp;<span class="string" id="4734392">&#34;https&#34;</span>&nbsp;<span class="op" id="4734400">&amp;&amp;</span>&nbsp;<span class="ident" id="4734403">newReq</span><span class="op" id="4734409">.</span><span class="ident" id="4734410">Scheme</span>&nbsp;<span class="op" id="4734417">==</span>&nbsp;<span class="string" id="4734420">&#34;http&#34;</span>&nbsp;<span class="op" id="4734427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4734431">return</span>&nbsp;<span class="string" id="4734438">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4734442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4734445">referer</span>&nbsp;<span class="op" id="4734453">:=</span>&nbsp;<span class="ident" id="4734456">lastReq</span><span class="op" id="4734463">.</span><span class="ident" id="4734464">String</span><span class="op" id="4734470">(</span><span class="op" id="4734471">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4734474">if</span>&nbsp;<span class="ident" id="4734477">lastReq</span><span class="op" id="4734484">.</span><span class="ident" id="4734485">User</span>&nbsp;<span class="op" id="4734490">!=</span>&nbsp;<span class="ident" id="4734493">nil</span>&nbsp;<span class="op" id="4734497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4734501">//&nbsp;This&nbsp;is&nbsp;not&nbsp;very&nbsp;efficient,&nbsp;but&nbsp;is&nbsp;the&nbsp;best&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4734557">//&nbsp;do&nbsp;without:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4734574">//&nbsp;-&nbsp;introducing&nbsp;a&nbsp;new&nbsp;method&nbsp;on&nbsp;URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4734613">//&nbsp;-&nbsp;creating&nbsp;a&nbsp;race&nbsp;condition</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4734646">//&nbsp;-&nbsp;copying&nbsp;the&nbsp;URL&nbsp;struct&nbsp;manually,&nbsp;which&nbsp;would&nbsp;cause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4734704">//&nbsp;&nbsp;&nbsp;maintenance&nbsp;problems&nbsp;down&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4734746">auth</span>&nbsp;<span class="op" id="4734751">:=</span>&nbsp;<span class="ident" id="4734754">lastReq</span><span class="op" id="4734761">.</span><span class="ident" id="4734762">User</span><span class="op" id="4734766">.</span><span class="ident" id="4734767">String</span><span class="op" id="4734773">(</span><span class="op" id="4734774">)</span>&nbsp;<span class="op" id="4734776">+</span>&nbsp;<span class="string" id="4734778">&#34;@&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4734784">referer</span>&nbsp;<span class="op" id="4734792">=</span>&nbsp;<span class="ident" id="4734794">strings</span><span class="op" id="4734801">.</span><span class="ident" id="4734802">Replace</span><span class="op" id="4734809">(</span><span class="ident" id="4734810">referer</span><span class="op" id="4734817">,</span>&nbsp;<span class="ident" id="4734819">auth</span><span class="op" id="4734823">,</span>&nbsp;<span class="string" id="4734825">&#34;&#34;</span><span class="op" id="4734827">,</span>&nbsp;<span class="num" id="4734829">1</span><span class="op" id="4734830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4734833">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4734836">return</span>&nbsp;<span class="ident" id="4734843">referer</span><br>
<span class="lineno"></span><span class="op" id="4734851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4734854">//&nbsp;Used&nbsp;in&nbsp;Send&nbsp;to&nbsp;implement&nbsp;io.ReadCloser&nbsp;by&nbsp;bundling&nbsp;together&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4734922">//&nbsp;bufio.Reader&nbsp;through&nbsp;which&nbsp;we&nbsp;read&nbsp;the&nbsp;response,&nbsp;and&nbsp;the&nbsp;underlying</span><br>
<span class="lineno">130</span><span class="comment" id="4734993">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4735016">type</span>&nbsp;<span class="ident" id="4735021">readClose</span>&nbsp;<span class="keyword" id="4735031">struct</span>&nbsp;<span class="op" id="4735038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4735041">io</span><span class="op" id="4735043">.</span><span class="ident" id="4735044">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4735052">io</span><span class="op" id="4735054">.</span><span class="ident" id="4735055">Closer</span><br>
<span class="lineno"></span><span class="op" id="4735062">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="4735065">func</span>&nbsp;<span class="op" id="4735070">(</span><span class="ident" id="4735071">c</span>&nbsp;<span class="op" id="4735073">*</span><span class="ident" id="4735074">Client</span><span class="op" id="4735080">)</span>&nbsp;<span class="ident" id="4735082">send</span><span class="op" id="4735086">(</span><span class="ident" id="4735087">req</span>&nbsp;<span class="op" id="4735091">*</span><span class="ident" id="4735092">Request</span><span class="op" id="4735099">)</span>&nbsp;<span class="op" id="4735101">(</span><span class="op" id="4735102">*</span><span class="ident" id="4735103">Response</span><span class="op" id="4735111">,</span>&nbsp;<span class="builtintype" id="4735113">error</span><span class="op" id="4735118">)</span>&nbsp;<span class="op" id="4735120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4735123">if</span>&nbsp;<span class="ident" id="4735126">c</span><span class="op" id="4735127">.</span><span class="ident" id="4735128">Jar</span>&nbsp;<span class="op" id="4735132">!=</span>&nbsp;<span class="ident" id="4735135">nil</span>&nbsp;<span class="op" id="4735139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4735143">for</span>&nbsp;<span class="ident" id="4735147">_</span><span class="op" id="4735148">,</span>&nbsp;<span class="ident" id="4735150">cookie</span>&nbsp;<span class="op" id="4735157">:=</span>&nbsp;<span class="keyword" id="4735160">range</span>&nbsp;<span class="ident" id="4735166">c</span><span class="op" id="4735167">.</span><span class="ident" id="4735168">Jar</span><span class="op" id="4735171">.</span><span class="ident" id="4735172">Cookies</span><span class="op" id="4735179">(</span><span class="ident" id="4735180">req</span><span class="op" id="4735183">.</span><span class="ident" id="4735184">URL</span><span class="op" id="4735187">)</span>&nbsp;<span class="op" id="4735189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4735194">req</span><span class="op" id="4735197">.</span><span class="ident" id="4735198">AddCookie</span><span class="op" id="4735207">(</span><span class="ident" id="4735208">cookie</span><span class="op" id="4735214">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4735218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4735221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4735224">resp</span><span class="op" id="4735228">,</span>&nbsp;<span class="ident" id="4735230">err</span>&nbsp;<span class="op" id="4735234">:=</span>&nbsp;<span class="ident" id="4735237">send</span><span class="op" id="4735241">(</span><span class="ident" id="4735242">req</span><span class="op" id="4735245">,</span>&nbsp;<span class="ident" id="4735247">c</span><span class="op" id="4735248">.</span><span class="ident" id="4735249">transport</span><span class="op" id="4735258">(</span><span class="op" id="4735259">)</span><span class="op" id="4735260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4735263">if</span>&nbsp;<span class="ident" id="4735266">err</span>&nbsp;<span class="op" id="4735270">!=</span>&nbsp;<span class="ident" id="4735273">nil</span>&nbsp;<span class="op" id="4735277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4735281">return</span>&nbsp;<span class="ident" id="4735288">nil</span><span class="op" id="4735291">,</span>&nbsp;<span class="ident" id="4735293">err</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4735298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4735301">if</span>&nbsp;<span class="ident" id="4735304">c</span><span class="op" id="4735305">.</span><span class="ident" id="4735306">Jar</span>&nbsp;<span class="op" id="4735310">!=</span>&nbsp;<span class="ident" id="4735313">nil</span>&nbsp;<span class="op" id="4735317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4735321">if</span>&nbsp;<span class="ident" id="4735324">rc</span>&nbsp;<span class="op" id="4735327">:=</span>&nbsp;<span class="ident" id="4735330">resp</span><span class="op" id="4735334">.</span><span class="ident" id="4735335">Cookies</span><span class="op" id="4735342">(</span><span class="op" id="4735343">)</span><span class="op" id="4735344">;</span>&nbsp;<span class="builtinfunc" id="4735346">len</span><span class="op" id="4735349">(</span><span class="ident" id="4735350">rc</span><span class="op" id="4735352">)</span>&nbsp;<span class="op" id="4735354">&gt;</span>&nbsp;<span class="num" id="4735356">0</span>&nbsp;<span class="op" id="4735358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4735363">c</span><span class="op" id="4735364">.</span><span class="ident" id="4735365">Jar</span><span class="op" id="4735368">.</span><span class="ident" id="4735369">SetCookies</span><span class="op" id="4735379">(</span><span class="ident" id="4735380">req</span><span class="op" id="4735383">.</span><span class="ident" id="4735384">URL</span><span class="op" id="4735387">,</span>&nbsp;<span class="ident" id="4735389">rc</span><span class="op" id="4735391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4735395">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4735398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4735401">return</span>&nbsp;<span class="ident" id="4735408">resp</span><span class="op" id="4735412">,</span>&nbsp;<span class="ident" id="4735414">err</span><br>
<span class="lineno"></span><span class="op" id="4735418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4735421">//&nbsp;Do&nbsp;sends&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response,&nbsp;following</span><br>
<span class="lineno">155</span><span class="comment" id="4735489">//&nbsp;policy&nbsp;(e.g.&nbsp;redirects,&nbsp;cookies,&nbsp;auth)&nbsp;as&nbsp;configured&nbsp;on&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="4735560">//</span><br>
<span class="lineno"></span><span class="comment" id="4735563">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;caused&nbsp;by&nbsp;client&nbsp;policy&nbsp;(such&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4735623">//&nbsp;CheckRedirect),&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4735682">//&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno">160</span><span class="comment" id="4735728">//</span><br>
<span class="lineno"></span><span class="comment" id="4735731">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="4735793">//</span><br>
<span class="lineno"></span><span class="comment" id="4735796">//&nbsp;Callers&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="4735860">//&nbsp;resp.Body&nbsp;is&nbsp;not&nbsp;closed,&nbsp;the&nbsp;Client&#39;s&nbsp;underlying&nbsp;RoundTripper</span><br>
<span class="lineno">165</span><span class="comment" id="4735925">//&nbsp;(typically&nbsp;Transport)&nbsp;may&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;re-use&nbsp;a&nbsp;persistent&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="4735993">//&nbsp;connection&nbsp;to&nbsp;the&nbsp;server&nbsp;for&nbsp;a&nbsp;subsequent&nbsp;&#34;keep-alive&#34;&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="4736060">//</span><br>
<span class="lineno"></span><span class="comment" id="4736063">//&nbsp;The&nbsp;request&nbsp;Body,&nbsp;if&nbsp;non-nil,&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4736129">//&nbsp;Transport,&nbsp;even&nbsp;on&nbsp;errors.</span><br>
<span class="lineno">170</span><span class="comment" id="4736159">//</span><br>
<span class="lineno"></span><span class="comment" id="4736162">//&nbsp;Generally&nbsp;Get,&nbsp;Post,&nbsp;or&nbsp;PostForm&nbsp;will&nbsp;be&nbsp;used&nbsp;instead&nbsp;of&nbsp;Do.</span><br>
<span class="lineno"></span><span class="keyword" id="4736226">func</span>&nbsp;<span class="op" id="4736231">(</span><span class="ident" id="4736232">c</span>&nbsp;<span class="op" id="4736234">*</span><span class="ident" id="4736235">Client</span><span class="op" id="4736241">)</span>&nbsp;<span class="ident" id="4736243">Do</span><span class="op" id="4736245">(</span><span class="ident" id="4736246">req</span>&nbsp;<span class="op" id="4736250">*</span><span class="ident" id="4736251">Request</span><span class="op" id="4736258">)</span>&nbsp;<span class="op" id="4736260">(</span><span class="ident" id="4736261">resp</span>&nbsp;<span class="op" id="4736266">*</span><span class="ident" id="4736267">Response</span><span class="op" id="4736275">,</span>&nbsp;<span class="ident" id="4736277">err</span>&nbsp;<span class="builtintype" id="4736281">error</span><span class="op" id="4736286">)</span>&nbsp;<span class="op" id="4736288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736291">if</span>&nbsp;<span class="ident" id="4736294">req</span><span class="op" id="4736297">.</span><span class="ident" id="4736298">Method</span>&nbsp;<span class="op" id="4736305">==</span>&nbsp;<span class="string" id="4736308">&#34;GET&#34;</span>&nbsp;<span class="op" id="4736314">||</span>&nbsp;<span class="ident" id="4736317">req</span><span class="op" id="4736320">.</span><span class="ident" id="4736321">Method</span>&nbsp;<span class="op" id="4736328">==</span>&nbsp;<span class="string" id="4736331">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="4736338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736342">return</span>&nbsp;<span class="ident" id="4736349">c</span><span class="op" id="4736350">.</span><span class="ident" id="4736351">doFollowingRedirects</span><span class="op" id="4736371">(</span><span class="ident" id="4736372">req</span><span class="op" id="4736375">,</span>&nbsp;<span class="ident" id="4736377">shouldRedirectGet</span><span class="op" id="4736394">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4736397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736400">if</span>&nbsp;<span class="ident" id="4736403">req</span><span class="op" id="4736406">.</span><span class="ident" id="4736407">Method</span>&nbsp;<span class="op" id="4736414">==</span>&nbsp;<span class="string" id="4736417">&#34;POST&#34;</span>&nbsp;<span class="op" id="4736424">||</span>&nbsp;<span class="ident" id="4736427">req</span><span class="op" id="4736430">.</span><span class="ident" id="4736431">Method</span>&nbsp;<span class="op" id="4736438">==</span>&nbsp;<span class="string" id="4736441">&#34;PUT&#34;</span>&nbsp;<span class="op" id="4736447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736451">return</span>&nbsp;<span class="ident" id="4736458">c</span><span class="op" id="4736459">.</span><span class="ident" id="4736460">doFollowingRedirects</span><span class="op" id="4736480">(</span><span class="ident" id="4736481">req</span><span class="op" id="4736484">,</span>&nbsp;<span class="ident" id="4736486">shouldRedirectPost</span><span class="op" id="4736504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4736507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736510">return</span>&nbsp;<span class="ident" id="4736517">c</span><span class="op" id="4736518">.</span><span class="ident" id="4736519">send</span><span class="op" id="4736523">(</span><span class="ident" id="4736524">req</span><span class="op" id="4736527">)</span><br>
<span class="lineno">180</span><span class="op" id="4736529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4736532">func</span>&nbsp;<span class="op" id="4736537">(</span><span class="ident" id="4736538">c</span>&nbsp;<span class="op" id="4736540">*</span><span class="ident" id="4736541">Client</span><span class="op" id="4736547">)</span>&nbsp;<span class="ident" id="4736549">transport</span><span class="op" id="4736558">(</span><span class="op" id="4736559">)</span>&nbsp;<span class="ident" id="4736561">RoundTripper</span>&nbsp;<span class="op" id="4736574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736577">if</span>&nbsp;<span class="ident" id="4736580">c</span><span class="op" id="4736581">.</span><span class="ident" id="4736582">Transport</span>&nbsp;<span class="op" id="4736592">!=</span>&nbsp;<span class="ident" id="4736595">nil</span>&nbsp;<span class="op" id="4736599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736603">return</span>&nbsp;<span class="ident" id="4736610">c</span><span class="op" id="4736611">.</span><span class="ident" id="4736612">Transport</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4736623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736626">return</span>&nbsp;<span class="ident" id="4736633">DefaultTransport</span><br>
<span class="lineno"></span><span class="op" id="4736650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4736653">//&nbsp;send&nbsp;issues&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno">190</span><span class="comment" id="4736685">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4736745">func</span>&nbsp;<span class="ident" id="4736750">send</span><span class="op" id="4736754">(</span><span class="ident" id="4736755">req</span>&nbsp;<span class="op" id="4736759">*</span><span class="ident" id="4736760">Request</span><span class="op" id="4736767">,</span>&nbsp;<span class="ident" id="4736769">t</span>&nbsp;<span class="ident" id="4736771">RoundTripper</span><span class="op" id="4736783">)</span>&nbsp;<span class="op" id="4736785">(</span><span class="ident" id="4736786">resp</span>&nbsp;<span class="op" id="4736791">*</span><span class="ident" id="4736792">Response</span><span class="op" id="4736800">,</span>&nbsp;<span class="ident" id="4736802">err</span>&nbsp;<span class="builtintype" id="4736806">error</span><span class="op" id="4736811">)</span>&nbsp;<span class="op" id="4736813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736816">if</span>&nbsp;<span class="ident" id="4736819">t</span>&nbsp;<span class="op" id="4736821">==</span>&nbsp;<span class="ident" id="4736824">nil</span>&nbsp;<span class="op" id="4736828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4736832">req</span><span class="op" id="4736835">.</span><span class="ident" id="4736836">closeBody</span><span class="op" id="4736845">(</span><span class="op" id="4736846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736850">return</span>&nbsp;<span class="ident" id="4736857">nil</span><span class="op" id="4736860">,</span>&nbsp;<span class="ident" id="4736862">errors</span><span class="op" id="4736868">.</span><span class="ident" id="4736869">New</span><span class="op" id="4736872">(</span><span class="string" id="4736873">&#34;http:&nbsp;no&nbsp;Client.Transport&nbsp;or&nbsp;DefaultTransport&#34;</span><span class="op" id="4736920">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4736923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736927">if</span>&nbsp;<span class="ident" id="4736930">req</span><span class="op" id="4736933">.</span><span class="ident" id="4736934">URL</span>&nbsp;<span class="op" id="4736938">==</span>&nbsp;<span class="ident" id="4736941">nil</span>&nbsp;<span class="op" id="4736945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4736949">req</span><span class="op" id="4736952">.</span><span class="ident" id="4736953">closeBody</span><span class="op" id="4736962">(</span><span class="op" id="4736963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4736967">return</span>&nbsp;<span class="ident" id="4736974">nil</span><span class="op" id="4736977">,</span>&nbsp;<span class="ident" id="4736979">errors</span><span class="op" id="4736985">.</span><span class="ident" id="4736986">New</span><span class="op" id="4736989">(</span><span class="string" id="4736990">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="4737013">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4737016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4737020">if</span>&nbsp;<span class="ident" id="4737023">req</span><span class="op" id="4737026">.</span><span class="ident" id="4737027">RequestURI</span>&nbsp;<span class="op" id="4737038">!=</span>&nbsp;<span class="string" id="4737041">&#34;&#34;</span>&nbsp;<span class="op" id="4737044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4737048">req</span><span class="op" id="4737051">.</span><span class="ident" id="4737052">closeBody</span><span class="op" id="4737061">(</span><span class="op" id="4737062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4737066">return</span>&nbsp;<span class="ident" id="4737073">nil</span><span class="op" id="4737076">,</span>&nbsp;<span class="ident" id="4737078">errors</span><span class="op" id="4737084">.</span><span class="ident" id="4737085">New</span><span class="op" id="4737088">(</span><span class="string" id="4737089">&#34;http:&nbsp;Request.RequestURI&nbsp;can&#39;t&nbsp;be&nbsp;set&nbsp;in&nbsp;client&nbsp;requests.&#34;</span><span class="op" id="4737148">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4737151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4737155">//&nbsp;Most&nbsp;the&nbsp;callers&nbsp;of&nbsp;send&nbsp;(Get,&nbsp;Post,&nbsp;et&nbsp;al)&nbsp;don&#39;t&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4737214">//&nbsp;Headers,&nbsp;leaving&nbsp;it&nbsp;uninitialized.&nbsp;&nbsp;We&nbsp;guarantee&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4737274">//&nbsp;Transport&nbsp;that&nbsp;this&nbsp;has&nbsp;been&nbsp;initialized,&nbsp;though.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4737328">if</span>&nbsp;<span class="ident" id="4737331">req</span><span class="op" id="4737334">.</span><span class="ident" id="4737335">Header</span>&nbsp;<span class="op" id="4737342">==</span>&nbsp;<span class="ident" id="4737345">nil</span>&nbsp;<span class="op" id="4737349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4737353">req</span><span class="op" id="4737356">.</span><span class="ident" id="4737357">Header</span>&nbsp;<span class="op" id="4737364">=</span>&nbsp;<span class="builtinfunc" id="4737366">make</span><span class="op" id="4737370">(</span><span class="ident" id="4737371">Header</span><span class="op" id="4737377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4737380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4737384">if</span>&nbsp;<span class="ident" id="4737387">u</span>&nbsp;<span class="op" id="4737389">:=</span>&nbsp;<span class="ident" id="4737392">req</span><span class="op" id="4737395">.</span><span class="ident" id="4737396">URL</span><span class="op" id="4737399">.</span><span class="ident" id="4737400">User</span><span class="op" id="4737404">;</span>&nbsp;<span class="ident" id="4737406">u</span>&nbsp;<span class="op" id="4737408">!=</span>&nbsp;<span class="ident" id="4737411">nil</span>&nbsp;<span class="op" id="4737415">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4737419">username</span>&nbsp;<span class="op" id="4737428">:=</span>&nbsp;<span class="ident" id="4737431">u</span><span class="op" id="4737432">.</span><span class="ident" id="4737433">Username</span><span class="op" id="4737441">(</span><span class="op" id="4737442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4737446">password</span><span class="op" id="4737454">,</span>&nbsp;<span class="ident" id="4737456">_</span>&nbsp;<span class="op" id="4737458">:=</span>&nbsp;<span class="ident" id="4737461">u</span><span class="op" id="4737462">.</span><span class="ident" id="4737463">Password</span><span class="op" id="4737471">(</span><span class="op" id="4737472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4737476">req</span><span class="op" id="4737479">.</span><span class="ident" id="4737480">Header</span><span class="op" id="4737486">.</span><span class="ident" id="4737487">Set</span><span class="op" id="4737490">(</span><span class="string" id="4737491">&#34;Authorization&#34;</span><span class="op" id="4737506">,</span>&nbsp;<span class="string" id="4737508">&#34;Basic&nbsp;&#34;</span><span class="op" id="4737516">+</span><span class="ident" id="4737517">basicAuth</span><span class="op" id="4737526">(</span><span class="ident" id="4737527">username</span><span class="op" id="4737535">,</span>&nbsp;<span class="ident" id="4737537">password</span><span class="op" id="4737545">)</span><span class="op" id="4737546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4737549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4737552">resp</span><span class="op" id="4737556">,</span>&nbsp;<span class="ident" id="4737558">err</span>&nbsp;<span class="op" id="4737562">=</span>&nbsp;<span class="ident" id="4737564">t</span><span class="op" id="4737565">.</span><span class="ident" id="4737566">RoundTrip</span><span class="op" id="4737575">(</span><span class="ident" id="4737576">req</span><span class="op" id="4737579">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4737582">if</span>&nbsp;<span class="ident" id="4737585">err</span>&nbsp;<span class="op" id="4737589">!=</span>&nbsp;<span class="ident" id="4737592">nil</span>&nbsp;<span class="op" id="4737596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4737600">if</span>&nbsp;<span class="ident" id="4737603">resp</span>&nbsp;<span class="op" id="4737608">!=</span>&nbsp;<span class="ident" id="4737611">nil</span>&nbsp;<span class="op" id="4737615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4737620">log</span><span class="op" id="4737623">.</span><span class="ident" id="4737624">Printf</span><span class="op" id="4737630">(</span><span class="string" id="4737631">&#34;RoundTripper&nbsp;returned&nbsp;a&nbsp;response&nbsp;&amp;&nbsp;error;&nbsp;ignoring&nbsp;response&#34;</span><span class="op" id="4737692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4737696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4737700">return</span>&nbsp;<span class="ident" id="4737707">nil</span><span class="op" id="4737710">,</span>&nbsp;<span class="ident" id="4737712">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4737717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4737720">return</span>&nbsp;<span class="ident" id="4737727">resp</span><span class="op" id="4737731">,</span>&nbsp;<span class="ident" id="4737733">nil</span><br>
<span class="lineno"></span><span class="op" id="4737737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4737740">//&nbsp;See&nbsp;2&nbsp;(end&nbsp;of&nbsp;page&nbsp;4)&nbsp;http://www.ietf.org/rfc/rfc2617.txt</span><br>
<span class="lineno">230</span><span class="comment" id="4737801">//&nbsp;&#34;To&nbsp;receive&nbsp;authorization,&nbsp;the&nbsp;client&nbsp;sends&nbsp;the&nbsp;userid&nbsp;and&nbsp;password,</span><br>
<span class="lineno"></span><span class="comment" id="4737873">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;single&nbsp;colon&nbsp;(&#34;:&#34;)&nbsp;character,&nbsp;within&nbsp;a&nbsp;base64</span><br>
<span class="lineno"></span><span class="comment" id="4737937">//&nbsp;encoded&nbsp;string&nbsp;in&nbsp;the&nbsp;credentials.&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4737976">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;urlencoded.</span><br>
<span class="lineno"></span><span class="keyword" id="4738013">func</span>&nbsp;<span class="ident" id="4738018">basicAuth</span><span class="op" id="4738027">(</span><span class="ident" id="4738028">username</span><span class="op" id="4738036">,</span>&nbsp;<span class="ident" id="4738038">password</span>&nbsp;<span class="builtintype" id="4738047">string</span><span class="op" id="4738053">)</span>&nbsp;<span class="builtintype" id="4738055">string</span>&nbsp;<span class="op" id="4738062">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4738065">auth</span>&nbsp;<span class="op" id="4738070">:=</span>&nbsp;<span class="ident" id="4738073">username</span>&nbsp;<span class="op" id="4738082">+</span>&nbsp;<span class="string" id="4738084">&#34;:&#34;</span>&nbsp;<span class="op" id="4738088">+</span>&nbsp;<span class="ident" id="4738090">password</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738100">return</span>&nbsp;<span class="ident" id="4738107">base64</span><span class="op" id="4738113">.</span><span class="ident" id="4738114">StdEncoding</span><span class="op" id="4738125">.</span><span class="ident" id="4738126">EncodeToString</span><span class="op" id="4738140">(</span><span class="op" id="4738141">[</span><span class="op" id="4738142">]</span><span class="builtintype" id="4738143">byte</span><span class="op" id="4738147">(</span><span class="ident" id="4738148">auth</span><span class="op" id="4738152">)</span><span class="op" id="4738153">)</span><br>
<span class="lineno"></span><span class="op" id="4738155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4738158">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Get&nbsp;utility&nbsp;should</span><br>
<span class="lineno">240</span><span class="comment" id="4738240">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="4738267">func</span>&nbsp;<span class="ident" id="4738272">shouldRedirectGet</span><span class="op" id="4738289">(</span><span class="ident" id="4738290">statusCode</span>&nbsp;<span class="builtintype" id="4738301">int</span><span class="op" id="4738304">)</span>&nbsp;<span class="builtintype" id="4738306">bool</span>&nbsp;<span class="op" id="4738311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738314">switch</span>&nbsp;<span class="ident" id="4738321">statusCode</span>&nbsp;<span class="op" id="4738332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738335">case</span>&nbsp;<span class="ident" id="4738340">StatusMovedPermanently</span><span class="op" id="4738362">,</span>&nbsp;<span class="ident" id="4738364">StatusFound</span><span class="op" id="4738375">,</span>&nbsp;<span class="ident" id="4738377">StatusSeeOther</span><span class="op" id="4738391">,</span>&nbsp;<span class="ident" id="4738393">StatusTemporaryRedirect</span><span class="op" id="4738416">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738420">return</span>&nbsp;<span class="builtintype" id="4738427">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4738433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738436">return</span>&nbsp;<span class="builtintype" id="4738443">false</span><br>
<span class="lineno"></span><span class="op" id="4738449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4738452">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Post&nbsp;utility&nbsp;should</span><br>
<span class="lineno">250</span><span class="comment" id="4738535">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="4738562">func</span>&nbsp;<span class="ident" id="4738567">shouldRedirectPost</span><span class="op" id="4738585">(</span><span class="ident" id="4738586">statusCode</span>&nbsp;<span class="builtintype" id="4738597">int</span><span class="op" id="4738600">)</span>&nbsp;<span class="builtintype" id="4738602">bool</span>&nbsp;<span class="op" id="4738607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738610">switch</span>&nbsp;<span class="ident" id="4738617">statusCode</span>&nbsp;<span class="op" id="4738628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738631">case</span>&nbsp;<span class="ident" id="4738636">StatusFound</span><span class="op" id="4738647">,</span>&nbsp;<span class="ident" id="4738649">StatusSeeOther</span><span class="op" id="4738663">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738667">return</span>&nbsp;<span class="builtintype" id="4738674">true</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4738680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4738683">return</span>&nbsp;<span class="builtintype" id="4738690">false</span><br>
<span class="lineno"></span><span class="op" id="4738696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4738699">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="4738782">//&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect,&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;10&nbsp;redirects:</span><br>
<span class="lineno"></span><span class="comment" id="4738860">//</span><br>
<span class="lineno"></span><span class="comment" id="4738863">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="4738893">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="4738911">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">265</span><span class="comment" id="4738933">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="4738964">//</span><br>
<span class="lineno"></span><span class="comment" id="4738967">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;there&nbsp;were&nbsp;too&nbsp;many&nbsp;redirects&nbsp;or&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="4739036">//&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="4739103">//&nbsp;error.</span><br>
<span class="lineno">270</span><span class="comment" id="4739113">//</span><br>
<span class="lineno"></span><span class="comment" id="4739116">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="4739178">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4739238">//</span><br>
<span class="lineno"></span><span class="comment" id="4739241">//&nbsp;Get&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Get.</span><br>
<span class="lineno">275</span><span class="keyword" id="4739287">func</span>&nbsp;<span class="ident" id="4739292">Get</span><span class="op" id="4739295">(</span><span class="ident" id="4739296">url</span>&nbsp;<span class="builtintype" id="4739300">string</span><span class="op" id="4739306">)</span>&nbsp;<span class="op" id="4739308">(</span><span class="ident" id="4739309">resp</span>&nbsp;<span class="op" id="4739314">*</span><span class="ident" id="4739315">Response</span><span class="op" id="4739323">,</span>&nbsp;<span class="ident" id="4739325">err</span>&nbsp;<span class="builtintype" id="4739329">error</span><span class="op" id="4739334">)</span>&nbsp;<span class="op" id="4739336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4739339">return</span>&nbsp;<span class="ident" id="4739346">DefaultClient</span><span class="op" id="4739359">.</span><span class="ident" id="4739360">Get</span><span class="op" id="4739363">(</span><span class="ident" id="4739364">url</span><span class="op" id="4739367">)</span><br>
<span class="lineno"></span><span class="op" id="4739369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4739372">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">280</span><span class="comment" id="4739445">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4739517">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="4739553">//</span><br>
<span class="lineno"></span><span class="comment" id="4739556">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="4739586">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">285</span><span class="comment" id="4739604">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="4739626">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="4739657">//</span><br>
<span class="lineno"></span><span class="comment" id="4739660">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;the&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function&nbsp;fails</span><br>
<span class="lineno"></span><span class="comment" id="4739729">//&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t</span><br>
<span class="lineno">290</span><span class="comment" id="4739799">//&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4739818">//</span><br>
<span class="lineno"></span><span class="comment" id="4739821">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="4739883">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4739943">func</span>&nbsp;<span class="op" id="4739948">(</span><span class="ident" id="4739949">c</span>&nbsp;<span class="op" id="4739951">*</span><span class="ident" id="4739952">Client</span><span class="op" id="4739958">)</span>&nbsp;<span class="ident" id="4739960">Get</span><span class="op" id="4739963">(</span><span class="ident" id="4739964">url</span>&nbsp;<span class="builtintype" id="4739968">string</span><span class="op" id="4739974">)</span>&nbsp;<span class="op" id="4739976">(</span><span class="ident" id="4739977">resp</span>&nbsp;<span class="op" id="4739982">*</span><span class="ident" id="4739983">Response</span><span class="op" id="4739991">,</span>&nbsp;<span class="ident" id="4739993">err</span>&nbsp;<span class="builtintype" id="4739997">error</span><span class="op" id="4740002">)</span>&nbsp;<span class="op" id="4740004">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740007">req</span><span class="op" id="4740010">,</span>&nbsp;<span class="ident" id="4740012">err</span>&nbsp;<span class="op" id="4740016">:=</span>&nbsp;<span class="ident" id="4740019">NewRequest</span><span class="op" id="4740029">(</span><span class="string" id="4740030">&#34;GET&#34;</span><span class="op" id="4740035">,</span>&nbsp;<span class="ident" id="4740037">url</span><span class="op" id="4740040">,</span>&nbsp;<span class="ident" id="4740042">nil</span><span class="op" id="4740045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740048">if</span>&nbsp;<span class="ident" id="4740051">err</span>&nbsp;<span class="op" id="4740055">!=</span>&nbsp;<span class="ident" id="4740058">nil</span>&nbsp;<span class="op" id="4740062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740066">return</span>&nbsp;<span class="ident" id="4740073">nil</span><span class="op" id="4740076">,</span>&nbsp;<span class="ident" id="4740078">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4740083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740086">return</span>&nbsp;<span class="ident" id="4740093">c</span><span class="op" id="4740094">.</span><span class="ident" id="4740095">doFollowingRedirects</span><span class="op" id="4740115">(</span><span class="ident" id="4740116">req</span><span class="op" id="4740119">,</span>&nbsp;<span class="ident" id="4740121">shouldRedirectGet</span><span class="op" id="4740138">)</span><br>
<span class="lineno">300</span><span class="op" id="4740140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4740143">func</span>&nbsp;<span class="op" id="4740148">(</span><span class="ident" id="4740149">c</span>&nbsp;<span class="op" id="4740151">*</span><span class="ident" id="4740152">Client</span><span class="op" id="4740158">)</span>&nbsp;<span class="ident" id="4740160">doFollowingRedirects</span><span class="op" id="4740180">(</span><span class="ident" id="4740181">ireq</span>&nbsp;<span class="op" id="4740186">*</span><span class="ident" id="4740187">Request</span><span class="op" id="4740194">,</span>&nbsp;<span class="ident" id="4740196">shouldRedirect</span>&nbsp;<span class="keyword" id="4740211">func</span><span class="op" id="4740215">(</span><span class="builtintype" id="4740216">int</span><span class="op" id="4740219">)</span>&nbsp;<span class="builtintype" id="4740221">bool</span><span class="op" id="4740225">)</span>&nbsp;<span class="op" id="4740227">(</span><span class="ident" id="4740228">resp</span>&nbsp;<span class="op" id="4740233">*</span><span class="ident" id="4740234">Response</span><span class="op" id="4740242">,</span>&nbsp;<span class="ident" id="4740244">err</span>&nbsp;<span class="builtintype" id="4740248">error</span><span class="op" id="4740253">)</span>&nbsp;<span class="op" id="4740255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740258">var</span>&nbsp;<span class="ident" id="4740262">base</span>&nbsp;<span class="op" id="4740267">*</span><span class="ident" id="4740268">url</span><span class="op" id="4740271">.</span><span class="ident" id="4740272">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740277">redirectChecker</span>&nbsp;<span class="op" id="4740293">:=</span>&nbsp;<span class="ident" id="4740296">c</span><span class="op" id="4740297">.</span><span class="ident" id="4740298">CheckRedirect</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740313">if</span>&nbsp;<span class="ident" id="4740316">redirectChecker</span>&nbsp;<span class="op" id="4740332">==</span>&nbsp;<span class="ident" id="4740335">nil</span>&nbsp;<span class="op" id="4740339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740343">redirectChecker</span>&nbsp;<span class="op" id="4740359">=</span>&nbsp;<span class="ident" id="4740361">defaultCheckRedirect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4740383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740386">var</span>&nbsp;<span class="ident" id="4740390">via</span>&nbsp;<span class="op" id="4740394">[</span><span class="op" id="4740395">]</span><span class="op" id="4740396">*</span><span class="ident" id="4740397">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740407">if</span>&nbsp;<span class="ident" id="4740410">ireq</span><span class="op" id="4740414">.</span><span class="ident" id="4740415">URL</span>&nbsp;<span class="op" id="4740419">==</span>&nbsp;<span class="ident" id="4740422">nil</span>&nbsp;<span class="op" id="4740426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740430">ireq</span><span class="op" id="4740434">.</span><span class="ident" id="4740435">closeBody</span><span class="op" id="4740444">(</span><span class="op" id="4740445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740449">return</span>&nbsp;<span class="ident" id="4740456">nil</span><span class="op" id="4740459">,</span>&nbsp;<span class="ident" id="4740461">errors</span><span class="op" id="4740467">.</span><span class="ident" id="4740468">New</span><span class="op" id="4740471">(</span><span class="string" id="4740472">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="4740495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4740498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740502">var</span>&nbsp;<span class="ident" id="4740506">reqmu</span>&nbsp;<span class="ident" id="4740512">sync</span><span class="op" id="4740516">.</span><span class="ident" id="4740517">Mutex</span>&nbsp;<span class="comment" id="4740523">//&nbsp;guards&nbsp;req</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740538">req</span>&nbsp;<span class="op" id="4740542">:=</span>&nbsp;<span class="ident" id="4740545">ireq</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740552">var</span>&nbsp;<span class="ident" id="4740556">timer</span>&nbsp;<span class="op" id="4740562">*</span><span class="ident" id="4740563">time</span><span class="op" id="4740567">.</span><span class="ident" id="4740568">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740575">if</span>&nbsp;<span class="ident" id="4740578">c</span><span class="op" id="4740579">.</span><span class="ident" id="4740580">Timeout</span>&nbsp;<span class="op" id="4740588">&gt;</span>&nbsp;<span class="num" id="4740590">0</span>&nbsp;<span class="op" id="4740592">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740596">type</span>&nbsp;<span class="ident" id="4740601">canceler</span>&nbsp;<span class="keyword" id="4740610">interface</span>&nbsp;<span class="op" id="4740620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740625">CancelRequest</span><span class="op" id="4740638">(</span><span class="op" id="4740639">*</span><span class="ident" id="4740640">Request</span><span class="op" id="4740647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4740651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740655">tr</span><span class="op" id="4740657">,</span>&nbsp;<span class="ident" id="4740659">ok</span>&nbsp;<span class="op" id="4740662">:=</span>&nbsp;<span class="ident" id="4740665">c</span><span class="op" id="4740666">.</span><span class="ident" id="4740667">transport</span><span class="op" id="4740676">(</span><span class="op" id="4740677">)</span><span class="op" id="4740678">.</span><span class="op" id="4740679">(</span><span class="ident" id="4740680">canceler</span><span class="op" id="4740688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740692">if</span>&nbsp;<span class="op" id="4740695">!</span><span class="ident" id="4740696">ok</span>&nbsp;<span class="op" id="4740699">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740704">return</span>&nbsp;<span class="ident" id="4740711">nil</span><span class="op" id="4740714">,</span>&nbsp;<span class="ident" id="4740716">fmt</span><span class="op" id="4740719">.</span><span class="ident" id="4740720">Errorf</span><span class="op" id="4740726">(</span><span class="string" id="4740727">&#34;net/http:&nbsp;Client&nbsp;Transport&nbsp;of&nbsp;type&nbsp;%T&nbsp;doesn&#39;t&nbsp;support&nbsp;CancelRequest;&nbsp;Timeout&nbsp;not&nbsp;supported&#34;</span><span class="op" id="4740819">,</span>&nbsp;<span class="ident" id="4740821">c</span><span class="op" id="4740822">.</span><span class="ident" id="4740823">transport</span><span class="op" id="4740832">(</span><span class="op" id="4740833">)</span><span class="op" id="4740834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4740838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740842">timer</span>&nbsp;<span class="op" id="4740848">=</span>&nbsp;<span class="ident" id="4740850">time</span><span class="op" id="4740854">.</span><span class="ident" id="4740855">AfterFunc</span><span class="op" id="4740864">(</span><span class="ident" id="4740865">c</span><span class="op" id="4740866">.</span><span class="ident" id="4740867">Timeout</span><span class="op" id="4740874">,</span>&nbsp;<span class="keyword" id="4740876">func</span><span class="op" id="4740880">(</span><span class="op" id="4740881">)</span>&nbsp;<span class="op" id="4740883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740888">reqmu</span><span class="op" id="4740893">.</span><span class="ident" id="4740894">Lock</span><span class="op" id="4740898">(</span><span class="op" id="4740899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740904">defer</span>&nbsp;<span class="ident" id="4740910">reqmu</span><span class="op" id="4740915">.</span><span class="ident" id="4740916">Unlock</span><span class="op" id="4740922">(</span><span class="op" id="4740923">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740928">tr</span><span class="op" id="4740930">.</span><span class="ident" id="4740931">CancelRequest</span><span class="op" id="4740944">(</span><span class="ident" id="4740945">req</span><span class="op" id="4740948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4740952">}</span><span class="op" id="4740953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4740956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740960">urlStr</span>&nbsp;<span class="op" id="4740967">:=</span>&nbsp;<span class="string" id="4740970">&#34;&#34;</span>&nbsp;<span class="comment" id="4740973">//&nbsp;next&nbsp;relative&nbsp;or&nbsp;absolute&nbsp;URL&nbsp;to&nbsp;fetch&nbsp;(after&nbsp;first&nbsp;request)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741038">redirectFailed</span>&nbsp;<span class="op" id="4741053">:=</span>&nbsp;<span class="builtintype" id="4741056">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741063">for</span>&nbsp;<span class="ident" id="4741067">redirect</span>&nbsp;<span class="op" id="4741076">:=</span>&nbsp;<span class="num" id="4741079">0</span><span class="op" id="4741080">;</span>&nbsp;<span class="op" id="4741082">;</span>&nbsp;<span class="ident" id="4741084">redirect</span><span class="op" id="4741092">++</span>&nbsp;<span class="op" id="4741095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741099">if</span>&nbsp;<span class="ident" id="4741102">redirect</span>&nbsp;<span class="op" id="4741111">!=</span>&nbsp;<span class="num" id="4741114">0</span>&nbsp;<span class="op" id="4741116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741121">nreq</span>&nbsp;<span class="op" id="4741126">:=</span>&nbsp;<span class="builtinfunc" id="4741129">new</span><span class="op" id="4741132">(</span><span class="ident" id="4741133">Request</span><span class="op" id="4741140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741145">nreq</span><span class="op" id="4741149">.</span><span class="ident" id="4741150">Method</span>&nbsp;<span class="op" id="4741157">=</span>&nbsp;<span class="ident" id="4741159">ireq</span><span class="op" id="4741163">.</span><span class="ident" id="4741164">Method</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741174">if</span>&nbsp;<span class="ident" id="4741177">ireq</span><span class="op" id="4741181">.</span><span class="ident" id="4741182">Method</span>&nbsp;<span class="op" id="4741189">==</span>&nbsp;<span class="string" id="4741192">&#34;POST&#34;</span>&nbsp;<span class="op" id="4741199">||</span>&nbsp;<span class="ident" id="4741202">ireq</span><span class="op" id="4741206">.</span><span class="ident" id="4741207">Method</span>&nbsp;<span class="op" id="4741214">==</span>&nbsp;<span class="string" id="4741217">&#34;PUT&#34;</span>&nbsp;<span class="op" id="4741223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741229">nreq</span><span class="op" id="4741233">.</span><span class="ident" id="4741234">Method</span>&nbsp;<span class="op" id="4741241">=</span>&nbsp;<span class="string" id="4741243">&#34;GET&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4741252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741257">nreq</span><span class="op" id="4741261">.</span><span class="ident" id="4741262">Header</span>&nbsp;<span class="op" id="4741269">=</span>&nbsp;<span class="builtinfunc" id="4741271">make</span><span class="op" id="4741275">(</span><span class="ident" id="4741276">Header</span><span class="op" id="4741282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741287">nreq</span><span class="op" id="4741291">.</span><span class="ident" id="4741292">URL</span><span class="op" id="4741295">,</span>&nbsp;<span class="ident" id="4741297">err</span>&nbsp;<span class="op" id="4741301">=</span>&nbsp;<span class="ident" id="4741303">base</span><span class="op" id="4741307">.</span><span class="ident" id="4741308">Parse</span><span class="op" id="4741313">(</span><span class="ident" id="4741314">urlStr</span><span class="op" id="4741320">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741325">if</span>&nbsp;<span class="ident" id="4741328">err</span>&nbsp;<span class="op" id="4741332">!=</span>&nbsp;<span class="ident" id="4741335">nil</span>&nbsp;<span class="op" id="4741339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741345">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4741354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741359">if</span>&nbsp;<span class="builtinfunc" id="4741362">len</span><span class="op" id="4741365">(</span><span class="ident" id="4741366">via</span><span class="op" id="4741369">)</span>&nbsp;<span class="op" id="4741371">&gt;</span>&nbsp;<span class="num" id="4741373">0</span>&nbsp;<span class="op" id="4741375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4741381">//&nbsp;Add&nbsp;the&nbsp;Referer&nbsp;header.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741412">lastReq</span>&nbsp;<span class="op" id="4741420">:=</span>&nbsp;<span class="ident" id="4741423">via</span><span class="op" id="4741426">[</span><span class="builtinfunc" id="4741427">len</span><span class="op" id="4741430">(</span><span class="ident" id="4741431">via</span><span class="op" id="4741434">)</span><span class="op" id="4741435">-</span><span class="num" id="4741436">1</span><span class="op" id="4741437">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741443">if</span>&nbsp;<span class="ident" id="4741446">ref</span>&nbsp;<span class="op" id="4741450">:=</span>&nbsp;<span class="ident" id="4741453">refererForURL</span><span class="op" id="4741466">(</span><span class="ident" id="4741467">lastReq</span><span class="op" id="4741474">.</span><span class="ident" id="4741475">URL</span><span class="op" id="4741478">,</span>&nbsp;<span class="ident" id="4741480">nreq</span><span class="op" id="4741484">.</span><span class="ident" id="4741485">URL</span><span class="op" id="4741488">)</span><span class="op" id="4741489">;</span>&nbsp;<span class="ident" id="4741491">ref</span>&nbsp;<span class="op" id="4741495">!=</span>&nbsp;<span class="string" id="4741498">&#34;&#34;</span>&nbsp;<span class="op" id="4741501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741508">nreq</span><span class="op" id="4741512">.</span><span class="ident" id="4741513">Header</span><span class="op" id="4741519">.</span><span class="ident" id="4741520">Set</span><span class="op" id="4741523">(</span><span class="string" id="4741524">&#34;Referer&#34;</span><span class="op" id="4741533">,</span>&nbsp;<span class="ident" id="4741535">ref</span><span class="op" id="4741538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4741544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741551">err</span>&nbsp;<span class="op" id="4741555">=</span>&nbsp;<span class="ident" id="4741557">redirectChecker</span><span class="op" id="4741572">(</span><span class="ident" id="4741573">nreq</span><span class="op" id="4741577">,</span>&nbsp;<span class="ident" id="4741579">via</span><span class="op" id="4741582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741588">if</span>&nbsp;<span class="ident" id="4741591">err</span>&nbsp;<span class="op" id="4741595">!=</span>&nbsp;<span class="ident" id="4741598">nil</span>&nbsp;<span class="op" id="4741602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741609">redirectFailed</span>&nbsp;<span class="op" id="4741624">=</span>&nbsp;<span class="builtintype" id="4741626">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741636">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4741646">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4741651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741656">reqmu</span><span class="op" id="4741661">.</span><span class="ident" id="4741662">Lock</span><span class="op" id="4741666">(</span><span class="op" id="4741667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741672">req</span>&nbsp;<span class="op" id="4741676">=</span>&nbsp;<span class="ident" id="4741678">nreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741686">reqmu</span><span class="op" id="4741691">.</span><span class="ident" id="4741692">Unlock</span><span class="op" id="4741698">(</span><span class="op" id="4741699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4741703">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741708">urlStr</span>&nbsp;<span class="op" id="4741715">=</span>&nbsp;<span class="ident" id="4741717">req</span><span class="op" id="4741720">.</span><span class="ident" id="4741721">URL</span><span class="op" id="4741724">.</span><span class="ident" id="4741725">String</span><span class="op" id="4741731">(</span><span class="op" id="4741732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741736">if</span>&nbsp;<span class="ident" id="4741739">resp</span><span class="op" id="4741743">,</span>&nbsp;<span class="ident" id="4741745">err</span>&nbsp;<span class="op" id="4741749">=</span>&nbsp;<span class="ident" id="4741751">c</span><span class="op" id="4741752">.</span><span class="ident" id="4741753">send</span><span class="op" id="4741757">(</span><span class="ident" id="4741758">req</span><span class="op" id="4741761">)</span><span class="op" id="4741762">;</span>&nbsp;<span class="ident" id="4741764">err</span>&nbsp;<span class="op" id="4741768">!=</span>&nbsp;<span class="ident" id="4741771">nil</span>&nbsp;<span class="op" id="4741775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741780">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4741788">}</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741793">if</span>&nbsp;<span class="ident" id="4741796">shouldRedirect</span><span class="op" id="4741810">(</span><span class="ident" id="4741811">resp</span><span class="op" id="4741815">.</span><span class="ident" id="4741816">StatusCode</span><span class="op" id="4741826">)</span>&nbsp;<span class="op" id="4741828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4741833">//&nbsp;Read&nbsp;the&nbsp;body&nbsp;if&nbsp;small&nbsp;so&nbsp;underlying&nbsp;TCP&nbsp;connection&nbsp;will&nbsp;be&nbsp;re-used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4741908">//&nbsp;No&nbsp;need&nbsp;to&nbsp;check&nbsp;for&nbsp;errors:&nbsp;if&nbsp;it&nbsp;fails,&nbsp;Transport&nbsp;won&#39;t&nbsp;reuse&nbsp;it&nbsp;anyway.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741989">const</span>&nbsp;<span class="ident" id="4741995">maxBodySlurpSize</span>&nbsp;<span class="op" id="4742012">=</span>&nbsp;<span class="num" id="4742014">2</span>&nbsp;<span class="op" id="4742016">&lt;&lt;</span>&nbsp;<span class="num" id="4742019">10</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742025">if</span>&nbsp;<span class="ident" id="4742028">resp</span><span class="op" id="4742032">.</span><span class="ident" id="4742033">ContentLength</span>&nbsp;<span class="op" id="4742047">==</span>&nbsp;<span class="op" id="4742050">-</span><span class="num" id="4742051">1</span>&nbsp;<span class="op" id="4742053">||</span>&nbsp;<span class="ident" id="4742056">resp</span><span class="op" id="4742060">.</span><span class="ident" id="4742061">ContentLength</span>&nbsp;<span class="op" id="4742075">&lt;=</span>&nbsp;<span class="ident" id="4742078">maxBodySlurpSize</span>&nbsp;<span class="op" id="4742095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742101">io</span><span class="op" id="4742103">.</span><span class="ident" id="4742104">CopyN</span><span class="op" id="4742109">(</span><span class="ident" id="4742110">ioutil</span><span class="op" id="4742116">.</span><span class="ident" id="4742117">Discard</span><span class="op" id="4742124">,</span>&nbsp;<span class="ident" id="4742126">resp</span><span class="op" id="4742130">.</span><span class="ident" id="4742131">Body</span><span class="op" id="4742135">,</span>&nbsp;<span class="ident" id="4742137">maxBodySlurpSize</span><span class="op" id="4742153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4742158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742163">resp</span><span class="op" id="4742167">.</span><span class="ident" id="4742168">Body</span><span class="op" id="4742172">.</span><span class="ident" id="4742173">Close</span><span class="op" id="4742178">(</span><span class="op" id="4742179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742184">if</span>&nbsp;<span class="ident" id="4742187">urlStr</span>&nbsp;<span class="op" id="4742194">=</span>&nbsp;<span class="ident" id="4742196">resp</span><span class="op" id="4742200">.</span><span class="ident" id="4742201">Header</span><span class="op" id="4742207">.</span><span class="ident" id="4742208">Get</span><span class="op" id="4742211">(</span><span class="string" id="4742212">&#34;Location&#34;</span><span class="op" id="4742222">)</span><span class="op" id="4742223">;</span>&nbsp;<span class="ident" id="4742225">urlStr</span>&nbsp;<span class="op" id="4742232">==</span>&nbsp;<span class="string" id="4742235">&#34;&#34;</span>&nbsp;<span class="op" id="4742238">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742244">err</span>&nbsp;<span class="op" id="4742248">=</span>&nbsp;<span class="ident" id="4742250">errors</span><span class="op" id="4742256">.</span><span class="ident" id="4742257">New</span><span class="op" id="4742260">(</span><span class="ident" id="4742261">fmt</span><span class="op" id="4742264">.</span><span class="ident" id="4742265">Sprintf</span><span class="op" id="4742272">(</span><span class="string" id="4742273">&#34;%d&nbsp;response&nbsp;missing&nbsp;Location&nbsp;header&#34;</span><span class="op" id="4742310">,</span>&nbsp;<span class="ident" id="4742312">resp</span><span class="op" id="4742316">.</span><span class="ident" id="4742317">StatusCode</span><span class="op" id="4742327">)</span><span class="op" id="4742328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742334">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4742343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742348">base</span>&nbsp;<span class="op" id="4742353">=</span>&nbsp;<span class="ident" id="4742355">req</span><span class="op" id="4742358">.</span><span class="ident" id="4742359">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742366">via</span>&nbsp;<span class="op" id="4742370">=</span>&nbsp;<span class="builtinfunc" id="4742372">append</span><span class="op" id="4742378">(</span><span class="ident" id="4742379">via</span><span class="op" id="4742382">,</span>&nbsp;<span class="ident" id="4742384">req</span><span class="op" id="4742387">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742392">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4742403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742407">if</span>&nbsp;<span class="ident" id="4742410">timer</span>&nbsp;<span class="op" id="4742416">!=</span>&nbsp;<span class="ident" id="4742419">nil</span>&nbsp;<span class="op" id="4742423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742428">resp</span><span class="op" id="4742432">.</span><span class="ident" id="4742433">Body</span>&nbsp;<span class="op" id="4742438">=</span>&nbsp;<span class="op" id="4742440">&amp;</span><span class="ident" id="4742441">cancelTimerBody</span><span class="op" id="4742456">{</span><span class="ident" id="4742457">timer</span><span class="op" id="4742462">,</span>&nbsp;<span class="ident" id="4742464">resp</span><span class="op" id="4742468">.</span><span class="ident" id="4742469">Body</span><span class="op" id="4742473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4742477">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742481">return</span>&nbsp;<span class="ident" id="4742488">resp</span><span class="op" id="4742492">,</span>&nbsp;<span class="ident" id="4742494">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4742499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742503">method</span>&nbsp;<span class="op" id="4742510">:=</span>&nbsp;<span class="ident" id="4742513">ireq</span><span class="op" id="4742517">.</span><span class="ident" id="4742518">Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742526">urlErr</span>&nbsp;<span class="op" id="4742533">:=</span>&nbsp;<span class="op" id="4742536">&amp;</span><span class="ident" id="4742537">url</span><span class="op" id="4742540">.</span><span class="ident" id="4742541">Error</span><span class="op" id="4742546">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742550">Op</span><span class="op" id="4742552">:</span>&nbsp;&nbsp;<span class="ident" id="4742555">method</span><span class="op" id="4742561">[</span><span class="num" id="4742562">0</span><span class="op" id="4742563">:</span><span class="num" id="4742564">1</span><span class="op" id="4742565">]</span>&nbsp;<span class="op" id="4742567">+</span>&nbsp;<span class="ident" id="4742569">strings</span><span class="op" id="4742576">.</span><span class="ident" id="4742577">ToLower</span><span class="op" id="4742584">(</span><span class="ident" id="4742585">method</span><span class="op" id="4742591">[</span><span class="num" id="4742592">1</span><span class="op" id="4742593">:</span><span class="op" id="4742594">]</span><span class="op" id="4742595">)</span><span class="op" id="4742596">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742600">URL</span><span class="op" id="4742603">:</span>&nbsp;<span class="ident" id="4742605">urlStr</span><span class="op" id="4742611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742615">Err</span><span class="op" id="4742618">:</span>&nbsp;<span class="ident" id="4742620">err</span><span class="op" id="4742623">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4742626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742630">if</span>&nbsp;<span class="ident" id="4742633">redirectFailed</span>&nbsp;<span class="op" id="4742648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4742652">//&nbsp;Special&nbsp;case&nbsp;for&nbsp;Go&nbsp;1&nbsp;compatibility:&nbsp;return&nbsp;both&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4742719">//&nbsp;and&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;CheckRedirect&nbsp;function&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4742775">//&nbsp;See&nbsp;http://golang.org/issue/3795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742813">return</span>&nbsp;<span class="ident" id="4742820">resp</span><span class="op" id="4742824">,</span>&nbsp;<span class="ident" id="4742826">urlErr</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4742834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742838">if</span>&nbsp;<span class="ident" id="4742841">resp</span>&nbsp;<span class="op" id="4742846">!=</span>&nbsp;<span class="ident" id="4742849">nil</span>&nbsp;<span class="op" id="4742853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742857">resp</span><span class="op" id="4742861">.</span><span class="ident" id="4742862">Body</span><span class="op" id="4742866">.</span><span class="ident" id="4742867">Close</span><span class="op" id="4742872">(</span><span class="op" id="4742873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4742876">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742879">return</span>&nbsp;<span class="ident" id="4742886">nil</span><span class="op" id="4742889">,</span>&nbsp;<span class="ident" id="4742891">urlErr</span><br>
<span class="lineno"></span><span class="op" id="4742898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4742901">func</span>&nbsp;<span class="ident" id="4742906">defaultCheckRedirect</span><span class="op" id="4742926">(</span><span class="ident" id="4742927">req</span>&nbsp;<span class="op" id="4742931">*</span><span class="ident" id="4742932">Request</span><span class="op" id="4742939">,</span>&nbsp;<span class="ident" id="4742941">via</span>&nbsp;<span class="op" id="4742945">[</span><span class="op" id="4742946">]</span><span class="op" id="4742947">*</span><span class="ident" id="4742948">Request</span><span class="op" id="4742955">)</span>&nbsp;<span class="builtintype" id="4742957">error</span>&nbsp;<span class="op" id="4742963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742966">if</span>&nbsp;<span class="builtinfunc" id="4742969">len</span><span class="op" id="4742972">(</span><span class="ident" id="4742973">via</span><span class="op" id="4742976">)</span>&nbsp;<span class="op" id="4742978">&gt;=</span>&nbsp;<span class="num" id="4742981">10</span>&nbsp;<span class="op" id="4742984">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742988">return</span>&nbsp;<span class="ident" id="4742995">errors</span><span class="op" id="4743001">.</span><span class="ident" id="4743002">New</span><span class="op" id="4743005">(</span><span class="string" id="4743006">&#34;stopped&nbsp;after&nbsp;10&nbsp;redirects&#34;</span><span class="op" id="4743034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4743037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743040">return</span>&nbsp;<span class="ident" id="4743047">nil</span><br>
<span class="lineno"></span><span class="op" id="4743051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="4743054">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno"></span><span class="comment" id="4743098">//</span><br>
<span class="lineno"></span><span class="comment" id="4743101">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4743161">//</span><br>
<span class="lineno"></span><span class="comment" id="4743164">//&nbsp;Post&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Post</span><br>
<span class="lineno">425</span><span class="keyword" id="4743211">func</span>&nbsp;<span class="ident" id="4743216">Post</span><span class="op" id="4743220">(</span><span class="ident" id="4743221">url</span>&nbsp;<span class="builtintype" id="4743225">string</span><span class="op" id="4743231">,</span>&nbsp;<span class="ident" id="4743233">bodyType</span>&nbsp;<span class="builtintype" id="4743242">string</span><span class="op" id="4743248">,</span>&nbsp;<span class="ident" id="4743250">body</span>&nbsp;<span class="ident" id="4743255">io</span><span class="op" id="4743257">.</span><span class="ident" id="4743258">Reader</span><span class="op" id="4743264">)</span>&nbsp;<span class="op" id="4743266">(</span><span class="ident" id="4743267">resp</span>&nbsp;<span class="op" id="4743272">*</span><span class="ident" id="4743273">Response</span><span class="op" id="4743281">,</span>&nbsp;<span class="ident" id="4743283">err</span>&nbsp;<span class="builtintype" id="4743287">error</span><span class="op" id="4743292">)</span>&nbsp;<span class="op" id="4743294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743297">return</span>&nbsp;<span class="ident" id="4743304">DefaultClient</span><span class="op" id="4743317">.</span><span class="ident" id="4743318">Post</span><span class="op" id="4743322">(</span><span class="ident" id="4743323">url</span><span class="op" id="4743326">,</span>&nbsp;<span class="ident" id="4743328">bodyType</span><span class="op" id="4743336">,</span>&nbsp;<span class="ident" id="4743338">body</span><span class="op" id="4743342">)</span><br>
<span class="lineno"></span><span class="op" id="4743344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4743347">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno">430</span><span class="comment" id="4743391">//</span><br>
<span class="lineno"></span><span class="comment" id="4743394">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4743454">//</span><br>
<span class="lineno"></span><span class="comment" id="4743457">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;it&nbsp;is&nbsp;closed&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4743526">//&nbsp;request.</span><br>
<span class="lineno">435</span><span class="keyword" id="4743538">func</span>&nbsp;<span class="op" id="4743543">(</span><span class="ident" id="4743544">c</span>&nbsp;<span class="op" id="4743546">*</span><span class="ident" id="4743547">Client</span><span class="op" id="4743553">)</span>&nbsp;<span class="ident" id="4743555">Post</span><span class="op" id="4743559">(</span><span class="ident" id="4743560">url</span>&nbsp;<span class="builtintype" id="4743564">string</span><span class="op" id="4743570">,</span>&nbsp;<span class="ident" id="4743572">bodyType</span>&nbsp;<span class="builtintype" id="4743581">string</span><span class="op" id="4743587">,</span>&nbsp;<span class="ident" id="4743589">body</span>&nbsp;<span class="ident" id="4743594">io</span><span class="op" id="4743596">.</span><span class="ident" id="4743597">Reader</span><span class="op" id="4743603">)</span>&nbsp;<span class="op" id="4743605">(</span><span class="ident" id="4743606">resp</span>&nbsp;<span class="op" id="4743611">*</span><span class="ident" id="4743612">Response</span><span class="op" id="4743620">,</span>&nbsp;<span class="ident" id="4743622">err</span>&nbsp;<span class="builtintype" id="4743626">error</span><span class="op" id="4743631">)</span>&nbsp;<span class="op" id="4743633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743636">req</span><span class="op" id="4743639">,</span>&nbsp;<span class="ident" id="4743641">err</span>&nbsp;<span class="op" id="4743645">:=</span>&nbsp;<span class="ident" id="4743648">NewRequest</span><span class="op" id="4743658">(</span><span class="string" id="4743659">&#34;POST&#34;</span><span class="op" id="4743665">,</span>&nbsp;<span class="ident" id="4743667">url</span><span class="op" id="4743670">,</span>&nbsp;<span class="ident" id="4743672">body</span><span class="op" id="4743676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743679">if</span>&nbsp;<span class="ident" id="4743682">err</span>&nbsp;<span class="op" id="4743686">!=</span>&nbsp;<span class="ident" id="4743689">nil</span>&nbsp;<span class="op" id="4743693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743697">return</span>&nbsp;<span class="ident" id="4743704">nil</span><span class="op" id="4743707">,</span>&nbsp;<span class="ident" id="4743709">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4743714">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743717">req</span><span class="op" id="4743720">.</span><span class="ident" id="4743721">Header</span><span class="op" id="4743727">.</span><span class="ident" id="4743728">Set</span><span class="op" id="4743731">(</span><span class="string" id="4743732">&#34;Content-Type&#34;</span><span class="op" id="4743746">,</span>&nbsp;<span class="ident" id="4743748">bodyType</span><span class="op" id="4743756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743759">return</span>&nbsp;<span class="ident" id="4743766">c</span><span class="op" id="4743767">.</span><span class="ident" id="4743768">doFollowingRedirects</span><span class="op" id="4743788">(</span><span class="ident" id="4743789">req</span><span class="op" id="4743792">,</span>&nbsp;<span class="ident" id="4743794">shouldRedirectPost</span><span class="op" id="4743812">)</span><br>
<span class="lineno"></span><span class="op" id="4743814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4743817">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and</span><br>
<span class="lineno">445</span><span class="comment" id="4743886">//&nbsp;values&nbsp;URL-encoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="4743929">//</span><br>
<span class="lineno"></span><span class="comment" id="4743932">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="4743994">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4744054">//</span><br>
<span class="lineno">450</span><span class="comment" id="4744057">//&nbsp;PostForm&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.PostForm</span><br>
<span class="lineno"></span><span class="keyword" id="4744112">func</span>&nbsp;<span class="ident" id="4744117">PostForm</span><span class="op" id="4744125">(</span><span class="ident" id="4744126">url</span>&nbsp;<span class="builtintype" id="4744130">string</span><span class="op" id="4744136">,</span>&nbsp;<span class="ident" id="4744138">data</span>&nbsp;<span class="ident" id="4744143">url</span><span class="op" id="4744146">.</span><span class="ident" id="4744147">Values</span><span class="op" id="4744153">)</span>&nbsp;<span class="op" id="4744155">(</span><span class="ident" id="4744156">resp</span>&nbsp;<span class="op" id="4744161">*</span><span class="ident" id="4744162">Response</span><span class="op" id="4744170">,</span>&nbsp;<span class="ident" id="4744172">err</span>&nbsp;<span class="builtintype" id="4744176">error</span><span class="op" id="4744181">)</span>&nbsp;<span class="op" id="4744183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744186">return</span>&nbsp;<span class="ident" id="4744193">DefaultClient</span><span class="op" id="4744206">.</span><span class="ident" id="4744207">PostForm</span><span class="op" id="4744215">(</span><span class="ident" id="4744216">url</span><span class="op" id="4744219">,</span>&nbsp;<span class="ident" id="4744221">data</span><span class="op" id="4744225">)</span><br>
<span class="lineno"></span><span class="op" id="4744227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="4744230">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,</span><br>
<span class="lineno"></span><span class="comment" id="4744278">//&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and&nbsp;values&nbsp;urlencoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="4744341">//</span><br>
<span class="lineno"></span><span class="comment" id="4744344">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="4744406">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno">460</span><span class="keyword" id="4744466">func</span>&nbsp;<span class="op" id="4744471">(</span><span class="ident" id="4744472">c</span>&nbsp;<span class="op" id="4744474">*</span><span class="ident" id="4744475">Client</span><span class="op" id="4744481">)</span>&nbsp;<span class="ident" id="4744483">PostForm</span><span class="op" id="4744491">(</span><span class="ident" id="4744492">url</span>&nbsp;<span class="builtintype" id="4744496">string</span><span class="op" id="4744502">,</span>&nbsp;<span class="ident" id="4744504">data</span>&nbsp;<span class="ident" id="4744509">url</span><span class="op" id="4744512">.</span><span class="ident" id="4744513">Values</span><span class="op" id="4744519">)</span>&nbsp;<span class="op" id="4744521">(</span><span class="ident" id="4744522">resp</span>&nbsp;<span class="op" id="4744527">*</span><span class="ident" id="4744528">Response</span><span class="op" id="4744536">,</span>&nbsp;<span class="ident" id="4744538">err</span>&nbsp;<span class="builtintype" id="4744542">error</span><span class="op" id="4744547">)</span>&nbsp;<span class="op" id="4744549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744552">return</span>&nbsp;<span class="ident" id="4744559">c</span><span class="op" id="4744560">.</span><span class="ident" id="4744561">Post</span><span class="op" id="4744565">(</span><span class="ident" id="4744566">url</span><span class="op" id="4744569">,</span>&nbsp;<span class="string" id="4744571">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="4744606">,</span>&nbsp;<span class="ident" id="4744608">strings</span><span class="op" id="4744615">.</span><span class="ident" id="4744616">NewReader</span><span class="op" id="4744625">(</span><span class="ident" id="4744626">data</span><span class="op" id="4744630">.</span><span class="ident" id="4744631">Encode</span><span class="op" id="4744637">(</span><span class="op" id="4744638">)</span><span class="op" id="4744639">)</span><span class="op" id="4744640">)</span><br>
<span class="lineno"></span><span class="op" id="4744642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4744645">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">465</span><span class="comment" id="4744720">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4744793">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="4744829">//</span><br>
<span class="lineno"></span><span class="comment" id="4744832">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="4744862">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">470</span><span class="comment" id="4744880">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="4744902">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="4744933">//</span><br>
<span class="lineno"></span><span class="comment" id="4744936">//&nbsp;Head&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Head</span><br>
<span class="lineno"></span><span class="keyword" id="4744983">func</span>&nbsp;<span class="ident" id="4744988">Head</span><span class="op" id="4744992">(</span><span class="ident" id="4744993">url</span>&nbsp;<span class="builtintype" id="4744997">string</span><span class="op" id="4745003">)</span>&nbsp;<span class="op" id="4745005">(</span><span class="ident" id="4745006">resp</span>&nbsp;<span class="op" id="4745011">*</span><span class="ident" id="4745012">Response</span><span class="op" id="4745020">,</span>&nbsp;<span class="ident" id="4745022">err</span>&nbsp;<span class="builtintype" id="4745026">error</span><span class="op" id="4745031">)</span>&nbsp;<span class="op" id="4745033">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745036">return</span>&nbsp;<span class="ident" id="4745043">DefaultClient</span><span class="op" id="4745056">.</span><span class="ident" id="4745057">Head</span><span class="op" id="4745061">(</span><span class="ident" id="4745062">url</span><span class="op" id="4745065">)</span><br>
<span class="lineno"></span><span class="op" id="4745067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4745070">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4745145">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="4745218">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="4745254">//</span><br>
<span class="lineno"></span><span class="comment" id="4745257">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="4745287">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="4745305">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">485</span><span class="comment" id="4745327">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="keyword" id="4745358">func</span>&nbsp;<span class="op" id="4745363">(</span><span class="ident" id="4745364">c</span>&nbsp;<span class="op" id="4745366">*</span><span class="ident" id="4745367">Client</span><span class="op" id="4745373">)</span>&nbsp;<span class="ident" id="4745375">Head</span><span class="op" id="4745379">(</span><span class="ident" id="4745380">url</span>&nbsp;<span class="builtintype" id="4745384">string</span><span class="op" id="4745390">)</span>&nbsp;<span class="op" id="4745392">(</span><span class="ident" id="4745393">resp</span>&nbsp;<span class="op" id="4745398">*</span><span class="ident" id="4745399">Response</span><span class="op" id="4745407">,</span>&nbsp;<span class="ident" id="4745409">err</span>&nbsp;<span class="builtintype" id="4745413">error</span><span class="op" id="4745418">)</span>&nbsp;<span class="op" id="4745420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745423">req</span><span class="op" id="4745426">,</span>&nbsp;<span class="ident" id="4745428">err</span>&nbsp;<span class="op" id="4745432">:=</span>&nbsp;<span class="ident" id="4745435">NewRequest</span><span class="op" id="4745445">(</span><span class="string" id="4745446">&#34;HEAD&#34;</span><span class="op" id="4745452">,</span>&nbsp;<span class="ident" id="4745454">url</span><span class="op" id="4745457">,</span>&nbsp;<span class="ident" id="4745459">nil</span><span class="op" id="4745462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745465">if</span>&nbsp;<span class="ident" id="4745468">err</span>&nbsp;<span class="op" id="4745472">!=</span>&nbsp;<span class="ident" id="4745475">nil</span>&nbsp;<span class="op" id="4745479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745483">return</span>&nbsp;<span class="ident" id="4745490">nil</span><span class="op" id="4745493">,</span>&nbsp;<span class="ident" id="4745495">err</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4745500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745503">return</span>&nbsp;<span class="ident" id="4745510">c</span><span class="op" id="4745511">.</span><span class="ident" id="4745512">doFollowingRedirects</span><span class="op" id="4745532">(</span><span class="ident" id="4745533">req</span><span class="op" id="4745536">,</span>&nbsp;<span class="ident" id="4745538">shouldRedirectGet</span><span class="op" id="4745555">)</span><br>
<span class="lineno"></span><span class="op" id="4745557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4745560">type</span>&nbsp;<span class="ident" id="4745565">cancelTimerBody</span>&nbsp;<span class="keyword" id="4745581">struct</span>&nbsp;<span class="op" id="4745588">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745591">t</span>&nbsp;&nbsp;<span class="op" id="4745594">*</span><span class="ident" id="4745595">time</span><span class="op" id="4745599">.</span><span class="ident" id="4745600">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745607">rc</span>&nbsp;<span class="ident" id="4745610">io</span><span class="op" id="4745612">.</span><span class="ident" id="4745613">ReadCloser</span><br>
<span class="lineno"></span><span class="op" id="4745624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4745627">func</span>&nbsp;<span class="op" id="4745632">(</span><span class="ident" id="4745633">b</span>&nbsp;<span class="op" id="4745635">*</span><span class="ident" id="4745636">cancelTimerBody</span><span class="op" id="4745651">)</span>&nbsp;<span class="ident" id="4745653">Read</span><span class="op" id="4745657">(</span><span class="ident" id="4745658">p</span>&nbsp;<span class="op" id="4745660">[</span><span class="op" id="4745661">]</span><span class="builtintype" id="4745662">byte</span><span class="op" id="4745666">)</span>&nbsp;<span class="op" id="4745668">(</span><span class="ident" id="4745669">n</span>&nbsp;<span class="builtintype" id="4745671">int</span><span class="op" id="4745674">,</span>&nbsp;<span class="ident" id="4745676">err</span>&nbsp;<span class="builtintype" id="4745680">error</span><span class="op" id="4745685">)</span>&nbsp;<span class="op" id="4745687">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745690">n</span><span class="op" id="4745691">,</span>&nbsp;<span class="ident" id="4745693">err</span>&nbsp;<span class="op" id="4745697">=</span>&nbsp;<span class="ident" id="4745699">b</span><span class="op" id="4745700">.</span><span class="ident" id="4745701">rc</span><span class="op" id="4745703">.</span><span class="ident" id="4745704">Read</span><span class="op" id="4745708">(</span><span class="ident" id="4745709">p</span><span class="op" id="4745710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745713">if</span>&nbsp;<span class="ident" id="4745716">err</span>&nbsp;<span class="op" id="4745720">==</span>&nbsp;<span class="ident" id="4745723">io</span><span class="op" id="4745725">.</span><span class="ident" id="4745726">EOF</span>&nbsp;<span class="op" id="4745730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745734">b</span><span class="op" id="4745735">.</span><span class="ident" id="4745736">t</span><span class="op" id="4745737">.</span><span class="ident" id="4745738">Stop</span><span class="op" id="4745742">(</span><span class="op" id="4745743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4745746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745749">return</span><br>
<span class="lineno">505</span><span class="op" id="4745756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4745759">func</span>&nbsp;<span class="op" id="4745764">(</span><span class="ident" id="4745765">b</span>&nbsp;<span class="op" id="4745767">*</span><span class="ident" id="4745768">cancelTimerBody</span><span class="op" id="4745783">)</span>&nbsp;<span class="ident" id="4745785">Close</span><span class="op" id="4745790">(</span><span class="op" id="4745791">)</span>&nbsp;<span class="builtintype" id="4745793">error</span>&nbsp;<span class="op" id="4745799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745802">err</span>&nbsp;<span class="op" id="4745806">:=</span>&nbsp;<span class="ident" id="4745809">b</span><span class="op" id="4745810">.</span><span class="ident" id="4745811">rc</span><span class="op" id="4745813">.</span><span class="ident" id="4745814">Close</span><span class="op" id="4745819">(</span><span class="op" id="4745820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745823">b</span><span class="op" id="4745824">.</span><span class="ident" id="4745825">t</span><span class="op" id="4745826">.</span><span class="ident" id="4745827">Stop</span><span class="op" id="4745831">(</span><span class="op" id="4745832">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745835">return</span>&nbsp;<span class="ident" id="4745842">err</span><br>
<span class="lineno"></span><span class="op" id="4745846">}</span>
</div>
</body>
</html>
