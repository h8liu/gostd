<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>text/template</h2>
<ul>
<li><a href="/gostd/text/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/text/template/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/text/template/examplefiles_test.go.html">examplefiles_test.go</a></li>
<li><a href="/gostd/text/template/examplefunc_test.go.html">examplefunc_test.go</a></li>
<li><a href="/gostd/text/template/exec.go.html">exec.go</a></li>
<li><a href="/gostd/text/template/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/text/template/funcs.go.html">funcs.go</a></li>
<li><a href="/gostd/text/template/helper.go.html">helper.go</a></li>
<li><a href="/gostd/text/template/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/text/template/template.go.html" class="current">template.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4617433">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4617488">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4617542">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4617593">package</span>&nbsp;<span class="ident" id="4617601">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4617611">import</span>&nbsp;<span class="op" id="4617618">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4617621">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4617628">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4617639">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="4617661">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4617664">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;information&nbsp;shared&nbsp;by&nbsp;related&nbsp;templates.</span><br>
<span class="lineno"></span><span class="keyword" id="4617725">type</span>&nbsp;<span class="ident" id="4617730">common</span>&nbsp;<span class="keyword" id="4617737">struct</span>&nbsp;<span class="op" id="4617744">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4617747">tmpl</span>&nbsp;<span class="keyword" id="4617752">map</span><span class="op" id="4617755">[</span><span class="builtintype" id="4617756">string</span><span class="op" id="4617762">]</span><span class="op" id="4617763">*</span><span class="ident" id="4617764">Template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4617774">//&nbsp;We&nbsp;use&nbsp;two&nbsp;maps,&nbsp;one&nbsp;for&nbsp;parsing&nbsp;and&nbsp;one&nbsp;for&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4617834">//&nbsp;This&nbsp;separation&nbsp;makes&nbsp;the&nbsp;API&nbsp;cleaner&nbsp;since&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4617893">//&nbsp;expose&nbsp;reflection&nbsp;to&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4617930">parseFuncs</span>&nbsp;<span class="ident" id="4617941">FuncMap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4617950">execFuncs</span>&nbsp;&nbsp;<span class="keyword" id="4617961">map</span><span class="op" id="4617964">[</span><span class="builtintype" id="4617965">string</span><span class="op" id="4617971">]</span><span class="ident" id="4617972">reflect</span><span class="op" id="4617979">.</span><span class="ident" id="4617980">Value</span><br>
<span class="lineno"></span><span class="op" id="4617986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4617989">//&nbsp;Template&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;parsed&nbsp;template.&nbsp;The&nbsp;*parse.Tree</span><br>
<span class="lineno"></span><span class="comment" id="4618061">//&nbsp;field&nbsp;is&nbsp;exported&nbsp;only&nbsp;for&nbsp;use&nbsp;by&nbsp;html/template&nbsp;and&nbsp;should&nbsp;be&nbsp;treated</span><br>
<span class="lineno">25</span><span class="comment" id="4618134">//&nbsp;as&nbsp;unexported&nbsp;by&nbsp;all&nbsp;other&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="4618173">type</span>&nbsp;<span class="ident" id="4618178">Template</span>&nbsp;<span class="keyword" id="4618187">struct</span>&nbsp;<span class="op" id="4618194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618197">name</span>&nbsp;<span class="builtintype" id="4618202">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4618210">*</span><span class="ident" id="4618211">parse</span><span class="op" id="4618216">.</span><span class="ident" id="4618217">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4618223">*</span><span class="ident" id="4618224">common</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618232">leftDelim</span>&nbsp;&nbsp;<span class="builtintype" id="4618243">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618251">rightDelim</span>&nbsp;<span class="builtintype" id="4618262">string</span><br>
<span class="lineno"></span><span class="op" id="4618269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4618272">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno">35</span><span class="keyword" id="4618325">func</span>&nbsp;<span class="ident" id="4618330">New</span><span class="op" id="4618333">(</span><span class="ident" id="4618334">name</span>&nbsp;<span class="builtintype" id="4618339">string</span><span class="op" id="4618345">)</span>&nbsp;<span class="op" id="4618347">*</span><span class="ident" id="4618348">Template</span>&nbsp;<span class="op" id="4618357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4618360">return</span>&nbsp;<span class="op" id="4618367">&amp;</span><span class="ident" id="4618368">Template</span><span class="op" id="4618376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618380">name</span><span class="op" id="4618384">:</span>&nbsp;<span class="ident" id="4618386">name</span><span class="op" id="4618390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4618393">}</span><br>
<span class="lineno"></span><span class="op" id="4618395">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="4618398">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;template.</span><br>
<span class="lineno"></span><span class="keyword" id="4618440">func</span>&nbsp;<span class="op" id="4618445">(</span><span class="ident" id="4618446">t</span>&nbsp;<span class="op" id="4618448">*</span><span class="ident" id="4618449">Template</span><span class="op" id="4618457">)</span>&nbsp;<span class="ident" id="4618459">Name</span><span class="op" id="4618463">(</span><span class="op" id="4618464">)</span>&nbsp;<span class="builtintype" id="4618466">string</span>&nbsp;<span class="op" id="4618473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4618476">return</span>&nbsp;<span class="ident" id="4618483">t</span><span class="op" id="4618484">.</span><span class="ident" id="4618485">name</span><br>
<span class="lineno"></span><span class="op" id="4618490">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="4618493">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;one&nbsp;and&nbsp;with&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="4618573">//&nbsp;delimiters.&nbsp;The&nbsp;association,&nbsp;which&nbsp;is&nbsp;transitive,&nbsp;allows&nbsp;one&nbsp;template&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4618649">//&nbsp;invoke&nbsp;another&nbsp;with&nbsp;a&nbsp;{{template}}&nbsp;action.</span><br>
<span class="lineno"></span><span class="keyword" id="4618695">func</span>&nbsp;<span class="op" id="4618700">(</span><span class="ident" id="4618701">t</span>&nbsp;<span class="op" id="4618703">*</span><span class="ident" id="4618704">Template</span><span class="op" id="4618712">)</span>&nbsp;<span class="ident" id="4618714">New</span><span class="op" id="4618717">(</span><span class="ident" id="4618718">name</span>&nbsp;<span class="builtintype" id="4618723">string</span><span class="op" id="4618729">)</span>&nbsp;<span class="op" id="4618731">*</span><span class="ident" id="4618732">Template</span>&nbsp;<span class="op" id="4618741">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618744">t</span><span class="op" id="4618745">.</span><span class="ident" id="4618746">init</span><span class="op" id="4618750">(</span><span class="op" id="4618751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4618754">return</span>&nbsp;<span class="op" id="4618761">&amp;</span><span class="ident" id="4618762">Template</span><span class="op" id="4618770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618774">name</span><span class="op" id="4618778">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618786">name</span><span class="op" id="4618790">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618794">common</span><span class="op" id="4618800">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618806">t</span><span class="op" id="4618807">.</span><span class="ident" id="4618808">common</span><span class="op" id="4618814">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618818">leftDelim</span><span class="op" id="4618827">:</span>&nbsp;&nbsp;<span class="ident" id="4618830">t</span><span class="op" id="4618831">.</span><span class="ident" id="4618832">leftDelim</span><span class="op" id="4618841">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618845">rightDelim</span><span class="op" id="4618855">:</span>&nbsp;<span class="ident" id="4618857">t</span><span class="op" id="4618858">.</span><span class="ident" id="4618859">rightDelim</span><span class="op" id="4618869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4618872">}</span><br>
<span class="lineno"></span><span class="op" id="4618874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4618877">func</span>&nbsp;<span class="op" id="4618882">(</span><span class="ident" id="4618883">t</span>&nbsp;<span class="op" id="4618885">*</span><span class="ident" id="4618886">Template</span><span class="op" id="4618894">)</span>&nbsp;<span class="ident" id="4618896">init</span><span class="op" id="4618900">(</span><span class="op" id="4618901">)</span>&nbsp;<span class="op" id="4618903">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4618906">if</span>&nbsp;<span class="ident" id="4618909">t</span><span class="op" id="4618910">.</span><span class="ident" id="4618911">common</span>&nbsp;<span class="op" id="4618918">==</span>&nbsp;<span class="builtintype" id="4618921">nil</span>&nbsp;<span class="op" id="4618925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618929">t</span><span class="op" id="4618930">.</span><span class="ident" id="4618931">common</span>&nbsp;<span class="op" id="4618938">=</span>&nbsp;<span class="builtinfunc" id="4618940">new</span><span class="op" id="4618943">(</span><span class="ident" id="4618944">common</span><span class="op" id="4618950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618954">t</span><span class="op" id="4618955">.</span><span class="ident" id="4618956">tmpl</span>&nbsp;<span class="op" id="4618961">=</span>&nbsp;<span class="builtinfunc" id="4618963">make</span><span class="op" id="4618967">(</span><span class="keyword" id="4618968">map</span><span class="op" id="4618971">[</span><span class="builtintype" id="4618972">string</span><span class="op" id="4618978">]</span><span class="op" id="4618979">*</span><span class="ident" id="4618980">Template</span><span class="op" id="4618988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618992">t</span><span class="op" id="4618993">.</span><span class="ident" id="4618994">parseFuncs</span>&nbsp;<span class="op" id="4619005">=</span>&nbsp;<span class="builtinfunc" id="4619007">make</span><span class="op" id="4619011">(</span><span class="ident" id="4619012">FuncMap</span><span class="op" id="4619019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4619023">t</span><span class="op" id="4619024">.</span><span class="ident" id="4619025">execFuncs</span>&nbsp;<span class="op" id="4619035">=</span>&nbsp;<span class="builtinfunc" id="4619037">make</span><span class="op" id="4619041">(</span><span class="keyword" id="4619042">map</span><span class="op" id="4619045">[</span><span class="builtintype" id="4619046">string</span><span class="op" id="4619052">]</span><span class="ident" id="4619053">reflect</span><span class="op" id="4619060">.</span><span class="ident" id="4619061">Value</span><span class="op" id="4619066">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4619069">}</span><br>
<span class="lineno"></span><span class="op" id="4619071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4619074">//&nbsp;Clone&nbsp;returns&nbsp;a&nbsp;duplicate&nbsp;of&nbsp;the&nbsp;template,&nbsp;including&nbsp;all&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="4619145">//&nbsp;templates.&nbsp;The&nbsp;actual&nbsp;representation&nbsp;is&nbsp;not&nbsp;copied,&nbsp;but&nbsp;the&nbsp;name&nbsp;space&nbsp;of</span><br>
<span class="lineno">70</span><span class="comment" id="4619222">//&nbsp;associated&nbsp;templates&nbsp;is,&nbsp;so&nbsp;further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add</span><br>
<span class="lineno"></span><span class="comment" id="4619297">//&nbsp;templates&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&nbsp;Clone&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;prepare</span><br>
<span class="lineno"></span><span class="comment" id="4619376">//&nbsp;common&nbsp;templates&nbsp;and&nbsp;use&nbsp;them&nbsp;with&nbsp;variant&nbsp;definitions&nbsp;for&nbsp;other&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="4619454">//&nbsp;by&nbsp;adding&nbsp;the&nbsp;variants&nbsp;after&nbsp;the&nbsp;clone&nbsp;is&nbsp;made.</span><br>
<span class="lineno"></span><span class="keyword" id="4619505">func</span>&nbsp;<span class="op" id="4619510">(</span><span class="ident" id="4619511">t</span>&nbsp;<span class="op" id="4619513">*</span><span class="ident" id="4619514">Template</span><span class="op" id="4619522">)</span>&nbsp;<span class="ident" id="4619524">Clone</span><span class="op" id="4619529">(</span><span class="op" id="4619530">)</span>&nbsp;<span class="op" id="4619532">(</span><span class="op" id="4619533">*</span><span class="ident" id="4619534">Template</span><span class="op" id="4619542">,</span>&nbsp;<span class="builtintype" id="4619544">error</span><span class="op" id="4619549">)</span>&nbsp;<span class="op" id="4619551">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4619554">nt</span>&nbsp;<span class="op" id="4619557">:=</span>&nbsp;<span class="ident" id="4619560">t</span><span class="op" id="4619561">.</span><span class="builtinfunc" id="4619562">copy</span><span class="op" id="4619566">(</span><span class="builtintype" id="4619567">nil</span><span class="op" id="4619570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4619573">nt</span><span class="op" id="4619575">.</span><span class="ident" id="4619576">init</span><span class="op" id="4619580">(</span><span class="op" id="4619581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4619584">nt</span><span class="op" id="4619586">.</span><span class="ident" id="4619587">tmpl</span><span class="op" id="4619591">[</span><span class="ident" id="4619592">t</span><span class="op" id="4619593">.</span><span class="ident" id="4619594">name</span><span class="op" id="4619598">]</span>&nbsp;<span class="op" id="4619600">=</span>&nbsp;<span class="ident" id="4619602">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4619606">for</span>&nbsp;<span class="ident" id="4619610">k</span><span class="op" id="4619611">,</span>&nbsp;<span class="ident" id="4619613">v</span>&nbsp;<span class="op" id="4619615">:=</span>&nbsp;<span class="keyword" id="4619618">range</span>&nbsp;<span class="ident" id="4619624">t</span><span class="op" id="4619625">.</span><span class="ident" id="4619626">tmpl</span>&nbsp;<span class="op" id="4619631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4619635">if</span>&nbsp;<span class="ident" id="4619638">k</span>&nbsp;<span class="op" id="4619640">==</span>&nbsp;<span class="ident" id="4619643">t</span><span class="op" id="4619644">.</span><span class="ident" id="4619645">name</span>&nbsp;<span class="op" id="4619650">{</span>&nbsp;<span class="comment" id="4619652">//&nbsp;Already&nbsp;installed.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4619677">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4619688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4619692">//&nbsp;The&nbsp;associated&nbsp;templates&nbsp;share&nbsp;nt&#39;s&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4619751">tmpl</span>&nbsp;<span class="op" id="4619756">:=</span>&nbsp;<span class="ident" id="4619759">v</span><span class="op" id="4619760">.</span><span class="builtinfunc" id="4619761">copy</span><span class="op" id="4619765">(</span><span class="ident" id="4619766">nt</span><span class="op" id="4619768">.</span><span class="ident" id="4619769">common</span><span class="op" id="4619775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4619779">nt</span><span class="op" id="4619781">.</span><span class="ident" id="4619782">tmpl</span><span class="op" id="4619786">[</span><span class="ident" id="4619787">k</span><span class="op" id="4619788">]</span>&nbsp;<span class="op" id="4619790">=</span>&nbsp;<span class="ident" id="4619792">tmpl</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4619798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4619801">for</span>&nbsp;<span class="ident" id="4619805">k</span><span class="op" id="4619806">,</span>&nbsp;<span class="ident" id="4619808">v</span>&nbsp;<span class="op" id="4619810">:=</span>&nbsp;<span class="keyword" id="4619813">range</span>&nbsp;<span class="ident" id="4619819">t</span><span class="op" id="4619820">.</span><span class="ident" id="4619821">parseFuncs</span>&nbsp;<span class="op" id="4619832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4619836">nt</span><span class="op" id="4619838">.</span><span class="ident" id="4619839">parseFuncs</span><span class="op" id="4619849">[</span><span class="ident" id="4619850">k</span><span class="op" id="4619851">]</span>&nbsp;<span class="op" id="4619853">=</span>&nbsp;<span class="ident" id="4619855">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4619858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4619861">for</span>&nbsp;<span class="ident" id="4619865">k</span><span class="op" id="4619866">,</span>&nbsp;<span class="ident" id="4619868">v</span>&nbsp;<span class="op" id="4619870">:=</span>&nbsp;<span class="keyword" id="4619873">range</span>&nbsp;<span class="ident" id="4619879">t</span><span class="op" id="4619880">.</span><span class="ident" id="4619881">execFuncs</span>&nbsp;<span class="op" id="4619891">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4619895">nt</span><span class="op" id="4619897">.</span><span class="ident" id="4619898">execFuncs</span><span class="op" id="4619907">[</span><span class="ident" id="4619908">k</span><span class="op" id="4619909">]</span>&nbsp;<span class="op" id="4619911">=</span>&nbsp;<span class="ident" id="4619913">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4619916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4619919">return</span>&nbsp;<span class="ident" id="4619926">nt</span><span class="op" id="4619928">,</span>&nbsp;<span class="builtintype" id="4619930">nil</span><br>
<span class="lineno"></span><span class="op" id="4619934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="4619937">//&nbsp;copy&nbsp;returns&nbsp;a&nbsp;shallow&nbsp;copy&nbsp;of&nbsp;t,&nbsp;with&nbsp;common&nbsp;set&nbsp;to&nbsp;the&nbsp;argument.</span><br>
<span class="lineno"></span><span class="keyword" id="4620007">func</span>&nbsp;<span class="op" id="4620012">(</span><span class="ident" id="4620013">t</span>&nbsp;<span class="op" id="4620015">*</span><span class="ident" id="4620016">Template</span><span class="op" id="4620024">)</span>&nbsp;<span class="builtinfunc" id="4620026">copy</span><span class="op" id="4620030">(</span><span class="ident" id="4620031">c</span>&nbsp;<span class="op" id="4620033">*</span><span class="ident" id="4620034">common</span><span class="op" id="4620040">)</span>&nbsp;<span class="op" id="4620042">*</span><span class="ident" id="4620043">Template</span>&nbsp;<span class="op" id="4620052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620055">nt</span>&nbsp;<span class="op" id="4620058">:=</span>&nbsp;<span class="ident" id="4620061">New</span><span class="op" id="4620064">(</span><span class="ident" id="4620065">t</span><span class="op" id="4620066">.</span><span class="ident" id="4620067">name</span><span class="op" id="4620071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620074">nt</span><span class="op" id="4620076">.</span><span class="ident" id="4620077">Tree</span>&nbsp;<span class="op" id="4620082">=</span>&nbsp;<span class="ident" id="4620084">t</span><span class="op" id="4620085">.</span><span class="ident" id="4620086">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620092">nt</span><span class="op" id="4620094">.</span><span class="ident" id="4620095">common</span>&nbsp;<span class="op" id="4620102">=</span>&nbsp;<span class="ident" id="4620104">c</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620107">nt</span><span class="op" id="4620109">.</span><span class="ident" id="4620110">leftDelim</span>&nbsp;<span class="op" id="4620120">=</span>&nbsp;<span class="ident" id="4620122">t</span><span class="op" id="4620123">.</span><span class="ident" id="4620124">leftDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620135">nt</span><span class="op" id="4620137">.</span><span class="ident" id="4620138">rightDelim</span>&nbsp;<span class="op" id="4620149">=</span>&nbsp;<span class="ident" id="4620151">t</span><span class="op" id="4620152">.</span><span class="ident" id="4620153">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4620165">return</span>&nbsp;<span class="ident" id="4620172">nt</span><br>
<span class="lineno"></span><span class="op" id="4620175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="4620178">//&nbsp;AddParseTree&nbsp;creates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;name&nbsp;and&nbsp;parse&nbsp;tree</span><br>
<span class="lineno"></span><span class="comment" id="4620246">//&nbsp;and&nbsp;associates&nbsp;it&nbsp;with&nbsp;t.</span><br>
<span class="lineno"></span><span class="keyword" id="4620275">func</span>&nbsp;<span class="op" id="4620280">(</span><span class="ident" id="4620281">t</span>&nbsp;<span class="op" id="4620283">*</span><span class="ident" id="4620284">Template</span><span class="op" id="4620292">)</span>&nbsp;<span class="ident" id="4620294">AddParseTree</span><span class="op" id="4620306">(</span><span class="ident" id="4620307">name</span>&nbsp;<span class="builtintype" id="4620312">string</span><span class="op" id="4620318">,</span>&nbsp;<span class="ident" id="4620320">tree</span>&nbsp;<span class="op" id="4620325">*</span><span class="ident" id="4620326">parse</span><span class="op" id="4620331">.</span><span class="ident" id="4620332">Tree</span><span class="op" id="4620336">)</span>&nbsp;<span class="op" id="4620338">(</span><span class="op" id="4620339">*</span><span class="ident" id="4620340">Template</span><span class="op" id="4620348">,</span>&nbsp;<span class="builtintype" id="4620350">error</span><span class="op" id="4620355">)</span>&nbsp;<span class="op" id="4620357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4620360">if</span>&nbsp;<span class="ident" id="4620363">t</span><span class="op" id="4620364">.</span><span class="ident" id="4620365">common</span>&nbsp;<span class="op" id="4620372">!=</span>&nbsp;<span class="builtintype" id="4620375">nil</span>&nbsp;<span class="op" id="4620379">&amp;&amp;</span>&nbsp;<span class="ident" id="4620382">t</span><span class="op" id="4620383">.</span><span class="ident" id="4620384">tmpl</span><span class="op" id="4620388">[</span><span class="ident" id="4620389">name</span><span class="op" id="4620393">]</span>&nbsp;<span class="op" id="4620395">!=</span>&nbsp;<span class="builtintype" id="4620398">nil</span>&nbsp;<span class="op" id="4620402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4620406">return</span>&nbsp;<span class="builtintype" id="4620413">nil</span><span class="op" id="4620416">,</span>&nbsp;<span class="ident" id="4620418">fmt</span><span class="op" id="4620421">.</span><span class="ident" id="4620422">Errorf</span><span class="op" id="4620428">(</span><span class="string" id="4620429">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="4620468">,</span>&nbsp;<span class="ident" id="4620470">name</span><span class="op" id="4620474">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4620477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620480">nt</span>&nbsp;<span class="op" id="4620483">:=</span>&nbsp;<span class="ident" id="4620486">t</span><span class="op" id="4620487">.</span><span class="ident" id="4620488">New</span><span class="op" id="4620491">(</span><span class="ident" id="4620492">name</span><span class="op" id="4620496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620499">nt</span><span class="op" id="4620501">.</span><span class="ident" id="4620502">Tree</span>&nbsp;<span class="op" id="4620507">=</span>&nbsp;<span class="ident" id="4620509">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620515">t</span><span class="op" id="4620516">.</span><span class="ident" id="4620517">tmpl</span><span class="op" id="4620521">[</span><span class="ident" id="4620522">name</span><span class="op" id="4620526">]</span>&nbsp;<span class="op" id="4620528">=</span>&nbsp;<span class="ident" id="4620530">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4620534">return</span>&nbsp;<span class="ident" id="4620541">nt</span><span class="op" id="4620543">,</span>&nbsp;<span class="builtintype" id="4620545">nil</span><br>
<span class="lineno">115</span><span class="op" id="4620549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4620552">//&nbsp;Templates&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;templates&nbsp;associated&nbsp;with&nbsp;t,&nbsp;including&nbsp;t</span><br>
<span class="lineno"></span><span class="comment" id="4620629">//&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4620640">func</span>&nbsp;<span class="op" id="4620645">(</span><span class="ident" id="4620646">t</span>&nbsp;<span class="op" id="4620648">*</span><span class="ident" id="4620649">Template</span><span class="op" id="4620657">)</span>&nbsp;<span class="ident" id="4620659">Templates</span><span class="op" id="4620668">(</span><span class="op" id="4620669">)</span>&nbsp;<span class="op" id="4620671">[</span><span class="op" id="4620672">]</span><span class="op" id="4620673">*</span><span class="ident" id="4620674">Template</span>&nbsp;<span class="op" id="4620683">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4620686">if</span>&nbsp;<span class="ident" id="4620689">t</span><span class="op" id="4620690">.</span><span class="ident" id="4620691">common</span>&nbsp;<span class="op" id="4620698">==</span>&nbsp;<span class="builtintype" id="4620701">nil</span>&nbsp;<span class="op" id="4620705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4620709">return</span>&nbsp;<span class="builtintype" id="4620716">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4620721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4620724">//&nbsp;Return&nbsp;a&nbsp;slice&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;expose&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620771">m</span>&nbsp;<span class="op" id="4620773">:=</span>&nbsp;<span class="builtinfunc" id="4620776">make</span><span class="op" id="4620780">(</span><span class="op" id="4620781">[</span><span class="op" id="4620782">]</span><span class="op" id="4620783">*</span><span class="ident" id="4620784">Template</span><span class="op" id="4620792">,</span>&nbsp;<span class="num" id="4620794">0</span><span class="op" id="4620795">,</span>&nbsp;<span class="builtinfunc" id="4620797">len</span><span class="op" id="4620800">(</span><span class="ident" id="4620801">t</span><span class="op" id="4620802">.</span><span class="ident" id="4620803">tmpl</span><span class="op" id="4620807">)</span><span class="op" id="4620808">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4620811">for</span>&nbsp;<span class="ident" id="4620815">_</span><span class="op" id="4620816">,</span>&nbsp;<span class="ident" id="4620818">v</span>&nbsp;<span class="op" id="4620820">:=</span>&nbsp;<span class="keyword" id="4620823">range</span>&nbsp;<span class="ident" id="4620829">t</span><span class="op" id="4620830">.</span><span class="ident" id="4620831">tmpl</span>&nbsp;<span class="op" id="4620836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620840">m</span>&nbsp;<span class="op" id="4620842">=</span>&nbsp;<span class="builtinfunc" id="4620844">append</span><span class="op" id="4620850">(</span><span class="ident" id="4620851">m</span><span class="op" id="4620852">,</span>&nbsp;<span class="ident" id="4620854">v</span><span class="op" id="4620855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4620858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4620861">return</span>&nbsp;<span class="ident" id="4620868">m</span><br>
<span class="lineno"></span><span class="op" id="4620870">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4620873">//&nbsp;Delims&nbsp;sets&nbsp;the&nbsp;action&nbsp;delimiters&nbsp;to&nbsp;the&nbsp;specified&nbsp;strings,&nbsp;to&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4620950">//&nbsp;subsequent&nbsp;calls&nbsp;to&nbsp;Parse,&nbsp;ParseFiles,&nbsp;or&nbsp;ParseGlob.&nbsp;Nested&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="4621022">//&nbsp;definitions&nbsp;will&nbsp;inherit&nbsp;the&nbsp;settings.&nbsp;An&nbsp;empty&nbsp;delimiter&nbsp;stands&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4621098">//&nbsp;corresponding&nbsp;default:&nbsp;{{&nbsp;or&nbsp;}}.</span><br>
<span class="lineno">135</span><span class="comment" id="4621134">//&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="4621196">func</span>&nbsp;<span class="op" id="4621201">(</span><span class="ident" id="4621202">t</span>&nbsp;<span class="op" id="4621204">*</span><span class="ident" id="4621205">Template</span><span class="op" id="4621213">)</span>&nbsp;<span class="ident" id="4621215">Delims</span><span class="op" id="4621221">(</span><span class="ident" id="4621222">left</span><span class="op" id="4621226">,</span>&nbsp;<span class="ident" id="4621228">right</span>&nbsp;<span class="builtintype" id="4621234">string</span><span class="op" id="4621240">)</span>&nbsp;<span class="op" id="4621242">*</span><span class="ident" id="4621243">Template</span>&nbsp;<span class="op" id="4621252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621255">t</span><span class="op" id="4621256">.</span><span class="ident" id="4621257">leftDelim</span>&nbsp;<span class="op" id="4621267">=</span>&nbsp;<span class="ident" id="4621269">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621275">t</span><span class="op" id="4621276">.</span><span class="ident" id="4621277">rightDelim</span>&nbsp;<span class="op" id="4621288">=</span>&nbsp;<span class="ident" id="4621290">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621297">return</span>&nbsp;<span class="ident" id="4621304">t</span><br>
<span class="lineno">140</span><span class="op" id="4621306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4621309">//&nbsp;Funcs&nbsp;adds&nbsp;the&nbsp;elements&nbsp;of&nbsp;the&nbsp;argument&nbsp;map&nbsp;to&nbsp;the&nbsp;template&#39;s&nbsp;function&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="4621388">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;a&nbsp;value&nbsp;in&nbsp;the&nbsp;map&nbsp;is&nbsp;not&nbsp;a&nbsp;function&nbsp;with&nbsp;appropriate&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4621465">//&nbsp;type.&nbsp;However,&nbsp;it&nbsp;is&nbsp;legal&nbsp;to&nbsp;overwrite&nbsp;elements&nbsp;of&nbsp;the&nbsp;map.&nbsp;The&nbsp;return</span><br>
<span class="lineno">145</span><span class="comment" id="4621540">//&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="4621591">func</span>&nbsp;<span class="op" id="4621596">(</span><span class="ident" id="4621597">t</span>&nbsp;<span class="op" id="4621599">*</span><span class="ident" id="4621600">Template</span><span class="op" id="4621608">)</span>&nbsp;<span class="ident" id="4621610">Funcs</span><span class="op" id="4621615">(</span><span class="ident" id="4621616">funcMap</span>&nbsp;<span class="ident" id="4621624">FuncMap</span><span class="op" id="4621631">)</span>&nbsp;<span class="op" id="4621633">*</span><span class="ident" id="4621634">Template</span>&nbsp;<span class="op" id="4621643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621646">t</span><span class="op" id="4621647">.</span><span class="ident" id="4621648">init</span><span class="op" id="4621652">(</span><span class="op" id="4621653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621656">addValueFuncs</span><span class="op" id="4621669">(</span><span class="ident" id="4621670">t</span><span class="op" id="4621671">.</span><span class="ident" id="4621672">execFuncs</span><span class="op" id="4621681">,</span>&nbsp;<span class="ident" id="4621683">funcMap</span><span class="op" id="4621690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621693">addFuncs</span><span class="op" id="4621701">(</span><span class="ident" id="4621702">t</span><span class="op" id="4621703">.</span><span class="ident" id="4621704">parseFuncs</span><span class="op" id="4621714">,</span>&nbsp;<span class="ident" id="4621716">funcMap</span><span class="op" id="4621723">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621726">return</span>&nbsp;<span class="ident" id="4621733">t</span><br>
<span class="lineno"></span><span class="op" id="4621735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4621738">//&nbsp;Lookup&nbsp;returns&nbsp;the&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name&nbsp;that&nbsp;is&nbsp;associated&nbsp;with&nbsp;t,</span><br>
<span class="lineno"></span><span class="comment" id="4621816">//&nbsp;or&nbsp;nil&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;such&nbsp;template.</span><br>
<span class="lineno">155</span><span class="keyword" id="4621856">func</span>&nbsp;<span class="op" id="4621861">(</span><span class="ident" id="4621862">t</span>&nbsp;<span class="op" id="4621864">*</span><span class="ident" id="4621865">Template</span><span class="op" id="4621873">)</span>&nbsp;<span class="ident" id="4621875">Lookup</span><span class="op" id="4621881">(</span><span class="ident" id="4621882">name</span>&nbsp;<span class="builtintype" id="4621887">string</span><span class="op" id="4621893">)</span>&nbsp;<span class="op" id="4621895">*</span><span class="ident" id="4621896">Template</span>&nbsp;<span class="op" id="4621905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621908">if</span>&nbsp;<span class="ident" id="4621911">t</span><span class="op" id="4621912">.</span><span class="ident" id="4621913">common</span>&nbsp;<span class="op" id="4621920">==</span>&nbsp;<span class="builtintype" id="4621923">nil</span>&nbsp;<span class="op" id="4621927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621931">return</span>&nbsp;<span class="builtintype" id="4621938">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4621943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621946">return</span>&nbsp;<span class="ident" id="4621953">t</span><span class="op" id="4621954">.</span><span class="ident" id="4621955">tmpl</span><span class="op" id="4621959">[</span><span class="ident" id="4621960">name</span><span class="op" id="4621964">]</span><br>
<span class="lineno">160</span><span class="op" id="4621966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4621969">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;string&nbsp;into&nbsp;a&nbsp;template.&nbsp;Nested&nbsp;template&nbsp;definitions&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4622047">//&nbsp;associated&nbsp;with&nbsp;the&nbsp;top-level&nbsp;template&nbsp;t.&nbsp;Parse&nbsp;may&nbsp;be&nbsp;called&nbsp;multiple&nbsp;times</span><br>
<span class="lineno"></span><span class="comment" id="4622127">//&nbsp;to&nbsp;parse&nbsp;definitions&nbsp;of&nbsp;templates&nbsp;to&nbsp;associate&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;if&nbsp;a</span><br>
<span class="lineno">165</span><span class="comment" id="4622205">//&nbsp;resulting&nbsp;template&nbsp;is&nbsp;non-empty&nbsp;(contains&nbsp;content&nbsp;other&nbsp;than&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="4622278">//&nbsp;definitions)&nbsp;and&nbsp;would&nbsp;replace&nbsp;a&nbsp;non-empty&nbsp;template&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="4622353">//&nbsp;(In&nbsp;multiple&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;with&nbsp;the&nbsp;same&nbsp;receiver&nbsp;template,&nbsp;only&nbsp;one&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="4622431">//&nbsp;can&nbsp;contain&nbsp;text&nbsp;other&nbsp;than&nbsp;space,&nbsp;comments,&nbsp;and&nbsp;template&nbsp;definitions.)</span><br>
<span class="lineno"></span><span class="keyword" id="4622506">func</span>&nbsp;<span class="op" id="4622511">(</span><span class="ident" id="4622512">t</span>&nbsp;<span class="op" id="4622514">*</span><span class="ident" id="4622515">Template</span><span class="op" id="4622523">)</span>&nbsp;<span class="ident" id="4622525">Parse</span><span class="op" id="4622530">(</span><span class="ident" id="4622531">text</span>&nbsp;<span class="builtintype" id="4622536">string</span><span class="op" id="4622542">)</span>&nbsp;<span class="op" id="4622544">(</span><span class="op" id="4622545">*</span><span class="ident" id="4622546">Template</span><span class="op" id="4622554">,</span>&nbsp;<span class="builtintype" id="4622556">error</span><span class="op" id="4622561">)</span>&nbsp;<span class="op" id="4622563">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622566">t</span><span class="op" id="4622567">.</span><span class="ident" id="4622568">init</span><span class="op" id="4622572">(</span><span class="op" id="4622573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622576">trees</span><span class="op" id="4622581">,</span>&nbsp;<span class="ident" id="4622583">err</span>&nbsp;<span class="op" id="4622587">:=</span>&nbsp;<span class="ident" id="4622590">parse</span><span class="op" id="4622595">.</span><span class="ident" id="4622596">Parse</span><span class="op" id="4622601">(</span><span class="ident" id="4622602">t</span><span class="op" id="4622603">.</span><span class="ident" id="4622604">name</span><span class="op" id="4622608">,</span>&nbsp;<span class="ident" id="4622610">text</span><span class="op" id="4622614">,</span>&nbsp;<span class="ident" id="4622616">t</span><span class="op" id="4622617">.</span><span class="ident" id="4622618">leftDelim</span><span class="op" id="4622627">,</span>&nbsp;<span class="ident" id="4622629">t</span><span class="op" id="4622630">.</span><span class="ident" id="4622631">rightDelim</span><span class="op" id="4622641">,</span>&nbsp;<span class="ident" id="4622643">t</span><span class="op" id="4622644">.</span><span class="ident" id="4622645">parseFuncs</span><span class="op" id="4622655">,</span>&nbsp;<span class="ident" id="4622657">builtins</span><span class="op" id="4622665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622668">if</span>&nbsp;<span class="ident" id="4622671">err</span>&nbsp;<span class="op" id="4622675">!=</span>&nbsp;<span class="builtintype" id="4622678">nil</span>&nbsp;<span class="op" id="4622682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622686">return</span>&nbsp;<span class="builtintype" id="4622693">nil</span><span class="op" id="4622696">,</span>&nbsp;<span class="ident" id="4622698">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4622703">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4622706">//&nbsp;Add&nbsp;the&nbsp;newly&nbsp;parsed&nbsp;trees,&nbsp;including&nbsp;the&nbsp;one&nbsp;for&nbsp;t,&nbsp;into&nbsp;our&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622790">for</span>&nbsp;<span class="ident" id="4622794">name</span><span class="op" id="4622798">,</span>&nbsp;<span class="ident" id="4622800">tree</span>&nbsp;<span class="op" id="4622805">:=</span>&nbsp;<span class="keyword" id="4622808">range</span>&nbsp;<span class="ident" id="4622814">trees</span>&nbsp;<span class="op" id="4622820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4622824">//&nbsp;If&nbsp;the&nbsp;name&nbsp;we&nbsp;parsed&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;this&nbsp;template,&nbsp;overwrite&nbsp;this&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4622906">//&nbsp;The&nbsp;associate&nbsp;method&nbsp;checks&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;redefinition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622964">tmpl</span>&nbsp;<span class="op" id="4622969">:=</span>&nbsp;<span class="ident" id="4622972">t</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622976">if</span>&nbsp;<span class="ident" id="4622979">name</span>&nbsp;<span class="op" id="4622984">!=</span>&nbsp;<span class="ident" id="4622987">t</span><span class="op" id="4622988">.</span><span class="ident" id="4622989">name</span>&nbsp;<span class="op" id="4622994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622999">tmpl</span>&nbsp;<span class="op" id="4623004">=</span>&nbsp;<span class="ident" id="4623006">t</span><span class="op" id="4623007">.</span><span class="ident" id="4623008">New</span><span class="op" id="4623011">(</span><span class="ident" id="4623012">name</span><span class="op" id="4623016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4623020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4623024">//&nbsp;Even&nbsp;if&nbsp;t&nbsp;==&nbsp;tmpl,&nbsp;we&nbsp;need&nbsp;to&nbsp;install&nbsp;it&nbsp;in&nbsp;the&nbsp;common.tmpl&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623094">if</span>&nbsp;<span class="ident" id="4623097">replace</span><span class="op" id="4623104">,</span>&nbsp;<span class="ident" id="4623106">err</span>&nbsp;<span class="op" id="4623110">:=</span>&nbsp;<span class="ident" id="4623113">t</span><span class="op" id="4623114">.</span><span class="ident" id="4623115">associate</span><span class="op" id="4623124">(</span><span class="ident" id="4623125">tmpl</span><span class="op" id="4623129">,</span>&nbsp;<span class="ident" id="4623131">tree</span><span class="op" id="4623135">)</span><span class="op" id="4623136">;</span>&nbsp;<span class="ident" id="4623138">err</span>&nbsp;<span class="op" id="4623142">!=</span>&nbsp;<span class="builtintype" id="4623145">nil</span>&nbsp;<span class="op" id="4623149">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623154">return</span>&nbsp;<span class="builtintype" id="4623161">nil</span><span class="op" id="4623164">,</span>&nbsp;<span class="ident" id="4623166">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4623172">}</span>&nbsp;<span class="keyword" id="4623174">else</span>&nbsp;<span class="keyword" id="4623179">if</span>&nbsp;<span class="ident" id="4623182">replace</span>&nbsp;<span class="op" id="4623190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623195">tmpl</span><span class="op" id="4623199">.</span><span class="ident" id="4623200">Tree</span>&nbsp;<span class="op" id="4623205">=</span>&nbsp;<span class="ident" id="4623207">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4623214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623218">tmpl</span><span class="op" id="4623222">.</span><span class="ident" id="4623223">leftDelim</span>&nbsp;<span class="op" id="4623233">=</span>&nbsp;<span class="ident" id="4623235">t</span><span class="op" id="4623236">.</span><span class="ident" id="4623237">leftDelim</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623249">tmpl</span><span class="op" id="4623253">.</span><span class="ident" id="4623254">rightDelim</span>&nbsp;<span class="op" id="4623265">=</span>&nbsp;<span class="ident" id="4623267">t</span><span class="op" id="4623268">.</span><span class="ident" id="4623269">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4623281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623284">return</span>&nbsp;<span class="ident" id="4623291">t</span><span class="op" id="4623292">,</span>&nbsp;<span class="builtintype" id="4623294">nil</span><br>
<span class="lineno"></span><span class="op" id="4623298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="4623301">//&nbsp;associate&nbsp;installs&nbsp;the&nbsp;new&nbsp;template&nbsp;into&nbsp;the&nbsp;group&nbsp;of&nbsp;templates&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="4623379">//&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;reuse&nbsp;a&nbsp;name&nbsp;except&nbsp;to&nbsp;overwrite&nbsp;an&nbsp;empty</span><br>
<span class="lineno"></span><span class="comment" id="4623450">//&nbsp;template.&nbsp;The&nbsp;two&nbsp;are&nbsp;already&nbsp;known&nbsp;to&nbsp;share&nbsp;the&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="4623520">//&nbsp;The&nbsp;boolean&nbsp;return&nbsp;value&nbsp;reports&nbsp;wither&nbsp;to&nbsp;store&nbsp;this&nbsp;tree&nbsp;as&nbsp;t.Tree.</span><br>
<span class="lineno"></span><span class="keyword" id="4623593">func</span>&nbsp;<span class="op" id="4623598">(</span><span class="ident" id="4623599">t</span>&nbsp;<span class="op" id="4623601">*</span><span class="ident" id="4623602">Template</span><span class="op" id="4623610">)</span>&nbsp;<span class="ident" id="4623612">associate</span><span class="op" id="4623621">(</span><span class="builtinfunc" id="4623622">new</span>&nbsp;<span class="op" id="4623626">*</span><span class="ident" id="4623627">Template</span><span class="op" id="4623635">,</span>&nbsp;<span class="ident" id="4623637">tree</span>&nbsp;<span class="op" id="4623642">*</span><span class="ident" id="4623643">parse</span><span class="op" id="4623648">.</span><span class="ident" id="4623649">Tree</span><span class="op" id="4623653">)</span>&nbsp;<span class="op" id="4623655">(</span><span class="builtintype" id="4623656">bool</span><span class="op" id="4623660">,</span>&nbsp;<span class="builtintype" id="4623662">error</span><span class="op" id="4623667">)</span>&nbsp;<span class="op" id="4623669">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623672">if</span>&nbsp;<span class="builtinfunc" id="4623675">new</span><span class="op" id="4623678">.</span><span class="ident" id="4623679">common</span>&nbsp;<span class="op" id="4623686">!=</span>&nbsp;<span class="ident" id="4623689">t</span><span class="op" id="4623690">.</span><span class="ident" id="4623691">common</span>&nbsp;<span class="op" id="4623698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4623702">panic</span><span class="op" id="4623707">(</span><span class="string" id="4623708">&#34;internal&nbsp;error:&nbsp;associate&nbsp;not&nbsp;common&#34;</span><span class="op" id="4623746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4623749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623752">name</span>&nbsp;<span class="op" id="4623757">:=</span>&nbsp;<span class="builtinfunc" id="4623760">new</span><span class="op" id="4623763">.</span><span class="ident" id="4623764">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623770">if</span>&nbsp;<span class="ident" id="4623773">old</span>&nbsp;<span class="op" id="4623777">:=</span>&nbsp;<span class="ident" id="4623780">t</span><span class="op" id="4623781">.</span><span class="ident" id="4623782">tmpl</span><span class="op" id="4623786">[</span><span class="ident" id="4623787">name</span><span class="op" id="4623791">]</span><span class="op" id="4623792">;</span>&nbsp;<span class="ident" id="4623794">old</span>&nbsp;<span class="op" id="4623798">!=</span>&nbsp;<span class="builtintype" id="4623801">nil</span>&nbsp;<span class="op" id="4623805">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623809">oldIsEmpty</span>&nbsp;<span class="op" id="4623820">:=</span>&nbsp;<span class="ident" id="4623823">parse</span><span class="op" id="4623828">.</span><span class="ident" id="4623829">IsEmptyTree</span><span class="op" id="4623840">(</span><span class="ident" id="4623841">old</span><span class="op" id="4623844">.</span><span class="ident" id="4623845">Root</span><span class="op" id="4623849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623853">newIsEmpty</span>&nbsp;<span class="op" id="4623864">:=</span>&nbsp;<span class="ident" id="4623867">parse</span><span class="op" id="4623872">.</span><span class="ident" id="4623873">IsEmptyTree</span><span class="op" id="4623884">(</span><span class="ident" id="4623885">tree</span><span class="op" id="4623889">.</span><span class="ident" id="4623890">Root</span><span class="op" id="4623894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623898">if</span>&nbsp;<span class="ident" id="4623901">newIsEmpty</span>&nbsp;<span class="op" id="4623912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4623917">//&nbsp;Whether&nbsp;old&nbsp;is&nbsp;empty&nbsp;or&nbsp;not,&nbsp;new&nbsp;is&nbsp;empty;&nbsp;no&nbsp;reason&nbsp;to&nbsp;replace&nbsp;old.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623992">return</span>&nbsp;<span class="builtintype" id="4623999">false</span><span class="op" id="4624004">,</span>&nbsp;<span class="builtintype" id="4624006">nil</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4624012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4624016">if</span>&nbsp;<span class="op" id="4624019">!</span><span class="ident" id="4624020">oldIsEmpty</span>&nbsp;<span class="op" id="4624031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4624036">return</span>&nbsp;<span class="builtintype" id="4624043">false</span><span class="op" id="4624048">,</span>&nbsp;<span class="ident" id="4624050">fmt</span><span class="op" id="4624053">.</span><span class="ident" id="4624054">Errorf</span><span class="op" id="4624060">(</span><span class="string" id="4624061">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="4624100">,</span>&nbsp;<span class="ident" id="4624102">name</span><span class="op" id="4624106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4624110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4624113">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624116">t</span><span class="op" id="4624117">.</span><span class="ident" id="4624118">tmpl</span><span class="op" id="4624122">[</span><span class="ident" id="4624123">name</span><span class="op" id="4624127">]</span>&nbsp;<span class="op" id="4624129">=</span>&nbsp;<span class="builtinfunc" id="4624131">new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4624136">return</span>&nbsp;<span class="builtintype" id="4624143">true</span><span class="op" id="4624147">,</span>&nbsp;<span class="builtintype" id="4624149">nil</span><br>
<span class="lineno"></span><span class="op" id="4624153">}</span>
</div>
</body>
</html>
