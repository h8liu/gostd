<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/url</h2>
<ul>
<li><a href="/gostd/net/url/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/url/url.go.html">url.go</a></li>
<li><a href="/gostd/net/url/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3303105">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3303160">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3303214">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3303265">//&nbsp;Package&nbsp;url&nbsp;parses&nbsp;URLs&nbsp;and&nbsp;implements&nbsp;query&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="comment" id="3303323">//&nbsp;See&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3303340">package</span>&nbsp;<span class="ident" id="3303348">url</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3303353">import</span>&nbsp;<span class="op" id="3303360">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3303363">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3303372">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3303382">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3303390">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3303401">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3303411">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3303414">//&nbsp;Error&nbsp;reports&nbsp;an&nbsp;error&nbsp;and&nbsp;the&nbsp;operation&nbsp;and&nbsp;URL&nbsp;that&nbsp;caused&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3303482">type</span>&nbsp;<span class="ident" id="3303487">Error</span>&nbsp;<span class="keyword" id="3303493">struct</span>&nbsp;<span class="op" id="3303500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3303503">Op</span>&nbsp;&nbsp;<span class="builtintype" id="3303507">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3303515">URL</span>&nbsp;<span class="builtintype" id="3303519">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3303527">Err</span>&nbsp;<span class="builtintype" id="3303531">error</span><br>
<span class="lineno"></span><span class="op" id="3303537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3303540">func</span>&nbsp;<span class="op" id="3303545">(</span><span class="ident" id="3303546">e</span>&nbsp;<span class="op" id="3303548">*</span><span class="ident" id="3303549">Error</span><span class="op" id="3303554">)</span>&nbsp;<span class="ident" id="3303556">Error</span><span class="op" id="3303561">(</span><span class="op" id="3303562">)</span>&nbsp;<span class="builtintype" id="3303564">string</span>&nbsp;<span class="op" id="3303571">{</span>&nbsp;<span class="keyword" id="3303573">return</span>&nbsp;<span class="ident" id="3303580">e</span><span class="op" id="3303581">.</span><span class="ident" id="3303582">Op</span>&nbsp;<span class="op" id="3303585">+</span>&nbsp;<span class="string" id="3303587">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3303591">+</span>&nbsp;<span class="ident" id="3303593">e</span><span class="op" id="3303594">.</span><span class="ident" id="3303595">URL</span>&nbsp;<span class="op" id="3303599">+</span>&nbsp;<span class="string" id="3303601">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3303606">+</span>&nbsp;<span class="ident" id="3303608">e</span><span class="op" id="3303609">.</span><span class="ident" id="3303610">Err</span><span class="op" id="3303613">.</span><span class="ident" id="3303614">Error</span><span class="op" id="3303619">(</span><span class="op" id="3303620">)</span>&nbsp;<span class="op" id="3303622">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3303625">func</span>&nbsp;<span class="ident" id="3303630">ishex</span><span class="op" id="3303635">(</span><span class="ident" id="3303636">c</span>&nbsp;<span class="builtintype" id="3303638">byte</span><span class="op" id="3303642">)</span>&nbsp;<span class="builtintype" id="3303644">bool</span>&nbsp;<span class="op" id="3303649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303652">switch</span>&nbsp;<span class="op" id="3303659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303662">case</span>&nbsp;<span class="string" id="3303667">&#39;0&#39;</span>&nbsp;<span class="op" id="3303671">&lt;=</span>&nbsp;<span class="ident" id="3303674">c</span>&nbsp;<span class="op" id="3303676">&amp;&amp;</span>&nbsp;<span class="ident" id="3303679">c</span>&nbsp;<span class="op" id="3303681">&lt;=</span>&nbsp;<span class="string" id="3303684">&#39;9&#39;</span><span class="op" id="3303687">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303691">return</span>&nbsp;<span class="builtintype" id="3303698">true</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303704">case</span>&nbsp;<span class="string" id="3303709">&#39;a&#39;</span>&nbsp;<span class="op" id="3303713">&lt;=</span>&nbsp;<span class="ident" id="3303716">c</span>&nbsp;<span class="op" id="3303718">&amp;&amp;</span>&nbsp;<span class="ident" id="3303721">c</span>&nbsp;<span class="op" id="3303723">&lt;=</span>&nbsp;<span class="string" id="3303726">&#39;f&#39;</span><span class="op" id="3303729">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303733">return</span>&nbsp;<span class="builtintype" id="3303740">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303746">case</span>&nbsp;<span class="string" id="3303751">&#39;A&#39;</span>&nbsp;<span class="op" id="3303755">&lt;=</span>&nbsp;<span class="ident" id="3303758">c</span>&nbsp;<span class="op" id="3303760">&amp;&amp;</span>&nbsp;<span class="ident" id="3303763">c</span>&nbsp;<span class="op" id="3303765">&lt;=</span>&nbsp;<span class="string" id="3303768">&#39;F&#39;</span><span class="op" id="3303771">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303775">return</span>&nbsp;<span class="builtintype" id="3303782">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3303788">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303791">return</span>&nbsp;<span class="builtintype" id="3303798">false</span><br>
<span class="lineno"></span><span class="op" id="3303804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3303807">func</span>&nbsp;<span class="ident" id="3303812">unhex</span><span class="op" id="3303817">(</span><span class="ident" id="3303818">c</span>&nbsp;<span class="builtintype" id="3303820">byte</span><span class="op" id="3303824">)</span>&nbsp;<span class="builtintype" id="3303826">byte</span>&nbsp;<span class="op" id="3303831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303834">switch</span>&nbsp;<span class="op" id="3303841">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303844">case</span>&nbsp;<span class="string" id="3303849">&#39;0&#39;</span>&nbsp;<span class="op" id="3303853">&lt;=</span>&nbsp;<span class="ident" id="3303856">c</span>&nbsp;<span class="op" id="3303858">&amp;&amp;</span>&nbsp;<span class="ident" id="3303861">c</span>&nbsp;<span class="op" id="3303863">&lt;=</span>&nbsp;<span class="string" id="3303866">&#39;9&#39;</span><span class="op" id="3303869">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303873">return</span>&nbsp;<span class="ident" id="3303880">c</span>&nbsp;<span class="op" id="3303882">-</span>&nbsp;<span class="string" id="3303884">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303889">case</span>&nbsp;<span class="string" id="3303894">&#39;a&#39;</span>&nbsp;<span class="op" id="3303898">&lt;=</span>&nbsp;<span class="ident" id="3303901">c</span>&nbsp;<span class="op" id="3303903">&amp;&amp;</span>&nbsp;<span class="ident" id="3303906">c</span>&nbsp;<span class="op" id="3303908">&lt;=</span>&nbsp;<span class="string" id="3303911">&#39;f&#39;</span><span class="op" id="3303914">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303918">return</span>&nbsp;<span class="ident" id="3303925">c</span>&nbsp;<span class="op" id="3303927">-</span>&nbsp;<span class="string" id="3303929">&#39;a&#39;</span>&nbsp;<span class="op" id="3303933">+</span>&nbsp;<span class="num" id="3303935">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303939">case</span>&nbsp;<span class="string" id="3303944">&#39;A&#39;</span>&nbsp;<span class="op" id="3303948">&lt;=</span>&nbsp;<span class="ident" id="3303951">c</span>&nbsp;<span class="op" id="3303953">&amp;&amp;</span>&nbsp;<span class="ident" id="3303956">c</span>&nbsp;<span class="op" id="3303958">&lt;=</span>&nbsp;<span class="string" id="3303961">&#39;F&#39;</span><span class="op" id="3303964">:</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303968">return</span>&nbsp;<span class="ident" id="3303975">c</span>&nbsp;<span class="op" id="3303977">-</span>&nbsp;<span class="string" id="3303979">&#39;A&#39;</span>&nbsp;<span class="op" id="3303983">+</span>&nbsp;<span class="num" id="3303985">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3303989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303992">return</span>&nbsp;<span class="num" id="3303999">0</span><br>
<span class="lineno"></span><span class="op" id="3304001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="3304004">type</span>&nbsp;<span class="ident" id="3304009">encoding</span>&nbsp;<span class="builtintype" id="3304018">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3304023">const</span>&nbsp;<span class="op" id="3304029">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3304032">encodePath</span>&nbsp;<span class="ident" id="3304043">encoding</span>&nbsp;<span class="op" id="3304052">=</span>&nbsp;<span class="num" id="3304054">1</span>&nbsp;<span class="op" id="3304056">+</span>&nbsp;<span class="ident" id="3304058">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3304064">encodeUserPassword</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3304084">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3304106">encodeFragment</span><br>
<span class="lineno"></span><span class="op" id="3304121">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3304124">type</span>&nbsp;<span class="ident" id="3304129">EscapeError</span>&nbsp;<span class="builtintype" id="3304141">string</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3304149">func</span>&nbsp;<span class="op" id="3304154">(</span><span class="ident" id="3304155">e</span>&nbsp;<span class="ident" id="3304157">EscapeError</span><span class="op" id="3304168">)</span>&nbsp;<span class="ident" id="3304170">Error</span><span class="op" id="3304175">(</span><span class="op" id="3304176">)</span>&nbsp;<span class="builtintype" id="3304178">string</span>&nbsp;<span class="op" id="3304185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304188">return</span>&nbsp;<span class="string" id="3304195">&#34;invalid&nbsp;URL&nbsp;escape&nbsp;&#34;</span>&nbsp;<span class="op" id="3304217">+</span>&nbsp;<span class="ident" id="3304219">strconv</span><span class="op" id="3304226">.</span><span class="ident" id="3304227">Quote</span><span class="op" id="3304232">(</span><span class="builtintype" id="3304233">string</span><span class="op" id="3304239">(</span><span class="ident" id="3304240">e</span><span class="op" id="3304241">)</span><span class="op" id="3304242">)</span><br>
<span class="lineno"></span><span class="op" id="3304244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3304247">//&nbsp;Return&nbsp;true&nbsp;if&nbsp;the&nbsp;specified&nbsp;character&nbsp;should&nbsp;be&nbsp;escaped&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="3304312">//&nbsp;appearing&nbsp;in&nbsp;a&nbsp;URL&nbsp;string,&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3304365">func</span>&nbsp;<span class="ident" id="3304370">shouldEscape</span><span class="op" id="3304382">(</span><span class="ident" id="3304383">c</span>&nbsp;<span class="builtintype" id="3304385">byte</span><span class="op" id="3304389">,</span>&nbsp;<span class="ident" id="3304391">mode</span>&nbsp;<span class="ident" id="3304396">encoding</span><span class="op" id="3304404">)</span>&nbsp;<span class="builtintype" id="3304406">bool</span>&nbsp;<span class="op" id="3304411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3304414">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(alphanum)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304457">if</span>&nbsp;<span class="string" id="3304460">&#39;A&#39;</span>&nbsp;<span class="op" id="3304464">&lt;=</span>&nbsp;<span class="ident" id="3304467">c</span>&nbsp;<span class="op" id="3304469">&amp;&amp;</span>&nbsp;<span class="ident" id="3304472">c</span>&nbsp;<span class="op" id="3304474">&lt;=</span>&nbsp;<span class="string" id="3304477">&#39;Z&#39;</span>&nbsp;<span class="op" id="3304481">||</span>&nbsp;<span class="string" id="3304484">&#39;a&#39;</span>&nbsp;<span class="op" id="3304488">&lt;=</span>&nbsp;<span class="ident" id="3304491">c</span>&nbsp;<span class="op" id="3304493">&amp;&amp;</span>&nbsp;<span class="ident" id="3304496">c</span>&nbsp;<span class="op" id="3304498">&lt;=</span>&nbsp;<span class="string" id="3304501">&#39;z&#39;</span>&nbsp;<span class="op" id="3304505">||</span>&nbsp;<span class="string" id="3304508">&#39;0&#39;</span>&nbsp;<span class="op" id="3304512">&lt;=</span>&nbsp;<span class="ident" id="3304515">c</span>&nbsp;<span class="op" id="3304517">&amp;&amp;</span>&nbsp;<span class="ident" id="3304520">c</span>&nbsp;<span class="op" id="3304522">&lt;=</span>&nbsp;<span class="string" id="3304525">&#39;9&#39;</span>&nbsp;<span class="op" id="3304529">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304533">return</span>&nbsp;<span class="builtintype" id="3304540">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3304547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304551">switch</span>&nbsp;<span class="ident" id="3304558">c</span>&nbsp;<span class="op" id="3304560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304563">case</span>&nbsp;<span class="string" id="3304568">&#39;-&#39;</span><span class="op" id="3304571">,</span>&nbsp;<span class="string" id="3304573">&#39;_&#39;</span><span class="op" id="3304576">,</span>&nbsp;<span class="string" id="3304578">&#39;.&#39;</span><span class="op" id="3304581">,</span>&nbsp;<span class="string" id="3304583">&#39;~&#39;</span><span class="op" id="3304586">:</span>&nbsp;<span class="comment" id="3304588">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(mark)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304628">return</span>&nbsp;<span class="builtintype" id="3304635">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304643">case</span>&nbsp;<span class="string" id="3304648">&#39;$&#39;</span><span class="op" id="3304651">,</span>&nbsp;<span class="string" id="3304653">&#39;&amp;&#39;</span><span class="op" id="3304656">,</span>&nbsp;<span class="string" id="3304658">&#39;+&#39;</span><span class="op" id="3304661">,</span>&nbsp;<span class="string" id="3304663">&#39;,&#39;</span><span class="op" id="3304666">,</span>&nbsp;<span class="string" id="3304668">&#39;/&#39;</span><span class="op" id="3304671">,</span>&nbsp;<span class="string" id="3304673">&#39;:&#39;</span><span class="op" id="3304676">,</span>&nbsp;<span class="string" id="3304678">&#39;;&#39;</span><span class="op" id="3304681">,</span>&nbsp;<span class="string" id="3304683">&#39;=&#39;</span><span class="op" id="3304686">,</span>&nbsp;<span class="string" id="3304688">&#39;?&#39;</span><span class="op" id="3304691">,</span>&nbsp;<span class="string" id="3304693">&#39;@&#39;</span><span class="op" id="3304696">:</span>&nbsp;<span class="comment" id="3304698">//&nbsp;§2.2&nbsp;Reserved&nbsp;characters&nbsp;(reserved)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3304740">//&nbsp;Different&nbsp;sections&nbsp;of&nbsp;the&nbsp;URL&nbsp;allow&nbsp;a&nbsp;few&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3304790">//&nbsp;the&nbsp;reserved&nbsp;characters&nbsp;to&nbsp;appear&nbsp;unescaped.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304840">switch</span>&nbsp;<span class="ident" id="3304847">mode</span>&nbsp;<span class="op" id="3304852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304856">case</span>&nbsp;<span class="ident" id="3304861">encodePath</span><span class="op" id="3304871">:</span>&nbsp;<span class="comment" id="3304873">//&nbsp;§3.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3304885">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;:&nbsp;@&nbsp;&amp;&nbsp;=&nbsp;+&nbsp;$&nbsp;but&nbsp;saves&nbsp;/&nbsp;;&nbsp;,&nbsp;for&nbsp;assigning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3304948">//&nbsp;meaning&nbsp;to&nbsp;individual&nbsp;path&nbsp;segments.&nbsp;This&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3305004">//&nbsp;only&nbsp;manipulates&nbsp;the&nbsp;path&nbsp;as&nbsp;a&nbsp;whole,&nbsp;so&nbsp;we&nbsp;allow&nbsp;those</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3305066">//&nbsp;last&nbsp;two&nbsp;as&nbsp;well.&nbsp;That&nbsp;leaves&nbsp;only&nbsp;?&nbsp;to&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305120">return</span>&nbsp;<span class="ident" id="3305127">c</span>&nbsp;<span class="op" id="3305129">==</span>&nbsp;<span class="string" id="3305132">&#39;?&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305139">case</span>&nbsp;<span class="ident" id="3305144">encodeUserPassword</span><span class="op" id="3305162">:</span>&nbsp;<span class="comment" id="3305164">//&nbsp;§3.2.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3305178">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;&#39;;&#39;,&nbsp;&#39;:&#39;,&nbsp;&#39;&amp;&#39;,&nbsp;&#39;=&#39;,&nbsp;&#39;+&#39;,&nbsp;&#39;$&#39;,&nbsp;and&nbsp;&#39;,&#39;&nbsp;in</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3305240">//&nbsp;userinfo,&nbsp;so&nbsp;we&nbsp;must&nbsp;escape&nbsp;only&nbsp;&#39;@&#39;,&nbsp;&#39;/&#39;,&nbsp;and&nbsp;&#39;?&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3305298">//&nbsp;The&nbsp;parsing&nbsp;of&nbsp;userinfo&nbsp;treats&nbsp;&#39;:&#39;&nbsp;as&nbsp;special&nbsp;so&nbsp;we&nbsp;must&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3305368">//&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305384">return</span>&nbsp;<span class="ident" id="3305391">c</span>&nbsp;<span class="op" id="3305393">==</span>&nbsp;<span class="string" id="3305396">&#39;@&#39;</span>&nbsp;<span class="op" id="3305400">||</span>&nbsp;<span class="ident" id="3305403">c</span>&nbsp;<span class="op" id="3305405">==</span>&nbsp;<span class="string" id="3305408">&#39;/&#39;</span>&nbsp;<span class="op" id="3305412">||</span>&nbsp;<span class="ident" id="3305415">c</span>&nbsp;<span class="op" id="3305417">==</span>&nbsp;<span class="string" id="3305420">&#39;?&#39;</span>&nbsp;<span class="op" id="3305424">||</span>&nbsp;<span class="ident" id="3305427">c</span>&nbsp;<span class="op" id="3305429">==</span>&nbsp;<span class="string" id="3305432">&#39;:&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305439">case</span>&nbsp;<span class="ident" id="3305444">encodeQueryComponent</span><span class="op" id="3305464">:</span>&nbsp;<span class="comment" id="3305466">//&nbsp;§3.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3305478">//&nbsp;The&nbsp;RFC&nbsp;reserves&nbsp;(so&nbsp;we&nbsp;must&nbsp;escape)&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305533">return</span>&nbsp;<span class="builtintype" id="3305540">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305548">case</span>&nbsp;<span class="ident" id="3305553">encodeFragment</span><span class="op" id="3305567">:</span>&nbsp;<span class="comment" id="3305569">//&nbsp;§4.1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3305581">//&nbsp;The&nbsp;RFC&nbsp;text&nbsp;is&nbsp;silent&nbsp;but&nbsp;the&nbsp;grammar&nbsp;allows</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3305633">//&nbsp;everything,&nbsp;so&nbsp;escape&nbsp;nothing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305670">return</span>&nbsp;<span class="builtintype" id="3305677">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3305685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3305688">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3305692">//&nbsp;Everything&nbsp;else&nbsp;must&nbsp;be&nbsp;escaped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305729">return</span>&nbsp;<span class="builtintype" id="3305736">true</span><br>
<span class="lineno"></span><span class="op" id="3305741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="3305744">//&nbsp;QueryUnescape&nbsp;does&nbsp;the&nbsp;inverse&nbsp;transformation&nbsp;of&nbsp;QueryEscape,&nbsp;converting</span><br>
<span class="lineno"></span><span class="comment" id="3305820">//&nbsp;%AB&nbsp;into&nbsp;the&nbsp;byte&nbsp;0xAB&nbsp;and&nbsp;&#39;+&#39;&nbsp;into&nbsp;&#39;&nbsp;&#39;&nbsp;(space).&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3305895">//&nbsp;any&nbsp;%&nbsp;is&nbsp;not&nbsp;followed&nbsp;by&nbsp;two&nbsp;hexadecimal&nbsp;digits.</span><br>
<span class="lineno"></span><span class="keyword" id="3305947">func</span>&nbsp;<span class="ident" id="3305952">QueryUnescape</span><span class="op" id="3305965">(</span><span class="ident" id="3305966">s</span>&nbsp;<span class="builtintype" id="3305968">string</span><span class="op" id="3305974">)</span>&nbsp;<span class="op" id="3305976">(</span><span class="builtintype" id="3305977">string</span><span class="op" id="3305983">,</span>&nbsp;<span class="builtintype" id="3305985">error</span><span class="op" id="3305990">)</span>&nbsp;<span class="op" id="3305992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305995">return</span>&nbsp;<span class="ident" id="3306002">unescape</span><span class="op" id="3306010">(</span><span class="ident" id="3306011">s</span><span class="op" id="3306012">,</span>&nbsp;<span class="ident" id="3306014">encodeQueryComponent</span><span class="op" id="3306034">)</span><br>
<span class="lineno">115</span><span class="op" id="3306036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3306039">//&nbsp;unescape&nbsp;unescapes&nbsp;a&nbsp;string;&nbsp;the&nbsp;mode&nbsp;specifies</span><br>
<span class="lineno"></span><span class="comment" id="3306090">//&nbsp;which&nbsp;section&nbsp;of&nbsp;the&nbsp;URL&nbsp;string&nbsp;is&nbsp;being&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="3306145">func</span>&nbsp;<span class="ident" id="3306150">unescape</span><span class="op" id="3306158">(</span><span class="ident" id="3306159">s</span>&nbsp;<span class="builtintype" id="3306161">string</span><span class="op" id="3306167">,</span>&nbsp;<span class="ident" id="3306169">mode</span>&nbsp;<span class="ident" id="3306174">encoding</span><span class="op" id="3306182">)</span>&nbsp;<span class="op" id="3306184">(</span><span class="builtintype" id="3306185">string</span><span class="op" id="3306191">,</span>&nbsp;<span class="builtintype" id="3306193">error</span><span class="op" id="3306198">)</span>&nbsp;<span class="op" id="3306200">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3306203">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306248">n</span>&nbsp;<span class="op" id="3306250">:=</span>&nbsp;<span class="num" id="3306253">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306256">hasPlus</span>&nbsp;<span class="op" id="3306264">:=</span>&nbsp;<span class="builtintype" id="3306267">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306274">for</span>&nbsp;<span class="ident" id="3306278">i</span>&nbsp;<span class="op" id="3306280">:=</span>&nbsp;<span class="num" id="3306283">0</span><span class="op" id="3306284">;</span>&nbsp;<span class="ident" id="3306286">i</span>&nbsp;<span class="op" id="3306288">&lt;</span>&nbsp;<span class="builtinfunc" id="3306290">len</span><span class="op" id="3306293">(</span><span class="ident" id="3306294">s</span><span class="op" id="3306295">)</span><span class="op" id="3306296">;</span>&nbsp;<span class="op" id="3306298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306302">switch</span>&nbsp;<span class="ident" id="3306309">s</span><span class="op" id="3306310">[</span><span class="ident" id="3306311">i</span><span class="op" id="3306312">]</span>&nbsp;<span class="op" id="3306314">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306318">case</span>&nbsp;<span class="string" id="3306323">&#39;%&#39;</span><span class="op" id="3306326">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306331">n</span><span class="op" id="3306332">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306338">if</span>&nbsp;<span class="ident" id="3306341">i</span><span class="op" id="3306342">+</span><span class="num" id="3306343">2</span>&nbsp;<span class="op" id="3306345">&gt;=</span>&nbsp;<span class="builtinfunc" id="3306348">len</span><span class="op" id="3306351">(</span><span class="ident" id="3306352">s</span><span class="op" id="3306353">)</span>&nbsp;<span class="op" id="3306355">||</span>&nbsp;<span class="op" id="3306358">!</span><span class="ident" id="3306359">ishex</span><span class="op" id="3306364">(</span><span class="ident" id="3306365">s</span><span class="op" id="3306366">[</span><span class="ident" id="3306367">i</span><span class="op" id="3306368">+</span><span class="num" id="3306369">1</span><span class="op" id="3306370">]</span><span class="op" id="3306371">)</span>&nbsp;<span class="op" id="3306373">||</span>&nbsp;<span class="op" id="3306376">!</span><span class="ident" id="3306377">ishex</span><span class="op" id="3306382">(</span><span class="ident" id="3306383">s</span><span class="op" id="3306384">[</span><span class="ident" id="3306385">i</span><span class="op" id="3306386">+</span><span class="num" id="3306387">2</span><span class="op" id="3306388">]</span><span class="op" id="3306389">)</span>&nbsp;<span class="op" id="3306391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306397">s</span>&nbsp;<span class="op" id="3306399">=</span>&nbsp;<span class="ident" id="3306401">s</span><span class="op" id="3306402">[</span><span class="ident" id="3306403">i</span><span class="op" id="3306404">:</span><span class="op" id="3306405">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306411">if</span>&nbsp;<span class="builtinfunc" id="3306414">len</span><span class="op" id="3306417">(</span><span class="ident" id="3306418">s</span><span class="op" id="3306419">)</span>&nbsp;<span class="op" id="3306421">&gt;</span>&nbsp;<span class="num" id="3306423">3</span>&nbsp;<span class="op" id="3306425">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306432">s</span>&nbsp;<span class="op" id="3306434">=</span>&nbsp;<span class="ident" id="3306436">s</span><span class="op" id="3306437">[</span><span class="num" id="3306438">0</span><span class="op" id="3306439">:</span><span class="num" id="3306440">3</span><span class="op" id="3306441">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3306447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306453">return</span>&nbsp;<span class="string" id="3306460">&#34;&#34;</span><span class="op" id="3306462">,</span>&nbsp;<span class="ident" id="3306464">EscapeError</span><span class="op" id="3306475">(</span><span class="ident" id="3306476">s</span><span class="op" id="3306477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3306482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306487">i</span>&nbsp;<span class="op" id="3306489">+=</span>&nbsp;<span class="num" id="3306492">3</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306496">case</span>&nbsp;<span class="string" id="3306501">&#39;+&#39;</span><span class="op" id="3306504">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306509">hasPlus</span>&nbsp;<span class="op" id="3306517">=</span>&nbsp;<span class="ident" id="3306519">mode</span>&nbsp;<span class="op" id="3306524">==</span>&nbsp;<span class="ident" id="3306527">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306551">i</span><span class="op" id="3306552">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306557">default</span><span class="op" id="3306564">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306569">i</span><span class="op" id="3306570">++</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3306575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3306578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306582">if</span>&nbsp;<span class="ident" id="3306585">n</span>&nbsp;<span class="op" id="3306587">==</span>&nbsp;<span class="num" id="3306590">0</span>&nbsp;<span class="op" id="3306592">&amp;&amp;</span>&nbsp;<span class="op" id="3306595">!</span><span class="ident" id="3306596">hasPlus</span>&nbsp;<span class="op" id="3306604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306608">return</span>&nbsp;<span class="ident" id="3306615">s</span><span class="op" id="3306616">,</span>&nbsp;<span class="ident" id="3306618">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3306623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306627">t</span>&nbsp;<span class="op" id="3306629">:=</span>&nbsp;<span class="builtinfunc" id="3306632">make</span><span class="op" id="3306636">(</span><span class="op" id="3306637">[</span><span class="op" id="3306638">]</span><span class="builtintype" id="3306639">byte</span><span class="op" id="3306643">,</span>&nbsp;<span class="builtinfunc" id="3306645">len</span><span class="op" id="3306648">(</span><span class="ident" id="3306649">s</span><span class="op" id="3306650">)</span><span class="op" id="3306651">-</span><span class="num" id="3306652">2</span><span class="op" id="3306653">*</span><span class="ident" id="3306654">n</span><span class="op" id="3306655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306658">j</span>&nbsp;<span class="op" id="3306660">:=</span>&nbsp;<span class="num" id="3306663">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306666">for</span>&nbsp;<span class="ident" id="3306670">i</span>&nbsp;<span class="op" id="3306672">:=</span>&nbsp;<span class="num" id="3306675">0</span><span class="op" id="3306676">;</span>&nbsp;<span class="ident" id="3306678">i</span>&nbsp;<span class="op" id="3306680">&lt;</span>&nbsp;<span class="builtinfunc" id="3306682">len</span><span class="op" id="3306685">(</span><span class="ident" id="3306686">s</span><span class="op" id="3306687">)</span><span class="op" id="3306688">;</span>&nbsp;<span class="op" id="3306690">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306694">switch</span>&nbsp;<span class="ident" id="3306701">s</span><span class="op" id="3306702">[</span><span class="ident" id="3306703">i</span><span class="op" id="3306704">]</span>&nbsp;<span class="op" id="3306706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306710">case</span>&nbsp;<span class="string" id="3306715">&#39;%&#39;</span><span class="op" id="3306718">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306723">t</span><span class="op" id="3306724">[</span><span class="ident" id="3306725">j</span><span class="op" id="3306726">]</span>&nbsp;<span class="op" id="3306728">=</span>&nbsp;<span class="ident" id="3306730">unhex</span><span class="op" id="3306735">(</span><span class="ident" id="3306736">s</span><span class="op" id="3306737">[</span><span class="ident" id="3306738">i</span><span class="op" id="3306739">+</span><span class="num" id="3306740">1</span><span class="op" id="3306741">]</span><span class="op" id="3306742">)</span><span class="op" id="3306743">&lt;&lt;</span><span class="num" id="3306745">4</span>&nbsp;<span class="op" id="3306747">|</span>&nbsp;<span class="ident" id="3306749">unhex</span><span class="op" id="3306754">(</span><span class="ident" id="3306755">s</span><span class="op" id="3306756">[</span><span class="ident" id="3306757">i</span><span class="op" id="3306758">+</span><span class="num" id="3306759">2</span><span class="op" id="3306760">]</span><span class="op" id="3306761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306766">j</span><span class="op" id="3306767">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306773">i</span>&nbsp;<span class="op" id="3306775">+=</span>&nbsp;<span class="num" id="3306778">3</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306782">case</span>&nbsp;<span class="string" id="3306787">&#39;+&#39;</span><span class="op" id="3306790">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306795">if</span>&nbsp;<span class="ident" id="3306798">mode</span>&nbsp;<span class="op" id="3306803">==</span>&nbsp;<span class="ident" id="3306806">encodeQueryComponent</span>&nbsp;<span class="op" id="3306827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306833">t</span><span class="op" id="3306834">[</span><span class="ident" id="3306835">j</span><span class="op" id="3306836">]</span>&nbsp;<span class="op" id="3306838">=</span>&nbsp;<span class="string" id="3306840">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3306847">}</span>&nbsp;<span class="keyword" id="3306849">else</span>&nbsp;<span class="op" id="3306854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306860">t</span><span class="op" id="3306861">[</span><span class="ident" id="3306862">j</span><span class="op" id="3306863">]</span>&nbsp;<span class="op" id="3306865">=</span>&nbsp;<span class="string" id="3306867">&#39;+&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3306874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306879">j</span><span class="op" id="3306880">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306886">i</span><span class="op" id="3306887">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306892">default</span><span class="op" id="3306899">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306904">t</span><span class="op" id="3306905">[</span><span class="ident" id="3306906">j</span><span class="op" id="3306907">]</span>&nbsp;<span class="op" id="3306909">=</span>&nbsp;<span class="ident" id="3306911">s</span><span class="op" id="3306912">[</span><span class="ident" id="3306913">i</span><span class="op" id="3306914">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306919">j</span><span class="op" id="3306920">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306926">i</span><span class="op" id="3306927">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3306932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3306935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306938">return</span>&nbsp;<span class="builtintype" id="3306945">string</span><span class="op" id="3306951">(</span><span class="ident" id="3306952">t</span><span class="op" id="3306953">)</span><span class="op" id="3306954">,</span>&nbsp;<span class="ident" id="3306956">nil</span><br>
<span class="lineno">170</span><span class="op" id="3306960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3306963">//&nbsp;QueryEscape&nbsp;escapes&nbsp;the&nbsp;string&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;safely&nbsp;placed</span><br>
<span class="lineno"></span><span class="comment" id="3307024">//&nbsp;inside&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno"></span><span class="keyword" id="3307047">func</span>&nbsp;<span class="ident" id="3307052">QueryEscape</span><span class="op" id="3307063">(</span><span class="ident" id="3307064">s</span>&nbsp;<span class="builtintype" id="3307066">string</span><span class="op" id="3307072">)</span>&nbsp;<span class="builtintype" id="3307074">string</span>&nbsp;<span class="op" id="3307081">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307084">return</span>&nbsp;<span class="ident" id="3307091">escape</span><span class="op" id="3307097">(</span><span class="ident" id="3307098">s</span><span class="op" id="3307099">,</span>&nbsp;<span class="ident" id="3307101">encodeQueryComponent</span><span class="op" id="3307121">)</span><br>
<span class="lineno"></span><span class="op" id="3307123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3307126">func</span>&nbsp;<span class="ident" id="3307131">escape</span><span class="op" id="3307137">(</span><span class="ident" id="3307138">s</span>&nbsp;<span class="builtintype" id="3307140">string</span><span class="op" id="3307146">,</span>&nbsp;<span class="ident" id="3307148">mode</span>&nbsp;<span class="ident" id="3307153">encoding</span><span class="op" id="3307161">)</span>&nbsp;<span class="builtintype" id="3307163">string</span>&nbsp;<span class="op" id="3307170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307173">spaceCount</span><span class="op" id="3307183">,</span>&nbsp;<span class="ident" id="3307185">hexCount</span>&nbsp;<span class="op" id="3307194">:=</span>&nbsp;<span class="num" id="3307197">0</span><span class="op" id="3307198">,</span>&nbsp;<span class="num" id="3307200">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307203">for</span>&nbsp;<span class="ident" id="3307207">i</span>&nbsp;<span class="op" id="3307209">:=</span>&nbsp;<span class="num" id="3307212">0</span><span class="op" id="3307213">;</span>&nbsp;<span class="ident" id="3307215">i</span>&nbsp;<span class="op" id="3307217">&lt;</span>&nbsp;<span class="builtinfunc" id="3307219">len</span><span class="op" id="3307222">(</span><span class="ident" id="3307223">s</span><span class="op" id="3307224">)</span><span class="op" id="3307225">;</span>&nbsp;<span class="ident" id="3307227">i</span><span class="op" id="3307228">++</span>&nbsp;<span class="op" id="3307231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307235">c</span>&nbsp;<span class="op" id="3307237">:=</span>&nbsp;<span class="ident" id="3307240">s</span><span class="op" id="3307241">[</span><span class="ident" id="3307242">i</span><span class="op" id="3307243">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307247">if</span>&nbsp;<span class="ident" id="3307250">shouldEscape</span><span class="op" id="3307262">(</span><span class="ident" id="3307263">c</span><span class="op" id="3307264">,</span>&nbsp;<span class="ident" id="3307266">mode</span><span class="op" id="3307270">)</span>&nbsp;<span class="op" id="3307272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307277">if</span>&nbsp;<span class="ident" id="3307280">c</span>&nbsp;<span class="op" id="3307282">==</span>&nbsp;<span class="string" id="3307285">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3307289">&amp;&amp;</span>&nbsp;<span class="ident" id="3307292">mode</span>&nbsp;<span class="op" id="3307297">==</span>&nbsp;<span class="ident" id="3307300">encodeQueryComponent</span>&nbsp;<span class="op" id="3307321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307327">spaceCount</span><span class="op" id="3307337">++</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307343">}</span>&nbsp;<span class="keyword" id="3307345">else</span>&nbsp;<span class="op" id="3307350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307356">hexCount</span><span class="op" id="3307364">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307377">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307381">if</span>&nbsp;<span class="ident" id="3307384">spaceCount</span>&nbsp;<span class="op" id="3307395">==</span>&nbsp;<span class="num" id="3307398">0</span>&nbsp;<span class="op" id="3307400">&amp;&amp;</span>&nbsp;<span class="ident" id="3307403">hexCount</span>&nbsp;<span class="op" id="3307412">==</span>&nbsp;<span class="num" id="3307415">0</span>&nbsp;<span class="op" id="3307417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307421">return</span>&nbsp;<span class="ident" id="3307428">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307435">t</span>&nbsp;<span class="op" id="3307437">:=</span>&nbsp;<span class="builtinfunc" id="3307440">make</span><span class="op" id="3307444">(</span><span class="op" id="3307445">[</span><span class="op" id="3307446">]</span><span class="builtintype" id="3307447">byte</span><span class="op" id="3307451">,</span>&nbsp;<span class="builtinfunc" id="3307453">len</span><span class="op" id="3307456">(</span><span class="ident" id="3307457">s</span><span class="op" id="3307458">)</span><span class="op" id="3307459">+</span><span class="num" id="3307460">2</span><span class="op" id="3307461">*</span><span class="ident" id="3307462">hexCount</span><span class="op" id="3307470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307473">j</span>&nbsp;<span class="op" id="3307475">:=</span>&nbsp;<span class="num" id="3307478">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307481">for</span>&nbsp;<span class="ident" id="3307485">i</span>&nbsp;<span class="op" id="3307487">:=</span>&nbsp;<span class="num" id="3307490">0</span><span class="op" id="3307491">;</span>&nbsp;<span class="ident" id="3307493">i</span>&nbsp;<span class="op" id="3307495">&lt;</span>&nbsp;<span class="builtinfunc" id="3307497">len</span><span class="op" id="3307500">(</span><span class="ident" id="3307501">s</span><span class="op" id="3307502">)</span><span class="op" id="3307503">;</span>&nbsp;<span class="ident" id="3307505">i</span><span class="op" id="3307506">++</span>&nbsp;<span class="op" id="3307509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307513">switch</span>&nbsp;<span class="ident" id="3307520">c</span>&nbsp;<span class="op" id="3307522">:=</span>&nbsp;<span class="ident" id="3307525">s</span><span class="op" id="3307526">[</span><span class="ident" id="3307527">i</span><span class="op" id="3307528">]</span><span class="op" id="3307529">;</span>&nbsp;<span class="op" id="3307531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307535">case</span>&nbsp;<span class="ident" id="3307540">c</span>&nbsp;<span class="op" id="3307542">==</span>&nbsp;<span class="string" id="3307545">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3307549">&amp;&amp;</span>&nbsp;<span class="ident" id="3307552">mode</span>&nbsp;<span class="op" id="3307557">==</span>&nbsp;<span class="ident" id="3307560">encodeQueryComponent</span><span class="op" id="3307580">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307585">t</span><span class="op" id="3307586">[</span><span class="ident" id="3307587">j</span><span class="op" id="3307588">]</span>&nbsp;<span class="op" id="3307590">=</span>&nbsp;<span class="string" id="3307592">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307599">j</span><span class="op" id="3307600">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307605">case</span>&nbsp;<span class="ident" id="3307610">shouldEscape</span><span class="op" id="3307622">(</span><span class="ident" id="3307623">c</span><span class="op" id="3307624">,</span>&nbsp;<span class="ident" id="3307626">mode</span><span class="op" id="3307630">)</span><span class="op" id="3307631">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307636">t</span><span class="op" id="3307637">[</span><span class="ident" id="3307638">j</span><span class="op" id="3307639">]</span>&nbsp;<span class="op" id="3307641">=</span>&nbsp;<span class="string" id="3307643">&#39;%&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307650">t</span><span class="op" id="3307651">[</span><span class="ident" id="3307652">j</span><span class="op" id="3307653">+</span><span class="num" id="3307654">1</span><span class="op" id="3307655">]</span>&nbsp;<span class="op" id="3307657">=</span>&nbsp;<span class="string" id="3307659">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3307677">[</span><span class="ident" id="3307678">c</span><span class="op" id="3307679">&gt;&gt;</span><span class="num" id="3307681">4</span><span class="op" id="3307682">]</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307687">t</span><span class="op" id="3307688">[</span><span class="ident" id="3307689">j</span><span class="op" id="3307690">+</span><span class="num" id="3307691">2</span><span class="op" id="3307692">]</span>&nbsp;<span class="op" id="3307694">=</span>&nbsp;<span class="string" id="3307696">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3307714">[</span><span class="ident" id="3307715">c</span><span class="op" id="3307716">&amp;</span><span class="num" id="3307717">15</span><span class="op" id="3307719">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307724">j</span>&nbsp;<span class="op" id="3307726">+=</span>&nbsp;<span class="num" id="3307729">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307733">default</span><span class="op" id="3307740">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307745">t</span><span class="op" id="3307746">[</span><span class="ident" id="3307747">j</span><span class="op" id="3307748">]</span>&nbsp;<span class="op" id="3307750">=</span>&nbsp;<span class="ident" id="3307752">s</span><span class="op" id="3307753">[</span><span class="ident" id="3307754">i</span><span class="op" id="3307755">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307760">j</span><span class="op" id="3307761">++</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307772">return</span>&nbsp;<span class="builtintype" id="3307779">string</span><span class="op" id="3307785">(</span><span class="ident" id="3307786">t</span><span class="op" id="3307787">)</span><br>
<span class="lineno"></span><span class="op" id="3307789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="3307792">//&nbsp;A&nbsp;URL&nbsp;represents&nbsp;a&nbsp;parsed&nbsp;URL&nbsp;(technically,&nbsp;a&nbsp;URI&nbsp;reference).</span><br>
<span class="lineno"></span><span class="comment" id="3307857">//&nbsp;The&nbsp;general&nbsp;form&nbsp;represented&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3307893">//</span><br>
<span class="lineno"></span><span class="comment" id="3307896">//&nbsp;&nbsp;&nbsp;&nbspscheme://[userinfo@]host/path[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3307948">//</span><br>
<span class="lineno">220</span><span class="comment" id="3307951">//&nbsp;URLs&nbsp;that&nbsp;do&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;slash&nbsp;after&nbsp;the&nbsp;scheme&nbsp;are&nbsp;interpreted&nbsp;as:</span><br>
<span class="lineno"></span><span class="comment" id="3308027">//</span><br>
<span class="lineno"></span><span class="comment" id="3308030">//&nbsp;&nbsp;&nbsp;&nbspscheme:opaque[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3308066">//</span><br>
<span class="lineno"></span><span class="comment" id="3308069">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;Path&nbsp;field&nbsp;is&nbsp;stored&nbsp;in&nbsp;decoded&nbsp;form:&nbsp;/%47%6f%2f&nbsp;becomes&nbsp;/Go/.</span><br>
<span class="lineno">225</span><span class="comment" id="3308149">//&nbsp;A&nbsp;consequence&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;impossible&nbsp;to&nbsp;tell&nbsp;which&nbsp;slashes&nbsp;in&nbsp;the&nbsp;Path&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="3308230">//&nbsp;slashes&nbsp;in&nbsp;the&nbsp;raw&nbsp;URL&nbsp;and&nbsp;which&nbsp;were&nbsp;%2f.&nbsp;This&nbsp;distinction&nbsp;is&nbsp;rarely&nbsp;important,</span><br>
<span class="lineno"></span><span class="comment" id="3308314">//&nbsp;but&nbsp;when&nbsp;it&nbsp;is&nbsp;a&nbsp;client&nbsp;must&nbsp;use&nbsp;other&nbsp;routines&nbsp;to&nbsp;parse&nbsp;the&nbsp;raw&nbsp;URL&nbsp;or&nbsp;construct</span><br>
<span class="lineno"></span><span class="comment" id="3308399">//&nbsp;the&nbsp;parsed&nbsp;URL.&nbsp;For&nbsp;example,&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;consult&nbsp;req.RequestURI,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3308478">//&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;can&nbsp;use&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Opaque:&nbsp;&#34;//example.com/Go%2f&#34;}</span><br>
<span class="lineno">230</span><span class="comment" id="3308560">//&nbsp;instead&nbsp;of&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Path:&nbsp;&#34;/Go/&#34;}.</span><br>
<span class="lineno"></span><span class="keyword" id="3308614">type</span>&nbsp;<span class="ident" id="3308619">URL</span>&nbsp;<span class="keyword" id="3308623">struct</span>&nbsp;<span class="op" id="3308630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3308633">Scheme</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3308642">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3308650">Opaque</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3308659">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3308669">//&nbsp;encoded&nbsp;opaque&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3308693">User</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3308702">*</span><span class="ident" id="3308703">Userinfo</span>&nbsp;<span class="comment" id="3308712">//&nbsp;username&nbsp;and&nbsp;password&nbsp;information</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3308750">Host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3308759">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3308769">//&nbsp;host&nbsp;or&nbsp;host:port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3308791">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3308800">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3308808">RawQuery</span>&nbsp;<span class="builtintype" id="3308817">string</span>&nbsp;<span class="comment" id="3308824">//&nbsp;encoded&nbsp;query&nbsp;values,&nbsp;without&nbsp;&#39;?&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3308862">Fragment</span>&nbsp;<span class="builtintype" id="3308871">string</span>&nbsp;<span class="comment" id="3308878">//&nbsp;fragment&nbsp;for&nbsp;references,&nbsp;without&nbsp;&#39;#&#39;</span><br>
<span class="lineno"></span><span class="op" id="3308918">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="3308921">//&nbsp;User&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3308981">//&nbsp;and&nbsp;no&nbsp;password&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3309005">func</span>&nbsp;<span class="ident" id="3309010">User</span><span class="op" id="3309014">(</span><span class="ident" id="3309015">username</span>&nbsp;<span class="builtintype" id="3309024">string</span><span class="op" id="3309030">)</span>&nbsp;<span class="op" id="3309032">*</span><span class="ident" id="3309033">Userinfo</span>&nbsp;<span class="op" id="3309042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3309045">return</span>&nbsp;<span class="op" id="3309052">&amp;</span><span class="ident" id="3309053">Userinfo</span><span class="op" id="3309061">{</span><span class="ident" id="3309062">username</span><span class="op" id="3309070">,</span>&nbsp;<span class="string" id="3309072">&#34;&#34;</span><span class="op" id="3309074">,</span>&nbsp;<span class="builtintype" id="3309076">false</span><span class="op" id="3309081">}</span><br>
<span class="lineno">245</span><span class="op" id="3309083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3309086">//&nbsp;UserPassword&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3309154">//&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="3309171">//&nbsp;This&nbsp;functionality&nbsp;should&nbsp;only&nbsp;be&nbsp;used&nbsp;with&nbsp;legacy&nbsp;web&nbsp;sites.</span><br>
<span class="lineno">250</span><span class="comment" id="3309236">//&nbsp;RFC&nbsp;2396&nbsp;warns&nbsp;that&nbsp;interpreting&nbsp;Userinfo&nbsp;this&nbsp;way</span><br>
<span class="lineno"></span><span class="comment" id="3309290">//&nbsp;``is&nbsp;NOT&nbsp;RECOMMENDED,&nbsp;because&nbsp;the&nbsp;passing&nbsp;of&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="3309353">//&nbsp;information&nbsp;in&nbsp;clear&nbsp;text&nbsp;(such&nbsp;as&nbsp;URI)&nbsp;has&nbsp;proven&nbsp;to&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3309415">//&nbsp;security&nbsp;risk&nbsp;in&nbsp;almost&nbsp;every&nbsp;case&nbsp;where&nbsp;it&nbsp;has&nbsp;been&nbsp;used.&#39;&#39;</span><br>
<span class="lineno"></span><span class="keyword" id="3309479">func</span>&nbsp;<span class="ident" id="3309484">UserPassword</span><span class="op" id="3309496">(</span><span class="ident" id="3309497">username</span><span class="op" id="3309505">,</span>&nbsp;<span class="ident" id="3309507">password</span>&nbsp;<span class="builtintype" id="3309516">string</span><span class="op" id="3309522">)</span>&nbsp;<span class="op" id="3309524">*</span><span class="ident" id="3309525">Userinfo</span>&nbsp;<span class="op" id="3309534">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3309537">return</span>&nbsp;<span class="op" id="3309544">&amp;</span><span class="ident" id="3309545">Userinfo</span><span class="op" id="3309553">{</span><span class="ident" id="3309554">username</span><span class="op" id="3309562">,</span>&nbsp;<span class="ident" id="3309564">password</span><span class="op" id="3309572">,</span>&nbsp;<span class="builtintype" id="3309574">true</span><span class="op" id="3309578">}</span><br>
<span class="lineno"></span><span class="op" id="3309580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3309583">//&nbsp;The&nbsp;Userinfo&nbsp;type&nbsp;is&nbsp;an&nbsp;immutable&nbsp;encapsulation&nbsp;of&nbsp;username&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3309650">//&nbsp;password&nbsp;details&nbsp;for&nbsp;a&nbsp;URL.&nbsp;An&nbsp;existing&nbsp;Userinfo&nbsp;value&nbsp;is&nbsp;guaranteed</span><br>
<span class="lineno">260</span><span class="comment" id="3309722">//&nbsp;to&nbsp;have&nbsp;a&nbsp;username&nbsp;set&nbsp;(potentially&nbsp;empty,&nbsp;as&nbsp;allowed&nbsp;by&nbsp;RFC&nbsp;2396),</span><br>
<span class="lineno"></span><span class="comment" id="3309793">//&nbsp;and&nbsp;optionally&nbsp;a&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="3309823">type</span>&nbsp;<span class="ident" id="3309828">Userinfo</span>&nbsp;<span class="keyword" id="3309837">struct</span>&nbsp;<span class="op" id="3309844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3309847">username</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3309859">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3309867">password</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3309879">string</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3309887">passwordSet</span>&nbsp;<span class="builtintype" id="3309899">bool</span><br>
<span class="lineno"></span><span class="op" id="3309904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3309907">//&nbsp;Username&nbsp;returns&nbsp;the&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="3309941">func</span>&nbsp;<span class="op" id="3309946">(</span><span class="ident" id="3309947">u</span>&nbsp;<span class="op" id="3309949">*</span><span class="ident" id="3309950">Userinfo</span><span class="op" id="3309958">)</span>&nbsp;<span class="ident" id="3309960">Username</span><span class="op" id="3309968">(</span><span class="op" id="3309969">)</span>&nbsp;<span class="builtintype" id="3309971">string</span>&nbsp;<span class="op" id="3309978">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3309981">return</span>&nbsp;<span class="ident" id="3309988">u</span><span class="op" id="3309989">.</span><span class="ident" id="3309990">username</span><br>
<span class="lineno"></span><span class="op" id="3309999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3310002">//&nbsp;Password&nbsp;returns&nbsp;the&nbsp;password&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;set,&nbsp;and&nbsp;whether&nbsp;it&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3310077">func</span>&nbsp;<span class="op" id="3310082">(</span><span class="ident" id="3310083">u</span>&nbsp;<span class="op" id="3310085">*</span><span class="ident" id="3310086">Userinfo</span><span class="op" id="3310094">)</span>&nbsp;<span class="ident" id="3310096">Password</span><span class="op" id="3310104">(</span><span class="op" id="3310105">)</span>&nbsp;<span class="op" id="3310107">(</span><span class="builtintype" id="3310108">string</span><span class="op" id="3310114">,</span>&nbsp;<span class="builtintype" id="3310116">bool</span><span class="op" id="3310120">)</span>&nbsp;<span class="op" id="3310122">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310125">if</span>&nbsp;<span class="ident" id="3310128">u</span><span class="op" id="3310129">.</span><span class="ident" id="3310130">passwordSet</span>&nbsp;<span class="op" id="3310142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310146">return</span>&nbsp;<span class="ident" id="3310153">u</span><span class="op" id="3310154">.</span><span class="ident" id="3310155">password</span><span class="op" id="3310163">,</span>&nbsp;<span class="builtintype" id="3310165">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3310171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310174">return</span>&nbsp;<span class="string" id="3310181">&#34;&#34;</span><span class="op" id="3310183">,</span>&nbsp;<span class="builtintype" id="3310185">false</span><br>
<span class="lineno"></span><span class="op" id="3310191">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3310194">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;userinfo&nbsp;information&nbsp;in&nbsp;the&nbsp;standard&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3310266">//&nbsp;of&nbsp;&#34;username[:password]&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3310295">func</span>&nbsp;<span class="op" id="3310300">(</span><span class="ident" id="3310301">u</span>&nbsp;<span class="op" id="3310303">*</span><span class="ident" id="3310304">Userinfo</span><span class="op" id="3310312">)</span>&nbsp;<span class="ident" id="3310314">String</span><span class="op" id="3310320">(</span><span class="op" id="3310321">)</span>&nbsp;<span class="builtintype" id="3310323">string</span>&nbsp;<span class="op" id="3310330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3310333">s</span>&nbsp;<span class="op" id="3310335">:=</span>&nbsp;<span class="ident" id="3310338">escape</span><span class="op" id="3310344">(</span><span class="ident" id="3310345">u</span><span class="op" id="3310346">.</span><span class="ident" id="3310347">username</span><span class="op" id="3310355">,</span>&nbsp;<span class="ident" id="3310357">encodeUserPassword</span><span class="op" id="3310375">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310378">if</span>&nbsp;<span class="ident" id="3310381">u</span><span class="op" id="3310382">.</span><span class="ident" id="3310383">passwordSet</span>&nbsp;<span class="op" id="3310395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3310399">s</span>&nbsp;<span class="op" id="3310401">+=</span>&nbsp;<span class="string" id="3310404">&#34;:&#34;</span>&nbsp;<span class="op" id="3310408">+</span>&nbsp;<span class="ident" id="3310410">escape</span><span class="op" id="3310416">(</span><span class="ident" id="3310417">u</span><span class="op" id="3310418">.</span><span class="ident" id="3310419">password</span><span class="op" id="3310427">,</span>&nbsp;<span class="ident" id="3310429">encodeUserPassword</span><span class="op" id="3310447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3310450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310453">return</span>&nbsp;<span class="ident" id="3310460">s</span><br>
<span class="lineno"></span><span class="op" id="3310462">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span><span class="comment" id="3310465">//&nbsp;Maybe&nbsp;rawurl&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;scheme:path.</span><br>
<span class="lineno"></span><span class="comment" id="3310509">//&nbsp;(Scheme&nbsp;must&nbsp;be&nbsp;[a-zA-Z][a-zA-Z0-9+-.]*)</span><br>
<span class="lineno"></span><span class="comment" id="3310553">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;scheme,&nbsp;path;&nbsp;else&nbsp;return&nbsp;&#34;&#34;,&nbsp;rawurl.</span><br>
<span class="lineno"></span><span class="keyword" id="3310608">func</span>&nbsp;<span class="ident" id="3310613">getscheme</span><span class="op" id="3310622">(</span><span class="ident" id="3310623">rawurl</span>&nbsp;<span class="builtintype" id="3310630">string</span><span class="op" id="3310636">)</span>&nbsp;<span class="op" id="3310638">(</span><span class="ident" id="3310639">scheme</span><span class="op" id="3310645">,</span>&nbsp;<span class="ident" id="3310647">path</span>&nbsp;<span class="builtintype" id="3310652">string</span><span class="op" id="3310658">,</span>&nbsp;<span class="ident" id="3310660">err</span>&nbsp;<span class="builtintype" id="3310664">error</span><span class="op" id="3310669">)</span>&nbsp;<span class="op" id="3310671">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310674">for</span>&nbsp;<span class="ident" id="3310678">i</span>&nbsp;<span class="op" id="3310680">:=</span>&nbsp;<span class="num" id="3310683">0</span><span class="op" id="3310684">;</span>&nbsp;<span class="ident" id="3310686">i</span>&nbsp;<span class="op" id="3310688">&lt;</span>&nbsp;<span class="builtinfunc" id="3310690">len</span><span class="op" id="3310693">(</span><span class="ident" id="3310694">rawurl</span><span class="op" id="3310700">)</span><span class="op" id="3310701">;</span>&nbsp;<span class="ident" id="3310703">i</span><span class="op" id="3310704">++</span>&nbsp;<span class="op" id="3310707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3310711">c</span>&nbsp;<span class="op" id="3310713">:=</span>&nbsp;<span class="ident" id="3310716">rawurl</span><span class="op" id="3310722">[</span><span class="ident" id="3310723">i</span><span class="op" id="3310724">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310728">switch</span>&nbsp;<span class="op" id="3310735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310739">case</span>&nbsp;<span class="string" id="3310744">&#39;a&#39;</span>&nbsp;<span class="op" id="3310748">&lt;=</span>&nbsp;<span class="ident" id="3310751">c</span>&nbsp;<span class="op" id="3310753">&amp;&amp;</span>&nbsp;<span class="ident" id="3310756">c</span>&nbsp;<span class="op" id="3310758">&lt;=</span>&nbsp;<span class="string" id="3310761">&#39;z&#39;</span>&nbsp;<span class="op" id="3310765">||</span>&nbsp;<span class="string" id="3310768">&#39;A&#39;</span>&nbsp;<span class="op" id="3310772">&lt;=</span>&nbsp;<span class="ident" id="3310775">c</span>&nbsp;<span class="op" id="3310777">&amp;&amp;</span>&nbsp;<span class="ident" id="3310780">c</span>&nbsp;<span class="op" id="3310782">&lt;=</span>&nbsp;<span class="string" id="3310785">&#39;Z&#39;</span><span class="op" id="3310788">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3310792">//&nbsp;do&nbsp;nothing</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310808">case</span>&nbsp;<span class="string" id="3310813">&#39;0&#39;</span>&nbsp;<span class="op" id="3310817">&lt;=</span>&nbsp;<span class="ident" id="3310820">c</span>&nbsp;<span class="op" id="3310822">&amp;&amp;</span>&nbsp;<span class="ident" id="3310825">c</span>&nbsp;<span class="op" id="3310827">&lt;=</span>&nbsp;<span class="string" id="3310830">&#39;9&#39;</span>&nbsp;<span class="op" id="3310834">||</span>&nbsp;<span class="ident" id="3310837">c</span>&nbsp;<span class="op" id="3310839">==</span>&nbsp;<span class="string" id="3310842">&#39;+&#39;</span>&nbsp;<span class="op" id="3310846">||</span>&nbsp;<span class="ident" id="3310849">c</span>&nbsp;<span class="op" id="3310851">==</span>&nbsp;<span class="string" id="3310854">&#39;-&#39;</span>&nbsp;<span class="op" id="3310858">||</span>&nbsp;<span class="ident" id="3310861">c</span>&nbsp;<span class="op" id="3310863">==</span>&nbsp;<span class="string" id="3310866">&#39;.&#39;</span><span class="op" id="3310869">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310874">if</span>&nbsp;<span class="ident" id="3310877">i</span>&nbsp;<span class="op" id="3310879">==</span>&nbsp;<span class="num" id="3310882">0</span>&nbsp;<span class="op" id="3310884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310890">return</span>&nbsp;<span class="string" id="3310897">&#34;&#34;</span><span class="op" id="3310899">,</span>&nbsp;<span class="ident" id="3310901">rawurl</span><span class="op" id="3310907">,</span>&nbsp;<span class="ident" id="3310909">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3310916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310920">case</span>&nbsp;<span class="ident" id="3310925">c</span>&nbsp;<span class="op" id="3310927">==</span>&nbsp;<span class="string" id="3310930">&#39;:&#39;</span><span class="op" id="3310933">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310938">if</span>&nbsp;<span class="ident" id="3310941">i</span>&nbsp;<span class="op" id="3310943">==</span>&nbsp;<span class="num" id="3310946">0</span>&nbsp;<span class="op" id="3310948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310954">return</span>&nbsp;<span class="string" id="3310961">&#34;&#34;</span><span class="op" id="3310963">,</span>&nbsp;<span class="string" id="3310965">&#34;&#34;</span><span class="op" id="3310967">,</span>&nbsp;<span class="ident" id="3310969">errors</span><span class="op" id="3310975">.</span><span class="ident" id="3310976">New</span><span class="op" id="3310979">(</span><span class="string" id="3310980">&#34;missing&nbsp;protocol&nbsp;scheme&#34;</span><span class="op" id="3311005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311015">return</span>&nbsp;<span class="ident" id="3311022">rawurl</span><span class="op" id="3311028">[</span><span class="num" id="3311029">0</span><span class="op" id="3311030">:</span><span class="ident" id="3311031">i</span><span class="op" id="3311032">]</span><span class="op" id="3311033">,</span>&nbsp;<span class="ident" id="3311035">rawurl</span><span class="op" id="3311041">[</span><span class="ident" id="3311042">i</span><span class="op" id="3311043">+</span><span class="num" id="3311044">1</span><span class="op" id="3311045">:</span><span class="op" id="3311046">]</span><span class="op" id="3311047">,</span>&nbsp;<span class="ident" id="3311049">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311055">default</span><span class="op" id="3311062">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3311067">//&nbsp;we&nbsp;have&nbsp;encountered&nbsp;an&nbsp;invalid&nbsp;character,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3311115">//&nbsp;so&nbsp;there&nbsp;is&nbsp;no&nbsp;valid&nbsp;scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311149">return</span>&nbsp;<span class="string" id="3311156">&#34;&#34;</span><span class="op" id="3311158">,</span>&nbsp;<span class="ident" id="3311160">rawurl</span><span class="op" id="3311166">,</span>&nbsp;<span class="ident" id="3311168">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311177">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311180">return</span>&nbsp;<span class="string" id="3311187">&#34;&#34;</span><span class="op" id="3311189">,</span>&nbsp;<span class="ident" id="3311191">rawurl</span><span class="op" id="3311197">,</span>&nbsp;<span class="ident" id="3311199">nil</span><br>
<span class="lineno"></span><span class="op" id="3311203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3311206">//&nbsp;Maybe&nbsp;s&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;t&nbsp;c&nbsp;u.</span><br>
<span class="lineno"></span><span class="comment" id="3311239">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;t,&nbsp;c&nbsp;u&nbsp;(or&nbsp;t,&nbsp;u&nbsp;if&nbsp;cutc&nbsp;==&nbsp;true).</span><br>
<span class="lineno">320</span><span class="comment" id="3311290">//&nbsp;If&nbsp;not,&nbsp;return&nbsp;s,&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3311315">func</span>&nbsp;<span class="ident" id="3311320">split</span><span class="op" id="3311325">(</span><span class="ident" id="3311326">s</span>&nbsp;<span class="builtintype" id="3311328">string</span><span class="op" id="3311334">,</span>&nbsp;<span class="ident" id="3311336">c</span>&nbsp;<span class="builtintype" id="3311338">string</span><span class="op" id="3311344">,</span>&nbsp;<span class="ident" id="3311346">cutc</span>&nbsp;<span class="builtintype" id="3311351">bool</span><span class="op" id="3311355">)</span>&nbsp;<span class="op" id="3311357">(</span><span class="builtintype" id="3311358">string</span><span class="op" id="3311364">,</span>&nbsp;<span class="builtintype" id="3311366">string</span><span class="op" id="3311372">)</span>&nbsp;<span class="op" id="3311374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311377">i</span>&nbsp;<span class="op" id="3311379">:=</span>&nbsp;<span class="ident" id="3311382">strings</span><span class="op" id="3311389">.</span><span class="ident" id="3311390">Index</span><span class="op" id="3311395">(</span><span class="ident" id="3311396">s</span><span class="op" id="3311397">,</span>&nbsp;<span class="ident" id="3311399">c</span><span class="op" id="3311400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311403">if</span>&nbsp;<span class="ident" id="3311406">i</span>&nbsp;<span class="op" id="3311408">&lt;</span>&nbsp;<span class="num" id="3311410">0</span>&nbsp;<span class="op" id="3311412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311416">return</span>&nbsp;<span class="ident" id="3311423">s</span><span class="op" id="3311424">,</span>&nbsp;<span class="string" id="3311426">&#34;&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311433">if</span>&nbsp;<span class="ident" id="3311436">cutc</span>&nbsp;<span class="op" id="3311441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311445">return</span>&nbsp;<span class="ident" id="3311452">s</span><span class="op" id="3311453">[</span><span class="num" id="3311454">0</span><span class="op" id="3311455">:</span><span class="ident" id="3311456">i</span><span class="op" id="3311457">]</span><span class="op" id="3311458">,</span>&nbsp;<span class="ident" id="3311460">s</span><span class="op" id="3311461">[</span><span class="ident" id="3311462">i</span><span class="op" id="3311463">+</span><span class="builtinfunc" id="3311464">len</span><span class="op" id="3311467">(</span><span class="ident" id="3311468">c</span><span class="op" id="3311469">)</span><span class="op" id="3311470">:</span><span class="op" id="3311471">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311477">return</span>&nbsp;<span class="ident" id="3311484">s</span><span class="op" id="3311485">[</span><span class="num" id="3311486">0</span><span class="op" id="3311487">:</span><span class="ident" id="3311488">i</span><span class="op" id="3311489">]</span><span class="op" id="3311490">,</span>&nbsp;<span class="ident" id="3311492">s</span><span class="op" id="3311493">[</span><span class="ident" id="3311494">i</span><span class="op" id="3311495">:</span><span class="op" id="3311496">]</span><br>
<span class="lineno">330</span><span class="op" id="3311498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3311501">//&nbsp;Parse&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="3311546">//&nbsp;The&nbsp;rawurl&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3311589">func</span>&nbsp;<span class="ident" id="3311594">Parse</span><span class="op" id="3311599">(</span><span class="ident" id="3311600">rawurl</span>&nbsp;<span class="builtintype" id="3311607">string</span><span class="op" id="3311613">)</span>&nbsp;<span class="op" id="3311615">(</span><span class="ident" id="3311616">url</span>&nbsp;<span class="op" id="3311620">*</span><span class="ident" id="3311621">URL</span><span class="op" id="3311624">,</span>&nbsp;<span class="ident" id="3311626">err</span>&nbsp;<span class="builtintype" id="3311630">error</span><span class="op" id="3311635">)</span>&nbsp;<span class="op" id="3311637">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3311640">//&nbsp;Cut&nbsp;off&nbsp;#frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311658">u</span><span class="op" id="3311659">,</span>&nbsp;<span class="ident" id="3311661">frag</span>&nbsp;<span class="op" id="3311666">:=</span>&nbsp;<span class="ident" id="3311669">split</span><span class="op" id="3311674">(</span><span class="ident" id="3311675">rawurl</span><span class="op" id="3311681">,</span>&nbsp;<span class="string" id="3311683">&#34;#&#34;</span><span class="op" id="3311686">,</span>&nbsp;<span class="builtintype" id="3311688">true</span><span class="op" id="3311692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311695">if</span>&nbsp;<span class="ident" id="3311698">url</span><span class="op" id="3311701">,</span>&nbsp;<span class="ident" id="3311703">err</span>&nbsp;<span class="op" id="3311707">=</span>&nbsp;<span class="ident" id="3311709">parse</span><span class="op" id="3311714">(</span><span class="ident" id="3311715">u</span><span class="op" id="3311716">,</span>&nbsp;<span class="builtintype" id="3311718">false</span><span class="op" id="3311723">)</span><span class="op" id="3311724">;</span>&nbsp;<span class="ident" id="3311726">err</span>&nbsp;<span class="op" id="3311730">!=</span>&nbsp;<span class="ident" id="3311733">nil</span>&nbsp;<span class="op" id="3311737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311741">return</span>&nbsp;<span class="ident" id="3311748">nil</span><span class="op" id="3311751">,</span>&nbsp;<span class="ident" id="3311753">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311758">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311761">if</span>&nbsp;<span class="ident" id="3311764">frag</span>&nbsp;<span class="op" id="3311769">==</span>&nbsp;<span class="string" id="3311772">&#34;&#34;</span>&nbsp;<span class="op" id="3311775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311779">return</span>&nbsp;<span class="ident" id="3311786">url</span><span class="op" id="3311789">,</span>&nbsp;<span class="ident" id="3311791">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311799">if</span>&nbsp;<span class="ident" id="3311802">url</span><span class="op" id="3311805">.</span><span class="ident" id="3311806">Fragment</span><span class="op" id="3311814">,</span>&nbsp;<span class="ident" id="3311816">err</span>&nbsp;<span class="op" id="3311820">=</span>&nbsp;<span class="ident" id="3311822">unescape</span><span class="op" id="3311830">(</span><span class="ident" id="3311831">frag</span><span class="op" id="3311835">,</span>&nbsp;<span class="ident" id="3311837">encodeFragment</span><span class="op" id="3311851">)</span><span class="op" id="3311852">;</span>&nbsp;<span class="ident" id="3311854">err</span>&nbsp;<span class="op" id="3311858">!=</span>&nbsp;<span class="ident" id="3311861">nil</span>&nbsp;<span class="op" id="3311865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311869">return</span>&nbsp;<span class="ident" id="3311876">nil</span><span class="op" id="3311879">,</span>&nbsp;<span class="op" id="3311881">&amp;</span><span class="ident" id="3311882">Error</span><span class="op" id="3311887">{</span><span class="string" id="3311888">&#34;parse&#34;</span><span class="op" id="3311895">,</span>&nbsp;<span class="ident" id="3311897">rawurl</span><span class="op" id="3311903">,</span>&nbsp;<span class="ident" id="3311905">err</span><span class="op" id="3311908">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311914">return</span>&nbsp;<span class="ident" id="3311921">url</span><span class="op" id="3311924">,</span>&nbsp;<span class="ident" id="3311926">nil</span><br>
<span class="lineno"></span><span class="op" id="3311930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3311933">//&nbsp;ParseRequestURI&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.&nbsp;&nbsp;It&nbsp;assumes&nbsp;that</span><br>
<span class="lineno">350</span><span class="comment" id="3312005">//&nbsp;rawurl&nbsp;was&nbsp;received&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request,&nbsp;so&nbsp;the&nbsp;rawurl&nbsp;is&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="3312077">//&nbsp;only&nbsp;as&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;or&nbsp;an&nbsp;absolute&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3312125">//&nbsp;The&nbsp;string&nbsp;rawurl&nbsp;is&nbsp;assumed&nbsp;not&nbsp;to&nbsp;have&nbsp;a&nbsp;#fragment&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="comment" id="3312189">//&nbsp;(Web&nbsp;browsers&nbsp;strip&nbsp;#fragment&nbsp;before&nbsp;sending&nbsp;the&nbsp;URL&nbsp;to&nbsp;a&nbsp;web&nbsp;server.)</span><br>
<span class="lineno"></span><span class="keyword" id="3312263">func</span>&nbsp;<span class="ident" id="3312268">ParseRequestURI</span><span class="op" id="3312283">(</span><span class="ident" id="3312284">rawurl</span>&nbsp;<span class="builtintype" id="3312291">string</span><span class="op" id="3312297">)</span>&nbsp;<span class="op" id="3312299">(</span><span class="ident" id="3312300">url</span>&nbsp;<span class="op" id="3312304">*</span><span class="ident" id="3312305">URL</span><span class="op" id="3312308">,</span>&nbsp;<span class="ident" id="3312310">err</span>&nbsp;<span class="builtintype" id="3312314">error</span><span class="op" id="3312319">)</span>&nbsp;<span class="op" id="3312321">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3312324">return</span>&nbsp;<span class="ident" id="3312331">parse</span><span class="op" id="3312336">(</span><span class="ident" id="3312337">rawurl</span><span class="op" id="3312343">,</span>&nbsp;<span class="builtintype" id="3312345">true</span><span class="op" id="3312349">)</span><br>
<span class="lineno"></span><span class="op" id="3312351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3312354">//&nbsp;parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;from&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;two&nbsp;contexts.&nbsp;&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3312418">//&nbsp;viaRequest&nbsp;is&nbsp;true,&nbsp;the&nbsp;URL&nbsp;is&nbsp;assumed&nbsp;to&nbsp;have&nbsp;arrived&nbsp;via&nbsp;an&nbsp;HTTP&nbsp;request,</span><br>
<span class="lineno">360</span><span class="comment" id="3312497">//&nbsp;in&nbsp;which&nbsp;case&nbsp;only&nbsp;absolute&nbsp;URLs&nbsp;or&nbsp;path-absolute&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="3312577">//&nbsp;If&nbsp;viaRequest&nbsp;is&nbsp;false,&nbsp;all&nbsp;forms&nbsp;of&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="keyword" id="3312644">func</span>&nbsp;<span class="ident" id="3312649">parse</span><span class="op" id="3312654">(</span><span class="ident" id="3312655">rawurl</span>&nbsp;<span class="builtintype" id="3312662">string</span><span class="op" id="3312668">,</span>&nbsp;<span class="ident" id="3312670">viaRequest</span>&nbsp;<span class="builtintype" id="3312681">bool</span><span class="op" id="3312685">)</span>&nbsp;<span class="op" id="3312687">(</span><span class="ident" id="3312688">url</span>&nbsp;<span class="op" id="3312692">*</span><span class="ident" id="3312693">URL</span><span class="op" id="3312696">,</span>&nbsp;<span class="ident" id="3312698">err</span>&nbsp;<span class="builtintype" id="3312702">error</span><span class="op" id="3312707">)</span>&nbsp;<span class="op" id="3312709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3312712">var</span>&nbsp;<span class="ident" id="3312716">rest</span>&nbsp;<span class="builtintype" id="3312721">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3312730">if</span>&nbsp;<span class="ident" id="3312733">rawurl</span>&nbsp;<span class="op" id="3312740">==</span>&nbsp;<span class="string" id="3312743">&#34;&#34;</span>&nbsp;<span class="op" id="3312746">&amp;&amp;</span>&nbsp;<span class="ident" id="3312749">viaRequest</span>&nbsp;<span class="op" id="3312760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3312764">err</span>&nbsp;<span class="op" id="3312768">=</span>&nbsp;<span class="ident" id="3312770">errors</span><span class="op" id="3312776">.</span><span class="ident" id="3312777">New</span><span class="op" id="3312780">(</span><span class="string" id="3312781">&#34;empty&nbsp;url&#34;</span><span class="op" id="3312792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3312796">goto</span>&nbsp;<span class="ident" id="3312801">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3312808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3312811">url</span>&nbsp;<span class="op" id="3312815">=</span>&nbsp;<span class="builtinfunc" id="3312817">new</span><span class="op" id="3312820">(</span><span class="ident" id="3312821">URL</span><span class="op" id="3312824">)</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3312828">if</span>&nbsp;<span class="ident" id="3312831">rawurl</span>&nbsp;<span class="op" id="3312838">==</span>&nbsp;<span class="string" id="3312841">&#34;*&#34;</span>&nbsp;<span class="op" id="3312845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3312849">url</span><span class="op" id="3312852">.</span><span class="ident" id="3312853">Path</span>&nbsp;<span class="op" id="3312858">=</span>&nbsp;<span class="string" id="3312860">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3312866">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3312874">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3312878">//&nbsp;Split&nbsp;off&nbsp;possible&nbsp;leading&nbsp;&#34;http:&#34;,&nbsp;&#34;mailto:&#34;,&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3312934">//&nbsp;Cannot&nbsp;contain&nbsp;escaped&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3312973">if</span>&nbsp;<span class="ident" id="3312976">url</span><span class="op" id="3312979">.</span><span class="ident" id="3312980">Scheme</span><span class="op" id="3312986">,</span>&nbsp;<span class="ident" id="3312988">rest</span><span class="op" id="3312992">,</span>&nbsp;<span class="ident" id="3312994">err</span>&nbsp;<span class="op" id="3312998">=</span>&nbsp;<span class="ident" id="3313000">getscheme</span><span class="op" id="3313009">(</span><span class="ident" id="3313010">rawurl</span><span class="op" id="3313016">)</span><span class="op" id="3313017">;</span>&nbsp;<span class="ident" id="3313019">err</span>&nbsp;<span class="op" id="3313023">!=</span>&nbsp;<span class="ident" id="3313026">nil</span>&nbsp;<span class="op" id="3313030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313034">goto</span>&nbsp;<span class="ident" id="3313039">Error</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3313049">url</span><span class="op" id="3313052">.</span><span class="ident" id="3313053">Scheme</span>&nbsp;<span class="op" id="3313060">=</span>&nbsp;<span class="ident" id="3313062">strings</span><span class="op" id="3313069">.</span><span class="ident" id="3313070">ToLower</span><span class="op" id="3313077">(</span><span class="ident" id="3313078">url</span><span class="op" id="3313081">.</span><span class="ident" id="3313082">Scheme</span><span class="op" id="3313088">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3313092">rest</span><span class="op" id="3313096">,</span>&nbsp;<span class="ident" id="3313098">url</span><span class="op" id="3313101">.</span><span class="ident" id="3313102">RawQuery</span>&nbsp;<span class="op" id="3313111">=</span>&nbsp;<span class="ident" id="3313113">split</span><span class="op" id="3313118">(</span><span class="ident" id="3313119">rest</span><span class="op" id="3313123">,</span>&nbsp;<span class="string" id="3313125">&#34;?&#34;</span><span class="op" id="3313128">,</span>&nbsp;<span class="builtintype" id="3313130">true</span><span class="op" id="3313134">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313138">if</span>&nbsp;<span class="op" id="3313141">!</span><span class="ident" id="3313142">strings</span><span class="op" id="3313149">.</span><span class="ident" id="3313150">HasPrefix</span><span class="op" id="3313159">(</span><span class="ident" id="3313160">rest</span><span class="op" id="3313164">,</span>&nbsp;<span class="string" id="3313166">&#34;/&#34;</span><span class="op" id="3313169">)</span>&nbsp;<span class="op" id="3313171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313175">if</span>&nbsp;<span class="ident" id="3313178">url</span><span class="op" id="3313181">.</span><span class="ident" id="3313182">Scheme</span>&nbsp;<span class="op" id="3313189">!=</span>&nbsp;<span class="string" id="3313192">&#34;&#34;</span>&nbsp;<span class="op" id="3313195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3313200">//&nbsp;We&nbsp;consider&nbsp;rootless&nbsp;paths&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;as&nbsp;opaque.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3313257">url</span><span class="op" id="3313260">.</span><span class="ident" id="3313261">Opaque</span>&nbsp;<span class="op" id="3313268">=</span>&nbsp;<span class="ident" id="3313270">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313278">return</span>&nbsp;<span class="ident" id="3313285">url</span><span class="op" id="3313288">,</span>&nbsp;<span class="ident" id="3313290">nil</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313300">if</span>&nbsp;<span class="ident" id="3313303">viaRequest</span>&nbsp;<span class="op" id="3313314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3313319">err</span>&nbsp;<span class="op" id="3313323">=</span>&nbsp;<span class="ident" id="3313325">errors</span><span class="op" id="3313331">.</span><span class="ident" id="3313332">New</span><span class="op" id="3313335">(</span><span class="string" id="3313336">&#34;invalid&nbsp;URI&nbsp;for&nbsp;request&#34;</span><span class="op" id="3313361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313366">goto</span>&nbsp;<span class="ident" id="3313371">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313379">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313386">if</span>&nbsp;<span class="op" id="3313389">(</span><span class="ident" id="3313390">url</span><span class="op" id="3313393">.</span><span class="ident" id="3313394">Scheme</span>&nbsp;<span class="op" id="3313401">!=</span>&nbsp;<span class="string" id="3313404">&#34;&#34;</span>&nbsp;<span class="op" id="3313407">||</span>&nbsp;<span class="op" id="3313410">!</span><span class="ident" id="3313411">viaRequest</span>&nbsp;<span class="op" id="3313422">&amp;&amp;</span>&nbsp;<span class="op" id="3313425">!</span><span class="ident" id="3313426">strings</span><span class="op" id="3313433">.</span><span class="ident" id="3313434">HasPrefix</span><span class="op" id="3313443">(</span><span class="ident" id="3313444">rest</span><span class="op" id="3313448">,</span>&nbsp;<span class="string" id="3313450">&#34;///&#34;</span><span class="op" id="3313455">)</span><span class="op" id="3313456">)</span>&nbsp;<span class="op" id="3313458">&amp;&amp;</span>&nbsp;<span class="ident" id="3313461">strings</span><span class="op" id="3313468">.</span><span class="ident" id="3313469">HasPrefix</span><span class="op" id="3313478">(</span><span class="ident" id="3313479">rest</span><span class="op" id="3313483">,</span>&nbsp;<span class="string" id="3313485">&#34;//&#34;</span><span class="op" id="3313489">)</span>&nbsp;<span class="op" id="3313491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313495">var</span>&nbsp;<span class="ident" id="3313499">authority</span>&nbsp;<span class="builtintype" id="3313509">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3313518">authority</span><span class="op" id="3313527">,</span>&nbsp;<span class="ident" id="3313529">rest</span>&nbsp;<span class="op" id="3313534">=</span>&nbsp;<span class="ident" id="3313536">split</span><span class="op" id="3313541">(</span><span class="ident" id="3313542">rest</span><span class="op" id="3313546">[</span><span class="num" id="3313547">2</span><span class="op" id="3313548">:</span><span class="op" id="3313549">]</span><span class="op" id="3313550">,</span>&nbsp;<span class="string" id="3313552">&#34;/&#34;</span><span class="op" id="3313555">,</span>&nbsp;<span class="builtintype" id="3313557">false</span><span class="op" id="3313562">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3313566">url</span><span class="op" id="3313569">.</span><span class="ident" id="3313570">User</span><span class="op" id="3313574">,</span>&nbsp;<span class="ident" id="3313576">url</span><span class="op" id="3313579">.</span><span class="ident" id="3313580">Host</span><span class="op" id="3313584">,</span>&nbsp;<span class="ident" id="3313586">err</span>&nbsp;<span class="op" id="3313590">=</span>&nbsp;<span class="ident" id="3313592">parseAuthority</span><span class="op" id="3313606">(</span><span class="ident" id="3313607">authority</span><span class="op" id="3313616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313620">if</span>&nbsp;<span class="ident" id="3313623">err</span>&nbsp;<span class="op" id="3313627">!=</span>&nbsp;<span class="ident" id="3313630">nil</span>&nbsp;<span class="op" id="3313634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313639">goto</span>&nbsp;<span class="ident" id="3313644">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313656">if</span>&nbsp;<span class="ident" id="3313659">strings</span><span class="op" id="3313666">.</span><span class="ident" id="3313667">Contains</span><span class="op" id="3313675">(</span><span class="ident" id="3313676">url</span><span class="op" id="3313679">.</span><span class="ident" id="3313680">Host</span><span class="op" id="3313684">,</span>&nbsp;<span class="string" id="3313686">&#34;%&#34;</span><span class="op" id="3313689">)</span>&nbsp;<span class="op" id="3313691">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3313696">err</span>&nbsp;<span class="op" id="3313700">=</span>&nbsp;<span class="ident" id="3313702">errors</span><span class="op" id="3313708">.</span><span class="ident" id="3313709">New</span><span class="op" id="3313712">(</span><span class="string" id="3313713">&#34;hexadecimal&nbsp;escape&nbsp;in&nbsp;host&#34;</span><span class="op" id="3313741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313746">goto</span>&nbsp;<span class="ident" id="3313751">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313765">if</span>&nbsp;<span class="ident" id="3313768">url</span><span class="op" id="3313771">.</span><span class="ident" id="3313772">Path</span><span class="op" id="3313776">,</span>&nbsp;<span class="ident" id="3313778">err</span>&nbsp;<span class="op" id="3313782">=</span>&nbsp;<span class="ident" id="3313784">unescape</span><span class="op" id="3313792">(</span><span class="ident" id="3313793">rest</span><span class="op" id="3313797">,</span>&nbsp;<span class="ident" id="3313799">encodePath</span><span class="op" id="3313809">)</span><span class="op" id="3313810">;</span>&nbsp;<span class="ident" id="3313812">err</span>&nbsp;<span class="op" id="3313816">!=</span>&nbsp;<span class="ident" id="3313819">nil</span>&nbsp;<span class="op" id="3313823">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313827">goto</span>&nbsp;<span class="ident" id="3313832">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313842">return</span>&nbsp;<span class="ident" id="3313849">url</span><span class="op" id="3313852">,</span>&nbsp;<span class="ident" id="3313854">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3313859">Error</span><span class="op" id="3313864">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313867">return</span>&nbsp;<span class="ident" id="3313874">nil</span><span class="op" id="3313877">,</span>&nbsp;<span class="op" id="3313879">&amp;</span><span class="ident" id="3313880">Error</span><span class="op" id="3313885">{</span><span class="string" id="3313886">&#34;parse&#34;</span><span class="op" id="3313893">,</span>&nbsp;<span class="ident" id="3313895">rawurl</span><span class="op" id="3313901">,</span>&nbsp;<span class="ident" id="3313903">err</span><span class="op" id="3313906">}</span><br>
<span class="lineno"></span><span class="op" id="3313908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3313911">func</span>&nbsp;<span class="ident" id="3313916">parseAuthority</span><span class="op" id="3313930">(</span><span class="ident" id="3313931">authority</span>&nbsp;<span class="builtintype" id="3313941">string</span><span class="op" id="3313947">)</span>&nbsp;<span class="op" id="3313949">(</span><span class="ident" id="3313950">user</span>&nbsp;<span class="op" id="3313955">*</span><span class="ident" id="3313956">Userinfo</span><span class="op" id="3313964">,</span>&nbsp;<span class="ident" id="3313966">host</span>&nbsp;<span class="builtintype" id="3313971">string</span><span class="op" id="3313977">,</span>&nbsp;<span class="ident" id="3313979">err</span>&nbsp;<span class="builtintype" id="3313983">error</span><span class="op" id="3313988">)</span>&nbsp;<span class="op" id="3313990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3313993">i</span>&nbsp;<span class="op" id="3313995">:=</span>&nbsp;<span class="ident" id="3313998">strings</span><span class="op" id="3314005">.</span><span class="ident" id="3314006">LastIndex</span><span class="op" id="3314015">(</span><span class="ident" id="3314016">authority</span><span class="op" id="3314025">,</span>&nbsp;<span class="string" id="3314027">&#34;@&#34;</span><span class="op" id="3314030">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314033">if</span>&nbsp;<span class="ident" id="3314036">i</span>&nbsp;<span class="op" id="3314038">&lt;</span>&nbsp;<span class="num" id="3314040">0</span>&nbsp;<span class="op" id="3314042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3314046">host</span>&nbsp;<span class="op" id="3314051">=</span>&nbsp;<span class="ident" id="3314053">authority</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314065">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3314073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3314076">userinfo</span><span class="op" id="3314084">,</span>&nbsp;<span class="ident" id="3314086">host</span>&nbsp;<span class="op" id="3314091">:=</span>&nbsp;<span class="ident" id="3314094">authority</span><span class="op" id="3314103">[</span><span class="op" id="3314104">:</span><span class="ident" id="3314105">i</span><span class="op" id="3314106">]</span><span class="op" id="3314107">,</span>&nbsp;<span class="ident" id="3314109">authority</span><span class="op" id="3314118">[</span><span class="ident" id="3314119">i</span><span class="op" id="3314120">+</span><span class="num" id="3314121">1</span><span class="op" id="3314122">:</span><span class="op" id="3314123">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314126">if</span>&nbsp;<span class="ident" id="3314129">strings</span><span class="op" id="3314136">.</span><span class="ident" id="3314137">Index</span><span class="op" id="3314142">(</span><span class="ident" id="3314143">userinfo</span><span class="op" id="3314151">,</span>&nbsp;<span class="string" id="3314153">&#34;:&#34;</span><span class="op" id="3314156">)</span>&nbsp;<span class="op" id="3314158">&lt;</span>&nbsp;<span class="num" id="3314160">0</span>&nbsp;<span class="op" id="3314162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314166">if</span>&nbsp;<span class="ident" id="3314169">userinfo</span><span class="op" id="3314177">,</span>&nbsp;<span class="ident" id="3314179">err</span>&nbsp;<span class="op" id="3314183">=</span>&nbsp;<span class="ident" id="3314185">unescape</span><span class="op" id="3314193">(</span><span class="ident" id="3314194">userinfo</span><span class="op" id="3314202">,</span>&nbsp;<span class="ident" id="3314204">encodeUserPassword</span><span class="op" id="3314222">)</span><span class="op" id="3314223">;</span>&nbsp;<span class="ident" id="3314225">err</span>&nbsp;<span class="op" id="3314229">!=</span>&nbsp;<span class="ident" id="3314232">nil</span>&nbsp;<span class="op" id="3314236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314241">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3314250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3314254">user</span>&nbsp;<span class="op" id="3314259">=</span>&nbsp;<span class="ident" id="3314261">User</span><span class="op" id="3314265">(</span><span class="ident" id="3314266">userinfo</span><span class="op" id="3314274">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3314277">}</span>&nbsp;<span class="keyword" id="3314279">else</span>&nbsp;<span class="op" id="3314284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3314288">username</span><span class="op" id="3314296">,</span>&nbsp;<span class="ident" id="3314298">password</span>&nbsp;<span class="op" id="3314307">:=</span>&nbsp;<span class="ident" id="3314310">split</span><span class="op" id="3314315">(</span><span class="ident" id="3314316">userinfo</span><span class="op" id="3314324">,</span>&nbsp;<span class="string" id="3314326">&#34;:&#34;</span><span class="op" id="3314329">,</span>&nbsp;<span class="builtintype" id="3314331">true</span><span class="op" id="3314335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314339">if</span>&nbsp;<span class="ident" id="3314342">username</span><span class="op" id="3314350">,</span>&nbsp;<span class="ident" id="3314352">err</span>&nbsp;<span class="op" id="3314356">=</span>&nbsp;<span class="ident" id="3314358">unescape</span><span class="op" id="3314366">(</span><span class="ident" id="3314367">username</span><span class="op" id="3314375">,</span>&nbsp;<span class="ident" id="3314377">encodeUserPassword</span><span class="op" id="3314395">)</span><span class="op" id="3314396">;</span>&nbsp;<span class="ident" id="3314398">err</span>&nbsp;<span class="op" id="3314402">!=</span>&nbsp;<span class="ident" id="3314405">nil</span>&nbsp;<span class="op" id="3314409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314414">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3314423">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314427">if</span>&nbsp;<span class="ident" id="3314430">password</span><span class="op" id="3314438">,</span>&nbsp;<span class="ident" id="3314440">err</span>&nbsp;<span class="op" id="3314444">=</span>&nbsp;<span class="ident" id="3314446">unescape</span><span class="op" id="3314454">(</span><span class="ident" id="3314455">password</span><span class="op" id="3314463">,</span>&nbsp;<span class="ident" id="3314465">encodeUserPassword</span><span class="op" id="3314483">)</span><span class="op" id="3314484">;</span>&nbsp;<span class="ident" id="3314486">err</span>&nbsp;<span class="op" id="3314490">!=</span>&nbsp;<span class="ident" id="3314493">nil</span>&nbsp;<span class="op" id="3314497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314502">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3314511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3314515">user</span>&nbsp;<span class="op" id="3314520">=</span>&nbsp;<span class="ident" id="3314522">UserPassword</span><span class="op" id="3314534">(</span><span class="ident" id="3314535">username</span><span class="op" id="3314543">,</span>&nbsp;<span class="ident" id="3314545">password</span><span class="op" id="3314553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3314556">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314559">return</span><br>
<span class="lineno"></span><span class="op" id="3314566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3314569">//&nbsp;String&nbsp;reassembles&nbsp;the&nbsp;URL&nbsp;into&nbsp;a&nbsp;valid&nbsp;URL&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3314624">//&nbsp;The&nbsp;general&nbsp;form&nbsp;of&nbsp;the&nbsp;result&nbsp;is&nbsp;one&nbsp;of:</span><br>
<span class="lineno">445</span><span class="comment" id="3314669">//</span><br>
<span class="lineno"></span><span class="comment" id="3314672">//&nbsp;&nbsp;&nbsp;&nbspscheme:opaque</span><br>
<span class="lineno"></span><span class="comment" id="3314689">//&nbsp;&nbsp;&nbsp;&nbspscheme://userinfo@host/path?query#fragment</span><br>
<span class="lineno"></span><span class="comment" id="3314735">//</span><br>
<span class="lineno"></span><span class="comment" id="3314738">//&nbsp;If&nbsp;u.Opaque&nbsp;is&nbsp;non-empty,&nbsp;String&nbsp;uses&nbsp;the&nbsp;first&nbsp;form;</span><br>
<span class="lineno">450</span><span class="comment" id="3314795">//&nbsp;otherwise&nbsp;it&nbsp;uses&nbsp;the&nbsp;second&nbsp;form.</span><br>
<span class="lineno"></span><span class="comment" id="3314833">//</span><br>
<span class="lineno"></span><span class="comment" id="3314836">//&nbsp;In&nbsp;the&nbsp;second&nbsp;form,&nbsp;the&nbsp;following&nbsp;rules&nbsp;apply:</span><br>
<span class="lineno"></span><span class="comment" id="3314886">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Scheme&nbsp;is&nbsp;empty,&nbsp;scheme:&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3314933">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.User&nbsp;is&nbsp;nil,&nbsp;userinfo@&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno">455</span><span class="comment" id="3314978">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;empty,&nbsp;host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3315021">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Scheme&nbsp;and&nbsp;u.Host&nbsp;are&nbsp;empty&nbsp;and&nbsp;u.User&nbsp;is&nbsp;nil,</span><br>
<span class="lineno"></span><span class="comment" id="3315078">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;the&nbsp;entire&nbsp;scheme://userinfo@host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3315131">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;non-empty&nbsp;and&nbsp;u.Path&nbsp;begins&nbsp;with&nbsp;a&nbsp;/,</span><br>
<span class="lineno"></span><span class="comment" id="3315187">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;the&nbsp;form&nbsp;host/path&nbsp;does&nbsp;not&nbsp;add&nbsp;its&nbsp;own&nbsp;/.</span><br>
<span class="lineno">460</span><span class="comment" id="3315236">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.RawQuery&nbsp;is&nbsp;empty,&nbsp;?query&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3315284">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Fragment&nbsp;is&nbsp;empty,&nbsp;#fragment&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="keyword" id="3315335">func</span>&nbsp;<span class="op" id="3315340">(</span><span class="ident" id="3315341">u</span>&nbsp;<span class="op" id="3315343">*</span><span class="ident" id="3315344">URL</span><span class="op" id="3315347">)</span>&nbsp;<span class="ident" id="3315349">String</span><span class="op" id="3315355">(</span><span class="op" id="3315356">)</span>&nbsp;<span class="builtintype" id="3315358">string</span>&nbsp;<span class="op" id="3315365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315368">var</span>&nbsp;<span class="ident" id="3315372">buf</span>&nbsp;<span class="ident" id="3315376">bytes</span><span class="op" id="3315381">.</span><span class="ident" id="3315382">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315390">if</span>&nbsp;<span class="ident" id="3315393">u</span><span class="op" id="3315394">.</span><span class="ident" id="3315395">Scheme</span>&nbsp;<span class="op" id="3315402">!=</span>&nbsp;<span class="string" id="3315405">&#34;&#34;</span>&nbsp;<span class="op" id="3315408">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315412">buf</span><span class="op" id="3315415">.</span><span class="ident" id="3315416">WriteString</span><span class="op" id="3315427">(</span><span class="ident" id="3315428">u</span><span class="op" id="3315429">.</span><span class="ident" id="3315430">Scheme</span><span class="op" id="3315436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315440">buf</span><span class="op" id="3315443">.</span><span class="ident" id="3315444">WriteByte</span><span class="op" id="3315453">(</span><span class="string" id="3315454">&#39;:&#39;</span><span class="op" id="3315457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3315460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315463">if</span>&nbsp;<span class="ident" id="3315466">u</span><span class="op" id="3315467">.</span><span class="ident" id="3315468">Opaque</span>&nbsp;<span class="op" id="3315475">!=</span>&nbsp;<span class="string" id="3315478">&#34;&#34;</span>&nbsp;<span class="op" id="3315481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315485">buf</span><span class="op" id="3315488">.</span><span class="ident" id="3315489">WriteString</span><span class="op" id="3315500">(</span><span class="ident" id="3315501">u</span><span class="op" id="3315502">.</span><span class="ident" id="3315503">Opaque</span><span class="op" id="3315509">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3315512">}</span>&nbsp;<span class="keyword" id="3315514">else</span>&nbsp;<span class="op" id="3315519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315523">if</span>&nbsp;<span class="ident" id="3315526">u</span><span class="op" id="3315527">.</span><span class="ident" id="3315528">Scheme</span>&nbsp;<span class="op" id="3315535">!=</span>&nbsp;<span class="string" id="3315538">&#34;&#34;</span>&nbsp;<span class="op" id="3315541">||</span>&nbsp;<span class="ident" id="3315544">u</span><span class="op" id="3315545">.</span><span class="ident" id="3315546">Host</span>&nbsp;<span class="op" id="3315551">!=</span>&nbsp;<span class="string" id="3315554">&#34;&#34;</span>&nbsp;<span class="op" id="3315557">||</span>&nbsp;<span class="ident" id="3315560">u</span><span class="op" id="3315561">.</span><span class="ident" id="3315562">User</span>&nbsp;<span class="op" id="3315567">!=</span>&nbsp;<span class="ident" id="3315570">nil</span>&nbsp;<span class="op" id="3315574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315579">buf</span><span class="op" id="3315582">.</span><span class="ident" id="3315583">WriteString</span><span class="op" id="3315594">(</span><span class="string" id="3315595">&#34;//&#34;</span><span class="op" id="3315599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315604">if</span>&nbsp;<span class="ident" id="3315607">ui</span>&nbsp;<span class="op" id="3315610">:=</span>&nbsp;<span class="ident" id="3315613">u</span><span class="op" id="3315614">.</span><span class="ident" id="3315615">User</span><span class="op" id="3315619">;</span>&nbsp;<span class="ident" id="3315621">ui</span>&nbsp;<span class="op" id="3315624">!=</span>&nbsp;<span class="ident" id="3315627">nil</span>&nbsp;<span class="op" id="3315631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315637">buf</span><span class="op" id="3315640">.</span><span class="ident" id="3315641">WriteString</span><span class="op" id="3315652">(</span><span class="ident" id="3315653">ui</span><span class="op" id="3315655">.</span><span class="ident" id="3315656">String</span><span class="op" id="3315662">(</span><span class="op" id="3315663">)</span><span class="op" id="3315664">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315670">buf</span><span class="op" id="3315673">.</span><span class="ident" id="3315674">WriteByte</span><span class="op" id="3315683">(</span><span class="string" id="3315684">&#39;@&#39;</span><span class="op" id="3315687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3315692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315697">if</span>&nbsp;<span class="ident" id="3315700">h</span>&nbsp;<span class="op" id="3315702">:=</span>&nbsp;<span class="ident" id="3315705">u</span><span class="op" id="3315706">.</span><span class="ident" id="3315707">Host</span><span class="op" id="3315711">;</span>&nbsp;<span class="ident" id="3315713">h</span>&nbsp;<span class="op" id="3315715">!=</span>&nbsp;<span class="string" id="3315718">&#34;&#34;</span>&nbsp;<span class="op" id="3315721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315727">buf</span><span class="op" id="3315730">.</span><span class="ident" id="3315731">WriteString</span><span class="op" id="3315742">(</span><span class="ident" id="3315743">h</span><span class="op" id="3315744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3315749">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3315753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315757">if</span>&nbsp;<span class="ident" id="3315760">u</span><span class="op" id="3315761">.</span><span class="ident" id="3315762">Path</span>&nbsp;<span class="op" id="3315767">!=</span>&nbsp;<span class="string" id="3315770">&#34;&#34;</span>&nbsp;<span class="op" id="3315773">&amp;&amp;</span>&nbsp;<span class="ident" id="3315776">u</span><span class="op" id="3315777">.</span><span class="ident" id="3315778">Path</span><span class="op" id="3315782">[</span><span class="num" id="3315783">0</span><span class="op" id="3315784">]</span>&nbsp;<span class="op" id="3315786">!=</span>&nbsp;<span class="string" id="3315789">&#39;/&#39;</span>&nbsp;<span class="op" id="3315793">&amp;&amp;</span>&nbsp;<span class="ident" id="3315796">u</span><span class="op" id="3315797">.</span><span class="ident" id="3315798">Host</span>&nbsp;<span class="op" id="3315803">!=</span>&nbsp;<span class="string" id="3315806">&#34;&#34;</span>&nbsp;<span class="op" id="3315809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315814">buf</span><span class="op" id="3315817">.</span><span class="ident" id="3315818">WriteByte</span><span class="op" id="3315827">(</span><span class="string" id="3315828">&#39;/&#39;</span><span class="op" id="3315831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3315835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315839">buf</span><span class="op" id="3315842">.</span><span class="ident" id="3315843">WriteString</span><span class="op" id="3315854">(</span><span class="ident" id="3315855">escape</span><span class="op" id="3315861">(</span><span class="ident" id="3315862">u</span><span class="op" id="3315863">.</span><span class="ident" id="3315864">Path</span><span class="op" id="3315868">,</span>&nbsp;<span class="ident" id="3315870">encodePath</span><span class="op" id="3315880">)</span><span class="op" id="3315881">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3315884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315887">if</span>&nbsp;<span class="ident" id="3315890">u</span><span class="op" id="3315891">.</span><span class="ident" id="3315892">RawQuery</span>&nbsp;<span class="op" id="3315901">!=</span>&nbsp;<span class="string" id="3315904">&#34;&#34;</span>&nbsp;<span class="op" id="3315907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315911">buf</span><span class="op" id="3315914">.</span><span class="ident" id="3315915">WriteByte</span><span class="op" id="3315924">(</span><span class="string" id="3315925">&#39;?&#39;</span><span class="op" id="3315928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315932">buf</span><span class="op" id="3315935">.</span><span class="ident" id="3315936">WriteString</span><span class="op" id="3315947">(</span><span class="ident" id="3315948">u</span><span class="op" id="3315949">.</span><span class="ident" id="3315950">RawQuery</span><span class="op" id="3315958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3315961">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315964">if</span>&nbsp;<span class="ident" id="3315967">u</span><span class="op" id="3315968">.</span><span class="ident" id="3315969">Fragment</span>&nbsp;<span class="op" id="3315978">!=</span>&nbsp;<span class="string" id="3315981">&#34;&#34;</span>&nbsp;<span class="op" id="3315984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315988">buf</span><span class="op" id="3315991">.</span><span class="ident" id="3315992">WriteByte</span><span class="op" id="3316001">(</span><span class="string" id="3316002">&#39;#&#39;</span><span class="op" id="3316005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316009">buf</span><span class="op" id="3316012">.</span><span class="ident" id="3316013">WriteString</span><span class="op" id="3316024">(</span><span class="ident" id="3316025">escape</span><span class="op" id="3316031">(</span><span class="ident" id="3316032">u</span><span class="op" id="3316033">.</span><span class="ident" id="3316034">Fragment</span><span class="op" id="3316042">,</span>&nbsp;<span class="ident" id="3316044">encodeFragment</span><span class="op" id="3316058">)</span><span class="op" id="3316059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3316062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316065">return</span>&nbsp;<span class="ident" id="3316072">buf</span><span class="op" id="3316075">.</span><span class="ident" id="3316076">String</span><span class="op" id="3316082">(</span><span class="op" id="3316083">)</span><br>
<span class="lineno">495</span><span class="op" id="3316085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3316088">//&nbsp;Values&nbsp;maps&nbsp;a&nbsp;string&nbsp;key&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3316137">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;for&nbsp;query&nbsp;parameters&nbsp;and&nbsp;form&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3316199">//&nbsp;Unlike&nbsp;in&nbsp;the&nbsp;http.Header&nbsp;map,&nbsp;the&nbsp;keys&nbsp;in&nbsp;a&nbsp;Values&nbsp;map</span><br>
<span class="lineno">500</span><span class="comment" id="3316258">//&nbsp;are&nbsp;case-sensitive.</span><br>
<span class="lineno"></span><span class="keyword" id="3316281">type</span>&nbsp;<span class="ident" id="3316286">Values</span>&nbsp;<span class="keyword" id="3316293">map</span><span class="op" id="3316296">[</span><span class="builtintype" id="3316297">string</span><span class="op" id="3316303">]</span><span class="op" id="3316304">[</span><span class="op" id="3316305">]</span><span class="builtintype" id="3316306">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3316314">//&nbsp;Get&nbsp;gets&nbsp;the&nbsp;first&nbsp;value&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3316373">//&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;values&nbsp;associated&nbsp;with&nbsp;the&nbsp;key,&nbsp;Get&nbsp;returns</span><br>
<span class="lineno">505</span><span class="comment" id="3316436">//&nbsp;the&nbsp;empty&nbsp;string.&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values,&nbsp;use&nbsp;the&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="3316496">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3316509">func</span>&nbsp;<span class="op" id="3316514">(</span><span class="ident" id="3316515">v</span>&nbsp;<span class="ident" id="3316517">Values</span><span class="op" id="3316523">)</span>&nbsp;<span class="ident" id="3316525">Get</span><span class="op" id="3316528">(</span><span class="ident" id="3316529">key</span>&nbsp;<span class="builtintype" id="3316533">string</span><span class="op" id="3316539">)</span>&nbsp;<span class="builtintype" id="3316541">string</span>&nbsp;<span class="op" id="3316548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316551">if</span>&nbsp;<span class="ident" id="3316554">v</span>&nbsp;<span class="op" id="3316556">==</span>&nbsp;<span class="ident" id="3316559">nil</span>&nbsp;<span class="op" id="3316563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316567">return</span>&nbsp;<span class="string" id="3316574">&#34;&#34;</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3316578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316581">vs</span><span class="op" id="3316583">,</span>&nbsp;<span class="ident" id="3316585">ok</span>&nbsp;<span class="op" id="3316588">:=</span>&nbsp;<span class="ident" id="3316591">v</span><span class="op" id="3316592">[</span><span class="ident" id="3316593">key</span><span class="op" id="3316596">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316599">if</span>&nbsp;<span class="op" id="3316602">!</span><span class="ident" id="3316603">ok</span>&nbsp;<span class="op" id="3316606">||</span>&nbsp;<span class="builtinfunc" id="3316609">len</span><span class="op" id="3316612">(</span><span class="ident" id="3316613">vs</span><span class="op" id="3316615">)</span>&nbsp;<span class="op" id="3316617">==</span>&nbsp;<span class="num" id="3316620">0</span>&nbsp;<span class="op" id="3316622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316626">return</span>&nbsp;<span class="string" id="3316633">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3316637">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316640">return</span>&nbsp;<span class="ident" id="3316647">vs</span><span class="op" id="3316649">[</span><span class="num" id="3316650">0</span><span class="op" id="3316651">]</span><br>
<span class="lineno"></span><span class="op" id="3316653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3316656">//&nbsp;Set&nbsp;sets&nbsp;the&nbsp;key&nbsp;to&nbsp;value.&nbsp;It&nbsp;replaces&nbsp;any&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="3316711">//&nbsp;values.</span><br>
<span class="lineno">520</span><span class="keyword" id="3316722">func</span>&nbsp;<span class="op" id="3316727">(</span><span class="ident" id="3316728">v</span>&nbsp;<span class="ident" id="3316730">Values</span><span class="op" id="3316736">)</span>&nbsp;<span class="ident" id="3316738">Set</span><span class="op" id="3316741">(</span><span class="ident" id="3316742">key</span><span class="op" id="3316745">,</span>&nbsp;<span class="ident" id="3316747">value</span>&nbsp;<span class="builtintype" id="3316753">string</span><span class="op" id="3316759">)</span>&nbsp;<span class="op" id="3316761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316764">v</span><span class="op" id="3316765">[</span><span class="ident" id="3316766">key</span><span class="op" id="3316769">]</span>&nbsp;<span class="op" id="3316771">=</span>&nbsp;<span class="op" id="3316773">[</span><span class="op" id="3316774">]</span><span class="builtintype" id="3316775">string</span><span class="op" id="3316781">{</span><span class="ident" id="3316782">value</span><span class="op" id="3316787">}</span><br>
<span class="lineno"></span><span class="op" id="3316789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3316792">//&nbsp;Add&nbsp;adds&nbsp;the&nbsp;value&nbsp;to&nbsp;key.&nbsp;It&nbsp;appends&nbsp;to&nbsp;any&nbsp;existing</span><br>
<span class="lineno">525</span><span class="comment" id="3316849">//&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3316880">func</span>&nbsp;<span class="op" id="3316885">(</span><span class="ident" id="3316886">v</span>&nbsp;<span class="ident" id="3316888">Values</span><span class="op" id="3316894">)</span>&nbsp;<span class="ident" id="3316896">Add</span><span class="op" id="3316899">(</span><span class="ident" id="3316900">key</span><span class="op" id="3316903">,</span>&nbsp;<span class="ident" id="3316905">value</span>&nbsp;<span class="builtintype" id="3316911">string</span><span class="op" id="3316917">)</span>&nbsp;<span class="op" id="3316919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316922">v</span><span class="op" id="3316923">[</span><span class="ident" id="3316924">key</span><span class="op" id="3316927">]</span>&nbsp;<span class="op" id="3316929">=</span>&nbsp;<span class="builtinfunc" id="3316931">append</span><span class="op" id="3316937">(</span><span class="ident" id="3316938">v</span><span class="op" id="3316939">[</span><span class="ident" id="3316940">key</span><span class="op" id="3316943">]</span><span class="op" id="3316944">,</span>&nbsp;<span class="ident" id="3316946">value</span><span class="op" id="3316951">)</span><br>
<span class="lineno"></span><span class="op" id="3316953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="3316956">//&nbsp;Del&nbsp;deletes&nbsp;the&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3317003">func</span>&nbsp;<span class="op" id="3317008">(</span><span class="ident" id="3317009">v</span>&nbsp;<span class="ident" id="3317011">Values</span><span class="op" id="3317017">)</span>&nbsp;<span class="ident" id="3317019">Del</span><span class="op" id="3317022">(</span><span class="ident" id="3317023">key</span>&nbsp;<span class="builtintype" id="3317027">string</span><span class="op" id="3317033">)</span>&nbsp;<span class="op" id="3317035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3317038">delete</span><span class="op" id="3317044">(</span><span class="ident" id="3317045">v</span><span class="op" id="3317046">,</span>&nbsp;<span class="ident" id="3317048">key</span><span class="op" id="3317051">)</span><br>
<span class="lineno"></span><span class="op" id="3317053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3317056">//&nbsp;ParseQuery&nbsp;parses&nbsp;the&nbsp;URL-encoded&nbsp;query&nbsp;string&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3317118">//&nbsp;a&nbsp;map&nbsp;listing&nbsp;the&nbsp;values&nbsp;specified&nbsp;for&nbsp;each&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3317170">//&nbsp;ParseQuery&nbsp;always&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;map&nbsp;containing&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3317232">//&nbsp;valid&nbsp;query&nbsp;parameters&nbsp;found;&nbsp;err&nbsp;describes&nbsp;the&nbsp;first&nbsp;decoding&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="3317304">//&nbsp;encountered,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">540</span><span class="keyword" id="3317328">func</span>&nbsp;<span class="ident" id="3317333">ParseQuery</span><span class="op" id="3317343">(</span><span class="ident" id="3317344">query</span>&nbsp;<span class="builtintype" id="3317350">string</span><span class="op" id="3317356">)</span>&nbsp;<span class="op" id="3317358">(</span><span class="ident" id="3317359">m</span>&nbsp;<span class="ident" id="3317361">Values</span><span class="op" id="3317367">,</span>&nbsp;<span class="ident" id="3317369">err</span>&nbsp;<span class="builtintype" id="3317373">error</span><span class="op" id="3317378">)</span>&nbsp;<span class="op" id="3317380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317383">m</span>&nbsp;<span class="op" id="3317385">=</span>&nbsp;<span class="builtinfunc" id="3317387">make</span><span class="op" id="3317391">(</span><span class="ident" id="3317392">Values</span><span class="op" id="3317398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317401">err</span>&nbsp;<span class="op" id="3317405">=</span>&nbsp;<span class="ident" id="3317407">parseQuery</span><span class="op" id="3317417">(</span><span class="ident" id="3317418">m</span><span class="op" id="3317419">,</span>&nbsp;<span class="ident" id="3317421">query</span><span class="op" id="3317426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317429">return</span><br>
<span class="lineno"></span><span class="op" id="3317436">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="keyword" id="3317439">func</span>&nbsp;<span class="ident" id="3317444">parseQuery</span><span class="op" id="3317454">(</span><span class="ident" id="3317455">m</span>&nbsp;<span class="ident" id="3317457">Values</span><span class="op" id="3317463">,</span>&nbsp;<span class="ident" id="3317465">query</span>&nbsp;<span class="builtintype" id="3317471">string</span><span class="op" id="3317477">)</span>&nbsp;<span class="op" id="3317479">(</span><span class="ident" id="3317480">err</span>&nbsp;<span class="builtintype" id="3317484">error</span><span class="op" id="3317489">)</span>&nbsp;<span class="op" id="3317491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317494">for</span>&nbsp;<span class="ident" id="3317498">query</span>&nbsp;<span class="op" id="3317504">!=</span>&nbsp;<span class="string" id="3317507">&#34;&#34;</span>&nbsp;<span class="op" id="3317510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317514">key</span>&nbsp;<span class="op" id="3317518">:=</span>&nbsp;<span class="ident" id="3317521">query</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317529">if</span>&nbsp;<span class="ident" id="3317532">i</span>&nbsp;<span class="op" id="3317534">:=</span>&nbsp;<span class="ident" id="3317537">strings</span><span class="op" id="3317544">.</span><span class="ident" id="3317545">IndexAny</span><span class="op" id="3317553">(</span><span class="ident" id="3317554">key</span><span class="op" id="3317557">,</span>&nbsp;<span class="string" id="3317559">&#34;&amp;;&#34;</span><span class="op" id="3317563">)</span><span class="op" id="3317564">;</span>&nbsp;<span class="ident" id="3317566">i</span>&nbsp;<span class="op" id="3317568">&gt;=</span>&nbsp;<span class="num" id="3317571">0</span>&nbsp;<span class="op" id="3317573">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317578">key</span><span class="op" id="3317581">,</span>&nbsp;<span class="ident" id="3317583">query</span>&nbsp;<span class="op" id="3317589">=</span>&nbsp;<span class="ident" id="3317591">key</span><span class="op" id="3317594">[</span><span class="op" id="3317595">:</span><span class="ident" id="3317596">i</span><span class="op" id="3317597">]</span><span class="op" id="3317598">,</span>&nbsp;<span class="ident" id="3317600">key</span><span class="op" id="3317603">[</span><span class="ident" id="3317604">i</span><span class="op" id="3317605">+</span><span class="num" id="3317606">1</span><span class="op" id="3317607">:</span><span class="op" id="3317608">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317612">}</span>&nbsp;<span class="keyword" id="3317614">else</span>&nbsp;<span class="op" id="3317619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317624">query</span>&nbsp;<span class="op" id="3317630">=</span>&nbsp;<span class="string" id="3317632">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317641">if</span>&nbsp;<span class="ident" id="3317644">key</span>&nbsp;<span class="op" id="3317648">==</span>&nbsp;<span class="string" id="3317651">&#34;&#34;</span>&nbsp;<span class="op" id="3317654">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317659">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317674">value</span>&nbsp;<span class="op" id="3317680">:=</span>&nbsp;<span class="string" id="3317683">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317688">if</span>&nbsp;<span class="ident" id="3317691">i</span>&nbsp;<span class="op" id="3317693">:=</span>&nbsp;<span class="ident" id="3317696">strings</span><span class="op" id="3317703">.</span><span class="ident" id="3317704">Index</span><span class="op" id="3317709">(</span><span class="ident" id="3317710">key</span><span class="op" id="3317713">,</span>&nbsp;<span class="string" id="3317715">&#34;=&#34;</span><span class="op" id="3317718">)</span><span class="op" id="3317719">;</span>&nbsp;<span class="ident" id="3317721">i</span>&nbsp;<span class="op" id="3317723">&gt;=</span>&nbsp;<span class="num" id="3317726">0</span>&nbsp;<span class="op" id="3317728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317733">key</span><span class="op" id="3317736">,</span>&nbsp;<span class="ident" id="3317738">value</span>&nbsp;<span class="op" id="3317744">=</span>&nbsp;<span class="ident" id="3317746">key</span><span class="op" id="3317749">[</span><span class="op" id="3317750">:</span><span class="ident" id="3317751">i</span><span class="op" id="3317752">]</span><span class="op" id="3317753">,</span>&nbsp;<span class="ident" id="3317755">key</span><span class="op" id="3317758">[</span><span class="ident" id="3317759">i</span><span class="op" id="3317760">+</span><span class="num" id="3317761">1</span><span class="op" id="3317762">:</span><span class="op" id="3317763">]</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317771">key</span><span class="op" id="3317774">,</span>&nbsp;<span class="ident" id="3317776">err1</span>&nbsp;<span class="op" id="3317781">:=</span>&nbsp;<span class="ident" id="3317784">QueryUnescape</span><span class="op" id="3317797">(</span><span class="ident" id="3317798">key</span><span class="op" id="3317801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317805">if</span>&nbsp;<span class="ident" id="3317808">err1</span>&nbsp;<span class="op" id="3317813">!=</span>&nbsp;<span class="ident" id="3317816">nil</span>&nbsp;<span class="op" id="3317820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317825">if</span>&nbsp;<span class="ident" id="3317828">err</span>&nbsp;<span class="op" id="3317832">==</span>&nbsp;<span class="ident" id="3317835">nil</span>&nbsp;<span class="op" id="3317839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317845">err</span>&nbsp;<span class="op" id="3317849">=</span>&nbsp;<span class="ident" id="3317851">err1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317864">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317879">value</span><span class="op" id="3317884">,</span>&nbsp;<span class="ident" id="3317886">err1</span>&nbsp;<span class="op" id="3317891">=</span>&nbsp;<span class="ident" id="3317893">QueryUnescape</span><span class="op" id="3317906">(</span><span class="ident" id="3317907">value</span><span class="op" id="3317912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317916">if</span>&nbsp;<span class="ident" id="3317919">err1</span>&nbsp;<span class="op" id="3317924">!=</span>&nbsp;<span class="ident" id="3317927">nil</span>&nbsp;<span class="op" id="3317931">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317936">if</span>&nbsp;<span class="ident" id="3317939">err</span>&nbsp;<span class="op" id="3317943">==</span>&nbsp;<span class="ident" id="3317946">nil</span>&nbsp;<span class="op" id="3317950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317956">err</span>&nbsp;<span class="op" id="3317960">=</span>&nbsp;<span class="ident" id="3317962">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317975">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317986">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317990">m</span><span class="op" id="3317991">[</span><span class="ident" id="3317992">key</span><span class="op" id="3317995">]</span>&nbsp;<span class="op" id="3317997">=</span>&nbsp;<span class="builtinfunc" id="3317999">append</span><span class="op" id="3318005">(</span><span class="ident" id="3318006">m</span><span class="op" id="3318007">[</span><span class="ident" id="3318008">key</span><span class="op" id="3318011">]</span><span class="op" id="3318012">,</span>&nbsp;<span class="ident" id="3318014">value</span><span class="op" id="3318019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318025">return</span>&nbsp;<span class="ident" id="3318032">err</span><br>
<span class="lineno"></span><span class="op" id="3318036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span><span class="comment" id="3318039">//&nbsp;Encode&nbsp;encodes&nbsp;the&nbsp;values&nbsp;into&nbsp;``URL&nbsp;encoded&#39;&#39;&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3318094">//&nbsp;(&#34;bar=baz&amp;foo=quux&#34;)&nbsp;sorted&nbsp;by&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3318133">func</span>&nbsp;<span class="op" id="3318138">(</span><span class="ident" id="3318139">v</span>&nbsp;<span class="ident" id="3318141">Values</span><span class="op" id="3318147">)</span>&nbsp;<span class="ident" id="3318149">Encode</span><span class="op" id="3318155">(</span><span class="op" id="3318156">)</span>&nbsp;<span class="builtintype" id="3318158">string</span>&nbsp;<span class="op" id="3318165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318168">if</span>&nbsp;<span class="ident" id="3318171">v</span>&nbsp;<span class="op" id="3318173">==</span>&nbsp;<span class="ident" id="3318176">nil</span>&nbsp;<span class="op" id="3318180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318184">return</span>&nbsp;<span class="string" id="3318191">&#34;&#34;</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318198">var</span>&nbsp;<span class="ident" id="3318202">buf</span>&nbsp;<span class="ident" id="3318206">bytes</span><span class="op" id="3318211">.</span><span class="ident" id="3318212">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318220">keys</span>&nbsp;<span class="op" id="3318225">:=</span>&nbsp;<span class="builtinfunc" id="3318228">make</span><span class="op" id="3318232">(</span><span class="op" id="3318233">[</span><span class="op" id="3318234">]</span><span class="builtintype" id="3318235">string</span><span class="op" id="3318241">,</span>&nbsp;<span class="num" id="3318243">0</span><span class="op" id="3318244">,</span>&nbsp;<span class="builtinfunc" id="3318246">len</span><span class="op" id="3318249">(</span><span class="ident" id="3318250">v</span><span class="op" id="3318251">)</span><span class="op" id="3318252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318255">for</span>&nbsp;<span class="ident" id="3318259">k</span>&nbsp;<span class="op" id="3318261">:=</span>&nbsp;<span class="keyword" id="3318264">range</span>&nbsp;<span class="ident" id="3318270">v</span>&nbsp;<span class="op" id="3318272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318276">keys</span>&nbsp;<span class="op" id="3318281">=</span>&nbsp;<span class="builtinfunc" id="3318283">append</span><span class="op" id="3318289">(</span><span class="ident" id="3318290">keys</span><span class="op" id="3318294">,</span>&nbsp;<span class="ident" id="3318296">k</span><span class="op" id="3318297">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318303">sort</span><span class="op" id="3318307">.</span><span class="ident" id="3318308">Strings</span><span class="op" id="3318315">(</span><span class="ident" id="3318316">keys</span><span class="op" id="3318320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318323">for</span>&nbsp;<span class="ident" id="3318327">_</span><span class="op" id="3318328">,</span>&nbsp;<span class="ident" id="3318330">k</span>&nbsp;<span class="op" id="3318332">:=</span>&nbsp;<span class="keyword" id="3318335">range</span>&nbsp;<span class="ident" id="3318341">keys</span>&nbsp;<span class="op" id="3318346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318350">vs</span>&nbsp;<span class="op" id="3318353">:=</span>&nbsp;<span class="ident" id="3318356">v</span><span class="op" id="3318357">[</span><span class="ident" id="3318358">k</span><span class="op" id="3318359">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318363">prefix</span>&nbsp;<span class="op" id="3318370">:=</span>&nbsp;<span class="ident" id="3318373">QueryEscape</span><span class="op" id="3318384">(</span><span class="ident" id="3318385">k</span><span class="op" id="3318386">)</span>&nbsp;<span class="op" id="3318388">+</span>&nbsp;<span class="string" id="3318390">&#34;=&#34;</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318396">for</span>&nbsp;<span class="ident" id="3318400">_</span><span class="op" id="3318401">,</span>&nbsp;<span class="ident" id="3318403">v</span>&nbsp;<span class="op" id="3318405">:=</span>&nbsp;<span class="keyword" id="3318408">range</span>&nbsp;<span class="ident" id="3318414">vs</span>&nbsp;<span class="op" id="3318417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318422">if</span>&nbsp;<span class="ident" id="3318425">buf</span><span class="op" id="3318428">.</span><span class="ident" id="3318429">Len</span><span class="op" id="3318432">(</span><span class="op" id="3318433">)</span>&nbsp;<span class="op" id="3318435">&gt;</span>&nbsp;<span class="num" id="3318437">0</span>&nbsp;<span class="op" id="3318439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318445">buf</span><span class="op" id="3318448">.</span><span class="ident" id="3318449">WriteByte</span><span class="op" id="3318458">(</span><span class="string" id="3318459">&#39;&amp;&#39;</span><span class="op" id="3318462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318472">buf</span><span class="op" id="3318475">.</span><span class="ident" id="3318476">WriteString</span><span class="op" id="3318487">(</span><span class="ident" id="3318488">prefix</span><span class="op" id="3318494">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318499">buf</span><span class="op" id="3318502">.</span><span class="ident" id="3318503">WriteString</span><span class="op" id="3318514">(</span><span class="ident" id="3318515">QueryEscape</span><span class="op" id="3318526">(</span><span class="ident" id="3318527">v</span><span class="op" id="3318528">)</span><span class="op" id="3318529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318539">return</span>&nbsp;<span class="ident" id="3318546">buf</span><span class="op" id="3318549">.</span><span class="ident" id="3318550">String</span><span class="op" id="3318556">(</span><span class="op" id="3318557">)</span><br>
<span class="lineno"></span><span class="op" id="3318559">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="comment" id="3318562">//&nbsp;resolvePath&nbsp;applies&nbsp;special&nbsp;path&nbsp;segments&nbsp;from&nbsp;refs&nbsp;and&nbsp;applies</span><br>
<span class="lineno"></span><span class="comment" id="3318629">//&nbsp;them&nbsp;to&nbsp;base,&nbsp;per&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3318660">func</span>&nbsp;<span class="ident" id="3318665">resolvePath</span><span class="op" id="3318676">(</span><span class="ident" id="3318677">base</span><span class="op" id="3318681">,</span>&nbsp;<span class="ident" id="3318683">ref</span>&nbsp;<span class="builtintype" id="3318687">string</span><span class="op" id="3318693">)</span>&nbsp;<span class="builtintype" id="3318695">string</span>&nbsp;<span class="op" id="3318702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318705">var</span>&nbsp;<span class="ident" id="3318709">full</span>&nbsp;<span class="builtintype" id="3318714">string</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318722">if</span>&nbsp;<span class="ident" id="3318725">ref</span>&nbsp;<span class="op" id="3318729">==</span>&nbsp;<span class="string" id="3318732">&#34;&#34;</span>&nbsp;<span class="op" id="3318735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318739">full</span>&nbsp;<span class="op" id="3318744">=</span>&nbsp;<span class="ident" id="3318746">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318752">}</span>&nbsp;<span class="keyword" id="3318754">else</span>&nbsp;<span class="keyword" id="3318759">if</span>&nbsp;<span class="ident" id="3318762">ref</span><span class="op" id="3318765">[</span><span class="num" id="3318766">0</span><span class="op" id="3318767">]</span>&nbsp;<span class="op" id="3318769">!=</span>&nbsp;<span class="string" id="3318772">&#39;/&#39;</span>&nbsp;<span class="op" id="3318776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318780">i</span>&nbsp;<span class="op" id="3318782">:=</span>&nbsp;<span class="ident" id="3318785">strings</span><span class="op" id="3318792">.</span><span class="ident" id="3318793">LastIndex</span><span class="op" id="3318802">(</span><span class="ident" id="3318803">base</span><span class="op" id="3318807">,</span>&nbsp;<span class="string" id="3318809">&#34;/&#34;</span><span class="op" id="3318812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318816">full</span>&nbsp;<span class="op" id="3318821">=</span>&nbsp;<span class="ident" id="3318823">base</span><span class="op" id="3318827">[</span><span class="op" id="3318828">:</span><span class="ident" id="3318829">i</span><span class="op" id="3318830">+</span><span class="num" id="3318831">1</span><span class="op" id="3318832">]</span>&nbsp;<span class="op" id="3318834">+</span>&nbsp;<span class="ident" id="3318836">ref</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318841">}</span>&nbsp;<span class="keyword" id="3318843">else</span>&nbsp;<span class="op" id="3318848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318852">full</span>&nbsp;<span class="op" id="3318857">=</span>&nbsp;<span class="ident" id="3318859">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318867">if</span>&nbsp;<span class="ident" id="3318870">full</span>&nbsp;<span class="op" id="3318875">==</span>&nbsp;<span class="string" id="3318878">&#34;&#34;</span>&nbsp;<span class="op" id="3318881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318885">return</span>&nbsp;<span class="string" id="3318892">&#34;&#34;</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318899">var</span>&nbsp;<span class="ident" id="3318903">dst</span>&nbsp;<span class="op" id="3318907">[</span><span class="op" id="3318908">]</span><span class="builtintype" id="3318909">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318917">src</span>&nbsp;<span class="op" id="3318921">:=</span>&nbsp;<span class="ident" id="3318924">strings</span><span class="op" id="3318931">.</span><span class="ident" id="3318932">Split</span><span class="op" id="3318937">(</span><span class="ident" id="3318938">full</span><span class="op" id="3318942">,</span>&nbsp;<span class="string" id="3318944">&#34;/&#34;</span><span class="op" id="3318947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318950">for</span>&nbsp;<span class="ident" id="3318954">_</span><span class="op" id="3318955">,</span>&nbsp;<span class="ident" id="3318957">elem</span>&nbsp;<span class="op" id="3318962">:=</span>&nbsp;<span class="keyword" id="3318965">range</span>&nbsp;<span class="ident" id="3318971">src</span>&nbsp;<span class="op" id="3318975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318979">switch</span>&nbsp;<span class="ident" id="3318986">elem</span>&nbsp;<span class="op" id="3318991">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318995">case</span>&nbsp;<span class="string" id="3319000">&#34;.&#34;</span><span class="op" id="3319003">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3319008">//&nbsp;drop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319018">case</span>&nbsp;<span class="string" id="3319023">&#34;..&#34;</span><span class="op" id="3319027">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319032">if</span>&nbsp;<span class="builtinfunc" id="3319035">len</span><span class="op" id="3319038">(</span><span class="ident" id="3319039">dst</span><span class="op" id="3319042">)</span>&nbsp;<span class="op" id="3319044">&gt;</span>&nbsp;<span class="num" id="3319046">0</span>&nbsp;<span class="op" id="3319048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319054">dst</span>&nbsp;<span class="op" id="3319058">=</span>&nbsp;<span class="ident" id="3319060">dst</span><span class="op" id="3319063">[</span><span class="op" id="3319064">:</span><span class="builtinfunc" id="3319065">len</span><span class="op" id="3319068">(</span><span class="ident" id="3319069">dst</span><span class="op" id="3319072">)</span><span class="op" id="3319073">-</span><span class="num" id="3319074">1</span><span class="op" id="3319075">]</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319084">default</span><span class="op" id="3319091">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319096">dst</span>&nbsp;<span class="op" id="3319100">=</span>&nbsp;<span class="builtinfunc" id="3319102">append</span><span class="op" id="3319108">(</span><span class="ident" id="3319109">dst</span><span class="op" id="3319112">,</span>&nbsp;<span class="ident" id="3319114">elem</span><span class="op" id="3319118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319125">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319128">if</span>&nbsp;<span class="ident" id="3319131">last</span>&nbsp;<span class="op" id="3319136">:=</span>&nbsp;<span class="ident" id="3319139">src</span><span class="op" id="3319142">[</span><span class="builtinfunc" id="3319143">len</span><span class="op" id="3319146">(</span><span class="ident" id="3319147">src</span><span class="op" id="3319150">)</span><span class="op" id="3319151">-</span><span class="num" id="3319152">1</span><span class="op" id="3319153">]</span><span class="op" id="3319154">;</span>&nbsp;<span class="ident" id="3319156">last</span>&nbsp;<span class="op" id="3319161">==</span>&nbsp;<span class="string" id="3319164">&#34;.&#34;</span>&nbsp;<span class="op" id="3319168">||</span>&nbsp;<span class="ident" id="3319171">last</span>&nbsp;<span class="op" id="3319176">==</span>&nbsp;<span class="string" id="3319179">&#34;..&#34;</span>&nbsp;<span class="op" id="3319184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3319188">//&nbsp;Add&nbsp;final&nbsp;slash&nbsp;to&nbsp;the&nbsp;joined&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319229">dst</span>&nbsp;<span class="op" id="3319233">=</span>&nbsp;<span class="builtinfunc" id="3319235">append</span><span class="op" id="3319241">(</span><span class="ident" id="3319242">dst</span><span class="op" id="3319245">,</span>&nbsp;<span class="string" id="3319247">&#34;&#34;</span><span class="op" id="3319249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319255">return</span>&nbsp;<span class="string" id="3319262">&#34;/&#34;</span>&nbsp;<span class="op" id="3319266">+</span>&nbsp;<span class="ident" id="3319268">strings</span><span class="op" id="3319275">.</span><span class="ident" id="3319276">TrimLeft</span><span class="op" id="3319284">(</span><span class="ident" id="3319285">strings</span><span class="op" id="3319292">.</span><span class="ident" id="3319293">Join</span><span class="op" id="3319297">(</span><span class="ident" id="3319298">dst</span><span class="op" id="3319301">,</span>&nbsp;<span class="string" id="3319303">&#34;/&#34;</span><span class="op" id="3319306">)</span><span class="op" id="3319307">,</span>&nbsp;<span class="string" id="3319309">&#34;/&#34;</span><span class="op" id="3319312">)</span><br>
<span class="lineno">640</span><span class="op" id="3319314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3319317">//&nbsp;IsAbs&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;URL&nbsp;is&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3319363">func</span>&nbsp;<span class="op" id="3319368">(</span><span class="ident" id="3319369">u</span>&nbsp;<span class="op" id="3319371">*</span><span class="ident" id="3319372">URL</span><span class="op" id="3319375">)</span>&nbsp;<span class="ident" id="3319377">IsAbs</span><span class="op" id="3319382">(</span><span class="op" id="3319383">)</span>&nbsp;<span class="builtintype" id="3319385">bool</span>&nbsp;<span class="op" id="3319390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319393">return</span>&nbsp;<span class="ident" id="3319400">u</span><span class="op" id="3319401">.</span><span class="ident" id="3319402">Scheme</span>&nbsp;<span class="op" id="3319409">!=</span>&nbsp;<span class="string" id="3319412">&#34;&#34;</span><br>
<span class="lineno">645</span><span class="op" id="3319415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3319418">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;in&nbsp;the&nbsp;context&nbsp;of&nbsp;the&nbsp;receiver.&nbsp;&nbsp;The&nbsp;provided&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="3319490">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;Parse&nbsp;returns&nbsp;nil,&nbsp;err&nbsp;on&nbsp;parse</span><br>
<span class="lineno"></span><span class="comment" id="3319555">//&nbsp;failure,&nbsp;otherwise&nbsp;its&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;ResolveReference.</span><br>
<span class="lineno">650</span><span class="keyword" id="3319627">func</span>&nbsp;<span class="op" id="3319632">(</span><span class="ident" id="3319633">u</span>&nbsp;<span class="op" id="3319635">*</span><span class="ident" id="3319636">URL</span><span class="op" id="3319639">)</span>&nbsp;<span class="ident" id="3319641">Parse</span><span class="op" id="3319646">(</span><span class="ident" id="3319647">ref</span>&nbsp;<span class="builtintype" id="3319651">string</span><span class="op" id="3319657">)</span>&nbsp;<span class="op" id="3319659">(</span><span class="op" id="3319660">*</span><span class="ident" id="3319661">URL</span><span class="op" id="3319664">,</span>&nbsp;<span class="builtintype" id="3319666">error</span><span class="op" id="3319671">)</span>&nbsp;<span class="op" id="3319673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319676">refurl</span><span class="op" id="3319682">,</span>&nbsp;<span class="ident" id="3319684">err</span>&nbsp;<span class="op" id="3319688">:=</span>&nbsp;<span class="ident" id="3319691">Parse</span><span class="op" id="3319696">(</span><span class="ident" id="3319697">ref</span><span class="op" id="3319700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319703">if</span>&nbsp;<span class="ident" id="3319706">err</span>&nbsp;<span class="op" id="3319710">!=</span>&nbsp;<span class="ident" id="3319713">nil</span>&nbsp;<span class="op" id="3319717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319721">return</span>&nbsp;<span class="ident" id="3319728">nil</span><span class="op" id="3319731">,</span>&nbsp;<span class="ident" id="3319733">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319738">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319741">return</span>&nbsp;<span class="ident" id="3319748">u</span><span class="op" id="3319749">.</span><span class="ident" id="3319750">ResolveReference</span><span class="op" id="3319766">(</span><span class="ident" id="3319767">refurl</span><span class="op" id="3319773">)</span><span class="op" id="3319774">,</span>&nbsp;<span class="ident" id="3319776">nil</span><br>
<span class="lineno"></span><span class="op" id="3319780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3319783">//&nbsp;ResolveReference&nbsp;resolves&nbsp;a&nbsp;URI&nbsp;reference&nbsp;to&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3319852">//&nbsp;an&nbsp;absolute&nbsp;base&nbsp;URI,&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;Section&nbsp;5.2.&nbsp;&nbsp;The&nbsp;URI&nbsp;reference</span><br>
<span class="lineno">660</span><span class="comment" id="3319922">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;ResolveReference&nbsp;always&nbsp;returns&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3319993">//&nbsp;URL&nbsp;instance,&nbsp;even&nbsp;if&nbsp;the&nbsp;returned&nbsp;URL&nbsp;is&nbsp;identical&nbsp;to&nbsp;either&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3320062">//&nbsp;base&nbsp;or&nbsp;reference.&nbsp;If&nbsp;ref&nbsp;is&nbsp;an&nbsp;absolute&nbsp;URL,&nbsp;then&nbsp;ResolveReference</span><br>
<span class="lineno"></span><span class="comment" id="3320133">//&nbsp;ignores&nbsp;base&nbsp;and&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;ref.</span><br>
<span class="lineno"></span><span class="keyword" id="3320176">func</span>&nbsp;<span class="op" id="3320181">(</span><span class="ident" id="3320182">u</span>&nbsp;<span class="op" id="3320184">*</span><span class="ident" id="3320185">URL</span><span class="op" id="3320188">)</span>&nbsp;<span class="ident" id="3320190">ResolveReference</span><span class="op" id="3320206">(</span><span class="ident" id="3320207">ref</span>&nbsp;<span class="op" id="3320211">*</span><span class="ident" id="3320212">URL</span><span class="op" id="3320215">)</span>&nbsp;<span class="op" id="3320217">*</span><span class="ident" id="3320218">URL</span>&nbsp;<span class="op" id="3320222">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320225">url</span>&nbsp;<span class="op" id="3320229">:=</span>&nbsp;<span class="op" id="3320232">*</span><span class="ident" id="3320233">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320238">if</span>&nbsp;<span class="ident" id="3320241">ref</span><span class="op" id="3320244">.</span><span class="ident" id="3320245">Scheme</span>&nbsp;<span class="op" id="3320252">==</span>&nbsp;<span class="string" id="3320255">&#34;&#34;</span>&nbsp;<span class="op" id="3320258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320262">url</span><span class="op" id="3320265">.</span><span class="ident" id="3320266">Scheme</span>&nbsp;<span class="op" id="3320273">=</span>&nbsp;<span class="ident" id="3320275">u</span><span class="op" id="3320276">.</span><span class="ident" id="3320277">Scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320288">if</span>&nbsp;<span class="ident" id="3320291">ref</span><span class="op" id="3320294">.</span><span class="ident" id="3320295">Scheme</span>&nbsp;<span class="op" id="3320302">!=</span>&nbsp;<span class="string" id="3320305">&#34;&#34;</span>&nbsp;<span class="op" id="3320308">||</span>&nbsp;<span class="ident" id="3320311">ref</span><span class="op" id="3320314">.</span><span class="ident" id="3320315">Host</span>&nbsp;<span class="op" id="3320320">!=</span>&nbsp;<span class="string" id="3320323">&#34;&#34;</span>&nbsp;<span class="op" id="3320326">||</span>&nbsp;<span class="ident" id="3320329">ref</span><span class="op" id="3320332">.</span><span class="ident" id="3320333">User</span>&nbsp;<span class="op" id="3320338">!=</span>&nbsp;<span class="ident" id="3320341">nil</span>&nbsp;<span class="op" id="3320345">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3320349">//&nbsp;The&nbsp;&#34;absoluteURI&#34;&nbsp;or&nbsp;&#34;net_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320393">url</span><span class="op" id="3320396">.</span><span class="ident" id="3320397">Path</span>&nbsp;<span class="op" id="3320402">=</span>&nbsp;<span class="ident" id="3320404">resolvePath</span><span class="op" id="3320415">(</span><span class="ident" id="3320416">ref</span><span class="op" id="3320419">.</span><span class="ident" id="3320420">Path</span><span class="op" id="3320424">,</span>&nbsp;<span class="string" id="3320426">&#34;&#34;</span><span class="op" id="3320428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320432">return</span>&nbsp;<span class="op" id="3320439">&amp;</span><span class="ident" id="3320440">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320448">if</span>&nbsp;<span class="ident" id="3320451">ref</span><span class="op" id="3320454">.</span><span class="ident" id="3320455">Opaque</span>&nbsp;<span class="op" id="3320462">!=</span>&nbsp;<span class="string" id="3320465">&#34;&#34;</span>&nbsp;<span class="op" id="3320468">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320472">url</span><span class="op" id="3320475">.</span><span class="ident" id="3320476">User</span>&nbsp;<span class="op" id="3320481">=</span>&nbsp;<span class="ident" id="3320483">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320489">url</span><span class="op" id="3320492">.</span><span class="ident" id="3320493">Host</span>&nbsp;<span class="op" id="3320498">=</span>&nbsp;<span class="string" id="3320500">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320505">url</span><span class="op" id="3320508">.</span><span class="ident" id="3320509">Path</span>&nbsp;<span class="op" id="3320514">=</span>&nbsp;<span class="string" id="3320516">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320521">return</span>&nbsp;<span class="op" id="3320528">&amp;</span><span class="ident" id="3320529">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320534">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320537">if</span>&nbsp;<span class="ident" id="3320540">ref</span><span class="op" id="3320543">.</span><span class="ident" id="3320544">Path</span>&nbsp;<span class="op" id="3320549">==</span>&nbsp;<span class="string" id="3320552">&#34;&#34;</span>&nbsp;<span class="op" id="3320555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320559">if</span>&nbsp;<span class="ident" id="3320562">ref</span><span class="op" id="3320565">.</span><span class="ident" id="3320566">RawQuery</span>&nbsp;<span class="op" id="3320575">==</span>&nbsp;<span class="string" id="3320578">&#34;&#34;</span>&nbsp;<span class="op" id="3320581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320586">url</span><span class="op" id="3320589">.</span><span class="ident" id="3320590">RawQuery</span>&nbsp;<span class="op" id="3320599">=</span>&nbsp;<span class="ident" id="3320601">u</span><span class="op" id="3320602">.</span><span class="ident" id="3320603">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320615">if</span>&nbsp;<span class="ident" id="3320618">ref</span><span class="op" id="3320621">.</span><span class="ident" id="3320622">Fragment</span>&nbsp;<span class="op" id="3320631">==</span>&nbsp;<span class="string" id="3320634">&#34;&#34;</span>&nbsp;<span class="op" id="3320637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320643">url</span><span class="op" id="3320646">.</span><span class="ident" id="3320647">Fragment</span>&nbsp;<span class="op" id="3320656">=</span>&nbsp;<span class="ident" id="3320658">u</span><span class="op" id="3320659">.</span><span class="ident" id="3320660">Fragment</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3320682">//&nbsp;The&nbsp;&#34;abs_path&#34;&nbsp;or&nbsp;&#34;rel_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320722">url</span><span class="op" id="3320725">.</span><span class="ident" id="3320726">Host</span>&nbsp;<span class="op" id="3320731">=</span>&nbsp;<span class="ident" id="3320733">u</span><span class="op" id="3320734">.</span><span class="ident" id="3320735">Host</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320741">url</span><span class="op" id="3320744">.</span><span class="ident" id="3320745">User</span>&nbsp;<span class="op" id="3320750">=</span>&nbsp;<span class="ident" id="3320752">u</span><span class="op" id="3320753">.</span><span class="ident" id="3320754">User</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320760">url</span><span class="op" id="3320763">.</span><span class="ident" id="3320764">Path</span>&nbsp;<span class="op" id="3320769">=</span>&nbsp;<span class="ident" id="3320771">resolvePath</span><span class="op" id="3320782">(</span><span class="ident" id="3320783">u</span><span class="op" id="3320784">.</span><span class="ident" id="3320785">Path</span><span class="op" id="3320789">,</span>&nbsp;<span class="ident" id="3320791">ref</span><span class="op" id="3320794">.</span><span class="ident" id="3320795">Path</span><span class="op" id="3320799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320802">return</span>&nbsp;<span class="op" id="3320809">&amp;</span><span class="ident" id="3320810">url</span><br>
<span class="lineno"></span><span class="op" id="3320814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="3320817">//&nbsp;Query&nbsp;parses&nbsp;RawQuery&nbsp;and&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3320880">func</span>&nbsp;<span class="op" id="3320885">(</span><span class="ident" id="3320886">u</span>&nbsp;<span class="op" id="3320888">*</span><span class="ident" id="3320889">URL</span><span class="op" id="3320892">)</span>&nbsp;<span class="ident" id="3320894">Query</span><span class="op" id="3320899">(</span><span class="op" id="3320900">)</span>&nbsp;<span class="ident" id="3320902">Values</span>&nbsp;<span class="op" id="3320909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320912">v</span><span class="op" id="3320913">,</span>&nbsp;<span class="ident" id="3320915">_</span>&nbsp;<span class="op" id="3320917">:=</span>&nbsp;<span class="ident" id="3320920">ParseQuery</span><span class="op" id="3320930">(</span><span class="ident" id="3320931">u</span><span class="op" id="3320932">.</span><span class="ident" id="3320933">RawQuery</span><span class="op" id="3320941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320944">return</span>&nbsp;<span class="ident" id="3320951">v</span><br>
<span class="lineno"></span><span class="op" id="3320953">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="comment" id="3320956">//&nbsp;RequestURI&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;path?query&nbsp;or&nbsp;opaque?query</span><br>
<span class="lineno"></span><span class="comment" id="3321017">//&nbsp;string&nbsp;that&nbsp;would&nbsp;be&nbsp;used&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;for&nbsp;u.</span><br>
<span class="lineno"></span><span class="keyword" id="3321072">func</span>&nbsp;<span class="op" id="3321077">(</span><span class="ident" id="3321078">u</span>&nbsp;<span class="op" id="3321080">*</span><span class="ident" id="3321081">URL</span><span class="op" id="3321084">)</span>&nbsp;<span class="ident" id="3321086">RequestURI</span><span class="op" id="3321096">(</span><span class="op" id="3321097">)</span>&nbsp;<span class="builtintype" id="3321099">string</span>&nbsp;<span class="op" id="3321106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3321109">result</span>&nbsp;<span class="op" id="3321116">:=</span>&nbsp;<span class="ident" id="3321119">u</span><span class="op" id="3321120">.</span><span class="ident" id="3321121">Opaque</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321129">if</span>&nbsp;<span class="ident" id="3321132">result</span>&nbsp;<span class="op" id="3321139">==</span>&nbsp;<span class="string" id="3321142">&#34;&#34;</span>&nbsp;<span class="op" id="3321145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3321149">result</span>&nbsp;<span class="op" id="3321156">=</span>&nbsp;<span class="ident" id="3321158">escape</span><span class="op" id="3321164">(</span><span class="ident" id="3321165">u</span><span class="op" id="3321166">.</span><span class="ident" id="3321167">Path</span><span class="op" id="3321171">,</span>&nbsp;<span class="ident" id="3321173">encodePath</span><span class="op" id="3321183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321187">if</span>&nbsp;<span class="ident" id="3321190">result</span>&nbsp;<span class="op" id="3321197">==</span>&nbsp;<span class="string" id="3321200">&#34;&#34;</span>&nbsp;<span class="op" id="3321203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3321208">result</span>&nbsp;<span class="op" id="3321215">=</span>&nbsp;<span class="string" id="3321217">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3321223">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3321226">}</span>&nbsp;<span class="keyword" id="3321228">else</span>&nbsp;<span class="op" id="3321233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321237">if</span>&nbsp;<span class="ident" id="3321240">strings</span><span class="op" id="3321247">.</span><span class="ident" id="3321248">HasPrefix</span><span class="op" id="3321257">(</span><span class="ident" id="3321258">result</span><span class="op" id="3321264">,</span>&nbsp;<span class="string" id="3321266">&#34;//&#34;</span><span class="op" id="3321270">)</span>&nbsp;<span class="op" id="3321272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3321277">result</span>&nbsp;<span class="op" id="3321284">=</span>&nbsp;<span class="ident" id="3321286">u</span><span class="op" id="3321287">.</span><span class="ident" id="3321288">Scheme</span>&nbsp;<span class="op" id="3321295">+</span>&nbsp;<span class="string" id="3321297">&#34;:&#34;</span>&nbsp;<span class="op" id="3321301">+</span>&nbsp;<span class="ident" id="3321303">result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3321312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3321315">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321318">if</span>&nbsp;<span class="ident" id="3321321">u</span><span class="op" id="3321322">.</span><span class="ident" id="3321323">RawQuery</span>&nbsp;<span class="op" id="3321332">!=</span>&nbsp;<span class="string" id="3321335">&#34;&#34;</span>&nbsp;<span class="op" id="3321338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3321342">result</span>&nbsp;<span class="op" id="3321349">+=</span>&nbsp;<span class="string" id="3321352">&#34;?&#34;</span>&nbsp;<span class="op" id="3321356">+</span>&nbsp;<span class="ident" id="3321358">u</span><span class="op" id="3321359">.</span><span class="ident" id="3321360">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3321370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321373">return</span>&nbsp;<span class="ident" id="3321380">result</span><br>
<span class="lineno"></span><span class="op" id="3321387">}</span>
</div>
</body>
</html>
