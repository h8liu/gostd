<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7664250">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7664305">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7664359">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7664410">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;parser&nbsp;test&nbsp;harness.&nbsp;The&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata</span><br>
<span class="lineno"></span><span class="comment" id="7664483">//&nbsp;directory&nbsp;are&nbsp;parsed&nbsp;and&nbsp;the&nbsp;errors&nbsp;reported&nbsp;are&nbsp;compared&nbsp;against&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7664556">//&nbsp;error&nbsp;messages&nbsp;expected&nbsp;in&nbsp;the&nbsp;test&nbsp;files.&nbsp;The&nbsp;test&nbsp;files&nbsp;must&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7664629">//&nbsp;.src&nbsp;rather&nbsp;than&nbsp;.go&nbsp;so&nbsp;that&nbsp;they&nbsp;are&nbsp;not&nbsp;disturbed&nbsp;by&nbsp;gofmt&nbsp;runs.</span><br>
<span class="lineno"></span><span class="comment" id="7664699">//</span><br>
<span class="lineno">10</span><span class="comment" id="7664702">//&nbsp;Expected&nbsp;errors&nbsp;are&nbsp;indicated&nbsp;in&nbsp;the&nbsp;test&nbsp;files&nbsp;by&nbsp;putting&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="7664774">//&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;immediately&nbsp;following&nbsp;an&nbsp;offending&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="7664848">//&nbsp;The&nbsp;harness&nbsp;will&nbsp;verify&nbsp;that&nbsp;an&nbsp;error&nbsp;matching&nbsp;the&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="7664921">//&nbsp;rx&nbsp;is&nbsp;reported&nbsp;at&nbsp;that&nbsp;source&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="7664964">//</span><br>
<span class="lineno">15</span><span class="comment" id="7664967">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;following&nbsp;test&nbsp;file&nbsp;indicates&nbsp;that&nbsp;a&nbsp;&#34;not&nbsp;declared&#34;</span><br>
<span class="lineno"></span><span class="comment" id="7665040">//&nbsp;error&nbsp;should&nbsp;be&nbsp;reported&nbsp;for&nbsp;the&nbsp;undeclared&nbsp;variable&nbsp;x:</span><br>
<span class="lineno"></span><span class="comment" id="7665099">//</span><br>
<span class="lineno"></span><span class="comment" id="7665102">//&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="7665115">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;f()&nbsp;{</span><br>
<span class="lineno">20</span><span class="comment" id="7665129">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp_&nbsp;=&nbsp;x&nbsp;/*&nbsp;ERROR&nbsp;&#34;not&nbsp;declared&#34;&nbsp;*/&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="7665170">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7665176">package</span>&nbsp;<span class="ident" id="7665184">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7665192">import</span>&nbsp;<span class="op" id="7665199">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7665202">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7665216">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7665228">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7665241">&#34;path/filepath&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7665258">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7665268">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7665279">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7665289">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="7665292">const</span>&nbsp;<span class="ident" id="7665298">testdata</span>&nbsp;<span class="op" id="7665307">=</span>&nbsp;<span class="string" id="7665309">&#34;testdata&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7665321">var</span>&nbsp;<span class="ident" id="7665325">fsetErrs</span>&nbsp;<span class="op" id="7665334">=</span>&nbsp;<span class="ident" id="7665336">token</span><span class="op" id="7665341">.</span><span class="ident" id="7665342">NewFileSet</span><span class="op" id="7665352">(</span><span class="op" id="7665353">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7665356">//&nbsp;getFile&nbsp;assumes&nbsp;that&nbsp;each&nbsp;filename&nbsp;occurs&nbsp;at&nbsp;most&nbsp;once</span><br>
<span class="lineno">40</span><span class="keyword" id="7665414">func</span>&nbsp;<span class="ident" id="7665419">getFile</span><span class="op" id="7665426">(</span><span class="ident" id="7665427">filename</span>&nbsp;<span class="builtintype" id="7665436">string</span><span class="op" id="7665442">)</span>&nbsp;<span class="op" id="7665444">(</span><span class="ident" id="7665445">file</span>&nbsp;<span class="op" id="7665450">*</span><span class="ident" id="7665451">token</span><span class="op" id="7665456">.</span><span class="ident" id="7665457">File</span><span class="op" id="7665461">)</span>&nbsp;<span class="op" id="7665463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7665466">fsetErrs</span><span class="op" id="7665474">.</span><span class="ident" id="7665475">Iterate</span><span class="op" id="7665482">(</span><span class="keyword" id="7665483">func</span><span class="op" id="7665487">(</span><span class="ident" id="7665488">f</span>&nbsp;<span class="op" id="7665490">*</span><span class="ident" id="7665491">token</span><span class="op" id="7665496">.</span><span class="ident" id="7665497">File</span><span class="op" id="7665501">)</span>&nbsp;<span class="builtintype" id="7665503">bool</span>&nbsp;<span class="op" id="7665508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7665512">if</span>&nbsp;<span class="ident" id="7665515">f</span><span class="op" id="7665516">.</span><span class="ident" id="7665517">Name</span><span class="op" id="7665521">(</span><span class="op" id="7665522">)</span>&nbsp;<span class="op" id="7665524">==</span>&nbsp;<span class="ident" id="7665527">filename</span>&nbsp;<span class="op" id="7665536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7665541">if</span>&nbsp;<span class="ident" id="7665544">file</span>&nbsp;<span class="op" id="7665549">!=</span>&nbsp;<span class="ident" id="7665552">nil</span>&nbsp;<span class="op" id="7665556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7665562">panic</span><span class="op" id="7665567">(</span><span class="ident" id="7665568">filename</span>&nbsp;<span class="op" id="7665577">+</span>&nbsp;<span class="string" id="7665579">&#34;&nbsp;used&nbsp;multiple&nbsp;times&#34;</span><span class="op" id="7665601">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7665606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7665611">file</span>&nbsp;<span class="op" id="7665616">=</span>&nbsp;<span class="ident" id="7665618">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7665622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7665626">return</span>&nbsp;<span class="ident" id="7665633">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7665639">}</span><span class="op" id="7665640">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7665643">return</span>&nbsp;<span class="ident" id="7665650">file</span><br>
<span class="lineno"></span><span class="op" id="7665655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7665658">func</span>&nbsp;<span class="ident" id="7665663">getPos</span><span class="op" id="7665669">(</span><span class="ident" id="7665670">filename</span>&nbsp;<span class="builtintype" id="7665679">string</span><span class="op" id="7665685">,</span>&nbsp;<span class="ident" id="7665687">offset</span>&nbsp;<span class="builtintype" id="7665694">int</span><span class="op" id="7665697">)</span>&nbsp;<span class="ident" id="7665699">token</span><span class="op" id="7665704">.</span><span class="ident" id="7665705">Pos</span>&nbsp;<span class="op" id="7665709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7665712">if</span>&nbsp;<span class="ident" id="7665715">f</span>&nbsp;<span class="op" id="7665717">:=</span>&nbsp;<span class="ident" id="7665720">getFile</span><span class="op" id="7665727">(</span><span class="ident" id="7665728">filename</span><span class="op" id="7665736">)</span><span class="op" id="7665737">;</span>&nbsp;<span class="ident" id="7665739">f</span>&nbsp;<span class="op" id="7665741">!=</span>&nbsp;<span class="ident" id="7665744">nil</span>&nbsp;<span class="op" id="7665748">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7665752">return</span>&nbsp;<span class="ident" id="7665759">f</span><span class="op" id="7665760">.</span><span class="ident" id="7665761">Pos</span><span class="op" id="7665764">(</span><span class="ident" id="7665765">offset</span><span class="op" id="7665771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7665774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7665777">return</span>&nbsp;<span class="ident" id="7665784">token</span><span class="op" id="7665789">.</span><span class="ident" id="7665790">NoPos</span><br>
<span class="lineno"></span><span class="op" id="7665796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="7665799">//&nbsp;ERROR&nbsp;comments&nbsp;must&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;and&nbsp;rx&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="7665864">//&nbsp;a&nbsp;regular&nbsp;expression&nbsp;that&nbsp;matches&nbsp;the&nbsp;expected&nbsp;error&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="7665929">//&nbsp;The&nbsp;special&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;HERE&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;must&nbsp;be&nbsp;used&nbsp;for&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="7665994">//&nbsp;messages&nbsp;that&nbsp;appear&nbsp;immediately&nbsp;after&nbsp;a&nbsp;token,&nbsp;rather&nbsp;than&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="7666060">//&nbsp;a&nbsp;token&#39;s&nbsp;position.</span><br>
<span class="lineno">65</span><span class="comment" id="7666083">//</span><br>
<span class="lineno"></span><span class="keyword" id="7666086">var</span>&nbsp;<span class="ident" id="7666090">errRx</span>&nbsp;<span class="op" id="7666096">=</span>&nbsp;<span class="ident" id="7666098">regexp</span><span class="op" id="7666104">.</span><span class="ident" id="7666105">MustCompile</span><span class="op" id="7666116">(</span><span class="string" id="7666117">`^/\*&nbsp;*ERROR&nbsp;*(HERE)?&nbsp;*&#34;([^&#34;]*)&#34;&nbsp;*\*/$`</span><span class="op" id="7666156">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7666159">//&nbsp;expectedErrors&nbsp;collects&nbsp;the&nbsp;regular&nbsp;expressions&nbsp;of&nbsp;ERROR&nbsp;comments&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="7666234">//&nbsp;in&nbsp;files&nbsp;and&nbsp;returns&nbsp;them&nbsp;as&nbsp;a&nbsp;map&nbsp;of&nbsp;error&nbsp;positions&nbsp;to&nbsp;error&nbsp;messages.</span><br>
<span class="lineno">70</span><span class="comment" id="7666310">//</span><br>
<span class="lineno"></span><span class="keyword" id="7666313">func</span>&nbsp;<span class="ident" id="7666318">expectedErrors</span><span class="op" id="7666332">(</span><span class="ident" id="7666333">t</span>&nbsp;<span class="op" id="7666335">*</span><span class="ident" id="7666336">testing</span><span class="op" id="7666343">.</span><span class="ident" id="7666344">T</span><span class="op" id="7666345">,</span>&nbsp;<span class="ident" id="7666347">filename</span>&nbsp;<span class="builtintype" id="7666356">string</span><span class="op" id="7666362">,</span>&nbsp;<span class="ident" id="7666364">src</span>&nbsp;<span class="op" id="7666368">[</span><span class="op" id="7666369">]</span><span class="builtintype" id="7666370">byte</span><span class="op" id="7666374">)</span>&nbsp;<span class="keyword" id="7666376">map</span><span class="op" id="7666379">[</span><span class="ident" id="7666380">token</span><span class="op" id="7666385">.</span><span class="ident" id="7666386">Pos</span><span class="op" id="7666389">]</span><span class="builtintype" id="7666390">string</span>&nbsp;<span class="op" id="7666397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7666400">errors</span>&nbsp;<span class="op" id="7666407">:=</span>&nbsp;<span class="builtinfunc" id="7666410">make</span><span class="op" id="7666414">(</span><span class="keyword" id="7666415">map</span><span class="op" id="7666418">[</span><span class="ident" id="7666419">token</span><span class="op" id="7666424">.</span><span class="ident" id="7666425">Pos</span><span class="op" id="7666428">]</span><span class="builtintype" id="7666429">string</span><span class="op" id="7666435">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7666439">var</span>&nbsp;<span class="ident" id="7666443">s</span>&nbsp;<span class="ident" id="7666445">scanner</span><span class="op" id="7666452">.</span><span class="ident" id="7666453">Scanner</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7666462">//&nbsp;file&nbsp;was&nbsp;parsed&nbsp;already&nbsp;-&nbsp;do&nbsp;not&nbsp;add&nbsp;it&nbsp;again&nbsp;to&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7666524">//&nbsp;set&nbsp;otherwise&nbsp;the&nbsp;position&nbsp;information&nbsp;returned&nbsp;here&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7666586">//&nbsp;not&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;collected&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7666649">s</span><span class="op" id="7666650">.</span><span class="ident" id="7666651">Init</span><span class="op" id="7666655">(</span><span class="ident" id="7666656">getFile</span><span class="op" id="7666663">(</span><span class="ident" id="7666664">filename</span><span class="op" id="7666672">)</span><span class="op" id="7666673">,</span>&nbsp;<span class="ident" id="7666675">src</span><span class="op" id="7666678">,</span>&nbsp;<span class="ident" id="7666680">nil</span><span class="op" id="7666683">,</span>&nbsp;<span class="ident" id="7666685">scanner</span><span class="op" id="7666692">.</span><span class="ident" id="7666693">ScanComments</span><span class="op" id="7666705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7666708">var</span>&nbsp;<span class="ident" id="7666712">prev</span>&nbsp;<span class="ident" id="7666717">token</span><span class="op" id="7666722">.</span><span class="ident" id="7666723">Pos</span>&nbsp;<span class="comment" id="7666727">//&nbsp;position&nbsp;of&nbsp;last&nbsp;non-comment,&nbsp;non-semicolon&nbsp;token</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7666781">var</span>&nbsp;<span class="ident" id="7666785">here</span>&nbsp;<span class="ident" id="7666790">token</span><span class="op" id="7666795">.</span><span class="ident" id="7666796">Pos</span>&nbsp;<span class="comment" id="7666800">//&nbsp;position&nbsp;immediately&nbsp;after&nbsp;the&nbsp;token&nbsp;at&nbsp;position&nbsp;prev</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7666859">for</span>&nbsp;<span class="op" id="7666863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7666867">pos</span><span class="op" id="7666870">,</span>&nbsp;<span class="ident" id="7666872">tok</span><span class="op" id="7666875">,</span>&nbsp;<span class="ident" id="7666877">lit</span>&nbsp;<span class="op" id="7666881">:=</span>&nbsp;<span class="ident" id="7666884">s</span><span class="op" id="7666885">.</span><span class="ident" id="7666886">Scan</span><span class="op" id="7666890">(</span><span class="op" id="7666891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7666895">switch</span>&nbsp;<span class="ident" id="7666902">tok</span>&nbsp;<span class="op" id="7666906">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7666910">case</span>&nbsp;<span class="ident" id="7666915">token</span><span class="op" id="7666920">.</span><span class="ident" id="7666921">EOF</span><span class="op" id="7666924">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7666929">return</span>&nbsp;<span class="ident" id="7666936">errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7666945">case</span>&nbsp;<span class="ident" id="7666950">token</span><span class="op" id="7666955">.</span><span class="ident" id="7666956">COMMENT</span><span class="op" id="7666963">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7666968">s</span>&nbsp;<span class="op" id="7666970">:=</span>&nbsp;<span class="ident" id="7666973">errRx</span><span class="op" id="7666978">.</span><span class="ident" id="7666979">FindStringSubmatch</span><span class="op" id="7666997">(</span><span class="ident" id="7666998">lit</span><span class="op" id="7667001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7667006">if</span>&nbsp;<span class="builtinfunc" id="7667009">len</span><span class="op" id="7667012">(</span><span class="ident" id="7667013">s</span><span class="op" id="7667014">)</span>&nbsp;<span class="op" id="7667016">==</span>&nbsp;<span class="num" id="7667019">3</span>&nbsp;<span class="op" id="7667021">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7667027">pos</span>&nbsp;<span class="op" id="7667031">:=</span>&nbsp;<span class="ident" id="7667034">prev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7667043">if</span>&nbsp;<span class="ident" id="7667046">s</span><span class="op" id="7667047">[</span><span class="num" id="7667048">1</span><span class="op" id="7667049">]</span>&nbsp;<span class="op" id="7667051">==</span>&nbsp;<span class="string" id="7667054">&#34;HERE&#34;</span>&nbsp;<span class="op" id="7667061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7667068">pos</span>&nbsp;<span class="op" id="7667072">=</span>&nbsp;<span class="ident" id="7667074">here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7667083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7667089">errors</span><span class="op" id="7667095">[</span><span class="ident" id="7667096">pos</span><span class="op" id="7667099">]</span>&nbsp;<span class="op" id="7667101">=</span>&nbsp;<span class="builtintype" id="7667103">string</span><span class="op" id="7667109">(</span><span class="ident" id="7667110">s</span><span class="op" id="7667111">[</span><span class="num" id="7667112">2</span><span class="op" id="7667113">]</span><span class="op" id="7667114">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7667119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7667123">default</span><span class="op" id="7667130">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7667135">prev</span>&nbsp;<span class="op" id="7667140">=</span>&nbsp;<span class="ident" id="7667142">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7667149">var</span>&nbsp;<span class="ident" id="7667153">l</span>&nbsp;<span class="builtintype" id="7667155">int</span>&nbsp;<span class="comment" id="7667159">//&nbsp;token&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7667178">if</span>&nbsp;<span class="ident" id="7667181">tok</span><span class="op" id="7667184">.</span><span class="ident" id="7667185">IsLiteral</span><span class="op" id="7667194">(</span><span class="op" id="7667195">)</span>&nbsp;<span class="op" id="7667197">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7667203">l</span>&nbsp;<span class="op" id="7667205">=</span>&nbsp;<span class="builtinfunc" id="7667207">len</span><span class="op" id="7667210">(</span><span class="ident" id="7667211">lit</span><span class="op" id="7667214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7667219">}</span>&nbsp;<span class="keyword" id="7667221">else</span>&nbsp;<span class="op" id="7667226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7667232">l</span>&nbsp;<span class="op" id="7667234">=</span>&nbsp;<span class="builtinfunc" id="7667236">len</span><span class="op" id="7667239">(</span><span class="ident" id="7667240">tok</span><span class="op" id="7667243">.</span><span class="ident" id="7667244">String</span><span class="op" id="7667250">(</span><span class="op" id="7667251">)</span><span class="op" id="7667252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7667257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7667262">here</span>&nbsp;<span class="op" id="7667267">=</span>&nbsp;<span class="ident" id="7667269">prev</span>&nbsp;<span class="op" id="7667274">+</span>&nbsp;<span class="ident" id="7667276">token</span><span class="op" id="7667281">.</span><span class="ident" id="7667282">Pos</span><span class="op" id="7667285">(</span><span class="ident" id="7667286">l</span><span class="op" id="7667287">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7667291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7667294">}</span><br>
<span class="lineno"></span><span class="op" id="7667296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7667299">//&nbsp;compareErrors&nbsp;compares&nbsp;the&nbsp;map&nbsp;of&nbsp;expected&nbsp;error&nbsp;messages&nbsp;with&nbsp;the&nbsp;list</span><br>
<span class="lineno">110</span><span class="comment" id="7667374">//&nbsp;of&nbsp;found&nbsp;errors&nbsp;and&nbsp;reports&nbsp;discrepancies.</span><br>
<span class="lineno"></span><span class="comment" id="7667420">//</span><br>
<span class="lineno"></span><span class="keyword" id="7667423">func</span>&nbsp;<span class="ident" id="7667428">compareErrors</span><span class="op" id="7667441">(</span><span class="ident" id="7667442">t</span>&nbsp;<span class="op" id="7667444">*</span><span class="ident" id="7667445">testing</span><span class="op" id="7667452">.</span><span class="ident" id="7667453">T</span><span class="op" id="7667454">,</span>&nbsp;<span class="ident" id="7667456">expected</span>&nbsp;<span class="keyword" id="7667465">map</span><span class="op" id="7667468">[</span><span class="ident" id="7667469">token</span><span class="op" id="7667474">.</span><span class="ident" id="7667475">Pos</span><span class="op" id="7667478">]</span><span class="builtintype" id="7667479">string</span><span class="op" id="7667485">,</span>&nbsp;<span class="ident" id="7667487">found</span>&nbsp;<span class="ident" id="7667493">scanner</span><span class="op" id="7667500">.</span><span class="ident" id="7667501">ErrorList</span><span class="op" id="7667510">)</span>&nbsp;<span class="op" id="7667512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7667515">for</span>&nbsp;<span class="ident" id="7667519">_</span><span class="op" id="7667520">,</span>&nbsp;<span class="builtintype" id="7667522">error</span>&nbsp;<span class="op" id="7667528">:=</span>&nbsp;<span class="keyword" id="7667531">range</span>&nbsp;<span class="ident" id="7667537">found</span>&nbsp;<span class="op" id="7667543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7667547">//&nbsp;error.Pos&nbsp;is&nbsp;a&nbsp;token.Position,&nbsp;but&nbsp;we&nbsp;want</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7667595">//&nbsp;a&nbsp;token.Pos&nbsp;so&nbsp;we&nbsp;can&nbsp;do&nbsp;a&nbsp;map&nbsp;lookup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7667638">pos</span>&nbsp;<span class="op" id="7667642">:=</span>&nbsp;<span class="ident" id="7667645">getPos</span><span class="op" id="7667651">(</span><span class="builtintype" id="7667652">error</span><span class="op" id="7667657">.</span><span class="ident" id="7667658">Pos</span><span class="op" id="7667661">.</span><span class="ident" id="7667662">Filename</span><span class="op" id="7667670">,</span>&nbsp;<span class="builtintype" id="7667672">error</span><span class="op" id="7667677">.</span><span class="ident" id="7667678">Pos</span><span class="op" id="7667681">.</span><span class="ident" id="7667682">Offset</span><span class="op" id="7667688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7667692">if</span>&nbsp;<span class="ident" id="7667695">msg</span><span class="op" id="7667698">,</span>&nbsp;<span class="ident" id="7667700">found</span>&nbsp;<span class="op" id="7667706">:=</span>&nbsp;<span class="ident" id="7667709">expected</span><span class="op" id="7667717">[</span><span class="ident" id="7667718">pos</span><span class="op" id="7667721">]</span><span class="op" id="7667722">;</span>&nbsp;<span class="ident" id="7667724">found</span>&nbsp;<span class="op" id="7667730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7667735">//&nbsp;we&nbsp;expect&nbsp;a&nbsp;message&nbsp;at&nbsp;pos;&nbsp;check&nbsp;if&nbsp;it&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7667789">rx</span><span class="op" id="7667791">,</span>&nbsp;<span class="ident" id="7667793">err</span>&nbsp;<span class="op" id="7667797">:=</span>&nbsp;<span class="ident" id="7667800">regexp</span><span class="op" id="7667806">.</span><span class="ident" id="7667807">Compile</span><span class="op" id="7667814">(</span><span class="ident" id="7667815">msg</span><span class="op" id="7667818">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7667823">if</span>&nbsp;<span class="ident" id="7667826">err</span>&nbsp;<span class="op" id="7667830">!=</span>&nbsp;<span class="ident" id="7667833">nil</span>&nbsp;<span class="op" id="7667837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7667843">t</span><span class="op" id="7667844">.</span><span class="ident" id="7667845">Errorf</span><span class="op" id="7667851">(</span><span class="string" id="7667852">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="7667860">,</span>&nbsp;<span class="builtintype" id="7667862">error</span><span class="op" id="7667867">.</span><span class="ident" id="7667868">Pos</span><span class="op" id="7667871">,</span>&nbsp;<span class="ident" id="7667873">err</span><span class="op" id="7667876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7667882">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7667894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7667899">if</span>&nbsp;<span class="ident" id="7667902">match</span>&nbsp;<span class="op" id="7667908">:=</span>&nbsp;<span class="ident" id="7667911">rx</span><span class="op" id="7667913">.</span><span class="ident" id="7667914">MatchString</span><span class="op" id="7667925">(</span><span class="builtintype" id="7667926">error</span><span class="op" id="7667931">.</span><span class="ident" id="7667932">Msg</span><span class="op" id="7667935">)</span><span class="op" id="7667936">;</span>&nbsp;<span class="op" id="7667938">!</span><span class="ident" id="7667939">match</span>&nbsp;<span class="op" id="7667945">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7667951">t</span><span class="op" id="7667952">.</span><span class="ident" id="7667953">Errorf</span><span class="op" id="7667959">(</span><span class="string" id="7667960">&#34;%s:&nbsp;%q&nbsp;does&nbsp;not&nbsp;match&nbsp;%q&#34;</span><span class="op" id="7667986">,</span>&nbsp;<span class="builtintype" id="7667988">error</span><span class="op" id="7667993">.</span><span class="ident" id="7667994">Pos</span><span class="op" id="7667997">,</span>&nbsp;<span class="builtintype" id="7667999">error</span><span class="op" id="7668004">.</span><span class="ident" id="7668005">Msg</span><span class="op" id="7668008">,</span>&nbsp;<span class="ident" id="7668010">msg</span><span class="op" id="7668013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7668019">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7668031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7668036">//&nbsp;we&nbsp;have&nbsp;a&nbsp;match&nbsp;-&nbsp;eliminate&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7668081">delete</span><span class="op" id="7668087">(</span><span class="ident" id="7668088">expected</span><span class="op" id="7668096">,</span>&nbsp;<span class="ident" id="7668098">pos</span><span class="op" id="7668101">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7668105">}</span>&nbsp;<span class="keyword" id="7668107">else</span>&nbsp;<span class="op" id="7668112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7668117">//&nbsp;To&nbsp;keep&nbsp;in&nbsp;mind&nbsp;when&nbsp;analyzing&nbsp;failed&nbsp;test&nbsp;output:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7668174">//&nbsp;If&nbsp;the&nbsp;same&nbsp;error&nbsp;position&nbsp;occurs&nbsp;multiple&nbsp;times&nbsp;in&nbsp;errors,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7668240">//&nbsp;this&nbsp;message&nbsp;will&nbsp;be&nbsp;triggered&nbsp;(because&nbsp;the&nbsp;first&nbsp;error&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7668305">//&nbsp;the&nbsp;position&nbsp;removes&nbsp;this&nbsp;position&nbsp;from&nbsp;the&nbsp;expected&nbsp;errors).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7668373">t</span><span class="op" id="7668374">.</span><span class="ident" id="7668375">Errorf</span><span class="op" id="7668381">(</span><span class="string" id="7668382">&#34;%s:&nbsp;unexpected&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7668408">,</span>&nbsp;<span class="builtintype" id="7668410">error</span><span class="op" id="7668415">.</span><span class="ident" id="7668416">Pos</span><span class="op" id="7668419">,</span>&nbsp;<span class="builtintype" id="7668421">error</span><span class="op" id="7668426">.</span><span class="ident" id="7668427">Msg</span><span class="op" id="7668430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7668434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7668437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7668441">//&nbsp;there&nbsp;should&nbsp;be&nbsp;no&nbsp;expected&nbsp;errors&nbsp;left</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7668485">if</span>&nbsp;<span class="builtinfunc" id="7668488">len</span><span class="op" id="7668491">(</span><span class="ident" id="7668492">expected</span><span class="op" id="7668500">)</span>&nbsp;<span class="op" id="7668502">&gt;</span>&nbsp;<span class="num" id="7668504">0</span>&nbsp;<span class="op" id="7668506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7668510">t</span><span class="op" id="7668511">.</span><span class="ident" id="7668512">Errorf</span><span class="op" id="7668518">(</span><span class="string" id="7668519">&#34;%d&nbsp;errors&nbsp;not&nbsp;reported:&#34;</span><span class="op" id="7668544">,</span>&nbsp;<span class="builtinfunc" id="7668546">len</span><span class="op" id="7668549">(</span><span class="ident" id="7668550">expected</span><span class="op" id="7668558">)</span><span class="op" id="7668559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7668563">for</span>&nbsp;<span class="ident" id="7668567">pos</span><span class="op" id="7668570">,</span>&nbsp;<span class="ident" id="7668572">msg</span>&nbsp;<span class="op" id="7668576">:=</span>&nbsp;<span class="keyword" id="7668579">range</span>&nbsp;<span class="ident" id="7668585">expected</span>&nbsp;<span class="op" id="7668594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7668599">t</span><span class="op" id="7668600">.</span><span class="ident" id="7668601">Errorf</span><span class="op" id="7668607">(</span><span class="string" id="7668608">&#34;%s:&nbsp;%s\n&#34;</span><span class="op" id="7668618">,</span>&nbsp;<span class="ident" id="7668620">fsetErrs</span><span class="op" id="7668628">.</span><span class="ident" id="7668629">Position</span><span class="op" id="7668637">(</span><span class="ident" id="7668638">pos</span><span class="op" id="7668641">)</span><span class="op" id="7668642">,</span>&nbsp;<span class="ident" id="7668644">msg</span><span class="op" id="7668647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7668651">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7668654">}</span><br>
<span class="lineno"></span><span class="op" id="7668656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7668659">func</span>&nbsp;<span class="ident" id="7668664">checkErrors</span><span class="op" id="7668675">(</span><span class="ident" id="7668676">t</span>&nbsp;<span class="op" id="7668678">*</span><span class="ident" id="7668679">testing</span><span class="op" id="7668686">.</span><span class="ident" id="7668687">T</span><span class="op" id="7668688">,</span>&nbsp;<span class="ident" id="7668690">filename</span>&nbsp;<span class="builtintype" id="7668699">string</span><span class="op" id="7668705">,</span>&nbsp;<span class="ident" id="7668707">input</span>&nbsp;<span class="keyword" id="7668713">interface</span><span class="op" id="7668722">{</span><span class="op" id="7668723">}</span><span class="op" id="7668724">)</span>&nbsp;<span class="op" id="7668726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7668729">src</span><span class="op" id="7668732">,</span>&nbsp;<span class="ident" id="7668734">err</span>&nbsp;<span class="op" id="7668738">:=</span>&nbsp;<span class="ident" id="7668741">readSource</span><span class="op" id="7668751">(</span><span class="ident" id="7668752">filename</span><span class="op" id="7668760">,</span>&nbsp;<span class="ident" id="7668762">input</span><span class="op" id="7668767">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7668770">if</span>&nbsp;<span class="ident" id="7668773">err</span>&nbsp;<span class="op" id="7668777">!=</span>&nbsp;<span class="ident" id="7668780">nil</span>&nbsp;<span class="op" id="7668784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7668788">t</span><span class="op" id="7668789">.</span><span class="ident" id="7668790">Error</span><span class="op" id="7668795">(</span><span class="ident" id="7668796">err</span><span class="op" id="7668799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7668803">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7668811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7668815">_</span><span class="op" id="7668816">,</span>&nbsp;<span class="ident" id="7668818">err</span>&nbsp;<span class="op" id="7668822">=</span>&nbsp;<span class="ident" id="7668824">ParseFile</span><span class="op" id="7668833">(</span><span class="ident" id="7668834">fsetErrs</span><span class="op" id="7668842">,</span>&nbsp;<span class="ident" id="7668844">filename</span><span class="op" id="7668852">,</span>&nbsp;<span class="ident" id="7668854">src</span><span class="op" id="7668857">,</span>&nbsp;<span class="ident" id="7668859">DeclarationErrors</span><span class="op" id="7668876">|</span><span class="ident" id="7668877">AllErrors</span><span class="op" id="7668886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7668889">found</span><span class="op" id="7668894">,</span>&nbsp;<span class="ident" id="7668896">ok</span>&nbsp;<span class="op" id="7668899">:=</span>&nbsp;<span class="ident" id="7668902">err</span><span class="op" id="7668905">.</span><span class="op" id="7668906">(</span><span class="ident" id="7668907">scanner</span><span class="op" id="7668914">.</span><span class="ident" id="7668915">ErrorList</span><span class="op" id="7668924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7668927">if</span>&nbsp;<span class="ident" id="7668930">err</span>&nbsp;<span class="op" id="7668934">!=</span>&nbsp;<span class="ident" id="7668937">nil</span>&nbsp;<span class="op" id="7668941">&amp;&amp;</span>&nbsp;<span class="op" id="7668944">!</span><span class="ident" id="7668945">ok</span>&nbsp;<span class="op" id="7668948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7668952">t</span><span class="op" id="7668953">.</span><span class="ident" id="7668954">Error</span><span class="op" id="7668959">(</span><span class="ident" id="7668960">err</span><span class="op" id="7668963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7668967">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7668975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7668978">found</span><span class="op" id="7668983">.</span><span class="ident" id="7668984">RemoveMultiples</span><span class="op" id="7668999">(</span><span class="op" id="7669000">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7669004">//&nbsp;we&nbsp;are&nbsp;expecting&nbsp;the&nbsp;following&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7669046">//&nbsp;(collect&nbsp;these&nbsp;after&nbsp;parsing&nbsp;a&nbsp;file&nbsp;so&nbsp;that&nbsp;it&nbsp;is&nbsp;found&nbsp;in&nbsp;the&nbsp;file&nbsp;set)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7669123">expected</span>&nbsp;<span class="op" id="7669132">:=</span>&nbsp;<span class="ident" id="7669135">expectedErrors</span><span class="op" id="7669149">(</span><span class="ident" id="7669150">t</span><span class="op" id="7669151">,</span>&nbsp;<span class="ident" id="7669153">filename</span><span class="op" id="7669161">,</span>&nbsp;<span class="ident" id="7669163">src</span><span class="op" id="7669166">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7669170">//&nbsp;verify&nbsp;errors&nbsp;returned&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7669211">compareErrors</span><span class="op" id="7669224">(</span><span class="ident" id="7669225">t</span><span class="op" id="7669226">,</span>&nbsp;<span class="ident" id="7669228">expected</span><span class="op" id="7669236">,</span>&nbsp;<span class="ident" id="7669238">found</span><span class="op" id="7669243">)</span><br>
<span class="lineno"></span><span class="op" id="7669245">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="7669248">func</span>&nbsp;<span class="ident" id="7669253">TestErrors</span><span class="op" id="7669263">(</span><span class="ident" id="7669264">t</span>&nbsp;<span class="op" id="7669266">*</span><span class="ident" id="7669267">testing</span><span class="op" id="7669274">.</span><span class="ident" id="7669275">T</span><span class="op" id="7669276">)</span>&nbsp;<span class="op" id="7669278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7669281">list</span><span class="op" id="7669285">,</span>&nbsp;<span class="ident" id="7669287">err</span>&nbsp;<span class="op" id="7669291">:=</span>&nbsp;<span class="ident" id="7669294">ioutil</span><span class="op" id="7669300">.</span><span class="ident" id="7669301">ReadDir</span><span class="op" id="7669308">(</span><span class="ident" id="7669309">testdata</span><span class="op" id="7669317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7669320">if</span>&nbsp;<span class="ident" id="7669323">err</span>&nbsp;<span class="op" id="7669327">!=</span>&nbsp;<span class="ident" id="7669330">nil</span>&nbsp;<span class="op" id="7669334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7669338">t</span><span class="op" id="7669339">.</span><span class="ident" id="7669340">Fatal</span><span class="op" id="7669345">(</span><span class="ident" id="7669346">err</span><span class="op" id="7669349">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7669352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7669355">for</span>&nbsp;<span class="ident" id="7669359">_</span><span class="op" id="7669360">,</span>&nbsp;<span class="ident" id="7669362">fi</span>&nbsp;<span class="op" id="7669365">:=</span>&nbsp;<span class="keyword" id="7669368">range</span>&nbsp;<span class="ident" id="7669374">list</span>&nbsp;<span class="op" id="7669379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7669383">name</span>&nbsp;<span class="op" id="7669388">:=</span>&nbsp;<span class="ident" id="7669391">fi</span><span class="op" id="7669393">.</span><span class="ident" id="7669394">Name</span><span class="op" id="7669398">(</span><span class="op" id="7669399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7669403">if</span>&nbsp;<span class="op" id="7669406">!</span><span class="ident" id="7669407">fi</span><span class="op" id="7669409">.</span><span class="ident" id="7669410">IsDir</span><span class="op" id="7669415">(</span><span class="op" id="7669416">)</span>&nbsp;<span class="op" id="7669418">&amp;&amp;</span>&nbsp;<span class="op" id="7669421">!</span><span class="ident" id="7669422">strings</span><span class="op" id="7669429">.</span><span class="ident" id="7669430">HasPrefix</span><span class="op" id="7669439">(</span><span class="ident" id="7669440">name</span><span class="op" id="7669444">,</span>&nbsp;<span class="string" id="7669446">&#34;.&#34;</span><span class="op" id="7669449">)</span>&nbsp;<span class="op" id="7669451">&amp;&amp;</span>&nbsp;<span class="ident" id="7669454">strings</span><span class="op" id="7669461">.</span><span class="ident" id="7669462">HasSuffix</span><span class="op" id="7669471">(</span><span class="ident" id="7669472">name</span><span class="op" id="7669476">,</span>&nbsp;<span class="string" id="7669478">&#34;.src&#34;</span><span class="op" id="7669484">)</span>&nbsp;<span class="op" id="7669486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7669491">checkErrors</span><span class="op" id="7669502">(</span><span class="ident" id="7669503">t</span><span class="op" id="7669504">,</span>&nbsp;<span class="ident" id="7669506">filepath</span><span class="op" id="7669514">.</span><span class="ident" id="7669515">Join</span><span class="op" id="7669519">(</span><span class="ident" id="7669520">testdata</span><span class="op" id="7669528">,</span>&nbsp;<span class="ident" id="7669530">name</span><span class="op" id="7669534">)</span><span class="op" id="7669535">,</span>&nbsp;<span class="ident" id="7669537">nil</span><span class="op" id="7669540">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7669544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7669547">}</span><br>
<span class="lineno"></span><span class="op" id="7669549">}</span>
</div>
</body>
</html>
