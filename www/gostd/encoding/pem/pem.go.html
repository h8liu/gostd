<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/pem</h2>
<ul>
<li><a href="/gostd/encoding/pem/pem.go.html" class="current">pem.go</a></li>
<li><a href="/gostd/encoding/pem/pem_test.go.html">pem_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4437265">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4437320">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4437374">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4437425">//&nbsp;Package&nbsp;pem&nbsp;implements&nbsp;the&nbsp;PEM&nbsp;data&nbsp;encoding,&nbsp;which&nbsp;originated&nbsp;in&nbsp;Privacy</span><br>
<span class="lineno"></span><span class="comment" id="4437502">//&nbsp;Enhanced&nbsp;Mail.&nbsp;The&nbsp;most&nbsp;common&nbsp;use&nbsp;of&nbsp;PEM&nbsp;encoding&nbsp;today&nbsp;is&nbsp;in&nbsp;TLS&nbsp;keys&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4437581">//&nbsp;certificates.&nbsp;See&nbsp;RFC&nbsp;1421.</span><br>
<span class="lineno"></span><span class="keyword" id="4437612">package</span>&nbsp;<span class="ident" id="4437620">pem</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4437625">import</span>&nbsp;<span class="op" id="4437632">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4437635">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4437644">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4437663">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4437669">&#34;sort&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4437676">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4437679">//&nbsp;A&nbsp;Block&nbsp;represents&nbsp;a&nbsp;PEM&nbsp;encoded&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="4437726">//</span><br>
<span class="lineno"></span><span class="comment" id="4437729">//&nbsp;The&nbsp;encoded&nbsp;form&nbsp;is:</span><br>
<span class="lineno">20</span><span class="comment" id="4437753">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;Type-----</span><br>
<span class="lineno"></span><span class="comment" id="4437780">//&nbsp;&nbsp;&nbsp;&nbsp;Headers</span><br>
<span class="lineno"></span><span class="comment" id="4437794">//&nbsp;&nbsp;&nbsp;&nbsp;base64-encoded&nbsp;Bytes</span><br>
<span class="lineno"></span><span class="comment" id="4437821">//&nbsp;&nbsp;&nbsp;&nbsp;-----END&nbsp;Type-----</span><br>
<span class="lineno"></span><span class="comment" id="4437846">//&nbsp;where&nbsp;Headers&nbsp;is&nbsp;a&nbsp;possibly&nbsp;empty&nbsp;sequence&nbsp;of&nbsp;Key:&nbsp;Value&nbsp;lines.</span><br>
<span class="lineno">25</span><span class="keyword" id="4437913">type</span>&nbsp;<span class="ident" id="4437918">Block</span>&nbsp;<span class="keyword" id="4437924">struct</span>&nbsp;<span class="op" id="4437931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4437934">Type</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4437942">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4437960">//&nbsp;The&nbsp;type,&nbsp;taken&nbsp;from&nbsp;the&nbsp;preamble&nbsp;(i.e.&nbsp;&#34;RSA&nbsp;PRIVATE&nbsp;KEY&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4438024">Headers</span>&nbsp;<span class="keyword" id="4438032">map</span><span class="op" id="4438035">[</span><span class="builtintype" id="4438036">string</span><span class="op" id="4438042">]</span><span class="builtintype" id="4438043">string</span>&nbsp;<span class="comment" id="4438050">//&nbsp;Optional&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4438072">Bytes</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4438080">[</span><span class="op" id="4438081">]</span><span class="builtintype" id="4438082">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4438098">//&nbsp;The&nbsp;decoded&nbsp;bytes&nbsp;of&nbsp;the&nbsp;contents.&nbsp;Typically&nbsp;a&nbsp;DER&nbsp;encoded&nbsp;ASN.1&nbsp;structure.</span><br>
<span class="lineno"></span><span class="op" id="4438177">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="4438180">//&nbsp;getLine&nbsp;results&nbsp;the&nbsp;first&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;delineated&nbsp;line&nbsp;from&nbsp;the&nbsp;given&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="4438256">//&nbsp;array.&nbsp;The&nbsp;line&nbsp;does&nbsp;not&nbsp;include&nbsp;trailing&nbsp;whitespace&nbsp;or&nbsp;the&nbsp;trailing&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="4438332">//&nbsp;line&nbsp;bytes.&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;byte&nbsp;array&nbsp;(also&nbsp;not&nbsp;including&nbsp;the&nbsp;new&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4438412">//&nbsp;bytes)&nbsp;is&nbsp;also&nbsp;returned&nbsp;and&nbsp;this&nbsp;will&nbsp;always&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;original</span><br>
<span class="lineno">35</span><span class="comment" id="4438489">//&nbsp;argument.</span><br>
<span class="lineno"></span><span class="keyword" id="4438502">func</span>&nbsp;<span class="ident" id="4438507">getLine</span><span class="op" id="4438514">(</span><span class="ident" id="4438515">data</span>&nbsp;<span class="op" id="4438520">[</span><span class="op" id="4438521">]</span><span class="builtintype" id="4438522">byte</span><span class="op" id="4438526">)</span>&nbsp;<span class="op" id="4438528">(</span><span class="ident" id="4438529">line</span><span class="op" id="4438533">,</span>&nbsp;<span class="ident" id="4438535">rest</span>&nbsp;<span class="op" id="4438540">[</span><span class="op" id="4438541">]</span><span class="builtintype" id="4438542">byte</span><span class="op" id="4438546">)</span>&nbsp;<span class="op" id="4438548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4438551">i</span>&nbsp;<span class="op" id="4438553">:=</span>&nbsp;<span class="ident" id="4438556">bytes</span><span class="op" id="4438561">.</span><span class="ident" id="4438562">Index</span><span class="op" id="4438567">(</span><span class="ident" id="4438568">data</span><span class="op" id="4438572">,</span>&nbsp;<span class="op" id="4438574">[</span><span class="op" id="4438575">]</span><span class="builtintype" id="4438576">byte</span><span class="op" id="4438580">{</span><span class="string" id="4438581">&#39;\n&#39;</span><span class="op" id="4438585">}</span><span class="op" id="4438586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4438589">var</span>&nbsp;<span class="ident" id="4438593">j</span>&nbsp;<span class="builtintype" id="4438595">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4438600">if</span>&nbsp;<span class="ident" id="4438603">i</span>&nbsp;<span class="op" id="4438605">&lt;</span>&nbsp;<span class="num" id="4438607">0</span>&nbsp;<span class="op" id="4438609">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4438613">i</span>&nbsp;<span class="op" id="4438615">=</span>&nbsp;<span class="builtinfunc" id="4438617">len</span><span class="op" id="4438620">(</span><span class="ident" id="4438621">data</span><span class="op" id="4438625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4438629">j</span>&nbsp;<span class="op" id="4438631">=</span>&nbsp;<span class="ident" id="4438633">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4438636">}</span>&nbsp;<span class="keyword" id="4438638">else</span>&nbsp;<span class="op" id="4438643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4438647">j</span>&nbsp;<span class="op" id="4438649">=</span>&nbsp;<span class="ident" id="4438651">i</span>&nbsp;<span class="op" id="4438653">+</span>&nbsp;<span class="num" id="4438655">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4438659">if</span>&nbsp;<span class="ident" id="4438662">i</span>&nbsp;<span class="op" id="4438664">&gt;</span>&nbsp;<span class="num" id="4438666">0</span>&nbsp;<span class="op" id="4438668">&amp;&amp;</span>&nbsp;<span class="ident" id="4438671">data</span><span class="op" id="4438675">[</span><span class="ident" id="4438676">i</span><span class="op" id="4438677">-</span><span class="num" id="4438678">1</span><span class="op" id="4438679">]</span>&nbsp;<span class="op" id="4438681">==</span>&nbsp;<span class="string" id="4438684">&#39;\r&#39;</span>&nbsp;<span class="op" id="4438689">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4438694">i</span><span class="op" id="4438695">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4438700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4438703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4438706">return</span>&nbsp;<span class="ident" id="4438713">bytes</span><span class="op" id="4438718">.</span><span class="ident" id="4438719">TrimRight</span><span class="op" id="4438728">(</span><span class="ident" id="4438729">data</span><span class="op" id="4438733">[</span><span class="num" id="4438734">0</span><span class="op" id="4438735">:</span><span class="ident" id="4438736">i</span><span class="op" id="4438737">]</span><span class="op" id="4438738">,</span>&nbsp;<span class="string" id="4438740">&#34;&nbsp;\t&#34;</span><span class="op" id="4438745">)</span><span class="op" id="4438746">,</span>&nbsp;<span class="ident" id="4438748">data</span><span class="op" id="4438752">[</span><span class="ident" id="4438753">j</span><span class="op" id="4438754">:</span><span class="op" id="4438755">]</span><br>
<span class="lineno"></span><span class="op" id="4438757">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4438760">//&nbsp;removeWhitespace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;its&nbsp;input&nbsp;with&nbsp;all&nbsp;spaces,&nbsp;tab&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4438833">//&nbsp;newline&nbsp;characters&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="4438864">func</span>&nbsp;<span class="ident" id="4438869">removeWhitespace</span><span class="op" id="4438885">(</span><span class="ident" id="4438886">data</span>&nbsp;<span class="op" id="4438891">[</span><span class="op" id="4438892">]</span><span class="builtintype" id="4438893">byte</span><span class="op" id="4438897">)</span>&nbsp;<span class="op" id="4438899">[</span><span class="op" id="4438900">]</span><span class="builtintype" id="4438901">byte</span>&nbsp;<span class="op" id="4438906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4438909">result</span>&nbsp;<span class="op" id="4438916">:=</span>&nbsp;<span class="builtinfunc" id="4438919">make</span><span class="op" id="4438923">(</span><span class="op" id="4438924">[</span><span class="op" id="4438925">]</span><span class="builtintype" id="4438926">byte</span><span class="op" id="4438930">,</span>&nbsp;<span class="builtinfunc" id="4438932">len</span><span class="op" id="4438935">(</span><span class="ident" id="4438936">data</span><span class="op" id="4438940">)</span><span class="op" id="4438941">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4438944">n</span>&nbsp;<span class="op" id="4438946">:=</span>&nbsp;<span class="num" id="4438949">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4438953">for</span>&nbsp;<span class="ident" id="4438957">_</span><span class="op" id="4438958">,</span>&nbsp;<span class="ident" id="4438960">b</span>&nbsp;<span class="op" id="4438962">:=</span>&nbsp;<span class="keyword" id="4438965">range</span>&nbsp;<span class="ident" id="4438971">data</span>&nbsp;<span class="op" id="4438976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4438980">if</span>&nbsp;<span class="ident" id="4438983">b</span>&nbsp;<span class="op" id="4438985">==</span>&nbsp;<span class="string" id="4438988">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4438992">||</span>&nbsp;<span class="ident" id="4438995">b</span>&nbsp;<span class="op" id="4438997">==</span>&nbsp;<span class="string" id="4439000">&#39;\t&#39;</span>&nbsp;<span class="op" id="4439005">||</span>&nbsp;<span class="ident" id="4439008">b</span>&nbsp;<span class="op" id="4439010">==</span>&nbsp;<span class="string" id="4439013">&#39;\r&#39;</span>&nbsp;<span class="op" id="4439018">||</span>&nbsp;<span class="ident" id="4439021">b</span>&nbsp;<span class="op" id="4439023">==</span>&nbsp;<span class="string" id="4439026">&#39;\n&#39;</span>&nbsp;<span class="op" id="4439031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4439036">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4439047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4439051">result</span><span class="op" id="4439057">[</span><span class="ident" id="4439058">n</span><span class="op" id="4439059">]</span>&nbsp;<span class="op" id="4439061">=</span>&nbsp;<span class="ident" id="4439063">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4439067">n</span><span class="op" id="4439068">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4439072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4439076">return</span>&nbsp;<span class="ident" id="4439083">result</span><span class="op" id="4439089">[</span><span class="num" id="4439090">0</span><span class="op" id="4439091">:</span><span class="ident" id="4439092">n</span><span class="op" id="4439093">]</span><br>
<span class="lineno"></span><span class="op" id="4439095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4439098">var</span>&nbsp;<span class="ident" id="4439102">pemStart</span>&nbsp;<span class="op" id="4439111">=</span>&nbsp;<span class="op" id="4439113">[</span><span class="op" id="4439114">]</span><span class="builtintype" id="4439115">byte</span><span class="op" id="4439119">(</span><span class="string" id="4439120">&#34;\n-----BEGIN&nbsp;&#34;</span><span class="op" id="4439135">)</span><br>
<span class="lineno"></span><span class="keyword" id="4439137">var</span>&nbsp;<span class="ident" id="4439141">pemEnd</span>&nbsp;<span class="op" id="4439148">=</span>&nbsp;<span class="op" id="4439150">[</span><span class="op" id="4439151">]</span><span class="builtintype" id="4439152">byte</span><span class="op" id="4439156">(</span><span class="string" id="4439157">&#34;\n-----END&nbsp;&#34;</span><span class="op" id="4439170">)</span><br>
<span class="lineno">70</span><span class="keyword" id="4439172">var</span>&nbsp;<span class="ident" id="4439176">pemEndOfLine</span>&nbsp;<span class="op" id="4439189">=</span>&nbsp;<span class="op" id="4439191">[</span><span class="op" id="4439192">]</span><span class="builtintype" id="4439193">byte</span><span class="op" id="4439197">(</span><span class="string" id="4439198">&#34;-----&#34;</span><span class="op" id="4439205">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4439208">//&nbsp;Decode&nbsp;will&nbsp;find&nbsp;the&nbsp;next&nbsp;PEM&nbsp;formatted&nbsp;block&nbsp;(certificate,&nbsp;private&nbsp;key</span><br>
<span class="lineno"></span><span class="comment" id="4439283">//&nbsp;etc)&nbsp;in&nbsp;the&nbsp;input.&nbsp;It&nbsp;returns&nbsp;that&nbsp;block&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;input.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="4439362">//&nbsp;no&nbsp;PEM&nbsp;data&nbsp;is&nbsp;found,&nbsp;p&nbsp;is&nbsp;nil&nbsp;and&nbsp;the&nbsp;whole&nbsp;of&nbsp;the&nbsp;input&nbsp;is&nbsp;returned&nbsp;in</span><br>
<span class="lineno">75</span><span class="comment" id="4439438">//&nbsp;rest.</span><br>
<span class="lineno"></span><span class="keyword" id="4439447">func</span>&nbsp;<span class="ident" id="4439452">Decode</span><span class="op" id="4439458">(</span><span class="ident" id="4439459">data</span>&nbsp;<span class="op" id="4439464">[</span><span class="op" id="4439465">]</span><span class="builtintype" id="4439466">byte</span><span class="op" id="4439470">)</span>&nbsp;<span class="op" id="4439472">(</span><span class="ident" id="4439473">p</span>&nbsp;<span class="op" id="4439475">*</span><span class="ident" id="4439476">Block</span><span class="op" id="4439481">,</span>&nbsp;<span class="ident" id="4439483">rest</span>&nbsp;<span class="op" id="4439488">[</span><span class="op" id="4439489">]</span><span class="builtintype" id="4439490">byte</span><span class="op" id="4439494">)</span>&nbsp;<span class="op" id="4439496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4439499">//&nbsp;pemStart&nbsp;begins&nbsp;with&nbsp;a&nbsp;newline.&nbsp;However,&nbsp;at&nbsp;the&nbsp;very&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4439569">//&nbsp;the&nbsp;byte&nbsp;array,&nbsp;we&#39;ll&nbsp;accept&nbsp;the&nbsp;start&nbsp;string&nbsp;without&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4439631">rest</span>&nbsp;<span class="op" id="4439636">=</span>&nbsp;<span class="ident" id="4439638">data</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4439644">if</span>&nbsp;<span class="ident" id="4439647">bytes</span><span class="op" id="4439652">.</span><span class="ident" id="4439653">HasPrefix</span><span class="op" id="4439662">(</span><span class="ident" id="4439663">data</span><span class="op" id="4439667">,</span>&nbsp;<span class="ident" id="4439669">pemStart</span><span class="op" id="4439677">[</span><span class="num" id="4439678">1</span><span class="op" id="4439679">:</span><span class="op" id="4439680">]</span><span class="op" id="4439681">)</span>&nbsp;<span class="op" id="4439683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4439687">rest</span>&nbsp;<span class="op" id="4439692">=</span>&nbsp;<span class="ident" id="4439694">rest</span><span class="op" id="4439698">[</span><span class="builtinfunc" id="4439699">len</span><span class="op" id="4439702">(</span><span class="ident" id="4439703">pemStart</span><span class="op" id="4439711">)</span><span class="op" id="4439712">-</span><span class="num" id="4439713">1</span>&nbsp;<span class="op" id="4439715">:</span>&nbsp;<span class="builtinfunc" id="4439717">len</span><span class="op" id="4439720">(</span><span class="ident" id="4439721">data</span><span class="op" id="4439725">)</span><span class="op" id="4439726">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4439729">}</span>&nbsp;<span class="keyword" id="4439731">else</span>&nbsp;<span class="keyword" id="4439736">if</span>&nbsp;<span class="ident" id="4439739">i</span>&nbsp;<span class="op" id="4439741">:=</span>&nbsp;<span class="ident" id="4439744">bytes</span><span class="op" id="4439749">.</span><span class="ident" id="4439750">Index</span><span class="op" id="4439755">(</span><span class="ident" id="4439756">data</span><span class="op" id="4439760">,</span>&nbsp;<span class="ident" id="4439762">pemStart</span><span class="op" id="4439770">)</span><span class="op" id="4439771">;</span>&nbsp;<span class="ident" id="4439773">i</span>&nbsp;<span class="op" id="4439775">&gt;=</span>&nbsp;<span class="num" id="4439778">0</span>&nbsp;<span class="op" id="4439780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4439784">rest</span>&nbsp;<span class="op" id="4439789">=</span>&nbsp;<span class="ident" id="4439791">rest</span><span class="op" id="4439795">[</span><span class="ident" id="4439796">i</span><span class="op" id="4439797">+</span><span class="builtinfunc" id="4439798">len</span><span class="op" id="4439801">(</span><span class="ident" id="4439802">pemStart</span><span class="op" id="4439810">)</span>&nbsp;<span class="op" id="4439812">:</span>&nbsp;<span class="builtinfunc" id="4439814">len</span><span class="op" id="4439817">(</span><span class="ident" id="4439818">data</span><span class="op" id="4439822">)</span><span class="op" id="4439823">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4439826">}</span>&nbsp;<span class="keyword" id="4439828">else</span>&nbsp;<span class="op" id="4439833">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4439837">return</span>&nbsp;<span class="builtintype" id="4439844">nil</span><span class="op" id="4439847">,</span>&nbsp;<span class="ident" id="4439849">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4439855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4439859">typeLine</span><span class="op" id="4439867">,</span>&nbsp;<span class="ident" id="4439869">rest</span>&nbsp;<span class="op" id="4439874">:=</span>&nbsp;<span class="ident" id="4439877">getLine</span><span class="op" id="4439884">(</span><span class="ident" id="4439885">rest</span><span class="op" id="4439889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4439892">if</span>&nbsp;<span class="op" id="4439895">!</span><span class="ident" id="4439896">bytes</span><span class="op" id="4439901">.</span><span class="ident" id="4439902">HasSuffix</span><span class="op" id="4439911">(</span><span class="ident" id="4439912">typeLine</span><span class="op" id="4439920">,</span>&nbsp;<span class="ident" id="4439922">pemEndOfLine</span><span class="op" id="4439934">)</span>&nbsp;<span class="op" id="4439936">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4439940">return</span>&nbsp;<span class="ident" id="4439947">decodeError</span><span class="op" id="4439958">(</span><span class="ident" id="4439959">data</span><span class="op" id="4439963">,</span>&nbsp;<span class="ident" id="4439965">rest</span><span class="op" id="4439969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4439972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4439975">typeLine</span>&nbsp;<span class="op" id="4439984">=</span>&nbsp;<span class="ident" id="4439986">typeLine</span><span class="op" id="4439994">[</span><span class="num" id="4439995">0</span>&nbsp;<span class="op" id="4439997">:</span>&nbsp;<span class="builtinfunc" id="4439999">len</span><span class="op" id="4440002">(</span><span class="ident" id="4440003">typeLine</span><span class="op" id="4440011">)</span><span class="op" id="4440012">-</span><span class="builtinfunc" id="4440013">len</span><span class="op" id="4440016">(</span><span class="ident" id="4440017">pemEndOfLine</span><span class="op" id="4440029">)</span><span class="op" id="4440030">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4440034">p</span>&nbsp;<span class="op" id="4440036">=</span>&nbsp;<span class="op" id="4440038">&amp;</span><span class="ident" id="4440039">Block</span><span class="op" id="4440044">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4440048">Headers</span><span class="op" id="4440055">:</span>&nbsp;<span class="builtinfunc" id="4440057">make</span><span class="op" id="4440061">(</span><span class="keyword" id="4440062">map</span><span class="op" id="4440065">[</span><span class="builtintype" id="4440066">string</span><span class="op" id="4440072">]</span><span class="builtintype" id="4440073">string</span><span class="op" id="4440079">)</span><span class="op" id="4440080">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4440084">Type</span><span class="op" id="4440088">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4440093">string</span><span class="op" id="4440099">(</span><span class="ident" id="4440100">typeLine</span><span class="op" id="4440108">)</span><span class="op" id="4440109">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4440112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4440116">for</span>&nbsp;<span class="op" id="4440120">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4440124">//&nbsp;This&nbsp;loop&nbsp;terminates&nbsp;because&nbsp;getLine&#39;s&nbsp;second&nbsp;result&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4440185">//&nbsp;always&nbsp;smaller&nbsp;than&nbsp;its&nbsp;argument.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4440224">if</span>&nbsp;<span class="builtinfunc" id="4440227">len</span><span class="op" id="4440230">(</span><span class="ident" id="4440231">rest</span><span class="op" id="4440235">)</span>&nbsp;<span class="op" id="4440237">==</span>&nbsp;<span class="num" id="4440240">0</span>&nbsp;<span class="op" id="4440242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4440247">return</span>&nbsp;<span class="builtintype" id="4440254">nil</span><span class="op" id="4440257">,</span>&nbsp;<span class="ident" id="4440259">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4440266">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4440270">line</span><span class="op" id="4440274">,</span>&nbsp;<span class="ident" id="4440276">next</span>&nbsp;<span class="op" id="4440281">:=</span>&nbsp;<span class="ident" id="4440284">getLine</span><span class="op" id="4440291">(</span><span class="ident" id="4440292">rest</span><span class="op" id="4440296">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4440301">i</span>&nbsp;<span class="op" id="4440303">:=</span>&nbsp;<span class="ident" id="4440306">bytes</span><span class="op" id="4440311">.</span><span class="ident" id="4440312">Index</span><span class="op" id="4440317">(</span><span class="ident" id="4440318">line</span><span class="op" id="4440322">,</span>&nbsp;<span class="op" id="4440324">[</span><span class="op" id="4440325">]</span><span class="builtintype" id="4440326">byte</span><span class="op" id="4440330">{</span><span class="string" id="4440331">&#39;:&#39;</span><span class="op" id="4440334">}</span><span class="op" id="4440335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4440339">if</span>&nbsp;<span class="ident" id="4440342">i</span>&nbsp;<span class="op" id="4440344">==</span>&nbsp;<span class="op" id="4440347">-</span><span class="num" id="4440348">1</span>&nbsp;<span class="op" id="4440350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4440355">break</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4440363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4440368">//&nbsp;TODO(agl):&nbsp;need&nbsp;to&nbsp;cope&nbsp;with&nbsp;values&nbsp;that&nbsp;spread&nbsp;across&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4440435">key</span><span class="op" id="4440438">,</span>&nbsp;<span class="ident" id="4440440">val</span>&nbsp;<span class="op" id="4440444">:=</span>&nbsp;<span class="ident" id="4440447">line</span><span class="op" id="4440451">[</span><span class="num" id="4440452">0</span><span class="op" id="4440453">:</span><span class="ident" id="4440454">i</span><span class="op" id="4440455">]</span><span class="op" id="4440456">,</span>&nbsp;<span class="ident" id="4440458">line</span><span class="op" id="4440462">[</span><span class="ident" id="4440463">i</span><span class="op" id="4440464">+</span><span class="num" id="4440465">1</span><span class="op" id="4440466">:</span><span class="op" id="4440467">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4440471">key</span>&nbsp;<span class="op" id="4440475">=</span>&nbsp;<span class="ident" id="4440477">bytes</span><span class="op" id="4440482">.</span><span class="ident" id="4440483">TrimSpace</span><span class="op" id="4440492">(</span><span class="ident" id="4440493">key</span><span class="op" id="4440496">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4440500">val</span>&nbsp;<span class="op" id="4440504">=</span>&nbsp;<span class="ident" id="4440506">bytes</span><span class="op" id="4440511">.</span><span class="ident" id="4440512">TrimSpace</span><span class="op" id="4440521">(</span><span class="ident" id="4440522">val</span><span class="op" id="4440525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4440529">p</span><span class="op" id="4440530">.</span><span class="ident" id="4440531">Headers</span><span class="op" id="4440538">[</span><span class="builtintype" id="4440539">string</span><span class="op" id="4440545">(</span><span class="ident" id="4440546">key</span><span class="op" id="4440549">)</span><span class="op" id="4440550">]</span>&nbsp;<span class="op" id="4440552">=</span>&nbsp;<span class="builtintype" id="4440554">string</span><span class="op" id="4440560">(</span><span class="ident" id="4440561">val</span><span class="op" id="4440564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4440568">rest</span>&nbsp;<span class="op" id="4440573">=</span>&nbsp;<span class="ident" id="4440575">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4440581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4440585">i</span>&nbsp;<span class="op" id="4440587">:=</span>&nbsp;<span class="ident" id="4440590">bytes</span><span class="op" id="4440595">.</span><span class="ident" id="4440596">Index</span><span class="op" id="4440601">(</span><span class="ident" id="4440602">rest</span><span class="op" id="4440606">,</span>&nbsp;<span class="ident" id="4440608">pemEnd</span><span class="op" id="4440614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4440617">if</span>&nbsp;<span class="ident" id="4440620">i</span>&nbsp;<span class="op" id="4440622">&lt;</span>&nbsp;<span class="num" id="4440624">0</span>&nbsp;<span class="op" id="4440626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4440630">return</span>&nbsp;<span class="ident" id="4440637">decodeError</span><span class="op" id="4440648">(</span><span class="ident" id="4440649">data</span><span class="op" id="4440653">,</span>&nbsp;<span class="ident" id="4440655">rest</span><span class="op" id="4440659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4440662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4440665">base64Data</span>&nbsp;<span class="op" id="4440676">:=</span>&nbsp;<span class="ident" id="4440679">removeWhitespace</span><span class="op" id="4440695">(</span><span class="ident" id="4440696">rest</span><span class="op" id="4440700">[</span><span class="num" id="4440701">0</span><span class="op" id="4440702">:</span><span class="ident" id="4440703">i</span><span class="op" id="4440704">]</span><span class="op" id="4440705">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4440709">p</span><span class="op" id="4440710">.</span><span class="ident" id="4440711">Bytes</span>&nbsp;<span class="op" id="4440717">=</span>&nbsp;<span class="builtinfunc" id="4440719">make</span><span class="op" id="4440723">(</span><span class="op" id="4440724">[</span><span class="op" id="4440725">]</span><span class="builtintype" id="4440726">byte</span><span class="op" id="4440730">,</span>&nbsp;<span class="ident" id="4440732">base64</span><span class="op" id="4440738">.</span><span class="ident" id="4440739">StdEncoding</span><span class="op" id="4440750">.</span><span class="ident" id="4440751">DecodedLen</span><span class="op" id="4440761">(</span><span class="builtinfunc" id="4440762">len</span><span class="op" id="4440765">(</span><span class="ident" id="4440766">base64Data</span><span class="op" id="4440776">)</span><span class="op" id="4440777">)</span><span class="op" id="4440778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4440781">n</span><span class="op" id="4440782">,</span>&nbsp;<span class="ident" id="4440784">err</span>&nbsp;<span class="op" id="4440788">:=</span>&nbsp;<span class="ident" id="4440791">base64</span><span class="op" id="4440797">.</span><span class="ident" id="4440798">StdEncoding</span><span class="op" id="4440809">.</span><span class="ident" id="4440810">Decode</span><span class="op" id="4440816">(</span><span class="ident" id="4440817">p</span><span class="op" id="4440818">.</span><span class="ident" id="4440819">Bytes</span><span class="op" id="4440824">,</span>&nbsp;<span class="ident" id="4440826">base64Data</span><span class="op" id="4440836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4440839">if</span>&nbsp;<span class="ident" id="4440842">err</span>&nbsp;<span class="op" id="4440846">!=</span>&nbsp;<span class="builtintype" id="4440849">nil</span>&nbsp;<span class="op" id="4440853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4440857">return</span>&nbsp;<span class="ident" id="4440864">decodeError</span><span class="op" id="4440875">(</span><span class="ident" id="4440876">data</span><span class="op" id="4440880">,</span>&nbsp;<span class="ident" id="4440882">rest</span><span class="op" id="4440886">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4440889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4440892">p</span><span class="op" id="4440893">.</span><span class="ident" id="4440894">Bytes</span>&nbsp;<span class="op" id="4440900">=</span>&nbsp;<span class="ident" id="4440902">p</span><span class="op" id="4440903">.</span><span class="ident" id="4440904">Bytes</span><span class="op" id="4440909">[</span><span class="num" id="4440910">0</span><span class="op" id="4440911">:</span><span class="ident" id="4440912">n</span><span class="op" id="4440913">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4440917">_</span><span class="op" id="4440918">,</span>&nbsp;<span class="ident" id="4440920">rest</span>&nbsp;<span class="op" id="4440925">=</span>&nbsp;<span class="ident" id="4440927">getLine</span><span class="op" id="4440934">(</span><span class="ident" id="4440935">rest</span><span class="op" id="4440939">[</span><span class="ident" id="4440940">i</span><span class="op" id="4440941">+</span><span class="builtinfunc" id="4440942">len</span><span class="op" id="4440945">(</span><span class="ident" id="4440946">pemEnd</span><span class="op" id="4440952">)</span><span class="op" id="4440953">:</span><span class="op" id="4440954">]</span><span class="op" id="4440955">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4440959">return</span><br>
<span class="lineno"></span><span class="op" id="4440966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4440969">func</span>&nbsp;<span class="ident" id="4440974">decodeError</span><span class="op" id="4440985">(</span><span class="ident" id="4440986">data</span><span class="op" id="4440990">,</span>&nbsp;<span class="ident" id="4440992">rest</span>&nbsp;<span class="op" id="4440997">[</span><span class="op" id="4440998">]</span><span class="builtintype" id="4440999">byte</span><span class="op" id="4441003">)</span>&nbsp;<span class="op" id="4441005">(</span><span class="op" id="4441006">*</span><span class="ident" id="4441007">Block</span><span class="op" id="4441012">,</span>&nbsp;<span class="op" id="4441014">[</span><span class="op" id="4441015">]</span><span class="builtintype" id="4441016">byte</span><span class="op" id="4441020">)</span>&nbsp;<span class="op" id="4441022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4441025">//&nbsp;If&nbsp;we&nbsp;get&nbsp;here&nbsp;then&nbsp;we&nbsp;have&nbsp;rejected&nbsp;a&nbsp;likely&nbsp;looking,&nbsp;but</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4441088">//&nbsp;ultimately&nbsp;invalid&nbsp;PEM&nbsp;block.&nbsp;We&nbsp;need&nbsp;to&nbsp;start&nbsp;over&nbsp;from&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4441155">//&nbsp;position.&nbsp;&nbsp;We&nbsp;have&nbsp;consumed&nbsp;the&nbsp;preamble&nbsp;line&nbsp;and&nbsp;will&nbsp;have&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4441228">//&nbsp;any&nbsp;lines&nbsp;which&nbsp;could&nbsp;be&nbsp;header&nbsp;lines.&nbsp;However,&nbsp;a&nbsp;valid&nbsp;preamble</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4441297">//&nbsp;line&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;header&nbsp;line,&nbsp;therefore&nbsp;we&nbsp;cannot&nbsp;have&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4441368">//&nbsp;the&nbsp;preamble&nbsp;line&nbsp;for&nbsp;the&nbsp;any&nbsp;subsequent&nbsp;block.&nbsp;Thus,&nbsp;we&nbsp;will&nbsp;always</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4441441">//&nbsp;find&nbsp;any&nbsp;valid&nbsp;block,&nbsp;no&nbsp;matter&nbsp;what&nbsp;bytes&nbsp;precede&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4441500">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4441504">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;the&nbsp;input&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4441537">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4441541">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;MALFORMED&nbsp;BLOCK-----</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4441580">//&nbsp;&nbsp;&nbsp;&nbsp;junk&nbsp;that&nbsp;may&nbsp;look&nbsp;like&nbsp;header&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4441624">//&nbsp;&nbsp;&nbsp;or&nbsp;data&nbsp;lines,&nbsp;but&nbsp;no&nbsp;END&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4441661">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4441665">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;ACTUAL&nbsp;BLOCK-----</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4441701">//&nbsp;&nbsp;&nbsp;&nbsp;realdata</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4441717">//&nbsp;&nbsp;&nbsp;&nbsp;-----END&nbsp;ACTUAL&nbsp;BLOCK-----</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4441751">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4441755">//&nbsp;we&#39;ve&nbsp;failed&nbsp;to&nbsp;parse&nbsp;using&nbsp;the&nbsp;first&nbsp;BEGIN&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4441808">//&nbsp;and&nbsp;now&nbsp;will&nbsp;try&nbsp;again,&nbsp;using&nbsp;the&nbsp;second&nbsp;BEGIN&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4441865">p</span><span class="op" id="4441866">,</span>&nbsp;<span class="ident" id="4441868">rest</span>&nbsp;<span class="op" id="4441873">:=</span>&nbsp;<span class="ident" id="4441876">Decode</span><span class="op" id="4441882">(</span><span class="ident" id="4441883">rest</span><span class="op" id="4441887">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4441890">if</span>&nbsp;<span class="ident" id="4441893">p</span>&nbsp;<span class="op" id="4441895">==</span>&nbsp;<span class="builtintype" id="4441898">nil</span>&nbsp;<span class="op" id="4441902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4441906">rest</span>&nbsp;<span class="op" id="4441911">=</span>&nbsp;<span class="ident" id="4441913">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4441919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4441922">return</span>&nbsp;<span class="ident" id="4441929">p</span><span class="op" id="4441930">,</span>&nbsp;<span class="ident" id="4441932">rest</span><br>
<span class="lineno"></span><span class="op" id="4441937">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="4441940">const</span>&nbsp;<span class="ident" id="4441946">pemLineLength</span>&nbsp;<span class="op" id="4441960">=</span>&nbsp;<span class="num" id="4441962">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4441966">type</span>&nbsp;<span class="ident" id="4441971">lineBreaker</span>&nbsp;<span class="keyword" id="4441983">struct</span>&nbsp;<span class="op" id="4441990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4441993">line</span>&nbsp;<span class="op" id="4441998">[</span><span class="ident" id="4441999">pemLineLength</span><span class="op" id="4442012">]</span><span class="builtintype" id="4442013">byte</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442019">used</span>&nbsp;<span class="builtintype" id="4442024">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442029">out</span>&nbsp;&nbsp;<span class="ident" id="4442034">io</span><span class="op" id="4442036">.</span><span class="ident" id="4442037">Writer</span><br>
<span class="lineno"></span><span class="op" id="4442044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4442047">func</span>&nbsp;<span class="op" id="4442052">(</span><span class="ident" id="4442053">l</span>&nbsp;<span class="op" id="4442055">*</span><span class="ident" id="4442056">lineBreaker</span><span class="op" id="4442067">)</span>&nbsp;<span class="ident" id="4442069">Write</span><span class="op" id="4442074">(</span><span class="ident" id="4442075">b</span>&nbsp;<span class="op" id="4442077">[</span><span class="op" id="4442078">]</span><span class="builtintype" id="4442079">byte</span><span class="op" id="4442083">)</span>&nbsp;<span class="op" id="4442085">(</span><span class="ident" id="4442086">n</span>&nbsp;<span class="builtintype" id="4442088">int</span><span class="op" id="4442091">,</span>&nbsp;<span class="ident" id="4442093">err</span>&nbsp;<span class="builtintype" id="4442097">error</span><span class="op" id="4442102">)</span>&nbsp;<span class="op" id="4442104">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4442107">if</span>&nbsp;<span class="ident" id="4442110">l</span><span class="op" id="4442111">.</span><span class="ident" id="4442112">used</span><span class="op" id="4442116">+</span><span class="builtinfunc" id="4442117">len</span><span class="op" id="4442120">(</span><span class="ident" id="4442121">b</span><span class="op" id="4442122">)</span>&nbsp;<span class="op" id="4442124">&lt;</span>&nbsp;<span class="ident" id="4442126">pemLineLength</span>&nbsp;<span class="op" id="4442140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4442144">copy</span><span class="op" id="4442148">(</span><span class="ident" id="4442149">l</span><span class="op" id="4442150">.</span><span class="ident" id="4442151">line</span><span class="op" id="4442155">[</span><span class="ident" id="4442156">l</span><span class="op" id="4442157">.</span><span class="ident" id="4442158">used</span><span class="op" id="4442162">:</span><span class="op" id="4442163">]</span><span class="op" id="4442164">,</span>&nbsp;<span class="ident" id="4442166">b</span><span class="op" id="4442167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442171">l</span><span class="op" id="4442172">.</span><span class="ident" id="4442173">used</span>&nbsp;<span class="op" id="4442178">+=</span>&nbsp;<span class="builtinfunc" id="4442181">len</span><span class="op" id="4442184">(</span><span class="ident" id="4442185">b</span><span class="op" id="4442186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4442190">return</span>&nbsp;<span class="builtinfunc" id="4442197">len</span><span class="op" id="4442200">(</span><span class="ident" id="4442201">b</span><span class="op" id="4442202">)</span><span class="op" id="4442203">,</span>&nbsp;<span class="builtintype" id="4442205">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4442210">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442214">n</span><span class="op" id="4442215">,</span>&nbsp;<span class="ident" id="4442217">err</span>&nbsp;<span class="op" id="4442221">=</span>&nbsp;<span class="ident" id="4442223">l</span><span class="op" id="4442224">.</span><span class="ident" id="4442225">out</span><span class="op" id="4442228">.</span><span class="ident" id="4442229">Write</span><span class="op" id="4442234">(</span><span class="ident" id="4442235">l</span><span class="op" id="4442236">.</span><span class="ident" id="4442237">line</span><span class="op" id="4442241">[</span><span class="num" id="4442242">0</span><span class="op" id="4442243">:</span><span class="ident" id="4442244">l</span><span class="op" id="4442245">.</span><span class="ident" id="4442246">used</span><span class="op" id="4442250">]</span><span class="op" id="4442251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4442254">if</span>&nbsp;<span class="ident" id="4442257">err</span>&nbsp;<span class="op" id="4442261">!=</span>&nbsp;<span class="builtintype" id="4442264">nil</span>&nbsp;<span class="op" id="4442268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4442272">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4442280">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442283">excess</span>&nbsp;<span class="op" id="4442290">:=</span>&nbsp;<span class="ident" id="4442293">pemLineLength</span>&nbsp;<span class="op" id="4442307">-</span>&nbsp;<span class="ident" id="4442309">l</span><span class="op" id="4442310">.</span><span class="ident" id="4442311">used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442317">l</span><span class="op" id="4442318">.</span><span class="ident" id="4442319">used</span>&nbsp;<span class="op" id="4442324">=</span>&nbsp;<span class="num" id="4442326">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442330">n</span><span class="op" id="4442331">,</span>&nbsp;<span class="ident" id="4442333">err</span>&nbsp;<span class="op" id="4442337">=</span>&nbsp;<span class="ident" id="4442339">l</span><span class="op" id="4442340">.</span><span class="ident" id="4442341">out</span><span class="op" id="4442344">.</span><span class="ident" id="4442345">Write</span><span class="op" id="4442350">(</span><span class="ident" id="4442351">b</span><span class="op" id="4442352">[</span><span class="num" id="4442353">0</span><span class="op" id="4442354">:</span><span class="ident" id="4442355">excess</span><span class="op" id="4442361">]</span><span class="op" id="4442362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4442365">if</span>&nbsp;<span class="ident" id="4442368">err</span>&nbsp;<span class="op" id="4442372">!=</span>&nbsp;<span class="builtintype" id="4442375">nil</span>&nbsp;<span class="op" id="4442379">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4442383">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4442391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442395">n</span><span class="op" id="4442396">,</span>&nbsp;<span class="ident" id="4442398">err</span>&nbsp;<span class="op" id="4442402">=</span>&nbsp;<span class="ident" id="4442404">l</span><span class="op" id="4442405">.</span><span class="ident" id="4442406">out</span><span class="op" id="4442409">.</span><span class="ident" id="4442410">Write</span><span class="op" id="4442415">(</span><span class="op" id="4442416">[</span><span class="op" id="4442417">]</span><span class="builtintype" id="4442418">byte</span><span class="op" id="4442422">{</span><span class="string" id="4442423">&#39;\n&#39;</span><span class="op" id="4442427">}</span><span class="op" id="4442428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4442431">if</span>&nbsp;<span class="ident" id="4442434">err</span>&nbsp;<span class="op" id="4442438">!=</span>&nbsp;<span class="builtintype" id="4442441">nil</span>&nbsp;<span class="op" id="4442445">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4442449">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4442457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4442461">return</span>&nbsp;<span class="ident" id="4442468">l</span><span class="op" id="4442469">.</span><span class="ident" id="4442470">Write</span><span class="op" id="4442475">(</span><span class="ident" id="4442476">b</span><span class="op" id="4442477">[</span><span class="ident" id="4442478">excess</span><span class="op" id="4442484">:</span><span class="op" id="4442485">]</span><span class="op" id="4442486">)</span><br>
<span class="lineno"></span><span class="op" id="4442488">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="4442491">func</span>&nbsp;<span class="op" id="4442496">(</span><span class="ident" id="4442497">l</span>&nbsp;<span class="op" id="4442499">*</span><span class="ident" id="4442500">lineBreaker</span><span class="op" id="4442511">)</span>&nbsp;<span class="ident" id="4442513">Close</span><span class="op" id="4442518">(</span><span class="op" id="4442519">)</span>&nbsp;<span class="op" id="4442521">(</span><span class="ident" id="4442522">err</span>&nbsp;<span class="builtintype" id="4442526">error</span><span class="op" id="4442531">)</span>&nbsp;<span class="op" id="4442533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4442536">if</span>&nbsp;<span class="ident" id="4442539">l</span><span class="op" id="4442540">.</span><span class="ident" id="4442541">used</span>&nbsp;<span class="op" id="4442546">&gt;</span>&nbsp;<span class="num" id="4442548">0</span>&nbsp;<span class="op" id="4442550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442554">_</span><span class="op" id="4442555">,</span>&nbsp;<span class="ident" id="4442557">err</span>&nbsp;<span class="op" id="4442561">=</span>&nbsp;<span class="ident" id="4442563">l</span><span class="op" id="4442564">.</span><span class="ident" id="4442565">out</span><span class="op" id="4442568">.</span><span class="ident" id="4442569">Write</span><span class="op" id="4442574">(</span><span class="ident" id="4442575">l</span><span class="op" id="4442576">.</span><span class="ident" id="4442577">line</span><span class="op" id="4442581">[</span><span class="num" id="4442582">0</span><span class="op" id="4442583">:</span><span class="ident" id="4442584">l</span><span class="op" id="4442585">.</span><span class="ident" id="4442586">used</span><span class="op" id="4442590">]</span><span class="op" id="4442591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4442595">if</span>&nbsp;<span class="ident" id="4442598">err</span>&nbsp;<span class="op" id="4442602">!=</span>&nbsp;<span class="builtintype" id="4442605">nil</span>&nbsp;<span class="op" id="4442609">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4442614">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4442623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442627">_</span><span class="op" id="4442628">,</span>&nbsp;<span class="ident" id="4442630">err</span>&nbsp;<span class="op" id="4442634">=</span>&nbsp;<span class="ident" id="4442636">l</span><span class="op" id="4442637">.</span><span class="ident" id="4442638">out</span><span class="op" id="4442641">.</span><span class="ident" id="4442642">Write</span><span class="op" id="4442647">(</span><span class="op" id="4442648">[</span><span class="op" id="4442649">]</span><span class="builtintype" id="4442650">byte</span><span class="op" id="4442654">{</span><span class="string" id="4442655">&#39;\n&#39;</span><span class="op" id="4442659">}</span><span class="op" id="4442660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4442663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4442667">return</span><br>
<span class="lineno"></span><span class="op" id="4442674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4442677">func</span>&nbsp;<span class="ident" id="4442682">writeHeader</span><span class="op" id="4442693">(</span><span class="ident" id="4442694">out</span>&nbsp;<span class="ident" id="4442698">io</span><span class="op" id="4442700">.</span><span class="ident" id="4442701">Writer</span><span class="op" id="4442707">,</span>&nbsp;<span class="ident" id="4442709">k</span><span class="op" id="4442710">,</span>&nbsp;<span class="ident" id="4442712">v</span>&nbsp;<span class="builtintype" id="4442714">string</span><span class="op" id="4442720">)</span>&nbsp;<span class="builtintype" id="4442722">error</span>&nbsp;<span class="op" id="4442728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442731">_</span><span class="op" id="4442732">,</span>&nbsp;<span class="ident" id="4442734">err</span>&nbsp;<span class="op" id="4442738">:=</span>&nbsp;<span class="ident" id="4442741">out</span><span class="op" id="4442744">.</span><span class="ident" id="4442745">Write</span><span class="op" id="4442750">(</span><span class="op" id="4442751">[</span><span class="op" id="4442752">]</span><span class="builtintype" id="4442753">byte</span><span class="op" id="4442757">(</span><span class="ident" id="4442758">k</span>&nbsp;<span class="op" id="4442760">+</span>&nbsp;<span class="string" id="4442762">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4442767">+</span>&nbsp;<span class="ident" id="4442769">v</span>&nbsp;<span class="op" id="4442771">+</span>&nbsp;<span class="string" id="4442773">&#34;\n&#34;</span><span class="op" id="4442777">)</span><span class="op" id="4442778">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4442781">return</span>&nbsp;<span class="ident" id="4442788">err</span><br>
<span class="lineno"></span><span class="op" id="4442792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4442795">func</span>&nbsp;<span class="ident" id="4442800">Encode</span><span class="op" id="4442806">(</span><span class="ident" id="4442807">out</span>&nbsp;<span class="ident" id="4442811">io</span><span class="op" id="4442813">.</span><span class="ident" id="4442814">Writer</span><span class="op" id="4442820">,</span>&nbsp;<span class="ident" id="4442822">b</span>&nbsp;<span class="op" id="4442824">*</span><span class="ident" id="4442825">Block</span><span class="op" id="4442830">)</span>&nbsp;<span class="builtintype" id="4442832">error</span>&nbsp;<span class="op" id="4442838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4442841">if</span>&nbsp;<span class="ident" id="4442844">_</span><span class="op" id="4442845">,</span>&nbsp;<span class="ident" id="4442847">err</span>&nbsp;<span class="op" id="4442851">:=</span>&nbsp;<span class="ident" id="4442854">out</span><span class="op" id="4442857">.</span><span class="ident" id="4442858">Write</span><span class="op" id="4442863">(</span><span class="ident" id="4442864">pemStart</span><span class="op" id="4442872">[</span><span class="num" id="4442873">1</span><span class="op" id="4442874">:</span><span class="op" id="4442875">]</span><span class="op" id="4442876">)</span><span class="op" id="4442877">;</span>&nbsp;<span class="ident" id="4442879">err</span>&nbsp;<span class="op" id="4442883">!=</span>&nbsp;<span class="builtintype" id="4442886">nil</span>&nbsp;<span class="op" id="4442890">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4442894">return</span>&nbsp;<span class="ident" id="4442901">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4442906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4442909">if</span>&nbsp;<span class="ident" id="4442912">_</span><span class="op" id="4442913">,</span>&nbsp;<span class="ident" id="4442915">err</span>&nbsp;<span class="op" id="4442919">:=</span>&nbsp;<span class="ident" id="4442922">out</span><span class="op" id="4442925">.</span><span class="ident" id="4442926">Write</span><span class="op" id="4442931">(</span><span class="op" id="4442932">[</span><span class="op" id="4442933">]</span><span class="builtintype" id="4442934">byte</span><span class="op" id="4442938">(</span><span class="ident" id="4442939">b</span><span class="op" id="4442940">.</span><span class="ident" id="4442941">Type</span>&nbsp;<span class="op" id="4442946">+</span>&nbsp;<span class="string" id="4442948">&#34;-----\n&#34;</span><span class="op" id="4442957">)</span><span class="op" id="4442958">)</span><span class="op" id="4442959">;</span>&nbsp;<span class="ident" id="4442961">err</span>&nbsp;<span class="op" id="4442965">!=</span>&nbsp;<span class="builtintype" id="4442968">nil</span>&nbsp;<span class="op" id="4442972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4442976">return</span>&nbsp;<span class="ident" id="4442983">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4442988">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4442992">if</span>&nbsp;<span class="builtinfunc" id="4442995">len</span><span class="op" id="4442998">(</span><span class="ident" id="4442999">b</span><span class="op" id="4443000">.</span><span class="ident" id="4443001">Headers</span><span class="op" id="4443008">)</span>&nbsp;<span class="op" id="4443010">&gt;</span>&nbsp;<span class="num" id="4443012">0</span>&nbsp;<span class="op" id="4443014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4443018">const</span>&nbsp;<span class="ident" id="4443024">procType</span>&nbsp;<span class="op" id="4443033">=</span>&nbsp;<span class="string" id="4443035">&#34;Proc-Type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443049">h</span>&nbsp;<span class="op" id="4443051">:=</span>&nbsp;<span class="builtinfunc" id="4443054">make</span><span class="op" id="4443058">(</span><span class="op" id="4443059">[</span><span class="op" id="4443060">]</span><span class="builtintype" id="4443061">string</span><span class="op" id="4443067">,</span>&nbsp;<span class="num" id="4443069">0</span><span class="op" id="4443070">,</span>&nbsp;<span class="builtinfunc" id="4443072">len</span><span class="op" id="4443075">(</span><span class="ident" id="4443076">b</span><span class="op" id="4443077">.</span><span class="ident" id="4443078">Headers</span><span class="op" id="4443085">)</span><span class="op" id="4443086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443090">hasProcType</span>&nbsp;<span class="op" id="4443102">:=</span>&nbsp;<span class="builtintype" id="4443105">false</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4443113">for</span>&nbsp;<span class="ident" id="4443117">k</span>&nbsp;<span class="op" id="4443119">:=</span>&nbsp;<span class="keyword" id="4443122">range</span>&nbsp;<span class="ident" id="4443128">b</span><span class="op" id="4443129">.</span><span class="ident" id="4443130">Headers</span>&nbsp;<span class="op" id="4443138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4443143">if</span>&nbsp;<span class="ident" id="4443146">k</span>&nbsp;<span class="op" id="4443148">==</span>&nbsp;<span class="ident" id="4443151">procType</span>&nbsp;<span class="op" id="4443160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443166">hasProcType</span>&nbsp;<span class="op" id="4443178">=</span>&nbsp;<span class="builtintype" id="4443180">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4443189">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4443201">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443206">h</span>&nbsp;<span class="op" id="4443208">=</span>&nbsp;<span class="builtinfunc" id="4443210">append</span><span class="op" id="4443216">(</span><span class="ident" id="4443217">h</span><span class="op" id="4443218">,</span>&nbsp;<span class="ident" id="4443220">k</span><span class="op" id="4443221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4443225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4443229">//&nbsp;The&nbsp;Proc-Type&nbsp;header&nbsp;must&nbsp;be&nbsp;written&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4443278">//&nbsp;See&nbsp;RFC&nbsp;1421,&nbsp;section&nbsp;4.6.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4443313">if</span>&nbsp;<span class="ident" id="4443316">hasProcType</span>&nbsp;<span class="op" id="4443328">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4443333">if</span>&nbsp;<span class="ident" id="4443336">err</span>&nbsp;<span class="op" id="4443340">:=</span>&nbsp;<span class="ident" id="4443343">writeHeader</span><span class="op" id="4443354">(</span><span class="ident" id="4443355">out</span><span class="op" id="4443358">,</span>&nbsp;<span class="ident" id="4443360">procType</span><span class="op" id="4443368">,</span>&nbsp;<span class="ident" id="4443370">b</span><span class="op" id="4443371">.</span><span class="ident" id="4443372">Headers</span><span class="op" id="4443379">[</span><span class="ident" id="4443380">procType</span><span class="op" id="4443388">]</span><span class="op" id="4443389">)</span><span class="op" id="4443390">;</span>&nbsp;<span class="ident" id="4443392">err</span>&nbsp;<span class="op" id="4443396">!=</span>&nbsp;<span class="builtintype" id="4443399">nil</span>&nbsp;<span class="op" id="4443403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4443409">return</span>&nbsp;<span class="ident" id="4443416">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4443423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4443427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4443431">//&nbsp;For&nbsp;consistency&nbsp;of&nbsp;output,&nbsp;write&nbsp;other&nbsp;headers&nbsp;sorted&nbsp;by&nbsp;key.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443498">sort</span><span class="op" id="4443502">.</span><span class="ident" id="4443503">Strings</span><span class="op" id="4443510">(</span><span class="ident" id="4443511">h</span><span class="op" id="4443512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4443516">for</span>&nbsp;<span class="ident" id="4443520">_</span><span class="op" id="4443521">,</span>&nbsp;<span class="ident" id="4443523">k</span>&nbsp;<span class="op" id="4443525">:=</span>&nbsp;<span class="keyword" id="4443528">range</span>&nbsp;<span class="ident" id="4443534">h</span>&nbsp;<span class="op" id="4443536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4443541">if</span>&nbsp;<span class="ident" id="4443544">err</span>&nbsp;<span class="op" id="4443548">:=</span>&nbsp;<span class="ident" id="4443551">writeHeader</span><span class="op" id="4443562">(</span><span class="ident" id="4443563">out</span><span class="op" id="4443566">,</span>&nbsp;<span class="ident" id="4443568">k</span><span class="op" id="4443569">,</span>&nbsp;<span class="ident" id="4443571">b</span><span class="op" id="4443572">.</span><span class="ident" id="4443573">Headers</span><span class="op" id="4443580">[</span><span class="ident" id="4443581">k</span><span class="op" id="4443582">]</span><span class="op" id="4443583">)</span><span class="op" id="4443584">;</span>&nbsp;<span class="ident" id="4443586">err</span>&nbsp;<span class="op" id="4443590">!=</span>&nbsp;<span class="builtintype" id="4443593">nil</span>&nbsp;<span class="op" id="4443597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4443603">return</span>&nbsp;<span class="ident" id="4443610">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4443617">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4443621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4443625">if</span>&nbsp;<span class="ident" id="4443628">_</span><span class="op" id="4443629">,</span>&nbsp;<span class="ident" id="4443631">err</span>&nbsp;<span class="op" id="4443635">:=</span>&nbsp;<span class="ident" id="4443638">out</span><span class="op" id="4443641">.</span><span class="ident" id="4443642">Write</span><span class="op" id="4443647">(</span><span class="op" id="4443648">[</span><span class="op" id="4443649">]</span><span class="builtintype" id="4443650">byte</span><span class="op" id="4443654">{</span><span class="string" id="4443655">&#39;\n&#39;</span><span class="op" id="4443659">}</span><span class="op" id="4443660">)</span><span class="op" id="4443661">;</span>&nbsp;<span class="ident" id="4443663">err</span>&nbsp;<span class="op" id="4443667">!=</span>&nbsp;<span class="builtintype" id="4443670">nil</span>&nbsp;<span class="op" id="4443674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4443679">return</span>&nbsp;<span class="ident" id="4443686">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4443692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4443695">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4443699">var</span>&nbsp;<span class="ident" id="4443703">breaker</span>&nbsp;<span class="ident" id="4443711">lineBreaker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443724">breaker</span><span class="op" id="4443731">.</span><span class="ident" id="4443732">out</span>&nbsp;<span class="op" id="4443736">=</span>&nbsp;<span class="ident" id="4443738">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443744">b64</span>&nbsp;<span class="op" id="4443748">:=</span>&nbsp;<span class="ident" id="4443751">base64</span><span class="op" id="4443757">.</span><span class="ident" id="4443758">NewEncoder</span><span class="op" id="4443768">(</span><span class="ident" id="4443769">base64</span><span class="op" id="4443775">.</span><span class="ident" id="4443776">StdEncoding</span><span class="op" id="4443787">,</span>&nbsp;<span class="op" id="4443789">&amp;</span><span class="ident" id="4443790">breaker</span><span class="op" id="4443797">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4443800">if</span>&nbsp;<span class="ident" id="4443803">_</span><span class="op" id="4443804">,</span>&nbsp;<span class="ident" id="4443806">err</span>&nbsp;<span class="op" id="4443810">:=</span>&nbsp;<span class="ident" id="4443813">b64</span><span class="op" id="4443816">.</span><span class="ident" id="4443817">Write</span><span class="op" id="4443822">(</span><span class="ident" id="4443823">b</span><span class="op" id="4443824">.</span><span class="ident" id="4443825">Bytes</span><span class="op" id="4443830">)</span><span class="op" id="4443831">;</span>&nbsp;<span class="ident" id="4443833">err</span>&nbsp;<span class="op" id="4443837">!=</span>&nbsp;<span class="builtintype" id="4443840">nil</span>&nbsp;<span class="op" id="4443844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4443848">return</span>&nbsp;<span class="ident" id="4443855">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4443860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443863">b64</span><span class="op" id="4443866">.</span><span class="ident" id="4443867">Close</span><span class="op" id="4443872">(</span><span class="op" id="4443873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443876">breaker</span><span class="op" id="4443883">.</span><span class="ident" id="4443884">Close</span><span class="op" id="4443889">(</span><span class="op" id="4443890">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4443894">if</span>&nbsp;<span class="ident" id="4443897">_</span><span class="op" id="4443898">,</span>&nbsp;<span class="ident" id="4443900">err</span>&nbsp;<span class="op" id="4443904">:=</span>&nbsp;<span class="ident" id="4443907">out</span><span class="op" id="4443910">.</span><span class="ident" id="4443911">Write</span><span class="op" id="4443916">(</span><span class="ident" id="4443917">pemEnd</span><span class="op" id="4443923">[</span><span class="num" id="4443924">1</span><span class="op" id="4443925">:</span><span class="op" id="4443926">]</span><span class="op" id="4443927">)</span><span class="op" id="4443928">;</span>&nbsp;<span class="ident" id="4443930">err</span>&nbsp;<span class="op" id="4443934">!=</span>&nbsp;<span class="builtintype" id="4443937">nil</span>&nbsp;<span class="op" id="4443941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4443945">return</span>&nbsp;<span class="ident" id="4443952">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4443957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443960">_</span><span class="op" id="4443961">,</span>&nbsp;<span class="ident" id="4443963">err</span>&nbsp;<span class="op" id="4443967">:=</span>&nbsp;<span class="ident" id="4443970">out</span><span class="op" id="4443973">.</span><span class="ident" id="4443974">Write</span><span class="op" id="4443979">(</span><span class="op" id="4443980">[</span><span class="op" id="4443981">]</span><span class="builtintype" id="4443982">byte</span><span class="op" id="4443986">(</span><span class="ident" id="4443987">b</span><span class="op" id="4443988">.</span><span class="ident" id="4443989">Type</span>&nbsp;<span class="op" id="4443994">+</span>&nbsp;<span class="string" id="4443996">&#34;-----\n&#34;</span><span class="op" id="4444005">)</span><span class="op" id="4444006">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4444009">return</span>&nbsp;<span class="ident" id="4444016">err</span><br>
<span class="lineno"></span><span class="op" id="4444020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4444023">func</span>&nbsp;<span class="ident" id="4444028">EncodeToMemory</span><span class="op" id="4444042">(</span><span class="ident" id="4444043">b</span>&nbsp;<span class="op" id="4444045">*</span><span class="ident" id="4444046">Block</span><span class="op" id="4444051">)</span>&nbsp;<span class="op" id="4444053">[</span><span class="op" id="4444054">]</span><span class="builtintype" id="4444055">byte</span>&nbsp;<span class="op" id="4444060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4444063">var</span>&nbsp;<span class="ident" id="4444067">buf</span>&nbsp;<span class="ident" id="4444071">bytes</span><span class="op" id="4444076">.</span><span class="ident" id="4444077">Buffer</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4444085">Encode</span><span class="op" id="4444091">(</span><span class="op" id="4444092">&amp;</span><span class="ident" id="4444093">buf</span><span class="op" id="4444096">,</span>&nbsp;<span class="ident" id="4444098">b</span><span class="op" id="4444099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4444102">return</span>&nbsp;<span class="ident" id="4444109">buf</span><span class="op" id="4444112">.</span><span class="ident" id="4444113">Bytes</span><span class="op" id="4444118">(</span><span class="op" id="4444119">)</span><br>
<span class="lineno"></span><span class="op" id="4444121">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
