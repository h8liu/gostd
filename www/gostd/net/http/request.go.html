<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3398705">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3398760">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3398814">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3398865">//&nbsp;HTTP&nbsp;Request&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3398903">package</span>&nbsp;<span class="ident" id="3398911">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3398917">import</span>&nbsp;<span class="op" id="3398924">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3398927">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3398936">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3398945">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3398959">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3398978">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3398988">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3398995">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3399001">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3399014">&#34;mime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3399022">&#34;mime/multipart&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3399040">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3399057">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3399068">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3399079">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3399090">&#34;sync&#34;</span><br>
<span class="lineno">25</span><span class="op" id="3399097">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3399100">const</span>&nbsp;<span class="op" id="3399106">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399109">maxValueLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3399126">=</span>&nbsp;<span class="num" id="3399128">4096</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399134">maxHeaderLines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3399151">=</span>&nbsp;<span class="num" id="3399153">1024</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399159">chunkSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399176">=</span>&nbsp;<span class="num" id="3399178">4</span>&nbsp;<span class="op" id="3399180">&lt;&lt;</span>&nbsp;<span class="num" id="3399183">10</span>&nbsp;&nbsp;<span class="comment" id="3399187">//&nbsp;4&nbsp;KB&nbsp;chunks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399203">defaultMaxMemory</span>&nbsp;<span class="op" id="3399220">=</span>&nbsp;<span class="num" id="3399222">32</span>&nbsp;<span class="op" id="3399225">&lt;&lt;</span>&nbsp;<span class="num" id="3399228">20</span>&nbsp;<span class="comment" id="3399231">//&nbsp;32&nbsp;MB</span><br>
<span class="lineno"></span><span class="op" id="3399240">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3399243">//&nbsp;ErrMissingFile&nbsp;is&nbsp;returned&nbsp;by&nbsp;FormFile&nbsp;when&nbsp;the&nbsp;provided&nbsp;file&nbsp;field&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="3399319">//&nbsp;is&nbsp;either&nbsp;not&nbsp;present&nbsp;in&nbsp;the&nbsp;request&nbsp;or&nbsp;not&nbsp;a&nbsp;file&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="3399380">var</span>&nbsp;<span class="ident" id="3399384">ErrMissingFile</span>&nbsp;<span class="op" id="3399399">=</span>&nbsp;<span class="ident" id="3399401">errors</span><span class="op" id="3399407">.</span><span class="ident" id="3399408">New</span><span class="op" id="3399411">(</span><span class="string" id="3399412">&#34;http:&nbsp;no&nbsp;such&nbsp;file&#34;</span><span class="op" id="3399432">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3399435">//&nbsp;HTTP&nbsp;request&nbsp;parsing&nbsp;errors.</span><br>
<span class="lineno"></span><span class="keyword" id="3399467">type</span>&nbsp;<span class="ident" id="3399472">ProtocolError</span>&nbsp;<span class="keyword" id="3399486">struct</span>&nbsp;<span class="op" id="3399493">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399496">ErrorString</span>&nbsp;<span class="builtintype" id="3399508">string</span><br>
<span class="lineno"></span><span class="op" id="3399515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3399518">func</span>&nbsp;<span class="op" id="3399523">(</span><span class="ident" id="3399524">err</span>&nbsp;<span class="op" id="3399528">*</span><span class="ident" id="3399529">ProtocolError</span><span class="op" id="3399542">)</span>&nbsp;<span class="ident" id="3399544">Error</span><span class="op" id="3399549">(</span><span class="op" id="3399550">)</span>&nbsp;<span class="builtintype" id="3399552">string</span>&nbsp;<span class="op" id="3399559">{</span>&nbsp;<span class="keyword" id="3399561">return</span>&nbsp;<span class="ident" id="3399568">err</span><span class="op" id="3399571">.</span><span class="ident" id="3399572">ErrorString</span>&nbsp;<span class="op" id="3399584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="3399587">var</span>&nbsp;<span class="op" id="3399591">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399594">ErrHeaderTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399618">=</span>&nbsp;<span class="op" id="3399620">&amp;</span><span class="ident" id="3399621">ProtocolError</span><span class="op" id="3399634">{</span><span class="string" id="3399635">&#34;header&nbsp;too&nbsp;long&#34;</span><span class="op" id="3399652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399655">ErrShortBody</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399679">=</span>&nbsp;<span class="op" id="3399681">&amp;</span><span class="ident" id="3399682">ProtocolError</span><span class="op" id="3399695">{</span><span class="string" id="3399696">&#34;entity&nbsp;body&nbsp;too&nbsp;short&#34;</span><span class="op" id="3399719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399722">ErrNotSupported</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399746">=</span>&nbsp;<span class="op" id="3399748">&amp;</span><span class="ident" id="3399749">ProtocolError</span><span class="op" id="3399762">{</span><span class="string" id="3399763">&#34;feature&nbsp;not&nbsp;supported&#34;</span><span class="op" id="3399786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399789">ErrUnexpectedTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399813">=</span>&nbsp;<span class="op" id="3399815">&amp;</span><span class="ident" id="3399816">ProtocolError</span><span class="op" id="3399829">{</span><span class="string" id="3399830">&#34;trailer&nbsp;header&nbsp;without&nbsp;chunked&nbsp;transfer&nbsp;encoding&#34;</span><span class="op" id="3399880">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399883">ErrMissingContentLength</span>&nbsp;<span class="op" id="3399907">=</span>&nbsp;<span class="op" id="3399909">&amp;</span><span class="ident" id="3399910">ProtocolError</span><span class="op" id="3399923">{</span><span class="string" id="3399924">&#34;missing&nbsp;ContentLength&nbsp;in&nbsp;HEAD&nbsp;response&#34;</span><span class="op" id="3399964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399967">ErrNotMultipart</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399991">=</span>&nbsp;<span class="op" id="3399993">&amp;</span><span class="ident" id="3399994">ProtocolError</span><span class="op" id="3400007">{</span><span class="string" id="3400008">&#34;request&nbsp;Content-Type&nbsp;isn&#39;t&nbsp;multipart/form-data&#34;</span><span class="op" id="3400056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400059">ErrMissingBoundary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3400083">=</span>&nbsp;<span class="op" id="3400085">&amp;</span><span class="ident" id="3400086">ProtocolError</span><span class="op" id="3400099">{</span><span class="string" id="3400100">&#34;no&nbsp;multipart&nbsp;boundary&nbsp;param&nbsp;in&nbsp;Content-Type&#34;</span><span class="op" id="3400145">}</span><br>
<span class="lineno"></span><span class="op" id="3400147">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3400150">type</span>&nbsp;<span class="ident" id="3400155">badStringError</span>&nbsp;<span class="keyword" id="3400170">struct</span>&nbsp;<span class="op" id="3400177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400180">what</span>&nbsp;<span class="builtintype" id="3400185">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400193">str</span>&nbsp;&nbsp;<span class="builtintype" id="3400198">string</span><br>
<span class="lineno"></span><span class="op" id="3400205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="3400208">func</span>&nbsp;<span class="op" id="3400213">(</span><span class="ident" id="3400214">e</span>&nbsp;<span class="op" id="3400216">*</span><span class="ident" id="3400217">badStringError</span><span class="op" id="3400231">)</span>&nbsp;<span class="ident" id="3400233">Error</span><span class="op" id="3400238">(</span><span class="op" id="3400239">)</span>&nbsp;<span class="builtintype" id="3400241">string</span>&nbsp;<span class="op" id="3400248">{</span>&nbsp;<span class="keyword" id="3400250">return</span>&nbsp;<span class="ident" id="3400257">fmt</span><span class="op" id="3400260">.</span><span class="ident" id="3400261">Sprintf</span><span class="op" id="3400268">(</span><span class="string" id="3400269">&#34;%s&nbsp;%q&#34;</span><span class="op" id="3400276">,</span>&nbsp;<span class="ident" id="3400278">e</span><span class="op" id="3400279">.</span><span class="ident" id="3400280">what</span><span class="op" id="3400284">,</span>&nbsp;<span class="ident" id="3400286">e</span><span class="op" id="3400287">.</span><span class="ident" id="3400288">str</span><span class="op" id="3400291">)</span>&nbsp;<span class="op" id="3400293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3400296">//&nbsp;Headers&nbsp;that&nbsp;Request.Write&nbsp;handles&nbsp;itself&nbsp;and&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="3400364">var</span>&nbsp;<span class="ident" id="3400368">reqWriteExcludeHeader</span>&nbsp;<span class="op" id="3400390">=</span>&nbsp;<span class="keyword" id="3400392">map</span><span class="op" id="3400395">[</span><span class="builtintype" id="3400396">string</span><span class="op" id="3400402">]</span><span class="builtintype" id="3400403">bool</span><span class="op" id="3400407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3400410">&#34;Host&#34;</span><span class="op" id="3400416">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3400431">true</span><span class="op" id="3400435">,</span>&nbsp;<span class="comment" id="3400437">//&nbsp;not&nbsp;in&nbsp;Header&nbsp;map&nbsp;anyway</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3400466">&#34;User-Agent&#34;</span><span class="op" id="3400478">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3400487">true</span><span class="op" id="3400491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3400494">&#34;Content-Length&#34;</span><span class="op" id="3400510">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3400515">true</span><span class="op" id="3400519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3400522">&#34;Transfer-Encoding&#34;</span><span class="op" id="3400541">:</span>&nbsp;<span class="builtintype" id="3400543">true</span><span class="op" id="3400547">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3400550">&#34;Trailer&#34;</span><span class="op" id="3400559">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3400571">true</span><span class="op" id="3400575">,</span><br>
<span class="lineno"></span><span class="op" id="3400577">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="3400580">//&nbsp;A&nbsp;Request&nbsp;represents&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;received&nbsp;by&nbsp;a&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="3400641">//&nbsp;or&nbsp;to&nbsp;be&nbsp;sent&nbsp;by&nbsp;a&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="3400671">//</span><br>
<span class="lineno"></span><span class="comment" id="3400674">//&nbsp;The&nbsp;field&nbsp;semantics&nbsp;differ&nbsp;slightly&nbsp;between&nbsp;client&nbsp;and&nbsp;server</span><br>
<span class="lineno">75</span><span class="comment" id="3400739">//&nbsp;usage.&nbsp;In&nbsp;addition&nbsp;to&nbsp;the&nbsp;notes&nbsp;on&nbsp;the&nbsp;fields&nbsp;below,&nbsp;see&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3400803">//&nbsp;documentation&nbsp;for&nbsp;Request.Write&nbsp;and&nbsp;RoundTripper.</span><br>
<span class="lineno"></span><span class="keyword" id="3400856">type</span>&nbsp;<span class="ident" id="3400861">Request</span>&nbsp;<span class="keyword" id="3400869">struct</span>&nbsp;<span class="op" id="3400876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3400879">//&nbsp;Method&nbsp;specifies&nbsp;the&nbsp;HTTP&nbsp;method&nbsp;(GET,&nbsp;POST,&nbsp;PUT,&nbsp;etc.).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3400940">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;an&nbsp;empty&nbsp;string&nbsp;means&nbsp;GET.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400991">Method</span>&nbsp;<span class="builtintype" id="3400998">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401007">//&nbsp;URL&nbsp;specifies&nbsp;either&nbsp;the&nbsp;URI&nbsp;being&nbsp;requested&nbsp;(for&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401068">//&nbsp;requests)&nbsp;or&nbsp;the&nbsp;URL&nbsp;to&nbsp;access&nbsp;(for&nbsp;client&nbsp;requests).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401126">//</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401130">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;URL&nbsp;is&nbsp;parsed&nbsp;from&nbsp;the&nbsp;URI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401185">//&nbsp;supplied&nbsp;on&nbsp;the&nbsp;Request-Line&nbsp;as&nbsp;stored&nbsp;in&nbsp;RequestURI.&nbsp;&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401248">//&nbsp;most&nbsp;requests,&nbsp;fields&nbsp;other&nbsp;than&nbsp;Path&nbsp;and&nbsp;RawQuery&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401311">//&nbsp;empty.&nbsp;(See&nbsp;RFC&nbsp;2616,&nbsp;Section&nbsp;5.1.2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401352">//</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401356">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;the&nbsp;URL&#39;s&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;server&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401420">//&nbsp;connect&nbsp;to,&nbsp;while&nbsp;the&nbsp;Request&#39;s&nbsp;Host&nbsp;field&nbsp;optionally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401478">//&nbsp;specifies&nbsp;the&nbsp;Host&nbsp;header&nbsp;value&nbsp;to&nbsp;send&nbsp;in&nbsp;the&nbsp;HTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401534">//&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401547">URL</span>&nbsp;<span class="op" id="3401551">*</span><span class="ident" id="3401552">url</span><span class="op" id="3401555">.</span><span class="ident" id="3401556">URL</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401562">//&nbsp;The&nbsp;protocol&nbsp;version&nbsp;for&nbsp;incoming&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401610">//&nbsp;Client&nbsp;requests&nbsp;always&nbsp;use&nbsp;HTTP/1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401651">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3401662">string</span>&nbsp;<span class="comment" id="3401669">//&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401684">ProtoMajor</span>&nbsp;<span class="builtintype" id="3401695">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3401702">//&nbsp;1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401708">ProtoMinor</span>&nbsp;<span class="builtintype" id="3401719">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3401726">//&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401733">//&nbsp;A&nbsp;header&nbsp;maps&nbsp;request&nbsp;lines&nbsp;to&nbsp;their&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401782">//&nbsp;If&nbsp;the&nbsp;header&nbsp;says</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401805">//</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401809">//&nbsp;&nbsp;&nbsp;&nbspaccept-encoding:&nbsp;gzip,&nbsp;deflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401844">//&nbsp;&nbsp;&nbsp;&nbspAccept-Language:&nbsp;en-us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401871">//&nbsp;&nbsp;&nbsp;&nbspConnection:&nbsp;keep-alive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401898">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401902">//&nbsp;then</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401911">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401915">//&nbsp;&nbsp;&nbsp;&nbspHeader&nbsp;=&nbsp;map[string][]string{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401949">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Accept-Encoding&#34;:&nbsp;{&#34;gzip,&nbsp;deflate&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3401992">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Accept-Language&#34;:&nbsp;{&#34;en-us&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402027">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Connection&#34;:&nbsp;{&#34;keep-alive&#34;},</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402062">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402068">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402072">//&nbsp;HTTP&nbsp;defines&nbsp;that&nbsp;header&nbsp;names&nbsp;are&nbsp;case-insensitive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402129">//&nbsp;The&nbsp;request&nbsp;parser&nbsp;implements&nbsp;this&nbsp;by&nbsp;canonicalizing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402190">//&nbsp;name,&nbsp;making&nbsp;the&nbsp;first&nbsp;character&nbsp;and&nbsp;any&nbsp;characters</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402246">//&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;uppercase&nbsp;and&nbsp;the&nbsp;rest&nbsp;lowercase.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402303">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402307">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;certain&nbsp;headers&nbsp;are&nbsp;automatically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402365">//&nbsp;added&nbsp;and&nbsp;may&nbsp;override&nbsp;values&nbsp;in&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402410">//</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402414">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;Request.Write&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402470">Header</span>&nbsp;<span class="ident" id="3402477">Header</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402486">//&nbsp;Body&nbsp;is&nbsp;the&nbsp;request&#39;s&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402518">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402522">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;a&nbsp;nil&nbsp;body&nbsp;means&nbsp;the&nbsp;request&nbsp;has&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402582">//&nbsp;body,&nbsp;such&nbsp;as&nbsp;a&nbsp;GET&nbsp;request.&nbsp;The&nbsp;HTTP&nbsp;Client&#39;s&nbsp;Transport</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402643">//&nbsp;is&nbsp;responsible&nbsp;for&nbsp;calling&nbsp;the&nbsp;Close&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402692">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402696">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Request&nbsp;Body&nbsp;is&nbsp;always&nbsp;non-nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402755">//&nbsp;but&nbsp;will&nbsp;return&nbsp;EOF&nbsp;immediately&nbsp;when&nbsp;no&nbsp;body&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402816">//&nbsp;The&nbsp;Server&nbsp;will&nbsp;close&nbsp;the&nbsp;request&nbsp;body.&nbsp;The&nbsp;ServeHTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402874">//&nbsp;Handler&nbsp;does&nbsp;not&nbsp;need&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402904">Body</span>&nbsp;<span class="ident" id="3402909">io</span><span class="op" id="3402911">.</span><span class="ident" id="3402912">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402925">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402989">//&nbsp;The&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403044">//&nbsp;Values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403104">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403127">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;a&nbsp;value&nbsp;of&nbsp;0&nbsp;means&nbsp;unknown&nbsp;if&nbsp;Body&nbsp;is&nbsp;not&nbsp;nil.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403199">ContentLength</span>&nbsp;<span class="ident" id="3403213">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403221">//&nbsp;TransferEncoding&nbsp;lists&nbsp;the&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outermost&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403289">//&nbsp;innermost.&nbsp;An&nbsp;empty&nbsp;list&nbsp;denotes&nbsp;the&nbsp;&#34;identity&#34;&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403351">//&nbsp;TransferEncoding&nbsp;can&nbsp;usually&nbsp;be&nbsp;ignored;&nbsp;chunked&nbsp;encoding&nbsp;is</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403416">//&nbsp;automatically&nbsp;added&nbsp;and&nbsp;removed&nbsp;as&nbsp;necessary&nbsp;when&nbsp;sending&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403482">//&nbsp;receiving&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403506">TransferEncoding</span>&nbsp;<span class="op" id="3403523">[</span><span class="op" id="3403524">]</span><span class="builtintype" id="3403525">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403534">//&nbsp;Close&nbsp;indicates&nbsp;whether&nbsp;to&nbsp;close&nbsp;the&nbsp;connection&nbsp;after</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403592">//&nbsp;replying&nbsp;to&nbsp;this&nbsp;request&nbsp;(for&nbsp;servers)&nbsp;or&nbsp;after&nbsp;sending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403652">//&nbsp;the&nbsp;request&nbsp;(for&nbsp;clients).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403683">Close</span>&nbsp;<span class="builtintype" id="3403689">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403696">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;host&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403757">//&nbsp;URL&nbsp;is&nbsp;sought.&nbsp;Per&nbsp;RFC&nbsp;2616,&nbsp;this&nbsp;is&nbsp;either&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403818">//&nbsp;the&nbsp;&#34;Host&#34;&nbsp;header&nbsp;or&nbsp;the&nbsp;host&nbsp;name&nbsp;given&nbsp;in&nbsp;the&nbsp;URL&nbsp;itself.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403882">//&nbsp;It&nbsp;may&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403921">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403925">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Host&nbsp;optionally&nbsp;overrides&nbsp;the&nbsp;Host</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403984">//&nbsp;header&nbsp;to&nbsp;send.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;Request.Write&nbsp;method&nbsp;uses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404044">//&nbsp;the&nbsp;value&nbsp;of&nbsp;URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404071">Host</span>&nbsp;<span class="builtintype" id="3404076">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404085">//&nbsp;Form&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data,&nbsp;including&nbsp;both&nbsp;the&nbsp;URL</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404148">//&nbsp;field&#39;s&nbsp;query&nbsp;parameters&nbsp;and&nbsp;the&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;form&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404208">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404268">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;Form&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404324">Form</span>&nbsp;<span class="ident" id="3404329">url</span><span class="op" id="3404332">.</span><span class="ident" id="3404333">Values</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404342">//&nbsp;PostForm&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data&nbsp;from&nbsp;POST&nbsp;or&nbsp;PUT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404402">//&nbsp;body&nbsp;parameters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404423">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404483">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;PostForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404543">PostForm</span>&nbsp;<span class="ident" id="3404552">url</span><span class="op" id="3404555">.</span><span class="ident" id="3404556">Values</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404565">//&nbsp;MultipartForm&nbsp;is&nbsp;the&nbsp;parsed&nbsp;multipart&nbsp;form,&nbsp;including&nbsp;file&nbsp;uploads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404637">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseMultipartForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404706">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;MultipartForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404771">MultipartForm</span>&nbsp;<span class="op" id="3404785">*</span><span class="ident" id="3404786">multipart</span><span class="op" id="3404795">.</span><span class="ident" id="3404796">Form</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404803">//&nbsp;Trailer&nbsp;specifies&nbsp;additional&nbsp;headers&nbsp;that&nbsp;are&nbsp;sent&nbsp;after&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404876">//&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404886">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404890">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Trailer&nbsp;map&nbsp;initially&nbsp;contains&nbsp;only&nbsp;the</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404958">//&nbsp;trailer&nbsp;keys,&nbsp;with&nbsp;nil&nbsp;values.&nbsp;(The&nbsp;client&nbsp;declares&nbsp;which&nbsp;trailers&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405032">//&nbsp;will&nbsp;later&nbsp;send.)&nbsp;&nbsp;While&nbsp;the&nbsp;handler&nbsp;is&nbsp;reading&nbsp;from&nbsp;Body,&nbsp;it&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405103">//&nbsp;not&nbsp;reference&nbsp;Trailer.&nbsp;After&nbsp;reading&nbsp;from&nbsp;Body&nbsp;returns&nbsp;EOF,&nbsp;Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405175">//&nbsp;can&nbsp;be&nbsp;read&nbsp;again&nbsp;and&nbsp;will&nbsp;contain&nbsp;non-nil&nbsp;values,&nbsp;if&nbsp;they&nbsp;were&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405248">//&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405267">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405271">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Trailer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;to&nbsp;a&nbsp;map&nbsp;containing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405343">//&nbsp;the&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;later&nbsp;send.&nbsp;The&nbsp;values&nbsp;may&nbsp;be&nbsp;nil&nbsp;or&nbsp;their&nbsp;final</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405416">//&nbsp;values.&nbsp;The&nbsp;ContentLength&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;-1,&nbsp;to&nbsp;send&nbsp;a&nbsp;chunked&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405490">//&nbsp;After&nbsp;the&nbsp;HTTP&nbsp;request&nbsp;is&nbsp;sent&nbsp;the&nbsp;map&nbsp;values&nbsp;can&nbsp;be&nbsp;updated&nbsp;while</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405561">//&nbsp;the&nbsp;request&nbsp;body&nbsp;is&nbsp;read.&nbsp;Once&nbsp;the&nbsp;body&nbsp;returns&nbsp;EOF,&nbsp;the&nbsp;caller&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405634">//&nbsp;not&nbsp;mutate&nbsp;Trailer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405658">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405662">//&nbsp;Few&nbsp;HTTP&nbsp;clients,&nbsp;servers,&nbsp;or&nbsp;proxies&nbsp;support&nbsp;HTTP&nbsp;trailers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405727">Trailer</span>&nbsp;<span class="ident" id="3405735">Header</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405744">//&nbsp;RemoteAddr&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405808">//&nbsp;the&nbsp;network&nbsp;address&nbsp;that&nbsp;sent&nbsp;the&nbsp;request,&nbsp;usually&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405867">//&nbsp;logging.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405927">//&nbsp;has&nbsp;no&nbsp;defined&nbsp;format.&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405986">//&nbsp;sets&nbsp;RemoteAddr&nbsp;to&nbsp;an&nbsp;&#34;IP:port&#34;&nbsp;address&nbsp;before&nbsp;invoking&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3406048">//&nbsp;handler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3406061">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406107">RemoteAddr</span>&nbsp;<span class="builtintype" id="3406118">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3406127">//&nbsp;RequestURI&nbsp;is&nbsp;the&nbsp;unmodified&nbsp;Request-URI&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3406179">//&nbsp;Request-Line&nbsp;(RFC&nbsp;2616,&nbsp;Section&nbsp;5.1)&nbsp;as&nbsp;sent&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3406242">//&nbsp;to&nbsp;a&nbsp;server.&nbsp;Usually&nbsp;the&nbsp;URL&nbsp;field&nbsp;should&nbsp;be&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3406305">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;set&nbsp;this&nbsp;field&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406369">RequestURI</span>&nbsp;<span class="builtintype" id="3406380">string</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3406389">//&nbsp;TLS&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3406446">//&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3406508">//&nbsp;was&nbsp;received.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3406570">//&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package&nbsp;sets&nbsp;the&nbsp;field&nbsp;for</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3406625">//&nbsp;TLS-enabled&nbsp;connections&nbsp;before&nbsp;invoking&nbsp;a&nbsp;handler;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3406680">//&nbsp;otherwise&nbsp;it&nbsp;leaves&nbsp;the&nbsp;field&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3406719">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406765">TLS</span>&nbsp;<span class="op" id="3406769">*</span><span class="ident" id="3406770">tls</span><span class="op" id="3406773">.</span><span class="ident" id="3406774">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="3406790">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="3406793">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3406848">//&nbsp;in&nbsp;the&nbsp;request&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="3406891">func</span>&nbsp;<span class="op" id="3406896">(</span><span class="ident" id="3406897">r</span>&nbsp;<span class="op" id="3406899">*</span><span class="ident" id="3406900">Request</span><span class="op" id="3406907">)</span>&nbsp;<span class="ident" id="3406909">ProtoAtLeast</span><span class="op" id="3406921">(</span><span class="ident" id="3406922">major</span><span class="op" id="3406927">,</span>&nbsp;<span class="ident" id="3406929">minor</span>&nbsp;<span class="builtintype" id="3406935">int</span><span class="op" id="3406938">)</span>&nbsp;<span class="builtintype" id="3406940">bool</span>&nbsp;<span class="op" id="3406945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406948">return</span>&nbsp;<span class="ident" id="3406955">r</span><span class="op" id="3406956">.</span><span class="ident" id="3406957">ProtoMajor</span>&nbsp;<span class="op" id="3406968">&gt;</span>&nbsp;<span class="ident" id="3406970">major</span>&nbsp;<span class="op" id="3406976">||</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406981">r</span><span class="op" id="3406982">.</span><span class="ident" id="3406983">ProtoMajor</span>&nbsp;<span class="op" id="3406994">==</span>&nbsp;<span class="ident" id="3406997">major</span>&nbsp;<span class="op" id="3407003">&amp;&amp;</span>&nbsp;<span class="ident" id="3407006">r</span><span class="op" id="3407007">.</span><span class="ident" id="3407008">ProtoMinor</span>&nbsp;<span class="op" id="3407019">&gt;=</span>&nbsp;<span class="ident" id="3407022">minor</span><br>
<span class="lineno"></span><span class="op" id="3407028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3407031">//&nbsp;UserAgent&nbsp;returns&nbsp;the&nbsp;client&#39;s&nbsp;User-Agent,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="3407101">func</span>&nbsp;<span class="op" id="3407106">(</span><span class="ident" id="3407107">r</span>&nbsp;<span class="op" id="3407109">*</span><span class="ident" id="3407110">Request</span><span class="op" id="3407117">)</span>&nbsp;<span class="ident" id="3407119">UserAgent</span><span class="op" id="3407128">(</span><span class="op" id="3407129">)</span>&nbsp;<span class="builtintype" id="3407131">string</span>&nbsp;<span class="op" id="3407138">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407141">return</span>&nbsp;<span class="ident" id="3407148">r</span><span class="op" id="3407149">.</span><span class="ident" id="3407150">Header</span><span class="op" id="3407156">.</span><span class="ident" id="3407157">Get</span><span class="op" id="3407160">(</span><span class="string" id="3407161">&#34;User-Agent&#34;</span><span class="op" id="3407173">)</span><br>
<span class="lineno"></span><span class="op" id="3407175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3407178">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;HTTP&nbsp;cookies&nbsp;sent&nbsp;with&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="3407248">func</span>&nbsp;<span class="op" id="3407253">(</span><span class="ident" id="3407254">r</span>&nbsp;<span class="op" id="3407256">*</span><span class="ident" id="3407257">Request</span><span class="op" id="3407264">)</span>&nbsp;<span class="ident" id="3407266">Cookies</span><span class="op" id="3407273">(</span><span class="op" id="3407274">)</span>&nbsp;<span class="op" id="3407276">[</span><span class="op" id="3407277">]</span><span class="op" id="3407278">*</span><span class="ident" id="3407279">Cookie</span>&nbsp;<span class="op" id="3407286">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407289">return</span>&nbsp;<span class="ident" id="3407296">readCookies</span><span class="op" id="3407307">(</span><span class="ident" id="3407308">r</span><span class="op" id="3407309">.</span><span class="ident" id="3407310">Header</span><span class="op" id="3407316">,</span>&nbsp;<span class="string" id="3407318">&#34;&#34;</span><span class="op" id="3407320">)</span><br>
<span class="lineno"></span><span class="op" id="3407322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3407325">var</span>&nbsp;<span class="ident" id="3407329">ErrNoCookie</span>&nbsp;<span class="op" id="3407341">=</span>&nbsp;<span class="ident" id="3407343">errors</span><span class="op" id="3407349">.</span><span class="ident" id="3407350">New</span><span class="op" id="3407353">(</span><span class="string" id="3407354">&#34;http:&nbsp;named&nbsp;cookie&nbsp;not&nbsp;present&#34;</span><span class="op" id="3407386">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="3407389">//&nbsp;Cookie&nbsp;returns&nbsp;the&nbsp;named&nbsp;cookie&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3407451">//&nbsp;ErrNoCookie&nbsp;if&nbsp;not&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="3407480">func</span>&nbsp;<span class="op" id="3407485">(</span><span class="ident" id="3407486">r</span>&nbsp;<span class="op" id="3407488">*</span><span class="ident" id="3407489">Request</span><span class="op" id="3407496">)</span>&nbsp;<span class="ident" id="3407498">Cookie</span><span class="op" id="3407504">(</span><span class="ident" id="3407505">name</span>&nbsp;<span class="builtintype" id="3407510">string</span><span class="op" id="3407516">)</span>&nbsp;<span class="op" id="3407518">(</span><span class="op" id="3407519">*</span><span class="ident" id="3407520">Cookie</span><span class="op" id="3407526">,</span>&nbsp;<span class="builtintype" id="3407528">error</span><span class="op" id="3407533">)</span>&nbsp;<span class="op" id="3407535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407538">for</span>&nbsp;<span class="ident" id="3407542">_</span><span class="op" id="3407543">,</span>&nbsp;<span class="ident" id="3407545">c</span>&nbsp;<span class="op" id="3407547">:=</span>&nbsp;<span class="keyword" id="3407550">range</span>&nbsp;<span class="ident" id="3407556">readCookies</span><span class="op" id="3407567">(</span><span class="ident" id="3407568">r</span><span class="op" id="3407569">.</span><span class="ident" id="3407570">Header</span><span class="op" id="3407576">,</span>&nbsp;<span class="ident" id="3407578">name</span><span class="op" id="3407582">)</span>&nbsp;<span class="op" id="3407584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407588">return</span>&nbsp;<span class="ident" id="3407595">c</span><span class="op" id="3407596">,</span>&nbsp;<span class="ident" id="3407598">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3407603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407606">return</span>&nbsp;<span class="ident" id="3407613">nil</span><span class="op" id="3407616">,</span>&nbsp;<span class="ident" id="3407618">ErrNoCookie</span><br>
<span class="lineno"></span><span class="op" id="3407630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3407633">//&nbsp;AddCookie&nbsp;adds&nbsp;a&nbsp;cookie&nbsp;to&nbsp;the&nbsp;request.&nbsp;&nbsp;Per&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.4,</span><br>
<span class="lineno">260</span><span class="comment" id="3407703">//&nbsp;AddCookie&nbsp;does&nbsp;not&nbsp;attach&nbsp;more&nbsp;than&nbsp;one&nbsp;Cookie&nbsp;header&nbsp;field.&nbsp;&nbsp;That</span><br>
<span class="lineno"></span><span class="comment" id="3407773">//&nbsp;means&nbsp;all&nbsp;cookies,&nbsp;if&nbsp;any,&nbsp;are&nbsp;written&nbsp;into&nbsp;the&nbsp;same&nbsp;line,</span><br>
<span class="lineno"></span><span class="comment" id="3407835">//&nbsp;separated&nbsp;by&nbsp;semicolon.</span><br>
<span class="lineno"></span><span class="keyword" id="3407862">func</span>&nbsp;<span class="op" id="3407867">(</span><span class="ident" id="3407868">r</span>&nbsp;<span class="op" id="3407870">*</span><span class="ident" id="3407871">Request</span><span class="op" id="3407878">)</span>&nbsp;<span class="ident" id="3407880">AddCookie</span><span class="op" id="3407889">(</span><span class="ident" id="3407890">c</span>&nbsp;<span class="op" id="3407892">*</span><span class="ident" id="3407893">Cookie</span><span class="op" id="3407899">)</span>&nbsp;<span class="op" id="3407901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407904">s</span>&nbsp;<span class="op" id="3407906">:=</span>&nbsp;<span class="ident" id="3407909">fmt</span><span class="op" id="3407912">.</span><span class="ident" id="3407913">Sprintf</span><span class="op" id="3407920">(</span><span class="string" id="3407921">&#34;%s=%s&#34;</span><span class="op" id="3407928">,</span>&nbsp;<span class="ident" id="3407930">sanitizeCookieName</span><span class="op" id="3407948">(</span><span class="ident" id="3407949">c</span><span class="op" id="3407950">.</span><span class="ident" id="3407951">Name</span><span class="op" id="3407955">)</span><span class="op" id="3407956">,</span>&nbsp;<span class="ident" id="3407958">sanitizeCookieValue</span><span class="op" id="3407977">(</span><span class="ident" id="3407978">c</span><span class="op" id="3407979">.</span><span class="ident" id="3407980">Value</span><span class="op" id="3407985">)</span><span class="op" id="3407986">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407989">if</span>&nbsp;<span class="ident" id="3407992">c</span>&nbsp;<span class="op" id="3407994">:=</span>&nbsp;<span class="ident" id="3407997">r</span><span class="op" id="3407998">.</span><span class="ident" id="3407999">Header</span><span class="op" id="3408005">.</span><span class="ident" id="3408006">Get</span><span class="op" id="3408009">(</span><span class="string" id="3408010">&#34;Cookie&#34;</span><span class="op" id="3408018">)</span><span class="op" id="3408019">;</span>&nbsp;<span class="ident" id="3408021">c</span>&nbsp;<span class="op" id="3408023">!=</span>&nbsp;<span class="string" id="3408026">&#34;&#34;</span>&nbsp;<span class="op" id="3408029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408033">r</span><span class="op" id="3408034">.</span><span class="ident" id="3408035">Header</span><span class="op" id="3408041">.</span><span class="ident" id="3408042">Set</span><span class="op" id="3408045">(</span><span class="string" id="3408046">&#34;Cookie&#34;</span><span class="op" id="3408054">,</span>&nbsp;<span class="ident" id="3408056">c</span><span class="op" id="3408057">+</span><span class="string" id="3408058">&#34;;&nbsp;&#34;</span><span class="op" id="3408062">+</span><span class="ident" id="3408063">s</span><span class="op" id="3408064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408067">}</span>&nbsp;<span class="keyword" id="3408069">else</span>&nbsp;<span class="op" id="3408074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408078">r</span><span class="op" id="3408079">.</span><span class="ident" id="3408080">Header</span><span class="op" id="3408086">.</span><span class="ident" id="3408087">Set</span><span class="op" id="3408090">(</span><span class="string" id="3408091">&#34;Cookie&#34;</span><span class="op" id="3408099">,</span>&nbsp;<span class="ident" id="3408101">s</span><span class="op" id="3408102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408105">}</span><br>
<span class="lineno">270</span><span class="op" id="3408107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3408110">//&nbsp;Referer&nbsp;returns&nbsp;the&nbsp;referring&nbsp;URL,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3408172">//</span><br>
<span class="lineno"></span><span class="comment" id="3408175">//&nbsp;Referer&nbsp;is&nbsp;misspelled&nbsp;as&nbsp;in&nbsp;the&nbsp;request&nbsp;itself,&nbsp;a&nbsp;mistake&nbsp;from&nbsp;the</span><br>
<span class="lineno">275</span><span class="comment" id="3408245">//&nbsp;earliest&nbsp;days&nbsp;of&nbsp;HTTP.&nbsp;&nbsp;This&nbsp;value&nbsp;can&nbsp;also&nbsp;be&nbsp;fetched&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3408312">//&nbsp;Header&nbsp;map&nbsp;as&nbsp;Header[&#34;Referer&#34;];&nbsp;the&nbsp;benefit&nbsp;of&nbsp;making&nbsp;it&nbsp;available</span><br>
<span class="lineno"></span><span class="comment" id="3408383">//&nbsp;as&nbsp;a&nbsp;method&nbsp;is&nbsp;that&nbsp;the&nbsp;compiler&nbsp;can&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3408454">//&nbsp;alternate&nbsp;(correct&nbsp;English)&nbsp;spelling&nbsp;req.Referrer()&nbsp;but&nbsp;cannot</span><br>
<span class="lineno"></span><span class="comment" id="3408520">//&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;Header[&#34;Referrer&#34;].</span><br>
<span class="lineno">280</span><span class="keyword" id="3408570">func</span>&nbsp;<span class="op" id="3408575">(</span><span class="ident" id="3408576">r</span>&nbsp;<span class="op" id="3408578">*</span><span class="ident" id="3408579">Request</span><span class="op" id="3408586">)</span>&nbsp;<span class="ident" id="3408588">Referer</span><span class="op" id="3408595">(</span><span class="op" id="3408596">)</span>&nbsp;<span class="builtintype" id="3408598">string</span>&nbsp;<span class="op" id="3408605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408608">return</span>&nbsp;<span class="ident" id="3408615">r</span><span class="op" id="3408616">.</span><span class="ident" id="3408617">Header</span><span class="op" id="3408623">.</span><span class="ident" id="3408624">Get</span><span class="op" id="3408627">(</span><span class="string" id="3408628">&#34;Referer&#34;</span><span class="op" id="3408637">)</span><br>
<span class="lineno"></span><span class="op" id="3408639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3408642">//&nbsp;multipartByReader&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno">285</span><span class="comment" id="3408684">//&nbsp;Its&nbsp;presence&nbsp;in&nbsp;Request.MultipartForm&nbsp;indicates&nbsp;that&nbsp;parsing&nbsp;of&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="3408763">//&nbsp;body&nbsp;has&nbsp;been&nbsp;handed&nbsp;off&nbsp;to&nbsp;a&nbsp;MultipartReader&nbsp;instead&nbsp;of&nbsp;ParseMultipartFrom.</span><br>
<span class="lineno"></span><span class="keyword" id="3408843">var</span>&nbsp;<span class="ident" id="3408847">multipartByReader</span>&nbsp;<span class="op" id="3408865">=</span>&nbsp;<span class="op" id="3408867">&amp;</span><span class="ident" id="3408868">multipart</span><span class="op" id="3408877">.</span><span class="ident" id="3408878">Form</span><span class="op" id="3408882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408885">Value</span><span class="op" id="3408890">:</span>&nbsp;<span class="builtinfunc" id="3408892">make</span><span class="op" id="3408896">(</span><span class="keyword" id="3408897">map</span><span class="op" id="3408900">[</span><span class="builtintype" id="3408901">string</span><span class="op" id="3408907">]</span><span class="op" id="3408908">[</span><span class="op" id="3408909">]</span><span class="builtintype" id="3408910">string</span><span class="op" id="3408916">)</span><span class="op" id="3408917">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408920">File</span><span class="op" id="3408924">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="3408927">make</span><span class="op" id="3408931">(</span><span class="keyword" id="3408932">map</span><span class="op" id="3408935">[</span><span class="builtintype" id="3408936">string</span><span class="op" id="3408942">]</span><span class="op" id="3408943">[</span><span class="op" id="3408944">]</span><span class="op" id="3408945">*</span><span class="ident" id="3408946">multipart</span><span class="op" id="3408955">.</span><span class="ident" id="3408956">FileHeader</span><span class="op" id="3408966">)</span><span class="op" id="3408967">,</span><br>
<span class="lineno">290</span><span class="op" id="3408969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3408972">//&nbsp;MultipartReader&nbsp;returns&nbsp;a&nbsp;MIME&nbsp;multipart&nbsp;reader&nbsp;if&nbsp;this&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3409036">//&nbsp;multipart/form-data&nbsp;POST&nbsp;request,&nbsp;else&nbsp;returns&nbsp;nil&nbsp;and&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3409104">//&nbsp;Use&nbsp;this&nbsp;function&nbsp;instead&nbsp;of&nbsp;ParseMultipartForm&nbsp;to</span><br>
<span class="lineno">295</span><span class="comment" id="3409158">//&nbsp;process&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="3409199">func</span>&nbsp;<span class="op" id="3409204">(</span><span class="ident" id="3409205">r</span>&nbsp;<span class="op" id="3409207">*</span><span class="ident" id="3409208">Request</span><span class="op" id="3409215">)</span>&nbsp;<span class="ident" id="3409217">MultipartReader</span><span class="op" id="3409232">(</span><span class="op" id="3409233">)</span>&nbsp;<span class="op" id="3409235">(</span><span class="op" id="3409236">*</span><span class="ident" id="3409237">multipart</span><span class="op" id="3409246">.</span><span class="ident" id="3409247">Reader</span><span class="op" id="3409253">,</span>&nbsp;<span class="builtintype" id="3409255">error</span><span class="op" id="3409260">)</span>&nbsp;<span class="op" id="3409262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409265">if</span>&nbsp;<span class="ident" id="3409268">r</span><span class="op" id="3409269">.</span><span class="ident" id="3409270">MultipartForm</span>&nbsp;<span class="op" id="3409284">==</span>&nbsp;<span class="ident" id="3409287">multipartByReader</span>&nbsp;<span class="op" id="3409305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409309">return</span>&nbsp;<span class="ident" id="3409316">nil</span><span class="op" id="3409319">,</span>&nbsp;<span class="ident" id="3409321">errors</span><span class="op" id="3409327">.</span><span class="ident" id="3409328">New</span><span class="op" id="3409331">(</span><span class="string" id="3409332">&#34;http:&nbsp;MultipartReader&nbsp;called&nbsp;twice&#34;</span><span class="op" id="3409368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409371">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409374">if</span>&nbsp;<span class="ident" id="3409377">r</span><span class="op" id="3409378">.</span><span class="ident" id="3409379">MultipartForm</span>&nbsp;<span class="op" id="3409393">!=</span>&nbsp;<span class="ident" id="3409396">nil</span>&nbsp;<span class="op" id="3409400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409404">return</span>&nbsp;<span class="ident" id="3409411">nil</span><span class="op" id="3409414">,</span>&nbsp;<span class="ident" id="3409416">errors</span><span class="op" id="3409422">.</span><span class="ident" id="3409423">New</span><span class="op" id="3409426">(</span><span class="string" id="3409427">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&#34;</span><span class="op" id="3409474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409480">r</span><span class="op" id="3409481">.</span><span class="ident" id="3409482">MultipartForm</span>&nbsp;<span class="op" id="3409496">=</span>&nbsp;<span class="ident" id="3409498">multipartByReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409517">return</span>&nbsp;<span class="ident" id="3409524">r</span><span class="op" id="3409525">.</span><span class="ident" id="3409526">multipartReader</span><span class="op" id="3409541">(</span><span class="op" id="3409542">)</span><br>
<span class="lineno">305</span><span class="op" id="3409544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3409547">func</span>&nbsp;<span class="op" id="3409552">(</span><span class="ident" id="3409553">r</span>&nbsp;<span class="op" id="3409555">*</span><span class="ident" id="3409556">Request</span><span class="op" id="3409563">)</span>&nbsp;<span class="ident" id="3409565">multipartReader</span><span class="op" id="3409580">(</span><span class="op" id="3409581">)</span>&nbsp;<span class="op" id="3409583">(</span><span class="op" id="3409584">*</span><span class="ident" id="3409585">multipart</span><span class="op" id="3409594">.</span><span class="ident" id="3409595">Reader</span><span class="op" id="3409601">,</span>&nbsp;<span class="builtintype" id="3409603">error</span><span class="op" id="3409608">)</span>&nbsp;<span class="op" id="3409610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409613">v</span>&nbsp;<span class="op" id="3409615">:=</span>&nbsp;<span class="ident" id="3409618">r</span><span class="op" id="3409619">.</span><span class="ident" id="3409620">Header</span><span class="op" id="3409626">.</span><span class="ident" id="3409627">Get</span><span class="op" id="3409630">(</span><span class="string" id="3409631">&#34;Content-Type&#34;</span><span class="op" id="3409645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409648">if</span>&nbsp;<span class="ident" id="3409651">v</span>&nbsp;<span class="op" id="3409653">==</span>&nbsp;<span class="string" id="3409656">&#34;&#34;</span>&nbsp;<span class="op" id="3409659">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409663">return</span>&nbsp;<span class="ident" id="3409670">nil</span><span class="op" id="3409673">,</span>&nbsp;<span class="ident" id="3409675">ErrNotMultipart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409695">d</span><span class="op" id="3409696">,</span>&nbsp;<span class="ident" id="3409698">params</span><span class="op" id="3409704">,</span>&nbsp;<span class="ident" id="3409706">err</span>&nbsp;<span class="op" id="3409710">:=</span>&nbsp;<span class="ident" id="3409713">mime</span><span class="op" id="3409717">.</span><span class="ident" id="3409718">ParseMediaType</span><span class="op" id="3409732">(</span><span class="ident" id="3409733">v</span><span class="op" id="3409734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409737">if</span>&nbsp;<span class="ident" id="3409740">err</span>&nbsp;<span class="op" id="3409744">!=</span>&nbsp;<span class="ident" id="3409747">nil</span>&nbsp;<span class="op" id="3409751">||</span>&nbsp;<span class="ident" id="3409754">d</span>&nbsp;<span class="op" id="3409756">!=</span>&nbsp;<span class="string" id="3409759">&#34;multipart/form-data&#34;</span>&nbsp;<span class="op" id="3409781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409785">return</span>&nbsp;<span class="ident" id="3409792">nil</span><span class="op" id="3409795">,</span>&nbsp;<span class="ident" id="3409797">ErrNotMultipart</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409817">boundary</span><span class="op" id="3409825">,</span>&nbsp;<span class="ident" id="3409827">ok</span>&nbsp;<span class="op" id="3409830">:=</span>&nbsp;<span class="ident" id="3409833">params</span><span class="op" id="3409839">[</span><span class="string" id="3409840">&#34;boundary&#34;</span><span class="op" id="3409850">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409853">if</span>&nbsp;<span class="op" id="3409856">!</span><span class="ident" id="3409857">ok</span>&nbsp;<span class="op" id="3409860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409864">return</span>&nbsp;<span class="ident" id="3409871">nil</span><span class="op" id="3409874">,</span>&nbsp;<span class="ident" id="3409876">ErrMissingBoundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409896">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409899">return</span>&nbsp;<span class="ident" id="3409906">multipart</span><span class="op" id="3409915">.</span><span class="ident" id="3409916">NewReader</span><span class="op" id="3409925">(</span><span class="ident" id="3409926">r</span><span class="op" id="3409927">.</span><span class="ident" id="3409928">Body</span><span class="op" id="3409932">,</span>&nbsp;<span class="ident" id="3409934">boundary</span><span class="op" id="3409942">)</span><span class="op" id="3409943">,</span>&nbsp;<span class="ident" id="3409945">nil</span><br>
<span class="lineno"></span><span class="op" id="3409949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3409952">//&nbsp;Return&nbsp;value&nbsp;if&nbsp;nonempty,&nbsp;def&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3409996">func</span>&nbsp;<span class="ident" id="3410001">valueOrDefault</span><span class="op" id="3410015">(</span><span class="ident" id="3410016">value</span><span class="op" id="3410021">,</span>&nbsp;<span class="ident" id="3410023">def</span>&nbsp;<span class="builtintype" id="3410027">string</span><span class="op" id="3410033">)</span>&nbsp;<span class="builtintype" id="3410035">string</span>&nbsp;<span class="op" id="3410042">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410045">if</span>&nbsp;<span class="ident" id="3410048">value</span>&nbsp;<span class="op" id="3410054">!=</span>&nbsp;<span class="string" id="3410057">&#34;&#34;</span>&nbsp;<span class="op" id="3410060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410064">return</span>&nbsp;<span class="ident" id="3410071">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3410078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410081">return</span>&nbsp;<span class="ident" id="3410088">def</span><br>
<span class="lineno"></span><span class="op" id="3410092">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="3410095">//&nbsp;NOTE:&nbsp;This&nbsp;is&nbsp;not&nbsp;intended&nbsp;to&nbsp;reflect&nbsp;the&nbsp;actual&nbsp;Go&nbsp;version&nbsp;being&nbsp;used.</span><br>
<span class="lineno"></span><span class="comment" id="3410170">//&nbsp;It&nbsp;was&nbsp;changed&nbsp;from&nbsp;&#34;Go&nbsp;http&nbsp;package&#34;&nbsp;to&nbsp;&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;&nbsp;at&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3410243">//&nbsp;time&nbsp;of&nbsp;the&nbsp;Go&nbsp;1.1&nbsp;release&nbsp;because&nbsp;the&nbsp;former&nbsp;User-Agent&nbsp;had&nbsp;ended&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="3410316">//&nbsp;on&nbsp;a&nbsp;blacklist&nbsp;for&nbsp;some&nbsp;intrusion&nbsp;detection&nbsp;systems.</span><br>
<span class="lineno">335</span><span class="comment" id="3410372">//&nbsp;See&nbsp;https://codereview.appspot.com/7532043.</span><br>
<span class="lineno"></span><span class="keyword" id="3410419">const</span>&nbsp;<span class="ident" id="3410425">defaultUserAgent</span>&nbsp;<span class="op" id="3410442">=</span>&nbsp;<span class="string" id="3410444">&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3410467">//&nbsp;Write&nbsp;writes&nbsp;an&nbsp;HTTP/1.1&nbsp;request&nbsp;--&nbsp;header&nbsp;and&nbsp;body&nbsp;--&nbsp;in&nbsp;wire&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="3410541">//&nbsp;This&nbsp;method&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;request:</span><br>
<span class="lineno">340</span><span class="comment" id="3410602">//&nbsp;&nbsp;&nbsp;&nbspHost</span><br>
<span class="lineno"></span><span class="comment" id="3410610">//&nbsp;&nbsp;&nbsp;&nbspURL</span><br>
<span class="lineno"></span><span class="comment" id="3410617">//&nbsp;&nbsp;&nbsp;&nbspMethod&nbsp;(defaults&nbsp;to&nbsp;&#34;GET&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3410647">//&nbsp;&nbsp;&nbsp;&nbspHeader</span><br>
<span class="lineno"></span><span class="comment" id="3410657">//&nbsp;&nbsp;&nbsp;&nbspContentLength</span><br>
<span class="lineno">345</span><span class="comment" id="3410674">//&nbsp;&nbsp;&nbsp;&nbspTransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="3410694">//&nbsp;&nbsp;&nbsp;&nbspBody</span><br>
<span class="lineno"></span><span class="comment" id="3410702">//</span><br>
<span class="lineno"></span><span class="comment" id="3410705">//&nbsp;If&nbsp;Body&nbsp;is&nbsp;present,&nbsp;Content-Length&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;and&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="3410772">//&nbsp;hasn&#39;t&nbsp;been&nbsp;set&nbsp;to&nbsp;&#34;identity&#34;,&nbsp;Write&nbsp;adds&nbsp;&#34;Transfer-Encoding:</span><br>
<span class="lineno">350</span><span class="comment" id="3410837">//&nbsp;chunked&#34;&nbsp;to&nbsp;the&nbsp;header.&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="3410897">func</span>&nbsp;<span class="op" id="3410902">(</span><span class="ident" id="3410903">r</span>&nbsp;<span class="op" id="3410905">*</span><span class="ident" id="3410906">Request</span><span class="op" id="3410913">)</span>&nbsp;<span class="ident" id="3410915">Write</span><span class="op" id="3410920">(</span><span class="ident" id="3410921">w</span>&nbsp;<span class="ident" id="3410923">io</span><span class="op" id="3410925">.</span><span class="ident" id="3410926">Writer</span><span class="op" id="3410932">)</span>&nbsp;<span class="builtintype" id="3410934">error</span>&nbsp;<span class="op" id="3410940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410943">return</span>&nbsp;<span class="ident" id="3410950">r</span><span class="op" id="3410951">.</span><span class="ident" id="3410952">write</span><span class="op" id="3410957">(</span><span class="ident" id="3410958">w</span><span class="op" id="3410959">,</span>&nbsp;<span class="builtintype" id="3410961">false</span><span class="op" id="3410966">,</span>&nbsp;<span class="ident" id="3410968">nil</span><span class="op" id="3410971">)</span><br>
<span class="lineno"></span><span class="op" id="3410973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="3410976">//&nbsp;WriteProxy&nbsp;is&nbsp;like&nbsp;Write&nbsp;but&nbsp;writes&nbsp;the&nbsp;request&nbsp;in&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3411039">//&nbsp;expected&nbsp;by&nbsp;an&nbsp;HTTP&nbsp;proxy.&nbsp;&nbsp;In&nbsp;particular,&nbsp;WriteProxy&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3411107">//&nbsp;initial&nbsp;Request-URI&nbsp;line&nbsp;of&nbsp;the&nbsp;request&nbsp;with&nbsp;an&nbsp;absolute&nbsp;URI,&nbsp;per</span><br>
<span class="lineno"></span><span class="comment" id="3411176">//&nbsp;section&nbsp;5.1.2&nbsp;of&nbsp;RFC&nbsp;2616,&nbsp;including&nbsp;the&nbsp;scheme&nbsp;and&nbsp;host.</span><br>
<span class="lineno"></span><span class="comment" id="3411237">//&nbsp;In&nbsp;either&nbsp;case,&nbsp;WriteProxy&nbsp;also&nbsp;writes&nbsp;a&nbsp;Host&nbsp;header,&nbsp;using</span><br>
<span class="lineno">360</span><span class="comment" id="3411300">//&nbsp;either&nbsp;r.Host&nbsp;or&nbsp;r.URL.Host.</span><br>
<span class="lineno"></span><span class="keyword" id="3411332">func</span>&nbsp;<span class="op" id="3411337">(</span><span class="ident" id="3411338">r</span>&nbsp;<span class="op" id="3411340">*</span><span class="ident" id="3411341">Request</span><span class="op" id="3411348">)</span>&nbsp;<span class="ident" id="3411350">WriteProxy</span><span class="op" id="3411360">(</span><span class="ident" id="3411361">w</span>&nbsp;<span class="ident" id="3411363">io</span><span class="op" id="3411365">.</span><span class="ident" id="3411366">Writer</span><span class="op" id="3411372">)</span>&nbsp;<span class="builtintype" id="3411374">error</span>&nbsp;<span class="op" id="3411380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411383">return</span>&nbsp;<span class="ident" id="3411390">r</span><span class="op" id="3411391">.</span><span class="ident" id="3411392">write</span><span class="op" id="3411397">(</span><span class="ident" id="3411398">w</span><span class="op" id="3411399">,</span>&nbsp;<span class="builtintype" id="3411401">true</span><span class="op" id="3411405">,</span>&nbsp;<span class="ident" id="3411407">nil</span><span class="op" id="3411410">)</span><br>
<span class="lineno"></span><span class="op" id="3411412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="3411415">//&nbsp;extraHeaders&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span><span class="keyword" id="3411442">func</span>&nbsp;<span class="op" id="3411447">(</span><span class="ident" id="3411448">req</span>&nbsp;<span class="op" id="3411452">*</span><span class="ident" id="3411453">Request</span><span class="op" id="3411460">)</span>&nbsp;<span class="ident" id="3411462">write</span><span class="op" id="3411467">(</span><span class="ident" id="3411468">w</span>&nbsp;<span class="ident" id="3411470">io</span><span class="op" id="3411472">.</span><span class="ident" id="3411473">Writer</span><span class="op" id="3411479">,</span>&nbsp;<span class="ident" id="3411481">usingProxy</span>&nbsp;<span class="builtintype" id="3411492">bool</span><span class="op" id="3411496">,</span>&nbsp;<span class="ident" id="3411498">extraHeaders</span>&nbsp;<span class="ident" id="3411511">Header</span><span class="op" id="3411517">)</span>&nbsp;<span class="builtintype" id="3411519">error</span>&nbsp;<span class="op" id="3411525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411528">host</span>&nbsp;<span class="op" id="3411533">:=</span>&nbsp;<span class="ident" id="3411536">req</span><span class="op" id="3411539">.</span><span class="ident" id="3411540">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411546">if</span>&nbsp;<span class="ident" id="3411549">host</span>&nbsp;<span class="op" id="3411554">==</span>&nbsp;<span class="string" id="3411557">&#34;&#34;</span>&nbsp;<span class="op" id="3411560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411564">if</span>&nbsp;<span class="ident" id="3411567">req</span><span class="op" id="3411570">.</span><span class="ident" id="3411571">URL</span>&nbsp;<span class="op" id="3411575">==</span>&nbsp;<span class="ident" id="3411578">nil</span>&nbsp;<span class="op" id="3411582">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411587">return</span>&nbsp;<span class="ident" id="3411594">errors</span><span class="op" id="3411600">.</span><span class="ident" id="3411601">New</span><span class="op" id="3411604">(</span><span class="string" id="3411605">&#34;http:&nbsp;Request.Write&nbsp;on&nbsp;Request&nbsp;with&nbsp;no&nbsp;Host&nbsp;or&nbsp;URL&nbsp;set&#34;</span><span class="op" id="3411661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3411665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411669">host</span>&nbsp;<span class="op" id="3411674">=</span>&nbsp;<span class="ident" id="3411676">req</span><span class="op" id="3411679">.</span><span class="ident" id="3411680">URL</span><span class="op" id="3411683">.</span><span class="ident" id="3411684">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3411690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411694">ruri</span>&nbsp;<span class="op" id="3411699">:=</span>&nbsp;<span class="ident" id="3411702">req</span><span class="op" id="3411705">.</span><span class="ident" id="3411706">URL</span><span class="op" id="3411709">.</span><span class="ident" id="3411710">RequestURI</span><span class="op" id="3411720">(</span><span class="op" id="3411721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411724">if</span>&nbsp;<span class="ident" id="3411727">usingProxy</span>&nbsp;<span class="op" id="3411738">&amp;&amp;</span>&nbsp;<span class="ident" id="3411741">req</span><span class="op" id="3411744">.</span><span class="ident" id="3411745">URL</span><span class="op" id="3411748">.</span><span class="ident" id="3411749">Scheme</span>&nbsp;<span class="op" id="3411756">!=</span>&nbsp;<span class="string" id="3411759">&#34;&#34;</span>&nbsp;<span class="op" id="3411762">&amp;&amp;</span>&nbsp;<span class="ident" id="3411765">req</span><span class="op" id="3411768">.</span><span class="ident" id="3411769">URL</span><span class="op" id="3411772">.</span><span class="ident" id="3411773">Opaque</span>&nbsp;<span class="op" id="3411780">==</span>&nbsp;<span class="string" id="3411783">&#34;&#34;</span>&nbsp;<span class="op" id="3411786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411790">ruri</span>&nbsp;<span class="op" id="3411795">=</span>&nbsp;<span class="ident" id="3411797">req</span><span class="op" id="3411800">.</span><span class="ident" id="3411801">URL</span><span class="op" id="3411804">.</span><span class="ident" id="3411805">Scheme</span>&nbsp;<span class="op" id="3411812">+</span>&nbsp;<span class="string" id="3411814">&#34;://&#34;</span>&nbsp;<span class="op" id="3411820">+</span>&nbsp;<span class="ident" id="3411822">host</span>&nbsp;<span class="op" id="3411827">+</span>&nbsp;<span class="ident" id="3411829">ruri</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3411835">}</span>&nbsp;<span class="keyword" id="3411837">else</span>&nbsp;<span class="keyword" id="3411842">if</span>&nbsp;<span class="ident" id="3411845">req</span><span class="op" id="3411848">.</span><span class="ident" id="3411849">Method</span>&nbsp;<span class="op" id="3411856">==</span>&nbsp;<span class="string" id="3411859">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="3411869">&amp;&amp;</span>&nbsp;<span class="ident" id="3411872">req</span><span class="op" id="3411875">.</span><span class="ident" id="3411876">URL</span><span class="op" id="3411879">.</span><span class="ident" id="3411880">Path</span>&nbsp;<span class="op" id="3411885">==</span>&nbsp;<span class="string" id="3411888">&#34;&#34;</span>&nbsp;<span class="op" id="3411891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3411895">//&nbsp;CONNECT&nbsp;requests&nbsp;normally&nbsp;give&nbsp;just&nbsp;the&nbsp;host&nbsp;and&nbsp;port,&nbsp;not&nbsp;a&nbsp;full&nbsp;URL.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411971">ruri</span>&nbsp;<span class="op" id="3411976">=</span>&nbsp;<span class="ident" id="3411978">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3411984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3411987">//&nbsp;TODO(bradfitz):&nbsp;escape&nbsp;at&nbsp;least&nbsp;newlines&nbsp;in&nbsp;ruri?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3412042">//&nbsp;Wrap&nbsp;the&nbsp;writer&nbsp;in&nbsp;a&nbsp;bufio&nbsp;Writer&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;already&nbsp;buffered.</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3412110">//&nbsp;Don&#39;t&nbsp;always&nbsp;call&nbsp;NewWriter,&nbsp;as&nbsp;that&nbsp;forces&nbsp;a&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3412173">//&nbsp;and&nbsp;other&nbsp;small&nbsp;bufio&nbsp;Writers&nbsp;to&nbsp;have&nbsp;a&nbsp;minimum&nbsp;4k&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3412235">//&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412245">var</span>&nbsp;<span class="ident" id="3412249">bw</span>&nbsp;<span class="op" id="3412252">*</span><span class="ident" id="3412253">bufio</span><span class="op" id="3412258">.</span><span class="ident" id="3412259">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412267">if</span>&nbsp;<span class="ident" id="3412270">_</span><span class="op" id="3412271">,</span>&nbsp;<span class="ident" id="3412273">ok</span>&nbsp;<span class="op" id="3412276">:=</span>&nbsp;<span class="ident" id="3412279">w</span><span class="op" id="3412280">.</span><span class="op" id="3412281">(</span><span class="ident" id="3412282">io</span><span class="op" id="3412284">.</span><span class="ident" id="3412285">ByteWriter</span><span class="op" id="3412295">)</span><span class="op" id="3412296">;</span>&nbsp;<span class="op" id="3412298">!</span><span class="ident" id="3412299">ok</span>&nbsp;<span class="op" id="3412302">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412306">bw</span>&nbsp;<span class="op" id="3412309">=</span>&nbsp;<span class="ident" id="3412311">bufio</span><span class="op" id="3412316">.</span><span class="ident" id="3412317">NewWriter</span><span class="op" id="3412326">(</span><span class="ident" id="3412327">w</span><span class="op" id="3412328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412332">w</span>&nbsp;<span class="op" id="3412334">=</span>&nbsp;<span class="ident" id="3412336">bw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412344">_</span><span class="op" id="3412345">,</span>&nbsp;<span class="ident" id="3412347">err</span>&nbsp;<span class="op" id="3412351">:=</span>&nbsp;<span class="ident" id="3412354">fmt</span><span class="op" id="3412357">.</span><span class="ident" id="3412358">Fprintf</span><span class="op" id="3412365">(</span><span class="ident" id="3412366">w</span><span class="op" id="3412367">,</span>&nbsp;<span class="string" id="3412369">&#34;%s&nbsp;%s&nbsp;HTTP/1.1\r\n&#34;</span><span class="op" id="3412389">,</span>&nbsp;<span class="ident" id="3412391">valueOrDefault</span><span class="op" id="3412405">(</span><span class="ident" id="3412406">req</span><span class="op" id="3412409">.</span><span class="ident" id="3412410">Method</span><span class="op" id="3412416">,</span>&nbsp;<span class="string" id="3412418">&#34;GET&#34;</span><span class="op" id="3412423">)</span><span class="op" id="3412424">,</span>&nbsp;<span class="ident" id="3412426">ruri</span><span class="op" id="3412430">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412433">if</span>&nbsp;<span class="ident" id="3412436">err</span>&nbsp;<span class="op" id="3412440">!=</span>&nbsp;<span class="ident" id="3412443">nil</span>&nbsp;<span class="op" id="3412447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412451">return</span>&nbsp;<span class="ident" id="3412458">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3412467">//&nbsp;Header&nbsp;lines</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412484">_</span><span class="op" id="3412485">,</span>&nbsp;<span class="ident" id="3412487">err</span>&nbsp;<span class="op" id="3412491">=</span>&nbsp;<span class="ident" id="3412493">fmt</span><span class="op" id="3412496">.</span><span class="ident" id="3412497">Fprintf</span><span class="op" id="3412504">(</span><span class="ident" id="3412505">w</span><span class="op" id="3412506">,</span>&nbsp;<span class="string" id="3412508">&#34;Host:&nbsp;%s\r\n&#34;</span><span class="op" id="3412522">,</span>&nbsp;<span class="ident" id="3412524">host</span><span class="op" id="3412528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412531">if</span>&nbsp;<span class="ident" id="3412534">err</span>&nbsp;<span class="op" id="3412538">!=</span>&nbsp;<span class="ident" id="3412541">nil</span>&nbsp;<span class="op" id="3412545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412549">return</span>&nbsp;<span class="ident" id="3412556">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3412565">//&nbsp;Use&nbsp;the&nbsp;defaultUserAgent&nbsp;unless&nbsp;the&nbsp;Header&nbsp;contains&nbsp;one,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3412632">//&nbsp;may&nbsp;be&nbsp;blank&nbsp;to&nbsp;not&nbsp;send&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412673">userAgent</span>&nbsp;<span class="op" id="3412683">:=</span>&nbsp;<span class="ident" id="3412686">defaultUserAgent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412704">if</span>&nbsp;<span class="ident" id="3412707">req</span><span class="op" id="3412710">.</span><span class="ident" id="3412711">Header</span>&nbsp;<span class="op" id="3412718">!=</span>&nbsp;<span class="ident" id="3412721">nil</span>&nbsp;<span class="op" id="3412725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412729">if</span>&nbsp;<span class="ident" id="3412732">ua</span>&nbsp;<span class="op" id="3412735">:=</span>&nbsp;<span class="ident" id="3412738">req</span><span class="op" id="3412741">.</span><span class="ident" id="3412742">Header</span><span class="op" id="3412748">[</span><span class="string" id="3412749">&#34;User-Agent&#34;</span><span class="op" id="3412761">]</span><span class="op" id="3412762">;</span>&nbsp;<span class="builtinfunc" id="3412764">len</span><span class="op" id="3412767">(</span><span class="ident" id="3412768">ua</span><span class="op" id="3412770">)</span>&nbsp;<span class="op" id="3412772">&gt;</span>&nbsp;<span class="num" id="3412774">0</span>&nbsp;<span class="op" id="3412776">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412781">userAgent</span>&nbsp;<span class="op" id="3412791">=</span>&nbsp;<span class="ident" id="3412793">ua</span><span class="op" id="3412795">[</span><span class="num" id="3412796">0</span><span class="op" id="3412797">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412807">if</span>&nbsp;<span class="ident" id="3412810">userAgent</span>&nbsp;<span class="op" id="3412820">!=</span>&nbsp;<span class="string" id="3412823">&#34;&#34;</span>&nbsp;<span class="op" id="3412826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412830">_</span><span class="op" id="3412831">,</span>&nbsp;<span class="ident" id="3412833">err</span>&nbsp;<span class="op" id="3412837">=</span>&nbsp;<span class="ident" id="3412839">fmt</span><span class="op" id="3412842">.</span><span class="ident" id="3412843">Fprintf</span><span class="op" id="3412850">(</span><span class="ident" id="3412851">w</span><span class="op" id="3412852">,</span>&nbsp;<span class="string" id="3412854">&#34;User-Agent:&nbsp;%s\r\n&#34;</span><span class="op" id="3412874">,</span>&nbsp;<span class="ident" id="3412876">userAgent</span><span class="op" id="3412885">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412889">if</span>&nbsp;<span class="ident" id="3412892">err</span>&nbsp;<span class="op" id="3412896">!=</span>&nbsp;<span class="ident" id="3412899">nil</span>&nbsp;<span class="op" id="3412903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412908">return</span>&nbsp;<span class="ident" id="3412915">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3412928">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412973">tw</span><span class="op" id="3412975">,</span>&nbsp;<span class="ident" id="3412977">err</span>&nbsp;<span class="op" id="3412981">:=</span>&nbsp;<span class="ident" id="3412984">newTransferWriter</span><span class="op" id="3413001">(</span><span class="ident" id="3413002">req</span><span class="op" id="3413005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413008">if</span>&nbsp;<span class="ident" id="3413011">err</span>&nbsp;<span class="op" id="3413015">!=</span>&nbsp;<span class="ident" id="3413018">nil</span>&nbsp;<span class="op" id="3413022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413026">return</span>&nbsp;<span class="ident" id="3413033">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413038">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413041">err</span>&nbsp;<span class="op" id="3413045">=</span>&nbsp;<span class="ident" id="3413047">tw</span><span class="op" id="3413049">.</span><span class="ident" id="3413050">WriteHeader</span><span class="op" id="3413061">(</span><span class="ident" id="3413062">w</span><span class="op" id="3413063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413066">if</span>&nbsp;<span class="ident" id="3413069">err</span>&nbsp;<span class="op" id="3413073">!=</span>&nbsp;<span class="ident" id="3413076">nil</span>&nbsp;<span class="op" id="3413080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413084">return</span>&nbsp;<span class="ident" id="3413091">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413100">err</span>&nbsp;<span class="op" id="3413104">=</span>&nbsp;<span class="ident" id="3413106">req</span><span class="op" id="3413109">.</span><span class="ident" id="3413110">Header</span><span class="op" id="3413116">.</span><span class="ident" id="3413117">WriteSubset</span><span class="op" id="3413128">(</span><span class="ident" id="3413129">w</span><span class="op" id="3413130">,</span>&nbsp;<span class="ident" id="3413132">reqWriteExcludeHeader</span><span class="op" id="3413153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413156">if</span>&nbsp;<span class="ident" id="3413159">err</span>&nbsp;<span class="op" id="3413163">!=</span>&nbsp;<span class="ident" id="3413166">nil</span>&nbsp;<span class="op" id="3413170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413174">return</span>&nbsp;<span class="ident" id="3413181">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413190">if</span>&nbsp;<span class="ident" id="3413193">extraHeaders</span>&nbsp;<span class="op" id="3413206">!=</span>&nbsp;<span class="ident" id="3413209">nil</span>&nbsp;<span class="op" id="3413213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413217">err</span>&nbsp;<span class="op" id="3413221">=</span>&nbsp;<span class="ident" id="3413223">extraHeaders</span><span class="op" id="3413235">.</span><span class="ident" id="3413236">Write</span><span class="op" id="3413241">(</span><span class="ident" id="3413242">w</span><span class="op" id="3413243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413247">if</span>&nbsp;<span class="ident" id="3413250">err</span>&nbsp;<span class="op" id="3413254">!=</span>&nbsp;<span class="ident" id="3413257">nil</span>&nbsp;<span class="op" id="3413261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413266">return</span>&nbsp;<span class="ident" id="3413273">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413279">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413286">_</span><span class="op" id="3413287">,</span>&nbsp;<span class="ident" id="3413289">err</span>&nbsp;<span class="op" id="3413293">=</span>&nbsp;<span class="ident" id="3413295">io</span><span class="op" id="3413297">.</span><span class="ident" id="3413298">WriteString</span><span class="op" id="3413309">(</span><span class="ident" id="3413310">w</span><span class="op" id="3413311">,</span>&nbsp;<span class="string" id="3413313">&#34;\r\n&#34;</span><span class="op" id="3413319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413322">if</span>&nbsp;<span class="ident" id="3413325">err</span>&nbsp;<span class="op" id="3413329">!=</span>&nbsp;<span class="ident" id="3413332">nil</span>&nbsp;<span class="op" id="3413336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413340">return</span>&nbsp;<span class="ident" id="3413347">err</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3413356">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413383">err</span>&nbsp;<span class="op" id="3413387">=</span>&nbsp;<span class="ident" id="3413389">tw</span><span class="op" id="3413391">.</span><span class="ident" id="3413392">WriteBody</span><span class="op" id="3413401">(</span><span class="ident" id="3413402">w</span><span class="op" id="3413403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413406">if</span>&nbsp;<span class="ident" id="3413409">err</span>&nbsp;<span class="op" id="3413413">!=</span>&nbsp;<span class="ident" id="3413416">nil</span>&nbsp;<span class="op" id="3413420">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413424">return</span>&nbsp;<span class="ident" id="3413431">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413440">if</span>&nbsp;<span class="ident" id="3413443">bw</span>&nbsp;<span class="op" id="3413446">!=</span>&nbsp;<span class="ident" id="3413449">nil</span>&nbsp;<span class="op" id="3413453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413457">return</span>&nbsp;<span class="ident" id="3413464">bw</span><span class="op" id="3413466">.</span><span class="ident" id="3413467">Flush</span><span class="op" id="3413472">(</span><span class="op" id="3413473">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413479">return</span>&nbsp;<span class="ident" id="3413486">nil</span><br>
<span class="lineno"></span><span class="op" id="3413490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3413493">//&nbsp;ParseHTTPVersion&nbsp;parses&nbsp;a&nbsp;HTTP&nbsp;version&nbsp;string.</span><br>
<span class="lineno">460</span><span class="comment" id="3413543">//&nbsp;&#34;HTTP/1.0&#34;&nbsp;returns&nbsp;(1,&nbsp;0,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="3413579">func</span>&nbsp;<span class="ident" id="3413584">ParseHTTPVersion</span><span class="op" id="3413600">(</span><span class="ident" id="3413601">vers</span>&nbsp;<span class="builtintype" id="3413606">string</span><span class="op" id="3413612">)</span>&nbsp;<span class="op" id="3413614">(</span><span class="ident" id="3413615">major</span><span class="op" id="3413620">,</span>&nbsp;<span class="ident" id="3413622">minor</span>&nbsp;<span class="builtintype" id="3413628">int</span><span class="op" id="3413631">,</span>&nbsp;<span class="ident" id="3413633">ok</span>&nbsp;<span class="builtintype" id="3413636">bool</span><span class="op" id="3413640">)</span>&nbsp;<span class="op" id="3413642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413645">const</span>&nbsp;<span class="ident" id="3413651">Big</span>&nbsp;<span class="op" id="3413655">=</span>&nbsp;<span class="num" id="3413657">1000000</span>&nbsp;<span class="comment" id="3413665">//&nbsp;arbitrary&nbsp;upper&nbsp;bound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413691">switch</span>&nbsp;<span class="ident" id="3413698">vers</span>&nbsp;<span class="op" id="3413703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413706">case</span>&nbsp;<span class="string" id="3413711">&#34;HTTP/1.1&#34;</span><span class="op" id="3413721">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413725">return</span>&nbsp;<span class="num" id="3413732">1</span><span class="op" id="3413733">,</span>&nbsp;<span class="num" id="3413735">1</span><span class="op" id="3413736">,</span>&nbsp;<span class="builtintype" id="3413738">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413744">case</span>&nbsp;<span class="string" id="3413749">&#34;HTTP/1.0&#34;</span><span class="op" id="3413759">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413763">return</span>&nbsp;<span class="num" id="3413770">1</span><span class="op" id="3413771">,</span>&nbsp;<span class="num" id="3413773">0</span><span class="op" id="3413774">,</span>&nbsp;<span class="builtintype" id="3413776">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413785">if</span>&nbsp;<span class="op" id="3413788">!</span><span class="ident" id="3413789">strings</span><span class="op" id="3413796">.</span><span class="ident" id="3413797">HasPrefix</span><span class="op" id="3413806">(</span><span class="ident" id="3413807">vers</span><span class="op" id="3413811">,</span>&nbsp;<span class="string" id="3413813">&#34;HTTP/&#34;</span><span class="op" id="3413820">)</span>&nbsp;<span class="op" id="3413822">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413826">return</span>&nbsp;<span class="num" id="3413833">0</span><span class="op" id="3413834">,</span>&nbsp;<span class="num" id="3413836">0</span><span class="op" id="3413837">,</span>&nbsp;<span class="builtintype" id="3413839">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413849">dot</span>&nbsp;<span class="op" id="3413853">:=</span>&nbsp;<span class="ident" id="3413856">strings</span><span class="op" id="3413863">.</span><span class="ident" id="3413864">Index</span><span class="op" id="3413869">(</span><span class="ident" id="3413870">vers</span><span class="op" id="3413874">,</span>&nbsp;<span class="string" id="3413876">&#34;.&#34;</span><span class="op" id="3413879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413882">if</span>&nbsp;<span class="ident" id="3413885">dot</span>&nbsp;<span class="op" id="3413889">&lt;</span>&nbsp;<span class="num" id="3413891">0</span>&nbsp;<span class="op" id="3413893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413897">return</span>&nbsp;<span class="num" id="3413904">0</span><span class="op" id="3413905">,</span>&nbsp;<span class="num" id="3413907">0</span><span class="op" id="3413908">,</span>&nbsp;<span class="builtintype" id="3413910">false</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413920">major</span><span class="op" id="3413925">,</span>&nbsp;<span class="ident" id="3413927">err</span>&nbsp;<span class="op" id="3413931">:=</span>&nbsp;<span class="ident" id="3413934">strconv</span><span class="op" id="3413941">.</span><span class="ident" id="3413942">Atoi</span><span class="op" id="3413946">(</span><span class="ident" id="3413947">vers</span><span class="op" id="3413951">[</span><span class="num" id="3413952">5</span><span class="op" id="3413953">:</span><span class="ident" id="3413954">dot</span><span class="op" id="3413957">]</span><span class="op" id="3413958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413961">if</span>&nbsp;<span class="ident" id="3413964">err</span>&nbsp;<span class="op" id="3413968">!=</span>&nbsp;<span class="ident" id="3413971">nil</span>&nbsp;<span class="op" id="3413975">||</span>&nbsp;<span class="ident" id="3413978">major</span>&nbsp;<span class="op" id="3413984">&lt;</span>&nbsp;<span class="num" id="3413986">0</span>&nbsp;<span class="op" id="3413988">||</span>&nbsp;<span class="ident" id="3413991">major</span>&nbsp;<span class="op" id="3413997">&gt;</span>&nbsp;<span class="ident" id="3413999">Big</span>&nbsp;<span class="op" id="3414003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414007">return</span>&nbsp;<span class="num" id="3414014">0</span><span class="op" id="3414015">,</span>&nbsp;<span class="num" id="3414017">0</span><span class="op" id="3414018">,</span>&nbsp;<span class="builtintype" id="3414020">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414027">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414030">minor</span><span class="op" id="3414035">,</span>&nbsp;<span class="ident" id="3414037">err</span>&nbsp;<span class="op" id="3414041">=</span>&nbsp;<span class="ident" id="3414043">strconv</span><span class="op" id="3414050">.</span><span class="ident" id="3414051">Atoi</span><span class="op" id="3414055">(</span><span class="ident" id="3414056">vers</span><span class="op" id="3414060">[</span><span class="ident" id="3414061">dot</span><span class="op" id="3414064">+</span><span class="num" id="3414065">1</span><span class="op" id="3414066">:</span><span class="op" id="3414067">]</span><span class="op" id="3414068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414071">if</span>&nbsp;<span class="ident" id="3414074">err</span>&nbsp;<span class="op" id="3414078">!=</span>&nbsp;<span class="ident" id="3414081">nil</span>&nbsp;<span class="op" id="3414085">||</span>&nbsp;<span class="ident" id="3414088">minor</span>&nbsp;<span class="op" id="3414094">&lt;</span>&nbsp;<span class="num" id="3414096">0</span>&nbsp;<span class="op" id="3414098">||</span>&nbsp;<span class="ident" id="3414101">minor</span>&nbsp;<span class="op" id="3414107">&gt;</span>&nbsp;<span class="ident" id="3414109">Big</span>&nbsp;<span class="op" id="3414113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414117">return</span>&nbsp;<span class="num" id="3414124">0</span><span class="op" id="3414125">,</span>&nbsp;<span class="num" id="3414127">0</span><span class="op" id="3414128">,</span>&nbsp;<span class="builtintype" id="3414130">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414140">return</span>&nbsp;<span class="ident" id="3414147">major</span><span class="op" id="3414152">,</span>&nbsp;<span class="ident" id="3414154">minor</span><span class="op" id="3414159">,</span>&nbsp;<span class="builtintype" id="3414161">true</span><br>
<span class="lineno">485</span><span class="op" id="3414166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3414169">//&nbsp;NewRequest&nbsp;returns&nbsp;a&nbsp;new&nbsp;Request&nbsp;given&nbsp;a&nbsp;method,&nbsp;URL,&nbsp;and&nbsp;optional&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="3414245">//</span><br>
<span class="lineno"></span><span class="comment" id="3414248">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;the&nbsp;returned</span><br>
<span class="lineno">490</span><span class="comment" id="3414307">//&nbsp;Request.Body&nbsp;is&nbsp;set&nbsp;to&nbsp;body&nbsp;and&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;Client</span><br>
<span class="lineno"></span><span class="comment" id="3414371">//&nbsp;methods&nbsp;Do,&nbsp;Post,&nbsp;and&nbsp;PostForm,&nbsp;and&nbsp;Transport.RoundTrip.</span><br>
<span class="lineno"></span><span class="keyword" id="3414431">func</span>&nbsp;<span class="ident" id="3414436">NewRequest</span><span class="op" id="3414446">(</span><span class="ident" id="3414447">method</span><span class="op" id="3414453">,</span>&nbsp;<span class="ident" id="3414455">urlStr</span>&nbsp;<span class="builtintype" id="3414462">string</span><span class="op" id="3414468">,</span>&nbsp;<span class="ident" id="3414470">body</span>&nbsp;<span class="ident" id="3414475">io</span><span class="op" id="3414477">.</span><span class="ident" id="3414478">Reader</span><span class="op" id="3414484">)</span>&nbsp;<span class="op" id="3414486">(</span><span class="op" id="3414487">*</span><span class="ident" id="3414488">Request</span><span class="op" id="3414495">,</span>&nbsp;<span class="builtintype" id="3414497">error</span><span class="op" id="3414502">)</span>&nbsp;<span class="op" id="3414504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414507">u</span><span class="op" id="3414508">,</span>&nbsp;<span class="ident" id="3414510">err</span>&nbsp;<span class="op" id="3414514">:=</span>&nbsp;<span class="ident" id="3414517">url</span><span class="op" id="3414520">.</span><span class="ident" id="3414521">Parse</span><span class="op" id="3414526">(</span><span class="ident" id="3414527">urlStr</span><span class="op" id="3414533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414536">if</span>&nbsp;<span class="ident" id="3414539">err</span>&nbsp;<span class="op" id="3414543">!=</span>&nbsp;<span class="ident" id="3414546">nil</span>&nbsp;<span class="op" id="3414550">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414554">return</span>&nbsp;<span class="ident" id="3414561">nil</span><span class="op" id="3414564">,</span>&nbsp;<span class="ident" id="3414566">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414574">rc</span><span class="op" id="3414576">,</span>&nbsp;<span class="ident" id="3414578">ok</span>&nbsp;<span class="op" id="3414581">:=</span>&nbsp;<span class="ident" id="3414584">body</span><span class="op" id="3414588">.</span><span class="op" id="3414589">(</span><span class="ident" id="3414590">io</span><span class="op" id="3414592">.</span><span class="ident" id="3414593">ReadCloser</span><span class="op" id="3414603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414606">if</span>&nbsp;<span class="op" id="3414609">!</span><span class="ident" id="3414610">ok</span>&nbsp;<span class="op" id="3414613">&amp;&amp;</span>&nbsp;<span class="ident" id="3414616">body</span>&nbsp;<span class="op" id="3414621">!=</span>&nbsp;<span class="ident" id="3414624">nil</span>&nbsp;<span class="op" id="3414628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414632">rc</span>&nbsp;<span class="op" id="3414635">=</span>&nbsp;<span class="ident" id="3414637">ioutil</span><span class="op" id="3414643">.</span><span class="ident" id="3414644">NopCloser</span><span class="op" id="3414653">(</span><span class="ident" id="3414654">body</span><span class="op" id="3414658">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414664">req</span>&nbsp;<span class="op" id="3414668">:=</span>&nbsp;<span class="op" id="3414671">&amp;</span><span class="ident" id="3414672">Request</span><span class="op" id="3414679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414683">Method</span><span class="op" id="3414689">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3414695">method</span><span class="op" id="3414701">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414705">URL</span><span class="op" id="3414708">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3414717">u</span><span class="op" id="3414718">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414722">Proto</span><span class="op" id="3414727">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3414734">&#34;HTTP/1.1&#34;</span><span class="op" id="3414744">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414748">ProtoMajor</span><span class="op" id="3414758">:</span>&nbsp;<span class="num" id="3414760">1</span><span class="op" id="3414761">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414765">ProtoMinor</span><span class="op" id="3414775">:</span>&nbsp;<span class="num" id="3414777">1</span><span class="op" id="3414778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414782">Header</span><span class="op" id="3414788">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3414794">make</span><span class="op" id="3414798">(</span><span class="ident" id="3414799">Header</span><span class="op" id="3414805">)</span><span class="op" id="3414806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414810">Body</span><span class="op" id="3414814">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3414822">rc</span><span class="op" id="3414824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414828">Host</span><span class="op" id="3414832">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3414840">u</span><span class="op" id="3414841">.</span><span class="ident" id="3414842">Host</span><span class="op" id="3414846">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414852">if</span>&nbsp;<span class="ident" id="3414855">body</span>&nbsp;<span class="op" id="3414860">!=</span>&nbsp;<span class="ident" id="3414863">nil</span>&nbsp;<span class="op" id="3414867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414871">switch</span>&nbsp;<span class="ident" id="3414878">v</span>&nbsp;<span class="op" id="3414880">:=</span>&nbsp;<span class="ident" id="3414883">body</span><span class="op" id="3414887">.</span><span class="op" id="3414888">(</span><span class="keyword" id="3414889">type</span><span class="op" id="3414893">)</span>&nbsp;<span class="op" id="3414895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414899">case</span>&nbsp;<span class="op" id="3414904">*</span><span class="ident" id="3414905">bytes</span><span class="op" id="3414910">.</span><span class="ident" id="3414911">Buffer</span><span class="op" id="3414917">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414922">req</span><span class="op" id="3414925">.</span><span class="ident" id="3414926">ContentLength</span>&nbsp;<span class="op" id="3414940">=</span>&nbsp;<span class="ident" id="3414942">int64</span><span class="op" id="3414947">(</span><span class="ident" id="3414948">v</span><span class="op" id="3414949">.</span><span class="ident" id="3414950">Len</span><span class="op" id="3414953">(</span><span class="op" id="3414954">)</span><span class="op" id="3414955">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414959">case</span>&nbsp;<span class="op" id="3414964">*</span><span class="ident" id="3414965">bytes</span><span class="op" id="3414970">.</span><span class="ident" id="3414971">Reader</span><span class="op" id="3414977">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414982">req</span><span class="op" id="3414985">.</span><span class="ident" id="3414986">ContentLength</span>&nbsp;<span class="op" id="3415000">=</span>&nbsp;<span class="ident" id="3415002">int64</span><span class="op" id="3415007">(</span><span class="ident" id="3415008">v</span><span class="op" id="3415009">.</span><span class="ident" id="3415010">Len</span><span class="op" id="3415013">(</span><span class="op" id="3415014">)</span><span class="op" id="3415015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415019">case</span>&nbsp;<span class="op" id="3415024">*</span><span class="ident" id="3415025">strings</span><span class="op" id="3415032">.</span><span class="ident" id="3415033">Reader</span><span class="op" id="3415039">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415044">req</span><span class="op" id="3415047">.</span><span class="ident" id="3415048">ContentLength</span>&nbsp;<span class="op" id="3415062">=</span>&nbsp;<span class="ident" id="3415064">int64</span><span class="op" id="3415069">(</span><span class="ident" id="3415070">v</span><span class="op" id="3415071">.</span><span class="ident" id="3415072">Len</span><span class="op" id="3415075">(</span><span class="op" id="3415076">)</span><span class="op" id="3415077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415081">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415088">return</span>&nbsp;<span class="ident" id="3415095">req</span><span class="op" id="3415098">,</span>&nbsp;<span class="ident" id="3415100">nil</span><br>
<span class="lineno"></span><span class="op" id="3415104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="comment" id="3415107">//&nbsp;BasicAuth&nbsp;returns&nbsp;the&nbsp;username&nbsp;and&nbsp;password&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3415180">//&nbsp;Authorization&nbsp;header,&nbsp;if&nbsp;the&nbsp;request&nbsp;uses&nbsp;HTTP&nbsp;Basic&nbsp;Authentication.</span><br>
<span class="lineno"></span><span class="comment" id="3415252">//&nbsp;See&nbsp;RFC&nbsp;2617,&nbsp;Section&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="3415280">func</span>&nbsp;<span class="op" id="3415285">(</span><span class="ident" id="3415286">r</span>&nbsp;<span class="op" id="3415288">*</span><span class="ident" id="3415289">Request</span><span class="op" id="3415296">)</span>&nbsp;<span class="ident" id="3415298">BasicAuth</span><span class="op" id="3415307">(</span><span class="op" id="3415308">)</span>&nbsp;<span class="op" id="3415310">(</span><span class="ident" id="3415311">username</span><span class="op" id="3415319">,</span>&nbsp;<span class="ident" id="3415321">password</span>&nbsp;<span class="builtintype" id="3415330">string</span><span class="op" id="3415336">,</span>&nbsp;<span class="ident" id="3415338">ok</span>&nbsp;<span class="builtintype" id="3415341">bool</span><span class="op" id="3415345">)</span>&nbsp;<span class="op" id="3415347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415350">auth</span>&nbsp;<span class="op" id="3415355">:=</span>&nbsp;<span class="ident" id="3415358">r</span><span class="op" id="3415359">.</span><span class="ident" id="3415360">Header</span><span class="op" id="3415366">.</span><span class="ident" id="3415367">Get</span><span class="op" id="3415370">(</span><span class="string" id="3415371">&#34;Authorization&#34;</span><span class="op" id="3415386">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415389">if</span>&nbsp;<span class="ident" id="3415392">auth</span>&nbsp;<span class="op" id="3415397">==</span>&nbsp;<span class="string" id="3415400">&#34;&#34;</span>&nbsp;<span class="op" id="3415403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415407">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415418">return</span>&nbsp;<span class="ident" id="3415425">parseBasicAuth</span><span class="op" id="3415439">(</span><span class="ident" id="3415440">auth</span><span class="op" id="3415444">)</span><br>
<span class="lineno"></span><span class="op" id="3415446">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span><span class="comment" id="3415449">//&nbsp;parseBasicAuth&nbsp;parses&nbsp;an&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3415511">//&nbsp;&#34;Basic&nbsp;QWxhZGRpbjpvcGVuIHNlc2FtZQ==&#34;&nbsp;returns&nbsp;(&#34;Aladdin&#34;,&nbsp;&#34;open&nbsp;sesame&#34;,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="3415593">func</span>&nbsp;<span class="ident" id="3415598">parseBasicAuth</span><span class="op" id="3415612">(</span><span class="ident" id="3415613">auth</span>&nbsp;<span class="builtintype" id="3415618">string</span><span class="op" id="3415624">)</span>&nbsp;<span class="op" id="3415626">(</span><span class="ident" id="3415627">username</span><span class="op" id="3415635">,</span>&nbsp;<span class="ident" id="3415637">password</span>&nbsp;<span class="builtintype" id="3415646">string</span><span class="op" id="3415652">,</span>&nbsp;<span class="ident" id="3415654">ok</span>&nbsp;<span class="builtintype" id="3415657">bool</span><span class="op" id="3415661">)</span>&nbsp;<span class="op" id="3415663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415666">if</span>&nbsp;<span class="op" id="3415669">!</span><span class="ident" id="3415670">strings</span><span class="op" id="3415677">.</span><span class="ident" id="3415678">HasPrefix</span><span class="op" id="3415687">(</span><span class="ident" id="3415688">auth</span><span class="op" id="3415692">,</span>&nbsp;<span class="string" id="3415694">&#34;Basic&nbsp;&#34;</span><span class="op" id="3415702">)</span>&nbsp;<span class="op" id="3415704">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415708">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415719">c</span><span class="op" id="3415720">,</span>&nbsp;<span class="ident" id="3415722">err</span>&nbsp;<span class="op" id="3415726">:=</span>&nbsp;<span class="ident" id="3415729">base64</span><span class="op" id="3415735">.</span><span class="ident" id="3415736">StdEncoding</span><span class="op" id="3415747">.</span><span class="ident" id="3415748">DecodeString</span><span class="op" id="3415760">(</span><span class="ident" id="3415761">strings</span><span class="op" id="3415768">.</span><span class="ident" id="3415769">TrimPrefix</span><span class="op" id="3415779">(</span><span class="ident" id="3415780">auth</span><span class="op" id="3415784">,</span>&nbsp;<span class="string" id="3415786">&#34;Basic&nbsp;&#34;</span><span class="op" id="3415794">)</span><span class="op" id="3415795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415798">if</span>&nbsp;<span class="ident" id="3415801">err</span>&nbsp;<span class="op" id="3415805">!=</span>&nbsp;<span class="ident" id="3415808">nil</span>&nbsp;<span class="op" id="3415812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415816">return</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415827">cs</span>&nbsp;<span class="op" id="3415830">:=</span>&nbsp;<span class="builtintype" id="3415833">string</span><span class="op" id="3415839">(</span><span class="ident" id="3415840">c</span><span class="op" id="3415841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415844">s</span>&nbsp;<span class="op" id="3415846">:=</span>&nbsp;<span class="ident" id="3415849">strings</span><span class="op" id="3415856">.</span><span class="ident" id="3415857">IndexByte</span><span class="op" id="3415866">(</span><span class="ident" id="3415867">cs</span><span class="op" id="3415869">,</span>&nbsp;<span class="string" id="3415871">&#39;:&#39;</span><span class="op" id="3415874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415877">if</span>&nbsp;<span class="ident" id="3415880">s</span>&nbsp;<span class="op" id="3415882">&lt;</span>&nbsp;<span class="num" id="3415884">0</span>&nbsp;<span class="op" id="3415886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415890">return</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415901">return</span>&nbsp;<span class="ident" id="3415908">cs</span><span class="op" id="3415910">[</span><span class="op" id="3415911">:</span><span class="ident" id="3415912">s</span><span class="op" id="3415913">]</span><span class="op" id="3415914">,</span>&nbsp;<span class="ident" id="3415916">cs</span><span class="op" id="3415918">[</span><span class="ident" id="3415919">s</span><span class="op" id="3415920">+</span><span class="num" id="3415921">1</span><span class="op" id="3415922">:</span><span class="op" id="3415923">]</span><span class="op" id="3415924">,</span>&nbsp;<span class="builtintype" id="3415926">true</span><br>
<span class="lineno"></span><span class="op" id="3415931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3415934">//&nbsp;SetBasicAuth&nbsp;sets&nbsp;the&nbsp;request&#39;s&nbsp;Authorization&nbsp;header&nbsp;to&nbsp;use&nbsp;HTTP</span><br>
<span class="lineno">555</span><span class="comment" id="3416002">//&nbsp;Basic&nbsp;Authentication&nbsp;with&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="3416067">//</span><br>
<span class="lineno"></span><span class="comment" id="3416070">//&nbsp;With&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="3416139">//&nbsp;are&nbsp;not&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="3416161">func</span>&nbsp;<span class="op" id="3416166">(</span><span class="ident" id="3416167">r</span>&nbsp;<span class="op" id="3416169">*</span><span class="ident" id="3416170">Request</span><span class="op" id="3416177">)</span>&nbsp;<span class="ident" id="3416179">SetBasicAuth</span><span class="op" id="3416191">(</span><span class="ident" id="3416192">username</span><span class="op" id="3416200">,</span>&nbsp;<span class="ident" id="3416202">password</span>&nbsp;<span class="builtintype" id="3416211">string</span><span class="op" id="3416217">)</span>&nbsp;<span class="op" id="3416219">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416222">r</span><span class="op" id="3416223">.</span><span class="ident" id="3416224">Header</span><span class="op" id="3416230">.</span><span class="ident" id="3416231">Set</span><span class="op" id="3416234">(</span><span class="string" id="3416235">&#34;Authorization&#34;</span><span class="op" id="3416250">,</span>&nbsp;<span class="string" id="3416252">&#34;Basic&nbsp;&#34;</span><span class="op" id="3416260">+</span><span class="ident" id="3416261">basicAuth</span><span class="op" id="3416270">(</span><span class="ident" id="3416271">username</span><span class="op" id="3416279">,</span>&nbsp;<span class="ident" id="3416281">password</span><span class="op" id="3416289">)</span><span class="op" id="3416290">)</span><br>
<span class="lineno"></span><span class="op" id="3416292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3416295">//&nbsp;parseRequestLine&nbsp;parses&nbsp;&#34;GET&nbsp;/foo&nbsp;HTTP/1.1&#34;&nbsp;into&nbsp;its&nbsp;three&nbsp;parts.</span><br>
<span class="lineno"></span><span class="keyword" id="3416364">func</span>&nbsp;<span class="ident" id="3416369">parseRequestLine</span><span class="op" id="3416385">(</span><span class="ident" id="3416386">line</span>&nbsp;<span class="builtintype" id="3416391">string</span><span class="op" id="3416397">)</span>&nbsp;<span class="op" id="3416399">(</span><span class="ident" id="3416400">method</span><span class="op" id="3416406">,</span>&nbsp;<span class="ident" id="3416408">requestURI</span><span class="op" id="3416418">,</span>&nbsp;<span class="ident" id="3416420">proto</span>&nbsp;<span class="builtintype" id="3416426">string</span><span class="op" id="3416432">,</span>&nbsp;<span class="ident" id="3416434">ok</span>&nbsp;<span class="builtintype" id="3416437">bool</span><span class="op" id="3416441">)</span>&nbsp;<span class="op" id="3416443">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416446">s1</span>&nbsp;<span class="op" id="3416449">:=</span>&nbsp;<span class="ident" id="3416452">strings</span><span class="op" id="3416459">.</span><span class="ident" id="3416460">Index</span><span class="op" id="3416465">(</span><span class="ident" id="3416466">line</span><span class="op" id="3416470">,</span>&nbsp;<span class="string" id="3416472">&#34;&nbsp;&#34;</span><span class="op" id="3416475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416478">s2</span>&nbsp;<span class="op" id="3416481">:=</span>&nbsp;<span class="ident" id="3416484">strings</span><span class="op" id="3416491">.</span><span class="ident" id="3416492">Index</span><span class="op" id="3416497">(</span><span class="ident" id="3416498">line</span><span class="op" id="3416502">[</span><span class="ident" id="3416503">s1</span><span class="op" id="3416505">+</span><span class="num" id="3416506">1</span><span class="op" id="3416507">:</span><span class="op" id="3416508">]</span><span class="op" id="3416509">,</span>&nbsp;<span class="string" id="3416511">&#34;&nbsp;&#34;</span><span class="op" id="3416514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416517">if</span>&nbsp;<span class="ident" id="3416520">s1</span>&nbsp;<span class="op" id="3416523">&lt;</span>&nbsp;<span class="num" id="3416525">0</span>&nbsp;<span class="op" id="3416527">||</span>&nbsp;<span class="ident" id="3416530">s2</span>&nbsp;<span class="op" id="3416533">&lt;</span>&nbsp;<span class="num" id="3416535">0</span>&nbsp;<span class="op" id="3416537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416541">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3416549">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416552">s2</span>&nbsp;<span class="op" id="3416555">+=</span>&nbsp;<span class="ident" id="3416558">s1</span>&nbsp;<span class="op" id="3416561">+</span>&nbsp;<span class="num" id="3416563">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416566">return</span>&nbsp;<span class="ident" id="3416573">line</span><span class="op" id="3416577">[</span><span class="op" id="3416578">:</span><span class="ident" id="3416579">s1</span><span class="op" id="3416581">]</span><span class="op" id="3416582">,</span>&nbsp;<span class="ident" id="3416584">line</span><span class="op" id="3416588">[</span><span class="ident" id="3416589">s1</span><span class="op" id="3416591">+</span><span class="num" id="3416592">1</span>&nbsp;<span class="op" id="3416594">:</span>&nbsp;<span class="ident" id="3416596">s2</span><span class="op" id="3416598">]</span><span class="op" id="3416599">,</span>&nbsp;<span class="ident" id="3416601">line</span><span class="op" id="3416605">[</span><span class="ident" id="3416606">s2</span><span class="op" id="3416608">+</span><span class="num" id="3416609">1</span><span class="op" id="3416610">:</span><span class="op" id="3416611">]</span><span class="op" id="3416612">,</span>&nbsp;<span class="builtintype" id="3416614">true</span><br>
<span class="lineno"></span><span class="op" id="3416619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3416622">var</span>&nbsp;<span class="ident" id="3416626">textprotoReaderPool</span>&nbsp;<span class="ident" id="3416646">sync</span><span class="op" id="3416650">.</span><span class="ident" id="3416651">Pool</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="keyword" id="3416657">func</span>&nbsp;<span class="ident" id="3416662">newTextprotoReader</span><span class="op" id="3416680">(</span><span class="ident" id="3416681">br</span>&nbsp;<span class="op" id="3416684">*</span><span class="ident" id="3416685">bufio</span><span class="op" id="3416690">.</span><span class="ident" id="3416691">Reader</span><span class="op" id="3416697">)</span>&nbsp;<span class="op" id="3416699">*</span><span class="ident" id="3416700">textproto</span><span class="op" id="3416709">.</span><span class="ident" id="3416710">Reader</span>&nbsp;<span class="op" id="3416717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416720">if</span>&nbsp;<span class="ident" id="3416723">v</span>&nbsp;<span class="op" id="3416725">:=</span>&nbsp;<span class="ident" id="3416728">textprotoReaderPool</span><span class="op" id="3416747">.</span><span class="ident" id="3416748">Get</span><span class="op" id="3416751">(</span><span class="op" id="3416752">)</span><span class="op" id="3416753">;</span>&nbsp;<span class="ident" id="3416755">v</span>&nbsp;<span class="op" id="3416757">!=</span>&nbsp;<span class="ident" id="3416760">nil</span>&nbsp;<span class="op" id="3416764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416768">tr</span>&nbsp;<span class="op" id="3416771">:=</span>&nbsp;<span class="ident" id="3416774">v</span><span class="op" id="3416775">.</span><span class="op" id="3416776">(</span><span class="op" id="3416777">*</span><span class="ident" id="3416778">textproto</span><span class="op" id="3416787">.</span><span class="ident" id="3416788">Reader</span><span class="op" id="3416794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416798">tr</span><span class="op" id="3416800">.</span><span class="ident" id="3416801">R</span>&nbsp;<span class="op" id="3416803">=</span>&nbsp;<span class="ident" id="3416805">br</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416810">return</span>&nbsp;<span class="ident" id="3416817">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3416821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416824">return</span>&nbsp;<span class="ident" id="3416831">textproto</span><span class="op" id="3416840">.</span><span class="ident" id="3416841">NewReader</span><span class="op" id="3416850">(</span><span class="ident" id="3416851">br</span><span class="op" id="3416853">)</span><br>
<span class="lineno"></span><span class="op" id="3416855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="keyword" id="3416858">func</span>&nbsp;<span class="ident" id="3416863">putTextprotoReader</span><span class="op" id="3416881">(</span><span class="ident" id="3416882">r</span>&nbsp;<span class="op" id="3416884">*</span><span class="ident" id="3416885">textproto</span><span class="op" id="3416894">.</span><span class="ident" id="3416895">Reader</span><span class="op" id="3416901">)</span>&nbsp;<span class="op" id="3416903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416906">r</span><span class="op" id="3416907">.</span><span class="ident" id="3416908">R</span>&nbsp;<span class="op" id="3416910">=</span>&nbsp;<span class="ident" id="3416912">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416917">textprotoReaderPool</span><span class="op" id="3416936">.</span><span class="ident" id="3416937">Put</span><span class="op" id="3416940">(</span><span class="ident" id="3416941">r</span><span class="op" id="3416942">)</span><br>
<span class="lineno"></span><span class="op" id="3416944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="3416947">//&nbsp;ReadRequest&nbsp;reads&nbsp;and&nbsp;parses&nbsp;a&nbsp;request&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="3416997">func</span>&nbsp;<span class="ident" id="3417002">ReadRequest</span><span class="op" id="3417013">(</span><span class="ident" id="3417014">b</span>&nbsp;<span class="op" id="3417016">*</span><span class="ident" id="3417017">bufio</span><span class="op" id="3417022">.</span><span class="ident" id="3417023">Reader</span><span class="op" id="3417029">)</span>&nbsp;<span class="op" id="3417031">(</span><span class="ident" id="3417032">req</span>&nbsp;<span class="op" id="3417036">*</span><span class="ident" id="3417037">Request</span><span class="op" id="3417044">,</span>&nbsp;<span class="ident" id="3417046">err</span>&nbsp;<span class="builtintype" id="3417050">error</span><span class="op" id="3417055">)</span>&nbsp;<span class="op" id="3417057">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417061">tp</span>&nbsp;<span class="op" id="3417064">:=</span>&nbsp;<span class="ident" id="3417067">newTextprotoReader</span><span class="op" id="3417085">(</span><span class="ident" id="3417086">b</span><span class="op" id="3417087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417090">req</span>&nbsp;<span class="op" id="3417094">=</span>&nbsp;<span class="builtinfunc" id="3417096">new</span><span class="op" id="3417099">(</span><span class="ident" id="3417100">Request</span><span class="op" id="3417107">)</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3417111">//&nbsp;First&nbsp;line:&nbsp;GET&nbsp;/index.html&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417152">var</span>&nbsp;<span class="ident" id="3417156">s</span>&nbsp;<span class="builtintype" id="3417158">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417166">if</span>&nbsp;<span class="ident" id="3417169">s</span><span class="op" id="3417170">,</span>&nbsp;<span class="ident" id="3417172">err</span>&nbsp;<span class="op" id="3417176">=</span>&nbsp;<span class="ident" id="3417178">tp</span><span class="op" id="3417180">.</span><span class="ident" id="3417181">ReadLine</span><span class="op" id="3417189">(</span><span class="op" id="3417190">)</span><span class="op" id="3417191">;</span>&nbsp;<span class="ident" id="3417193">err</span>&nbsp;<span class="op" id="3417197">!=</span>&nbsp;<span class="ident" id="3417200">nil</span>&nbsp;<span class="op" id="3417204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417208">return</span>&nbsp;<span class="ident" id="3417215">nil</span><span class="op" id="3417218">,</span>&nbsp;<span class="ident" id="3417220">err</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417228">defer</span>&nbsp;<span class="keyword" id="3417234">func</span><span class="op" id="3417238">(</span><span class="op" id="3417239">)</span>&nbsp;<span class="op" id="3417241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417245">putTextprotoReader</span><span class="op" id="3417263">(</span><span class="ident" id="3417264">tp</span><span class="op" id="3417266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417270">if</span>&nbsp;<span class="ident" id="3417273">err</span>&nbsp;<span class="op" id="3417277">==</span>&nbsp;<span class="ident" id="3417280">io</span><span class="op" id="3417282">.</span><span class="ident" id="3417283">EOF</span>&nbsp;<span class="op" id="3417287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417292">err</span>&nbsp;<span class="op" id="3417296">=</span>&nbsp;<span class="ident" id="3417298">io</span><span class="op" id="3417300">.</span><span class="ident" id="3417301">ErrUnexpectedEOF</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417323">}</span><span class="op" id="3417324">(</span><span class="op" id="3417325">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417329">var</span>&nbsp;<span class="ident" id="3417333">ok</span>&nbsp;<span class="builtintype" id="3417336">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417342">req</span><span class="op" id="3417345">.</span><span class="ident" id="3417346">Method</span><span class="op" id="3417352">,</span>&nbsp;<span class="ident" id="3417354">req</span><span class="op" id="3417357">.</span><span class="ident" id="3417358">RequestURI</span><span class="op" id="3417368">,</span>&nbsp;<span class="ident" id="3417370">req</span><span class="op" id="3417373">.</span><span class="ident" id="3417374">Proto</span><span class="op" id="3417379">,</span>&nbsp;<span class="ident" id="3417381">ok</span>&nbsp;<span class="op" id="3417384">=</span>&nbsp;<span class="ident" id="3417386">parseRequestLine</span><span class="op" id="3417402">(</span><span class="ident" id="3417403">s</span><span class="op" id="3417404">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417407">if</span>&nbsp;<span class="op" id="3417410">!</span><span class="ident" id="3417411">ok</span>&nbsp;<span class="op" id="3417414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417418">return</span>&nbsp;<span class="ident" id="3417425">nil</span><span class="op" id="3417428">,</span>&nbsp;<span class="op" id="3417430">&amp;</span><span class="ident" id="3417431">badStringError</span><span class="op" id="3417445">{</span><span class="string" id="3417446">&#34;malformed&nbsp;HTTP&nbsp;request&#34;</span><span class="op" id="3417470">,</span>&nbsp;<span class="ident" id="3417472">s</span><span class="op" id="3417473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417479">rawurl</span>&nbsp;<span class="op" id="3417486">:=</span>&nbsp;<span class="ident" id="3417489">req</span><span class="op" id="3417492">.</span><span class="ident" id="3417493">RequestURI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417505">if</span>&nbsp;<span class="ident" id="3417508">req</span><span class="op" id="3417511">.</span><span class="ident" id="3417512">ProtoMajor</span><span class="op" id="3417522">,</span>&nbsp;<span class="ident" id="3417524">req</span><span class="op" id="3417527">.</span><span class="ident" id="3417528">ProtoMinor</span><span class="op" id="3417538">,</span>&nbsp;<span class="ident" id="3417540">ok</span>&nbsp;<span class="op" id="3417543">=</span>&nbsp;<span class="ident" id="3417545">ParseHTTPVersion</span><span class="op" id="3417561">(</span><span class="ident" id="3417562">req</span><span class="op" id="3417565">.</span><span class="ident" id="3417566">Proto</span><span class="op" id="3417571">)</span><span class="op" id="3417572">;</span>&nbsp;<span class="op" id="3417574">!</span><span class="ident" id="3417575">ok</span>&nbsp;<span class="op" id="3417578">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417582">return</span>&nbsp;<span class="ident" id="3417589">nil</span><span class="op" id="3417592">,</span>&nbsp;<span class="op" id="3417594">&amp;</span><span class="ident" id="3417595">badStringError</span><span class="op" id="3417609">{</span><span class="string" id="3417610">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="3417634">,</span>&nbsp;<span class="ident" id="3417636">req</span><span class="op" id="3417639">.</span><span class="ident" id="3417640">Proto</span><span class="op" id="3417645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3417652">//&nbsp;CONNECT&nbsp;requests&nbsp;are&nbsp;used&nbsp;two&nbsp;different&nbsp;ways,&nbsp;and&nbsp;neither&nbsp;uses&nbsp;a&nbsp;full&nbsp;URL:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3417731">//&nbsp;The&nbsp;standard&nbsp;use&nbsp;is&nbsp;to&nbsp;tunnel&nbsp;HTTPS&nbsp;through&nbsp;an&nbsp;HTTP&nbsp;proxy.</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3417794">//&nbsp;It&nbsp;looks&nbsp;like&nbsp;&#34;CONNECT&nbsp;www.google.com:443&nbsp;HTTP/1.1&#34;,&nbsp;and&nbsp;the&nbsp;parameter&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3417872">//&nbsp;just&nbsp;the&nbsp;authority&nbsp;section&nbsp;of&nbsp;a&nbsp;URL.&nbsp;This&nbsp;information&nbsp;should&nbsp;go&nbsp;in&nbsp;req.URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3417957">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3417961">//&nbsp;The&nbsp;net/rpc&nbsp;package&nbsp;also&nbsp;uses&nbsp;CONNECT,&nbsp;but&nbsp;there&nbsp;the&nbsp;parameter&nbsp;is&nbsp;a&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3418038">//&nbsp;that&nbsp;starts&nbsp;with&nbsp;a&nbsp;slash.&nbsp;It&nbsp;can&nbsp;be&nbsp;parsed&nbsp;with&nbsp;the&nbsp;regular&nbsp;URL&nbsp;parser,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3418114">//&nbsp;and&nbsp;the&nbsp;path&nbsp;will&nbsp;end&nbsp;up&nbsp;in&nbsp;req.URL.Path,&nbsp;where&nbsp;it&nbsp;needs&nbsp;to&nbsp;be&nbsp;in&nbsp;order&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3418194">//&nbsp;RPC&nbsp;to&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418211">justAuthority</span>&nbsp;<span class="op" id="3418225">:=</span>&nbsp;<span class="ident" id="3418228">req</span><span class="op" id="3418231">.</span><span class="ident" id="3418232">Method</span>&nbsp;<span class="op" id="3418239">==</span>&nbsp;<span class="string" id="3418242">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="3418252">&amp;&amp;</span>&nbsp;<span class="op" id="3418255">!</span><span class="ident" id="3418256">strings</span><span class="op" id="3418263">.</span><span class="ident" id="3418264">HasPrefix</span><span class="op" id="3418273">(</span><span class="ident" id="3418274">rawurl</span><span class="op" id="3418280">,</span>&nbsp;<span class="string" id="3418282">&#34;/&#34;</span><span class="op" id="3418285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418288">if</span>&nbsp;<span class="ident" id="3418291">justAuthority</span>&nbsp;<span class="op" id="3418305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418309">rawurl</span>&nbsp;<span class="op" id="3418316">=</span>&nbsp;<span class="string" id="3418318">&#34;http://&#34;</span>&nbsp;<span class="op" id="3418328">+</span>&nbsp;<span class="ident" id="3418330">rawurl</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418342">if</span>&nbsp;<span class="ident" id="3418345">req</span><span class="op" id="3418348">.</span><span class="ident" id="3418349">URL</span><span class="op" id="3418352">,</span>&nbsp;<span class="ident" id="3418354">err</span>&nbsp;<span class="op" id="3418358">=</span>&nbsp;<span class="ident" id="3418360">url</span><span class="op" id="3418363">.</span><span class="ident" id="3418364">ParseRequestURI</span><span class="op" id="3418379">(</span><span class="ident" id="3418380">rawurl</span><span class="op" id="3418386">)</span><span class="op" id="3418387">;</span>&nbsp;<span class="ident" id="3418389">err</span>&nbsp;<span class="op" id="3418393">!=</span>&nbsp;<span class="ident" id="3418396">nil</span>&nbsp;<span class="op" id="3418400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418404">return</span>&nbsp;<span class="ident" id="3418411">nil</span><span class="op" id="3418414">,</span>&nbsp;<span class="ident" id="3418416">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418421">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418425">if</span>&nbsp;<span class="ident" id="3418428">justAuthority</span>&nbsp;<span class="op" id="3418442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3418446">//&nbsp;Strip&nbsp;the&nbsp;bogus&nbsp;&#34;http://&#34;&nbsp;back&nbsp;off.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418487">req</span><span class="op" id="3418490">.</span><span class="ident" id="3418491">URL</span><span class="op" id="3418494">.</span><span class="ident" id="3418495">Scheme</span>&nbsp;<span class="op" id="3418502">=</span>&nbsp;<span class="string" id="3418504">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418508">}</span><br>
<span class="lineno">640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3418512">//&nbsp;Subsequent&nbsp;lines:&nbsp;Key:&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418546">mimeHeader</span><span class="op" id="3418556">,</span>&nbsp;<span class="ident" id="3418558">err</span>&nbsp;<span class="op" id="3418562">:=</span>&nbsp;<span class="ident" id="3418565">tp</span><span class="op" id="3418567">.</span><span class="ident" id="3418568">ReadMIMEHeader</span><span class="op" id="3418582">(</span><span class="op" id="3418583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418586">if</span>&nbsp;<span class="ident" id="3418589">err</span>&nbsp;<span class="op" id="3418593">!=</span>&nbsp;<span class="ident" id="3418596">nil</span>&nbsp;<span class="op" id="3418600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418604">return</span>&nbsp;<span class="ident" id="3418611">nil</span><span class="op" id="3418614">,</span>&nbsp;<span class="ident" id="3418616">err</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418624">req</span><span class="op" id="3418627">.</span><span class="ident" id="3418628">Header</span>&nbsp;<span class="op" id="3418635">=</span>&nbsp;<span class="ident" id="3418637">Header</span><span class="op" id="3418643">(</span><span class="ident" id="3418644">mimeHeader</span><span class="op" id="3418654">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3418658">//&nbsp;RFC2616:&nbsp;Must&nbsp;treat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3418682">//&nbsp;&nbsp;&nbsp;&nbspGET&nbsp;/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3418711">//&nbsp;&nbsp;&nbsp;&nbspHost:&nbsp;www.google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3418736">//&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3418744">//&nbsp;&nbsp;&nbsp;&nbspGET&nbsp;http://www.google.com/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3418794">//&nbsp;&nbsp;&nbsp;&nbspHost:&nbsp;doesntmatter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3418817">//&nbsp;the&nbsp;same.&nbsp;&nbsp;In&nbsp;the&nbsp;second&nbsp;case,&nbsp;any&nbsp;Host&nbsp;line&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418878">req</span><span class="op" id="3418881">.</span><span class="ident" id="3418882">Host</span>&nbsp;<span class="op" id="3418887">=</span>&nbsp;<span class="ident" id="3418889">req</span><span class="op" id="3418892">.</span><span class="ident" id="3418893">URL</span><span class="op" id="3418896">.</span><span class="ident" id="3418897">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418903">if</span>&nbsp;<span class="ident" id="3418906">req</span><span class="op" id="3418909">.</span><span class="ident" id="3418910">Host</span>&nbsp;<span class="op" id="3418915">==</span>&nbsp;<span class="string" id="3418918">&#34;&#34;</span>&nbsp;<span class="op" id="3418921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418925">req</span><span class="op" id="3418928">.</span><span class="ident" id="3418929">Host</span>&nbsp;<span class="op" id="3418934">=</span>&nbsp;<span class="ident" id="3418936">req</span><span class="op" id="3418939">.</span><span class="ident" id="3418940">Header</span><span class="op" id="3418946">.</span><span class="ident" id="3418947">get</span><span class="op" id="3418950">(</span><span class="string" id="3418951">&#34;Host&#34;</span><span class="op" id="3418957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3418963">delete</span><span class="op" id="3418969">(</span><span class="ident" id="3418970">req</span><span class="op" id="3418973">.</span><span class="ident" id="3418974">Header</span><span class="op" id="3418980">,</span>&nbsp;<span class="string" id="3418982">&#34;Host&#34;</span><span class="op" id="3418988">)</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418992">fixPragmaCacheControl</span><span class="op" id="3419013">(</span><span class="ident" id="3419014">req</span><span class="op" id="3419017">.</span><span class="ident" id="3419018">Header</span><span class="op" id="3419024">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3419028">err</span>&nbsp;<span class="op" id="3419032">=</span>&nbsp;<span class="ident" id="3419034">readTransfer</span><span class="op" id="3419046">(</span><span class="ident" id="3419047">req</span><span class="op" id="3419050">,</span>&nbsp;<span class="ident" id="3419052">b</span><span class="op" id="3419053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419056">if</span>&nbsp;<span class="ident" id="3419059">err</span>&nbsp;<span class="op" id="3419063">!=</span>&nbsp;<span class="ident" id="3419066">nil</span>&nbsp;<span class="op" id="3419070">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419074">return</span>&nbsp;<span class="ident" id="3419081">nil</span><span class="op" id="3419084">,</span>&nbsp;<span class="ident" id="3419086">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3419091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3419095">req</span><span class="op" id="3419098">.</span><span class="ident" id="3419099">Close</span>&nbsp;<span class="op" id="3419105">=</span>&nbsp;<span class="ident" id="3419107">shouldClose</span><span class="op" id="3419118">(</span><span class="ident" id="3419119">req</span><span class="op" id="3419122">.</span><span class="ident" id="3419123">ProtoMajor</span><span class="op" id="3419133">,</span>&nbsp;<span class="ident" id="3419135">req</span><span class="op" id="3419138">.</span><span class="ident" id="3419139">ProtoMinor</span><span class="op" id="3419149">,</span>&nbsp;<span class="ident" id="3419151">req</span><span class="op" id="3419154">.</span><span class="ident" id="3419155">Header</span><span class="op" id="3419161">,</span>&nbsp;<span class="builtintype" id="3419163">false</span><span class="op" id="3419168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419171">return</span>&nbsp;<span class="ident" id="3419178">req</span><span class="op" id="3419181">,</span>&nbsp;<span class="ident" id="3419183">nil</span><br>
<span class="lineno">670</span><span class="op" id="3419187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3419190">//&nbsp;MaxBytesReader&nbsp;is&nbsp;similar&nbsp;to&nbsp;io.LimitReader&nbsp;but&nbsp;is&nbsp;intended&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3419257">//&nbsp;limiting&nbsp;the&nbsp;size&nbsp;of&nbsp;incoming&nbsp;request&nbsp;bodies.&nbsp;In&nbsp;contrast&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3419321">//&nbsp;io.LimitReader,&nbsp;MaxBytesReader&#39;s&nbsp;result&nbsp;is&nbsp;a&nbsp;ReadCloser,&nbsp;returns&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="3419391">//&nbsp;non-EOF&nbsp;error&nbsp;for&nbsp;a&nbsp;Read&nbsp;beyond&nbsp;the&nbsp;limit,&nbsp;and&nbsp;Closes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3419452">//&nbsp;underlying&nbsp;reader&nbsp;when&nbsp;its&nbsp;Close&nbsp;method&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span><span class="comment" id="3419506">//</span><br>
<span class="lineno"></span><span class="comment" id="3419509">//&nbsp;MaxBytesReader&nbsp;prevents&nbsp;clients&nbsp;from&nbsp;accidentally&nbsp;or&nbsp;maliciously</span><br>
<span class="lineno"></span><span class="comment" id="3419577">//&nbsp;sending&nbsp;a&nbsp;large&nbsp;request&nbsp;and&nbsp;wasting&nbsp;server&nbsp;resources.</span><br>
<span class="lineno">680</span><span class="keyword" id="3419634">func</span>&nbsp;<span class="ident" id="3419639">MaxBytesReader</span><span class="op" id="3419653">(</span><span class="ident" id="3419654">w</span>&nbsp;<span class="ident" id="3419656">ResponseWriter</span><span class="op" id="3419670">,</span>&nbsp;<span class="ident" id="3419672">r</span>&nbsp;<span class="ident" id="3419674">io</span><span class="op" id="3419676">.</span><span class="ident" id="3419677">ReadCloser</span><span class="op" id="3419687">,</span>&nbsp;<span class="ident" id="3419689">n</span>&nbsp;<span class="ident" id="3419691">int64</span><span class="op" id="3419696">)</span>&nbsp;<span class="ident" id="3419698">io</span><span class="op" id="3419700">.</span><span class="ident" id="3419701">ReadCloser</span>&nbsp;<span class="op" id="3419712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419715">return</span>&nbsp;<span class="op" id="3419722">&amp;</span><span class="ident" id="3419723">maxBytesReader</span><span class="op" id="3419737">{</span><span class="ident" id="3419738">w</span><span class="op" id="3419739">:</span>&nbsp;<span class="ident" id="3419741">w</span><span class="op" id="3419742">,</span>&nbsp;<span class="ident" id="3419744">r</span><span class="op" id="3419745">:</span>&nbsp;<span class="ident" id="3419747">r</span><span class="op" id="3419748">,</span>&nbsp;<span class="ident" id="3419750">n</span><span class="op" id="3419751">:</span>&nbsp;<span class="ident" id="3419753">n</span><span class="op" id="3419754">}</span><br>
<span class="lineno"></span><span class="op" id="3419756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3419759">type</span>&nbsp;<span class="ident" id="3419764">maxBytesReader</span>&nbsp;<span class="keyword" id="3419779">struct</span>&nbsp;<span class="op" id="3419786">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3419789">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3419797">ResponseWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3419813">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3419821">io</span><span class="op" id="3419823">.</span><span class="ident" id="3419824">ReadCloser</span>&nbsp;<span class="comment" id="3419835">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3419857">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3419865">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3419879">//&nbsp;max&nbsp;bytes&nbsp;remaining</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3419903">stopped</span>&nbsp;<span class="builtintype" id="3419911">bool</span><br>
<span class="lineno"></span><span class="op" id="3419916">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="3419919">func</span>&nbsp;<span class="op" id="3419924">(</span><span class="ident" id="3419925">l</span>&nbsp;<span class="op" id="3419927">*</span><span class="ident" id="3419928">maxBytesReader</span><span class="op" id="3419942">)</span>&nbsp;<span class="ident" id="3419944">Read</span><span class="op" id="3419948">(</span><span class="ident" id="3419949">p</span>&nbsp;<span class="op" id="3419951">[</span><span class="op" id="3419952">]</span><span class="builtintype" id="3419953">byte</span><span class="op" id="3419957">)</span>&nbsp;<span class="op" id="3419959">(</span><span class="ident" id="3419960">n</span>&nbsp;<span class="builtintype" id="3419962">int</span><span class="op" id="3419965">,</span>&nbsp;<span class="ident" id="3419967">err</span>&nbsp;<span class="builtintype" id="3419971">error</span><span class="op" id="3419976">)</span>&nbsp;<span class="op" id="3419978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419981">if</span>&nbsp;<span class="ident" id="3419984">l</span><span class="op" id="3419985">.</span><span class="ident" id="3419986">n</span>&nbsp;<span class="op" id="3419988">&lt;=</span>&nbsp;<span class="num" id="3419991">0</span>&nbsp;<span class="op" id="3419993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419997">if</span>&nbsp;<span class="op" id="3420000">!</span><span class="ident" id="3420001">l</span><span class="op" id="3420002">.</span><span class="ident" id="3420003">stopped</span>&nbsp;<span class="op" id="3420011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3420016">l</span><span class="op" id="3420017">.</span><span class="ident" id="3420018">stopped</span>&nbsp;<span class="op" id="3420026">=</span>&nbsp;<span class="builtintype" id="3420028">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420036">if</span>&nbsp;<span class="ident" id="3420039">res</span><span class="op" id="3420042">,</span>&nbsp;<span class="ident" id="3420044">ok</span>&nbsp;<span class="op" id="3420047">:=</span>&nbsp;<span class="ident" id="3420050">l</span><span class="op" id="3420051">.</span><span class="ident" id="3420052">w</span><span class="op" id="3420053">.</span><span class="op" id="3420054">(</span><span class="op" id="3420055">*</span><span class="ident" id="3420056">response</span><span class="op" id="3420064">)</span><span class="op" id="3420065">;</span>&nbsp;<span class="ident" id="3420067">ok</span>&nbsp;<span class="op" id="3420070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3420076">res</span><span class="op" id="3420079">.</span><span class="ident" id="3420080">requestTooLarge</span><span class="op" id="3420095">(</span><span class="op" id="3420096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3420101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3420105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420109">return</span>&nbsp;<span class="num" id="3420116">0</span><span class="op" id="3420117">,</span>&nbsp;<span class="ident" id="3420119">errors</span><span class="op" id="3420125">.</span><span class="ident" id="3420126">New</span><span class="op" id="3420129">(</span><span class="string" id="3420130">&#34;http:&nbsp;request&nbsp;body&nbsp;too&nbsp;large&#34;</span><span class="op" id="3420160">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3420163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420166">if</span>&nbsp;<span class="ident" id="3420169">int64</span><span class="op" id="3420174">(</span><span class="builtinfunc" id="3420175">len</span><span class="op" id="3420178">(</span><span class="ident" id="3420179">p</span><span class="op" id="3420180">)</span><span class="op" id="3420181">)</span>&nbsp;<span class="op" id="3420183">&gt;</span>&nbsp;<span class="ident" id="3420185">l</span><span class="op" id="3420186">.</span><span class="ident" id="3420187">n</span>&nbsp;<span class="op" id="3420189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3420193">p</span>&nbsp;<span class="op" id="3420195">=</span>&nbsp;<span class="ident" id="3420197">p</span><span class="op" id="3420198">[</span><span class="op" id="3420199">:</span><span class="ident" id="3420200">l</span><span class="op" id="3420201">.</span><span class="ident" id="3420202">n</span><span class="op" id="3420203">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3420206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3420209">n</span><span class="op" id="3420210">,</span>&nbsp;<span class="ident" id="3420212">err</span>&nbsp;<span class="op" id="3420216">=</span>&nbsp;<span class="ident" id="3420218">l</span><span class="op" id="3420219">.</span><span class="ident" id="3420220">r</span><span class="op" id="3420221">.</span><span class="ident" id="3420222">Read</span><span class="op" id="3420226">(</span><span class="ident" id="3420227">p</span><span class="op" id="3420228">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3420231">l</span><span class="op" id="3420232">.</span><span class="ident" id="3420233">n</span>&nbsp;<span class="op" id="3420235">-=</span>&nbsp;<span class="ident" id="3420238">int64</span><span class="op" id="3420243">(</span><span class="ident" id="3420244">n</span><span class="op" id="3420245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420248">return</span><br>
<span class="lineno"></span><span class="op" id="3420255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3420258">func</span>&nbsp;<span class="op" id="3420263">(</span><span class="ident" id="3420264">l</span>&nbsp;<span class="op" id="3420266">*</span><span class="ident" id="3420267">maxBytesReader</span><span class="op" id="3420281">)</span>&nbsp;<span class="ident" id="3420283">Close</span><span class="op" id="3420288">(</span><span class="op" id="3420289">)</span>&nbsp;<span class="builtintype" id="3420291">error</span>&nbsp;<span class="op" id="3420297">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420300">return</span>&nbsp;<span class="ident" id="3420307">l</span><span class="op" id="3420308">.</span><span class="ident" id="3420309">r</span><span class="op" id="3420310">.</span><span class="ident" id="3420311">Close</span><span class="op" id="3420316">(</span><span class="op" id="3420317">)</span><br>
<span class="lineno"></span><span class="op" id="3420319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3420322">func</span>&nbsp;<span class="ident" id="3420327">copyValues</span><span class="op" id="3420337">(</span><span class="ident" id="3420338">dst</span><span class="op" id="3420341">,</span>&nbsp;<span class="ident" id="3420343">src</span>&nbsp;<span class="ident" id="3420347">url</span><span class="op" id="3420350">.</span><span class="ident" id="3420351">Values</span><span class="op" id="3420357">)</span>&nbsp;<span class="op" id="3420359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420362">for</span>&nbsp;<span class="ident" id="3420366">k</span><span class="op" id="3420367">,</span>&nbsp;<span class="ident" id="3420369">vs</span>&nbsp;<span class="op" id="3420372">:=</span>&nbsp;<span class="keyword" id="3420375">range</span>&nbsp;<span class="ident" id="3420381">src</span>&nbsp;<span class="op" id="3420385">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420389">for</span>&nbsp;<span class="ident" id="3420393">_</span><span class="op" id="3420394">,</span>&nbsp;<span class="ident" id="3420396">value</span>&nbsp;<span class="op" id="3420402">:=</span>&nbsp;<span class="keyword" id="3420405">range</span>&nbsp;<span class="ident" id="3420411">vs</span>&nbsp;<span class="op" id="3420414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3420419">dst</span><span class="op" id="3420422">.</span><span class="ident" id="3420423">Add</span><span class="op" id="3420426">(</span><span class="ident" id="3420427">k</span><span class="op" id="3420428">,</span>&nbsp;<span class="ident" id="3420430">value</span><span class="op" id="3420435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3420439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3420442">}</span><br>
<span class="lineno"></span><span class="op" id="3420444">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="keyword" id="3420447">func</span>&nbsp;<span class="ident" id="3420452">parsePostForm</span><span class="op" id="3420465">(</span><span class="ident" id="3420466">r</span>&nbsp;<span class="op" id="3420468">*</span><span class="ident" id="3420469">Request</span><span class="op" id="3420476">)</span>&nbsp;<span class="op" id="3420478">(</span><span class="ident" id="3420479">vs</span>&nbsp;<span class="ident" id="3420482">url</span><span class="op" id="3420485">.</span><span class="ident" id="3420486">Values</span><span class="op" id="3420492">,</span>&nbsp;<span class="ident" id="3420494">err</span>&nbsp;<span class="builtintype" id="3420498">error</span><span class="op" id="3420503">)</span>&nbsp;<span class="op" id="3420505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420508">if</span>&nbsp;<span class="ident" id="3420511">r</span><span class="op" id="3420512">.</span><span class="ident" id="3420513">Body</span>&nbsp;<span class="op" id="3420518">==</span>&nbsp;<span class="ident" id="3420521">nil</span>&nbsp;<span class="op" id="3420525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3420529">err</span>&nbsp;<span class="op" id="3420533">=</span>&nbsp;<span class="ident" id="3420535">errors</span><span class="op" id="3420541">.</span><span class="ident" id="3420542">New</span><span class="op" id="3420545">(</span><span class="string" id="3420546">&#34;missing&nbsp;form&nbsp;body&#34;</span><span class="op" id="3420565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420569">return</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3420577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3420580">ct</span>&nbsp;<span class="op" id="3420583">:=</span>&nbsp;<span class="ident" id="3420586">r</span><span class="op" id="3420587">.</span><span class="ident" id="3420588">Header</span><span class="op" id="3420594">.</span><span class="ident" id="3420595">Get</span><span class="op" id="3420598">(</span><span class="string" id="3420599">&#34;Content-Type&#34;</span><span class="op" id="3420613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3420616">//&nbsp;RFC&nbsp;2616,&nbsp;section&nbsp;7.2.1&nbsp;-&nbsp;empty&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3420657">//&nbsp;&nbsp;&nbsp;SHOULD&nbsp;be&nbsp;treated&nbsp;as&nbsp;application/octet-stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420709">if</span>&nbsp;<span class="ident" id="3420712">ct</span>&nbsp;<span class="op" id="3420715">==</span>&nbsp;<span class="string" id="3420718">&#34;&#34;</span>&nbsp;<span class="op" id="3420721">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3420725">ct</span>&nbsp;<span class="op" id="3420728">=</span>&nbsp;<span class="string" id="3420730">&#34;application/octet-stream&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3420758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3420761">ct</span><span class="op" id="3420763">,</span>&nbsp;<span class="ident" id="3420765">_</span><span class="op" id="3420766">,</span>&nbsp;<span class="ident" id="3420768">err</span>&nbsp;<span class="op" id="3420772">=</span>&nbsp;<span class="ident" id="3420774">mime</span><span class="op" id="3420778">.</span><span class="ident" id="3420779">ParseMediaType</span><span class="op" id="3420793">(</span><span class="ident" id="3420794">ct</span><span class="op" id="3420796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420799">switch</span>&nbsp;<span class="op" id="3420806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420809">case</span>&nbsp;<span class="ident" id="3420814">ct</span>&nbsp;<span class="op" id="3420817">==</span>&nbsp;<span class="string" id="3420820">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="3420855">:</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420859">var</span>&nbsp;<span class="ident" id="3420863">reader</span>&nbsp;<span class="ident" id="3420870">io</span><span class="op" id="3420872">.</span><span class="ident" id="3420873">Reader</span>&nbsp;<span class="op" id="3420880">=</span>&nbsp;<span class="ident" id="3420882">r</span><span class="op" id="3420883">.</span><span class="ident" id="3420884">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3420891">maxFormSize</span>&nbsp;<span class="op" id="3420903">:=</span>&nbsp;<span class="ident" id="3420906">int64</span><span class="op" id="3420911">(</span><span class="num" id="3420912">1</span><span class="op" id="3420913">&lt;&lt;</span><span class="num" id="3420915">63</span>&nbsp;<span class="op" id="3420918">-</span>&nbsp;<span class="num" id="3420920">1</span><span class="op" id="3420921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420925">if</span>&nbsp;<span class="ident" id="3420928">_</span><span class="op" id="3420929">,</span>&nbsp;<span class="ident" id="3420931">ok</span>&nbsp;<span class="op" id="3420934">:=</span>&nbsp;<span class="ident" id="3420937">r</span><span class="op" id="3420938">.</span><span class="ident" id="3420939">Body</span><span class="op" id="3420943">.</span><span class="op" id="3420944">(</span><span class="op" id="3420945">*</span><span class="ident" id="3420946">maxBytesReader</span><span class="op" id="3420960">)</span><span class="op" id="3420961">;</span>&nbsp;<span class="op" id="3420963">!</span><span class="ident" id="3420964">ok</span>&nbsp;<span class="op" id="3420967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3420972">maxFormSize</span>&nbsp;<span class="op" id="3420984">=</span>&nbsp;<span class="ident" id="3420986">int64</span><span class="op" id="3420991">(</span><span class="num" id="3420992">10</span>&nbsp;<span class="op" id="3420995">&lt;&lt;</span>&nbsp;<span class="num" id="3420998">20</span><span class="op" id="3421000">)</span>&nbsp;<span class="comment" id="3421002">//&nbsp;10&nbsp;MB&nbsp;is&nbsp;a&nbsp;lot&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421032">reader</span>&nbsp;<span class="op" id="3421039">=</span>&nbsp;<span class="ident" id="3421041">io</span><span class="op" id="3421043">.</span><span class="ident" id="3421044">LimitReader</span><span class="op" id="3421055">(</span><span class="ident" id="3421056">r</span><span class="op" id="3421057">.</span><span class="ident" id="3421058">Body</span><span class="op" id="3421062">,</span>&nbsp;<span class="ident" id="3421064">maxFormSize</span><span class="op" id="3421075">+</span><span class="num" id="3421076">1</span><span class="op" id="3421077">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421085">b</span><span class="op" id="3421086">,</span>&nbsp;<span class="ident" id="3421088">e</span>&nbsp;<span class="op" id="3421090">:=</span>&nbsp;<span class="ident" id="3421093">ioutil</span><span class="op" id="3421099">.</span><span class="ident" id="3421100">ReadAll</span><span class="op" id="3421107">(</span><span class="ident" id="3421108">reader</span><span class="op" id="3421114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421118">if</span>&nbsp;<span class="ident" id="3421121">e</span>&nbsp;<span class="op" id="3421123">!=</span>&nbsp;<span class="ident" id="3421126">nil</span>&nbsp;<span class="op" id="3421130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421135">if</span>&nbsp;<span class="ident" id="3421138">err</span>&nbsp;<span class="op" id="3421142">==</span>&nbsp;<span class="ident" id="3421145">nil</span>&nbsp;<span class="op" id="3421149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421155">err</span>&nbsp;<span class="op" id="3421159">=</span>&nbsp;<span class="ident" id="3421161">e</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421171">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421183">if</span>&nbsp;<span class="ident" id="3421186">int64</span><span class="op" id="3421191">(</span><span class="builtinfunc" id="3421192">len</span><span class="op" id="3421195">(</span><span class="ident" id="3421196">b</span><span class="op" id="3421197">)</span><span class="op" id="3421198">)</span>&nbsp;<span class="op" id="3421200">&gt;</span>&nbsp;<span class="ident" id="3421202">maxFormSize</span>&nbsp;<span class="op" id="3421214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421219">err</span>&nbsp;<span class="op" id="3421223">=</span>&nbsp;<span class="ident" id="3421225">errors</span><span class="op" id="3421231">.</span><span class="ident" id="3421232">New</span><span class="op" id="3421235">(</span><span class="string" id="3421236">&#34;http:&nbsp;POST&nbsp;too&nbsp;large&#34;</span><span class="op" id="3421258">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421263">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421276">vs</span><span class="op" id="3421278">,</span>&nbsp;<span class="ident" id="3421280">e</span>&nbsp;<span class="op" id="3421282">=</span>&nbsp;<span class="ident" id="3421284">url</span><span class="op" id="3421287">.</span><span class="ident" id="3421288">ParseQuery</span><span class="op" id="3421298">(</span><span class="builtintype" id="3421299">string</span><span class="op" id="3421305">(</span><span class="ident" id="3421306">b</span><span class="op" id="3421307">)</span><span class="op" id="3421308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421312">if</span>&nbsp;<span class="ident" id="3421315">err</span>&nbsp;<span class="op" id="3421319">==</span>&nbsp;<span class="ident" id="3421322">nil</span>&nbsp;<span class="op" id="3421326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421331">err</span>&nbsp;<span class="op" id="3421335">=</span>&nbsp;<span class="ident" id="3421337">e</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421344">case</span>&nbsp;<span class="ident" id="3421349">ct</span>&nbsp;<span class="op" id="3421352">==</span>&nbsp;<span class="string" id="3421355">&#34;multipart/form-data&#34;</span><span class="op" id="3421376">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3421380">//&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&nbsp;(which&nbsp;is&nbsp;calling&nbsp;us,&nbsp;or&nbsp;should&nbsp;be)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3421451">//&nbsp;TODO(bradfitz):&nbsp;there&nbsp;are&nbsp;too&nbsp;many&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3421500">//&nbsp;orders&nbsp;to&nbsp;call&nbsp;too&nbsp;many&nbsp;functions&nbsp;here.</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3421545">//&nbsp;Clean&nbsp;this&nbsp;up&nbsp;and&nbsp;write&nbsp;more&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3421586">//&nbsp;request_test.go&nbsp;contains&nbsp;the&nbsp;start&nbsp;of&nbsp;this,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3421635">//&nbsp;in&nbsp;TestParseMultipartFormOrder&nbsp;and&nbsp;others.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421685">return</span><br>
<span class="lineno">765</span><span class="op" id="3421692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3421695">//&nbsp;ParseForm&nbsp;parses&nbsp;the&nbsp;raw&nbsp;query&nbsp;from&nbsp;the&nbsp;URL&nbsp;and&nbsp;updates&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3421762">//</span><br>
<span class="lineno"></span><span class="comment" id="3421765">//&nbsp;For&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;requests,&nbsp;it&nbsp;also&nbsp;parses&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;form&nbsp;and</span><br>
<span class="lineno">770</span><span class="comment" id="3421840">//&nbsp;put&nbsp;the&nbsp;results&nbsp;into&nbsp;both&nbsp;r.PostForm&nbsp;and&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3421892">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="3421969">//&nbsp;in&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3421983">//</span><br>
<span class="lineno"></span><span class="comment" id="3421986">//&nbsp;If&nbsp;the&nbsp;request&nbsp;Body&#39;s&nbsp;size&nbsp;has&nbsp;not&nbsp;already&nbsp;been&nbsp;limited&nbsp;by&nbsp;MaxBytesReader,</span><br>
<span class="lineno">775</span><span class="comment" id="3422064">//&nbsp;the&nbsp;size&nbsp;is&nbsp;capped&nbsp;at&nbsp;10MB.</span><br>
<span class="lineno"></span><span class="comment" id="3422095">//</span><br>
<span class="lineno"></span><span class="comment" id="3422098">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="comment" id="3422151">//&nbsp;It&nbsp;is&nbsp;idempotent.</span><br>
<span class="lineno"></span><span class="keyword" id="3422172">func</span>&nbsp;<span class="op" id="3422177">(</span><span class="ident" id="3422178">r</span>&nbsp;<span class="op" id="3422180">*</span><span class="ident" id="3422181">Request</span><span class="op" id="3422188">)</span>&nbsp;<span class="ident" id="3422190">ParseForm</span><span class="op" id="3422199">(</span><span class="op" id="3422200">)</span>&nbsp;<span class="builtintype" id="3422202">error</span>&nbsp;<span class="op" id="3422208">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422211">var</span>&nbsp;<span class="ident" id="3422215">err</span>&nbsp;<span class="builtintype" id="3422219">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422226">if</span>&nbsp;<span class="ident" id="3422229">r</span><span class="op" id="3422230">.</span><span class="ident" id="3422231">PostForm</span>&nbsp;<span class="op" id="3422240">==</span>&nbsp;<span class="ident" id="3422243">nil</span>&nbsp;<span class="op" id="3422247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422251">if</span>&nbsp;<span class="ident" id="3422254">r</span><span class="op" id="3422255">.</span><span class="ident" id="3422256">Method</span>&nbsp;<span class="op" id="3422263">==</span>&nbsp;<span class="string" id="3422266">&#34;POST&#34;</span>&nbsp;<span class="op" id="3422273">||</span>&nbsp;<span class="ident" id="3422276">r</span><span class="op" id="3422277">.</span><span class="ident" id="3422278">Method</span>&nbsp;<span class="op" id="3422285">==</span>&nbsp;<span class="string" id="3422288">&#34;PUT&#34;</span>&nbsp;<span class="op" id="3422294">||</span>&nbsp;<span class="ident" id="3422297">r</span><span class="op" id="3422298">.</span><span class="ident" id="3422299">Method</span>&nbsp;<span class="op" id="3422306">==</span>&nbsp;<span class="string" id="3422309">&#34;PATCH&#34;</span>&nbsp;<span class="op" id="3422317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3422322">r</span><span class="op" id="3422323">.</span><span class="ident" id="3422324">PostForm</span><span class="op" id="3422332">,</span>&nbsp;<span class="ident" id="3422334">err</span>&nbsp;<span class="op" id="3422338">=</span>&nbsp;<span class="ident" id="3422340">parsePostForm</span><span class="op" id="3422353">(</span><span class="ident" id="3422354">r</span><span class="op" id="3422355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422359">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422363">if</span>&nbsp;<span class="ident" id="3422366">r</span><span class="op" id="3422367">.</span><span class="ident" id="3422368">PostForm</span>&nbsp;<span class="op" id="3422377">==</span>&nbsp;<span class="ident" id="3422380">nil</span>&nbsp;<span class="op" id="3422384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3422389">r</span><span class="op" id="3422390">.</span><span class="ident" id="3422391">PostForm</span>&nbsp;<span class="op" id="3422400">=</span>&nbsp;<span class="builtinfunc" id="3422402">make</span><span class="op" id="3422406">(</span><span class="ident" id="3422407">url</span><span class="op" id="3422410">.</span><span class="ident" id="3422411">Values</span><span class="op" id="3422417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422427">if</span>&nbsp;<span class="ident" id="3422430">r</span><span class="op" id="3422431">.</span><span class="ident" id="3422432">Form</span>&nbsp;<span class="op" id="3422437">==</span>&nbsp;<span class="ident" id="3422440">nil</span>&nbsp;<span class="op" id="3422444">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422448">if</span>&nbsp;<span class="builtinfunc" id="3422451">len</span><span class="op" id="3422454">(</span><span class="ident" id="3422455">r</span><span class="op" id="3422456">.</span><span class="ident" id="3422457">PostForm</span><span class="op" id="3422465">)</span>&nbsp;<span class="op" id="3422467">&gt;</span>&nbsp;<span class="num" id="3422469">0</span>&nbsp;<span class="op" id="3422471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3422476">r</span><span class="op" id="3422477">.</span><span class="ident" id="3422478">Form</span>&nbsp;<span class="op" id="3422483">=</span>&nbsp;<span class="builtinfunc" id="3422485">make</span><span class="op" id="3422489">(</span><span class="ident" id="3422490">url</span><span class="op" id="3422493">.</span><span class="ident" id="3422494">Values</span><span class="op" id="3422500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3422505">copyValues</span><span class="op" id="3422515">(</span><span class="ident" id="3422516">r</span><span class="op" id="3422517">.</span><span class="ident" id="3422518">Form</span><span class="op" id="3422522">,</span>&nbsp;<span class="ident" id="3422524">r</span><span class="op" id="3422525">.</span><span class="ident" id="3422526">PostForm</span><span class="op" id="3422534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422542">var</span>&nbsp;<span class="ident" id="3422546">newValues</span>&nbsp;<span class="ident" id="3422556">url</span><span class="op" id="3422559">.</span><span class="ident" id="3422560">Values</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422569">if</span>&nbsp;<span class="ident" id="3422572">r</span><span class="op" id="3422573">.</span><span class="ident" id="3422574">URL</span>&nbsp;<span class="op" id="3422578">!=</span>&nbsp;<span class="ident" id="3422581">nil</span>&nbsp;<span class="op" id="3422585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422590">var</span>&nbsp;<span class="ident" id="3422594">e</span>&nbsp;<span class="builtintype" id="3422596">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3422605">newValues</span><span class="op" id="3422614">,</span>&nbsp;<span class="ident" id="3422616">e</span>&nbsp;<span class="op" id="3422618">=</span>&nbsp;<span class="ident" id="3422620">url</span><span class="op" id="3422623">.</span><span class="ident" id="3422624">ParseQuery</span><span class="op" id="3422634">(</span><span class="ident" id="3422635">r</span><span class="op" id="3422636">.</span><span class="ident" id="3422637">URL</span><span class="op" id="3422640">.</span><span class="ident" id="3422641">RawQuery</span><span class="op" id="3422649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422654">if</span>&nbsp;<span class="ident" id="3422657">err</span>&nbsp;<span class="op" id="3422661">==</span>&nbsp;<span class="ident" id="3422664">nil</span>&nbsp;<span class="op" id="3422668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3422674">err</span>&nbsp;<span class="op" id="3422678">=</span>&nbsp;<span class="ident" id="3422680">e</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422693">if</span>&nbsp;<span class="ident" id="3422696">newValues</span>&nbsp;<span class="op" id="3422706">==</span>&nbsp;<span class="ident" id="3422709">nil</span>&nbsp;<span class="op" id="3422713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3422718">newValues</span>&nbsp;<span class="op" id="3422728">=</span>&nbsp;<span class="builtinfunc" id="3422730">make</span><span class="op" id="3422734">(</span><span class="ident" id="3422735">url</span><span class="op" id="3422738">.</span><span class="ident" id="3422739">Values</span><span class="op" id="3422745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422749">}</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422753">if</span>&nbsp;<span class="ident" id="3422756">r</span><span class="op" id="3422757">.</span><span class="ident" id="3422758">Form</span>&nbsp;<span class="op" id="3422763">==</span>&nbsp;<span class="ident" id="3422766">nil</span>&nbsp;<span class="op" id="3422770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3422775">r</span><span class="op" id="3422776">.</span><span class="ident" id="3422777">Form</span>&nbsp;<span class="op" id="3422782">=</span>&nbsp;<span class="ident" id="3422784">newValues</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422796">}</span>&nbsp;<span class="keyword" id="3422798">else</span>&nbsp;<span class="op" id="3422803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3422808">copyValues</span><span class="op" id="3422818">(</span><span class="ident" id="3422819">r</span><span class="op" id="3422820">.</span><span class="ident" id="3422821">Form</span><span class="op" id="3422825">,</span>&nbsp;<span class="ident" id="3422827">newValues</span><span class="op" id="3422836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422840">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422846">return</span>&nbsp;<span class="ident" id="3422853">err</span><br>
<span class="lineno"></span><span class="op" id="3422857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3422860">//&nbsp;ParseMultipartForm&nbsp;parses&nbsp;a&nbsp;request&nbsp;body&nbsp;as&nbsp;multipart/form-data.</span><br>
<span class="lineno">815</span><span class="comment" id="3422928">//&nbsp;The&nbsp;whole&nbsp;request&nbsp;body&nbsp;is&nbsp;parsed&nbsp;and&nbsp;up&nbsp;to&nbsp;a&nbsp;total&nbsp;of&nbsp;maxMemory&nbsp;bytes&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3423004">//&nbsp;its&nbsp;file&nbsp;parts&nbsp;are&nbsp;stored&nbsp;in&nbsp;memory,&nbsp;with&nbsp;the&nbsp;remainder&nbsp;stored&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3423073">//&nbsp;disk&nbsp;in&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="3423101">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="comment" id="3423153">//&nbsp;After&nbsp;one&nbsp;call&nbsp;to&nbsp;ParseMultipartForm,&nbsp;subsequent&nbsp;calls&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">820</span><span class="keyword" id="3423227">func</span>&nbsp;<span class="op" id="3423232">(</span><span class="ident" id="3423233">r</span>&nbsp;<span class="op" id="3423235">*</span><span class="ident" id="3423236">Request</span><span class="op" id="3423243">)</span>&nbsp;<span class="ident" id="3423245">ParseMultipartForm</span><span class="op" id="3423263">(</span><span class="ident" id="3423264">maxMemory</span>&nbsp;<span class="ident" id="3423274">int64</span><span class="op" id="3423279">)</span>&nbsp;<span class="builtintype" id="3423281">error</span>&nbsp;<span class="op" id="3423287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423290">if</span>&nbsp;<span class="ident" id="3423293">r</span><span class="op" id="3423294">.</span><span class="ident" id="3423295">MultipartForm</span>&nbsp;<span class="op" id="3423309">==</span>&nbsp;<span class="ident" id="3423312">multipartByReader</span>&nbsp;<span class="op" id="3423330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423334">return</span>&nbsp;<span class="ident" id="3423341">errors</span><span class="op" id="3423347">.</span><span class="ident" id="3423348">New</span><span class="op" id="3423351">(</span><span class="string" id="3423352">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="3423396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3423399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423402">if</span>&nbsp;<span class="ident" id="3423405">r</span><span class="op" id="3423406">.</span><span class="ident" id="3423407">Form</span>&nbsp;<span class="op" id="3423412">==</span>&nbsp;<span class="ident" id="3423415">nil</span>&nbsp;<span class="op" id="3423419">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423423">err</span>&nbsp;<span class="op" id="3423427">:=</span>&nbsp;<span class="ident" id="3423430">r</span><span class="op" id="3423431">.</span><span class="ident" id="3423432">ParseForm</span><span class="op" id="3423441">(</span><span class="op" id="3423442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423446">if</span>&nbsp;<span class="ident" id="3423449">err</span>&nbsp;<span class="op" id="3423453">!=</span>&nbsp;<span class="ident" id="3423456">nil</span>&nbsp;<span class="op" id="3423460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423465">return</span>&nbsp;<span class="ident" id="3423472">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3423478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3423481">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423484">if</span>&nbsp;<span class="ident" id="3423487">r</span><span class="op" id="3423488">.</span><span class="ident" id="3423489">MultipartForm</span>&nbsp;<span class="op" id="3423503">!=</span>&nbsp;<span class="ident" id="3423506">nil</span>&nbsp;<span class="op" id="3423510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423514">return</span>&nbsp;<span class="ident" id="3423521">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3423526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423530">mr</span><span class="op" id="3423532">,</span>&nbsp;<span class="ident" id="3423534">err</span>&nbsp;<span class="op" id="3423538">:=</span>&nbsp;<span class="ident" id="3423541">r</span><span class="op" id="3423542">.</span><span class="ident" id="3423543">multipartReader</span><span class="op" id="3423558">(</span><span class="op" id="3423559">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423562">if</span>&nbsp;<span class="ident" id="3423565">err</span>&nbsp;<span class="op" id="3423569">!=</span>&nbsp;<span class="ident" id="3423572">nil</span>&nbsp;<span class="op" id="3423576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423580">return</span>&nbsp;<span class="ident" id="3423587">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3423592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423596">f</span><span class="op" id="3423597">,</span>&nbsp;<span class="ident" id="3423599">err</span>&nbsp;<span class="op" id="3423603">:=</span>&nbsp;<span class="ident" id="3423606">mr</span><span class="op" id="3423608">.</span><span class="ident" id="3423609">ReadForm</span><span class="op" id="3423617">(</span><span class="ident" id="3423618">maxMemory</span><span class="op" id="3423627">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423630">if</span>&nbsp;<span class="ident" id="3423633">err</span>&nbsp;<span class="op" id="3423637">!=</span>&nbsp;<span class="ident" id="3423640">nil</span>&nbsp;<span class="op" id="3423644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423648">return</span>&nbsp;<span class="ident" id="3423655">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3423660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423663">for</span>&nbsp;<span class="ident" id="3423667">k</span><span class="op" id="3423668">,</span>&nbsp;<span class="ident" id="3423670">v</span>&nbsp;<span class="op" id="3423672">:=</span>&nbsp;<span class="keyword" id="3423675">range</span>&nbsp;<span class="ident" id="3423681">f</span><span class="op" id="3423682">.</span><span class="ident" id="3423683">Value</span>&nbsp;<span class="op" id="3423689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423693">r</span><span class="op" id="3423694">.</span><span class="ident" id="3423695">Form</span><span class="op" id="3423699">[</span><span class="ident" id="3423700">k</span><span class="op" id="3423701">]</span>&nbsp;<span class="op" id="3423703">=</span>&nbsp;<span class="builtinfunc" id="3423705">append</span><span class="op" id="3423711">(</span><span class="ident" id="3423712">r</span><span class="op" id="3423713">.</span><span class="ident" id="3423714">Form</span><span class="op" id="3423718">[</span><span class="ident" id="3423719">k</span><span class="op" id="3423720">]</span><span class="op" id="3423721">,</span>&nbsp;<span class="ident" id="3423723">v</span><span class="op" id="3423724">...</span><span class="op" id="3423727">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3423730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423733">r</span><span class="op" id="3423734">.</span><span class="ident" id="3423735">MultipartForm</span>&nbsp;<span class="op" id="3423749">=</span>&nbsp;<span class="ident" id="3423751">f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423755">return</span>&nbsp;<span class="ident" id="3423762">nil</span><br>
<span class="lineno"></span><span class="op" id="3423766">}</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span><span class="comment" id="3423769">//&nbsp;FormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;query.</span><br>
<span class="lineno"></span><span class="comment" id="3423844">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3423922">//&nbsp;FormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno"></span><span class="comment" id="3423999">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno">855</span><span class="comment" id="3424042">//&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;key,&nbsp;call&nbsp;ParseForm&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3424107">//&nbsp;then&nbsp;inspect&nbsp;Request.Form&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3424146">func</span>&nbsp;<span class="op" id="3424151">(</span><span class="ident" id="3424152">r</span>&nbsp;<span class="op" id="3424154">*</span><span class="ident" id="3424155">Request</span><span class="op" id="3424162">)</span>&nbsp;<span class="ident" id="3424164">FormValue</span><span class="op" id="3424173">(</span><span class="ident" id="3424174">key</span>&nbsp;<span class="builtintype" id="3424178">string</span><span class="op" id="3424184">)</span>&nbsp;<span class="builtintype" id="3424186">string</span>&nbsp;<span class="op" id="3424193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424196">if</span>&nbsp;<span class="ident" id="3424199">r</span><span class="op" id="3424200">.</span><span class="ident" id="3424201">Form</span>&nbsp;<span class="op" id="3424206">==</span>&nbsp;<span class="ident" id="3424209">nil</span>&nbsp;<span class="op" id="3424213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3424217">r</span><span class="op" id="3424218">.</span><span class="ident" id="3424219">ParseMultipartForm</span><span class="op" id="3424237">(</span><span class="ident" id="3424238">defaultMaxMemory</span><span class="op" id="3424254">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3424257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424260">if</span>&nbsp;<span class="ident" id="3424263">vs</span>&nbsp;<span class="op" id="3424266">:=</span>&nbsp;<span class="ident" id="3424269">r</span><span class="op" id="3424270">.</span><span class="ident" id="3424271">Form</span><span class="op" id="3424275">[</span><span class="ident" id="3424276">key</span><span class="op" id="3424279">]</span><span class="op" id="3424280">;</span>&nbsp;<span class="builtinfunc" id="3424282">len</span><span class="op" id="3424285">(</span><span class="ident" id="3424286">vs</span><span class="op" id="3424288">)</span>&nbsp;<span class="op" id="3424290">&gt;</span>&nbsp;<span class="num" id="3424292">0</span>&nbsp;<span class="op" id="3424294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424298">return</span>&nbsp;<span class="ident" id="3424305">vs</span><span class="op" id="3424307">[</span><span class="num" id="3424308">0</span><span class="op" id="3424309">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3424312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424315">return</span>&nbsp;<span class="string" id="3424322">&#34;&#34;</span><br>
<span class="lineno">865</span><span class="op" id="3424325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3424328">//&nbsp;PostFormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;POST</span><br>
<span class="lineno"></span><span class="comment" id="3424405">//&nbsp;or&nbsp;PUT&nbsp;request&nbsp;body.&nbsp;URL&nbsp;query&nbsp;parameters&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3424463">//&nbsp;PostFormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno">870</span><span class="comment" id="3424544">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno"></span><span class="keyword" id="3424587">func</span>&nbsp;<span class="op" id="3424592">(</span><span class="ident" id="3424593">r</span>&nbsp;<span class="op" id="3424595">*</span><span class="ident" id="3424596">Request</span><span class="op" id="3424603">)</span>&nbsp;<span class="ident" id="3424605">PostFormValue</span><span class="op" id="3424618">(</span><span class="ident" id="3424619">key</span>&nbsp;<span class="builtintype" id="3424623">string</span><span class="op" id="3424629">)</span>&nbsp;<span class="builtintype" id="3424631">string</span>&nbsp;<span class="op" id="3424638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424641">if</span>&nbsp;<span class="ident" id="3424644">r</span><span class="op" id="3424645">.</span><span class="ident" id="3424646">PostForm</span>&nbsp;<span class="op" id="3424655">==</span>&nbsp;<span class="ident" id="3424658">nil</span>&nbsp;<span class="op" id="3424662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3424666">r</span><span class="op" id="3424667">.</span><span class="ident" id="3424668">ParseMultipartForm</span><span class="op" id="3424686">(</span><span class="ident" id="3424687">defaultMaxMemory</span><span class="op" id="3424703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3424706">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424709">if</span>&nbsp;<span class="ident" id="3424712">vs</span>&nbsp;<span class="op" id="3424715">:=</span>&nbsp;<span class="ident" id="3424718">r</span><span class="op" id="3424719">.</span><span class="ident" id="3424720">PostForm</span><span class="op" id="3424728">[</span><span class="ident" id="3424729">key</span><span class="op" id="3424732">]</span><span class="op" id="3424733">;</span>&nbsp;<span class="builtinfunc" id="3424735">len</span><span class="op" id="3424738">(</span><span class="ident" id="3424739">vs</span><span class="op" id="3424741">)</span>&nbsp;<span class="op" id="3424743">&gt;</span>&nbsp;<span class="num" id="3424745">0</span>&nbsp;<span class="op" id="3424747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424751">return</span>&nbsp;<span class="ident" id="3424758">vs</span><span class="op" id="3424760">[</span><span class="num" id="3424761">0</span><span class="op" id="3424762">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3424765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424768">return</span>&nbsp;<span class="string" id="3424775">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3424778">}</span><br>
<span class="lineno">880</span><br>
<span class="lineno"></span><span class="comment" id="3424781">//&nbsp;FormFile&nbsp;returns&nbsp;the&nbsp;first&nbsp;file&nbsp;for&nbsp;the&nbsp;provided&nbsp;form&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3424843">//&nbsp;FormFile&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="3424908">func</span>&nbsp;<span class="op" id="3424913">(</span><span class="ident" id="3424914">r</span>&nbsp;<span class="op" id="3424916">*</span><span class="ident" id="3424917">Request</span><span class="op" id="3424924">)</span>&nbsp;<span class="ident" id="3424926">FormFile</span><span class="op" id="3424934">(</span><span class="ident" id="3424935">key</span>&nbsp;<span class="builtintype" id="3424939">string</span><span class="op" id="3424945">)</span>&nbsp;<span class="op" id="3424947">(</span><span class="ident" id="3424948">multipart</span><span class="op" id="3424957">.</span><span class="ident" id="3424958">File</span><span class="op" id="3424962">,</span>&nbsp;<span class="op" id="3424964">*</span><span class="ident" id="3424965">multipart</span><span class="op" id="3424974">.</span><span class="ident" id="3424975">FileHeader</span><span class="op" id="3424985">,</span>&nbsp;<span class="builtintype" id="3424987">error</span><span class="op" id="3424992">)</span>&nbsp;<span class="op" id="3424994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424997">if</span>&nbsp;<span class="ident" id="3425000">r</span><span class="op" id="3425001">.</span><span class="ident" id="3425002">MultipartForm</span>&nbsp;<span class="op" id="3425016">==</span>&nbsp;<span class="ident" id="3425019">multipartByReader</span>&nbsp;<span class="op" id="3425037">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425041">return</span>&nbsp;<span class="ident" id="3425048">nil</span><span class="op" id="3425051">,</span>&nbsp;<span class="ident" id="3425053">nil</span><span class="op" id="3425056">,</span>&nbsp;<span class="ident" id="3425058">errors</span><span class="op" id="3425064">.</span><span class="ident" id="3425065">New</span><span class="op" id="3425068">(</span><span class="string" id="3425069">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="3425113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3425116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425119">if</span>&nbsp;<span class="ident" id="3425122">r</span><span class="op" id="3425123">.</span><span class="ident" id="3425124">MultipartForm</span>&nbsp;<span class="op" id="3425138">==</span>&nbsp;<span class="ident" id="3425141">nil</span>&nbsp;<span class="op" id="3425145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3425149">err</span>&nbsp;<span class="op" id="3425153">:=</span>&nbsp;<span class="ident" id="3425156">r</span><span class="op" id="3425157">.</span><span class="ident" id="3425158">ParseMultipartForm</span><span class="op" id="3425176">(</span><span class="ident" id="3425177">defaultMaxMemory</span><span class="op" id="3425193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425197">if</span>&nbsp;<span class="ident" id="3425200">err</span>&nbsp;<span class="op" id="3425204">!=</span>&nbsp;<span class="ident" id="3425207">nil</span>&nbsp;<span class="op" id="3425211">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425216">return</span>&nbsp;<span class="ident" id="3425223">nil</span><span class="op" id="3425226">,</span>&nbsp;<span class="ident" id="3425228">nil</span><span class="op" id="3425231">,</span>&nbsp;<span class="ident" id="3425233">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3425239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3425242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425245">if</span>&nbsp;<span class="ident" id="3425248">r</span><span class="op" id="3425249">.</span><span class="ident" id="3425250">MultipartForm</span>&nbsp;<span class="op" id="3425264">!=</span>&nbsp;<span class="ident" id="3425267">nil</span>&nbsp;<span class="op" id="3425271">&amp;&amp;</span>&nbsp;<span class="ident" id="3425274">r</span><span class="op" id="3425275">.</span><span class="ident" id="3425276">MultipartForm</span><span class="op" id="3425289">.</span><span class="ident" id="3425290">File</span>&nbsp;<span class="op" id="3425295">!=</span>&nbsp;<span class="ident" id="3425298">nil</span>&nbsp;<span class="op" id="3425302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425306">if</span>&nbsp;<span class="ident" id="3425309">fhs</span>&nbsp;<span class="op" id="3425313">:=</span>&nbsp;<span class="ident" id="3425316">r</span><span class="op" id="3425317">.</span><span class="ident" id="3425318">MultipartForm</span><span class="op" id="3425331">.</span><span class="ident" id="3425332">File</span><span class="op" id="3425336">[</span><span class="ident" id="3425337">key</span><span class="op" id="3425340">]</span><span class="op" id="3425341">;</span>&nbsp;<span class="builtinfunc" id="3425343">len</span><span class="op" id="3425346">(</span><span class="ident" id="3425347">fhs</span><span class="op" id="3425350">)</span>&nbsp;<span class="op" id="3425352">&gt;</span>&nbsp;<span class="num" id="3425354">0</span>&nbsp;<span class="op" id="3425356">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3425361">f</span><span class="op" id="3425362">,</span>&nbsp;<span class="ident" id="3425364">err</span>&nbsp;<span class="op" id="3425368">:=</span>&nbsp;<span class="ident" id="3425371">fhs</span><span class="op" id="3425374">[</span><span class="num" id="3425375">0</span><span class="op" id="3425376">]</span><span class="op" id="3425377">.</span><span class="ident" id="3425378">Open</span><span class="op" id="3425382">(</span><span class="op" id="3425383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425388">return</span>&nbsp;<span class="ident" id="3425395">f</span><span class="op" id="3425396">,</span>&nbsp;<span class="ident" id="3425398">fhs</span><span class="op" id="3425401">[</span><span class="num" id="3425402">0</span><span class="op" id="3425403">]</span><span class="op" id="3425404">,</span>&nbsp;<span class="ident" id="3425406">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3425412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3425415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425418">return</span>&nbsp;<span class="ident" id="3425425">nil</span><span class="op" id="3425428">,</span>&nbsp;<span class="ident" id="3425430">nil</span><span class="op" id="3425433">,</span>&nbsp;<span class="ident" id="3425435">ErrMissingFile</span><br>
<span class="lineno">900</span><span class="op" id="3425450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3425453">func</span>&nbsp;<span class="op" id="3425458">(</span><span class="ident" id="3425459">r</span>&nbsp;<span class="op" id="3425461">*</span><span class="ident" id="3425462">Request</span><span class="op" id="3425469">)</span>&nbsp;<span class="ident" id="3425471">expectsContinue</span><span class="op" id="3425486">(</span><span class="op" id="3425487">)</span>&nbsp;<span class="builtintype" id="3425489">bool</span>&nbsp;<span class="op" id="3425494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425497">return</span>&nbsp;<span class="ident" id="3425504">hasToken</span><span class="op" id="3425512">(</span><span class="ident" id="3425513">r</span><span class="op" id="3425514">.</span><span class="ident" id="3425515">Header</span><span class="op" id="3425521">.</span><span class="ident" id="3425522">get</span><span class="op" id="3425525">(</span><span class="string" id="3425526">&#34;Expect&#34;</span><span class="op" id="3425534">)</span><span class="op" id="3425535">,</span>&nbsp;<span class="string" id="3425537">&#34;100-continue&#34;</span><span class="op" id="3425551">)</span><br>
<span class="lineno"></span><span class="op" id="3425553">}</span><br>
<span class="lineno">905</span><br>
<span class="lineno"></span><span class="keyword" id="3425556">func</span>&nbsp;<span class="op" id="3425561">(</span><span class="ident" id="3425562">r</span>&nbsp;<span class="op" id="3425564">*</span><span class="ident" id="3425565">Request</span><span class="op" id="3425572">)</span>&nbsp;<span class="ident" id="3425574">wantsHttp10KeepAlive</span><span class="op" id="3425594">(</span><span class="op" id="3425595">)</span>&nbsp;<span class="builtintype" id="3425597">bool</span>&nbsp;<span class="op" id="3425602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425605">if</span>&nbsp;<span class="ident" id="3425608">r</span><span class="op" id="3425609">.</span><span class="ident" id="3425610">ProtoMajor</span>&nbsp;<span class="op" id="3425621">!=</span>&nbsp;<span class="num" id="3425624">1</span>&nbsp;<span class="op" id="3425626">||</span>&nbsp;<span class="ident" id="3425629">r</span><span class="op" id="3425630">.</span><span class="ident" id="3425631">ProtoMinor</span>&nbsp;<span class="op" id="3425642">!=</span>&nbsp;<span class="num" id="3425645">0</span>&nbsp;<span class="op" id="3425647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425651">return</span>&nbsp;<span class="builtintype" id="3425658">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3425665">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425668">return</span>&nbsp;<span class="ident" id="3425675">hasToken</span><span class="op" id="3425683">(</span><span class="ident" id="3425684">r</span><span class="op" id="3425685">.</span><span class="ident" id="3425686">Header</span><span class="op" id="3425692">.</span><span class="ident" id="3425693">get</span><span class="op" id="3425696">(</span><span class="string" id="3425697">&#34;Connection&#34;</span><span class="op" id="3425709">)</span><span class="op" id="3425710">,</span>&nbsp;<span class="string" id="3425712">&#34;keep-alive&#34;</span><span class="op" id="3425724">)</span><br>
<span class="lineno"></span><span class="op" id="3425726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3425729">func</span>&nbsp;<span class="op" id="3425734">(</span><span class="ident" id="3425735">r</span>&nbsp;<span class="op" id="3425737">*</span><span class="ident" id="3425738">Request</span><span class="op" id="3425745">)</span>&nbsp;<span class="ident" id="3425747">wantsClose</span><span class="op" id="3425757">(</span><span class="op" id="3425758">)</span>&nbsp;<span class="builtintype" id="3425760">bool</span>&nbsp;<span class="op" id="3425765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425768">return</span>&nbsp;<span class="ident" id="3425775">hasToken</span><span class="op" id="3425783">(</span><span class="ident" id="3425784">r</span><span class="op" id="3425785">.</span><span class="ident" id="3425786">Header</span><span class="op" id="3425792">.</span><span class="ident" id="3425793">get</span><span class="op" id="3425796">(</span><span class="string" id="3425797">&#34;Connection&#34;</span><span class="op" id="3425809">)</span><span class="op" id="3425810">,</span>&nbsp;<span class="string" id="3425812">&#34;close&#34;</span><span class="op" id="3425819">)</span><br>
<span class="lineno">915</span><span class="op" id="3425821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3425824">func</span>&nbsp;<span class="op" id="3425829">(</span><span class="ident" id="3425830">r</span>&nbsp;<span class="op" id="3425832">*</span><span class="ident" id="3425833">Request</span><span class="op" id="3425840">)</span>&nbsp;<span class="ident" id="3425842">closeBody</span><span class="op" id="3425851">(</span><span class="op" id="3425852">)</span>&nbsp;<span class="op" id="3425854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425857">if</span>&nbsp;<span class="ident" id="3425860">r</span><span class="op" id="3425861">.</span><span class="ident" id="3425862">Body</span>&nbsp;<span class="op" id="3425867">!=</span>&nbsp;<span class="ident" id="3425870">nil</span>&nbsp;<span class="op" id="3425874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3425878">r</span><span class="op" id="3425879">.</span><span class="ident" id="3425880">Body</span><span class="op" id="3425884">.</span><span class="ident" id="3425885">Close</span><span class="op" id="3425890">(</span><span class="op" id="3425891">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3425894">}</span><br>
<span class="lineno"></span><span class="op" id="3425896">}</span>
</div>
</body>
</html>
