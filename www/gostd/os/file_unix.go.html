<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html" class="current">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2442757">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2442812">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2442866">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2442917">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2442987">package</span>&nbsp;<span class="ident" id="2442995">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2442999">import</span>&nbsp;<span class="op" id="2443006">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2443009">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2443020">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2443035">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2443045">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2443048">//&nbsp;File&nbsp;represents&nbsp;an&nbsp;open&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2443092">type</span>&nbsp;<span class="ident" id="2443097">File</span>&nbsp;<span class="keyword" id="2443102">struct</span>&nbsp;<span class="op" id="2443109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2443112">*</span><span class="ident" id="2443113">file</span><br>
<span class="lineno"></span><span class="op" id="2443118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="2443121">//&nbsp;file&nbsp;is&nbsp;the&nbsp;real&nbsp;representation&nbsp;of&nbsp;*File.</span><br>
<span class="lineno"></span><span class="comment" id="2443166">//&nbsp;The&nbsp;extra&nbsp;level&nbsp;of&nbsp;indirection&nbsp;ensures&nbsp;that&nbsp;no&nbsp;clients&nbsp;of&nbsp;os</span><br>
<span class="lineno"></span><span class="comment" id="2443230">//&nbsp;can&nbsp;overwrite&nbsp;this&nbsp;data,&nbsp;which&nbsp;could&nbsp;cause&nbsp;the&nbsp;finalizer</span><br>
<span class="lineno"></span><span class="comment" id="2443290">//&nbsp;to&nbsp;close&nbsp;the&nbsp;wrong&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2443329">type</span>&nbsp;<span class="ident" id="2443334">file</span>&nbsp;<span class="keyword" id="2443339">struct</span>&nbsp;<span class="op" id="2443346">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2443349">fd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2443357">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2443362">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2443370">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2443378">dirinfo</span>&nbsp;<span class="op" id="2443386">*</span><span class="ident" id="2443387">dirInfo</span>&nbsp;<span class="comment" id="2443395">//&nbsp;nil&nbsp;unless&nbsp;directory&nbsp;being&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2443431">nepipe</span>&nbsp;&nbsp;<span class="builtintype" id="2443439">int32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2443448">//&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;EPIPE&nbsp;in&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="2443488">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2443491">//&nbsp;Fd&nbsp;returns&nbsp;the&nbsp;integer&nbsp;Unix&nbsp;file&nbsp;descriptor&nbsp;referencing&nbsp;the&nbsp;open&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2443565">//&nbsp;The&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;valid&nbsp;only&nbsp;until&nbsp;f.Close&nbsp;is&nbsp;called&nbsp;or&nbsp;f&nbsp;is&nbsp;garbage&nbsp;collected.</span><br>
<span class="lineno"></span><span class="keyword" id="2443653">func</span>&nbsp;<span class="op" id="2443658">(</span><span class="ident" id="2443659">f</span>&nbsp;<span class="op" id="2443661">*</span><span class="ident" id="2443662">File</span><span class="op" id="2443666">)</span>&nbsp;<span class="ident" id="2443668">Fd</span><span class="op" id="2443670">(</span><span class="op" id="2443671">)</span>&nbsp;<span class="builtintype" id="2443673">uintptr</span>&nbsp;<span class="op" id="2443681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2443684">if</span>&nbsp;<span class="ident" id="2443687">f</span>&nbsp;<span class="op" id="2443689">==</span>&nbsp;<span class="builtintype" id="2443692">nil</span>&nbsp;<span class="op" id="2443696">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2443700">return</span>&nbsp;<span class="op" id="2443707">^</span><span class="op" id="2443708">(</span><span class="builtintype" id="2443709">uintptr</span><span class="op" id="2443716">(</span><span class="num" id="2443717">0</span><span class="op" id="2443718">)</span><span class="op" id="2443719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2443722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2443725">return</span>&nbsp;<span class="builtintype" id="2443732">uintptr</span><span class="op" id="2443739">(</span><span class="ident" id="2443740">f</span><span class="op" id="2443741">.</span><span class="ident" id="2443742">fd</span><span class="op" id="2443744">)</span><br>
<span class="lineno"></span><span class="op" id="2443746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2443749">//&nbsp;NewFile&nbsp;returns&nbsp;a&nbsp;new&nbsp;File&nbsp;with&nbsp;the&nbsp;given&nbsp;file&nbsp;descriptor&nbsp;and&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="2443820">func</span>&nbsp;<span class="ident" id="2443825">NewFile</span><span class="op" id="2443832">(</span><span class="ident" id="2443833">fd</span>&nbsp;<span class="builtintype" id="2443836">uintptr</span><span class="op" id="2443843">,</span>&nbsp;<span class="ident" id="2443845">name</span>&nbsp;<span class="builtintype" id="2443850">string</span><span class="op" id="2443856">)</span>&nbsp;<span class="op" id="2443858">*</span><span class="ident" id="2443859">File</span>&nbsp;<span class="op" id="2443864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2443867">fdi</span>&nbsp;<span class="op" id="2443871">:=</span>&nbsp;<span class="builtintype" id="2443874">int</span><span class="op" id="2443877">(</span><span class="ident" id="2443878">fd</span><span class="op" id="2443880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2443883">if</span>&nbsp;<span class="ident" id="2443886">fdi</span>&nbsp;<span class="op" id="2443890">&lt;</span>&nbsp;<span class="num" id="2443892">0</span>&nbsp;<span class="op" id="2443894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2443898">return</span>&nbsp;<span class="builtintype" id="2443905">nil</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2443910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2443913">f</span>&nbsp;<span class="op" id="2443915">:=</span>&nbsp;<span class="op" id="2443918">&amp;</span><span class="ident" id="2443919">File</span><span class="op" id="2443923">{</span><span class="op" id="2443924">&amp;</span><span class="ident" id="2443925">file</span><span class="op" id="2443929">{</span><span class="ident" id="2443930">fd</span><span class="op" id="2443932">:</span>&nbsp;<span class="ident" id="2443934">fdi</span><span class="op" id="2443937">,</span>&nbsp;<span class="ident" id="2443939">name</span><span class="op" id="2443943">:</span>&nbsp;<span class="ident" id="2443945">name</span><span class="op" id="2443949">}</span><span class="op" id="2443950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2443953">runtime</span><span class="op" id="2443960">.</span><span class="ident" id="2443961">SetFinalizer</span><span class="op" id="2443973">(</span><span class="ident" id="2443974">f</span><span class="op" id="2443975">.</span><span class="ident" id="2443976">file</span><span class="op" id="2443980">,</span>&nbsp;<span class="op" id="2443982">(</span><span class="op" id="2443983">*</span><span class="ident" id="2443984">file</span><span class="op" id="2443988">)</span><span class="op" id="2443989">.</span><span class="builtinfunc" id="2443990">close</span><span class="op" id="2443995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2443998">return</span>&nbsp;<span class="ident" id="2444005">f</span><br>
<span class="lineno"></span><span class="op" id="2444007">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="2444010">//&nbsp;Auxiliary&nbsp;information&nbsp;if&nbsp;the&nbsp;File&nbsp;describes&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="keyword" id="2444069">type</span>&nbsp;<span class="ident" id="2444074">dirInfo</span>&nbsp;<span class="keyword" id="2444082">struct</span>&nbsp;<span class="op" id="2444089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2444092">buf</span>&nbsp;&nbsp;<span class="op" id="2444097">[</span><span class="op" id="2444098">]</span><span class="builtintype" id="2444099">byte</span>&nbsp;<span class="comment" id="2444104">//&nbsp;buffer&nbsp;for&nbsp;directory&nbsp;I/O</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2444133">nbuf</span>&nbsp;<span class="builtintype" id="2444138">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2444145">//&nbsp;length&nbsp;of&nbsp;buf;&nbsp;return&nbsp;value&nbsp;from&nbsp;Getdirentries</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2444196">bufp</span>&nbsp;<span class="builtintype" id="2444201">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2444208">//&nbsp;location&nbsp;of&nbsp;next&nbsp;record&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span><span class="op" id="2444243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2444246">func</span>&nbsp;<span class="ident" id="2444251">epipecheck</span><span class="op" id="2444261">(</span><span class="ident" id="2444262">file</span>&nbsp;<span class="op" id="2444267">*</span><span class="ident" id="2444268">File</span><span class="op" id="2444272">,</span>&nbsp;<span class="ident" id="2444274">e</span>&nbsp;<span class="builtintype" id="2444276">error</span><span class="op" id="2444281">)</span>&nbsp;<span class="op" id="2444283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2444286">if</span>&nbsp;<span class="ident" id="2444289">e</span>&nbsp;<span class="op" id="2444291">==</span>&nbsp;<span class="ident" id="2444294">syscall</span><span class="op" id="2444301">.</span><span class="ident" id="2444302">EPIPE</span>&nbsp;<span class="op" id="2444308">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2444312">if</span>&nbsp;<span class="ident" id="2444315">atomic</span><span class="op" id="2444321">.</span><span class="ident" id="2444322">AddInt32</span><span class="op" id="2444330">(</span><span class="op" id="2444331">&amp;</span><span class="ident" id="2444332">file</span><span class="op" id="2444336">.</span><span class="ident" id="2444337">nepipe</span><span class="op" id="2444343">,</span>&nbsp;<span class="num" id="2444345">1</span><span class="op" id="2444346">)</span>&nbsp;<span class="op" id="2444348">&gt;=</span>&nbsp;<span class="num" id="2444351">10</span>&nbsp;<span class="op" id="2444354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2444359">sigpipe</span><span class="op" id="2444366">(</span><span class="op" id="2444367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2444371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2444374">}</span>&nbsp;<span class="keyword" id="2444376">else</span>&nbsp;<span class="op" id="2444381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2444385">atomic</span><span class="op" id="2444391">.</span><span class="ident" id="2444392">StoreInt32</span><span class="op" id="2444402">(</span><span class="op" id="2444403">&amp;</span><span class="ident" id="2444404">file</span><span class="op" id="2444408">.</span><span class="ident" id="2444409">nepipe</span><span class="op" id="2444415">,</span>&nbsp;<span class="num" id="2444417">0</span><span class="op" id="2444418">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2444421">}</span><br>
<span class="lineno"></span><span class="op" id="2444423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2444426">//&nbsp;DevNull&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;operating&nbsp;system&#39;s&nbsp;``null&nbsp;device.&#39;&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2444492">//&nbsp;On&nbsp;Unix-like&nbsp;systems,&nbsp;it&nbsp;is&nbsp;&#34;/dev/null&#34;;&nbsp;on&nbsp;Windows,&nbsp;&#34;NUL&#34;.</span><br>
<span class="lineno">70</span><span class="keyword" id="2444555">const</span>&nbsp;<span class="ident" id="2444561">DevNull</span>&nbsp;<span class="op" id="2444569">=</span>&nbsp;<span class="string" id="2444571">&#34;/dev/null&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2444584">//&nbsp;OpenFile&nbsp;is&nbsp;the&nbsp;generalized&nbsp;open&nbsp;call;&nbsp;most&nbsp;users&nbsp;will&nbsp;use&nbsp;Open</span><br>
<span class="lineno"></span><span class="comment" id="2444651">//&nbsp;or&nbsp;Create&nbsp;instead.&nbsp;&nbsp;It&nbsp;opens&nbsp;the&nbsp;named&nbsp;file&nbsp;with&nbsp;specified&nbsp;flag</span><br>
<span class="lineno"></span><span class="comment" id="2444718">//&nbsp;(O_RDONLY&nbsp;etc.)&nbsp;and&nbsp;perm,&nbsp;(0666&nbsp;etc.)&nbsp;if&nbsp;applicable.&nbsp;&nbsp;If&nbsp;successful,</span><br>
<span class="lineno">75</span><span class="comment" id="2444790">//&nbsp;methods&nbsp;on&nbsp;the&nbsp;returned&nbsp;File&nbsp;can&nbsp;be&nbsp;used&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2444843">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2444899">func</span>&nbsp;<span class="ident" id="2444904">OpenFile</span><span class="op" id="2444912">(</span><span class="ident" id="2444913">name</span>&nbsp;<span class="builtintype" id="2444918">string</span><span class="op" id="2444924">,</span>&nbsp;<span class="ident" id="2444926">flag</span>&nbsp;<span class="builtintype" id="2444931">int</span><span class="op" id="2444934">,</span>&nbsp;<span class="ident" id="2444936">perm</span>&nbsp;<span class="ident" id="2444941">FileMode</span><span class="op" id="2444949">)</span>&nbsp;<span class="op" id="2444951">(</span><span class="ident" id="2444952">file</span>&nbsp;<span class="op" id="2444957">*</span><span class="ident" id="2444958">File</span><span class="op" id="2444962">,</span>&nbsp;<span class="ident" id="2444964">err</span>&nbsp;<span class="builtintype" id="2444968">error</span><span class="op" id="2444973">)</span>&nbsp;<span class="op" id="2444975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2444978">r</span><span class="op" id="2444979">,</span>&nbsp;<span class="ident" id="2444981">e</span>&nbsp;<span class="op" id="2444983">:=</span>&nbsp;<span class="ident" id="2444986">syscall</span><span class="op" id="2444993">.</span><span class="ident" id="2444994">Open</span><span class="op" id="2444998">(</span><span class="ident" id="2444999">name</span><span class="op" id="2445003">,</span>&nbsp;<span class="ident" id="2445005">flag</span><span class="op" id="2445009">|</span><span class="ident" id="2445010">syscall</span><span class="op" id="2445017">.</span><span class="ident" id="2445018">O_CLOEXEC</span><span class="op" id="2445027">,</span>&nbsp;<span class="ident" id="2445029">syscallMode</span><span class="op" id="2445040">(</span><span class="ident" id="2445041">perm</span><span class="op" id="2445045">)</span><span class="op" id="2445046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2445049">if</span>&nbsp;<span class="ident" id="2445052">e</span>&nbsp;<span class="op" id="2445054">!=</span>&nbsp;<span class="builtintype" id="2445057">nil</span>&nbsp;<span class="op" id="2445061">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2445065">return</span>&nbsp;<span class="builtintype" id="2445072">nil</span><span class="op" id="2445075">,</span>&nbsp;<span class="op" id="2445077">&amp;</span><span class="ident" id="2445078">PathError</span><span class="op" id="2445087">{</span><span class="string" id="2445088">&#34;open&#34;</span><span class="op" id="2445094">,</span>&nbsp;<span class="ident" id="2445096">name</span><span class="op" id="2445100">,</span>&nbsp;<span class="ident" id="2445102">e</span><span class="op" id="2445103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2445106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2445110">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here&nbsp;with&nbsp;fork/exec,&nbsp;which&nbsp;we&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2445163">//&nbsp;content&nbsp;to&nbsp;live&nbsp;with.&nbsp;&nbsp;See&nbsp;../syscall/exec_unix.go.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2445219">if</span>&nbsp;<span class="op" id="2445222">!</span><span class="ident" id="2445223">supportsCloseOnExec</span>&nbsp;<span class="op" id="2445243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2445247">syscall</span><span class="op" id="2445254">.</span><span class="ident" id="2445255">CloseOnExec</span><span class="op" id="2445266">(</span><span class="ident" id="2445267">r</span><span class="op" id="2445268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2445271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2445275">return</span>&nbsp;<span class="ident" id="2445282">NewFile</span><span class="op" id="2445289">(</span><span class="builtintype" id="2445290">uintptr</span><span class="op" id="2445297">(</span><span class="ident" id="2445298">r</span><span class="op" id="2445299">)</span><span class="op" id="2445300">,</span>&nbsp;<span class="ident" id="2445302">name</span><span class="op" id="2445306">)</span><span class="op" id="2445307">,</span>&nbsp;<span class="builtintype" id="2445309">nil</span><br>
<span class="lineno">90</span><span class="op" id="2445313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2445316">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;File,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2445373">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2445405">func</span>&nbsp;<span class="op" id="2445410">(</span><span class="ident" id="2445411">f</span>&nbsp;<span class="op" id="2445413">*</span><span class="ident" id="2445414">File</span><span class="op" id="2445418">)</span>&nbsp;<span class="ident" id="2445420">Close</span><span class="op" id="2445425">(</span><span class="op" id="2445426">)</span>&nbsp;<span class="builtintype" id="2445428">error</span>&nbsp;<span class="op" id="2445434">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2445437">if</span>&nbsp;<span class="ident" id="2445440">f</span>&nbsp;<span class="op" id="2445442">==</span>&nbsp;<span class="builtintype" id="2445445">nil</span>&nbsp;<span class="op" id="2445449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2445453">return</span>&nbsp;<span class="ident" id="2445460">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2445472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2445475">return</span>&nbsp;<span class="ident" id="2445482">f</span><span class="op" id="2445483">.</span><span class="ident" id="2445484">file</span><span class="op" id="2445488">.</span><span class="builtinfunc" id="2445489">close</span><span class="op" id="2445494">(</span><span class="op" id="2445495">)</span><br>
<span class="lineno"></span><span class="op" id="2445497">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2445500">func</span>&nbsp;<span class="op" id="2445505">(</span><span class="ident" id="2445506">file</span>&nbsp;<span class="op" id="2445511">*</span><span class="ident" id="2445512">file</span><span class="op" id="2445516">)</span>&nbsp;<span class="builtinfunc" id="2445518">close</span><span class="op" id="2445523">(</span><span class="op" id="2445524">)</span>&nbsp;<span class="builtintype" id="2445526">error</span>&nbsp;<span class="op" id="2445532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2445535">if</span>&nbsp;<span class="ident" id="2445538">file</span>&nbsp;<span class="op" id="2445543">==</span>&nbsp;<span class="builtintype" id="2445546">nil</span>&nbsp;<span class="op" id="2445550">||</span>&nbsp;<span class="ident" id="2445553">file</span><span class="op" id="2445557">.</span><span class="ident" id="2445558">fd</span>&nbsp;<span class="op" id="2445561">&lt;</span>&nbsp;<span class="num" id="2445563">0</span>&nbsp;<span class="op" id="2445565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2445569">return</span>&nbsp;<span class="ident" id="2445576">syscall</span><span class="op" id="2445583">.</span><span class="ident" id="2445584">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2445592">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2445595">var</span>&nbsp;<span class="ident" id="2445599">err</span>&nbsp;<span class="builtintype" id="2445603">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2445610">if</span>&nbsp;<span class="ident" id="2445613">e</span>&nbsp;<span class="op" id="2445615">:=</span>&nbsp;<span class="ident" id="2445618">syscall</span><span class="op" id="2445625">.</span><span class="ident" id="2445626">Close</span><span class="op" id="2445631">(</span><span class="ident" id="2445632">file</span><span class="op" id="2445636">.</span><span class="ident" id="2445637">fd</span><span class="op" id="2445639">)</span><span class="op" id="2445640">;</span>&nbsp;<span class="ident" id="2445642">e</span>&nbsp;<span class="op" id="2445644">!=</span>&nbsp;<span class="builtintype" id="2445647">nil</span>&nbsp;<span class="op" id="2445651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2445655">err</span>&nbsp;<span class="op" id="2445659">=</span>&nbsp;<span class="op" id="2445661">&amp;</span><span class="ident" id="2445662">PathError</span><span class="op" id="2445671">{</span><span class="string" id="2445672">&#34;close&#34;</span><span class="op" id="2445679">,</span>&nbsp;<span class="ident" id="2445681">file</span><span class="op" id="2445685">.</span><span class="ident" id="2445686">name</span><span class="op" id="2445690">,</span>&nbsp;<span class="ident" id="2445692">e</span><span class="op" id="2445693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2445696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2445699">file</span><span class="op" id="2445703">.</span><span class="ident" id="2445704">fd</span>&nbsp;<span class="op" id="2445707">=</span>&nbsp;<span class="op" id="2445709">-</span><span class="num" id="2445710">1</span>&nbsp;<span class="comment" id="2445712">//&nbsp;so&nbsp;it&nbsp;can&#39;t&nbsp;be&nbsp;closed&nbsp;again</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2445745">//&nbsp;no&nbsp;need&nbsp;for&nbsp;a&nbsp;finalizer&nbsp;anymore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2445781">runtime</span><span class="op" id="2445788">.</span><span class="ident" id="2445789">SetFinalizer</span><span class="op" id="2445801">(</span><span class="ident" id="2445802">file</span><span class="op" id="2445806">,</span>&nbsp;<span class="builtintype" id="2445808">nil</span><span class="op" id="2445811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2445814">return</span>&nbsp;<span class="ident" id="2445821">err</span><br>
<span class="lineno"></span><span class="op" id="2445825">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2445828">//&nbsp;Stat&nbsp;returns&nbsp;the&nbsp;FileInfo&nbsp;structure&nbsp;describing&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2445884">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2445940">func</span>&nbsp;<span class="op" id="2445945">(</span><span class="ident" id="2445946">f</span>&nbsp;<span class="op" id="2445948">*</span><span class="ident" id="2445949">File</span><span class="op" id="2445953">)</span>&nbsp;<span class="ident" id="2445955">Stat</span><span class="op" id="2445959">(</span><span class="op" id="2445960">)</span>&nbsp;<span class="op" id="2445962">(</span><span class="ident" id="2445963">fi</span>&nbsp;<span class="ident" id="2445966">FileInfo</span><span class="op" id="2445974">,</span>&nbsp;<span class="ident" id="2445976">err</span>&nbsp;<span class="builtintype" id="2445980">error</span><span class="op" id="2445985">)</span>&nbsp;<span class="op" id="2445987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2445990">if</span>&nbsp;<span class="ident" id="2445993">f</span>&nbsp;<span class="op" id="2445995">==</span>&nbsp;<span class="builtintype" id="2445998">nil</span>&nbsp;<span class="op" id="2446002">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2446006">return</span>&nbsp;<span class="builtintype" id="2446013">nil</span><span class="op" id="2446016">,</span>&nbsp;<span class="ident" id="2446018">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2446030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2446033">var</span>&nbsp;<span class="ident" id="2446037">stat</span>&nbsp;<span class="ident" id="2446042">syscall</span><span class="op" id="2446049">.</span><span class="ident" id="2446050">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2446058">err</span>&nbsp;<span class="op" id="2446062">=</span>&nbsp;<span class="ident" id="2446064">syscall</span><span class="op" id="2446071">.</span><span class="ident" id="2446072">Fstat</span><span class="op" id="2446077">(</span><span class="ident" id="2446078">f</span><span class="op" id="2446079">.</span><span class="ident" id="2446080">fd</span><span class="op" id="2446082">,</span>&nbsp;<span class="op" id="2446084">&amp;</span><span class="ident" id="2446085">stat</span><span class="op" id="2446089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2446092">if</span>&nbsp;<span class="ident" id="2446095">err</span>&nbsp;<span class="op" id="2446099">!=</span>&nbsp;<span class="builtintype" id="2446102">nil</span>&nbsp;<span class="op" id="2446106">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2446110">return</span>&nbsp;<span class="builtintype" id="2446117">nil</span><span class="op" id="2446120">,</span>&nbsp;<span class="op" id="2446122">&amp;</span><span class="ident" id="2446123">PathError</span><span class="op" id="2446132">{</span><span class="string" id="2446133">&#34;stat&#34;</span><span class="op" id="2446139">,</span>&nbsp;<span class="ident" id="2446141">f</span><span class="op" id="2446142">.</span><span class="ident" id="2446143">name</span><span class="op" id="2446147">,</span>&nbsp;<span class="ident" id="2446149">err</span><span class="op" id="2446152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2446155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2446158">return</span>&nbsp;<span class="ident" id="2446165">fileInfoFromStat</span><span class="op" id="2446181">(</span><span class="op" id="2446182">&amp;</span><span class="ident" id="2446183">stat</span><span class="op" id="2446187">,</span>&nbsp;<span class="ident" id="2446189">f</span><span class="op" id="2446190">.</span><span class="ident" id="2446191">name</span><span class="op" id="2446195">)</span><span class="op" id="2446196">,</span>&nbsp;<span class="builtintype" id="2446198">nil</span><br>
<span class="lineno"></span><span class="op" id="2446202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="2446205">//&nbsp;Stat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2446259">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2446315">func</span>&nbsp;<span class="ident" id="2446320">Stat</span><span class="op" id="2446324">(</span><span class="ident" id="2446325">name</span>&nbsp;<span class="builtintype" id="2446330">string</span><span class="op" id="2446336">)</span>&nbsp;<span class="op" id="2446338">(</span><span class="ident" id="2446339">fi</span>&nbsp;<span class="ident" id="2446342">FileInfo</span><span class="op" id="2446350">,</span>&nbsp;<span class="ident" id="2446352">err</span>&nbsp;<span class="builtintype" id="2446356">error</span><span class="op" id="2446361">)</span>&nbsp;<span class="op" id="2446363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2446366">var</span>&nbsp;<span class="ident" id="2446370">stat</span>&nbsp;<span class="ident" id="2446375">syscall</span><span class="op" id="2446382">.</span><span class="ident" id="2446383">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2446391">err</span>&nbsp;<span class="op" id="2446395">=</span>&nbsp;<span class="ident" id="2446397">syscall</span><span class="op" id="2446404">.</span><span class="ident" id="2446405">Stat</span><span class="op" id="2446409">(</span><span class="ident" id="2446410">name</span><span class="op" id="2446414">,</span>&nbsp;<span class="op" id="2446416">&amp;</span><span class="ident" id="2446417">stat</span><span class="op" id="2446421">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2446424">if</span>&nbsp;<span class="ident" id="2446427">err</span>&nbsp;<span class="op" id="2446431">!=</span>&nbsp;<span class="builtintype" id="2446434">nil</span>&nbsp;<span class="op" id="2446438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2446442">return</span>&nbsp;<span class="builtintype" id="2446449">nil</span><span class="op" id="2446452">,</span>&nbsp;<span class="op" id="2446454">&amp;</span><span class="ident" id="2446455">PathError</span><span class="op" id="2446464">{</span><span class="string" id="2446465">&#34;stat&#34;</span><span class="op" id="2446471">,</span>&nbsp;<span class="ident" id="2446473">name</span><span class="op" id="2446477">,</span>&nbsp;<span class="ident" id="2446479">err</span><span class="op" id="2446482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2446485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2446488">return</span>&nbsp;<span class="ident" id="2446495">fileInfoFromStat</span><span class="op" id="2446511">(</span><span class="op" id="2446512">&amp;</span><span class="ident" id="2446513">stat</span><span class="op" id="2446517">,</span>&nbsp;<span class="ident" id="2446519">name</span><span class="op" id="2446523">)</span><span class="op" id="2446524">,</span>&nbsp;<span class="builtintype" id="2446526">nil</span><br>
<span class="lineno"></span><span class="op" id="2446530">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="2446533">//&nbsp;Lstat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2446588">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;the&nbsp;returned&nbsp;FileInfo</span><br>
<span class="lineno"></span><span class="comment" id="2446645">//&nbsp;describes&nbsp;the&nbsp;symbolic&nbsp;link.&nbsp;&nbsp;Lstat&nbsp;makes&nbsp;no&nbsp;attempt&nbsp;to&nbsp;follow&nbsp;the&nbsp;link.</span><br>
<span class="lineno"></span><span class="comment" id="2446721">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno">145</span><span class="keyword" id="2446777">func</span>&nbsp;<span class="ident" id="2446782">Lstat</span><span class="op" id="2446787">(</span><span class="ident" id="2446788">name</span>&nbsp;<span class="builtintype" id="2446793">string</span><span class="op" id="2446799">)</span>&nbsp;<span class="op" id="2446801">(</span><span class="ident" id="2446802">fi</span>&nbsp;<span class="ident" id="2446805">FileInfo</span><span class="op" id="2446813">,</span>&nbsp;<span class="ident" id="2446815">err</span>&nbsp;<span class="builtintype" id="2446819">error</span><span class="op" id="2446824">)</span>&nbsp;<span class="op" id="2446826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2446829">var</span>&nbsp;<span class="ident" id="2446833">stat</span>&nbsp;<span class="ident" id="2446838">syscall</span><span class="op" id="2446845">.</span><span class="ident" id="2446846">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2446854">err</span>&nbsp;<span class="op" id="2446858">=</span>&nbsp;<span class="ident" id="2446860">syscall</span><span class="op" id="2446867">.</span><span class="ident" id="2446868">Lstat</span><span class="op" id="2446873">(</span><span class="ident" id="2446874">name</span><span class="op" id="2446878">,</span>&nbsp;<span class="op" id="2446880">&amp;</span><span class="ident" id="2446881">stat</span><span class="op" id="2446885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2446888">if</span>&nbsp;<span class="ident" id="2446891">err</span>&nbsp;<span class="op" id="2446895">!=</span>&nbsp;<span class="builtintype" id="2446898">nil</span>&nbsp;<span class="op" id="2446902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2446906">return</span>&nbsp;<span class="builtintype" id="2446913">nil</span><span class="op" id="2446916">,</span>&nbsp;<span class="op" id="2446918">&amp;</span><span class="ident" id="2446919">PathError</span><span class="op" id="2446928">{</span><span class="string" id="2446929">&#34;lstat&#34;</span><span class="op" id="2446936">,</span>&nbsp;<span class="ident" id="2446938">name</span><span class="op" id="2446942">,</span>&nbsp;<span class="ident" id="2446944">err</span><span class="op" id="2446947">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2446950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2446953">return</span>&nbsp;<span class="ident" id="2446960">fileInfoFromStat</span><span class="op" id="2446976">(</span><span class="op" id="2446977">&amp;</span><span class="ident" id="2446978">stat</span><span class="op" id="2446982">,</span>&nbsp;<span class="ident" id="2446984">name</span><span class="op" id="2446988">)</span><span class="op" id="2446989">,</span>&nbsp;<span class="builtintype" id="2446991">nil</span><br>
<span class="lineno"></span><span class="op" id="2446995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2446998">func</span>&nbsp;<span class="op" id="2447003">(</span><span class="ident" id="2447004">f</span>&nbsp;<span class="op" id="2447006">*</span><span class="ident" id="2447007">File</span><span class="op" id="2447011">)</span>&nbsp;<span class="ident" id="2447013">readdir</span><span class="op" id="2447020">(</span><span class="ident" id="2447021">n</span>&nbsp;<span class="builtintype" id="2447023">int</span><span class="op" id="2447026">)</span>&nbsp;<span class="op" id="2447028">(</span><span class="ident" id="2447029">fi</span>&nbsp;<span class="op" id="2447032">[</span><span class="op" id="2447033">]</span><span class="ident" id="2447034">FileInfo</span><span class="op" id="2447042">,</span>&nbsp;<span class="ident" id="2447044">err</span>&nbsp;<span class="builtintype" id="2447048">error</span><span class="op" id="2447053">)</span>&nbsp;<span class="op" id="2447055">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2447058">dirname</span>&nbsp;<span class="op" id="2447066">:=</span>&nbsp;<span class="ident" id="2447069">f</span><span class="op" id="2447070">.</span><span class="ident" id="2447071">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2447077">if</span>&nbsp;<span class="ident" id="2447080">dirname</span>&nbsp;<span class="op" id="2447088">==</span>&nbsp;<span class="string" id="2447091">&#34;&#34;</span>&nbsp;<span class="op" id="2447094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2447098">dirname</span>&nbsp;<span class="op" id="2447106">=</span>&nbsp;<span class="string" id="2447108">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2447113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2447116">names</span><span class="op" id="2447121">,</span>&nbsp;<span class="ident" id="2447123">err</span>&nbsp;<span class="op" id="2447127">:=</span>&nbsp;<span class="ident" id="2447130">f</span><span class="op" id="2447131">.</span><span class="ident" id="2447132">Readdirnames</span><span class="op" id="2447144">(</span><span class="ident" id="2447145">n</span><span class="op" id="2447146">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2447149">fi</span>&nbsp;<span class="op" id="2447152">=</span>&nbsp;<span class="builtinfunc" id="2447154">make</span><span class="op" id="2447158">(</span><span class="op" id="2447159">[</span><span class="op" id="2447160">]</span><span class="ident" id="2447161">FileInfo</span><span class="op" id="2447169">,</span>&nbsp;<span class="num" id="2447171">0</span><span class="op" id="2447172">,</span>&nbsp;<span class="builtinfunc" id="2447174">len</span><span class="op" id="2447177">(</span><span class="ident" id="2447178">names</span><span class="op" id="2447183">)</span><span class="op" id="2447184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2447187">for</span>&nbsp;<span class="ident" id="2447191">_</span><span class="op" id="2447192">,</span>&nbsp;<span class="ident" id="2447194">filename</span>&nbsp;<span class="op" id="2447203">:=</span>&nbsp;<span class="keyword" id="2447206">range</span>&nbsp;<span class="ident" id="2447212">names</span>&nbsp;<span class="op" id="2447218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2447222">fip</span><span class="op" id="2447225">,</span>&nbsp;<span class="ident" id="2447227">lerr</span>&nbsp;<span class="op" id="2447232">:=</span>&nbsp;<span class="ident" id="2447235">lstat</span><span class="op" id="2447240">(</span><span class="ident" id="2447241">dirname</span>&nbsp;<span class="op" id="2447249">+</span>&nbsp;<span class="string" id="2447251">&#34;/&#34;</span>&nbsp;<span class="op" id="2447255">+</span>&nbsp;<span class="ident" id="2447257">filename</span><span class="op" id="2447265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2447269">if</span>&nbsp;<span class="ident" id="2447272">IsNotExist</span><span class="op" id="2447282">(</span><span class="ident" id="2447283">lerr</span><span class="op" id="2447287">)</span>&nbsp;<span class="op" id="2447289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2447294">//&nbsp;File&nbsp;disappeared&nbsp;between&nbsp;readdir&nbsp;+&nbsp;stat.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2447341">//&nbsp;Just&nbsp;treat&nbsp;it&nbsp;as&nbsp;if&nbsp;it&nbsp;didn&#39;t&nbsp;exist.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2447384">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2447395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2447399">if</span>&nbsp;<span class="ident" id="2447402">lerr</span>&nbsp;<span class="op" id="2447407">!=</span>&nbsp;<span class="builtintype" id="2447410">nil</span>&nbsp;<span class="op" id="2447414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2447419">return</span>&nbsp;<span class="ident" id="2447426">fi</span><span class="op" id="2447428">,</span>&nbsp;<span class="ident" id="2447430">lerr</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2447437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2447441">fi</span>&nbsp;<span class="op" id="2447444">=</span>&nbsp;<span class="builtinfunc" id="2447446">append</span><span class="op" id="2447452">(</span><span class="ident" id="2447453">fi</span><span class="op" id="2447455">,</span>&nbsp;<span class="ident" id="2447457">fip</span><span class="op" id="2447460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2447463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2447466">return</span>&nbsp;<span class="ident" id="2447473">fi</span><span class="op" id="2447475">,</span>&nbsp;<span class="ident" id="2447477">err</span><br>
<span class="lineno"></span><span class="op" id="2447481">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="2447484">//&nbsp;Darwin&nbsp;and&nbsp;FreeBSD&nbsp;can&#39;t&nbsp;read&nbsp;or&nbsp;write&nbsp;2GB+&nbsp;at&nbsp;a&nbsp;time,</span><br>
<span class="lineno"></span><span class="comment" id="2447542">//&nbsp;even&nbsp;on&nbsp;64-bit&nbsp;systems.&nbsp;See&nbsp;golang.org/issue/7812.</span><br>
<span class="lineno"></span><span class="comment" id="2447596">//&nbsp;Use&nbsp;1GB&nbsp;instead&nbsp;of,&nbsp;say,&nbsp;2GB-1,&nbsp;to&nbsp;keep&nbsp;subsequent</span><br>
<span class="lineno"></span><span class="comment" id="2447650">//&nbsp;reads&nbsp;aligned.</span><br>
<span class="lineno">180</span><span class="keyword" id="2447668">const</span>&nbsp;<span class="op" id="2447674">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2447677">needsMaxRW</span>&nbsp;<span class="op" id="2447688">=</span>&nbsp;<span class="ident" id="2447690">runtime</span><span class="op" id="2447697">.</span><span class="ident" id="2447698">GOOS</span>&nbsp;<span class="op" id="2447703">==</span>&nbsp;<span class="string" id="2447706">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2447715">||</span>&nbsp;<span class="ident" id="2447718">runtime</span><span class="op" id="2447725">.</span><span class="ident" id="2447726">GOOS</span>&nbsp;<span class="op" id="2447731">==</span>&nbsp;<span class="string" id="2447734">&#34;freebsd&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2447745">maxRW</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2447756">=</span>&nbsp;<span class="num" id="2447758">1</span>&nbsp;<span class="op" id="2447760">&lt;&lt;</span>&nbsp;<span class="num" id="2447763">30</span><br>
<span class="lineno"></span><span class="op" id="2447766">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="2447769">//&nbsp;read&nbsp;reads&nbsp;up&nbsp;to&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File.</span><br>
<span class="lineno"></span><span class="comment" id="2447817">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2447878">func</span>&nbsp;<span class="op" id="2447883">(</span><span class="ident" id="2447884">f</span>&nbsp;<span class="op" id="2447886">*</span><span class="ident" id="2447887">File</span><span class="op" id="2447891">)</span>&nbsp;<span class="ident" id="2447893">read</span><span class="op" id="2447897">(</span><span class="ident" id="2447898">b</span>&nbsp;<span class="op" id="2447900">[</span><span class="op" id="2447901">]</span><span class="builtintype" id="2447902">byte</span><span class="op" id="2447906">)</span>&nbsp;<span class="op" id="2447908">(</span><span class="ident" id="2447909">n</span>&nbsp;<span class="builtintype" id="2447911">int</span><span class="op" id="2447914">,</span>&nbsp;<span class="ident" id="2447916">err</span>&nbsp;<span class="builtintype" id="2447920">error</span><span class="op" id="2447925">)</span>&nbsp;<span class="op" id="2447927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2447930">if</span>&nbsp;<span class="ident" id="2447933">needsMaxRW</span>&nbsp;<span class="op" id="2447944">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2447947">len</span><span class="op" id="2447950">(</span><span class="ident" id="2447951">b</span><span class="op" id="2447952">)</span>&nbsp;<span class="op" id="2447954">&gt;</span>&nbsp;<span class="ident" id="2447956">maxRW</span>&nbsp;<span class="op" id="2447962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2447966">b</span>&nbsp;<span class="op" id="2447968">=</span>&nbsp;<span class="ident" id="2447970">b</span><span class="op" id="2447971">[</span><span class="op" id="2447972">:</span><span class="ident" id="2447973">maxRW</span><span class="op" id="2447978">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2447981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2447984">return</span>&nbsp;<span class="ident" id="2447991">fixCount</span><span class="op" id="2447999">(</span><span class="ident" id="2448000">syscall</span><span class="op" id="2448007">.</span><span class="ident" id="2448008">Read</span><span class="op" id="2448012">(</span><span class="ident" id="2448013">f</span><span class="op" id="2448014">.</span><span class="ident" id="2448015">fd</span><span class="op" id="2448017">,</span>&nbsp;<span class="ident" id="2448019">b</span><span class="op" id="2448020">)</span><span class="op" id="2448021">)</span><br>
<span class="lineno"></span><span class="op" id="2448023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2448026">//&nbsp;pread&nbsp;reads&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno">195</span><span class="comment" id="2448097">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;the&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="2448159">//&nbsp;EOF&nbsp;is&nbsp;signaled&nbsp;by&nbsp;a&nbsp;zero&nbsp;count&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2448215">func</span>&nbsp;<span class="op" id="2448220">(</span><span class="ident" id="2448221">f</span>&nbsp;<span class="op" id="2448223">*</span><span class="ident" id="2448224">File</span><span class="op" id="2448228">)</span>&nbsp;<span class="ident" id="2448230">pread</span><span class="op" id="2448235">(</span><span class="ident" id="2448236">b</span>&nbsp;<span class="op" id="2448238">[</span><span class="op" id="2448239">]</span><span class="builtintype" id="2448240">byte</span><span class="op" id="2448244">,</span>&nbsp;<span class="ident" id="2448246">off</span>&nbsp;<span class="ident" id="2448250">int64</span><span class="op" id="2448255">)</span>&nbsp;<span class="op" id="2448257">(</span><span class="ident" id="2448258">n</span>&nbsp;<span class="builtintype" id="2448260">int</span><span class="op" id="2448263">,</span>&nbsp;<span class="ident" id="2448265">err</span>&nbsp;<span class="builtintype" id="2448269">error</span><span class="op" id="2448274">)</span>&nbsp;<span class="op" id="2448276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2448279">if</span>&nbsp;<span class="ident" id="2448282">needsMaxRW</span>&nbsp;<span class="op" id="2448293">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2448296">len</span><span class="op" id="2448299">(</span><span class="ident" id="2448300">b</span><span class="op" id="2448301">)</span>&nbsp;<span class="op" id="2448303">&gt;</span>&nbsp;<span class="ident" id="2448305">maxRW</span>&nbsp;<span class="op" id="2448311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2448315">b</span>&nbsp;<span class="op" id="2448317">=</span>&nbsp;<span class="ident" id="2448319">b</span><span class="op" id="2448320">[</span><span class="op" id="2448321">:</span><span class="ident" id="2448322">maxRW</span><span class="op" id="2448327">]</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2448330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2448333">return</span>&nbsp;<span class="ident" id="2448340">fixCount</span><span class="op" id="2448348">(</span><span class="ident" id="2448349">syscall</span><span class="op" id="2448356">.</span><span class="ident" id="2448357">Pread</span><span class="op" id="2448362">(</span><span class="ident" id="2448363">f</span><span class="op" id="2448364">.</span><span class="ident" id="2448365">fd</span><span class="op" id="2448367">,</span>&nbsp;<span class="ident" id="2448369">b</span><span class="op" id="2448370">,</span>&nbsp;<span class="ident" id="2448372">off</span><span class="op" id="2448375">)</span><span class="op" id="2448376">)</span><br>
<span class="lineno"></span><span class="op" id="2448378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2448381">//&nbsp;write&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File.</span><br>
<span class="lineno">205</span><span class="comment" id="2448423">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2448487">func</span>&nbsp;<span class="op" id="2448492">(</span><span class="ident" id="2448493">f</span>&nbsp;<span class="op" id="2448495">*</span><span class="ident" id="2448496">File</span><span class="op" id="2448500">)</span>&nbsp;<span class="ident" id="2448502">write</span><span class="op" id="2448507">(</span><span class="ident" id="2448508">b</span>&nbsp;<span class="op" id="2448510">[</span><span class="op" id="2448511">]</span><span class="builtintype" id="2448512">byte</span><span class="op" id="2448516">)</span>&nbsp;<span class="op" id="2448518">(</span><span class="ident" id="2448519">n</span>&nbsp;<span class="builtintype" id="2448521">int</span><span class="op" id="2448524">,</span>&nbsp;<span class="ident" id="2448526">err</span>&nbsp;<span class="builtintype" id="2448530">error</span><span class="op" id="2448535">)</span>&nbsp;<span class="op" id="2448537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2448540">for</span>&nbsp;<span class="op" id="2448544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2448548">bcap</span>&nbsp;<span class="op" id="2448553">:=</span>&nbsp;<span class="ident" id="2448556">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2448560">if</span>&nbsp;<span class="ident" id="2448563">needsMaxRW</span>&nbsp;<span class="op" id="2448574">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2448577">len</span><span class="op" id="2448580">(</span><span class="ident" id="2448581">bcap</span><span class="op" id="2448585">)</span>&nbsp;<span class="op" id="2448587">&gt;</span>&nbsp;<span class="ident" id="2448589">maxRW</span>&nbsp;<span class="op" id="2448595">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2448600">bcap</span>&nbsp;<span class="op" id="2448605">=</span>&nbsp;<span class="ident" id="2448607">bcap</span><span class="op" id="2448611">[</span><span class="op" id="2448612">:</span><span class="ident" id="2448613">maxRW</span><span class="op" id="2448618">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2448622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2448626">m</span><span class="op" id="2448627">,</span>&nbsp;<span class="ident" id="2448629">err</span>&nbsp;<span class="op" id="2448633">:=</span>&nbsp;<span class="ident" id="2448636">fixCount</span><span class="op" id="2448644">(</span><span class="ident" id="2448645">syscall</span><span class="op" id="2448652">.</span><span class="ident" id="2448653">Write</span><span class="op" id="2448658">(</span><span class="ident" id="2448659">f</span><span class="op" id="2448660">.</span><span class="ident" id="2448661">fd</span><span class="op" id="2448663">,</span>&nbsp;<span class="ident" id="2448665">bcap</span><span class="op" id="2448669">)</span><span class="op" id="2448670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2448674">n</span>&nbsp;<span class="op" id="2448676">+=</span>&nbsp;<span class="ident" id="2448679">m</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2448684">//&nbsp;If&nbsp;the&nbsp;syscall&nbsp;wrote&nbsp;some&nbsp;data&nbsp;but&nbsp;not&nbsp;all&nbsp;(short&nbsp;write)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2448746">//&nbsp;or&nbsp;it&nbsp;returned&nbsp;EINTR,&nbsp;then&nbsp;assume&nbsp;it&nbsp;stopped&nbsp;early&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2448806">//&nbsp;reasons&nbsp;that&nbsp;are&nbsp;uninteresting&nbsp;to&nbsp;the&nbsp;caller,&nbsp;and&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2448872">if</span>&nbsp;<span class="num" id="2448875">0</span>&nbsp;<span class="op" id="2448877">&lt;</span>&nbsp;<span class="ident" id="2448879">m</span>&nbsp;<span class="op" id="2448881">&amp;&amp;</span>&nbsp;<span class="ident" id="2448884">m</span>&nbsp;<span class="op" id="2448886">&lt;</span>&nbsp;<span class="builtinfunc" id="2448888">len</span><span class="op" id="2448891">(</span><span class="ident" id="2448892">bcap</span><span class="op" id="2448896">)</span>&nbsp;<span class="op" id="2448898">||</span>&nbsp;<span class="ident" id="2448901">err</span>&nbsp;<span class="op" id="2448905">==</span>&nbsp;<span class="ident" id="2448908">syscall</span><span class="op" id="2448915">.</span><span class="ident" id="2448916">EINTR</span>&nbsp;<span class="op" id="2448922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2448927">b</span>&nbsp;<span class="op" id="2448929">=</span>&nbsp;<span class="ident" id="2448931">b</span><span class="op" id="2448932">[</span><span class="ident" id="2448933">m</span><span class="op" id="2448934">:</span><span class="op" id="2448935">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2448940">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2448951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2448956">if</span>&nbsp;<span class="ident" id="2448959">needsMaxRW</span>&nbsp;<span class="op" id="2448970">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2448973">len</span><span class="op" id="2448976">(</span><span class="ident" id="2448977">bcap</span><span class="op" id="2448981">)</span>&nbsp;<span class="op" id="2448983">!=</span>&nbsp;<span class="builtinfunc" id="2448986">len</span><span class="op" id="2448989">(</span><span class="ident" id="2448990">b</span><span class="op" id="2448991">)</span>&nbsp;<span class="op" id="2448993">&amp;&amp;</span>&nbsp;<span class="ident" id="2448996">err</span>&nbsp;<span class="op" id="2449000">==</span>&nbsp;<span class="builtintype" id="2449003">nil</span>&nbsp;<span class="op" id="2449007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2449012">b</span>&nbsp;<span class="op" id="2449014">=</span>&nbsp;<span class="ident" id="2449016">b</span><span class="op" id="2449017">[</span><span class="ident" id="2449018">m</span><span class="op" id="2449019">:</span><span class="op" id="2449020">]</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2449025">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2449036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2449041">return</span>&nbsp;<span class="ident" id="2449048">n</span><span class="op" id="2449049">,</span>&nbsp;<span class="ident" id="2449051">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2449056">}</span><br>
<span class="lineno">230</span><span class="op" id="2449058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2449061">//&nbsp;pwrite&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno"></span><span class="comment" id="2449132">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2449196">func</span>&nbsp;<span class="op" id="2449201">(</span><span class="ident" id="2449202">f</span>&nbsp;<span class="op" id="2449204">*</span><span class="ident" id="2449205">File</span><span class="op" id="2449209">)</span>&nbsp;<span class="ident" id="2449211">pwrite</span><span class="op" id="2449217">(</span><span class="ident" id="2449218">b</span>&nbsp;<span class="op" id="2449220">[</span><span class="op" id="2449221">]</span><span class="builtintype" id="2449222">byte</span><span class="op" id="2449226">,</span>&nbsp;<span class="ident" id="2449228">off</span>&nbsp;<span class="ident" id="2449232">int64</span><span class="op" id="2449237">)</span>&nbsp;<span class="op" id="2449239">(</span><span class="ident" id="2449240">n</span>&nbsp;<span class="builtintype" id="2449242">int</span><span class="op" id="2449245">,</span>&nbsp;<span class="ident" id="2449247">err</span>&nbsp;<span class="builtintype" id="2449251">error</span><span class="op" id="2449256">)</span>&nbsp;<span class="op" id="2449258">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2449261">if</span>&nbsp;<span class="ident" id="2449264">needsMaxRW</span>&nbsp;<span class="op" id="2449275">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2449278">len</span><span class="op" id="2449281">(</span><span class="ident" id="2449282">b</span><span class="op" id="2449283">)</span>&nbsp;<span class="op" id="2449285">&gt;</span>&nbsp;<span class="ident" id="2449287">maxRW</span>&nbsp;<span class="op" id="2449293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2449297">b</span>&nbsp;<span class="op" id="2449299">=</span>&nbsp;<span class="ident" id="2449301">b</span><span class="op" id="2449302">[</span><span class="op" id="2449303">:</span><span class="ident" id="2449304">maxRW</span><span class="op" id="2449309">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2449312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2449315">return</span>&nbsp;<span class="ident" id="2449322">fixCount</span><span class="op" id="2449330">(</span><span class="ident" id="2449331">syscall</span><span class="op" id="2449338">.</span><span class="ident" id="2449339">Pwrite</span><span class="op" id="2449345">(</span><span class="ident" id="2449346">f</span><span class="op" id="2449347">.</span><span class="ident" id="2449348">fd</span><span class="op" id="2449350">,</span>&nbsp;<span class="ident" id="2449352">b</span><span class="op" id="2449353">,</span>&nbsp;<span class="ident" id="2449355">off</span><span class="op" id="2449358">)</span><span class="op" id="2449359">)</span><br>
<span class="lineno"></span><span class="op" id="2449361">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="2449364">//&nbsp;seek&nbsp;sets&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;Read&nbsp;or&nbsp;Write&nbsp;on&nbsp;file&nbsp;to&nbsp;offset,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="2449446">//&nbsp;according&nbsp;to&nbsp;whence:&nbsp;0&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;origin&nbsp;of&nbsp;the&nbsp;file,&nbsp;1&nbsp;means</span><br>
<span class="lineno"></span><span class="comment" id="2449522">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;offset,&nbsp;and&nbsp;2&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span><span class="comment" id="2449590">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;new&nbsp;offset&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">245</span><span class="keyword" id="2449641">func</span>&nbsp;<span class="op" id="2449646">(</span><span class="ident" id="2449647">f</span>&nbsp;<span class="op" id="2449649">*</span><span class="ident" id="2449650">File</span><span class="op" id="2449654">)</span>&nbsp;<span class="ident" id="2449656">seek</span><span class="op" id="2449660">(</span><span class="ident" id="2449661">offset</span>&nbsp;<span class="ident" id="2449668">int64</span><span class="op" id="2449673">,</span>&nbsp;<span class="ident" id="2449675">whence</span>&nbsp;<span class="builtintype" id="2449682">int</span><span class="op" id="2449685">)</span>&nbsp;<span class="op" id="2449687">(</span><span class="ident" id="2449688">ret</span>&nbsp;<span class="ident" id="2449692">int64</span><span class="op" id="2449697">,</span>&nbsp;<span class="ident" id="2449699">err</span>&nbsp;<span class="builtintype" id="2449703">error</span><span class="op" id="2449708">)</span>&nbsp;<span class="op" id="2449710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2449713">return</span>&nbsp;<span class="ident" id="2449720">syscall</span><span class="op" id="2449727">.</span><span class="ident" id="2449728">Seek</span><span class="op" id="2449732">(</span><span class="ident" id="2449733">f</span><span class="op" id="2449734">.</span><span class="ident" id="2449735">fd</span><span class="op" id="2449737">,</span>&nbsp;<span class="ident" id="2449739">offset</span><span class="op" id="2449745">,</span>&nbsp;<span class="ident" id="2449747">whence</span><span class="op" id="2449753">)</span><br>
<span class="lineno"></span><span class="op" id="2449755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2449758">//&nbsp;Truncate&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno">250</span><span class="comment" id="2449806">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;it&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;link&#39;s&nbsp;target.</span><br>
<span class="lineno"></span><span class="comment" id="2449883">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2449939">func</span>&nbsp;<span class="ident" id="2449944">Truncate</span><span class="op" id="2449952">(</span><span class="ident" id="2449953">name</span>&nbsp;<span class="builtintype" id="2449958">string</span><span class="op" id="2449964">,</span>&nbsp;<span class="ident" id="2449966">size</span>&nbsp;<span class="ident" id="2449971">int64</span><span class="op" id="2449976">)</span>&nbsp;<span class="builtintype" id="2449978">error</span>&nbsp;<span class="op" id="2449984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2449987">if</span>&nbsp;<span class="ident" id="2449990">e</span>&nbsp;<span class="op" id="2449992">:=</span>&nbsp;<span class="ident" id="2449995">syscall</span><span class="op" id="2450002">.</span><span class="ident" id="2450003">Truncate</span><span class="op" id="2450011">(</span><span class="ident" id="2450012">name</span><span class="op" id="2450016">,</span>&nbsp;<span class="ident" id="2450018">size</span><span class="op" id="2450022">)</span><span class="op" id="2450023">;</span>&nbsp;<span class="ident" id="2450025">e</span>&nbsp;<span class="op" id="2450027">!=</span>&nbsp;<span class="builtintype" id="2450030">nil</span>&nbsp;<span class="op" id="2450034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2450038">return</span>&nbsp;<span class="op" id="2450045">&amp;</span><span class="ident" id="2450046">PathError</span><span class="op" id="2450055">{</span><span class="string" id="2450056">&#34;truncate&#34;</span><span class="op" id="2450066">,</span>&nbsp;<span class="ident" id="2450068">name</span><span class="op" id="2450072">,</span>&nbsp;<span class="ident" id="2450074">e</span><span class="op" id="2450075">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2450078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2450081">return</span>&nbsp;<span class="builtintype" id="2450088">nil</span><br>
<span class="lineno"></span><span class="op" id="2450092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2450095">//&nbsp;Remove&nbsp;removes&nbsp;the&nbsp;named&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno">260</span><span class="comment" id="2450142">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2450198">func</span>&nbsp;<span class="ident" id="2450203">Remove</span><span class="op" id="2450209">(</span><span class="ident" id="2450210">name</span>&nbsp;<span class="builtintype" id="2450215">string</span><span class="op" id="2450221">)</span>&nbsp;<span class="builtintype" id="2450223">error</span>&nbsp;<span class="op" id="2450229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2450232">//&nbsp;System&nbsp;call&nbsp;interface&nbsp;forces&nbsp;us&nbsp;to&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2450276">//&nbsp;whether&nbsp;name&nbsp;is&nbsp;a&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2450317">//&nbsp;Try&nbsp;both:&nbsp;it&nbsp;is&nbsp;cheaper&nbsp;on&nbsp;average&nbsp;than</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2450361">//&nbsp;doing&nbsp;a&nbsp;Stat&nbsp;plus&nbsp;the&nbsp;right&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2450398">e</span>&nbsp;<span class="op" id="2450400">:=</span>&nbsp;<span class="ident" id="2450403">syscall</span><span class="op" id="2450410">.</span><span class="ident" id="2450411">Unlink</span><span class="op" id="2450417">(</span><span class="ident" id="2450418">name</span><span class="op" id="2450422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2450425">if</span>&nbsp;<span class="ident" id="2450428">e</span>&nbsp;<span class="op" id="2450430">==</span>&nbsp;<span class="builtintype" id="2450433">nil</span>&nbsp;<span class="op" id="2450437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2450441">return</span>&nbsp;<span class="builtintype" id="2450448">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2450453">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2450456">e1</span>&nbsp;<span class="op" id="2450459">:=</span>&nbsp;<span class="ident" id="2450462">syscall</span><span class="op" id="2450469">.</span><span class="ident" id="2450470">Rmdir</span><span class="op" id="2450475">(</span><span class="ident" id="2450476">name</span><span class="op" id="2450480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2450483">if</span>&nbsp;<span class="ident" id="2450486">e1</span>&nbsp;<span class="op" id="2450489">==</span>&nbsp;<span class="builtintype" id="2450492">nil</span>&nbsp;<span class="op" id="2450496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2450500">return</span>&nbsp;<span class="builtintype" id="2450507">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2450512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2450516">//&nbsp;Both&nbsp;failed:&nbsp;figure&nbsp;out&nbsp;which&nbsp;error&nbsp;to&nbsp;return.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2450567">//&nbsp;OS&nbsp;X&nbsp;and&nbsp;Linux&nbsp;differ&nbsp;on&nbsp;whether&nbsp;unlink(dir)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2450616">//&nbsp;returns&nbsp;EISDIR,&nbsp;so&nbsp;can&#39;t&nbsp;use&nbsp;that.&nbsp;&nbsp;However,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2450665">//&nbsp;both&nbsp;agree&nbsp;that&nbsp;rmdir(file)&nbsp;returns&nbsp;ENOTDIR,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2450714">//&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;that&nbsp;to&nbsp;decide&nbsp;which&nbsp;error&nbsp;is&nbsp;real.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2450768">//&nbsp;Rmdir&nbsp;might&nbsp;also&nbsp;return&nbsp;ENOTDIR&nbsp;if&nbsp;given&nbsp;a&nbsp;bad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2450819">//&nbsp;file&nbsp;path,&nbsp;like&nbsp;/etc/passwd/foo,&nbsp;but&nbsp;in&nbsp;that&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2450874">//&nbsp;both&nbsp;errors&nbsp;will&nbsp;be&nbsp;ENOTDIR,&nbsp;so&nbsp;it&#39;s&nbsp;okay&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2450923">//&nbsp;use&nbsp;the&nbsp;error&nbsp;from&nbsp;unlink.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2450954">if</span>&nbsp;<span class="ident" id="2450957">e1</span>&nbsp;<span class="op" id="2450960">!=</span>&nbsp;<span class="ident" id="2450963">syscall</span><span class="op" id="2450970">.</span><span class="ident" id="2450971">ENOTDIR</span>&nbsp;<span class="op" id="2450979">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2450983">e</span>&nbsp;<span class="op" id="2450985">=</span>&nbsp;<span class="ident" id="2450987">e1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2450991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2450994">return</span>&nbsp;<span class="op" id="2451001">&amp;</span><span class="ident" id="2451002">PathError</span><span class="op" id="2451011">{</span><span class="string" id="2451012">&#34;remove&#34;</span><span class="op" id="2451020">,</span>&nbsp;<span class="ident" id="2451022">name</span><span class="op" id="2451026">,</span>&nbsp;<span class="ident" id="2451028">e</span><span class="op" id="2451029">}</span><br>
<span class="lineno"></span><span class="op" id="2451031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="2451034">//&nbsp;basename&nbsp;removes&nbsp;trailing&nbsp;slashes&nbsp;and&nbsp;the&nbsp;leading&nbsp;directory&nbsp;name&nbsp;from&nbsp;path&nbsp;name</span><br>
<span class="lineno"></span><span class="keyword" id="2451117">func</span>&nbsp;<span class="ident" id="2451122">basename</span><span class="op" id="2451130">(</span><span class="ident" id="2451131">name</span>&nbsp;<span class="builtintype" id="2451136">string</span><span class="op" id="2451142">)</span>&nbsp;<span class="builtintype" id="2451144">string</span>&nbsp;<span class="op" id="2451151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2451154">i</span>&nbsp;<span class="op" id="2451156">:=</span>&nbsp;<span class="builtinfunc" id="2451159">len</span><span class="op" id="2451162">(</span><span class="ident" id="2451163">name</span><span class="op" id="2451167">)</span>&nbsp;<span class="op" id="2451169">-</span>&nbsp;<span class="num" id="2451171">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2451174">//&nbsp;Remove&nbsp;trailing&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2451202">for</span>&nbsp;<span class="op" id="2451206">;</span>&nbsp;<span class="ident" id="2451208">i</span>&nbsp;<span class="op" id="2451210">&gt;</span>&nbsp;<span class="num" id="2451212">0</span>&nbsp;<span class="op" id="2451214">&amp;&amp;</span>&nbsp;<span class="ident" id="2451217">name</span><span class="op" id="2451221">[</span><span class="ident" id="2451222">i</span><span class="op" id="2451223">]</span>&nbsp;<span class="op" id="2451225">==</span>&nbsp;<span class="string" id="2451228">&#39;/&#39;</span><span class="op" id="2451231">;</span>&nbsp;<span class="ident" id="2451233">i</span><span class="op" id="2451234">--</span>&nbsp;<span class="op" id="2451237">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2451241">name</span>&nbsp;<span class="op" id="2451246">=</span>&nbsp;<span class="ident" id="2451248">name</span><span class="op" id="2451252">[</span><span class="op" id="2451253">:</span><span class="ident" id="2451254">i</span><span class="op" id="2451255">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2451258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2451261">//&nbsp;Remove&nbsp;leading&nbsp;directory&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2451295">for</span>&nbsp;<span class="ident" id="2451299">i</span><span class="op" id="2451300">--</span><span class="op" id="2451302">;</span>&nbsp;<span class="ident" id="2451304">i</span>&nbsp;<span class="op" id="2451306">&gt;=</span>&nbsp;<span class="num" id="2451309">0</span><span class="op" id="2451310">;</span>&nbsp;<span class="ident" id="2451312">i</span><span class="op" id="2451313">--</span>&nbsp;<span class="op" id="2451316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2451320">if</span>&nbsp;<span class="ident" id="2451323">name</span><span class="op" id="2451327">[</span><span class="ident" id="2451328">i</span><span class="op" id="2451329">]</span>&nbsp;<span class="op" id="2451331">==</span>&nbsp;<span class="string" id="2451334">&#39;/&#39;</span>&nbsp;<span class="op" id="2451338">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2451343">name</span>&nbsp;<span class="op" id="2451348">=</span>&nbsp;<span class="ident" id="2451350">name</span><span class="op" id="2451354">[</span><span class="ident" id="2451355">i</span><span class="op" id="2451356">+</span><span class="num" id="2451357">1</span><span class="op" id="2451358">:</span><span class="op" id="2451359">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2451364">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2451372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2451375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2451379">return</span>&nbsp;<span class="ident" id="2451386">name</span><br>
<span class="lineno"></span><span class="op" id="2451391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2451394">//&nbsp;TempDir&nbsp;returns&nbsp;the&nbsp;default&nbsp;directory&nbsp;to&nbsp;use&nbsp;for&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="keyword" id="2451463">func</span>&nbsp;<span class="ident" id="2451468">TempDir</span><span class="op" id="2451475">(</span><span class="op" id="2451476">)</span>&nbsp;<span class="builtintype" id="2451478">string</span>&nbsp;<span class="op" id="2451485">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2451488">dir</span>&nbsp;<span class="op" id="2451492">:=</span>&nbsp;<span class="ident" id="2451495">Getenv</span><span class="op" id="2451501">(</span><span class="string" id="2451502">&#34;TMPDIR&#34;</span><span class="op" id="2451510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2451513">if</span>&nbsp;<span class="ident" id="2451516">dir</span>&nbsp;<span class="op" id="2451520">==</span>&nbsp;<span class="string" id="2451523">&#34;&#34;</span>&nbsp;<span class="op" id="2451526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2451530">if</span>&nbsp;<span class="ident" id="2451533">runtime</span><span class="op" id="2451540">.</span><span class="ident" id="2451541">GOOS</span>&nbsp;<span class="op" id="2451546">==</span>&nbsp;<span class="string" id="2451549">&#34;android&#34;</span>&nbsp;<span class="op" id="2451559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2451564">dir</span>&nbsp;<span class="op" id="2451568">=</span>&nbsp;<span class="string" id="2451570">&#34;/data/local/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2451590">}</span>&nbsp;<span class="keyword" id="2451592">else</span>&nbsp;<span class="op" id="2451597">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2451602">dir</span>&nbsp;<span class="op" id="2451606">=</span>&nbsp;<span class="string" id="2451608">&#34;/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2451617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2451620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2451623">return</span>&nbsp;<span class="ident" id="2451630">dir</span><br>
<span class="lineno"></span><span class="op" id="2451634">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2451637">//&nbsp;Link&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;hard&nbsp;link&nbsp;to&nbsp;the&nbsp;oldname&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2451697">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2451753">func</span>&nbsp;<span class="ident" id="2451758">Link</span><span class="op" id="2451762">(</span><span class="ident" id="2451763">oldname</span><span class="op" id="2451770">,</span>&nbsp;<span class="ident" id="2451772">newname</span>&nbsp;<span class="builtintype" id="2451780">string</span><span class="op" id="2451786">)</span>&nbsp;<span class="builtintype" id="2451788">error</span>&nbsp;<span class="op" id="2451794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2451797">e</span>&nbsp;<span class="op" id="2451799">:=</span>&nbsp;<span class="ident" id="2451802">syscall</span><span class="op" id="2451809">.</span><span class="ident" id="2451810">Link</span><span class="op" id="2451814">(</span><span class="ident" id="2451815">oldname</span><span class="op" id="2451822">,</span>&nbsp;<span class="ident" id="2451824">newname</span><span class="op" id="2451831">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2451834">if</span>&nbsp;<span class="ident" id="2451837">e</span>&nbsp;<span class="op" id="2451839">!=</span>&nbsp;<span class="builtintype" id="2451842">nil</span>&nbsp;<span class="op" id="2451846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2451850">return</span>&nbsp;<span class="op" id="2451857">&amp;</span><span class="ident" id="2451858">LinkError</span><span class="op" id="2451867">{</span><span class="string" id="2451868">&#34;link&#34;</span><span class="op" id="2451874">,</span>&nbsp;<span class="ident" id="2451876">oldname</span><span class="op" id="2451883">,</span>&nbsp;<span class="ident" id="2451885">newname</span><span class="op" id="2451892">,</span>&nbsp;<span class="ident" id="2451894">e</span><span class="op" id="2451895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2451898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2451901">return</span>&nbsp;<span class="builtintype" id="2451908">nil</span><br>
<span class="lineno"></span><span class="op" id="2451912">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="2451915">//&nbsp;Symlink&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;symbolic&nbsp;link&nbsp;to&nbsp;oldname.</span><br>
<span class="lineno"></span><span class="comment" id="2451973">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2452029">func</span>&nbsp;<span class="ident" id="2452034">Symlink</span><span class="op" id="2452041">(</span><span class="ident" id="2452042">oldname</span><span class="op" id="2452049">,</span>&nbsp;<span class="ident" id="2452051">newname</span>&nbsp;<span class="builtintype" id="2452059">string</span><span class="op" id="2452065">)</span>&nbsp;<span class="builtintype" id="2452067">error</span>&nbsp;<span class="op" id="2452073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2452076">e</span>&nbsp;<span class="op" id="2452078">:=</span>&nbsp;<span class="ident" id="2452081">syscall</span><span class="op" id="2452088">.</span><span class="ident" id="2452089">Symlink</span><span class="op" id="2452096">(</span><span class="ident" id="2452097">oldname</span><span class="op" id="2452104">,</span>&nbsp;<span class="ident" id="2452106">newname</span><span class="op" id="2452113">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2452116">if</span>&nbsp;<span class="ident" id="2452119">e</span>&nbsp;<span class="op" id="2452121">!=</span>&nbsp;<span class="builtintype" id="2452124">nil</span>&nbsp;<span class="op" id="2452128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2452132">return</span>&nbsp;<span class="op" id="2452139">&amp;</span><span class="ident" id="2452140">LinkError</span><span class="op" id="2452149">{</span><span class="string" id="2452150">&#34;symlink&#34;</span><span class="op" id="2452159">,</span>&nbsp;<span class="ident" id="2452161">oldname</span><span class="op" id="2452168">,</span>&nbsp;<span class="ident" id="2452170">newname</span><span class="op" id="2452177">,</span>&nbsp;<span class="ident" id="2452179">e</span><span class="op" id="2452180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2452183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2452186">return</span>&nbsp;<span class="builtintype" id="2452193">nil</span><br>
<span class="lineno"></span><span class="op" id="2452197">}</span>
</div>
</body>
</html>
