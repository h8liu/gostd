<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html" class="current">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4759787">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4759842">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4759896">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4759947">//&nbsp;Package&nbsp;gzip&nbsp;implements&nbsp;reading&nbsp;and&nbsp;writing&nbsp;of&nbsp;gzip&nbsp;format&nbsp;compressed&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="4760027">//&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;1952.</span><br>
<span class="lineno"></span><span class="keyword" id="4760056">package</span>&nbsp;<span class="ident" id="4760064">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4760070">import</span>&nbsp;<span class="op" id="4760077">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4760080">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4760089">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4760107">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4760117">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4760125">&#34;hash/crc32&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4760139">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4760145">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4760152">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4760155">const</span>&nbsp;<span class="op" id="4760161">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4760164">gzipID1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4760176">=</span>&nbsp;<span class="num" id="4760178">0x1f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4760184">gzipID2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4760196">=</span>&nbsp;<span class="num" id="4760198">0x8b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4760204">gzipDeflate</span>&nbsp;<span class="op" id="4760216">=</span>&nbsp;<span class="num" id="4760218">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4760221">flagText</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4760233">=</span>&nbsp;<span class="num" id="4760235">1</span>&nbsp;<span class="op" id="4760237">&lt;&lt;</span>&nbsp;<span class="num" id="4760240">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4760243">flagHdrCrc</span>&nbsp;&nbsp;<span class="op" id="4760255">=</span>&nbsp;<span class="num" id="4760257">1</span>&nbsp;<span class="op" id="4760259">&lt;&lt;</span>&nbsp;<span class="num" id="4760262">1</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4760265">flagExtra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4760277">=</span>&nbsp;<span class="num" id="4760279">1</span>&nbsp;<span class="op" id="4760281">&lt;&lt;</span>&nbsp;<span class="num" id="4760284">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4760287">flagName</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4760299">=</span>&nbsp;<span class="num" id="4760301">1</span>&nbsp;<span class="op" id="4760303">&lt;&lt;</span>&nbsp;<span class="num" id="4760306">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4760309">flagComment</span>&nbsp;<span class="op" id="4760321">=</span>&nbsp;<span class="num" id="4760323">1</span>&nbsp;<span class="op" id="4760325">&lt;&lt;</span>&nbsp;<span class="num" id="4760328">4</span><br>
<span class="lineno"></span><span class="op" id="4760330">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4760333">func</span>&nbsp;<span class="ident" id="4760338">makeReader</span><span class="op" id="4760348">(</span><span class="ident" id="4760349">r</span>&nbsp;<span class="ident" id="4760351">io</span><span class="op" id="4760353">.</span><span class="ident" id="4760354">Reader</span><span class="op" id="4760360">)</span>&nbsp;<span class="ident" id="4760362">flate</span><span class="op" id="4760367">.</span><span class="ident" id="4760368">Reader</span>&nbsp;<span class="op" id="4760375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4760378">if</span>&nbsp;<span class="ident" id="4760381">rr</span><span class="op" id="4760383">,</span>&nbsp;<span class="ident" id="4760385">ok</span>&nbsp;<span class="op" id="4760388">:=</span>&nbsp;<span class="ident" id="4760391">r</span><span class="op" id="4760392">.</span><span class="op" id="4760393">(</span><span class="ident" id="4760394">flate</span><span class="op" id="4760399">.</span><span class="ident" id="4760400">Reader</span><span class="op" id="4760406">)</span><span class="op" id="4760407">;</span>&nbsp;<span class="ident" id="4760409">ok</span>&nbsp;<span class="op" id="4760412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4760416">return</span>&nbsp;<span class="ident" id="4760423">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4760427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4760430">return</span>&nbsp;<span class="ident" id="4760437">bufio</span><span class="op" id="4760442">.</span><span class="ident" id="4760443">NewReader</span><span class="op" id="4760452">(</span><span class="ident" id="4760453">r</span><span class="op" id="4760454">)</span><br>
<span class="lineno">35</span><span class="op" id="4760456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4760459">var</span>&nbsp;<span class="op" id="4760463">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4760466">//&nbsp;ErrChecksum&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4760547">ErrChecksum</span>&nbsp;<span class="op" id="4760559">=</span>&nbsp;<span class="ident" id="4760561">errors</span><span class="op" id="4760567">.</span><span class="ident" id="4760568">New</span><span class="op" id="4760571">(</span><span class="string" id="4760572">&#34;gzip:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="4760596">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4760599">//&nbsp;ErrHeader&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4760676">ErrHeader</span>&nbsp;<span class="op" id="4760686">=</span>&nbsp;<span class="ident" id="4760688">errors</span><span class="op" id="4760694">.</span><span class="ident" id="4760695">New</span><span class="op" id="4760698">(</span><span class="string" id="4760699">&#34;gzip:&nbsp;invalid&nbsp;header&#34;</span><span class="op" id="4760721">)</span><br>
<span class="lineno"></span><span class="op" id="4760723">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4760726">//&nbsp;The&nbsp;gzip&nbsp;file&nbsp;stores&nbsp;a&nbsp;header&nbsp;giving&nbsp;metadata&nbsp;about&nbsp;the&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno">45</span><span class="comment" id="4760802">//&nbsp;That&nbsp;header&nbsp;is&nbsp;exposed&nbsp;as&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;Writer&nbsp;and&nbsp;Reader&nbsp;structs.</span><br>
<span class="lineno"></span><span class="keyword" id="4760876">type</span>&nbsp;<span class="ident" id="4760881">Header</span>&nbsp;<span class="keyword" id="4760888">struct</span>&nbsp;<span class="op" id="4760895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4760898">Comment</span>&nbsp;<span class="builtintype" id="4760906">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4760916">//&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4760928">Extra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4760936">[</span><span class="op" id="4760937">]</span><span class="builtintype" id="4760938">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4760946">//&nbsp;&#34;extra&nbsp;data&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4760963">ModTime</span>&nbsp;<span class="ident" id="4760971">time</span><span class="op" id="4760975">.</span><span class="ident" id="4760976">Time</span>&nbsp;<span class="comment" id="4760981">//&nbsp;modification&nbsp;time</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4761003">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4761011">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4761021">//&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4761035">OS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4761043">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4761053">//&nbsp;operating&nbsp;system&nbsp;type</span><br>
<span class="lineno"></span><span class="op" id="4761078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4761081">//&nbsp;A&nbsp;Reader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;can&nbsp;be&nbsp;read&nbsp;to&nbsp;retrieve</span><br>
<span class="lineno">55</span><span class="comment" id="4761138">//&nbsp;uncompressed&nbsp;data&nbsp;from&nbsp;a&nbsp;gzip-format&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="4761195">//</span><br>
<span class="lineno"></span><span class="comment" id="4761198">//&nbsp;In&nbsp;general,&nbsp;a&nbsp;gzip&nbsp;file&nbsp;can&nbsp;be&nbsp;a&nbsp;concatenation&nbsp;of&nbsp;gzip&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="4761263">//&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header.&nbsp;&nbsp;Reads&nbsp;from&nbsp;the&nbsp;Reader</span><br>
<span class="lineno"></span><span class="comment" id="4761315">//&nbsp;return&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;of&nbsp;each.</span><br>
<span class="lineno">60</span><span class="comment" id="4761377">//&nbsp;Only&nbsp;the&nbsp;first&nbsp;header&nbsp;is&nbsp;recorded&nbsp;in&nbsp;the&nbsp;Reader&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="4761436">//</span><br>
<span class="lineno"></span><span class="comment" id="4761439">//&nbsp;Gzip&nbsp;files&nbsp;store&nbsp;a&nbsp;length&nbsp;and&nbsp;checksum&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4761507">//&nbsp;The&nbsp;Reader&nbsp;will&nbsp;return&nbsp;a&nbsp;ErrChecksum&nbsp;when&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="4761557">//&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;if&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno">65</span><span class="comment" id="4761616">//&nbsp;have&nbsp;the&nbsp;expected&nbsp;length&nbsp;or&nbsp;checksum.&nbsp;&nbsp;Clients&nbsp;should&nbsp;treat&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="4761684">//&nbsp;returned&nbsp;by&nbsp;Read&nbsp;as&nbsp;tentative&nbsp;until&nbsp;they&nbsp;receive&nbsp;the&nbsp;io.EOF</span><br>
<span class="lineno"></span><span class="comment" id="4761747">//&nbsp;marking&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4761779">type</span>&nbsp;<span class="ident" id="4761784">Reader</span>&nbsp;<span class="keyword" id="4761791">struct</span>&nbsp;<span class="op" id="4761798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4761801">Header</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4761809">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4761822">flate</span><span class="op" id="4761827">.</span><span class="ident" id="4761828">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4761836">decompressor</span>&nbsp;<span class="ident" id="4761849">io</span><span class="op" id="4761851">.</span><span class="ident" id="4761852">ReadCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4761864">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4761877">hash</span><span class="op" id="4761881">.</span><span class="ident" id="4761882">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4761890">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4761903">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4761911">flg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4761924">byte</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4761930">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4761943">[</span><span class="num" id="4761944">512</span><span class="op" id="4761947">]</span><span class="builtintype" id="4761948">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4761954">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4761967">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4761974">multistream</span>&nbsp;&nbsp;<span class="builtintype" id="4761987">bool</span><br>
<span class="lineno"></span><span class="op" id="4761992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4761995">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno"></span><span class="comment" id="4762055">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4762102">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4762164">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;Reader&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="4762240">func</span>&nbsp;<span class="ident" id="4762245">NewReader</span><span class="op" id="4762254">(</span><span class="ident" id="4762255">r</span>&nbsp;<span class="ident" id="4762257">io</span><span class="op" id="4762259">.</span><span class="ident" id="4762260">Reader</span><span class="op" id="4762266">)</span>&nbsp;<span class="op" id="4762268">(</span><span class="op" id="4762269">*</span><span class="ident" id="4762270">Reader</span><span class="op" id="4762276">,</span>&nbsp;<span class="builtintype" id="4762278">error</span><span class="op" id="4762283">)</span>&nbsp;<span class="op" id="4762285">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4762288">z</span>&nbsp;<span class="op" id="4762290">:=</span>&nbsp;<span class="builtinfunc" id="4762293">new</span><span class="op" id="4762296">(</span><span class="ident" id="4762297">Reader</span><span class="op" id="4762303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4762306">z</span><span class="op" id="4762307">.</span><span class="ident" id="4762308">r</span>&nbsp;<span class="op" id="4762310">=</span>&nbsp;<span class="ident" id="4762312">makeReader</span><span class="op" id="4762322">(</span><span class="ident" id="4762323">r</span><span class="op" id="4762324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4762327">z</span><span class="op" id="4762328">.</span><span class="ident" id="4762329">multistream</span>&nbsp;<span class="op" id="4762341">=</span>&nbsp;<span class="builtintype" id="4762343">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4762349">z</span><span class="op" id="4762350">.</span><span class="ident" id="4762351">digest</span>&nbsp;<span class="op" id="4762358">=</span>&nbsp;<span class="ident" id="4762360">crc32</span><span class="op" id="4762365">.</span><span class="ident" id="4762366">NewIEEE</span><span class="op" id="4762373">(</span><span class="op" id="4762374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4762377">if</span>&nbsp;<span class="ident" id="4762380">err</span>&nbsp;<span class="op" id="4762384">:=</span>&nbsp;<span class="ident" id="4762387">z</span><span class="op" id="4762388">.</span><span class="ident" id="4762389">readHeader</span><span class="op" id="4762399">(</span><span class="builtintype" id="4762400">true</span><span class="op" id="4762404">)</span><span class="op" id="4762405">;</span>&nbsp;<span class="ident" id="4762407">err</span>&nbsp;<span class="op" id="4762411">!=</span>&nbsp;<span class="builtintype" id="4762414">nil</span>&nbsp;<span class="op" id="4762418">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4762422">return</span>&nbsp;<span class="builtintype" id="4762429">nil</span><span class="op" id="4762432">,</span>&nbsp;<span class="ident" id="4762434">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4762439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4762442">return</span>&nbsp;<span class="ident" id="4762449">z</span><span class="op" id="4762450">,</span>&nbsp;<span class="builtintype" id="4762452">nil</span><br>
<span class="lineno"></span><span class="op" id="4762456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="4762459">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Reader&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4762529">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewReader,&nbsp;but&nbsp;reading&nbsp;from&nbsp;r&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="4762605">//&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Reader&nbsp;rather&nbsp;than&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4762672">func</span>&nbsp;<span class="op" id="4762677">(</span><span class="ident" id="4762678">z</span>&nbsp;<span class="op" id="4762680">*</span><span class="ident" id="4762681">Reader</span><span class="op" id="4762687">)</span>&nbsp;<span class="ident" id="4762689">Reset</span><span class="op" id="4762694">(</span><span class="ident" id="4762695">r</span>&nbsp;<span class="ident" id="4762697">io</span><span class="op" id="4762699">.</span><span class="ident" id="4762700">Reader</span><span class="op" id="4762706">)</span>&nbsp;<span class="builtintype" id="4762708">error</span>&nbsp;<span class="op" id="4762714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4762717">z</span><span class="op" id="4762718">.</span><span class="ident" id="4762719">r</span>&nbsp;<span class="op" id="4762721">=</span>&nbsp;<span class="ident" id="4762723">makeReader</span><span class="op" id="4762733">(</span><span class="ident" id="4762734">r</span><span class="op" id="4762735">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4762738">if</span>&nbsp;<span class="ident" id="4762741">z</span><span class="op" id="4762742">.</span><span class="ident" id="4762743">digest</span>&nbsp;<span class="op" id="4762750">==</span>&nbsp;<span class="builtintype" id="4762753">nil</span>&nbsp;<span class="op" id="4762757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4762761">z</span><span class="op" id="4762762">.</span><span class="ident" id="4762763">digest</span>&nbsp;<span class="op" id="4762770">=</span>&nbsp;<span class="ident" id="4762772">crc32</span><span class="op" id="4762777">.</span><span class="ident" id="4762778">NewIEEE</span><span class="op" id="4762785">(</span><span class="op" id="4762786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4762789">}</span>&nbsp;<span class="keyword" id="4762791">else</span>&nbsp;<span class="op" id="4762796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4762800">z</span><span class="op" id="4762801">.</span><span class="ident" id="4762802">digest</span><span class="op" id="4762808">.</span><span class="ident" id="4762809">Reset</span><span class="op" id="4762814">(</span><span class="op" id="4762815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4762818">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4762821">z</span><span class="op" id="4762822">.</span><span class="ident" id="4762823">size</span>&nbsp;<span class="op" id="4762828">=</span>&nbsp;<span class="num" id="4762830">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4762833">z</span><span class="op" id="4762834">.</span><span class="ident" id="4762835">err</span>&nbsp;<span class="op" id="4762839">=</span>&nbsp;<span class="builtintype" id="4762841">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4762846">z</span><span class="op" id="4762847">.</span><span class="ident" id="4762848">multistream</span>&nbsp;<span class="op" id="4762860">=</span>&nbsp;<span class="builtintype" id="4762862">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4762868">return</span>&nbsp;<span class="ident" id="4762875">z</span><span class="op" id="4762876">.</span><span class="ident" id="4762877">readHeader</span><span class="op" id="4762887">(</span><span class="builtintype" id="4762888">true</span><span class="op" id="4762892">)</span><br>
<span class="lineno"></span><span class="op" id="4762894">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4762897">//&nbsp;Multistream&nbsp;controls&nbsp;whether&nbsp;the&nbsp;reader&nbsp;supports&nbsp;multistream&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="4762968">//</span><br>
<span class="lineno"></span><span class="comment" id="4762971">//&nbsp;If&nbsp;enabled&nbsp;(the&nbsp;default),&nbsp;the&nbsp;Reader&nbsp;expects&nbsp;the&nbsp;input&nbsp;to&nbsp;be&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4763046">//&nbsp;of&nbsp;individually&nbsp;gzipped&nbsp;data&nbsp;streams,&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="4763116">//&nbsp;trailer,&nbsp;ending&nbsp;at&nbsp;EOF.&nbsp;The&nbsp;effect&nbsp;is&nbsp;that&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4763194">//&nbsp;of&nbsp;gzipped&nbsp;files&nbsp;is&nbsp;treated&nbsp;as&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;gzip&nbsp;of&nbsp;the&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="4763272">//&nbsp;of&nbsp;the&nbsp;sequence.&nbsp;This&nbsp;is&nbsp;standard&nbsp;behavior&nbsp;for&nbsp;gzip&nbsp;readers.</span><br>
<span class="lineno"></span><span class="comment" id="4763336">//</span><br>
<span class="lineno"></span><span class="comment" id="4763339">//&nbsp;Calling&nbsp;Multistream(false)&nbsp;disables&nbsp;this&nbsp;behavior;&nbsp;disabling&nbsp;the&nbsp;behavior</span><br>
<span class="lineno">120</span><span class="comment" id="4763416">//&nbsp;can&nbsp;be&nbsp;useful&nbsp;when&nbsp;reading&nbsp;file&nbsp;formats&nbsp;that&nbsp;distinguish&nbsp;individual&nbsp;gzip</span><br>
<span class="lineno"></span><span class="comment" id="4763492">//&nbsp;data&nbsp;streams&nbsp;or&nbsp;mix&nbsp;gzip&nbsp;data&nbsp;streams&nbsp;with&nbsp;other&nbsp;data&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="4763558">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;when&nbsp;the&nbsp;Reader&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="4763627">//&nbsp;Read&nbsp;returns&nbsp;io.EOF.&nbsp;If&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;implements&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4763702">//&nbsp;it&nbsp;will&nbsp;be&nbsp;left&nbsp;positioned&nbsp;just&nbsp;after&nbsp;the&nbsp;gzip&nbsp;stream.</span><br>
<span class="lineno">125</span><span class="comment" id="4763760">//&nbsp;To&nbsp;start&nbsp;the&nbsp;next&nbsp;stream,&nbsp;call&nbsp;z.Reset(r)&nbsp;followed&nbsp;by&nbsp;z.Multistream(false).</span><br>
<span class="lineno"></span><span class="comment" id="4763839">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;next&nbsp;stream,&nbsp;z.Reset(r)&nbsp;will&nbsp;return&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="4763901">func</span>&nbsp;<span class="op" id="4763906">(</span><span class="ident" id="4763907">z</span>&nbsp;<span class="op" id="4763909">*</span><span class="ident" id="4763910">Reader</span><span class="op" id="4763916">)</span>&nbsp;<span class="ident" id="4763918">Multistream</span><span class="op" id="4763929">(</span><span class="ident" id="4763930">ok</span>&nbsp;<span class="builtintype" id="4763933">bool</span><span class="op" id="4763937">)</span>&nbsp;<span class="op" id="4763939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4763942">z</span><span class="op" id="4763943">.</span><span class="ident" id="4763944">multistream</span>&nbsp;<span class="op" id="4763956">=</span>&nbsp;<span class="ident" id="4763958">ok</span><br>
<span class="lineno"></span><span class="op" id="4763961">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4763964">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="4764025">func</span>&nbsp;<span class="ident" id="4764030">get4</span><span class="op" id="4764034">(</span><span class="ident" id="4764035">p</span>&nbsp;<span class="op" id="4764037">[</span><span class="op" id="4764038">]</span><span class="builtintype" id="4764039">byte</span><span class="op" id="4764043">)</span>&nbsp;<span class="builtintype" id="4764045">uint32</span>&nbsp;<span class="op" id="4764052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4764055">return</span>&nbsp;<span class="builtintype" id="4764062">uint32</span><span class="op" id="4764068">(</span><span class="ident" id="4764069">p</span><span class="op" id="4764070">[</span><span class="num" id="4764071">0</span><span class="op" id="4764072">]</span><span class="op" id="4764073">)</span>&nbsp;<span class="op" id="4764075">|</span>&nbsp;<span class="builtintype" id="4764077">uint32</span><span class="op" id="4764083">(</span><span class="ident" id="4764084">p</span><span class="op" id="4764085">[</span><span class="num" id="4764086">1</span><span class="op" id="4764087">]</span><span class="op" id="4764088">)</span><span class="op" id="4764089">&lt;&lt;</span><span class="num" id="4764091">8</span>&nbsp;<span class="op" id="4764093">|</span>&nbsp;<span class="builtintype" id="4764095">uint32</span><span class="op" id="4764101">(</span><span class="ident" id="4764102">p</span><span class="op" id="4764103">[</span><span class="num" id="4764104">2</span><span class="op" id="4764105">]</span><span class="op" id="4764106">)</span><span class="op" id="4764107">&lt;&lt;</span><span class="num" id="4764109">16</span>&nbsp;<span class="op" id="4764112">|</span>&nbsp;<span class="builtintype" id="4764114">uint32</span><span class="op" id="4764120">(</span><span class="ident" id="4764121">p</span><span class="op" id="4764122">[</span><span class="num" id="4764123">3</span><span class="op" id="4764124">]</span><span class="op" id="4764125">)</span><span class="op" id="4764126">&lt;&lt;</span><span class="num" id="4764128">24</span><br>
<span class="lineno"></span><span class="op" id="4764131">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="4764134">func</span>&nbsp;<span class="op" id="4764139">(</span><span class="ident" id="4764140">z</span>&nbsp;<span class="op" id="4764142">*</span><span class="ident" id="4764143">Reader</span><span class="op" id="4764149">)</span>&nbsp;<span class="ident" id="4764151">readString</span><span class="op" id="4764161">(</span><span class="op" id="4764162">)</span>&nbsp;<span class="op" id="4764164">(</span><span class="builtintype" id="4764165">string</span><span class="op" id="4764171">,</span>&nbsp;<span class="builtintype" id="4764173">error</span><span class="op" id="4764178">)</span>&nbsp;<span class="op" id="4764180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4764183">var</span>&nbsp;<span class="ident" id="4764187">err</span>&nbsp;<span class="builtintype" id="4764191">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764198">needconv</span>&nbsp;<span class="op" id="4764207">:=</span>&nbsp;<span class="builtintype" id="4764210">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4764217">for</span>&nbsp;<span class="ident" id="4764221">i</span>&nbsp;<span class="op" id="4764223">:=</span>&nbsp;<span class="num" id="4764226">0</span><span class="op" id="4764227">;</span>&nbsp;<span class="op" id="4764229">;</span>&nbsp;<span class="ident" id="4764231">i</span><span class="op" id="4764232">++</span>&nbsp;<span class="op" id="4764235">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4764239">if</span>&nbsp;<span class="ident" id="4764242">i</span>&nbsp;<span class="op" id="4764244">&gt;=</span>&nbsp;<span class="builtinfunc" id="4764247">len</span><span class="op" id="4764250">(</span><span class="ident" id="4764251">z</span><span class="op" id="4764252">.</span><span class="ident" id="4764253">buf</span><span class="op" id="4764256">)</span>&nbsp;<span class="op" id="4764258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4764263">return</span>&nbsp;<span class="string" id="4764270">&#34;&#34;</span><span class="op" id="4764272">,</span>&nbsp;<span class="ident" id="4764274">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4764286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764290">z</span><span class="op" id="4764291">.</span><span class="ident" id="4764292">buf</span><span class="op" id="4764295">[</span><span class="ident" id="4764296">i</span><span class="op" id="4764297">]</span><span class="op" id="4764298">,</span>&nbsp;<span class="ident" id="4764300">err</span>&nbsp;<span class="op" id="4764304">=</span>&nbsp;<span class="ident" id="4764306">z</span><span class="op" id="4764307">.</span><span class="ident" id="4764308">r</span><span class="op" id="4764309">.</span><span class="ident" id="4764310">ReadByte</span><span class="op" id="4764318">(</span><span class="op" id="4764319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4764323">if</span>&nbsp;<span class="ident" id="4764326">err</span>&nbsp;<span class="op" id="4764330">!=</span>&nbsp;<span class="builtintype" id="4764333">nil</span>&nbsp;<span class="op" id="4764337">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4764342">return</span>&nbsp;<span class="string" id="4764349">&#34;&#34;</span><span class="op" id="4764351">,</span>&nbsp;<span class="ident" id="4764353">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4764359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4764363">if</span>&nbsp;<span class="ident" id="4764366">z</span><span class="op" id="4764367">.</span><span class="ident" id="4764368">buf</span><span class="op" id="4764371">[</span><span class="ident" id="4764372">i</span><span class="op" id="4764373">]</span>&nbsp;<span class="op" id="4764375">&gt;</span>&nbsp;<span class="num" id="4764377">0x7f</span>&nbsp;<span class="op" id="4764382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764387">needconv</span>&nbsp;<span class="op" id="4764396">=</span>&nbsp;<span class="builtintype" id="4764398">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4764405">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4764409">if</span>&nbsp;<span class="ident" id="4764412">z</span><span class="op" id="4764413">.</span><span class="ident" id="4764414">buf</span><span class="op" id="4764417">[</span><span class="ident" id="4764418">i</span><span class="op" id="4764419">]</span>&nbsp;<span class="op" id="4764421">==</span>&nbsp;<span class="num" id="4764424">0</span>&nbsp;<span class="op" id="4764426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4764431">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4764517">if</span>&nbsp;<span class="ident" id="4764520">needconv</span>&nbsp;<span class="op" id="4764529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764535">s</span>&nbsp;<span class="op" id="4764537">:=</span>&nbsp;<span class="builtinfunc" id="4764540">make</span><span class="op" id="4764544">(</span><span class="op" id="4764545">[</span><span class="op" id="4764546">]</span><span class="builtintype" id="4764547">rune</span><span class="op" id="4764551">,</span>&nbsp;<span class="num" id="4764553">0</span><span class="op" id="4764554">,</span>&nbsp;<span class="ident" id="4764556">i</span><span class="op" id="4764557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4764563">for</span>&nbsp;<span class="ident" id="4764567">_</span><span class="op" id="4764568">,</span>&nbsp;<span class="ident" id="4764570">v</span>&nbsp;<span class="op" id="4764572">:=</span>&nbsp;<span class="keyword" id="4764575">range</span>&nbsp;<span class="ident" id="4764581">z</span><span class="op" id="4764582">.</span><span class="ident" id="4764583">buf</span><span class="op" id="4764586">[</span><span class="num" id="4764587">0</span><span class="op" id="4764588">:</span><span class="ident" id="4764589">i</span><span class="op" id="4764590">]</span>&nbsp;<span class="op" id="4764592">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764599">s</span>&nbsp;<span class="op" id="4764601">=</span>&nbsp;<span class="builtinfunc" id="4764603">append</span><span class="op" id="4764609">(</span><span class="ident" id="4764610">s</span><span class="op" id="4764611">,</span>&nbsp;<span class="builtintype" id="4764613">rune</span><span class="op" id="4764617">(</span><span class="ident" id="4764618">v</span><span class="op" id="4764619">)</span><span class="op" id="4764620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4764626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4764632">return</span>&nbsp;<span class="builtintype" id="4764639">string</span><span class="op" id="4764645">(</span><span class="ident" id="4764646">s</span><span class="op" id="4764647">)</span><span class="op" id="4764648">,</span>&nbsp;<span class="builtintype" id="4764650">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4764657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4764662">return</span>&nbsp;<span class="builtintype" id="4764669">string</span><span class="op" id="4764675">(</span><span class="ident" id="4764676">z</span><span class="op" id="4764677">.</span><span class="ident" id="4764678">buf</span><span class="op" id="4764681">[</span><span class="num" id="4764682">0</span><span class="op" id="4764683">:</span><span class="ident" id="4764684">i</span><span class="op" id="4764685">]</span><span class="op" id="4764686">)</span><span class="op" id="4764687">,</span>&nbsp;<span class="builtintype" id="4764689">nil</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4764695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4764698">}</span><br>
<span class="lineno"></span><span class="op" id="4764700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4764703">func</span>&nbsp;<span class="op" id="4764708">(</span><span class="ident" id="4764709">z</span>&nbsp;<span class="op" id="4764711">*</span><span class="ident" id="4764712">Reader</span><span class="op" id="4764718">)</span>&nbsp;<span class="ident" id="4764720">read2</span><span class="op" id="4764725">(</span><span class="op" id="4764726">)</span>&nbsp;<span class="op" id="4764728">(</span><span class="builtintype" id="4764729">uint32</span><span class="op" id="4764735">,</span>&nbsp;<span class="builtintype" id="4764737">error</span><span class="op" id="4764742">)</span>&nbsp;<span class="op" id="4764744">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764747">_</span><span class="op" id="4764748">,</span>&nbsp;<span class="ident" id="4764750">err</span>&nbsp;<span class="op" id="4764754">:=</span>&nbsp;<span class="ident" id="4764757">io</span><span class="op" id="4764759">.</span><span class="ident" id="4764760">ReadFull</span><span class="op" id="4764768">(</span><span class="ident" id="4764769">z</span><span class="op" id="4764770">.</span><span class="ident" id="4764771">r</span><span class="op" id="4764772">,</span>&nbsp;<span class="ident" id="4764774">z</span><span class="op" id="4764775">.</span><span class="ident" id="4764776">buf</span><span class="op" id="4764779">[</span><span class="num" id="4764780">0</span><span class="op" id="4764781">:</span><span class="num" id="4764782">2</span><span class="op" id="4764783">]</span><span class="op" id="4764784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4764787">if</span>&nbsp;<span class="ident" id="4764790">err</span>&nbsp;<span class="op" id="4764794">!=</span>&nbsp;<span class="builtintype" id="4764797">nil</span>&nbsp;<span class="op" id="4764801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4764805">return</span>&nbsp;<span class="num" id="4764812">0</span><span class="op" id="4764813">,</span>&nbsp;<span class="ident" id="4764815">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4764820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4764823">return</span>&nbsp;<span class="builtintype" id="4764830">uint32</span><span class="op" id="4764836">(</span><span class="ident" id="4764837">z</span><span class="op" id="4764838">.</span><span class="ident" id="4764839">buf</span><span class="op" id="4764842">[</span><span class="num" id="4764843">0</span><span class="op" id="4764844">]</span><span class="op" id="4764845">)</span>&nbsp;<span class="op" id="4764847">|</span>&nbsp;<span class="builtintype" id="4764849">uint32</span><span class="op" id="4764855">(</span><span class="ident" id="4764856">z</span><span class="op" id="4764857">.</span><span class="ident" id="4764858">buf</span><span class="op" id="4764861">[</span><span class="num" id="4764862">1</span><span class="op" id="4764863">]</span><span class="op" id="4764864">)</span><span class="op" id="4764865">&lt;&lt;</span><span class="num" id="4764867">8</span><span class="op" id="4764868">,</span>&nbsp;<span class="builtintype" id="4764870">nil</span><br>
<span class="lineno">170</span><span class="op" id="4764874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4764877">func</span>&nbsp;<span class="op" id="4764882">(</span><span class="ident" id="4764883">z</span>&nbsp;<span class="op" id="4764885">*</span><span class="ident" id="4764886">Reader</span><span class="op" id="4764892">)</span>&nbsp;<span class="ident" id="4764894">readHeader</span><span class="op" id="4764904">(</span><span class="ident" id="4764905">save</span>&nbsp;<span class="builtintype" id="4764910">bool</span><span class="op" id="4764914">)</span>&nbsp;<span class="builtintype" id="4764916">error</span>&nbsp;<span class="op" id="4764922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4764925">_</span><span class="op" id="4764926">,</span>&nbsp;<span class="ident" id="4764928">err</span>&nbsp;<span class="op" id="4764932">:=</span>&nbsp;<span class="ident" id="4764935">io</span><span class="op" id="4764937">.</span><span class="ident" id="4764938">ReadFull</span><span class="op" id="4764946">(</span><span class="ident" id="4764947">z</span><span class="op" id="4764948">.</span><span class="ident" id="4764949">r</span><span class="op" id="4764950">,</span>&nbsp;<span class="ident" id="4764952">z</span><span class="op" id="4764953">.</span><span class="ident" id="4764954">buf</span><span class="op" id="4764957">[</span><span class="num" id="4764958">0</span><span class="op" id="4764959">:</span><span class="num" id="4764960">10</span><span class="op" id="4764962">]</span><span class="op" id="4764963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4764966">if</span>&nbsp;<span class="ident" id="4764969">err</span>&nbsp;<span class="op" id="4764973">!=</span>&nbsp;<span class="builtintype" id="4764976">nil</span>&nbsp;<span class="op" id="4764980">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4764984">return</span>&nbsp;<span class="ident" id="4764991">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4764996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4764999">if</span>&nbsp;<span class="ident" id="4765002">z</span><span class="op" id="4765003">.</span><span class="ident" id="4765004">buf</span><span class="op" id="4765007">[</span><span class="num" id="4765008">0</span><span class="op" id="4765009">]</span>&nbsp;<span class="op" id="4765011">!=</span>&nbsp;<span class="ident" id="4765014">gzipID1</span>&nbsp;<span class="op" id="4765022">||</span>&nbsp;<span class="ident" id="4765025">z</span><span class="op" id="4765026">.</span><span class="ident" id="4765027">buf</span><span class="op" id="4765030">[</span><span class="num" id="4765031">1</span><span class="op" id="4765032">]</span>&nbsp;<span class="op" id="4765034">!=</span>&nbsp;<span class="ident" id="4765037">gzipID2</span>&nbsp;<span class="op" id="4765045">||</span>&nbsp;<span class="ident" id="4765048">z</span><span class="op" id="4765049">.</span><span class="ident" id="4765050">buf</span><span class="op" id="4765053">[</span><span class="num" id="4765054">2</span><span class="op" id="4765055">]</span>&nbsp;<span class="op" id="4765057">!=</span>&nbsp;<span class="ident" id="4765060">gzipDeflate</span>&nbsp;<span class="op" id="4765072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765076">return</span>&nbsp;<span class="ident" id="4765083">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4765094">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4765097">z</span><span class="op" id="4765098">.</span><span class="ident" id="4765099">flg</span>&nbsp;<span class="op" id="4765103">=</span>&nbsp;<span class="ident" id="4765105">z</span><span class="op" id="4765106">.</span><span class="ident" id="4765107">buf</span><span class="op" id="4765110">[</span><span class="num" id="4765111">3</span><span class="op" id="4765112">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765115">if</span>&nbsp;<span class="ident" id="4765118">save</span>&nbsp;<span class="op" id="4765123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4765127">z</span><span class="op" id="4765128">.</span><span class="ident" id="4765129">ModTime</span>&nbsp;<span class="op" id="4765137">=</span>&nbsp;<span class="ident" id="4765139">time</span><span class="op" id="4765143">.</span><span class="ident" id="4765144">Unix</span><span class="op" id="4765148">(</span><span class="ident" id="4765149">int64</span><span class="op" id="4765154">(</span><span class="ident" id="4765155">get4</span><span class="op" id="4765159">(</span><span class="ident" id="4765160">z</span><span class="op" id="4765161">.</span><span class="ident" id="4765162">buf</span><span class="op" id="4765165">[</span><span class="num" id="4765166">4</span><span class="op" id="4765167">:</span><span class="num" id="4765168">8</span><span class="op" id="4765169">]</span><span class="op" id="4765170">)</span><span class="op" id="4765171">)</span><span class="op" id="4765172">,</span>&nbsp;<span class="num" id="4765174">0</span><span class="op" id="4765175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4765179">//&nbsp;z.buf[8]&nbsp;is&nbsp;xfl,&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4765209">z</span><span class="op" id="4765210">.</span><span class="ident" id="4765211">OS</span>&nbsp;<span class="op" id="4765214">=</span>&nbsp;<span class="ident" id="4765216">z</span><span class="op" id="4765217">.</span><span class="ident" id="4765218">buf</span><span class="op" id="4765221">[</span><span class="num" id="4765222">9</span><span class="op" id="4765223">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4765226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4765229">z</span><span class="op" id="4765230">.</span><span class="ident" id="4765231">digest</span><span class="op" id="4765237">.</span><span class="ident" id="4765238">Reset</span><span class="op" id="4765243">(</span><span class="op" id="4765244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4765247">z</span><span class="op" id="4765248">.</span><span class="ident" id="4765249">digest</span><span class="op" id="4765255">.</span><span class="ident" id="4765256">Write</span><span class="op" id="4765261">(</span><span class="ident" id="4765262">z</span><span class="op" id="4765263">.</span><span class="ident" id="4765264">buf</span><span class="op" id="4765267">[</span><span class="num" id="4765268">0</span><span class="op" id="4765269">:</span><span class="num" id="4765270">10</span><span class="op" id="4765272">]</span><span class="op" id="4765273">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765277">if</span>&nbsp;<span class="ident" id="4765280">z</span><span class="op" id="4765281">.</span><span class="ident" id="4765282">flg</span><span class="op" id="4765285">&amp;</span><span class="ident" id="4765286">flagExtra</span>&nbsp;<span class="op" id="4765296">!=</span>&nbsp;<span class="num" id="4765299">0</span>&nbsp;<span class="op" id="4765301">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4765305">n</span><span class="op" id="4765306">,</span>&nbsp;<span class="ident" id="4765308">err</span>&nbsp;<span class="op" id="4765312">:=</span>&nbsp;<span class="ident" id="4765315">z</span><span class="op" id="4765316">.</span><span class="ident" id="4765317">read2</span><span class="op" id="4765322">(</span><span class="op" id="4765323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765327">if</span>&nbsp;<span class="ident" id="4765330">err</span>&nbsp;<span class="op" id="4765334">!=</span>&nbsp;<span class="builtintype" id="4765337">nil</span>&nbsp;<span class="op" id="4765341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765346">return</span>&nbsp;<span class="ident" id="4765353">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4765359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4765363">data</span>&nbsp;<span class="op" id="4765368">:=</span>&nbsp;<span class="builtinfunc" id="4765371">make</span><span class="op" id="4765375">(</span><span class="op" id="4765376">[</span><span class="op" id="4765377">]</span><span class="builtintype" id="4765378">byte</span><span class="op" id="4765382">,</span>&nbsp;<span class="ident" id="4765384">n</span><span class="op" id="4765385">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765389">if</span>&nbsp;<span class="ident" id="4765392">_</span><span class="op" id="4765393">,</span>&nbsp;<span class="ident" id="4765395">err</span>&nbsp;<span class="op" id="4765399">=</span>&nbsp;<span class="ident" id="4765401">io</span><span class="op" id="4765403">.</span><span class="ident" id="4765404">ReadFull</span><span class="op" id="4765412">(</span><span class="ident" id="4765413">z</span><span class="op" id="4765414">.</span><span class="ident" id="4765415">r</span><span class="op" id="4765416">,</span>&nbsp;<span class="ident" id="4765418">data</span><span class="op" id="4765422">)</span><span class="op" id="4765423">;</span>&nbsp;<span class="ident" id="4765425">err</span>&nbsp;<span class="op" id="4765429">!=</span>&nbsp;<span class="builtintype" id="4765432">nil</span>&nbsp;<span class="op" id="4765436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765441">return</span>&nbsp;<span class="ident" id="4765448">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4765454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765458">if</span>&nbsp;<span class="ident" id="4765461">save</span>&nbsp;<span class="op" id="4765466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4765471">z</span><span class="op" id="4765472">.</span><span class="ident" id="4765473">Extra</span>&nbsp;<span class="op" id="4765479">=</span>&nbsp;<span class="ident" id="4765481">data</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4765488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4765491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765495">var</span>&nbsp;<span class="ident" id="4765499">s</span>&nbsp;<span class="builtintype" id="4765501">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765509">if</span>&nbsp;<span class="ident" id="4765512">z</span><span class="op" id="4765513">.</span><span class="ident" id="4765514">flg</span><span class="op" id="4765517">&amp;</span><span class="ident" id="4765518">flagName</span>&nbsp;<span class="op" id="4765527">!=</span>&nbsp;<span class="num" id="4765530">0</span>&nbsp;<span class="op" id="4765532">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765536">if</span>&nbsp;<span class="ident" id="4765539">s</span><span class="op" id="4765540">,</span>&nbsp;<span class="ident" id="4765542">err</span>&nbsp;<span class="op" id="4765546">=</span>&nbsp;<span class="ident" id="4765548">z</span><span class="op" id="4765549">.</span><span class="ident" id="4765550">readString</span><span class="op" id="4765560">(</span><span class="op" id="4765561">)</span><span class="op" id="4765562">;</span>&nbsp;<span class="ident" id="4765564">err</span>&nbsp;<span class="op" id="4765568">!=</span>&nbsp;<span class="builtintype" id="4765571">nil</span>&nbsp;<span class="op" id="4765575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765580">return</span>&nbsp;<span class="ident" id="4765587">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4765593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765597">if</span>&nbsp;<span class="ident" id="4765600">save</span>&nbsp;<span class="op" id="4765605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4765610">z</span><span class="op" id="4765611">.</span><span class="ident" id="4765612">Name</span>&nbsp;<span class="op" id="4765617">=</span>&nbsp;<span class="ident" id="4765619">s</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4765623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4765626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765630">if</span>&nbsp;<span class="ident" id="4765633">z</span><span class="op" id="4765634">.</span><span class="ident" id="4765635">flg</span><span class="op" id="4765638">&amp;</span><span class="ident" id="4765639">flagComment</span>&nbsp;<span class="op" id="4765651">!=</span>&nbsp;<span class="num" id="4765654">0</span>&nbsp;<span class="op" id="4765656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765660">if</span>&nbsp;<span class="ident" id="4765663">s</span><span class="op" id="4765664">,</span>&nbsp;<span class="ident" id="4765666">err</span>&nbsp;<span class="op" id="4765670">=</span>&nbsp;<span class="ident" id="4765672">z</span><span class="op" id="4765673">.</span><span class="ident" id="4765674">readString</span><span class="op" id="4765684">(</span><span class="op" id="4765685">)</span><span class="op" id="4765686">;</span>&nbsp;<span class="ident" id="4765688">err</span>&nbsp;<span class="op" id="4765692">!=</span>&nbsp;<span class="builtintype" id="4765695">nil</span>&nbsp;<span class="op" id="4765699">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765704">return</span>&nbsp;<span class="ident" id="4765711">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4765717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765721">if</span>&nbsp;<span class="ident" id="4765724">save</span>&nbsp;<span class="op" id="4765729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4765734">z</span><span class="op" id="4765735">.</span><span class="ident" id="4765736">Comment</span>&nbsp;<span class="op" id="4765744">=</span>&nbsp;<span class="ident" id="4765746">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4765750">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4765753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765757">if</span>&nbsp;<span class="ident" id="4765760">z</span><span class="op" id="4765761">.</span><span class="ident" id="4765762">flg</span><span class="op" id="4765765">&amp;</span><span class="ident" id="4765766">flagHdrCrc</span>&nbsp;<span class="op" id="4765777">!=</span>&nbsp;<span class="num" id="4765780">0</span>&nbsp;<span class="op" id="4765782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4765786">n</span><span class="op" id="4765787">,</span>&nbsp;<span class="ident" id="4765789">err</span>&nbsp;<span class="op" id="4765793">:=</span>&nbsp;<span class="ident" id="4765796">z</span><span class="op" id="4765797">.</span><span class="ident" id="4765798">read2</span><span class="op" id="4765803">(</span><span class="op" id="4765804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765808">if</span>&nbsp;<span class="ident" id="4765811">err</span>&nbsp;<span class="op" id="4765815">!=</span>&nbsp;<span class="builtintype" id="4765818">nil</span>&nbsp;<span class="op" id="4765822">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765827">return</span>&nbsp;<span class="ident" id="4765834">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4765840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4765844">sum</span>&nbsp;<span class="op" id="4765848">:=</span>&nbsp;<span class="ident" id="4765851">z</span><span class="op" id="4765852">.</span><span class="ident" id="4765853">digest</span><span class="op" id="4765859">.</span><span class="ident" id="4765860">Sum32</span><span class="op" id="4765865">(</span><span class="op" id="4765866">)</span>&nbsp;<span class="op" id="4765868">&amp;</span>&nbsp;<span class="num" id="4765870">0xFFFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765879">if</span>&nbsp;<span class="ident" id="4765882">n</span>&nbsp;<span class="op" id="4765884">!=</span>&nbsp;<span class="ident" id="4765887">sum</span>&nbsp;<span class="op" id="4765891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765896">return</span>&nbsp;<span class="ident" id="4765903">ErrHeader</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4765915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4765918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4765922">z</span><span class="op" id="4765923">.</span><span class="ident" id="4765924">digest</span><span class="op" id="4765930">.</span><span class="ident" id="4765931">Reset</span><span class="op" id="4765936">(</span><span class="op" id="4765937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4765940">if</span>&nbsp;<span class="ident" id="4765943">z</span><span class="op" id="4765944">.</span><span class="ident" id="4765945">decompressor</span>&nbsp;<span class="op" id="4765958">==</span>&nbsp;<span class="builtintype" id="4765961">nil</span>&nbsp;<span class="op" id="4765965">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4765969">z</span><span class="op" id="4765970">.</span><span class="ident" id="4765971">decompressor</span>&nbsp;<span class="op" id="4765984">=</span>&nbsp;<span class="ident" id="4765986">flate</span><span class="op" id="4765991">.</span><span class="ident" id="4765992">NewReader</span><span class="op" id="4766001">(</span><span class="ident" id="4766002">z</span><span class="op" id="4766003">.</span><span class="ident" id="4766004">r</span><span class="op" id="4766005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4766008">}</span>&nbsp;<span class="keyword" id="4766010">else</span>&nbsp;<span class="op" id="4766015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4766019">z</span><span class="op" id="4766020">.</span><span class="ident" id="4766021">decompressor</span><span class="op" id="4766033">.</span><span class="op" id="4766034">(</span><span class="ident" id="4766035">flate</span><span class="op" id="4766040">.</span><span class="ident" id="4766041">Resetter</span><span class="op" id="4766049">)</span><span class="op" id="4766050">.</span><span class="ident" id="4766051">Reset</span><span class="op" id="4766056">(</span><span class="ident" id="4766057">z</span><span class="op" id="4766058">.</span><span class="ident" id="4766059">r</span><span class="op" id="4766060">,</span>&nbsp;<span class="builtintype" id="4766062">nil</span><span class="op" id="4766065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4766068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4766071">return</span>&nbsp;<span class="builtintype" id="4766078">nil</span><br>
<span class="lineno">240</span><span class="op" id="4766082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4766085">func</span>&nbsp;<span class="op" id="4766090">(</span><span class="ident" id="4766091">z</span>&nbsp;<span class="op" id="4766093">*</span><span class="ident" id="4766094">Reader</span><span class="op" id="4766100">)</span>&nbsp;<span class="ident" id="4766102">Read</span><span class="op" id="4766106">(</span><span class="ident" id="4766107">p</span>&nbsp;<span class="op" id="4766109">[</span><span class="op" id="4766110">]</span><span class="builtintype" id="4766111">byte</span><span class="op" id="4766115">)</span>&nbsp;<span class="op" id="4766117">(</span><span class="ident" id="4766118">n</span>&nbsp;<span class="builtintype" id="4766120">int</span><span class="op" id="4766123">,</span>&nbsp;<span class="ident" id="4766125">err</span>&nbsp;<span class="builtintype" id="4766129">error</span><span class="op" id="4766134">)</span>&nbsp;<span class="op" id="4766136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4766139">if</span>&nbsp;<span class="ident" id="4766142">z</span><span class="op" id="4766143">.</span><span class="ident" id="4766144">err</span>&nbsp;<span class="op" id="4766148">!=</span>&nbsp;<span class="builtintype" id="4766151">nil</span>&nbsp;<span class="op" id="4766155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4766159">return</span>&nbsp;<span class="num" id="4766166">0</span><span class="op" id="4766167">,</span>&nbsp;<span class="ident" id="4766169">z</span><span class="op" id="4766170">.</span><span class="ident" id="4766171">err</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4766176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4766179">if</span>&nbsp;<span class="builtinfunc" id="4766182">len</span><span class="op" id="4766185">(</span><span class="ident" id="4766186">p</span><span class="op" id="4766187">)</span>&nbsp;<span class="op" id="4766189">==</span>&nbsp;<span class="num" id="4766192">0</span>&nbsp;<span class="op" id="4766194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4766198">return</span>&nbsp;<span class="num" id="4766205">0</span><span class="op" id="4766206">,</span>&nbsp;<span class="builtintype" id="4766208">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4766213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4766217">n</span><span class="op" id="4766218">,</span>&nbsp;<span class="ident" id="4766220">err</span>&nbsp;<span class="op" id="4766224">=</span>&nbsp;<span class="ident" id="4766226">z</span><span class="op" id="4766227">.</span><span class="ident" id="4766228">decompressor</span><span class="op" id="4766240">.</span><span class="ident" id="4766241">Read</span><span class="op" id="4766245">(</span><span class="ident" id="4766246">p</span><span class="op" id="4766247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4766250">z</span><span class="op" id="4766251">.</span><span class="ident" id="4766252">digest</span><span class="op" id="4766258">.</span><span class="ident" id="4766259">Write</span><span class="op" id="4766264">(</span><span class="ident" id="4766265">p</span><span class="op" id="4766266">[</span><span class="num" id="4766267">0</span><span class="op" id="4766268">:</span><span class="ident" id="4766269">n</span><span class="op" id="4766270">]</span><span class="op" id="4766271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4766274">z</span><span class="op" id="4766275">.</span><span class="ident" id="4766276">size</span>&nbsp;<span class="op" id="4766281">+=</span>&nbsp;<span class="builtintype" id="4766284">uint32</span><span class="op" id="4766290">(</span><span class="ident" id="4766291">n</span><span class="op" id="4766292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4766295">if</span>&nbsp;<span class="ident" id="4766298">n</span>&nbsp;<span class="op" id="4766300">!=</span>&nbsp;<span class="num" id="4766303">0</span>&nbsp;<span class="op" id="4766305">||</span>&nbsp;<span class="ident" id="4766308">err</span>&nbsp;<span class="op" id="4766312">!=</span>&nbsp;<span class="ident" id="4766315">io</span><span class="op" id="4766317">.</span><span class="ident" id="4766318">EOF</span>&nbsp;<span class="op" id="4766322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4766326">z</span><span class="op" id="4766327">.</span><span class="ident" id="4766328">err</span>&nbsp;<span class="op" id="4766332">=</span>&nbsp;<span class="ident" id="4766334">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4766340">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4766348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4766352">//&nbsp;Finished&nbsp;file;&nbsp;check&nbsp;checksum&nbsp;+&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4766394">if</span>&nbsp;<span class="ident" id="4766397">_</span><span class="op" id="4766398">,</span>&nbsp;<span class="ident" id="4766400">err</span>&nbsp;<span class="op" id="4766404">:=</span>&nbsp;<span class="ident" id="4766407">io</span><span class="op" id="4766409">.</span><span class="ident" id="4766410">ReadFull</span><span class="op" id="4766418">(</span><span class="ident" id="4766419">z</span><span class="op" id="4766420">.</span><span class="ident" id="4766421">r</span><span class="op" id="4766422">,</span>&nbsp;<span class="ident" id="4766424">z</span><span class="op" id="4766425">.</span><span class="ident" id="4766426">buf</span><span class="op" id="4766429">[</span><span class="num" id="4766430">0</span><span class="op" id="4766431">:</span><span class="num" id="4766432">8</span><span class="op" id="4766433">]</span><span class="op" id="4766434">)</span><span class="op" id="4766435">;</span>&nbsp;<span class="ident" id="4766437">err</span>&nbsp;<span class="op" id="4766441">!=</span>&nbsp;<span class="builtintype" id="4766444">nil</span>&nbsp;<span class="op" id="4766448">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4766452">z</span><span class="op" id="4766453">.</span><span class="ident" id="4766454">err</span>&nbsp;<span class="op" id="4766458">=</span>&nbsp;<span class="ident" id="4766460">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4766466">return</span>&nbsp;<span class="num" id="4766473">0</span><span class="op" id="4766474">,</span>&nbsp;<span class="ident" id="4766476">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4766481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4766484">crc32</span><span class="op" id="4766489">,</span>&nbsp;<span class="ident" id="4766491">isize</span>&nbsp;<span class="op" id="4766497">:=</span>&nbsp;<span class="ident" id="4766500">get4</span><span class="op" id="4766504">(</span><span class="ident" id="4766505">z</span><span class="op" id="4766506">.</span><span class="ident" id="4766507">buf</span><span class="op" id="4766510">[</span><span class="num" id="4766511">0</span><span class="op" id="4766512">:</span><span class="num" id="4766513">4</span><span class="op" id="4766514">]</span><span class="op" id="4766515">)</span><span class="op" id="4766516">,</span>&nbsp;<span class="ident" id="4766518">get4</span><span class="op" id="4766522">(</span><span class="ident" id="4766523">z</span><span class="op" id="4766524">.</span><span class="ident" id="4766525">buf</span><span class="op" id="4766528">[</span><span class="num" id="4766529">4</span><span class="op" id="4766530">:</span><span class="num" id="4766531">8</span><span class="op" id="4766532">]</span><span class="op" id="4766533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4766536">sum</span>&nbsp;<span class="op" id="4766540">:=</span>&nbsp;<span class="ident" id="4766543">z</span><span class="op" id="4766544">.</span><span class="ident" id="4766545">digest</span><span class="op" id="4766551">.</span><span class="ident" id="4766552">Sum32</span><span class="op" id="4766557">(</span><span class="op" id="4766558">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4766561">if</span>&nbsp;<span class="ident" id="4766564">sum</span>&nbsp;<span class="op" id="4766568">!=</span>&nbsp;<span class="ident" id="4766571">crc32</span>&nbsp;<span class="op" id="4766577">||</span>&nbsp;<span class="ident" id="4766580">isize</span>&nbsp;<span class="op" id="4766586">!=</span>&nbsp;<span class="ident" id="4766589">z</span><span class="op" id="4766590">.</span><span class="ident" id="4766591">size</span>&nbsp;<span class="op" id="4766596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4766600">z</span><span class="op" id="4766601">.</span><span class="ident" id="4766602">err</span>&nbsp;<span class="op" id="4766606">=</span>&nbsp;<span class="ident" id="4766608">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4766622">return</span>&nbsp;<span class="num" id="4766629">0</span><span class="op" id="4766630">,</span>&nbsp;<span class="ident" id="4766632">z</span><span class="op" id="4766633">.</span><span class="ident" id="4766634">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4766639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4766643">//&nbsp;File&nbsp;is&nbsp;ok;&nbsp;is&nbsp;there&nbsp;another?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4766677">if</span>&nbsp;<span class="op" id="4766680">!</span><span class="ident" id="4766681">z</span><span class="op" id="4766682">.</span><span class="ident" id="4766683">multistream</span>&nbsp;<span class="op" id="4766695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4766699">return</span>&nbsp;<span class="num" id="4766706">0</span><span class="op" id="4766707">,</span>&nbsp;<span class="ident" id="4766709">io</span><span class="op" id="4766711">.</span><span class="ident" id="4766712">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4766717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4766721">if</span>&nbsp;<span class="ident" id="4766724">err</span>&nbsp;<span class="op" id="4766728">=</span>&nbsp;<span class="ident" id="4766730">z</span><span class="op" id="4766731">.</span><span class="ident" id="4766732">readHeader</span><span class="op" id="4766742">(</span><span class="builtintype" id="4766743">false</span><span class="op" id="4766748">)</span><span class="op" id="4766749">;</span>&nbsp;<span class="ident" id="4766751">err</span>&nbsp;<span class="op" id="4766755">!=</span>&nbsp;<span class="builtintype" id="4766758">nil</span>&nbsp;<span class="op" id="4766762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4766766">z</span><span class="op" id="4766767">.</span><span class="ident" id="4766768">err</span>&nbsp;<span class="op" id="4766772">=</span>&nbsp;<span class="ident" id="4766774">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4766780">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4766788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4766792">//&nbsp;Yes.&nbsp;&nbsp;Reset&nbsp;and&nbsp;read&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4766826">z</span><span class="op" id="4766827">.</span><span class="ident" id="4766828">digest</span><span class="op" id="4766834">.</span><span class="ident" id="4766835">Reset</span><span class="op" id="4766840">(</span><span class="op" id="4766841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4766844">z</span><span class="op" id="4766845">.</span><span class="ident" id="4766846">size</span>&nbsp;<span class="op" id="4766851">=</span>&nbsp;<span class="num" id="4766853">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4766856">return</span>&nbsp;<span class="ident" id="4766863">z</span><span class="op" id="4766864">.</span><span class="ident" id="4766865">Read</span><span class="op" id="4766869">(</span><span class="ident" id="4766870">p</span><span class="op" id="4766871">)</span><br>
<span class="lineno"></span><span class="op" id="4766873">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="4766876">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Reader.&nbsp;It&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="keyword" id="4766948">func</span>&nbsp;<span class="op" id="4766953">(</span><span class="ident" id="4766954">z</span>&nbsp;<span class="op" id="4766956">*</span><span class="ident" id="4766957">Reader</span><span class="op" id="4766963">)</span>&nbsp;<span class="ident" id="4766965">Close</span><span class="op" id="4766970">(</span><span class="op" id="4766971">)</span>&nbsp;<span class="builtintype" id="4766973">error</span>&nbsp;<span class="op" id="4766979">{</span>&nbsp;<span class="keyword" id="4766981">return</span>&nbsp;<span class="ident" id="4766988">z</span><span class="op" id="4766989">.</span><span class="ident" id="4766990">decompressor</span><span class="op" id="4767002">.</span><span class="ident" id="4767003">Close</span><span class="op" id="4767008">(</span><span class="op" id="4767009">)</span>&nbsp;<span class="op" id="4767011">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
