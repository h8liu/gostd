<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5519177">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5519232">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5519286">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5519337">//&nbsp;Package&nbsp;bzip2&nbsp;implements&nbsp;bzip2&nbsp;decompression.</span><br>
<span class="lineno"></span><span class="keyword" id="5519386">package</span>&nbsp;<span class="ident" id="5519394">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5519401">import</span>&nbsp;<span class="string" id="5519408">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="5519414">//&nbsp;There&#39;s&nbsp;no&nbsp;RFC&nbsp;for&nbsp;bzip2.&nbsp;I&nbsp;used&nbsp;the&nbsp;Wikipedia&nbsp;page&nbsp;for&nbsp;reference&nbsp;and&nbsp;a&nbsp;lot</span><br>
<span class="lineno"></span><span class="comment" id="5519493">//&nbsp;of&nbsp;guessing:&nbsp;http://en.wikipedia.org/wiki/Bzip2</span><br>
<span class="lineno"></span><span class="comment" id="5519544">//&nbsp;The&nbsp;source&nbsp;code&nbsp;to&nbsp;pyflate&nbsp;was&nbsp;useful&nbsp;for&nbsp;debugging:</span><br>
<span class="lineno"></span><span class="comment" id="5519600">//&nbsp;http://www.paul.sladen.org/projects/pyflate</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5519648">//&nbsp;A&nbsp;StructuralError&nbsp;is&nbsp;returned&nbsp;when&nbsp;the&nbsp;bzip2&nbsp;data&nbsp;is&nbsp;found&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5519716">//&nbsp;syntactically&nbsp;invalid.</span><br>
<span class="lineno"></span><span class="keyword" id="5519742">type</span>&nbsp;<span class="ident" id="5519747">StructuralError</span>&nbsp;<span class="builtintype" id="5519763">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5519771">func</span>&nbsp;<span class="op" id="5519776">(</span><span class="ident" id="5519777">s</span>&nbsp;<span class="ident" id="5519779"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5519794">)</span>&nbsp;<span class="ident" id="5519796">Error</span><span class="op" id="5519801">(</span><span class="op" id="5519802">)</span>&nbsp;<span class="builtintype" id="5519804">string</span>&nbsp;<span class="op" id="5519811">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519814">return</span>&nbsp;<span class="string" id="5519821">&#34;bzip2&nbsp;data&nbsp;invalid:&nbsp;&#34;</span>&nbsp;<span class="op" id="5519844">+</span>&nbsp;<span class="builtintype" id="5519846">string</span><span class="op" id="5519852">(</span><span class="ident" id="5519853"><a href="/compress/bzip2/bzip2.go.html#5519777">s</a></span><span class="op" id="5519854">)</span><br>
<span class="lineno"></span><span class="op" id="5519856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5519859">//&nbsp;A&nbsp;reader&nbsp;decompresses&nbsp;bzip2&nbsp;compressed&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5519907">type</span>&nbsp;<span class="ident" id="5519912">reader</span>&nbsp;<span class="keyword" id="5519919">struct</span>&nbsp;<span class="op" id="5519926">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519929">br</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519942"><a href="/compress/bzip2/bit_reader.go.html#5517461">bitReader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519953">fileCRC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5519966">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519974">blockCRC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5519987">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519995">wantBlockCRC</span>&nbsp;<span class="builtintype" id="5520008">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520016">setupDone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5520029">bool</span>&nbsp;<span class="comment" id="5520034">//&nbsp;true&nbsp;if&nbsp;we&nbsp;have&nbsp;parsed&nbsp;the&nbsp;bzip2&nbsp;header.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520079">blockSize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5520092">int</span>&nbsp;&nbsp;<span class="comment" id="5520097">//&nbsp;blockSize&nbsp;in&nbsp;bytes,&nbsp;i.e.&nbsp;900&nbsp;*&nbsp;1024.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520138">eof</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5520151">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520157">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5520170">[</span><span class="op" id="5520171">]</span><span class="builtintype" id="5520172">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5520180">//&nbsp;stores&nbsp;Burrows-Wheeler&nbsp;transformed&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520225">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5520238">[</span><span class="num" id="5520239">256</span><span class="op" id="5520242">]</span><span class="builtintype" id="5520243">uint</span>&nbsp;<span class="comment" id="5520248">//&nbsp;the&nbsp;`C&#39;&nbsp;array&nbsp;for&nbsp;the&nbsp;inverse&nbsp;BWT.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520287">tt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5520300">[</span><span class="op" id="5520301">]</span><span class="builtintype" id="5520302">uint32</span>&nbsp;&nbsp;<span class="comment" id="5520310">//&nbsp;mirrors&nbsp;the&nbsp;`tt&#39;&nbsp;array&nbsp;in&nbsp;the&nbsp;bzip2&nbsp;source&nbsp;and&nbsp;contains&nbsp;the&nbsp;P&nbsp;array&nbsp;in&nbsp;the&nbsp;upper&nbsp;24&nbsp;bits.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520404">tPos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5520417">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5520427">//&nbsp;Index&nbsp;of&nbsp;the&nbsp;next&nbsp;output&nbsp;byte&nbsp;in&nbsp;tt.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520469">preRLE</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5520481">[</span><span class="op" id="5520482">]</span><span class="builtintype" id="5520483">uint32</span>&nbsp;<span class="comment" id="5520490">//&nbsp;contains&nbsp;the&nbsp;RLE&nbsp;data&nbsp;still&nbsp;to&nbsp;be&nbsp;processed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520539">preRLEUsed</span>&nbsp;&nbsp;<span class="builtintype" id="5520551">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5520560">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;of&nbsp;preRLE&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520598">lastByte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5520610">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5520619">//&nbsp;the&nbsp;last&nbsp;byte&nbsp;value&nbsp;seen.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520649">byteRepeats</span>&nbsp;<span class="builtintype" id="5520661">uint</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5520670">//&nbsp;the&nbsp;number&nbsp;of&nbsp;repeats&nbsp;of&nbsp;lastByte&nbsp;seen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520714">repeats</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5520726">uint</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5520735">//&nbsp;the&nbsp;number&nbsp;of&nbsp;copies&nbsp;of&nbsp;lastByte&nbsp;to&nbsp;output.</span><br>
<span class="lineno"></span><span class="op" id="5520782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5520785">//&nbsp;NewReader&nbsp;returns&nbsp;an&nbsp;io.Reader&nbsp;which&nbsp;decompresses&nbsp;bzip2&nbsp;data&nbsp;from&nbsp;r.</span><br>
<span class="lineno">45</span><span class="comment" id="5520857">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="5520904">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5520966">func</span>&nbsp;<span class="ident" id="5520971">NewReader</span><span class="op" id="5520980">(</span><span class="ident" id="5520981">r</span>&nbsp;<span class="ident" id="5520983"><a href="/compress/bzip2/bzip2.go.html#5519408">io</a></span><span class="op" id="5520985">.</span><span class="ident" id="5520986">Reader</span><span class="op" id="5520992">)</span>&nbsp;<span class="ident" id="5520994"><a href="/compress/bzip2/bzip2.go.html#5519408">io</a></span><span class="op" id="5520996">.</span><span class="ident" id="5520997">Reader</span>&nbsp;<span class="op" id="5521004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521007">bz2</span>&nbsp;<span class="op" id="5521011">:=</span>&nbsp;<span class="builtinfunc" id="5521014">new</span><span class="op" id="5521017">(</span><span class="ident" id="5521018"><a href="/compress/bzip2/bzip2.go.html#5519912">reader</a></span><span class="op" id="5521024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521027"><a href="/compress/bzip2/bzip2.go.html#5521007">bz2</a></span><span class="op" id="5521030">.</span><span class="ident" id="5521031">br</span>&nbsp;<span class="op" id="5521034">=</span>&nbsp;<span class="ident" id="5521036"><a href="/compress/bzip2/bit_reader.go.html#5517682">newBitReader</a></span><span class="op" id="5521048">(</span><span class="ident" id="5521049"><a href="/compress/bzip2/bzip2.go.html#5520981">r</a></span><span class="op" id="5521050">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521053">return</span>&nbsp;<span class="ident" id="5521060"><a href="/compress/bzip2/bzip2.go.html#5521007">bz2</a></span><br>
<span class="lineno"></span><span class="op" id="5521064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5521067">const</span>&nbsp;<span class="ident" id="5521073">bzip2FileMagic</span>&nbsp;<span class="op" id="5521088">=</span>&nbsp;<span class="num" id="5521090">0x425a</span>&nbsp;<span class="comment" id="5521097">//&nbsp;&#34;BZ&#34;</span><br>
<span class="lineno"></span><span class="keyword" id="5521105">const</span>&nbsp;<span class="ident" id="5521111">bzip2BlockMagic</span>&nbsp;<span class="op" id="5521127">=</span>&nbsp;<span class="num" id="5521129">0x314159265359</span><br>
<span class="lineno">55</span><span class="keyword" id="5521144">const</span>&nbsp;<span class="ident" id="5521150">bzip2FinalMagic</span>&nbsp;<span class="op" id="5521166">=</span>&nbsp;<span class="num" id="5521168">0x177245385090</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5521184">//&nbsp;setup&nbsp;parses&nbsp;the&nbsp;bzip2&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="5521218">func</span>&nbsp;<span class="op" id="5521223">(</span><span class="ident" id="5521224">bz2</span>&nbsp;<span class="op" id="5521228">*</span><span class="ident" id="5521229"><a href="/compress/bzip2/bzip2.go.html#5519912">reader</a></span><span class="op" id="5521235">)</span>&nbsp;<span class="ident" id="5521237">setup</span><span class="op" id="5521242">(</span><span class="ident" id="5521243">needMagic</span>&nbsp;<span class="builtintype" id="5521253">bool</span><span class="op" id="5521257">)</span>&nbsp;<span class="builtintype" id="5521259">error</span>&nbsp;<span class="op" id="5521265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521268">br</span>&nbsp;<span class="op" id="5521271">:=</span>&nbsp;<span class="op" id="5521274">&amp;</span><span class="ident" id="5521275"><a href="/compress/bzip2/bzip2.go.html#5521224">bz2</a></span><span class="op" id="5521278">.</span><span class="ident" id="5521279">br</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521284">if</span>&nbsp;<span class="ident" id="5521287"><a href="/compress/bzip2/bzip2.go.html#5521243">needMagic</a></span>&nbsp;<span class="op" id="5521297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521301">magic</span>&nbsp;<span class="op" id="5521307">:=</span>&nbsp;<span class="ident" id="5521310"><a href="/compress/bzip2/bzip2.go.html#5521268">br</a></span><span class="op" id="5521312">.</span><span class="ident" id="5521313">ReadBits</span><span class="op" id="5521321">(</span><span class="num" id="5521322">16</span><span class="op" id="5521324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521328">if</span>&nbsp;<span class="ident" id="5521331"><a href="/compress/bzip2/bzip2.go.html#5521301">magic</a></span>&nbsp;<span class="op" id="5521337">!=</span>&nbsp;<span class="ident" id="5521340"><a href="/compress/bzip2/bzip2.go.html#5521073">bzip2FileMagic</a></span>&nbsp;<span class="op" id="5521355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521360">return</span>&nbsp;<span class="ident" id="5521367"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5521382">(</span><span class="string" id="5521383">&#34;bad&nbsp;magic&nbsp;value&#34;</span><span class="op" id="5521400">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521411">t</span>&nbsp;<span class="op" id="5521413">:=</span>&nbsp;<span class="ident" id="5521416"><a href="/compress/bzip2/bzip2.go.html#5521268">br</a></span><span class="op" id="5521418">.</span><span class="ident" id="5521419">ReadBits</span><span class="op" id="5521427">(</span><span class="num" id="5521428">8</span><span class="op" id="5521429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521432">if</span>&nbsp;<span class="ident" id="5521435"><a href="/compress/bzip2/bzip2.go.html#5521411">t</a></span>&nbsp;<span class="op" id="5521437">!=</span>&nbsp;<span class="string" id="5521440">&#39;h&#39;</span>&nbsp;<span class="op" id="5521444">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521448">return</span>&nbsp;<span class="ident" id="5521455"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5521470">(</span><span class="string" id="5521471">&#34;non-Huffman&nbsp;entropy&nbsp;encoding&#34;</span><span class="op" id="5521501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521508">level</span>&nbsp;<span class="op" id="5521514">:=</span>&nbsp;<span class="ident" id="5521517"><a href="/compress/bzip2/bzip2.go.html#5521268">br</a></span><span class="op" id="5521519">.</span><span class="ident" id="5521520">ReadBits</span><span class="op" id="5521528">(</span><span class="num" id="5521529">8</span><span class="op" id="5521530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521533">if</span>&nbsp;<span class="ident" id="5521536"><a href="/compress/bzip2/bzip2.go.html#5521508">level</a></span>&nbsp;<span class="op" id="5521542">&lt;</span>&nbsp;<span class="string" id="5521544">&#39;1&#39;</span>&nbsp;<span class="op" id="5521548">||</span>&nbsp;<span class="ident" id="5521551"><a href="/compress/bzip2/bzip2.go.html#5521508">level</a></span>&nbsp;<span class="op" id="5521557">&gt;</span>&nbsp;<span class="string" id="5521559">&#39;9&#39;</span>&nbsp;<span class="op" id="5521563">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521567">return</span>&nbsp;<span class="ident" id="5521574"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5521589">(</span><span class="string" id="5521590">&#34;invalid&nbsp;compression&nbsp;level&#34;</span><span class="op" id="5521617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521624"><a href="/compress/bzip2/bzip2.go.html#5521224">bz2</a></span><span class="op" id="5521627">.</span><span class="ident" id="5521628">fileCRC</span>&nbsp;<span class="op" id="5521636">=</span>&nbsp;<span class="num" id="5521638">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521641"><a href="/compress/bzip2/bzip2.go.html#5521224">bz2</a></span><span class="op" id="5521644">.</span><span class="ident" id="5521645">blockSize</span>&nbsp;<span class="op" id="5521655">=</span>&nbsp;<span class="num" id="5521657">100</span>&nbsp;<span class="op" id="5521661">*</span>&nbsp;<span class="num" id="5521663">1024</span>&nbsp;<span class="op" id="5521668">*</span>&nbsp;<span class="op" id="5521670">(</span><span class="builtintype" id="5521671">int</span><span class="op" id="5521674">(</span><span class="ident" id="5521675"><a href="/compress/bzip2/bzip2.go.html#5521508">level</a></span><span class="op" id="5521680">)</span>&nbsp;<span class="op" id="5521682">-</span>&nbsp;<span class="string" id="5521684">&#39;0&#39;</span><span class="op" id="5521687">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521690">if</span>&nbsp;<span class="ident" id="5521693"><a href="/compress/bzip2/bzip2.go.html#5521224">bz2</a></span><span class="op" id="5521696">.</span><span class="ident" id="5521697">blockSize</span>&nbsp;<span class="op" id="5521707">&gt;</span>&nbsp;<span class="builtinfunc" id="5521709">len</span><span class="op" id="5521712">(</span><span class="ident" id="5521713"><a href="/compress/bzip2/bzip2.go.html#5521224">bz2</a></span><span class="op" id="5521716">.</span><span class="ident" id="5521717">tt</span><span class="op" id="5521719">)</span>&nbsp;<span class="op" id="5521721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521725"><a href="/compress/bzip2/bzip2.go.html#5521224">bz2</a></span><span class="op" id="5521728">.</span><span class="ident" id="5521729">tt</span>&nbsp;<span class="op" id="5521732">=</span>&nbsp;<span class="builtinfunc" id="5521734">make</span><span class="op" id="5521738">(</span><span class="op" id="5521739">[</span><span class="op" id="5521740">]</span><span class="builtintype" id="5521741">uint32</span><span class="op" id="5521747">,</span>&nbsp;<span class="ident" id="5521749"><a href="/compress/bzip2/bzip2.go.html#5521224">bz2</a></span><span class="op" id="5521752">.</span><span class="ident" id="5521753">blockSize</span><span class="op" id="5521762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521768">return</span>&nbsp;<span class="ident" id="5521775">nil</span><br>
<span class="lineno"></span><span class="op" id="5521779">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="5521782">func</span>&nbsp;<span class="op" id="5521787">(</span><span class="ident" id="5521788">bz2</span>&nbsp;<span class="op" id="5521792">*</span><span class="ident" id="5521793"><a href="/compress/bzip2/bzip2.go.html#5519912">reader</a></span><span class="op" id="5521799">)</span>&nbsp;<span class="ident" id="5521801">Read</span><span class="op" id="5521805">(</span><span class="ident" id="5521806">buf</span>&nbsp;<span class="op" id="5521810">[</span><span class="op" id="5521811">]</span><span class="builtintype" id="5521812">byte</span><span class="op" id="5521816">)</span>&nbsp;<span class="op" id="5521818">(</span><span class="ident" id="5521819">n</span>&nbsp;<span class="builtintype" id="5521821">int</span><span class="op" id="5521824">,</span>&nbsp;<span class="ident" id="5521826">err</span>&nbsp;<span class="builtintype" id="5521830">error</span><span class="op" id="5521835">)</span>&nbsp;<span class="op" id="5521837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521840">if</span>&nbsp;<span class="ident" id="5521843"><a href="/compress/bzip2/bzip2.go.html#5521788">bz2</a></span><span class="op" id="5521846">.</span><span class="ident" id="5521847">eof</span>&nbsp;<span class="op" id="5521851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521855">return</span>&nbsp;<span class="num" id="5521862">0</span><span class="op" id="5521863">,</span>&nbsp;<span class="ident" id="5521865"><a href="/compress/bzip2/bzip2.go.html#5519408">io</a></span><span class="op" id="5521867">.</span><span class="ident" id="5521868">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521873">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521877">if</span>&nbsp;<span class="op" id="5521880">!</span><span class="ident" id="5521881"><a href="/compress/bzip2/bzip2.go.html#5521788">bz2</a></span><span class="op" id="5521884">.</span><span class="ident" id="5521885">setupDone</span>&nbsp;<span class="op" id="5521895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521899"><a href="/compress/bzip2/bzip2.go.html#5521826">err</a></span>&nbsp;<span class="op" id="5521903">=</span>&nbsp;<span class="ident" id="5521905"><a href="/compress/bzip2/bzip2.go.html#5521788">bz2</a></span><span class="op" id="5521908">.</span><span class="ident" id="5521909">setup</span><span class="op" id="5521914">(</span><span class="ident" id="5521915">true</span><span class="op" id="5521919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521923">brErr</span>&nbsp;<span class="op" id="5521929">:=</span>&nbsp;<span class="ident" id="5521932"><a href="/compress/bzip2/bzip2.go.html#5521788">bz2</a></span><span class="op" id="5521935">.</span><span class="ident" id="5521936">br</span><span class="op" id="5521938">.</span><span class="ident" id="5521939">Err</span><span class="op" id="5521942">(</span><span class="op" id="5521943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521947">if</span>&nbsp;<span class="ident" id="5521950"><a href="/compress/bzip2/bzip2.go.html#5521923">brErr</a></span>&nbsp;<span class="op" id="5521956">!=</span>&nbsp;<span class="ident" id="5521959">nil</span>&nbsp;<span class="op" id="5521963">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521968"><a href="/compress/bzip2/bzip2.go.html#5521826">err</a></span>&nbsp;<span class="op" id="5521972">=</span>&nbsp;<span class="ident" id="5521974"><a href="/compress/bzip2/bzip2.go.html#5521923">brErr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521986">if</span>&nbsp;<span class="ident" id="5521989"><a href="/compress/bzip2/bzip2.go.html#5521826">err</a></span>&nbsp;<span class="op" id="5521993">!=</span>&nbsp;<span class="ident" id="5521996">nil</span>&nbsp;<span class="op" id="5522000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522005">return</span>&nbsp;<span class="num" id="5522012">0</span><span class="op" id="5522013">,</span>&nbsp;<span class="ident" id="5522015"><a href="/compress/bzip2/bzip2.go.html#5521826">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522021">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522025"><a href="/compress/bzip2/bzip2.go.html#5521788">bz2</a></span><span class="op" id="5522028">.</span><span class="ident" id="5522029">setupDone</span>&nbsp;<span class="op" id="5522039">=</span>&nbsp;<span class="ident" id="5522041">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522051"><a href="/compress/bzip2/bzip2.go.html#5521819">n</a></span><span class="op" id="5522052">,</span>&nbsp;<span class="ident" id="5522054"><a href="/compress/bzip2/bzip2.go.html#5521826">err</a></span>&nbsp;<span class="op" id="5522058">=</span>&nbsp;<span class="ident" id="5522060"><a href="/compress/bzip2/bzip2.go.html#5521788">bz2</a></span><span class="op" id="5522063">.</span><span class="ident" id="5522064">read</span><span class="op" id="5522068">(</span><span class="ident" id="5522069"><a href="/compress/bzip2/bzip2.go.html#5521806">buf</a></span><span class="op" id="5522072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522075">brErr</span>&nbsp;<span class="op" id="5522081">:=</span>&nbsp;<span class="ident" id="5522084"><a href="/compress/bzip2/bzip2.go.html#5521788">bz2</a></span><span class="op" id="5522087">.</span><span class="ident" id="5522088">br</span><span class="op" id="5522090">.</span><span class="ident" id="5522091">Err</span><span class="op" id="5522094">(</span><span class="op" id="5522095">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522098">if</span>&nbsp;<span class="ident" id="5522101"><a href="/compress/bzip2/bzip2.go.html#5522075">brErr</a></span>&nbsp;<span class="op" id="5522107">!=</span>&nbsp;<span class="ident" id="5522110">nil</span>&nbsp;<span class="op" id="5522114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522118"><a href="/compress/bzip2/bzip2.go.html#5521826">err</a></span>&nbsp;<span class="op" id="5522122">=</span>&nbsp;<span class="ident" id="5522124"><a href="/compress/bzip2/bzip2.go.html#5522075">brErr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522134">return</span><br>
<span class="lineno"></span><span class="op" id="5522141">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="5522144">func</span>&nbsp;<span class="op" id="5522149">(</span><span class="ident" id="5522150">bz2</span>&nbsp;<span class="op" id="5522154">*</span><span class="ident" id="5522155"><a href="/compress/bzip2/bzip2.go.html#5519912">reader</a></span><span class="op" id="5522161">)</span>&nbsp;<span class="ident" id="5522163">readFromBlock</span><span class="op" id="5522176">(</span><span class="ident" id="5522177">buf</span>&nbsp;<span class="op" id="5522181">[</span><span class="op" id="5522182">]</span><span class="builtintype" id="5522183">byte</span><span class="op" id="5522187">)</span>&nbsp;<span class="builtintype" id="5522189">int</span>&nbsp;<span class="op" id="5522193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522196">//&nbsp;bzip2&nbsp;is&nbsp;a&nbsp;block&nbsp;based&nbsp;compressor,&nbsp;except&nbsp;that&nbsp;it&nbsp;has&nbsp;a&nbsp;run-length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522267">//&nbsp;preprocessing&nbsp;step.&nbsp;The&nbsp;block&nbsp;based&nbsp;nature&nbsp;means&nbsp;that&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522332">//&nbsp;preallocate&nbsp;fixed-size&nbsp;buffers&nbsp;and&nbsp;reuse&nbsp;them.&nbsp;However,&nbsp;the&nbsp;RLE</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522400">//&nbsp;preprocessing&nbsp;would&nbsp;require&nbsp;allocating&nbsp;huge&nbsp;buffers&nbsp;to&nbsp;store&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522469">//&nbsp;maximum&nbsp;expansion.&nbsp;Thus&nbsp;we&nbsp;process&nbsp;blocks&nbsp;all&nbsp;at&nbsp;once,&nbsp;except&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522539">//&nbsp;the&nbsp;RLE&nbsp;which&nbsp;we&nbsp;decompress&nbsp;as&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522584">n</span>&nbsp;<span class="op" id="5522586">:=</span>&nbsp;<span class="num" id="5522589">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522592">for</span>&nbsp;<span class="op" id="5522596">(</span><span class="ident" id="5522597"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5522600">.</span><span class="ident" id="5522601">repeats</span>&nbsp;<span class="op" id="5522609">&gt;</span>&nbsp;<span class="num" id="5522611">0</span>&nbsp;<span class="op" id="5522613">||</span>&nbsp;<span class="ident" id="5522616"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5522619">.</span><span class="ident" id="5522620">preRLEUsed</span>&nbsp;<span class="op" id="5522631">&lt;</span>&nbsp;<span class="builtinfunc" id="5522633">len</span><span class="op" id="5522636">(</span><span class="ident" id="5522637"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5522640">.</span><span class="ident" id="5522641">preRLE</span><span class="op" id="5522647">)</span><span class="op" id="5522648">)</span>&nbsp;<span class="op" id="5522650">&amp;&amp;</span>&nbsp;<span class="ident" id="5522653"><a href="/compress/bzip2/bzip2.go.html#5522584">n</a></span>&nbsp;<span class="op" id="5522655">&lt;</span>&nbsp;<span class="builtinfunc" id="5522657">len</span><span class="op" id="5522660">(</span><span class="ident" id="5522661"><a href="/compress/bzip2/bzip2.go.html#5522177">buf</a></span><span class="op" id="5522664">)</span>&nbsp;<span class="op" id="5522666">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522670">//&nbsp;We&nbsp;have&nbsp;RLE&nbsp;data&nbsp;pending.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522702">//&nbsp;The&nbsp;run-length&nbsp;encoding&nbsp;works&nbsp;like&nbsp;this:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522748">//&nbsp;Any&nbsp;sequence&nbsp;of&nbsp;four&nbsp;equal&nbsp;bytes&nbsp;is&nbsp;followed&nbsp;by&nbsp;a&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522810">//&nbsp;byte&nbsp;which&nbsp;contains&nbsp;the&nbsp;number&nbsp;of&nbsp;repeats&nbsp;of&nbsp;that&nbsp;byte&nbsp;to</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522873">//&nbsp;include.&nbsp;(The&nbsp;number&nbsp;of&nbsp;repeats&nbsp;can&nbsp;be&nbsp;zero.)&nbsp;Because&nbsp;we&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522939">//&nbsp;decompressing&nbsp;on-demand&nbsp;our&nbsp;state&nbsp;is&nbsp;kept&nbsp;in&nbsp;the&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5523000">//&nbsp;object.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523014">if</span>&nbsp;<span class="ident" id="5523017"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5523020">.</span><span class="ident" id="5523021">repeats</span>&nbsp;<span class="op" id="5523029">&gt;</span>&nbsp;<span class="num" id="5523031">0</span>&nbsp;<span class="op" id="5523033">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523038"><a href="/compress/bzip2/bzip2.go.html#5522177">buf</a></span><span class="op" id="5523041">[</span><span class="ident" id="5523042"><a href="/compress/bzip2/bzip2.go.html#5522584">n</a></span><span class="op" id="5523043">]</span>&nbsp;<span class="op" id="5523045">=</span>&nbsp;<span class="builtintype" id="5523047">byte</span><span class="op" id="5523051">(</span><span class="ident" id="5523052"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5523055">.</span><span class="ident" id="5523056">lastByte</span><span class="op" id="5523064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523069"><a href="/compress/bzip2/bzip2.go.html#5522584">n</a></span><span class="op" id="5523070">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523076"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5523079">.</span><span class="ident" id="5523080">repeats</span><span class="op" id="5523087">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523093">if</span>&nbsp;<span class="ident" id="5523096"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5523099">.</span><span class="ident" id="5523100">repeats</span>&nbsp;<span class="op" id="5523108">==</span>&nbsp;<span class="num" id="5523111">0</span>&nbsp;<span class="op" id="5523113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523119"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5523122">.</span><span class="ident" id="5523123">lastByte</span>&nbsp;<span class="op" id="5523132">=</span>&nbsp;<span class="op" id="5523134">-</span><span class="num" id="5523135">1</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523145">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523161"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5523164">.</span><span class="ident" id="5523165">tPos</span>&nbsp;<span class="op" id="5523170">=</span>&nbsp;<span class="ident" id="5523172"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5523175">.</span><span class="ident" id="5523176">preRLE</span><span class="op" id="5523182">[</span><span class="ident" id="5523183"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5523186">.</span><span class="ident" id="5523187">tPos</span><span class="op" id="5523191">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523195">b</span>&nbsp;<span class="op" id="5523197">:=</span>&nbsp;<span class="builtintype" id="5523200">byte</span><span class="op" id="5523204">(</span><span class="ident" id="5523205"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5523208">.</span><span class="ident" id="5523209">tPos</span><span class="op" id="5523213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523217"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5523220">.</span><span class="ident" id="5523221">tPos</span>&nbsp;<span class="op" id="5523226">&gt;&gt;=</span>&nbsp;<span class="num" id="5523230">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523234"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5523237">.</span><span class="ident" id="5523238">preRLEUsed</span><span class="op" id="5523248">++</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523254">if</span>&nbsp;<span class="ident" id="5523257"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5523260">.</span><span class="ident" id="5523261">byteRepeats</span>&nbsp;<span class="op" id="5523273">==</span>&nbsp;<span class="num" id="5523276">3</span>&nbsp;<span class="op" id="5523278">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523283"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5523286">.</span><span class="ident" id="5523287">repeats</span>&nbsp;<span class="op" id="5523295">=</span>&nbsp;<span class="builtintype" id="5523297">uint</span><span class="op" id="5523301">(</span><span class="ident" id="5523302"><a href="/compress/bzip2/bzip2.go.html#5523195">b</a></span><span class="op" id="5523303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523308"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5523311">.</span><span class="ident" id="5523312">byteRepeats</span>&nbsp;<span class="op" id="5523324">=</span>&nbsp;<span class="num" id="5523326">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523331">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523347">if</span>&nbsp;<span class="ident" id="5523350"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5523353">.</span><span class="ident" id="5523354">lastByte</span>&nbsp;<span class="op" id="5523363">==</span>&nbsp;<span class="builtintype" id="5523366">int</span><span class="op" id="5523369">(</span><span class="ident" id="5523370"><a href="/compress/bzip2/bzip2.go.html#5523195">b</a></span><span class="op" id="5523371">)</span>&nbsp;<span class="op" id="5523373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523378"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5523381">.</span><span class="ident" id="5523382">byteRepeats</span><span class="op" id="5523393">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523398">}</span>&nbsp;<span class="keyword" id="5523400">else</span>&nbsp;<span class="op" id="5523405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523410"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5523413">.</span><span class="ident" id="5523414">byteRepeats</span>&nbsp;<span class="op" id="5523426">=</span>&nbsp;<span class="num" id="5523428">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523432">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523436"><a href="/compress/bzip2/bzip2.go.html#5522150">bz2</a></span><span class="op" id="5523439">.</span><span class="ident" id="5523440">lastByte</span>&nbsp;<span class="op" id="5523449">=</span>&nbsp;<span class="builtintype" id="5523451">int</span><span class="op" id="5523454">(</span><span class="ident" id="5523455"><a href="/compress/bzip2/bzip2.go.html#5523195">b</a></span><span class="op" id="5523456">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523461"><a href="/compress/bzip2/bzip2.go.html#5522177">buf</a></span><span class="op" id="5523464">[</span><span class="ident" id="5523465"><a href="/compress/bzip2/bzip2.go.html#5522584">n</a></span><span class="op" id="5523466">]</span>&nbsp;<span class="op" id="5523468">=</span>&nbsp;<span class="ident" id="5523470"><a href="/compress/bzip2/bzip2.go.html#5523195">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523474"><a href="/compress/bzip2/bzip2.go.html#5522584">n</a></span><span class="op" id="5523475">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523479">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523483">return</span>&nbsp;<span class="ident" id="5523490"><a href="/compress/bzip2/bzip2.go.html#5522584">n</a></span><br>
<span class="lineno"></span><span class="op" id="5523492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5523495">func</span>&nbsp;<span class="op" id="5523500">(</span><span class="ident" id="5523501">bz2</span>&nbsp;<span class="op" id="5523505">*</span><span class="ident" id="5523506"><a href="/compress/bzip2/bzip2.go.html#5519912">reader</a></span><span class="op" id="5523512">)</span>&nbsp;<span class="ident" id="5523514">read</span><span class="op" id="5523518">(</span><span class="ident" id="5523519">buf</span>&nbsp;<span class="op" id="5523523">[</span><span class="op" id="5523524">]</span><span class="builtintype" id="5523525">byte</span><span class="op" id="5523529">)</span>&nbsp;<span class="op" id="5523531">(</span><span class="builtintype" id="5523532">int</span><span class="op" id="5523535">,</span>&nbsp;<span class="builtintype" id="5523537">error</span><span class="op" id="5523542">)</span>&nbsp;<span class="op" id="5523544">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523547">for</span>&nbsp;<span class="op" id="5523551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523555">n</span>&nbsp;<span class="op" id="5523557">:=</span>&nbsp;<span class="ident" id="5523560"><a href="/compress/bzip2/bzip2.go.html#5523501">bz2</a></span><span class="op" id="5523563">.</span><span class="ident" id="5523564">readFromBlock</span><span class="op" id="5523577">(</span><span class="ident" id="5523578"><a href="/compress/bzip2/bzip2.go.html#5523519">buf</a></span><span class="op" id="5523581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523585">if</span>&nbsp;<span class="ident" id="5523588"><a href="/compress/bzip2/bzip2.go.html#5523555">n</a></span>&nbsp;<span class="op" id="5523590">&gt;</span>&nbsp;<span class="num" id="5523592">0</span>&nbsp;<span class="op" id="5523594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523599"><a href="/compress/bzip2/bzip2.go.html#5523501">bz2</a></span><span class="op" id="5523602">.</span><span class="ident" id="5523603">blockCRC</span>&nbsp;<span class="op" id="5523612">=</span>&nbsp;<span class="ident" id="5523614"><a href="/compress/bzip2/bzip2.go.html#5532426">updateCRC</a></span><span class="op" id="5523623">(</span><span class="ident" id="5523624"><a href="/compress/bzip2/bzip2.go.html#5523501">bz2</a></span><span class="op" id="5523627">.</span><span class="ident" id="5523628">blockCRC</span><span class="op" id="5523636">,</span>&nbsp;<span class="ident" id="5523638"><a href="/compress/bzip2/bzip2.go.html#5523519">buf</a></span><span class="op" id="5523641">[</span><span class="op" id="5523642">:</span><span class="ident" id="5523643"><a href="/compress/bzip2/bzip2.go.html#5523555">n</a></span><span class="op" id="5523644">]</span><span class="op" id="5523645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523650">return</span>&nbsp;<span class="ident" id="5523657"><a href="/compress/bzip2/bzip2.go.html#5523555">n</a></span><span class="op" id="5523658">,</span>&nbsp;<span class="ident" id="5523660">nil</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5523671">//&nbsp;End&nbsp;of&nbsp;block.&nbsp;Check&nbsp;CRC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523701">if</span>&nbsp;<span class="ident" id="5523704"><a href="/compress/bzip2/bzip2.go.html#5523501">bz2</a></span><span class="op" id="5523707">.</span><span class="ident" id="5523708">blockCRC</span>&nbsp;<span class="op" id="5523717">!=</span>&nbsp;<span class="ident" id="5523720"><a href="/compress/bzip2/bzip2.go.html#5523501">bz2</a></span><span class="op" id="5523723">.</span><span class="ident" id="5523724">wantBlockCRC</span>&nbsp;<span class="op" id="5523737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523742"><a href="/compress/bzip2/bzip2.go.html#5523501">bz2</a></span><span class="op" id="5523745">.</span><span class="ident" id="5523746">br</span><span class="op" id="5523748">.</span><span class="ident" id="5523749">err</span>&nbsp;<span class="op" id="5523753">=</span>&nbsp;<span class="ident" id="5523755"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5523770">(</span><span class="string" id="5523771">&#34;block&nbsp;checksum&nbsp;mismatch&#34;</span><span class="op" id="5523796">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523801">return</span>&nbsp;<span class="num" id="5523808">0</span><span class="op" id="5523809">,</span>&nbsp;<span class="ident" id="5523811"><a href="/compress/bzip2/bzip2.go.html#5523501">bz2</a></span><span class="op" id="5523814">.</span><span class="ident" id="5523815">br</span><span class="op" id="5523817">.</span><span class="ident" id="5523818">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5523829">//&nbsp;Find&nbsp;next&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523851">br</span>&nbsp;<span class="op" id="5523854">:=</span>&nbsp;<span class="op" id="5523857">&amp;</span><span class="ident" id="5523858"><a href="/compress/bzip2/bzip2.go.html#5523501">bz2</a></span><span class="op" id="5523861">.</span><span class="ident" id="5523862">br</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523867">switch</span>&nbsp;<span class="ident" id="5523874"><a href="/compress/bzip2/bzip2.go.html#5523851">br</a></span><span class="op" id="5523876">.</span><span class="ident" id="5523877">ReadBits64</span><span class="op" id="5523887">(</span><span class="num" id="5523888">48</span><span class="op" id="5523890">)</span>&nbsp;<span class="op" id="5523892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523896">default</span><span class="op" id="5523903">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523908">return</span>&nbsp;<span class="num" id="5523915">0</span><span class="op" id="5523916">,</span>&nbsp;<span class="ident" id="5523918"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5523933">(</span><span class="string" id="5523934">&#34;bad&nbsp;magic&nbsp;value&nbsp;found&#34;</span><span class="op" id="5523957">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523962">case</span>&nbsp;<span class="ident" id="5523967"><a href="/compress/bzip2/bzip2.go.html#5521111">bzip2BlockMagic</a></span><span class="op" id="5523982">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5523987">//&nbsp;Start&nbsp;of&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524009">err</span>&nbsp;<span class="op" id="5524013">:=</span>&nbsp;<span class="ident" id="5524016"><a href="/compress/bzip2/bzip2.go.html#5523501">bz2</a></span><span class="op" id="5524019">.</span><span class="ident" id="5524020">readBlock</span><span class="op" id="5524029">(</span><span class="op" id="5524030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524035">if</span>&nbsp;<span class="ident" id="5524038"><a href="/compress/bzip2/bzip2.go.html#5524009">err</a></span>&nbsp;<span class="op" id="5524042">!=</span>&nbsp;<span class="ident" id="5524045">nil</span>&nbsp;<span class="op" id="5524049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524055">return</span>&nbsp;<span class="num" id="5524062">0</span><span class="op" id="5524063">,</span>&nbsp;<span class="ident" id="5524065"><a href="/compress/bzip2/bzip2.go.html#5524009">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524072">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524077">case</span>&nbsp;<span class="ident" id="5524082"><a href="/compress/bzip2/bzip2.go.html#5521150">bzip2FinalMagic</a></span><span class="op" id="5524097">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5524102">//&nbsp;Check&nbsp;end-of-file&nbsp;CRC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524131">wantFileCRC</span>&nbsp;<span class="op" id="5524143">:=</span>&nbsp;<span class="builtintype" id="5524146">uint32</span><span class="op" id="5524152">(</span><span class="ident" id="5524153"><a href="/compress/bzip2/bzip2.go.html#5523851">br</a></span><span class="op" id="5524155">.</span><span class="ident" id="5524156">ReadBits64</span><span class="op" id="5524166">(</span><span class="num" id="5524167">32</span><span class="op" id="5524169">)</span><span class="op" id="5524170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524175">if</span>&nbsp;<span class="ident" id="5524178"><a href="/compress/bzip2/bzip2.go.html#5523851">br</a></span><span class="op" id="5524180">.</span><span class="ident" id="5524181">err</span>&nbsp;<span class="op" id="5524185">!=</span>&nbsp;<span class="ident" id="5524188">nil</span>&nbsp;<span class="op" id="5524192">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524198">return</span>&nbsp;<span class="num" id="5524205">0</span><span class="op" id="5524206">,</span>&nbsp;<span class="ident" id="5524208"><a href="/compress/bzip2/bzip2.go.html#5523851">br</a></span><span class="op" id="5524210">.</span><span class="ident" id="5524211">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524223">if</span>&nbsp;<span class="ident" id="5524226"><a href="/compress/bzip2/bzip2.go.html#5523501">bz2</a></span><span class="op" id="5524229">.</span><span class="ident" id="5524230">fileCRC</span>&nbsp;<span class="op" id="5524238">!=</span>&nbsp;<span class="ident" id="5524241"><a href="/compress/bzip2/bzip2.go.html#5524131">wantFileCRC</a></span>&nbsp;<span class="op" id="5524253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524259"><a href="/compress/bzip2/bzip2.go.html#5523851">br</a></span><span class="op" id="5524261">.</span><span class="ident" id="5524262">err</span>&nbsp;<span class="op" id="5524266">=</span>&nbsp;<span class="ident" id="5524268"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5524283">(</span><span class="string" id="5524284">&#34;file&nbsp;checksum&nbsp;mismatch&#34;</span><span class="op" id="5524308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524314">return</span>&nbsp;<span class="num" id="5524321">0</span><span class="op" id="5524322">,</span>&nbsp;<span class="ident" id="5524324"><a href="/compress/bzip2/bzip2.go.html#5523851">br</a></span><span class="op" id="5524326">.</span><span class="ident" id="5524327">err</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5524340">//&nbsp;Skip&nbsp;ahead&nbsp;to&nbsp;byte&nbsp;boundary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5524375">//&nbsp;Is&nbsp;there&nbsp;a&nbsp;file&nbsp;concatenated&nbsp;to&nbsp;this&nbsp;one?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5524423">//&nbsp;It&nbsp;would&nbsp;start&nbsp;with&nbsp;BZ.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524453">if</span>&nbsp;<span class="ident" id="5524456"><a href="/compress/bzip2/bzip2.go.html#5523851">br</a></span><span class="op" id="5524458">.</span><span class="ident" id="5524459">bits</span><span class="op" id="5524463">%</span><span class="num" id="5524464">8</span>&nbsp;<span class="op" id="5524466">!=</span>&nbsp;<span class="num" id="5524469">0</span>&nbsp;<span class="op" id="5524471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524477"><a href="/compress/bzip2/bzip2.go.html#5523851">br</a></span><span class="op" id="5524479">.</span><span class="ident" id="5524480">ReadBits</span><span class="op" id="5524488">(</span><span class="ident" id="5524489"><a href="/compress/bzip2/bzip2.go.html#5523851">br</a></span><span class="op" id="5524491">.</span><span class="ident" id="5524492">bits</span>&nbsp;<span class="op" id="5524497">%</span>&nbsp;<span class="num" id="5524499">8</span><span class="op" id="5524500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524510">b</span><span class="op" id="5524511">,</span>&nbsp;<span class="ident" id="5524513">err</span>&nbsp;<span class="op" id="5524517">:=</span>&nbsp;<span class="ident" id="5524520"><a href="/compress/bzip2/bzip2.go.html#5523851">br</a></span><span class="op" id="5524522">.</span><span class="ident" id="5524523">r</span><span class="op" id="5524524">.</span><span class="ident" id="5524525">ReadByte</span><span class="op" id="5524533">(</span><span class="op" id="5524534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524539">if</span>&nbsp;<span class="ident" id="5524542"><a href="/compress/bzip2/bzip2.go.html#5524513">err</a></span>&nbsp;<span class="op" id="5524546">==</span>&nbsp;<span class="ident" id="5524549"><a href="/compress/bzip2/bzip2.go.html#5519408">io</a></span><span class="op" id="5524551">.</span><span class="ident" id="5524552">EOF</span>&nbsp;<span class="op" id="5524556">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524562"><a href="/compress/bzip2/bzip2.go.html#5523851">br</a></span><span class="op" id="5524564">.</span><span class="ident" id="5524565">err</span>&nbsp;<span class="op" id="5524569">=</span>&nbsp;<span class="ident" id="5524571"><a href="/compress/bzip2/bzip2.go.html#5519408">io</a></span><span class="op" id="5524573">.</span><span class="ident" id="5524574">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524582"><a href="/compress/bzip2/bzip2.go.html#5523501">bz2</a></span><span class="op" id="5524585">.</span><span class="ident" id="5524586">eof</span>&nbsp;<span class="op" id="5524590">=</span>&nbsp;<span class="ident" id="5524592">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524601">return</span>&nbsp;<span class="num" id="5524608">0</span><span class="op" id="5524609">,</span>&nbsp;<span class="ident" id="5524611"><a href="/compress/bzip2/bzip2.go.html#5519408">io</a></span><span class="op" id="5524613">.</span><span class="ident" id="5524614">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524626">if</span>&nbsp;<span class="ident" id="5524629"><a href="/compress/bzip2/bzip2.go.html#5524513">err</a></span>&nbsp;<span class="op" id="5524633">!=</span>&nbsp;<span class="ident" id="5524636">nil</span>&nbsp;<span class="op" id="5524640">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524646"><a href="/compress/bzip2/bzip2.go.html#5523851">br</a></span><span class="op" id="5524648">.</span><span class="ident" id="5524649">err</span>&nbsp;<span class="op" id="5524653">=</span>&nbsp;<span class="ident" id="5524655"><a href="/compress/bzip2/bzip2.go.html#5524513">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524663">return</span>&nbsp;<span class="num" id="5524670">0</span><span class="op" id="5524671">,</span>&nbsp;<span class="ident" id="5524673"><a href="/compress/bzip2/bzip2.go.html#5524513">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524685">z</span><span class="op" id="5524686">,</span>&nbsp;<span class="ident" id="5524688"><a href="/compress/bzip2/bzip2.go.html#5524513">err</a></span>&nbsp;<span class="op" id="5524692">:=</span>&nbsp;<span class="ident" id="5524695"><a href="/compress/bzip2/bzip2.go.html#5523851">br</a></span><span class="op" id="5524697">.</span><span class="ident" id="5524698">r</span><span class="op" id="5524699">.</span><span class="ident" id="5524700">ReadByte</span><span class="op" id="5524708">(</span><span class="op" id="5524709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524714">if</span>&nbsp;<span class="ident" id="5524717"><a href="/compress/bzip2/bzip2.go.html#5524513">err</a></span>&nbsp;<span class="op" id="5524721">!=</span>&nbsp;<span class="ident" id="5524724">nil</span>&nbsp;<span class="op" id="5524728">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524734">if</span>&nbsp;<span class="ident" id="5524737"><a href="/compress/bzip2/bzip2.go.html#5524513">err</a></span>&nbsp;<span class="op" id="5524741">==</span>&nbsp;<span class="ident" id="5524744"><a href="/compress/bzip2/bzip2.go.html#5519408">io</a></span><span class="op" id="5524746">.</span><span class="ident" id="5524747">EOF</span>&nbsp;<span class="op" id="5524751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524758"><a href="/compress/bzip2/bzip2.go.html#5524513">err</a></span>&nbsp;<span class="op" id="5524762">=</span>&nbsp;<span class="ident" id="5524764"><a href="/compress/bzip2/bzip2.go.html#5519408">io</a></span><span class="op" id="5524766">.</span><span class="ident" id="5524767">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524794"><a href="/compress/bzip2/bzip2.go.html#5523851">br</a></span><span class="op" id="5524796">.</span><span class="ident" id="5524797">err</span>&nbsp;<span class="op" id="5524801">=</span>&nbsp;<span class="ident" id="5524803"><a href="/compress/bzip2/bzip2.go.html#5524513">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524811">return</span>&nbsp;<span class="num" id="5524818">0</span><span class="op" id="5524819">,</span>&nbsp;<span class="ident" id="5524821"><a href="/compress/bzip2/bzip2.go.html#5524513">err</a></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524833">if</span>&nbsp;<span class="ident" id="5524836"><a href="/compress/bzip2/bzip2.go.html#5524510">b</a></span>&nbsp;<span class="op" id="5524838">!=</span>&nbsp;<span class="string" id="5524841">&#39;B&#39;</span>&nbsp;<span class="op" id="5524845">||</span>&nbsp;<span class="ident" id="5524848"><a href="/compress/bzip2/bzip2.go.html#5524685">z</a></span>&nbsp;<span class="op" id="5524850">!=</span>&nbsp;<span class="string" id="5524853">&#39;Z&#39;</span>&nbsp;<span class="op" id="5524857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524863">return</span>&nbsp;<span class="num" id="5524870">0</span><span class="op" id="5524871">,</span>&nbsp;<span class="ident" id="5524873"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5524888">(</span><span class="string" id="5524889">&#34;bad&nbsp;magic&nbsp;value&nbsp;in&nbsp;continuation&nbsp;file&#34;</span><span class="op" id="5524927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524937">if</span>&nbsp;<span class="ident" id="5524940">err</span>&nbsp;<span class="op" id="5524944">:=</span>&nbsp;<span class="ident" id="5524947"><a href="/compress/bzip2/bzip2.go.html#5523501">bz2</a></span><span class="op" id="5524950">.</span><span class="ident" id="5524951">setup</span><span class="op" id="5524956">(</span><span class="ident" id="5524957">false</span><span class="op" id="5524962">)</span><span class="op" id="5524963">;</span>&nbsp;<span class="ident" id="5524965"><a href="/compress/bzip2/bzip2.go.html#5524940">err</a></span>&nbsp;<span class="op" id="5524969">!=</span>&nbsp;<span class="ident" id="5524972">nil</span>&nbsp;<span class="op" id="5524976">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524982">return</span>&nbsp;<span class="num" id="5524989">0</span><span class="op" id="5524990">,</span>&nbsp;<span class="ident" id="5524992"><a href="/compress/bzip2/bzip2.go.html#5524940">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5525003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5525006">}</span><br>
<span class="lineno"></span><span class="op" id="5525008">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="5525011">//&nbsp;readBlock&nbsp;reads&nbsp;a&nbsp;bzip2&nbsp;block.&nbsp;The&nbsp;magic&nbsp;number&nbsp;should&nbsp;already&nbsp;have&nbsp;been&nbsp;consumed.</span><br>
<span class="lineno"></span><span class="keyword" id="5525097">func</span>&nbsp;<span class="op" id="5525102">(</span><span class="ident" id="5525103">bz2</span>&nbsp;<span class="op" id="5525107">*</span><span class="ident" id="5525108"><a href="/compress/bzip2/bzip2.go.html#5519912">reader</a></span><span class="op" id="5525114">)</span>&nbsp;<span class="ident" id="5525116">readBlock</span><span class="op" id="5525125">(</span><span class="op" id="5525126">)</span>&nbsp;<span class="op" id="5525128">(</span><span class="ident" id="5525129">err</span>&nbsp;<span class="builtintype" id="5525133">error</span><span class="op" id="5525138">)</span>&nbsp;<span class="op" id="5525140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525143">br</span>&nbsp;<span class="op" id="5525146">:=</span>&nbsp;<span class="op" id="5525149">&amp;</span><span class="ident" id="5525150"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5525153">.</span><span class="ident" id="5525154">br</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525158"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5525161">.</span><span class="ident" id="5525162">wantBlockCRC</span>&nbsp;<span class="op" id="5525175">=</span>&nbsp;<span class="builtintype" id="5525177">uint32</span><span class="op" id="5525183">(</span><span class="ident" id="5525184"><a href="/compress/bzip2/bzip2.go.html#5525143">br</a></span><span class="op" id="5525186">.</span><span class="ident" id="5525187">ReadBits64</span><span class="op" id="5525197">(</span><span class="num" id="5525198">32</span><span class="op" id="5525200">)</span><span class="op" id="5525201">)</span>&nbsp;<span class="comment" id="5525203">//&nbsp;skip&nbsp;checksum.&nbsp;TODO:&nbsp;check&nbsp;it&nbsp;if&nbsp;we&nbsp;can&nbsp;figure&nbsp;out&nbsp;what&nbsp;it&nbsp;is.</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525270"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5525273">.</span><span class="ident" id="5525274">blockCRC</span>&nbsp;<span class="op" id="5525283">=</span>&nbsp;<span class="num" id="5525285">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525288"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5525291">.</span><span class="ident" id="5525292">fileCRC</span>&nbsp;<span class="op" id="5525300">=</span>&nbsp;<span class="op" id="5525302">(</span><span class="ident" id="5525303"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5525306">.</span><span class="ident" id="5525307">fileCRC</span><span class="op" id="5525314">&lt;&lt;</span><span class="num" id="5525316">1</span>&nbsp;<span class="op" id="5525318">|</span>&nbsp;<span class="ident" id="5525320"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5525323">.</span><span class="ident" id="5525324">fileCRC</span><span class="op" id="5525331">&gt;&gt;</span><span class="num" id="5525333">31</span><span class="op" id="5525335">)</span>&nbsp;<span class="op" id="5525337">^</span>&nbsp;<span class="ident" id="5525339"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5525342">.</span><span class="ident" id="5525343">wantBlockCRC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525357">randomized</span>&nbsp;<span class="op" id="5525368">:=</span>&nbsp;<span class="ident" id="5525371"><a href="/compress/bzip2/bzip2.go.html#5525143">br</a></span><span class="op" id="5525373">.</span><span class="ident" id="5525374">ReadBits</span><span class="op" id="5525382">(</span><span class="num" id="5525383">1</span><span class="op" id="5525384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525387">if</span>&nbsp;<span class="ident" id="5525390"><a href="/compress/bzip2/bzip2.go.html#5525357">randomized</a></span>&nbsp;<span class="op" id="5525401">!=</span>&nbsp;<span class="num" id="5525404">0</span>&nbsp;<span class="op" id="5525406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525410">return</span>&nbsp;<span class="ident" id="5525417"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5525432">(</span><span class="string" id="5525433">&#34;deprecated&nbsp;randomized&nbsp;files&#34;</span><span class="op" id="5525462">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5525465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525468">origPtr</span>&nbsp;<span class="op" id="5525476">:=</span>&nbsp;<span class="builtintype" id="5525479">uint</span><span class="op" id="5525483">(</span><span class="ident" id="5525484"><a href="/compress/bzip2/bzip2.go.html#5525143">br</a></span><span class="op" id="5525486">.</span><span class="ident" id="5525487">ReadBits</span><span class="op" id="5525495">(</span><span class="num" id="5525496">24</span><span class="op" id="5525498">)</span><span class="op" id="5525499">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5525503">//&nbsp;If&nbsp;not&nbsp;every&nbsp;byte&nbsp;value&nbsp;is&nbsp;used&nbsp;in&nbsp;the&nbsp;block&nbsp;(i.e.,&nbsp;it&#39;s&nbsp;text)&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5525575">//&nbsp;the&nbsp;symbol&nbsp;set&nbsp;is&nbsp;reduced.&nbsp;The&nbsp;symbols&nbsp;used&nbsp;are&nbsp;stored&nbsp;as&nbsp;a</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5525639">//&nbsp;two-level,&nbsp;16x16&nbsp;bitmap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525668">symbolRangeUsedBitmap</span>&nbsp;<span class="op" id="5525690">:=</span>&nbsp;<span class="ident" id="5525693"><a href="/compress/bzip2/bzip2.go.html#5525143">br</a></span><span class="op" id="5525695">.</span><span class="ident" id="5525696">ReadBits</span><span class="op" id="5525704">(</span><span class="num" id="5525705">16</span><span class="op" id="5525707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525710">symbolPresent</span>&nbsp;<span class="op" id="5525724">:=</span>&nbsp;<span class="builtinfunc" id="5525727">make</span><span class="op" id="5525731">(</span><span class="op" id="5525732">[</span><span class="op" id="5525733">]</span><span class="builtintype" id="5525734">bool</span><span class="op" id="5525738">,</span>&nbsp;<span class="num" id="5525740">256</span><span class="op" id="5525743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525746">numSymbols</span>&nbsp;<span class="op" id="5525757">:=</span>&nbsp;<span class="num" id="5525760">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525763">for</span>&nbsp;<span class="ident" id="5525767">symRange</span>&nbsp;<span class="op" id="5525776">:=</span>&nbsp;<span class="builtintype" id="5525779">uint</span><span class="op" id="5525783">(</span><span class="num" id="5525784">0</span><span class="op" id="5525785">)</span><span class="op" id="5525786">;</span>&nbsp;<span class="ident" id="5525788"><a href="/compress/bzip2/bzip2.go.html#5525767">symRange</a></span>&nbsp;<span class="op" id="5525797">&lt;</span>&nbsp;<span class="num" id="5525799">16</span><span class="op" id="5525801">;</span>&nbsp;<span class="ident" id="5525803"><a href="/compress/bzip2/bzip2.go.html#5525767">symRange</a></span><span class="op" id="5525811">++</span>&nbsp;<span class="op" id="5525814">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525818">if</span>&nbsp;<span class="ident" id="5525821"><a href="/compress/bzip2/bzip2.go.html#5525668">symbolRangeUsedBitmap</a></span><span class="op" id="5525842">&amp;</span><span class="op" id="5525843">(</span><span class="num" id="5525844">1</span><span class="op" id="5525845">&lt;&lt;</span><span class="op" id="5525847">(</span><span class="num" id="5525848">15</span><span class="op" id="5525850">-</span><span class="ident" id="5525851"><a href="/compress/bzip2/bzip2.go.html#5525767">symRange</a></span><span class="op" id="5525859">)</span><span class="op" id="5525860">)</span>&nbsp;<span class="op" id="5525862">!=</span>&nbsp;<span class="num" id="5525865">0</span>&nbsp;<span class="op" id="5525867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525872">bits</span>&nbsp;<span class="op" id="5525877">:=</span>&nbsp;<span class="ident" id="5525880"><a href="/compress/bzip2/bzip2.go.html#5525143">br</a></span><span class="op" id="5525882">.</span><span class="ident" id="5525883">ReadBits</span><span class="op" id="5525891">(</span><span class="num" id="5525892">16</span><span class="op" id="5525894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525899">for</span>&nbsp;<span class="ident" id="5525903">symbol</span>&nbsp;<span class="op" id="5525910">:=</span>&nbsp;<span class="builtintype" id="5525913">uint</span><span class="op" id="5525917">(</span><span class="num" id="5525918">0</span><span class="op" id="5525919">)</span><span class="op" id="5525920">;</span>&nbsp;<span class="ident" id="5525922"><a href="/compress/bzip2/bzip2.go.html#5525903">symbol</a></span>&nbsp;<span class="op" id="5525929">&lt;</span>&nbsp;<span class="num" id="5525931">16</span><span class="op" id="5525933">;</span>&nbsp;<span class="ident" id="5525935"><a href="/compress/bzip2/bzip2.go.html#5525903">symbol</a></span><span class="op" id="5525941">++</span>&nbsp;<span class="op" id="5525944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525950">if</span>&nbsp;<span class="ident" id="5525953"><a href="/compress/bzip2/bzip2.go.html#5525872">bits</a></span><span class="op" id="5525957">&amp;</span><span class="op" id="5525958">(</span><span class="num" id="5525959">1</span><span class="op" id="5525960">&lt;&lt;</span><span class="op" id="5525962">(</span><span class="num" id="5525963">15</span><span class="op" id="5525965">-</span><span class="ident" id="5525966"><a href="/compress/bzip2/bzip2.go.html#5525903">symbol</a></span><span class="op" id="5525972">)</span><span class="op" id="5525973">)</span>&nbsp;<span class="op" id="5525975">!=</span>&nbsp;<span class="num" id="5525978">0</span>&nbsp;<span class="op" id="5525980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525987"><a href="/compress/bzip2/bzip2.go.html#5525710">symbolPresent</a></span><span class="op" id="5526000">[</span><span class="num" id="5526001">16</span><span class="op" id="5526003">*</span><span class="ident" id="5526004"><a href="/compress/bzip2/bzip2.go.html#5525767">symRange</a></span><span class="op" id="5526012">+</span><span class="ident" id="5526013"><a href="/compress/bzip2/bzip2.go.html#5525903">symbol</a></span><span class="op" id="5526019">]</span>&nbsp;<span class="op" id="5526021">=</span>&nbsp;<span class="ident" id="5526023">true</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526033"><a href="/compress/bzip2/bzip2.go.html#5525746">numSymbols</a></span><span class="op" id="5526043">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5526050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5526055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5526059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5526062">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526066">if</span>&nbsp;<span class="ident" id="5526069"><a href="/compress/bzip2/bzip2.go.html#5525746">numSymbols</a></span>&nbsp;<span class="op" id="5526080">==</span>&nbsp;<span class="num" id="5526083">0</span>&nbsp;<span class="op" id="5526085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5526089">//&nbsp;There&nbsp;must&nbsp;be&nbsp;an&nbsp;EOF&nbsp;symbol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526123">return</span>&nbsp;<span class="ident" id="5526130"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5526145">(</span><span class="string" id="5526146">&#34;no&nbsp;symbols&nbsp;in&nbsp;input&#34;</span><span class="op" id="5526167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5526170">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5526174">//&nbsp;A&nbsp;block&nbsp;uses&nbsp;between&nbsp;two&nbsp;and&nbsp;six&nbsp;different&nbsp;Huffman&nbsp;trees.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526236">numHuffmanTrees</span>&nbsp;<span class="op" id="5526252">:=</span>&nbsp;<span class="ident" id="5526255"><a href="/compress/bzip2/bzip2.go.html#5525143">br</a></span><span class="op" id="5526257">.</span><span class="ident" id="5526258">ReadBits</span><span class="op" id="5526266">(</span><span class="num" id="5526267">3</span><span class="op" id="5526268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526271">if</span>&nbsp;<span class="ident" id="5526274"><a href="/compress/bzip2/bzip2.go.html#5526236">numHuffmanTrees</a></span>&nbsp;<span class="op" id="5526290">&lt;</span>&nbsp;<span class="num" id="5526292">2</span>&nbsp;<span class="op" id="5526294">||</span>&nbsp;<span class="ident" id="5526297"><a href="/compress/bzip2/bzip2.go.html#5526236">numHuffmanTrees</a></span>&nbsp;<span class="op" id="5526313">&gt;</span>&nbsp;<span class="num" id="5526315">6</span>&nbsp;<span class="op" id="5526317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526321">return</span>&nbsp;<span class="ident" id="5526328"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5526343">(</span><span class="string" id="5526344">&#34;invalid&nbsp;number&nbsp;of&nbsp;Huffman&nbsp;trees&#34;</span><span class="op" id="5526377">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5526380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5526384">//&nbsp;The&nbsp;Huffman&nbsp;tree&nbsp;can&nbsp;switch&nbsp;every&nbsp;50&nbsp;symbols&nbsp;so&nbsp;there&#39;s&nbsp;a&nbsp;list&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5526454">//&nbsp;tree&nbsp;indexes&nbsp;telling&nbsp;us&nbsp;which&nbsp;tree&nbsp;to&nbsp;use&nbsp;for&nbsp;each&nbsp;50&nbsp;symbol&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526526">numSelectors</span>&nbsp;<span class="op" id="5526539">:=</span>&nbsp;<span class="ident" id="5526542"><a href="/compress/bzip2/bzip2.go.html#5525143">br</a></span><span class="op" id="5526544">.</span><span class="ident" id="5526545">ReadBits</span><span class="op" id="5526553">(</span><span class="num" id="5526554">15</span><span class="op" id="5526556">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526559">treeIndexes</span>&nbsp;<span class="op" id="5526571">:=</span>&nbsp;<span class="builtinfunc" id="5526574">make</span><span class="op" id="5526578">(</span><span class="op" id="5526579">[</span><span class="op" id="5526580">]</span><span class="builtintype" id="5526581">uint8</span><span class="op" id="5526586">,</span>&nbsp;<span class="ident" id="5526588"><a href="/compress/bzip2/bzip2.go.html#5526526">numSelectors</a></span><span class="op" id="5526600">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5526604">//&nbsp;The&nbsp;tree&nbsp;indexes&nbsp;are&nbsp;move-to-front&nbsp;transformed&nbsp;and&nbsp;stored&nbsp;as&nbsp;unary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5526675">//&nbsp;numbers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526688">mtfTreeDecoder</span>&nbsp;<span class="op" id="5526703">:=</span>&nbsp;<span class="ident" id="5526706"><a href="/compress/bzip2/move_to_front.go.html#5540912">newMTFDecoderWithRange</a></span><span class="op" id="5526728">(</span><span class="ident" id="5526729"><a href="/compress/bzip2/bzip2.go.html#5526236">numHuffmanTrees</a></span><span class="op" id="5526744">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526747">for</span>&nbsp;<span class="ident" id="5526751">i</span>&nbsp;<span class="op" id="5526753">:=</span>&nbsp;<span class="keyword" id="5526756">range</span>&nbsp;<span class="ident" id="5526762"><a href="/compress/bzip2/bzip2.go.html#5526559">treeIndexes</a></span>&nbsp;<span class="op" id="5526774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526778">c</span>&nbsp;<span class="op" id="5526780">:=</span>&nbsp;<span class="num" id="5526783">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526787">for</span>&nbsp;<span class="op" id="5526791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526796">inc</span>&nbsp;<span class="op" id="5526800">:=</span>&nbsp;<span class="ident" id="5526803"><a href="/compress/bzip2/bzip2.go.html#5525143">br</a></span><span class="op" id="5526805">.</span><span class="ident" id="5526806">ReadBits</span><span class="op" id="5526814">(</span><span class="num" id="5526815">1</span><span class="op" id="5526816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526821">if</span>&nbsp;<span class="ident" id="5526824"><a href="/compress/bzip2/bzip2.go.html#5526796">inc</a></span>&nbsp;<span class="op" id="5526828">==</span>&nbsp;<span class="num" id="5526831">0</span>&nbsp;<span class="op" id="5526833">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526839">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5526848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526853"><a href="/compress/bzip2/bzip2.go.html#5526778">c</a></span><span class="op" id="5526854">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5526859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526863">if</span>&nbsp;<span class="ident" id="5526866"><a href="/compress/bzip2/bzip2.go.html#5526778">c</a></span>&nbsp;<span class="op" id="5526868">&gt;=</span>&nbsp;<span class="ident" id="5526871"><a href="/compress/bzip2/bzip2.go.html#5526236">numHuffmanTrees</a></span>&nbsp;<span class="op" id="5526887">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526892">return</span>&nbsp;<span class="ident" id="5526899"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5526914">(</span><span class="string" id="5526915">&#34;tree&nbsp;index&nbsp;too&nbsp;large&#34;</span><span class="op" id="5526937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5526941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526945"><a href="/compress/bzip2/bzip2.go.html#5526559">treeIndexes</a></span><span class="op" id="5526956">[</span><span class="ident" id="5526957"><a href="/compress/bzip2/bzip2.go.html#5526751">i</a></span><span class="op" id="5526958">]</span>&nbsp;<span class="op" id="5526960">=</span>&nbsp;<span class="builtintype" id="5526962">uint8</span><span class="op" id="5526967">(</span><span class="ident" id="5526968"><a href="/compress/bzip2/bzip2.go.html#5526688">mtfTreeDecoder</a></span><span class="op" id="5526982">.</span><span class="ident" id="5526983">Decode</span><span class="op" id="5526989">(</span><span class="ident" id="5526990"><a href="/compress/bzip2/bzip2.go.html#5526778">c</a></span><span class="op" id="5526991">)</span><span class="op" id="5526992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5526995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5526999">//&nbsp;The&nbsp;list&nbsp;of&nbsp;symbols&nbsp;for&nbsp;the&nbsp;move-to-front&nbsp;transform&nbsp;is&nbsp;taken&nbsp;from</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5527069">//&nbsp;the&nbsp;previously&nbsp;decoded&nbsp;symbol&nbsp;bitmap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527111">symbols</span>&nbsp;<span class="op" id="5527119">:=</span>&nbsp;<span class="builtinfunc" id="5527122">make</span><span class="op" id="5527126">(</span><span class="op" id="5527127">[</span><span class="op" id="5527128">]</span><span class="builtintype" id="5527129">byte</span><span class="op" id="5527133">,</span>&nbsp;<span class="ident" id="5527135"><a href="/compress/bzip2/bzip2.go.html#5525746">numSymbols</a></span><span class="op" id="5527145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527148">nextSymbol</span>&nbsp;<span class="op" id="5527159">:=</span>&nbsp;<span class="num" id="5527162">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527165">for</span>&nbsp;<span class="ident" id="5527169">i</span>&nbsp;<span class="op" id="5527171">:=</span>&nbsp;<span class="num" id="5527174">0</span><span class="op" id="5527175">;</span>&nbsp;<span class="ident" id="5527177"><a href="/compress/bzip2/bzip2.go.html#5527169">i</a></span>&nbsp;<span class="op" id="5527179">&lt;</span>&nbsp;<span class="num" id="5527181">256</span><span class="op" id="5527184">;</span>&nbsp;<span class="ident" id="5527186"><a href="/compress/bzip2/bzip2.go.html#5527169">i</a></span><span class="op" id="5527187">++</span>&nbsp;<span class="op" id="5527190">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527194">if</span>&nbsp;<span class="ident" id="5527197"><a href="/compress/bzip2/bzip2.go.html#5525710">symbolPresent</a></span><span class="op" id="5527210">[</span><span class="ident" id="5527211"><a href="/compress/bzip2/bzip2.go.html#5527169">i</a></span><span class="op" id="5527212">]</span>&nbsp;<span class="op" id="5527214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527219"><a href="/compress/bzip2/bzip2.go.html#5527111">symbols</a></span><span class="op" id="5527226">[</span><span class="ident" id="5527227"><a href="/compress/bzip2/bzip2.go.html#5527148">nextSymbol</a></span><span class="op" id="5527237">]</span>&nbsp;<span class="op" id="5527239">=</span>&nbsp;<span class="builtintype" id="5527241">byte</span><span class="op" id="5527245">(</span><span class="ident" id="5527246"><a href="/compress/bzip2/bzip2.go.html#5527169">i</a></span><span class="op" id="5527247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527252"><a href="/compress/bzip2/bzip2.go.html#5527148">nextSymbol</a></span><span class="op" id="5527262">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527270">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527273">mtf</span>&nbsp;<span class="op" id="5527277">:=</span>&nbsp;<span class="ident" id="5527280"><a href="/compress/bzip2/move_to_front.go.html#5540660">newMTFDecoder</a></span><span class="op" id="5527293">(</span><span class="ident" id="5527294"><a href="/compress/bzip2/bzip2.go.html#5527111">symbols</a></span><span class="op" id="5527301">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527305"><a href="/compress/bzip2/bzip2.go.html#5525746">numSymbols</a></span>&nbsp;<span class="op" id="5527316">+=</span>&nbsp;<span class="num" id="5527319">2</span>&nbsp;<span class="comment" id="5527321">//&nbsp;to&nbsp;account&nbsp;for&nbsp;RUNA&nbsp;and&nbsp;RUNB&nbsp;symbols</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527362">huffmanTrees</span>&nbsp;<span class="op" id="5527375">:=</span>&nbsp;<span class="builtinfunc" id="5527378">make</span><span class="op" id="5527382">(</span><span class="op" id="5527383">[</span><span class="op" id="5527384">]</span><span class="ident" id="5527385"><a href="/compress/bzip2/huffman.go.html#5532849">huffmanTree</a></span><span class="op" id="5527396">,</span>&nbsp;<span class="ident" id="5527398"><a href="/compress/bzip2/bzip2.go.html#5526236">numHuffmanTrees</a></span><span class="op" id="5527413">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5527417">//&nbsp;Now&nbsp;we&nbsp;decode&nbsp;the&nbsp;arrays&nbsp;of&nbsp;code-lengths&nbsp;for&nbsp;each&nbsp;tree.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527477">lengths</span>&nbsp;<span class="op" id="5527485">:=</span>&nbsp;<span class="builtinfunc" id="5527488">make</span><span class="op" id="5527492">(</span><span class="op" id="5527493">[</span><span class="op" id="5527494">]</span><span class="builtintype" id="5527495">uint8</span><span class="op" id="5527500">,</span>&nbsp;<span class="ident" id="5527502"><a href="/compress/bzip2/bzip2.go.html#5525746">numSymbols</a></span><span class="op" id="5527512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527515">for</span>&nbsp;<span class="ident" id="5527519">i</span>&nbsp;<span class="op" id="5527521">:=</span>&nbsp;<span class="keyword" id="5527524">range</span>&nbsp;<span class="ident" id="5527530"><a href="/compress/bzip2/bzip2.go.html#5527362">huffmanTrees</a></span>&nbsp;<span class="op" id="5527543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5527547">//&nbsp;The&nbsp;code&nbsp;lengths&nbsp;are&nbsp;delta&nbsp;encoded&nbsp;from&nbsp;a&nbsp;5-bit&nbsp;base&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527612">length</span>&nbsp;<span class="op" id="5527619">:=</span>&nbsp;<span class="ident" id="5527622"><a href="/compress/bzip2/bzip2.go.html#5525143">br</a></span><span class="op" id="5527624">.</span><span class="ident" id="5527625">ReadBits</span><span class="op" id="5527633">(</span><span class="num" id="5527634">5</span><span class="op" id="5527635">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527639">for</span>&nbsp;<span class="ident" id="5527643">j</span>&nbsp;<span class="op" id="5527645">:=</span>&nbsp;<span class="keyword" id="5527648">range</span>&nbsp;<span class="ident" id="5527654"><a href="/compress/bzip2/bzip2.go.html#5527477">lengths</a></span>&nbsp;<span class="op" id="5527662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527667">for</span>&nbsp;<span class="op" id="5527671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527677">if</span>&nbsp;<span class="op" id="5527680">!</span><span class="ident" id="5527681"><a href="/compress/bzip2/bzip2.go.html#5525143">br</a></span><span class="op" id="5527683">.</span><span class="ident" id="5527684">ReadBit</span><span class="op" id="5527691">(</span><span class="op" id="5527692">)</span>&nbsp;<span class="op" id="5527694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527701">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527711">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527717">if</span>&nbsp;<span class="ident" id="5527720"><a href="/compress/bzip2/bzip2.go.html#5525143">br</a></span><span class="op" id="5527722">.</span><span class="ident" id="5527723">ReadBit</span><span class="op" id="5527730">(</span><span class="op" id="5527731">)</span>&nbsp;<span class="op" id="5527733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527740"><a href="/compress/bzip2/bzip2.go.html#5527612">length</a></span><span class="op" id="5527746">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527753">}</span>&nbsp;<span class="keyword" id="5527755">else</span>&nbsp;<span class="op" id="5527760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527767"><a href="/compress/bzip2/bzip2.go.html#5527612">length</a></span><span class="op" id="5527773">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527780">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527790">if</span>&nbsp;<span class="ident" id="5527793"><a href="/compress/bzip2/bzip2.go.html#5527612">length</a></span>&nbsp;<span class="op" id="5527800">&lt;</span>&nbsp;<span class="num" id="5527802">0</span>&nbsp;<span class="op" id="5527804">||</span>&nbsp;<span class="ident" id="5527807"><a href="/compress/bzip2/bzip2.go.html#5527612">length</a></span>&nbsp;<span class="op" id="5527814">&gt;</span>&nbsp;<span class="num" id="5527816">20</span>&nbsp;<span class="op" id="5527819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527825">return</span>&nbsp;<span class="ident" id="5527832"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5527847">(</span><span class="string" id="5527848">&#34;Huffman&nbsp;length&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="5527877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527887"><a href="/compress/bzip2/bzip2.go.html#5527477">lengths</a></span><span class="op" id="5527894">[</span><span class="ident" id="5527895"><a href="/compress/bzip2/bzip2.go.html#5527643">j</a></span><span class="op" id="5527896">]</span>&nbsp;<span class="op" id="5527898">=</span>&nbsp;<span class="builtintype" id="5527900">uint8</span><span class="op" id="5527905">(</span><span class="ident" id="5527906"><a href="/compress/bzip2/bzip2.go.html#5527612">length</a></span><span class="op" id="5527912">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527920"><a href="/compress/bzip2/bzip2.go.html#5527362">huffmanTrees</a></span><span class="op" id="5527932">[</span><span class="ident" id="5527933"><a href="/compress/bzip2/bzip2.go.html#5527519">i</a></span><span class="op" id="5527934">]</span><span class="op" id="5527935">,</span>&nbsp;<span class="ident" id="5527937"><a href="/compress/bzip2/bzip2.go.html#5525129">err</a></span>&nbsp;<span class="op" id="5527941">=</span>&nbsp;<span class="ident" id="5527943"><a href="/compress/bzip2/huffman.go.html#5534491">newHuffmanTree</a></span><span class="op" id="5527957">(</span><span class="ident" id="5527958"><a href="/compress/bzip2/bzip2.go.html#5527477">lengths</a></span><span class="op" id="5527965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527969">if</span>&nbsp;<span class="ident" id="5527972"><a href="/compress/bzip2/bzip2.go.html#5525129">err</a></span>&nbsp;<span class="op" id="5527976">!=</span>&nbsp;<span class="ident" id="5527979">nil</span>&nbsp;<span class="op" id="5527983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527988">return</span>&nbsp;<span class="ident" id="5527995"><a href="/compress/bzip2/bzip2.go.html#5525129">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528001">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528008">selectorIndex</span>&nbsp;<span class="op" id="5528022">:=</span>&nbsp;<span class="num" id="5528025">1</span>&nbsp;<span class="comment" id="5528027">//&nbsp;the&nbsp;next&nbsp;tree&nbsp;index&nbsp;to&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528058">if</span>&nbsp;<span class="builtinfunc" id="5528061">len</span><span class="op" id="5528064">(</span><span class="ident" id="5528065"><a href="/compress/bzip2/bzip2.go.html#5526559">treeIndexes</a></span><span class="op" id="5528076">)</span>&nbsp;<span class="op" id="5528078">==</span>&nbsp;<span class="num" id="5528081">0</span>&nbsp;<span class="op" id="5528083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528087">return</span>&nbsp;<span class="ident" id="5528094"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5528109">(</span><span class="string" id="5528110">&#34;no&nbsp;tree&nbsp;selectors&nbsp;given&#34;</span><span class="op" id="5528135">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528141">if</span>&nbsp;<span class="builtintype" id="5528144">int</span><span class="op" id="5528147">(</span><span class="ident" id="5528148"><a href="/compress/bzip2/bzip2.go.html#5526559">treeIndexes</a></span><span class="op" id="5528159">[</span><span class="num" id="5528160">0</span><span class="op" id="5528161">]</span><span class="op" id="5528162">)</span>&nbsp;<span class="op" id="5528164">&gt;=</span>&nbsp;<span class="builtinfunc" id="5528167">len</span><span class="op" id="5528170">(</span><span class="ident" id="5528171"><a href="/compress/bzip2/bzip2.go.html#5527362">huffmanTrees</a></span><span class="op" id="5528183">)</span>&nbsp;<span class="op" id="5528185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528189">return</span>&nbsp;<span class="ident" id="5528196"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5528211">(</span><span class="string" id="5528212">&#34;tree&nbsp;selector&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="5528240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528246">currentHuffmanTree</span>&nbsp;<span class="op" id="5528265">:=</span>&nbsp;<span class="ident" id="5528268"><a href="/compress/bzip2/bzip2.go.html#5527362">huffmanTrees</a></span><span class="op" id="5528280">[</span><span class="ident" id="5528281"><a href="/compress/bzip2/bzip2.go.html#5526559">treeIndexes</a></span><span class="op" id="5528292">[</span><span class="num" id="5528293">0</span><span class="op" id="5528294">]</span><span class="op" id="5528295">]</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528298">bufIndex</span>&nbsp;<span class="op" id="5528307">:=</span>&nbsp;<span class="num" id="5528310">0</span>&nbsp;<span class="comment" id="5528312">//&nbsp;indexes&nbsp;bz2.buf,&nbsp;the&nbsp;output&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5528352">//&nbsp;The&nbsp;output&nbsp;of&nbsp;the&nbsp;move-to-front&nbsp;transform&nbsp;is&nbsp;run-length&nbsp;encoded&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5528424">//&nbsp;we&nbsp;merge&nbsp;the&nbsp;decoding&nbsp;into&nbsp;the&nbsp;Huffman&nbsp;parsing&nbsp;loop.&nbsp;These&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5528491">//&nbsp;variables&nbsp;accumulate&nbsp;the&nbsp;repeat&nbsp;count.&nbsp;See&nbsp;the&nbsp;Wikipedia&nbsp;page&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5528561">//&nbsp;details.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528574">repeat</span>&nbsp;<span class="op" id="5528581">:=</span>&nbsp;<span class="num" id="5528584">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528587">repeat_power</span>&nbsp;<span class="op" id="5528600">:=</span>&nbsp;<span class="num" id="5528603">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5528607">//&nbsp;The&nbsp;`C&#39;&nbsp;array&nbsp;(used&nbsp;by&nbsp;the&nbsp;inverse&nbsp;BWT)&nbsp;needs&nbsp;to&nbsp;be&nbsp;zero&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528681">for</span>&nbsp;<span class="ident" id="5528685">i</span>&nbsp;<span class="op" id="5528687">:=</span>&nbsp;<span class="keyword" id="5528690">range</span>&nbsp;<span class="ident" id="5528696"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5528699">.</span><span class="ident" id="5528700">c</span>&nbsp;<span class="op" id="5528702">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528706"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5528709">.</span><span class="ident" id="5528710">c</span><span class="op" id="5528711">[</span><span class="ident" id="5528712"><a href="/compress/bzip2/bzip2.go.html#5528685">i</a></span><span class="op" id="5528713">]</span>&nbsp;<span class="op" id="5528715">=</span>&nbsp;<span class="num" id="5528717">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528724">decoded</span>&nbsp;<span class="op" id="5528732">:=</span>&nbsp;<span class="num" id="5528735">0</span>&nbsp;<span class="comment" id="5528737">//&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;symbols&nbsp;decoded&nbsp;by&nbsp;the&nbsp;current&nbsp;tree.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528799">for</span>&nbsp;<span class="op" id="5528803">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528807">if</span>&nbsp;<span class="ident" id="5528810"><a href="/compress/bzip2/bzip2.go.html#5528724">decoded</a></span>&nbsp;<span class="op" id="5528818">==</span>&nbsp;<span class="num" id="5528821">50</span>&nbsp;<span class="op" id="5528824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528829">if</span>&nbsp;<span class="ident" id="5528832"><a href="/compress/bzip2/bzip2.go.html#5528008">selectorIndex</a></span>&nbsp;<span class="op" id="5528846">&gt;=</span>&nbsp;<span class="ident" id="5528849"><a href="/compress/bzip2/bzip2.go.html#5526526">numSelectors</a></span>&nbsp;<span class="op" id="5528862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528868">return</span>&nbsp;<span class="ident" id="5528875"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5528890">(</span><span class="string" id="5528891">&#34;insufficient&nbsp;selector&nbsp;indices&nbsp;for&nbsp;number&nbsp;of&nbsp;symbols&#34;</span><span class="op" id="5528944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528954">if</span>&nbsp;<span class="builtintype" id="5528957">int</span><span class="op" id="5528960">(</span><span class="ident" id="5528961"><a href="/compress/bzip2/bzip2.go.html#5526559">treeIndexes</a></span><span class="op" id="5528972">[</span><span class="ident" id="5528973"><a href="/compress/bzip2/bzip2.go.html#5528008">selectorIndex</a></span><span class="op" id="5528986">]</span><span class="op" id="5528987">)</span>&nbsp;<span class="op" id="5528989">&gt;=</span>&nbsp;<span class="builtinfunc" id="5528992">len</span><span class="op" id="5528995">(</span><span class="ident" id="5528996"><a href="/compress/bzip2/bzip2.go.html#5527362">huffmanTrees</a></span><span class="op" id="5529008">)</span>&nbsp;<span class="op" id="5529010">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529016">return</span>&nbsp;<span class="ident" id="5529023"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5529038">(</span><span class="string" id="5529039">&#34;tree&nbsp;selector&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="5529067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5529072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529077"><a href="/compress/bzip2/bzip2.go.html#5528246">currentHuffmanTree</a></span>&nbsp;<span class="op" id="5529096">=</span>&nbsp;<span class="ident" id="5529098"><a href="/compress/bzip2/bzip2.go.html#5527362">huffmanTrees</a></span><span class="op" id="5529110">[</span><span class="ident" id="5529111"><a href="/compress/bzip2/bzip2.go.html#5526559">treeIndexes</a></span><span class="op" id="5529122">[</span><span class="ident" id="5529123"><a href="/compress/bzip2/bzip2.go.html#5528008">selectorIndex</a></span><span class="op" id="5529136">]</span><span class="op" id="5529137">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529142"><a href="/compress/bzip2/bzip2.go.html#5528008">selectorIndex</a></span><span class="op" id="5529155">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529161"><a href="/compress/bzip2/bzip2.go.html#5528724">decoded</a></span>&nbsp;<span class="op" id="5529169">=</span>&nbsp;<span class="num" id="5529171">0</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5529175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529180">v</span>&nbsp;<span class="op" id="5529182">:=</span>&nbsp;<span class="ident" id="5529185"><a href="/compress/bzip2/bzip2.go.html#5528246">currentHuffmanTree</a></span><span class="op" id="5529203">.</span><span class="ident" id="5529204">Decode</span><span class="op" id="5529210">(</span><span class="ident" id="5529211"><a href="/compress/bzip2/bzip2.go.html#5525143">br</a></span><span class="op" id="5529213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529217"><a href="/compress/bzip2/bzip2.go.html#5528724">decoded</a></span><span class="op" id="5529224">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529230">if</span>&nbsp;<span class="ident" id="5529233"><a href="/compress/bzip2/bzip2.go.html#5529180">v</a></span>&nbsp;<span class="op" id="5529235">&lt;</span>&nbsp;<span class="num" id="5529237">2</span>&nbsp;<span class="op" id="5529239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5529244">//&nbsp;This&nbsp;is&nbsp;either&nbsp;the&nbsp;RUNA&nbsp;or&nbsp;RUNB&nbsp;symbol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529290">if</span>&nbsp;<span class="ident" id="5529293"><a href="/compress/bzip2/bzip2.go.html#5528574">repeat</a></span>&nbsp;<span class="op" id="5529300">==</span>&nbsp;<span class="num" id="5529303">0</span>&nbsp;<span class="op" id="5529305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529311"><a href="/compress/bzip2/bzip2.go.html#5528587">repeat_power</a></span>&nbsp;<span class="op" id="5529324">=</span>&nbsp;<span class="num" id="5529326">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5529331">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529336"><a href="/compress/bzip2/bzip2.go.html#5528574">repeat</a></span>&nbsp;<span class="op" id="5529343">+=</span>&nbsp;<span class="ident" id="5529346"><a href="/compress/bzip2/bzip2.go.html#5528587">repeat_power</a></span>&nbsp;<span class="op" id="5529359">&lt;&lt;</span>&nbsp;<span class="ident" id="5529362"><a href="/compress/bzip2/bzip2.go.html#5529180">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529367"><a href="/compress/bzip2/bzip2.go.html#5528587">repeat_power</a></span>&nbsp;<span class="op" id="5529380">&lt;&lt;=</span>&nbsp;<span class="num" id="5529384">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5529390">//&nbsp;This&nbsp;limit&nbsp;of&nbsp;2&nbsp;million&nbsp;comes&nbsp;from&nbsp;the&nbsp;bzip2&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5529448">//&nbsp;code.&nbsp;It&nbsp;prevents&nbsp;repeat&nbsp;from&nbsp;overflowing.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529497">if</span>&nbsp;<span class="ident" id="5529500"><a href="/compress/bzip2/bzip2.go.html#5528574">repeat</a></span>&nbsp;<span class="op" id="5529507">&gt;</span>&nbsp;<span class="num" id="5529509">2</span><span class="op" id="5529510">*</span><span class="num" id="5529511">1024</span><span class="op" id="5529515">*</span><span class="num" id="5529516">1024</span>&nbsp;<span class="op" id="5529521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529527">return</span>&nbsp;<span class="ident" id="5529534"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5529549">(</span><span class="string" id="5529550">&#34;repeat&nbsp;count&nbsp;too&nbsp;large&#34;</span><span class="op" id="5529574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5529579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529584">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5529595">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529600">if</span>&nbsp;<span class="ident" id="5529603"><a href="/compress/bzip2/bzip2.go.html#5528574">repeat</a></span>&nbsp;<span class="op" id="5529610">&gt;</span>&nbsp;<span class="num" id="5529612">0</span>&nbsp;<span class="op" id="5529614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5529619">//&nbsp;We&nbsp;have&nbsp;decoded&nbsp;a&nbsp;complete&nbsp;run-length&nbsp;so&nbsp;we&nbsp;need&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5529677">//&nbsp;replicate&nbsp;the&nbsp;last&nbsp;output&nbsp;symbol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529717">if</span>&nbsp;<span class="ident" id="5529720"><a href="/compress/bzip2/bzip2.go.html#5528574">repeat</a></span>&nbsp;<span class="op" id="5529727">&gt;</span>&nbsp;<span class="ident" id="5529729"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5529732">.</span><span class="ident" id="5529733">blockSize</span><span class="op" id="5529742">-</span><span class="ident" id="5529743"><a href="/compress/bzip2/bzip2.go.html#5528298">bufIndex</a></span>&nbsp;<span class="op" id="5529752">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529758">return</span>&nbsp;<span class="ident" id="5529765"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5529780">(</span><span class="string" id="5529781">&#34;repeats&nbsp;past&nbsp;end&nbsp;of&nbsp;block&#34;</span><span class="op" id="5529808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5529813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529818">for</span>&nbsp;<span class="ident" id="5529822">i</span>&nbsp;<span class="op" id="5529824">:=</span>&nbsp;<span class="num" id="5529827">0</span><span class="op" id="5529828">;</span>&nbsp;<span class="ident" id="5529830"><a href="/compress/bzip2/bzip2.go.html#5529822">i</a></span>&nbsp;<span class="op" id="5529832">&lt;</span>&nbsp;<span class="ident" id="5529834"><a href="/compress/bzip2/bzip2.go.html#5528574">repeat</a></span><span class="op" id="5529840">;</span>&nbsp;<span class="ident" id="5529842"><a href="/compress/bzip2/bzip2.go.html#5529822">i</a></span><span class="op" id="5529843">++</span>&nbsp;<span class="op" id="5529846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529852">b</span>&nbsp;<span class="op" id="5529854">:=</span>&nbsp;<span class="builtintype" id="5529857">byte</span><span class="op" id="5529861">(</span><span class="ident" id="5529862"><a href="/compress/bzip2/bzip2.go.html#5527273">mtf</a></span><span class="op" id="5529865">.</span><span class="ident" id="5529866">First</span><span class="op" id="5529871">(</span><span class="op" id="5529872">)</span><span class="op" id="5529873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529879"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5529882">.</span><span class="ident" id="5529883">tt</span><span class="op" id="5529885">[</span><span class="ident" id="5529886"><a href="/compress/bzip2/bzip2.go.html#5528298">bufIndex</a></span><span class="op" id="5529894">]</span>&nbsp;<span class="op" id="5529896">=</span>&nbsp;<span class="builtintype" id="5529898">uint32</span><span class="op" id="5529904">(</span><span class="ident" id="5529905"><a href="/compress/bzip2/bzip2.go.html#5529852">b</a></span><span class="op" id="5529906">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529912"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5529915">.</span><span class="ident" id="5529916">c</span><span class="op" id="5529917">[</span><span class="ident" id="5529918"><a href="/compress/bzip2/bzip2.go.html#5529852">b</a></span><span class="op" id="5529919">]</span><span class="op" id="5529920">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529927"><a href="/compress/bzip2/bzip2.go.html#5528298">bufIndex</a></span><span class="op" id="5529935">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5529941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529946"><a href="/compress/bzip2/bzip2.go.html#5528574">repeat</a></span>&nbsp;<span class="op" id="5529953">=</span>&nbsp;<span class="num" id="5529955">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5529959">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529964">if</span>&nbsp;<span class="builtintype" id="5529967">int</span><span class="op" id="5529970">(</span><span class="ident" id="5529971"><a href="/compress/bzip2/bzip2.go.html#5529180">v</a></span><span class="op" id="5529972">)</span>&nbsp;<span class="op" id="5529974">==</span>&nbsp;<span class="ident" id="5529977"><a href="/compress/bzip2/bzip2.go.html#5525746">numSymbols</a></span><span class="op" id="5529987">-</span><span class="num" id="5529988">1</span>&nbsp;<span class="op" id="5529990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5529995">//&nbsp;This&nbsp;is&nbsp;the&nbsp;EOF&nbsp;symbol.&nbsp;Because&nbsp;it&#39;s&nbsp;always&nbsp;at&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5530052">//&nbsp;end&nbsp;of&nbsp;the&nbsp;move-to-front&nbsp;list,&nbsp;and&nbsp;never&nbsp;gets&nbsp;moved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5530110">//&nbsp;to&nbsp;the&nbsp;front,&nbsp;it&nbsp;has&nbsp;this&nbsp;unique&nbsp;value.</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530156">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5530164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5530169">//&nbsp;Since&nbsp;two&nbsp;metasymbols&nbsp;(RUNA&nbsp;and&nbsp;RUNB)&nbsp;have&nbsp;values&nbsp;0&nbsp;and&nbsp;1,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5530233">//&nbsp;one&nbsp;would&nbsp;expect&nbsp;|v-2|&nbsp;to&nbsp;be&nbsp;passed&nbsp;to&nbsp;the&nbsp;MTF&nbsp;decoder.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5530294">//&nbsp;However,&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;MTF&nbsp;list&nbsp;is&nbsp;never&nbsp;referenced&nbsp;as&nbsp;0,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5530360">//&nbsp;it&#39;s&nbsp;always&nbsp;referenced&nbsp;with&nbsp;a&nbsp;run-length&nbsp;of&nbsp;1.&nbsp;Thus&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5530419">//&nbsp;doesn&#39;t&nbsp;need&nbsp;to&nbsp;be&nbsp;encoded&nbsp;and&nbsp;we&nbsp;have&nbsp;|v-1|&nbsp;in&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5530481">//&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530492">b</span>&nbsp;<span class="op" id="5530494">:=</span>&nbsp;<span class="builtintype" id="5530497">byte</span><span class="op" id="5530501">(</span><span class="ident" id="5530502"><a href="/compress/bzip2/bzip2.go.html#5527273">mtf</a></span><span class="op" id="5530505">.</span><span class="ident" id="5530506">Decode</span><span class="op" id="5530512">(</span><span class="builtintype" id="5530513">int</span><span class="op" id="5530516">(</span><span class="ident" id="5530517"><a href="/compress/bzip2/bzip2.go.html#5529180">v</a></span>&nbsp;<span class="op" id="5530519">-</span>&nbsp;<span class="num" id="5530521">1</span><span class="op" id="5530522">)</span><span class="op" id="5530523">)</span><span class="op" id="5530524">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530528">if</span>&nbsp;<span class="ident" id="5530531"><a href="/compress/bzip2/bzip2.go.html#5528298">bufIndex</a></span>&nbsp;<span class="op" id="5530540">&gt;=</span>&nbsp;<span class="ident" id="5530543"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5530546">.</span><span class="ident" id="5530547">blockSize</span>&nbsp;<span class="op" id="5530557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530562">return</span>&nbsp;<span class="ident" id="5530569"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5530584">(</span><span class="string" id="5530585">&#34;data&nbsp;exceeds&nbsp;block&nbsp;size&#34;</span><span class="op" id="5530610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5530614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530618"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5530621">.</span><span class="ident" id="5530622">tt</span><span class="op" id="5530624">[</span><span class="ident" id="5530625"><a href="/compress/bzip2/bzip2.go.html#5528298">bufIndex</a></span><span class="op" id="5530633">]</span>&nbsp;<span class="op" id="5530635">=</span>&nbsp;<span class="builtintype" id="5530637">uint32</span><span class="op" id="5530643">(</span><span class="ident" id="5530644"><a href="/compress/bzip2/bzip2.go.html#5530492">b</a></span><span class="op" id="5530645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530649"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5530652">.</span><span class="ident" id="5530653">c</span><span class="op" id="5530654">[</span><span class="ident" id="5530655"><a href="/compress/bzip2/bzip2.go.html#5530492">b</a></span><span class="op" id="5530656">]</span><span class="op" id="5530657">++</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530662"><a href="/compress/bzip2/bzip2.go.html#5528298">bufIndex</a></span><span class="op" id="5530670">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5530674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530678">if</span>&nbsp;<span class="ident" id="5530681"><a href="/compress/bzip2/bzip2.go.html#5525468">origPtr</a></span>&nbsp;<span class="op" id="5530689">&gt;=</span>&nbsp;<span class="builtintype" id="5530692">uint</span><span class="op" id="5530696">(</span><span class="ident" id="5530697"><a href="/compress/bzip2/bzip2.go.html#5528298">bufIndex</a></span><span class="op" id="5530705">)</span>&nbsp;<span class="op" id="5530707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530711">return</span>&nbsp;<span class="ident" id="5530718"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5530733">(</span><span class="string" id="5530734">&#34;origPtr&nbsp;out&nbsp;of&nbsp;bounds&#34;</span><span class="op" id="5530757">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5530760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5530764">//&nbsp;We&nbsp;have&nbsp;completed&nbsp;the&nbsp;entropy&nbsp;decoding.&nbsp;Now&nbsp;we&nbsp;can&nbsp;perform&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5530831">//&nbsp;inverse&nbsp;BWT&nbsp;and&nbsp;setup&nbsp;the&nbsp;RLE&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530873"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5530876">.</span><span class="ident" id="5530877">preRLE</span>&nbsp;<span class="op" id="5530884">=</span>&nbsp;<span class="ident" id="5530886"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5530889">.</span><span class="ident" id="5530890">tt</span><span class="op" id="5530892">[</span><span class="op" id="5530893">:</span><span class="ident" id="5530894"><a href="/compress/bzip2/bzip2.go.html#5528298">bufIndex</a></span><span class="op" id="5530902">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530905"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5530908">.</span><span class="ident" id="5530909">preRLEUsed</span>&nbsp;<span class="op" id="5530920">=</span>&nbsp;<span class="num" id="5530922">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530925"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5530928">.</span><span class="ident" id="5530929">tPos</span>&nbsp;<span class="op" id="5530934">=</span>&nbsp;<span class="ident" id="5530936"><a href="/compress/bzip2/bzip2.go.html#5531651">inverseBWT</a></span><span class="op" id="5530946">(</span><span class="ident" id="5530947"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5530950">.</span><span class="ident" id="5530951">preRLE</span><span class="op" id="5530957">,</span>&nbsp;<span class="ident" id="5530959"><a href="/compress/bzip2/bzip2.go.html#5525468">origPtr</a></span><span class="op" id="5530966">,</span>&nbsp;<span class="ident" id="5530968"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5530971">.</span><span class="ident" id="5530972">c</span><span class="op" id="5530973">[</span><span class="op" id="5530974">:</span><span class="op" id="5530975">]</span><span class="op" id="5530976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530979"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5530982">.</span><span class="ident" id="5530983">lastByte</span>&nbsp;<span class="op" id="5530992">=</span>&nbsp;<span class="op" id="5530994">-</span><span class="num" id="5530995">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530998"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5531001">.</span><span class="ident" id="5531002">byteRepeats</span>&nbsp;<span class="op" id="5531014">=</span>&nbsp;<span class="num" id="5531016">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531019"><a href="/compress/bzip2/bzip2.go.html#5525103">bz2</a></span><span class="op" id="5531022">.</span><span class="ident" id="5531023">repeats</span>&nbsp;<span class="op" id="5531031">=</span>&nbsp;<span class="num" id="5531033">0</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531037">return</span>&nbsp;<span class="ident" id="5531044">nil</span><br>
<span class="lineno"></span><span class="op" id="5531048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5531051">//&nbsp;inverseBWT&nbsp;implements&nbsp;the&nbsp;inverse&nbsp;Burrows-Wheeler&nbsp;transform&nbsp;as&nbsp;described&nbsp;in</span><br>
<span class="lineno">450</span><span class="comment" id="5531130">//&nbsp;http://www.hpl.hp.com/techreports/Compaq-DEC/SRC-RR-124.pdf,&nbsp;section&nbsp;4.2.</span><br>
<span class="lineno"></span><span class="comment" id="5531207">//&nbsp;In&nbsp;that&nbsp;document,&nbsp;origPtr&nbsp;is&nbsp;called&nbsp;`I&#39;&nbsp;and&nbsp;c&nbsp;is&nbsp;the&nbsp;`C&#39;&nbsp;array&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5531283">//&nbsp;first&nbsp;pass&nbsp;over&nbsp;the&nbsp;data.&nbsp;It&#39;s&nbsp;an&nbsp;argument&nbsp;here&nbsp;because&nbsp;we&nbsp;merge&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="5531361">//&nbsp;pass&nbsp;with&nbsp;the&nbsp;Huffman&nbsp;decoding.</span><br>
<span class="lineno"></span><span class="comment" id="5531396">//</span><br>
<span class="lineno">455</span><span class="comment" id="5531399">//&nbsp;This&nbsp;also&nbsp;implements&nbsp;the&nbsp;`single&nbsp;array&#39;&nbsp;method&nbsp;from&nbsp;the&nbsp;bzip2&nbsp;source&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="5531476">//&nbsp;which&nbsp;leaves&nbsp;the&nbsp;output,&nbsp;still&nbsp;shuffled,&nbsp;in&nbsp;the&nbsp;bottom&nbsp;8&nbsp;bits&nbsp;of&nbsp;tt&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5531556">//&nbsp;index&nbsp;of&nbsp;the&nbsp;next&nbsp;byte&nbsp;in&nbsp;the&nbsp;top&nbsp;24-bits.&nbsp;The&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;byte&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5531633">//&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="5531646">func</span>&nbsp;<span class="ident" id="5531651">inverseBWT</span><span class="op" id="5531661">(</span><span class="ident" id="5531662">tt</span>&nbsp;<span class="op" id="5531665">[</span><span class="op" id="5531666">]</span><span class="builtintype" id="5531667">uint32</span><span class="op" id="5531673">,</span>&nbsp;<span class="ident" id="5531675">origPtr</span>&nbsp;<span class="builtintype" id="5531683">uint</span><span class="op" id="5531687">,</span>&nbsp;<span class="ident" id="5531689">c</span>&nbsp;<span class="op" id="5531691">[</span><span class="op" id="5531692">]</span><span class="builtintype" id="5531693">uint</span><span class="op" id="5531697">)</span>&nbsp;<span class="builtintype" id="5531699">uint32</span>&nbsp;<span class="op" id="5531706">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531709">sum</span>&nbsp;<span class="op" id="5531713">:=</span>&nbsp;<span class="builtintype" id="5531716">uint</span><span class="op" id="5531720">(</span><span class="num" id="5531721">0</span><span class="op" id="5531722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531725">for</span>&nbsp;<span class="ident" id="5531729">i</span>&nbsp;<span class="op" id="5531731">:=</span>&nbsp;<span class="num" id="5531734">0</span><span class="op" id="5531735">;</span>&nbsp;<span class="ident" id="5531737"><a href="/compress/bzip2/bzip2.go.html#5531729">i</a></span>&nbsp;<span class="op" id="5531739">&lt;</span>&nbsp;<span class="num" id="5531741">256</span><span class="op" id="5531744">;</span>&nbsp;<span class="ident" id="5531746"><a href="/compress/bzip2/bzip2.go.html#5531729">i</a></span><span class="op" id="5531747">++</span>&nbsp;<span class="op" id="5531750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531754"><a href="/compress/bzip2/bzip2.go.html#5531709">sum</a></span>&nbsp;<span class="op" id="5531758">+=</span>&nbsp;<span class="ident" id="5531761"><a href="/compress/bzip2/bzip2.go.html#5531689">c</a></span><span class="op" id="5531762">[</span><span class="ident" id="5531763"><a href="/compress/bzip2/bzip2.go.html#5531729">i</a></span><span class="op" id="5531764">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531768"><a href="/compress/bzip2/bzip2.go.html#5531689">c</a></span><span class="op" id="5531769">[</span><span class="ident" id="5531770"><a href="/compress/bzip2/bzip2.go.html#5531729">i</a></span><span class="op" id="5531771">]</span>&nbsp;<span class="op" id="5531773">=</span>&nbsp;<span class="ident" id="5531775"><a href="/compress/bzip2/bzip2.go.html#5531709">sum</a></span>&nbsp;<span class="op" id="5531779">-</span>&nbsp;<span class="ident" id="5531781"><a href="/compress/bzip2/bzip2.go.html#5531689">c</a></span><span class="op" id="5531782">[</span><span class="ident" id="5531783"><a href="/compress/bzip2/bzip2.go.html#5531729">i</a></span><span class="op" id="5531784">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5531787">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531791">for</span>&nbsp;<span class="ident" id="5531795">i</span>&nbsp;<span class="op" id="5531797">:=</span>&nbsp;<span class="keyword" id="5531800">range</span>&nbsp;<span class="ident" id="5531806"><a href="/compress/bzip2/bzip2.go.html#5531662">tt</a></span>&nbsp;<span class="op" id="5531809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531813">b</span>&nbsp;<span class="op" id="5531815">:=</span>&nbsp;<span class="ident" id="5531818"><a href="/compress/bzip2/bzip2.go.html#5531662">tt</a></span><span class="op" id="5531820">[</span><span class="ident" id="5531821"><a href="/compress/bzip2/bzip2.go.html#5531795">i</a></span><span class="op" id="5531822">]</span>&nbsp;<span class="op" id="5531824">&amp;</span>&nbsp;<span class="num" id="5531826">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531833"><a href="/compress/bzip2/bzip2.go.html#5531662">tt</a></span><span class="op" id="5531835">[</span><span class="ident" id="5531836"><a href="/compress/bzip2/bzip2.go.html#5531689">c</a></span><span class="op" id="5531837">[</span><span class="ident" id="5531838"><a href="/compress/bzip2/bzip2.go.html#5531813">b</a></span><span class="op" id="5531839">]</span><span class="op" id="5531840">]</span>&nbsp;<span class="op" id="5531842">|=</span>&nbsp;<span class="builtintype" id="5531845">uint32</span><span class="op" id="5531851">(</span><span class="ident" id="5531852"><a href="/compress/bzip2/bzip2.go.html#5531795">i</a></span><span class="op" id="5531853">)</span>&nbsp;<span class="op" id="5531855">&lt;&lt;</span>&nbsp;<span class="num" id="5531858">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531862"><a href="/compress/bzip2/bzip2.go.html#5531689">c</a></span><span class="op" id="5531863">[</span><span class="ident" id="5531864"><a href="/compress/bzip2/bzip2.go.html#5531813">b</a></span><span class="op" id="5531865">]</span><span class="op" id="5531866">++</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5531870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531874">return</span>&nbsp;<span class="ident" id="5531881"><a href="/compress/bzip2/bzip2.go.html#5531662">tt</a></span><span class="op" id="5531883">[</span><span class="ident" id="5531884"><a href="/compress/bzip2/bzip2.go.html#5531675">origPtr</a></span><span class="op" id="5531891">]</span>&nbsp;<span class="op" id="5531893">&gt;&gt;</span>&nbsp;<span class="num" id="5531896">8</span><br>
<span class="lineno"></span><span class="op" id="5531898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span><span class="comment" id="5531901">//&nbsp;This&nbsp;is&nbsp;a&nbsp;standard&nbsp;CRC32&nbsp;like&nbsp;in&nbsp;hash/crc32&nbsp;except&nbsp;that&nbsp;all&nbsp;the&nbsp;shifts&nbsp;are&nbsp;reversed,</span><br>
<span class="lineno"></span><span class="comment" id="5531989">//&nbsp;causing&nbsp;the&nbsp;bits&nbsp;in&nbsp;the&nbsp;input&nbsp;to&nbsp;be&nbsp;processed&nbsp;in&nbsp;the&nbsp;reverse&nbsp;of&nbsp;the&nbsp;usual&nbsp;order.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5532074">var</span>&nbsp;<span class="ident" id="5532078">crctab</span>&nbsp;<span class="op" id="5532085">[</span><span class="num" id="5532086">256</span><span class="op" id="5532089">]</span><span class="builtintype" id="5532090">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="5532098">func</span>&nbsp;<span class="ident" id="5532103">init</span><span class="op" id="5532107">(</span><span class="op" id="5532108">)</span>&nbsp;<span class="op" id="5532110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532113">const</span>&nbsp;<span class="ident" id="5532119">poly</span>&nbsp;<span class="op" id="5532124">=</span>&nbsp;<span class="num" id="5532126">0x04C11DB7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532138">for</span>&nbsp;<span class="ident" id="5532142">i</span>&nbsp;<span class="op" id="5532144">:=</span>&nbsp;<span class="keyword" id="5532147">range</span>&nbsp;<span class="ident" id="5532153"><a href="/compress/bzip2/bzip2.go.html#5532078">crctab</a></span>&nbsp;<span class="op" id="5532160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532164">crc</span>&nbsp;<span class="op" id="5532168">:=</span>&nbsp;<span class="builtintype" id="5532171">uint32</span><span class="op" id="5532177">(</span><span class="ident" id="5532178"><a href="/compress/bzip2/bzip2.go.html#5532142">i</a></span><span class="op" id="5532179">)</span>&nbsp;<span class="op" id="5532181">&lt;&lt;</span>&nbsp;<span class="num" id="5532184">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532189">for</span>&nbsp;<span class="ident" id="5532193">j</span>&nbsp;<span class="op" id="5532195">:=</span>&nbsp;<span class="num" id="5532198">0</span><span class="op" id="5532199">;</span>&nbsp;<span class="ident" id="5532201"><a href="/compress/bzip2/bzip2.go.html#5532193">j</a></span>&nbsp;<span class="op" id="5532203">&lt;</span>&nbsp;<span class="num" id="5532205">8</span><span class="op" id="5532206">;</span>&nbsp;<span class="ident" id="5532208"><a href="/compress/bzip2/bzip2.go.html#5532193">j</a></span><span class="op" id="5532209">++</span>&nbsp;<span class="op" id="5532212">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532217">if</span>&nbsp;<span class="ident" id="5532220"><a href="/compress/bzip2/bzip2.go.html#5532164">crc</a></span><span class="op" id="5532223">&amp;</span><span class="num" id="5532224">0x80000000</span>&nbsp;<span class="op" id="5532235">!=</span>&nbsp;<span class="num" id="5532238">0</span>&nbsp;<span class="op" id="5532240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532246"><a href="/compress/bzip2/bzip2.go.html#5532164">crc</a></span>&nbsp;<span class="op" id="5532250">=</span>&nbsp;<span class="op" id="5532252">(</span><span class="ident" id="5532253"><a href="/compress/bzip2/bzip2.go.html#5532164">crc</a></span>&nbsp;<span class="op" id="5532257">&lt;&lt;</span>&nbsp;<span class="num" id="5532260">1</span><span class="op" id="5532261">)</span>&nbsp;<span class="op" id="5532263">^</span>&nbsp;<span class="ident" id="5532265"><a href="/compress/bzip2/bzip2.go.html#5532119">poly</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5532273">}</span>&nbsp;<span class="keyword" id="5532275">else</span>&nbsp;<span class="op" id="5532280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532286"><a href="/compress/bzip2/bzip2.go.html#5532164">crc</a></span>&nbsp;<span class="op" id="5532290">&lt;&lt;=</span>&nbsp;<span class="num" id="5532294">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5532299">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5532303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532307"><a href="/compress/bzip2/bzip2.go.html#5532078">crctab</a></span><span class="op" id="5532313">[</span><span class="ident" id="5532314"><a href="/compress/bzip2/bzip2.go.html#5532142">i</a></span><span class="op" id="5532315">]</span>&nbsp;<span class="op" id="5532317">=</span>&nbsp;<span class="ident" id="5532319"><a href="/compress/bzip2/bzip2.go.html#5532164">crc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5532324">}</span><br>
<span class="lineno"></span><span class="op" id="5532326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="5532329">//&nbsp;updateCRC&nbsp;updates&nbsp;the&nbsp;crc&nbsp;value&nbsp;to&nbsp;incorporate&nbsp;the&nbsp;data&nbsp;in&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="5532394">//&nbsp;The&nbsp;initial&nbsp;value&nbsp;is&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="5532421">func</span>&nbsp;<span class="ident" id="5532426">updateCRC</span><span class="op" id="5532435">(</span><span class="ident" id="5532436">val</span>&nbsp;<span class="builtintype" id="5532440">uint32</span><span class="op" id="5532446">,</span>&nbsp;<span class="ident" id="5532448">b</span>&nbsp;<span class="op" id="5532450">[</span><span class="op" id="5532451">]</span><span class="builtintype" id="5532452">byte</span><span class="op" id="5532456">)</span>&nbsp;<span class="builtintype" id="5532458">uint32</span>&nbsp;<span class="op" id="5532465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532468">crc</span>&nbsp;<span class="op" id="5532472">:=</span>&nbsp;<span class="op" id="5532475">^</span><span class="ident" id="5532476"><a href="/compress/bzip2/bzip2.go.html#5532436">val</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532481">for</span>&nbsp;<span class="ident" id="5532485">_</span><span class="op" id="5532486">,</span>&nbsp;<span class="ident" id="5532488">v</span>&nbsp;<span class="op" id="5532490">:=</span>&nbsp;<span class="keyword" id="5532493">range</span>&nbsp;<span class="ident" id="5532499"><a href="/compress/bzip2/bzip2.go.html#5532448">b</a></span>&nbsp;<span class="op" id="5532501">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532505"><a href="/compress/bzip2/bzip2.go.html#5532468">crc</a></span>&nbsp;<span class="op" id="5532509">=</span>&nbsp;<span class="ident" id="5532511"><a href="/compress/bzip2/bzip2.go.html#5532078">crctab</a></span><span class="op" id="5532517">[</span><span class="builtintype" id="5532518">byte</span><span class="op" id="5532522">(</span><span class="ident" id="5532523"><a href="/compress/bzip2/bzip2.go.html#5532468">crc</a></span><span class="op" id="5532526">&gt;&gt;</span><span class="num" id="5532528">24</span><span class="op" id="5532530">)</span><span class="op" id="5532531">^</span><span class="ident" id="5532532"><a href="/compress/bzip2/bzip2.go.html#5532488">v</a></span><span class="op" id="5532533">]</span>&nbsp;<span class="op" id="5532535">^</span>&nbsp;<span class="op" id="5532537">(</span><span class="ident" id="5532538"><a href="/compress/bzip2/bzip2.go.html#5532468">crc</a></span>&nbsp;<span class="op" id="5532542">&lt;&lt;</span>&nbsp;<span class="num" id="5532545">8</span><span class="op" id="5532546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5532549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532552">return</span>&nbsp;<span class="op" id="5532559">^</span><span class="ident" id="5532560"><a href="/compress/bzip2/bzip2.go.html#5532468">crc</a></span><br>
<span class="lineno"></span><span class="op" id="5532564">}</span>
</div>
</body>
</html>
