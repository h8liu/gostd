<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>io</h2>
<ul>
<li><a href="/gostd/io/io.go.html">io.go</a></li>
<li><a href="/gostd/io/io_test.go.html">io_test.go</a></li>
<li><a href="/gostd/io/multi.go.html">multi.go</a></li>
<li><a href="/gostd/io/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/io/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/io/pipe_test.go.html">pipe_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1604373">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1604428">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1604482">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1604533">package</span>&nbsp;<span class="ident" id="1604541">io</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1604545">type</span>&nbsp;<span class="ident" id="1604550">multiReader</span>&nbsp;<span class="keyword" id="1604562">struct</span>&nbsp;<span class="op" id="1604569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1604572">readers</span>&nbsp;<span class="op" id="1604580">[</span><span class="op" id="1604581">]</span><span class="ident" id="1604582">Reader</span><br>
<span class="lineno"></span><span class="op" id="1604589">}</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1604592">func</span>&nbsp;<span class="op" id="1604597">(</span><span class="ident" id="1604598">mr</span>&nbsp;<span class="op" id="1604601">*</span><span class="ident" id="1604602">multiReader</span><span class="op" id="1604613">)</span>&nbsp;<span class="ident" id="1604615">Read</span><span class="op" id="1604619">(</span><span class="ident" id="1604620">p</span>&nbsp;<span class="op" id="1604622">[</span><span class="op" id="1604623">]</span><span class="builtintype" id="1604624">byte</span><span class="op" id="1604628">)</span>&nbsp;<span class="op" id="1604630">(</span><span class="ident" id="1604631">n</span>&nbsp;<span class="builtintype" id="1604633">int</span><span class="op" id="1604636">,</span>&nbsp;<span class="ident" id="1604638">err</span>&nbsp;<span class="builtintype" id="1604642">error</span><span class="op" id="1604647">)</span>&nbsp;<span class="op" id="1604649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1604652">for</span>&nbsp;<span class="builtinfunc" id="1604656">len</span><span class="op" id="1604659">(</span><span class="ident" id="1604660">mr</span><span class="op" id="1604662">.</span><span class="ident" id="1604663">readers</span><span class="op" id="1604670">)</span>&nbsp;<span class="op" id="1604672">&gt;</span>&nbsp;<span class="num" id="1604674">0</span>&nbsp;<span class="op" id="1604676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1604680">n</span><span class="op" id="1604681">,</span>&nbsp;<span class="ident" id="1604683">err</span>&nbsp;<span class="op" id="1604687">=</span>&nbsp;<span class="ident" id="1604689">mr</span><span class="op" id="1604691">.</span><span class="ident" id="1604692">readers</span><span class="op" id="1604699">[</span><span class="num" id="1604700">0</span><span class="op" id="1604701">]</span><span class="op" id="1604702">.</span><span class="ident" id="1604703">Read</span><span class="op" id="1604707">(</span><span class="ident" id="1604708">p</span><span class="op" id="1604709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1604713">if</span>&nbsp;<span class="ident" id="1604716">n</span>&nbsp;<span class="op" id="1604718">&gt;</span>&nbsp;<span class="num" id="1604720">0</span>&nbsp;<span class="op" id="1604722">||</span>&nbsp;<span class="ident" id="1604725">err</span>&nbsp;<span class="op" id="1604729">!=</span>&nbsp;<span class="ident" id="1604732">EOF</span>&nbsp;<span class="op" id="1604736">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1604741">if</span>&nbsp;<span class="ident" id="1604744">err</span>&nbsp;<span class="op" id="1604748">==</span>&nbsp;<span class="ident" id="1604751">EOF</span>&nbsp;<span class="op" id="1604755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1604761">//&nbsp;Don&#39;t&nbsp;return&nbsp;EOF&nbsp;yet.&nbsp;There&nbsp;may&nbsp;be&nbsp;more&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1604814">//&nbsp;in&nbsp;the&nbsp;remaining&nbsp;readers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1604847">err</span>&nbsp;<span class="op" id="1604851">=</span>&nbsp;<span class="ident" id="1604853">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1604860">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1604865">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1604874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1604878">mr</span><span class="op" id="1604880">.</span><span class="ident" id="1604881">readers</span>&nbsp;<span class="op" id="1604889">=</span>&nbsp;<span class="ident" id="1604891">mr</span><span class="op" id="1604893">.</span><span class="ident" id="1604894">readers</span><span class="op" id="1604901">[</span><span class="num" id="1604902">1</span><span class="op" id="1604903">:</span><span class="op" id="1604904">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1604907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1604910">return</span>&nbsp;<span class="num" id="1604917">0</span><span class="op" id="1604918">,</span>&nbsp;<span class="ident" id="1604920">EOF</span><br>
<span class="lineno">25</span><span class="op" id="1604924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1604927">//&nbsp;MultiReader&nbsp;returns&nbsp;a&nbsp;Reader&nbsp;that&#39;s&nbsp;the&nbsp;logical&nbsp;concatenation&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1604995">//&nbsp;the&nbsp;provided&nbsp;input&nbsp;readers.&nbsp;&nbsp;They&#39;re&nbsp;read&nbsp;sequentially.&nbsp;&nbsp;Once&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="1605064">//&nbsp;inputs&nbsp;have&nbsp;returned&nbsp;EOF,&nbsp;Read&nbsp;will&nbsp;return&nbsp;EOF.&nbsp;&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;readers</span><br>
<span class="lineno">30</span><span class="comment" id="1605138">//&nbsp;return&nbsp;a&nbsp;non-nil,&nbsp;non-EOF&nbsp;error,&nbsp;Read&nbsp;will&nbsp;return&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="1605203">func</span>&nbsp;<span class="ident" id="1605208">MultiReader</span><span class="op" id="1605219">(</span><span class="ident" id="1605220">readers</span>&nbsp;<span class="op" id="1605228">...</span><span class="ident" id="1605231">Reader</span><span class="op" id="1605237">)</span>&nbsp;<span class="ident" id="1605239">Reader</span>&nbsp;<span class="op" id="1605246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605249">r</span>&nbsp;<span class="op" id="1605251">:=</span>&nbsp;<span class="builtinfunc" id="1605254">make</span><span class="op" id="1605258">(</span><span class="op" id="1605259">[</span><span class="op" id="1605260">]</span><span class="ident" id="1605261">Reader</span><span class="op" id="1605267">,</span>&nbsp;<span class="builtinfunc" id="1605269">len</span><span class="op" id="1605272">(</span><span class="ident" id="1605273">readers</span><span class="op" id="1605280">)</span><span class="op" id="1605281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1605284">copy</span><span class="op" id="1605288">(</span><span class="ident" id="1605289">r</span><span class="op" id="1605290">,</span>&nbsp;<span class="ident" id="1605292">readers</span><span class="op" id="1605299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605302">return</span>&nbsp;<span class="op" id="1605309">&amp;</span><span class="ident" id="1605310">multiReader</span><span class="op" id="1605321">{</span><span class="ident" id="1605322">r</span><span class="op" id="1605323">}</span><br>
<span class="lineno">35</span><span class="op" id="1605325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1605328">type</span>&nbsp;<span class="ident" id="1605333">multiWriter</span>&nbsp;<span class="keyword" id="1605345">struct</span>&nbsp;<span class="op" id="1605352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605355">writers</span>&nbsp;<span class="op" id="1605363">[</span><span class="op" id="1605364">]</span><span class="ident" id="1605365">Writer</span><br>
<span class="lineno"></span><span class="op" id="1605372">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="1605375">func</span>&nbsp;<span class="op" id="1605380">(</span><span class="ident" id="1605381">t</span>&nbsp;<span class="op" id="1605383">*</span><span class="ident" id="1605384">multiWriter</span><span class="op" id="1605395">)</span>&nbsp;<span class="ident" id="1605397">Write</span><span class="op" id="1605402">(</span><span class="ident" id="1605403">p</span>&nbsp;<span class="op" id="1605405">[</span><span class="op" id="1605406">]</span><span class="builtintype" id="1605407">byte</span><span class="op" id="1605411">)</span>&nbsp;<span class="op" id="1605413">(</span><span class="ident" id="1605414">n</span>&nbsp;<span class="builtintype" id="1605416">int</span><span class="op" id="1605419">,</span>&nbsp;<span class="ident" id="1605421">err</span>&nbsp;<span class="builtintype" id="1605425">error</span><span class="op" id="1605430">)</span>&nbsp;<span class="op" id="1605432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605435">for</span>&nbsp;<span class="ident" id="1605439">_</span><span class="op" id="1605440">,</span>&nbsp;<span class="ident" id="1605442">w</span>&nbsp;<span class="op" id="1605444">:=</span>&nbsp;<span class="keyword" id="1605447">range</span>&nbsp;<span class="ident" id="1605453">t</span><span class="op" id="1605454">.</span><span class="ident" id="1605455">writers</span>&nbsp;<span class="op" id="1605463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605467">n</span><span class="op" id="1605468">,</span>&nbsp;<span class="ident" id="1605470">err</span>&nbsp;<span class="op" id="1605474">=</span>&nbsp;<span class="ident" id="1605476">w</span><span class="op" id="1605477">.</span><span class="ident" id="1605478">Write</span><span class="op" id="1605483">(</span><span class="ident" id="1605484">p</span><span class="op" id="1605485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605489">if</span>&nbsp;<span class="ident" id="1605492">err</span>&nbsp;<span class="op" id="1605496">!=</span>&nbsp;<span class="ident" id="1605499">nil</span>&nbsp;<span class="op" id="1605503">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605508">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1605517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605521">if</span>&nbsp;<span class="ident" id="1605524">n</span>&nbsp;<span class="op" id="1605526">!=</span>&nbsp;<span class="builtinfunc" id="1605529">len</span><span class="op" id="1605532">(</span><span class="ident" id="1605533">p</span><span class="op" id="1605534">)</span>&nbsp;<span class="op" id="1605536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605541">err</span>&nbsp;<span class="op" id="1605545">=</span>&nbsp;<span class="ident" id="1605547">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605564">return</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1605573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1605576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605579">return</span>&nbsp;<span class="builtinfunc" id="1605586">len</span><span class="op" id="1605589">(</span><span class="ident" id="1605590">p</span><span class="op" id="1605591">)</span><span class="op" id="1605592">,</span>&nbsp;<span class="ident" id="1605594">nil</span><br>
<span class="lineno"></span><span class="op" id="1605598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1605601">//&nbsp;MultiWriter&nbsp;creates&nbsp;a&nbsp;writer&nbsp;that&nbsp;duplicates&nbsp;its&nbsp;writes&nbsp;to&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1605671">//&nbsp;provided&nbsp;writers,&nbsp;similar&nbsp;to&nbsp;the&nbsp;Unix&nbsp;tee(1)&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="1605728">func</span>&nbsp;<span class="ident" id="1605733">MultiWriter</span><span class="op" id="1605744">(</span><span class="ident" id="1605745">writers</span>&nbsp;<span class="op" id="1605753">...</span><span class="ident" id="1605756">Writer</span><span class="op" id="1605762">)</span>&nbsp;<span class="ident" id="1605764">Writer</span>&nbsp;<span class="op" id="1605771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605774">w</span>&nbsp;<span class="op" id="1605776">:=</span>&nbsp;<span class="builtinfunc" id="1605779">make</span><span class="op" id="1605783">(</span><span class="op" id="1605784">[</span><span class="op" id="1605785">]</span><span class="ident" id="1605786">Writer</span><span class="op" id="1605792">,</span>&nbsp;<span class="builtinfunc" id="1605794">len</span><span class="op" id="1605797">(</span><span class="ident" id="1605798">writers</span><span class="op" id="1605805">)</span><span class="op" id="1605806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1605809">copy</span><span class="op" id="1605813">(</span><span class="ident" id="1605814">w</span><span class="op" id="1605815">,</span>&nbsp;<span class="ident" id="1605817">writers</span><span class="op" id="1605824">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605827">return</span>&nbsp;<span class="op" id="1605834">&amp;</span><span class="ident" id="1605835">multiWriter</span><span class="op" id="1605846">{</span><span class="ident" id="1605847">w</span><span class="op" id="1605848">}</span><br>
<span class="lineno"></span><span class="op" id="1605850">}</span>
</div>
</body>
</html>
