<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/dsa</h2>
<ul>
<li><a href="/gostd/crypto/dsa/dsa.go.html" class="current">dsa.go</a></li>
<li><a href="/gostd/crypto/dsa/dsa_test.go.html">dsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4734477">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4734532">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4734586">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4734637">//&nbsp;Package&nbsp;dsa&nbsp;implements&nbsp;the&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4734722">package</span>&nbsp;<span class="ident" id="4734730">dsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4734735">import</span>&nbsp;<span class="op" id="4734742">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4734745">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4734755">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4734761">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4734772">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4734775">//&nbsp;Parameters&nbsp;represents&nbsp;the&nbsp;domain&nbsp;parameters&nbsp;for&nbsp;a&nbsp;key.&nbsp;These&nbsp;parameters&nbsp;can</span><br>
<span class="lineno">15</span><span class="comment" id="4734854">//&nbsp;be&nbsp;shared&nbsp;across&nbsp;many&nbsp;keys.&nbsp;The&nbsp;bit&nbsp;length&nbsp;of&nbsp;Q&nbsp;must&nbsp;be&nbsp;a&nbsp;multiple&nbsp;of&nbsp;8.</span><br>
<span class="lineno"></span><span class="keyword" id="4734930">type</span>&nbsp;<span class="ident" id="4734935">Parameters</span>&nbsp;<span class="keyword" id="4734946">struct</span>&nbsp;<span class="op" id="4734953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4734956">P</span><span class="op" id="4734957">,</span>&nbsp;<span class="ident" id="4734959">Q</span><span class="op" id="4734960">,</span>&nbsp;<span class="ident" id="4734962">G</span>&nbsp;<span class="op" id="4734964">*</span><span class="ident" id="4734965">big</span><span class="op" id="4734968">.</span><span class="ident" id="4734969">Int</span><br>
<span class="lineno"></span><span class="op" id="4734973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4734976">//&nbsp;PublicKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4735018">type</span>&nbsp;<span class="ident" id="4735023">PublicKey</span>&nbsp;<span class="keyword" id="4735033">struct</span>&nbsp;<span class="op" id="4735040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4735043">Parameters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4735055">Y</span>&nbsp;<span class="op" id="4735057">*</span><span class="ident" id="4735058">big</span><span class="op" id="4735061">.</span><span class="ident" id="4735062">Int</span><br>
<span class="lineno"></span><span class="op" id="4735066">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4735069">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4735113">type</span>&nbsp;<span class="ident" id="4735118">PrivateKey</span>&nbsp;<span class="keyword" id="4735129">struct</span>&nbsp;<span class="op" id="4735136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4735139">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4735150">X</span>&nbsp;<span class="op" id="4735152">*</span><span class="ident" id="4735153">big</span><span class="op" id="4735156">.</span><span class="ident" id="4735157">Int</span><br>
<span class="lineno">30</span><span class="op" id="4735161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4735164">//&nbsp;ErrInvalidPublicKey&nbsp;results&nbsp;when&nbsp;a&nbsp;public&nbsp;key&nbsp;is&nbsp;not&nbsp;usable&nbsp;by&nbsp;this&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4735241">//&nbsp;FIPS&nbsp;is&nbsp;quite&nbsp;strict&nbsp;about&nbsp;the&nbsp;format&nbsp;of&nbsp;DSA&nbsp;keys,&nbsp;but&nbsp;other&nbsp;code&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4735317">//&nbsp;less&nbsp;so.&nbsp;Thus,&nbsp;when&nbsp;using&nbsp;keys&nbsp;which&nbsp;may&nbsp;have&nbsp;been&nbsp;generated&nbsp;by&nbsp;other&nbsp;code,</span><br>
<span class="lineno">35</span><span class="comment" id="4735396">//&nbsp;this&nbsp;error&nbsp;must&nbsp;be&nbsp;handled.</span><br>
<span class="lineno"></span><span class="keyword" id="4735427">var</span>&nbsp;<span class="ident" id="4735431">ErrInvalidPublicKey</span>&nbsp;<span class="op" id="4735451">=</span>&nbsp;<span class="ident" id="4735453">errors</span><span class="op" id="4735459">.</span><span class="ident" id="4735460">New</span><span class="op" id="4735463">(</span><span class="string" id="4735464">&#34;crypto/dsa:&nbsp;invalid&nbsp;public&nbsp;key&#34;</span><span class="op" id="4735496">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4735499">//&nbsp;ParameterSizes&nbsp;is&nbsp;a&nbsp;enumeration&nbsp;of&nbsp;the&nbsp;acceptable&nbsp;bit&nbsp;lengths&nbsp;of&nbsp;the&nbsp;primes</span><br>
<span class="lineno"></span><span class="comment" id="4735578">//&nbsp;in&nbsp;a&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters.&nbsp;See&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.2.</span><br>
<span class="lineno">40</span><span class="keyword" id="4735638">type</span>&nbsp;<span class="ident" id="4735643">ParameterSizes</span>&nbsp;<span class="builtintype" id="4735658">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4735663">const</span>&nbsp;<span class="op" id="4735669">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4735672">L1024N160</span>&nbsp;<span class="ident" id="4735682">ParameterSizes</span>&nbsp;<span class="op" id="4735697">=</span>&nbsp;<span class="ident" id="4735699">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4735705">L2048N224</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4735716">L2048N256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4735727">L3072N256</span><br>
<span class="lineno"></span><span class="op" id="4735737">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4735740">//&nbsp;numMRTests&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;Miller-Rabin&nbsp;primality&nbsp;tests&nbsp;that&nbsp;we&nbsp;perform.&nbsp;We</span><br>
<span class="lineno">50</span><span class="comment" id="4735820">//&nbsp;pick&nbsp;the&nbsp;largest&nbsp;recommended&nbsp;number&nbsp;from&nbsp;table&nbsp;C.1&nbsp;of&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4735889">const</span>&nbsp;<span class="ident" id="4735895">numMRTests</span>&nbsp;<span class="op" id="4735906">=</span>&nbsp;<span class="num" id="4735908">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4735912">//&nbsp;GenerateParameters&nbsp;puts&nbsp;a&nbsp;random,&nbsp;valid&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters&nbsp;into&nbsp;params.</span><br>
<span class="lineno"></span><span class="comment" id="4735990">//&nbsp;This&nbsp;function&nbsp;takes&nbsp;many&nbsp;seconds,&nbsp;even&nbsp;on&nbsp;fast&nbsp;machines.</span><br>
<span class="lineno">55</span><span class="keyword" id="4736050">func</span>&nbsp;<span class="ident" id="4736055">GenerateParameters</span><span class="op" id="4736073">(</span><span class="ident" id="4736074">params</span>&nbsp;<span class="op" id="4736081">*</span><span class="ident" id="4736082">Parameters</span><span class="op" id="4736092">,</span>&nbsp;<span class="ident" id="4736094">rand</span>&nbsp;<span class="ident" id="4736099">io</span><span class="op" id="4736101">.</span><span class="ident" id="4736102">Reader</span><span class="op" id="4736108">,</span>&nbsp;<span class="ident" id="4736110">sizes</span>&nbsp;<span class="ident" id="4736116">ParameterSizes</span><span class="op" id="4736130">)</span>&nbsp;<span class="op" id="4736132">(</span><span class="ident" id="4736133">err</span>&nbsp;<span class="builtintype" id="4736137">error</span><span class="op" id="4736142">)</span>&nbsp;<span class="op" id="4736144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4736147">//&nbsp;This&nbsp;function&nbsp;doesn&#39;t&nbsp;follow&nbsp;FIPS&nbsp;186-3&nbsp;exactly&nbsp;in&nbsp;that&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4736218">//&nbsp;use&nbsp;a&nbsp;verification&nbsp;seed&nbsp;to&nbsp;generate&nbsp;the&nbsp;primes.&nbsp;The&nbsp;verification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4736287">//&nbsp;seed&nbsp;doesn&#39;t&nbsp;appear&nbsp;to&nbsp;be&nbsp;exported&nbsp;or&nbsp;used&nbsp;by&nbsp;other&nbsp;code&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4736352">//&nbsp;omitting&nbsp;it&nbsp;makes&nbsp;the&nbsp;code&nbsp;cleaner.</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4736393">var</span>&nbsp;<span class="ident" id="4736397">L</span><span class="op" id="4736398">,</span>&nbsp;<span class="ident" id="4736400">N</span>&nbsp;<span class="builtintype" id="4736402">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4736407">switch</span>&nbsp;<span class="ident" id="4736414">sizes</span>&nbsp;<span class="op" id="4736420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4736423">case</span>&nbsp;<span class="ident" id="4736428">L1024N160</span><span class="op" id="4736437">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736441">L</span>&nbsp;<span class="op" id="4736443">=</span>&nbsp;<span class="num" id="4736445">1024</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736452">N</span>&nbsp;<span class="op" id="4736454">=</span>&nbsp;<span class="num" id="4736456">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4736461">case</span>&nbsp;<span class="ident" id="4736466">L2048N224</span><span class="op" id="4736475">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736479">L</span>&nbsp;<span class="op" id="4736481">=</span>&nbsp;<span class="num" id="4736483">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736490">N</span>&nbsp;<span class="op" id="4736492">=</span>&nbsp;<span class="num" id="4736494">224</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4736499">case</span>&nbsp;<span class="ident" id="4736504">L2048N256</span><span class="op" id="4736513">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736517">L</span>&nbsp;<span class="op" id="4736519">=</span>&nbsp;<span class="num" id="4736521">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736528">N</span>&nbsp;<span class="op" id="4736530">=</span>&nbsp;<span class="num" id="4736532">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4736537">case</span>&nbsp;<span class="ident" id="4736542">L3072N256</span><span class="op" id="4736551">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736555">L</span>&nbsp;<span class="op" id="4736557">=</span>&nbsp;<span class="num" id="4736559">3072</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736566">N</span>&nbsp;<span class="op" id="4736568">=</span>&nbsp;<span class="num" id="4736570">256</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4736575">default</span><span class="op" id="4736582">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4736586">return</span>&nbsp;<span class="ident" id="4736593">errors</span><span class="op" id="4736599">.</span><span class="ident" id="4736600">New</span><span class="op" id="4736603">(</span><span class="string" id="4736604">&#34;crypto/dsa:&nbsp;invalid&nbsp;ParameterSizes&#34;</span><span class="op" id="4736640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4736643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736647">qBytes</span>&nbsp;<span class="op" id="4736654">:=</span>&nbsp;<span class="builtinfunc" id="4736657">make</span><span class="op" id="4736661">(</span><span class="op" id="4736662">[</span><span class="op" id="4736663">]</span><span class="builtintype" id="4736664">byte</span><span class="op" id="4736668">,</span>&nbsp;<span class="ident" id="4736670">N</span><span class="op" id="4736671">/</span><span class="num" id="4736672">8</span><span class="op" id="4736673">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736676">pBytes</span>&nbsp;<span class="op" id="4736683">:=</span>&nbsp;<span class="builtinfunc" id="4736686">make</span><span class="op" id="4736690">(</span><span class="op" id="4736691">[</span><span class="op" id="4736692">]</span><span class="builtintype" id="4736693">byte</span><span class="op" id="4736697">,</span>&nbsp;<span class="ident" id="4736699">L</span><span class="op" id="4736700">/</span><span class="num" id="4736701">8</span><span class="op" id="4736702">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736706">q</span>&nbsp;<span class="op" id="4736708">:=</span>&nbsp;<span class="builtinfunc" id="4736711">new</span><span class="op" id="4736714">(</span><span class="ident" id="4736715">big</span><span class="op" id="4736718">.</span><span class="ident" id="4736719">Int</span><span class="op" id="4736722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736725">p</span>&nbsp;<span class="op" id="4736727">:=</span>&nbsp;<span class="builtinfunc" id="4736730">new</span><span class="op" id="4736733">(</span><span class="ident" id="4736734">big</span><span class="op" id="4736737">.</span><span class="ident" id="4736738">Int</span><span class="op" id="4736741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736744">rem</span>&nbsp;<span class="op" id="4736748">:=</span>&nbsp;<span class="builtinfunc" id="4736751">new</span><span class="op" id="4736754">(</span><span class="ident" id="4736755">big</span><span class="op" id="4736758">.</span><span class="ident" id="4736759">Int</span><span class="op" id="4736762">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736765">one</span>&nbsp;<span class="op" id="4736769">:=</span>&nbsp;<span class="builtinfunc" id="4736772">new</span><span class="op" id="4736775">(</span><span class="ident" id="4736776">big</span><span class="op" id="4736779">.</span><span class="ident" id="4736780">Int</span><span class="op" id="4736783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736786">one</span><span class="op" id="4736789">.</span><span class="ident" id="4736790">SetInt64</span><span class="op" id="4736798">(</span><span class="num" id="4736799">1</span><span class="op" id="4736800">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4736803">GeneratePrimes</span><span class="op" id="4736817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4736820">for</span>&nbsp;<span class="op" id="4736824">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736828">_</span><span class="op" id="4736829">,</span>&nbsp;<span class="ident" id="4736831">err</span>&nbsp;<span class="op" id="4736835">=</span>&nbsp;<span class="ident" id="4736837">io</span><span class="op" id="4736839">.</span><span class="ident" id="4736840">ReadFull</span><span class="op" id="4736848">(</span><span class="ident" id="4736849">rand</span><span class="op" id="4736853">,</span>&nbsp;<span class="ident" id="4736855">qBytes</span><span class="op" id="4736861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4736865">if</span>&nbsp;<span class="ident" id="4736868">err</span>&nbsp;<span class="op" id="4736872">!=</span>&nbsp;<span class="builtintype" id="4736875">nil</span>&nbsp;<span class="op" id="4736879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4736884">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4736893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736898">qBytes</span><span class="op" id="4736904">[</span><span class="builtinfunc" id="4736905">len</span><span class="op" id="4736908">(</span><span class="ident" id="4736909">qBytes</span><span class="op" id="4736915">)</span><span class="op" id="4736916">-</span><span class="num" id="4736917">1</span><span class="op" id="4736918">]</span>&nbsp;<span class="op" id="4736920">|=</span>&nbsp;<span class="num" id="4736923">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736927">qBytes</span><span class="op" id="4736933">[</span><span class="num" id="4736934">0</span><span class="op" id="4736935">]</span>&nbsp;<span class="op" id="4736937">|=</span>&nbsp;<span class="num" id="4736940">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736947">q</span><span class="op" id="4736948">.</span><span class="ident" id="4736949">SetBytes</span><span class="op" id="4736957">(</span><span class="ident" id="4736958">qBytes</span><span class="op" id="4736964">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4736969">if</span>&nbsp;<span class="op" id="4736972">!</span><span class="ident" id="4736973">q</span><span class="op" id="4736974">.</span><span class="ident" id="4736975">ProbablyPrime</span><span class="op" id="4736988">(</span><span class="ident" id="4736989">numMRTests</span><span class="op" id="4736999">)</span>&nbsp;<span class="op" id="4737001">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737006">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4737017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737022">for</span>&nbsp;<span class="ident" id="4737026">i</span>&nbsp;<span class="op" id="4737028">:=</span>&nbsp;<span class="num" id="4737031">0</span><span class="op" id="4737032">;</span>&nbsp;<span class="ident" id="4737034">i</span>&nbsp;<span class="op" id="4737036">&lt;</span>&nbsp;<span class="num" id="4737038">4</span><span class="op" id="4737039">*</span><span class="ident" id="4737040">L</span><span class="op" id="4737041">;</span>&nbsp;<span class="ident" id="4737043">i</span><span class="op" id="4737044">++</span>&nbsp;<span class="op" id="4737047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737052">_</span><span class="op" id="4737053">,</span>&nbsp;<span class="ident" id="4737055">err</span>&nbsp;<span class="op" id="4737059">=</span>&nbsp;<span class="ident" id="4737061">io</span><span class="op" id="4737063">.</span><span class="ident" id="4737064">ReadFull</span><span class="op" id="4737072">(</span><span class="ident" id="4737073">rand</span><span class="op" id="4737077">,</span>&nbsp;<span class="ident" id="4737079">pBytes</span><span class="op" id="4737085">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737090">if</span>&nbsp;<span class="ident" id="4737093">err</span>&nbsp;<span class="op" id="4737097">!=</span>&nbsp;<span class="builtintype" id="4737100">nil</span>&nbsp;<span class="op" id="4737104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737110">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4737120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737126">pBytes</span><span class="op" id="4737132">[</span><span class="builtinfunc" id="4737133">len</span><span class="op" id="4737136">(</span><span class="ident" id="4737137">pBytes</span><span class="op" id="4737143">)</span><span class="op" id="4737144">-</span><span class="num" id="4737145">1</span><span class="op" id="4737146">]</span>&nbsp;<span class="op" id="4737148">|=</span>&nbsp;<span class="num" id="4737151">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737156">pBytes</span><span class="op" id="4737162">[</span><span class="num" id="4737163">0</span><span class="op" id="4737164">]</span>&nbsp;<span class="op" id="4737166">|=</span>&nbsp;<span class="num" id="4737169">0x80</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737178">p</span><span class="op" id="4737179">.</span><span class="ident" id="4737180">SetBytes</span><span class="op" id="4737188">(</span><span class="ident" id="4737189">pBytes</span><span class="op" id="4737195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737200">rem</span><span class="op" id="4737203">.</span><span class="ident" id="4737204">Mod</span><span class="op" id="4737207">(</span><span class="ident" id="4737208">p</span><span class="op" id="4737209">,</span>&nbsp;<span class="ident" id="4737211">q</span><span class="op" id="4737212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737217">rem</span><span class="op" id="4737220">.</span><span class="ident" id="4737221">Sub</span><span class="op" id="4737224">(</span><span class="ident" id="4737225">rem</span><span class="op" id="4737228">,</span>&nbsp;<span class="ident" id="4737230">one</span><span class="op" id="4737233">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737238">p</span><span class="op" id="4737239">.</span><span class="ident" id="4737240">Sub</span><span class="op" id="4737243">(</span><span class="ident" id="4737244">p</span><span class="op" id="4737245">,</span>&nbsp;<span class="ident" id="4737247">rem</span><span class="op" id="4737250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737255">if</span>&nbsp;<span class="ident" id="4737258">p</span><span class="op" id="4737259">.</span><span class="ident" id="4737260">BitLen</span><span class="op" id="4737266">(</span><span class="op" id="4737267">)</span>&nbsp;<span class="op" id="4737269">&lt;</span>&nbsp;<span class="ident" id="4737271">L</span>&nbsp;<span class="op" id="4737273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737279">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4737291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737297">if</span>&nbsp;<span class="op" id="4737300">!</span><span class="ident" id="4737301">p</span><span class="op" id="4737302">.</span><span class="ident" id="4737303">ProbablyPrime</span><span class="op" id="4737316">(</span><span class="ident" id="4737317">numMRTests</span><span class="op" id="4737327">)</span>&nbsp;<span class="op" id="4737329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737335">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4737347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737353">params</span><span class="op" id="4737359">.</span><span class="ident" id="4737360">P</span>&nbsp;<span class="op" id="4737362">=</span>&nbsp;<span class="ident" id="4737364">p</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737369">params</span><span class="op" id="4737375">.</span><span class="ident" id="4737376">Q</span>&nbsp;<span class="op" id="4737378">=</span>&nbsp;<span class="ident" id="4737380">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737385">break</span>&nbsp;<span class="ident" id="4737391">GeneratePrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4737408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4737411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737415">h</span>&nbsp;<span class="op" id="4737417">:=</span>&nbsp;<span class="builtinfunc" id="4737420">new</span><span class="op" id="4737423">(</span><span class="ident" id="4737424">big</span><span class="op" id="4737427">.</span><span class="ident" id="4737428">Int</span><span class="op" id="4737431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737434">h</span><span class="op" id="4737435">.</span><span class="ident" id="4737436">SetInt64</span><span class="op" id="4737444">(</span><span class="num" id="4737445">2</span><span class="op" id="4737446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737449">g</span>&nbsp;<span class="op" id="4737451">:=</span>&nbsp;<span class="builtinfunc" id="4737454">new</span><span class="op" id="4737457">(</span><span class="ident" id="4737458">big</span><span class="op" id="4737461">.</span><span class="ident" id="4737462">Int</span><span class="op" id="4737465">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737469">pm1</span>&nbsp;<span class="op" id="4737473">:=</span>&nbsp;<span class="builtinfunc" id="4737476">new</span><span class="op" id="4737479">(</span><span class="ident" id="4737480">big</span><span class="op" id="4737483">.</span><span class="ident" id="4737484">Int</span><span class="op" id="4737487">)</span><span class="op" id="4737488">.</span><span class="ident" id="4737489">Sub</span><span class="op" id="4737492">(</span><span class="ident" id="4737493">p</span><span class="op" id="4737494">,</span>&nbsp;<span class="ident" id="4737496">one</span><span class="op" id="4737499">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737502">e</span>&nbsp;<span class="op" id="4737504">:=</span>&nbsp;<span class="builtinfunc" id="4737507">new</span><span class="op" id="4737510">(</span><span class="ident" id="4737511">big</span><span class="op" id="4737514">.</span><span class="ident" id="4737515">Int</span><span class="op" id="4737518">)</span><span class="op" id="4737519">.</span><span class="ident" id="4737520">Div</span><span class="op" id="4737523">(</span><span class="ident" id="4737524">pm1</span><span class="op" id="4737527">,</span>&nbsp;<span class="ident" id="4737529">q</span><span class="op" id="4737530">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737534">for</span>&nbsp;<span class="op" id="4737538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737542">g</span><span class="op" id="4737543">.</span><span class="ident" id="4737544">Exp</span><span class="op" id="4737547">(</span><span class="ident" id="4737548">h</span><span class="op" id="4737549">,</span>&nbsp;<span class="ident" id="4737551">e</span><span class="op" id="4737552">,</span>&nbsp;<span class="ident" id="4737554">p</span><span class="op" id="4737555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737559">if</span>&nbsp;<span class="ident" id="4737562">g</span><span class="op" id="4737563">.</span><span class="ident" id="4737564">Cmp</span><span class="op" id="4737567">(</span><span class="ident" id="4737568">one</span><span class="op" id="4737571">)</span>&nbsp;<span class="op" id="4737573">==</span>&nbsp;<span class="num" id="4737576">0</span>&nbsp;<span class="op" id="4737578">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737583">h</span><span class="op" id="4737584">.</span><span class="ident" id="4737585">Add</span><span class="op" id="4737588">(</span><span class="ident" id="4737589">h</span><span class="op" id="4737590">,</span>&nbsp;<span class="ident" id="4737592">one</span><span class="op" id="4737595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737600">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4737611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737616">params</span><span class="op" id="4737622">.</span><span class="ident" id="4737623">G</span>&nbsp;<span class="op" id="4737625">=</span>&nbsp;<span class="ident" id="4737627">g</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737631">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4737639">}</span><br>
<span class="lineno"></span><span class="op" id="4737641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4737644">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&amp;private&nbsp;key&nbsp;pair.&nbsp;The&nbsp;Parameters&nbsp;of&nbsp;the</span><br>
<span class="lineno">150</span><span class="comment" id="4737718">//&nbsp;PrivateKey&nbsp;must&nbsp;already&nbsp;be&nbsp;valid&nbsp;(see&nbsp;GenerateParameters).</span><br>
<span class="lineno"></span><span class="keyword" id="4737780">func</span>&nbsp;<span class="ident" id="4737785">GenerateKey</span><span class="op" id="4737796">(</span><span class="ident" id="4737797">priv</span>&nbsp;<span class="op" id="4737802">*</span><span class="ident" id="4737803">PrivateKey</span><span class="op" id="4737813">,</span>&nbsp;<span class="ident" id="4737815">rand</span>&nbsp;<span class="ident" id="4737820">io</span><span class="op" id="4737822">.</span><span class="ident" id="4737823">Reader</span><span class="op" id="4737829">)</span>&nbsp;<span class="builtintype" id="4737831">error</span>&nbsp;<span class="op" id="4737837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737840">if</span>&nbsp;<span class="ident" id="4737843">priv</span><span class="op" id="4737847">.</span><span class="ident" id="4737848">P</span>&nbsp;<span class="op" id="4737850">==</span>&nbsp;<span class="builtintype" id="4737853">nil</span>&nbsp;<span class="op" id="4737857">||</span>&nbsp;<span class="ident" id="4737860">priv</span><span class="op" id="4737864">.</span><span class="ident" id="4737865">Q</span>&nbsp;<span class="op" id="4737867">==</span>&nbsp;<span class="builtintype" id="4737870">nil</span>&nbsp;<span class="op" id="4737874">||</span>&nbsp;<span class="ident" id="4737877">priv</span><span class="op" id="4737881">.</span><span class="ident" id="4737882">G</span>&nbsp;<span class="op" id="4737884">==</span>&nbsp;<span class="builtintype" id="4737887">nil</span>&nbsp;<span class="op" id="4737891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737895">return</span>&nbsp;<span class="ident" id="4737902">errors</span><span class="op" id="4737908">.</span><span class="ident" id="4737909">New</span><span class="op" id="4737912">(</span><span class="string" id="4737913">&#34;crypto/dsa:&nbsp;parameters&nbsp;not&nbsp;set&nbsp;up&nbsp;before&nbsp;generating&nbsp;key&#34;</span><span class="op" id="4737970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4737973">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737977">x</span>&nbsp;<span class="op" id="4737979">:=</span>&nbsp;<span class="builtinfunc" id="4737982">new</span><span class="op" id="4737985">(</span><span class="ident" id="4737986">big</span><span class="op" id="4737989">.</span><span class="ident" id="4737990">Int</span><span class="op" id="4737993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737996">xBytes</span>&nbsp;<span class="op" id="4738003">:=</span>&nbsp;<span class="builtinfunc" id="4738006">make</span><span class="op" id="4738010">(</span><span class="op" id="4738011">[</span><span class="op" id="4738012">]</span><span class="builtintype" id="4738013">byte</span><span class="op" id="4738017">,</span>&nbsp;<span class="ident" id="4738019">priv</span><span class="op" id="4738023">.</span><span class="ident" id="4738024">Q</span><span class="op" id="4738025">.</span><span class="ident" id="4738026">BitLen</span><span class="op" id="4738032">(</span><span class="op" id="4738033">)</span><span class="op" id="4738034">/</span><span class="num" id="4738035">8</span><span class="op" id="4738036">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4738040">for</span>&nbsp;<span class="op" id="4738044">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738048">_</span><span class="op" id="4738049">,</span>&nbsp;<span class="ident" id="4738051">err</span>&nbsp;<span class="op" id="4738055">:=</span>&nbsp;<span class="ident" id="4738058">io</span><span class="op" id="4738060">.</span><span class="ident" id="4738061">ReadFull</span><span class="op" id="4738069">(</span><span class="ident" id="4738070">rand</span><span class="op" id="4738074">,</span>&nbsp;<span class="ident" id="4738076">xBytes</span><span class="op" id="4738082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4738086">if</span>&nbsp;<span class="ident" id="4738089">err</span>&nbsp;<span class="op" id="4738093">!=</span>&nbsp;<span class="builtintype" id="4738096">nil</span>&nbsp;<span class="op" id="4738100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4738105">return</span>&nbsp;<span class="ident" id="4738112">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4738118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738122">x</span><span class="op" id="4738123">.</span><span class="ident" id="4738124">SetBytes</span><span class="op" id="4738132">(</span><span class="ident" id="4738133">xBytes</span><span class="op" id="4738139">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4738143">if</span>&nbsp;<span class="ident" id="4738146">x</span><span class="op" id="4738147">.</span><span class="ident" id="4738148">Sign</span><span class="op" id="4738152">(</span><span class="op" id="4738153">)</span>&nbsp;<span class="op" id="4738155">!=</span>&nbsp;<span class="num" id="4738158">0</span>&nbsp;<span class="op" id="4738160">&amp;&amp;</span>&nbsp;<span class="ident" id="4738163">x</span><span class="op" id="4738164">.</span><span class="ident" id="4738165">Cmp</span><span class="op" id="4738168">(</span><span class="ident" id="4738169">priv</span><span class="op" id="4738173">.</span><span class="ident" id="4738174">Q</span><span class="op" id="4738175">)</span>&nbsp;<span class="op" id="4738177">&lt;</span>&nbsp;<span class="num" id="4738179">0</span>&nbsp;<span class="op" id="4738181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4738186">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4738194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4738197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738201">priv</span><span class="op" id="4738205">.</span><span class="ident" id="4738206">X</span>&nbsp;<span class="op" id="4738208">=</span>&nbsp;<span class="ident" id="4738210">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738213">priv</span><span class="op" id="4738217">.</span><span class="ident" id="4738218">Y</span>&nbsp;<span class="op" id="4738220">=</span>&nbsp;<span class="builtinfunc" id="4738222">new</span><span class="op" id="4738225">(</span><span class="ident" id="4738226">big</span><span class="op" id="4738229">.</span><span class="ident" id="4738230">Int</span><span class="op" id="4738233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738236">priv</span><span class="op" id="4738240">.</span><span class="ident" id="4738241">Y</span><span class="op" id="4738242">.</span><span class="ident" id="4738243">Exp</span><span class="op" id="4738246">(</span><span class="ident" id="4738247">priv</span><span class="op" id="4738251">.</span><span class="ident" id="4738252">G</span><span class="op" id="4738253">,</span>&nbsp;<span class="ident" id="4738255">x</span><span class="op" id="4738256">,</span>&nbsp;<span class="ident" id="4738258">priv</span><span class="op" id="4738262">.</span><span class="ident" id="4738263">P</span><span class="op" id="4738264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4738267">return</span>&nbsp;<span class="builtintype" id="4738274">nil</span><br>
<span class="lineno"></span><span class="op" id="4738278">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4738281">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4738358">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4738436">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4738507">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">180</span><span class="keyword" id="4738545">func</span>&nbsp;<span class="ident" id="4738550">fermatInverse</span><span class="op" id="4738563">(</span><span class="ident" id="4738564">k</span><span class="op" id="4738565">,</span>&nbsp;<span class="ident" id="4738567">P</span>&nbsp;<span class="op" id="4738569">*</span><span class="ident" id="4738570">big</span><span class="op" id="4738573">.</span><span class="ident" id="4738574">Int</span><span class="op" id="4738577">)</span>&nbsp;<span class="op" id="4738579">*</span><span class="ident" id="4738580">big</span><span class="op" id="4738583">.</span><span class="ident" id="4738584">Int</span>&nbsp;<span class="op" id="4738588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738591">two</span>&nbsp;<span class="op" id="4738595">:=</span>&nbsp;<span class="ident" id="4738598">big</span><span class="op" id="4738601">.</span><span class="ident" id="4738602">NewInt</span><span class="op" id="4738608">(</span><span class="num" id="4738609">2</span><span class="op" id="4738610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738613">pMinus2</span>&nbsp;<span class="op" id="4738621">:=</span>&nbsp;<span class="builtinfunc" id="4738624">new</span><span class="op" id="4738627">(</span><span class="ident" id="4738628">big</span><span class="op" id="4738631">.</span><span class="ident" id="4738632">Int</span><span class="op" id="4738635">)</span><span class="op" id="4738636">.</span><span class="ident" id="4738637">Sub</span><span class="op" id="4738640">(</span><span class="ident" id="4738641">P</span><span class="op" id="4738642">,</span>&nbsp;<span class="ident" id="4738644">two</span><span class="op" id="4738647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4738650">return</span>&nbsp;<span class="builtinfunc" id="4738657">new</span><span class="op" id="4738660">(</span><span class="ident" id="4738661">big</span><span class="op" id="4738664">.</span><span class="ident" id="4738665">Int</span><span class="op" id="4738668">)</span><span class="op" id="4738669">.</span><span class="ident" id="4738670">Exp</span><span class="op" id="4738673">(</span><span class="ident" id="4738674">k</span><span class="op" id="4738675">,</span>&nbsp;<span class="ident" id="4738677">pMinus2</span><span class="op" id="4738684">,</span>&nbsp;<span class="ident" id="4738686">P</span><span class="op" id="4738687">)</span><br>
<span class="lineno"></span><span class="op" id="4738689">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="4738692">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4738772">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4738850">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4738929">//&nbsp;rand.</span><br>
<span class="lineno">190</span><span class="comment" id="4738938">//</span><br>
<span class="lineno"></span><span class="comment" id="4738941">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4739021">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4739096">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4739118">func</span>&nbsp;<span class="ident" id="4739123">Sign</span><span class="op" id="4739127">(</span><span class="ident" id="4739128">rand</span>&nbsp;<span class="ident" id="4739133">io</span><span class="op" id="4739135">.</span><span class="ident" id="4739136">Reader</span><span class="op" id="4739142">,</span>&nbsp;<span class="ident" id="4739144">priv</span>&nbsp;<span class="op" id="4739149">*</span><span class="ident" id="4739150">PrivateKey</span><span class="op" id="4739160">,</span>&nbsp;<span class="ident" id="4739162">hash</span>&nbsp;<span class="op" id="4739167">[</span><span class="op" id="4739168">]</span><span class="builtintype" id="4739169">byte</span><span class="op" id="4739173">)</span>&nbsp;<span class="op" id="4739175">(</span><span class="ident" id="4739176">r</span><span class="op" id="4739177">,</span>&nbsp;<span class="ident" id="4739179">s</span>&nbsp;<span class="op" id="4739181">*</span><span class="ident" id="4739182">big</span><span class="op" id="4739185">.</span><span class="ident" id="4739186">Int</span><span class="op" id="4739189">,</span>&nbsp;<span class="ident" id="4739191">err</span>&nbsp;<span class="builtintype" id="4739195">error</span><span class="op" id="4739200">)</span>&nbsp;<span class="op" id="4739202">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4739205">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.6</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4739234">n</span>&nbsp;<span class="op" id="4739236">:=</span>&nbsp;<span class="ident" id="4739239">priv</span><span class="op" id="4739243">.</span><span class="ident" id="4739244">Q</span><span class="op" id="4739245">.</span><span class="ident" id="4739246">BitLen</span><span class="op" id="4739252">(</span><span class="op" id="4739253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4739256">if</span>&nbsp;<span class="ident" id="4739259">n</span><span class="op" id="4739260">&amp;</span><span class="num" id="4739261">7</span>&nbsp;<span class="op" id="4739263">!=</span>&nbsp;<span class="num" id="4739266">0</span>&nbsp;<span class="op" id="4739268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4739272">err</span>&nbsp;<span class="op" id="4739276">=</span>&nbsp;<span class="ident" id="4739278">ErrInvalidPublicKey</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4739300">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4739308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4739311">n</span>&nbsp;<span class="op" id="4739313">&gt;&gt;=</span>&nbsp;<span class="num" id="4739317">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4739321">for</span>&nbsp;<span class="op" id="4739325">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4739329">k</span>&nbsp;<span class="op" id="4739331">:=</span>&nbsp;<span class="builtinfunc" id="4739334">new</span><span class="op" id="4739337">(</span><span class="ident" id="4739338">big</span><span class="op" id="4739341">.</span><span class="ident" id="4739342">Int</span><span class="op" id="4739345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4739349">buf</span>&nbsp;<span class="op" id="4739353">:=</span>&nbsp;<span class="builtinfunc" id="4739356">make</span><span class="op" id="4739360">(</span><span class="op" id="4739361">[</span><span class="op" id="4739362">]</span><span class="builtintype" id="4739363">byte</span><span class="op" id="4739367">,</span>&nbsp;<span class="ident" id="4739369">n</span><span class="op" id="4739370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4739374">for</span>&nbsp;<span class="op" id="4739378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4739383">_</span><span class="op" id="4739384">,</span>&nbsp;<span class="ident" id="4739386">err</span>&nbsp;<span class="op" id="4739390">=</span>&nbsp;<span class="ident" id="4739392">io</span><span class="op" id="4739394">.</span><span class="ident" id="4739395">ReadFull</span><span class="op" id="4739403">(</span><span class="ident" id="4739404">rand</span><span class="op" id="4739408">,</span>&nbsp;<span class="ident" id="4739410">buf</span><span class="op" id="4739413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4739418">if</span>&nbsp;<span class="ident" id="4739421">err</span>&nbsp;<span class="op" id="4739425">!=</span>&nbsp;<span class="builtintype" id="4739428">nil</span>&nbsp;<span class="op" id="4739432">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4739438">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4739448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4739453">k</span><span class="op" id="4739454">.</span><span class="ident" id="4739455">SetBytes</span><span class="op" id="4739463">(</span><span class="ident" id="4739464">buf</span><span class="op" id="4739467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4739472">if</span>&nbsp;<span class="ident" id="4739475">k</span><span class="op" id="4739476">.</span><span class="ident" id="4739477">Sign</span><span class="op" id="4739481">(</span><span class="op" id="4739482">)</span>&nbsp;<span class="op" id="4739484">&gt;</span>&nbsp;<span class="num" id="4739486">0</span>&nbsp;<span class="op" id="4739488">&amp;&amp;</span>&nbsp;<span class="ident" id="4739491">k</span><span class="op" id="4739492">.</span><span class="ident" id="4739493">Cmp</span><span class="op" id="4739496">(</span><span class="ident" id="4739497">priv</span><span class="op" id="4739501">.</span><span class="ident" id="4739502">Q</span><span class="op" id="4739503">)</span>&nbsp;<span class="op" id="4739505">&lt;</span>&nbsp;<span class="num" id="4739507">0</span>&nbsp;<span class="op" id="4739509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4739515">break</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4739524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4739528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4739533">kInv</span>&nbsp;<span class="op" id="4739538">:=</span>&nbsp;<span class="ident" id="4739541">fermatInverse</span><span class="op" id="4739554">(</span><span class="ident" id="4739555">k</span><span class="op" id="4739556">,</span>&nbsp;<span class="ident" id="4739558">priv</span><span class="op" id="4739562">.</span><span class="ident" id="4739563">Q</span><span class="op" id="4739564">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4739569">r</span>&nbsp;<span class="op" id="4739571">=</span>&nbsp;<span class="builtinfunc" id="4739573">new</span><span class="op" id="4739576">(</span><span class="ident" id="4739577">big</span><span class="op" id="4739580">.</span><span class="ident" id="4739581">Int</span><span class="op" id="4739584">)</span><span class="op" id="4739585">.</span><span class="ident" id="4739586">Exp</span><span class="op" id="4739589">(</span><span class="ident" id="4739590">priv</span><span class="op" id="4739594">.</span><span class="ident" id="4739595">G</span><span class="op" id="4739596">,</span>&nbsp;<span class="ident" id="4739598">k</span><span class="op" id="4739599">,</span>&nbsp;<span class="ident" id="4739601">priv</span><span class="op" id="4739605">.</span><span class="ident" id="4739606">P</span><span class="op" id="4739607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4739611">r</span><span class="op" id="4739612">.</span><span class="ident" id="4739613">Mod</span><span class="op" id="4739616">(</span><span class="ident" id="4739617">r</span><span class="op" id="4739618">,</span>&nbsp;<span class="ident" id="4739620">priv</span><span class="op" id="4739624">.</span><span class="ident" id="4739625">Q</span><span class="op" id="4739626">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4739631">if</span>&nbsp;<span class="ident" id="4739634">r</span><span class="op" id="4739635">.</span><span class="ident" id="4739636">Sign</span><span class="op" id="4739640">(</span><span class="op" id="4739641">)</span>&nbsp;<span class="op" id="4739643">==</span>&nbsp;<span class="num" id="4739646">0</span>&nbsp;<span class="op" id="4739648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4739653">continue</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4739664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4739669">z</span>&nbsp;<span class="op" id="4739671">:=</span>&nbsp;<span class="ident" id="4739674">k</span><span class="op" id="4739675">.</span><span class="ident" id="4739676">SetBytes</span><span class="op" id="4739684">(</span><span class="ident" id="4739685">hash</span><span class="op" id="4739689">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4739694">s</span>&nbsp;<span class="op" id="4739696">=</span>&nbsp;<span class="builtinfunc" id="4739698">new</span><span class="op" id="4739701">(</span><span class="ident" id="4739702">big</span><span class="op" id="4739705">.</span><span class="ident" id="4739706">Int</span><span class="op" id="4739709">)</span><span class="op" id="4739710">.</span><span class="ident" id="4739711">Mul</span><span class="op" id="4739714">(</span><span class="ident" id="4739715">priv</span><span class="op" id="4739719">.</span><span class="ident" id="4739720">X</span><span class="op" id="4739721">,</span>&nbsp;<span class="ident" id="4739723">r</span><span class="op" id="4739724">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4739728">s</span><span class="op" id="4739729">.</span><span class="ident" id="4739730">Add</span><span class="op" id="4739733">(</span><span class="ident" id="4739734">s</span><span class="op" id="4739735">,</span>&nbsp;<span class="ident" id="4739737">z</span><span class="op" id="4739738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4739742">s</span><span class="op" id="4739743">.</span><span class="ident" id="4739744">Mod</span><span class="op" id="4739747">(</span><span class="ident" id="4739748">s</span><span class="op" id="4739749">,</span>&nbsp;<span class="ident" id="4739751">priv</span><span class="op" id="4739755">.</span><span class="ident" id="4739756">Q</span><span class="op" id="4739757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4739761">s</span><span class="op" id="4739762">.</span><span class="ident" id="4739763">Mul</span><span class="op" id="4739766">(</span><span class="ident" id="4739767">s</span><span class="op" id="4739768">,</span>&nbsp;<span class="ident" id="4739770">kInv</span><span class="op" id="4739774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4739778">s</span><span class="op" id="4739779">.</span><span class="ident" id="4739780">Mod</span><span class="op" id="4739783">(</span><span class="ident" id="4739784">s</span><span class="op" id="4739785">,</span>&nbsp;<span class="ident" id="4739787">priv</span><span class="op" id="4739791">.</span><span class="ident" id="4739792">Q</span><span class="op" id="4739793">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4739798">if</span>&nbsp;<span class="ident" id="4739801">s</span><span class="op" id="4739802">.</span><span class="ident" id="4739803">Sign</span><span class="op" id="4739807">(</span><span class="op" id="4739808">)</span>&nbsp;<span class="op" id="4739810">!=</span>&nbsp;<span class="num" id="4739813">0</span>&nbsp;<span class="op" id="4739815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4739820">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4739828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4739831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4739835">return</span><br>
<span class="lineno"></span><span class="op" id="4739842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4739845">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4739924">//&nbsp;reports&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno">245</span><span class="comment" id="4739967">//</span><br>
<span class="lineno"></span><span class="comment" id="4739970">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4740050">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4740125">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4740147">func</span>&nbsp;<span class="ident" id="4740152">Verify</span><span class="op" id="4740158">(</span><span class="ident" id="4740159">pub</span>&nbsp;<span class="op" id="4740163">*</span><span class="ident" id="4740164">PublicKey</span><span class="op" id="4740173">,</span>&nbsp;<span class="ident" id="4740175">hash</span>&nbsp;<span class="op" id="4740180">[</span><span class="op" id="4740181">]</span><span class="builtintype" id="4740182">byte</span><span class="op" id="4740186">,</span>&nbsp;<span class="ident" id="4740188">r</span><span class="op" id="4740189">,</span>&nbsp;<span class="ident" id="4740191">s</span>&nbsp;<span class="op" id="4740193">*</span><span class="ident" id="4740194">big</span><span class="op" id="4740197">.</span><span class="ident" id="4740198">Int</span><span class="op" id="4740201">)</span>&nbsp;<span class="builtintype" id="4740203">bool</span>&nbsp;<span class="op" id="4740208">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4740211">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4740240">if</span>&nbsp;<span class="ident" id="4740243">r</span><span class="op" id="4740244">.</span><span class="ident" id="4740245">Sign</span><span class="op" id="4740249">(</span><span class="op" id="4740250">)</span>&nbsp;<span class="op" id="4740252">&lt;</span>&nbsp;<span class="num" id="4740254">1</span>&nbsp;<span class="op" id="4740256">||</span>&nbsp;<span class="ident" id="4740259">r</span><span class="op" id="4740260">.</span><span class="ident" id="4740261">Cmp</span><span class="op" id="4740264">(</span><span class="ident" id="4740265">pub</span><span class="op" id="4740268">.</span><span class="ident" id="4740269">Q</span><span class="op" id="4740270">)</span>&nbsp;<span class="op" id="4740272">&gt;=</span>&nbsp;<span class="num" id="4740275">0</span>&nbsp;<span class="op" id="4740277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4740281">return</span>&nbsp;<span class="builtintype" id="4740288">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4740295">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4740298">if</span>&nbsp;<span class="ident" id="4740301">s</span><span class="op" id="4740302">.</span><span class="ident" id="4740303">Sign</span><span class="op" id="4740307">(</span><span class="op" id="4740308">)</span>&nbsp;<span class="op" id="4740310">&lt;</span>&nbsp;<span class="num" id="4740312">1</span>&nbsp;<span class="op" id="4740314">||</span>&nbsp;<span class="ident" id="4740317">s</span><span class="op" id="4740318">.</span><span class="ident" id="4740319">Cmp</span><span class="op" id="4740322">(</span><span class="ident" id="4740323">pub</span><span class="op" id="4740326">.</span><span class="ident" id="4740327">Q</span><span class="op" id="4740328">)</span>&nbsp;<span class="op" id="4740330">&gt;=</span>&nbsp;<span class="num" id="4740333">0</span>&nbsp;<span class="op" id="4740335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4740339">return</span>&nbsp;<span class="builtintype" id="4740346">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4740353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740357">w</span>&nbsp;<span class="op" id="4740359">:=</span>&nbsp;<span class="builtinfunc" id="4740362">new</span><span class="op" id="4740365">(</span><span class="ident" id="4740366">big</span><span class="op" id="4740369">.</span><span class="ident" id="4740370">Int</span><span class="op" id="4740373">)</span><span class="op" id="4740374">.</span><span class="ident" id="4740375">ModInverse</span><span class="op" id="4740385">(</span><span class="ident" id="4740386">s</span><span class="op" id="4740387">,</span>&nbsp;<span class="ident" id="4740389">pub</span><span class="op" id="4740392">.</span><span class="ident" id="4740393">Q</span><span class="op" id="4740394">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740398">n</span>&nbsp;<span class="op" id="4740400">:=</span>&nbsp;<span class="ident" id="4740403">pub</span><span class="op" id="4740406">.</span><span class="ident" id="4740407">Q</span><span class="op" id="4740408">.</span><span class="ident" id="4740409">BitLen</span><span class="op" id="4740415">(</span><span class="op" id="4740416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4740419">if</span>&nbsp;<span class="ident" id="4740422">n</span><span class="op" id="4740423">&amp;</span><span class="num" id="4740424">7</span>&nbsp;<span class="op" id="4740426">!=</span>&nbsp;<span class="num" id="4740429">0</span>&nbsp;<span class="op" id="4740431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4740435">return</span>&nbsp;<span class="builtintype" id="4740442">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4740449">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740452">z</span>&nbsp;<span class="op" id="4740454">:=</span>&nbsp;<span class="builtinfunc" id="4740457">new</span><span class="op" id="4740460">(</span><span class="ident" id="4740461">big</span><span class="op" id="4740464">.</span><span class="ident" id="4740465">Int</span><span class="op" id="4740468">)</span><span class="op" id="4740469">.</span><span class="ident" id="4740470">SetBytes</span><span class="op" id="4740478">(</span><span class="ident" id="4740479">hash</span><span class="op" id="4740483">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740487">u1</span>&nbsp;<span class="op" id="4740490">:=</span>&nbsp;<span class="builtinfunc" id="4740493">new</span><span class="op" id="4740496">(</span><span class="ident" id="4740497">big</span><span class="op" id="4740500">.</span><span class="ident" id="4740501">Int</span><span class="op" id="4740504">)</span><span class="op" id="4740505">.</span><span class="ident" id="4740506">Mul</span><span class="op" id="4740509">(</span><span class="ident" id="4740510">z</span><span class="op" id="4740511">,</span>&nbsp;<span class="ident" id="4740513">w</span><span class="op" id="4740514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740517">u1</span><span class="op" id="4740519">.</span><span class="ident" id="4740520">Mod</span><span class="op" id="4740523">(</span><span class="ident" id="4740524">u1</span><span class="op" id="4740526">,</span>&nbsp;<span class="ident" id="4740528">pub</span><span class="op" id="4740531">.</span><span class="ident" id="4740532">Q</span><span class="op" id="4740533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740536">u2</span>&nbsp;<span class="op" id="4740539">:=</span>&nbsp;<span class="ident" id="4740542">w</span><span class="op" id="4740543">.</span><span class="ident" id="4740544">Mul</span><span class="op" id="4740547">(</span><span class="ident" id="4740548">r</span><span class="op" id="4740549">,</span>&nbsp;<span class="ident" id="4740551">w</span><span class="op" id="4740552">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740555">u2</span><span class="op" id="4740557">.</span><span class="ident" id="4740558">Mod</span><span class="op" id="4740561">(</span><span class="ident" id="4740562">u2</span><span class="op" id="4740564">,</span>&nbsp;<span class="ident" id="4740566">pub</span><span class="op" id="4740569">.</span><span class="ident" id="4740570">Q</span><span class="op" id="4740571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740574">v</span>&nbsp;<span class="op" id="4740576">:=</span>&nbsp;<span class="ident" id="4740579">u1</span><span class="op" id="4740581">.</span><span class="ident" id="4740582">Exp</span><span class="op" id="4740585">(</span><span class="ident" id="4740586">pub</span><span class="op" id="4740589">.</span><span class="ident" id="4740590">G</span><span class="op" id="4740591">,</span>&nbsp;<span class="ident" id="4740593">u1</span><span class="op" id="4740595">,</span>&nbsp;<span class="ident" id="4740597">pub</span><span class="op" id="4740600">.</span><span class="ident" id="4740601">P</span><span class="op" id="4740602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740605">u2</span><span class="op" id="4740607">.</span><span class="ident" id="4740608">Exp</span><span class="op" id="4740611">(</span><span class="ident" id="4740612">pub</span><span class="op" id="4740615">.</span><span class="ident" id="4740616">Y</span><span class="op" id="4740617">,</span>&nbsp;<span class="ident" id="4740619">u2</span><span class="op" id="4740621">,</span>&nbsp;<span class="ident" id="4740623">pub</span><span class="op" id="4740626">.</span><span class="ident" id="4740627">P</span><span class="op" id="4740628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740631">v</span><span class="op" id="4740632">.</span><span class="ident" id="4740633">Mul</span><span class="op" id="4740636">(</span><span class="ident" id="4740637">v</span><span class="op" id="4740638">,</span>&nbsp;<span class="ident" id="4740640">u2</span><span class="op" id="4740642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740645">v</span><span class="op" id="4740646">.</span><span class="ident" id="4740647">Mod</span><span class="op" id="4740650">(</span><span class="ident" id="4740651">v</span><span class="op" id="4740652">,</span>&nbsp;<span class="ident" id="4740654">pub</span><span class="op" id="4740657">.</span><span class="ident" id="4740658">P</span><span class="op" id="4740659">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740662">v</span><span class="op" id="4740663">.</span><span class="ident" id="4740664">Mod</span><span class="op" id="4740667">(</span><span class="ident" id="4740668">v</span><span class="op" id="4740669">,</span>&nbsp;<span class="ident" id="4740671">pub</span><span class="op" id="4740674">.</span><span class="ident" id="4740675">Q</span><span class="op" id="4740676">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4740680">return</span>&nbsp;<span class="ident" id="4740687">v</span><span class="op" id="4740688">.</span><span class="ident" id="4740689">Cmp</span><span class="op" id="4740692">(</span><span class="ident" id="4740693">r</span><span class="op" id="4740694">)</span>&nbsp;<span class="op" id="4740696">==</span>&nbsp;<span class="num" id="4740699">0</span><br>
<span class="lineno"></span><span class="op" id="4740701">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
