<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3131326">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3131382">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3131436">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3131487">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3131565">package</span>&nbsp;<span class="ident" id="3131573">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3131578">import</span>&nbsp;<span class="op" id="3131585">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3131588">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3131599">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3131606">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3131609">func</span>&nbsp;<span class="ident" id="3131614">sockaddrToUDP</span><span class="op" id="3131627">(</span><span class="ident" id="3131628">sa</span>&nbsp;<span class="ident" id="3131631">syscall</span><span class="op" id="3131638">.</span><span class="ident" id="3131639">Sockaddr</span><span class="op" id="3131647">)</span>&nbsp;<span class="ident" id="3131649">Addr</span>&nbsp;<span class="op" id="3131654">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131657">switch</span>&nbsp;<span class="ident" id="3131664">sa</span>&nbsp;<span class="op" id="3131667">:=</span>&nbsp;<span class="ident" id="3131670">sa</span><span class="op" id="3131672">.</span><span class="op" id="3131673">(</span><span class="keyword" id="3131674">type</span><span class="op" id="3131678">)</span>&nbsp;<span class="op" id="3131680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131683">case</span>&nbsp;<span class="op" id="3131688">*</span><span class="ident" id="3131689">syscall</span><span class="op" id="3131696">.</span><span class="ident" id="3131697">SockaddrInet4</span><span class="op" id="3131710">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131714">return</span>&nbsp;<span class="op" id="3131721">&amp;</span><span class="ident" id="3131722">UDPAddr</span><span class="op" id="3131729">{</span><span class="ident" id="3131730">IP</span><span class="op" id="3131732">:</span>&nbsp;<span class="ident" id="3131734">sa</span><span class="op" id="3131736">.</span><span class="ident" id="3131737">Addr</span><span class="op" id="3131741">[</span><span class="num" id="3131742">0</span><span class="op" id="3131743">:</span><span class="op" id="3131744">]</span><span class="op" id="3131745">,</span>&nbsp;<span class="ident" id="3131747">Port</span><span class="op" id="3131751">:</span>&nbsp;<span class="ident" id="3131753">sa</span><span class="op" id="3131755">.</span><span class="ident" id="3131756">Port</span><span class="op" id="3131760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131763">case</span>&nbsp;<span class="op" id="3131768">*</span><span class="ident" id="3131769">syscall</span><span class="op" id="3131776">.</span><span class="ident" id="3131777">SockaddrInet6</span><span class="op" id="3131790">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131794">return</span>&nbsp;<span class="op" id="3131801">&amp;</span><span class="ident" id="3131802">UDPAddr</span><span class="op" id="3131809">{</span><span class="ident" id="3131810">IP</span><span class="op" id="3131812">:</span>&nbsp;<span class="ident" id="3131814">sa</span><span class="op" id="3131816">.</span><span class="ident" id="3131817">Addr</span><span class="op" id="3131821">[</span><span class="num" id="3131822">0</span><span class="op" id="3131823">:</span><span class="op" id="3131824">]</span><span class="op" id="3131825">,</span>&nbsp;<span class="ident" id="3131827">Port</span><span class="op" id="3131831">:</span>&nbsp;<span class="ident" id="3131833">sa</span><span class="op" id="3131835">.</span><span class="ident" id="3131836">Port</span><span class="op" id="3131840">,</span>&nbsp;<span class="ident" id="3131842">Zone</span><span class="op" id="3131846">:</span>&nbsp;<span class="ident" id="3131848">zoneToString</span><span class="op" id="3131860">(</span><span class="builtintype" id="3131861">int</span><span class="op" id="3131864">(</span><span class="ident" id="3131865">sa</span><span class="op" id="3131867">.</span><span class="ident" id="3131868">ZoneId</span><span class="op" id="3131874">)</span><span class="op" id="3131875">)</span><span class="op" id="3131876">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3131879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131882">return</span>&nbsp;<span class="ident" id="3131889">nil</span><br>
<span class="lineno"></span><span class="op" id="3131893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3131896">func</span>&nbsp;<span class="op" id="3131901">(</span><span class="ident" id="3131902">a</span>&nbsp;<span class="op" id="3131904">*</span><span class="ident" id="3131905">UDPAddr</span><span class="op" id="3131912">)</span>&nbsp;<span class="ident" id="3131914">family</span><span class="op" id="3131920">(</span><span class="op" id="3131921">)</span>&nbsp;<span class="builtintype" id="3131923">int</span>&nbsp;<span class="op" id="3131927">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131930">if</span>&nbsp;<span class="ident" id="3131933">a</span>&nbsp;<span class="op" id="3131935">==</span>&nbsp;<span class="ident" id="3131938">nil</span>&nbsp;<span class="op" id="3131942">||</span>&nbsp;<span class="builtinfunc" id="3131945">len</span><span class="op" id="3131948">(</span><span class="ident" id="3131949">a</span><span class="op" id="3131950">.</span><span class="ident" id="3131951">IP</span><span class="op" id="3131953">)</span>&nbsp;<span class="op" id="3131955">&lt;=</span>&nbsp;<span class="ident" id="3131958">IPv4len</span>&nbsp;<span class="op" id="3131966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131970">return</span>&nbsp;<span class="ident" id="3131977">syscall</span><span class="op" id="3131984">.</span><span class="ident" id="3131985">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3131994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131997">if</span>&nbsp;<span class="ident" id="3132000">a</span><span class="op" id="3132001">.</span><span class="ident" id="3132002">IP</span><span class="op" id="3132004">.</span><span class="ident" id="3132005">To4</span><span class="op" id="3132008">(</span><span class="op" id="3132009">)</span>&nbsp;<span class="op" id="3132011">!=</span>&nbsp;<span class="ident" id="3132014">nil</span>&nbsp;<span class="op" id="3132018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3132022">return</span>&nbsp;<span class="ident" id="3132029">syscall</span><span class="op" id="3132036">.</span><span class="ident" id="3132037">AF_INET</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3132046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3132049">return</span>&nbsp;<span class="ident" id="3132056">syscall</span><span class="op" id="3132063">.</span><span class="ident" id="3132064">AF_INET6</span><br>
<span class="lineno"></span><span class="op" id="3132073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3132076">func</span>&nbsp;<span class="op" id="3132081">(</span><span class="ident" id="3132082">a</span>&nbsp;<span class="op" id="3132084">*</span><span class="ident" id="3132085">UDPAddr</span><span class="op" id="3132092">)</span>&nbsp;<span class="ident" id="3132094">isWildcard</span><span class="op" id="3132104">(</span><span class="op" id="3132105">)</span>&nbsp;<span class="builtintype" id="3132107">bool</span>&nbsp;<span class="op" id="3132112">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3132115">if</span>&nbsp;<span class="ident" id="3132118">a</span>&nbsp;<span class="op" id="3132120">==</span>&nbsp;<span class="ident" id="3132123">nil</span>&nbsp;<span class="op" id="3132127">||</span>&nbsp;<span class="ident" id="3132130">a</span><span class="op" id="3132131">.</span><span class="ident" id="3132132">IP</span>&nbsp;<span class="op" id="3132135">==</span>&nbsp;<span class="ident" id="3132138">nil</span>&nbsp;<span class="op" id="3132142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3132146">return</span>&nbsp;<span class="builtintype" id="3132153">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3132159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3132162">return</span>&nbsp;<span class="ident" id="3132169">a</span><span class="op" id="3132170">.</span><span class="ident" id="3132171">IP</span><span class="op" id="3132173">.</span><span class="ident" id="3132174">IsUnspecified</span><span class="op" id="3132187">(</span><span class="op" id="3132188">)</span><br>
<span class="lineno"></span><span class="op" id="3132190">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="3132193">func</span>&nbsp;<span class="op" id="3132198">(</span><span class="ident" id="3132199">a</span>&nbsp;<span class="op" id="3132201">*</span><span class="ident" id="3132202">UDPAddr</span><span class="op" id="3132209">)</span>&nbsp;<span class="ident" id="3132211">sockaddr</span><span class="op" id="3132219">(</span><span class="ident" id="3132220">family</span>&nbsp;<span class="builtintype" id="3132227">int</span><span class="op" id="3132230">)</span>&nbsp;<span class="op" id="3132232">(</span><span class="ident" id="3132233">syscall</span><span class="op" id="3132240">.</span><span class="ident" id="3132241">Sockaddr</span><span class="op" id="3132249">,</span>&nbsp;<span class="builtintype" id="3132251">error</span><span class="op" id="3132256">)</span>&nbsp;<span class="op" id="3132258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3132261">if</span>&nbsp;<span class="ident" id="3132264">a</span>&nbsp;<span class="op" id="3132266">==</span>&nbsp;<span class="ident" id="3132269">nil</span>&nbsp;<span class="op" id="3132273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3132277">return</span>&nbsp;<span class="ident" id="3132284">nil</span><span class="op" id="3132287">,</span>&nbsp;<span class="ident" id="3132289">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3132294">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3132297">return</span>&nbsp;<span class="ident" id="3132304">ipToSockaddr</span><span class="op" id="3132316">(</span><span class="ident" id="3132317">family</span><span class="op" id="3132323">,</span>&nbsp;<span class="ident" id="3132325">a</span><span class="op" id="3132326">.</span><span class="ident" id="3132327">IP</span><span class="op" id="3132329">,</span>&nbsp;<span class="ident" id="3132331">a</span><span class="op" id="3132332">.</span><span class="ident" id="3132333">Port</span><span class="op" id="3132337">,</span>&nbsp;<span class="ident" id="3132339">a</span><span class="op" id="3132340">.</span><span class="ident" id="3132341">Zone</span><span class="op" id="3132345">)</span><br>
<span class="lineno"></span><span class="op" id="3132347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3132350">//&nbsp;UDPConn&nbsp;is&nbsp;the&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;and&nbsp;PacketConn&nbsp;interfaces</span><br>
<span class="lineno"></span><span class="comment" id="3132421">//&nbsp;for&nbsp;UDP&nbsp;network&nbsp;connections.</span><br>
<span class="lineno">50</span><span class="keyword" id="3132453">type</span>&nbsp;<span class="ident" id="3132458">UDPConn</span>&nbsp;<span class="keyword" id="3132466">struct</span>&nbsp;<span class="op" id="3132473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3132476">conn</span><br>
<span class="lineno"></span><span class="op" id="3132481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3132484">func</span>&nbsp;<span class="ident" id="3132489">newUDPConn</span><span class="op" id="3132499">(</span><span class="ident" id="3132500">fd</span>&nbsp;<span class="op" id="3132503">*</span><span class="ident" id="3132504">netFD</span><span class="op" id="3132509">)</span>&nbsp;<span class="op" id="3132511">*</span><span class="ident" id="3132512">UDPConn</span>&nbsp;<span class="op" id="3132520">{</span>&nbsp;<span class="keyword" id="3132522">return</span>&nbsp;<span class="op" id="3132529">&amp;</span><span class="ident" id="3132530">UDPConn</span><span class="op" id="3132537">{</span><span class="ident" id="3132538">conn</span><span class="op" id="3132542">{</span><span class="ident" id="3132543">fd</span><span class="op" id="3132545">}</span><span class="op" id="3132546">}</span>&nbsp;<span class="op" id="3132548">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="3132551">//&nbsp;ReadFromUDP&nbsp;reads&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3132621">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;return&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3132692">//&nbsp;that&nbsp;was&nbsp;on&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3132719">//</span><br>
<span class="lineno">60</span><span class="comment" id="3132722">//&nbsp;ReadFromUDP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3132786">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3132853">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3132873">func</span>&nbsp;<span class="op" id="3132878">(</span><span class="ident" id="3132879">c</span>&nbsp;<span class="op" id="3132881">*</span><span class="ident" id="3132882">UDPConn</span><span class="op" id="3132889">)</span>&nbsp;<span class="ident" id="3132891">ReadFromUDP</span><span class="op" id="3132902">(</span><span class="ident" id="3132903">b</span>&nbsp;<span class="op" id="3132905">[</span><span class="op" id="3132906">]</span><span class="builtintype" id="3132907">byte</span><span class="op" id="3132911">)</span>&nbsp;<span class="op" id="3132913">(</span><span class="ident" id="3132914">n</span>&nbsp;<span class="builtintype" id="3132916">int</span><span class="op" id="3132919">,</span>&nbsp;<span class="ident" id="3132921">addr</span>&nbsp;<span class="op" id="3132926">*</span><span class="ident" id="3132927">UDPAddr</span><span class="op" id="3132934">,</span>&nbsp;<span class="ident" id="3132936">err</span>&nbsp;<span class="builtintype" id="3132940">error</span><span class="op" id="3132945">)</span>&nbsp;<span class="op" id="3132947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3132950">if</span>&nbsp;<span class="op" id="3132953">!</span><span class="ident" id="3132954">c</span><span class="op" id="3132955">.</span><span class="ident" id="3132956">ok</span><span class="op" id="3132958">(</span><span class="op" id="3132959">)</span>&nbsp;<span class="op" id="3132961">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3132965">return</span>&nbsp;<span class="num" id="3132972">0</span><span class="op" id="3132973">,</span>&nbsp;<span class="ident" id="3132975">nil</span><span class="op" id="3132978">,</span>&nbsp;<span class="ident" id="3132980">syscall</span><span class="op" id="3132987">.</span><span class="ident" id="3132988">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3132996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3132999">n</span><span class="op" id="3133000">,</span>&nbsp;<span class="ident" id="3133002">sa</span><span class="op" id="3133004">,</span>&nbsp;<span class="ident" id="3133006">err</span>&nbsp;<span class="op" id="3133010">:=</span>&nbsp;<span class="ident" id="3133013">c</span><span class="op" id="3133014">.</span><span class="ident" id="3133015">fd</span><span class="op" id="3133017">.</span><span class="ident" id="3133018">readFrom</span><span class="op" id="3133026">(</span><span class="ident" id="3133027">b</span><span class="op" id="3133028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3133031">switch</span>&nbsp;<span class="ident" id="3133038">sa</span>&nbsp;<span class="op" id="3133041">:=</span>&nbsp;<span class="ident" id="3133044">sa</span><span class="op" id="3133046">.</span><span class="op" id="3133047">(</span><span class="keyword" id="3133048">type</span><span class="op" id="3133052">)</span>&nbsp;<span class="op" id="3133054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3133057">case</span>&nbsp;<span class="op" id="3133062">*</span><span class="ident" id="3133063">syscall</span><span class="op" id="3133070">.</span><span class="ident" id="3133071">SockaddrInet4</span><span class="op" id="3133084">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3133088">addr</span>&nbsp;<span class="op" id="3133093">=</span>&nbsp;<span class="op" id="3133095">&amp;</span><span class="ident" id="3133096">UDPAddr</span><span class="op" id="3133103">{</span><span class="ident" id="3133104">IP</span><span class="op" id="3133106">:</span>&nbsp;<span class="ident" id="3133108">sa</span><span class="op" id="3133110">.</span><span class="ident" id="3133111">Addr</span><span class="op" id="3133115">[</span><span class="num" id="3133116">0</span><span class="op" id="3133117">:</span><span class="op" id="3133118">]</span><span class="op" id="3133119">,</span>&nbsp;<span class="ident" id="3133121">Port</span><span class="op" id="3133125">:</span>&nbsp;<span class="ident" id="3133127">sa</span><span class="op" id="3133129">.</span><span class="ident" id="3133130">Port</span><span class="op" id="3133134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3133137">case</span>&nbsp;<span class="op" id="3133142">*</span><span class="ident" id="3133143">syscall</span><span class="op" id="3133150">.</span><span class="ident" id="3133151">SockaddrInet6</span><span class="op" id="3133164">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3133168">addr</span>&nbsp;<span class="op" id="3133173">=</span>&nbsp;<span class="op" id="3133175">&amp;</span><span class="ident" id="3133176">UDPAddr</span><span class="op" id="3133183">{</span><span class="ident" id="3133184">IP</span><span class="op" id="3133186">:</span>&nbsp;<span class="ident" id="3133188">sa</span><span class="op" id="3133190">.</span><span class="ident" id="3133191">Addr</span><span class="op" id="3133195">[</span><span class="num" id="3133196">0</span><span class="op" id="3133197">:</span><span class="op" id="3133198">]</span><span class="op" id="3133199">,</span>&nbsp;<span class="ident" id="3133201">Port</span><span class="op" id="3133205">:</span>&nbsp;<span class="ident" id="3133207">sa</span><span class="op" id="3133209">.</span><span class="ident" id="3133210">Port</span><span class="op" id="3133214">,</span>&nbsp;<span class="ident" id="3133216">Zone</span><span class="op" id="3133220">:</span>&nbsp;<span class="ident" id="3133222">zoneToString</span><span class="op" id="3133234">(</span><span class="builtintype" id="3133235">int</span><span class="op" id="3133238">(</span><span class="ident" id="3133239">sa</span><span class="op" id="3133241">.</span><span class="ident" id="3133242">ZoneId</span><span class="op" id="3133248">)</span><span class="op" id="3133249">)</span><span class="op" id="3133250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3133253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3133256">return</span><br>
<span class="lineno">75</span><span class="op" id="3133263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3133266">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3133321">func</span>&nbsp;<span class="op" id="3133326">(</span><span class="ident" id="3133327">c</span>&nbsp;<span class="op" id="3133329">*</span><span class="ident" id="3133330">UDPConn</span><span class="op" id="3133337">)</span>&nbsp;<span class="ident" id="3133339">ReadFrom</span><span class="op" id="3133347">(</span><span class="ident" id="3133348">b</span>&nbsp;<span class="op" id="3133350">[</span><span class="op" id="3133351">]</span><span class="builtintype" id="3133352">byte</span><span class="op" id="3133356">)</span>&nbsp;<span class="op" id="3133358">(</span><span class="builtintype" id="3133359">int</span><span class="op" id="3133362">,</span>&nbsp;<span class="ident" id="3133364">Addr</span><span class="op" id="3133368">,</span>&nbsp;<span class="builtintype" id="3133370">error</span><span class="op" id="3133375">)</span>&nbsp;<span class="op" id="3133377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3133380">if</span>&nbsp;<span class="op" id="3133383">!</span><span class="ident" id="3133384">c</span><span class="op" id="3133385">.</span><span class="ident" id="3133386">ok</span><span class="op" id="3133388">(</span><span class="op" id="3133389">)</span>&nbsp;<span class="op" id="3133391">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3133395">return</span>&nbsp;<span class="num" id="3133402">0</span><span class="op" id="3133403">,</span>&nbsp;<span class="ident" id="3133405">nil</span><span class="op" id="3133408">,</span>&nbsp;<span class="ident" id="3133410">syscall</span><span class="op" id="3133417">.</span><span class="ident" id="3133418">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3133426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3133429">n</span><span class="op" id="3133430">,</span>&nbsp;<span class="ident" id="3133432">addr</span><span class="op" id="3133436">,</span>&nbsp;<span class="ident" id="3133438">err</span>&nbsp;<span class="op" id="3133442">:=</span>&nbsp;<span class="ident" id="3133445">c</span><span class="op" id="3133446">.</span><span class="ident" id="3133447">ReadFromUDP</span><span class="op" id="3133458">(</span><span class="ident" id="3133459">b</span><span class="op" id="3133460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3133463">return</span>&nbsp;<span class="ident" id="3133470">n</span><span class="op" id="3133471">,</span>&nbsp;<span class="ident" id="3133473">addr</span><span class="op" id="3133477">.</span><span class="ident" id="3133478">toAddr</span><span class="op" id="3133484">(</span><span class="op" id="3133485">)</span><span class="op" id="3133486">,</span>&nbsp;<span class="ident" id="3133488">err</span><br>
<span class="lineno"></span><span class="op" id="3133492">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3133495">//&nbsp;ReadMsgUDP&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3133563">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="3133631">//&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3133699">//&nbsp;flags&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno">90</span><span class="comment" id="3133766">//&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="3133777">func</span>&nbsp;<span class="op" id="3133782">(</span><span class="ident" id="3133783">c</span>&nbsp;<span class="op" id="3133785">*</span><span class="ident" id="3133786">UDPConn</span><span class="op" id="3133793">)</span>&nbsp;<span class="ident" id="3133795">ReadMsgUDP</span><span class="op" id="3133805">(</span><span class="ident" id="3133806">b</span><span class="op" id="3133807">,</span>&nbsp;<span class="ident" id="3133809">oob</span>&nbsp;<span class="op" id="3133813">[</span><span class="op" id="3133814">]</span><span class="builtintype" id="3133815">byte</span><span class="op" id="3133819">)</span>&nbsp;<span class="op" id="3133821">(</span><span class="ident" id="3133822">n</span><span class="op" id="3133823">,</span>&nbsp;<span class="ident" id="3133825">oobn</span><span class="op" id="3133829">,</span>&nbsp;<span class="ident" id="3133831">flags</span>&nbsp;<span class="builtintype" id="3133837">int</span><span class="op" id="3133840">,</span>&nbsp;<span class="ident" id="3133842">addr</span>&nbsp;<span class="op" id="3133847">*</span><span class="ident" id="3133848">UDPAddr</span><span class="op" id="3133855">,</span>&nbsp;<span class="ident" id="3133857">err</span>&nbsp;<span class="builtintype" id="3133861">error</span><span class="op" id="3133866">)</span>&nbsp;<span class="op" id="3133868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3133871">if</span>&nbsp;<span class="op" id="3133874">!</span><span class="ident" id="3133875">c</span><span class="op" id="3133876">.</span><span class="ident" id="3133877">ok</span><span class="op" id="3133879">(</span><span class="op" id="3133880">)</span>&nbsp;<span class="op" id="3133882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3133886">return</span>&nbsp;<span class="num" id="3133893">0</span><span class="op" id="3133894">,</span>&nbsp;<span class="num" id="3133896">0</span><span class="op" id="3133897">,</span>&nbsp;<span class="num" id="3133899">0</span><span class="op" id="3133900">,</span>&nbsp;<span class="ident" id="3133902">nil</span><span class="op" id="3133905">,</span>&nbsp;<span class="ident" id="3133907">syscall</span><span class="op" id="3133914">.</span><span class="ident" id="3133915">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3133923">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3133926">var</span>&nbsp;<span class="ident" id="3133930">sa</span>&nbsp;<span class="ident" id="3133933">syscall</span><span class="op" id="3133940">.</span><span class="ident" id="3133941">Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3133951">n</span><span class="op" id="3133952">,</span>&nbsp;<span class="ident" id="3133954">oobn</span><span class="op" id="3133958">,</span>&nbsp;<span class="ident" id="3133960">flags</span><span class="op" id="3133965">,</span>&nbsp;<span class="ident" id="3133967">sa</span><span class="op" id="3133969">,</span>&nbsp;<span class="ident" id="3133971">err</span>&nbsp;<span class="op" id="3133975">=</span>&nbsp;<span class="ident" id="3133977">c</span><span class="op" id="3133978">.</span><span class="ident" id="3133979">fd</span><span class="op" id="3133981">.</span><span class="ident" id="3133982">readMsg</span><span class="op" id="3133989">(</span><span class="ident" id="3133990">b</span><span class="op" id="3133991">,</span>&nbsp;<span class="ident" id="3133993">oob</span><span class="op" id="3133996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3133999">switch</span>&nbsp;<span class="ident" id="3134006">sa</span>&nbsp;<span class="op" id="3134009">:=</span>&nbsp;<span class="ident" id="3134012">sa</span><span class="op" id="3134014">.</span><span class="op" id="3134015">(</span><span class="keyword" id="3134016">type</span><span class="op" id="3134020">)</span>&nbsp;<span class="op" id="3134022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134025">case</span>&nbsp;<span class="op" id="3134030">*</span><span class="ident" id="3134031">syscall</span><span class="op" id="3134038">.</span><span class="ident" id="3134039">SockaddrInet4</span><span class="op" id="3134052">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3134056">addr</span>&nbsp;<span class="op" id="3134061">=</span>&nbsp;<span class="op" id="3134063">&amp;</span><span class="ident" id="3134064">UDPAddr</span><span class="op" id="3134071">{</span><span class="ident" id="3134072">IP</span><span class="op" id="3134074">:</span>&nbsp;<span class="ident" id="3134076">sa</span><span class="op" id="3134078">.</span><span class="ident" id="3134079">Addr</span><span class="op" id="3134083">[</span><span class="num" id="3134084">0</span><span class="op" id="3134085">:</span><span class="op" id="3134086">]</span><span class="op" id="3134087">,</span>&nbsp;<span class="ident" id="3134089">Port</span><span class="op" id="3134093">:</span>&nbsp;<span class="ident" id="3134095">sa</span><span class="op" id="3134097">.</span><span class="ident" id="3134098">Port</span><span class="op" id="3134102">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134105">case</span>&nbsp;<span class="op" id="3134110">*</span><span class="ident" id="3134111">syscall</span><span class="op" id="3134118">.</span><span class="ident" id="3134119">SockaddrInet6</span><span class="op" id="3134132">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3134136">addr</span>&nbsp;<span class="op" id="3134141">=</span>&nbsp;<span class="op" id="3134143">&amp;</span><span class="ident" id="3134144">UDPAddr</span><span class="op" id="3134151">{</span><span class="ident" id="3134152">IP</span><span class="op" id="3134154">:</span>&nbsp;<span class="ident" id="3134156">sa</span><span class="op" id="3134158">.</span><span class="ident" id="3134159">Addr</span><span class="op" id="3134163">[</span><span class="num" id="3134164">0</span><span class="op" id="3134165">:</span><span class="op" id="3134166">]</span><span class="op" id="3134167">,</span>&nbsp;<span class="ident" id="3134169">Port</span><span class="op" id="3134173">:</span>&nbsp;<span class="ident" id="3134175">sa</span><span class="op" id="3134177">.</span><span class="ident" id="3134178">Port</span><span class="op" id="3134182">,</span>&nbsp;<span class="ident" id="3134184">Zone</span><span class="op" id="3134188">:</span>&nbsp;<span class="ident" id="3134190">zoneToString</span><span class="op" id="3134202">(</span><span class="builtintype" id="3134203">int</span><span class="op" id="3134206">(</span><span class="ident" id="3134207">sa</span><span class="op" id="3134209">.</span><span class="ident" id="3134210">ZoneId</span><span class="op" id="3134216">)</span><span class="op" id="3134217">)</span><span class="op" id="3134218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3134221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134224">return</span><br>
<span class="lineno"></span><span class="op" id="3134231">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="3134234">//&nbsp;WriteToUDP&nbsp;writes&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3134303">//&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3134314">//</span><br>
<span class="lineno"></span><span class="comment" id="3134317">//&nbsp;WriteToUDP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">110</span><span class="comment" id="3134380">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3134447">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3134516">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3134529">func</span>&nbsp;<span class="op" id="3134534">(</span><span class="ident" id="3134535">c</span>&nbsp;<span class="op" id="3134537">*</span><span class="ident" id="3134538">UDPConn</span><span class="op" id="3134545">)</span>&nbsp;<span class="ident" id="3134547">WriteToUDP</span><span class="op" id="3134557">(</span><span class="ident" id="3134558">b</span>&nbsp;<span class="op" id="3134560">[</span><span class="op" id="3134561">]</span><span class="builtintype" id="3134562">byte</span><span class="op" id="3134566">,</span>&nbsp;<span class="ident" id="3134568">addr</span>&nbsp;<span class="op" id="3134573">*</span><span class="ident" id="3134574">UDPAddr</span><span class="op" id="3134581">)</span>&nbsp;<span class="op" id="3134583">(</span><span class="builtintype" id="3134584">int</span><span class="op" id="3134587">,</span>&nbsp;<span class="builtintype" id="3134589">error</span><span class="op" id="3134594">)</span>&nbsp;<span class="op" id="3134596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134599">if</span>&nbsp;<span class="op" id="3134602">!</span><span class="ident" id="3134603">c</span><span class="op" id="3134604">.</span><span class="ident" id="3134605">ok</span><span class="op" id="3134607">(</span><span class="op" id="3134608">)</span>&nbsp;<span class="op" id="3134610">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134614">return</span>&nbsp;<span class="num" id="3134621">0</span><span class="op" id="3134622">,</span>&nbsp;<span class="ident" id="3134624">syscall</span><span class="op" id="3134631">.</span><span class="ident" id="3134632">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3134640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134643">if</span>&nbsp;<span class="ident" id="3134646">c</span><span class="op" id="3134647">.</span><span class="ident" id="3134648">fd</span><span class="op" id="3134650">.</span><span class="ident" id="3134651">isConnected</span>&nbsp;<span class="op" id="3134663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134667">return</span>&nbsp;<span class="num" id="3134674">0</span><span class="op" id="3134675">,</span>&nbsp;<span class="op" id="3134677">&amp;</span><span class="ident" id="3134678">OpError</span><span class="op" id="3134685">{</span><span class="string" id="3134686">&#34;write&#34;</span><span class="op" id="3134693">,</span>&nbsp;<span class="ident" id="3134695">c</span><span class="op" id="3134696">.</span><span class="ident" id="3134697">fd</span><span class="op" id="3134699">.</span><span class="ident" id="3134700">net</span><span class="op" id="3134703">,</span>&nbsp;<span class="ident" id="3134705">addr</span><span class="op" id="3134709">,</span>&nbsp;<span class="ident" id="3134711">ErrWriteToConnected</span><span class="op" id="3134730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3134733">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134736">if</span>&nbsp;<span class="ident" id="3134739">addr</span>&nbsp;<span class="op" id="3134744">==</span>&nbsp;<span class="ident" id="3134747">nil</span>&nbsp;<span class="op" id="3134751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134755">return</span>&nbsp;<span class="num" id="3134762">0</span><span class="op" id="3134763">,</span>&nbsp;<span class="op" id="3134765">&amp;</span><span class="ident" id="3134766">OpError</span><span class="op" id="3134773">{</span><span class="ident" id="3134774">Op</span><span class="op" id="3134776">:</span>&nbsp;<span class="string" id="3134778">&#34;write&#34;</span><span class="op" id="3134785">,</span>&nbsp;<span class="ident" id="3134787">Net</span><span class="op" id="3134790">:</span>&nbsp;<span class="ident" id="3134792">c</span><span class="op" id="3134793">.</span><span class="ident" id="3134794">fd</span><span class="op" id="3134796">.</span><span class="ident" id="3134797">net</span><span class="op" id="3134800">,</span>&nbsp;<span class="ident" id="3134802">Addr</span><span class="op" id="3134806">:</span>&nbsp;<span class="ident" id="3134808">nil</span><span class="op" id="3134811">,</span>&nbsp;<span class="ident" id="3134813">Err</span><span class="op" id="3134816">:</span>&nbsp;<span class="ident" id="3134818">errMissingAddress</span><span class="op" id="3134835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3134838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3134841">sa</span><span class="op" id="3134843">,</span>&nbsp;<span class="ident" id="3134845">err</span>&nbsp;<span class="op" id="3134849">:=</span>&nbsp;<span class="ident" id="3134852">addr</span><span class="op" id="3134856">.</span><span class="ident" id="3134857">sockaddr</span><span class="op" id="3134865">(</span><span class="ident" id="3134866">c</span><span class="op" id="3134867">.</span><span class="ident" id="3134868">fd</span><span class="op" id="3134870">.</span><span class="ident" id="3134871">family</span><span class="op" id="3134877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134880">if</span>&nbsp;<span class="ident" id="3134883">err</span>&nbsp;<span class="op" id="3134887">!=</span>&nbsp;<span class="ident" id="3134890">nil</span>&nbsp;<span class="op" id="3134894">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134898">return</span>&nbsp;<span class="num" id="3134905">0</span><span class="op" id="3134906">,</span>&nbsp;<span class="op" id="3134908">&amp;</span><span class="ident" id="3134909">OpError</span><span class="op" id="3134916">{</span><span class="string" id="3134917">&#34;write&#34;</span><span class="op" id="3134924">,</span>&nbsp;<span class="ident" id="3134926">c</span><span class="op" id="3134927">.</span><span class="ident" id="3134928">fd</span><span class="op" id="3134930">.</span><span class="ident" id="3134931">net</span><span class="op" id="3134934">,</span>&nbsp;<span class="ident" id="3134936">addr</span><span class="op" id="3134940">,</span>&nbsp;<span class="ident" id="3134942">err</span><span class="op" id="3134945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3134948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134951">return</span>&nbsp;<span class="ident" id="3134958">c</span><span class="op" id="3134959">.</span><span class="ident" id="3134960">fd</span><span class="op" id="3134962">.</span><span class="ident" id="3134963">writeTo</span><span class="op" id="3134970">(</span><span class="ident" id="3134971">b</span><span class="op" id="3134972">,</span>&nbsp;<span class="ident" id="3134974">sa</span><span class="op" id="3134976">)</span><br>
<span class="lineno"></span><span class="op" id="3134978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="3134981">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3135034">func</span>&nbsp;<span class="op" id="3135039">(</span><span class="ident" id="3135040">c</span>&nbsp;<span class="op" id="3135042">*</span><span class="ident" id="3135043">UDPConn</span><span class="op" id="3135050">)</span>&nbsp;<span class="ident" id="3135052">WriteTo</span><span class="op" id="3135059">(</span><span class="ident" id="3135060">b</span>&nbsp;<span class="op" id="3135062">[</span><span class="op" id="3135063">]</span><span class="builtintype" id="3135064">byte</span><span class="op" id="3135068">,</span>&nbsp;<span class="ident" id="3135070">addr</span>&nbsp;<span class="ident" id="3135075">Addr</span><span class="op" id="3135079">)</span>&nbsp;<span class="op" id="3135081">(</span><span class="builtintype" id="3135082">int</span><span class="op" id="3135085">,</span>&nbsp;<span class="builtintype" id="3135087">error</span><span class="op" id="3135092">)</span>&nbsp;<span class="op" id="3135094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135097">if</span>&nbsp;<span class="op" id="3135100">!</span><span class="ident" id="3135101">c</span><span class="op" id="3135102">.</span><span class="ident" id="3135103">ok</span><span class="op" id="3135105">(</span><span class="op" id="3135106">)</span>&nbsp;<span class="op" id="3135108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135112">return</span>&nbsp;<span class="num" id="3135119">0</span><span class="op" id="3135120">,</span>&nbsp;<span class="ident" id="3135122">syscall</span><span class="op" id="3135129">.</span><span class="ident" id="3135130">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3135138">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3135141">a</span><span class="op" id="3135142">,</span>&nbsp;<span class="ident" id="3135144">ok</span>&nbsp;<span class="op" id="3135147">:=</span>&nbsp;<span class="ident" id="3135150">addr</span><span class="op" id="3135154">.</span><span class="op" id="3135155">(</span><span class="op" id="3135156">*</span><span class="ident" id="3135157">UDPAddr</span><span class="op" id="3135164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135167">if</span>&nbsp;<span class="op" id="3135170">!</span><span class="ident" id="3135171">ok</span>&nbsp;<span class="op" id="3135174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135178">return</span>&nbsp;<span class="num" id="3135185">0</span><span class="op" id="3135186">,</span>&nbsp;<span class="op" id="3135188">&amp;</span><span class="ident" id="3135189">OpError</span><span class="op" id="3135196">{</span><span class="string" id="3135197">&#34;write&#34;</span><span class="op" id="3135204">,</span>&nbsp;<span class="ident" id="3135206">c</span><span class="op" id="3135207">.</span><span class="ident" id="3135208">fd</span><span class="op" id="3135210">.</span><span class="ident" id="3135211">net</span><span class="op" id="3135214">,</span>&nbsp;<span class="ident" id="3135216">addr</span><span class="op" id="3135220">,</span>&nbsp;<span class="ident" id="3135222">syscall</span><span class="op" id="3135229">.</span><span class="ident" id="3135230">EINVAL</span><span class="op" id="3135236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3135239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135242">return</span>&nbsp;<span class="ident" id="3135249">c</span><span class="op" id="3135250">.</span><span class="ident" id="3135251">WriteToUDP</span><span class="op" id="3135261">(</span><span class="ident" id="3135262">b</span><span class="op" id="3135263">,</span>&nbsp;<span class="ident" id="3135265">a</span><span class="op" id="3135266">)</span><br>
<span class="lineno">140</span><span class="op" id="3135268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3135271">//&nbsp;WriteMsgUDP&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3135342">//&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3135409">//&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">145</span><span class="keyword" id="3135461">func</span>&nbsp;<span class="op" id="3135466">(</span><span class="ident" id="3135467">c</span>&nbsp;<span class="op" id="3135469">*</span><span class="ident" id="3135470">UDPConn</span><span class="op" id="3135477">)</span>&nbsp;<span class="ident" id="3135479">WriteMsgUDP</span><span class="op" id="3135490">(</span><span class="ident" id="3135491">b</span><span class="op" id="3135492">,</span>&nbsp;<span class="ident" id="3135494">oob</span>&nbsp;<span class="op" id="3135498">[</span><span class="op" id="3135499">]</span><span class="builtintype" id="3135500">byte</span><span class="op" id="3135504">,</span>&nbsp;<span class="ident" id="3135506">addr</span>&nbsp;<span class="op" id="3135511">*</span><span class="ident" id="3135512">UDPAddr</span><span class="op" id="3135519">)</span>&nbsp;<span class="op" id="3135521">(</span><span class="ident" id="3135522">n</span><span class="op" id="3135523">,</span>&nbsp;<span class="ident" id="3135525">oobn</span>&nbsp;<span class="builtintype" id="3135530">int</span><span class="op" id="3135533">,</span>&nbsp;<span class="ident" id="3135535">err</span>&nbsp;<span class="builtintype" id="3135539">error</span><span class="op" id="3135544">)</span>&nbsp;<span class="op" id="3135546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135549">if</span>&nbsp;<span class="op" id="3135552">!</span><span class="ident" id="3135553">c</span><span class="op" id="3135554">.</span><span class="ident" id="3135555">ok</span><span class="op" id="3135557">(</span><span class="op" id="3135558">)</span>&nbsp;<span class="op" id="3135560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135564">return</span>&nbsp;<span class="num" id="3135571">0</span><span class="op" id="3135572">,</span>&nbsp;<span class="num" id="3135574">0</span><span class="op" id="3135575">,</span>&nbsp;<span class="ident" id="3135577">syscall</span><span class="op" id="3135584">.</span><span class="ident" id="3135585">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3135593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135596">if</span>&nbsp;<span class="ident" id="3135599">c</span><span class="op" id="3135600">.</span><span class="ident" id="3135601">fd</span><span class="op" id="3135603">.</span><span class="ident" id="3135604">isConnected</span>&nbsp;<span class="op" id="3135616">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135620">return</span>&nbsp;<span class="num" id="3135627">0</span><span class="op" id="3135628">,</span>&nbsp;<span class="num" id="3135630">0</span><span class="op" id="3135631">,</span>&nbsp;<span class="op" id="3135633">&amp;</span><span class="ident" id="3135634">OpError</span><span class="op" id="3135641">{</span><span class="string" id="3135642">&#34;write&#34;</span><span class="op" id="3135649">,</span>&nbsp;<span class="ident" id="3135651">c</span><span class="op" id="3135652">.</span><span class="ident" id="3135653">fd</span><span class="op" id="3135655">.</span><span class="ident" id="3135656">net</span><span class="op" id="3135659">,</span>&nbsp;<span class="ident" id="3135661">addr</span><span class="op" id="3135665">,</span>&nbsp;<span class="ident" id="3135667">ErrWriteToConnected</span><span class="op" id="3135686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3135689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135692">if</span>&nbsp;<span class="ident" id="3135695">addr</span>&nbsp;<span class="op" id="3135700">==</span>&nbsp;<span class="ident" id="3135703">nil</span>&nbsp;<span class="op" id="3135707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135711">return</span>&nbsp;<span class="num" id="3135718">0</span><span class="op" id="3135719">,</span>&nbsp;<span class="num" id="3135721">0</span><span class="op" id="3135722">,</span>&nbsp;<span class="op" id="3135724">&amp;</span><span class="ident" id="3135725">OpError</span><span class="op" id="3135732">{</span><span class="ident" id="3135733">Op</span><span class="op" id="3135735">:</span>&nbsp;<span class="string" id="3135737">&#34;write&#34;</span><span class="op" id="3135744">,</span>&nbsp;<span class="ident" id="3135746">Net</span><span class="op" id="3135749">:</span>&nbsp;<span class="ident" id="3135751">c</span><span class="op" id="3135752">.</span><span class="ident" id="3135753">fd</span><span class="op" id="3135755">.</span><span class="ident" id="3135756">net</span><span class="op" id="3135759">,</span>&nbsp;<span class="ident" id="3135761">Addr</span><span class="op" id="3135765">:</span>&nbsp;<span class="ident" id="3135767">nil</span><span class="op" id="3135770">,</span>&nbsp;<span class="ident" id="3135772">Err</span><span class="op" id="3135775">:</span>&nbsp;<span class="ident" id="3135777">errMissingAddress</span><span class="op" id="3135794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3135797">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3135800">sa</span><span class="op" id="3135802">,</span>&nbsp;<span class="ident" id="3135804">err</span>&nbsp;<span class="op" id="3135808">:=</span>&nbsp;<span class="ident" id="3135811">addr</span><span class="op" id="3135815">.</span><span class="ident" id="3135816">sockaddr</span><span class="op" id="3135824">(</span><span class="ident" id="3135825">c</span><span class="op" id="3135826">.</span><span class="ident" id="3135827">fd</span><span class="op" id="3135829">.</span><span class="ident" id="3135830">family</span><span class="op" id="3135836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135839">if</span>&nbsp;<span class="ident" id="3135842">err</span>&nbsp;<span class="op" id="3135846">!=</span>&nbsp;<span class="ident" id="3135849">nil</span>&nbsp;<span class="op" id="3135853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135857">return</span>&nbsp;<span class="num" id="3135864">0</span><span class="op" id="3135865">,</span>&nbsp;<span class="num" id="3135867">0</span><span class="op" id="3135868">,</span>&nbsp;<span class="op" id="3135870">&amp;</span><span class="ident" id="3135871">OpError</span><span class="op" id="3135878">{</span><span class="string" id="3135879">&#34;write&#34;</span><span class="op" id="3135886">,</span>&nbsp;<span class="ident" id="3135888">c</span><span class="op" id="3135889">.</span><span class="ident" id="3135890">fd</span><span class="op" id="3135892">.</span><span class="ident" id="3135893">net</span><span class="op" id="3135896">,</span>&nbsp;<span class="ident" id="3135898">addr</span><span class="op" id="3135902">,</span>&nbsp;<span class="ident" id="3135904">err</span><span class="op" id="3135907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3135910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135913">return</span>&nbsp;<span class="ident" id="3135920">c</span><span class="op" id="3135921">.</span><span class="ident" id="3135922">fd</span><span class="op" id="3135924">.</span><span class="ident" id="3135925">writeMsg</span><span class="op" id="3135933">(</span><span class="ident" id="3135934">b</span><span class="op" id="3135935">,</span>&nbsp;<span class="ident" id="3135937">oob</span><span class="op" id="3135940">,</span>&nbsp;<span class="ident" id="3135942">sa</span><span class="op" id="3135944">)</span><br>
<span class="lineno">160</span><span class="op" id="3135946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3135949">//&nbsp;DialUDP&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="3136017">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,&nbsp;or&nbsp;&#34;udp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil,&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3136088">//&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno">165</span><span class="keyword" id="3136137">func</span>&nbsp;<span class="ident" id="3136142">DialUDP</span><span class="op" id="3136149">(</span><span class="ident" id="3136150">net</span>&nbsp;<span class="builtintype" id="3136154">string</span><span class="op" id="3136160">,</span>&nbsp;<span class="ident" id="3136162">laddr</span><span class="op" id="3136167">,</span>&nbsp;<span class="ident" id="3136169">raddr</span>&nbsp;<span class="op" id="3136175">*</span><span class="ident" id="3136176">UDPAddr</span><span class="op" id="3136183">)</span>&nbsp;<span class="op" id="3136185">(</span><span class="op" id="3136186">*</span><span class="ident" id="3136187">UDPConn</span><span class="op" id="3136194">,</span>&nbsp;<span class="builtintype" id="3136196">error</span><span class="op" id="3136201">)</span>&nbsp;<span class="op" id="3136203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136206">switch</span>&nbsp;<span class="ident" id="3136213">net</span>&nbsp;<span class="op" id="3136217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136220">case</span>&nbsp;<span class="string" id="3136225">&#34;udp&#34;</span><span class="op" id="3136230">,</span>&nbsp;<span class="string" id="3136232">&#34;udp4&#34;</span><span class="op" id="3136238">,</span>&nbsp;<span class="string" id="3136240">&#34;udp6&#34;</span><span class="op" id="3136246">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136249">default</span><span class="op" id="3136256">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136260">return</span>&nbsp;<span class="ident" id="3136267">nil</span><span class="op" id="3136270">,</span>&nbsp;<span class="op" id="3136272">&amp;</span><span class="ident" id="3136273">OpError</span><span class="op" id="3136280">{</span><span class="ident" id="3136281">Op</span><span class="op" id="3136283">:</span>&nbsp;<span class="string" id="3136285">&#34;dial&#34;</span><span class="op" id="3136291">,</span>&nbsp;<span class="ident" id="3136293">Net</span><span class="op" id="3136296">:</span>&nbsp;<span class="ident" id="3136298">net</span><span class="op" id="3136301">,</span>&nbsp;<span class="ident" id="3136303">Addr</span><span class="op" id="3136307">:</span>&nbsp;<span class="ident" id="3136309">raddr</span><span class="op" id="3136314">,</span>&nbsp;<span class="ident" id="3136316">Err</span><span class="op" id="3136319">:</span>&nbsp;<span class="ident" id="3136321">UnknownNetworkError</span><span class="op" id="3136340">(</span><span class="ident" id="3136341">net</span><span class="op" id="3136344">)</span><span class="op" id="3136345">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3136348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136351">if</span>&nbsp;<span class="ident" id="3136354">raddr</span>&nbsp;<span class="op" id="3136360">==</span>&nbsp;<span class="ident" id="3136363">nil</span>&nbsp;<span class="op" id="3136367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136371">return</span>&nbsp;<span class="ident" id="3136378">nil</span><span class="op" id="3136381">,</span>&nbsp;<span class="op" id="3136383">&amp;</span><span class="ident" id="3136384">OpError</span><span class="op" id="3136391">{</span><span class="ident" id="3136392">Op</span><span class="op" id="3136394">:</span>&nbsp;<span class="string" id="3136396">&#34;dial&#34;</span><span class="op" id="3136402">,</span>&nbsp;<span class="ident" id="3136404">Net</span><span class="op" id="3136407">:</span>&nbsp;<span class="ident" id="3136409">net</span><span class="op" id="3136412">,</span>&nbsp;<span class="ident" id="3136414">Addr</span><span class="op" id="3136418">:</span>&nbsp;<span class="ident" id="3136420">nil</span><span class="op" id="3136423">,</span>&nbsp;<span class="ident" id="3136425">Err</span><span class="op" id="3136428">:</span>&nbsp;<span class="ident" id="3136430">errMissingAddress</span><span class="op" id="3136447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3136450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136453">return</span>&nbsp;<span class="ident" id="3136460">dialUDP</span><span class="op" id="3136467">(</span><span class="ident" id="3136468">net</span><span class="op" id="3136471">,</span>&nbsp;<span class="ident" id="3136473">laddr</span><span class="op" id="3136478">,</span>&nbsp;<span class="ident" id="3136480">raddr</span><span class="op" id="3136485">,</span>&nbsp;<span class="ident" id="3136487">noDeadline</span><span class="op" id="3136497">)</span><br>
<span class="lineno">175</span><span class="op" id="3136499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3136502">func</span>&nbsp;<span class="ident" id="3136507">dialUDP</span><span class="op" id="3136514">(</span><span class="ident" id="3136515">net</span>&nbsp;<span class="builtintype" id="3136519">string</span><span class="op" id="3136525">,</span>&nbsp;<span class="ident" id="3136527">laddr</span><span class="op" id="3136532">,</span>&nbsp;<span class="ident" id="3136534">raddr</span>&nbsp;<span class="op" id="3136540">*</span><span class="ident" id="3136541">UDPAddr</span><span class="op" id="3136548">,</span>&nbsp;<span class="ident" id="3136550">deadline</span>&nbsp;<span class="ident" id="3136559">time</span><span class="op" id="3136563">.</span><span class="ident" id="3136564">Time</span><span class="op" id="3136568">)</span>&nbsp;<span class="op" id="3136570">(</span><span class="op" id="3136571">*</span><span class="ident" id="3136572">UDPConn</span><span class="op" id="3136579">,</span>&nbsp;<span class="builtintype" id="3136581">error</span><span class="op" id="3136586">)</span>&nbsp;<span class="op" id="3136588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136591">fd</span><span class="op" id="3136593">,</span>&nbsp;<span class="ident" id="3136595">err</span>&nbsp;<span class="op" id="3136599">:=</span>&nbsp;<span class="ident" id="3136602">internetSocket</span><span class="op" id="3136616">(</span><span class="ident" id="3136617">net</span><span class="op" id="3136620">,</span>&nbsp;<span class="ident" id="3136622">laddr</span><span class="op" id="3136627">,</span>&nbsp;<span class="ident" id="3136629">raddr</span><span class="op" id="3136634">,</span>&nbsp;<span class="ident" id="3136636">deadline</span><span class="op" id="3136644">,</span>&nbsp;<span class="ident" id="3136646">syscall</span><span class="op" id="3136653">.</span><span class="ident" id="3136654">SOCK_DGRAM</span><span class="op" id="3136664">,</span>&nbsp;<span class="num" id="3136666">0</span><span class="op" id="3136667">,</span>&nbsp;<span class="string" id="3136669">&#34;dial&#34;</span><span class="op" id="3136675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136678">if</span>&nbsp;<span class="ident" id="3136681">err</span>&nbsp;<span class="op" id="3136685">!=</span>&nbsp;<span class="ident" id="3136688">nil</span>&nbsp;<span class="op" id="3136692">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136696">return</span>&nbsp;<span class="ident" id="3136703">nil</span><span class="op" id="3136706">,</span>&nbsp;<span class="op" id="3136708">&amp;</span><span class="ident" id="3136709">OpError</span><span class="op" id="3136716">{</span><span class="ident" id="3136717">Op</span><span class="op" id="3136719">:</span>&nbsp;<span class="string" id="3136721">&#34;dial&#34;</span><span class="op" id="3136727">,</span>&nbsp;<span class="ident" id="3136729">Net</span><span class="op" id="3136732">:</span>&nbsp;<span class="ident" id="3136734">net</span><span class="op" id="3136737">,</span>&nbsp;<span class="ident" id="3136739">Addr</span><span class="op" id="3136743">:</span>&nbsp;<span class="ident" id="3136745">raddr</span><span class="op" id="3136750">,</span>&nbsp;<span class="ident" id="3136752">Err</span><span class="op" id="3136755">:</span>&nbsp;<span class="ident" id="3136757">err</span><span class="op" id="3136760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3136763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136766">return</span>&nbsp;<span class="ident" id="3136773">newUDPConn</span><span class="op" id="3136783">(</span><span class="ident" id="3136784">fd</span><span class="op" id="3136786">)</span><span class="op" id="3136787">,</span>&nbsp;<span class="ident" id="3136789">nil</span><br>
<span class="lineno"></span><span class="op" id="3136793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="3136796">//&nbsp;ListenUDP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;UDP&nbsp;packets&nbsp;addressed&nbsp;to&nbsp;the&nbsp;local</span><br>
<span class="lineno"></span><span class="comment" id="3136865">//&nbsp;address&nbsp;laddr.&nbsp;&nbsp;Net&nbsp;must&nbsp;be&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,&nbsp;or&nbsp;&#34;udp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="3136936">//&nbsp;a&nbsp;port&nbsp;of&nbsp;0,&nbsp;ListenUDP&nbsp;will&nbsp;choose&nbsp;an&nbsp;available&nbsp;port.</span><br>
<span class="lineno"></span><span class="comment" id="3136993">//&nbsp;The&nbsp;LocalAddr&nbsp;method&nbsp;of&nbsp;the&nbsp;returned&nbsp;UDPConn&nbsp;can&nbsp;be&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3137056">//&nbsp;discover&nbsp;the&nbsp;port.&nbsp;&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo</span><br>
<span class="lineno">190</span><span class="comment" id="3137126">//&nbsp;methods&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;UDP&nbsp;packets&nbsp;with&nbsp;per-packet</span><br>
<span class="lineno"></span><span class="comment" id="3137197">//&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3137212">func</span>&nbsp;<span class="ident" id="3137217">ListenUDP</span><span class="op" id="3137226">(</span><span class="ident" id="3137227">net</span>&nbsp;<span class="builtintype" id="3137231">string</span><span class="op" id="3137237">,</span>&nbsp;<span class="ident" id="3137239">laddr</span>&nbsp;<span class="op" id="3137245">*</span><span class="ident" id="3137246">UDPAddr</span><span class="op" id="3137253">)</span>&nbsp;<span class="op" id="3137255">(</span><span class="op" id="3137256">*</span><span class="ident" id="3137257">UDPConn</span><span class="op" id="3137264">,</span>&nbsp;<span class="builtintype" id="3137266">error</span><span class="op" id="3137271">)</span>&nbsp;<span class="op" id="3137273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137276">switch</span>&nbsp;<span class="ident" id="3137283">net</span>&nbsp;<span class="op" id="3137287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137290">case</span>&nbsp;<span class="string" id="3137295">&#34;udp&#34;</span><span class="op" id="3137300">,</span>&nbsp;<span class="string" id="3137302">&#34;udp4&#34;</span><span class="op" id="3137308">,</span>&nbsp;<span class="string" id="3137310">&#34;udp6&#34;</span><span class="op" id="3137316">:</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137319">default</span><span class="op" id="3137326">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137330">return</span>&nbsp;<span class="ident" id="3137337">nil</span><span class="op" id="3137340">,</span>&nbsp;<span class="op" id="3137342">&amp;</span><span class="ident" id="3137343">OpError</span><span class="op" id="3137350">{</span><span class="ident" id="3137351">Op</span><span class="op" id="3137353">:</span>&nbsp;<span class="string" id="3137355">&#34;listen&#34;</span><span class="op" id="3137363">,</span>&nbsp;<span class="ident" id="3137365">Net</span><span class="op" id="3137368">:</span>&nbsp;<span class="ident" id="3137370">net</span><span class="op" id="3137373">,</span>&nbsp;<span class="ident" id="3137375">Addr</span><span class="op" id="3137379">:</span>&nbsp;<span class="ident" id="3137381">laddr</span><span class="op" id="3137386">,</span>&nbsp;<span class="ident" id="3137388">Err</span><span class="op" id="3137391">:</span>&nbsp;<span class="ident" id="3137393">UnknownNetworkError</span><span class="op" id="3137412">(</span><span class="ident" id="3137413">net</span><span class="op" id="3137416">)</span><span class="op" id="3137417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3137420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137423">if</span>&nbsp;<span class="ident" id="3137426">laddr</span>&nbsp;<span class="op" id="3137432">==</span>&nbsp;<span class="ident" id="3137435">nil</span>&nbsp;<span class="op" id="3137439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137443">laddr</span>&nbsp;<span class="op" id="3137449">=</span>&nbsp;<span class="op" id="3137451">&amp;</span><span class="ident" id="3137452">UDPAddr</span><span class="op" id="3137459">{</span><span class="op" id="3137460">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3137463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137466">fd</span><span class="op" id="3137468">,</span>&nbsp;<span class="ident" id="3137470">err</span>&nbsp;<span class="op" id="3137474">:=</span>&nbsp;<span class="ident" id="3137477">internetSocket</span><span class="op" id="3137491">(</span><span class="ident" id="3137492">net</span><span class="op" id="3137495">,</span>&nbsp;<span class="ident" id="3137497">laddr</span><span class="op" id="3137502">,</span>&nbsp;<span class="ident" id="3137504">nil</span><span class="op" id="3137507">,</span>&nbsp;<span class="ident" id="3137509">noDeadline</span><span class="op" id="3137519">,</span>&nbsp;<span class="ident" id="3137521">syscall</span><span class="op" id="3137528">.</span><span class="ident" id="3137529">SOCK_DGRAM</span><span class="op" id="3137539">,</span>&nbsp;<span class="num" id="3137541">0</span><span class="op" id="3137542">,</span>&nbsp;<span class="string" id="3137544">&#34;listen&#34;</span><span class="op" id="3137552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137555">if</span>&nbsp;<span class="ident" id="3137558">err</span>&nbsp;<span class="op" id="3137562">!=</span>&nbsp;<span class="ident" id="3137565">nil</span>&nbsp;<span class="op" id="3137569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137573">return</span>&nbsp;<span class="ident" id="3137580">nil</span><span class="op" id="3137583">,</span>&nbsp;<span class="op" id="3137585">&amp;</span><span class="ident" id="3137586">OpError</span><span class="op" id="3137593">{</span><span class="ident" id="3137594">Op</span><span class="op" id="3137596">:</span>&nbsp;<span class="string" id="3137598">&#34;listen&#34;</span><span class="op" id="3137606">,</span>&nbsp;<span class="ident" id="3137608">Net</span><span class="op" id="3137611">:</span>&nbsp;<span class="ident" id="3137613">net</span><span class="op" id="3137616">,</span>&nbsp;<span class="ident" id="3137618">Addr</span><span class="op" id="3137622">:</span>&nbsp;<span class="ident" id="3137624">laddr</span><span class="op" id="3137629">,</span>&nbsp;<span class="ident" id="3137631">Err</span><span class="op" id="3137634">:</span>&nbsp;<span class="ident" id="3137636">err</span><span class="op" id="3137639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3137642">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137645">return</span>&nbsp;<span class="ident" id="3137652">newUDPConn</span><span class="op" id="3137662">(</span><span class="ident" id="3137663">fd</span><span class="op" id="3137665">)</span><span class="op" id="3137666">,</span>&nbsp;<span class="ident" id="3137668">nil</span><br>
<span class="lineno"></span><span class="op" id="3137672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3137675">//&nbsp;ListenMulticastUDP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;multicast&nbsp;UDP&nbsp;packets</span><br>
<span class="lineno"></span><span class="comment" id="3137740">//&nbsp;addressed&nbsp;to&nbsp;the&nbsp;group&nbsp;address&nbsp;gaddr&nbsp;on&nbsp;ifi,&nbsp;which&nbsp;specifies&nbsp;the</span><br>
<span class="lineno">210</span><span class="comment" id="3137808">//&nbsp;interface&nbsp;to&nbsp;join.&nbsp;&nbsp;ListenMulticastUDP&nbsp;uses&nbsp;default&nbsp;multicast</span><br>
<span class="lineno"></span><span class="comment" id="3137873">//&nbsp;interface&nbsp;if&nbsp;ifi&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3137901">func</span>&nbsp;<span class="ident" id="3137906">ListenMulticastUDP</span><span class="op" id="3137924">(</span><span class="ident" id="3137925">net</span>&nbsp;<span class="builtintype" id="3137929">string</span><span class="op" id="3137935">,</span>&nbsp;<span class="ident" id="3137937">ifi</span>&nbsp;<span class="op" id="3137941">*</span><span class="ident" id="3137942">Interface</span><span class="op" id="3137951">,</span>&nbsp;<span class="ident" id="3137953">gaddr</span>&nbsp;<span class="op" id="3137959">*</span><span class="ident" id="3137960">UDPAddr</span><span class="op" id="3137967">)</span>&nbsp;<span class="op" id="3137969">(</span><span class="op" id="3137970">*</span><span class="ident" id="3137971">UDPConn</span><span class="op" id="3137978">,</span>&nbsp;<span class="builtintype" id="3137980">error</span><span class="op" id="3137985">)</span>&nbsp;<span class="op" id="3137987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137990">switch</span>&nbsp;<span class="ident" id="3137997">net</span>&nbsp;<span class="op" id="3138001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138004">case</span>&nbsp;<span class="string" id="3138009">&#34;udp&#34;</span><span class="op" id="3138014">,</span>&nbsp;<span class="string" id="3138016">&#34;udp4&#34;</span><span class="op" id="3138022">,</span>&nbsp;<span class="string" id="3138024">&#34;udp6&#34;</span><span class="op" id="3138030">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138033">default</span><span class="op" id="3138040">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138044">return</span>&nbsp;<span class="ident" id="3138051">nil</span><span class="op" id="3138054">,</span>&nbsp;<span class="op" id="3138056">&amp;</span><span class="ident" id="3138057">OpError</span><span class="op" id="3138064">{</span><span class="ident" id="3138065">Op</span><span class="op" id="3138067">:</span>&nbsp;<span class="string" id="3138069">&#34;listen&#34;</span><span class="op" id="3138077">,</span>&nbsp;<span class="ident" id="3138079">Net</span><span class="op" id="3138082">:</span>&nbsp;<span class="ident" id="3138084">net</span><span class="op" id="3138087">,</span>&nbsp;<span class="ident" id="3138089">Addr</span><span class="op" id="3138093">:</span>&nbsp;<span class="ident" id="3138095">gaddr</span><span class="op" id="3138100">,</span>&nbsp;<span class="ident" id="3138102">Err</span><span class="op" id="3138105">:</span>&nbsp;<span class="ident" id="3138107">UnknownNetworkError</span><span class="op" id="3138126">(</span><span class="ident" id="3138127">net</span><span class="op" id="3138130">)</span><span class="op" id="3138131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3138134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138137">if</span>&nbsp;<span class="ident" id="3138140">gaddr</span>&nbsp;<span class="op" id="3138146">==</span>&nbsp;<span class="ident" id="3138149">nil</span>&nbsp;<span class="op" id="3138153">||</span>&nbsp;<span class="ident" id="3138156">gaddr</span><span class="op" id="3138161">.</span><span class="ident" id="3138162">IP</span>&nbsp;<span class="op" id="3138165">==</span>&nbsp;<span class="ident" id="3138168">nil</span>&nbsp;<span class="op" id="3138172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138176">return</span>&nbsp;<span class="ident" id="3138183">nil</span><span class="op" id="3138186">,</span>&nbsp;<span class="op" id="3138188">&amp;</span><span class="ident" id="3138189">OpError</span><span class="op" id="3138196">{</span><span class="ident" id="3138197">Op</span><span class="op" id="3138199">:</span>&nbsp;<span class="string" id="3138201">&#34;listen&#34;</span><span class="op" id="3138209">,</span>&nbsp;<span class="ident" id="3138211">Net</span><span class="op" id="3138214">:</span>&nbsp;<span class="ident" id="3138216">net</span><span class="op" id="3138219">,</span>&nbsp;<span class="ident" id="3138221">Addr</span><span class="op" id="3138225">:</span>&nbsp;<span class="ident" id="3138227">nil</span><span class="op" id="3138230">,</span>&nbsp;<span class="ident" id="3138232">Err</span><span class="op" id="3138235">:</span>&nbsp;<span class="ident" id="3138237">errMissingAddress</span><span class="op" id="3138254">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3138257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138260">fd</span><span class="op" id="3138262">,</span>&nbsp;<span class="ident" id="3138264">err</span>&nbsp;<span class="op" id="3138268">:=</span>&nbsp;<span class="ident" id="3138271">internetSocket</span><span class="op" id="3138285">(</span><span class="ident" id="3138286">net</span><span class="op" id="3138289">,</span>&nbsp;<span class="ident" id="3138291">gaddr</span><span class="op" id="3138296">,</span>&nbsp;<span class="ident" id="3138298">nil</span><span class="op" id="3138301">,</span>&nbsp;<span class="ident" id="3138303">noDeadline</span><span class="op" id="3138313">,</span>&nbsp;<span class="ident" id="3138315">syscall</span><span class="op" id="3138322">.</span><span class="ident" id="3138323">SOCK_DGRAM</span><span class="op" id="3138333">,</span>&nbsp;<span class="num" id="3138335">0</span><span class="op" id="3138336">,</span>&nbsp;<span class="string" id="3138338">&#34;listen&#34;</span><span class="op" id="3138346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138349">if</span>&nbsp;<span class="ident" id="3138352">err</span>&nbsp;<span class="op" id="3138356">!=</span>&nbsp;<span class="ident" id="3138359">nil</span>&nbsp;<span class="op" id="3138363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138367">return</span>&nbsp;<span class="ident" id="3138374">nil</span><span class="op" id="3138377">,</span>&nbsp;<span class="op" id="3138379">&amp;</span><span class="ident" id="3138380">OpError</span><span class="op" id="3138387">{</span><span class="ident" id="3138388">Op</span><span class="op" id="3138390">:</span>&nbsp;<span class="string" id="3138392">&#34;listen&#34;</span><span class="op" id="3138400">,</span>&nbsp;<span class="ident" id="3138402">Net</span><span class="op" id="3138405">:</span>&nbsp;<span class="ident" id="3138407">net</span><span class="op" id="3138410">,</span>&nbsp;<span class="ident" id="3138412">Addr</span><span class="op" id="3138416">:</span>&nbsp;<span class="ident" id="3138418">gaddr</span><span class="op" id="3138423">,</span>&nbsp;<span class="ident" id="3138425">Err</span><span class="op" id="3138428">:</span>&nbsp;<span class="ident" id="3138430">err</span><span class="op" id="3138433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3138436">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138439">c</span>&nbsp;<span class="op" id="3138441">:=</span>&nbsp;<span class="ident" id="3138444">newUDPConn</span><span class="op" id="3138454">(</span><span class="ident" id="3138455">fd</span><span class="op" id="3138457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138460">if</span>&nbsp;<span class="ident" id="3138463">ip4</span>&nbsp;<span class="op" id="3138467">:=</span>&nbsp;<span class="ident" id="3138470">gaddr</span><span class="op" id="3138475">.</span><span class="ident" id="3138476">IP</span><span class="op" id="3138478">.</span><span class="ident" id="3138479">To4</span><span class="op" id="3138482">(</span><span class="op" id="3138483">)</span><span class="op" id="3138484">;</span>&nbsp;<span class="ident" id="3138486">ip4</span>&nbsp;<span class="op" id="3138490">!=</span>&nbsp;<span class="ident" id="3138493">nil</span>&nbsp;<span class="op" id="3138497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138501">if</span>&nbsp;<span class="ident" id="3138504">err</span>&nbsp;<span class="op" id="3138508">:=</span>&nbsp;<span class="ident" id="3138511">listenIPv4MulticastUDP</span><span class="op" id="3138533">(</span><span class="ident" id="3138534">c</span><span class="op" id="3138535">,</span>&nbsp;<span class="ident" id="3138537">ifi</span><span class="op" id="3138540">,</span>&nbsp;<span class="ident" id="3138542">ip4</span><span class="op" id="3138545">)</span><span class="op" id="3138546">;</span>&nbsp;<span class="ident" id="3138548">err</span>&nbsp;<span class="op" id="3138552">!=</span>&nbsp;<span class="ident" id="3138555">nil</span>&nbsp;<span class="op" id="3138559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138564">c</span><span class="op" id="3138565">.</span><span class="ident" id="3138566">Close</span><span class="op" id="3138571">(</span><span class="op" id="3138572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138577">return</span>&nbsp;<span class="ident" id="3138584">nil</span><span class="op" id="3138587">,</span>&nbsp;<span class="op" id="3138589">&amp;</span><span class="ident" id="3138590">OpError</span><span class="op" id="3138597">{</span><span class="ident" id="3138598">Op</span><span class="op" id="3138600">:</span>&nbsp;<span class="string" id="3138602">&#34;listen&#34;</span><span class="op" id="3138610">,</span>&nbsp;<span class="ident" id="3138612">Net</span><span class="op" id="3138615">:</span>&nbsp;<span class="ident" id="3138617">net</span><span class="op" id="3138620">,</span>&nbsp;<span class="ident" id="3138622">Addr</span><span class="op" id="3138626">:</span>&nbsp;<span class="op" id="3138628">&amp;</span><span class="ident" id="3138629">IPAddr</span><span class="op" id="3138635">{</span><span class="ident" id="3138636">IP</span><span class="op" id="3138638">:</span>&nbsp;<span class="ident" id="3138640">ip4</span><span class="op" id="3138643">}</span><span class="op" id="3138644">,</span>&nbsp;<span class="ident" id="3138646">Err</span><span class="op" id="3138649">:</span>&nbsp;<span class="ident" id="3138651">err</span><span class="op" id="3138654">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3138658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3138661">}</span>&nbsp;<span class="keyword" id="3138663">else</span>&nbsp;<span class="op" id="3138668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138672">if</span>&nbsp;<span class="ident" id="3138675">err</span>&nbsp;<span class="op" id="3138679">:=</span>&nbsp;<span class="ident" id="3138682">listenIPv6MulticastUDP</span><span class="op" id="3138704">(</span><span class="ident" id="3138705">c</span><span class="op" id="3138706">,</span>&nbsp;<span class="ident" id="3138708">ifi</span><span class="op" id="3138711">,</span>&nbsp;<span class="ident" id="3138713">gaddr</span><span class="op" id="3138718">.</span><span class="ident" id="3138719">IP</span><span class="op" id="3138721">)</span><span class="op" id="3138722">;</span>&nbsp;<span class="ident" id="3138724">err</span>&nbsp;<span class="op" id="3138728">!=</span>&nbsp;<span class="ident" id="3138731">nil</span>&nbsp;<span class="op" id="3138735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138740">c</span><span class="op" id="3138741">.</span><span class="ident" id="3138742">Close</span><span class="op" id="3138747">(</span><span class="op" id="3138748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138753">return</span>&nbsp;<span class="ident" id="3138760">nil</span><span class="op" id="3138763">,</span>&nbsp;<span class="op" id="3138765">&amp;</span><span class="ident" id="3138766">OpError</span><span class="op" id="3138773">{</span><span class="ident" id="3138774">Op</span><span class="op" id="3138776">:</span>&nbsp;<span class="string" id="3138778">&#34;listen&#34;</span><span class="op" id="3138786">,</span>&nbsp;<span class="ident" id="3138788">Net</span><span class="op" id="3138791">:</span>&nbsp;<span class="ident" id="3138793">net</span><span class="op" id="3138796">,</span>&nbsp;<span class="ident" id="3138798">Addr</span><span class="op" id="3138802">:</span>&nbsp;<span class="op" id="3138804">&amp;</span><span class="ident" id="3138805">IPAddr</span><span class="op" id="3138811">{</span><span class="ident" id="3138812">IP</span><span class="op" id="3138814">:</span>&nbsp;<span class="ident" id="3138816">gaddr</span><span class="op" id="3138821">.</span><span class="ident" id="3138822">IP</span><span class="op" id="3138824">}</span><span class="op" id="3138825">,</span>&nbsp;<span class="ident" id="3138827">Err</span><span class="op" id="3138830">:</span>&nbsp;<span class="ident" id="3138832">err</span><span class="op" id="3138835">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3138839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3138842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138845">return</span>&nbsp;<span class="ident" id="3138852">c</span><span class="op" id="3138853">,</span>&nbsp;<span class="ident" id="3138855">nil</span><br>
<span class="lineno"></span><span class="op" id="3138859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="3138862">func</span>&nbsp;<span class="ident" id="3138867">listenIPv4MulticastUDP</span><span class="op" id="3138889">(</span><span class="ident" id="3138890">c</span>&nbsp;<span class="op" id="3138892">*</span><span class="ident" id="3138893">UDPConn</span><span class="op" id="3138900">,</span>&nbsp;<span class="ident" id="3138902">ifi</span>&nbsp;<span class="op" id="3138906">*</span><span class="ident" id="3138907">Interface</span><span class="op" id="3138916">,</span>&nbsp;<span class="ident" id="3138918">ip</span>&nbsp;<span class="ident" id="3138921">IP</span><span class="op" id="3138923">)</span>&nbsp;<span class="builtintype" id="3138925">error</span>&nbsp;<span class="op" id="3138931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138934">if</span>&nbsp;<span class="ident" id="3138937">ifi</span>&nbsp;<span class="op" id="3138941">!=</span>&nbsp;<span class="ident" id="3138944">nil</span>&nbsp;<span class="op" id="3138948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138952">if</span>&nbsp;<span class="ident" id="3138955">err</span>&nbsp;<span class="op" id="3138959">:=</span>&nbsp;<span class="ident" id="3138962">setIPv4MulticastInterface</span><span class="op" id="3138987">(</span><span class="ident" id="3138988">c</span><span class="op" id="3138989">.</span><span class="ident" id="3138990">fd</span><span class="op" id="3138992">,</span>&nbsp;<span class="ident" id="3138994">ifi</span><span class="op" id="3138997">)</span><span class="op" id="3138998">;</span>&nbsp;<span class="ident" id="3139000">err</span>&nbsp;<span class="op" id="3139004">!=</span>&nbsp;<span class="ident" id="3139007">nil</span>&nbsp;<span class="op" id="3139011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139016">return</span>&nbsp;<span class="ident" id="3139023">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3139029">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3139032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139035">if</span>&nbsp;<span class="ident" id="3139038">err</span>&nbsp;<span class="op" id="3139042">:=</span>&nbsp;<span class="ident" id="3139045">setIPv4MulticastLoopback</span><span class="op" id="3139069">(</span><span class="ident" id="3139070">c</span><span class="op" id="3139071">.</span><span class="ident" id="3139072">fd</span><span class="op" id="3139074">,</span>&nbsp;<span class="builtintype" id="3139076">false</span><span class="op" id="3139081">)</span><span class="op" id="3139082">;</span>&nbsp;<span class="ident" id="3139084">err</span>&nbsp;<span class="op" id="3139088">!=</span>&nbsp;<span class="ident" id="3139091">nil</span>&nbsp;<span class="op" id="3139095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139099">return</span>&nbsp;<span class="ident" id="3139106">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3139111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139114">if</span>&nbsp;<span class="ident" id="3139117">err</span>&nbsp;<span class="op" id="3139121">:=</span>&nbsp;<span class="ident" id="3139124">joinIPv4Group</span><span class="op" id="3139137">(</span><span class="ident" id="3139138">c</span><span class="op" id="3139139">.</span><span class="ident" id="3139140">fd</span><span class="op" id="3139142">,</span>&nbsp;<span class="ident" id="3139144">ifi</span><span class="op" id="3139147">,</span>&nbsp;<span class="ident" id="3139149">ip</span><span class="op" id="3139151">)</span><span class="op" id="3139152">;</span>&nbsp;<span class="ident" id="3139154">err</span>&nbsp;<span class="op" id="3139158">!=</span>&nbsp;<span class="ident" id="3139161">nil</span>&nbsp;<span class="op" id="3139165">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139169">return</span>&nbsp;<span class="ident" id="3139176">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3139181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139184">return</span>&nbsp;<span class="ident" id="3139191">nil</span><br>
<span class="lineno"></span><span class="op" id="3139195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="3139198">func</span>&nbsp;<span class="ident" id="3139203">listenIPv6MulticastUDP</span><span class="op" id="3139225">(</span><span class="ident" id="3139226">c</span>&nbsp;<span class="op" id="3139228">*</span><span class="ident" id="3139229">UDPConn</span><span class="op" id="3139236">,</span>&nbsp;<span class="ident" id="3139238">ifi</span>&nbsp;<span class="op" id="3139242">*</span><span class="ident" id="3139243">Interface</span><span class="op" id="3139252">,</span>&nbsp;<span class="ident" id="3139254">ip</span>&nbsp;<span class="ident" id="3139257">IP</span><span class="op" id="3139259">)</span>&nbsp;<span class="builtintype" id="3139261">error</span>&nbsp;<span class="op" id="3139267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139270">if</span>&nbsp;<span class="ident" id="3139273">ifi</span>&nbsp;<span class="op" id="3139277">!=</span>&nbsp;<span class="ident" id="3139280">nil</span>&nbsp;<span class="op" id="3139284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139288">if</span>&nbsp;<span class="ident" id="3139291">err</span>&nbsp;<span class="op" id="3139295">:=</span>&nbsp;<span class="ident" id="3139298">setIPv6MulticastInterface</span><span class="op" id="3139323">(</span><span class="ident" id="3139324">c</span><span class="op" id="3139325">.</span><span class="ident" id="3139326">fd</span><span class="op" id="3139328">,</span>&nbsp;<span class="ident" id="3139330">ifi</span><span class="op" id="3139333">)</span><span class="op" id="3139334">;</span>&nbsp;<span class="ident" id="3139336">err</span>&nbsp;<span class="op" id="3139340">!=</span>&nbsp;<span class="ident" id="3139343">nil</span>&nbsp;<span class="op" id="3139347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139352">return</span>&nbsp;<span class="ident" id="3139359">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3139365">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3139368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139371">if</span>&nbsp;<span class="ident" id="3139374">err</span>&nbsp;<span class="op" id="3139378">:=</span>&nbsp;<span class="ident" id="3139381">setIPv6MulticastLoopback</span><span class="op" id="3139405">(</span><span class="ident" id="3139406">c</span><span class="op" id="3139407">.</span><span class="ident" id="3139408">fd</span><span class="op" id="3139410">,</span>&nbsp;<span class="builtintype" id="3139412">false</span><span class="op" id="3139417">)</span><span class="op" id="3139418">;</span>&nbsp;<span class="ident" id="3139420">err</span>&nbsp;<span class="op" id="3139424">!=</span>&nbsp;<span class="ident" id="3139427">nil</span>&nbsp;<span class="op" id="3139431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139435">return</span>&nbsp;<span class="ident" id="3139442">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3139447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139450">if</span>&nbsp;<span class="ident" id="3139453">err</span>&nbsp;<span class="op" id="3139457">:=</span>&nbsp;<span class="ident" id="3139460">joinIPv6Group</span><span class="op" id="3139473">(</span><span class="ident" id="3139474">c</span><span class="op" id="3139475">.</span><span class="ident" id="3139476">fd</span><span class="op" id="3139478">,</span>&nbsp;<span class="ident" id="3139480">ifi</span><span class="op" id="3139483">,</span>&nbsp;<span class="ident" id="3139485">ip</span><span class="op" id="3139487">)</span><span class="op" id="3139488">;</span>&nbsp;<span class="ident" id="3139490">err</span>&nbsp;<span class="op" id="3139494">!=</span>&nbsp;<span class="ident" id="3139497">nil</span>&nbsp;<span class="op" id="3139501">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139505">return</span>&nbsp;<span class="ident" id="3139512">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3139517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139520">return</span>&nbsp;<span class="ident" id="3139527">nil</span><br>
<span class="lineno"></span><span class="op" id="3139531">}</span>
</div>
</body>
</html>
