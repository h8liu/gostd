<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/cipher</h2>
<ul>
<li><a href="/gostd/crypto/cipher/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc.go.html">cbc.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc_aes_test.go.html">cbc_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb.go.html">cfb.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb_test.go.html">cfb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher_test.go.html">cipher_test.go</a></li>
<li><a href="/gostd/crypto/cipher/common_test.go.html">common_test.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr.go.html">ctr.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr_aes_test.go.html">ctr_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm.go.html">gcm.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm_test.go.html">gcm_test.go</a></li>
<li><a href="/gostd/crypto/cipher/io.go.html">io.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb.go.html">ofb.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb_test.go.html">ofb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/xor.go.html">xor.go</a></li>
<li><a href="/gostd/crypto/cipher/xor_test.go.html">xor_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3938222">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3938277">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3938331">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3938382">package</span>&nbsp;<span class="ident" id="3938390">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3938398">import</span>&nbsp;<span class="string" id="3938405">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3938411">//&nbsp;The&nbsp;Stream*&nbsp;objects&nbsp;are&nbsp;so&nbsp;simple&nbsp;that&nbsp;all&nbsp;their&nbsp;members&nbsp;are&nbsp;public.&nbsp;Users</span><br>
<span class="lineno">10</span><span class="comment" id="3938489">//&nbsp;can&nbsp;create&nbsp;them&nbsp;themselves.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3938521">//&nbsp;StreamReader&nbsp;wraps&nbsp;a&nbsp;Stream&nbsp;into&nbsp;an&nbsp;io.Reader.&nbsp;It&nbsp;calls&nbsp;XORKeyStream</span><br>
<span class="lineno"></span><span class="comment" id="3938593">//&nbsp;to&nbsp;process&nbsp;each&nbsp;slice&nbsp;of&nbsp;data&nbsp;which&nbsp;passes&nbsp;through.</span><br>
<span class="lineno"></span><span class="keyword" id="3938648">type</span>&nbsp;<span class="ident" id="3938653">StreamReader</span>&nbsp;<span class="keyword" id="3938666">struct</span>&nbsp;<span class="op" id="3938673">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938676">S</span>&nbsp;<span class="ident" id="3938678">Stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938686">R</span>&nbsp;<span class="ident" id="3938688">io</span><span class="op" id="3938690">.</span><span class="ident" id="3938691">Reader</span><br>
<span class="lineno"></span><span class="op" id="3938698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3938701">func</span>&nbsp;<span class="op" id="3938706">(</span><span class="ident" id="3938707">r</span>&nbsp;<span class="ident" id="3938709">StreamReader</span><span class="op" id="3938721">)</span>&nbsp;<span class="ident" id="3938723">Read</span><span class="op" id="3938727">(</span><span class="ident" id="3938728">dst</span>&nbsp;<span class="op" id="3938732">[</span><span class="op" id="3938733">]</span><span class="builtintype" id="3938734">byte</span><span class="op" id="3938738">)</span>&nbsp;<span class="op" id="3938740">(</span><span class="ident" id="3938741">n</span>&nbsp;<span class="builtintype" id="3938743">int</span><span class="op" id="3938746">,</span>&nbsp;<span class="ident" id="3938748">err</span>&nbsp;<span class="builtintype" id="3938752">error</span><span class="op" id="3938757">)</span>&nbsp;<span class="op" id="3938759">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938762">n</span><span class="op" id="3938763">,</span>&nbsp;<span class="ident" id="3938765">err</span>&nbsp;<span class="op" id="3938769">=</span>&nbsp;<span class="ident" id="3938771">r</span><span class="op" id="3938772">.</span><span class="ident" id="3938773">R</span><span class="op" id="3938774">.</span><span class="ident" id="3938775">Read</span><span class="op" id="3938779">(</span><span class="ident" id="3938780">dst</span><span class="op" id="3938783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938786">r</span><span class="op" id="3938787">.</span><span class="ident" id="3938788">S</span><span class="op" id="3938789">.</span><span class="ident" id="3938790">XORKeyStream</span><span class="op" id="3938802">(</span><span class="ident" id="3938803">dst</span><span class="op" id="3938806">[</span><span class="op" id="3938807">:</span><span class="ident" id="3938808">n</span><span class="op" id="3938809">]</span><span class="op" id="3938810">,</span>&nbsp;<span class="ident" id="3938812">dst</span><span class="op" id="3938815">[</span><span class="op" id="3938816">:</span><span class="ident" id="3938817">n</span><span class="op" id="3938818">]</span><span class="op" id="3938819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938822">return</span><br>
<span class="lineno"></span><span class="op" id="3938829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3938832">//&nbsp;StreamWriter&nbsp;wraps&nbsp;a&nbsp;Stream&nbsp;into&nbsp;an&nbsp;io.Writer.&nbsp;It&nbsp;calls&nbsp;XORKeyStream</span><br>
<span class="lineno"></span><span class="comment" id="3938904">//&nbsp;to&nbsp;process&nbsp;each&nbsp;slice&nbsp;of&nbsp;data&nbsp;which&nbsp;passes&nbsp;through.&nbsp;If&nbsp;any&nbsp;Write&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3938977">//&nbsp;returns&nbsp;short&nbsp;then&nbsp;the&nbsp;StreamWriter&nbsp;is&nbsp;out&nbsp;of&nbsp;sync&nbsp;and&nbsp;must&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="comment" id="3939054">//&nbsp;A&nbsp;StreamWriter&nbsp;has&nbsp;no&nbsp;internal&nbsp;buffering;&nbsp;Close&nbsp;does&nbsp;not&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="3939119">//&nbsp;to&nbsp;be&nbsp;called&nbsp;to&nbsp;flush&nbsp;write&nbsp;data.</span><br>
<span class="lineno">30</span><span class="keyword" id="3939156">type</span>&nbsp;<span class="ident" id="3939161">StreamWriter</span>&nbsp;<span class="keyword" id="3939174">struct</span>&nbsp;<span class="op" id="3939181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939184">S</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3939188">Stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939196">W</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3939200">io</span><span class="op" id="3939202">.</span><span class="ident" id="3939203">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939211">Err</span>&nbsp;<span class="builtintype" id="3939215">error</span>&nbsp;<span class="comment" id="3939221">//&nbsp;unused</span><br>
<span class="lineno"></span><span class="op" id="3939231">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="3939234">func</span>&nbsp;<span class="op" id="3939239">(</span><span class="ident" id="3939240">w</span>&nbsp;<span class="ident" id="3939242">StreamWriter</span><span class="op" id="3939254">)</span>&nbsp;<span class="ident" id="3939256">Write</span><span class="op" id="3939261">(</span><span class="ident" id="3939262">src</span>&nbsp;<span class="op" id="3939266">[</span><span class="op" id="3939267">]</span><span class="builtintype" id="3939268">byte</span><span class="op" id="3939272">)</span>&nbsp;<span class="op" id="3939274">(</span><span class="ident" id="3939275">n</span>&nbsp;<span class="builtintype" id="3939277">int</span><span class="op" id="3939280">,</span>&nbsp;<span class="ident" id="3939282">err</span>&nbsp;<span class="builtintype" id="3939286">error</span><span class="op" id="3939291">)</span>&nbsp;<span class="op" id="3939293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939296">c</span>&nbsp;<span class="op" id="3939298">:=</span>&nbsp;<span class="builtinfunc" id="3939301">make</span><span class="op" id="3939305">(</span><span class="op" id="3939306">[</span><span class="op" id="3939307">]</span><span class="builtintype" id="3939308">byte</span><span class="op" id="3939312">,</span>&nbsp;<span class="builtinfunc" id="3939314">len</span><span class="op" id="3939317">(</span><span class="ident" id="3939318">src</span><span class="op" id="3939321">)</span><span class="op" id="3939322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939325">w</span><span class="op" id="3939326">.</span><span class="ident" id="3939327">S</span><span class="op" id="3939328">.</span><span class="ident" id="3939329">XORKeyStream</span><span class="op" id="3939341">(</span><span class="ident" id="3939342">c</span><span class="op" id="3939343">,</span>&nbsp;<span class="ident" id="3939345">src</span><span class="op" id="3939348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939351">n</span><span class="op" id="3939352">,</span>&nbsp;<span class="ident" id="3939354">err</span>&nbsp;<span class="op" id="3939358">=</span>&nbsp;<span class="ident" id="3939360">w</span><span class="op" id="3939361">.</span><span class="ident" id="3939362">W</span><span class="op" id="3939363">.</span><span class="ident" id="3939364">Write</span><span class="op" id="3939369">(</span><span class="ident" id="3939370">c</span><span class="op" id="3939371">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939374">if</span>&nbsp;<span class="ident" id="3939377">n</span>&nbsp;<span class="op" id="3939379">!=</span>&nbsp;<span class="builtinfunc" id="3939382">len</span><span class="op" id="3939385">(</span><span class="ident" id="3939386">src</span><span class="op" id="3939389">)</span>&nbsp;<span class="op" id="3939391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939395">if</span>&nbsp;<span class="ident" id="3939398">err</span>&nbsp;<span class="op" id="3939402">==</span>&nbsp;<span class="ident" id="3939405">nil</span>&nbsp;<span class="op" id="3939409">{</span>&nbsp;<span class="comment" id="3939411">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939437">err</span>&nbsp;<span class="op" id="3939441">=</span>&nbsp;<span class="ident" id="3939443">io</span><span class="op" id="3939445">.</span><span class="ident" id="3939446">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939465">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939468">return</span><br>
<span class="lineno"></span><span class="op" id="3939475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3939478">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;underlying&nbsp;Writer&nbsp;and&nbsp;returns&nbsp;its&nbsp;Close&nbsp;return&nbsp;value,&nbsp;if&nbsp;the&nbsp;Writer</span><br>
<span class="lineno"></span><span class="comment" id="3939566">//&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer.&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">50</span><span class="keyword" id="3939617">func</span>&nbsp;<span class="op" id="3939622">(</span><span class="ident" id="3939623">w</span>&nbsp;<span class="ident" id="3939625">StreamWriter</span><span class="op" id="3939637">)</span>&nbsp;<span class="ident" id="3939639">Close</span><span class="op" id="3939644">(</span><span class="op" id="3939645">)</span>&nbsp;<span class="builtintype" id="3939647">error</span>&nbsp;<span class="op" id="3939653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939656">if</span>&nbsp;<span class="ident" id="3939659">c</span><span class="op" id="3939660">,</span>&nbsp;<span class="ident" id="3939662">ok</span>&nbsp;<span class="op" id="3939665">:=</span>&nbsp;<span class="ident" id="3939668">w</span><span class="op" id="3939669">.</span><span class="ident" id="3939670">W</span><span class="op" id="3939671">.</span><span class="op" id="3939672">(</span><span class="ident" id="3939673">io</span><span class="op" id="3939675">.</span><span class="ident" id="3939676">Closer</span><span class="op" id="3939682">)</span><span class="op" id="3939683">;</span>&nbsp;<span class="ident" id="3939685">ok</span>&nbsp;<span class="op" id="3939688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939692">return</span>&nbsp;<span class="ident" id="3939699">c</span><span class="op" id="3939700">.</span><span class="ident" id="3939701">Close</span><span class="op" id="3939706">(</span><span class="op" id="3939707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939713">return</span>&nbsp;<span class="ident" id="3939720">nil</span><br>
<span class="lineno">55</span><span class="op" id="3939724">}</span>
</div>
</body>
</html>
