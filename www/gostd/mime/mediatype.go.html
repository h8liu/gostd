<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime</h2>
<ul>
<li><a href="/gostd/mime/grammar.go.html">grammar.go</a></li>
<li><a href="/gostd/mime/mediatype.go.html">mediatype.go</a></li>
<li><a href="/gostd/mime/mediatype_test.go.html">mediatype_test.go</a></li>
<li><a href="/gostd/mime/type.go.html">type.go</a></li>
<li><a href="/gostd/mime/type_test.go.html">type_test.go</a></li>
<li><a href="/gostd/mime/type_unix.go.html">type_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5047414">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5047469">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5047523">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5047574">package</span>&nbsp;<span class="ident" id="5047582">mime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5047588">import</span>&nbsp;<span class="op" id="5047595">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5047598">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5047607">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5047617">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5047624">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5047632">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5047643">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="5047653">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5047656">//&nbsp;FormatMediaType&nbsp;serializes&nbsp;mediatype&nbsp;t&nbsp;and&nbsp;the&nbsp;parameters</span><br>
<span class="lineno"></span><span class="comment" id="5047717">//&nbsp;param&nbsp;as&nbsp;a&nbsp;media&nbsp;type&nbsp;conforming&nbsp;to&nbsp;RFC&nbsp;2045&nbsp;and&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="5047779">//&nbsp;The&nbsp;type&nbsp;and&nbsp;parameter&nbsp;names&nbsp;are&nbsp;written&nbsp;in&nbsp;lower-case.</span><br>
<span class="lineno"></span><span class="comment" id="5047838">//&nbsp;When&nbsp;any&nbsp;of&nbsp;the&nbsp;arguments&nbsp;result&nbsp;in&nbsp;a&nbsp;standard&nbsp;violation&nbsp;then</span><br>
<span class="lineno">20</span><span class="comment" id="5047903">//&nbsp;FormatMediaType&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5047948">func</span>&nbsp;<span class="ident" id="5047953">FormatMediaType</span><span class="op" id="5047968">(</span><span class="ident" id="5047969">t</span>&nbsp;<span class="builtintype" id="5047971">string</span><span class="op" id="5047977">,</span>&nbsp;<span class="ident" id="5047979">param</span>&nbsp;<span class="keyword" id="5047985">map</span><span class="op" id="5047988">[</span><span class="builtintype" id="5047989">string</span><span class="op" id="5047995">]</span><span class="builtintype" id="5047996">string</span><span class="op" id="5048002">)</span>&nbsp;<span class="builtintype" id="5048004">string</span>&nbsp;<span class="op" id="5048011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048014">slash</span>&nbsp;<span class="op" id="5048020">:=</span>&nbsp;<span class="ident" id="5048023">strings</span><span class="op" id="5048030">.</span><span class="ident" id="5048031">Index</span><span class="op" id="5048036">(</span><span class="ident" id="5048037">t</span><span class="op" id="5048038">,</span>&nbsp;<span class="string" id="5048040">&#34;/&#34;</span><span class="op" id="5048043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048046">if</span>&nbsp;<span class="ident" id="5048049">slash</span>&nbsp;<span class="op" id="5048055">==</span>&nbsp;<span class="op" id="5048058">-</span><span class="num" id="5048059">1</span>&nbsp;<span class="op" id="5048061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048065">return</span>&nbsp;<span class="string" id="5048072">&#34;&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048079">major</span><span class="op" id="5048084">,</span>&nbsp;<span class="ident" id="5048086">sub</span>&nbsp;<span class="op" id="5048090">:=</span>&nbsp;<span class="ident" id="5048093">t</span><span class="op" id="5048094">[</span><span class="op" id="5048095">:</span><span class="ident" id="5048096">slash</span><span class="op" id="5048101">]</span><span class="op" id="5048102">,</span>&nbsp;<span class="ident" id="5048104">t</span><span class="op" id="5048105">[</span><span class="ident" id="5048106">slash</span><span class="op" id="5048111">+</span><span class="num" id="5048112">1</span><span class="op" id="5048113">:</span><span class="op" id="5048114">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048117">if</span>&nbsp;<span class="op" id="5048120">!</span><span class="ident" id="5048121">isToken</span><span class="op" id="5048128">(</span><span class="ident" id="5048129">major</span><span class="op" id="5048134">)</span>&nbsp;<span class="op" id="5048136">||</span>&nbsp;<span class="op" id="5048139">!</span><span class="ident" id="5048140">isToken</span><span class="op" id="5048147">(</span><span class="ident" id="5048148">sub</span><span class="op" id="5048151">)</span>&nbsp;<span class="op" id="5048153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048157">return</span>&nbsp;<span class="string" id="5048164">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048168">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048171">var</span>&nbsp;<span class="ident" id="5048175">b</span>&nbsp;<span class="ident" id="5048177">bytes</span><span class="op" id="5048182">.</span><span class="ident" id="5048183">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048191">b</span><span class="op" id="5048192">.</span><span class="ident" id="5048193">WriteString</span><span class="op" id="5048204">(</span><span class="ident" id="5048205">strings</span><span class="op" id="5048212">.</span><span class="ident" id="5048213">ToLower</span><span class="op" id="5048220">(</span><span class="ident" id="5048221">major</span><span class="op" id="5048226">)</span><span class="op" id="5048227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048230">b</span><span class="op" id="5048231">.</span><span class="ident" id="5048232">WriteByte</span><span class="op" id="5048241">(</span><span class="string" id="5048242">&#39;/&#39;</span><span class="op" id="5048245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048248">b</span><span class="op" id="5048249">.</span><span class="ident" id="5048250">WriteString</span><span class="op" id="5048261">(</span><span class="ident" id="5048262">strings</span><span class="op" id="5048269">.</span><span class="ident" id="5048270">ToLower</span><span class="op" id="5048277">(</span><span class="ident" id="5048278">sub</span><span class="op" id="5048281">)</span><span class="op" id="5048282">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048286">attrs</span>&nbsp;<span class="op" id="5048292">:=</span>&nbsp;<span class="builtinfunc" id="5048295">make</span><span class="op" id="5048299">(</span><span class="op" id="5048300">[</span><span class="op" id="5048301">]</span><span class="builtintype" id="5048302">string</span><span class="op" id="5048308">,</span>&nbsp;<span class="num" id="5048310">0</span><span class="op" id="5048311">,</span>&nbsp;<span class="builtinfunc" id="5048313">len</span><span class="op" id="5048316">(</span><span class="ident" id="5048317">param</span><span class="op" id="5048322">)</span><span class="op" id="5048323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048326">for</span>&nbsp;<span class="ident" id="5048330">a</span>&nbsp;<span class="op" id="5048332">:=</span>&nbsp;<span class="keyword" id="5048335">range</span>&nbsp;<span class="ident" id="5048341">param</span>&nbsp;<span class="op" id="5048347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048351">attrs</span>&nbsp;<span class="op" id="5048357">=</span>&nbsp;<span class="builtinfunc" id="5048359">append</span><span class="op" id="5048365">(</span><span class="ident" id="5048366">attrs</span><span class="op" id="5048371">,</span>&nbsp;<span class="ident" id="5048373">a</span><span class="op" id="5048374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048380">sort</span><span class="op" id="5048384">.</span><span class="ident" id="5048385">Strings</span><span class="op" id="5048392">(</span><span class="ident" id="5048393">attrs</span><span class="op" id="5048398">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048402">for</span>&nbsp;<span class="ident" id="5048406">_</span><span class="op" id="5048407">,</span>&nbsp;<span class="ident" id="5048409">attribute</span>&nbsp;<span class="op" id="5048419">:=</span>&nbsp;<span class="keyword" id="5048422">range</span>&nbsp;<span class="ident" id="5048428">attrs</span>&nbsp;<span class="op" id="5048434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048438">value</span>&nbsp;<span class="op" id="5048444">:=</span>&nbsp;<span class="ident" id="5048447">param</span><span class="op" id="5048452">[</span><span class="ident" id="5048453">attribute</span><span class="op" id="5048462">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048466">b</span><span class="op" id="5048467">.</span><span class="ident" id="5048468">WriteByte</span><span class="op" id="5048477">(</span><span class="string" id="5048478">&#39;;&#39;</span><span class="op" id="5048481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048485">b</span><span class="op" id="5048486">.</span><span class="ident" id="5048487">WriteByte</span><span class="op" id="5048496">(</span><span class="string" id="5048497">&#39;&nbsp;&#39;</span><span class="op" id="5048500">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048504">if</span>&nbsp;<span class="op" id="5048507">!</span><span class="ident" id="5048508">isToken</span><span class="op" id="5048515">(</span><span class="ident" id="5048516">attribute</span><span class="op" id="5048525">)</span>&nbsp;<span class="op" id="5048527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048532">return</span>&nbsp;<span class="string" id="5048539">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048548">b</span><span class="op" id="5048549">.</span><span class="ident" id="5048550">WriteString</span><span class="op" id="5048561">(</span><span class="ident" id="5048562">strings</span><span class="op" id="5048569">.</span><span class="ident" id="5048570">ToLower</span><span class="op" id="5048577">(</span><span class="ident" id="5048578">attribute</span><span class="op" id="5048587">)</span><span class="op" id="5048588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048592">b</span><span class="op" id="5048593">.</span><span class="ident" id="5048594">WriteByte</span><span class="op" id="5048603">(</span><span class="string" id="5048604">&#39;=&#39;</span><span class="op" id="5048607">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048611">if</span>&nbsp;<span class="ident" id="5048614">isToken</span><span class="op" id="5048621">(</span><span class="ident" id="5048622">value</span><span class="op" id="5048627">)</span>&nbsp;<span class="op" id="5048629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048634">b</span><span class="op" id="5048635">.</span><span class="ident" id="5048636">WriteString</span><span class="op" id="5048647">(</span><span class="ident" id="5048648">value</span><span class="op" id="5048653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048658">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048674">b</span><span class="op" id="5048675">.</span><span class="ident" id="5048676">WriteByte</span><span class="op" id="5048685">(</span><span class="string" id="5048686">&#39;&#34;&#39;</span><span class="op" id="5048689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048693">offset</span>&nbsp;<span class="op" id="5048700">:=</span>&nbsp;<span class="num" id="5048703">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048707">for</span>&nbsp;<span class="ident" id="5048711">index</span><span class="op" id="5048716">,</span>&nbsp;<span class="ident" id="5048718">character</span>&nbsp;<span class="op" id="5048728">:=</span>&nbsp;<span class="keyword" id="5048731">range</span>&nbsp;<span class="ident" id="5048737">value</span>&nbsp;<span class="op" id="5048743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048748">if</span>&nbsp;<span class="ident" id="5048751">character</span>&nbsp;<span class="op" id="5048761">==</span>&nbsp;<span class="string" id="5048764">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="5048768">||</span>&nbsp;<span class="ident" id="5048771">character</span>&nbsp;<span class="op" id="5048781">==</span>&nbsp;<span class="string" id="5048784">&#39;\\&#39;</span>&nbsp;<span class="op" id="5048789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048795">b</span><span class="op" id="5048796">.</span><span class="ident" id="5048797">WriteString</span><span class="op" id="5048808">(</span><span class="ident" id="5048809">value</span><span class="op" id="5048814">[</span><span class="ident" id="5048815">offset</span><span class="op" id="5048821">:</span><span class="ident" id="5048822">index</span><span class="op" id="5048827">]</span><span class="op" id="5048828">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048834">offset</span>&nbsp;<span class="op" id="5048841">=</span>&nbsp;<span class="ident" id="5048843">index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048853">b</span><span class="op" id="5048854">.</span><span class="ident" id="5048855">WriteByte</span><span class="op" id="5048864">(</span><span class="string" id="5048865">&#39;\\&#39;</span><span class="op" id="5048869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048879">if</span>&nbsp;<span class="ident" id="5048882">character</span><span class="op" id="5048891">&amp;</span><span class="num" id="5048892">0x80</span>&nbsp;<span class="op" id="5048897">!=</span>&nbsp;<span class="num" id="5048900">0</span>&nbsp;<span class="op" id="5048902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048908">return</span>&nbsp;<span class="string" id="5048915">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048929">b</span><span class="op" id="5048930">.</span><span class="ident" id="5048931">WriteString</span><span class="op" id="5048942">(</span><span class="ident" id="5048943">value</span><span class="op" id="5048948">[</span><span class="ident" id="5048949">offset</span><span class="op" id="5048955">:</span><span class="op" id="5048956">]</span><span class="op" id="5048957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048961">b</span><span class="op" id="5048962">.</span><span class="ident" id="5048963">WriteByte</span><span class="op" id="5048972">(</span><span class="string" id="5048973">&#39;&#34;&#39;</span><span class="op" id="5048976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048979">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048982">return</span>&nbsp;<span class="ident" id="5048989">b</span><span class="op" id="5048990">.</span><span class="ident" id="5048991">String</span><span class="op" id="5048997">(</span><span class="op" id="5048998">)</span><br>
<span class="lineno"></span><span class="op" id="5049000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5049003">func</span>&nbsp;<span class="ident" id="5049008">checkMediaTypeDisposition</span><span class="op" id="5049033">(</span><span class="ident" id="5049034">s</span>&nbsp;<span class="builtintype" id="5049036">string</span><span class="op" id="5049042">)</span>&nbsp;<span class="builtintype" id="5049044">error</span>&nbsp;<span class="op" id="5049050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049053">typ</span><span class="op" id="5049056">,</span>&nbsp;<span class="ident" id="5049058">rest</span>&nbsp;<span class="op" id="5049063">:=</span>&nbsp;<span class="ident" id="5049066">consumeToken</span><span class="op" id="5049078">(</span><span class="ident" id="5049079">s</span><span class="op" id="5049080">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049083">if</span>&nbsp;<span class="ident" id="5049086">typ</span>&nbsp;<span class="op" id="5049090">==</span>&nbsp;<span class="string" id="5049093">&#34;&#34;</span>&nbsp;<span class="op" id="5049096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049100">return</span>&nbsp;<span class="ident" id="5049107">errors</span><span class="op" id="5049113">.</span><span class="ident" id="5049114">New</span><span class="op" id="5049117">(</span><span class="string" id="5049118">&#34;mime:&nbsp;no&nbsp;media&nbsp;type&#34;</span><span class="op" id="5049139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5049142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049145">if</span>&nbsp;<span class="ident" id="5049148">rest</span>&nbsp;<span class="op" id="5049153">==</span>&nbsp;<span class="string" id="5049156">&#34;&#34;</span>&nbsp;<span class="op" id="5049159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049163">return</span>&nbsp;<span class="ident" id="5049170">nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5049175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049178">if</span>&nbsp;<span class="op" id="5049181">!</span><span class="ident" id="5049182">strings</span><span class="op" id="5049189">.</span><span class="ident" id="5049190">HasPrefix</span><span class="op" id="5049199">(</span><span class="ident" id="5049200">rest</span><span class="op" id="5049204">,</span>&nbsp;<span class="string" id="5049206">&#34;/&#34;</span><span class="op" id="5049209">)</span>&nbsp;<span class="op" id="5049211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049215">return</span>&nbsp;<span class="ident" id="5049222">errors</span><span class="op" id="5049228">.</span><span class="ident" id="5049229">New</span><span class="op" id="5049232">(</span><span class="string" id="5049233">&#34;mime:&nbsp;expected&nbsp;slash&nbsp;after&nbsp;first&nbsp;token&#34;</span><span class="op" id="5049273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5049276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049279">subtype</span><span class="op" id="5049286">,</span>&nbsp;<span class="ident" id="5049288">rest</span>&nbsp;<span class="op" id="5049293">:=</span>&nbsp;<span class="ident" id="5049296">consumeToken</span><span class="op" id="5049308">(</span><span class="ident" id="5049309">rest</span><span class="op" id="5049313">[</span><span class="num" id="5049314">1</span><span class="op" id="5049315">:</span><span class="op" id="5049316">]</span><span class="op" id="5049317">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049320">if</span>&nbsp;<span class="ident" id="5049323">subtype</span>&nbsp;<span class="op" id="5049331">==</span>&nbsp;<span class="string" id="5049334">&#34;&#34;</span>&nbsp;<span class="op" id="5049337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049341">return</span>&nbsp;<span class="ident" id="5049348">errors</span><span class="op" id="5049354">.</span><span class="ident" id="5049355">New</span><span class="op" id="5049358">(</span><span class="string" id="5049359">&#34;mime:&nbsp;expected&nbsp;token&nbsp;after&nbsp;slash&#34;</span><span class="op" id="5049393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5049396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049399">if</span>&nbsp;<span class="ident" id="5049402">rest</span>&nbsp;<span class="op" id="5049407">!=</span>&nbsp;<span class="string" id="5049410">&#34;&#34;</span>&nbsp;<span class="op" id="5049413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049417">return</span>&nbsp;<span class="ident" id="5049424">errors</span><span class="op" id="5049430">.</span><span class="ident" id="5049431">New</span><span class="op" id="5049434">(</span><span class="string" id="5049435">&#34;mime:&nbsp;unexpected&nbsp;content&nbsp;after&nbsp;media&nbsp;subtype&#34;</span><span class="op" id="5049481">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5049484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049487">return</span>&nbsp;<span class="ident" id="5049494">nil</span><br>
<span class="lineno"></span><span class="op" id="5049498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5049501">//&nbsp;ParseMediaType&nbsp;parses&nbsp;a&nbsp;media&nbsp;type&nbsp;value&nbsp;and&nbsp;any&nbsp;optional</span><br>
<span class="lineno">95</span><span class="comment" id="5049562">//&nbsp;parameters,&nbsp;per&nbsp;RFC&nbsp;1521.&nbsp;&nbsp;Media&nbsp;types&nbsp;are&nbsp;the&nbsp;values&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5049622">//&nbsp;Content-Type&nbsp;and&nbsp;Content-Disposition&nbsp;headers&nbsp;(RFC&nbsp;2183).</span><br>
<span class="lineno"></span><span class="comment" id="5049682">//&nbsp;On&nbsp;success,&nbsp;ParseMediaType&nbsp;returns&nbsp;the&nbsp;media&nbsp;type&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="5049745">//&nbsp;to&nbsp;lowercase&nbsp;and&nbsp;trimmed&nbsp;of&nbsp;white&nbsp;space&nbsp;and&nbsp;a&nbsp;non-nil&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="5049807">//&nbsp;The&nbsp;returned&nbsp;map,&nbsp;params,&nbsp;maps&nbsp;from&nbsp;the&nbsp;lowercase</span><br>
<span class="lineno">100</span><span class="comment" id="5049860">//&nbsp;attribute&nbsp;to&nbsp;the&nbsp;attribute&nbsp;value&nbsp;with&nbsp;its&nbsp;case&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="keyword" id="5049921">func</span>&nbsp;<span class="ident" id="5049926">ParseMediaType</span><span class="op" id="5049940">(</span><span class="ident" id="5049941">v</span>&nbsp;<span class="builtintype" id="5049943">string</span><span class="op" id="5049949">)</span>&nbsp;<span class="op" id="5049951">(</span><span class="ident" id="5049952">mediatype</span>&nbsp;<span class="builtintype" id="5049962">string</span><span class="op" id="5049968">,</span>&nbsp;<span class="ident" id="5049970">params</span>&nbsp;<span class="keyword" id="5049977">map</span><span class="op" id="5049980">[</span><span class="builtintype" id="5049981">string</span><span class="op" id="5049987">]</span><span class="builtintype" id="5049988">string</span><span class="op" id="5049994">,</span>&nbsp;<span class="ident" id="5049996">err</span>&nbsp;<span class="builtintype" id="5050000">error</span><span class="op" id="5050005">)</span>&nbsp;<span class="op" id="5050007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050010">i</span>&nbsp;<span class="op" id="5050012">:=</span>&nbsp;<span class="ident" id="5050015">strings</span><span class="op" id="5050022">.</span><span class="ident" id="5050023">Index</span><span class="op" id="5050028">(</span><span class="ident" id="5050029">v</span><span class="op" id="5050030">,</span>&nbsp;<span class="string" id="5050032">&#34;;&#34;</span><span class="op" id="5050035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050038">if</span>&nbsp;<span class="ident" id="5050041">i</span>&nbsp;<span class="op" id="5050043">==</span>&nbsp;<span class="op" id="5050046">-</span><span class="num" id="5050047">1</span>&nbsp;<span class="op" id="5050049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050053">i</span>&nbsp;<span class="op" id="5050055">=</span>&nbsp;<span class="builtinfunc" id="5050057">len</span><span class="op" id="5050060">(</span><span class="ident" id="5050061">v</span><span class="op" id="5050062">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5050065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050068">mediatype</span>&nbsp;<span class="op" id="5050078">=</span>&nbsp;<span class="ident" id="5050080">strings</span><span class="op" id="5050087">.</span><span class="ident" id="5050088">TrimSpace</span><span class="op" id="5050097">(</span><span class="ident" id="5050098">strings</span><span class="op" id="5050105">.</span><span class="ident" id="5050106">ToLower</span><span class="op" id="5050113">(</span><span class="ident" id="5050114">v</span><span class="op" id="5050115">[</span><span class="num" id="5050116">0</span><span class="op" id="5050117">:</span><span class="ident" id="5050118">i</span><span class="op" id="5050119">]</span><span class="op" id="5050120">)</span><span class="op" id="5050121">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050125">err</span>&nbsp;<span class="op" id="5050129">=</span>&nbsp;<span class="ident" id="5050131">checkMediaTypeDisposition</span><span class="op" id="5050156">(</span><span class="ident" id="5050157">mediatype</span><span class="op" id="5050166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050169">if</span>&nbsp;<span class="ident" id="5050172">err</span>&nbsp;<span class="op" id="5050176">!=</span>&nbsp;<span class="ident" id="5050179">nil</span>&nbsp;<span class="op" id="5050183">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050187">return</span>&nbsp;<span class="string" id="5050194">&#34;&#34;</span><span class="op" id="5050196">,</span>&nbsp;<span class="ident" id="5050198">nil</span><span class="op" id="5050201">,</span>&nbsp;<span class="ident" id="5050203">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5050208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050212">params</span>&nbsp;<span class="op" id="5050219">=</span>&nbsp;<span class="builtinfunc" id="5050221">make</span><span class="op" id="5050225">(</span><span class="keyword" id="5050226">map</span><span class="op" id="5050229">[</span><span class="builtintype" id="5050230">string</span><span class="op" id="5050236">]</span><span class="builtintype" id="5050237">string</span><span class="op" id="5050243">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5050247">//&nbsp;Map&nbsp;of&nbsp;base&nbsp;parameter&nbsp;name&nbsp;-&gt;&nbsp;parameter&nbsp;name&nbsp;-&gt;&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5050305">//&nbsp;for&nbsp;parameters&nbsp;containing&nbsp;a&nbsp;&#39;*&#39;&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5050352">//&nbsp;Lazily&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050376">var</span>&nbsp;<span class="ident" id="5050380">continuation</span>&nbsp;<span class="keyword" id="5050393">map</span><span class="op" id="5050396">[</span><span class="builtintype" id="5050397">string</span><span class="op" id="5050403">]</span><span class="keyword" id="5050404">map</span><span class="op" id="5050407">[</span><span class="builtintype" id="5050408">string</span><span class="op" id="5050414">]</span><span class="builtintype" id="5050415">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050424">v</span>&nbsp;<span class="op" id="5050426">=</span>&nbsp;<span class="ident" id="5050428">v</span><span class="op" id="5050429">[</span><span class="ident" id="5050430">i</span><span class="op" id="5050431">:</span><span class="op" id="5050432">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050435">for</span>&nbsp;<span class="builtinfunc" id="5050439">len</span><span class="op" id="5050442">(</span><span class="ident" id="5050443">v</span><span class="op" id="5050444">)</span>&nbsp;<span class="op" id="5050446">&gt;</span>&nbsp;<span class="num" id="5050448">0</span>&nbsp;<span class="op" id="5050450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050454">v</span>&nbsp;<span class="op" id="5050456">=</span>&nbsp;<span class="ident" id="5050458">strings</span><span class="op" id="5050465">.</span><span class="ident" id="5050466">TrimLeftFunc</span><span class="op" id="5050478">(</span><span class="ident" id="5050479">v</span><span class="op" id="5050480">,</span>&nbsp;<span class="ident" id="5050482">unicode</span><span class="op" id="5050489">.</span><span class="ident" id="5050490">IsSpace</span><span class="op" id="5050497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050501">if</span>&nbsp;<span class="builtinfunc" id="5050504">len</span><span class="op" id="5050507">(</span><span class="ident" id="5050508">v</span><span class="op" id="5050509">)</span>&nbsp;<span class="op" id="5050511">==</span>&nbsp;<span class="num" id="5050514">0</span>&nbsp;<span class="op" id="5050516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050521">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5050529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050533">key</span><span class="op" id="5050536">,</span>&nbsp;<span class="ident" id="5050538">value</span><span class="op" id="5050543">,</span>&nbsp;<span class="ident" id="5050545">rest</span>&nbsp;<span class="op" id="5050550">:=</span>&nbsp;<span class="ident" id="5050553">consumeMediaParam</span><span class="op" id="5050570">(</span><span class="ident" id="5050571">v</span><span class="op" id="5050572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050576">if</span>&nbsp;<span class="ident" id="5050579">key</span>&nbsp;<span class="op" id="5050583">==</span>&nbsp;<span class="string" id="5050586">&#34;&#34;</span>&nbsp;<span class="op" id="5050589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050594">if</span>&nbsp;<span class="ident" id="5050597">strings</span><span class="op" id="5050604">.</span><span class="ident" id="5050605">TrimSpace</span><span class="op" id="5050614">(</span><span class="ident" id="5050615">rest</span><span class="op" id="5050619">)</span>&nbsp;<span class="op" id="5050621">==</span>&nbsp;<span class="string" id="5050624">&#34;;&#34;</span>&nbsp;<span class="op" id="5050628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5050634">//&nbsp;Ignore&nbsp;trailing&nbsp;semicolons.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5050669">//&nbsp;Not&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050690">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5050700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5050705">//&nbsp;Parse&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050724">return</span>&nbsp;<span class="string" id="5050731">&#34;&#34;</span><span class="op" id="5050733">,</span>&nbsp;<span class="ident" id="5050735">nil</span><span class="op" id="5050738">,</span>&nbsp;<span class="ident" id="5050740">errors</span><span class="op" id="5050746">.</span><span class="ident" id="5050747">New</span><span class="op" id="5050750">(</span><span class="string" id="5050751">&#34;mime:&nbsp;invalid&nbsp;media&nbsp;parameter&#34;</span><span class="op" id="5050782">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5050786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050791">pmap</span>&nbsp;<span class="op" id="5050796">:=</span>&nbsp;<span class="ident" id="5050799">params</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050808">if</span>&nbsp;<span class="ident" id="5050811">idx</span>&nbsp;<span class="op" id="5050815">:=</span>&nbsp;<span class="ident" id="5050818">strings</span><span class="op" id="5050825">.</span><span class="ident" id="5050826">Index</span><span class="op" id="5050831">(</span><span class="ident" id="5050832">key</span><span class="op" id="5050835">,</span>&nbsp;<span class="string" id="5050837">&#34;*&#34;</span><span class="op" id="5050840">)</span><span class="op" id="5050841">;</span>&nbsp;<span class="ident" id="5050843">idx</span>&nbsp;<span class="op" id="5050847">!=</span>&nbsp;<span class="op" id="5050850">-</span><span class="num" id="5050851">1</span>&nbsp;<span class="op" id="5050853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050858">baseName</span>&nbsp;<span class="op" id="5050867">:=</span>&nbsp;<span class="ident" id="5050870">key</span><span class="op" id="5050873">[</span><span class="op" id="5050874">:</span><span class="ident" id="5050875">idx</span><span class="op" id="5050878">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050883">if</span>&nbsp;<span class="ident" id="5050886">continuation</span>&nbsp;<span class="op" id="5050899">==</span>&nbsp;<span class="ident" id="5050902">nil</span>&nbsp;<span class="op" id="5050906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050912">continuation</span>&nbsp;<span class="op" id="5050925">=</span>&nbsp;<span class="builtinfunc" id="5050927">make</span><span class="op" id="5050931">(</span><span class="keyword" id="5050932">map</span><span class="op" id="5050935">[</span><span class="builtintype" id="5050936">string</span><span class="op" id="5050942">]</span><span class="keyword" id="5050943">map</span><span class="op" id="5050946">[</span><span class="builtintype" id="5050947">string</span><span class="op" id="5050953">]</span><span class="builtintype" id="5050954">string</span><span class="op" id="5050960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5050965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050970">var</span>&nbsp;<span class="ident" id="5050974">ok</span>&nbsp;<span class="builtintype" id="5050977">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050985">if</span>&nbsp;<span class="ident" id="5050988">pmap</span><span class="op" id="5050992">,</span>&nbsp;<span class="ident" id="5050994">ok</span>&nbsp;<span class="op" id="5050997">=</span>&nbsp;<span class="ident" id="5050999">continuation</span><span class="op" id="5051011">[</span><span class="ident" id="5051012">baseName</span><span class="op" id="5051020">]</span><span class="op" id="5051021">;</span>&nbsp;<span class="op" id="5051023">!</span><span class="ident" id="5051024">ok</span>&nbsp;<span class="op" id="5051027">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051033">continuation</span><span class="op" id="5051045">[</span><span class="ident" id="5051046">baseName</span><span class="op" id="5051054">]</span>&nbsp;<span class="op" id="5051056">=</span>&nbsp;<span class="builtinfunc" id="5051058">make</span><span class="op" id="5051062">(</span><span class="keyword" id="5051063">map</span><span class="op" id="5051066">[</span><span class="builtintype" id="5051067">string</span><span class="op" id="5051073">]</span><span class="builtintype" id="5051074">string</span><span class="op" id="5051080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051086">pmap</span>&nbsp;<span class="op" id="5051091">=</span>&nbsp;<span class="ident" id="5051093">continuation</span><span class="op" id="5051105">[</span><span class="ident" id="5051106">baseName</span><span class="op" id="5051114">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5051119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5051123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051127">if</span>&nbsp;<span class="ident" id="5051130">_</span><span class="op" id="5051131">,</span>&nbsp;<span class="ident" id="5051133">exists</span>&nbsp;<span class="op" id="5051140">:=</span>&nbsp;<span class="ident" id="5051143">pmap</span><span class="op" id="5051147">[</span><span class="ident" id="5051148">key</span><span class="op" id="5051151">]</span><span class="op" id="5051152">;</span>&nbsp;<span class="ident" id="5051154">exists</span>&nbsp;<span class="op" id="5051161">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5051166">//&nbsp;Duplicate&nbsp;parameter&nbsp;name&nbsp;is&nbsp;bogus.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051207">return</span>&nbsp;<span class="string" id="5051214">&#34;&#34;</span><span class="op" id="5051216">,</span>&nbsp;<span class="ident" id="5051218">nil</span><span class="op" id="5051221">,</span>&nbsp;<span class="ident" id="5051223">errors</span><span class="op" id="5051229">.</span><span class="ident" id="5051230">New</span><span class="op" id="5051233">(</span><span class="string" id="5051234">&#34;mime:&nbsp;duplicate&nbsp;parameter&nbsp;name&#34;</span><span class="op" id="5051266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5051270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051274">pmap</span><span class="op" id="5051278">[</span><span class="ident" id="5051279">key</span><span class="op" id="5051282">]</span>&nbsp;<span class="op" id="5051284">=</span>&nbsp;<span class="ident" id="5051286">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051294">v</span>&nbsp;<span class="op" id="5051296">=</span>&nbsp;<span class="ident" id="5051298">rest</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5051304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5051308">//&nbsp;Stitch&nbsp;together&nbsp;any&nbsp;continuations&nbsp;or&nbsp;things&nbsp;with&nbsp;stars</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5051367">//&nbsp;(i.e.&nbsp;RFC&nbsp;2231&nbsp;things&nbsp;with&nbsp;stars:&nbsp;&#34;foo*0&#34;&nbsp;or&nbsp;&#34;foo*&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051424">var</span>&nbsp;<span class="ident" id="5051428">buf</span>&nbsp;<span class="ident" id="5051432">bytes</span><span class="op" id="5051437">.</span><span class="ident" id="5051438">Buffer</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051446">for</span>&nbsp;<span class="ident" id="5051450">key</span><span class="op" id="5051453">,</span>&nbsp;<span class="ident" id="5051455">pieceMap</span>&nbsp;<span class="op" id="5051464">:=</span>&nbsp;<span class="keyword" id="5051467">range</span>&nbsp;<span class="ident" id="5051473">continuation</span>&nbsp;<span class="op" id="5051486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051490">singlePartKey</span>&nbsp;<span class="op" id="5051504">:=</span>&nbsp;<span class="ident" id="5051507">key</span>&nbsp;<span class="op" id="5051511">+</span>&nbsp;<span class="string" id="5051513">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051519">if</span>&nbsp;<span class="ident" id="5051522">v</span><span class="op" id="5051523">,</span>&nbsp;<span class="ident" id="5051525">ok</span>&nbsp;<span class="op" id="5051528">:=</span>&nbsp;<span class="ident" id="5051531">pieceMap</span><span class="op" id="5051539">[</span><span class="ident" id="5051540">singlePartKey</span><span class="op" id="5051553">]</span><span class="op" id="5051554">;</span>&nbsp;<span class="ident" id="5051556">ok</span>&nbsp;<span class="op" id="5051559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051564">decv</span>&nbsp;<span class="op" id="5051569">:=</span>&nbsp;<span class="ident" id="5051572">decode2231Enc</span><span class="op" id="5051585">(</span><span class="ident" id="5051586">v</span><span class="op" id="5051587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051592">params</span><span class="op" id="5051598">[</span><span class="ident" id="5051599">key</span><span class="op" id="5051602">]</span>&nbsp;<span class="op" id="5051604">=</span>&nbsp;<span class="ident" id="5051606">decv</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051614">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5051625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051630">buf</span><span class="op" id="5051633">.</span><span class="ident" id="5051634">Reset</span><span class="op" id="5051639">(</span><span class="op" id="5051640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051644">valid</span>&nbsp;<span class="op" id="5051650">:=</span>&nbsp;<span class="builtintype" id="5051653">false</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051661">for</span>&nbsp;<span class="ident" id="5051665">n</span>&nbsp;<span class="op" id="5051667">:=</span>&nbsp;<span class="num" id="5051670">0</span><span class="op" id="5051671">;</span>&nbsp;<span class="op" id="5051673">;</span>&nbsp;<span class="ident" id="5051675">n</span><span class="op" id="5051676">++</span>&nbsp;<span class="op" id="5051679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051684">simplePart</span>&nbsp;<span class="op" id="5051695">:=</span>&nbsp;<span class="ident" id="5051698">fmt</span><span class="op" id="5051701">.</span><span class="ident" id="5051702">Sprintf</span><span class="op" id="5051709">(</span><span class="string" id="5051710">&#34;%s*%d&#34;</span><span class="op" id="5051717">,</span>&nbsp;<span class="ident" id="5051719">key</span><span class="op" id="5051722">,</span>&nbsp;<span class="ident" id="5051724">n</span><span class="op" id="5051725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051730">if</span>&nbsp;<span class="ident" id="5051733">v</span><span class="op" id="5051734">,</span>&nbsp;<span class="ident" id="5051736">ok</span>&nbsp;<span class="op" id="5051739">:=</span>&nbsp;<span class="ident" id="5051742">pieceMap</span><span class="op" id="5051750">[</span><span class="ident" id="5051751">simplePart</span><span class="op" id="5051761">]</span><span class="op" id="5051762">;</span>&nbsp;<span class="ident" id="5051764">ok</span>&nbsp;<span class="op" id="5051767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051773">valid</span>&nbsp;<span class="op" id="5051779">=</span>&nbsp;<span class="builtintype" id="5051781">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051790">buf</span><span class="op" id="5051793">.</span><span class="ident" id="5051794">WriteString</span><span class="op" id="5051805">(</span><span class="ident" id="5051806">v</span><span class="op" id="5051807">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051813">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5051825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051830">encodedPart</span>&nbsp;<span class="op" id="5051842">:=</span>&nbsp;<span class="ident" id="5051845">simplePart</span>&nbsp;<span class="op" id="5051856">+</span>&nbsp;<span class="string" id="5051858">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051865">if</span>&nbsp;<span class="ident" id="5051868">v</span><span class="op" id="5051869">,</span>&nbsp;<span class="ident" id="5051871">ok</span>&nbsp;<span class="op" id="5051874">:=</span>&nbsp;<span class="ident" id="5051877">pieceMap</span><span class="op" id="5051885">[</span><span class="ident" id="5051886">encodedPart</span><span class="op" id="5051897">]</span><span class="op" id="5051898">;</span>&nbsp;<span class="ident" id="5051900">ok</span>&nbsp;<span class="op" id="5051903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051909">valid</span>&nbsp;<span class="op" id="5051915">=</span>&nbsp;<span class="builtintype" id="5051917">true</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051926">if</span>&nbsp;<span class="ident" id="5051929">n</span>&nbsp;<span class="op" id="5051931">==</span>&nbsp;<span class="num" id="5051934">0</span>&nbsp;<span class="op" id="5051936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051943">buf</span><span class="op" id="5051946">.</span><span class="ident" id="5051947">WriteString</span><span class="op" id="5051958">(</span><span class="ident" id="5051959">decode2231Enc</span><span class="op" id="5051972">(</span><span class="ident" id="5051973">v</span><span class="op" id="5051974">)</span><span class="op" id="5051975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5051981">}</span>&nbsp;<span class="keyword" id="5051983">else</span>&nbsp;<span class="op" id="5051988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051995">decv</span><span class="op" id="5051999">,</span>&nbsp;<span class="ident" id="5052001">_</span>&nbsp;<span class="op" id="5052003">:=</span>&nbsp;<span class="ident" id="5052006">percentHexUnescape</span><span class="op" id="5052024">(</span><span class="ident" id="5052025">v</span><span class="op" id="5052026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5052033">buf</span><span class="op" id="5052036">.</span><span class="ident" id="5052037">WriteString</span><span class="op" id="5052048">(</span><span class="ident" id="5052049">decv</span><span class="op" id="5052053">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5052059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5052064">}</span>&nbsp;<span class="keyword" id="5052066">else</span>&nbsp;<span class="op" id="5052071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052077">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5052086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5052090">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052094">if</span>&nbsp;<span class="ident" id="5052097">valid</span>&nbsp;<span class="op" id="5052103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5052108">params</span><span class="op" id="5052114">[</span><span class="ident" id="5052115">key</span><span class="op" id="5052118">]</span>&nbsp;<span class="op" id="5052120">=</span>&nbsp;<span class="ident" id="5052122">buf</span><span class="op" id="5052125">.</span><span class="ident" id="5052126">String</span><span class="op" id="5052132">(</span><span class="op" id="5052133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5052137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5052140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052144">return</span><br>
<span class="lineno"></span><span class="op" id="5052151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5052154">func</span>&nbsp;<span class="ident" id="5052159">decode2231Enc</span><span class="op" id="5052172">(</span><span class="ident" id="5052173">v</span>&nbsp;<span class="builtintype" id="5052175">string</span><span class="op" id="5052181">)</span>&nbsp;<span class="builtintype" id="5052183">string</span>&nbsp;<span class="op" id="5052190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5052193">sv</span>&nbsp;<span class="op" id="5052196">:=</span>&nbsp;<span class="ident" id="5052199">strings</span><span class="op" id="5052206">.</span><span class="ident" id="5052207">SplitN</span><span class="op" id="5052213">(</span><span class="ident" id="5052214">v</span><span class="op" id="5052215">,</span>&nbsp;<span class="string" id="5052217">&#34;&#39;&#34;</span><span class="op" id="5052220">,</span>&nbsp;<span class="num" id="5052222">3</span><span class="op" id="5052223">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052226">if</span>&nbsp;<span class="builtinfunc" id="5052229">len</span><span class="op" id="5052232">(</span><span class="ident" id="5052233">sv</span><span class="op" id="5052235">)</span>&nbsp;<span class="op" id="5052237">!=</span>&nbsp;<span class="num" id="5052240">3</span>&nbsp;<span class="op" id="5052242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052246">return</span>&nbsp;<span class="string" id="5052253">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5052257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5052260">//&nbsp;TODO:&nbsp;ignoring&nbsp;lang&nbsp;in&nbsp;sv[1]&nbsp;for&nbsp;now.&nbsp;If&nbsp;anybody&nbsp;needs&nbsp;it&nbsp;we&#39;ll</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5052328">//&nbsp;need&nbsp;to&nbsp;decide&nbsp;how&nbsp;to&nbsp;expose&nbsp;it&nbsp;in&nbsp;the&nbsp;API.&nbsp;But&nbsp;I&#39;m&nbsp;not&nbsp;sure</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5052393">//&nbsp;anybody&nbsp;uses&nbsp;it&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5052426">charset</span>&nbsp;<span class="op" id="5052434">:=</span>&nbsp;<span class="ident" id="5052437">strings</span><span class="op" id="5052444">.</span><span class="ident" id="5052445">ToLower</span><span class="op" id="5052452">(</span><span class="ident" id="5052453">sv</span><span class="op" id="5052455">[</span><span class="num" id="5052456">0</span><span class="op" id="5052457">]</span><span class="op" id="5052458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052461">if</span>&nbsp;<span class="ident" id="5052464">charset</span>&nbsp;<span class="op" id="5052472">!=</span>&nbsp;<span class="string" id="5052475">&#34;us-ascii&#34;</span>&nbsp;<span class="op" id="5052486">&amp;&amp;</span>&nbsp;<span class="ident" id="5052489">charset</span>&nbsp;<span class="op" id="5052497">!=</span>&nbsp;<span class="string" id="5052500">&#34;utf-8&#34;</span>&nbsp;<span class="op" id="5052508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5052512">//&nbsp;TODO:&nbsp;unsupported&nbsp;encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052544">return</span>&nbsp;<span class="string" id="5052551">&#34;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5052555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5052558">encv</span><span class="op" id="5052562">,</span>&nbsp;<span class="ident" id="5052564">_</span>&nbsp;<span class="op" id="5052566">:=</span>&nbsp;<span class="ident" id="5052569">percentHexUnescape</span><span class="op" id="5052587">(</span><span class="ident" id="5052588">sv</span><span class="op" id="5052590">[</span><span class="num" id="5052591">2</span><span class="op" id="5052592">]</span><span class="op" id="5052593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052596">return</span>&nbsp;<span class="ident" id="5052603">encv</span><br>
<span class="lineno"></span><span class="op" id="5052608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="5052611">func</span>&nbsp;<span class="ident" id="5052616">isNotTokenChar</span><span class="op" id="5052630">(</span><span class="ident" id="5052631">r</span>&nbsp;<span class="builtintype" id="5052633">rune</span><span class="op" id="5052637">)</span>&nbsp;<span class="builtintype" id="5052639">bool</span>&nbsp;<span class="op" id="5052644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052647">return</span>&nbsp;<span class="op" id="5052654">!</span><span class="ident" id="5052655">isTokenChar</span><span class="op" id="5052666">(</span><span class="ident" id="5052667">r</span><span class="op" id="5052668">)</span><br>
<span class="lineno"></span><span class="op" id="5052670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5052673">//&nbsp;consumeToken&nbsp;consumes&nbsp;a&nbsp;token&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;provided</span><br>
<span class="lineno">220</span><span class="comment" id="5052737">//&nbsp;string,&nbsp;per&nbsp;RFC&nbsp;2045&nbsp;section&nbsp;5.1&nbsp;(referenced&nbsp;from&nbsp;2183),&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5052808">//&nbsp;the&nbsp;token&nbsp;consumed&nbsp;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;string.&nbsp;&nbsp;Returns&nbsp;(&#34;&#34;,&nbsp;v)&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="5052878">//&nbsp;failure&nbsp;to&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;character.</span><br>
<span class="lineno"></span><span class="keyword" id="5052924">func</span>&nbsp;<span class="ident" id="5052929">consumeToken</span><span class="op" id="5052941">(</span><span class="ident" id="5052942">v</span>&nbsp;<span class="builtintype" id="5052944">string</span><span class="op" id="5052950">)</span>&nbsp;<span class="op" id="5052952">(</span><span class="ident" id="5052953">token</span><span class="op" id="5052958">,</span>&nbsp;<span class="ident" id="5052960">rest</span>&nbsp;<span class="builtintype" id="5052965">string</span><span class="op" id="5052971">)</span>&nbsp;<span class="op" id="5052973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5052976">notPos</span>&nbsp;<span class="op" id="5052983">:=</span>&nbsp;<span class="ident" id="5052986">strings</span><span class="op" id="5052993">.</span><span class="ident" id="5052994">IndexFunc</span><span class="op" id="5053003">(</span><span class="ident" id="5053004">v</span><span class="op" id="5053005">,</span>&nbsp;<span class="ident" id="5053007">isNotTokenChar</span><span class="op" id="5053021">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053024">if</span>&nbsp;<span class="ident" id="5053027">notPos</span>&nbsp;<span class="op" id="5053034">==</span>&nbsp;<span class="op" id="5053037">-</span><span class="num" id="5053038">1</span>&nbsp;<span class="op" id="5053040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053044">return</span>&nbsp;<span class="ident" id="5053051">v</span><span class="op" id="5053052">,</span>&nbsp;<span class="string" id="5053054">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5053058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053061">if</span>&nbsp;<span class="ident" id="5053064">notPos</span>&nbsp;<span class="op" id="5053071">==</span>&nbsp;<span class="num" id="5053074">0</span>&nbsp;<span class="op" id="5053076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053080">return</span>&nbsp;<span class="string" id="5053087">&#34;&#34;</span><span class="op" id="5053089">,</span>&nbsp;<span class="ident" id="5053091">v</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5053094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053097">return</span>&nbsp;<span class="ident" id="5053104">v</span><span class="op" id="5053105">[</span><span class="num" id="5053106">0</span><span class="op" id="5053107">:</span><span class="ident" id="5053108">notPos</span><span class="op" id="5053114">]</span><span class="op" id="5053115">,</span>&nbsp;<span class="ident" id="5053117">v</span><span class="op" id="5053118">[</span><span class="ident" id="5053119">notPos</span><span class="op" id="5053125">:</span><span class="op" id="5053126">]</span><br>
<span class="lineno"></span><span class="op" id="5053128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5053131">//&nbsp;consumeValue&nbsp;consumes&nbsp;a&nbsp;&#34;value&#34;&nbsp;per&nbsp;RFC&nbsp;2045,&nbsp;where&nbsp;a&nbsp;value&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="5053197">//&nbsp;either&nbsp;a&nbsp;&#39;token&#39;&nbsp;or&nbsp;a&nbsp;&#39;quoted-string&#39;.&nbsp;&nbsp;On&nbsp;success,&nbsp;consumeValue</span><br>
<span class="lineno"></span><span class="comment" id="5053265">//&nbsp;returns&nbsp;the&nbsp;value&nbsp;consumed&nbsp;(and&nbsp;de-quoted/escaped,&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5053324">//&nbsp;quoted-string)&nbsp;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;string.&nbsp;&nbsp;On&nbsp;failure,&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5053391">//&nbsp;(&#34;&#34;,&nbsp;v).</span><br>
<span class="lineno"></span><span class="keyword" id="5053403">func</span>&nbsp;<span class="ident" id="5053408">consumeValue</span><span class="op" id="5053420">(</span><span class="ident" id="5053421">v</span>&nbsp;<span class="builtintype" id="5053423">string</span><span class="op" id="5053429">)</span>&nbsp;<span class="op" id="5053431">(</span><span class="ident" id="5053432">value</span><span class="op" id="5053437">,</span>&nbsp;<span class="ident" id="5053439">rest</span>&nbsp;<span class="builtintype" id="5053444">string</span><span class="op" id="5053450">)</span>&nbsp;<span class="op" id="5053452">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053455">if</span>&nbsp;<span class="op" id="5053458">!</span><span class="ident" id="5053459">strings</span><span class="op" id="5053466">.</span><span class="ident" id="5053467">HasPrefix</span><span class="op" id="5053476">(</span><span class="ident" id="5053477">v</span><span class="op" id="5053478">,</span>&nbsp;<span class="string" id="5053480">`&#34;`</span><span class="op" id="5053483">)</span>&nbsp;<span class="op" id="5053485">&amp;&amp;</span>&nbsp;<span class="op" id="5053488">!</span><span class="ident" id="5053489">strings</span><span class="op" id="5053496">.</span><span class="ident" id="5053497">HasPrefix</span><span class="op" id="5053506">(</span><span class="ident" id="5053507">v</span><span class="op" id="5053508">,</span>&nbsp;<span class="string" id="5053510">`&#39;`</span><span class="op" id="5053513">)</span>&nbsp;<span class="op" id="5053515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053519">return</span>&nbsp;<span class="ident" id="5053526">consumeToken</span><span class="op" id="5053538">(</span><span class="ident" id="5053539">v</span><span class="op" id="5053540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5053543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053547">leadQuote</span>&nbsp;<span class="op" id="5053557">:=</span>&nbsp;<span class="builtintype" id="5053560">rune</span><span class="op" id="5053564">(</span><span class="ident" id="5053565">v</span><span class="op" id="5053566">[</span><span class="num" id="5053567">0</span><span class="op" id="5053568">]</span><span class="op" id="5053569">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5053573">//&nbsp;parse&nbsp;a&nbsp;quoted-string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053599">rest</span>&nbsp;<span class="op" id="5053604">=</span>&nbsp;<span class="ident" id="5053606">v</span><span class="op" id="5053607">[</span><span class="num" id="5053608">1</span><span class="op" id="5053609">:</span><span class="op" id="5053610">]</span>&nbsp;<span class="comment" id="5053612">//&nbsp;consume&nbsp;the&nbsp;leading&nbsp;quote</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053642">buffer</span>&nbsp;<span class="op" id="5053649">:=</span>&nbsp;<span class="builtinfunc" id="5053652">new</span><span class="op" id="5053655">(</span><span class="ident" id="5053656">bytes</span><span class="op" id="5053661">.</span><span class="ident" id="5053662">Buffer</span><span class="op" id="5053668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053671">var</span>&nbsp;<span class="ident" id="5053675">idx</span>&nbsp;<span class="builtintype" id="5053679">int</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053684">var</span>&nbsp;<span class="ident" id="5053688">r</span>&nbsp;<span class="builtintype" id="5053690">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053696">var</span>&nbsp;<span class="ident" id="5053700">nextIsLiteral</span>&nbsp;<span class="builtintype" id="5053714">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053720">for</span>&nbsp;<span class="ident" id="5053724">idx</span><span class="op" id="5053727">,</span>&nbsp;<span class="ident" id="5053729">r</span>&nbsp;<span class="op" id="5053731">=</span>&nbsp;<span class="keyword" id="5053733">range</span>&nbsp;<span class="ident" id="5053739">rest</span>&nbsp;<span class="op" id="5053744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053748">switch</span>&nbsp;<span class="op" id="5053755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053759">case</span>&nbsp;<span class="ident" id="5053764">nextIsLiteral</span><span class="op" id="5053777">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053782">buffer</span><span class="op" id="5053788">.</span><span class="ident" id="5053789">WriteRune</span><span class="op" id="5053798">(</span><span class="ident" id="5053799">r</span><span class="op" id="5053800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053805">nextIsLiteral</span>&nbsp;<span class="op" id="5053819">=</span>&nbsp;<span class="builtintype" id="5053821">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053829">case</span>&nbsp;<span class="ident" id="5053834">r</span>&nbsp;<span class="op" id="5053836">==</span>&nbsp;<span class="ident" id="5053839">leadQuote</span><span class="op" id="5053848">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053853">return</span>&nbsp;<span class="ident" id="5053860">buffer</span><span class="op" id="5053866">.</span><span class="ident" id="5053867">String</span><span class="op" id="5053873">(</span><span class="op" id="5053874">)</span><span class="op" id="5053875">,</span>&nbsp;<span class="ident" id="5053877">rest</span><span class="op" id="5053881">[</span><span class="ident" id="5053882">idx</span><span class="op" id="5053885">+</span><span class="num" id="5053886">1</span><span class="op" id="5053887">:</span><span class="op" id="5053888">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053892">case</span>&nbsp;<span class="ident" id="5053897">r</span>&nbsp;<span class="op" id="5053899">==</span>&nbsp;<span class="string" id="5053902">&#39;\\&#39;</span><span class="op" id="5053906">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053911">nextIsLiteral</span>&nbsp;<span class="op" id="5053925">=</span>&nbsp;<span class="builtintype" id="5053927">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053934">case</span>&nbsp;<span class="ident" id="5053939">r</span>&nbsp;<span class="op" id="5053941">!=</span>&nbsp;<span class="string" id="5053944">&#39;\r&#39;</span>&nbsp;<span class="op" id="5053949">&amp;&amp;</span>&nbsp;<span class="ident" id="5053952">r</span>&nbsp;<span class="op" id="5053954">!=</span>&nbsp;<span class="string" id="5053957">&#39;\n&#39;</span><span class="op" id="5053961">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053966">buffer</span><span class="op" id="5053972">.</span><span class="ident" id="5053973">WriteRune</span><span class="op" id="5053982">(</span><span class="ident" id="5053983">r</span><span class="op" id="5053984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053988">default</span><span class="op" id="5053995">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054000">return</span>&nbsp;<span class="string" id="5054007">&#34;&#34;</span><span class="op" id="5054009">,</span>&nbsp;<span class="ident" id="5054011">v</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5054015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5054018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054021">return</span>&nbsp;<span class="string" id="5054028">&#34;&#34;</span><span class="op" id="5054030">,</span>&nbsp;<span class="ident" id="5054032">v</span><br>
<span class="lineno"></span><span class="op" id="5054034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="5054037">func</span>&nbsp;<span class="ident" id="5054042">consumeMediaParam</span><span class="op" id="5054059">(</span><span class="ident" id="5054060">v</span>&nbsp;<span class="builtintype" id="5054062">string</span><span class="op" id="5054068">)</span>&nbsp;<span class="op" id="5054070">(</span><span class="ident" id="5054071">param</span><span class="op" id="5054076">,</span>&nbsp;<span class="ident" id="5054078">value</span><span class="op" id="5054083">,</span>&nbsp;<span class="ident" id="5054085">rest</span>&nbsp;<span class="builtintype" id="5054090">string</span><span class="op" id="5054096">)</span>&nbsp;<span class="op" id="5054098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054101">rest</span>&nbsp;<span class="op" id="5054106">=</span>&nbsp;<span class="ident" id="5054108">strings</span><span class="op" id="5054115">.</span><span class="ident" id="5054116">TrimLeftFunc</span><span class="op" id="5054128">(</span><span class="ident" id="5054129">v</span><span class="op" id="5054130">,</span>&nbsp;<span class="ident" id="5054132">unicode</span><span class="op" id="5054139">.</span><span class="ident" id="5054140">IsSpace</span><span class="op" id="5054147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054150">if</span>&nbsp;<span class="op" id="5054153">!</span><span class="ident" id="5054154">strings</span><span class="op" id="5054161">.</span><span class="ident" id="5054162">HasPrefix</span><span class="op" id="5054171">(</span><span class="ident" id="5054172">rest</span><span class="op" id="5054176">,</span>&nbsp;<span class="string" id="5054178">&#34;;&#34;</span><span class="op" id="5054181">)</span>&nbsp;<span class="op" id="5054183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054187">return</span>&nbsp;<span class="string" id="5054194">&#34;&#34;</span><span class="op" id="5054196">,</span>&nbsp;<span class="string" id="5054198">&#34;&#34;</span><span class="op" id="5054200">,</span>&nbsp;<span class="ident" id="5054202">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5054205">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054209">rest</span>&nbsp;<span class="op" id="5054214">=</span>&nbsp;<span class="ident" id="5054216">rest</span><span class="op" id="5054220">[</span><span class="num" id="5054221">1</span><span class="op" id="5054222">:</span><span class="op" id="5054223">]</span>&nbsp;<span class="comment" id="5054225">//&nbsp;consume&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054247">rest</span>&nbsp;<span class="op" id="5054252">=</span>&nbsp;<span class="ident" id="5054254">strings</span><span class="op" id="5054261">.</span><span class="ident" id="5054262">TrimLeftFunc</span><span class="op" id="5054274">(</span><span class="ident" id="5054275">rest</span><span class="op" id="5054279">,</span>&nbsp;<span class="ident" id="5054281">unicode</span><span class="op" id="5054288">.</span><span class="ident" id="5054289">IsSpace</span><span class="op" id="5054296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054299">param</span><span class="op" id="5054304">,</span>&nbsp;<span class="ident" id="5054306">rest</span>&nbsp;<span class="op" id="5054311">=</span>&nbsp;<span class="ident" id="5054313">consumeToken</span><span class="op" id="5054325">(</span><span class="ident" id="5054326">rest</span><span class="op" id="5054330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054333">param</span>&nbsp;<span class="op" id="5054339">=</span>&nbsp;<span class="ident" id="5054341">strings</span><span class="op" id="5054348">.</span><span class="ident" id="5054349">ToLower</span><span class="op" id="5054356">(</span><span class="ident" id="5054357">param</span><span class="op" id="5054362">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054365">if</span>&nbsp;<span class="ident" id="5054368">param</span>&nbsp;<span class="op" id="5054374">==</span>&nbsp;<span class="string" id="5054377">&#34;&#34;</span>&nbsp;<span class="op" id="5054380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054384">return</span>&nbsp;<span class="string" id="5054391">&#34;&#34;</span><span class="op" id="5054393">,</span>&nbsp;<span class="string" id="5054395">&#34;&#34;</span><span class="op" id="5054397">,</span>&nbsp;<span class="ident" id="5054399">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5054402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054406">rest</span>&nbsp;<span class="op" id="5054411">=</span>&nbsp;<span class="ident" id="5054413">strings</span><span class="op" id="5054420">.</span><span class="ident" id="5054421">TrimLeftFunc</span><span class="op" id="5054433">(</span><span class="ident" id="5054434">rest</span><span class="op" id="5054438">,</span>&nbsp;<span class="ident" id="5054440">unicode</span><span class="op" id="5054447">.</span><span class="ident" id="5054448">IsSpace</span><span class="op" id="5054455">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054458">if</span>&nbsp;<span class="op" id="5054461">!</span><span class="ident" id="5054462">strings</span><span class="op" id="5054469">.</span><span class="ident" id="5054470">HasPrefix</span><span class="op" id="5054479">(</span><span class="ident" id="5054480">rest</span><span class="op" id="5054484">,</span>&nbsp;<span class="string" id="5054486">&#34;=&#34;</span><span class="op" id="5054489">)</span>&nbsp;<span class="op" id="5054491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054495">return</span>&nbsp;<span class="string" id="5054502">&#34;&#34;</span><span class="op" id="5054504">,</span>&nbsp;<span class="string" id="5054506">&#34;&#34;</span><span class="op" id="5054508">,</span>&nbsp;<span class="ident" id="5054510">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5054513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054516">rest</span>&nbsp;<span class="op" id="5054521">=</span>&nbsp;<span class="ident" id="5054523">rest</span><span class="op" id="5054527">[</span><span class="num" id="5054528">1</span><span class="op" id="5054529">:</span><span class="op" id="5054530">]</span>&nbsp;<span class="comment" id="5054532">//&nbsp;consume&nbsp;equals&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054556">rest</span>&nbsp;<span class="op" id="5054561">=</span>&nbsp;<span class="ident" id="5054563">strings</span><span class="op" id="5054570">.</span><span class="ident" id="5054571">TrimLeftFunc</span><span class="op" id="5054583">(</span><span class="ident" id="5054584">rest</span><span class="op" id="5054588">,</span>&nbsp;<span class="ident" id="5054590">unicode</span><span class="op" id="5054597">.</span><span class="ident" id="5054598">IsSpace</span><span class="op" id="5054605">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054608">value</span><span class="op" id="5054613">,</span>&nbsp;<span class="ident" id="5054615">rest</span>&nbsp;<span class="op" id="5054620">=</span>&nbsp;<span class="ident" id="5054622">consumeValue</span><span class="op" id="5054634">(</span><span class="ident" id="5054635">rest</span><span class="op" id="5054639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054642">if</span>&nbsp;<span class="ident" id="5054645">value</span>&nbsp;<span class="op" id="5054651">==</span>&nbsp;<span class="string" id="5054654">&#34;&#34;</span>&nbsp;<span class="op" id="5054657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054661">return</span>&nbsp;<span class="string" id="5054668">&#34;&#34;</span><span class="op" id="5054670">,</span>&nbsp;<span class="string" id="5054672">&#34;&#34;</span><span class="op" id="5054674">,</span>&nbsp;<span class="ident" id="5054676">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5054679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054682">return</span>&nbsp;<span class="ident" id="5054689">param</span><span class="op" id="5054694">,</span>&nbsp;<span class="ident" id="5054696">value</span><span class="op" id="5054701">,</span>&nbsp;<span class="ident" id="5054703">rest</span><br>
<span class="lineno">295</span><span class="op" id="5054708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5054711">func</span>&nbsp;<span class="ident" id="5054716">percentHexUnescape</span><span class="op" id="5054734">(</span><span class="ident" id="5054735">s</span>&nbsp;<span class="builtintype" id="5054737">string</span><span class="op" id="5054743">)</span>&nbsp;<span class="op" id="5054745">(</span><span class="builtintype" id="5054746">string</span><span class="op" id="5054752">,</span>&nbsp;<span class="builtintype" id="5054754">error</span><span class="op" id="5054759">)</span>&nbsp;<span class="op" id="5054761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5054764">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054809">percents</span>&nbsp;<span class="op" id="5054818">:=</span>&nbsp;<span class="num" id="5054821">0</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054824">for</span>&nbsp;<span class="ident" id="5054828">i</span>&nbsp;<span class="op" id="5054830">:=</span>&nbsp;<span class="num" id="5054833">0</span><span class="op" id="5054834">;</span>&nbsp;<span class="ident" id="5054836">i</span>&nbsp;<span class="op" id="5054838">&lt;</span>&nbsp;<span class="builtinfunc" id="5054840">len</span><span class="op" id="5054843">(</span><span class="ident" id="5054844">s</span><span class="op" id="5054845">)</span><span class="op" id="5054846">;</span>&nbsp;<span class="op" id="5054848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054852">if</span>&nbsp;<span class="ident" id="5054855">s</span><span class="op" id="5054856">[</span><span class="ident" id="5054857">i</span><span class="op" id="5054858">]</span>&nbsp;<span class="op" id="5054860">!=</span>&nbsp;<span class="string" id="5054863">&#39;%&#39;</span>&nbsp;<span class="op" id="5054867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054872">i</span><span class="op" id="5054873">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054879">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5054890">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054894">percents</span><span class="op" id="5054902">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054907">if</span>&nbsp;<span class="ident" id="5054910">i</span><span class="op" id="5054911">+</span><span class="num" id="5054912">2</span>&nbsp;<span class="op" id="5054914">&gt;=</span>&nbsp;<span class="builtinfunc" id="5054917">len</span><span class="op" id="5054920">(</span><span class="ident" id="5054921">s</span><span class="op" id="5054922">)</span>&nbsp;<span class="op" id="5054924">||</span>&nbsp;<span class="op" id="5054927">!</span><span class="ident" id="5054928">ishex</span><span class="op" id="5054933">(</span><span class="ident" id="5054934">s</span><span class="op" id="5054935">[</span><span class="ident" id="5054936">i</span><span class="op" id="5054937">+</span><span class="num" id="5054938">1</span><span class="op" id="5054939">]</span><span class="op" id="5054940">)</span>&nbsp;<span class="op" id="5054942">||</span>&nbsp;<span class="op" id="5054945">!</span><span class="ident" id="5054946">ishex</span><span class="op" id="5054951">(</span><span class="ident" id="5054952">s</span><span class="op" id="5054953">[</span><span class="ident" id="5054954">i</span><span class="op" id="5054955">+</span><span class="num" id="5054956">2</span><span class="op" id="5054957">]</span><span class="op" id="5054958">)</span>&nbsp;<span class="op" id="5054960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054965">s</span>&nbsp;<span class="op" id="5054967">=</span>&nbsp;<span class="ident" id="5054969">s</span><span class="op" id="5054970">[</span><span class="ident" id="5054971">i</span><span class="op" id="5054972">:</span><span class="op" id="5054973">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054978">if</span>&nbsp;<span class="builtinfunc" id="5054981">len</span><span class="op" id="5054984">(</span><span class="ident" id="5054985">s</span><span class="op" id="5054986">)</span>&nbsp;<span class="op" id="5054988">&gt;</span>&nbsp;<span class="num" id="5054990">3</span>&nbsp;<span class="op" id="5054992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054998">s</span>&nbsp;<span class="op" id="5055000">=</span>&nbsp;<span class="ident" id="5055002">s</span><span class="op" id="5055003">[</span><span class="num" id="5055004">0</span><span class="op" id="5055005">:</span><span class="num" id="5055006">3</span><span class="op" id="5055007">]</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5055012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055017">return</span>&nbsp;<span class="string" id="5055024">&#34;&#34;</span><span class="op" id="5055026">,</span>&nbsp;<span class="ident" id="5055028">fmt</span><span class="op" id="5055031">.</span><span class="ident" id="5055032">Errorf</span><span class="op" id="5055038">(</span><span class="string" id="5055039">&#34;mime:&nbsp;bogus&nbsp;characters&nbsp;after&nbsp;%%:&nbsp;%q&#34;</span><span class="op" id="5055076">,</span>&nbsp;<span class="ident" id="5055078">s</span><span class="op" id="5055079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5055083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055087">i</span>&nbsp;<span class="op" id="5055089">+=</span>&nbsp;<span class="num" id="5055092">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5055095">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055098">if</span>&nbsp;<span class="ident" id="5055101">percents</span>&nbsp;<span class="op" id="5055110">==</span>&nbsp;<span class="num" id="5055113">0</span>&nbsp;<span class="op" id="5055115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055119">return</span>&nbsp;<span class="ident" id="5055126">s</span><span class="op" id="5055127">,</span>&nbsp;<span class="ident" id="5055129">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5055134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055138">t</span>&nbsp;<span class="op" id="5055140">:=</span>&nbsp;<span class="builtinfunc" id="5055143">make</span><span class="op" id="5055147">(</span><span class="op" id="5055148">[</span><span class="op" id="5055149">]</span><span class="builtintype" id="5055150">byte</span><span class="op" id="5055154">,</span>&nbsp;<span class="builtinfunc" id="5055156">len</span><span class="op" id="5055159">(</span><span class="ident" id="5055160">s</span><span class="op" id="5055161">)</span><span class="op" id="5055162">-</span><span class="num" id="5055163">2</span><span class="op" id="5055164">*</span><span class="ident" id="5055165">percents</span><span class="op" id="5055173">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055176">j</span>&nbsp;<span class="op" id="5055178">:=</span>&nbsp;<span class="num" id="5055181">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055184">for</span>&nbsp;<span class="ident" id="5055188">i</span>&nbsp;<span class="op" id="5055190">:=</span>&nbsp;<span class="num" id="5055193">0</span><span class="op" id="5055194">;</span>&nbsp;<span class="ident" id="5055196">i</span>&nbsp;<span class="op" id="5055198">&lt;</span>&nbsp;<span class="builtinfunc" id="5055200">len</span><span class="op" id="5055203">(</span><span class="ident" id="5055204">s</span><span class="op" id="5055205">)</span><span class="op" id="5055206">;</span>&nbsp;<span class="op" id="5055208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055212">switch</span>&nbsp;<span class="ident" id="5055219">s</span><span class="op" id="5055220">[</span><span class="ident" id="5055221">i</span><span class="op" id="5055222">]</span>&nbsp;<span class="op" id="5055224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055228">case</span>&nbsp;<span class="string" id="5055233">&#39;%&#39;</span><span class="op" id="5055236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055241">t</span><span class="op" id="5055242">[</span><span class="ident" id="5055243">j</span><span class="op" id="5055244">]</span>&nbsp;<span class="op" id="5055246">=</span>&nbsp;<span class="ident" id="5055248">unhex</span><span class="op" id="5055253">(</span><span class="ident" id="5055254">s</span><span class="op" id="5055255">[</span><span class="ident" id="5055256">i</span><span class="op" id="5055257">+</span><span class="num" id="5055258">1</span><span class="op" id="5055259">]</span><span class="op" id="5055260">)</span><span class="op" id="5055261">&lt;&lt;</span><span class="num" id="5055263">4</span>&nbsp;<span class="op" id="5055265">|</span>&nbsp;<span class="ident" id="5055267">unhex</span><span class="op" id="5055272">(</span><span class="ident" id="5055273">s</span><span class="op" id="5055274">[</span><span class="ident" id="5055275">i</span><span class="op" id="5055276">+</span><span class="num" id="5055277">2</span><span class="op" id="5055278">]</span><span class="op" id="5055279">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055284">j</span><span class="op" id="5055285">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055291">i</span>&nbsp;<span class="op" id="5055293">+=</span>&nbsp;<span class="num" id="5055296">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055300">default</span><span class="op" id="5055307">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055312">t</span><span class="op" id="5055313">[</span><span class="ident" id="5055314">j</span><span class="op" id="5055315">]</span>&nbsp;<span class="op" id="5055317">=</span>&nbsp;<span class="ident" id="5055319">s</span><span class="op" id="5055320">[</span><span class="ident" id="5055321">i</span><span class="op" id="5055322">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055327">j</span><span class="op" id="5055328">++</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055334">i</span><span class="op" id="5055335">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5055340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5055343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055346">return</span>&nbsp;<span class="builtintype" id="5055353">string</span><span class="op" id="5055359">(</span><span class="ident" id="5055360">t</span><span class="op" id="5055361">)</span><span class="op" id="5055362">,</span>&nbsp;<span class="ident" id="5055364">nil</span><br>
<span class="lineno"></span><span class="op" id="5055368">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="keyword" id="5055371">func</span>&nbsp;<span class="ident" id="5055376">ishex</span><span class="op" id="5055381">(</span><span class="ident" id="5055382">c</span>&nbsp;<span class="builtintype" id="5055384">byte</span><span class="op" id="5055388">)</span>&nbsp;<span class="builtintype" id="5055390">bool</span>&nbsp;<span class="op" id="5055395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055398">switch</span>&nbsp;<span class="op" id="5055405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055408">case</span>&nbsp;<span class="string" id="5055413">&#39;0&#39;</span>&nbsp;<span class="op" id="5055417">&lt;=</span>&nbsp;<span class="ident" id="5055420">c</span>&nbsp;<span class="op" id="5055422">&amp;&amp;</span>&nbsp;<span class="ident" id="5055425">c</span>&nbsp;<span class="op" id="5055427">&lt;=</span>&nbsp;<span class="string" id="5055430">&#39;9&#39;</span><span class="op" id="5055433">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055437">return</span>&nbsp;<span class="builtintype" id="5055444">true</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055450">case</span>&nbsp;<span class="string" id="5055455">&#39;a&#39;</span>&nbsp;<span class="op" id="5055459">&lt;=</span>&nbsp;<span class="ident" id="5055462">c</span>&nbsp;<span class="op" id="5055464">&amp;&amp;</span>&nbsp;<span class="ident" id="5055467">c</span>&nbsp;<span class="op" id="5055469">&lt;=</span>&nbsp;<span class="string" id="5055472">&#39;f&#39;</span><span class="op" id="5055475">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055479">return</span>&nbsp;<span class="builtintype" id="5055486">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055492">case</span>&nbsp;<span class="string" id="5055497">&#39;A&#39;</span>&nbsp;<span class="op" id="5055501">&lt;=</span>&nbsp;<span class="ident" id="5055504">c</span>&nbsp;<span class="op" id="5055506">&amp;&amp;</span>&nbsp;<span class="ident" id="5055509">c</span>&nbsp;<span class="op" id="5055511">&lt;=</span>&nbsp;<span class="string" id="5055514">&#39;F&#39;</span><span class="op" id="5055517">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055521">return</span>&nbsp;<span class="builtintype" id="5055528">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5055534">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055537">return</span>&nbsp;<span class="builtintype" id="5055544">false</span><br>
<span class="lineno"></span><span class="op" id="5055550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5055553">func</span>&nbsp;<span class="ident" id="5055558">unhex</span><span class="op" id="5055563">(</span><span class="ident" id="5055564">c</span>&nbsp;<span class="builtintype" id="5055566">byte</span><span class="op" id="5055570">)</span>&nbsp;<span class="builtintype" id="5055572">byte</span>&nbsp;<span class="op" id="5055577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055580">switch</span>&nbsp;<span class="op" id="5055587">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055590">case</span>&nbsp;<span class="string" id="5055595">&#39;0&#39;</span>&nbsp;<span class="op" id="5055599">&lt;=</span>&nbsp;<span class="ident" id="5055602">c</span>&nbsp;<span class="op" id="5055604">&amp;&amp;</span>&nbsp;<span class="ident" id="5055607">c</span>&nbsp;<span class="op" id="5055609">&lt;=</span>&nbsp;<span class="string" id="5055612">&#39;9&#39;</span><span class="op" id="5055615">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055619">return</span>&nbsp;<span class="ident" id="5055626">c</span>&nbsp;<span class="op" id="5055628">-</span>&nbsp;<span class="string" id="5055630">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055635">case</span>&nbsp;<span class="string" id="5055640">&#39;a&#39;</span>&nbsp;<span class="op" id="5055644">&lt;=</span>&nbsp;<span class="ident" id="5055647">c</span>&nbsp;<span class="op" id="5055649">&amp;&amp;</span>&nbsp;<span class="ident" id="5055652">c</span>&nbsp;<span class="op" id="5055654">&lt;=</span>&nbsp;<span class="string" id="5055657">&#39;f&#39;</span><span class="op" id="5055660">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055664">return</span>&nbsp;<span class="ident" id="5055671">c</span>&nbsp;<span class="op" id="5055673">-</span>&nbsp;<span class="string" id="5055675">&#39;a&#39;</span>&nbsp;<span class="op" id="5055679">+</span>&nbsp;<span class="num" id="5055681">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055685">case</span>&nbsp;<span class="string" id="5055690">&#39;A&#39;</span>&nbsp;<span class="op" id="5055694">&lt;=</span>&nbsp;<span class="ident" id="5055697">c</span>&nbsp;<span class="op" id="5055699">&amp;&amp;</span>&nbsp;<span class="ident" id="5055702">c</span>&nbsp;<span class="op" id="5055704">&lt;=</span>&nbsp;<span class="string" id="5055707">&#39;F&#39;</span><span class="op" id="5055710">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055714">return</span>&nbsp;<span class="ident" id="5055721">c</span>&nbsp;<span class="op" id="5055723">-</span>&nbsp;<span class="string" id="5055725">&#39;A&#39;</span>&nbsp;<span class="op" id="5055729">+</span>&nbsp;<span class="num" id="5055731">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5055735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055738">return</span>&nbsp;<span class="num" id="5055745">0</span><br>
<span class="lineno"></span><span class="op" id="5055747">}</span>
</div>
</body>
</html>
