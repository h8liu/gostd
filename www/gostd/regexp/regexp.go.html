<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp</h2>
<ul>
<li><a href="/gostd/regexp/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/regexp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/regexp/exec.go.html">exec.go</a></li>
<li><a href="/gostd/regexp/exec2_test.go.html">exec2_test.go</a></li>
<li><a href="/gostd/regexp/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/regexp/find_test.go.html">find_test.go</a></li>
<li><a href="/gostd/regexp/onepass.go.html">onepass.go</a></li>
<li><a href="/gostd/regexp/onepass_test.go.html">onepass_test.go</a></li>
<li><a href="/gostd/regexp/regexp.go.html">regexp.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3358028">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3358083">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3358137">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3358188">//&nbsp;Package&nbsp;regexp&nbsp;implements&nbsp;regular&nbsp;expression&nbsp;search.</span><br>
<span class="lineno"></span><span class="comment" id="3358244">//</span><br>
<span class="lineno"></span><span class="comment" id="3358247">//&nbsp;The&nbsp;syntax&nbsp;of&nbsp;the&nbsp;regular&nbsp;expressions&nbsp;accepted&nbsp;is&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3358309">//&nbsp;general&nbsp;syntax&nbsp;used&nbsp;by&nbsp;Perl,&nbsp;Python,&nbsp;and&nbsp;other&nbsp;languages.</span><br>
<span class="lineno"></span><span class="comment" id="3358370">//&nbsp;More&nbsp;precisely,&nbsp;it&nbsp;is&nbsp;the&nbsp;syntax&nbsp;accepted&nbsp;by&nbsp;RE2&nbsp;and&nbsp;described&nbsp;at</span><br>
<span class="lineno">10</span><span class="comment" id="3358439">//&nbsp;http://code.google.com/p/re2/wiki/Syntax,&nbsp;except&nbsp;for&nbsp;\C.</span><br>
<span class="lineno"></span><span class="comment" id="3358499">//&nbsp;For&nbsp;an&nbsp;overview&nbsp;of&nbsp;the&nbsp;syntax,&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="3358537">//&nbsp;&nbsp;&nbsp;godoc&nbsp;regexp/syntax</span><br>
<span class="lineno"></span><span class="comment" id="3358562">//</span><br>
<span class="lineno"></span><span class="comment" id="3358565">//&nbsp;The&nbsp;regexp&nbsp;implementation&nbsp;provided&nbsp;by&nbsp;this&nbsp;package&nbsp;is</span><br>
<span class="lineno">15</span><span class="comment" id="3358622">//&nbsp;guaranteed&nbsp;to&nbsp;run&nbsp;in&nbsp;time&nbsp;linear&nbsp;in&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="3358684">//&nbsp;(This&nbsp;is&nbsp;a&nbsp;property&nbsp;not&nbsp;guaranteed&nbsp;by&nbsp;most&nbsp;open&nbsp;source</span><br>
<span class="lineno"></span><span class="comment" id="3358742">//&nbsp;implementations&nbsp;of&nbsp;regular&nbsp;expressions.)&nbsp;For&nbsp;more&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="3358807">//&nbsp;about&nbsp;this&nbsp;property,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="3358835">//&nbsp;&nbsp;&nbsp;&nbsphttp://swtch.com/~rsc/regexp/regexp1.html</span><br>
<span class="lineno">20</span><span class="comment" id="3358880">//&nbsp;or&nbsp;any&nbsp;book&nbsp;about&nbsp;automata&nbsp;theory.</span><br>
<span class="lineno"></span><span class="comment" id="3358918">//</span><br>
<span class="lineno"></span><span class="comment" id="3358921">//&nbsp;All&nbsp;characters&nbsp;are&nbsp;UTF-8-encoded&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="3358970">//</span><br>
<span class="lineno"></span><span class="comment" id="3358973">//&nbsp;There&nbsp;are&nbsp;16&nbsp;methods&nbsp;of&nbsp;Regexp&nbsp;that&nbsp;match&nbsp;a&nbsp;regular&nbsp;expression&nbsp;and&nbsp;identify</span><br>
<span class="lineno">25</span><span class="comment" id="3359052">//&nbsp;the&nbsp;matched&nbsp;text.&nbsp;&nbsp;Their&nbsp;names&nbsp;are&nbsp;matched&nbsp;by&nbsp;this&nbsp;regular&nbsp;expression:</span><br>
<span class="lineno"></span><span class="comment" id="3359126">//</span><br>
<span class="lineno"></span><span class="comment" id="3359129">//&nbsp;&nbsp;&nbsp;&nbspFind(All)?(String)?(Submatch)?(Index)?</span><br>
<span class="lineno"></span><span class="comment" id="3359171">//</span><br>
<span class="lineno"></span><span class="comment" id="3359174">//&nbsp;If&nbsp;&#39;All&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;routine&nbsp;matches&nbsp;successive&nbsp;non-overlapping</span><br>
<span class="lineno">30</span><span class="comment" id="3359245">//&nbsp;matches&nbsp;of&nbsp;the&nbsp;entire&nbsp;expression.&nbsp;&nbsp;Empty&nbsp;matches&nbsp;abutting&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="3359318">//&nbsp;match&nbsp;are&nbsp;ignored.&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;successive</span><br>
<span class="lineno"></span><span class="comment" id="3359395">//&nbsp;return&nbsp;values&nbsp;of&nbsp;the&nbsp;corresponding&nbsp;non-&#39;All&#39;&nbsp;routine.&nbsp;&nbsp;These&nbsp;routines&nbsp;take</span><br>
<span class="lineno"></span><span class="comment" id="3359473">//&nbsp;an&nbsp;extra&nbsp;integer&nbsp;argument,&nbsp;n;&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0,&nbsp;the&nbsp;function&nbsp;returns&nbsp;at&nbsp;most&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="3359548">//&nbsp;matches/submatches.</span><br>
<span class="lineno">35</span><span class="comment" id="3359571">//</span><br>
<span class="lineno"></span><span class="comment" id="3359574">//&nbsp;If&nbsp;&#39;String&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;argument&nbsp;is&nbsp;a&nbsp;string;&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="3359651">//&nbsp;of&nbsp;bytes;&nbsp;return&nbsp;values&nbsp;are&nbsp;adjusted&nbsp;as&nbsp;appropriate.</span><br>
<span class="lineno"></span><span class="comment" id="3359707">//</span><br>
<span class="lineno"></span><span class="comment" id="3359710">//&nbsp;If&nbsp;&#39;Submatch&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;return&nbsp;value&nbsp;is&nbsp;a&nbsp;slice&nbsp;identifying&nbsp;the</span><br>
<span class="lineno">40</span><span class="comment" id="3359783">//&nbsp;successive&nbsp;submatches&nbsp;of&nbsp;the&nbsp;expression.&nbsp;Submatches&nbsp;are&nbsp;matches&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3359853">//&nbsp;parenthesized&nbsp;subexpressions&nbsp;(also&nbsp;known&nbsp;as&nbsp;capturing&nbsp;groups)&nbsp;within&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3359929">//&nbsp;regular&nbsp;expression,&nbsp;numbered&nbsp;from&nbsp;left&nbsp;to&nbsp;right&nbsp;in&nbsp;order&nbsp;of&nbsp;opening</span><br>
<span class="lineno"></span><span class="comment" id="3360000">//&nbsp;parenthesis.&nbsp;Submatch&nbsp;0&nbsp;is&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;entire&nbsp;expression,&nbsp;submatch&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3360077">//&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;first&nbsp;parenthesized&nbsp;subexpression,&nbsp;and&nbsp;so&nbsp;on.</span><br>
<span class="lineno">45</span><span class="comment" id="3360143">//</span><br>
<span class="lineno"></span><span class="comment" id="3360146">//&nbsp;If&nbsp;&#39;Index&#39;&nbsp;is&nbsp;present,&nbsp;matches&nbsp;and&nbsp;submatches&nbsp;are&nbsp;identified&nbsp;by&nbsp;byte&nbsp;index</span><br>
<span class="lineno"></span><span class="comment" id="3360224">//&nbsp;pairs&nbsp;within&nbsp;the&nbsp;input&nbsp;string:&nbsp;result[2*n:2*n+1]&nbsp;identifies&nbsp;the&nbsp;indexes&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3360302">//&nbsp;the&nbsp;nth&nbsp;submatch.&nbsp;&nbsp;The&nbsp;pair&nbsp;for&nbsp;n==0&nbsp;identifies&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;entire</span><br>
<span class="lineno"></span><span class="comment" id="3360377">//&nbsp;expression.&nbsp;&nbsp;If&nbsp;&#39;Index&#39;&nbsp;is&nbsp;not&nbsp;present,&nbsp;the&nbsp;match&nbsp;is&nbsp;identified&nbsp;by&nbsp;the</span><br>
<span class="lineno">50</span><span class="comment" id="3360451">//&nbsp;text&nbsp;of&nbsp;the&nbsp;match/submatch.&nbsp;&nbsp;If&nbsp;an&nbsp;index&nbsp;is&nbsp;negative,&nbsp;it&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3360522">//&nbsp;subexpression&nbsp;did&nbsp;not&nbsp;match&nbsp;any&nbsp;string&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="3360578">//</span><br>
<span class="lineno"></span><span class="comment" id="3360581">//&nbsp;There&nbsp;is&nbsp;also&nbsp;a&nbsp;subset&nbsp;of&nbsp;the&nbsp;methods&nbsp;that&nbsp;can&nbsp;be&nbsp;applied&nbsp;to&nbsp;text&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3360655">//&nbsp;from&nbsp;a&nbsp;RuneReader:</span><br>
<span class="lineno">55</span><span class="comment" id="3360677">//</span><br>
<span class="lineno"></span><span class="comment" id="3360680">//&nbsp;&nbsp;&nbsp;&nbspMatchReader,&nbsp;FindReaderIndex,&nbsp;FindReaderSubmatchIndex</span><br>
<span class="lineno"></span><span class="comment" id="3360737">//</span><br>
<span class="lineno"></span><span class="comment" id="3360740">//&nbsp;This&nbsp;set&nbsp;may&nbsp;grow.&nbsp;&nbsp;Note&nbsp;that&nbsp;regular&nbsp;expression&nbsp;matches&nbsp;may&nbsp;need&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3360812">//&nbsp;examine&nbsp;text&nbsp;beyond&nbsp;the&nbsp;text&nbsp;returned&nbsp;by&nbsp;a&nbsp;match,&nbsp;so&nbsp;the&nbsp;methods&nbsp;that</span><br>
<span class="lineno">60</span><span class="comment" id="3360885">//&nbsp;match&nbsp;text&nbsp;from&nbsp;a&nbsp;RuneReader&nbsp;may&nbsp;read&nbsp;arbitrarily&nbsp;far&nbsp;into&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span><span class="comment" id="3360957">//&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="comment" id="3360978">//</span><br>
<span class="lineno"></span><span class="comment" id="3360981">//&nbsp;(There&nbsp;are&nbsp;a&nbsp;few&nbsp;other&nbsp;methods&nbsp;that&nbsp;do&nbsp;not&nbsp;match&nbsp;this&nbsp;pattern.)</span><br>
<span class="lineno"></span><span class="comment" id="3361048">//</span><br>
<span class="lineno">65</span><span class="keyword" id="3361051">package</span>&nbsp;<span class="ident" id="3361059">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3361067">import</span>&nbsp;<span class="op" id="3361074">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3361077">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3361086">&#34;io&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3361092">&#34;regexp/syntax&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3361109">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3361120">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3361131">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3361139">&#34;unicode&#34;</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3361150">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3361165">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3361168">var</span>&nbsp;<span class="ident" id="3361172">debug</span>&nbsp;<span class="op" id="3361178">=</span>&nbsp;<span class="builtintype" id="3361180">false</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="3361187">//&nbsp;Regexp&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;compiled&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="comment" id="3361253">//&nbsp;A&nbsp;Regexp&nbsp;is&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="3361316">type</span>&nbsp;<span class="ident" id="3361321">Regexp</span>&nbsp;<span class="keyword" id="3361328">struct</span>&nbsp;<span class="op" id="3361335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3361338">//&nbsp;read-only&nbsp;after&nbsp;Compile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361366">expr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3361381">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3361396">//&nbsp;as&nbsp;passed&nbsp;to&nbsp;Compile</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361421">prog</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3361436">*</span><span class="ident" id="3361437">syntax</span><span class="op" id="3361443">.</span><span class="ident" id="3361444">Prog</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3361451">//&nbsp;compiled&nbsp;program</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361472">onepass</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3361487">*</span><span class="ident" id="3361488">onePassProg</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3361502">//&nbsp;onpass&nbsp;program&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361528">prefix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3361543">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3361558">//&nbsp;required&nbsp;prefix&nbsp;in&nbsp;unanchored&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361600">prefixBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3361615">[</span><span class="op" id="3361616">]</span><span class="builtintype" id="3361617">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3361630">//&nbsp;prefix,&nbsp;as&nbsp;a&nbsp;[]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361654">prefixComplete</span>&nbsp;<span class="builtintype" id="3361669">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3361684">//&nbsp;prefix&nbsp;is&nbsp;the&nbsp;entire&nbsp;regexp</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361716">prefixRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3361731">rune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3361746">//&nbsp;first&nbsp;rune&nbsp;in&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361771">prefixEnd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3361786">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3361801">//&nbsp;pc&nbsp;for&nbsp;last&nbsp;rune&nbsp;in&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361832">cond</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3361847">syntax</span><span class="op" id="3361853">.</span><span class="ident" id="3361854">EmptyOp</span>&nbsp;<span class="comment" id="3361862">//&nbsp;empty-width&nbsp;conditions&nbsp;required&nbsp;at&nbsp;start&nbsp;of&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361916">numSubexp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3361931">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361936">subexpNames</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3361951">[</span><span class="op" id="3361952">]</span><span class="builtintype" id="3361953">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361961">longest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3361976">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3361983">//&nbsp;cache&nbsp;of&nbsp;machines&nbsp;for&nbsp;running&nbsp;regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362024">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3362032">sync</span><span class="op" id="3362036">.</span><span class="ident" id="3362037">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362044">machine</span>&nbsp;<span class="op" id="3362052">[</span><span class="op" id="3362053">]</span><span class="op" id="3362054">*</span><span class="ident" id="3362055">machine</span><br>
<span class="lineno">100</span><span class="op" id="3362063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3362066">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;source&nbsp;text&nbsp;used&nbsp;to&nbsp;compile&nbsp;the&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="3362140">func</span>&nbsp;<span class="op" id="3362145">(</span><span class="ident" id="3362146">re</span>&nbsp;<span class="op" id="3362149">*</span><span class="ident" id="3362150">Regexp</span><span class="op" id="3362156">)</span>&nbsp;<span class="ident" id="3362158">String</span><span class="op" id="3362164">(</span><span class="op" id="3362165">)</span>&nbsp;<span class="builtintype" id="3362167">string</span>&nbsp;<span class="op" id="3362174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362177">return</span>&nbsp;<span class="ident" id="3362184">re</span><span class="op" id="3362186">.</span><span class="ident" id="3362187">expr</span><br>
<span class="lineno">105</span><span class="op" id="3362192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3362195">//&nbsp;Compile&nbsp;parses&nbsp;a&nbsp;regular&nbsp;expression&nbsp;and&nbsp;returns,&nbsp;if&nbsp;successful,</span><br>
<span class="lineno"></span><span class="comment" id="3362262">//&nbsp;a&nbsp;Regexp&nbsp;object&nbsp;that&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;match&nbsp;against&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="3362321">//</span><br>
<span class="lineno">110</span><span class="comment" id="3362324">//&nbsp;When&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3362387">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="3362459">//&nbsp;it&nbsp;chooses&nbsp;the&nbsp;one&nbsp;that&nbsp;a&nbsp;backtracking&nbsp;search&nbsp;would&nbsp;have&nbsp;found&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="3362532">//&nbsp;This&nbsp;so-called&nbsp;leftmost-first&nbsp;matching&nbsp;is&nbsp;the&nbsp;same&nbsp;semantics</span><br>
<span class="lineno"></span><span class="comment" id="3362596">//&nbsp;that&nbsp;Perl,&nbsp;Python,&nbsp;and&nbsp;other&nbsp;implementations&nbsp;use,&nbsp;although&nbsp;this</span><br>
<span class="lineno">115</span><span class="comment" id="3362663">//&nbsp;package&nbsp;implements&nbsp;it&nbsp;without&nbsp;the&nbsp;expense&nbsp;of&nbsp;backtracking.</span><br>
<span class="lineno"></span><span class="comment" id="3362725">//&nbsp;For&nbsp;POSIX&nbsp;leftmost-longest&nbsp;matching,&nbsp;see&nbsp;CompilePOSIX.</span><br>
<span class="lineno"></span><span class="keyword" id="3362783">func</span>&nbsp;<span class="ident" id="3362788">Compile</span><span class="op" id="3362795">(</span><span class="ident" id="3362796">expr</span>&nbsp;<span class="builtintype" id="3362801">string</span><span class="op" id="3362807">)</span>&nbsp;<span class="op" id="3362809">(</span><span class="op" id="3362810">*</span><span class="ident" id="3362811">Regexp</span><span class="op" id="3362817">,</span>&nbsp;<span class="builtintype" id="3362819">error</span><span class="op" id="3362824">)</span>&nbsp;<span class="op" id="3362826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362829">return</span>&nbsp;<span class="ident" id="3362836">compile</span><span class="op" id="3362843">(</span><span class="ident" id="3362844">expr</span><span class="op" id="3362848">,</span>&nbsp;<span class="ident" id="3362850">syntax</span><span class="op" id="3362856">.</span><span class="ident" id="3362857">Perl</span><span class="op" id="3362861">,</span>&nbsp;<span class="builtintype" id="3362863">false</span><span class="op" id="3362868">)</span><br>
<span class="lineno"></span><span class="op" id="3362870">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="3362873">//&nbsp;CompilePOSIX&nbsp;is&nbsp;like&nbsp;Compile&nbsp;but&nbsp;restricts&nbsp;the&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="3362942">//&nbsp;to&nbsp;POSIX&nbsp;ERE&nbsp;(egrep)&nbsp;syntax&nbsp;and&nbsp;changes&nbsp;the&nbsp;match&nbsp;semantics&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3363008">//&nbsp;leftmost-longest.</span><br>
<span class="lineno"></span><span class="comment" id="3363029">//</span><br>
<span class="lineno">125</span><span class="comment" id="3363032">//&nbsp;That&nbsp;is,&nbsp;when&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3363104">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="3363176">//&nbsp;it&nbsp;chooses&nbsp;a&nbsp;match&nbsp;that&nbsp;is&nbsp;as&nbsp;long&nbsp;as&nbsp;possible.</span><br>
<span class="lineno"></span><span class="comment" id="3363227">//&nbsp;This&nbsp;so-called&nbsp;leftmost-longest&nbsp;matching&nbsp;is&nbsp;the&nbsp;same&nbsp;semantics</span><br>
<span class="lineno"></span><span class="comment" id="3363293">//&nbsp;that&nbsp;early&nbsp;regular&nbsp;expression&nbsp;implementations&nbsp;used&nbsp;and&nbsp;that&nbsp;POSIX</span><br>
<span class="lineno">130</span><span class="comment" id="3363362">//&nbsp;specifies.</span><br>
<span class="lineno"></span><span class="comment" id="3363376">//</span><br>
<span class="lineno"></span><span class="comment" id="3363379">//&nbsp;However,&nbsp;there&nbsp;can&nbsp;be&nbsp;multiple&nbsp;leftmost-longest&nbsp;matches,&nbsp;with&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="3363454">//&nbsp;submatch&nbsp;choices,&nbsp;and&nbsp;here&nbsp;this&nbsp;package&nbsp;diverges&nbsp;from&nbsp;POSIX.</span><br>
<span class="lineno"></span><span class="comment" id="3363518">//&nbsp;Among&nbsp;the&nbsp;possible&nbsp;leftmost-longest&nbsp;matches,&nbsp;this&nbsp;package&nbsp;chooses</span><br>
<span class="lineno">135</span><span class="comment" id="3363587">//&nbsp;the&nbsp;one&nbsp;that&nbsp;a&nbsp;backtracking&nbsp;search&nbsp;would&nbsp;have&nbsp;found&nbsp;first,&nbsp;while&nbsp;POSIX</span><br>
<span class="lineno"></span><span class="comment" id="3363661">//&nbsp;specifies&nbsp;that&nbsp;the&nbsp;match&nbsp;be&nbsp;chosen&nbsp;to&nbsp;maximize&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="3363735">//&nbsp;subexpression,&nbsp;then&nbsp;the&nbsp;second,&nbsp;and&nbsp;so&nbsp;on&nbsp;from&nbsp;left&nbsp;to&nbsp;right.</span><br>
<span class="lineno"></span><span class="comment" id="3363800">//&nbsp;The&nbsp;POSIX&nbsp;rule&nbsp;is&nbsp;computationally&nbsp;prohibitive&nbsp;and&nbsp;not&nbsp;even&nbsp;well-defined.</span><br>
<span class="lineno"></span><span class="comment" id="3363876">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp2.html#posix&nbsp;for&nbsp;details.</span><br>
<span class="lineno">140</span><span class="keyword" id="3363944">func</span>&nbsp;<span class="ident" id="3363949">CompilePOSIX</span><span class="op" id="3363961">(</span><span class="ident" id="3363962">expr</span>&nbsp;<span class="builtintype" id="3363967">string</span><span class="op" id="3363973">)</span>&nbsp;<span class="op" id="3363975">(</span><span class="op" id="3363976">*</span><span class="ident" id="3363977">Regexp</span><span class="op" id="3363983">,</span>&nbsp;<span class="builtintype" id="3363985">error</span><span class="op" id="3363990">)</span>&nbsp;<span class="op" id="3363992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363995">return</span>&nbsp;<span class="ident" id="3364002">compile</span><span class="op" id="3364009">(</span><span class="ident" id="3364010">expr</span><span class="op" id="3364014">,</span>&nbsp;<span class="ident" id="3364016">syntax</span><span class="op" id="3364022">.</span><span class="ident" id="3364023">POSIX</span><span class="op" id="3364028">,</span>&nbsp;<span class="builtintype" id="3364030">true</span><span class="op" id="3364034">)</span><br>
<span class="lineno"></span><span class="op" id="3364036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3364039">//&nbsp;Longest&nbsp;makes&nbsp;future&nbsp;searches&nbsp;prefer&nbsp;the&nbsp;leftmost-longest&nbsp;match.</span><br>
<span class="lineno">145</span><span class="comment" id="3364107">//&nbsp;That&nbsp;is,&nbsp;when&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3364179">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="3364251">//&nbsp;it&nbsp;chooses&nbsp;a&nbsp;match&nbsp;that&nbsp;is&nbsp;as&nbsp;long&nbsp;as&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="3364302">func</span>&nbsp;<span class="op" id="3364307">(</span><span class="ident" id="3364308">re</span>&nbsp;<span class="op" id="3364311">*</span><span class="ident" id="3364312">Regexp</span><span class="op" id="3364318">)</span>&nbsp;<span class="ident" id="3364320">Longest</span><span class="op" id="3364327">(</span><span class="op" id="3364328">)</span>&nbsp;<span class="op" id="3364330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364333">re</span><span class="op" id="3364335">.</span><span class="ident" id="3364336">longest</span>&nbsp;<span class="op" id="3364344">=</span>&nbsp;<span class="builtintype" id="3364346">true</span><br>
<span class="lineno">150</span><span class="op" id="3364351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3364354">func</span>&nbsp;<span class="ident" id="3364359">compile</span><span class="op" id="3364366">(</span><span class="ident" id="3364367">expr</span>&nbsp;<span class="builtintype" id="3364372">string</span><span class="op" id="3364378">,</span>&nbsp;<span class="ident" id="3364380">mode</span>&nbsp;<span class="ident" id="3364385">syntax</span><span class="op" id="3364391">.</span><span class="ident" id="3364392">Flags</span><span class="op" id="3364397">,</span>&nbsp;<span class="ident" id="3364399">longest</span>&nbsp;<span class="builtintype" id="3364407">bool</span><span class="op" id="3364411">)</span>&nbsp;<span class="op" id="3364413">(</span><span class="op" id="3364414">*</span><span class="ident" id="3364415">Regexp</span><span class="op" id="3364421">,</span>&nbsp;<span class="builtintype" id="3364423">error</span><span class="op" id="3364428">)</span>&nbsp;<span class="op" id="3364430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364433">re</span><span class="op" id="3364435">,</span>&nbsp;<span class="ident" id="3364437">err</span>&nbsp;<span class="op" id="3364441">:=</span>&nbsp;<span class="ident" id="3364444">syntax</span><span class="op" id="3364450">.</span><span class="ident" id="3364451">Parse</span><span class="op" id="3364456">(</span><span class="ident" id="3364457">expr</span><span class="op" id="3364461">,</span>&nbsp;<span class="ident" id="3364463">mode</span><span class="op" id="3364467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364470">if</span>&nbsp;<span class="ident" id="3364473">err</span>&nbsp;<span class="op" id="3364477">!=</span>&nbsp;<span class="ident" id="3364480">nil</span>&nbsp;<span class="op" id="3364484">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364488">return</span>&nbsp;<span class="ident" id="3364495">nil</span><span class="op" id="3364498">,</span>&nbsp;<span class="ident" id="3364500">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364508">maxCap</span>&nbsp;<span class="op" id="3364515">:=</span>&nbsp;<span class="ident" id="3364518">re</span><span class="op" id="3364520">.</span><span class="ident" id="3364521">MaxCap</span><span class="op" id="3364527">(</span><span class="op" id="3364528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364531">capNames</span>&nbsp;<span class="op" id="3364540">:=</span>&nbsp;<span class="ident" id="3364543">re</span><span class="op" id="3364545">.</span><span class="ident" id="3364546">CapNames</span><span class="op" id="3364554">(</span><span class="op" id="3364555">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364559">re</span>&nbsp;<span class="op" id="3364562">=</span>&nbsp;<span class="ident" id="3364564">re</span><span class="op" id="3364566">.</span><span class="ident" id="3364567">Simplify</span><span class="op" id="3364575">(</span><span class="op" id="3364576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364579">prog</span><span class="op" id="3364583">,</span>&nbsp;<span class="ident" id="3364585">err</span>&nbsp;<span class="op" id="3364589">:=</span>&nbsp;<span class="ident" id="3364592">syntax</span><span class="op" id="3364598">.</span><span class="ident" id="3364599">Compile</span><span class="op" id="3364606">(</span><span class="ident" id="3364607">re</span><span class="op" id="3364609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364612">if</span>&nbsp;<span class="ident" id="3364615">err</span>&nbsp;<span class="op" id="3364619">!=</span>&nbsp;<span class="ident" id="3364622">nil</span>&nbsp;<span class="op" id="3364626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364630">return</span>&nbsp;<span class="ident" id="3364637">nil</span><span class="op" id="3364640">,</span>&nbsp;<span class="ident" id="3364642">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364647">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364650">regexp</span>&nbsp;<span class="op" id="3364657">:=</span>&nbsp;<span class="op" id="3364660">&amp;</span><span class="ident" id="3364661">Regexp</span><span class="op" id="3364667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364671">expr</span><span class="op" id="3364675">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3364684">expr</span><span class="op" id="3364688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364692">prog</span><span class="op" id="3364696">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3364705">prog</span><span class="op" id="3364709">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364713">onepass</span><span class="op" id="3364720">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3364726">compileOnePass</span><span class="op" id="3364740">(</span><span class="ident" id="3364741">prog</span><span class="op" id="3364745">)</span><span class="op" id="3364746">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364750">numSubexp</span><span class="op" id="3364759">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3364763">maxCap</span><span class="op" id="3364769">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364773">subexpNames</span><span class="op" id="3364784">:</span>&nbsp;<span class="ident" id="3364786">capNames</span><span class="op" id="3364794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364798">cond</span><span class="op" id="3364802">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3364811">prog</span><span class="op" id="3364815">.</span><span class="ident" id="3364816">StartCond</span><span class="op" id="3364825">(</span><span class="op" id="3364826">)</span><span class="op" id="3364827">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364831">longest</span><span class="op" id="3364838">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3364844">longest</span><span class="op" id="3364851">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364857">if</span>&nbsp;<span class="ident" id="3364860">regexp</span><span class="op" id="3364866">.</span><span class="ident" id="3364867">onepass</span>&nbsp;<span class="op" id="3364875">==</span>&nbsp;<span class="ident" id="3364878">notOnePass</span>&nbsp;<span class="op" id="3364889">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364893">regexp</span><span class="op" id="3364899">.</span><span class="ident" id="3364900">prefix</span><span class="op" id="3364906">,</span>&nbsp;<span class="ident" id="3364908">regexp</span><span class="op" id="3364914">.</span><span class="ident" id="3364915">prefixComplete</span>&nbsp;<span class="op" id="3364930">=</span>&nbsp;<span class="ident" id="3364932">prog</span><span class="op" id="3364936">.</span><span class="ident" id="3364937">Prefix</span><span class="op" id="3364943">(</span><span class="op" id="3364944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364947">}</span>&nbsp;<span class="keyword" id="3364949">else</span>&nbsp;<span class="op" id="3364954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364958">regexp</span><span class="op" id="3364964">.</span><span class="ident" id="3364965">prefix</span><span class="op" id="3364971">,</span>&nbsp;<span class="ident" id="3364973">regexp</span><span class="op" id="3364979">.</span><span class="ident" id="3364980">prefixComplete</span><span class="op" id="3364994">,</span>&nbsp;<span class="ident" id="3364996">regexp</span><span class="op" id="3365002">.</span><span class="ident" id="3365003">prefixEnd</span>&nbsp;<span class="op" id="3365013">=</span>&nbsp;<span class="ident" id="3365015">onePassPrefix</span><span class="op" id="3365028">(</span><span class="ident" id="3365029">prog</span><span class="op" id="3365033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3365036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365039">if</span>&nbsp;<span class="ident" id="3365042">regexp</span><span class="op" id="3365048">.</span><span class="ident" id="3365049">prefix</span>&nbsp;<span class="op" id="3365056">!=</span>&nbsp;<span class="string" id="3365059">&#34;&#34;</span>&nbsp;<span class="op" id="3365062">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3365066">//&nbsp;TODO(rsc):&nbsp;Remove&nbsp;this&nbsp;allocation&nbsp;by&nbsp;adding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3365115">//&nbsp;IndexString&nbsp;to&nbsp;package&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365150">regexp</span><span class="op" id="3365156">.</span><span class="ident" id="3365157">prefixBytes</span>&nbsp;<span class="op" id="3365169">=</span>&nbsp;<span class="op" id="3365171">[</span><span class="op" id="3365172">]</span><span class="builtintype" id="3365173">byte</span><span class="op" id="3365177">(</span><span class="ident" id="3365178">regexp</span><span class="op" id="3365184">.</span><span class="ident" id="3365185">prefix</span><span class="op" id="3365191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365195">regexp</span><span class="op" id="3365201">.</span><span class="ident" id="3365202">prefixRune</span><span class="op" id="3365212">,</span>&nbsp;<span class="ident" id="3365214">_</span>&nbsp;<span class="op" id="3365216">=</span>&nbsp;<span class="ident" id="3365218">utf8</span><span class="op" id="3365222">.</span><span class="ident" id="3365223">DecodeRuneInString</span><span class="op" id="3365241">(</span><span class="ident" id="3365242">regexp</span><span class="op" id="3365248">.</span><span class="ident" id="3365249">prefix</span><span class="op" id="3365255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3365258">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365261">return</span>&nbsp;<span class="ident" id="3365268">regexp</span><span class="op" id="3365274">,</span>&nbsp;<span class="ident" id="3365276">nil</span><br>
<span class="lineno"></span><span class="op" id="3365280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3365283">//&nbsp;get&nbsp;returns&nbsp;a&nbsp;machine&nbsp;to&nbsp;use&nbsp;for&nbsp;matching&nbsp;re.</span><br>
<span class="lineno"></span><span class="comment" id="3365332">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;re&#39;s&nbsp;machine&nbsp;cache&nbsp;if&nbsp;possible,&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">190</span><span class="comment" id="3365388">//&nbsp;unnecessary&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="3365415">func</span>&nbsp;<span class="op" id="3365420">(</span><span class="ident" id="3365421">re</span>&nbsp;<span class="op" id="3365424">*</span><span class="ident" id="3365425">Regexp</span><span class="op" id="3365431">)</span>&nbsp;<span class="ident" id="3365433">get</span><span class="op" id="3365436">(</span><span class="op" id="3365437">)</span>&nbsp;<span class="op" id="3365439">*</span><span class="ident" id="3365440">machine</span>&nbsp;<span class="op" id="3365448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365451">re</span><span class="op" id="3365453">.</span><span class="ident" id="3365454">mu</span><span class="op" id="3365456">.</span><span class="ident" id="3365457">Lock</span><span class="op" id="3365461">(</span><span class="op" id="3365462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365465">if</span>&nbsp;<span class="ident" id="3365468">n</span>&nbsp;<span class="op" id="3365470">:=</span>&nbsp;<span class="builtinfunc" id="3365473">len</span><span class="op" id="3365476">(</span><span class="ident" id="3365477">re</span><span class="op" id="3365479">.</span><span class="ident" id="3365480">machine</span><span class="op" id="3365487">)</span><span class="op" id="3365488">;</span>&nbsp;<span class="ident" id="3365490">n</span>&nbsp;<span class="op" id="3365492">&gt;</span>&nbsp;<span class="num" id="3365494">0</span>&nbsp;<span class="op" id="3365496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365500">z</span>&nbsp;<span class="op" id="3365502">:=</span>&nbsp;<span class="ident" id="3365505">re</span><span class="op" id="3365507">.</span><span class="ident" id="3365508">machine</span><span class="op" id="3365515">[</span><span class="ident" id="3365516">n</span><span class="op" id="3365517">-</span><span class="num" id="3365518">1</span><span class="op" id="3365519">]</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365523">re</span><span class="op" id="3365525">.</span><span class="ident" id="3365526">machine</span>&nbsp;<span class="op" id="3365534">=</span>&nbsp;<span class="ident" id="3365536">re</span><span class="op" id="3365538">.</span><span class="ident" id="3365539">machine</span><span class="op" id="3365546">[</span><span class="op" id="3365547">:</span><span class="ident" id="3365548">n</span><span class="op" id="3365549">-</span><span class="num" id="3365550">1</span><span class="op" id="3365551">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365555">re</span><span class="op" id="3365557">.</span><span class="ident" id="3365558">mu</span><span class="op" id="3365560">.</span><span class="ident" id="3365561">Unlock</span><span class="op" id="3365567">(</span><span class="op" id="3365568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365572">return</span>&nbsp;<span class="ident" id="3365579">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3365582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365585">re</span><span class="op" id="3365587">.</span><span class="ident" id="3365588">mu</span><span class="op" id="3365590">.</span><span class="ident" id="3365591">Unlock</span><span class="op" id="3365597">(</span><span class="op" id="3365598">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365601">z</span>&nbsp;<span class="op" id="3365603">:=</span>&nbsp;<span class="ident" id="3365606">progMachine</span><span class="op" id="3365617">(</span><span class="ident" id="3365618">re</span><span class="op" id="3365620">.</span><span class="ident" id="3365621">prog</span><span class="op" id="3365625">,</span>&nbsp;<span class="ident" id="3365627">re</span><span class="op" id="3365629">.</span><span class="ident" id="3365630">onepass</span><span class="op" id="3365637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365640">z</span><span class="op" id="3365641">.</span><span class="ident" id="3365642">re</span>&nbsp;<span class="op" id="3365645">=</span>&nbsp;<span class="ident" id="3365647">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365651">return</span>&nbsp;<span class="ident" id="3365658">z</span><br>
<span class="lineno"></span><span class="op" id="3365660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="3365663">//&nbsp;put&nbsp;returns&nbsp;a&nbsp;machine&nbsp;to&nbsp;the&nbsp;re&#39;s&nbsp;machine&nbsp;cache.</span><br>
<span class="lineno"></span><span class="comment" id="3365715">//&nbsp;There&nbsp;is&nbsp;no&nbsp;attempt&nbsp;to&nbsp;limit&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;cache,&nbsp;so&nbsp;it&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="3365781">//&nbsp;grow&nbsp;to&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;simultaneous&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="3365835">//&nbsp;run&nbsp;using&nbsp;re.&nbsp;&nbsp;(The&nbsp;cache&nbsp;empties&nbsp;when&nbsp;re&nbsp;gets&nbsp;garbage&nbsp;collected.)</span><br>
<span class="lineno"></span><span class="keyword" id="3365905">func</span>&nbsp;<span class="op" id="3365910">(</span><span class="ident" id="3365911">re</span>&nbsp;<span class="op" id="3365914">*</span><span class="ident" id="3365915">Regexp</span><span class="op" id="3365921">)</span>&nbsp;<span class="ident" id="3365923">put</span><span class="op" id="3365926">(</span><span class="ident" id="3365927">z</span>&nbsp;<span class="op" id="3365929">*</span><span class="ident" id="3365930">machine</span><span class="op" id="3365937">)</span>&nbsp;<span class="op" id="3365939">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365942">re</span><span class="op" id="3365944">.</span><span class="ident" id="3365945">mu</span><span class="op" id="3365947">.</span><span class="ident" id="3365948">Lock</span><span class="op" id="3365952">(</span><span class="op" id="3365953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365956">re</span><span class="op" id="3365958">.</span><span class="ident" id="3365959">machine</span>&nbsp;<span class="op" id="3365967">=</span>&nbsp;<span class="builtinfunc" id="3365969">append</span><span class="op" id="3365975">(</span><span class="ident" id="3365976">re</span><span class="op" id="3365978">.</span><span class="ident" id="3365979">machine</span><span class="op" id="3365986">,</span>&nbsp;<span class="ident" id="3365988">z</span><span class="op" id="3365989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365992">re</span><span class="op" id="3365994">.</span><span class="ident" id="3365995">mu</span><span class="op" id="3365997">.</span><span class="ident" id="3365998">Unlock</span><span class="op" id="3366004">(</span><span class="op" id="3366005">)</span><br>
<span class="lineno"></span><span class="op" id="3366007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="3366010">//&nbsp;MustCompile&nbsp;is&nbsp;like&nbsp;Compile&nbsp;but&nbsp;panics&nbsp;if&nbsp;the&nbsp;expression&nbsp;cannot&nbsp;be&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="3366088">//&nbsp;It&nbsp;simplifies&nbsp;safe&nbsp;initialization&nbsp;of&nbsp;global&nbsp;variables&nbsp;holding&nbsp;compiled&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="3366170">//&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="keyword" id="3366186">func</span>&nbsp;<span class="ident" id="3366191">MustCompile</span><span class="op" id="3366202">(</span><span class="ident" id="3366203">str</span>&nbsp;<span class="builtintype" id="3366207">string</span><span class="op" id="3366213">)</span>&nbsp;<span class="op" id="3366215">*</span><span class="ident" id="3366216">Regexp</span>&nbsp;<span class="op" id="3366223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366226">regexp</span><span class="op" id="3366232">,</span>&nbsp;<span class="builtintype" id="3366234">error</span>&nbsp;<span class="op" id="3366240">:=</span>&nbsp;<span class="ident" id="3366243">Compile</span><span class="op" id="3366250">(</span><span class="ident" id="3366251">str</span><span class="op" id="3366254">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366257">if</span>&nbsp;<span class="builtintype" id="3366260">error</span>&nbsp;<span class="op" id="3366266">!=</span>&nbsp;<span class="ident" id="3366269">nil</span>&nbsp;<span class="op" id="3366273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3366277">panic</span><span class="op" id="3366282">(</span><span class="string" id="3366283">`regexp:&nbsp;Compile(`</span>&nbsp;<span class="op" id="3366302">+</span>&nbsp;<span class="ident" id="3366304">quote</span><span class="op" id="3366309">(</span><span class="ident" id="3366310">str</span><span class="op" id="3366313">)</span>&nbsp;<span class="op" id="3366315">+</span>&nbsp;<span class="string" id="3366317">`):&nbsp;`</span>&nbsp;<span class="op" id="3366323">+</span>&nbsp;<span class="builtintype" id="3366325">error</span><span class="op" id="3366330">.</span><span class="ident" id="3366331">Error</span><span class="op" id="3366336">(</span><span class="op" id="3366337">)</span><span class="op" id="3366338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366344">return</span>&nbsp;<span class="ident" id="3366351">regexp</span><br>
<span class="lineno"></span><span class="op" id="3366358">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="3366361">//&nbsp;MustCompilePOSIX&nbsp;is&nbsp;like&nbsp;CompilePOSIX&nbsp;but&nbsp;panics&nbsp;if&nbsp;the&nbsp;expression&nbsp;cannot&nbsp;be&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="3366449">//&nbsp;It&nbsp;simplifies&nbsp;safe&nbsp;initialization&nbsp;of&nbsp;global&nbsp;variables&nbsp;holding&nbsp;compiled&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="3366531">//&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="keyword" id="3366547">func</span>&nbsp;<span class="ident" id="3366552">MustCompilePOSIX</span><span class="op" id="3366568">(</span><span class="ident" id="3366569">str</span>&nbsp;<span class="builtintype" id="3366573">string</span><span class="op" id="3366579">)</span>&nbsp;<span class="op" id="3366581">*</span><span class="ident" id="3366582">Regexp</span>&nbsp;<span class="op" id="3366589">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366592">regexp</span><span class="op" id="3366598">,</span>&nbsp;<span class="builtintype" id="3366600">error</span>&nbsp;<span class="op" id="3366606">:=</span>&nbsp;<span class="ident" id="3366609">CompilePOSIX</span><span class="op" id="3366621">(</span><span class="ident" id="3366622">str</span><span class="op" id="3366625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366628">if</span>&nbsp;<span class="builtintype" id="3366631">error</span>&nbsp;<span class="op" id="3366637">!=</span>&nbsp;<span class="ident" id="3366640">nil</span>&nbsp;<span class="op" id="3366644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3366648">panic</span><span class="op" id="3366653">(</span><span class="string" id="3366654">`regexp:&nbsp;CompilePOSIX(`</span>&nbsp;<span class="op" id="3366678">+</span>&nbsp;<span class="ident" id="3366680">quote</span><span class="op" id="3366685">(</span><span class="ident" id="3366686">str</span><span class="op" id="3366689">)</span>&nbsp;<span class="op" id="3366691">+</span>&nbsp;<span class="string" id="3366693">`):&nbsp;`</span>&nbsp;<span class="op" id="3366699">+</span>&nbsp;<span class="builtintype" id="3366701">error</span><span class="op" id="3366706">.</span><span class="ident" id="3366707">Error</span><span class="op" id="3366712">(</span><span class="op" id="3366713">)</span><span class="op" id="3366714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366720">return</span>&nbsp;<span class="ident" id="3366727">regexp</span><br>
<span class="lineno">235</span><span class="op" id="3366734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3366737">func</span>&nbsp;<span class="ident" id="3366742">quote</span><span class="op" id="3366747">(</span><span class="ident" id="3366748">s</span>&nbsp;<span class="builtintype" id="3366750">string</span><span class="op" id="3366756">)</span>&nbsp;<span class="builtintype" id="3366758">string</span>&nbsp;<span class="op" id="3366765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366768">if</span>&nbsp;<span class="ident" id="3366771">strconv</span><span class="op" id="3366778">.</span><span class="ident" id="3366779">CanBackquote</span><span class="op" id="3366791">(</span><span class="ident" id="3366792">s</span><span class="op" id="3366793">)</span>&nbsp;<span class="op" id="3366795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366799">return</span>&nbsp;<span class="string" id="3366806">&#34;`&#34;</span>&nbsp;<span class="op" id="3366810">+</span>&nbsp;<span class="ident" id="3366812">s</span>&nbsp;<span class="op" id="3366814">+</span>&nbsp;<span class="string" id="3366816">&#34;`&#34;</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366824">return</span>&nbsp;<span class="ident" id="3366831">strconv</span><span class="op" id="3366838">.</span><span class="ident" id="3366839">Quote</span><span class="op" id="3366844">(</span><span class="ident" id="3366845">s</span><span class="op" id="3366846">)</span><br>
<span class="lineno"></span><span class="op" id="3366848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3366851">//&nbsp;NumSubexp&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;parenthesized&nbsp;subexpressions&nbsp;in&nbsp;this&nbsp;Regexp.</span><br>
<span class="lineno">245</span><span class="keyword" id="3366931">func</span>&nbsp;<span class="op" id="3366936">(</span><span class="ident" id="3366937">re</span>&nbsp;<span class="op" id="3366940">*</span><span class="ident" id="3366941">Regexp</span><span class="op" id="3366947">)</span>&nbsp;<span class="ident" id="3366949">NumSubexp</span><span class="op" id="3366958">(</span><span class="op" id="3366959">)</span>&nbsp;<span class="builtintype" id="3366961">int</span>&nbsp;<span class="op" id="3366965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366968">return</span>&nbsp;<span class="ident" id="3366975">re</span><span class="op" id="3366977">.</span><span class="ident" id="3366978">numSubexp</span><br>
<span class="lineno"></span><span class="op" id="3366988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3366991">//&nbsp;SubexpNames&nbsp;returns&nbsp;the&nbsp;names&nbsp;of&nbsp;the&nbsp;parenthesized&nbsp;subexpressions</span><br>
<span class="lineno">250</span><span class="comment" id="3367060">//&nbsp;in&nbsp;this&nbsp;Regexp.&nbsp;&nbsp;The&nbsp;name&nbsp;for&nbsp;the&nbsp;first&nbsp;sub-expression&nbsp;is&nbsp;names[1],</span><br>
<span class="lineno"></span><span class="comment" id="3367131">//&nbsp;so&nbsp;that&nbsp;if&nbsp;m&nbsp;is&nbsp;a&nbsp;match&nbsp;slice,&nbsp;the&nbsp;name&nbsp;for&nbsp;m[i]&nbsp;is&nbsp;SubexpNames()[i].</span><br>
<span class="lineno"></span><span class="comment" id="3367204">//&nbsp;Since&nbsp;the&nbsp;Regexp&nbsp;as&nbsp;a&nbsp;whole&nbsp;cannot&nbsp;be&nbsp;named,&nbsp;names[0]&nbsp;is&nbsp;always</span><br>
<span class="lineno"></span><span class="comment" id="3367271">//&nbsp;the&nbsp;empty&nbsp;string.&nbsp;&nbsp;The&nbsp;slice&nbsp;should&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="keyword" id="3367327">func</span>&nbsp;<span class="op" id="3367332">(</span><span class="ident" id="3367333">re</span>&nbsp;<span class="op" id="3367336">*</span><span class="ident" id="3367337">Regexp</span><span class="op" id="3367343">)</span>&nbsp;<span class="ident" id="3367345">SubexpNames</span><span class="op" id="3367356">(</span><span class="op" id="3367357">)</span>&nbsp;<span class="op" id="3367359">[</span><span class="op" id="3367360">]</span><span class="builtintype" id="3367361">string</span>&nbsp;<span class="op" id="3367368">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367371">return</span>&nbsp;<span class="ident" id="3367378">re</span><span class="op" id="3367380">.</span><span class="ident" id="3367381">subexpNames</span><br>
<span class="lineno"></span><span class="op" id="3367393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3367396">const</span>&nbsp;<span class="ident" id="3367402">endOfText</span>&nbsp;<span class="builtintype" id="3367412">rune</span>&nbsp;<span class="op" id="3367417">=</span>&nbsp;<span class="op" id="3367419">-</span><span class="num" id="3367420">1</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="3367423">//&nbsp;input&nbsp;abstracts&nbsp;different&nbsp;representations&nbsp;of&nbsp;the&nbsp;input&nbsp;text.&nbsp;It&nbsp;provides</span><br>
<span class="lineno"></span><span class="comment" id="3367499">//&nbsp;one-character&nbsp;lookahead.</span><br>
<span class="lineno"></span><span class="keyword" id="3367527">type</span>&nbsp;<span class="ident" id="3367532">input</span>&nbsp;<span class="keyword" id="3367538">interface</span>&nbsp;<span class="op" id="3367548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367551">step</span><span class="op" id="3367555">(</span><span class="ident" id="3367556">pos</span>&nbsp;<span class="builtintype" id="3367560">int</span><span class="op" id="3367563">)</span>&nbsp;<span class="op" id="3367565">(</span><span class="ident" id="3367566">r</span>&nbsp;<span class="builtintype" id="3367568">rune</span><span class="op" id="3367572">,</span>&nbsp;<span class="ident" id="3367574">width</span>&nbsp;<span class="builtintype" id="3367580">int</span><span class="op" id="3367583">)</span>&nbsp;<span class="comment" id="3367585">//&nbsp;advance&nbsp;one&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367606">canCheckPrefix</span><span class="op" id="3367620">(</span><span class="op" id="3367621">)</span>&nbsp;<span class="builtintype" id="3367623">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3367640">//&nbsp;can&nbsp;we&nbsp;look&nbsp;ahead&nbsp;without&nbsp;losing&nbsp;info?</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367683">hasPrefix</span><span class="op" id="3367692">(</span><span class="ident" id="3367693">re</span>&nbsp;<span class="op" id="3367696">*</span><span class="ident" id="3367697">Regexp</span><span class="op" id="3367703">)</span>&nbsp;<span class="builtintype" id="3367705">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367711">index</span><span class="op" id="3367716">(</span><span class="ident" id="3367717">re</span>&nbsp;<span class="op" id="3367720">*</span><span class="ident" id="3367721">Regexp</span><span class="op" id="3367727">,</span>&nbsp;<span class="ident" id="3367729">pos</span>&nbsp;<span class="builtintype" id="3367733">int</span><span class="op" id="3367736">)</span>&nbsp;<span class="builtintype" id="3367738">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367743">context</span><span class="op" id="3367750">(</span><span class="ident" id="3367751">pos</span>&nbsp;<span class="builtintype" id="3367755">int</span><span class="op" id="3367758">)</span>&nbsp;<span class="ident" id="3367760">syntax</span><span class="op" id="3367766">.</span><span class="ident" id="3367767">EmptyOp</span><br>
<span class="lineno"></span><span class="op" id="3367775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="3367778">//&nbsp;inputString&nbsp;scans&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3367809">type</span>&nbsp;<span class="ident" id="3367814">inputString</span>&nbsp;<span class="keyword" id="3367826">struct</span>&nbsp;<span class="op" id="3367833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367836">str</span>&nbsp;<span class="builtintype" id="3367840">string</span><br>
<span class="lineno"></span><span class="op" id="3367847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="3367850">func</span>&nbsp;<span class="op" id="3367855">(</span><span class="ident" id="3367856">i</span>&nbsp;<span class="op" id="3367858">*</span><span class="ident" id="3367859">inputString</span><span class="op" id="3367870">)</span>&nbsp;<span class="ident" id="3367872">step</span><span class="op" id="3367876">(</span><span class="ident" id="3367877">pos</span>&nbsp;<span class="builtintype" id="3367881">int</span><span class="op" id="3367884">)</span>&nbsp;<span class="op" id="3367886">(</span><span class="builtintype" id="3367887">rune</span><span class="op" id="3367891">,</span>&nbsp;<span class="builtintype" id="3367893">int</span><span class="op" id="3367896">)</span>&nbsp;<span class="op" id="3367898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367901">if</span>&nbsp;<span class="ident" id="3367904">pos</span>&nbsp;<span class="op" id="3367908">&lt;</span>&nbsp;<span class="builtinfunc" id="3367910">len</span><span class="op" id="3367913">(</span><span class="ident" id="3367914">i</span><span class="op" id="3367915">.</span><span class="ident" id="3367916">str</span><span class="op" id="3367919">)</span>&nbsp;<span class="op" id="3367921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367925">c</span>&nbsp;<span class="op" id="3367927">:=</span>&nbsp;<span class="ident" id="3367930">i</span><span class="op" id="3367931">.</span><span class="ident" id="3367932">str</span><span class="op" id="3367935">[</span><span class="ident" id="3367936">pos</span><span class="op" id="3367939">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367943">if</span>&nbsp;<span class="ident" id="3367946">c</span>&nbsp;<span class="op" id="3367948">&lt;</span>&nbsp;<span class="ident" id="3367950">utf8</span><span class="op" id="3367954">.</span><span class="ident" id="3367955">RuneSelf</span>&nbsp;<span class="op" id="3367964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367969">return</span>&nbsp;<span class="builtintype" id="3367976">rune</span><span class="op" id="3367980">(</span><span class="ident" id="3367981">c</span><span class="op" id="3367982">)</span><span class="op" id="3367983">,</span>&nbsp;<span class="num" id="3367985">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367993">return</span>&nbsp;<span class="ident" id="3368000">utf8</span><span class="op" id="3368004">.</span><span class="ident" id="3368005">DecodeRuneInString</span><span class="op" id="3368023">(</span><span class="ident" id="3368024">i</span><span class="op" id="3368025">.</span><span class="ident" id="3368026">str</span><span class="op" id="3368029">[</span><span class="ident" id="3368030">pos</span><span class="op" id="3368033">:</span><span class="op" id="3368034">]</span><span class="op" id="3368035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368041">return</span>&nbsp;<span class="ident" id="3368048">endOfText</span><span class="op" id="3368057">,</span>&nbsp;<span class="num" id="3368059">0</span><br>
<span class="lineno"></span><span class="op" id="3368061">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="3368064">func</span>&nbsp;<span class="op" id="3368069">(</span><span class="ident" id="3368070">i</span>&nbsp;<span class="op" id="3368072">*</span><span class="ident" id="3368073">inputString</span><span class="op" id="3368084">)</span>&nbsp;<span class="ident" id="3368086">canCheckPrefix</span><span class="op" id="3368100">(</span><span class="op" id="3368101">)</span>&nbsp;<span class="builtintype" id="3368103">bool</span>&nbsp;<span class="op" id="3368108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368111">return</span>&nbsp;<span class="builtintype" id="3368118">true</span><br>
<span class="lineno"></span><span class="op" id="3368123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="3368126">func</span>&nbsp;<span class="op" id="3368131">(</span><span class="ident" id="3368132">i</span>&nbsp;<span class="op" id="3368134">*</span><span class="ident" id="3368135">inputString</span><span class="op" id="3368146">)</span>&nbsp;<span class="ident" id="3368148">hasPrefix</span><span class="op" id="3368157">(</span><span class="ident" id="3368158">re</span>&nbsp;<span class="op" id="3368161">*</span><span class="ident" id="3368162">Regexp</span><span class="op" id="3368168">)</span>&nbsp;<span class="builtintype" id="3368170">bool</span>&nbsp;<span class="op" id="3368175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368178">return</span>&nbsp;<span class="ident" id="3368185">strings</span><span class="op" id="3368192">.</span><span class="ident" id="3368193">HasPrefix</span><span class="op" id="3368202">(</span><span class="ident" id="3368203">i</span><span class="op" id="3368204">.</span><span class="ident" id="3368205">str</span><span class="op" id="3368208">,</span>&nbsp;<span class="ident" id="3368210">re</span><span class="op" id="3368212">.</span><span class="ident" id="3368213">prefix</span><span class="op" id="3368219">)</span><br>
<span class="lineno"></span><span class="op" id="3368221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3368224">func</span>&nbsp;<span class="op" id="3368229">(</span><span class="ident" id="3368230">i</span>&nbsp;<span class="op" id="3368232">*</span><span class="ident" id="3368233">inputString</span><span class="op" id="3368244">)</span>&nbsp;<span class="ident" id="3368246">index</span><span class="op" id="3368251">(</span><span class="ident" id="3368252">re</span>&nbsp;<span class="op" id="3368255">*</span><span class="ident" id="3368256">Regexp</span><span class="op" id="3368262">,</span>&nbsp;<span class="ident" id="3368264">pos</span>&nbsp;<span class="builtintype" id="3368268">int</span><span class="op" id="3368271">)</span>&nbsp;<span class="builtintype" id="3368273">int</span>&nbsp;<span class="op" id="3368277">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368280">return</span>&nbsp;<span class="ident" id="3368287">strings</span><span class="op" id="3368294">.</span><span class="ident" id="3368295">Index</span><span class="op" id="3368300">(</span><span class="ident" id="3368301">i</span><span class="op" id="3368302">.</span><span class="ident" id="3368303">str</span><span class="op" id="3368306">[</span><span class="ident" id="3368307">pos</span><span class="op" id="3368310">:</span><span class="op" id="3368311">]</span><span class="op" id="3368312">,</span>&nbsp;<span class="ident" id="3368314">re</span><span class="op" id="3368316">.</span><span class="ident" id="3368317">prefix</span><span class="op" id="3368323">)</span><br>
<span class="lineno"></span><span class="op" id="3368325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3368328">func</span>&nbsp;<span class="op" id="3368333">(</span><span class="ident" id="3368334">i</span>&nbsp;<span class="op" id="3368336">*</span><span class="ident" id="3368337">inputString</span><span class="op" id="3368348">)</span>&nbsp;<span class="ident" id="3368350">context</span><span class="op" id="3368357">(</span><span class="ident" id="3368358">pos</span>&nbsp;<span class="builtintype" id="3368362">int</span><span class="op" id="3368365">)</span>&nbsp;<span class="ident" id="3368367">syntax</span><span class="op" id="3368373">.</span><span class="ident" id="3368374">EmptyOp</span>&nbsp;<span class="op" id="3368382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368385">r1</span><span class="op" id="3368387">,</span>&nbsp;<span class="ident" id="3368389">r2</span>&nbsp;<span class="op" id="3368392">:=</span>&nbsp;<span class="ident" id="3368395">endOfText</span><span class="op" id="3368404">,</span>&nbsp;<span class="ident" id="3368406">endOfText</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368417">if</span>&nbsp;<span class="ident" id="3368420">pos</span>&nbsp;<span class="op" id="3368424">&gt;</span>&nbsp;<span class="num" id="3368426">0</span>&nbsp;<span class="op" id="3368428">&amp;&amp;</span>&nbsp;<span class="ident" id="3368431">pos</span>&nbsp;<span class="op" id="3368435">&lt;=</span>&nbsp;<span class="builtinfunc" id="3368438">len</span><span class="op" id="3368441">(</span><span class="ident" id="3368442">i</span><span class="op" id="3368443">.</span><span class="ident" id="3368444">str</span><span class="op" id="3368447">)</span>&nbsp;<span class="op" id="3368449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368453">r1</span><span class="op" id="3368455">,</span>&nbsp;<span class="ident" id="3368457">_</span>&nbsp;<span class="op" id="3368459">=</span>&nbsp;<span class="ident" id="3368461">utf8</span><span class="op" id="3368465">.</span><span class="ident" id="3368466">DecodeLastRuneInString</span><span class="op" id="3368488">(</span><span class="ident" id="3368489">i</span><span class="op" id="3368490">.</span><span class="ident" id="3368491">str</span><span class="op" id="3368494">[</span><span class="op" id="3368495">:</span><span class="ident" id="3368496">pos</span><span class="op" id="3368499">]</span><span class="op" id="3368500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368506">if</span>&nbsp;<span class="ident" id="3368509">pos</span>&nbsp;<span class="op" id="3368513">&lt;</span>&nbsp;<span class="builtinfunc" id="3368515">len</span><span class="op" id="3368518">(</span><span class="ident" id="3368519">i</span><span class="op" id="3368520">.</span><span class="ident" id="3368521">str</span><span class="op" id="3368524">)</span>&nbsp;<span class="op" id="3368526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368530">r2</span><span class="op" id="3368532">,</span>&nbsp;<span class="ident" id="3368534">_</span>&nbsp;<span class="op" id="3368536">=</span>&nbsp;<span class="ident" id="3368538">utf8</span><span class="op" id="3368542">.</span><span class="ident" id="3368543">DecodeRuneInString</span><span class="op" id="3368561">(</span><span class="ident" id="3368562">i</span><span class="op" id="3368563">.</span><span class="ident" id="3368564">str</span><span class="op" id="3368567">[</span><span class="ident" id="3368568">pos</span><span class="op" id="3368571">:</span><span class="op" id="3368572">]</span><span class="op" id="3368573">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368579">return</span>&nbsp;<span class="ident" id="3368586">syntax</span><span class="op" id="3368592">.</span><span class="ident" id="3368593">EmptyOpContext</span><span class="op" id="3368607">(</span><span class="ident" id="3368608">r1</span><span class="op" id="3368610">,</span>&nbsp;<span class="ident" id="3368612">r2</span><span class="op" id="3368614">)</span><br>
<span class="lineno"></span><span class="op" id="3368616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3368619">//&nbsp;inputBytes&nbsp;scans&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno">310</span><span class="keyword" id="3368653">type</span>&nbsp;<span class="ident" id="3368658">inputBytes</span>&nbsp;<span class="keyword" id="3368669">struct</span>&nbsp;<span class="op" id="3368676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368679">str</span>&nbsp;<span class="op" id="3368683">[</span><span class="op" id="3368684">]</span><span class="builtintype" id="3368685">byte</span><br>
<span class="lineno"></span><span class="op" id="3368690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3368693">func</span>&nbsp;<span class="op" id="3368698">(</span><span class="ident" id="3368699">i</span>&nbsp;<span class="op" id="3368701">*</span><span class="ident" id="3368702">inputBytes</span><span class="op" id="3368712">)</span>&nbsp;<span class="ident" id="3368714">step</span><span class="op" id="3368718">(</span><span class="ident" id="3368719">pos</span>&nbsp;<span class="builtintype" id="3368723">int</span><span class="op" id="3368726">)</span>&nbsp;<span class="op" id="3368728">(</span><span class="builtintype" id="3368729">rune</span><span class="op" id="3368733">,</span>&nbsp;<span class="builtintype" id="3368735">int</span><span class="op" id="3368738">)</span>&nbsp;<span class="op" id="3368740">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368743">if</span>&nbsp;<span class="ident" id="3368746">pos</span>&nbsp;<span class="op" id="3368750">&lt;</span>&nbsp;<span class="builtinfunc" id="3368752">len</span><span class="op" id="3368755">(</span><span class="ident" id="3368756">i</span><span class="op" id="3368757">.</span><span class="ident" id="3368758">str</span><span class="op" id="3368761">)</span>&nbsp;<span class="op" id="3368763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368767">c</span>&nbsp;<span class="op" id="3368769">:=</span>&nbsp;<span class="ident" id="3368772">i</span><span class="op" id="3368773">.</span><span class="ident" id="3368774">str</span><span class="op" id="3368777">[</span><span class="ident" id="3368778">pos</span><span class="op" id="3368781">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368785">if</span>&nbsp;<span class="ident" id="3368788">c</span>&nbsp;<span class="op" id="3368790">&lt;</span>&nbsp;<span class="ident" id="3368792">utf8</span><span class="op" id="3368796">.</span><span class="ident" id="3368797">RuneSelf</span>&nbsp;<span class="op" id="3368806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368811">return</span>&nbsp;<span class="builtintype" id="3368818">rune</span><span class="op" id="3368822">(</span><span class="ident" id="3368823">c</span><span class="op" id="3368824">)</span><span class="op" id="3368825">,</span>&nbsp;<span class="num" id="3368827">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368831">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368835">return</span>&nbsp;<span class="ident" id="3368842">utf8</span><span class="op" id="3368846">.</span><span class="ident" id="3368847">DecodeRune</span><span class="op" id="3368857">(</span><span class="ident" id="3368858">i</span><span class="op" id="3368859">.</span><span class="ident" id="3368860">str</span><span class="op" id="3368863">[</span><span class="ident" id="3368864">pos</span><span class="op" id="3368867">:</span><span class="op" id="3368868">]</span><span class="op" id="3368869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368875">return</span>&nbsp;<span class="ident" id="3368882">endOfText</span><span class="op" id="3368891">,</span>&nbsp;<span class="num" id="3368893">0</span><br>
<span class="lineno"></span><span class="op" id="3368895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="3368898">func</span>&nbsp;<span class="op" id="3368903">(</span><span class="ident" id="3368904">i</span>&nbsp;<span class="op" id="3368906">*</span><span class="ident" id="3368907">inputBytes</span><span class="op" id="3368917">)</span>&nbsp;<span class="ident" id="3368919">canCheckPrefix</span><span class="op" id="3368933">(</span><span class="op" id="3368934">)</span>&nbsp;<span class="builtintype" id="3368936">bool</span>&nbsp;<span class="op" id="3368941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368944">return</span>&nbsp;<span class="builtintype" id="3368951">true</span><br>
<span class="lineno"></span><span class="op" id="3368956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3368959">func</span>&nbsp;<span class="op" id="3368964">(</span><span class="ident" id="3368965">i</span>&nbsp;<span class="op" id="3368967">*</span><span class="ident" id="3368968">inputBytes</span><span class="op" id="3368978">)</span>&nbsp;<span class="ident" id="3368980">hasPrefix</span><span class="op" id="3368989">(</span><span class="ident" id="3368990">re</span>&nbsp;<span class="op" id="3368993">*</span><span class="ident" id="3368994">Regexp</span><span class="op" id="3369000">)</span>&nbsp;<span class="builtintype" id="3369002">bool</span>&nbsp;<span class="op" id="3369007">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369010">return</span>&nbsp;<span class="ident" id="3369017">bytes</span><span class="op" id="3369022">.</span><span class="ident" id="3369023">HasPrefix</span><span class="op" id="3369032">(</span><span class="ident" id="3369033">i</span><span class="op" id="3369034">.</span><span class="ident" id="3369035">str</span><span class="op" id="3369038">,</span>&nbsp;<span class="ident" id="3369040">re</span><span class="op" id="3369042">.</span><span class="ident" id="3369043">prefixBytes</span><span class="op" id="3369054">)</span><br>
<span class="lineno"></span><span class="op" id="3369056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3369059">func</span>&nbsp;<span class="op" id="3369064">(</span><span class="ident" id="3369065">i</span>&nbsp;<span class="op" id="3369067">*</span><span class="ident" id="3369068">inputBytes</span><span class="op" id="3369078">)</span>&nbsp;<span class="ident" id="3369080">index</span><span class="op" id="3369085">(</span><span class="ident" id="3369086">re</span>&nbsp;<span class="op" id="3369089">*</span><span class="ident" id="3369090">Regexp</span><span class="op" id="3369096">,</span>&nbsp;<span class="ident" id="3369098">pos</span>&nbsp;<span class="builtintype" id="3369102">int</span><span class="op" id="3369105">)</span>&nbsp;<span class="builtintype" id="3369107">int</span>&nbsp;<span class="op" id="3369111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369114">return</span>&nbsp;<span class="ident" id="3369121">bytes</span><span class="op" id="3369126">.</span><span class="ident" id="3369127">Index</span><span class="op" id="3369132">(</span><span class="ident" id="3369133">i</span><span class="op" id="3369134">.</span><span class="ident" id="3369135">str</span><span class="op" id="3369138">[</span><span class="ident" id="3369139">pos</span><span class="op" id="3369142">:</span><span class="op" id="3369143">]</span><span class="op" id="3369144">,</span>&nbsp;<span class="ident" id="3369146">re</span><span class="op" id="3369148">.</span><span class="ident" id="3369149">prefixBytes</span><span class="op" id="3369160">)</span><br>
<span class="lineno">335</span><span class="op" id="3369162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3369165">func</span>&nbsp;<span class="op" id="3369170">(</span><span class="ident" id="3369171">i</span>&nbsp;<span class="op" id="3369173">*</span><span class="ident" id="3369174">inputBytes</span><span class="op" id="3369184">)</span>&nbsp;<span class="ident" id="3369186">context</span><span class="op" id="3369193">(</span><span class="ident" id="3369194">pos</span>&nbsp;<span class="builtintype" id="3369198">int</span><span class="op" id="3369201">)</span>&nbsp;<span class="ident" id="3369203">syntax</span><span class="op" id="3369209">.</span><span class="ident" id="3369210">EmptyOp</span>&nbsp;<span class="op" id="3369218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369221">r1</span><span class="op" id="3369223">,</span>&nbsp;<span class="ident" id="3369225">r2</span>&nbsp;<span class="op" id="3369228">:=</span>&nbsp;<span class="ident" id="3369231">endOfText</span><span class="op" id="3369240">,</span>&nbsp;<span class="ident" id="3369242">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369253">if</span>&nbsp;<span class="ident" id="3369256">pos</span>&nbsp;<span class="op" id="3369260">&gt;</span>&nbsp;<span class="num" id="3369262">0</span>&nbsp;<span class="op" id="3369264">&amp;&amp;</span>&nbsp;<span class="ident" id="3369267">pos</span>&nbsp;<span class="op" id="3369271">&lt;=</span>&nbsp;<span class="builtinfunc" id="3369274">len</span><span class="op" id="3369277">(</span><span class="ident" id="3369278">i</span><span class="op" id="3369279">.</span><span class="ident" id="3369280">str</span><span class="op" id="3369283">)</span>&nbsp;<span class="op" id="3369285">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369289">r1</span><span class="op" id="3369291">,</span>&nbsp;<span class="ident" id="3369293">_</span>&nbsp;<span class="op" id="3369295">=</span>&nbsp;<span class="ident" id="3369297">utf8</span><span class="op" id="3369301">.</span><span class="ident" id="3369302">DecodeLastRune</span><span class="op" id="3369316">(</span><span class="ident" id="3369317">i</span><span class="op" id="3369318">.</span><span class="ident" id="3369319">str</span><span class="op" id="3369322">[</span><span class="op" id="3369323">:</span><span class="ident" id="3369324">pos</span><span class="op" id="3369327">]</span><span class="op" id="3369328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369334">if</span>&nbsp;<span class="ident" id="3369337">pos</span>&nbsp;<span class="op" id="3369341">&lt;</span>&nbsp;<span class="builtinfunc" id="3369343">len</span><span class="op" id="3369346">(</span><span class="ident" id="3369347">i</span><span class="op" id="3369348">.</span><span class="ident" id="3369349">str</span><span class="op" id="3369352">)</span>&nbsp;<span class="op" id="3369354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369358">r2</span><span class="op" id="3369360">,</span>&nbsp;<span class="ident" id="3369362">_</span>&nbsp;<span class="op" id="3369364">=</span>&nbsp;<span class="ident" id="3369366">utf8</span><span class="op" id="3369370">.</span><span class="ident" id="3369371">DecodeRune</span><span class="op" id="3369381">(</span><span class="ident" id="3369382">i</span><span class="op" id="3369383">.</span><span class="ident" id="3369384">str</span><span class="op" id="3369387">[</span><span class="ident" id="3369388">pos</span><span class="op" id="3369391">:</span><span class="op" id="3369392">]</span><span class="op" id="3369393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369396">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369399">return</span>&nbsp;<span class="ident" id="3369406">syntax</span><span class="op" id="3369412">.</span><span class="ident" id="3369413">EmptyOpContext</span><span class="op" id="3369427">(</span><span class="ident" id="3369428">r1</span><span class="op" id="3369430">,</span>&nbsp;<span class="ident" id="3369432">r2</span><span class="op" id="3369434">)</span><br>
<span class="lineno"></span><span class="op" id="3369436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3369439">//&nbsp;inputReader&nbsp;scans&nbsp;a&nbsp;RuneReader.</span><br>
<span class="lineno"></span><span class="keyword" id="3369474">type</span>&nbsp;<span class="ident" id="3369479">inputReader</span>&nbsp;<span class="keyword" id="3369491">struct</span>&nbsp;<span class="op" id="3369498">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369501">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3369507">io</span><span class="op" id="3369509">.</span><span class="ident" id="3369510">RuneReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369522">atEOT</span>&nbsp;<span class="builtintype" id="3369528">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369534">pos</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3369540">int</span><br>
<span class="lineno"></span><span class="op" id="3369544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="3369547">func</span>&nbsp;<span class="op" id="3369552">(</span><span class="ident" id="3369553">i</span>&nbsp;<span class="op" id="3369555">*</span><span class="ident" id="3369556">inputReader</span><span class="op" id="3369567">)</span>&nbsp;<span class="ident" id="3369569">step</span><span class="op" id="3369573">(</span><span class="ident" id="3369574">pos</span>&nbsp;<span class="builtintype" id="3369578">int</span><span class="op" id="3369581">)</span>&nbsp;<span class="op" id="3369583">(</span><span class="builtintype" id="3369584">rune</span><span class="op" id="3369588">,</span>&nbsp;<span class="builtintype" id="3369590">int</span><span class="op" id="3369593">)</span>&nbsp;<span class="op" id="3369595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369598">if</span>&nbsp;<span class="op" id="3369601">!</span><span class="ident" id="3369602">i</span><span class="op" id="3369603">.</span><span class="ident" id="3369604">atEOT</span>&nbsp;<span class="op" id="3369610">&amp;&amp;</span>&nbsp;<span class="ident" id="3369613">pos</span>&nbsp;<span class="op" id="3369617">!=</span>&nbsp;<span class="ident" id="3369620">i</span><span class="op" id="3369621">.</span><span class="ident" id="3369622">pos</span>&nbsp;<span class="op" id="3369626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369630">return</span>&nbsp;<span class="ident" id="3369637">endOfText</span><span class="op" id="3369646">,</span>&nbsp;<span class="num" id="3369648">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369652">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369655">r</span><span class="op" id="3369656">,</span>&nbsp;<span class="ident" id="3369658">w</span><span class="op" id="3369659">,</span>&nbsp;<span class="ident" id="3369661">err</span>&nbsp;<span class="op" id="3369665">:=</span>&nbsp;<span class="ident" id="3369668">i</span><span class="op" id="3369669">.</span><span class="ident" id="3369670">r</span><span class="op" id="3369671">.</span><span class="ident" id="3369672">ReadRune</span><span class="op" id="3369680">(</span><span class="op" id="3369681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369684">if</span>&nbsp;<span class="ident" id="3369687">err</span>&nbsp;<span class="op" id="3369691">!=</span>&nbsp;<span class="ident" id="3369694">nil</span>&nbsp;<span class="op" id="3369698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369702">i</span><span class="op" id="3369703">.</span><span class="ident" id="3369704">atEOT</span>&nbsp;<span class="op" id="3369710">=</span>&nbsp;<span class="builtintype" id="3369712">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369719">return</span>&nbsp;<span class="ident" id="3369726">endOfText</span><span class="op" id="3369735">,</span>&nbsp;<span class="num" id="3369737">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369740">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369743">i</span><span class="op" id="3369744">.</span><span class="ident" id="3369745">pos</span>&nbsp;<span class="op" id="3369749">+=</span>&nbsp;<span class="ident" id="3369752">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369755">return</span>&nbsp;<span class="ident" id="3369762">r</span><span class="op" id="3369763">,</span>&nbsp;<span class="ident" id="3369765">w</span><br>
<span class="lineno"></span><span class="op" id="3369767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3369770">func</span>&nbsp;<span class="op" id="3369775">(</span><span class="ident" id="3369776">i</span>&nbsp;<span class="op" id="3369778">*</span><span class="ident" id="3369779">inputReader</span><span class="op" id="3369790">)</span>&nbsp;<span class="ident" id="3369792">canCheckPrefix</span><span class="op" id="3369806">(</span><span class="op" id="3369807">)</span>&nbsp;<span class="builtintype" id="3369809">bool</span>&nbsp;<span class="op" id="3369814">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369817">return</span>&nbsp;<span class="builtintype" id="3369824">false</span><br>
<span class="lineno"></span><span class="op" id="3369830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3369833">func</span>&nbsp;<span class="op" id="3369838">(</span><span class="ident" id="3369839">i</span>&nbsp;<span class="op" id="3369841">*</span><span class="ident" id="3369842">inputReader</span><span class="op" id="3369853">)</span>&nbsp;<span class="ident" id="3369855">hasPrefix</span><span class="op" id="3369864">(</span><span class="ident" id="3369865">re</span>&nbsp;<span class="op" id="3369868">*</span><span class="ident" id="3369869">Regexp</span><span class="op" id="3369875">)</span>&nbsp;<span class="builtintype" id="3369877">bool</span>&nbsp;<span class="op" id="3369882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369885">return</span>&nbsp;<span class="builtintype" id="3369892">false</span><br>
<span class="lineno">375</span><span class="op" id="3369898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3369901">func</span>&nbsp;<span class="op" id="3369906">(</span><span class="ident" id="3369907">i</span>&nbsp;<span class="op" id="3369909">*</span><span class="ident" id="3369910">inputReader</span><span class="op" id="3369921">)</span>&nbsp;<span class="ident" id="3369923">index</span><span class="op" id="3369928">(</span><span class="ident" id="3369929">re</span>&nbsp;<span class="op" id="3369932">*</span><span class="ident" id="3369933">Regexp</span><span class="op" id="3369939">,</span>&nbsp;<span class="ident" id="3369941">pos</span>&nbsp;<span class="builtintype" id="3369945">int</span><span class="op" id="3369948">)</span>&nbsp;<span class="builtintype" id="3369950">int</span>&nbsp;<span class="op" id="3369954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369957">return</span>&nbsp;<span class="op" id="3369964">-</span><span class="num" id="3369965">1</span><br>
<span class="lineno"></span><span class="op" id="3369967">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="keyword" id="3369970">func</span>&nbsp;<span class="op" id="3369975">(</span><span class="ident" id="3369976">i</span>&nbsp;<span class="op" id="3369978">*</span><span class="ident" id="3369979">inputReader</span><span class="op" id="3369990">)</span>&nbsp;<span class="ident" id="3369992">context</span><span class="op" id="3369999">(</span><span class="ident" id="3370000">pos</span>&nbsp;<span class="builtintype" id="3370004">int</span><span class="op" id="3370007">)</span>&nbsp;<span class="ident" id="3370009">syntax</span><span class="op" id="3370015">.</span><span class="ident" id="3370016">EmptyOp</span>&nbsp;<span class="op" id="3370024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370027">return</span>&nbsp;<span class="num" id="3370034">0</span><br>
<span class="lineno"></span><span class="op" id="3370036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="3370039">//&nbsp;LiteralPrefix&nbsp;returns&nbsp;a&nbsp;literal&nbsp;string&nbsp;that&nbsp;must&nbsp;begin&nbsp;any&nbsp;match</span><br>
<span class="lineno"></span><span class="comment" id="3370107">//&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;re.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;boolean&nbsp;true&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3370176">//&nbsp;literal&nbsp;string&nbsp;comprises&nbsp;the&nbsp;entire&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="3370235">func</span>&nbsp;<span class="op" id="3370240">(</span><span class="ident" id="3370241">re</span>&nbsp;<span class="op" id="3370244">*</span><span class="ident" id="3370245">Regexp</span><span class="op" id="3370251">)</span>&nbsp;<span class="ident" id="3370253">LiteralPrefix</span><span class="op" id="3370266">(</span><span class="op" id="3370267">)</span>&nbsp;<span class="op" id="3370269">(</span><span class="ident" id="3370270">prefix</span>&nbsp;<span class="builtintype" id="3370277">string</span><span class="op" id="3370283">,</span>&nbsp;<span class="ident" id="3370285">complete</span>&nbsp;<span class="builtintype" id="3370294">bool</span><span class="op" id="3370298">)</span>&nbsp;<span class="op" id="3370300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370303">return</span>&nbsp;<span class="ident" id="3370310">re</span><span class="op" id="3370312">.</span><span class="ident" id="3370313">prefix</span><span class="op" id="3370319">,</span>&nbsp;<span class="ident" id="3370321">re</span><span class="op" id="3370323">.</span><span class="ident" id="3370324">prefixComplete</span><br>
<span class="lineno">390</span><span class="op" id="3370339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3370342">//&nbsp;MatchReader&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;text&nbsp;read&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3370413">//&nbsp;RuneReader.</span><br>
<span class="lineno"></span><span class="keyword" id="3370428">func</span>&nbsp;<span class="op" id="3370433">(</span><span class="ident" id="3370434">re</span>&nbsp;<span class="op" id="3370437">*</span><span class="ident" id="3370438">Regexp</span><span class="op" id="3370444">)</span>&nbsp;<span class="ident" id="3370446">MatchReader</span><span class="op" id="3370457">(</span><span class="ident" id="3370458">r</span>&nbsp;<span class="ident" id="3370460">io</span><span class="op" id="3370462">.</span><span class="ident" id="3370463">RuneReader</span><span class="op" id="3370473">)</span>&nbsp;<span class="builtintype" id="3370475">bool</span>&nbsp;<span class="op" id="3370480">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370483">return</span>&nbsp;<span class="ident" id="3370490">re</span><span class="op" id="3370492">.</span><span class="ident" id="3370493">doExecute</span><span class="op" id="3370502">(</span><span class="ident" id="3370503">r</span><span class="op" id="3370504">,</span>&nbsp;<span class="ident" id="3370506">nil</span><span class="op" id="3370509">,</span>&nbsp;<span class="string" id="3370511">&#34;&#34;</span><span class="op" id="3370513">,</span>&nbsp;<span class="num" id="3370515">0</span><span class="op" id="3370516">,</span>&nbsp;<span class="num" id="3370518">0</span><span class="op" id="3370519">)</span>&nbsp;<span class="op" id="3370521">!=</span>&nbsp;<span class="ident" id="3370524">nil</span><br>
<span class="lineno"></span><span class="op" id="3370528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3370531">//&nbsp;MatchString&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="3370595">func</span>&nbsp;<span class="op" id="3370600">(</span><span class="ident" id="3370601">re</span>&nbsp;<span class="op" id="3370604">*</span><span class="ident" id="3370605">Regexp</span><span class="op" id="3370611">)</span>&nbsp;<span class="ident" id="3370613">MatchString</span><span class="op" id="3370624">(</span><span class="ident" id="3370625">s</span>&nbsp;<span class="builtintype" id="3370627">string</span><span class="op" id="3370633">)</span>&nbsp;<span class="builtintype" id="3370635">bool</span>&nbsp;<span class="op" id="3370640">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370643">return</span>&nbsp;<span class="ident" id="3370650">re</span><span class="op" id="3370652">.</span><span class="ident" id="3370653">doExecute</span><span class="op" id="3370662">(</span><span class="ident" id="3370663">nil</span><span class="op" id="3370666">,</span>&nbsp;<span class="ident" id="3370668">nil</span><span class="op" id="3370671">,</span>&nbsp;<span class="ident" id="3370673">s</span><span class="op" id="3370674">,</span>&nbsp;<span class="num" id="3370676">0</span><span class="op" id="3370677">,</span>&nbsp;<span class="num" id="3370679">0</span><span class="op" id="3370680">)</span>&nbsp;<span class="op" id="3370682">!=</span>&nbsp;<span class="ident" id="3370685">nil</span><br>
<span class="lineno"></span><span class="op" id="3370689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3370692">//&nbsp;Match&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;byte&nbsp;slice&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="3370754">func</span>&nbsp;<span class="op" id="3370759">(</span><span class="ident" id="3370760">re</span>&nbsp;<span class="op" id="3370763">*</span><span class="ident" id="3370764">Regexp</span><span class="op" id="3370770">)</span>&nbsp;<span class="ident" id="3370772">Match</span><span class="op" id="3370777">(</span><span class="ident" id="3370778">b</span>&nbsp;<span class="op" id="3370780">[</span><span class="op" id="3370781">]</span><span class="builtintype" id="3370782">byte</span><span class="op" id="3370786">)</span>&nbsp;<span class="builtintype" id="3370788">bool</span>&nbsp;<span class="op" id="3370793">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370796">return</span>&nbsp;<span class="ident" id="3370803">re</span><span class="op" id="3370805">.</span><span class="ident" id="3370806">doExecute</span><span class="op" id="3370815">(</span><span class="ident" id="3370816">nil</span><span class="op" id="3370819">,</span>&nbsp;<span class="ident" id="3370821">b</span><span class="op" id="3370822">,</span>&nbsp;<span class="string" id="3370824">&#34;&#34;</span><span class="op" id="3370826">,</span>&nbsp;<span class="num" id="3370828">0</span><span class="op" id="3370829">,</span>&nbsp;<span class="num" id="3370831">0</span><span class="op" id="3370832">)</span>&nbsp;<span class="op" id="3370834">!=</span>&nbsp;<span class="ident" id="3370837">nil</span><br>
<span class="lineno"></span><span class="op" id="3370841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3370844">//&nbsp;MatchReader&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression&nbsp;matches&nbsp;the&nbsp;text</span><br>
<span class="lineno"></span><span class="comment" id="3370920">//&nbsp;read&nbsp;by&nbsp;the&nbsp;RuneReader.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and</span><br>
<span class="lineno">410</span><span class="comment" id="3370997">//&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3371027">func</span>&nbsp;<span class="ident" id="3371032">MatchReader</span><span class="op" id="3371043">(</span><span class="ident" id="3371044">pattern</span>&nbsp;<span class="builtintype" id="3371052">string</span><span class="op" id="3371058">,</span>&nbsp;<span class="ident" id="3371060">r</span>&nbsp;<span class="ident" id="3371062">io</span><span class="op" id="3371064">.</span><span class="ident" id="3371065">RuneReader</span><span class="op" id="3371075">)</span>&nbsp;<span class="op" id="3371077">(</span><span class="ident" id="3371078">matched</span>&nbsp;<span class="builtintype" id="3371086">bool</span><span class="op" id="3371090">,</span>&nbsp;<span class="ident" id="3371092">err</span>&nbsp;<span class="builtintype" id="3371096">error</span><span class="op" id="3371101">)</span>&nbsp;<span class="op" id="3371103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371106">re</span><span class="op" id="3371108">,</span>&nbsp;<span class="ident" id="3371110">err</span>&nbsp;<span class="op" id="3371114">:=</span>&nbsp;<span class="ident" id="3371117">Compile</span><span class="op" id="3371124">(</span><span class="ident" id="3371125">pattern</span><span class="op" id="3371132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371135">if</span>&nbsp;<span class="ident" id="3371138">err</span>&nbsp;<span class="op" id="3371142">!=</span>&nbsp;<span class="ident" id="3371145">nil</span>&nbsp;<span class="op" id="3371149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371153">return</span>&nbsp;<span class="builtintype" id="3371160">false</span><span class="op" id="3371165">,</span>&nbsp;<span class="ident" id="3371167">err</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371175">return</span>&nbsp;<span class="ident" id="3371182">re</span><span class="op" id="3371184">.</span><span class="ident" id="3371185">MatchReader</span><span class="op" id="3371196">(</span><span class="ident" id="3371197">r</span><span class="op" id="3371198">)</span><span class="op" id="3371199">,</span>&nbsp;<span class="ident" id="3371201">nil</span><br>
<span class="lineno"></span><span class="op" id="3371205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3371208">//&nbsp;MatchString&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression</span><br>
<span class="lineno">420</span><span class="comment" id="3371267">//&nbsp;matches&nbsp;a&nbsp;string.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="3371319">//&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3371368">func</span>&nbsp;<span class="ident" id="3371373">MatchString</span><span class="op" id="3371384">(</span><span class="ident" id="3371385">pattern</span>&nbsp;<span class="builtintype" id="3371393">string</span><span class="op" id="3371399">,</span>&nbsp;<span class="ident" id="3371401">s</span>&nbsp;<span class="builtintype" id="3371403">string</span><span class="op" id="3371409">)</span>&nbsp;<span class="op" id="3371411">(</span><span class="ident" id="3371412">matched</span>&nbsp;<span class="builtintype" id="3371420">bool</span><span class="op" id="3371424">,</span>&nbsp;<span class="ident" id="3371426">err</span>&nbsp;<span class="builtintype" id="3371430">error</span><span class="op" id="3371435">)</span>&nbsp;<span class="op" id="3371437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371440">re</span><span class="op" id="3371442">,</span>&nbsp;<span class="ident" id="3371444">err</span>&nbsp;<span class="op" id="3371448">:=</span>&nbsp;<span class="ident" id="3371451">Compile</span><span class="op" id="3371458">(</span><span class="ident" id="3371459">pattern</span><span class="op" id="3371466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371469">if</span>&nbsp;<span class="ident" id="3371472">err</span>&nbsp;<span class="op" id="3371476">!=</span>&nbsp;<span class="ident" id="3371479">nil</span>&nbsp;<span class="op" id="3371483">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371487">return</span>&nbsp;<span class="builtintype" id="3371494">false</span><span class="op" id="3371499">,</span>&nbsp;<span class="ident" id="3371501">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371509">return</span>&nbsp;<span class="ident" id="3371516">re</span><span class="op" id="3371518">.</span><span class="ident" id="3371519">MatchString</span><span class="op" id="3371530">(</span><span class="ident" id="3371531">s</span><span class="op" id="3371532">)</span><span class="op" id="3371533">,</span>&nbsp;<span class="ident" id="3371535">nil</span><br>
<span class="lineno"></span><span class="op" id="3371539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="comment" id="3371542">//&nbsp;Match&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="3371595">//&nbsp;matches&nbsp;a&nbsp;byte&nbsp;slice.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="3371651">//&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3371700">func</span>&nbsp;<span class="ident" id="3371705">Match</span><span class="op" id="3371710">(</span><span class="ident" id="3371711">pattern</span>&nbsp;<span class="builtintype" id="3371719">string</span><span class="op" id="3371725">,</span>&nbsp;<span class="ident" id="3371727">b</span>&nbsp;<span class="op" id="3371729">[</span><span class="op" id="3371730">]</span><span class="builtintype" id="3371731">byte</span><span class="op" id="3371735">)</span>&nbsp;<span class="op" id="3371737">(</span><span class="ident" id="3371738">matched</span>&nbsp;<span class="builtintype" id="3371746">bool</span><span class="op" id="3371750">,</span>&nbsp;<span class="ident" id="3371752">err</span>&nbsp;<span class="builtintype" id="3371756">error</span><span class="op" id="3371761">)</span>&nbsp;<span class="op" id="3371763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371766">re</span><span class="op" id="3371768">,</span>&nbsp;<span class="ident" id="3371770">err</span>&nbsp;<span class="op" id="3371774">:=</span>&nbsp;<span class="ident" id="3371777">Compile</span><span class="op" id="3371784">(</span><span class="ident" id="3371785">pattern</span><span class="op" id="3371792">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371795">if</span>&nbsp;<span class="ident" id="3371798">err</span>&nbsp;<span class="op" id="3371802">!=</span>&nbsp;<span class="ident" id="3371805">nil</span>&nbsp;<span class="op" id="3371809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371813">return</span>&nbsp;<span class="builtintype" id="3371820">false</span><span class="op" id="3371825">,</span>&nbsp;<span class="ident" id="3371827">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371835">return</span>&nbsp;<span class="ident" id="3371842">re</span><span class="op" id="3371844">.</span><span class="ident" id="3371845">Match</span><span class="op" id="3371850">(</span><span class="ident" id="3371851">b</span><span class="op" id="3371852">)</span><span class="op" id="3371853">,</span>&nbsp;<span class="ident" id="3371855">nil</span><br>
<span class="lineno"></span><span class="op" id="3371859">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="3371862">//&nbsp;ReplaceAllString&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="3371937">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;string&nbsp;repl.&nbsp;&nbsp;Inside&nbsp;repl,&nbsp;$&nbsp;signs&nbsp;are&nbsp;interpreted&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3372015">//&nbsp;in&nbsp;Expand,&nbsp;so&nbsp;for&nbsp;instance&nbsp;$1&nbsp;represents&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;submatch.</span><br>
<span class="lineno"></span><span class="keyword" id="3372091">func</span>&nbsp;<span class="op" id="3372096">(</span><span class="ident" id="3372097">re</span>&nbsp;<span class="op" id="3372100">*</span><span class="ident" id="3372101">Regexp</span><span class="op" id="3372107">)</span>&nbsp;<span class="ident" id="3372109">ReplaceAllString</span><span class="op" id="3372125">(</span><span class="ident" id="3372126">src</span><span class="op" id="3372129">,</span>&nbsp;<span class="ident" id="3372131">repl</span>&nbsp;<span class="builtintype" id="3372136">string</span><span class="op" id="3372142">)</span>&nbsp;<span class="builtintype" id="3372144">string</span>&nbsp;<span class="op" id="3372151">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372154">n</span>&nbsp;<span class="op" id="3372156">:=</span>&nbsp;<span class="num" id="3372159">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372162">if</span>&nbsp;<span class="ident" id="3372165">strings</span><span class="op" id="3372172">.</span><span class="ident" id="3372173">Index</span><span class="op" id="3372178">(</span><span class="ident" id="3372179">repl</span><span class="op" id="3372183">,</span>&nbsp;<span class="string" id="3372185">&#34;$&#34;</span><span class="op" id="3372188">)</span>&nbsp;<span class="op" id="3372190">&gt;=</span>&nbsp;<span class="num" id="3372193">0</span>&nbsp;<span class="op" id="3372195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372199">n</span>&nbsp;<span class="op" id="3372201">=</span>&nbsp;<span class="num" id="3372203">2</span>&nbsp;<span class="op" id="3372205">*</span>&nbsp;<span class="op" id="3372207">(</span><span class="ident" id="3372208">re</span><span class="op" id="3372210">.</span><span class="ident" id="3372211">numSubexp</span>&nbsp;<span class="op" id="3372221">+</span>&nbsp;<span class="num" id="3372223">1</span><span class="op" id="3372224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3372227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372230">b</span>&nbsp;<span class="op" id="3372232">:=</span>&nbsp;<span class="ident" id="3372235">re</span><span class="op" id="3372237">.</span><span class="ident" id="3372238">replaceAll</span><span class="op" id="3372248">(</span><span class="ident" id="3372249">nil</span><span class="op" id="3372252">,</span>&nbsp;<span class="ident" id="3372254">src</span><span class="op" id="3372257">,</span>&nbsp;<span class="ident" id="3372259">n</span><span class="op" id="3372260">,</span>&nbsp;<span class="keyword" id="3372262">func</span><span class="op" id="3372266">(</span><span class="ident" id="3372267">dst</span>&nbsp;<span class="op" id="3372271">[</span><span class="op" id="3372272">]</span><span class="builtintype" id="3372273">byte</span><span class="op" id="3372277">,</span>&nbsp;<span class="ident" id="3372279">match</span>&nbsp;<span class="op" id="3372285">[</span><span class="op" id="3372286">]</span><span class="builtintype" id="3372287">int</span><span class="op" id="3372290">)</span>&nbsp;<span class="op" id="3372292">[</span><span class="op" id="3372293">]</span><span class="builtintype" id="3372294">byte</span>&nbsp;<span class="op" id="3372299">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372303">return</span>&nbsp;<span class="ident" id="3372310">re</span><span class="op" id="3372312">.</span><span class="ident" id="3372313">expand</span><span class="op" id="3372319">(</span><span class="ident" id="3372320">dst</span><span class="op" id="3372323">,</span>&nbsp;<span class="ident" id="3372325">repl</span><span class="op" id="3372329">,</span>&nbsp;<span class="ident" id="3372331">nil</span><span class="op" id="3372334">,</span>&nbsp;<span class="ident" id="3372336">src</span><span class="op" id="3372339">,</span>&nbsp;<span class="ident" id="3372341">match</span><span class="op" id="3372346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3372349">}</span><span class="op" id="3372350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372353">return</span>&nbsp;<span class="builtintype" id="3372360">string</span><span class="op" id="3372366">(</span><span class="ident" id="3372367">b</span><span class="op" id="3372368">)</span><br>
<span class="lineno"></span><span class="op" id="3372370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="3372373">//&nbsp;ReplaceAllLiteralString&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="3372455">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;string&nbsp;repl.&nbsp;&nbsp;The&nbsp;replacement&nbsp;repl&nbsp;is&nbsp;substituted&nbsp;directly,</span><br>
<span class="lineno"></span><span class="comment" id="3372539">//&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="3372564">func</span>&nbsp;<span class="op" id="3372569">(</span><span class="ident" id="3372570">re</span>&nbsp;<span class="op" id="3372573">*</span><span class="ident" id="3372574">Regexp</span><span class="op" id="3372580">)</span>&nbsp;<span class="ident" id="3372582">ReplaceAllLiteralString</span><span class="op" id="3372605">(</span><span class="ident" id="3372606">src</span><span class="op" id="3372609">,</span>&nbsp;<span class="ident" id="3372611">repl</span>&nbsp;<span class="builtintype" id="3372616">string</span><span class="op" id="3372622">)</span>&nbsp;<span class="builtintype" id="3372624">string</span>&nbsp;<span class="op" id="3372631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372634">return</span>&nbsp;<span class="builtintype" id="3372641">string</span><span class="op" id="3372647">(</span><span class="ident" id="3372648">re</span><span class="op" id="3372650">.</span><span class="ident" id="3372651">replaceAll</span><span class="op" id="3372661">(</span><span class="ident" id="3372662">nil</span><span class="op" id="3372665">,</span>&nbsp;<span class="ident" id="3372667">src</span><span class="op" id="3372670">,</span>&nbsp;<span class="num" id="3372672">2</span><span class="op" id="3372673">,</span>&nbsp;<span class="keyword" id="3372675">func</span><span class="op" id="3372679">(</span><span class="ident" id="3372680">dst</span>&nbsp;<span class="op" id="3372684">[</span><span class="op" id="3372685">]</span><span class="builtintype" id="3372686">byte</span><span class="op" id="3372690">,</span>&nbsp;<span class="ident" id="3372692">match</span>&nbsp;<span class="op" id="3372698">[</span><span class="op" id="3372699">]</span><span class="builtintype" id="3372700">int</span><span class="op" id="3372703">)</span>&nbsp;<span class="op" id="3372705">[</span><span class="op" id="3372706">]</span><span class="builtintype" id="3372707">byte</span>&nbsp;<span class="op" id="3372712">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372716">return</span>&nbsp;<span class="builtinfunc" id="3372723">append</span><span class="op" id="3372729">(</span><span class="ident" id="3372730">dst</span><span class="op" id="3372733">,</span>&nbsp;<span class="ident" id="3372735">repl</span><span class="op" id="3372739">...</span><span class="op" id="3372742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3372745">}</span><span class="op" id="3372746">)</span><span class="op" id="3372747">)</span><br>
<span class="lineno"></span><span class="op" id="3372749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3372752">//&nbsp;ReplaceAllStringFunc&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src&nbsp;in&nbsp;which&nbsp;all&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno">465</span><span class="comment" id="3372826">//&nbsp;Regexp&nbsp;have&nbsp;been&nbsp;replaced&nbsp;by&nbsp;the&nbsp;return&nbsp;value&nbsp;of&nbsp;function&nbsp;repl&nbsp;applied</span><br>
<span class="lineno"></span><span class="comment" id="3372900">//&nbsp;to&nbsp;the&nbsp;matched&nbsp;substring.&nbsp;&nbsp;The&nbsp;replacement&nbsp;returned&nbsp;by&nbsp;repl&nbsp;is&nbsp;substituted</span><br>
<span class="lineno"></span><span class="comment" id="3372978">//&nbsp;directly,&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="3373013">func</span>&nbsp;<span class="op" id="3373018">(</span><span class="ident" id="3373019">re</span>&nbsp;<span class="op" id="3373022">*</span><span class="ident" id="3373023">Regexp</span><span class="op" id="3373029">)</span>&nbsp;<span class="ident" id="3373031">ReplaceAllStringFunc</span><span class="op" id="3373051">(</span><span class="ident" id="3373052">src</span>&nbsp;<span class="builtintype" id="3373056">string</span><span class="op" id="3373062">,</span>&nbsp;<span class="ident" id="3373064">repl</span>&nbsp;<span class="keyword" id="3373069">func</span><span class="op" id="3373073">(</span><span class="builtintype" id="3373074">string</span><span class="op" id="3373080">)</span>&nbsp;<span class="builtintype" id="3373082">string</span><span class="op" id="3373088">)</span>&nbsp;<span class="builtintype" id="3373090">string</span>&nbsp;<span class="op" id="3373097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373100">b</span>&nbsp;<span class="op" id="3373102">:=</span>&nbsp;<span class="ident" id="3373105">re</span><span class="op" id="3373107">.</span><span class="ident" id="3373108">replaceAll</span><span class="op" id="3373118">(</span><span class="ident" id="3373119">nil</span><span class="op" id="3373122">,</span>&nbsp;<span class="ident" id="3373124">src</span><span class="op" id="3373127">,</span>&nbsp;<span class="num" id="3373129">2</span><span class="op" id="3373130">,</span>&nbsp;<span class="keyword" id="3373132">func</span><span class="op" id="3373136">(</span><span class="ident" id="3373137">dst</span>&nbsp;<span class="op" id="3373141">[</span><span class="op" id="3373142">]</span><span class="builtintype" id="3373143">byte</span><span class="op" id="3373147">,</span>&nbsp;<span class="ident" id="3373149">match</span>&nbsp;<span class="op" id="3373155">[</span><span class="op" id="3373156">]</span><span class="builtintype" id="3373157">int</span><span class="op" id="3373160">)</span>&nbsp;<span class="op" id="3373162">[</span><span class="op" id="3373163">]</span><span class="builtintype" id="3373164">byte</span>&nbsp;<span class="op" id="3373169">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373173">return</span>&nbsp;<span class="builtinfunc" id="3373180">append</span><span class="op" id="3373186">(</span><span class="ident" id="3373187">dst</span><span class="op" id="3373190">,</span>&nbsp;<span class="ident" id="3373192">repl</span><span class="op" id="3373196">(</span><span class="ident" id="3373197">src</span><span class="op" id="3373200">[</span><span class="ident" id="3373201">match</span><span class="op" id="3373206">[</span><span class="num" id="3373207">0</span><span class="op" id="3373208">]</span><span class="op" id="3373209">:</span><span class="ident" id="3373210">match</span><span class="op" id="3373215">[</span><span class="num" id="3373216">1</span><span class="op" id="3373217">]</span><span class="op" id="3373218">]</span><span class="op" id="3373219">)</span><span class="op" id="3373220">...</span><span class="op" id="3373223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373226">}</span><span class="op" id="3373227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373230">return</span>&nbsp;<span class="builtintype" id="3373237">string</span><span class="op" id="3373243">(</span><span class="ident" id="3373244">b</span><span class="op" id="3373245">)</span><br>
<span class="lineno"></span><span class="op" id="3373247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span><span class="keyword" id="3373250">func</span>&nbsp;<span class="op" id="3373255">(</span><span class="ident" id="3373256">re</span>&nbsp;<span class="op" id="3373259">*</span><span class="ident" id="3373260">Regexp</span><span class="op" id="3373266">)</span>&nbsp;<span class="ident" id="3373268">replaceAll</span><span class="op" id="3373278">(</span><span class="ident" id="3373279">bsrc</span>&nbsp;<span class="op" id="3373284">[</span><span class="op" id="3373285">]</span><span class="builtintype" id="3373286">byte</span><span class="op" id="3373290">,</span>&nbsp;<span class="ident" id="3373292">src</span>&nbsp;<span class="builtintype" id="3373296">string</span><span class="op" id="3373302">,</span>&nbsp;<span class="ident" id="3373304">nmatch</span>&nbsp;<span class="builtintype" id="3373311">int</span><span class="op" id="3373314">,</span>&nbsp;<span class="ident" id="3373316">repl</span>&nbsp;<span class="keyword" id="3373321">func</span><span class="op" id="3373325">(</span><span class="ident" id="3373326">dst</span>&nbsp;<span class="op" id="3373330">[</span><span class="op" id="3373331">]</span><span class="builtintype" id="3373332">byte</span><span class="op" id="3373336">,</span>&nbsp;<span class="ident" id="3373338">m</span>&nbsp;<span class="op" id="3373340">[</span><span class="op" id="3373341">]</span><span class="builtintype" id="3373342">int</span><span class="op" id="3373345">)</span>&nbsp;<span class="op" id="3373347">[</span><span class="op" id="3373348">]</span><span class="builtintype" id="3373349">byte</span><span class="op" id="3373353">)</span>&nbsp;<span class="op" id="3373355">[</span><span class="op" id="3373356">]</span><span class="builtintype" id="3373357">byte</span>&nbsp;<span class="op" id="3373362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373365">lastMatchEnd</span>&nbsp;<span class="op" id="3373378">:=</span>&nbsp;<span class="num" id="3373381">0</span>&nbsp;<span class="comment" id="3373383">//&nbsp;end&nbsp;position&nbsp;of&nbsp;the&nbsp;most&nbsp;recent&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373425">searchPos</span>&nbsp;<span class="op" id="3373435">:=</span>&nbsp;<span class="num" id="3373438">0</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3373443">//&nbsp;position&nbsp;where&nbsp;we&nbsp;next&nbsp;look&nbsp;for&nbsp;a&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373487">var</span>&nbsp;<span class="ident" id="3373491">buf</span>&nbsp;<span class="op" id="3373495">[</span><span class="op" id="3373496">]</span><span class="builtintype" id="3373497">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373503">var</span>&nbsp;<span class="ident" id="3373507">endPos</span>&nbsp;<span class="builtintype" id="3373514">int</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373519">if</span>&nbsp;<span class="ident" id="3373522">bsrc</span>&nbsp;<span class="op" id="3373527">!=</span>&nbsp;<span class="ident" id="3373530">nil</span>&nbsp;<span class="op" id="3373534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373538">endPos</span>&nbsp;<span class="op" id="3373545">=</span>&nbsp;<span class="builtinfunc" id="3373547">len</span><span class="op" id="3373550">(</span><span class="ident" id="3373551">bsrc</span><span class="op" id="3373555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373558">}</span>&nbsp;<span class="keyword" id="3373560">else</span>&nbsp;<span class="op" id="3373565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373569">endPos</span>&nbsp;<span class="op" id="3373576">=</span>&nbsp;<span class="builtinfunc" id="3373578">len</span><span class="op" id="3373581">(</span><span class="ident" id="3373582">src</span><span class="op" id="3373585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373588">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373591">for</span>&nbsp;<span class="ident" id="3373595">searchPos</span>&nbsp;<span class="op" id="3373605">&lt;=</span>&nbsp;<span class="ident" id="3373608">endPos</span>&nbsp;<span class="op" id="3373615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373619">a</span>&nbsp;<span class="op" id="3373621">:=</span>&nbsp;<span class="ident" id="3373624">re</span><span class="op" id="3373626">.</span><span class="ident" id="3373627">doExecute</span><span class="op" id="3373636">(</span><span class="ident" id="3373637">nil</span><span class="op" id="3373640">,</span>&nbsp;<span class="ident" id="3373642">bsrc</span><span class="op" id="3373646">,</span>&nbsp;<span class="ident" id="3373648">src</span><span class="op" id="3373651">,</span>&nbsp;<span class="ident" id="3373653">searchPos</span><span class="op" id="3373662">,</span>&nbsp;<span class="ident" id="3373664">nmatch</span><span class="op" id="3373670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373674">if</span>&nbsp;<span class="builtinfunc" id="3373677">len</span><span class="op" id="3373680">(</span><span class="ident" id="3373681">a</span><span class="op" id="3373682">)</span>&nbsp;<span class="op" id="3373684">==</span>&nbsp;<span class="num" id="3373687">0</span>&nbsp;<span class="op" id="3373689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373694">break</span>&nbsp;<span class="comment" id="3373700">//&nbsp;no&nbsp;more&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373721">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3373726">//&nbsp;Copy&nbsp;the&nbsp;unmatched&nbsp;characters&nbsp;before&nbsp;this&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373780">if</span>&nbsp;<span class="ident" id="3373783">bsrc</span>&nbsp;<span class="op" id="3373788">!=</span>&nbsp;<span class="ident" id="3373791">nil</span>&nbsp;<span class="op" id="3373795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373800">buf</span>&nbsp;<span class="op" id="3373804">=</span>&nbsp;<span class="builtinfunc" id="3373806">append</span><span class="op" id="3373812">(</span><span class="ident" id="3373813">buf</span><span class="op" id="3373816">,</span>&nbsp;<span class="ident" id="3373818">bsrc</span><span class="op" id="3373822">[</span><span class="ident" id="3373823">lastMatchEnd</span><span class="op" id="3373835">:</span><span class="ident" id="3373836">a</span><span class="op" id="3373837">[</span><span class="num" id="3373838">0</span><span class="op" id="3373839">]</span><span class="op" id="3373840">]</span><span class="op" id="3373841">...</span><span class="op" id="3373844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373848">}</span>&nbsp;<span class="keyword" id="3373850">else</span>&nbsp;<span class="op" id="3373855">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373860">buf</span>&nbsp;<span class="op" id="3373864">=</span>&nbsp;<span class="builtinfunc" id="3373866">append</span><span class="op" id="3373872">(</span><span class="ident" id="3373873">buf</span><span class="op" id="3373876">,</span>&nbsp;<span class="ident" id="3373878">src</span><span class="op" id="3373881">[</span><span class="ident" id="3373882">lastMatchEnd</span><span class="op" id="3373894">:</span><span class="ident" id="3373895">a</span><span class="op" id="3373896">[</span><span class="num" id="3373897">0</span><span class="op" id="3373898">]</span><span class="op" id="3373899">]</span><span class="op" id="3373900">...</span><span class="op" id="3373903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3373912">//&nbsp;Now&nbsp;insert&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;replacement&nbsp;string,&nbsp;but&nbsp;not&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3373976">//&nbsp;match&nbsp;of&nbsp;the&nbsp;empty&nbsp;string&nbsp;immediately&nbsp;after&nbsp;another&nbsp;match.</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374040">//&nbsp;(Otherwise,&nbsp;we&nbsp;get&nbsp;double&nbsp;replacement&nbsp;for&nbsp;patterns&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374101">//&nbsp;match&nbsp;both&nbsp;empty&nbsp;and&nbsp;nonempty&nbsp;strings.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374146">if</span>&nbsp;<span class="ident" id="3374149">a</span><span class="op" id="3374150">[</span><span class="num" id="3374151">1</span><span class="op" id="3374152">]</span>&nbsp;<span class="op" id="3374154">&gt;</span>&nbsp;<span class="ident" id="3374156">lastMatchEnd</span>&nbsp;<span class="op" id="3374169">||</span>&nbsp;<span class="ident" id="3374172">a</span><span class="op" id="3374173">[</span><span class="num" id="3374174">0</span><span class="op" id="3374175">]</span>&nbsp;<span class="op" id="3374177">==</span>&nbsp;<span class="num" id="3374180">0</span>&nbsp;<span class="op" id="3374182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374187">buf</span>&nbsp;<span class="op" id="3374191">=</span>&nbsp;<span class="ident" id="3374193">repl</span><span class="op" id="3374197">(</span><span class="ident" id="3374198">buf</span><span class="op" id="3374201">,</span>&nbsp;<span class="ident" id="3374203">a</span><span class="op" id="3374204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374208">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374212">lastMatchEnd</span>&nbsp;<span class="op" id="3374225">=</span>&nbsp;<span class="ident" id="3374227">a</span><span class="op" id="3374228">[</span><span class="num" id="3374229">1</span><span class="op" id="3374230">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374235">//&nbsp;Advance&nbsp;past&nbsp;this&nbsp;match;&nbsp;always&nbsp;advance&nbsp;at&nbsp;least&nbsp;one&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374304">var</span>&nbsp;<span class="ident" id="3374308">width</span>&nbsp;<span class="builtintype" id="3374314">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374320">if</span>&nbsp;<span class="ident" id="3374323">bsrc</span>&nbsp;<span class="op" id="3374328">!=</span>&nbsp;<span class="ident" id="3374331">nil</span>&nbsp;<span class="op" id="3374335">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374340">_</span><span class="op" id="3374341">,</span>&nbsp;<span class="ident" id="3374343">width</span>&nbsp;<span class="op" id="3374349">=</span>&nbsp;<span class="ident" id="3374351">utf8</span><span class="op" id="3374355">.</span><span class="ident" id="3374356">DecodeRune</span><span class="op" id="3374366">(</span><span class="ident" id="3374367">bsrc</span><span class="op" id="3374371">[</span><span class="ident" id="3374372">searchPos</span><span class="op" id="3374381">:</span><span class="op" id="3374382">]</span><span class="op" id="3374383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374387">}</span>&nbsp;<span class="keyword" id="3374389">else</span>&nbsp;<span class="op" id="3374394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374399">_</span><span class="op" id="3374400">,</span>&nbsp;<span class="ident" id="3374402">width</span>&nbsp;<span class="op" id="3374408">=</span>&nbsp;<span class="ident" id="3374410">utf8</span><span class="op" id="3374414">.</span><span class="ident" id="3374415">DecodeRuneInString</span><span class="op" id="3374433">(</span><span class="ident" id="3374434">src</span><span class="op" id="3374437">[</span><span class="ident" id="3374438">searchPos</span><span class="op" id="3374447">:</span><span class="op" id="3374448">]</span><span class="op" id="3374449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374457">if</span>&nbsp;<span class="ident" id="3374460">searchPos</span><span class="op" id="3374469">+</span><span class="ident" id="3374470">width</span>&nbsp;<span class="op" id="3374476">&gt;</span>&nbsp;<span class="ident" id="3374478">a</span><span class="op" id="3374479">[</span><span class="num" id="3374480">1</span><span class="op" id="3374481">]</span>&nbsp;<span class="op" id="3374483">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374488">searchPos</span>&nbsp;<span class="op" id="3374498">+=</span>&nbsp;<span class="ident" id="3374501">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374509">}</span>&nbsp;<span class="keyword" id="3374511">else</span>&nbsp;<span class="keyword" id="3374516">if</span>&nbsp;<span class="ident" id="3374519">searchPos</span><span class="op" id="3374528">+</span><span class="num" id="3374529">1</span>&nbsp;<span class="op" id="3374531">&gt;</span>&nbsp;<span class="ident" id="3374533">a</span><span class="op" id="3374534">[</span><span class="num" id="3374535">1</span><span class="op" id="3374536">]</span>&nbsp;<span class="op" id="3374538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374543">//&nbsp;This&nbsp;clause&nbsp;is&nbsp;only&nbsp;needed&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374600">//&nbsp;string.&nbsp;&nbsp;In&nbsp;that&nbsp;case,&nbsp;DecodeRuneInString&nbsp;returns&nbsp;width=0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374665">searchPos</span><span class="op" id="3374674">++</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374679">}</span>&nbsp;<span class="keyword" id="3374681">else</span>&nbsp;<span class="op" id="3374686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374691">searchPos</span>&nbsp;<span class="op" id="3374701">=</span>&nbsp;<span class="ident" id="3374703">a</span><span class="op" id="3374704">[</span><span class="num" id="3374705">1</span><span class="op" id="3374706">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374717">//&nbsp;Copy&nbsp;the&nbsp;unmatched&nbsp;characters&nbsp;after&nbsp;the&nbsp;last&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374773">if</span>&nbsp;<span class="ident" id="3374776">bsrc</span>&nbsp;<span class="op" id="3374781">!=</span>&nbsp;<span class="ident" id="3374784">nil</span>&nbsp;<span class="op" id="3374788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374792">buf</span>&nbsp;<span class="op" id="3374796">=</span>&nbsp;<span class="builtinfunc" id="3374798">append</span><span class="op" id="3374804">(</span><span class="ident" id="3374805">buf</span><span class="op" id="3374808">,</span>&nbsp;<span class="ident" id="3374810">bsrc</span><span class="op" id="3374814">[</span><span class="ident" id="3374815">lastMatchEnd</span><span class="op" id="3374827">:</span><span class="op" id="3374828">]</span><span class="op" id="3374829">...</span><span class="op" id="3374832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374835">}</span>&nbsp;<span class="keyword" id="3374837">else</span>&nbsp;<span class="op" id="3374842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374846">buf</span>&nbsp;<span class="op" id="3374850">=</span>&nbsp;<span class="builtinfunc" id="3374852">append</span><span class="op" id="3374858">(</span><span class="ident" id="3374859">buf</span><span class="op" id="3374862">,</span>&nbsp;<span class="ident" id="3374864">src</span><span class="op" id="3374867">[</span><span class="ident" id="3374868">lastMatchEnd</span><span class="op" id="3374880">:</span><span class="op" id="3374881">]</span><span class="op" id="3374882">...</span><span class="op" id="3374885">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374892">return</span>&nbsp;<span class="ident" id="3374899">buf</span><br>
<span class="lineno"></span><span class="op" id="3374903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3374906">//&nbsp;ReplaceAll&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="3374975">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;text&nbsp;repl.&nbsp;&nbsp;Inside&nbsp;repl,&nbsp;$&nbsp;signs&nbsp;are&nbsp;interpreted&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3375051">//&nbsp;in&nbsp;Expand,&nbsp;so&nbsp;for&nbsp;instance&nbsp;$1&nbsp;represents&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;submatch.</span><br>
<span class="lineno"></span><span class="keyword" id="3375127">func</span>&nbsp;<span class="op" id="3375132">(</span><span class="ident" id="3375133">re</span>&nbsp;<span class="op" id="3375136">*</span><span class="ident" id="3375137">Regexp</span><span class="op" id="3375143">)</span>&nbsp;<span class="ident" id="3375145">ReplaceAll</span><span class="op" id="3375155">(</span><span class="ident" id="3375156">src</span><span class="op" id="3375159">,</span>&nbsp;<span class="ident" id="3375161">repl</span>&nbsp;<span class="op" id="3375166">[</span><span class="op" id="3375167">]</span><span class="builtintype" id="3375168">byte</span><span class="op" id="3375172">)</span>&nbsp;<span class="op" id="3375174">[</span><span class="op" id="3375175">]</span><span class="builtintype" id="3375176">byte</span>&nbsp;<span class="op" id="3375181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375184">n</span>&nbsp;<span class="op" id="3375186">:=</span>&nbsp;<span class="num" id="3375189">2</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375192">if</span>&nbsp;<span class="ident" id="3375195">bytes</span><span class="op" id="3375200">.</span><span class="ident" id="3375201">IndexByte</span><span class="op" id="3375210">(</span><span class="ident" id="3375211">repl</span><span class="op" id="3375215">,</span>&nbsp;<span class="string" id="3375217">&#39;$&#39;</span><span class="op" id="3375220">)</span>&nbsp;<span class="op" id="3375222">&gt;=</span>&nbsp;<span class="num" id="3375225">0</span>&nbsp;<span class="op" id="3375227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375231">n</span>&nbsp;<span class="op" id="3375233">=</span>&nbsp;<span class="num" id="3375235">2</span>&nbsp;<span class="op" id="3375237">*</span>&nbsp;<span class="op" id="3375239">(</span><span class="ident" id="3375240">re</span><span class="op" id="3375242">.</span><span class="ident" id="3375243">numSubexp</span>&nbsp;<span class="op" id="3375253">+</span>&nbsp;<span class="num" id="3375255">1</span><span class="op" id="3375256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375262">srepl</span>&nbsp;<span class="op" id="3375268">:=</span>&nbsp;<span class="string" id="3375271">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375275">b</span>&nbsp;<span class="op" id="3375277">:=</span>&nbsp;<span class="ident" id="3375280">re</span><span class="op" id="3375282">.</span><span class="ident" id="3375283">replaceAll</span><span class="op" id="3375293">(</span><span class="ident" id="3375294">src</span><span class="op" id="3375297">,</span>&nbsp;<span class="string" id="3375299">&#34;&#34;</span><span class="op" id="3375301">,</span>&nbsp;<span class="ident" id="3375303">n</span><span class="op" id="3375304">,</span>&nbsp;<span class="keyword" id="3375306">func</span><span class="op" id="3375310">(</span><span class="ident" id="3375311">dst</span>&nbsp;<span class="op" id="3375315">[</span><span class="op" id="3375316">]</span><span class="builtintype" id="3375317">byte</span><span class="op" id="3375321">,</span>&nbsp;<span class="ident" id="3375323">match</span>&nbsp;<span class="op" id="3375329">[</span><span class="op" id="3375330">]</span><span class="builtintype" id="3375331">int</span><span class="op" id="3375334">)</span>&nbsp;<span class="op" id="3375336">[</span><span class="op" id="3375337">]</span><span class="builtintype" id="3375338">byte</span>&nbsp;<span class="op" id="3375343">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375347">if</span>&nbsp;<span class="builtinfunc" id="3375350">len</span><span class="op" id="3375353">(</span><span class="ident" id="3375354">srepl</span><span class="op" id="3375359">)</span>&nbsp;<span class="op" id="3375361">!=</span>&nbsp;<span class="builtinfunc" id="3375364">len</span><span class="op" id="3375367">(</span><span class="ident" id="3375368">repl</span><span class="op" id="3375372">)</span>&nbsp;<span class="op" id="3375374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375379">srepl</span>&nbsp;<span class="op" id="3375385">=</span>&nbsp;<span class="builtintype" id="3375387">string</span><span class="op" id="3375393">(</span><span class="ident" id="3375394">repl</span><span class="op" id="3375398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375406">return</span>&nbsp;<span class="ident" id="3375413">re</span><span class="op" id="3375415">.</span><span class="ident" id="3375416">expand</span><span class="op" id="3375422">(</span><span class="ident" id="3375423">dst</span><span class="op" id="3375426">,</span>&nbsp;<span class="ident" id="3375428">srepl</span><span class="op" id="3375433">,</span>&nbsp;<span class="ident" id="3375435">src</span><span class="op" id="3375438">,</span>&nbsp;<span class="string" id="3375440">&#34;&#34;</span><span class="op" id="3375442">,</span>&nbsp;<span class="ident" id="3375444">match</span><span class="op" id="3375449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375452">}</span><span class="op" id="3375453">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375456">return</span>&nbsp;<span class="ident" id="3375463">b</span><br>
<span class="lineno"></span><span class="op" id="3375465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3375468">//&nbsp;ReplaceAllLiteral&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="3375544">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;bytes&nbsp;repl.&nbsp;&nbsp;The&nbsp;replacement&nbsp;repl&nbsp;is&nbsp;substituted&nbsp;directly,</span><br>
<span class="lineno">555</span><span class="comment" id="3375627">//&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="3375652">func</span>&nbsp;<span class="op" id="3375657">(</span><span class="ident" id="3375658">re</span>&nbsp;<span class="op" id="3375661">*</span><span class="ident" id="3375662">Regexp</span><span class="op" id="3375668">)</span>&nbsp;<span class="ident" id="3375670">ReplaceAllLiteral</span><span class="op" id="3375687">(</span><span class="ident" id="3375688">src</span><span class="op" id="3375691">,</span>&nbsp;<span class="ident" id="3375693">repl</span>&nbsp;<span class="op" id="3375698">[</span><span class="op" id="3375699">]</span><span class="builtintype" id="3375700">byte</span><span class="op" id="3375704">)</span>&nbsp;<span class="op" id="3375706">[</span><span class="op" id="3375707">]</span><span class="builtintype" id="3375708">byte</span>&nbsp;<span class="op" id="3375713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375716">return</span>&nbsp;<span class="ident" id="3375723">re</span><span class="op" id="3375725">.</span><span class="ident" id="3375726">replaceAll</span><span class="op" id="3375736">(</span><span class="ident" id="3375737">src</span><span class="op" id="3375740">,</span>&nbsp;<span class="string" id="3375742">&#34;&#34;</span><span class="op" id="3375744">,</span>&nbsp;<span class="num" id="3375746">2</span><span class="op" id="3375747">,</span>&nbsp;<span class="keyword" id="3375749">func</span><span class="op" id="3375753">(</span><span class="ident" id="3375754">dst</span>&nbsp;<span class="op" id="3375758">[</span><span class="op" id="3375759">]</span><span class="builtintype" id="3375760">byte</span><span class="op" id="3375764">,</span>&nbsp;<span class="ident" id="3375766">match</span>&nbsp;<span class="op" id="3375772">[</span><span class="op" id="3375773">]</span><span class="builtintype" id="3375774">int</span><span class="op" id="3375777">)</span>&nbsp;<span class="op" id="3375779">[</span><span class="op" id="3375780">]</span><span class="builtintype" id="3375781">byte</span>&nbsp;<span class="op" id="3375786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375790">return</span>&nbsp;<span class="builtinfunc" id="3375797">append</span><span class="op" id="3375803">(</span><span class="ident" id="3375804">dst</span><span class="op" id="3375807">,</span>&nbsp;<span class="ident" id="3375809">repl</span><span class="op" id="3375813">...</span><span class="op" id="3375816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375819">}</span><span class="op" id="3375820">)</span><br>
<span class="lineno">560</span><span class="op" id="3375822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3375825">//&nbsp;ReplaceAllFunc&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src&nbsp;in&nbsp;which&nbsp;all&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3375893">//&nbsp;Regexp&nbsp;have&nbsp;been&nbsp;replaced&nbsp;by&nbsp;the&nbsp;return&nbsp;value&nbsp;of&nbsp;function&nbsp;repl&nbsp;applied</span><br>
<span class="lineno"></span><span class="comment" id="3375967">//&nbsp;to&nbsp;the&nbsp;matched&nbsp;byte&nbsp;slice.&nbsp;&nbsp;The&nbsp;replacement&nbsp;returned&nbsp;by&nbsp;repl&nbsp;is&nbsp;substituted</span><br>
<span class="lineno">565</span><span class="comment" id="3376046">//&nbsp;directly,&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="3376081">func</span>&nbsp;<span class="op" id="3376086">(</span><span class="ident" id="3376087">re</span>&nbsp;<span class="op" id="3376090">*</span><span class="ident" id="3376091">Regexp</span><span class="op" id="3376097">)</span>&nbsp;<span class="ident" id="3376099">ReplaceAllFunc</span><span class="op" id="3376113">(</span><span class="ident" id="3376114">src</span>&nbsp;<span class="op" id="3376118">[</span><span class="op" id="3376119">]</span><span class="builtintype" id="3376120">byte</span><span class="op" id="3376124">,</span>&nbsp;<span class="ident" id="3376126">repl</span>&nbsp;<span class="keyword" id="3376131">func</span><span class="op" id="3376135">(</span><span class="op" id="3376136">[</span><span class="op" id="3376137">]</span><span class="builtintype" id="3376138">byte</span><span class="op" id="3376142">)</span>&nbsp;<span class="op" id="3376144">[</span><span class="op" id="3376145">]</span><span class="builtintype" id="3376146">byte</span><span class="op" id="3376150">)</span>&nbsp;<span class="op" id="3376152">[</span><span class="op" id="3376153">]</span><span class="builtintype" id="3376154">byte</span>&nbsp;<span class="op" id="3376159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376162">return</span>&nbsp;<span class="ident" id="3376169">re</span><span class="op" id="3376171">.</span><span class="ident" id="3376172">replaceAll</span><span class="op" id="3376182">(</span><span class="ident" id="3376183">src</span><span class="op" id="3376186">,</span>&nbsp;<span class="string" id="3376188">&#34;&#34;</span><span class="op" id="3376190">,</span>&nbsp;<span class="num" id="3376192">2</span><span class="op" id="3376193">,</span>&nbsp;<span class="keyword" id="3376195">func</span><span class="op" id="3376199">(</span><span class="ident" id="3376200">dst</span>&nbsp;<span class="op" id="3376204">[</span><span class="op" id="3376205">]</span><span class="builtintype" id="3376206">byte</span><span class="op" id="3376210">,</span>&nbsp;<span class="ident" id="3376212">match</span>&nbsp;<span class="op" id="3376218">[</span><span class="op" id="3376219">]</span><span class="builtintype" id="3376220">int</span><span class="op" id="3376223">)</span>&nbsp;<span class="op" id="3376225">[</span><span class="op" id="3376226">]</span><span class="builtintype" id="3376227">byte</span>&nbsp;<span class="op" id="3376232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376236">return</span>&nbsp;<span class="builtinfunc" id="3376243">append</span><span class="op" id="3376249">(</span><span class="ident" id="3376250">dst</span><span class="op" id="3376253">,</span>&nbsp;<span class="ident" id="3376255">repl</span><span class="op" id="3376259">(</span><span class="ident" id="3376260">src</span><span class="op" id="3376263">[</span><span class="ident" id="3376264">match</span><span class="op" id="3376269">[</span><span class="num" id="3376270">0</span><span class="op" id="3376271">]</span><span class="op" id="3376272">:</span><span class="ident" id="3376273">match</span><span class="op" id="3376278">[</span><span class="num" id="3376279">1</span><span class="op" id="3376280">]</span><span class="op" id="3376281">]</span><span class="op" id="3376282">)</span><span class="op" id="3376283">...</span><span class="op" id="3376286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3376289">}</span><span class="op" id="3376290">)</span><br>
<span class="lineno">570</span><span class="op" id="3376292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3376295">var</span>&nbsp;<span class="ident" id="3376299">specialBytes</span>&nbsp;<span class="op" id="3376312">=</span>&nbsp;<span class="op" id="3376314">[</span><span class="op" id="3376315">]</span><span class="builtintype" id="3376316">byte</span><span class="op" id="3376320">(</span><span class="string" id="3376321">`\.+*?()|[]{}^$`</span><span class="op" id="3376337">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3376340">func</span>&nbsp;<span class="ident" id="3376345">special</span><span class="op" id="3376352">(</span><span class="ident" id="3376353">b</span>&nbsp;<span class="builtintype" id="3376355">byte</span><span class="op" id="3376359">)</span>&nbsp;<span class="builtintype" id="3376361">bool</span>&nbsp;<span class="op" id="3376366">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376369">return</span>&nbsp;<span class="ident" id="3376376">bytes</span><span class="op" id="3376381">.</span><span class="ident" id="3376382">IndexByte</span><span class="op" id="3376391">(</span><span class="ident" id="3376392">specialBytes</span><span class="op" id="3376404">,</span>&nbsp;<span class="ident" id="3376406">b</span><span class="op" id="3376407">)</span>&nbsp;<span class="op" id="3376409">&gt;=</span>&nbsp;<span class="num" id="3376412">0</span><br>
<span class="lineno"></span><span class="op" id="3376414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3376417">//&nbsp;QuoteMeta&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;quotes&nbsp;all&nbsp;regular&nbsp;expression&nbsp;metacharacters</span><br>
<span class="lineno"></span><span class="comment" id="3376497">//&nbsp;inside&nbsp;the&nbsp;argument&nbsp;text;&nbsp;the&nbsp;returned&nbsp;string&nbsp;is&nbsp;a&nbsp;regular&nbsp;expression&nbsp;matching</span><br>
<span class="lineno">580</span><span class="comment" id="3376579">//&nbsp;the&nbsp;literal&nbsp;text.&nbsp;&nbsp;For&nbsp;example,&nbsp;QuoteMeta(`[foo]`)&nbsp;returns&nbsp;`\[foo\]`.</span><br>
<span class="lineno"></span><span class="keyword" id="3376652">func</span>&nbsp;<span class="ident" id="3376657">QuoteMeta</span><span class="op" id="3376666">(</span><span class="ident" id="3376667">s</span>&nbsp;<span class="builtintype" id="3376669">string</span><span class="op" id="3376675">)</span>&nbsp;<span class="builtintype" id="3376677">string</span>&nbsp;<span class="op" id="3376684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376687">b</span>&nbsp;<span class="op" id="3376689">:=</span>&nbsp;<span class="builtinfunc" id="3376692">make</span><span class="op" id="3376696">(</span><span class="op" id="3376697">[</span><span class="op" id="3376698">]</span><span class="builtintype" id="3376699">byte</span><span class="op" id="3376703">,</span>&nbsp;<span class="num" id="3376705">2</span><span class="op" id="3376706">*</span><span class="builtinfunc" id="3376707">len</span><span class="op" id="3376710">(</span><span class="ident" id="3376711">s</span><span class="op" id="3376712">)</span><span class="op" id="3376713">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3376717">//&nbsp;A&nbsp;byte&nbsp;loop&nbsp;is&nbsp;correct&nbsp;because&nbsp;all&nbsp;metacharacters&nbsp;are&nbsp;ASCII.</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376782">j</span>&nbsp;<span class="op" id="3376784">:=</span>&nbsp;<span class="num" id="3376787">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376790">for</span>&nbsp;<span class="ident" id="3376794">i</span>&nbsp;<span class="op" id="3376796">:=</span>&nbsp;<span class="num" id="3376799">0</span><span class="op" id="3376800">;</span>&nbsp;<span class="ident" id="3376802">i</span>&nbsp;<span class="op" id="3376804">&lt;</span>&nbsp;<span class="builtinfunc" id="3376806">len</span><span class="op" id="3376809">(</span><span class="ident" id="3376810">s</span><span class="op" id="3376811">)</span><span class="op" id="3376812">;</span>&nbsp;<span class="ident" id="3376814">i</span><span class="op" id="3376815">++</span>&nbsp;<span class="op" id="3376818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376822">if</span>&nbsp;<span class="ident" id="3376825">special</span><span class="op" id="3376832">(</span><span class="ident" id="3376833">s</span><span class="op" id="3376834">[</span><span class="ident" id="3376835">i</span><span class="op" id="3376836">]</span><span class="op" id="3376837">)</span>&nbsp;<span class="op" id="3376839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376844">b</span><span class="op" id="3376845">[</span><span class="ident" id="3376846">j</span><span class="op" id="3376847">]</span>&nbsp;<span class="op" id="3376849">=</span>&nbsp;<span class="string" id="3376851">&#39;\\&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376859">j</span><span class="op" id="3376860">++</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3376865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376869">b</span><span class="op" id="3376870">[</span><span class="ident" id="3376871">j</span><span class="op" id="3376872">]</span>&nbsp;<span class="op" id="3376874">=</span>&nbsp;<span class="ident" id="3376876">s</span><span class="op" id="3376877">[</span><span class="ident" id="3376878">i</span><span class="op" id="3376879">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376883">j</span><span class="op" id="3376884">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3376888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376891">return</span>&nbsp;<span class="builtintype" id="3376898">string</span><span class="op" id="3376904">(</span><span class="ident" id="3376905">b</span><span class="op" id="3376906">[</span><span class="num" id="3376907">0</span><span class="op" id="3376908">:</span><span class="ident" id="3376909">j</span><span class="op" id="3376910">]</span><span class="op" id="3376911">)</span><br>
<span class="lineno">595</span><span class="op" id="3376913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3376916">//&nbsp;The&nbsp;number&nbsp;of&nbsp;capture&nbsp;values&nbsp;in&nbsp;the&nbsp;program&nbsp;may&nbsp;correspond</span><br>
<span class="lineno"></span><span class="comment" id="3376978">//&nbsp;to&nbsp;fewer&nbsp;capturing&nbsp;expressions&nbsp;than&nbsp;are&nbsp;in&nbsp;the&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="comment" id="3377036">//&nbsp;For&nbsp;example,&nbsp;&#34;(a){0}&#34;&nbsp;turns&nbsp;into&nbsp;an&nbsp;empty&nbsp;program,&nbsp;so&nbsp;the</span><br>
<span class="lineno">600</span><span class="comment" id="3377097">//&nbsp;maximum&nbsp;capture&nbsp;in&nbsp;the&nbsp;program&nbsp;is&nbsp;0&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="3377158">//&nbsp;an&nbsp;expression&nbsp;for&nbsp;\1.&nbsp;&nbsp;Pad&nbsp;appends&nbsp;-1s&nbsp;to&nbsp;the&nbsp;slice&nbsp;a&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="3377226">func</span>&nbsp;<span class="op" id="3377231">(</span><span class="ident" id="3377232">re</span>&nbsp;<span class="op" id="3377235">*</span><span class="ident" id="3377236">Regexp</span><span class="op" id="3377242">)</span>&nbsp;<span class="ident" id="3377244">pad</span><span class="op" id="3377247">(</span><span class="ident" id="3377248">a</span>&nbsp;<span class="op" id="3377250">[</span><span class="op" id="3377251">]</span><span class="builtintype" id="3377252">int</span><span class="op" id="3377255">)</span>&nbsp;<span class="op" id="3377257">[</span><span class="op" id="3377258">]</span><span class="builtintype" id="3377259">int</span>&nbsp;<span class="op" id="3377263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3377266">if</span>&nbsp;<span class="ident" id="3377269">a</span>&nbsp;<span class="op" id="3377271">==</span>&nbsp;<span class="ident" id="3377274">nil</span>&nbsp;<span class="op" id="3377278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3377282">//&nbsp;No&nbsp;match.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3377297">return</span>&nbsp;<span class="ident" id="3377304">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3377309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3377312">n</span>&nbsp;<span class="op" id="3377314">:=</span>&nbsp;<span class="op" id="3377317">(</span><span class="num" id="3377318">1</span>&nbsp;<span class="op" id="3377320">+</span>&nbsp;<span class="ident" id="3377322">re</span><span class="op" id="3377324">.</span><span class="ident" id="3377325">numSubexp</span><span class="op" id="3377334">)</span>&nbsp;<span class="op" id="3377336">*</span>&nbsp;<span class="num" id="3377338">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3377341">for</span>&nbsp;<span class="builtinfunc" id="3377345">len</span><span class="op" id="3377348">(</span><span class="ident" id="3377349">a</span><span class="op" id="3377350">)</span>&nbsp;<span class="op" id="3377352">&lt;</span>&nbsp;<span class="ident" id="3377354">n</span>&nbsp;<span class="op" id="3377356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3377360">a</span>&nbsp;<span class="op" id="3377362">=</span>&nbsp;<span class="builtinfunc" id="3377364">append</span><span class="op" id="3377370">(</span><span class="ident" id="3377371">a</span><span class="op" id="3377372">,</span>&nbsp;<span class="op" id="3377374">-</span><span class="num" id="3377375">1</span><span class="op" id="3377376">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3377379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3377382">return</span>&nbsp;<span class="ident" id="3377389">a</span><br>
<span class="lineno"></span><span class="op" id="3377391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3377394">//&nbsp;Find&nbsp;matches&nbsp;in&nbsp;slice&nbsp;b&nbsp;if&nbsp;b&nbsp;is&nbsp;non-nil,&nbsp;otherwise&nbsp;find&nbsp;matches&nbsp;in&nbsp;string&nbsp;s.</span><br>
<span class="lineno">615</span><span class="keyword" id="3377474">func</span>&nbsp;<span class="op" id="3377479">(</span><span class="ident" id="3377480">re</span>&nbsp;<span class="op" id="3377483">*</span><span class="ident" id="3377484">Regexp</span><span class="op" id="3377490">)</span>&nbsp;<span class="ident" id="3377492">allMatches</span><span class="op" id="3377502">(</span><span class="ident" id="3377503">s</span>&nbsp;<span class="builtintype" id="3377505">string</span><span class="op" id="3377511">,</span>&nbsp;<span class="ident" id="3377513">b</span>&nbsp;<span class="op" id="3377515">[</span><span class="op" id="3377516">]</span><span class="builtintype" id="3377517">byte</span><span class="op" id="3377521">,</span>&nbsp;<span class="ident" id="3377523">n</span>&nbsp;<span class="builtintype" id="3377525">int</span><span class="op" id="3377528">,</span>&nbsp;<span class="ident" id="3377530">deliver</span>&nbsp;<span class="keyword" id="3377538">func</span><span class="op" id="3377542">(</span><span class="op" id="3377543">[</span><span class="op" id="3377544">]</span><span class="builtintype" id="3377545">int</span><span class="op" id="3377548">)</span><span class="op" id="3377549">)</span>&nbsp;<span class="op" id="3377551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3377554">var</span>&nbsp;<span class="ident" id="3377558">end</span>&nbsp;<span class="builtintype" id="3377562">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3377567">if</span>&nbsp;<span class="ident" id="3377570">b</span>&nbsp;<span class="op" id="3377572">==</span>&nbsp;<span class="ident" id="3377575">nil</span>&nbsp;<span class="op" id="3377579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3377583">end</span>&nbsp;<span class="op" id="3377587">=</span>&nbsp;<span class="builtinfunc" id="3377589">len</span><span class="op" id="3377592">(</span><span class="ident" id="3377593">s</span><span class="op" id="3377594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3377597">}</span>&nbsp;<span class="keyword" id="3377599">else</span>&nbsp;<span class="op" id="3377604">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3377608">end</span>&nbsp;<span class="op" id="3377612">=</span>&nbsp;<span class="builtinfunc" id="3377614">len</span><span class="op" id="3377617">(</span><span class="ident" id="3377618">b</span><span class="op" id="3377619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3377622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3377626">for</span>&nbsp;<span class="ident" id="3377630">pos</span><span class="op" id="3377633">,</span>&nbsp;<span class="ident" id="3377635">i</span><span class="op" id="3377636">,</span>&nbsp;<span class="ident" id="3377638">prevMatchEnd</span>&nbsp;<span class="op" id="3377651">:=</span>&nbsp;<span class="num" id="3377654">0</span><span class="op" id="3377655">,</span>&nbsp;<span class="num" id="3377657">0</span><span class="op" id="3377658">,</span>&nbsp;<span class="op" id="3377660">-</span><span class="num" id="3377661">1</span><span class="op" id="3377662">;</span>&nbsp;<span class="ident" id="3377664">i</span>&nbsp;<span class="op" id="3377666">&lt;</span>&nbsp;<span class="ident" id="3377668">n</span>&nbsp;<span class="op" id="3377670">&amp;&amp;</span>&nbsp;<span class="ident" id="3377673">pos</span>&nbsp;<span class="op" id="3377677">&lt;=</span>&nbsp;<span class="ident" id="3377680">end</span><span class="op" id="3377683">;</span>&nbsp;<span class="op" id="3377685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3377689">matches</span>&nbsp;<span class="op" id="3377697">:=</span>&nbsp;<span class="ident" id="3377700">re</span><span class="op" id="3377702">.</span><span class="ident" id="3377703">doExecute</span><span class="op" id="3377712">(</span><span class="ident" id="3377713">nil</span><span class="op" id="3377716">,</span>&nbsp;<span class="ident" id="3377718">b</span><span class="op" id="3377719">,</span>&nbsp;<span class="ident" id="3377721">s</span><span class="op" id="3377722">,</span>&nbsp;<span class="ident" id="3377724">pos</span><span class="op" id="3377727">,</span>&nbsp;<span class="ident" id="3377729">re</span><span class="op" id="3377731">.</span><span class="ident" id="3377732">prog</span><span class="op" id="3377736">.</span><span class="ident" id="3377737">NumCap</span><span class="op" id="3377743">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3377747">if</span>&nbsp;<span class="builtinfunc" id="3377750">len</span><span class="op" id="3377753">(</span><span class="ident" id="3377754">matches</span><span class="op" id="3377761">)</span>&nbsp;<span class="op" id="3377763">==</span>&nbsp;<span class="num" id="3377766">0</span>&nbsp;<span class="op" id="3377768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3377773">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3377781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3377786">accept</span>&nbsp;<span class="op" id="3377793">:=</span>&nbsp;<span class="builtintype" id="3377796">true</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3377803">if</span>&nbsp;<span class="ident" id="3377806">matches</span><span class="op" id="3377813">[</span><span class="num" id="3377814">1</span><span class="op" id="3377815">]</span>&nbsp;<span class="op" id="3377817">==</span>&nbsp;<span class="ident" id="3377820">pos</span>&nbsp;<span class="op" id="3377824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3377829">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;empty&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3377863">if</span>&nbsp;<span class="ident" id="3377866">matches</span><span class="op" id="3377873">[</span><span class="num" id="3377874">0</span><span class="op" id="3377875">]</span>&nbsp;<span class="op" id="3377877">==</span>&nbsp;<span class="ident" id="3377880">prevMatchEnd</span>&nbsp;<span class="op" id="3377893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3377899">//&nbsp;We&nbsp;don&#39;t&nbsp;allow&nbsp;an&nbsp;empty&nbsp;match&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3377942">//&nbsp;after&nbsp;a&nbsp;previous&nbsp;match,&nbsp;so&nbsp;ignore&nbsp;it.</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3377987">accept</span>&nbsp;<span class="op" id="3377994">=</span>&nbsp;<span class="builtintype" id="3377996">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3378005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3378010">var</span>&nbsp;<span class="ident" id="3378014">width</span>&nbsp;<span class="builtintype" id="3378020">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3378027">//&nbsp;TODO:&nbsp;use&nbsp;step()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3378050">if</span>&nbsp;<span class="ident" id="3378053">b</span>&nbsp;<span class="op" id="3378055">==</span>&nbsp;<span class="ident" id="3378058">nil</span>&nbsp;<span class="op" id="3378062">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378068">_</span><span class="op" id="3378069">,</span>&nbsp;<span class="ident" id="3378071">width</span>&nbsp;<span class="op" id="3378077">=</span>&nbsp;<span class="ident" id="3378079">utf8</span><span class="op" id="3378083">.</span><span class="ident" id="3378084">DecodeRuneInString</span><span class="op" id="3378102">(</span><span class="ident" id="3378103">s</span><span class="op" id="3378104">[</span><span class="ident" id="3378105">pos</span><span class="op" id="3378108">:</span><span class="ident" id="3378109">end</span><span class="op" id="3378112">]</span><span class="op" id="3378113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3378118">}</span>&nbsp;<span class="keyword" id="3378120">else</span>&nbsp;<span class="op" id="3378125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378131">_</span><span class="op" id="3378132">,</span>&nbsp;<span class="ident" id="3378134">width</span>&nbsp;<span class="op" id="3378140">=</span>&nbsp;<span class="ident" id="3378142">utf8</span><span class="op" id="3378146">.</span><span class="ident" id="3378147">DecodeRune</span><span class="op" id="3378157">(</span><span class="ident" id="3378158">b</span><span class="op" id="3378159">[</span><span class="ident" id="3378160">pos</span><span class="op" id="3378163">:</span><span class="ident" id="3378164">end</span><span class="op" id="3378167">]</span><span class="op" id="3378168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3378173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3378178">if</span>&nbsp;<span class="ident" id="3378181">width</span>&nbsp;<span class="op" id="3378187">&gt;</span>&nbsp;<span class="num" id="3378189">0</span>&nbsp;<span class="op" id="3378191">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378197">pos</span>&nbsp;<span class="op" id="3378201">+=</span>&nbsp;<span class="ident" id="3378204">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3378213">}</span>&nbsp;<span class="keyword" id="3378215">else</span>&nbsp;<span class="op" id="3378220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378226">pos</span>&nbsp;<span class="op" id="3378230">=</span>&nbsp;<span class="ident" id="3378232">end</span>&nbsp;<span class="op" id="3378236">+</span>&nbsp;<span class="num" id="3378238">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3378243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3378247">}</span>&nbsp;<span class="keyword" id="3378249">else</span>&nbsp;<span class="op" id="3378254">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378259">pos</span>&nbsp;<span class="op" id="3378263">=</span>&nbsp;<span class="ident" id="3378265">matches</span><span class="op" id="3378272">[</span><span class="num" id="3378273">1</span><span class="op" id="3378274">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3378278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378282">prevMatchEnd</span>&nbsp;<span class="op" id="3378295">=</span>&nbsp;<span class="ident" id="3378297">matches</span><span class="op" id="3378304">[</span><span class="num" id="3378305">1</span><span class="op" id="3378306">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3378311">if</span>&nbsp;<span class="ident" id="3378314">accept</span>&nbsp;<span class="op" id="3378321">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378326">deliver</span><span class="op" id="3378333">(</span><span class="ident" id="3378334">re</span><span class="op" id="3378336">.</span><span class="ident" id="3378337">pad</span><span class="op" id="3378340">(</span><span class="ident" id="3378341">matches</span><span class="op" id="3378348">)</span><span class="op" id="3378349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378354">i</span><span class="op" id="3378355">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3378360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3378363">}</span><br>
<span class="lineno"></span><span class="op" id="3378365">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="3378368">//&nbsp;Find&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;b&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="comment" id="3378463">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3378508">func</span>&nbsp;<span class="op" id="3378513">(</span><span class="ident" id="3378514">re</span>&nbsp;<span class="op" id="3378517">*</span><span class="ident" id="3378518">Regexp</span><span class="op" id="3378524">)</span>&nbsp;<span class="ident" id="3378526">Find</span><span class="op" id="3378530">(</span><span class="ident" id="3378531">b</span>&nbsp;<span class="op" id="3378533">[</span><span class="op" id="3378534">]</span><span class="builtintype" id="3378535">byte</span><span class="op" id="3378539">)</span>&nbsp;<span class="op" id="3378541">[</span><span class="op" id="3378542">]</span><span class="builtintype" id="3378543">byte</span>&nbsp;<span class="op" id="3378548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378551">a</span>&nbsp;<span class="op" id="3378553">:=</span>&nbsp;<span class="ident" id="3378556">re</span><span class="op" id="3378558">.</span><span class="ident" id="3378559">doExecute</span><span class="op" id="3378568">(</span><span class="ident" id="3378569">nil</span><span class="op" id="3378572">,</span>&nbsp;<span class="ident" id="3378574">b</span><span class="op" id="3378575">,</span>&nbsp;<span class="string" id="3378577">&#34;&#34;</span><span class="op" id="3378579">,</span>&nbsp;<span class="num" id="3378581">0</span><span class="op" id="3378582">,</span>&nbsp;<span class="num" id="3378584">2</span><span class="op" id="3378585">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3378588">if</span>&nbsp;<span class="ident" id="3378591">a</span>&nbsp;<span class="op" id="3378593">==</span>&nbsp;<span class="ident" id="3378596">nil</span>&nbsp;<span class="op" id="3378600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3378604">return</span>&nbsp;<span class="ident" id="3378611">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3378616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3378619">return</span>&nbsp;<span class="ident" id="3378626">b</span><span class="op" id="3378627">[</span><span class="ident" id="3378628">a</span><span class="op" id="3378629">[</span><span class="num" id="3378630">0</span><span class="op" id="3378631">]</span><span class="op" id="3378632">:</span><span class="ident" id="3378633">a</span><span class="op" id="3378634">[</span><span class="num" id="3378635">1</span><span class="op" id="3378636">]</span><span class="op" id="3378637">]</span><br>
<span class="lineno"></span><span class="op" id="3378639">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="3378642">//&nbsp;FindIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the&nbsp;location&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3378720">//&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;b&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.&nbsp;&nbsp;The&nbsp;match&nbsp;itself&nbsp;is&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="3378798">//&nbsp;b[loc[0]:loc[1]].</span><br>
<span class="lineno"></span><span class="comment" id="3378819">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">675</span><span class="keyword" id="3378864">func</span>&nbsp;<span class="op" id="3378869">(</span><span class="ident" id="3378870">re</span>&nbsp;<span class="op" id="3378873">*</span><span class="ident" id="3378874">Regexp</span><span class="op" id="3378880">)</span>&nbsp;<span class="ident" id="3378882">FindIndex</span><span class="op" id="3378891">(</span><span class="ident" id="3378892">b</span>&nbsp;<span class="op" id="3378894">[</span><span class="op" id="3378895">]</span><span class="builtintype" id="3378896">byte</span><span class="op" id="3378900">)</span>&nbsp;<span class="op" id="3378902">(</span><span class="ident" id="3378903">loc</span>&nbsp;<span class="op" id="3378907">[</span><span class="op" id="3378908">]</span><span class="builtintype" id="3378909">int</span><span class="op" id="3378912">)</span>&nbsp;<span class="op" id="3378914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378917">a</span>&nbsp;<span class="op" id="3378919">:=</span>&nbsp;<span class="ident" id="3378922">re</span><span class="op" id="3378924">.</span><span class="ident" id="3378925">doExecute</span><span class="op" id="3378934">(</span><span class="ident" id="3378935">nil</span><span class="op" id="3378938">,</span>&nbsp;<span class="ident" id="3378940">b</span><span class="op" id="3378941">,</span>&nbsp;<span class="string" id="3378943">&#34;&#34;</span><span class="op" id="3378945">,</span>&nbsp;<span class="num" id="3378947">0</span><span class="op" id="3378948">,</span>&nbsp;<span class="num" id="3378950">2</span><span class="op" id="3378951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3378954">if</span>&nbsp;<span class="ident" id="3378957">a</span>&nbsp;<span class="op" id="3378959">==</span>&nbsp;<span class="ident" id="3378962">nil</span>&nbsp;<span class="op" id="3378966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3378970">return</span>&nbsp;<span class="ident" id="3378977">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3378982">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3378985">return</span>&nbsp;<span class="ident" id="3378992">a</span><span class="op" id="3378993">[</span><span class="num" id="3378994">0</span><span class="op" id="3378995">:</span><span class="num" id="3378996">2</span><span class="op" id="3378997">]</span><br>
<span class="lineno"></span><span class="op" id="3378999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3379002">//&nbsp;FindString&nbsp;returns&nbsp;a&nbsp;string&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="3379092">//&nbsp;expression.&nbsp;&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;match,&nbsp;the&nbsp;return&nbsp;value&nbsp;is&nbsp;an&nbsp;empty&nbsp;string,</span><br>
<span class="lineno">685</span><span class="comment" id="3379167">//&nbsp;but&nbsp;it&nbsp;will&nbsp;also&nbsp;be&nbsp;empty&nbsp;if&nbsp;the&nbsp;regular&nbsp;expression&nbsp;successfully&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="3379243">//&nbsp;an&nbsp;empty&nbsp;string.&nbsp;&nbsp;Use&nbsp;FindStringIndex&nbsp;or&nbsp;FindStringSubmatch&nbsp;if&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3379315">//&nbsp;necessary&nbsp;to&nbsp;distinguish&nbsp;these&nbsp;cases.</span><br>
<span class="lineno"></span><span class="keyword" id="3379356">func</span>&nbsp;<span class="op" id="3379361">(</span><span class="ident" id="3379362">re</span>&nbsp;<span class="op" id="3379365">*</span><span class="ident" id="3379366">Regexp</span><span class="op" id="3379372">)</span>&nbsp;<span class="ident" id="3379374">FindString</span><span class="op" id="3379384">(</span><span class="ident" id="3379385">s</span>&nbsp;<span class="builtintype" id="3379387">string</span><span class="op" id="3379393">)</span>&nbsp;<span class="builtintype" id="3379395">string</span>&nbsp;<span class="op" id="3379402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3379405">a</span>&nbsp;<span class="op" id="3379407">:=</span>&nbsp;<span class="ident" id="3379410">re</span><span class="op" id="3379412">.</span><span class="ident" id="3379413">doExecute</span><span class="op" id="3379422">(</span><span class="ident" id="3379423">nil</span><span class="op" id="3379426">,</span>&nbsp;<span class="ident" id="3379428">nil</span><span class="op" id="3379431">,</span>&nbsp;<span class="ident" id="3379433">s</span><span class="op" id="3379434">,</span>&nbsp;<span class="num" id="3379436">0</span><span class="op" id="3379437">,</span>&nbsp;<span class="num" id="3379439">2</span><span class="op" id="3379440">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379443">if</span>&nbsp;<span class="ident" id="3379446">a</span>&nbsp;<span class="op" id="3379448">==</span>&nbsp;<span class="ident" id="3379451">nil</span>&nbsp;<span class="op" id="3379455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379459">return</span>&nbsp;<span class="string" id="3379466">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3379470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379473">return</span>&nbsp;<span class="ident" id="3379480">s</span><span class="op" id="3379481">[</span><span class="ident" id="3379482">a</span><span class="op" id="3379483">[</span><span class="num" id="3379484">0</span><span class="op" id="3379485">]</span><span class="op" id="3379486">:</span><span class="ident" id="3379487">a</span><span class="op" id="3379488">[</span><span class="num" id="3379489">1</span><span class="op" id="3379490">]</span><span class="op" id="3379491">]</span><br>
<span class="lineno"></span><span class="op" id="3379493">}</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span><span class="comment" id="3379496">//&nbsp;FindStringIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3379568">//&nbsp;location&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.&nbsp;&nbsp;The&nbsp;match</span><br>
<span class="lineno"></span><span class="comment" id="3379645">//&nbsp;itself&nbsp;is&nbsp;at&nbsp;s[loc[0]:loc[1]].</span><br>
<span class="lineno"></span><span class="comment" id="3379679">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">700</span><span class="keyword" id="3379724">func</span>&nbsp;<span class="op" id="3379729">(</span><span class="ident" id="3379730">re</span>&nbsp;<span class="op" id="3379733">*</span><span class="ident" id="3379734">Regexp</span><span class="op" id="3379740">)</span>&nbsp;<span class="ident" id="3379742">FindStringIndex</span><span class="op" id="3379757">(</span><span class="ident" id="3379758">s</span>&nbsp;<span class="builtintype" id="3379760">string</span><span class="op" id="3379766">)</span>&nbsp;<span class="op" id="3379768">(</span><span class="ident" id="3379769">loc</span>&nbsp;<span class="op" id="3379773">[</span><span class="op" id="3379774">]</span><span class="builtintype" id="3379775">int</span><span class="op" id="3379778">)</span>&nbsp;<span class="op" id="3379780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3379783">a</span>&nbsp;<span class="op" id="3379785">:=</span>&nbsp;<span class="ident" id="3379788">re</span><span class="op" id="3379790">.</span><span class="ident" id="3379791">doExecute</span><span class="op" id="3379800">(</span><span class="ident" id="3379801">nil</span><span class="op" id="3379804">,</span>&nbsp;<span class="ident" id="3379806">nil</span><span class="op" id="3379809">,</span>&nbsp;<span class="ident" id="3379811">s</span><span class="op" id="3379812">,</span>&nbsp;<span class="num" id="3379814">0</span><span class="op" id="3379815">,</span>&nbsp;<span class="num" id="3379817">2</span><span class="op" id="3379818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379821">if</span>&nbsp;<span class="ident" id="3379824">a</span>&nbsp;<span class="op" id="3379826">==</span>&nbsp;<span class="ident" id="3379829">nil</span>&nbsp;<span class="op" id="3379833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379837">return</span>&nbsp;<span class="ident" id="3379844">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3379849">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379852">return</span>&nbsp;<span class="ident" id="3379859">a</span><span class="op" id="3379860">[</span><span class="num" id="3379861">0</span><span class="op" id="3379862">:</span><span class="num" id="3379863">2</span><span class="op" id="3379864">]</span><br>
<span class="lineno"></span><span class="op" id="3379866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3379869">//&nbsp;FindReaderIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3379941">//&nbsp;location&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;text&nbsp;read&nbsp;from</span><br>
<span class="lineno">710</span><span class="comment" id="3380019">//&nbsp;the&nbsp;RuneReader.&nbsp;&nbsp;The&nbsp;match&nbsp;text&nbsp;was&nbsp;found&nbsp;in&nbsp;the&nbsp;input&nbsp;stream&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="3380087">//&nbsp;byte&nbsp;offset&nbsp;loc[0]&nbsp;through&nbsp;loc[1]-1.</span><br>
<span class="lineno"></span><span class="comment" id="3380127">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3380172">func</span>&nbsp;<span class="op" id="3380177">(</span><span class="ident" id="3380178">re</span>&nbsp;<span class="op" id="3380181">*</span><span class="ident" id="3380182">Regexp</span><span class="op" id="3380188">)</span>&nbsp;<span class="ident" id="3380190">FindReaderIndex</span><span class="op" id="3380205">(</span><span class="ident" id="3380206">r</span>&nbsp;<span class="ident" id="3380208">io</span><span class="op" id="3380210">.</span><span class="ident" id="3380211">RuneReader</span><span class="op" id="3380221">)</span>&nbsp;<span class="op" id="3380223">(</span><span class="ident" id="3380224">loc</span>&nbsp;<span class="op" id="3380228">[</span><span class="op" id="3380229">]</span><span class="builtintype" id="3380230">int</span><span class="op" id="3380233">)</span>&nbsp;<span class="op" id="3380235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3380238">a</span>&nbsp;<span class="op" id="3380240">:=</span>&nbsp;<span class="ident" id="3380243">re</span><span class="op" id="3380245">.</span><span class="ident" id="3380246">doExecute</span><span class="op" id="3380255">(</span><span class="ident" id="3380256">r</span><span class="op" id="3380257">,</span>&nbsp;<span class="ident" id="3380259">nil</span><span class="op" id="3380262">,</span>&nbsp;<span class="string" id="3380264">&#34;&#34;</span><span class="op" id="3380266">,</span>&nbsp;<span class="num" id="3380268">0</span><span class="op" id="3380269">,</span>&nbsp;<span class="num" id="3380271">2</span><span class="op" id="3380272">)</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3380275">if</span>&nbsp;<span class="ident" id="3380278">a</span>&nbsp;<span class="op" id="3380280">==</span>&nbsp;<span class="ident" id="3380283">nil</span>&nbsp;<span class="op" id="3380287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3380291">return</span>&nbsp;<span class="ident" id="3380298">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3380303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3380306">return</span>&nbsp;<span class="ident" id="3380313">a</span><span class="op" id="3380314">[</span><span class="num" id="3380315">0</span><span class="op" id="3380316">:</span><span class="num" id="3380317">2</span><span class="op" id="3380318">]</span><br>
<span class="lineno"></span><span class="op" id="3380320">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="comment" id="3380323">//&nbsp;FindSubmatch&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;slices&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost</span><br>
<span class="lineno"></span><span class="comment" id="3380398">//&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;b&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="3380470">//&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="3380546">//&nbsp;comment.</span><br>
<span class="lineno">725</span><span class="comment" id="3380558">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3380603">func</span>&nbsp;<span class="op" id="3380608">(</span><span class="ident" id="3380609">re</span>&nbsp;<span class="op" id="3380612">*</span><span class="ident" id="3380613">Regexp</span><span class="op" id="3380619">)</span>&nbsp;<span class="ident" id="3380621">FindSubmatch</span><span class="op" id="3380633">(</span><span class="ident" id="3380634">b</span>&nbsp;<span class="op" id="3380636">[</span><span class="op" id="3380637">]</span><span class="builtintype" id="3380638">byte</span><span class="op" id="3380642">)</span>&nbsp;<span class="op" id="3380644">[</span><span class="op" id="3380645">]</span><span class="op" id="3380646">[</span><span class="op" id="3380647">]</span><span class="builtintype" id="3380648">byte</span>&nbsp;<span class="op" id="3380653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3380656">a</span>&nbsp;<span class="op" id="3380658">:=</span>&nbsp;<span class="ident" id="3380661">re</span><span class="op" id="3380663">.</span><span class="ident" id="3380664">doExecute</span><span class="op" id="3380673">(</span><span class="ident" id="3380674">nil</span><span class="op" id="3380677">,</span>&nbsp;<span class="ident" id="3380679">b</span><span class="op" id="3380680">,</span>&nbsp;<span class="string" id="3380682">&#34;&#34;</span><span class="op" id="3380684">,</span>&nbsp;<span class="num" id="3380686">0</span><span class="op" id="3380687">,</span>&nbsp;<span class="ident" id="3380689">re</span><span class="op" id="3380691">.</span><span class="ident" id="3380692">prog</span><span class="op" id="3380696">.</span><span class="ident" id="3380697">NumCap</span><span class="op" id="3380703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3380706">if</span>&nbsp;<span class="ident" id="3380709">a</span>&nbsp;<span class="op" id="3380711">==</span>&nbsp;<span class="ident" id="3380714">nil</span>&nbsp;<span class="op" id="3380718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3380722">return</span>&nbsp;<span class="ident" id="3380729">nil</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3380734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3380737">ret</span>&nbsp;<span class="op" id="3380741">:=</span>&nbsp;<span class="builtinfunc" id="3380744">make</span><span class="op" id="3380748">(</span><span class="op" id="3380749">[</span><span class="op" id="3380750">]</span><span class="op" id="3380751">[</span><span class="op" id="3380752">]</span><span class="builtintype" id="3380753">byte</span><span class="op" id="3380757">,</span>&nbsp;<span class="num" id="3380759">1</span><span class="op" id="3380760">+</span><span class="ident" id="3380761">re</span><span class="op" id="3380763">.</span><span class="ident" id="3380764">numSubexp</span><span class="op" id="3380773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3380776">for</span>&nbsp;<span class="ident" id="3380780">i</span>&nbsp;<span class="op" id="3380782">:=</span>&nbsp;<span class="keyword" id="3380785">range</span>&nbsp;<span class="ident" id="3380791">ret</span>&nbsp;<span class="op" id="3380795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3380799">if</span>&nbsp;<span class="num" id="3380802">2</span><span class="op" id="3380803">*</span><span class="ident" id="3380804">i</span>&nbsp;<span class="op" id="3380806">&lt;</span>&nbsp;<span class="builtinfunc" id="3380808">len</span><span class="op" id="3380811">(</span><span class="ident" id="3380812">a</span><span class="op" id="3380813">)</span>&nbsp;<span class="op" id="3380815">&amp;&amp;</span>&nbsp;<span class="ident" id="3380818">a</span><span class="op" id="3380819">[</span><span class="num" id="3380820">2</span><span class="op" id="3380821">*</span><span class="ident" id="3380822">i</span><span class="op" id="3380823">]</span>&nbsp;<span class="op" id="3380825">&gt;=</span>&nbsp;<span class="num" id="3380828">0</span>&nbsp;<span class="op" id="3380830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3380835">ret</span><span class="op" id="3380838">[</span><span class="ident" id="3380839">i</span><span class="op" id="3380840">]</span>&nbsp;<span class="op" id="3380842">=</span>&nbsp;<span class="ident" id="3380844">b</span><span class="op" id="3380845">[</span><span class="ident" id="3380846">a</span><span class="op" id="3380847">[</span><span class="num" id="3380848">2</span><span class="op" id="3380849">*</span><span class="ident" id="3380850">i</span><span class="op" id="3380851">]</span><span class="op" id="3380852">:</span><span class="ident" id="3380853">a</span><span class="op" id="3380854">[</span><span class="num" id="3380855">2</span><span class="op" id="3380856">*</span><span class="ident" id="3380857">i</span><span class="op" id="3380858">+</span><span class="num" id="3380859">1</span><span class="op" id="3380860">]</span><span class="op" id="3380861">]</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3380865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3380868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3380871">return</span>&nbsp;<span class="ident" id="3380878">ret</span><br>
<span class="lineno"></span><span class="op" id="3380882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="3380885">//&nbsp;Expand&nbsp;appends&nbsp;template&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;result;&nbsp;during&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3380954">//&nbsp;append,&nbsp;Expand&nbsp;replaces&nbsp;variables&nbsp;in&nbsp;the&nbsp;template&nbsp;with&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="3381026">//&nbsp;matches&nbsp;drawn&nbsp;from&nbsp;src.&nbsp;&nbsp;The&nbsp;match&nbsp;slice&nbsp;should&nbsp;have&nbsp;been&nbsp;returned&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="3381099">//&nbsp;FindSubmatchIndex.</span><br>
<span class="lineno"></span><span class="comment" id="3381121">//</span><br>
<span class="lineno">745</span><span class="comment" id="3381124">//&nbsp;In&nbsp;the&nbsp;template,&nbsp;a&nbsp;variable&nbsp;is&nbsp;denoted&nbsp;by&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3381193">//&nbsp;$name&nbsp;or&nbsp;${name},&nbsp;where&nbsp;name&nbsp;is&nbsp;a&nbsp;non-empty&nbsp;sequence&nbsp;of&nbsp;letters,</span><br>
<span class="lineno"></span><span class="comment" id="3381261">//&nbsp;digits,&nbsp;and&nbsp;underscores.&nbsp;&nbsp;A&nbsp;purely&nbsp;numeric&nbsp;name&nbsp;like&nbsp;$1&nbsp;refers&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3381330">//&nbsp;the&nbsp;submatch&nbsp;with&nbsp;the&nbsp;corresponding&nbsp;index;&nbsp;other&nbsp;names&nbsp;refer&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3381397">//&nbsp;capturing&nbsp;parentheses&nbsp;named&nbsp;with&nbsp;the&nbsp;(?P&lt;name&gt;...)&nbsp;syntax.&nbsp;&nbsp;A</span><br>
<span class="lineno">750</span><span class="comment" id="3381462">//&nbsp;reference&nbsp;to&nbsp;an&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;unmatched&nbsp;index&nbsp;or&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3381535">//&nbsp;present&nbsp;in&nbsp;the&nbsp;regular&nbsp;expression&nbsp;is&nbsp;replaced&nbsp;with&nbsp;an&nbsp;empty&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="3381605">//</span><br>
<span class="lineno"></span><span class="comment" id="3381608">//&nbsp;In&nbsp;the&nbsp;$name&nbsp;form,&nbsp;name&nbsp;is&nbsp;taken&nbsp;to&nbsp;be&nbsp;as&nbsp;long&nbsp;as&nbsp;possible:&nbsp;$1x&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3381678">//&nbsp;equivalent&nbsp;to&nbsp;${1x},&nbsp;not&nbsp;${1}x,&nbsp;and,&nbsp;$10&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;${10},&nbsp;not&nbsp;${1}0.</span><br>
<span class="lineno">755</span><span class="comment" id="3381757">//</span><br>
<span class="lineno"></span><span class="comment" id="3381760">//&nbsp;To&nbsp;insert&nbsp;a&nbsp;literal&nbsp;$&nbsp;in&nbsp;the&nbsp;output,&nbsp;use&nbsp;$$&nbsp;in&nbsp;the&nbsp;template.</span><br>
<span class="lineno"></span><span class="keyword" id="3381824">func</span>&nbsp;<span class="op" id="3381829">(</span><span class="ident" id="3381830">re</span>&nbsp;<span class="op" id="3381833">*</span><span class="ident" id="3381834">Regexp</span><span class="op" id="3381840">)</span>&nbsp;<span class="ident" id="3381842">Expand</span><span class="op" id="3381848">(</span><span class="ident" id="3381849">dst</span>&nbsp;<span class="op" id="3381853">[</span><span class="op" id="3381854">]</span><span class="builtintype" id="3381855">byte</span><span class="op" id="3381859">,</span>&nbsp;<span class="ident" id="3381861">template</span>&nbsp;<span class="op" id="3381870">[</span><span class="op" id="3381871">]</span><span class="builtintype" id="3381872">byte</span><span class="op" id="3381876">,</span>&nbsp;<span class="ident" id="3381878">src</span>&nbsp;<span class="op" id="3381882">[</span><span class="op" id="3381883">]</span><span class="builtintype" id="3381884">byte</span><span class="op" id="3381888">,</span>&nbsp;<span class="ident" id="3381890">match</span>&nbsp;<span class="op" id="3381896">[</span><span class="op" id="3381897">]</span><span class="builtintype" id="3381898">int</span><span class="op" id="3381901">)</span>&nbsp;<span class="op" id="3381903">[</span><span class="op" id="3381904">]</span><span class="builtintype" id="3381905">byte</span>&nbsp;<span class="op" id="3381910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3381913">return</span>&nbsp;<span class="ident" id="3381920">re</span><span class="op" id="3381922">.</span><span class="ident" id="3381923">expand</span><span class="op" id="3381929">(</span><span class="ident" id="3381930">dst</span><span class="op" id="3381933">,</span>&nbsp;<span class="builtintype" id="3381935">string</span><span class="op" id="3381941">(</span><span class="ident" id="3381942">template</span><span class="op" id="3381950">)</span><span class="op" id="3381951">,</span>&nbsp;<span class="ident" id="3381953">src</span><span class="op" id="3381956">,</span>&nbsp;<span class="string" id="3381958">&#34;&#34;</span><span class="op" id="3381960">,</span>&nbsp;<span class="ident" id="3381962">match</span><span class="op" id="3381967">)</span><br>
<span class="lineno"></span><span class="op" id="3381969">}</span><br>
<span class="lineno">760</span><br>
<span class="lineno"></span><span class="comment" id="3381972">//&nbsp;ExpandString&nbsp;is&nbsp;like&nbsp;Expand&nbsp;but&nbsp;the&nbsp;template&nbsp;and&nbsp;source&nbsp;are&nbsp;strings.</span><br>
<span class="lineno"></span><span class="comment" id="3382044">//&nbsp;It&nbsp;appends&nbsp;to&nbsp;and&nbsp;returns&nbsp;a&nbsp;byte&nbsp;slice&nbsp;in&nbsp;order&nbsp;to&nbsp;give&nbsp;the&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="3382115">//&nbsp;code&nbsp;control&nbsp;over&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="3382148">func</span>&nbsp;<span class="op" id="3382153">(</span><span class="ident" id="3382154">re</span>&nbsp;<span class="op" id="3382157">*</span><span class="ident" id="3382158">Regexp</span><span class="op" id="3382164">)</span>&nbsp;<span class="ident" id="3382166">ExpandString</span><span class="op" id="3382178">(</span><span class="ident" id="3382179">dst</span>&nbsp;<span class="op" id="3382183">[</span><span class="op" id="3382184">]</span><span class="builtintype" id="3382185">byte</span><span class="op" id="3382189">,</span>&nbsp;<span class="ident" id="3382191">template</span>&nbsp;<span class="builtintype" id="3382200">string</span><span class="op" id="3382206">,</span>&nbsp;<span class="ident" id="3382208">src</span>&nbsp;<span class="builtintype" id="3382212">string</span><span class="op" id="3382218">,</span>&nbsp;<span class="ident" id="3382220">match</span>&nbsp;<span class="op" id="3382226">[</span><span class="op" id="3382227">]</span><span class="builtintype" id="3382228">int</span><span class="op" id="3382231">)</span>&nbsp;<span class="op" id="3382233">[</span><span class="op" id="3382234">]</span><span class="builtintype" id="3382235">byte</span>&nbsp;<span class="op" id="3382240">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382243">return</span>&nbsp;<span class="ident" id="3382250">re</span><span class="op" id="3382252">.</span><span class="ident" id="3382253">expand</span><span class="op" id="3382259">(</span><span class="ident" id="3382260">dst</span><span class="op" id="3382263">,</span>&nbsp;<span class="ident" id="3382265">template</span><span class="op" id="3382273">,</span>&nbsp;<span class="ident" id="3382275">nil</span><span class="op" id="3382278">,</span>&nbsp;<span class="ident" id="3382280">src</span><span class="op" id="3382283">,</span>&nbsp;<span class="ident" id="3382285">match</span><span class="op" id="3382290">)</span><br>
<span class="lineno"></span><span class="op" id="3382292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3382295">func</span>&nbsp;<span class="op" id="3382300">(</span><span class="ident" id="3382301">re</span>&nbsp;<span class="op" id="3382304">*</span><span class="ident" id="3382305">Regexp</span><span class="op" id="3382311">)</span>&nbsp;<span class="ident" id="3382313">expand</span><span class="op" id="3382319">(</span><span class="ident" id="3382320">dst</span>&nbsp;<span class="op" id="3382324">[</span><span class="op" id="3382325">]</span><span class="builtintype" id="3382326">byte</span><span class="op" id="3382330">,</span>&nbsp;<span class="ident" id="3382332">template</span>&nbsp;<span class="builtintype" id="3382341">string</span><span class="op" id="3382347">,</span>&nbsp;<span class="ident" id="3382349">bsrc</span>&nbsp;<span class="op" id="3382354">[</span><span class="op" id="3382355">]</span><span class="builtintype" id="3382356">byte</span><span class="op" id="3382360">,</span>&nbsp;<span class="ident" id="3382362">src</span>&nbsp;<span class="builtintype" id="3382366">string</span><span class="op" id="3382372">,</span>&nbsp;<span class="ident" id="3382374">match</span>&nbsp;<span class="op" id="3382380">[</span><span class="op" id="3382381">]</span><span class="builtintype" id="3382382">int</span><span class="op" id="3382385">)</span>&nbsp;<span class="op" id="3382387">[</span><span class="op" id="3382388">]</span><span class="builtintype" id="3382389">byte</span>&nbsp;<span class="op" id="3382394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382397">for</span>&nbsp;<span class="builtinfunc" id="3382401">len</span><span class="op" id="3382404">(</span><span class="ident" id="3382405">template</span><span class="op" id="3382413">)</span>&nbsp;<span class="op" id="3382415">&gt;</span>&nbsp;<span class="num" id="3382417">0</span>&nbsp;<span class="op" id="3382419">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382423">i</span>&nbsp;<span class="op" id="3382425">:=</span>&nbsp;<span class="ident" id="3382428">strings</span><span class="op" id="3382435">.</span><span class="ident" id="3382436">Index</span><span class="op" id="3382441">(</span><span class="ident" id="3382442">template</span><span class="op" id="3382450">,</span>&nbsp;<span class="string" id="3382452">&#34;$&#34;</span><span class="op" id="3382455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382459">if</span>&nbsp;<span class="ident" id="3382462">i</span>&nbsp;<span class="op" id="3382464">&lt;</span>&nbsp;<span class="num" id="3382466">0</span>&nbsp;<span class="op" id="3382468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382473">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3382481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382485">dst</span>&nbsp;<span class="op" id="3382489">=</span>&nbsp;<span class="builtinfunc" id="3382491">append</span><span class="op" id="3382497">(</span><span class="ident" id="3382498">dst</span><span class="op" id="3382501">,</span>&nbsp;<span class="ident" id="3382503">template</span><span class="op" id="3382511">[</span><span class="op" id="3382512">:</span><span class="ident" id="3382513">i</span><span class="op" id="3382514">]</span><span class="op" id="3382515">...</span><span class="op" id="3382518">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382522">template</span>&nbsp;<span class="op" id="3382531">=</span>&nbsp;<span class="ident" id="3382533">template</span><span class="op" id="3382541">[</span><span class="ident" id="3382542">i</span><span class="op" id="3382543">:</span><span class="op" id="3382544">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382548">if</span>&nbsp;<span class="builtinfunc" id="3382551">len</span><span class="op" id="3382554">(</span><span class="ident" id="3382555">template</span><span class="op" id="3382563">)</span>&nbsp;<span class="op" id="3382565">&gt;</span>&nbsp;<span class="num" id="3382567">1</span>&nbsp;<span class="op" id="3382569">&amp;&amp;</span>&nbsp;<span class="ident" id="3382572">template</span><span class="op" id="3382580">[</span><span class="num" id="3382581">1</span><span class="op" id="3382582">]</span>&nbsp;<span class="op" id="3382584">==</span>&nbsp;<span class="string" id="3382587">&#39;$&#39;</span>&nbsp;<span class="op" id="3382591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3382596">//&nbsp;Treat&nbsp;$$&nbsp;as&nbsp;$.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382617">dst</span>&nbsp;<span class="op" id="3382621">=</span>&nbsp;<span class="builtinfunc" id="3382623">append</span><span class="op" id="3382629">(</span><span class="ident" id="3382630">dst</span><span class="op" id="3382633">,</span>&nbsp;<span class="string" id="3382635">&#39;$&#39;</span><span class="op" id="3382638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382643">template</span>&nbsp;<span class="op" id="3382652">=</span>&nbsp;<span class="ident" id="3382654">template</span><span class="op" id="3382662">[</span><span class="num" id="3382663">2</span><span class="op" id="3382664">:</span><span class="op" id="3382665">]</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382670">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3382681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382685">name</span><span class="op" id="3382689">,</span>&nbsp;<span class="ident" id="3382691">num</span><span class="op" id="3382694">,</span>&nbsp;<span class="ident" id="3382696">rest</span><span class="op" id="3382700">,</span>&nbsp;<span class="ident" id="3382702">ok</span>&nbsp;<span class="op" id="3382705">:=</span>&nbsp;<span class="ident" id="3382708">extract</span><span class="op" id="3382715">(</span><span class="ident" id="3382716">template</span><span class="op" id="3382724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382728">if</span>&nbsp;<span class="op" id="3382731">!</span><span class="ident" id="3382732">ok</span>&nbsp;<span class="op" id="3382735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3382740">//&nbsp;Malformed;&nbsp;treat&nbsp;$&nbsp;as&nbsp;raw&nbsp;text.</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382778">dst</span>&nbsp;<span class="op" id="3382782">=</span>&nbsp;<span class="builtinfunc" id="3382784">append</span><span class="op" id="3382790">(</span><span class="ident" id="3382791">dst</span><span class="op" id="3382794">,</span>&nbsp;<span class="string" id="3382796">&#39;$&#39;</span><span class="op" id="3382799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382804">template</span>&nbsp;<span class="op" id="3382813">=</span>&nbsp;<span class="ident" id="3382815">template</span><span class="op" id="3382823">[</span><span class="num" id="3382824">1</span><span class="op" id="3382825">:</span><span class="op" id="3382826">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382831">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3382842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382846">template</span>&nbsp;<span class="op" id="3382855">=</span>&nbsp;<span class="ident" id="3382857">rest</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382864">if</span>&nbsp;<span class="ident" id="3382867">num</span>&nbsp;<span class="op" id="3382871">&gt;=</span>&nbsp;<span class="num" id="3382874">0</span>&nbsp;<span class="op" id="3382876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382881">if</span>&nbsp;<span class="num" id="3382884">2</span><span class="op" id="3382885">*</span><span class="ident" id="3382886">num</span><span class="op" id="3382889">+</span><span class="num" id="3382890">1</span>&nbsp;<span class="op" id="3382892">&lt;</span>&nbsp;<span class="builtinfunc" id="3382894">len</span><span class="op" id="3382897">(</span><span class="ident" id="3382898">match</span><span class="op" id="3382903">)</span>&nbsp;<span class="op" id="3382905">&amp;&amp;</span>&nbsp;<span class="ident" id="3382908">match</span><span class="op" id="3382913">[</span><span class="num" id="3382914">2</span><span class="op" id="3382915">*</span><span class="ident" id="3382916">num</span><span class="op" id="3382919">]</span>&nbsp;<span class="op" id="3382921">&gt;=</span>&nbsp;<span class="num" id="3382924">0</span>&nbsp;<span class="op" id="3382926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382932">if</span>&nbsp;<span class="ident" id="3382935">bsrc</span>&nbsp;<span class="op" id="3382940">!=</span>&nbsp;<span class="ident" id="3382943">nil</span>&nbsp;<span class="op" id="3382947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382954">dst</span>&nbsp;<span class="op" id="3382958">=</span>&nbsp;<span class="builtinfunc" id="3382960">append</span><span class="op" id="3382966">(</span><span class="ident" id="3382967">dst</span><span class="op" id="3382970">,</span>&nbsp;<span class="ident" id="3382972">bsrc</span><span class="op" id="3382976">[</span><span class="ident" id="3382977">match</span><span class="op" id="3382982">[</span><span class="num" id="3382983">2</span><span class="op" id="3382984">*</span><span class="ident" id="3382985">num</span><span class="op" id="3382988">]</span><span class="op" id="3382989">:</span><span class="ident" id="3382990">match</span><span class="op" id="3382995">[</span><span class="num" id="3382996">2</span><span class="op" id="3382997">*</span><span class="ident" id="3382998">num</span><span class="op" id="3383001">+</span><span class="num" id="3383002">1</span><span class="op" id="3383003">]</span><span class="op" id="3383004">]</span><span class="op" id="3383005">...</span><span class="op" id="3383008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3383014">}</span>&nbsp;<span class="keyword" id="3383016">else</span>&nbsp;<span class="op" id="3383021">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383028">dst</span>&nbsp;<span class="op" id="3383032">=</span>&nbsp;<span class="builtinfunc" id="3383034">append</span><span class="op" id="3383040">(</span><span class="ident" id="3383041">dst</span><span class="op" id="3383044">,</span>&nbsp;<span class="ident" id="3383046">src</span><span class="op" id="3383049">[</span><span class="ident" id="3383050">match</span><span class="op" id="3383055">[</span><span class="num" id="3383056">2</span><span class="op" id="3383057">*</span><span class="ident" id="3383058">num</span><span class="op" id="3383061">]</span><span class="op" id="3383062">:</span><span class="ident" id="3383063">match</span><span class="op" id="3383068">[</span><span class="num" id="3383069">2</span><span class="op" id="3383070">*</span><span class="ident" id="3383071">num</span><span class="op" id="3383074">+</span><span class="num" id="3383075">1</span><span class="op" id="3383076">]</span><span class="op" id="3383077">]</span><span class="op" id="3383078">...</span><span class="op" id="3383081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3383087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3383092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3383096">}</span>&nbsp;<span class="keyword" id="3383098">else</span>&nbsp;<span class="op" id="3383103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383108">for</span>&nbsp;<span class="ident" id="3383112">i</span><span class="op" id="3383113">,</span>&nbsp;<span class="ident" id="3383115">namei</span>&nbsp;<span class="op" id="3383121">:=</span>&nbsp;<span class="keyword" id="3383124">range</span>&nbsp;<span class="ident" id="3383130">re</span><span class="op" id="3383132">.</span><span class="ident" id="3383133">subexpNames</span>&nbsp;<span class="op" id="3383145">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383151">if</span>&nbsp;<span class="ident" id="3383154">name</span>&nbsp;<span class="op" id="3383159">==</span>&nbsp;<span class="ident" id="3383162">namei</span>&nbsp;<span class="op" id="3383168">&amp;&amp;</span>&nbsp;<span class="num" id="3383171">2</span><span class="op" id="3383172">*</span><span class="ident" id="3383173">i</span><span class="op" id="3383174">+</span><span class="num" id="3383175">1</span>&nbsp;<span class="op" id="3383177">&lt;</span>&nbsp;<span class="builtinfunc" id="3383179">len</span><span class="op" id="3383182">(</span><span class="ident" id="3383183">match</span><span class="op" id="3383188">)</span>&nbsp;<span class="op" id="3383190">&amp;&amp;</span>&nbsp;<span class="ident" id="3383193">match</span><span class="op" id="3383198">[</span><span class="num" id="3383199">2</span><span class="op" id="3383200">*</span><span class="ident" id="3383201">i</span><span class="op" id="3383202">]</span>&nbsp;<span class="op" id="3383204">&gt;=</span>&nbsp;<span class="num" id="3383207">0</span>&nbsp;<span class="op" id="3383209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383216">if</span>&nbsp;<span class="ident" id="3383219">bsrc</span>&nbsp;<span class="op" id="3383224">!=</span>&nbsp;<span class="ident" id="3383227">nil</span>&nbsp;<span class="op" id="3383231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383239">dst</span>&nbsp;<span class="op" id="3383243">=</span>&nbsp;<span class="builtinfunc" id="3383245">append</span><span class="op" id="3383251">(</span><span class="ident" id="3383252">dst</span><span class="op" id="3383255">,</span>&nbsp;<span class="ident" id="3383257">bsrc</span><span class="op" id="3383261">[</span><span class="ident" id="3383262">match</span><span class="op" id="3383267">[</span><span class="num" id="3383268">2</span><span class="op" id="3383269">*</span><span class="ident" id="3383270">i</span><span class="op" id="3383271">]</span><span class="op" id="3383272">:</span><span class="ident" id="3383273">match</span><span class="op" id="3383278">[</span><span class="num" id="3383279">2</span><span class="op" id="3383280">*</span><span class="ident" id="3383281">i</span><span class="op" id="3383282">+</span><span class="num" id="3383283">1</span><span class="op" id="3383284">]</span><span class="op" id="3383285">]</span><span class="op" id="3383286">...</span><span class="op" id="3383289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3383296">}</span>&nbsp;<span class="keyword" id="3383298">else</span>&nbsp;<span class="op" id="3383303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383311">dst</span>&nbsp;<span class="op" id="3383315">=</span>&nbsp;<span class="builtinfunc" id="3383317">append</span><span class="op" id="3383323">(</span><span class="ident" id="3383324">dst</span><span class="op" id="3383327">,</span>&nbsp;<span class="ident" id="3383329">src</span><span class="op" id="3383332">[</span><span class="ident" id="3383333">match</span><span class="op" id="3383338">[</span><span class="num" id="3383339">2</span><span class="op" id="3383340">*</span><span class="ident" id="3383341">i</span><span class="op" id="3383342">]</span><span class="op" id="3383343">:</span><span class="ident" id="3383344">match</span><span class="op" id="3383349">[</span><span class="num" id="3383350">2</span><span class="op" id="3383351">*</span><span class="ident" id="3383352">i</span><span class="op" id="3383353">+</span><span class="num" id="3383354">1</span><span class="op" id="3383355">]</span><span class="op" id="3383356">]</span><span class="op" id="3383357">...</span><span class="op" id="3383360">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3383367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383374">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3383384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3383389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3383393">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3383396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383399">dst</span>&nbsp;<span class="op" id="3383403">=</span>&nbsp;<span class="builtinfunc" id="3383405">append</span><span class="op" id="3383411">(</span><span class="ident" id="3383412">dst</span><span class="op" id="3383415">,</span>&nbsp;<span class="ident" id="3383417">template</span><span class="op" id="3383425">...</span><span class="op" id="3383428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383431">return</span>&nbsp;<span class="ident" id="3383438">dst</span><br>
<span class="lineno"></span><span class="op" id="3383442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span><span class="comment" id="3383445">//&nbsp;extract&nbsp;returns&nbsp;the&nbsp;name&nbsp;from&nbsp;a&nbsp;leading&nbsp;&#34;$name&#34;&nbsp;or&nbsp;&#34;${name}&#34;&nbsp;in&nbsp;str.</span><br>
<span class="lineno"></span><span class="comment" id="3383517">//&nbsp;If&nbsp;it&nbsp;is&nbsp;a&nbsp;number,&nbsp;extract&nbsp;returns&nbsp;num&nbsp;set&nbsp;to&nbsp;that&nbsp;number;&nbsp;otherwise&nbsp;num&nbsp;=&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="3383599">func</span>&nbsp;<span class="ident" id="3383604">extract</span><span class="op" id="3383611">(</span><span class="ident" id="3383612">str</span>&nbsp;<span class="builtintype" id="3383616">string</span><span class="op" id="3383622">)</span>&nbsp;<span class="op" id="3383624">(</span><span class="ident" id="3383625">name</span>&nbsp;<span class="builtintype" id="3383630">string</span><span class="op" id="3383636">,</span>&nbsp;<span class="ident" id="3383638">num</span>&nbsp;<span class="builtintype" id="3383642">int</span><span class="op" id="3383645">,</span>&nbsp;<span class="ident" id="3383647">rest</span>&nbsp;<span class="builtintype" id="3383652">string</span><span class="op" id="3383658">,</span>&nbsp;<span class="ident" id="3383660">ok</span>&nbsp;<span class="builtintype" id="3383663">bool</span><span class="op" id="3383667">)</span>&nbsp;<span class="op" id="3383669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383672">if</span>&nbsp;<span class="builtinfunc" id="3383675">len</span><span class="op" id="3383678">(</span><span class="ident" id="3383679">str</span><span class="op" id="3383682">)</span>&nbsp;<span class="op" id="3383684">&lt;</span>&nbsp;<span class="num" id="3383686">2</span>&nbsp;<span class="op" id="3383688">||</span>&nbsp;<span class="ident" id="3383691">str</span><span class="op" id="3383694">[</span><span class="num" id="3383695">0</span><span class="op" id="3383696">]</span>&nbsp;<span class="op" id="3383698">!=</span>&nbsp;<span class="string" id="3383701">&#39;$&#39;</span>&nbsp;<span class="op" id="3383705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383709">return</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3383717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383720">brace</span>&nbsp;<span class="op" id="3383726">:=</span>&nbsp;<span class="builtintype" id="3383729">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383736">if</span>&nbsp;<span class="ident" id="3383739">str</span><span class="op" id="3383742">[</span><span class="num" id="3383743">1</span><span class="op" id="3383744">]</span>&nbsp;<span class="op" id="3383746">==</span>&nbsp;<span class="string" id="3383749">&#39;{&#39;</span>&nbsp;<span class="op" id="3383753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383757">brace</span>&nbsp;<span class="op" id="3383763">=</span>&nbsp;<span class="builtintype" id="3383765">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383772">str</span>&nbsp;<span class="op" id="3383776">=</span>&nbsp;<span class="ident" id="3383778">str</span><span class="op" id="3383781">[</span><span class="num" id="3383782">2</span><span class="op" id="3383783">:</span><span class="op" id="3383784">]</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3383787">}</span>&nbsp;<span class="keyword" id="3383789">else</span>&nbsp;<span class="op" id="3383794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383798">str</span>&nbsp;<span class="op" id="3383802">=</span>&nbsp;<span class="ident" id="3383804">str</span><span class="op" id="3383807">[</span><span class="num" id="3383808">1</span><span class="op" id="3383809">:</span><span class="op" id="3383810">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3383813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383816">i</span>&nbsp;<span class="op" id="3383818">:=</span>&nbsp;<span class="num" id="3383821">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383824">for</span>&nbsp;<span class="ident" id="3383828">i</span>&nbsp;<span class="op" id="3383830">&lt;</span>&nbsp;<span class="builtinfunc" id="3383832">len</span><span class="op" id="3383835">(</span><span class="ident" id="3383836">str</span><span class="op" id="3383839">)</span>&nbsp;<span class="op" id="3383841">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3383845">rune</span><span class="op" id="3383849">,</span>&nbsp;<span class="ident" id="3383851">size</span>&nbsp;<span class="op" id="3383856">:=</span>&nbsp;<span class="ident" id="3383859">utf8</span><span class="op" id="3383863">.</span><span class="ident" id="3383864">DecodeRuneInString</span><span class="op" id="3383882">(</span><span class="ident" id="3383883">str</span><span class="op" id="3383886">[</span><span class="ident" id="3383887">i</span><span class="op" id="3383888">:</span><span class="op" id="3383889">]</span><span class="op" id="3383890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383894">if</span>&nbsp;<span class="op" id="3383897">!</span><span class="ident" id="3383898">unicode</span><span class="op" id="3383905">.</span><span class="ident" id="3383906">IsLetter</span><span class="op" id="3383914">(</span><span class="builtintype" id="3383915">rune</span><span class="op" id="3383919">)</span>&nbsp;<span class="op" id="3383921">&amp;&amp;</span>&nbsp;<span class="op" id="3383924">!</span><span class="ident" id="3383925">unicode</span><span class="op" id="3383932">.</span><span class="ident" id="3383933">IsDigit</span><span class="op" id="3383940">(</span><span class="builtintype" id="3383941">rune</span><span class="op" id="3383945">)</span>&nbsp;<span class="op" id="3383947">&amp;&amp;</span>&nbsp;<span class="builtintype" id="3383950">rune</span>&nbsp;<span class="op" id="3383955">!=</span>&nbsp;<span class="string" id="3383958">&#39;_&#39;</span>&nbsp;<span class="op" id="3383962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383967">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3383975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383979">i</span>&nbsp;<span class="op" id="3383981">+=</span>&nbsp;<span class="ident" id="3383984">size</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3383990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383993">if</span>&nbsp;<span class="ident" id="3383996">i</span>&nbsp;<span class="op" id="3383998">==</span>&nbsp;<span class="num" id="3384001">0</span>&nbsp;<span class="op" id="3384003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3384007">//&nbsp;empty&nbsp;name&nbsp;is&nbsp;not&nbsp;okay</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3384035">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3384043">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3384046">name</span>&nbsp;<span class="op" id="3384051">=</span>&nbsp;<span class="ident" id="3384053">str</span><span class="op" id="3384056">[</span><span class="op" id="3384057">:</span><span class="ident" id="3384058">i</span><span class="op" id="3384059">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3384062">if</span>&nbsp;<span class="ident" id="3384065">brace</span>&nbsp;<span class="op" id="3384071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3384075">if</span>&nbsp;<span class="ident" id="3384078">i</span>&nbsp;<span class="op" id="3384080">&gt;=</span>&nbsp;<span class="builtinfunc" id="3384083">len</span><span class="op" id="3384086">(</span><span class="ident" id="3384087">str</span><span class="op" id="3384090">)</span>&nbsp;<span class="op" id="3384092">||</span>&nbsp;<span class="ident" id="3384095">str</span><span class="op" id="3384098">[</span><span class="ident" id="3384099">i</span><span class="op" id="3384100">]</span>&nbsp;<span class="op" id="3384102">!=</span>&nbsp;<span class="string" id="3384105">&#39;}&#39;</span>&nbsp;<span class="op" id="3384109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3384114">//&nbsp;missing&nbsp;closing&nbsp;brace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3384142">return</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3384151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3384155">i</span><span class="op" id="3384156">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3384160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3384164">//&nbsp;Parse&nbsp;number.</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3384182">num</span>&nbsp;<span class="op" id="3384186">=</span>&nbsp;<span class="num" id="3384188">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3384191">for</span>&nbsp;<span class="ident" id="3384195">i</span>&nbsp;<span class="op" id="3384197">:=</span>&nbsp;<span class="num" id="3384200">0</span><span class="op" id="3384201">;</span>&nbsp;<span class="ident" id="3384203">i</span>&nbsp;<span class="op" id="3384205">&lt;</span>&nbsp;<span class="builtinfunc" id="3384207">len</span><span class="op" id="3384210">(</span><span class="ident" id="3384211">name</span><span class="op" id="3384215">)</span><span class="op" id="3384216">;</span>&nbsp;<span class="ident" id="3384218">i</span><span class="op" id="3384219">++</span>&nbsp;<span class="op" id="3384222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3384226">if</span>&nbsp;<span class="ident" id="3384229">name</span><span class="op" id="3384233">[</span><span class="ident" id="3384234">i</span><span class="op" id="3384235">]</span>&nbsp;<span class="op" id="3384237">&lt;</span>&nbsp;<span class="string" id="3384239">&#39;0&#39;</span>&nbsp;<span class="op" id="3384243">||</span>&nbsp;<span class="string" id="3384246">&#39;9&#39;</span>&nbsp;<span class="op" id="3384250">&lt;</span>&nbsp;<span class="ident" id="3384252">name</span><span class="op" id="3384256">[</span><span class="ident" id="3384257">i</span><span class="op" id="3384258">]</span>&nbsp;<span class="op" id="3384260">||</span>&nbsp;<span class="ident" id="3384263">num</span>&nbsp;<span class="op" id="3384267">&gt;=</span>&nbsp;<span class="num" id="3384270">1e8</span>&nbsp;<span class="op" id="3384274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3384279">num</span>&nbsp;<span class="op" id="3384283">=</span>&nbsp;<span class="op" id="3384285">-</span><span class="num" id="3384286">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3384291">break</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3384299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3384303">num</span>&nbsp;<span class="op" id="3384307">=</span>&nbsp;<span class="ident" id="3384309">num</span><span class="op" id="3384312">*</span><span class="num" id="3384313">10</span>&nbsp;<span class="op" id="3384316">+</span>&nbsp;<span class="builtintype" id="3384318">int</span><span class="op" id="3384321">(</span><span class="ident" id="3384322">name</span><span class="op" id="3384326">[</span><span class="ident" id="3384327">i</span><span class="op" id="3384328">]</span><span class="op" id="3384329">)</span>&nbsp;<span class="op" id="3384331">-</span>&nbsp;<span class="string" id="3384333">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3384338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3384341">//&nbsp;Disallow&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3384369">if</span>&nbsp;<span class="ident" id="3384372">name</span><span class="op" id="3384376">[</span><span class="num" id="3384377">0</span><span class="op" id="3384378">]</span>&nbsp;<span class="op" id="3384380">==</span>&nbsp;<span class="string" id="3384383">&#39;0&#39;</span>&nbsp;<span class="op" id="3384387">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3384390">len</span><span class="op" id="3384393">(</span><span class="ident" id="3384394">name</span><span class="op" id="3384398">)</span>&nbsp;<span class="op" id="3384400">&gt;</span>&nbsp;<span class="num" id="3384402">1</span>&nbsp;<span class="op" id="3384404">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3384408">num</span>&nbsp;<span class="op" id="3384412">=</span>&nbsp;<span class="op" id="3384414">-</span><span class="num" id="3384415">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3384418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3384422">rest</span>&nbsp;<span class="op" id="3384427">=</span>&nbsp;<span class="ident" id="3384429">str</span><span class="op" id="3384432">[</span><span class="ident" id="3384433">i</span><span class="op" id="3384434">:</span><span class="op" id="3384435">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3384438">ok</span>&nbsp;<span class="op" id="3384441">=</span>&nbsp;<span class="builtintype" id="3384443">true</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3384449">return</span><br>
<span class="lineno"></span><span class="op" id="3384456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3384459">//&nbsp;FindSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs&nbsp;identifying&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3384536">//&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;b&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of</span><br>
<span class="lineno">870</span><span class="comment" id="3384613">//&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and&nbsp;&#39;Index&#39;&nbsp;descriptions</span><br>
<span class="lineno"></span><span class="comment" id="3384690">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3384717">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3384762">func</span>&nbsp;<span class="op" id="3384767">(</span><span class="ident" id="3384768">re</span>&nbsp;<span class="op" id="3384771">*</span><span class="ident" id="3384772">Regexp</span><span class="op" id="3384778">)</span>&nbsp;<span class="ident" id="3384780">FindSubmatchIndex</span><span class="op" id="3384797">(</span><span class="ident" id="3384798">b</span>&nbsp;<span class="op" id="3384800">[</span><span class="op" id="3384801">]</span><span class="builtintype" id="3384802">byte</span><span class="op" id="3384806">)</span>&nbsp;<span class="op" id="3384808">[</span><span class="op" id="3384809">]</span><span class="builtintype" id="3384810">int</span>&nbsp;<span class="op" id="3384814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3384817">return</span>&nbsp;<span class="ident" id="3384824">re</span><span class="op" id="3384826">.</span><span class="ident" id="3384827">pad</span><span class="op" id="3384830">(</span><span class="ident" id="3384831">re</span><span class="op" id="3384833">.</span><span class="ident" id="3384834">doExecute</span><span class="op" id="3384843">(</span><span class="ident" id="3384844">nil</span><span class="op" id="3384847">,</span>&nbsp;<span class="ident" id="3384849">b</span><span class="op" id="3384850">,</span>&nbsp;<span class="string" id="3384852">&#34;&#34;</span><span class="op" id="3384854">,</span>&nbsp;<span class="num" id="3384856">0</span><span class="op" id="3384857">,</span>&nbsp;<span class="ident" id="3384859">re</span><span class="op" id="3384861">.</span><span class="ident" id="3384862">prog</span><span class="op" id="3384866">.</span><span class="ident" id="3384867">NumCap</span><span class="op" id="3384873">)</span><span class="op" id="3384874">)</span><br>
<span class="lineno">875</span><span class="op" id="3384876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3384879">//&nbsp;FindStringSubmatch&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3384952">//&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;s&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3385029">//&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;description&nbsp;in&nbsp;the</span><br>
<span class="lineno">880</span><span class="comment" id="3385100">//&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3385120">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3385165">func</span>&nbsp;<span class="op" id="3385170">(</span><span class="ident" id="3385171">re</span>&nbsp;<span class="op" id="3385174">*</span><span class="ident" id="3385175">Regexp</span><span class="op" id="3385181">)</span>&nbsp;<span class="ident" id="3385183">FindStringSubmatch</span><span class="op" id="3385201">(</span><span class="ident" id="3385202">s</span>&nbsp;<span class="builtintype" id="3385204">string</span><span class="op" id="3385210">)</span>&nbsp;<span class="op" id="3385212">[</span><span class="op" id="3385213">]</span><span class="builtintype" id="3385214">string</span>&nbsp;<span class="op" id="3385221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385224">a</span>&nbsp;<span class="op" id="3385226">:=</span>&nbsp;<span class="ident" id="3385229">re</span><span class="op" id="3385231">.</span><span class="ident" id="3385232">doExecute</span><span class="op" id="3385241">(</span><span class="ident" id="3385242">nil</span><span class="op" id="3385245">,</span>&nbsp;<span class="ident" id="3385247">nil</span><span class="op" id="3385250">,</span>&nbsp;<span class="ident" id="3385252">s</span><span class="op" id="3385253">,</span>&nbsp;<span class="num" id="3385255">0</span><span class="op" id="3385256">,</span>&nbsp;<span class="ident" id="3385258">re</span><span class="op" id="3385260">.</span><span class="ident" id="3385261">prog</span><span class="op" id="3385265">.</span><span class="ident" id="3385266">NumCap</span><span class="op" id="3385272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385275">if</span>&nbsp;<span class="ident" id="3385278">a</span>&nbsp;<span class="op" id="3385280">==</span>&nbsp;<span class="ident" id="3385283">nil</span>&nbsp;<span class="op" id="3385287">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385291">return</span>&nbsp;<span class="ident" id="3385298">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3385303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385306">ret</span>&nbsp;<span class="op" id="3385310">:=</span>&nbsp;<span class="builtinfunc" id="3385313">make</span><span class="op" id="3385317">(</span><span class="op" id="3385318">[</span><span class="op" id="3385319">]</span><span class="builtintype" id="3385320">string</span><span class="op" id="3385326">,</span>&nbsp;<span class="num" id="3385328">1</span><span class="op" id="3385329">+</span><span class="ident" id="3385330">re</span><span class="op" id="3385332">.</span><span class="ident" id="3385333">numSubexp</span><span class="op" id="3385342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385345">for</span>&nbsp;<span class="ident" id="3385349">i</span>&nbsp;<span class="op" id="3385351">:=</span>&nbsp;<span class="keyword" id="3385354">range</span>&nbsp;<span class="ident" id="3385360">ret</span>&nbsp;<span class="op" id="3385364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385368">if</span>&nbsp;<span class="num" id="3385371">2</span><span class="op" id="3385372">*</span><span class="ident" id="3385373">i</span>&nbsp;<span class="op" id="3385375">&lt;</span>&nbsp;<span class="builtinfunc" id="3385377">len</span><span class="op" id="3385380">(</span><span class="ident" id="3385381">a</span><span class="op" id="3385382">)</span>&nbsp;<span class="op" id="3385384">&amp;&amp;</span>&nbsp;<span class="ident" id="3385387">a</span><span class="op" id="3385388">[</span><span class="num" id="3385389">2</span><span class="op" id="3385390">*</span><span class="ident" id="3385391">i</span><span class="op" id="3385392">]</span>&nbsp;<span class="op" id="3385394">&gt;=</span>&nbsp;<span class="num" id="3385397">0</span>&nbsp;<span class="op" id="3385399">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385404">ret</span><span class="op" id="3385407">[</span><span class="ident" id="3385408">i</span><span class="op" id="3385409">]</span>&nbsp;<span class="op" id="3385411">=</span>&nbsp;<span class="ident" id="3385413">s</span><span class="op" id="3385414">[</span><span class="ident" id="3385415">a</span><span class="op" id="3385416">[</span><span class="num" id="3385417">2</span><span class="op" id="3385418">*</span><span class="ident" id="3385419">i</span><span class="op" id="3385420">]</span><span class="op" id="3385421">:</span><span class="ident" id="3385422">a</span><span class="op" id="3385423">[</span><span class="num" id="3385424">2</span><span class="op" id="3385425">*</span><span class="ident" id="3385426">i</span><span class="op" id="3385427">+</span><span class="num" id="3385428">1</span><span class="op" id="3385429">]</span><span class="op" id="3385430">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3385434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3385437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385440">return</span>&nbsp;<span class="ident" id="3385447">ret</span><br>
<span class="lineno"></span><span class="op" id="3385451">}</span><br>
<span class="lineno">895</span><br>
<span class="lineno"></span><span class="comment" id="3385454">//&nbsp;FindStringSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="3385521">//&nbsp;identifying&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;s&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3385594">//&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3385670">//&nbsp;&#39;Index&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">900</span><span class="comment" id="3385718">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3385763">func</span>&nbsp;<span class="op" id="3385768">(</span><span class="ident" id="3385769">re</span>&nbsp;<span class="op" id="3385772">*</span><span class="ident" id="3385773">Regexp</span><span class="op" id="3385779">)</span>&nbsp;<span class="ident" id="3385781">FindStringSubmatchIndex</span><span class="op" id="3385804">(</span><span class="ident" id="3385805">s</span>&nbsp;<span class="builtintype" id="3385807">string</span><span class="op" id="3385813">)</span>&nbsp;<span class="op" id="3385815">[</span><span class="op" id="3385816">]</span><span class="builtintype" id="3385817">int</span>&nbsp;<span class="op" id="3385821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385824">return</span>&nbsp;<span class="ident" id="3385831">re</span><span class="op" id="3385833">.</span><span class="ident" id="3385834">pad</span><span class="op" id="3385837">(</span><span class="ident" id="3385838">re</span><span class="op" id="3385840">.</span><span class="ident" id="3385841">doExecute</span><span class="op" id="3385850">(</span><span class="ident" id="3385851">nil</span><span class="op" id="3385854">,</span>&nbsp;<span class="ident" id="3385856">nil</span><span class="op" id="3385859">,</span>&nbsp;<span class="ident" id="3385861">s</span><span class="op" id="3385862">,</span>&nbsp;<span class="num" id="3385864">0</span><span class="op" id="3385865">,</span>&nbsp;<span class="ident" id="3385867">re</span><span class="op" id="3385869">.</span><span class="ident" id="3385870">prog</span><span class="op" id="3385874">.</span><span class="ident" id="3385875">NumCap</span><span class="op" id="3385881">)</span><span class="op" id="3385882">)</span><br>
<span class="lineno"></span><span class="op" id="3385884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="3385887">//&nbsp;FindReaderSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="3385954">//&nbsp;identifying&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;of&nbsp;text&nbsp;read&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="3386030">//&nbsp;the&nbsp;RuneReader,&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined</span><br>
<span class="lineno"></span><span class="comment" id="3386108">//&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and&nbsp;&#39;Index&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.&nbsp;&nbsp;A</span><br>
<span class="lineno"></span><span class="comment" id="3386181">//&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">910</span><span class="keyword" id="3386224">func</span>&nbsp;<span class="op" id="3386229">(</span><span class="ident" id="3386230">re</span>&nbsp;<span class="op" id="3386233">*</span><span class="ident" id="3386234">Regexp</span><span class="op" id="3386240">)</span>&nbsp;<span class="ident" id="3386242">FindReaderSubmatchIndex</span><span class="op" id="3386265">(</span><span class="ident" id="3386266">r</span>&nbsp;<span class="ident" id="3386268">io</span><span class="op" id="3386270">.</span><span class="ident" id="3386271">RuneReader</span><span class="op" id="3386281">)</span>&nbsp;<span class="op" id="3386283">[</span><span class="op" id="3386284">]</span><span class="builtintype" id="3386285">int</span>&nbsp;<span class="op" id="3386289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386292">return</span>&nbsp;<span class="ident" id="3386299">re</span><span class="op" id="3386301">.</span><span class="ident" id="3386302">pad</span><span class="op" id="3386305">(</span><span class="ident" id="3386306">re</span><span class="op" id="3386308">.</span><span class="ident" id="3386309">doExecute</span><span class="op" id="3386318">(</span><span class="ident" id="3386319">r</span><span class="op" id="3386320">,</span>&nbsp;<span class="ident" id="3386322">nil</span><span class="op" id="3386325">,</span>&nbsp;<span class="string" id="3386327">&#34;&#34;</span><span class="op" id="3386329">,</span>&nbsp;<span class="num" id="3386331">0</span><span class="op" id="3386332">,</span>&nbsp;<span class="ident" id="3386334">re</span><span class="op" id="3386336">.</span><span class="ident" id="3386337">prog</span><span class="op" id="3386341">.</span><span class="ident" id="3386342">NumCap</span><span class="op" id="3386348">)</span><span class="op" id="3386349">)</span><br>
<span class="lineno"></span><span class="op" id="3386351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3386354">const</span>&nbsp;<span class="ident" id="3386360">startSize</span>&nbsp;<span class="op" id="3386370">=</span>&nbsp;<span class="num" id="3386372">10</span>&nbsp;<span class="comment" id="3386375">//&nbsp;The&nbsp;size&nbsp;at&nbsp;which&nbsp;to&nbsp;start&nbsp;a&nbsp;slice&nbsp;in&nbsp;the&nbsp;&#39;All&#39;&nbsp;routines.</span><br>
<span class="lineno">915</span><br>
<span class="lineno"></span><span class="comment" id="3386437">//&nbsp;FindAll&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;Find;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive</span><br>
<span class="lineno"></span><span class="comment" id="3386515">//&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3386588">//&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3386608">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">920</span><span class="keyword" id="3386653">func</span>&nbsp;<span class="op" id="3386658">(</span><span class="ident" id="3386659">re</span>&nbsp;<span class="op" id="3386662">*</span><span class="ident" id="3386663">Regexp</span><span class="op" id="3386669">)</span>&nbsp;<span class="ident" id="3386671">FindAll</span><span class="op" id="3386678">(</span><span class="ident" id="3386679">b</span>&nbsp;<span class="op" id="3386681">[</span><span class="op" id="3386682">]</span><span class="builtintype" id="3386683">byte</span><span class="op" id="3386687">,</span>&nbsp;<span class="ident" id="3386689">n</span>&nbsp;<span class="builtintype" id="3386691">int</span><span class="op" id="3386694">)</span>&nbsp;<span class="op" id="3386696">[</span><span class="op" id="3386697">]</span><span class="op" id="3386698">[</span><span class="op" id="3386699">]</span><span class="builtintype" id="3386700">byte</span>&nbsp;<span class="op" id="3386705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386708">if</span>&nbsp;<span class="ident" id="3386711">n</span>&nbsp;<span class="op" id="3386713">&lt;</span>&nbsp;<span class="num" id="3386715">0</span>&nbsp;<span class="op" id="3386717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3386721">n</span>&nbsp;<span class="op" id="3386723">=</span>&nbsp;<span class="builtinfunc" id="3386725">len</span><span class="op" id="3386728">(</span><span class="ident" id="3386729">b</span><span class="op" id="3386730">)</span>&nbsp;<span class="op" id="3386732">+</span>&nbsp;<span class="num" id="3386734">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3386737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3386740">result</span>&nbsp;<span class="op" id="3386747">:=</span>&nbsp;<span class="builtinfunc" id="3386750">make</span><span class="op" id="3386754">(</span><span class="op" id="3386755">[</span><span class="op" id="3386756">]</span><span class="op" id="3386757">[</span><span class="op" id="3386758">]</span><span class="builtintype" id="3386759">byte</span><span class="op" id="3386763">,</span>&nbsp;<span class="num" id="3386765">0</span><span class="op" id="3386766">,</span>&nbsp;<span class="ident" id="3386768">startSize</span><span class="op" id="3386777">)</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3386780">re</span><span class="op" id="3386782">.</span><span class="ident" id="3386783">allMatches</span><span class="op" id="3386793">(</span><span class="string" id="3386794">&#34;&#34;</span><span class="op" id="3386796">,</span>&nbsp;<span class="ident" id="3386798">b</span><span class="op" id="3386799">,</span>&nbsp;<span class="ident" id="3386801">n</span><span class="op" id="3386802">,</span>&nbsp;<span class="keyword" id="3386804">func</span><span class="op" id="3386808">(</span><span class="ident" id="3386809">match</span>&nbsp;<span class="op" id="3386815">[</span><span class="op" id="3386816">]</span><span class="builtintype" id="3386817">int</span><span class="op" id="3386820">)</span>&nbsp;<span class="op" id="3386822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3386826">result</span>&nbsp;<span class="op" id="3386833">=</span>&nbsp;<span class="builtinfunc" id="3386835">append</span><span class="op" id="3386841">(</span><span class="ident" id="3386842">result</span><span class="op" id="3386848">,</span>&nbsp;<span class="ident" id="3386850">b</span><span class="op" id="3386851">[</span><span class="ident" id="3386852">match</span><span class="op" id="3386857">[</span><span class="num" id="3386858">0</span><span class="op" id="3386859">]</span><span class="op" id="3386860">:</span><span class="ident" id="3386861">match</span><span class="op" id="3386866">[</span><span class="num" id="3386867">1</span><span class="op" id="3386868">]</span><span class="op" id="3386869">]</span><span class="op" id="3386870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3386873">}</span><span class="op" id="3386874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386877">if</span>&nbsp;<span class="builtinfunc" id="3386880">len</span><span class="op" id="3386883">(</span><span class="ident" id="3386884">result</span><span class="op" id="3386890">)</span>&nbsp;<span class="op" id="3386892">==</span>&nbsp;<span class="num" id="3386895">0</span>&nbsp;<span class="op" id="3386897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386901">return</span>&nbsp;<span class="ident" id="3386908">nil</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3386913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386916">return</span>&nbsp;<span class="ident" id="3386923">result</span><br>
<span class="lineno"></span><span class="op" id="3386930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3386933">//&nbsp;FindAllIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindIndex;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all</span><br>
<span class="lineno">935</span><span class="comment" id="3387010">//&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description</span><br>
<span class="lineno"></span><span class="comment" id="3387087">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3387114">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3387159">func</span>&nbsp;<span class="op" id="3387164">(</span><span class="ident" id="3387165">re</span>&nbsp;<span class="op" id="3387168">*</span><span class="ident" id="3387169">Regexp</span><span class="op" id="3387175">)</span>&nbsp;<span class="ident" id="3387177">FindAllIndex</span><span class="op" id="3387189">(</span><span class="ident" id="3387190">b</span>&nbsp;<span class="op" id="3387192">[</span><span class="op" id="3387193">]</span><span class="builtintype" id="3387194">byte</span><span class="op" id="3387198">,</span>&nbsp;<span class="ident" id="3387200">n</span>&nbsp;<span class="builtintype" id="3387202">int</span><span class="op" id="3387205">)</span>&nbsp;<span class="op" id="3387207">[</span><span class="op" id="3387208">]</span><span class="op" id="3387209">[</span><span class="op" id="3387210">]</span><span class="builtintype" id="3387211">int</span>&nbsp;<span class="op" id="3387215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387218">if</span>&nbsp;<span class="ident" id="3387221">n</span>&nbsp;<span class="op" id="3387223">&lt;</span>&nbsp;<span class="num" id="3387225">0</span>&nbsp;<span class="op" id="3387227">{</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387231">n</span>&nbsp;<span class="op" id="3387233">=</span>&nbsp;<span class="builtinfunc" id="3387235">len</span><span class="op" id="3387238">(</span><span class="ident" id="3387239">b</span><span class="op" id="3387240">)</span>&nbsp;<span class="op" id="3387242">+</span>&nbsp;<span class="num" id="3387244">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387250">result</span>&nbsp;<span class="op" id="3387257">:=</span>&nbsp;<span class="builtinfunc" id="3387260">make</span><span class="op" id="3387264">(</span><span class="op" id="3387265">[</span><span class="op" id="3387266">]</span><span class="op" id="3387267">[</span><span class="op" id="3387268">]</span><span class="builtintype" id="3387269">int</span><span class="op" id="3387272">,</span>&nbsp;<span class="num" id="3387274">0</span><span class="op" id="3387275">,</span>&nbsp;<span class="ident" id="3387277">startSize</span><span class="op" id="3387286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387289">re</span><span class="op" id="3387291">.</span><span class="ident" id="3387292">allMatches</span><span class="op" id="3387302">(</span><span class="string" id="3387303">&#34;&#34;</span><span class="op" id="3387305">,</span>&nbsp;<span class="ident" id="3387307">b</span><span class="op" id="3387308">,</span>&nbsp;<span class="ident" id="3387310">n</span><span class="op" id="3387311">,</span>&nbsp;<span class="keyword" id="3387313">func</span><span class="op" id="3387317">(</span><span class="ident" id="3387318">match</span>&nbsp;<span class="op" id="3387324">[</span><span class="op" id="3387325">]</span><span class="builtintype" id="3387326">int</span><span class="op" id="3387329">)</span>&nbsp;<span class="op" id="3387331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387335">result</span>&nbsp;<span class="op" id="3387342">=</span>&nbsp;<span class="builtinfunc" id="3387344">append</span><span class="op" id="3387350">(</span><span class="ident" id="3387351">result</span><span class="op" id="3387357">,</span>&nbsp;<span class="ident" id="3387359">match</span><span class="op" id="3387364">[</span><span class="num" id="3387365">0</span><span class="op" id="3387366">:</span><span class="num" id="3387367">2</span><span class="op" id="3387368">]</span><span class="op" id="3387369">)</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387372">}</span><span class="op" id="3387373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387376">if</span>&nbsp;<span class="builtinfunc" id="3387379">len</span><span class="op" id="3387382">(</span><span class="ident" id="3387383">result</span><span class="op" id="3387389">)</span>&nbsp;<span class="op" id="3387391">==</span>&nbsp;<span class="num" id="3387394">0</span>&nbsp;<span class="op" id="3387396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387400">return</span>&nbsp;<span class="ident" id="3387407">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387415">return</span>&nbsp;<span class="ident" id="3387422">result</span><br>
<span class="lineno">950</span><span class="op" id="3387429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3387432">//&nbsp;FindAllString&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindString;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="3387511">//&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description</span><br>
<span class="lineno"></span><span class="comment" id="3387588">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">955</span><span class="comment" id="3387615">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3387660">func</span>&nbsp;<span class="op" id="3387665">(</span><span class="ident" id="3387666">re</span>&nbsp;<span class="op" id="3387669">*</span><span class="ident" id="3387670">Regexp</span><span class="op" id="3387676">)</span>&nbsp;<span class="ident" id="3387678">FindAllString</span><span class="op" id="3387691">(</span><span class="ident" id="3387692">s</span>&nbsp;<span class="builtintype" id="3387694">string</span><span class="op" id="3387700">,</span>&nbsp;<span class="ident" id="3387702">n</span>&nbsp;<span class="builtintype" id="3387704">int</span><span class="op" id="3387707">)</span>&nbsp;<span class="op" id="3387709">[</span><span class="op" id="3387710">]</span><span class="builtintype" id="3387711">string</span>&nbsp;<span class="op" id="3387718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387721">if</span>&nbsp;<span class="ident" id="3387724">n</span>&nbsp;<span class="op" id="3387726">&lt;</span>&nbsp;<span class="num" id="3387728">0</span>&nbsp;<span class="op" id="3387730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387734">n</span>&nbsp;<span class="op" id="3387736">=</span>&nbsp;<span class="builtinfunc" id="3387738">len</span><span class="op" id="3387741">(</span><span class="ident" id="3387742">s</span><span class="op" id="3387743">)</span>&nbsp;<span class="op" id="3387745">+</span>&nbsp;<span class="num" id="3387747">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387750">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387753">result</span>&nbsp;<span class="op" id="3387760">:=</span>&nbsp;<span class="builtinfunc" id="3387763">make</span><span class="op" id="3387767">(</span><span class="op" id="3387768">[</span><span class="op" id="3387769">]</span><span class="builtintype" id="3387770">string</span><span class="op" id="3387776">,</span>&nbsp;<span class="num" id="3387778">0</span><span class="op" id="3387779">,</span>&nbsp;<span class="ident" id="3387781">startSize</span><span class="op" id="3387790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387793">re</span><span class="op" id="3387795">.</span><span class="ident" id="3387796">allMatches</span><span class="op" id="3387806">(</span><span class="ident" id="3387807">s</span><span class="op" id="3387808">,</span>&nbsp;<span class="ident" id="3387810">nil</span><span class="op" id="3387813">,</span>&nbsp;<span class="ident" id="3387815">n</span><span class="op" id="3387816">,</span>&nbsp;<span class="keyword" id="3387818">func</span><span class="op" id="3387822">(</span><span class="ident" id="3387823">match</span>&nbsp;<span class="op" id="3387829">[</span><span class="op" id="3387830">]</span><span class="builtintype" id="3387831">int</span><span class="op" id="3387834">)</span>&nbsp;<span class="op" id="3387836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387840">result</span>&nbsp;<span class="op" id="3387847">=</span>&nbsp;<span class="builtinfunc" id="3387849">append</span><span class="op" id="3387855">(</span><span class="ident" id="3387856">result</span><span class="op" id="3387862">,</span>&nbsp;<span class="ident" id="3387864">s</span><span class="op" id="3387865">[</span><span class="ident" id="3387866">match</span><span class="op" id="3387871">[</span><span class="num" id="3387872">0</span><span class="op" id="3387873">]</span><span class="op" id="3387874">:</span><span class="ident" id="3387875">match</span><span class="op" id="3387880">[</span><span class="num" id="3387881">1</span><span class="op" id="3387882">]</span><span class="op" id="3387883">]</span><span class="op" id="3387884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387887">}</span><span class="op" id="3387888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387891">if</span>&nbsp;<span class="builtinfunc" id="3387894">len</span><span class="op" id="3387897">(</span><span class="ident" id="3387898">result</span><span class="op" id="3387904">)</span>&nbsp;<span class="op" id="3387906">==</span>&nbsp;<span class="num" id="3387909">0</span>&nbsp;<span class="op" id="3387911">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387915">return</span>&nbsp;<span class="ident" id="3387922">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387930">return</span>&nbsp;<span class="ident" id="3387937">result</span><br>
<span class="lineno"></span><span class="op" id="3387944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">970</span><span class="comment" id="3387947">//&nbsp;FindAllStringIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindStringIndex;&nbsp;it&nbsp;returns&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3388023">//&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;</span><br>
<span class="lineno"></span><span class="comment" id="3388101">//&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3388140">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3388185">func</span>&nbsp;<span class="op" id="3388190">(</span><span class="ident" id="3388191">re</span>&nbsp;<span class="op" id="3388194">*</span><span class="ident" id="3388195">Regexp</span><span class="op" id="3388201">)</span>&nbsp;<span class="ident" id="3388203">FindAllStringIndex</span><span class="op" id="3388221">(</span><span class="ident" id="3388222">s</span>&nbsp;<span class="builtintype" id="3388224">string</span><span class="op" id="3388230">,</span>&nbsp;<span class="ident" id="3388232">n</span>&nbsp;<span class="builtintype" id="3388234">int</span><span class="op" id="3388237">)</span>&nbsp;<span class="op" id="3388239">[</span><span class="op" id="3388240">]</span><span class="op" id="3388241">[</span><span class="op" id="3388242">]</span><span class="builtintype" id="3388243">int</span>&nbsp;<span class="op" id="3388247">{</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388250">if</span>&nbsp;<span class="ident" id="3388253">n</span>&nbsp;<span class="op" id="3388255">&lt;</span>&nbsp;<span class="num" id="3388257">0</span>&nbsp;<span class="op" id="3388259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388263">n</span>&nbsp;<span class="op" id="3388265">=</span>&nbsp;<span class="builtinfunc" id="3388267">len</span><span class="op" id="3388270">(</span><span class="ident" id="3388271">s</span><span class="op" id="3388272">)</span>&nbsp;<span class="op" id="3388274">+</span>&nbsp;<span class="num" id="3388276">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388282">result</span>&nbsp;<span class="op" id="3388289">:=</span>&nbsp;<span class="builtinfunc" id="3388292">make</span><span class="op" id="3388296">(</span><span class="op" id="3388297">[</span><span class="op" id="3388298">]</span><span class="op" id="3388299">[</span><span class="op" id="3388300">]</span><span class="builtintype" id="3388301">int</span><span class="op" id="3388304">,</span>&nbsp;<span class="num" id="3388306">0</span><span class="op" id="3388307">,</span>&nbsp;<span class="ident" id="3388309">startSize</span><span class="op" id="3388318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388321">re</span><span class="op" id="3388323">.</span><span class="ident" id="3388324">allMatches</span><span class="op" id="3388334">(</span><span class="ident" id="3388335">s</span><span class="op" id="3388336">,</span>&nbsp;<span class="ident" id="3388338">nil</span><span class="op" id="3388341">,</span>&nbsp;<span class="ident" id="3388343">n</span><span class="op" id="3388344">,</span>&nbsp;<span class="keyword" id="3388346">func</span><span class="op" id="3388350">(</span><span class="ident" id="3388351">match</span>&nbsp;<span class="op" id="3388357">[</span><span class="op" id="3388358">]</span><span class="builtintype" id="3388359">int</span><span class="op" id="3388362">)</span>&nbsp;<span class="op" id="3388364">{</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388368">result</span>&nbsp;<span class="op" id="3388375">=</span>&nbsp;<span class="builtinfunc" id="3388377">append</span><span class="op" id="3388383">(</span><span class="ident" id="3388384">result</span><span class="op" id="3388390">,</span>&nbsp;<span class="ident" id="3388392">match</span><span class="op" id="3388397">[</span><span class="num" id="3388398">0</span><span class="op" id="3388399">:</span><span class="num" id="3388400">2</span><span class="op" id="3388401">]</span><span class="op" id="3388402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388405">}</span><span class="op" id="3388406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388409">if</span>&nbsp;<span class="builtinfunc" id="3388412">len</span><span class="op" id="3388415">(</span><span class="ident" id="3388416">result</span><span class="op" id="3388422">)</span>&nbsp;<span class="op" id="3388424">==</span>&nbsp;<span class="num" id="3388427">0</span>&nbsp;<span class="op" id="3388429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388433">return</span>&nbsp;<span class="ident" id="3388440">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388445">}</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388448">return</span>&nbsp;<span class="ident" id="3388455">result</span><br>
<span class="lineno"></span><span class="op" id="3388462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3388465">//&nbsp;FindAllSubmatch&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindSubmatch;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="3388541">//&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;</span><br>
<span class="lineno">990</span><span class="comment" id="3388613">//&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3388652">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3388697">func</span>&nbsp;<span class="op" id="3388702">(</span><span class="ident" id="3388703">re</span>&nbsp;<span class="op" id="3388706">*</span><span class="ident" id="3388707">Regexp</span><span class="op" id="3388713">)</span>&nbsp;<span class="ident" id="3388715">FindAllSubmatch</span><span class="op" id="3388730">(</span><span class="ident" id="3388731">b</span>&nbsp;<span class="op" id="3388733">[</span><span class="op" id="3388734">]</span><span class="builtintype" id="3388735">byte</span><span class="op" id="3388739">,</span>&nbsp;<span class="ident" id="3388741">n</span>&nbsp;<span class="builtintype" id="3388743">int</span><span class="op" id="3388746">)</span>&nbsp;<span class="op" id="3388748">[</span><span class="op" id="3388749">]</span><span class="op" id="3388750">[</span><span class="op" id="3388751">]</span><span class="op" id="3388752">[</span><span class="op" id="3388753">]</span><span class="builtintype" id="3388754">byte</span>&nbsp;<span class="op" id="3388759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388762">if</span>&nbsp;<span class="ident" id="3388765">n</span>&nbsp;<span class="op" id="3388767">&lt;</span>&nbsp;<span class="num" id="3388769">0</span>&nbsp;<span class="op" id="3388771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388775">n</span>&nbsp;<span class="op" id="3388777">=</span>&nbsp;<span class="builtinfunc" id="3388779">len</span><span class="op" id="3388782">(</span><span class="ident" id="3388783">b</span><span class="op" id="3388784">)</span>&nbsp;<span class="op" id="3388786">+</span>&nbsp;<span class="num" id="3388788">1</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388794">result</span>&nbsp;<span class="op" id="3388801">:=</span>&nbsp;<span class="builtinfunc" id="3388804">make</span><span class="op" id="3388808">(</span><span class="op" id="3388809">[</span><span class="op" id="3388810">]</span><span class="op" id="3388811">[</span><span class="op" id="3388812">]</span><span class="op" id="3388813">[</span><span class="op" id="3388814">]</span><span class="builtintype" id="3388815">byte</span><span class="op" id="3388819">,</span>&nbsp;<span class="num" id="3388821">0</span><span class="op" id="3388822">,</span>&nbsp;<span class="ident" id="3388824">startSize</span><span class="op" id="3388833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388836">re</span><span class="op" id="3388838">.</span><span class="ident" id="3388839">allMatches</span><span class="op" id="3388849">(</span><span class="string" id="3388850">&#34;&#34;</span><span class="op" id="3388852">,</span>&nbsp;<span class="ident" id="3388854">b</span><span class="op" id="3388855">,</span>&nbsp;<span class="ident" id="3388857">n</span><span class="op" id="3388858">,</span>&nbsp;<span class="keyword" id="3388860">func</span><span class="op" id="3388864">(</span><span class="ident" id="3388865">match</span>&nbsp;<span class="op" id="3388871">[</span><span class="op" id="3388872">]</span><span class="builtintype" id="3388873">int</span><span class="op" id="3388876">)</span>&nbsp;<span class="op" id="3388878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388882">slice</span>&nbsp;<span class="op" id="3388888">:=</span>&nbsp;<span class="builtinfunc" id="3388891">make</span><span class="op" id="3388895">(</span><span class="op" id="3388896">[</span><span class="op" id="3388897">]</span><span class="op" id="3388898">[</span><span class="op" id="3388899">]</span><span class="builtintype" id="3388900">byte</span><span class="op" id="3388904">,</span>&nbsp;<span class="builtinfunc" id="3388906">len</span><span class="op" id="3388909">(</span><span class="ident" id="3388910">match</span><span class="op" id="3388915">)</span><span class="op" id="3388916">/</span><span class="num" id="3388917">2</span><span class="op" id="3388918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388922">for</span>&nbsp;<span class="ident" id="3388926">j</span>&nbsp;<span class="op" id="3388928">:=</span>&nbsp;<span class="keyword" id="3388931">range</span>&nbsp;<span class="ident" id="3388937">slice</span>&nbsp;<span class="op" id="3388943">{</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388948">if</span>&nbsp;<span class="ident" id="3388951">match</span><span class="op" id="3388956">[</span><span class="num" id="3388957">2</span><span class="op" id="3388958">*</span><span class="ident" id="3388959">j</span><span class="op" id="3388960">]</span>&nbsp;<span class="op" id="3388962">&gt;=</span>&nbsp;<span class="num" id="3388965">0</span>&nbsp;<span class="op" id="3388967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388973">slice</span><span class="op" id="3388978">[</span><span class="ident" id="3388979">j</span><span class="op" id="3388980">]</span>&nbsp;<span class="op" id="3388982">=</span>&nbsp;<span class="ident" id="3388984">b</span><span class="op" id="3388985">[</span><span class="ident" id="3388986">match</span><span class="op" id="3388991">[</span><span class="num" id="3388992">2</span><span class="op" id="3388993">*</span><span class="ident" id="3388994">j</span><span class="op" id="3388995">]</span><span class="op" id="3388996">:</span><span class="ident" id="3388997">match</span><span class="op" id="3389002">[</span><span class="num" id="3389003">2</span><span class="op" id="3389004">*</span><span class="ident" id="3389005">j</span><span class="op" id="3389006">+</span><span class="num" id="3389007">1</span><span class="op" id="3389008">]</span><span class="op" id="3389009">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389022">result</span>&nbsp;<span class="op" id="3389029">=</span>&nbsp;<span class="builtinfunc" id="3389031">append</span><span class="op" id="3389037">(</span><span class="ident" id="3389038">result</span><span class="op" id="3389044">,</span>&nbsp;<span class="ident" id="3389046">slice</span><span class="op" id="3389051">)</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389054">}</span><span class="op" id="3389055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389058">if</span>&nbsp;<span class="builtinfunc" id="3389061">len</span><span class="op" id="3389064">(</span><span class="ident" id="3389065">result</span><span class="op" id="3389071">)</span>&nbsp;<span class="op" id="3389073">==</span>&nbsp;<span class="num" id="3389076">0</span>&nbsp;<span class="op" id="3389078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389082">return</span>&nbsp;<span class="ident" id="3389089">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389097">return</span>&nbsp;<span class="ident" id="3389104">result</span><br>
<span class="lineno">1010</span><span class="op" id="3389111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3389114">//&nbsp;FindAllSubmatchIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindSubmatchIndex;&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3389192">//&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3389266">//&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">1015</span><span class="comment" id="3389311">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3389356">func</span>&nbsp;<span class="op" id="3389361">(</span><span class="ident" id="3389362">re</span>&nbsp;<span class="op" id="3389365">*</span><span class="ident" id="3389366">Regexp</span><span class="op" id="3389372">)</span>&nbsp;<span class="ident" id="3389374">FindAllSubmatchIndex</span><span class="op" id="3389394">(</span><span class="ident" id="3389395">b</span>&nbsp;<span class="op" id="3389397">[</span><span class="op" id="3389398">]</span><span class="builtintype" id="3389399">byte</span><span class="op" id="3389403">,</span>&nbsp;<span class="ident" id="3389405">n</span>&nbsp;<span class="builtintype" id="3389407">int</span><span class="op" id="3389410">)</span>&nbsp;<span class="op" id="3389412">[</span><span class="op" id="3389413">]</span><span class="op" id="3389414">[</span><span class="op" id="3389415">]</span><span class="builtintype" id="3389416">int</span>&nbsp;<span class="op" id="3389420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389423">if</span>&nbsp;<span class="ident" id="3389426">n</span>&nbsp;<span class="op" id="3389428">&lt;</span>&nbsp;<span class="num" id="3389430">0</span>&nbsp;<span class="op" id="3389432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389436">n</span>&nbsp;<span class="op" id="3389438">=</span>&nbsp;<span class="builtinfunc" id="3389440">len</span><span class="op" id="3389443">(</span><span class="ident" id="3389444">b</span><span class="op" id="3389445">)</span>&nbsp;<span class="op" id="3389447">+</span>&nbsp;<span class="num" id="3389449">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389452">}</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389455">result</span>&nbsp;<span class="op" id="3389462">:=</span>&nbsp;<span class="builtinfunc" id="3389465">make</span><span class="op" id="3389469">(</span><span class="op" id="3389470">[</span><span class="op" id="3389471">]</span><span class="op" id="3389472">[</span><span class="op" id="3389473">]</span><span class="builtintype" id="3389474">int</span><span class="op" id="3389477">,</span>&nbsp;<span class="num" id="3389479">0</span><span class="op" id="3389480">,</span>&nbsp;<span class="ident" id="3389482">startSize</span><span class="op" id="3389491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389494">re</span><span class="op" id="3389496">.</span><span class="ident" id="3389497">allMatches</span><span class="op" id="3389507">(</span><span class="string" id="3389508">&#34;&#34;</span><span class="op" id="3389510">,</span>&nbsp;<span class="ident" id="3389512">b</span><span class="op" id="3389513">,</span>&nbsp;<span class="ident" id="3389515">n</span><span class="op" id="3389516">,</span>&nbsp;<span class="keyword" id="3389518">func</span><span class="op" id="3389522">(</span><span class="ident" id="3389523">match</span>&nbsp;<span class="op" id="3389529">[</span><span class="op" id="3389530">]</span><span class="builtintype" id="3389531">int</span><span class="op" id="3389534">)</span>&nbsp;<span class="op" id="3389536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389540">result</span>&nbsp;<span class="op" id="3389547">=</span>&nbsp;<span class="builtinfunc" id="3389549">append</span><span class="op" id="3389555">(</span><span class="ident" id="3389556">result</span><span class="op" id="3389562">,</span>&nbsp;<span class="ident" id="3389564">match</span><span class="op" id="3389569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389572">}</span><span class="op" id="3389573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389576">if</span>&nbsp;<span class="builtinfunc" id="3389579">len</span><span class="op" id="3389582">(</span><span class="ident" id="3389583">result</span><span class="op" id="3389589">)</span>&nbsp;<span class="op" id="3389591">==</span>&nbsp;<span class="num" id="3389594">0</span>&nbsp;<span class="op" id="3389596">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389600">return</span>&nbsp;<span class="ident" id="3389607">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389615">return</span>&nbsp;<span class="ident" id="3389622">result</span><br>
<span class="lineno"></span><span class="op" id="3389629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1030</span><span class="comment" id="3389632">//&nbsp;FindAllStringSubmatch&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindStringSubmatch;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3389704">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="3389782">//&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3389831">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3389876">func</span>&nbsp;<span class="op" id="3389881">(</span><span class="ident" id="3389882">re</span>&nbsp;<span class="op" id="3389885">*</span><span class="ident" id="3389886">Regexp</span><span class="op" id="3389892">)</span>&nbsp;<span class="ident" id="3389894">FindAllStringSubmatch</span><span class="op" id="3389915">(</span><span class="ident" id="3389916">s</span>&nbsp;<span class="builtintype" id="3389918">string</span><span class="op" id="3389924">,</span>&nbsp;<span class="ident" id="3389926">n</span>&nbsp;<span class="builtintype" id="3389928">int</span><span class="op" id="3389931">)</span>&nbsp;<span class="op" id="3389933">[</span><span class="op" id="3389934">]</span><span class="op" id="3389935">[</span><span class="op" id="3389936">]</span><span class="builtintype" id="3389937">string</span>&nbsp;<span class="op" id="3389944">{</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389947">if</span>&nbsp;<span class="ident" id="3389950">n</span>&nbsp;<span class="op" id="3389952">&lt;</span>&nbsp;<span class="num" id="3389954">0</span>&nbsp;<span class="op" id="3389956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389960">n</span>&nbsp;<span class="op" id="3389962">=</span>&nbsp;<span class="builtinfunc" id="3389964">len</span><span class="op" id="3389967">(</span><span class="ident" id="3389968">s</span><span class="op" id="3389969">)</span>&nbsp;<span class="op" id="3389971">+</span>&nbsp;<span class="num" id="3389973">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389979">result</span>&nbsp;<span class="op" id="3389986">:=</span>&nbsp;<span class="builtinfunc" id="3389989">make</span><span class="op" id="3389993">(</span><span class="op" id="3389994">[</span><span class="op" id="3389995">]</span><span class="op" id="3389996">[</span><span class="op" id="3389997">]</span><span class="builtintype" id="3389998">string</span><span class="op" id="3390004">,</span>&nbsp;<span class="num" id="3390006">0</span><span class="op" id="3390007">,</span>&nbsp;<span class="ident" id="3390009">startSize</span><span class="op" id="3390018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390021">re</span><span class="op" id="3390023">.</span><span class="ident" id="3390024">allMatches</span><span class="op" id="3390034">(</span><span class="ident" id="3390035">s</span><span class="op" id="3390036">,</span>&nbsp;<span class="ident" id="3390038">nil</span><span class="op" id="3390041">,</span>&nbsp;<span class="ident" id="3390043">n</span><span class="op" id="3390044">,</span>&nbsp;<span class="keyword" id="3390046">func</span><span class="op" id="3390050">(</span><span class="ident" id="3390051">match</span>&nbsp;<span class="op" id="3390057">[</span><span class="op" id="3390058">]</span><span class="builtintype" id="3390059">int</span><span class="op" id="3390062">)</span>&nbsp;<span class="op" id="3390064">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390068">slice</span>&nbsp;<span class="op" id="3390074">:=</span>&nbsp;<span class="builtinfunc" id="3390077">make</span><span class="op" id="3390081">(</span><span class="op" id="3390082">[</span><span class="op" id="3390083">]</span><span class="builtintype" id="3390084">string</span><span class="op" id="3390090">,</span>&nbsp;<span class="builtinfunc" id="3390092">len</span><span class="op" id="3390095">(</span><span class="ident" id="3390096">match</span><span class="op" id="3390101">)</span><span class="op" id="3390102">/</span><span class="num" id="3390103">2</span><span class="op" id="3390104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390108">for</span>&nbsp;<span class="ident" id="3390112">j</span>&nbsp;<span class="op" id="3390114">:=</span>&nbsp;<span class="keyword" id="3390117">range</span>&nbsp;<span class="ident" id="3390123">slice</span>&nbsp;<span class="op" id="3390129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390134">if</span>&nbsp;<span class="ident" id="3390137">match</span><span class="op" id="3390142">[</span><span class="num" id="3390143">2</span><span class="op" id="3390144">*</span><span class="ident" id="3390145">j</span><span class="op" id="3390146">]</span>&nbsp;<span class="op" id="3390148">&gt;=</span>&nbsp;<span class="num" id="3390151">0</span>&nbsp;<span class="op" id="3390153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390159">slice</span><span class="op" id="3390164">[</span><span class="ident" id="3390165">j</span><span class="op" id="3390166">]</span>&nbsp;<span class="op" id="3390168">=</span>&nbsp;<span class="ident" id="3390170">s</span><span class="op" id="3390171">[</span><span class="ident" id="3390172">match</span><span class="op" id="3390177">[</span><span class="num" id="3390178">2</span><span class="op" id="3390179">*</span><span class="ident" id="3390180">j</span><span class="op" id="3390181">]</span><span class="op" id="3390182">:</span><span class="ident" id="3390183">match</span><span class="op" id="3390188">[</span><span class="num" id="3390189">2</span><span class="op" id="3390190">*</span><span class="ident" id="3390191">j</span><span class="op" id="3390192">+</span><span class="num" id="3390193">1</span><span class="op" id="3390194">]</span><span class="op" id="3390195">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390200">}</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390208">result</span>&nbsp;<span class="op" id="3390215">=</span>&nbsp;<span class="builtinfunc" id="3390217">append</span><span class="op" id="3390223">(</span><span class="ident" id="3390224">result</span><span class="op" id="3390230">,</span>&nbsp;<span class="ident" id="3390232">slice</span><span class="op" id="3390237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390240">}</span><span class="op" id="3390241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390244">if</span>&nbsp;<span class="builtinfunc" id="3390247">len</span><span class="op" id="3390250">(</span><span class="ident" id="3390251">result</span><span class="op" id="3390257">)</span>&nbsp;<span class="op" id="3390259">==</span>&nbsp;<span class="num" id="3390262">0</span>&nbsp;<span class="op" id="3390264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390268">return</span>&nbsp;<span class="ident" id="3390275">nil</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390283">return</span>&nbsp;<span class="ident" id="3390290">result</span><br>
<span class="lineno"></span><span class="op" id="3390297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3390300">//&nbsp;FindAllStringSubmatchIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of</span><br>
<span class="lineno">1055</span><span class="comment" id="3390354">//&nbsp;FindStringSubmatchIndex;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3390430">//&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="3390500">//&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3390512">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3390557">func</span>&nbsp;<span class="op" id="3390562">(</span><span class="ident" id="3390563">re</span>&nbsp;<span class="op" id="3390566">*</span><span class="ident" id="3390567">Regexp</span><span class="op" id="3390573">)</span>&nbsp;<span class="ident" id="3390575">FindAllStringSubmatchIndex</span><span class="op" id="3390601">(</span><span class="ident" id="3390602">s</span>&nbsp;<span class="builtintype" id="3390604">string</span><span class="op" id="3390610">,</span>&nbsp;<span class="ident" id="3390612">n</span>&nbsp;<span class="builtintype" id="3390614">int</span><span class="op" id="3390617">)</span>&nbsp;<span class="op" id="3390619">[</span><span class="op" id="3390620">]</span><span class="op" id="3390621">[</span><span class="op" id="3390622">]</span><span class="builtintype" id="3390623">int</span>&nbsp;<span class="op" id="3390627">{</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390630">if</span>&nbsp;<span class="ident" id="3390633">n</span>&nbsp;<span class="op" id="3390635">&lt;</span>&nbsp;<span class="num" id="3390637">0</span>&nbsp;<span class="op" id="3390639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390643">n</span>&nbsp;<span class="op" id="3390645">=</span>&nbsp;<span class="builtinfunc" id="3390647">len</span><span class="op" id="3390650">(</span><span class="ident" id="3390651">s</span><span class="op" id="3390652">)</span>&nbsp;<span class="op" id="3390654">+</span>&nbsp;<span class="num" id="3390656">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390662">result</span>&nbsp;<span class="op" id="3390669">:=</span>&nbsp;<span class="builtinfunc" id="3390672">make</span><span class="op" id="3390676">(</span><span class="op" id="3390677">[</span><span class="op" id="3390678">]</span><span class="op" id="3390679">[</span><span class="op" id="3390680">]</span><span class="builtintype" id="3390681">int</span><span class="op" id="3390684">,</span>&nbsp;<span class="num" id="3390686">0</span><span class="op" id="3390687">,</span>&nbsp;<span class="ident" id="3390689">startSize</span><span class="op" id="3390698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390701">re</span><span class="op" id="3390703">.</span><span class="ident" id="3390704">allMatches</span><span class="op" id="3390714">(</span><span class="ident" id="3390715">s</span><span class="op" id="3390716">,</span>&nbsp;<span class="ident" id="3390718">nil</span><span class="op" id="3390721">,</span>&nbsp;<span class="ident" id="3390723">n</span><span class="op" id="3390724">,</span>&nbsp;<span class="keyword" id="3390726">func</span><span class="op" id="3390730">(</span><span class="ident" id="3390731">match</span>&nbsp;<span class="op" id="3390737">[</span><span class="op" id="3390738">]</span><span class="builtintype" id="3390739">int</span><span class="op" id="3390742">)</span>&nbsp;<span class="op" id="3390744">{</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390748">result</span>&nbsp;<span class="op" id="3390755">=</span>&nbsp;<span class="builtinfunc" id="3390757">append</span><span class="op" id="3390763">(</span><span class="ident" id="3390764">result</span><span class="op" id="3390770">,</span>&nbsp;<span class="ident" id="3390772">match</span><span class="op" id="3390777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390780">}</span><span class="op" id="3390781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390784">if</span>&nbsp;<span class="builtinfunc" id="3390787">len</span><span class="op" id="3390790">(</span><span class="ident" id="3390791">result</span><span class="op" id="3390797">)</span>&nbsp;<span class="op" id="3390799">==</span>&nbsp;<span class="num" id="3390802">0</span>&nbsp;<span class="op" id="3390804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390808">return</span>&nbsp;<span class="ident" id="3390815">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390820">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390823">return</span>&nbsp;<span class="ident" id="3390830">result</span><br>
<span class="lineno"></span><span class="op" id="3390837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3390840">//&nbsp;Split&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;the&nbsp;expression&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3390925">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;expression&nbsp;matches.</span><br>
<span class="lineno">1075</span><span class="comment" id="3390977">//</span><br>
<span class="lineno"></span><span class="comment" id="3390980">//&nbsp;The&nbsp;slice&nbsp;returned&nbsp;by&nbsp;this&nbsp;method&nbsp;consists&nbsp;of&nbsp;all&nbsp;the&nbsp;substrings&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="3391053">//&nbsp;not&nbsp;contained&nbsp;in&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;FindAllString.&nbsp;When&nbsp;called&nbsp;on&nbsp;an&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="3391139">//&nbsp;that&nbsp;contains&nbsp;no&nbsp;metacharacters,&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;strings.SplitN.</span><br>
<span class="lineno"></span><span class="comment" id="3391211">//</span><br>
<span class="lineno">1080</span><span class="comment" id="3391214">//&nbsp;Example:</span><br>
<span class="lineno"></span><span class="comment" id="3391226">//&nbsp;&nbsp;&nbsp;s&nbsp;:=&nbsp;regexp.MustCompile(&#34;a*&#34;).Split(&#34;abaabaccadaaae&#34;,&nbsp;5)</span><br>
<span class="lineno"></span><span class="comment" id="3391288">//&nbsp;&nbsp;&nbsp;//&nbsp;s:&nbsp;[&#34;&#34;,&nbsp;&#34;b&#34;,&nbsp;&#34;b&#34;,&nbsp;&#34;c&#34;,&nbsp;&#34;cadaaae&#34;]</span><br>
<span class="lineno"></span><span class="comment" id="3391330">//</span><br>
<span class="lineno"></span><span class="comment" id="3391333">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno">1085</span><span class="comment" id="3391393">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment" id="3391477">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="3391526">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="3391553">func</span>&nbsp;<span class="op" id="3391558">(</span><span class="ident" id="3391559">re</span>&nbsp;<span class="op" id="3391562">*</span><span class="ident" id="3391563">Regexp</span><span class="op" id="3391569">)</span>&nbsp;<span class="ident" id="3391571">Split</span><span class="op" id="3391576">(</span><span class="ident" id="3391577">s</span>&nbsp;<span class="builtintype" id="3391579">string</span><span class="op" id="3391585">,</span>&nbsp;<span class="ident" id="3391587">n</span>&nbsp;<span class="builtintype" id="3391589">int</span><span class="op" id="3391592">)</span>&nbsp;<span class="op" id="3391594">[</span><span class="op" id="3391595">]</span><span class="builtintype" id="3391596">string</span>&nbsp;<span class="op" id="3391603">{</span><br>
<span class="lineno"></span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391607">if</span>&nbsp;<span class="ident" id="3391610">n</span>&nbsp;<span class="op" id="3391612">==</span>&nbsp;<span class="num" id="3391615">0</span>&nbsp;<span class="op" id="3391617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391621">return</span>&nbsp;<span class="ident" id="3391628">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391637">if</span>&nbsp;<span class="builtinfunc" id="3391640">len</span><span class="op" id="3391643">(</span><span class="ident" id="3391644">re</span><span class="op" id="3391646">.</span><span class="ident" id="3391647">expr</span><span class="op" id="3391651">)</span>&nbsp;<span class="op" id="3391653">&gt;</span>&nbsp;<span class="num" id="3391655">0</span>&nbsp;<span class="op" id="3391657">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3391660">len</span><span class="op" id="3391663">(</span><span class="ident" id="3391664">s</span><span class="op" id="3391665">)</span>&nbsp;<span class="op" id="3391667">==</span>&nbsp;<span class="num" id="3391670">0</span>&nbsp;<span class="op" id="3391672">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391676">return</span>&nbsp;<span class="op" id="3391683">[</span><span class="op" id="3391684">]</span><span class="builtintype" id="3391685">string</span><span class="op" id="3391691">{</span><span class="string" id="3391692">&#34;&#34;</span><span class="op" id="3391694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3391701">matches</span>&nbsp;<span class="op" id="3391709">:=</span>&nbsp;<span class="ident" id="3391712">re</span><span class="op" id="3391714">.</span><span class="ident" id="3391715">FindAllStringIndex</span><span class="op" id="3391733">(</span><span class="ident" id="3391734">s</span><span class="op" id="3391735">,</span>&nbsp;<span class="ident" id="3391737">n</span><span class="op" id="3391738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3391741">strings</span>&nbsp;<span class="op" id="3391749">:=</span>&nbsp;<span class="builtinfunc" id="3391752">make</span><span class="op" id="3391756">(</span><span class="op" id="3391757">[</span><span class="op" id="3391758">]</span><span class="builtintype" id="3391759">string</span><span class="op" id="3391765">,</span>&nbsp;<span class="num" id="3391767">0</span><span class="op" id="3391768">,</span>&nbsp;<span class="builtinfunc" id="3391770">len</span><span class="op" id="3391773">(</span><span class="ident" id="3391774">matches</span><span class="op" id="3391781">)</span><span class="op" id="3391782">)</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3391786">beg</span>&nbsp;<span class="op" id="3391790">:=</span>&nbsp;<span class="num" id="3391793">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3391796">end</span>&nbsp;<span class="op" id="3391800">:=</span>&nbsp;<span class="num" id="3391803">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391806">for</span>&nbsp;<span class="ident" id="3391810">_</span><span class="op" id="3391811">,</span>&nbsp;<span class="ident" id="3391813">match</span>&nbsp;<span class="op" id="3391819">:=</span>&nbsp;<span class="keyword" id="3391822">range</span>&nbsp;<span class="ident" id="3391828">matches</span>&nbsp;<span class="op" id="3391836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391840">if</span>&nbsp;<span class="ident" id="3391843">n</span>&nbsp;<span class="op" id="3391845">&gt;</span>&nbsp;<span class="num" id="3391847">0</span>&nbsp;<span class="op" id="3391849">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3391852">len</span><span class="op" id="3391855">(</span><span class="ident" id="3391856">strings</span><span class="op" id="3391863">)</span>&nbsp;<span class="op" id="3391865">&gt;=</span>&nbsp;<span class="ident" id="3391868">n</span><span class="op" id="3391869">-</span><span class="num" id="3391870">1</span>&nbsp;<span class="op" id="3391872">{</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391877">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3391890">end</span>&nbsp;<span class="op" id="3391894">=</span>&nbsp;<span class="ident" id="3391896">match</span><span class="op" id="3391901">[</span><span class="num" id="3391902">0</span><span class="op" id="3391903">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391907">if</span>&nbsp;<span class="ident" id="3391910">match</span><span class="op" id="3391915">[</span><span class="num" id="3391916">1</span><span class="op" id="3391917">]</span>&nbsp;<span class="op" id="3391919">!=</span>&nbsp;<span class="num" id="3391922">0</span>&nbsp;<span class="op" id="3391924">{</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3391929">strings</span>&nbsp;<span class="op" id="3391937">=</span>&nbsp;<span class="builtinfunc" id="3391939">append</span><span class="op" id="3391945">(</span><span class="ident" id="3391946">strings</span><span class="op" id="3391953">,</span>&nbsp;<span class="ident" id="3391955">s</span><span class="op" id="3391956">[</span><span class="ident" id="3391957">beg</span><span class="op" id="3391960">:</span><span class="ident" id="3391961">end</span><span class="op" id="3391964">]</span><span class="op" id="3391965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3391973">beg</span>&nbsp;<span class="op" id="3391977">=</span>&nbsp;<span class="ident" id="3391979">match</span><span class="op" id="3391984">[</span><span class="num" id="3391985">1</span><span class="op" id="3391986">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391993">if</span>&nbsp;<span class="ident" id="3391996">end</span>&nbsp;<span class="op" id="3392000">!=</span>&nbsp;<span class="builtinfunc" id="3392003">len</span><span class="op" id="3392006">(</span><span class="ident" id="3392007">s</span><span class="op" id="3392008">)</span>&nbsp;<span class="op" id="3392010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3392014">strings</span>&nbsp;<span class="op" id="3392022">=</span>&nbsp;<span class="builtinfunc" id="3392024">append</span><span class="op" id="3392030">(</span><span class="ident" id="3392031">strings</span><span class="op" id="3392038">,</span>&nbsp;<span class="ident" id="3392040">s</span><span class="op" id="3392041">[</span><span class="ident" id="3392042">beg</span><span class="op" id="3392045">:</span><span class="op" id="3392046">]</span><span class="op" id="3392047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392054">return</span>&nbsp;<span class="ident" id="3392061">strings</span><br>
<span class="lineno">1120</span><span class="op" id="3392069">}</span>
</div>
</body>
</html>
