<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html" class="current">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4679601">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4679656">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4679710">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4679761">package</span>&nbsp;<span class="ident" id="4679769">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4679776">import</span>&nbsp;<span class="op" id="4679783">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4679786">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4679792">&#34;math&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4679799">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4679802">const</span>&nbsp;<span class="op" id="4679808">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4679811">//&nbsp;The&nbsp;largest&nbsp;offset&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4679840">offsetCodeCount</span>&nbsp;<span class="op" id="4679856">=</span>&nbsp;<span class="num" id="4679858">30</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4679863">//&nbsp;The&nbsp;special&nbsp;code&nbsp;used&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4679917">endBlockMarker</span>&nbsp;<span class="op" id="4679932">=</span>&nbsp;<span class="num" id="4679934">256</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4679940">//&nbsp;The&nbsp;first&nbsp;length&nbsp;code.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4679967">lengthCodesStart</span>&nbsp;<span class="op" id="4679984">=</span>&nbsp;<span class="num" id="4679986">257</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4679992">//&nbsp;The&nbsp;number&nbsp;of&nbsp;codegen&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4680025">codegenCodeCount</span>&nbsp;<span class="op" id="4680042">=</span>&nbsp;<span class="num" id="4680044">19</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4680048">badCode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4680065">=</span>&nbsp;<span class="num" id="4680067">255</span><br>
<span class="lineno">25</span><span class="op" id="4680071">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4680074">//&nbsp;The&nbsp;number&nbsp;of&nbsp;extra&nbsp;bits&nbsp;needed&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="4680148">var</span>&nbsp;<span class="ident" id="4680152">lengthExtraBits</span>&nbsp;<span class="op" id="4680168">=</span>&nbsp;<span class="op" id="4680170">[</span><span class="op" id="4680171">]</span><span class="builtintype" id="4680172">int8</span><span class="op" id="4680176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4680179">/*&nbsp;257&nbsp;*/</span>&nbsp;<span class="num" id="4680189">0</span><span class="op" id="4680190">,</span>&nbsp;<span class="num" id="4680192">0</span><span class="op" id="4680193">,</span>&nbsp;<span class="num" id="4680195">0</span><span class="op" id="4680196">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4680199">/*&nbsp;260&nbsp;*/</span>&nbsp;<span class="num" id="4680209">0</span><span class="op" id="4680210">,</span>&nbsp;<span class="num" id="4680212">0</span><span class="op" id="4680213">,</span>&nbsp;<span class="num" id="4680215">0</span><span class="op" id="4680216">,</span>&nbsp;<span class="num" id="4680218">0</span><span class="op" id="4680219">,</span>&nbsp;<span class="num" id="4680221">0</span><span class="op" id="4680222">,</span>&nbsp;<span class="num" id="4680224">1</span><span class="op" id="4680225">,</span>&nbsp;<span class="num" id="4680227">1</span><span class="op" id="4680228">,</span>&nbsp;<span class="num" id="4680230">1</span><span class="op" id="4680231">,</span>&nbsp;<span class="num" id="4680233">1</span><span class="op" id="4680234">,</span>&nbsp;<span class="num" id="4680236">2</span><span class="op" id="4680237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4680240">/*&nbsp;270&nbsp;*/</span>&nbsp;<span class="num" id="4680250">2</span><span class="op" id="4680251">,</span>&nbsp;<span class="num" id="4680253">2</span><span class="op" id="4680254">,</span>&nbsp;<span class="num" id="4680256">2</span><span class="op" id="4680257">,</span>&nbsp;<span class="num" id="4680259">3</span><span class="op" id="4680260">,</span>&nbsp;<span class="num" id="4680262">3</span><span class="op" id="4680263">,</span>&nbsp;<span class="num" id="4680265">3</span><span class="op" id="4680266">,</span>&nbsp;<span class="num" id="4680268">3</span><span class="op" id="4680269">,</span>&nbsp;<span class="num" id="4680271">4</span><span class="op" id="4680272">,</span>&nbsp;<span class="num" id="4680274">4</span><span class="op" id="4680275">,</span>&nbsp;<span class="num" id="4680277">4</span><span class="op" id="4680278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4680281">/*&nbsp;280&nbsp;*/</span>&nbsp;<span class="num" id="4680291">4</span><span class="op" id="4680292">,</span>&nbsp;<span class="num" id="4680294">5</span><span class="op" id="4680295">,</span>&nbsp;<span class="num" id="4680297">5</span><span class="op" id="4680298">,</span>&nbsp;<span class="num" id="4680300">5</span><span class="op" id="4680301">,</span>&nbsp;<span class="num" id="4680303">5</span><span class="op" id="4680304">,</span>&nbsp;<span class="num" id="4680306">0</span><span class="op" id="4680307">,</span><br>
<span class="lineno"></span><span class="op" id="4680309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4680312">//&nbsp;The&nbsp;length&nbsp;indicated&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="4680375">var</span>&nbsp;<span class="ident" id="4680379">lengthBase</span>&nbsp;<span class="op" id="4680390">=</span>&nbsp;<span class="op" id="4680392">[</span><span class="op" id="4680393">]</span><span class="builtintype" id="4680394">uint32</span><span class="op" id="4680400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4680403">0</span><span class="op" id="4680404">,</span>&nbsp;<span class="num" id="4680406">1</span><span class="op" id="4680407">,</span>&nbsp;<span class="num" id="4680409">2</span><span class="op" id="4680410">,</span>&nbsp;<span class="num" id="4680412">3</span><span class="op" id="4680413">,</span>&nbsp;<span class="num" id="4680415">4</span><span class="op" id="4680416">,</span>&nbsp;<span class="num" id="4680418">5</span><span class="op" id="4680419">,</span>&nbsp;<span class="num" id="4680421">6</span><span class="op" id="4680422">,</span>&nbsp;<span class="num" id="4680424">7</span><span class="op" id="4680425">,</span>&nbsp;<span class="num" id="4680427">8</span><span class="op" id="4680428">,</span>&nbsp;<span class="num" id="4680430">10</span><span class="op" id="4680432">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4680435">12</span><span class="op" id="4680437">,</span>&nbsp;<span class="num" id="4680439">14</span><span class="op" id="4680441">,</span>&nbsp;<span class="num" id="4680443">16</span><span class="op" id="4680445">,</span>&nbsp;<span class="num" id="4680447">20</span><span class="op" id="4680449">,</span>&nbsp;<span class="num" id="4680451">24</span><span class="op" id="4680453">,</span>&nbsp;<span class="num" id="4680455">28</span><span class="op" id="4680457">,</span>&nbsp;<span class="num" id="4680459">32</span><span class="op" id="4680461">,</span>&nbsp;<span class="num" id="4680463">40</span><span class="op" id="4680465">,</span>&nbsp;<span class="num" id="4680467">48</span><span class="op" id="4680469">,</span>&nbsp;<span class="num" id="4680471">56</span><span class="op" id="4680473">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4680476">64</span><span class="op" id="4680478">,</span>&nbsp;<span class="num" id="4680480">80</span><span class="op" id="4680482">,</span>&nbsp;<span class="num" id="4680484">96</span><span class="op" id="4680486">,</span>&nbsp;<span class="num" id="4680488">112</span><span class="op" id="4680491">,</span>&nbsp;<span class="num" id="4680493">128</span><span class="op" id="4680496">,</span>&nbsp;<span class="num" id="4680498">160</span><span class="op" id="4680501">,</span>&nbsp;<span class="num" id="4680503">192</span><span class="op" id="4680506">,</span>&nbsp;<span class="num" id="4680508">224</span><span class="op" id="4680511">,</span>&nbsp;<span class="num" id="4680513">255</span><span class="op" id="4680516">,</span><br>
<span class="lineno">40</span><span class="op" id="4680518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4680521">//&nbsp;offset&nbsp;code&nbsp;word&nbsp;extra&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4680553">var</span>&nbsp;<span class="ident" id="4680557">offsetExtraBits</span>&nbsp;<span class="op" id="4680573">=</span>&nbsp;<span class="op" id="4680575">[</span><span class="op" id="4680576">]</span><span class="builtintype" id="4680577">int8</span><span class="op" id="4680581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4680584">0</span><span class="op" id="4680585">,</span>&nbsp;<span class="num" id="4680587">0</span><span class="op" id="4680588">,</span>&nbsp;<span class="num" id="4680590">0</span><span class="op" id="4680591">,</span>&nbsp;<span class="num" id="4680593">0</span><span class="op" id="4680594">,</span>&nbsp;<span class="num" id="4680596">1</span><span class="op" id="4680597">,</span>&nbsp;<span class="num" id="4680599">1</span><span class="op" id="4680600">,</span>&nbsp;<span class="num" id="4680602">2</span><span class="op" id="4680603">,</span>&nbsp;<span class="num" id="4680605">2</span><span class="op" id="4680606">,</span>&nbsp;<span class="num" id="4680608">3</span><span class="op" id="4680609">,</span>&nbsp;<span class="num" id="4680611">3</span><span class="op" id="4680612">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4680615">4</span><span class="op" id="4680616">,</span>&nbsp;<span class="num" id="4680618">4</span><span class="op" id="4680619">,</span>&nbsp;<span class="num" id="4680621">5</span><span class="op" id="4680622">,</span>&nbsp;<span class="num" id="4680624">5</span><span class="op" id="4680625">,</span>&nbsp;<span class="num" id="4680627">6</span><span class="op" id="4680628">,</span>&nbsp;<span class="num" id="4680630">6</span><span class="op" id="4680631">,</span>&nbsp;<span class="num" id="4680633">7</span><span class="op" id="4680634">,</span>&nbsp;<span class="num" id="4680636">7</span><span class="op" id="4680637">,</span>&nbsp;<span class="num" id="4680639">8</span><span class="op" id="4680640">,</span>&nbsp;<span class="num" id="4680642">8</span><span class="op" id="4680643">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4680646">9</span><span class="op" id="4680647">,</span>&nbsp;<span class="num" id="4680649">9</span><span class="op" id="4680650">,</span>&nbsp;<span class="num" id="4680652">10</span><span class="op" id="4680654">,</span>&nbsp;<span class="num" id="4680656">10</span><span class="op" id="4680658">,</span>&nbsp;<span class="num" id="4680660">11</span><span class="op" id="4680662">,</span>&nbsp;<span class="num" id="4680664">11</span><span class="op" id="4680666">,</span>&nbsp;<span class="num" id="4680668">12</span><span class="op" id="4680670">,</span>&nbsp;<span class="num" id="4680672">12</span><span class="op" id="4680674">,</span>&nbsp;<span class="num" id="4680676">13</span><span class="op" id="4680678">,</span>&nbsp;<span class="num" id="4680680">13</span><span class="op" id="4680682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4680685">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4680708">14</span><span class="op" id="4680710">,</span>&nbsp;<span class="num" id="4680712">14</span><span class="op" id="4680714">,</span>&nbsp;<span class="num" id="4680716">15</span><span class="op" id="4680718">,</span>&nbsp;<span class="num" id="4680720">15</span><span class="op" id="4680722">,</span>&nbsp;<span class="num" id="4680724">16</span><span class="op" id="4680726">,</span>&nbsp;<span class="num" id="4680728">16</span><span class="op" id="4680730">,</span>&nbsp;<span class="num" id="4680732">17</span><span class="op" id="4680734">,</span>&nbsp;<span class="num" id="4680736">17</span><span class="op" id="4680738">,</span>&nbsp;<span class="num" id="4680740">18</span><span class="op" id="4680742">,</span>&nbsp;<span class="num" id="4680744">18</span><span class="op" id="4680746">,</span>&nbsp;<span class="num" id="4680748">19</span><span class="op" id="4680750">,</span>&nbsp;<span class="num" id="4680752">19</span><span class="op" id="4680754">,</span>&nbsp;<span class="num" id="4680756">20</span><span class="op" id="4680758">,</span>&nbsp;<span class="num" id="4680760">20</span><span class="op" id="4680762">,</span><br>
<span class="lineno"></span><span class="op" id="4680764">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="4680767">var</span>&nbsp;<span class="ident" id="4680771">offsetBase</span>&nbsp;<span class="op" id="4680782">=</span>&nbsp;<span class="op" id="4680784">[</span><span class="op" id="4680785">]</span><span class="builtintype" id="4680786">uint32</span><span class="op" id="4680792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4680795">/*&nbsp;normal&nbsp;deflate&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4680817">0x000000</span><span class="op" id="4680825">,</span>&nbsp;<span class="num" id="4680827">0x000001</span><span class="op" id="4680835">,</span>&nbsp;<span class="num" id="4680837">0x000002</span><span class="op" id="4680845">,</span>&nbsp;<span class="num" id="4680847">0x000003</span><span class="op" id="4680855">,</span>&nbsp;<span class="num" id="4680857">0x000004</span><span class="op" id="4680865">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4680868">0x000006</span><span class="op" id="4680876">,</span>&nbsp;<span class="num" id="4680878">0x000008</span><span class="op" id="4680886">,</span>&nbsp;<span class="num" id="4680888">0x00000c</span><span class="op" id="4680896">,</span>&nbsp;<span class="num" id="4680898">0x000010</span><span class="op" id="4680906">,</span>&nbsp;<span class="num" id="4680908">0x000018</span><span class="op" id="4680916">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4680919">0x000020</span><span class="op" id="4680927">,</span>&nbsp;<span class="num" id="4680929">0x000030</span><span class="op" id="4680937">,</span>&nbsp;<span class="num" id="4680939">0x000040</span><span class="op" id="4680947">,</span>&nbsp;<span class="num" id="4680949">0x000060</span><span class="op" id="4680957">,</span>&nbsp;<span class="num" id="4680959">0x000080</span><span class="op" id="4680967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4680970">0x0000c0</span><span class="op" id="4680978">,</span>&nbsp;<span class="num" id="4680980">0x000100</span><span class="op" id="4680988">,</span>&nbsp;<span class="num" id="4680990">0x000180</span><span class="op" id="4680998">,</span>&nbsp;<span class="num" id="4681000">0x000200</span><span class="op" id="4681008">,</span>&nbsp;<span class="num" id="4681010">0x000300</span><span class="op" id="4681018">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4681021">0x000400</span><span class="op" id="4681029">,</span>&nbsp;<span class="num" id="4681031">0x000600</span><span class="op" id="4681039">,</span>&nbsp;<span class="num" id="4681041">0x000800</span><span class="op" id="4681049">,</span>&nbsp;<span class="num" id="4681051">0x000c00</span><span class="op" id="4681059">,</span>&nbsp;<span class="num" id="4681061">0x001000</span><span class="op" id="4681069">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4681072">0x001800</span><span class="op" id="4681080">,</span>&nbsp;<span class="num" id="4681082">0x002000</span><span class="op" id="4681090">,</span>&nbsp;<span class="num" id="4681092">0x003000</span><span class="op" id="4681100">,</span>&nbsp;<span class="num" id="4681102">0x004000</span><span class="op" id="4681110">,</span>&nbsp;<span class="num" id="4681112">0x006000</span><span class="op" id="4681120">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4681124">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4681147">0x008000</span><span class="op" id="4681155">,</span>&nbsp;<span class="num" id="4681157">0x00c000</span><span class="op" id="4681165">,</span>&nbsp;<span class="num" id="4681167">0x010000</span><span class="op" id="4681175">,</span>&nbsp;<span class="num" id="4681177">0x018000</span><span class="op" id="4681185">,</span>&nbsp;<span class="num" id="4681187">0x020000</span><span class="op" id="4681195">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4681198">0x030000</span><span class="op" id="4681206">,</span>&nbsp;<span class="num" id="4681208">0x040000</span><span class="op" id="4681216">,</span>&nbsp;<span class="num" id="4681218">0x060000</span><span class="op" id="4681226">,</span>&nbsp;<span class="num" id="4681228">0x080000</span><span class="op" id="4681236">,</span>&nbsp;<span class="num" id="4681238">0x0c0000</span><span class="op" id="4681246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4681249">0x100000</span><span class="op" id="4681257">,</span>&nbsp;<span class="num" id="4681259">0x180000</span><span class="op" id="4681267">,</span>&nbsp;<span class="num" id="4681269">0x200000</span><span class="op" id="4681277">,</span>&nbsp;<span class="num" id="4681279">0x300000</span><span class="op" id="4681287">,</span><br>
<span class="lineno"></span><span class="op" id="4681289">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="4681292">//&nbsp;The&nbsp;odd&nbsp;order&nbsp;in&nbsp;which&nbsp;the&nbsp;codegen&nbsp;code&nbsp;sizes&nbsp;are&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="4681354">var</span>&nbsp;<span class="ident" id="4681358">codegenOrder</span>&nbsp;<span class="op" id="4681371">=</span>&nbsp;<span class="op" id="4681373">[</span><span class="op" id="4681374">]</span><span class="builtintype" id="4681375">uint32</span><span class="op" id="4681381">{</span><span class="num" id="4681382">16</span><span class="op" id="4681384">,</span>&nbsp;<span class="num" id="4681386">17</span><span class="op" id="4681388">,</span>&nbsp;<span class="num" id="4681390">18</span><span class="op" id="4681392">,</span>&nbsp;<span class="num" id="4681394">0</span><span class="op" id="4681395">,</span>&nbsp;<span class="num" id="4681397">8</span><span class="op" id="4681398">,</span>&nbsp;<span class="num" id="4681400">7</span><span class="op" id="4681401">,</span>&nbsp;<span class="num" id="4681403">9</span><span class="op" id="4681404">,</span>&nbsp;<span class="num" id="4681406">6</span><span class="op" id="4681407">,</span>&nbsp;<span class="num" id="4681409">10</span><span class="op" id="4681411">,</span>&nbsp;<span class="num" id="4681413">5</span><span class="op" id="4681414">,</span>&nbsp;<span class="num" id="4681416">11</span><span class="op" id="4681418">,</span>&nbsp;<span class="num" id="4681420">4</span><span class="op" id="4681421">,</span>&nbsp;<span class="num" id="4681423">12</span><span class="op" id="4681425">,</span>&nbsp;<span class="num" id="4681427">3</span><span class="op" id="4681428">,</span>&nbsp;<span class="num" id="4681430">13</span><span class="op" id="4681432">,</span>&nbsp;<span class="num" id="4681434">2</span><span class="op" id="4681435">,</span>&nbsp;<span class="num" id="4681437">14</span><span class="op" id="4681439">,</span>&nbsp;<span class="num" id="4681441">1</span><span class="op" id="4681442">,</span>&nbsp;<span class="num" id="4681444">15</span><span class="op" id="4681446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4681449">type</span>&nbsp;<span class="ident" id="4681454">huffmanBitWriter</span>&nbsp;<span class="keyword" id="4681471">struct</span>&nbsp;<span class="op" id="4681478">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4681481">w</span>&nbsp;<span class="ident" id="4681483">io</span><span class="op" id="4681485">.</span><span class="ident" id="4681486">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4681494">//&nbsp;Data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;written&nbsp;is&nbsp;bytes[0:nbytes]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4681544">//&nbsp;and&nbsp;then&nbsp;the&nbsp;low&nbsp;nbits&nbsp;of&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4681580">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4681596">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4681604">nbits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4681620">uint32</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4681628">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4681644">[</span><span class="num" id="4681645">64</span><span class="op" id="4681647">]</span><span class="builtintype" id="4681648">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4681654">nbytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4681670">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4681675">literalFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4681691">[</span><span class="op" id="4681692">]</span><span class="builtintype" id="4681693">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4681700">offsetFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4681716">[</span><span class="op" id="4681717">]</span><span class="builtintype" id="4681718">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4681725">codegen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4681741">[</span><span class="op" id="4681742">]</span><span class="builtintype" id="4681743">uint8</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4681750">codegenFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4681766">[</span><span class="op" id="4681767">]</span><span class="builtintype" id="4681768">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4681775">literalEncoding</span>&nbsp;<span class="op" id="4681791">*</span><span class="ident" id="4681792">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4681808">offsetEncoding</span>&nbsp;&nbsp;<span class="op" id="4681824">*</span><span class="ident" id="4681825">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4681841">codegenEncoding</span>&nbsp;<span class="op" id="4681857">*</span><span class="ident" id="4681858">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4681874">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4681890">error</span><br>
<span class="lineno">85</span><span class="op" id="4681896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4681899">func</span>&nbsp;<span class="ident" id="4681904">newHuffmanBitWriter</span><span class="op" id="4681923">(</span><span class="ident" id="4681924">w</span>&nbsp;<span class="ident" id="4681926">io</span><span class="op" id="4681928">.</span><span class="ident" id="4681929">Writer</span><span class="op" id="4681935">)</span>&nbsp;<span class="op" id="4681937">*</span><span class="ident" id="4681938">huffmanBitWriter</span>&nbsp;<span class="op" id="4681955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4681958">return</span>&nbsp;<span class="op" id="4681965">&amp;</span><span class="ident" id="4681966">huffmanBitWriter</span><span class="op" id="4681982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4681986">w</span><span class="op" id="4681987">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682003">w</span><span class="op" id="4682004">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682008">literalFreq</span><span class="op" id="4682019">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4682025">make</span><span class="op" id="4682029">(</span><span class="op" id="4682030">[</span><span class="op" id="4682031">]</span><span class="builtintype" id="4682032">int32</span><span class="op" id="4682037">,</span>&nbsp;<span class="ident" id="4682039">maxLit</span><span class="op" id="4682045">)</span><span class="op" id="4682046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682050">offsetFreq</span><span class="op" id="4682060">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4682067">make</span><span class="op" id="4682071">(</span><span class="op" id="4682072">[</span><span class="op" id="4682073">]</span><span class="builtintype" id="4682074">int32</span><span class="op" id="4682079">,</span>&nbsp;<span class="ident" id="4682081">offsetCodeCount</span><span class="op" id="4682096">)</span><span class="op" id="4682097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682101">codegen</span><span class="op" id="4682108">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4682118">make</span><span class="op" id="4682122">(</span><span class="op" id="4682123">[</span><span class="op" id="4682124">]</span><span class="builtintype" id="4682125">uint8</span><span class="op" id="4682130">,</span>&nbsp;<span class="ident" id="4682132">maxLit</span><span class="op" id="4682138">+</span><span class="ident" id="4682139">offsetCodeCount</span><span class="op" id="4682154">+</span><span class="num" id="4682155">1</span><span class="op" id="4682156">)</span><span class="op" id="4682157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682161">codegenFreq</span><span class="op" id="4682172">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4682178">make</span><span class="op" id="4682182">(</span><span class="op" id="4682183">[</span><span class="op" id="4682184">]</span><span class="builtintype" id="4682185">int32</span><span class="op" id="4682190">,</span>&nbsp;<span class="ident" id="4682192">codegenCodeCount</span><span class="op" id="4682208">)</span><span class="op" id="4682209">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682213">literalEncoding</span><span class="op" id="4682228">:</span>&nbsp;<span class="ident" id="4682230">newHuffmanEncoder</span><span class="op" id="4682247">(</span><span class="ident" id="4682248">maxLit</span><span class="op" id="4682254">)</span><span class="op" id="4682255">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682259">offsetEncoding</span><span class="op" id="4682273">:</span>&nbsp;&nbsp;<span class="ident" id="4682276">newHuffmanEncoder</span><span class="op" id="4682293">(</span><span class="ident" id="4682294">offsetCodeCount</span><span class="op" id="4682309">)</span><span class="op" id="4682310">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682314">codegenEncoding</span><span class="op" id="4682329">:</span>&nbsp;<span class="ident" id="4682331">newHuffmanEncoder</span><span class="op" id="4682348">(</span><span class="ident" id="4682349">codegenCodeCount</span><span class="op" id="4682365">)</span><span class="op" id="4682366">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4682369">}</span><br>
<span class="lineno"></span><span class="op" id="4682371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="4682374">func</span>&nbsp;<span class="op" id="4682379">(</span><span class="ident" id="4682380">w</span>&nbsp;<span class="op" id="4682382">*</span><span class="ident" id="4682383">huffmanBitWriter</span><span class="op" id="4682399">)</span>&nbsp;<span class="ident" id="4682401">reset</span><span class="op" id="4682406">(</span><span class="ident" id="4682407">writer</span>&nbsp;<span class="ident" id="4682414">io</span><span class="op" id="4682416">.</span><span class="ident" id="4682417">Writer</span><span class="op" id="4682423">)</span>&nbsp;<span class="op" id="4682425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682428">w</span><span class="op" id="4682429">.</span><span class="ident" id="4682430">w</span>&nbsp;<span class="op" id="4682432">=</span>&nbsp;<span class="ident" id="4682434">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682442">w</span><span class="op" id="4682443">.</span><span class="ident" id="4682444">bits</span><span class="op" id="4682448">,</span>&nbsp;<span class="ident" id="4682450">w</span><span class="op" id="4682451">.</span><span class="ident" id="4682452">nbits</span><span class="op" id="4682457">,</span>&nbsp;<span class="ident" id="4682459">w</span><span class="op" id="4682460">.</span><span class="ident" id="4682461">nbytes</span><span class="op" id="4682467">,</span>&nbsp;<span class="ident" id="4682469">w</span><span class="op" id="4682470">.</span><span class="ident" id="4682471">err</span>&nbsp;<span class="op" id="4682475">=</span>&nbsp;<span class="num" id="4682477">0</span><span class="op" id="4682478">,</span>&nbsp;<span class="num" id="4682480">0</span><span class="op" id="4682481">,</span>&nbsp;<span class="num" id="4682483">0</span><span class="op" id="4682484">,</span>&nbsp;<span class="builtintype" id="4682486">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682491">w</span><span class="op" id="4682492">.</span><span class="ident" id="4682493">bytes</span>&nbsp;<span class="op" id="4682499">=</span>&nbsp;<span class="op" id="4682501">[</span><span class="num" id="4682502">64</span><span class="op" id="4682504">]</span><span class="builtintype" id="4682505">byte</span><span class="op" id="4682509">{</span><span class="op" id="4682510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4682513">for</span>&nbsp;<span class="ident" id="4682517">i</span>&nbsp;<span class="op" id="4682519">:=</span>&nbsp;<span class="keyword" id="4682522">range</span>&nbsp;<span class="ident" id="4682528">w</span><span class="op" id="4682529">.</span><span class="ident" id="4682530">codegen</span>&nbsp;<span class="op" id="4682538">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682542">w</span><span class="op" id="4682543">.</span><span class="ident" id="4682544">codegen</span><span class="op" id="4682551">[</span><span class="ident" id="4682552">i</span><span class="op" id="4682553">]</span>&nbsp;<span class="op" id="4682555">=</span>&nbsp;<span class="num" id="4682557">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4682560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4682563">for</span>&nbsp;<span class="ident" id="4682567">_</span><span class="op" id="4682568">,</span>&nbsp;<span class="ident" id="4682570">s</span>&nbsp;<span class="op" id="4682572">:=</span>&nbsp;<span class="keyword" id="4682575">range</span>&nbsp;<span class="op" id="4682581">[</span><span class="op" id="4682582">...</span><span class="op" id="4682585">]</span><span class="op" id="4682586">[</span><span class="op" id="4682587">]</span><span class="builtintype" id="4682588">int32</span><span class="op" id="4682593">{</span><span class="ident" id="4682594">w</span><span class="op" id="4682595">.</span><span class="ident" id="4682596">literalFreq</span><span class="op" id="4682607">,</span>&nbsp;<span class="ident" id="4682609">w</span><span class="op" id="4682610">.</span><span class="ident" id="4682611">offsetFreq</span><span class="op" id="4682621">,</span>&nbsp;<span class="ident" id="4682623">w</span><span class="op" id="4682624">.</span><span class="ident" id="4682625">codegenFreq</span><span class="op" id="4682636">}</span>&nbsp;<span class="op" id="4682638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4682642">for</span>&nbsp;<span class="ident" id="4682646">i</span>&nbsp;<span class="op" id="4682648">:=</span>&nbsp;<span class="keyword" id="4682651">range</span>&nbsp;<span class="ident" id="4682657">s</span>&nbsp;<span class="op" id="4682659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682664">s</span><span class="op" id="4682665">[</span><span class="ident" id="4682666">i</span><span class="op" id="4682667">]</span>&nbsp;<span class="op" id="4682669">=</span>&nbsp;<span class="num" id="4682671">0</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4682675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4682678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4682681">for</span>&nbsp;<span class="ident" id="4682685">_</span><span class="op" id="4682686">,</span>&nbsp;<span class="ident" id="4682688">enc</span>&nbsp;<span class="op" id="4682692">:=</span>&nbsp;<span class="keyword" id="4682695">range</span>&nbsp;<span class="op" id="4682701">[</span><span class="op" id="4682702">...</span><span class="op" id="4682705">]</span><span class="op" id="4682706">*</span><span class="ident" id="4682707">huffmanEncoder</span><span class="op" id="4682721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682725">w</span><span class="op" id="4682726">.</span><span class="ident" id="4682727">literalEncoding</span><span class="op" id="4682742">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682746">w</span><span class="op" id="4682747">.</span><span class="ident" id="4682748">offsetEncoding</span><span class="op" id="4682762">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682766">w</span><span class="op" id="4682767">.</span><span class="ident" id="4682768">codegenEncoding</span><span class="op" id="4682783">}</span>&nbsp;<span class="op" id="4682785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4682789">for</span>&nbsp;<span class="ident" id="4682793">i</span>&nbsp;<span class="op" id="4682795">:=</span>&nbsp;<span class="keyword" id="4682798">range</span>&nbsp;<span class="ident" id="4682804">enc</span><span class="op" id="4682807">.</span><span class="ident" id="4682808">code</span>&nbsp;<span class="op" id="4682813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682818">enc</span><span class="op" id="4682821">.</span><span class="ident" id="4682822">code</span><span class="op" id="4682826">[</span><span class="ident" id="4682827">i</span><span class="op" id="4682828">]</span>&nbsp;<span class="op" id="4682830">=</span>&nbsp;<span class="num" id="4682832">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4682836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4682840">for</span>&nbsp;<span class="ident" id="4682844">i</span>&nbsp;<span class="op" id="4682846">:=</span>&nbsp;<span class="keyword" id="4682849">range</span>&nbsp;<span class="ident" id="4682855">enc</span><span class="op" id="4682858">.</span><span class="ident" id="4682859">codeBits</span>&nbsp;<span class="op" id="4682868">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682873">enc</span><span class="op" id="4682876">.</span><span class="ident" id="4682877">codeBits</span><span class="op" id="4682885">[</span><span class="ident" id="4682886">i</span><span class="op" id="4682887">]</span>&nbsp;<span class="op" id="4682889">=</span>&nbsp;<span class="num" id="4682891">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4682895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4682898">}</span><br>
<span class="lineno"></span><span class="op" id="4682900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="4682903">func</span>&nbsp;<span class="op" id="4682908">(</span><span class="ident" id="4682909">w</span>&nbsp;<span class="op" id="4682911">*</span><span class="ident" id="4682912">huffmanBitWriter</span><span class="op" id="4682928">)</span>&nbsp;<span class="ident" id="4682930">flushBits</span><span class="op" id="4682939">(</span><span class="op" id="4682940">)</span>&nbsp;<span class="op" id="4682942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4682945">if</span>&nbsp;<span class="ident" id="4682948">w</span><span class="op" id="4682949">.</span><span class="ident" id="4682950">err</span>&nbsp;<span class="op" id="4682954">!=</span>&nbsp;<span class="builtintype" id="4682957">nil</span>&nbsp;<span class="op" id="4682961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682965">w</span><span class="op" id="4682966">.</span><span class="ident" id="4682967">nbits</span>&nbsp;<span class="op" id="4682973">=</span>&nbsp;<span class="num" id="4682975">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4682979">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4682987">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682990">bits</span>&nbsp;<span class="op" id="4682995">:=</span>&nbsp;<span class="ident" id="4682998">w</span><span class="op" id="4682999">.</span><span class="ident" id="4683000">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683006">w</span><span class="op" id="4683007">.</span><span class="ident" id="4683008">bits</span>&nbsp;<span class="op" id="4683013">&gt;&gt;=</span>&nbsp;<span class="num" id="4683017">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683021">w</span><span class="op" id="4683022">.</span><span class="ident" id="4683023">nbits</span>&nbsp;<span class="op" id="4683029">-=</span>&nbsp;<span class="num" id="4683032">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683036">n</span>&nbsp;<span class="op" id="4683038">:=</span>&nbsp;<span class="ident" id="4683041">w</span><span class="op" id="4683042">.</span><span class="ident" id="4683043">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683051">w</span><span class="op" id="4683052">.</span><span class="ident" id="4683053">bytes</span><span class="op" id="4683058">[</span><span class="ident" id="4683059">n</span><span class="op" id="4683060">]</span>&nbsp;<span class="op" id="4683062">=</span>&nbsp;<span class="builtintype" id="4683064">byte</span><span class="op" id="4683068">(</span><span class="ident" id="4683069">bits</span><span class="op" id="4683073">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683076">w</span><span class="op" id="4683077">.</span><span class="ident" id="4683078">bytes</span><span class="op" id="4683083">[</span><span class="ident" id="4683084">n</span><span class="op" id="4683085">+</span><span class="num" id="4683086">1</span><span class="op" id="4683087">]</span>&nbsp;<span class="op" id="4683089">=</span>&nbsp;<span class="builtintype" id="4683091">byte</span><span class="op" id="4683095">(</span><span class="ident" id="4683096">bits</span>&nbsp;<span class="op" id="4683101">&gt;&gt;</span>&nbsp;<span class="num" id="4683104">8</span><span class="op" id="4683105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4683108">if</span>&nbsp;<span class="ident" id="4683111">n</span>&nbsp;<span class="op" id="4683113">+=</span>&nbsp;<span class="num" id="4683116">2</span><span class="op" id="4683117">;</span>&nbsp;<span class="ident" id="4683119">n</span>&nbsp;<span class="op" id="4683121">&gt;=</span>&nbsp;<span class="builtinfunc" id="4683124">len</span><span class="op" id="4683127">(</span><span class="ident" id="4683128">w</span><span class="op" id="4683129">.</span><span class="ident" id="4683130">bytes</span><span class="op" id="4683135">)</span>&nbsp;<span class="op" id="4683137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683141">_</span><span class="op" id="4683142">,</span>&nbsp;<span class="ident" id="4683144">w</span><span class="op" id="4683145">.</span><span class="ident" id="4683146">err</span>&nbsp;<span class="op" id="4683150">=</span>&nbsp;<span class="ident" id="4683152">w</span><span class="op" id="4683153">.</span><span class="ident" id="4683154">w</span><span class="op" id="4683155">.</span><span class="ident" id="4683156">Write</span><span class="op" id="4683161">(</span><span class="ident" id="4683162">w</span><span class="op" id="4683163">.</span><span class="ident" id="4683164">bytes</span><span class="op" id="4683169">[</span><span class="num" id="4683170">0</span><span class="op" id="4683171">:</span><span class="op" id="4683172">]</span><span class="op" id="4683173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683177">n</span>&nbsp;<span class="op" id="4683179">=</span>&nbsp;<span class="num" id="4683181">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4683184">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683187">w</span><span class="op" id="4683188">.</span><span class="ident" id="4683189">nbytes</span>&nbsp;<span class="op" id="4683196">=</span>&nbsp;<span class="ident" id="4683198">n</span><br>
<span class="lineno"></span><span class="op" id="4683200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4683203">func</span>&nbsp;<span class="op" id="4683208">(</span><span class="ident" id="4683209">w</span>&nbsp;<span class="op" id="4683211">*</span><span class="ident" id="4683212">huffmanBitWriter</span><span class="op" id="4683228">)</span>&nbsp;<span class="ident" id="4683230">flush</span><span class="op" id="4683235">(</span><span class="op" id="4683236">)</span>&nbsp;<span class="op" id="4683238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4683241">if</span>&nbsp;<span class="ident" id="4683244">w</span><span class="op" id="4683245">.</span><span class="ident" id="4683246">err</span>&nbsp;<span class="op" id="4683250">!=</span>&nbsp;<span class="builtintype" id="4683253">nil</span>&nbsp;<span class="op" id="4683257">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683261">w</span><span class="op" id="4683262">.</span><span class="ident" id="4683263">nbits</span>&nbsp;<span class="op" id="4683269">=</span>&nbsp;<span class="num" id="4683271">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4683275">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4683283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683286">n</span>&nbsp;<span class="op" id="4683288">:=</span>&nbsp;<span class="ident" id="4683291">w</span><span class="op" id="4683292">.</span><span class="ident" id="4683293">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4683301">if</span>&nbsp;<span class="ident" id="4683304">w</span><span class="op" id="4683305">.</span><span class="ident" id="4683306">nbits</span>&nbsp;<span class="op" id="4683312">&gt;</span>&nbsp;<span class="num" id="4683314">8</span>&nbsp;<span class="op" id="4683316">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683320">w</span><span class="op" id="4683321">.</span><span class="ident" id="4683322">bytes</span><span class="op" id="4683327">[</span><span class="ident" id="4683328">n</span><span class="op" id="4683329">]</span>&nbsp;<span class="op" id="4683331">=</span>&nbsp;<span class="builtintype" id="4683333">byte</span><span class="op" id="4683337">(</span><span class="ident" id="4683338">w</span><span class="op" id="4683339">.</span><span class="ident" id="4683340">bits</span><span class="op" id="4683344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683348">w</span><span class="op" id="4683349">.</span><span class="ident" id="4683350">bits</span>&nbsp;<span class="op" id="4683355">&gt;&gt;=</span>&nbsp;<span class="num" id="4683359">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683363">w</span><span class="op" id="4683364">.</span><span class="ident" id="4683365">nbits</span>&nbsp;<span class="op" id="4683371">-=</span>&nbsp;<span class="num" id="4683374">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683378">n</span><span class="op" id="4683379">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4683383">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4683386">if</span>&nbsp;<span class="ident" id="4683389">w</span><span class="op" id="4683390">.</span><span class="ident" id="4683391">nbits</span>&nbsp;<span class="op" id="4683397">&gt;</span>&nbsp;<span class="num" id="4683399">0</span>&nbsp;<span class="op" id="4683401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683405">w</span><span class="op" id="4683406">.</span><span class="ident" id="4683407">bytes</span><span class="op" id="4683412">[</span><span class="ident" id="4683413">n</span><span class="op" id="4683414">]</span>&nbsp;<span class="op" id="4683416">=</span>&nbsp;<span class="builtintype" id="4683418">byte</span><span class="op" id="4683422">(</span><span class="ident" id="4683423">w</span><span class="op" id="4683424">.</span><span class="ident" id="4683425">bits</span><span class="op" id="4683429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683433">w</span><span class="op" id="4683434">.</span><span class="ident" id="4683435">nbits</span>&nbsp;<span class="op" id="4683441">=</span>&nbsp;<span class="num" id="4683443">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683447">n</span><span class="op" id="4683448">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4683452">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683455">w</span><span class="op" id="4683456">.</span><span class="ident" id="4683457">bits</span>&nbsp;<span class="op" id="4683462">=</span>&nbsp;<span class="num" id="4683464">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683467">_</span><span class="op" id="4683468">,</span>&nbsp;<span class="ident" id="4683470">w</span><span class="op" id="4683471">.</span><span class="ident" id="4683472">err</span>&nbsp;<span class="op" id="4683476">=</span>&nbsp;<span class="ident" id="4683478">w</span><span class="op" id="4683479">.</span><span class="ident" id="4683480">w</span><span class="op" id="4683481">.</span><span class="ident" id="4683482">Write</span><span class="op" id="4683487">(</span><span class="ident" id="4683488">w</span><span class="op" id="4683489">.</span><span class="ident" id="4683490">bytes</span><span class="op" id="4683495">[</span><span class="num" id="4683496">0</span><span class="op" id="4683497">:</span><span class="ident" id="4683498">n</span><span class="op" id="4683499">]</span><span class="op" id="4683500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683503">w</span><span class="op" id="4683504">.</span><span class="ident" id="4683505">nbytes</span>&nbsp;<span class="op" id="4683512">=</span>&nbsp;<span class="num" id="4683514">0</span><br>
<span class="lineno"></span><span class="op" id="4683516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="4683519">func</span>&nbsp;<span class="op" id="4683524">(</span><span class="ident" id="4683525">w</span>&nbsp;<span class="op" id="4683527">*</span><span class="ident" id="4683528">huffmanBitWriter</span><span class="op" id="4683544">)</span>&nbsp;<span class="ident" id="4683546">writeBits</span><span class="op" id="4683555">(</span><span class="ident" id="4683556">b</span><span class="op" id="4683557">,</span>&nbsp;<span class="ident" id="4683559">nb</span>&nbsp;<span class="builtintype" id="4683562">int32</span><span class="op" id="4683567">)</span>&nbsp;<span class="op" id="4683569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683572">w</span><span class="op" id="4683573">.</span><span class="ident" id="4683574">bits</span>&nbsp;<span class="op" id="4683579">|=</span>&nbsp;<span class="builtintype" id="4683582">uint32</span><span class="op" id="4683588">(</span><span class="ident" id="4683589">b</span><span class="op" id="4683590">)</span>&nbsp;<span class="op" id="4683592">&lt;&lt;</span>&nbsp;<span class="ident" id="4683595">w</span><span class="op" id="4683596">.</span><span class="ident" id="4683597">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4683604">if</span>&nbsp;<span class="ident" id="4683607">w</span><span class="op" id="4683608">.</span><span class="ident" id="4683609">nbits</span>&nbsp;<span class="op" id="4683615">+=</span>&nbsp;<span class="builtintype" id="4683618">uint32</span><span class="op" id="4683624">(</span><span class="ident" id="4683625">nb</span><span class="op" id="4683627">)</span><span class="op" id="4683628">;</span>&nbsp;<span class="ident" id="4683630">w</span><span class="op" id="4683631">.</span><span class="ident" id="4683632">nbits</span>&nbsp;<span class="op" id="4683638">&gt;=</span>&nbsp;<span class="num" id="4683641">16</span>&nbsp;<span class="op" id="4683644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683648">w</span><span class="op" id="4683649">.</span><span class="ident" id="4683650">flushBits</span><span class="op" id="4683659">(</span><span class="op" id="4683660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4683663">}</span><br>
<span class="lineno">170</span><span class="op" id="4683665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4683668">func</span>&nbsp;<span class="op" id="4683673">(</span><span class="ident" id="4683674">w</span>&nbsp;<span class="op" id="4683676">*</span><span class="ident" id="4683677">huffmanBitWriter</span><span class="op" id="4683693">)</span>&nbsp;<span class="ident" id="4683695">writeBytes</span><span class="op" id="4683705">(</span><span class="ident" id="4683706">bytes</span>&nbsp;<span class="op" id="4683712">[</span><span class="op" id="4683713">]</span><span class="builtintype" id="4683714">byte</span><span class="op" id="4683718">)</span>&nbsp;<span class="op" id="4683720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4683723">if</span>&nbsp;<span class="ident" id="4683726">w</span><span class="op" id="4683727">.</span><span class="ident" id="4683728">err</span>&nbsp;<span class="op" id="4683732">!=</span>&nbsp;<span class="builtintype" id="4683735">nil</span>&nbsp;<span class="op" id="4683739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4683743">return</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4683751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683754">n</span>&nbsp;<span class="op" id="4683756">:=</span>&nbsp;<span class="ident" id="4683759">w</span><span class="op" id="4683760">.</span><span class="ident" id="4683761">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4683769">if</span>&nbsp;<span class="ident" id="4683772">w</span><span class="op" id="4683773">.</span><span class="ident" id="4683774">nbits</span>&nbsp;<span class="op" id="4683780">==</span>&nbsp;<span class="num" id="4683783">8</span>&nbsp;<span class="op" id="4683785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683789">w</span><span class="op" id="4683790">.</span><span class="ident" id="4683791">bytes</span><span class="op" id="4683796">[</span><span class="ident" id="4683797">n</span><span class="op" id="4683798">]</span>&nbsp;<span class="op" id="4683800">=</span>&nbsp;<span class="builtintype" id="4683802">byte</span><span class="op" id="4683806">(</span><span class="ident" id="4683807">w</span><span class="op" id="4683808">.</span><span class="ident" id="4683809">bits</span><span class="op" id="4683813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683817">w</span><span class="op" id="4683818">.</span><span class="ident" id="4683819">nbits</span>&nbsp;<span class="op" id="4683825">=</span>&nbsp;<span class="num" id="4683827">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683831">n</span><span class="op" id="4683832">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4683836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4683839">if</span>&nbsp;<span class="ident" id="4683842">w</span><span class="op" id="4683843">.</span><span class="ident" id="4683844">nbits</span>&nbsp;<span class="op" id="4683850">!=</span>&nbsp;<span class="num" id="4683853">0</span>&nbsp;<span class="op" id="4683855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683859">w</span><span class="op" id="4683860">.</span><span class="ident" id="4683861">err</span>&nbsp;<span class="op" id="4683865">=</span>&nbsp;<span class="ident" id="4683867">InternalError</span><span class="op" id="4683880">(</span><span class="string" id="4683881">&#34;writeBytes&nbsp;with&nbsp;unfinished&nbsp;bits&#34;</span><span class="op" id="4683914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4683918">return</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4683926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4683929">if</span>&nbsp;<span class="ident" id="4683932">n</span>&nbsp;<span class="op" id="4683934">!=</span>&nbsp;<span class="num" id="4683937">0</span>&nbsp;<span class="op" id="4683939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683943">_</span><span class="op" id="4683944">,</span>&nbsp;<span class="ident" id="4683946">w</span><span class="op" id="4683947">.</span><span class="ident" id="4683948">err</span>&nbsp;<span class="op" id="4683952">=</span>&nbsp;<span class="ident" id="4683954">w</span><span class="op" id="4683955">.</span><span class="ident" id="4683956">w</span><span class="op" id="4683957">.</span><span class="ident" id="4683958">Write</span><span class="op" id="4683963">(</span><span class="ident" id="4683964">w</span><span class="op" id="4683965">.</span><span class="ident" id="4683966">bytes</span><span class="op" id="4683971">[</span><span class="num" id="4683972">0</span><span class="op" id="4683973">:</span><span class="ident" id="4683974">n</span><span class="op" id="4683975">]</span><span class="op" id="4683976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4683980">if</span>&nbsp;<span class="ident" id="4683983">w</span><span class="op" id="4683984">.</span><span class="ident" id="4683985">err</span>&nbsp;<span class="op" id="4683989">!=</span>&nbsp;<span class="builtintype" id="4683992">nil</span>&nbsp;<span class="op" id="4683996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4684001">return</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4684010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4684013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4684016">w</span><span class="op" id="4684017">.</span><span class="ident" id="4684018">nbytes</span>&nbsp;<span class="op" id="4684025">=</span>&nbsp;<span class="num" id="4684027">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4684030">_</span><span class="op" id="4684031">,</span>&nbsp;<span class="ident" id="4684033">w</span><span class="op" id="4684034">.</span><span class="ident" id="4684035">err</span>&nbsp;<span class="op" id="4684039">=</span>&nbsp;<span class="ident" id="4684041">w</span><span class="op" id="4684042">.</span><span class="ident" id="4684043">w</span><span class="op" id="4684044">.</span><span class="ident" id="4684045">Write</span><span class="op" id="4684050">(</span><span class="ident" id="4684051">bytes</span><span class="op" id="4684056">)</span><br>
<span class="lineno"></span><span class="op" id="4684058">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="4684061">//&nbsp;RFC&nbsp;1951&nbsp;3.2.7&nbsp;specifies&nbsp;a&nbsp;special&nbsp;run-length&nbsp;encoding&nbsp;for&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="4684134">//&nbsp;the&nbsp;literal&nbsp;and&nbsp;offset&nbsp;lengths&nbsp;arrays&nbsp;(which&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="4684213">//&nbsp;array).&nbsp;&nbsp;This&nbsp;method&nbsp;generates&nbsp;that&nbsp;run-length&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="4684273">//</span><br>
<span class="lineno">200</span><span class="comment" id="4684276">//&nbsp;The&nbsp;result&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegen&nbsp;array,&nbsp;and&nbsp;the&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4684345">//&nbsp;of&nbsp;each&nbsp;code&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegenFreq&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="4684400">//&nbsp;Codes&nbsp;0-15&nbsp;are&nbsp;single&nbsp;byte&nbsp;codes.&nbsp;Codes&nbsp;16-18&nbsp;are&nbsp;followed&nbsp;by&nbsp;additional</span><br>
<span class="lineno"></span><span class="comment" id="4684476">//&nbsp;information.&nbsp;&nbsp;Code&nbsp;badCode&nbsp;is&nbsp;an&nbsp;end&nbsp;marker</span><br>
<span class="lineno"></span><span class="comment" id="4684523">//</span><br>
<span class="lineno">205</span><span class="comment" id="4684526">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;in&nbsp;literalEncoding</span><br>
<span class="lineno"></span><span class="comment" id="4684589">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;in&nbsp;offsetEncoding</span><br>
<span class="lineno"></span><span class="keyword" id="4684650">func</span>&nbsp;<span class="op" id="4684655">(</span><span class="ident" id="4684656">w</span>&nbsp;<span class="op" id="4684658">*</span><span class="ident" id="4684659">huffmanBitWriter</span><span class="op" id="4684675">)</span>&nbsp;<span class="ident" id="4684677">generateCodegen</span><span class="op" id="4684692">(</span><span class="ident" id="4684693">numLiterals</span>&nbsp;<span class="builtintype" id="4684705">int</span><span class="op" id="4684708">,</span>&nbsp;<span class="ident" id="4684710">numOffsets</span>&nbsp;<span class="builtintype" id="4684721">int</span><span class="op" id="4684724">)</span>&nbsp;<span class="op" id="4684726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4684729">for</span>&nbsp;<span class="ident" id="4684733">i</span>&nbsp;<span class="op" id="4684735">:=</span>&nbsp;<span class="keyword" id="4684738">range</span>&nbsp;<span class="ident" id="4684744">w</span><span class="op" id="4684745">.</span><span class="ident" id="4684746">codegenFreq</span>&nbsp;<span class="op" id="4684758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4684762">w</span><span class="op" id="4684763">.</span><span class="ident" id="4684764">codegenFreq</span><span class="op" id="4684775">[</span><span class="ident" id="4684776">i</span><span class="op" id="4684777">]</span>&nbsp;<span class="op" id="4684779">=</span>&nbsp;<span class="num" id="4684781">0</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4684784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4684787">//&nbsp;Note&nbsp;that&nbsp;we&nbsp;are&nbsp;using&nbsp;codegen&nbsp;both&nbsp;as&nbsp;a&nbsp;temporary&nbsp;variable&nbsp;for&nbsp;holding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4684863">//&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;frequencies,&nbsp;and&nbsp;as&nbsp;the&nbsp;place&nbsp;where&nbsp;we&nbsp;put&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4684936">//&nbsp;This&nbsp;is&nbsp;fine&nbsp;because&nbsp;the&nbsp;output&nbsp;is&nbsp;always&nbsp;shorter&nbsp;than&nbsp;the&nbsp;input&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4685010">//&nbsp;so&nbsp;far.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4685022">codegen</span>&nbsp;<span class="op" id="4685030">:=</span>&nbsp;<span class="ident" id="4685033">w</span><span class="op" id="4685034">.</span><span class="ident" id="4685035">codegen</span>&nbsp;<span class="comment" id="4685043">//&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4685053">//&nbsp;Copy&nbsp;the&nbsp;concatenated&nbsp;code&nbsp;sizes&nbsp;to&nbsp;codegen.&nbsp;&nbsp;Put&nbsp;a&nbsp;marker&nbsp;at&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4685128">copy</span><span class="op" id="4685132">(</span><span class="ident" id="4685133">codegen</span><span class="op" id="4685140">[</span><span class="num" id="4685141">0</span><span class="op" id="4685142">:</span><span class="ident" id="4685143">numLiterals</span><span class="op" id="4685154">]</span><span class="op" id="4685155">,</span>&nbsp;<span class="ident" id="4685157">w</span><span class="op" id="4685158">.</span><span class="ident" id="4685159">literalEncoding</span><span class="op" id="4685174">.</span><span class="ident" id="4685175">codeBits</span><span class="op" id="4685183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4685186">copy</span><span class="op" id="4685190">(</span><span class="ident" id="4685191">codegen</span><span class="op" id="4685198">[</span><span class="ident" id="4685199">numLiterals</span><span class="op" id="4685210">:</span><span class="ident" id="4685211">numLiterals</span><span class="op" id="4685222">+</span><span class="ident" id="4685223">numOffsets</span><span class="op" id="4685233">]</span><span class="op" id="4685234">,</span>&nbsp;<span class="ident" id="4685236">w</span><span class="op" id="4685237">.</span><span class="ident" id="4685238">offsetEncoding</span><span class="op" id="4685252">.</span><span class="ident" id="4685253">codeBits</span><span class="op" id="4685261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4685264">codegen</span><span class="op" id="4685271">[</span><span class="ident" id="4685272">numLiterals</span><span class="op" id="4685283">+</span><span class="ident" id="4685284">numOffsets</span><span class="op" id="4685294">]</span>&nbsp;<span class="op" id="4685296">=</span>&nbsp;<span class="ident" id="4685298">badCode</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4685308">size</span>&nbsp;<span class="op" id="4685313">:=</span>&nbsp;<span class="ident" id="4685316">codegen</span><span class="op" id="4685323">[</span><span class="num" id="4685324">0</span><span class="op" id="4685325">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4685328">count</span>&nbsp;<span class="op" id="4685334">:=</span>&nbsp;<span class="num" id="4685337">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4685340">outIndex</span>&nbsp;<span class="op" id="4685349">:=</span>&nbsp;<span class="num" id="4685352">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4685355">for</span>&nbsp;<span class="ident" id="4685359">inIndex</span>&nbsp;<span class="op" id="4685367">:=</span>&nbsp;<span class="num" id="4685370">1</span><span class="op" id="4685371">;</span>&nbsp;<span class="ident" id="4685373">size</span>&nbsp;<span class="op" id="4685378">!=</span>&nbsp;<span class="ident" id="4685381">badCode</span><span class="op" id="4685388">;</span>&nbsp;<span class="ident" id="4685390">inIndex</span><span class="op" id="4685397">++</span>&nbsp;<span class="op" id="4685400">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4685404">//&nbsp;INVARIANT:&nbsp;We&nbsp;have&nbsp;seen&nbsp;&#34;count&#34;&nbsp;copies&nbsp;of&nbsp;size&nbsp;that&nbsp;have&nbsp;not&nbsp;yet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4685474">//&nbsp;had&nbsp;output&nbsp;generated&nbsp;for&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4685510">nextSize</span>&nbsp;<span class="op" id="4685519">:=</span>&nbsp;<span class="ident" id="4685522">codegen</span><span class="op" id="4685529">[</span><span class="ident" id="4685530">inIndex</span><span class="op" id="4685537">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4685541">if</span>&nbsp;<span class="ident" id="4685544">nextSize</span>&nbsp;<span class="op" id="4685553">==</span>&nbsp;<span class="ident" id="4685556">size</span>&nbsp;<span class="op" id="4685561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4685566">count</span><span class="op" id="4685571">++</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4685577">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4685588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4685592">//&nbsp;We&nbsp;need&nbsp;to&nbsp;generate&nbsp;codegen&nbsp;indicating&nbsp;&#34;count&#34;&nbsp;of&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4685653">if</span>&nbsp;<span class="ident" id="4685656">size</span>&nbsp;<span class="op" id="4685661">!=</span>&nbsp;<span class="num" id="4685664">0</span>&nbsp;<span class="op" id="4685666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4685671">codegen</span><span class="op" id="4685678">[</span><span class="ident" id="4685679">outIndex</span><span class="op" id="4685687">]</span>&nbsp;<span class="op" id="4685689">=</span>&nbsp;<span class="ident" id="4685691">size</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4685699">outIndex</span><span class="op" id="4685707">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4685713">w</span><span class="op" id="4685714">.</span><span class="ident" id="4685715">codegenFreq</span><span class="op" id="4685726">[</span><span class="ident" id="4685727">size</span><span class="op" id="4685731">]</span><span class="op" id="4685732">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4685738">count</span><span class="op" id="4685743">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4685749">for</span>&nbsp;<span class="ident" id="4685753">count</span>&nbsp;<span class="op" id="4685759">&gt;=</span>&nbsp;<span class="num" id="4685762">3</span>&nbsp;<span class="op" id="4685764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4685770">n</span>&nbsp;<span class="op" id="4685772">:=</span>&nbsp;<span class="num" id="4685775">6</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4685781">if</span>&nbsp;<span class="ident" id="4685784">n</span>&nbsp;<span class="op" id="4685786">&gt;</span>&nbsp;<span class="ident" id="4685788">count</span>&nbsp;<span class="op" id="4685794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4685801">n</span>&nbsp;<span class="op" id="4685803">=</span>&nbsp;<span class="ident" id="4685805">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4685815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4685821">codegen</span><span class="op" id="4685828">[</span><span class="ident" id="4685829">outIndex</span><span class="op" id="4685837">]</span>&nbsp;<span class="op" id="4685839">=</span>&nbsp;<span class="num" id="4685841">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4685848">outIndex</span><span class="op" id="4685856">++</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4685863">codegen</span><span class="op" id="4685870">[</span><span class="ident" id="4685871">outIndex</span><span class="op" id="4685879">]</span>&nbsp;<span class="op" id="4685881">=</span>&nbsp;<span class="builtintype" id="4685883">uint8</span><span class="op" id="4685888">(</span><span class="ident" id="4685889">n</span>&nbsp;<span class="op" id="4685891">-</span>&nbsp;<span class="num" id="4685893">3</span><span class="op" id="4685894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4685900">outIndex</span><span class="op" id="4685908">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4685915">w</span><span class="op" id="4685916">.</span><span class="ident" id="4685917">codegenFreq</span><span class="op" id="4685928">[</span><span class="num" id="4685929">16</span><span class="op" id="4685931">]</span><span class="op" id="4685932">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4685939">count</span>&nbsp;<span class="op" id="4685945">-=</span>&nbsp;<span class="ident" id="4685948">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4685953">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4685957">}</span>&nbsp;<span class="keyword" id="4685959">else</span>&nbsp;<span class="op" id="4685964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4685969">for</span>&nbsp;<span class="ident" id="4685973">count</span>&nbsp;<span class="op" id="4685979">&gt;=</span>&nbsp;<span class="num" id="4685982">11</span>&nbsp;<span class="op" id="4685985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4685991">n</span>&nbsp;<span class="op" id="4685993">:=</span>&nbsp;<span class="num" id="4685996">138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4686004">if</span>&nbsp;<span class="ident" id="4686007">n</span>&nbsp;<span class="op" id="4686009">&gt;</span>&nbsp;<span class="ident" id="4686011">count</span>&nbsp;<span class="op" id="4686017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686024">n</span>&nbsp;<span class="op" id="4686026">=</span>&nbsp;<span class="ident" id="4686028">count</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4686038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686044">codegen</span><span class="op" id="4686051">[</span><span class="ident" id="4686052">outIndex</span><span class="op" id="4686060">]</span>&nbsp;<span class="op" id="4686062">=</span>&nbsp;<span class="num" id="4686064">18</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686071">outIndex</span><span class="op" id="4686079">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686086">codegen</span><span class="op" id="4686093">[</span><span class="ident" id="4686094">outIndex</span><span class="op" id="4686102">]</span>&nbsp;<span class="op" id="4686104">=</span>&nbsp;<span class="builtintype" id="4686106">uint8</span><span class="op" id="4686111">(</span><span class="ident" id="4686112">n</span>&nbsp;<span class="op" id="4686114">-</span>&nbsp;<span class="num" id="4686116">11</span><span class="op" id="4686118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686124">outIndex</span><span class="op" id="4686132">++</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686139">w</span><span class="op" id="4686140">.</span><span class="ident" id="4686141">codegenFreq</span><span class="op" id="4686152">[</span><span class="num" id="4686153">18</span><span class="op" id="4686155">]</span><span class="op" id="4686156">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686163">count</span>&nbsp;<span class="op" id="4686169">-=</span>&nbsp;<span class="ident" id="4686172">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4686177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4686182">if</span>&nbsp;<span class="ident" id="4686185">count</span>&nbsp;<span class="op" id="4686191">&gt;=</span>&nbsp;<span class="num" id="4686194">3</span>&nbsp;<span class="op" id="4686196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4686202">//&nbsp;count&nbsp;&gt;=&nbsp;3&nbsp;&amp;&amp;&nbsp;count&nbsp;&lt;=&nbsp;10</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686235">codegen</span><span class="op" id="4686242">[</span><span class="ident" id="4686243">outIndex</span><span class="op" id="4686251">]</span>&nbsp;<span class="op" id="4686253">=</span>&nbsp;<span class="num" id="4686255">17</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686262">outIndex</span><span class="op" id="4686270">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686277">codegen</span><span class="op" id="4686284">[</span><span class="ident" id="4686285">outIndex</span><span class="op" id="4686293">]</span>&nbsp;<span class="op" id="4686295">=</span>&nbsp;<span class="builtintype" id="4686297">uint8</span><span class="op" id="4686302">(</span><span class="ident" id="4686303">count</span>&nbsp;<span class="op" id="4686309">-</span>&nbsp;<span class="num" id="4686311">3</span><span class="op" id="4686312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686318">outIndex</span><span class="op" id="4686326">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686333">w</span><span class="op" id="4686334">.</span><span class="ident" id="4686335">codegenFreq</span><span class="op" id="4686346">[</span><span class="num" id="4686347">17</span><span class="op" id="4686349">]</span><span class="op" id="4686350">++</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686357">count</span>&nbsp;<span class="op" id="4686363">=</span>&nbsp;<span class="num" id="4686365">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4686370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4686374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686378">count</span><span class="op" id="4686383">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4686388">for</span>&nbsp;<span class="op" id="4686392">;</span>&nbsp;<span class="ident" id="4686394">count</span>&nbsp;<span class="op" id="4686400">&gt;=</span>&nbsp;<span class="num" id="4686403">0</span><span class="op" id="4686404">;</span>&nbsp;<span class="ident" id="4686406">count</span><span class="op" id="4686411">--</span>&nbsp;<span class="op" id="4686414">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686419">codegen</span><span class="op" id="4686426">[</span><span class="ident" id="4686427">outIndex</span><span class="op" id="4686435">]</span>&nbsp;<span class="op" id="4686437">=</span>&nbsp;<span class="ident" id="4686439">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686447">outIndex</span><span class="op" id="4686455">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686461">w</span><span class="op" id="4686462">.</span><span class="ident" id="4686463">codegenFreq</span><span class="op" id="4686474">[</span><span class="ident" id="4686475">size</span><span class="op" id="4686479">]</span><span class="op" id="4686480">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4686485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4686489">//&nbsp;Set&nbsp;up&nbsp;invariant&nbsp;for&nbsp;next&nbsp;time&nbsp;through&nbsp;the&nbsp;loop.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686543">size</span>&nbsp;<span class="op" id="4686548">=</span>&nbsp;<span class="ident" id="4686550">nextSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686561">count</span>&nbsp;<span class="op" id="4686567">=</span>&nbsp;<span class="num" id="4686569">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4686572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4686575">//&nbsp;Marker&nbsp;indicating&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;codegen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686621">codegen</span><span class="op" id="4686628">[</span><span class="ident" id="4686629">outIndex</span><span class="op" id="4686637">]</span>&nbsp;<span class="op" id="4686639">=</span>&nbsp;<span class="ident" id="4686641">badCode</span><br>
<span class="lineno">285</span><span class="op" id="4686649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4686652">func</span>&nbsp;<span class="op" id="4686657">(</span><span class="ident" id="4686658">w</span>&nbsp;<span class="op" id="4686660">*</span><span class="ident" id="4686661">huffmanBitWriter</span><span class="op" id="4686677">)</span>&nbsp;<span class="ident" id="4686679">writeCode</span><span class="op" id="4686688">(</span><span class="ident" id="4686689">code</span>&nbsp;<span class="op" id="4686694">*</span><span class="ident" id="4686695">huffmanEncoder</span><span class="op" id="4686709">,</span>&nbsp;<span class="ident" id="4686711">literal</span>&nbsp;<span class="builtintype" id="4686719">uint32</span><span class="op" id="4686725">)</span>&nbsp;<span class="op" id="4686727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4686730">if</span>&nbsp;<span class="ident" id="4686733">w</span><span class="op" id="4686734">.</span><span class="ident" id="4686735">err</span>&nbsp;<span class="op" id="4686739">!=</span>&nbsp;<span class="builtintype" id="4686742">nil</span>&nbsp;<span class="op" id="4686746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4686750">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4686758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4686761">w</span><span class="op" id="4686762">.</span><span class="ident" id="4686763">writeBits</span><span class="op" id="4686772">(</span><span class="builtintype" id="4686773">int32</span><span class="op" id="4686778">(</span><span class="ident" id="4686779">code</span><span class="op" id="4686783">.</span><span class="ident" id="4686784">code</span><span class="op" id="4686788">[</span><span class="ident" id="4686789">literal</span><span class="op" id="4686796">]</span><span class="op" id="4686797">)</span><span class="op" id="4686798">,</span>&nbsp;<span class="builtintype" id="4686800">int32</span><span class="op" id="4686805">(</span><span class="ident" id="4686806">code</span><span class="op" id="4686810">.</span><span class="ident" id="4686811">codeBits</span><span class="op" id="4686819">[</span><span class="ident" id="4686820">literal</span><span class="op" id="4686827">]</span><span class="op" id="4686828">)</span><span class="op" id="4686829">)</span><br>
<span class="lineno"></span><span class="op" id="4686831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4686834">//&nbsp;Write&nbsp;the&nbsp;header&nbsp;of&nbsp;a&nbsp;dynamic&nbsp;Huffman&nbsp;block&nbsp;to&nbsp;the&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">295</span><span class="comment" id="4686903">//</span><br>
<span class="lineno"></span><span class="comment" id="4686906">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="4686967">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="4687027">//&nbsp;&nbsp;numCodegens&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;codegens&nbsp;used&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="keyword" id="4687083">func</span>&nbsp;<span class="op" id="4687088">(</span><span class="ident" id="4687089">w</span>&nbsp;<span class="op" id="4687091">*</span><span class="ident" id="4687092">huffmanBitWriter</span><span class="op" id="4687108">)</span>&nbsp;<span class="ident" id="4687110">writeDynamicHeader</span><span class="op" id="4687128">(</span><span class="ident" id="4687129">numLiterals</span>&nbsp;<span class="builtintype" id="4687141">int</span><span class="op" id="4687144">,</span>&nbsp;<span class="ident" id="4687146">numOffsets</span>&nbsp;<span class="builtintype" id="4687157">int</span><span class="op" id="4687160">,</span>&nbsp;<span class="ident" id="4687162">numCodegens</span>&nbsp;<span class="builtintype" id="4687174">int</span><span class="op" id="4687177">,</span>&nbsp;<span class="ident" id="4687179">isEof</span>&nbsp;<span class="builtintype" id="4687185">bool</span><span class="op" id="4687189">)</span>&nbsp;<span class="op" id="4687191">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4687194">if</span>&nbsp;<span class="ident" id="4687197">w</span><span class="op" id="4687198">.</span><span class="ident" id="4687199">err</span>&nbsp;<span class="op" id="4687203">!=</span>&nbsp;<span class="builtintype" id="4687206">nil</span>&nbsp;<span class="op" id="4687210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4687214">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4687222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4687225">var</span>&nbsp;<span class="ident" id="4687229">firstBits</span>&nbsp;<span class="builtintype" id="4687239">int32</span>&nbsp;<span class="op" id="4687245">=</span>&nbsp;<span class="num" id="4687247">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4687250">if</span>&nbsp;<span class="ident" id="4687253">isEof</span>&nbsp;<span class="op" id="4687259">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4687263">firstBits</span>&nbsp;<span class="op" id="4687273">=</span>&nbsp;<span class="num" id="4687275">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4687278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4687281">w</span><span class="op" id="4687282">.</span><span class="ident" id="4687283">writeBits</span><span class="op" id="4687292">(</span><span class="ident" id="4687293">firstBits</span><span class="op" id="4687302">,</span>&nbsp;<span class="num" id="4687304">3</span><span class="op" id="4687305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4687308">w</span><span class="op" id="4687309">.</span><span class="ident" id="4687310">writeBits</span><span class="op" id="4687319">(</span><span class="builtintype" id="4687320">int32</span><span class="op" id="4687325">(</span><span class="ident" id="4687326">numLiterals</span><span class="op" id="4687337">-</span><span class="num" id="4687338">257</span><span class="op" id="4687341">)</span><span class="op" id="4687342">,</span>&nbsp;<span class="num" id="4687344">5</span><span class="op" id="4687345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4687348">w</span><span class="op" id="4687349">.</span><span class="ident" id="4687350">writeBits</span><span class="op" id="4687359">(</span><span class="builtintype" id="4687360">int32</span><span class="op" id="4687365">(</span><span class="ident" id="4687366">numOffsets</span><span class="op" id="4687376">-</span><span class="num" id="4687377">1</span><span class="op" id="4687378">)</span><span class="op" id="4687379">,</span>&nbsp;<span class="num" id="4687381">5</span><span class="op" id="4687382">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4687385">w</span><span class="op" id="4687386">.</span><span class="ident" id="4687387">writeBits</span><span class="op" id="4687396">(</span><span class="builtintype" id="4687397">int32</span><span class="op" id="4687402">(</span><span class="ident" id="4687403">numCodegens</span><span class="op" id="4687414">-</span><span class="num" id="4687415">4</span><span class="op" id="4687416">)</span><span class="op" id="4687417">,</span>&nbsp;<span class="num" id="4687419">4</span><span class="op" id="4687420">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4687424">for</span>&nbsp;<span class="ident" id="4687428">i</span>&nbsp;<span class="op" id="4687430">:=</span>&nbsp;<span class="num" id="4687433">0</span><span class="op" id="4687434">;</span>&nbsp;<span class="ident" id="4687436">i</span>&nbsp;<span class="op" id="4687438">&lt;</span>&nbsp;<span class="ident" id="4687440">numCodegens</span><span class="op" id="4687451">;</span>&nbsp;<span class="ident" id="4687453">i</span><span class="op" id="4687454">++</span>&nbsp;<span class="op" id="4687457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4687461">value</span>&nbsp;<span class="op" id="4687467">:=</span>&nbsp;<span class="ident" id="4687470">w</span><span class="op" id="4687471">.</span><span class="ident" id="4687472">codegenEncoding</span><span class="op" id="4687487">.</span><span class="ident" id="4687488">codeBits</span><span class="op" id="4687496">[</span><span class="ident" id="4687497">codegenOrder</span><span class="op" id="4687509">[</span><span class="ident" id="4687510">i</span><span class="op" id="4687511">]</span><span class="op" id="4687512">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4687516">w</span><span class="op" id="4687517">.</span><span class="ident" id="4687518">writeBits</span><span class="op" id="4687527">(</span><span class="builtintype" id="4687528">int32</span><span class="op" id="4687533">(</span><span class="ident" id="4687534">value</span><span class="op" id="4687539">)</span><span class="op" id="4687540">,</span>&nbsp;<span class="num" id="4687542">3</span><span class="op" id="4687543">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4687546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4687550">i</span>&nbsp;<span class="op" id="4687552">:=</span>&nbsp;<span class="num" id="4687555">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4687558">for</span>&nbsp;<span class="op" id="4687562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4687566">var</span>&nbsp;<span class="ident" id="4687570">codeWord</span>&nbsp;<span class="builtintype" id="4687579">int</span>&nbsp;<span class="op" id="4687583">=</span>&nbsp;<span class="builtintype" id="4687585">int</span><span class="op" id="4687588">(</span><span class="ident" id="4687589">w</span><span class="op" id="4687590">.</span><span class="ident" id="4687591">codegen</span><span class="op" id="4687598">[</span><span class="ident" id="4687599">i</span><span class="op" id="4687600">]</span><span class="op" id="4687601">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4687605">i</span><span class="op" id="4687606">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4687611">if</span>&nbsp;<span class="ident" id="4687614">codeWord</span>&nbsp;<span class="op" id="4687623">==</span>&nbsp;<span class="ident" id="4687626">badCode</span>&nbsp;<span class="op" id="4687634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4687639">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4687647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4687651">//&nbsp;The&nbsp;low&nbsp;byte&nbsp;contains&nbsp;the&nbsp;actual&nbsp;code&nbsp;to&nbsp;generate.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4687707">w</span><span class="op" id="4687708">.</span><span class="ident" id="4687709">writeCode</span><span class="op" id="4687718">(</span><span class="ident" id="4687719">w</span><span class="op" id="4687720">.</span><span class="ident" id="4687721">codegenEncoding</span><span class="op" id="4687736">,</span>&nbsp;<span class="builtintype" id="4687738">uint32</span><span class="op" id="4687744">(</span><span class="ident" id="4687745">codeWord</span><span class="op" id="4687753">)</span><span class="op" id="4687754">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4687759">switch</span>&nbsp;<span class="ident" id="4687766">codeWord</span>&nbsp;<span class="op" id="4687775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4687779">case</span>&nbsp;<span class="num" id="4687784">16</span><span class="op" id="4687786">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4687791">w</span><span class="op" id="4687792">.</span><span class="ident" id="4687793">writeBits</span><span class="op" id="4687802">(</span><span class="builtintype" id="4687803">int32</span><span class="op" id="4687808">(</span><span class="ident" id="4687809">w</span><span class="op" id="4687810">.</span><span class="ident" id="4687811">codegen</span><span class="op" id="4687818">[</span><span class="ident" id="4687819">i</span><span class="op" id="4687820">]</span><span class="op" id="4687821">)</span><span class="op" id="4687822">,</span>&nbsp;<span class="num" id="4687824">2</span><span class="op" id="4687825">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4687830">i</span><span class="op" id="4687831">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4687837">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4687845">case</span>&nbsp;<span class="num" id="4687850">17</span><span class="op" id="4687852">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4687857">w</span><span class="op" id="4687858">.</span><span class="ident" id="4687859">writeBits</span><span class="op" id="4687868">(</span><span class="builtintype" id="4687869">int32</span><span class="op" id="4687874">(</span><span class="ident" id="4687875">w</span><span class="op" id="4687876">.</span><span class="ident" id="4687877">codegen</span><span class="op" id="4687884">[</span><span class="ident" id="4687885">i</span><span class="op" id="4687886">]</span><span class="op" id="4687887">)</span><span class="op" id="4687888">,</span>&nbsp;<span class="num" id="4687890">3</span><span class="op" id="4687891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4687896">i</span><span class="op" id="4687897">++</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4687903">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4687911">case</span>&nbsp;<span class="num" id="4687916">18</span><span class="op" id="4687918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4687923">w</span><span class="op" id="4687924">.</span><span class="ident" id="4687925">writeBits</span><span class="op" id="4687934">(</span><span class="builtintype" id="4687935">int32</span><span class="op" id="4687940">(</span><span class="ident" id="4687941">w</span><span class="op" id="4687942">.</span><span class="ident" id="4687943">codegen</span><span class="op" id="4687950">[</span><span class="ident" id="4687951">i</span><span class="op" id="4687952">]</span><span class="op" id="4687953">)</span><span class="op" id="4687954">,</span>&nbsp;<span class="num" id="4687956">7</span><span class="op" id="4687957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4687962">i</span><span class="op" id="4687963">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4687969">break</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4687977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4687980">}</span><br>
<span class="lineno"></span><span class="op" id="4687982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4687985">func</span>&nbsp;<span class="op" id="4687990">(</span><span class="ident" id="4687991">w</span>&nbsp;<span class="op" id="4687993">*</span><span class="ident" id="4687994">huffmanBitWriter</span><span class="op" id="4688010">)</span>&nbsp;<span class="ident" id="4688012">writeStoredHeader</span><span class="op" id="4688029">(</span><span class="ident" id="4688030">length</span>&nbsp;<span class="builtintype" id="4688037">int</span><span class="op" id="4688040">,</span>&nbsp;<span class="ident" id="4688042">isEof</span>&nbsp;<span class="builtintype" id="4688048">bool</span><span class="op" id="4688052">)</span>&nbsp;<span class="op" id="4688054">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4688057">if</span>&nbsp;<span class="ident" id="4688060">w</span><span class="op" id="4688061">.</span><span class="ident" id="4688062">err</span>&nbsp;<span class="op" id="4688066">!=</span>&nbsp;<span class="builtintype" id="4688069">nil</span>&nbsp;<span class="op" id="4688073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4688077">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4688085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4688088">var</span>&nbsp;<span class="ident" id="4688092">flag</span>&nbsp;<span class="builtintype" id="4688097">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4688104">if</span>&nbsp;<span class="ident" id="4688107">isEof</span>&nbsp;<span class="op" id="4688113">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4688117">flag</span>&nbsp;<span class="op" id="4688122">=</span>&nbsp;<span class="num" id="4688124">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4688127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4688130">w</span><span class="op" id="4688131">.</span><span class="ident" id="4688132">writeBits</span><span class="op" id="4688141">(</span><span class="ident" id="4688142">flag</span><span class="op" id="4688146">,</span>&nbsp;<span class="num" id="4688148">3</span><span class="op" id="4688149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4688152">w</span><span class="op" id="4688153">.</span><span class="ident" id="4688154">flush</span><span class="op" id="4688159">(</span><span class="op" id="4688160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4688163">w</span><span class="op" id="4688164">.</span><span class="ident" id="4688165">writeBits</span><span class="op" id="4688174">(</span><span class="builtintype" id="4688175">int32</span><span class="op" id="4688180">(</span><span class="ident" id="4688181">length</span><span class="op" id="4688187">)</span><span class="op" id="4688188">,</span>&nbsp;<span class="num" id="4688190">16</span><span class="op" id="4688192">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4688195">w</span><span class="op" id="4688196">.</span><span class="ident" id="4688197">writeBits</span><span class="op" id="4688206">(</span><span class="builtintype" id="4688207">int32</span><span class="op" id="4688212">(</span><span class="op" id="4688213">^</span><span class="builtintype" id="4688214">uint16</span><span class="op" id="4688220">(</span><span class="ident" id="4688221">length</span><span class="op" id="4688227">)</span><span class="op" id="4688228">)</span><span class="op" id="4688229">,</span>&nbsp;<span class="num" id="4688231">16</span><span class="op" id="4688233">)</span><br>
<span class="lineno"></span><span class="op" id="4688235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4688238">func</span>&nbsp;<span class="op" id="4688243">(</span><span class="ident" id="4688244">w</span>&nbsp;<span class="op" id="4688246">*</span><span class="ident" id="4688247">huffmanBitWriter</span><span class="op" id="4688263">)</span>&nbsp;<span class="ident" id="4688265">writeFixedHeader</span><span class="op" id="4688281">(</span><span class="ident" id="4688282">isEof</span>&nbsp;<span class="builtintype" id="4688288">bool</span><span class="op" id="4688292">)</span>&nbsp;<span class="op" id="4688294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4688297">if</span>&nbsp;<span class="ident" id="4688300">w</span><span class="op" id="4688301">.</span><span class="ident" id="4688302">err</span>&nbsp;<span class="op" id="4688306">!=</span>&nbsp;<span class="builtintype" id="4688309">nil</span>&nbsp;<span class="op" id="4688313">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4688317">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4688325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4688328">//&nbsp;Indicate&nbsp;that&nbsp;we&nbsp;are&nbsp;a&nbsp;fixed&nbsp;Huffman&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4688375">var</span>&nbsp;<span class="ident" id="4688379">value</span>&nbsp;<span class="builtintype" id="4688385">int32</span>&nbsp;<span class="op" id="4688391">=</span>&nbsp;<span class="num" id="4688393">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4688396">if</span>&nbsp;<span class="ident" id="4688399">isEof</span>&nbsp;<span class="op" id="4688405">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4688409">value</span>&nbsp;<span class="op" id="4688415">=</span>&nbsp;<span class="num" id="4688417">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4688420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4688423">w</span><span class="op" id="4688424">.</span><span class="ident" id="4688425">writeBits</span><span class="op" id="4688434">(</span><span class="ident" id="4688435">value</span><span class="op" id="4688440">,</span>&nbsp;<span class="num" id="4688442">3</span><span class="op" id="4688443">)</span><br>
<span class="lineno"></span><span class="op" id="4688445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="4688448">func</span>&nbsp;<span class="op" id="4688453">(</span><span class="ident" id="4688454">w</span>&nbsp;<span class="op" id="4688456">*</span><span class="ident" id="4688457">huffmanBitWriter</span><span class="op" id="4688473">)</span>&nbsp;<span class="ident" id="4688475">writeBlock</span><span class="op" id="4688485">(</span><span class="ident" id="4688486">tokens</span>&nbsp;<span class="op" id="4688493">[</span><span class="op" id="4688494">]</span><span class="ident" id="4688495">token</span><span class="op" id="4688500">,</span>&nbsp;<span class="ident" id="4688502">eof</span>&nbsp;<span class="builtintype" id="4688506">bool</span><span class="op" id="4688510">,</span>&nbsp;<span class="ident" id="4688512">input</span>&nbsp;<span class="op" id="4688518">[</span><span class="op" id="4688519">]</span><span class="builtintype" id="4688520">byte</span><span class="op" id="4688524">)</span>&nbsp;<span class="op" id="4688526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4688529">if</span>&nbsp;<span class="ident" id="4688532">w</span><span class="op" id="4688533">.</span><span class="ident" id="4688534">err</span>&nbsp;<span class="op" id="4688538">!=</span>&nbsp;<span class="builtintype" id="4688541">nil</span>&nbsp;<span class="op" id="4688545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4688549">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4688557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4688560">for</span>&nbsp;<span class="ident" id="4688564">i</span>&nbsp;<span class="op" id="4688566">:=</span>&nbsp;<span class="keyword" id="4688569">range</span>&nbsp;<span class="ident" id="4688575">w</span><span class="op" id="4688576">.</span><span class="ident" id="4688577">literalFreq</span>&nbsp;<span class="op" id="4688589">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4688593">w</span><span class="op" id="4688594">.</span><span class="ident" id="4688595">literalFreq</span><span class="op" id="4688606">[</span><span class="ident" id="4688607">i</span><span class="op" id="4688608">]</span>&nbsp;<span class="op" id="4688610">=</span>&nbsp;<span class="num" id="4688612">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4688615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4688618">for</span>&nbsp;<span class="ident" id="4688622">i</span>&nbsp;<span class="op" id="4688624">:=</span>&nbsp;<span class="keyword" id="4688627">range</span>&nbsp;<span class="ident" id="4688633">w</span><span class="op" id="4688634">.</span><span class="ident" id="4688635">offsetFreq</span>&nbsp;<span class="op" id="4688646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4688650">w</span><span class="op" id="4688651">.</span><span class="ident" id="4688652">offsetFreq</span><span class="op" id="4688662">[</span><span class="ident" id="4688663">i</span><span class="op" id="4688664">]</span>&nbsp;<span class="op" id="4688666">=</span>&nbsp;<span class="num" id="4688668">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4688671">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4688675">n</span>&nbsp;<span class="op" id="4688677">:=</span>&nbsp;<span class="builtinfunc" id="4688680">len</span><span class="op" id="4688683">(</span><span class="ident" id="4688684">tokens</span><span class="op" id="4688690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4688693">tokens</span>&nbsp;<span class="op" id="4688700">=</span>&nbsp;<span class="ident" id="4688702">tokens</span><span class="op" id="4688708">[</span><span class="num" id="4688709">0</span>&nbsp;<span class="op" id="4688711">:</span>&nbsp;<span class="ident" id="4688713">n</span><span class="op" id="4688714">+</span><span class="num" id="4688715">1</span><span class="op" id="4688716">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4688719">tokens</span><span class="op" id="4688725">[</span><span class="ident" id="4688726">n</span><span class="op" id="4688727">]</span>&nbsp;<span class="op" id="4688729">=</span>&nbsp;<span class="ident" id="4688731">endBlockMarker</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4688748">for</span>&nbsp;<span class="ident" id="4688752">_</span><span class="op" id="4688753">,</span>&nbsp;<span class="ident" id="4688755">t</span>&nbsp;<span class="op" id="4688757">:=</span>&nbsp;<span class="keyword" id="4688760">range</span>&nbsp;<span class="ident" id="4688766">tokens</span>&nbsp;<span class="op" id="4688773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4688777">switch</span>&nbsp;<span class="ident" id="4688784">t</span><span class="op" id="4688785">.</span><span class="ident" id="4688786">typ</span><span class="op" id="4688789">(</span><span class="op" id="4688790">)</span>&nbsp;<span class="op" id="4688792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4688796">case</span>&nbsp;<span class="ident" id="4688801">literalType</span><span class="op" id="4688812">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4688817">w</span><span class="op" id="4688818">.</span><span class="ident" id="4688819">literalFreq</span><span class="op" id="4688830">[</span><span class="ident" id="4688831">t</span><span class="op" id="4688832">.</span><span class="ident" id="4688833">literal</span><span class="op" id="4688840">(</span><span class="op" id="4688841">)</span><span class="op" id="4688842">]</span><span class="op" id="4688843">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4688848">case</span>&nbsp;<span class="ident" id="4688853">matchType</span><span class="op" id="4688862">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4688867">length</span>&nbsp;<span class="op" id="4688874">:=</span>&nbsp;<span class="ident" id="4688877">t</span><span class="op" id="4688878">.</span><span class="ident" id="4688879">length</span><span class="op" id="4688885">(</span><span class="op" id="4688886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4688891">offset</span>&nbsp;<span class="op" id="4688898">:=</span>&nbsp;<span class="ident" id="4688901">t</span><span class="op" id="4688902">.</span><span class="ident" id="4688903">offset</span><span class="op" id="4688909">(</span><span class="op" id="4688910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4688915">w</span><span class="op" id="4688916">.</span><span class="ident" id="4688917">literalFreq</span><span class="op" id="4688928">[</span><span class="ident" id="4688929">lengthCodesStart</span><span class="op" id="4688945">+</span><span class="ident" id="4688946">lengthCode</span><span class="op" id="4688956">(</span><span class="ident" id="4688957">length</span><span class="op" id="4688963">)</span><span class="op" id="4688964">]</span><span class="op" id="4688965">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4688971">w</span><span class="op" id="4688972">.</span><span class="ident" id="4688973">offsetFreq</span><span class="op" id="4688983">[</span><span class="ident" id="4688984">offsetCode</span><span class="op" id="4688994">(</span><span class="ident" id="4688995">offset</span><span class="op" id="4689001">)</span><span class="op" id="4689002">]</span><span class="op" id="4689003">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4689008">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4689011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4689015">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4689046">numLiterals</span>&nbsp;<span class="op" id="4689058">:=</span>&nbsp;<span class="builtinfunc" id="4689061">len</span><span class="op" id="4689064">(</span><span class="ident" id="4689065">w</span><span class="op" id="4689066">.</span><span class="ident" id="4689067">literalFreq</span><span class="op" id="4689078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4689081">for</span>&nbsp;<span class="ident" id="4689085">w</span><span class="op" id="4689086">.</span><span class="ident" id="4689087">literalFreq</span><span class="op" id="4689098">[</span><span class="ident" id="4689099">numLiterals</span><span class="op" id="4689110">-</span><span class="num" id="4689111">1</span><span class="op" id="4689112">]</span>&nbsp;<span class="op" id="4689114">==</span>&nbsp;<span class="num" id="4689117">0</span>&nbsp;<span class="op" id="4689119">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4689123">numLiterals</span><span class="op" id="4689134">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4689138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4689141">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4689171">numOffsets</span>&nbsp;<span class="op" id="4689182">:=</span>&nbsp;<span class="builtinfunc" id="4689185">len</span><span class="op" id="4689188">(</span><span class="ident" id="4689189">w</span><span class="op" id="4689190">.</span><span class="ident" id="4689191">offsetFreq</span><span class="op" id="4689201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4689204">for</span>&nbsp;<span class="ident" id="4689208">numOffsets</span>&nbsp;<span class="op" id="4689219">&gt;</span>&nbsp;<span class="num" id="4689221">0</span>&nbsp;<span class="op" id="4689223">&amp;&amp;</span>&nbsp;<span class="ident" id="4689226">w</span><span class="op" id="4689227">.</span><span class="ident" id="4689228">offsetFreq</span><span class="op" id="4689238">[</span><span class="ident" id="4689239">numOffsets</span><span class="op" id="4689249">-</span><span class="num" id="4689250">1</span><span class="op" id="4689251">]</span>&nbsp;<span class="op" id="4689253">==</span>&nbsp;<span class="num" id="4689256">0</span>&nbsp;<span class="op" id="4689258">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4689262">numOffsets</span><span class="op" id="4689272">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4689276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4689279">if</span>&nbsp;<span class="ident" id="4689282">numOffsets</span>&nbsp;<span class="op" id="4689293">==</span>&nbsp;<span class="num" id="4689296">0</span>&nbsp;<span class="op" id="4689298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4689302">//&nbsp;We&nbsp;haven&#39;t&nbsp;found&nbsp;a&nbsp;single&nbsp;match.&nbsp;If&nbsp;we&nbsp;want&nbsp;to&nbsp;go&nbsp;with&nbsp;the&nbsp;dynamic&nbsp;encoding,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4689384">//&nbsp;we&nbsp;should&nbsp;count&nbsp;at&nbsp;least&nbsp;one&nbsp;offset&nbsp;to&nbsp;be&nbsp;sure&nbsp;that&nbsp;the&nbsp;offset&nbsp;huffman&nbsp;tree&nbsp;could&nbsp;be&nbsp;encoded.</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4689483">w</span><span class="op" id="4689484">.</span><span class="ident" id="4689485">offsetFreq</span><span class="op" id="4689495">[</span><span class="num" id="4689496">0</span><span class="op" id="4689497">]</span>&nbsp;<span class="op" id="4689499">=</span>&nbsp;<span class="num" id="4689501">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4689505">numOffsets</span>&nbsp;<span class="op" id="4689516">=</span>&nbsp;<span class="num" id="4689518">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4689521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4689525">w</span><span class="op" id="4689526">.</span><span class="ident" id="4689527">literalEncoding</span><span class="op" id="4689542">.</span><span class="ident" id="4689543">generate</span><span class="op" id="4689551">(</span><span class="ident" id="4689552">w</span><span class="op" id="4689553">.</span><span class="ident" id="4689554">literalFreq</span><span class="op" id="4689565">,</span>&nbsp;<span class="num" id="4689567">15</span><span class="op" id="4689569">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4689572">w</span><span class="op" id="4689573">.</span><span class="ident" id="4689574">offsetEncoding</span><span class="op" id="4689588">.</span><span class="ident" id="4689589">generate</span><span class="op" id="4689597">(</span><span class="ident" id="4689598">w</span><span class="op" id="4689599">.</span><span class="ident" id="4689600">offsetFreq</span><span class="op" id="4689610">,</span>&nbsp;<span class="num" id="4689612">15</span><span class="op" id="4689614">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4689618">storedBytes</span>&nbsp;<span class="op" id="4689630">:=</span>&nbsp;<span class="num" id="4689633">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4689636">if</span>&nbsp;<span class="ident" id="4689639">input</span>&nbsp;<span class="op" id="4689645">!=</span>&nbsp;<span class="builtintype" id="4689648">nil</span>&nbsp;<span class="op" id="4689652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4689656">storedBytes</span>&nbsp;<span class="op" id="4689668">=</span>&nbsp;<span class="builtinfunc" id="4689670">len</span><span class="op" id="4689673">(</span><span class="ident" id="4689674">input</span><span class="op" id="4689679">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4689682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4689685">var</span>&nbsp;<span class="ident" id="4689689">extraBits</span>&nbsp;<span class="builtintype" id="4689699">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4689706">var</span>&nbsp;<span class="ident" id="4689710">storedSize</span>&nbsp;<span class="builtintype" id="4689721">int64</span>&nbsp;<span class="op" id="4689727">=</span>&nbsp;<span class="ident" id="4689729">math</span><span class="op" id="4689733">.</span><span class="ident" id="4689734">MaxInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4689744">if</span>&nbsp;<span class="ident" id="4689747">storedBytes</span>&nbsp;<span class="op" id="4689759">&lt;=</span>&nbsp;<span class="ident" id="4689762">maxStoreBlockSize</span>&nbsp;<span class="op" id="4689780">&amp;&amp;</span>&nbsp;<span class="ident" id="4689783">input</span>&nbsp;<span class="op" id="4689789">!=</span>&nbsp;<span class="builtintype" id="4689792">nil</span>&nbsp;<span class="op" id="4689796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4689800">storedSize</span>&nbsp;<span class="op" id="4689811">=</span>&nbsp;<span class="builtintype" id="4689813">int64</span><span class="op" id="4689818">(</span><span class="op" id="4689819">(</span><span class="ident" id="4689820">storedBytes</span>&nbsp;<span class="op" id="4689832">+</span>&nbsp;<span class="num" id="4689834">5</span><span class="op" id="4689835">)</span>&nbsp;<span class="op" id="4689837">*</span>&nbsp;<span class="num" id="4689839">8</span><span class="op" id="4689840">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4689844">//&nbsp;We&nbsp;only&nbsp;bother&nbsp;calculating&nbsp;the&nbsp;costs&nbsp;of&nbsp;the&nbsp;extra&nbsp;bits&nbsp;required&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4689916">//&nbsp;the&nbsp;length&nbsp;of&nbsp;offset&nbsp;fields&nbsp;(which&nbsp;will&nbsp;be&nbsp;the&nbsp;same&nbsp;for&nbsp;both&nbsp;fixed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4689988">//&nbsp;and&nbsp;dynamic&nbsp;encoding),&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;compare&nbsp;those&nbsp;two&nbsp;encodings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4690058">//&nbsp;against&nbsp;stored&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4690088">for</span>&nbsp;<span class="ident" id="4690092">lengthCode</span>&nbsp;<span class="op" id="4690103">:=</span>&nbsp;<span class="ident" id="4690106">lengthCodesStart</span>&nbsp;<span class="op" id="4690123">+</span>&nbsp;<span class="num" id="4690125">8</span><span class="op" id="4690126">;</span>&nbsp;<span class="ident" id="4690128">lengthCode</span>&nbsp;<span class="op" id="4690139">&lt;</span>&nbsp;<span class="ident" id="4690141">numLiterals</span><span class="op" id="4690152">;</span>&nbsp;<span class="ident" id="4690154">lengthCode</span><span class="op" id="4690164">++</span>&nbsp;<span class="op" id="4690167">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4690172">//&nbsp;First&nbsp;eight&nbsp;length&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4690224">extraBits</span>&nbsp;<span class="op" id="4690234">+=</span>&nbsp;<span class="builtintype" id="4690237">int64</span><span class="op" id="4690242">(</span><span class="ident" id="4690243">w</span><span class="op" id="4690244">.</span><span class="ident" id="4690245">literalFreq</span><span class="op" id="4690256">[</span><span class="ident" id="4690257">lengthCode</span><span class="op" id="4690267">]</span><span class="op" id="4690268">)</span>&nbsp;<span class="op" id="4690270">*</span>&nbsp;<span class="builtintype" id="4690272">int64</span><span class="op" id="4690277">(</span><span class="ident" id="4690278">lengthExtraBits</span><span class="op" id="4690293">[</span><span class="ident" id="4690294">lengthCode</span><span class="op" id="4690304">-</span><span class="ident" id="4690305">lengthCodesStart</span><span class="op" id="4690321">]</span><span class="op" id="4690322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4690326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4690330">for</span>&nbsp;<span class="ident" id="4690334">offsetCode</span>&nbsp;<span class="op" id="4690345">:=</span>&nbsp;<span class="num" id="4690348">4</span><span class="op" id="4690349">;</span>&nbsp;<span class="ident" id="4690351">offsetCode</span>&nbsp;<span class="op" id="4690362">&lt;</span>&nbsp;<span class="ident" id="4690364">numOffsets</span><span class="op" id="4690374">;</span>&nbsp;<span class="ident" id="4690376">offsetCode</span><span class="op" id="4690386">++</span>&nbsp;<span class="op" id="4690389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4690394">//&nbsp;First&nbsp;four&nbsp;offset&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4690445">extraBits</span>&nbsp;<span class="op" id="4690455">+=</span>&nbsp;<span class="builtintype" id="4690458">int64</span><span class="op" id="4690463">(</span><span class="ident" id="4690464">w</span><span class="op" id="4690465">.</span><span class="ident" id="4690466">offsetFreq</span><span class="op" id="4690476">[</span><span class="ident" id="4690477">offsetCode</span><span class="op" id="4690487">]</span><span class="op" id="4690488">)</span>&nbsp;<span class="op" id="4690490">*</span>&nbsp;<span class="builtintype" id="4690492">int64</span><span class="op" id="4690497">(</span><span class="ident" id="4690498">offsetExtraBits</span><span class="op" id="4690513">[</span><span class="ident" id="4690514">offsetCode</span><span class="op" id="4690524">]</span><span class="op" id="4690525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4690529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4690532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4690536">//&nbsp;Figure&nbsp;out&nbsp;smallest&nbsp;code.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4690566">//&nbsp;Fixed&nbsp;Huffman&nbsp;baseline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4690594">var</span>&nbsp;<span class="ident" id="4690598">size</span>&nbsp;<span class="op" id="4690603">=</span>&nbsp;<span class="builtintype" id="4690605">int64</span><span class="op" id="4690610">(</span><span class="num" id="4690611">3</span><span class="op" id="4690612">)</span>&nbsp;<span class="op" id="4690614">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4690618">fixedLiteralEncoding</span><span class="op" id="4690638">.</span><span class="ident" id="4690639">bitLength</span><span class="op" id="4690648">(</span><span class="ident" id="4690649">w</span><span class="op" id="4690650">.</span><span class="ident" id="4690651">literalFreq</span><span class="op" id="4690662">)</span>&nbsp;<span class="op" id="4690664">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4690668">fixedOffsetEncoding</span><span class="op" id="4690687">.</span><span class="ident" id="4690688">bitLength</span><span class="op" id="4690697">(</span><span class="ident" id="4690698">w</span><span class="op" id="4690699">.</span><span class="ident" id="4690700">offsetFreq</span><span class="op" id="4690710">)</span>&nbsp;<span class="op" id="4690712">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4690716">extraBits</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4690727">var</span>&nbsp;<span class="ident" id="4690731">literalEncoding</span>&nbsp;<span class="op" id="4690747">=</span>&nbsp;<span class="ident" id="4690749">fixedLiteralEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4690771">var</span>&nbsp;<span class="ident" id="4690775">offsetEncoding</span>&nbsp;<span class="op" id="4690790">=</span>&nbsp;<span class="ident" id="4690792">fixedOffsetEncoding</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4690814">//&nbsp;Dynamic&nbsp;Huffman?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4690835">var</span>&nbsp;<span class="ident" id="4690839">numCodegens</span>&nbsp;<span class="builtintype" id="4690851">int</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4690857">//&nbsp;Generate&nbsp;codegen&nbsp;and&nbsp;codegenFrequencies,&nbsp;which&nbsp;indicates&nbsp;how&nbsp;to&nbsp;encode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4690932">//&nbsp;the&nbsp;literalEncoding&nbsp;and&nbsp;the&nbsp;offsetEncoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4690980">w</span><span class="op" id="4690981">.</span><span class="ident" id="4690982">generateCodegen</span><span class="op" id="4690997">(</span><span class="ident" id="4690998">numLiterals</span><span class="op" id="4691009">,</span>&nbsp;<span class="ident" id="4691011">numOffsets</span><span class="op" id="4691021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4691024">w</span><span class="op" id="4691025">.</span><span class="ident" id="4691026">codegenEncoding</span><span class="op" id="4691041">.</span><span class="ident" id="4691042">generate</span><span class="op" id="4691050">(</span><span class="ident" id="4691051">w</span><span class="op" id="4691052">.</span><span class="ident" id="4691053">codegenFreq</span><span class="op" id="4691064">,</span>&nbsp;<span class="num" id="4691066">7</span><span class="op" id="4691067">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4691070">numCodegens</span>&nbsp;<span class="op" id="4691082">=</span>&nbsp;<span class="builtinfunc" id="4691084">len</span><span class="op" id="4691087">(</span><span class="ident" id="4691088">w</span><span class="op" id="4691089">.</span><span class="ident" id="4691090">codegenFreq</span><span class="op" id="4691101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4691104">for</span>&nbsp;<span class="ident" id="4691108">numCodegens</span>&nbsp;<span class="op" id="4691120">&gt;</span>&nbsp;<span class="num" id="4691122">4</span>&nbsp;<span class="op" id="4691124">&amp;&amp;</span>&nbsp;<span class="ident" id="4691127">w</span><span class="op" id="4691128">.</span><span class="ident" id="4691129">codegenFreq</span><span class="op" id="4691140">[</span><span class="ident" id="4691141">codegenOrder</span><span class="op" id="4691153">[</span><span class="ident" id="4691154">numCodegens</span><span class="op" id="4691165">-</span><span class="num" id="4691166">1</span><span class="op" id="4691167">]</span><span class="op" id="4691168">]</span>&nbsp;<span class="op" id="4691170">==</span>&nbsp;<span class="num" id="4691173">0</span>&nbsp;<span class="op" id="4691175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4691179">numCodegens</span><span class="op" id="4691190">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4691194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4691197">dynamicHeader</span>&nbsp;<span class="op" id="4691211">:=</span>&nbsp;<span class="builtintype" id="4691214">int64</span><span class="op" id="4691219">(</span><span class="num" id="4691220">3</span><span class="op" id="4691221">+</span><span class="num" id="4691222">5</span><span class="op" id="4691223">+</span><span class="num" id="4691224">5</span><span class="op" id="4691225">+</span><span class="num" id="4691226">4</span><span class="op" id="4691227">+</span><span class="op" id="4691228">(</span><span class="num" id="4691229">3</span><span class="op" id="4691230">*</span><span class="ident" id="4691231">numCodegens</span><span class="op" id="4691242">)</span><span class="op" id="4691243">)</span>&nbsp;<span class="op" id="4691245">+</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4691249">w</span><span class="op" id="4691250">.</span><span class="ident" id="4691251">codegenEncoding</span><span class="op" id="4691266">.</span><span class="ident" id="4691267">bitLength</span><span class="op" id="4691276">(</span><span class="ident" id="4691277">w</span><span class="op" id="4691278">.</span><span class="ident" id="4691279">codegenFreq</span><span class="op" id="4691290">)</span>&nbsp;<span class="op" id="4691292">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4691296">int64</span><span class="op" id="4691301">(</span><span class="ident" id="4691302">extraBits</span><span class="op" id="4691311">)</span>&nbsp;<span class="op" id="4691313">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4691317">int64</span><span class="op" id="4691322">(</span><span class="ident" id="4691323">w</span><span class="op" id="4691324">.</span><span class="ident" id="4691325">codegenFreq</span><span class="op" id="4691336">[</span><span class="num" id="4691337">16</span><span class="op" id="4691339">]</span><span class="op" id="4691340">*</span><span class="num" id="4691341">2</span><span class="op" id="4691342">)</span>&nbsp;<span class="op" id="4691344">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4691348">int64</span><span class="op" id="4691353">(</span><span class="ident" id="4691354">w</span><span class="op" id="4691355">.</span><span class="ident" id="4691356">codegenFreq</span><span class="op" id="4691367">[</span><span class="num" id="4691368">17</span><span class="op" id="4691370">]</span><span class="op" id="4691371">*</span><span class="num" id="4691372">3</span><span class="op" id="4691373">)</span>&nbsp;<span class="op" id="4691375">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4691379">int64</span><span class="op" id="4691384">(</span><span class="ident" id="4691385">w</span><span class="op" id="4691386">.</span><span class="ident" id="4691387">codegenFreq</span><span class="op" id="4691398">[</span><span class="num" id="4691399">18</span><span class="op" id="4691401">]</span><span class="op" id="4691402">*</span><span class="num" id="4691403">7</span><span class="op" id="4691404">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4691407">dynamicSize</span>&nbsp;<span class="op" id="4691419">:=</span>&nbsp;<span class="ident" id="4691422">dynamicHeader</span>&nbsp;<span class="op" id="4691436">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4691440">w</span><span class="op" id="4691441">.</span><span class="ident" id="4691442">literalEncoding</span><span class="op" id="4691457">.</span><span class="ident" id="4691458">bitLength</span><span class="op" id="4691467">(</span><span class="ident" id="4691468">w</span><span class="op" id="4691469">.</span><span class="ident" id="4691470">literalFreq</span><span class="op" id="4691481">)</span>&nbsp;<span class="op" id="4691483">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4691487">w</span><span class="op" id="4691488">.</span><span class="ident" id="4691489">offsetEncoding</span><span class="op" id="4691503">.</span><span class="ident" id="4691504">bitLength</span><span class="op" id="4691513">(</span><span class="ident" id="4691514">w</span><span class="op" id="4691515">.</span><span class="ident" id="4691516">offsetFreq</span><span class="op" id="4691526">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4691530">if</span>&nbsp;<span class="ident" id="4691533">dynamicSize</span>&nbsp;<span class="op" id="4691545">&lt;</span>&nbsp;<span class="ident" id="4691547">size</span>&nbsp;<span class="op" id="4691552">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4691556">size</span>&nbsp;<span class="op" id="4691561">=</span>&nbsp;<span class="ident" id="4691563">dynamicSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4691577">literalEncoding</span>&nbsp;<span class="op" id="4691593">=</span>&nbsp;<span class="ident" id="4691595">w</span><span class="op" id="4691596">.</span><span class="ident" id="4691597">literalEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4691615">offsetEncoding</span>&nbsp;<span class="op" id="4691630">=</span>&nbsp;<span class="ident" id="4691632">w</span><span class="op" id="4691633">.</span><span class="ident" id="4691634">offsetEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4691650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4691654">//&nbsp;Stored&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4691672">if</span>&nbsp;<span class="ident" id="4691675">storedSize</span>&nbsp;<span class="op" id="4691686">&lt;</span>&nbsp;<span class="ident" id="4691688">size</span>&nbsp;<span class="op" id="4691693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4691697">w</span><span class="op" id="4691698">.</span><span class="ident" id="4691699">writeStoredHeader</span><span class="op" id="4691716">(</span><span class="ident" id="4691717">storedBytes</span><span class="op" id="4691728">,</span>&nbsp;<span class="ident" id="4691730">eof</span><span class="op" id="4691733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4691737">w</span><span class="op" id="4691738">.</span><span class="ident" id="4691739">writeBytes</span><span class="op" id="4691749">(</span><span class="ident" id="4691750">input</span><span class="op" id="4691755">[</span><span class="num" id="4691756">0</span><span class="op" id="4691757">:</span><span class="ident" id="4691758">storedBytes</span><span class="op" id="4691769">]</span><span class="op" id="4691770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4691774">return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4691782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4691786">//&nbsp;Huffman.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4691799">if</span>&nbsp;<span class="ident" id="4691802">literalEncoding</span>&nbsp;<span class="op" id="4691818">==</span>&nbsp;<span class="ident" id="4691821">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4691842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4691846">w</span><span class="op" id="4691847">.</span><span class="ident" id="4691848">writeFixedHeader</span><span class="op" id="4691864">(</span><span class="ident" id="4691865">eof</span><span class="op" id="4691868">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4691871">}</span>&nbsp;<span class="keyword" id="4691873">else</span>&nbsp;<span class="op" id="4691878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4691882">w</span><span class="op" id="4691883">.</span><span class="ident" id="4691884">writeDynamicHeader</span><span class="op" id="4691902">(</span><span class="ident" id="4691903">numLiterals</span><span class="op" id="4691914">,</span>&nbsp;<span class="ident" id="4691916">numOffsets</span><span class="op" id="4691926">,</span>&nbsp;<span class="ident" id="4691928">numCodegens</span><span class="op" id="4691939">,</span>&nbsp;<span class="ident" id="4691941">eof</span><span class="op" id="4691944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4691947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4691950">for</span>&nbsp;<span class="ident" id="4691954">_</span><span class="op" id="4691955">,</span>&nbsp;<span class="ident" id="4691957">t</span>&nbsp;<span class="op" id="4691959">:=</span>&nbsp;<span class="keyword" id="4691962">range</span>&nbsp;<span class="ident" id="4691968">tokens</span>&nbsp;<span class="op" id="4691975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4691979">switch</span>&nbsp;<span class="ident" id="4691986">t</span><span class="op" id="4691987">.</span><span class="ident" id="4691988">typ</span><span class="op" id="4691991">(</span><span class="op" id="4691992">)</span>&nbsp;<span class="op" id="4691994">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4691998">case</span>&nbsp;<span class="ident" id="4692003">literalType</span><span class="op" id="4692014">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4692019">w</span><span class="op" id="4692020">.</span><span class="ident" id="4692021">writeCode</span><span class="op" id="4692030">(</span><span class="ident" id="4692031">literalEncoding</span><span class="op" id="4692046">,</span>&nbsp;<span class="ident" id="4692048">t</span><span class="op" id="4692049">.</span><span class="ident" id="4692050">literal</span><span class="op" id="4692057">(</span><span class="op" id="4692058">)</span><span class="op" id="4692059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4692064">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4692072">case</span>&nbsp;<span class="ident" id="4692077">matchType</span><span class="op" id="4692086">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4692091">//&nbsp;Write&nbsp;the&nbsp;length</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4692114">length</span>&nbsp;<span class="op" id="4692121">:=</span>&nbsp;<span class="ident" id="4692124">t</span><span class="op" id="4692125">.</span><span class="ident" id="4692126">length</span><span class="op" id="4692132">(</span><span class="op" id="4692133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4692138">lengthCode</span>&nbsp;<span class="op" id="4692149">:=</span>&nbsp;<span class="ident" id="4692152">lengthCode</span><span class="op" id="4692162">(</span><span class="ident" id="4692163">length</span><span class="op" id="4692169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4692174">w</span><span class="op" id="4692175">.</span><span class="ident" id="4692176">writeCode</span><span class="op" id="4692185">(</span><span class="ident" id="4692186">literalEncoding</span><span class="op" id="4692201">,</span>&nbsp;<span class="ident" id="4692203">lengthCode</span><span class="op" id="4692213">+</span><span class="ident" id="4692214">lengthCodesStart</span><span class="op" id="4692230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4692235">extraLengthBits</span>&nbsp;<span class="op" id="4692251">:=</span>&nbsp;<span class="builtintype" id="4692254">int32</span><span class="op" id="4692259">(</span><span class="ident" id="4692260">lengthExtraBits</span><span class="op" id="4692275">[</span><span class="ident" id="4692276">lengthCode</span><span class="op" id="4692286">]</span><span class="op" id="4692287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4692292">if</span>&nbsp;<span class="ident" id="4692295">extraLengthBits</span>&nbsp;<span class="op" id="4692311">&gt;</span>&nbsp;<span class="num" id="4692313">0</span>&nbsp;<span class="op" id="4692315">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4692321">extraLength</span>&nbsp;<span class="op" id="4692333">:=</span>&nbsp;<span class="builtintype" id="4692336">int32</span><span class="op" id="4692341">(</span><span class="ident" id="4692342">length</span>&nbsp;<span class="op" id="4692349">-</span>&nbsp;<span class="ident" id="4692351">lengthBase</span><span class="op" id="4692361">[</span><span class="ident" id="4692362">lengthCode</span><span class="op" id="4692372">]</span><span class="op" id="4692373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4692379">w</span><span class="op" id="4692380">.</span><span class="ident" id="4692381">writeBits</span><span class="op" id="4692390">(</span><span class="ident" id="4692391">extraLength</span><span class="op" id="4692402">,</span>&nbsp;<span class="ident" id="4692404">extraLengthBits</span><span class="op" id="4692419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4692424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4692429">//&nbsp;Write&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4692452">offset</span>&nbsp;<span class="op" id="4692459">:=</span>&nbsp;<span class="ident" id="4692462">t</span><span class="op" id="4692463">.</span><span class="ident" id="4692464">offset</span><span class="op" id="4692470">(</span><span class="op" id="4692471">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4692476">offsetCode</span>&nbsp;<span class="op" id="4692487">:=</span>&nbsp;<span class="ident" id="4692490">offsetCode</span><span class="op" id="4692500">(</span><span class="ident" id="4692501">offset</span><span class="op" id="4692507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4692512">w</span><span class="op" id="4692513">.</span><span class="ident" id="4692514">writeCode</span><span class="op" id="4692523">(</span><span class="ident" id="4692524">offsetEncoding</span><span class="op" id="4692538">,</span>&nbsp;<span class="ident" id="4692540">offsetCode</span><span class="op" id="4692550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4692555">extraOffsetBits</span>&nbsp;<span class="op" id="4692571">:=</span>&nbsp;<span class="builtintype" id="4692574">int32</span><span class="op" id="4692579">(</span><span class="ident" id="4692580">offsetExtraBits</span><span class="op" id="4692595">[</span><span class="ident" id="4692596">offsetCode</span><span class="op" id="4692606">]</span><span class="op" id="4692607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4692612">if</span>&nbsp;<span class="ident" id="4692615">extraOffsetBits</span>&nbsp;<span class="op" id="4692631">&gt;</span>&nbsp;<span class="num" id="4692633">0</span>&nbsp;<span class="op" id="4692635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4692641">extraOffset</span>&nbsp;<span class="op" id="4692653">:=</span>&nbsp;<span class="builtintype" id="4692656">int32</span><span class="op" id="4692661">(</span><span class="ident" id="4692662">offset</span>&nbsp;<span class="op" id="4692669">-</span>&nbsp;<span class="ident" id="4692671">offsetBase</span><span class="op" id="4692681">[</span><span class="ident" id="4692682">offsetCode</span><span class="op" id="4692692">]</span><span class="op" id="4692693">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4692699">w</span><span class="op" id="4692700">.</span><span class="ident" id="4692701">writeBits</span><span class="op" id="4692710">(</span><span class="ident" id="4692711">extraOffset</span><span class="op" id="4692722">,</span>&nbsp;<span class="ident" id="4692724">extraOffsetBits</span><span class="op" id="4692739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4692744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4692749">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4692757">default</span><span class="op" id="4692764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4692769">panic</span><span class="op" id="4692774">(</span><span class="string" id="4692775">&#34;unknown&nbsp;token&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="4692798">+</span>&nbsp;<span class="builtintype" id="4692800">string</span><span class="op" id="4692806">(</span><span class="ident" id="4692807">t</span><span class="op" id="4692808">)</span><span class="op" id="4692809">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4692813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4692816">}</span><br>
<span class="lineno"></span><span class="op" id="4692818">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
