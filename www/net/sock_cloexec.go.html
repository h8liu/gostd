<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1488401">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1488456">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1488510">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1488561">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;sysSocket&nbsp;and&nbsp;accept&nbsp;for&nbsp;platforms&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="1488625">//&nbsp;provide&nbsp;a&nbsp;fast&nbsp;path&nbsp;for&nbsp;setting&nbsp;SetNonblock&nbsp;and&nbsp;CloseOnExec.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1488690">//&nbsp;+build&nbsp;freebsd&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="1488715">package</span>&nbsp;<span class="ident" id="1488723">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1488728">import</span>&nbsp;<span class="string" id="1488735">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1488746">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;socket&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">15</span><span class="comment" id="1488816">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="1488864">func</span>&nbsp;<span class="ident" id="1488869">sysSocket</span><span class="op" id="1488878">(</span><span class="ident" id="1488879">family</span><span class="op" id="1488885">,</span>&nbsp;<span class="ident" id="1488887">sotype</span><span class="op" id="1488893">,</span>&nbsp;<span class="ident" id="1488895">proto</span>&nbsp;<span class="builtintype" id="1488901">int</span><span class="op" id="1488904">)</span>&nbsp;<span class="op" id="1488906">(</span><span class="builtintype" id="1488907">int</span><span class="op" id="1488910">,</span>&nbsp;<span class="builtintype" id="1488912">error</span><span class="op" id="1488917">)</span>&nbsp;<span class="op" id="1488919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1488922">s</span><span class="op" id="1488923">,</span>&nbsp;<span class="ident" id="1488925">err</span>&nbsp;<span class="op" id="1488929">:=</span>&nbsp;<span class="ident" id="1488932"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1488939">.</span><span class="ident" id="1488940">Socket</span><span class="op" id="1488946">(</span><span class="ident" id="1488947"><a href="/net/sock_cloexec.go.html#1488879">family</a></span><span class="op" id="1488953">,</span>&nbsp;<span class="ident" id="1488955"><a href="/net/sock_cloexec.go.html#1488887">sotype</a></span><span class="op" id="1488961">|</span><span class="ident" id="1488962"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1488969">.</span><span class="ident" id="1488970">SOCK_NONBLOCK</span><span class="op" id="1488983">|</span><span class="ident" id="1488984"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1488991">.</span><span class="ident" id="1488992">SOCK_CLOEXEC</span><span class="op" id="1489004">,</span>&nbsp;<span class="ident" id="1489006"><a href="/net/sock_cloexec.go.html#1488895">proto</a></span><span class="op" id="1489011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1489014">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;SOCK_NONBLOCK&nbsp;and&nbsp;SOCK_CLOEXEC&nbsp;flags&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1489073">//&nbsp;introduced&nbsp;in&nbsp;2.6.27&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;both&nbsp;flags&nbsp;were</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1489136">//&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we&nbsp;get&nbsp;an&nbsp;EINVAL&nbsp;error&nbsp;on&nbsp;Linux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1489200">//&nbsp;or&nbsp;EPROTONOSUPPORT&nbsp;error&nbsp;on&nbsp;FreeBSD,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1489260">//&nbsp;socket&nbsp;without&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489285">if</span>&nbsp;<span class="ident" id="1489288"><a href="/net/sock_cloexec.go.html#1488925">err</a></span>&nbsp;<span class="op" id="1489292">==</span>&nbsp;<span class="ident" id="1489295">nil</span>&nbsp;<span class="op" id="1489299">||</span>&nbsp;<span class="op" id="1489302">(</span><span class="ident" id="1489303"><a href="/net/sock_cloexec.go.html#1488925">err</a></span>&nbsp;<span class="op" id="1489307">!=</span>&nbsp;<span class="ident" id="1489310"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1489317">.</span><span class="ident" id="1489318">EPROTONOSUPPORT</span>&nbsp;<span class="op" id="1489334">&amp;&amp;</span>&nbsp;<span class="ident" id="1489337"><a href="/net/sock_cloexec.go.html#1488925">err</a></span>&nbsp;<span class="op" id="1489341">!=</span>&nbsp;<span class="ident" id="1489344"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1489351">.</span><span class="ident" id="1489352">EINVAL</span><span class="op" id="1489358">)</span>&nbsp;<span class="op" id="1489360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489364">return</span>&nbsp;<span class="ident" id="1489371"><a href="/net/sock_cloexec.go.html#1488922">s</a></span><span class="op" id="1489372">,</span>&nbsp;<span class="ident" id="1489374"><a href="/net/sock_cloexec.go.html#1488925">err</a></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1489379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1489383">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1489444"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1489451">.</span><span class="ident" id="1489452">ForkLock</span><span class="op" id="1489460">.</span><span class="ident" id="1489461">RLock</span><span class="op" id="1489466">(</span><span class="op" id="1489467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1489470"><a href="/net/sock_cloexec.go.html#1488922">s</a></span><span class="op" id="1489471">,</span>&nbsp;<span class="ident" id="1489473"><a href="/net/sock_cloexec.go.html#1488925">err</a></span>&nbsp;<span class="op" id="1489477">=</span>&nbsp;<span class="ident" id="1489479"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1489486">.</span><span class="ident" id="1489487">Socket</span><span class="op" id="1489493">(</span><span class="ident" id="1489494"><a href="/net/sock_cloexec.go.html#1488879">family</a></span><span class="op" id="1489500">,</span>&nbsp;<span class="ident" id="1489502"><a href="/net/sock_cloexec.go.html#1488887">sotype</a></span><span class="op" id="1489508">,</span>&nbsp;<span class="ident" id="1489510"><a href="/net/sock_cloexec.go.html#1488895">proto</a></span><span class="op" id="1489515">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489518">if</span>&nbsp;<span class="ident" id="1489521"><a href="/net/sock_cloexec.go.html#1488925">err</a></span>&nbsp;<span class="op" id="1489525">==</span>&nbsp;<span class="ident" id="1489528">nil</span>&nbsp;<span class="op" id="1489532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1489536"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1489543">.</span><span class="ident" id="1489544">CloseOnExec</span><span class="op" id="1489555">(</span><span class="ident" id="1489556"><a href="/net/sock_cloexec.go.html#1488922">s</a></span><span class="op" id="1489557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1489560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1489563"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1489570">.</span><span class="ident" id="1489571">ForkLock</span><span class="op" id="1489579">.</span><span class="ident" id="1489580">RUnlock</span><span class="op" id="1489587">(</span><span class="op" id="1489588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489591">if</span>&nbsp;<span class="ident" id="1489594"><a href="/net/sock_cloexec.go.html#1488925">err</a></span>&nbsp;<span class="op" id="1489598">!=</span>&nbsp;<span class="ident" id="1489601">nil</span>&nbsp;<span class="op" id="1489605">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489609">return</span>&nbsp;<span class="op" id="1489616">-</span><span class="num" id="1489617">1</span><span class="op" id="1489618">,</span>&nbsp;<span class="ident" id="1489620"><a href="/net/sock_cloexec.go.html#1488925">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1489625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489628">if</span>&nbsp;<span class="ident" id="1489631"><a href="/net/sock_cloexec.go.html#1488925">err</a></span>&nbsp;<span class="op" id="1489635">=</span>&nbsp;<span class="ident" id="1489637"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1489644">.</span><span class="ident" id="1489645">SetNonblock</span><span class="op" id="1489656">(</span><span class="ident" id="1489657"><a href="/net/sock_cloexec.go.html#1488922">s</a></span><span class="op" id="1489658">,</span>&nbsp;<span class="builtintype" id="1489660">true</span><span class="op" id="1489664">)</span><span class="op" id="1489665">;</span>&nbsp;<span class="ident" id="1489667"><a href="/net/sock_cloexec.go.html#1488925">err</a></span>&nbsp;<span class="op" id="1489671">!=</span>&nbsp;<span class="ident" id="1489674">nil</span>&nbsp;<span class="op" id="1489678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1489682"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1489689">.</span><span class="ident" id="1489690">Close</span><span class="op" id="1489695">(</span><span class="ident" id="1489696"><a href="/net/sock_cloexec.go.html#1488922">s</a></span><span class="op" id="1489697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489701">return</span>&nbsp;<span class="op" id="1489708">-</span><span class="num" id="1489709">1</span><span class="op" id="1489710">,</span>&nbsp;<span class="ident" id="1489712"><a href="/net/sock_cloexec.go.html#1488925">err</a></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1489717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489720">return</span>&nbsp;<span class="ident" id="1489727"><a href="/net/sock_cloexec.go.html#1488922">s</a></span><span class="op" id="1489728">,</span>&nbsp;<span class="ident" id="1489730">nil</span><br>
<span class="lineno"></span><span class="op" id="1489734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1489737">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;accept&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">45</span><span class="comment" id="1489807">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="1489855">func</span>&nbsp;<span class="ident" id="1489860">accept</span><span class="op" id="1489866">(</span><span class="ident" id="1489867">s</span>&nbsp;<span class="builtintype" id="1489869">int</span><span class="op" id="1489872">)</span>&nbsp;<span class="op" id="1489874">(</span><span class="builtintype" id="1489875">int</span><span class="op" id="1489878">,</span>&nbsp;<span class="ident" id="1489880"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1489887">.</span><span class="ident" id="1489888">Sockaddr</span><span class="op" id="1489896">,</span>&nbsp;<span class="builtintype" id="1489898">error</span><span class="op" id="1489903">)</span>&nbsp;<span class="op" id="1489905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1489908">ns</span><span class="op" id="1489910">,</span>&nbsp;<span class="ident" id="1489912">sa</span><span class="op" id="1489914">,</span>&nbsp;<span class="ident" id="1489916">err</span>&nbsp;<span class="op" id="1489920">:=</span>&nbsp;<span class="ident" id="1489923"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1489930">.</span><span class="ident" id="1489931">Accept4</span><span class="op" id="1489938">(</span><span class="ident" id="1489939"><a href="/net/sock_cloexec.go.html#1489867">s</a></span><span class="op" id="1489940">,</span>&nbsp;<span class="ident" id="1489942"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1489949">.</span><span class="ident" id="1489950">SOCK_NONBLOCK</span><span class="op" id="1489963">|</span><span class="ident" id="1489964"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1489971">.</span><span class="ident" id="1489972">SOCK_CLOEXEC</span><span class="op" id="1489984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1489987">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;accept4&nbsp;system&nbsp;call&nbsp;was&nbsp;introduced&nbsp;in&nbsp;2.6.28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1490049">//&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;it&nbsp;was&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1490113">//&nbsp;get&nbsp;an&nbsp;ENOSYS&nbsp;error&nbsp;on&nbsp;both&nbsp;Linux&nbsp;and&nbsp;FreeBSD,&nbsp;or&nbsp;EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1490174">//&nbsp;error&nbsp;on&nbsp;Linux,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using&nbsp;accept.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490221">switch</span>&nbsp;<span class="ident" id="1490228"><a href="/net/sock_cloexec.go.html#1489916">err</a></span>&nbsp;<span class="op" id="1490232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490235">default</span><span class="op" id="1490242">:</span>&nbsp;<span class="comment" id="1490244">//&nbsp;nil&nbsp;and&nbsp;errors&nbsp;other&nbsp;than&nbsp;the&nbsp;ones&nbsp;listed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490291">return</span>&nbsp;<span class="ident" id="1490298"><a href="/net/sock_cloexec.go.html#1489908">ns</a></span><span class="op" id="1490300">,</span>&nbsp;<span class="ident" id="1490302"><a href="/net/sock_cloexec.go.html#1489912">sa</a></span><span class="op" id="1490304">,</span>&nbsp;<span class="ident" id="1490306"><a href="/net/sock_cloexec.go.html#1489916">err</a></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490311">case</span>&nbsp;<span class="ident" id="1490316"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1490323">.</span><span class="ident" id="1490324">ENOSYS</span><span class="op" id="1490330">:</span>&nbsp;<span class="comment" id="1490332">//&nbsp;syscall&nbsp;missing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490352">case</span>&nbsp;<span class="ident" id="1490357"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1490364">.</span><span class="ident" id="1490365">EINVAL</span><span class="op" id="1490371">:</span>&nbsp;<span class="comment" id="1490373">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490415">case</span>&nbsp;<span class="ident" id="1490420"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1490427">.</span><span class="ident" id="1490428">EACCES</span><span class="op" id="1490434">:</span>&nbsp;<span class="comment" id="1490436">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490478">case</span>&nbsp;<span class="ident" id="1490483"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1490490">.</span><span class="ident" id="1490491">EFAULT</span><span class="op" id="1490497">:</span>&nbsp;<span class="comment" id="1490499">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1490541">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1490545">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1490606">//&nbsp;It&nbsp;is&nbsp;probably&nbsp;okay&nbsp;to&nbsp;hold&nbsp;the&nbsp;lock&nbsp;across&nbsp;syscall.Accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1490669">//&nbsp;because&nbsp;we&nbsp;have&nbsp;put&nbsp;fd.sysfd&nbsp;into&nbsp;non-blocking&nbsp;mode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1490726">//&nbsp;However,&nbsp;a&nbsp;call&nbsp;to&nbsp;the&nbsp;File&nbsp;method&nbsp;will&nbsp;put&nbsp;it&nbsp;back&nbsp;into</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1490787">//&nbsp;blocking&nbsp;mode.&nbsp;We&nbsp;can&#39;t&nbsp;take&nbsp;that&nbsp;risk,&nbsp;so&nbsp;no&nbsp;use&nbsp;of&nbsp;ForkLock&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1490859"><a href="/net/sock_cloexec.go.html#1489908">ns</a></span><span class="op" id="1490861">,</span>&nbsp;<span class="ident" id="1490863"><a href="/net/sock_cloexec.go.html#1489912">sa</a></span><span class="op" id="1490865">,</span>&nbsp;<span class="ident" id="1490867"><a href="/net/sock_cloexec.go.html#1489916">err</a></span>&nbsp;<span class="op" id="1490871">=</span>&nbsp;<span class="ident" id="1490873"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1490880">.</span><span class="ident" id="1490881">Accept</span><span class="op" id="1490887">(</span><span class="ident" id="1490888"><a href="/net/sock_cloexec.go.html#1489867">s</a></span><span class="op" id="1490889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490892">if</span>&nbsp;<span class="ident" id="1490895"><a href="/net/sock_cloexec.go.html#1489916">err</a></span>&nbsp;<span class="op" id="1490899">==</span>&nbsp;<span class="ident" id="1490902">nil</span>&nbsp;<span class="op" id="1490906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1490910"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1490917">.</span><span class="ident" id="1490918">CloseOnExec</span><span class="op" id="1490929">(</span><span class="ident" id="1490930"><a href="/net/sock_cloexec.go.html#1489908">ns</a></span><span class="op" id="1490932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1490935">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490938">if</span>&nbsp;<span class="ident" id="1490941"><a href="/net/sock_cloexec.go.html#1489916">err</a></span>&nbsp;<span class="op" id="1490945">!=</span>&nbsp;<span class="ident" id="1490948">nil</span>&nbsp;<span class="op" id="1490952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490956">return</span>&nbsp;<span class="op" id="1490963">-</span><span class="num" id="1490964">1</span><span class="op" id="1490965">,</span>&nbsp;<span class="ident" id="1490967">nil</span><span class="op" id="1490970">,</span>&nbsp;<span class="ident" id="1490972"><a href="/net/sock_cloexec.go.html#1489916">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1490977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490980">if</span>&nbsp;<span class="ident" id="1490983"><a href="/net/sock_cloexec.go.html#1489916">err</a></span>&nbsp;<span class="op" id="1490987">=</span>&nbsp;<span class="ident" id="1490989"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1490996">.</span><span class="ident" id="1490997">SetNonblock</span><span class="op" id="1491008">(</span><span class="ident" id="1491009"><a href="/net/sock_cloexec.go.html#1489908">ns</a></span><span class="op" id="1491011">,</span>&nbsp;<span class="builtintype" id="1491013">true</span><span class="op" id="1491017">)</span><span class="op" id="1491018">;</span>&nbsp;<span class="ident" id="1491020"><a href="/net/sock_cloexec.go.html#1489916">err</a></span>&nbsp;<span class="op" id="1491024">!=</span>&nbsp;<span class="ident" id="1491027">nil</span>&nbsp;<span class="op" id="1491031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1491035"><a href="/net/sock_cloexec.go.html#1488735">syscall</a></span><span class="op" id="1491042">.</span><span class="ident" id="1491043">Close</span><span class="op" id="1491048">(</span><span class="ident" id="1491049"><a href="/net/sock_cloexec.go.html#1489908">ns</a></span><span class="op" id="1491051">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491055">return</span>&nbsp;<span class="op" id="1491062">-</span><span class="num" id="1491063">1</span><span class="op" id="1491064">,</span>&nbsp;<span class="ident" id="1491066">nil</span><span class="op" id="1491069">,</span>&nbsp;<span class="ident" id="1491071"><a href="/net/sock_cloexec.go.html#1489916">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1491076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491079">return</span>&nbsp;<span class="ident" id="1491086"><a href="/net/sock_cloexec.go.html#1489908">ns</a></span><span class="op" id="1491088">,</span>&nbsp;<span class="ident" id="1491090"><a href="/net/sock_cloexec.go.html#1489912">sa</a></span><span class="op" id="1491092">,</span>&nbsp;<span class="ident" id="1491094">nil</span><br>
<span class="lineno"></span><span class="op" id="1491098">}</span>
</div>
</body>
</html>
