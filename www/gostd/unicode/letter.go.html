<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>unicode</h2>
<ul>
<li><a href="/gostd/unicode/casetables.go.html">casetables.go</a></li>
<li><a href="/gostd/unicode/digit.go.html">digit.go</a></li>
<li><a href="/gostd/unicode/digit_test.go.html">digit_test.go</a></li>
<li><a href="/gostd/unicode/graphic.go.html">graphic.go</a></li>
<li><a href="/gostd/unicode/graphic_test.go.html">graphic_test.go</a></li>
<li><a href="/gostd/unicode/letter.go.html">letter.go</a></li>
<li><a href="/gostd/unicode/letter_test.go.html">letter_test.go</a></li>
<li><a href="/gostd/unicode/script_test.go.html">script_test.go</a></li>
<li><a href="/gostd/unicode/tables.go.html">tables.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1991064">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1991119">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1991173">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1991224">//&nbsp;Package&nbsp;unicode&nbsp;provides&nbsp;data&nbsp;and&nbsp;functions&nbsp;to&nbsp;test&nbsp;some&nbsp;properties&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1991298">//&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="keyword" id="1991322">package</span>&nbsp;<span class="ident" id="1991330">unicode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1991339">//&nbsp;Tables&nbsp;are&nbsp;regenerated&nbsp;each&nbsp;time&nbsp;we&nbsp;update&nbsp;the&nbsp;Unicode&nbsp;version.</span><br>
<span class="lineno">10</span><span class="comment" id="1991406">//go:generate&nbsp;go&nbsp;run&nbsp;maketables.go&nbsp;-tables=all&nbsp;-output&nbsp;tables.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1991472">const</span>&nbsp;<span class="op" id="1991478">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1991481">MaxRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1991497">=</span>&nbsp;<span class="string" id="1991499">&#39;\U0010FFFF&#39;</span>&nbsp;<span class="comment" id="1991512">//&nbsp;Maximum&nbsp;valid&nbsp;Unicode&nbsp;code&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1991550">ReplacementChar</span>&nbsp;<span class="op" id="1991566">=</span>&nbsp;<span class="string" id="1991568">&#39;\uFFFD&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1991581">//&nbsp;Represents&nbsp;invalid&nbsp;code&nbsp;points.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1991617">MaxASCII</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1991633">=</span>&nbsp;<span class="string" id="1991635">&#39;\u007F&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1991648">//&nbsp;maximum&nbsp;ASCII&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1991673">MaxLatin1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1991689">=</span>&nbsp;<span class="string" id="1991691">&#39;\u00FF&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1991704">//&nbsp;maximum&nbsp;Latin-1&nbsp;value.</span><br>
<span class="lineno"></span><span class="op" id="1991730">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1991733">//&nbsp;RangeTable&nbsp;defines&nbsp;a&nbsp;set&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;by&nbsp;listing&nbsp;the&nbsp;ranges&nbsp;of</span><br>
<span class="lineno">20</span><span class="comment" id="1991809">//&nbsp;code&nbsp;points&nbsp;within&nbsp;the&nbsp;set.&nbsp;The&nbsp;ranges&nbsp;are&nbsp;listed&nbsp;in&nbsp;two&nbsp;slices</span><br>
<span class="lineno"></span><span class="comment" id="1991876">//&nbsp;to&nbsp;save&nbsp;space:&nbsp;a&nbsp;slice&nbsp;of&nbsp;16-bit&nbsp;ranges&nbsp;and&nbsp;a&nbsp;slice&nbsp;of&nbsp;32-bit&nbsp;ranges.</span><br>
<span class="lineno"></span><span class="comment" id="1991949">//&nbsp;The&nbsp;two&nbsp;slices&nbsp;must&nbsp;be&nbsp;in&nbsp;sorted&nbsp;order&nbsp;and&nbsp;non-overlapping.</span><br>
<span class="lineno"></span><span class="comment" id="1992012">//&nbsp;Also,&nbsp;R32&nbsp;should&nbsp;contain&nbsp;only&nbsp;values&nbsp;&gt;=&nbsp;0x10000&nbsp;(1&lt;&lt;16).</span><br>
<span class="lineno"></span><span class="keyword" id="1992072">type</span>&nbsp;<span class="ident" id="1992077">RangeTable</span>&nbsp;<span class="keyword" id="1992088">struct</span>&nbsp;<span class="op" id="1992095">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1992098">R16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1992110">[</span><span class="op" id="1992111">]</span><span class="ident" id="1992112">Range16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1992121">R32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1992133">[</span><span class="op" id="1992134">]</span><span class="ident" id="1992135">Range32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1992144">LatinOffset</span>&nbsp;<span class="builtintype" id="1992156">int</span>&nbsp;<span class="comment" id="1992160">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;R16&nbsp;with&nbsp;Hi&nbsp;&lt;=&nbsp;MaxLatin1</span><br>
<span class="lineno"></span><span class="op" id="1992209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="1992212">//&nbsp;Range16&nbsp;represents&nbsp;of&nbsp;a&nbsp;range&nbsp;of&nbsp;16-bit&nbsp;Unicode&nbsp;code&nbsp;points.&nbsp;&nbsp;The&nbsp;range&nbsp;runs&nbsp;from&nbsp;Lo&nbsp;to&nbsp;Hi</span><br>
<span class="lineno"></span><span class="comment" id="1992306">//&nbsp;inclusive&nbsp;and&nbsp;has&nbsp;the&nbsp;specified&nbsp;stride.</span><br>
<span class="lineno"></span><span class="keyword" id="1992349">type</span>&nbsp;<span class="ident" id="1992354">Range16</span>&nbsp;<span class="keyword" id="1992362">struct</span>&nbsp;<span class="op" id="1992369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1992372">Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1992379">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1992387">Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1992394">uint16</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1992402">Stride</span>&nbsp;<span class="builtintype" id="1992409">uint16</span><br>
<span class="lineno"></span><span class="op" id="1992416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1992419">//&nbsp;Range32&nbsp;represents&nbsp;of&nbsp;a&nbsp;range&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;and&nbsp;is&nbsp;used&nbsp;when&nbsp;one&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="1992499">//&nbsp;more&nbsp;of&nbsp;the&nbsp;values&nbsp;will&nbsp;not&nbsp;fit&nbsp;in&nbsp;16&nbsp;bits.&nbsp;&nbsp;The&nbsp;range&nbsp;runs&nbsp;from&nbsp;Lo&nbsp;to&nbsp;Hi</span><br>
<span class="lineno">40</span><span class="comment" id="1992576">//&nbsp;inclusive&nbsp;and&nbsp;has&nbsp;the&nbsp;specified&nbsp;stride.&nbsp;Lo&nbsp;and&nbsp;Hi&nbsp;must&nbsp;always&nbsp;be&nbsp;&gt;=&nbsp;1&lt;&lt;16.</span><br>
<span class="lineno"></span><span class="keyword" id="1992654">type</span>&nbsp;<span class="ident" id="1992659">Range32</span>&nbsp;<span class="keyword" id="1992667">struct</span>&nbsp;<span class="op" id="1992674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1992677">Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1992684">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1992692">Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1992699">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1992707">Stride</span>&nbsp;<span class="builtintype" id="1992714">uint32</span><br>
<span class="lineno">45</span><span class="op" id="1992721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1992724">//&nbsp;CaseRange&nbsp;represents&nbsp;a&nbsp;range&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;for&nbsp;simple&nbsp;(one</span><br>
<span class="lineno"></span><span class="comment" id="1992795">//&nbsp;code&nbsp;point&nbsp;to&nbsp;one&nbsp;code&nbsp;point)&nbsp;case&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="comment" id="1992845">//&nbsp;The&nbsp;range&nbsp;runs&nbsp;from&nbsp;Lo&nbsp;to&nbsp;Hi&nbsp;inclusive,&nbsp;with&nbsp;a&nbsp;fixed&nbsp;stride&nbsp;of&nbsp;1.&nbsp;&nbsp;Deltas</span><br>
<span class="lineno">50</span><span class="comment" id="1992922">//&nbsp;are&nbsp;the&nbsp;number&nbsp;to&nbsp;add&nbsp;to&nbsp;the&nbsp;code&nbsp;point&nbsp;to&nbsp;reach&nbsp;the&nbsp;code&nbsp;point&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1992995">//&nbsp;different&nbsp;case&nbsp;for&nbsp;that&nbsp;character.&nbsp;&nbsp;They&nbsp;may&nbsp;be&nbsp;negative.&nbsp;&nbsp;If&nbsp;zero,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1993069">//&nbsp;means&nbsp;the&nbsp;character&nbsp;is&nbsp;in&nbsp;the&nbsp;corresponding&nbsp;case.&nbsp;There&nbsp;is&nbsp;a&nbsp;special</span><br>
<span class="lineno"></span><span class="comment" id="1993141">//&nbsp;case&nbsp;representing&nbsp;sequences&nbsp;of&nbsp;alternating&nbsp;corresponding&nbsp;Upper&nbsp;and&nbsp;Lower</span><br>
<span class="lineno"></span><span class="comment" id="1993217">//&nbsp;pairs.&nbsp;&nbsp;It&nbsp;appears&nbsp;with&nbsp;a&nbsp;fixed&nbsp;Delta&nbsp;of</span><br>
<span class="lineno">55</span><span class="comment" id="1993261">//&nbsp;&nbsp;&nbsp;&nbsp{UpperLower,&nbsp;UpperLower,&nbsp;UpperLower}</span><br>
<span class="lineno"></span><span class="comment" id="1993301">//&nbsp;The&nbsp;constant&nbsp;UpperLower&nbsp;has&nbsp;an&nbsp;otherwise&nbsp;impossible&nbsp;delta&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1993369">type</span>&nbsp;<span class="ident" id="1993374">CaseRange</span>&nbsp;<span class="keyword" id="1993384">struct</span>&nbsp;<span class="op" id="1993391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1993394">Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1993400">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1993408">Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1993414">uint32</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1993422">Delta</span>&nbsp;<span class="ident" id="1993428">d</span><br>
<span class="lineno"></span><span class="op" id="1993430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1993433">//&nbsp;SpecialCase&nbsp;represents&nbsp;language-specific&nbsp;case&nbsp;mappings&nbsp;such&nbsp;as&nbsp;Turkish.</span><br>
<span class="lineno"></span><span class="comment" id="1993508">//&nbsp;Methods&nbsp;of&nbsp;SpecialCase&nbsp;customize&nbsp;(by&nbsp;overriding)&nbsp;the&nbsp;standard&nbsp;mappings.</span><br>
<span class="lineno">65</span><span class="keyword" id="1993583">type</span>&nbsp;<span class="ident" id="1993588">SpecialCase</span>&nbsp;<span class="op" id="1993600">[</span><span class="op" id="1993601">]</span><span class="ident" id="1993602">CaseRange</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1993613">//&nbsp;BUG(r):&nbsp;There&nbsp;is&nbsp;no&nbsp;mechanism&nbsp;for&nbsp;full&nbsp;case&nbsp;folding,&nbsp;that&nbsp;is,&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="1993682">//&nbsp;characters&nbsp;that&nbsp;involve&nbsp;multiple&nbsp;runes&nbsp;in&nbsp;the&nbsp;input&nbsp;or&nbsp;output.</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="1993749">//&nbsp;Indices&nbsp;into&nbsp;the&nbsp;Delta&nbsp;arrays&nbsp;inside&nbsp;CaseRanges&nbsp;for&nbsp;case&nbsp;mapping.</span><br>
<span class="lineno"></span><span class="keyword" id="1993818">const</span>&nbsp;<span class="op" id="1993824">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1993827">UpperCase</span>&nbsp;<span class="op" id="1993837">=</span>&nbsp;<span class="ident" id="1993839">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1993845">LowerCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1993856">TitleCase</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1993867">MaxCase</span><br>
<span class="lineno"></span><span class="op" id="1993875">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1993878">type</span>&nbsp;<span class="ident" id="1993883">d</span>&nbsp;<span class="op" id="1993885">[</span><span class="ident" id="1993886">MaxCase</span><span class="op" id="1993893">]</span><span class="builtintype" id="1993894">rune</span>&nbsp;<span class="comment" id="1993899">//&nbsp;to&nbsp;make&nbsp;the&nbsp;CaseRanges&nbsp;text&nbsp;shorter</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="1993939">//&nbsp;If&nbsp;the&nbsp;Delta&nbsp;field&nbsp;of&nbsp;a&nbsp;CaseRange&nbsp;is&nbsp;UpperLower,&nbsp;it&nbsp;means</span><br>
<span class="lineno"></span><span class="comment" id="1994000">//&nbsp;this&nbsp;CaseRange&nbsp;represents&nbsp;a&nbsp;sequence&nbsp;of&nbsp;the&nbsp;form&nbsp;(say)</span><br>
<span class="lineno"></span><span class="comment" id="1994058">//&nbsp;Upper&nbsp;Lower&nbsp;Upper&nbsp;Lower.</span><br>
<span class="lineno"></span><span class="keyword" id="1994086">const</span>&nbsp;<span class="op" id="1994092">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994095">UpperLower</span>&nbsp;<span class="op" id="1994106">=</span>&nbsp;<span class="ident" id="1994108">MaxRune</span>&nbsp;<span class="op" id="1994116">+</span>&nbsp;<span class="num" id="1994118">1</span>&nbsp;<span class="comment" id="1994120">//&nbsp;(Cannot&nbsp;be&nbsp;a&nbsp;valid&nbsp;delta.)</span><br>
<span class="lineno">85</span><span class="op" id="1994150">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1994153">//&nbsp;linearMax&nbsp;is&nbsp;the&nbsp;maximum&nbsp;size&nbsp;table&nbsp;for&nbsp;linear&nbsp;search&nbsp;for&nbsp;non-Latin1&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1994231">//&nbsp;Derived&nbsp;by&nbsp;running&nbsp;&#39;go&nbsp;test&nbsp;-calibrate&#39;.</span><br>
<span class="lineno"></span><span class="keyword" id="1994275">const</span>&nbsp;<span class="ident" id="1994281">linearMax</span>&nbsp;<span class="op" id="1994291">=</span>&nbsp;<span class="num" id="1994293">18</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="1994297">//&nbsp;is16&nbsp;reports&nbsp;whether&nbsp;r&nbsp;is&nbsp;in&nbsp;the&nbsp;sorted&nbsp;slice&nbsp;of&nbsp;16-bit&nbsp;ranges.</span><br>
<span class="lineno"></span><span class="keyword" id="1994364">func</span>&nbsp;<span class="ident" id="1994369">is16</span><span class="op" id="1994373">(</span><span class="ident" id="1994374">ranges</span>&nbsp;<span class="op" id="1994381">[</span><span class="op" id="1994382">]</span><span class="ident" id="1994383">Range16</span><span class="op" id="1994390">,</span>&nbsp;<span class="ident" id="1994392">r</span>&nbsp;<span class="builtintype" id="1994394">uint16</span><span class="op" id="1994400">)</span>&nbsp;<span class="builtintype" id="1994402">bool</span>&nbsp;<span class="op" id="1994407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1994410">if</span>&nbsp;<span class="builtinfunc" id="1994413">len</span><span class="op" id="1994416">(</span><span class="ident" id="1994417">ranges</span><span class="op" id="1994423">)</span>&nbsp;<span class="op" id="1994425">&lt;=</span>&nbsp;<span class="ident" id="1994428">linearMax</span>&nbsp;<span class="op" id="1994438">||</span>&nbsp;<span class="ident" id="1994441">r</span>&nbsp;<span class="op" id="1994443">&lt;=</span>&nbsp;<span class="ident" id="1994446">MaxLatin1</span>&nbsp;<span class="op" id="1994456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1994460">for</span>&nbsp;<span class="ident" id="1994464">i</span>&nbsp;<span class="op" id="1994466">:=</span>&nbsp;<span class="keyword" id="1994469">range</span>&nbsp;<span class="ident" id="1994475">ranges</span>&nbsp;<span class="op" id="1994482">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994487">range_</span>&nbsp;<span class="op" id="1994494">:=</span>&nbsp;<span class="op" id="1994497">&amp;</span><span class="ident" id="1994498">ranges</span><span class="op" id="1994504">[</span><span class="ident" id="1994505">i</span><span class="op" id="1994506">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1994511">if</span>&nbsp;<span class="ident" id="1994514">r</span>&nbsp;<span class="op" id="1994516">&lt;</span>&nbsp;<span class="ident" id="1994518">range_</span><span class="op" id="1994524">.</span><span class="ident" id="1994525">Lo</span>&nbsp;<span class="op" id="1994528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1994534">return</span>&nbsp;<span class="builtintype" id="1994541">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1994550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1994555">if</span>&nbsp;<span class="ident" id="1994558">r</span>&nbsp;<span class="op" id="1994560">&lt;=</span>&nbsp;<span class="ident" id="1994563">range_</span><span class="op" id="1994569">.</span><span class="ident" id="1994570">Hi</span>&nbsp;<span class="op" id="1994573">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1994579">return</span>&nbsp;<span class="op" id="1994586">(</span><span class="ident" id="1994587">r</span><span class="op" id="1994588">-</span><span class="ident" id="1994589">range_</span><span class="op" id="1994595">.</span><span class="ident" id="1994596">Lo</span><span class="op" id="1994598">)</span><span class="op" id="1994599">%</span><span class="ident" id="1994600">range_</span><span class="op" id="1994606">.</span><span class="ident" id="1994607">Stride</span>&nbsp;<span class="op" id="1994614">==</span>&nbsp;<span class="num" id="1994617">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1994622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1994626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1994630">return</span>&nbsp;<span class="builtintype" id="1994637">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1994644">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1994648">//&nbsp;binary&nbsp;search&nbsp;over&nbsp;ranges</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994678">lo</span>&nbsp;<span class="op" id="1994681">:=</span>&nbsp;<span class="num" id="1994684">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994687">hi</span>&nbsp;<span class="op" id="1994690">:=</span>&nbsp;<span class="builtinfunc" id="1994693">len</span><span class="op" id="1994696">(</span><span class="ident" id="1994697">ranges</span><span class="op" id="1994703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1994706">for</span>&nbsp;<span class="ident" id="1994710">lo</span>&nbsp;<span class="op" id="1994713">&lt;</span>&nbsp;<span class="ident" id="1994715">hi</span>&nbsp;<span class="op" id="1994718">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994722">m</span>&nbsp;<span class="op" id="1994724">:=</span>&nbsp;<span class="ident" id="1994727">lo</span>&nbsp;<span class="op" id="1994730">+</span>&nbsp;<span class="op" id="1994732">(</span><span class="ident" id="1994733">hi</span><span class="op" id="1994735">-</span><span class="ident" id="1994736">lo</span><span class="op" id="1994738">)</span><span class="op" id="1994739">/</span><span class="num" id="1994740">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994744">range_</span>&nbsp;<span class="op" id="1994751">:=</span>&nbsp;<span class="op" id="1994754">&amp;</span><span class="ident" id="1994755">ranges</span><span class="op" id="1994761">[</span><span class="ident" id="1994762">m</span><span class="op" id="1994763">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1994767">if</span>&nbsp;<span class="ident" id="1994770">range_</span><span class="op" id="1994776">.</span><span class="ident" id="1994777">Lo</span>&nbsp;<span class="op" id="1994780">&lt;=</span>&nbsp;<span class="ident" id="1994783">r</span>&nbsp;<span class="op" id="1994785">&amp;&amp;</span>&nbsp;<span class="ident" id="1994788">r</span>&nbsp;<span class="op" id="1994790">&lt;=</span>&nbsp;<span class="ident" id="1994793">range_</span><span class="op" id="1994799">.</span><span class="ident" id="1994800">Hi</span>&nbsp;<span class="op" id="1994803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1994808">return</span>&nbsp;<span class="op" id="1994815">(</span><span class="ident" id="1994816">r</span><span class="op" id="1994817">-</span><span class="ident" id="1994818">range_</span><span class="op" id="1994824">.</span><span class="ident" id="1994825">Lo</span><span class="op" id="1994827">)</span><span class="op" id="1994828">%</span><span class="ident" id="1994829">range_</span><span class="op" id="1994835">.</span><span class="ident" id="1994836">Stride</span>&nbsp;<span class="op" id="1994843">==</span>&nbsp;<span class="num" id="1994846">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1994850">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1994854">if</span>&nbsp;<span class="ident" id="1994857">r</span>&nbsp;<span class="op" id="1994859">&lt;</span>&nbsp;<span class="ident" id="1994861">range_</span><span class="op" id="1994867">.</span><span class="ident" id="1994868">Lo</span>&nbsp;<span class="op" id="1994871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994876">hi</span>&nbsp;<span class="op" id="1994879">=</span>&nbsp;<span class="ident" id="1994881">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1994885">}</span>&nbsp;<span class="keyword" id="1994887">else</span>&nbsp;<span class="op" id="1994892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994897">lo</span>&nbsp;<span class="op" id="1994900">=</span>&nbsp;<span class="ident" id="1994902">m</span>&nbsp;<span class="op" id="1994904">+</span>&nbsp;<span class="num" id="1994906">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1994910">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1994913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1994916">return</span>&nbsp;<span class="builtintype" id="1994923">false</span><br>
<span class="lineno"></span><span class="op" id="1994929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1994932">//&nbsp;is32&nbsp;reports&nbsp;whether&nbsp;r&nbsp;is&nbsp;in&nbsp;the&nbsp;sorted&nbsp;slice&nbsp;of&nbsp;32-bit&nbsp;ranges.</span><br>
<span class="lineno">125</span><span class="keyword" id="1994999">func</span>&nbsp;<span class="ident" id="1995004">is32</span><span class="op" id="1995008">(</span><span class="ident" id="1995009">ranges</span>&nbsp;<span class="op" id="1995016">[</span><span class="op" id="1995017">]</span><span class="ident" id="1995018">Range32</span><span class="op" id="1995025">,</span>&nbsp;<span class="ident" id="1995027">r</span>&nbsp;<span class="builtintype" id="1995029">uint32</span><span class="op" id="1995035">)</span>&nbsp;<span class="builtintype" id="1995037">bool</span>&nbsp;<span class="op" id="1995042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1995045">if</span>&nbsp;<span class="builtinfunc" id="1995048">len</span><span class="op" id="1995051">(</span><span class="ident" id="1995052">ranges</span><span class="op" id="1995058">)</span>&nbsp;<span class="op" id="1995060">&lt;=</span>&nbsp;<span class="ident" id="1995063">linearMax</span>&nbsp;<span class="op" id="1995073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1995077">for</span>&nbsp;<span class="ident" id="1995081">i</span>&nbsp;<span class="op" id="1995083">:=</span>&nbsp;<span class="keyword" id="1995086">range</span>&nbsp;<span class="ident" id="1995092">ranges</span>&nbsp;<span class="op" id="1995099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1995104">range_</span>&nbsp;<span class="op" id="1995111">:=</span>&nbsp;<span class="op" id="1995114">&amp;</span><span class="ident" id="1995115">ranges</span><span class="op" id="1995121">[</span><span class="ident" id="1995122">i</span><span class="op" id="1995123">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1995128">if</span>&nbsp;<span class="ident" id="1995131">r</span>&nbsp;<span class="op" id="1995133">&lt;</span>&nbsp;<span class="ident" id="1995135">range_</span><span class="op" id="1995141">.</span><span class="ident" id="1995142">Lo</span>&nbsp;<span class="op" id="1995145">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1995151">return</span>&nbsp;<span class="builtintype" id="1995158">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1995167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1995172">if</span>&nbsp;<span class="ident" id="1995175">r</span>&nbsp;<span class="op" id="1995177">&lt;=</span>&nbsp;<span class="ident" id="1995180">range_</span><span class="op" id="1995186">.</span><span class="ident" id="1995187">Hi</span>&nbsp;<span class="op" id="1995190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1995196">return</span>&nbsp;<span class="op" id="1995203">(</span><span class="ident" id="1995204">r</span><span class="op" id="1995205">-</span><span class="ident" id="1995206">range_</span><span class="op" id="1995212">.</span><span class="ident" id="1995213">Lo</span><span class="op" id="1995215">)</span><span class="op" id="1995216">%</span><span class="ident" id="1995217">range_</span><span class="op" id="1995223">.</span><span class="ident" id="1995224">Stride</span>&nbsp;<span class="op" id="1995231">==</span>&nbsp;<span class="num" id="1995234">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1995239">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1995243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1995247">return</span>&nbsp;<span class="builtintype" id="1995254">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1995261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1995265">//&nbsp;binary&nbsp;search&nbsp;over&nbsp;ranges</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1995295">lo</span>&nbsp;<span class="op" id="1995298">:=</span>&nbsp;<span class="num" id="1995301">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1995304">hi</span>&nbsp;<span class="op" id="1995307">:=</span>&nbsp;<span class="builtinfunc" id="1995310">len</span><span class="op" id="1995313">(</span><span class="ident" id="1995314">ranges</span><span class="op" id="1995320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1995323">for</span>&nbsp;<span class="ident" id="1995327">lo</span>&nbsp;<span class="op" id="1995330">&lt;</span>&nbsp;<span class="ident" id="1995332">hi</span>&nbsp;<span class="op" id="1995335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1995339">m</span>&nbsp;<span class="op" id="1995341">:=</span>&nbsp;<span class="ident" id="1995344">lo</span>&nbsp;<span class="op" id="1995347">+</span>&nbsp;<span class="op" id="1995349">(</span><span class="ident" id="1995350">hi</span><span class="op" id="1995352">-</span><span class="ident" id="1995353">lo</span><span class="op" id="1995355">)</span><span class="op" id="1995356">/</span><span class="num" id="1995357">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1995361">range_</span>&nbsp;<span class="op" id="1995368">:=</span>&nbsp;<span class="ident" id="1995371">ranges</span><span class="op" id="1995377">[</span><span class="ident" id="1995378">m</span><span class="op" id="1995379">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1995383">if</span>&nbsp;<span class="ident" id="1995386">range_</span><span class="op" id="1995392">.</span><span class="ident" id="1995393">Lo</span>&nbsp;<span class="op" id="1995396">&lt;=</span>&nbsp;<span class="ident" id="1995399">r</span>&nbsp;<span class="op" id="1995401">&amp;&amp;</span>&nbsp;<span class="ident" id="1995404">r</span>&nbsp;<span class="op" id="1995406">&lt;=</span>&nbsp;<span class="ident" id="1995409">range_</span><span class="op" id="1995415">.</span><span class="ident" id="1995416">Hi</span>&nbsp;<span class="op" id="1995419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1995424">return</span>&nbsp;<span class="op" id="1995431">(</span><span class="ident" id="1995432">r</span><span class="op" id="1995433">-</span><span class="ident" id="1995434">range_</span><span class="op" id="1995440">.</span><span class="ident" id="1995441">Lo</span><span class="op" id="1995443">)</span><span class="op" id="1995444">%</span><span class="ident" id="1995445">range_</span><span class="op" id="1995451">.</span><span class="ident" id="1995452">Stride</span>&nbsp;<span class="op" id="1995459">==</span>&nbsp;<span class="num" id="1995462">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1995466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1995470">if</span>&nbsp;<span class="ident" id="1995473">r</span>&nbsp;<span class="op" id="1995475">&lt;</span>&nbsp;<span class="ident" id="1995477">range_</span><span class="op" id="1995483">.</span><span class="ident" id="1995484">Lo</span>&nbsp;<span class="op" id="1995487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1995492">hi</span>&nbsp;<span class="op" id="1995495">=</span>&nbsp;<span class="ident" id="1995497">m</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1995501">}</span>&nbsp;<span class="keyword" id="1995503">else</span>&nbsp;<span class="op" id="1995508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1995513">lo</span>&nbsp;<span class="op" id="1995516">=</span>&nbsp;<span class="ident" id="1995518">m</span>&nbsp;<span class="op" id="1995520">+</span>&nbsp;<span class="num" id="1995522">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1995526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1995529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1995532">return</span>&nbsp;<span class="builtintype" id="1995539">false</span><br>
<span class="lineno">155</span><span class="op" id="1995545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1995548">//&nbsp;Is&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;is&nbsp;in&nbsp;the&nbsp;specified&nbsp;table&nbsp;of&nbsp;ranges.</span><br>
<span class="lineno"></span><span class="keyword" id="1995616">func</span>&nbsp;<span class="ident" id="1995621">Is</span><span class="op" id="1995623">(</span><span class="ident" id="1995624">rangeTab</span>&nbsp;<span class="op" id="1995633">*</span><span class="ident" id="1995634">RangeTable</span><span class="op" id="1995644">,</span>&nbsp;<span class="ident" id="1995646">r</span>&nbsp;<span class="builtintype" id="1995648">rune</span><span class="op" id="1995652">)</span>&nbsp;<span class="builtintype" id="1995654">bool</span>&nbsp;<span class="op" id="1995659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1995662">r16</span>&nbsp;<span class="op" id="1995666">:=</span>&nbsp;<span class="ident" id="1995669">rangeTab</span><span class="op" id="1995677">.</span><span class="ident" id="1995678">R16</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1995683">if</span>&nbsp;<span class="builtinfunc" id="1995686">len</span><span class="op" id="1995689">(</span><span class="ident" id="1995690">r16</span><span class="op" id="1995693">)</span>&nbsp;<span class="op" id="1995695">&gt;</span>&nbsp;<span class="num" id="1995697">0</span>&nbsp;<span class="op" id="1995699">&amp;&amp;</span>&nbsp;<span class="ident" id="1995702">r</span>&nbsp;<span class="op" id="1995704">&lt;=</span>&nbsp;<span class="builtintype" id="1995707">rune</span><span class="op" id="1995711">(</span><span class="ident" id="1995712">r16</span><span class="op" id="1995715">[</span><span class="builtinfunc" id="1995716">len</span><span class="op" id="1995719">(</span><span class="ident" id="1995720">r16</span><span class="op" id="1995723">)</span><span class="op" id="1995724">-</span><span class="num" id="1995725">1</span><span class="op" id="1995726">]</span><span class="op" id="1995727">.</span><span class="ident" id="1995728">Hi</span><span class="op" id="1995730">)</span>&nbsp;<span class="op" id="1995732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1995736">return</span>&nbsp;<span class="ident" id="1995743">is16</span><span class="op" id="1995747">(</span><span class="ident" id="1995748">r16</span><span class="op" id="1995751">,</span>&nbsp;<span class="builtintype" id="1995753">uint16</span><span class="op" id="1995759">(</span><span class="ident" id="1995760">r</span><span class="op" id="1995761">)</span><span class="op" id="1995762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1995765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1995768">r32</span>&nbsp;<span class="op" id="1995772">:=</span>&nbsp;<span class="ident" id="1995775">rangeTab</span><span class="op" id="1995783">.</span><span class="ident" id="1995784">R32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1995789">if</span>&nbsp;<span class="builtinfunc" id="1995792">len</span><span class="op" id="1995795">(</span><span class="ident" id="1995796">r32</span><span class="op" id="1995799">)</span>&nbsp;<span class="op" id="1995801">&gt;</span>&nbsp;<span class="num" id="1995803">0</span>&nbsp;<span class="op" id="1995805">&amp;&amp;</span>&nbsp;<span class="ident" id="1995808">r</span>&nbsp;<span class="op" id="1995810">&gt;=</span>&nbsp;<span class="builtintype" id="1995813">rune</span><span class="op" id="1995817">(</span><span class="ident" id="1995818">r32</span><span class="op" id="1995821">[</span><span class="num" id="1995822">0</span><span class="op" id="1995823">]</span><span class="op" id="1995824">.</span><span class="ident" id="1995825">Lo</span><span class="op" id="1995827">)</span>&nbsp;<span class="op" id="1995829">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1995833">return</span>&nbsp;<span class="ident" id="1995840">is32</span><span class="op" id="1995844">(</span><span class="ident" id="1995845">r32</span><span class="op" id="1995848">,</span>&nbsp;<span class="builtintype" id="1995850">uint32</span><span class="op" id="1995856">(</span><span class="ident" id="1995857">r</span><span class="op" id="1995858">)</span><span class="op" id="1995859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1995862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1995865">return</span>&nbsp;<span class="builtintype" id="1995872">false</span><br>
<span class="lineno"></span><span class="op" id="1995878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="1995881">func</span>&nbsp;<span class="ident" id="1995886">isExcludingLatin</span><span class="op" id="1995902">(</span><span class="ident" id="1995903">rangeTab</span>&nbsp;<span class="op" id="1995912">*</span><span class="ident" id="1995913">RangeTable</span><span class="op" id="1995923">,</span>&nbsp;<span class="ident" id="1995925">r</span>&nbsp;<span class="builtintype" id="1995927">rune</span><span class="op" id="1995931">)</span>&nbsp;<span class="builtintype" id="1995933">bool</span>&nbsp;<span class="op" id="1995938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1995941">r16</span>&nbsp;<span class="op" id="1995945">:=</span>&nbsp;<span class="ident" id="1995948">rangeTab</span><span class="op" id="1995956">.</span><span class="ident" id="1995957">R16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1995962">if</span>&nbsp;<span class="ident" id="1995965">off</span>&nbsp;<span class="op" id="1995969">:=</span>&nbsp;<span class="ident" id="1995972">rangeTab</span><span class="op" id="1995980">.</span><span class="ident" id="1995981">LatinOffset</span><span class="op" id="1995992">;</span>&nbsp;<span class="builtinfunc" id="1995994">len</span><span class="op" id="1995997">(</span><span class="ident" id="1995998">r16</span><span class="op" id="1996001">)</span>&nbsp;<span class="op" id="1996003">&gt;</span>&nbsp;<span class="ident" id="1996005">off</span>&nbsp;<span class="op" id="1996009">&amp;&amp;</span>&nbsp;<span class="ident" id="1996012">r</span>&nbsp;<span class="op" id="1996014">&lt;=</span>&nbsp;<span class="builtintype" id="1996017">rune</span><span class="op" id="1996021">(</span><span class="ident" id="1996022">r16</span><span class="op" id="1996025">[</span><span class="builtinfunc" id="1996026">len</span><span class="op" id="1996029">(</span><span class="ident" id="1996030">r16</span><span class="op" id="1996033">)</span><span class="op" id="1996034">-</span><span class="num" id="1996035">1</span><span class="op" id="1996036">]</span><span class="op" id="1996037">.</span><span class="ident" id="1996038">Hi</span><span class="op" id="1996040">)</span>&nbsp;<span class="op" id="1996042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1996046">return</span>&nbsp;<span class="ident" id="1996053">is16</span><span class="op" id="1996057">(</span><span class="ident" id="1996058">r16</span><span class="op" id="1996061">[</span><span class="ident" id="1996062">off</span><span class="op" id="1996065">:</span><span class="op" id="1996066">]</span><span class="op" id="1996067">,</span>&nbsp;<span class="builtintype" id="1996069">uint16</span><span class="op" id="1996075">(</span><span class="ident" id="1996076">r</span><span class="op" id="1996077">)</span><span class="op" id="1996078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1996081">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1996084">r32</span>&nbsp;<span class="op" id="1996088">:=</span>&nbsp;<span class="ident" id="1996091">rangeTab</span><span class="op" id="1996099">.</span><span class="ident" id="1996100">R32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1996105">if</span>&nbsp;<span class="builtinfunc" id="1996108">len</span><span class="op" id="1996111">(</span><span class="ident" id="1996112">r32</span><span class="op" id="1996115">)</span>&nbsp;<span class="op" id="1996117">&gt;</span>&nbsp;<span class="num" id="1996119">0</span>&nbsp;<span class="op" id="1996121">&amp;&amp;</span>&nbsp;<span class="ident" id="1996124">r</span>&nbsp;<span class="op" id="1996126">&gt;=</span>&nbsp;<span class="builtintype" id="1996129">rune</span><span class="op" id="1996133">(</span><span class="ident" id="1996134">r32</span><span class="op" id="1996137">[</span><span class="num" id="1996138">0</span><span class="op" id="1996139">]</span><span class="op" id="1996140">.</span><span class="ident" id="1996141">Lo</span><span class="op" id="1996143">)</span>&nbsp;<span class="op" id="1996145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1996149">return</span>&nbsp;<span class="ident" id="1996156">is32</span><span class="op" id="1996160">(</span><span class="ident" id="1996161">r32</span><span class="op" id="1996164">,</span>&nbsp;<span class="builtintype" id="1996166">uint32</span><span class="op" id="1996172">(</span><span class="ident" id="1996173">r</span><span class="op" id="1996174">)</span><span class="op" id="1996175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1996178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1996181">return</span>&nbsp;<span class="builtintype" id="1996188">false</span><br>
<span class="lineno">180</span><span class="op" id="1996194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1996197">//&nbsp;IsUpper&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;is&nbsp;an&nbsp;upper&nbsp;case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="1996258">func</span>&nbsp;<span class="ident" id="1996263">IsUpper</span><span class="op" id="1996270">(</span><span class="ident" id="1996271">r</span>&nbsp;<span class="builtintype" id="1996273">rune</span><span class="op" id="1996277">)</span>&nbsp;<span class="builtintype" id="1996279">bool</span>&nbsp;<span class="op" id="1996284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1996287">//&nbsp;See&nbsp;comment&nbsp;in&nbsp;IsGraphic.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1996317">if</span>&nbsp;<span class="builtintype" id="1996320">uint32</span><span class="op" id="1996326">(</span><span class="ident" id="1996327">r</span><span class="op" id="1996328">)</span>&nbsp;<span class="op" id="1996330">&lt;=</span>&nbsp;<span class="ident" id="1996333">MaxLatin1</span>&nbsp;<span class="op" id="1996343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1996347">return</span>&nbsp;<span class="ident" id="1996354">properties</span><span class="op" id="1996364">[</span><span class="builtintype" id="1996365">uint8</span><span class="op" id="1996370">(</span><span class="ident" id="1996371">r</span><span class="op" id="1996372">)</span><span class="op" id="1996373">]</span><span class="op" id="1996374">&amp;</span><span class="ident" id="1996375">pLmask</span>&nbsp;<span class="op" id="1996382">==</span>&nbsp;<span class="ident" id="1996385">pLu</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1996390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1996393">return</span>&nbsp;<span class="ident" id="1996400">isExcludingLatin</span><span class="op" id="1996416">(</span><span class="ident" id="1996417">Upper</span><span class="op" id="1996422">,</span>&nbsp;<span class="ident" id="1996424">r</span><span class="op" id="1996425">)</span><br>
<span class="lineno"></span><span class="op" id="1996427">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="1996430">//&nbsp;IsLower&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;is&nbsp;a&nbsp;lower&nbsp;case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="1996490">func</span>&nbsp;<span class="ident" id="1996495">IsLower</span><span class="op" id="1996502">(</span><span class="ident" id="1996503">r</span>&nbsp;<span class="builtintype" id="1996505">rune</span><span class="op" id="1996509">)</span>&nbsp;<span class="builtintype" id="1996511">bool</span>&nbsp;<span class="op" id="1996516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1996519">//&nbsp;See&nbsp;comment&nbsp;in&nbsp;IsGraphic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1996549">if</span>&nbsp;<span class="builtintype" id="1996552">uint32</span><span class="op" id="1996558">(</span><span class="ident" id="1996559">r</span><span class="op" id="1996560">)</span>&nbsp;<span class="op" id="1996562">&lt;=</span>&nbsp;<span class="ident" id="1996565">MaxLatin1</span>&nbsp;<span class="op" id="1996575">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1996579">return</span>&nbsp;<span class="ident" id="1996586">properties</span><span class="op" id="1996596">[</span><span class="builtintype" id="1996597">uint8</span><span class="op" id="1996602">(</span><span class="ident" id="1996603">r</span><span class="op" id="1996604">)</span><span class="op" id="1996605">]</span><span class="op" id="1996606">&amp;</span><span class="ident" id="1996607">pLmask</span>&nbsp;<span class="op" id="1996614">==</span>&nbsp;<span class="ident" id="1996617">pLl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1996622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1996625">return</span>&nbsp;<span class="ident" id="1996632">isExcludingLatin</span><span class="op" id="1996648">(</span><span class="ident" id="1996649">Lower</span><span class="op" id="1996654">,</span>&nbsp;<span class="ident" id="1996656">r</span><span class="op" id="1996657">)</span><br>
<span class="lineno"></span><span class="op" id="1996659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="1996662">//&nbsp;IsTitle&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;is&nbsp;a&nbsp;title&nbsp;case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="1996722">func</span>&nbsp;<span class="ident" id="1996727">IsTitle</span><span class="op" id="1996734">(</span><span class="ident" id="1996735">r</span>&nbsp;<span class="builtintype" id="1996737">rune</span><span class="op" id="1996741">)</span>&nbsp;<span class="builtintype" id="1996743">bool</span>&nbsp;<span class="op" id="1996748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1996751">if</span>&nbsp;<span class="ident" id="1996754">r</span>&nbsp;<span class="op" id="1996756">&lt;=</span>&nbsp;<span class="ident" id="1996759">MaxLatin1</span>&nbsp;<span class="op" id="1996769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1996773">return</span>&nbsp;<span class="builtintype" id="1996780">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1996787">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1996790">return</span>&nbsp;<span class="ident" id="1996797">isExcludingLatin</span><span class="op" id="1996813">(</span><span class="ident" id="1996814">Title</span><span class="op" id="1996819">,</span>&nbsp;<span class="ident" id="1996821">r</span><span class="op" id="1996822">)</span><br>
<span class="lineno"></span><span class="op" id="1996824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1996827">//&nbsp;to&nbsp;maps&nbsp;the&nbsp;rune&nbsp;using&nbsp;the&nbsp;specified&nbsp;case&nbsp;mapping.</span><br>
<span class="lineno"></span><span class="keyword" id="1996881">func</span>&nbsp;<span class="ident" id="1996886">to</span><span class="op" id="1996888">(</span><span class="ident" id="1996889">_case</span>&nbsp;<span class="builtintype" id="1996895">int</span><span class="op" id="1996898">,</span>&nbsp;<span class="ident" id="1996900">r</span>&nbsp;<span class="builtintype" id="1996902">rune</span><span class="op" id="1996906">,</span>&nbsp;<span class="ident" id="1996908">caseRange</span>&nbsp;<span class="op" id="1996918">[</span><span class="op" id="1996919">]</span><span class="ident" id="1996920">CaseRange</span><span class="op" id="1996929">)</span>&nbsp;<span class="builtintype" id="1996931">rune</span>&nbsp;<span class="op" id="1996936">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1996939">if</span>&nbsp;<span class="ident" id="1996942">_case</span>&nbsp;<span class="op" id="1996948">&lt;</span>&nbsp;<span class="num" id="1996950">0</span>&nbsp;<span class="op" id="1996952">||</span>&nbsp;<span class="ident" id="1996955">MaxCase</span>&nbsp;<span class="op" id="1996963">&lt;=</span>&nbsp;<span class="ident" id="1996966">_case</span>&nbsp;<span class="op" id="1996972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1996976">return</span>&nbsp;<span class="ident" id="1996983">ReplacementChar</span>&nbsp;<span class="comment" id="1996999">//&nbsp;as&nbsp;reasonable&nbsp;an&nbsp;error&nbsp;as&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1997033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1997036">//&nbsp;binary&nbsp;search&nbsp;over&nbsp;ranges</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1997066">lo</span>&nbsp;<span class="op" id="1997069">:=</span>&nbsp;<span class="num" id="1997072">0</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1997075">hi</span>&nbsp;<span class="op" id="1997078">:=</span>&nbsp;<span class="builtinfunc" id="1997081">len</span><span class="op" id="1997084">(</span><span class="ident" id="1997085">caseRange</span><span class="op" id="1997094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1997097">for</span>&nbsp;<span class="ident" id="1997101">lo</span>&nbsp;<span class="op" id="1997104">&lt;</span>&nbsp;<span class="ident" id="1997106">hi</span>&nbsp;<span class="op" id="1997109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1997113">m</span>&nbsp;<span class="op" id="1997115">:=</span>&nbsp;<span class="ident" id="1997118">lo</span>&nbsp;<span class="op" id="1997121">+</span>&nbsp;<span class="op" id="1997123">(</span><span class="ident" id="1997124">hi</span><span class="op" id="1997126">-</span><span class="ident" id="1997127">lo</span><span class="op" id="1997129">)</span><span class="op" id="1997130">/</span><span class="num" id="1997131">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1997135">cr</span>&nbsp;<span class="op" id="1997138">:=</span>&nbsp;<span class="ident" id="1997141">caseRange</span><span class="op" id="1997150">[</span><span class="ident" id="1997151">m</span><span class="op" id="1997152">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1997156">if</span>&nbsp;<span class="builtintype" id="1997159">rune</span><span class="op" id="1997163">(</span><span class="ident" id="1997164">cr</span><span class="op" id="1997166">.</span><span class="ident" id="1997167">Lo</span><span class="op" id="1997169">)</span>&nbsp;<span class="op" id="1997171">&lt;=</span>&nbsp;<span class="ident" id="1997174">r</span>&nbsp;<span class="op" id="1997176">&amp;&amp;</span>&nbsp;<span class="ident" id="1997179">r</span>&nbsp;<span class="op" id="1997181">&lt;=</span>&nbsp;<span class="builtintype" id="1997184">rune</span><span class="op" id="1997188">(</span><span class="ident" id="1997189">cr</span><span class="op" id="1997191">.</span><span class="ident" id="1997192">Hi</span><span class="op" id="1997194">)</span>&nbsp;<span class="op" id="1997196">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1997201">delta</span>&nbsp;<span class="op" id="1997207">:=</span>&nbsp;<span class="builtintype" id="1997210">rune</span><span class="op" id="1997214">(</span><span class="ident" id="1997215">cr</span><span class="op" id="1997217">.</span><span class="ident" id="1997218">Delta</span><span class="op" id="1997223">[</span><span class="ident" id="1997224">_case</span><span class="op" id="1997229">]</span><span class="op" id="1997230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1997235">if</span>&nbsp;<span class="ident" id="1997238">delta</span>&nbsp;<span class="op" id="1997244">&gt;</span>&nbsp;<span class="ident" id="1997246">MaxRune</span>&nbsp;<span class="op" id="1997254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1997260">//&nbsp;In&nbsp;an&nbsp;Upper-Lower&nbsp;sequence,&nbsp;which&nbsp;always&nbsp;starts&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1997320">//&nbsp;an&nbsp;UpperCase&nbsp;letter,&nbsp;the&nbsp;real&nbsp;deltas&nbsp;always&nbsp;look&nbsp;like:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1997382">//&nbsp;&nbsp;&nbsp;&nbsp{0,&nbsp;1,&nbsp;0}&nbsp;&nbsp;&nbsp;&nbsp;UpperCase&nbsp;(Lower&nbsp;is&nbsp;next)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1997428">//&nbsp;&nbsp;&nbsp;&nbsp{-1,&nbsp;0,&nbsp;-1}&nbsp;&nbsp;LowerCase&nbsp;(Upper,&nbsp;Title&nbsp;are&nbsp;previous)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1997486">//&nbsp;The&nbsp;characters&nbsp;at&nbsp;even&nbsp;offsets&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1997550">//&nbsp;sequence&nbsp;are&nbsp;upper&nbsp;case;&nbsp;the&nbsp;ones&nbsp;at&nbsp;odd&nbsp;offsets&nbsp;are&nbsp;lower.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1997617">//&nbsp;The&nbsp;correct&nbsp;mapping&nbsp;can&nbsp;be&nbsp;done&nbsp;by&nbsp;clearing&nbsp;or&nbsp;setting&nbsp;the&nbsp;low</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1997687">//&nbsp;bit&nbsp;in&nbsp;the&nbsp;sequence&nbsp;offset.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1997722">//&nbsp;The&nbsp;constants&nbsp;UpperCase&nbsp;and&nbsp;TitleCase&nbsp;are&nbsp;even&nbsp;while&nbsp;LowerCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1997792">//&nbsp;is&nbsp;odd&nbsp;so&nbsp;we&nbsp;take&nbsp;the&nbsp;low&nbsp;bit&nbsp;from&nbsp;_case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1997841">return</span>&nbsp;<span class="builtintype" id="1997848">rune</span><span class="op" id="1997852">(</span><span class="ident" id="1997853">cr</span><span class="op" id="1997855">.</span><span class="ident" id="1997856">Lo</span><span class="op" id="1997858">)</span>&nbsp;<span class="op" id="1997860">+</span>&nbsp;<span class="op" id="1997862">(</span><span class="op" id="1997863">(</span><span class="ident" id="1997864">r</span><span class="op" id="1997865">-</span><span class="builtintype" id="1997866">rune</span><span class="op" id="1997870">(</span><span class="ident" id="1997871">cr</span><span class="op" id="1997873">.</span><span class="ident" id="1997874">Lo</span><span class="op" id="1997876">)</span><span class="op" id="1997877">)</span><span class="op" id="1997878">&amp;^</span><span class="num" id="1997880">1</span>&nbsp;<span class="op" id="1997882">|</span>&nbsp;<span class="builtintype" id="1997884">rune</span><span class="op" id="1997888">(</span><span class="ident" id="1997889">_case</span><span class="op" id="1997894">&amp;</span><span class="num" id="1997895">1</span><span class="op" id="1997896">)</span><span class="op" id="1997897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1997902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1997907">return</span>&nbsp;<span class="ident" id="1997914">r</span>&nbsp;<span class="op" id="1997916">+</span>&nbsp;<span class="ident" id="1997918">delta</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1997926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1997930">if</span>&nbsp;<span class="ident" id="1997933">r</span>&nbsp;<span class="op" id="1997935">&lt;</span>&nbsp;<span class="builtintype" id="1997937">rune</span><span class="op" id="1997941">(</span><span class="ident" id="1997942">cr</span><span class="op" id="1997944">.</span><span class="ident" id="1997945">Lo</span><span class="op" id="1997947">)</span>&nbsp;<span class="op" id="1997949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1997954">hi</span>&nbsp;<span class="op" id="1997957">=</span>&nbsp;<span class="ident" id="1997959">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1997963">}</span>&nbsp;<span class="keyword" id="1997965">else</span>&nbsp;<span class="op" id="1997970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1997975">lo</span>&nbsp;<span class="op" id="1997978">=</span>&nbsp;<span class="ident" id="1997980">m</span>&nbsp;<span class="op" id="1997982">+</span>&nbsp;<span class="num" id="1997984">1</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1997988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1997991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1997994">return</span>&nbsp;<span class="ident" id="1998001">r</span><br>
<span class="lineno"></span><span class="op" id="1998003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="1998006">//&nbsp;To&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;the&nbsp;specified&nbsp;case:&nbsp;UpperCase,&nbsp;LowerCase,&nbsp;or&nbsp;TitleCase.</span><br>
<span class="lineno"></span><span class="keyword" id="1998085">func</span>&nbsp;<span class="ident" id="1998090">To</span><span class="op" id="1998092">(</span><span class="ident" id="1998093">_case</span>&nbsp;<span class="builtintype" id="1998099">int</span><span class="op" id="1998102">,</span>&nbsp;<span class="ident" id="1998104">r</span>&nbsp;<span class="builtintype" id="1998106">rune</span><span class="op" id="1998110">)</span>&nbsp;<span class="builtintype" id="1998112">rune</span>&nbsp;<span class="op" id="1998117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998120">return</span>&nbsp;<span class="ident" id="1998127">to</span><span class="op" id="1998129">(</span><span class="ident" id="1998130">_case</span><span class="op" id="1998135">,</span>&nbsp;<span class="ident" id="1998137">r</span><span class="op" id="1998138">,</span>&nbsp;<span class="ident" id="1998140">CaseRanges</span><span class="op" id="1998150">)</span><br>
<span class="lineno"></span><span class="op" id="1998152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="1998155">//&nbsp;ToUpper&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;upper&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="1998195">func</span>&nbsp;<span class="ident" id="1998200">ToUpper</span><span class="op" id="1998207">(</span><span class="ident" id="1998208">r</span>&nbsp;<span class="builtintype" id="1998210">rune</span><span class="op" id="1998214">)</span>&nbsp;<span class="builtintype" id="1998216">rune</span>&nbsp;<span class="op" id="1998221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998224">if</span>&nbsp;<span class="ident" id="1998227">r</span>&nbsp;<span class="op" id="1998229">&lt;=</span>&nbsp;<span class="ident" id="1998232">MaxASCII</span>&nbsp;<span class="op" id="1998241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998245">if</span>&nbsp;<span class="string" id="1998248">&#39;a&#39;</span>&nbsp;<span class="op" id="1998252">&lt;=</span>&nbsp;<span class="ident" id="1998255">r</span>&nbsp;<span class="op" id="1998257">&amp;&amp;</span>&nbsp;<span class="ident" id="1998260">r</span>&nbsp;<span class="op" id="1998262">&lt;=</span>&nbsp;<span class="string" id="1998265">&#39;z&#39;</span>&nbsp;<span class="op" id="1998269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1998274">r</span>&nbsp;<span class="op" id="1998276">-=</span>&nbsp;<span class="string" id="1998279">&#39;a&#39;</span>&nbsp;<span class="op" id="1998283">-</span>&nbsp;<span class="string" id="1998285">&#39;A&#39;</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1998291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998295">return</span>&nbsp;<span class="ident" id="1998302">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1998305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998308">return</span>&nbsp;<span class="ident" id="1998315">To</span><span class="op" id="1998317">(</span><span class="ident" id="1998318">UpperCase</span><span class="op" id="1998327">,</span>&nbsp;<span class="ident" id="1998329">r</span><span class="op" id="1998330">)</span><br>
<span class="lineno"></span><span class="op" id="1998332">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="1998335">//&nbsp;ToLower&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="1998375">func</span>&nbsp;<span class="ident" id="1998380">ToLower</span><span class="op" id="1998387">(</span><span class="ident" id="1998388">r</span>&nbsp;<span class="builtintype" id="1998390">rune</span><span class="op" id="1998394">)</span>&nbsp;<span class="builtintype" id="1998396">rune</span>&nbsp;<span class="op" id="1998401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998404">if</span>&nbsp;<span class="ident" id="1998407">r</span>&nbsp;<span class="op" id="1998409">&lt;=</span>&nbsp;<span class="ident" id="1998412">MaxASCII</span>&nbsp;<span class="op" id="1998421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998425">if</span>&nbsp;<span class="string" id="1998428">&#39;A&#39;</span>&nbsp;<span class="op" id="1998432">&lt;=</span>&nbsp;<span class="ident" id="1998435">r</span>&nbsp;<span class="op" id="1998437">&amp;&amp;</span>&nbsp;<span class="ident" id="1998440">r</span>&nbsp;<span class="op" id="1998442">&lt;=</span>&nbsp;<span class="string" id="1998445">&#39;Z&#39;</span>&nbsp;<span class="op" id="1998449">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1998454">r</span>&nbsp;<span class="op" id="1998456">+=</span>&nbsp;<span class="string" id="1998459">&#39;a&#39;</span>&nbsp;<span class="op" id="1998463">-</span>&nbsp;<span class="string" id="1998465">&#39;A&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1998471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998475">return</span>&nbsp;<span class="ident" id="1998482">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1998485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998488">return</span>&nbsp;<span class="ident" id="1998495">To</span><span class="op" id="1998497">(</span><span class="ident" id="1998498">LowerCase</span><span class="op" id="1998507">,</span>&nbsp;<span class="ident" id="1998509">r</span><span class="op" id="1998510">)</span><br>
<span class="lineno">270</span><span class="op" id="1998512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1998515">//&nbsp;ToTitle&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="1998555">func</span>&nbsp;<span class="ident" id="1998560">ToTitle</span><span class="op" id="1998567">(</span><span class="ident" id="1998568">r</span>&nbsp;<span class="builtintype" id="1998570">rune</span><span class="op" id="1998574">)</span>&nbsp;<span class="builtintype" id="1998576">rune</span>&nbsp;<span class="op" id="1998581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998584">if</span>&nbsp;<span class="ident" id="1998587">r</span>&nbsp;<span class="op" id="1998589">&lt;=</span>&nbsp;<span class="ident" id="1998592">MaxASCII</span>&nbsp;<span class="op" id="1998601">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998605">if</span>&nbsp;<span class="string" id="1998608">&#39;a&#39;</span>&nbsp;<span class="op" id="1998612">&lt;=</span>&nbsp;<span class="ident" id="1998615">r</span>&nbsp;<span class="op" id="1998617">&amp;&amp;</span>&nbsp;<span class="ident" id="1998620">r</span>&nbsp;<span class="op" id="1998622">&lt;=</span>&nbsp;<span class="string" id="1998625">&#39;z&#39;</span>&nbsp;<span class="op" id="1998629">{</span>&nbsp;<span class="comment" id="1998631">//&nbsp;title&nbsp;case&nbsp;is&nbsp;upper&nbsp;case&nbsp;for&nbsp;ASCII</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1998672">r</span>&nbsp;<span class="op" id="1998674">-=</span>&nbsp;<span class="string" id="1998677">&#39;a&#39;</span>&nbsp;<span class="op" id="1998681">-</span>&nbsp;<span class="string" id="1998683">&#39;A&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1998689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998693">return</span>&nbsp;<span class="ident" id="1998700">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1998703">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998706">return</span>&nbsp;<span class="ident" id="1998713">To</span><span class="op" id="1998715">(</span><span class="ident" id="1998716">TitleCase</span><span class="op" id="1998725">,</span>&nbsp;<span class="ident" id="1998727">r</span><span class="op" id="1998728">)</span><br>
<span class="lineno"></span><span class="op" id="1998730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1998733">//&nbsp;ToUpper&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;upper&nbsp;case&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;mapping.</span><br>
<span class="lineno"></span><span class="keyword" id="1998812">func</span>&nbsp;<span class="op" id="1998817">(</span><span class="ident" id="1998818">special</span>&nbsp;<span class="ident" id="1998826">SpecialCase</span><span class="op" id="1998837">)</span>&nbsp;<span class="ident" id="1998839">ToUpper</span><span class="op" id="1998846">(</span><span class="ident" id="1998847">r</span>&nbsp;<span class="builtintype" id="1998849">rune</span><span class="op" id="1998853">)</span>&nbsp;<span class="builtintype" id="1998855">rune</span>&nbsp;<span class="op" id="1998860">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1998863">r1</span>&nbsp;<span class="op" id="1998866">:=</span>&nbsp;<span class="ident" id="1998869">to</span><span class="op" id="1998871">(</span><span class="ident" id="1998872">UpperCase</span><span class="op" id="1998881">,</span>&nbsp;<span class="ident" id="1998883">r</span><span class="op" id="1998884">,</span>&nbsp;<span class="op" id="1998886">[</span><span class="op" id="1998887">]</span><span class="ident" id="1998888">CaseRange</span><span class="op" id="1998897">(</span><span class="ident" id="1998898">special</span><span class="op" id="1998905">)</span><span class="op" id="1998906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998909">if</span>&nbsp;<span class="ident" id="1998912">r1</span>&nbsp;<span class="op" id="1998915">==</span>&nbsp;<span class="ident" id="1998918">r</span>&nbsp;<span class="op" id="1998920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1998924">r1</span>&nbsp;<span class="op" id="1998927">=</span>&nbsp;<span class="ident" id="1998929">ToUpper</span><span class="op" id="1998936">(</span><span class="ident" id="1998937">r</span><span class="op" id="1998938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1998941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998944">return</span>&nbsp;<span class="ident" id="1998951">r1</span><br>
<span class="lineno">290</span><span class="op" id="1998954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1998957">//&nbsp;ToTitle&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;title&nbsp;case&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;mapping.</span><br>
<span class="lineno"></span><span class="keyword" id="1999036">func</span>&nbsp;<span class="op" id="1999041">(</span><span class="ident" id="1999042">special</span>&nbsp;<span class="ident" id="1999050">SpecialCase</span><span class="op" id="1999061">)</span>&nbsp;<span class="ident" id="1999063">ToTitle</span><span class="op" id="1999070">(</span><span class="ident" id="1999071">r</span>&nbsp;<span class="builtintype" id="1999073">rune</span><span class="op" id="1999077">)</span>&nbsp;<span class="builtintype" id="1999079">rune</span>&nbsp;<span class="op" id="1999084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1999087">r1</span>&nbsp;<span class="op" id="1999090">:=</span>&nbsp;<span class="ident" id="1999093">to</span><span class="op" id="1999095">(</span><span class="ident" id="1999096">TitleCase</span><span class="op" id="1999105">,</span>&nbsp;<span class="ident" id="1999107">r</span><span class="op" id="1999108">,</span>&nbsp;<span class="op" id="1999110">[</span><span class="op" id="1999111">]</span><span class="ident" id="1999112">CaseRange</span><span class="op" id="1999121">(</span><span class="ident" id="1999122">special</span><span class="op" id="1999129">)</span><span class="op" id="1999130">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1999133">if</span>&nbsp;<span class="ident" id="1999136">r1</span>&nbsp;<span class="op" id="1999139">==</span>&nbsp;<span class="ident" id="1999142">r</span>&nbsp;<span class="op" id="1999144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1999148">r1</span>&nbsp;<span class="op" id="1999151">=</span>&nbsp;<span class="ident" id="1999153">ToTitle</span><span class="op" id="1999160">(</span><span class="ident" id="1999161">r</span><span class="op" id="1999162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1999165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1999168">return</span>&nbsp;<span class="ident" id="1999175">r1</span><br>
<span class="lineno"></span><span class="op" id="1999178">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="1999181">//&nbsp;ToLower&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;lower&nbsp;case&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;mapping.</span><br>
<span class="lineno"></span><span class="keyword" id="1999260">func</span>&nbsp;<span class="op" id="1999265">(</span><span class="ident" id="1999266">special</span>&nbsp;<span class="ident" id="1999274">SpecialCase</span><span class="op" id="1999285">)</span>&nbsp;<span class="ident" id="1999287">ToLower</span><span class="op" id="1999294">(</span><span class="ident" id="1999295">r</span>&nbsp;<span class="builtintype" id="1999297">rune</span><span class="op" id="1999301">)</span>&nbsp;<span class="builtintype" id="1999303">rune</span>&nbsp;<span class="op" id="1999308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1999311">r1</span>&nbsp;<span class="op" id="1999314">:=</span>&nbsp;<span class="ident" id="1999317">to</span><span class="op" id="1999319">(</span><span class="ident" id="1999320">LowerCase</span><span class="op" id="1999329">,</span>&nbsp;<span class="ident" id="1999331">r</span><span class="op" id="1999332">,</span>&nbsp;<span class="op" id="1999334">[</span><span class="op" id="1999335">]</span><span class="ident" id="1999336">CaseRange</span><span class="op" id="1999345">(</span><span class="ident" id="1999346">special</span><span class="op" id="1999353">)</span><span class="op" id="1999354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1999357">if</span>&nbsp;<span class="ident" id="1999360">r1</span>&nbsp;<span class="op" id="1999363">==</span>&nbsp;<span class="ident" id="1999366">r</span>&nbsp;<span class="op" id="1999368">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1999372">r1</span>&nbsp;<span class="op" id="1999375">=</span>&nbsp;<span class="ident" id="1999377">ToLower</span><span class="op" id="1999384">(</span><span class="ident" id="1999385">r</span><span class="op" id="1999386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1999389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1999392">return</span>&nbsp;<span class="ident" id="1999399">r1</span><br>
<span class="lineno"></span><span class="op" id="1999402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="1999405">//&nbsp;caseOrbit&nbsp;is&nbsp;defined&nbsp;in&nbsp;tables.go&nbsp;as&nbsp;[]foldPair.&nbsp;&nbsp;Right&nbsp;now&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1999476">//&nbsp;entries&nbsp;fit&nbsp;in&nbsp;uint16,&nbsp;so&nbsp;use&nbsp;uint16.&nbsp;&nbsp;If&nbsp;that&nbsp;changes,&nbsp;compilation</span><br>
<span class="lineno"></span><span class="comment" id="1999547">//&nbsp;will&nbsp;fail&nbsp;(the&nbsp;constants&nbsp;in&nbsp;the&nbsp;composite&nbsp;literal&nbsp;will&nbsp;not&nbsp;fit&nbsp;in&nbsp;uint16)</span><br>
<span class="lineno"></span><span class="comment" id="1999624">//&nbsp;and&nbsp;the&nbsp;types&nbsp;here&nbsp;can&nbsp;change&nbsp;to&nbsp;uint32.</span><br>
<span class="lineno"></span><span class="keyword" id="1999668">type</span>&nbsp;<span class="ident" id="1999673">foldPair</span>&nbsp;<span class="keyword" id="1999682">struct</span>&nbsp;<span class="op" id="1999689">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1999692">From</span>&nbsp;<span class="builtintype" id="1999697">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1999705">To</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1999710">uint16</span><br>
<span class="lineno"></span><span class="op" id="1999717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1999720">//&nbsp;SimpleFold&nbsp;iterates&nbsp;over&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;equivalent&nbsp;under</span><br>
<span class="lineno">320</span><span class="comment" id="1999785">//&nbsp;the&nbsp;Unicode-defined&nbsp;simple&nbsp;case&nbsp;folding.&nbsp;&nbsp;Among&nbsp;the&nbsp;code&nbsp;points</span><br>
<span class="lineno"></span><span class="comment" id="1999852">//&nbsp;equivalent&nbsp;to&nbsp;rune&nbsp;(including&nbsp;rune&nbsp;itself),&nbsp;SimpleFold&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1999922">//&nbsp;smallest&nbsp;rune&nbsp;&gt;&nbsp;r&nbsp;if&nbsp;one&nbsp;exists,&nbsp;or&nbsp;else&nbsp;the&nbsp;smallest&nbsp;rune&nbsp;&gt;=&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="1999990">//</span><br>
<span class="lineno"></span><span class="comment" id="1999993">//&nbsp;For&nbsp;example:</span><br>
<span class="lineno">325</span><span class="comment" id="2000009">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;A&#39;)&nbsp;=&nbsp;&#39;a&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2000034">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;a&#39;)&nbsp;=&nbsp;&#39;A&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2000059">//</span><br>
<span class="lineno"></span><span class="comment" id="2000062">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;K&#39;)&nbsp;=&nbsp;&#39;k&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2000087">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;k&#39;)&nbsp;=&nbsp;&#39;\u212A&#39;&nbsp;(Kelvin&nbsp;symbol,&nbsp;)</span><br>
<span class="lineno">330</span><span class="comment" id="2000138">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;\u212A&#39;)&nbsp;=&nbsp;&#39;K&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2000168">//</span><br>
<span class="lineno"></span><span class="comment" id="2000171">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;1&#39;)&nbsp;=&nbsp;&#39;1&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2000196">//</span><br>
<span class="lineno"></span><span class="keyword" id="2000199">func</span>&nbsp;<span class="ident" id="2000204">SimpleFold</span><span class="op" id="2000214">(</span><span class="ident" id="2000215">r</span>&nbsp;<span class="builtintype" id="2000217">rune</span><span class="op" id="2000221">)</span>&nbsp;<span class="builtintype" id="2000223">rune</span>&nbsp;<span class="op" id="2000228">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2000231">//&nbsp;Consult&nbsp;caseOrbit&nbsp;table&nbsp;for&nbsp;special&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2000278">lo</span>&nbsp;<span class="op" id="2000281">:=</span>&nbsp;<span class="num" id="2000284">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2000287">hi</span>&nbsp;<span class="op" id="2000290">:=</span>&nbsp;<span class="builtinfunc" id="2000293">len</span><span class="op" id="2000296">(</span><span class="ident" id="2000297">caseOrbit</span><span class="op" id="2000306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2000309">for</span>&nbsp;<span class="ident" id="2000313">lo</span>&nbsp;<span class="op" id="2000316">&lt;</span>&nbsp;<span class="ident" id="2000318">hi</span>&nbsp;<span class="op" id="2000321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2000325">m</span>&nbsp;<span class="op" id="2000327">:=</span>&nbsp;<span class="ident" id="2000330">lo</span>&nbsp;<span class="op" id="2000333">+</span>&nbsp;<span class="op" id="2000335">(</span><span class="ident" id="2000336">hi</span><span class="op" id="2000338">-</span><span class="ident" id="2000339">lo</span><span class="op" id="2000341">)</span><span class="op" id="2000342">/</span><span class="num" id="2000343">2</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2000347">if</span>&nbsp;<span class="builtintype" id="2000350">rune</span><span class="op" id="2000354">(</span><span class="ident" id="2000355">caseOrbit</span><span class="op" id="2000364">[</span><span class="ident" id="2000365">m</span><span class="op" id="2000366">]</span><span class="op" id="2000367">.</span><span class="ident" id="2000368">From</span><span class="op" id="2000372">)</span>&nbsp;<span class="op" id="2000374">&lt;</span>&nbsp;<span class="ident" id="2000376">r</span>&nbsp;<span class="op" id="2000378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2000383">lo</span>&nbsp;<span class="op" id="2000386">=</span>&nbsp;<span class="ident" id="2000388">m</span>&nbsp;<span class="op" id="2000390">+</span>&nbsp;<span class="num" id="2000392">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2000396">}</span>&nbsp;<span class="keyword" id="2000398">else</span>&nbsp;<span class="op" id="2000403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2000408">hi</span>&nbsp;<span class="op" id="2000411">=</span>&nbsp;<span class="ident" id="2000413">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2000417">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2000420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2000423">if</span>&nbsp;<span class="ident" id="2000426">lo</span>&nbsp;<span class="op" id="2000429">&lt;</span>&nbsp;<span class="builtinfunc" id="2000431">len</span><span class="op" id="2000434">(</span><span class="ident" id="2000435">caseOrbit</span><span class="op" id="2000444">)</span>&nbsp;<span class="op" id="2000446">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2000449">rune</span><span class="op" id="2000453">(</span><span class="ident" id="2000454">caseOrbit</span><span class="op" id="2000463">[</span><span class="ident" id="2000464">lo</span><span class="op" id="2000466">]</span><span class="op" id="2000467">.</span><span class="ident" id="2000468">From</span><span class="op" id="2000472">)</span>&nbsp;<span class="op" id="2000474">==</span>&nbsp;<span class="ident" id="2000477">r</span>&nbsp;<span class="op" id="2000479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2000483">return</span>&nbsp;<span class="builtintype" id="2000490">rune</span><span class="op" id="2000494">(</span><span class="ident" id="2000495">caseOrbit</span><span class="op" id="2000504">[</span><span class="ident" id="2000505">lo</span><span class="op" id="2000507">]</span><span class="op" id="2000508">.</span><span class="ident" id="2000509">To</span><span class="op" id="2000511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2000514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2000518">//&nbsp;No&nbsp;folding&nbsp;specified.&nbsp;&nbsp;This&nbsp;is&nbsp;a&nbsp;one-&nbsp;or&nbsp;two-element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2000575">//&nbsp;equivalence&nbsp;class&nbsp;containing&nbsp;rune&nbsp;and&nbsp;ToLower(rune)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2000631">//&nbsp;and&nbsp;ToUpper(rune)&nbsp;if&nbsp;they&nbsp;are&nbsp;different&nbsp;from&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2000686">if</span>&nbsp;<span class="ident" id="2000689">l</span>&nbsp;<span class="op" id="2000691">:=</span>&nbsp;<span class="ident" id="2000694">ToLower</span><span class="op" id="2000701">(</span><span class="ident" id="2000702">r</span><span class="op" id="2000703">)</span><span class="op" id="2000704">;</span>&nbsp;<span class="ident" id="2000706">l</span>&nbsp;<span class="op" id="2000708">!=</span>&nbsp;<span class="ident" id="2000711">r</span>&nbsp;<span class="op" id="2000713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2000717">return</span>&nbsp;<span class="ident" id="2000724">l</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2000727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2000730">return</span>&nbsp;<span class="ident" id="2000737">ToUpper</span><span class="op" id="2000744">(</span><span class="ident" id="2000745">r</span><span class="op" id="2000746">)</span><br>
<span class="lineno"></span><span class="op" id="2000748">}</span>
</div>
</body>
</html>
