<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>text/tabwriter</h2>
<ul>
<li><a href="/gostd/text/tabwriter/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/text/tabwriter/tabwriter.go.html" class="current">tabwriter.go</a></li>
<li><a href="/gostd/text/tabwriter/tabwriter_test.go.html">tabwriter_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4999892">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4999947">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5000001">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5000052">//&nbsp;Package&nbsp;tabwriter&nbsp;implements&nbsp;a&nbsp;write&nbsp;filter&nbsp;(tabwriter.Writer)&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5000123">//&nbsp;translates&nbsp;tabbed&nbsp;columns&nbsp;in&nbsp;input&nbsp;into&nbsp;properly&nbsp;aligned&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="5000189">//</span><br>
<span class="lineno"></span><span class="comment" id="5000192">//&nbsp;The&nbsp;package&nbsp;is&nbsp;using&nbsp;the&nbsp;Elastic&nbsp;Tabstops&nbsp;algorithm&nbsp;described&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="5000260">//&nbsp;http://nickgravgaard.com/elastictabstops/index.html.</span><br>
<span class="lineno">10</span><span class="comment" id="5000316">//</span><br>
<span class="lineno"></span><span class="keyword" id="5000319">package</span>&nbsp;<span class="ident" id="5000327">tabwriter</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5000338">import</span>&nbsp;<span class="op" id="5000345">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5000348">&#34;bytes&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5000357">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5000363">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5000378">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5000381">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">20</span><span class="comment" id="5000461">//&nbsp;Filter&nbsp;implementation</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5000487">//&nbsp;A&nbsp;cell&nbsp;represents&nbsp;a&nbsp;segment&nbsp;of&nbsp;text&nbsp;terminated&nbsp;by&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks.</span><br>
<span class="lineno"></span><span class="comment" id="5000561">//&nbsp;The&nbsp;text&nbsp;itself&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;separate&nbsp;buffer;&nbsp;cell&nbsp;only&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5000636">//&nbsp;segment&#39;s&nbsp;size&nbsp;in&nbsp;bytes,&nbsp;its&nbsp;width&nbsp;in&nbsp;runes,&nbsp;and&nbsp;whether&nbsp;it&#39;s&nbsp;an&nbsp;htab</span><br>
<span class="lineno">25</span><span class="comment" id="5000709">//&nbsp;(&#39;\t&#39;)&nbsp;terminated&nbsp;cell.</span><br>
<span class="lineno"></span><span class="comment" id="5000736">//</span><br>
<span class="lineno"></span><span class="keyword" id="5000739">type</span>&nbsp;<span class="ident" id="5000744">cell</span>&nbsp;<span class="keyword" id="5000749">struct</span>&nbsp;<span class="op" id="5000756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5000759">size</span>&nbsp;&nbsp;<span class="builtintype" id="5000765">int</span>&nbsp;&nbsp;<span class="comment" id="5000770">//&nbsp;cell&nbsp;size&nbsp;in&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5000793">width</span>&nbsp;<span class="builtintype" id="5000799">int</span>&nbsp;&nbsp;<span class="comment" id="5000804">//&nbsp;cell&nbsp;width&nbsp;in&nbsp;runes</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5000828">htab</span>&nbsp;&nbsp;<span class="builtintype" id="5000834">bool</span>&nbsp;<span class="comment" id="5000839">//&nbsp;true&nbsp;if&nbsp;the&nbsp;cell&nbsp;is&nbsp;terminated&nbsp;by&nbsp;an&nbsp;htab&nbsp;(&#39;\t&#39;)</span><br>
<span class="lineno"></span><span class="op" id="5000891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5000894">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;filter&nbsp;that&nbsp;inserts&nbsp;padding&nbsp;around&nbsp;tab-delimited</span><br>
<span class="lineno"></span><span class="comment" id="5000960">//&nbsp;columns&nbsp;in&nbsp;its&nbsp;input&nbsp;to&nbsp;align&nbsp;them&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno">35</span><span class="comment" id="5001013">//</span><br>
<span class="lineno"></span><span class="comment" id="5001016">//&nbsp;The&nbsp;Writer&nbsp;treats&nbsp;incoming&nbsp;bytes&nbsp;as&nbsp;UTF-8&nbsp;encoded&nbsp;text&nbsp;consisting</span><br>
<span class="lineno"></span><span class="comment" id="5001085">//&nbsp;of&nbsp;cells&nbsp;terminated&nbsp;by&nbsp;(horizontal&nbsp;or&nbsp;vertical)&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5001149">//&nbsp;breaks&nbsp;(newline&nbsp;or&nbsp;formfeed&nbsp;characters).&nbsp;Cells&nbsp;in&nbsp;adjacent&nbsp;lines</span><br>
<span class="lineno"></span><span class="comment" id="5001217">//&nbsp;constitute&nbsp;a&nbsp;column.&nbsp;The&nbsp;Writer&nbsp;inserts&nbsp;padding&nbsp;as&nbsp;needed&nbsp;to</span><br>
<span class="lineno">40</span><span class="comment" id="5001281">//&nbsp;make&nbsp;all&nbsp;cells&nbsp;in&nbsp;a&nbsp;column&nbsp;have&nbsp;the&nbsp;same&nbsp;width,&nbsp;effectively</span><br>
<span class="lineno"></span><span class="comment" id="5001344">//&nbsp;aligning&nbsp;the&nbsp;columns.&nbsp;It&nbsp;assumes&nbsp;that&nbsp;all&nbsp;characters&nbsp;have&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5001409">//&nbsp;same&nbsp;width&nbsp;except&nbsp;for&nbsp;tabs&nbsp;for&nbsp;which&nbsp;a&nbsp;tabwidth&nbsp;must&nbsp;be&nbsp;specified.</span><br>
<span class="lineno"></span><span class="comment" id="5001479">//&nbsp;Note&nbsp;that&nbsp;cells&nbsp;are&nbsp;tab-terminated,&nbsp;not&nbsp;tab-separated:&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="5001546">//&nbsp;non-tab&nbsp;text&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;line&nbsp;does&nbsp;not&nbsp;form&nbsp;a&nbsp;column&nbsp;cell.</span><br>
<span class="lineno">45</span><span class="comment" id="5001612">//</span><br>
<span class="lineno"></span><span class="comment" id="5001615">//&nbsp;The&nbsp;Writer&nbsp;assumes&nbsp;that&nbsp;all&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;have&nbsp;the&nbsp;same&nbsp;width;</span><br>
<span class="lineno"></span><span class="comment" id="5001687">//&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;true&nbsp;in&nbsp;some&nbsp;fonts.</span><br>
<span class="lineno"></span><span class="comment" id="5001726">//</span><br>
<span class="lineno"></span><span class="comment" id="5001729">//&nbsp;If&nbsp;DiscardEmptyColumns&nbsp;is&nbsp;set,&nbsp;empty&nbsp;columns&nbsp;that&nbsp;are&nbsp;terminated</span><br>
<span class="lineno">50</span><span class="comment" id="5001797">//&nbsp;entirely&nbsp;by&nbsp;vertical&nbsp;(or&nbsp;&#34;soft&#34;)&nbsp;tabs&nbsp;are&nbsp;discarded.&nbsp;Columns</span><br>
<span class="lineno"></span><span class="comment" id="5001861">//&nbsp;terminated&nbsp;by&nbsp;horizontal&nbsp;(or&nbsp;&#34;hard&#34;)&nbsp;tabs&nbsp;are&nbsp;not&nbsp;affected&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5001926">//&nbsp;this&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="5001940">//</span><br>
<span class="lineno"></span><span class="comment" id="5001943">//&nbsp;If&nbsp;a&nbsp;Writer&nbsp;is&nbsp;configured&nbsp;to&nbsp;filter&nbsp;HTML,&nbsp;HTML&nbsp;tags&nbsp;and&nbsp;entities</span><br>
<span class="lineno">55</span><span class="comment" id="5002011">//&nbsp;are&nbsp;passed&nbsp;through.&nbsp;The&nbsp;widths&nbsp;of&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5002070">//&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;(tags)&nbsp;and&nbsp;one&nbsp;(entities)&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="5002143">//</span><br>
<span class="lineno"></span><span class="comment" id="5002146">//&nbsp;A&nbsp;segment&nbsp;of&nbsp;text&nbsp;may&nbsp;be&nbsp;escaped&nbsp;by&nbsp;bracketing&nbsp;it&nbsp;with&nbsp;Escape</span><br>
<span class="lineno"></span><span class="comment" id="5002211">//&nbsp;characters.&nbsp;The&nbsp;tabwriter&nbsp;passes&nbsp;escaped&nbsp;text&nbsp;segments&nbsp;through</span><br>
<span class="lineno">60</span><span class="comment" id="5002277">//&nbsp;unchanged.&nbsp;In&nbsp;particular,&nbsp;it&nbsp;does&nbsp;not&nbsp;interpret&nbsp;any&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5002345">//&nbsp;breaks&nbsp;within&nbsp;the&nbsp;segment.&nbsp;If&nbsp;the&nbsp;StripEscape&nbsp;flag&nbsp;is&nbsp;set,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5002411">//&nbsp;Escape&nbsp;characters&nbsp;are&nbsp;stripped&nbsp;from&nbsp;the&nbsp;output;&nbsp;otherwise&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="5002477">//&nbsp;are&nbsp;passed&nbsp;through&nbsp;as&nbsp;well.&nbsp;For&nbsp;the&nbsp;purpose&nbsp;of&nbsp;formatting,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5002543">//&nbsp;width&nbsp;of&nbsp;the&nbsp;escaped&nbsp;text&nbsp;is&nbsp;always&nbsp;computed&nbsp;excluding&nbsp;the&nbsp;Escape</span><br>
<span class="lineno">65</span><span class="comment" id="5002612">//&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="5002627">//</span><br>
<span class="lineno"></span><span class="comment" id="5002630">//&nbsp;The&nbsp;formfeed&nbsp;character&nbsp;(&#39;\f&#39;)&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline&nbsp;but&nbsp;it&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="5002695">//&nbsp;terminates&nbsp;all&nbsp;columns&nbsp;in&nbsp;the&nbsp;current&nbsp;line&nbsp;(effectively&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="5002762">//&nbsp;Flush).&nbsp;Cells&nbsp;in&nbsp;the&nbsp;next&nbsp;line&nbsp;start&nbsp;new&nbsp;columns.&nbsp;Unless&nbsp;found</span><br>
<span class="lineno">70</span><span class="comment" id="5002828">//&nbsp;inside&nbsp;an&nbsp;HTML&nbsp;tag&nbsp;or&nbsp;inside&nbsp;an&nbsp;escaped&nbsp;text&nbsp;segment,&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="5002894">//&nbsp;characters&nbsp;appear&nbsp;as&nbsp;newlines&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="5002942">//</span><br>
<span class="lineno"></span><span class="comment" id="5002945">//&nbsp;The&nbsp;Writer&nbsp;must&nbsp;buffer&nbsp;input&nbsp;internally,&nbsp;because&nbsp;proper&nbsp;spacing</span><br>
<span class="lineno"></span><span class="comment" id="5003012">//&nbsp;of&nbsp;one&nbsp;line&nbsp;may&nbsp;depend&nbsp;on&nbsp;the&nbsp;cells&nbsp;in&nbsp;future&nbsp;lines.&nbsp;Clients&nbsp;must</span><br>
<span class="lineno">75</span><span class="comment" id="5003081">//&nbsp;call&nbsp;Flush&nbsp;when&nbsp;done&nbsp;calling&nbsp;Write.</span><br>
<span class="lineno"></span><span class="comment" id="5003120">//</span><br>
<span class="lineno"></span><span class="keyword" id="5003123">type</span>&nbsp;<span class="ident" id="5003128">Writer</span>&nbsp;<span class="keyword" id="5003135">struct</span>&nbsp;<span class="op" id="5003142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5003145">//&nbsp;configuration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003163">output</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5003172">io</span><span class="op" id="5003174">.</span><span class="ident" id="5003175">Writer</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003183">minwidth</span>&nbsp;<span class="builtintype" id="5003192">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003197">tabwidth</span>&nbsp;<span class="builtintype" id="5003206">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003211">padding</span>&nbsp;&nbsp;<span class="builtintype" id="5003220">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003225">padbytes</span>&nbsp;<span class="op" id="5003234">[</span><span class="num" id="5003235">8</span><span class="op" id="5003236">]</span><span class="builtintype" id="5003237">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003243">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5003252">uint</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5003259">//&nbsp;current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003277">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003285">bytes</span><span class="op" id="5003290">.</span><span class="ident" id="5003291">Buffer</span>&nbsp;<span class="comment" id="5003298">//&nbsp;collected&nbsp;text&nbsp;excluding&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003347">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5003355">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5003368">//&nbsp;buffer&nbsp;position&nbsp;up&nbsp;to&nbsp;which&nbsp;cell.width&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;has&nbsp;been&nbsp;computed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003448">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003456">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5003469">//&nbsp;current&nbsp;incomplete&nbsp;cell;&nbsp;cell.width&nbsp;is&nbsp;up&nbsp;to&nbsp;buf[pos]&nbsp;excluding&nbsp;ignored&nbsp;sections</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003554">endChar</span>&nbsp;<span class="builtintype" id="5003562">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5003575">//&nbsp;terminating&nbsp;char&nbsp;of&nbsp;escaped&nbsp;sequence&nbsp;(Escape&nbsp;for&nbsp;escapes,&nbsp;&#39;&gt;&#39;,&nbsp;&#39;;&#39;&nbsp;for&nbsp;HTML&nbsp;tags/entities,&nbsp;or&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003676">lines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5003684">[</span><span class="op" id="5003685">]</span><span class="op" id="5003686">[</span><span class="op" id="5003687">]</span><span class="ident" id="5003688">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5003697">//&nbsp;list&nbsp;of&nbsp;lines;&nbsp;each&nbsp;line&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003745">widths</span>&nbsp;&nbsp;<span class="op" id="5003753">[</span><span class="op" id="5003754">]</span><span class="builtintype" id="5003755">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5003766">//&nbsp;list&nbsp;of&nbsp;column&nbsp;widths&nbsp;in&nbsp;runes&nbsp;-&nbsp;re-used&nbsp;during&nbsp;formatting</span><br>
<span class="lineno"></span><span class="op" id="5003828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5003831">func</span>&nbsp;<span class="op" id="5003836">(</span><span class="ident" id="5003837">b</span>&nbsp;<span class="op" id="5003839">*</span><span class="ident" id="5003840">Writer</span><span class="op" id="5003846">)</span>&nbsp;<span class="ident" id="5003848">addLine</span><span class="op" id="5003855">(</span><span class="op" id="5003856">)</span>&nbsp;<span class="op" id="5003858">{</span>&nbsp;<span class="ident" id="5003860">b</span><span class="op" id="5003861">.</span><span class="ident" id="5003862">lines</span>&nbsp;<span class="op" id="5003868">=</span>&nbsp;<span class="builtinfunc" id="5003870">append</span><span class="op" id="5003876">(</span><span class="ident" id="5003877">b</span><span class="op" id="5003878">.</span><span class="ident" id="5003879">lines</span><span class="op" id="5003884">,</span>&nbsp;<span class="op" id="5003886">[</span><span class="op" id="5003887">]</span><span class="ident" id="5003888">cell</span><span class="op" id="5003892">{</span><span class="op" id="5003893">}</span><span class="op" id="5003894">)</span>&nbsp;<span class="op" id="5003896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5003899">//&nbsp;Reset&nbsp;the&nbsp;current&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5003927">func</span>&nbsp;<span class="op" id="5003932">(</span><span class="ident" id="5003933">b</span>&nbsp;<span class="op" id="5003935">*</span><span class="ident" id="5003936">Writer</span><span class="op" id="5003942">)</span>&nbsp;<span class="ident" id="5003944">reset</span><span class="op" id="5003949">(</span><span class="op" id="5003950">)</span>&nbsp;<span class="op" id="5003952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003955">b</span><span class="op" id="5003956">.</span><span class="ident" id="5003957">buf</span><span class="op" id="5003960">.</span><span class="ident" id="5003961">Reset</span><span class="op" id="5003966">(</span><span class="op" id="5003967">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003970">b</span><span class="op" id="5003971">.</span><span class="ident" id="5003972">pos</span>&nbsp;<span class="op" id="5003976">=</span>&nbsp;<span class="num" id="5003978">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003981">b</span><span class="op" id="5003982">.</span><span class="ident" id="5003983">cell</span>&nbsp;<span class="op" id="5003988">=</span>&nbsp;<span class="ident" id="5003990">cell</span><span class="op" id="5003994">{</span><span class="op" id="5003995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003998">b</span><span class="op" id="5003999">.</span><span class="ident" id="5004000">endChar</span>&nbsp;<span class="op" id="5004008">=</span>&nbsp;<span class="num" id="5004010">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004013">b</span><span class="op" id="5004014">.</span><span class="ident" id="5004015">lines</span>&nbsp;<span class="op" id="5004021">=</span>&nbsp;<span class="ident" id="5004023">b</span><span class="op" id="5004024">.</span><span class="ident" id="5004025">lines</span><span class="op" id="5004030">[</span><span class="num" id="5004031">0</span><span class="op" id="5004032">:</span><span class="num" id="5004033">0</span><span class="op" id="5004034">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004037">b</span><span class="op" id="5004038">.</span><span class="ident" id="5004039">widths</span>&nbsp;<span class="op" id="5004046">=</span>&nbsp;<span class="ident" id="5004048">b</span><span class="op" id="5004049">.</span><span class="ident" id="5004050">widths</span><span class="op" id="5004056">[</span><span class="num" id="5004057">0</span><span class="op" id="5004058">:</span><span class="num" id="5004059">0</span><span class="op" id="5004060">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004063">b</span><span class="op" id="5004064">.</span><span class="ident" id="5004065">addLine</span><span class="op" id="5004072">(</span><span class="op" id="5004073">)</span><br>
<span class="lineno"></span><span class="op" id="5004075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5004078">//&nbsp;Internal&nbsp;representation&nbsp;(current&nbsp;state):</span><br>
<span class="lineno"></span><span class="comment" id="5004122">//</span><br>
<span class="lineno">110</span><span class="comment" id="5004125">//&nbsp;-&nbsp;all&nbsp;text&nbsp;written&nbsp;is&nbsp;appended&nbsp;to&nbsp;buf;&nbsp;tabs&nbsp;and&nbsp;line&nbsp;breaks&nbsp;are&nbsp;stripped&nbsp;away</span><br>
<span class="lineno"></span><span class="comment" id="5004206">//&nbsp;-&nbsp;at&nbsp;any&nbsp;given&nbsp;time&nbsp;there&nbsp;is&nbsp;a&nbsp;(possibly&nbsp;empty)&nbsp;incomplete&nbsp;cell&nbsp;at&nbsp;the&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="5004284">//&nbsp;&nbsp;&nbsp;(the&nbsp;cell&nbsp;starts&nbsp;after&nbsp;a&nbsp;tab&nbsp;or&nbsp;line&nbsp;break)</span><br>
<span class="lineno"></span><span class="comment" id="5004333">//&nbsp;-&nbsp;cell.size&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;belonging&nbsp;to&nbsp;the&nbsp;cell&nbsp;so&nbsp;far</span><br>
<span class="lineno"></span><span class="comment" id="5004400">//&nbsp;-&nbsp;cell.width&nbsp;is&nbsp;text&nbsp;width&nbsp;in&nbsp;runes&nbsp;of&nbsp;that&nbsp;cell&nbsp;from&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;cell&nbsp;to</span><br>
<span class="lineno">115</span><span class="comment" id="5004482">//&nbsp;&nbsp;&nbsp;position&nbsp;pos;&nbsp;html&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are&nbsp;excluded&nbsp;from&nbsp;this&nbsp;width&nbsp;if&nbsp;html</span><br>
<span class="lineno"></span><span class="comment" id="5004561">//&nbsp;&nbsp;&nbsp;filtering&nbsp;is&nbsp;enabled</span><br>
<span class="lineno"></span><span class="comment" id="5004587">//&nbsp;-&nbsp;the&nbsp;sizes&nbsp;and&nbsp;widths&nbsp;of&nbsp;processed&nbsp;text&nbsp;are&nbsp;kept&nbsp;in&nbsp;the&nbsp;lines&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="5004658">//&nbsp;&nbsp;&nbsp;which&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;cells&nbsp;for&nbsp;each&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5004708">//&nbsp;-&nbsp;the&nbsp;widths&nbsp;list&nbsp;is&nbsp;a&nbsp;temporary&nbsp;list&nbsp;with&nbsp;current&nbsp;widths&nbsp;used&nbsp;during</span><br>
<span class="lineno">120</span><span class="comment" id="5004781">//&nbsp;&nbsp;&nbsp;formatting;&nbsp;it&nbsp;is&nbsp;kept&nbsp;in&nbsp;Writer&nbsp;because&nbsp;it&#39;s&nbsp;re-used</span><br>
<span class="lineno"></span><span class="comment" id="5004840">//</span><br>
<span class="lineno"></span><span class="comment" id="5004843">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;----------&nbsp;size&nbsp;----------&gt;|</span><br>
<span class="lineno"></span><span class="comment" id="5004896">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="5004949">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;-&nbsp;width&nbsp;-&gt;|&lt;-&nbsp;ignored&nbsp;-&gt;|&nbsp;&nbsp;|</span><br>
<span class="lineno">125</span><span class="comment" id="5005002">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="5005055">//&nbsp;[---processed---tab------------&lt;tag&gt;...&lt;/tag&gt;...]</span><br>
<span class="lineno"></span><span class="comment" id="5005108">//&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</span><br>
<span class="lineno"></span><span class="comment" id="5005158">//&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="5005208">//&nbsp;buf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;&nbsp;pos</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="5005261">//&nbsp;Formatting&nbsp;can&nbsp;be&nbsp;controlled&nbsp;with&nbsp;these&nbsp;flags.</span><br>
<span class="lineno"></span><span class="keyword" id="5005311">const</span>&nbsp;<span class="op" id="5005317">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5005320">//&nbsp;Ignore&nbsp;html&nbsp;tags&nbsp;and&nbsp;treat&nbsp;entities&nbsp;(starting&nbsp;with&nbsp;&#39;&amp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5005379">//&nbsp;and&nbsp;ending&nbsp;in&nbsp;&#39;;&#39;)&nbsp;as&nbsp;single&nbsp;characters&nbsp;(width&nbsp;=&nbsp;1).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005436">FilterHTML</span>&nbsp;<span class="builtintype" id="5005447">uint</span>&nbsp;<span class="op" id="5005452">=</span>&nbsp;<span class="num" id="5005454">1</span>&nbsp;<span class="op" id="5005456">&lt;&lt;</span>&nbsp;<span class="ident" id="5005459">iota</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5005466">//&nbsp;Strip&nbsp;Escape&nbsp;characters&nbsp;bracketing&nbsp;escaped&nbsp;text&nbsp;segments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5005527">//&nbsp;instead&nbsp;of&nbsp;passing&nbsp;them&nbsp;through&nbsp;unchanged&nbsp;with&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005588">StripEscape</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5005602">//&nbsp;Force&nbsp;right-alignment&nbsp;of&nbsp;cell&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5005645">//&nbsp;Default&nbsp;is&nbsp;left-alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005676">AlignRight</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5005689">//&nbsp;Handle&nbsp;empty&nbsp;columns&nbsp;as&nbsp;if&nbsp;they&nbsp;were&nbsp;not&nbsp;present&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5005745">//&nbsp;the&nbsp;input&nbsp;in&nbsp;the&nbsp;first&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005779">DiscardEmptyColumns</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5005801">//&nbsp;Always&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;columns&nbsp;(i.e.,&nbsp;padding&nbsp;of</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5005863">//&nbsp;leading&nbsp;empty&nbsp;cells&nbsp;on&nbsp;the&nbsp;left)&nbsp;independent&nbsp;of&nbsp;padchar.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005924">TabIndent</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5005936">//&nbsp;Print&nbsp;a&nbsp;vertical&nbsp;bar&nbsp;(&#39;|&#39;)&nbsp;between&nbsp;columns&nbsp;(after&nbsp;formatting).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5006003">//&nbsp;Discarded&nbsp;columns&nbsp;appear&nbsp;as&nbsp;zero-width&nbsp;columns&nbsp;(&#34;||&#34;).</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5006062">Debug</span><br>
<span class="lineno"></span><span class="op" id="5006068">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5006071">//&nbsp;A&nbsp;Writer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;with&nbsp;a&nbsp;call&nbsp;to&nbsp;Init.&nbsp;The&nbsp;first&nbsp;parameter&nbsp;(output)</span><br>
<span class="lineno"></span><span class="comment" id="5006153">//&nbsp;specifies&nbsp;the&nbsp;filter&nbsp;output.&nbsp;The&nbsp;remaining&nbsp;parameters&nbsp;control&nbsp;the&nbsp;formatting:</span><br>
<span class="lineno">160</span><span class="comment" id="5006234">//</span><br>
<span class="lineno"></span><span class="comment" id="5006237">//&nbsp;&nbsp;&nbsp;&nbsp;minwidth&nbsp;&nbsp;&nbsp;&nbsp;minimal&nbsp;cell&nbsp;width&nbsp;including&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span><span class="comment" id="5006290">//&nbsp;&nbsp;&nbsp;&nbsp;tabwidth&nbsp;&nbsp;&nbsp;&nbsp;width&nbsp;of&nbsp;tab&nbsp;characters&nbsp;(equivalent&nbsp;number&nbsp;of&nbsp;spaces)</span><br>
<span class="lineno"></span><span class="comment" id="5006356">//&nbsp;&nbsp;&nbsp;&nbsp;padding&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;padding&nbsp;added&nbsp;to&nbsp;a&nbsp;cell&nbsp;before&nbsp;computing&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="5006419">//&nbsp;&nbsp;&nbsp;&nbsp;padchar&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASCII&nbsp;char&nbsp;used&nbsp;for&nbsp;padding</span><br>
<span class="lineno">165</span><span class="comment" id="5006459">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;padchar&nbsp;==&nbsp;&#39;\t&#39;,&nbsp;the&nbsp;Writer&nbsp;will&nbsp;assume&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5006516">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width&nbsp;of&nbsp;a&nbsp;&#39;\t&#39;&nbsp;in&nbsp;the&nbsp;formatted&nbsp;output&nbsp;is&nbsp;tabwidth,</span><br>
<span class="lineno"></span><span class="comment" id="5006574">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;cells&nbsp;are&nbsp;left-aligned&nbsp;independent&nbsp;of&nbsp;align_left</span><br>
<span class="lineno"></span><span class="comment" id="5006632">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(for&nbsp;correct-looking&nbsp;results,&nbsp;tabwidth&nbsp;must&nbsp;correspond</span><br>
<span class="lineno"></span><span class="comment" id="5006692">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;the&nbsp;tab&nbsp;width&nbsp;in&nbsp;the&nbsp;viewer&nbsp;displaying&nbsp;the&nbsp;result)</span><br>
<span class="lineno">170</span><span class="comment" id="5006751">//&nbsp;&nbsp;&nbsp;&nbsp;flags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;formatting&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="5006780">//</span><br>
<span class="lineno"></span><span class="keyword" id="5006783">func</span>&nbsp;<span class="op" id="5006788">(</span><span class="ident" id="5006789">b</span>&nbsp;<span class="op" id="5006791">*</span><span class="ident" id="5006792">Writer</span><span class="op" id="5006798">)</span>&nbsp;<span class="ident" id="5006800">Init</span><span class="op" id="5006804">(</span><span class="ident" id="5006805">output</span>&nbsp;<span class="ident" id="5006812">io</span><span class="op" id="5006814">.</span><span class="ident" id="5006815">Writer</span><span class="op" id="5006821">,</span>&nbsp;<span class="ident" id="5006823">minwidth</span><span class="op" id="5006831">,</span>&nbsp;<span class="ident" id="5006833">tabwidth</span><span class="op" id="5006841">,</span>&nbsp;<span class="ident" id="5006843">padding</span>&nbsp;<span class="builtintype" id="5006851">int</span><span class="op" id="5006854">,</span>&nbsp;<span class="ident" id="5006856">padchar</span>&nbsp;<span class="builtintype" id="5006864">byte</span><span class="op" id="5006868">,</span>&nbsp;<span class="ident" id="5006870">flags</span>&nbsp;<span class="builtintype" id="5006876">uint</span><span class="op" id="5006880">)</span>&nbsp;<span class="op" id="5006882">*</span><span class="ident" id="5006883">Writer</span>&nbsp;<span class="op" id="5006890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006893">if</span>&nbsp;<span class="ident" id="5006896">minwidth</span>&nbsp;<span class="op" id="5006905">&lt;</span>&nbsp;<span class="num" id="5006907">0</span>&nbsp;<span class="op" id="5006909">||</span>&nbsp;<span class="ident" id="5006912">tabwidth</span>&nbsp;<span class="op" id="5006921">&lt;</span>&nbsp;<span class="num" id="5006923">0</span>&nbsp;<span class="op" id="5006925">||</span>&nbsp;<span class="ident" id="5006928">padding</span>&nbsp;<span class="op" id="5006936">&lt;</span>&nbsp;<span class="num" id="5006938">0</span>&nbsp;<span class="op" id="5006940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5006944">panic</span><span class="op" id="5006949">(</span><span class="string" id="5006950">&#34;negative&nbsp;minwidth,&nbsp;tabwidth,&nbsp;or&nbsp;padding&#34;</span><span class="op" id="5006991">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5006994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5006997">b</span><span class="op" id="5006998">.</span><span class="ident" id="5006999">output</span>&nbsp;<span class="op" id="5007006">=</span>&nbsp;<span class="ident" id="5007008">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007016">b</span><span class="op" id="5007017">.</span><span class="ident" id="5007018">minwidth</span>&nbsp;<span class="op" id="5007027">=</span>&nbsp;<span class="ident" id="5007029">minwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007039">b</span><span class="op" id="5007040">.</span><span class="ident" id="5007041">tabwidth</span>&nbsp;<span class="op" id="5007050">=</span>&nbsp;<span class="ident" id="5007052">tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007062">b</span><span class="op" id="5007063">.</span><span class="ident" id="5007064">padding</span>&nbsp;<span class="op" id="5007072">=</span>&nbsp;<span class="ident" id="5007074">padding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007083">for</span>&nbsp;<span class="ident" id="5007087">i</span>&nbsp;<span class="op" id="5007089">:=</span>&nbsp;<span class="keyword" id="5007092">range</span>&nbsp;<span class="ident" id="5007098">b</span><span class="op" id="5007099">.</span><span class="ident" id="5007100">padbytes</span>&nbsp;<span class="op" id="5007109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007113">b</span><span class="op" id="5007114">.</span><span class="ident" id="5007115">padbytes</span><span class="op" id="5007123">[</span><span class="ident" id="5007124">i</span><span class="op" id="5007125">]</span>&nbsp;<span class="op" id="5007127">=</span>&nbsp;<span class="ident" id="5007129">padchar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5007138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007141">if</span>&nbsp;<span class="ident" id="5007144">padchar</span>&nbsp;<span class="op" id="5007152">==</span>&nbsp;<span class="string" id="5007155">&#39;\t&#39;</span>&nbsp;<span class="op" id="5007160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5007164">//&nbsp;tab&nbsp;padding&nbsp;enforces&nbsp;left-alignment</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007205">flags</span>&nbsp;<span class="op" id="5007211">&amp;^=</span>&nbsp;<span class="ident" id="5007215">AlignRight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5007227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007230">b</span><span class="op" id="5007231">.</span><span class="ident" id="5007232">flags</span>&nbsp;<span class="op" id="5007238">=</span>&nbsp;<span class="ident" id="5007240">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007248">b</span><span class="op" id="5007249">.</span><span class="ident" id="5007250">reset</span><span class="op" id="5007255">(</span><span class="op" id="5007256">)</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007260">return</span>&nbsp;<span class="ident" id="5007267">b</span><br>
<span class="lineno"></span><span class="op" id="5007269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5007272">//&nbsp;debugging&nbsp;support&nbsp;(keep&nbsp;code&nbsp;around)</span><br>
<span class="lineno">195</span><span class="keyword" id="5007312">func</span>&nbsp;<span class="op" id="5007317">(</span><span class="ident" id="5007318">b</span>&nbsp;<span class="op" id="5007320">*</span><span class="ident" id="5007321">Writer</span><span class="op" id="5007327">)</span>&nbsp;<span class="ident" id="5007329">dump</span><span class="op" id="5007333">(</span><span class="op" id="5007334">)</span>&nbsp;<span class="op" id="5007336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007339">pos</span>&nbsp;<span class="op" id="5007343">:=</span>&nbsp;<span class="num" id="5007346">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007349">for</span>&nbsp;<span class="ident" id="5007353">i</span><span class="op" id="5007354">,</span>&nbsp;<span class="ident" id="5007356">line</span>&nbsp;<span class="op" id="5007361">:=</span>&nbsp;<span class="keyword" id="5007364">range</span>&nbsp;<span class="ident" id="5007370">b</span><span class="op" id="5007371">.</span><span class="ident" id="5007372">lines</span>&nbsp;<span class="op" id="5007378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5007382">print</span><span class="op" id="5007387">(</span><span class="string" id="5007388">&#34;(&#34;</span><span class="op" id="5007391">,</span>&nbsp;<span class="ident" id="5007393">i</span><span class="op" id="5007394">,</span>&nbsp;<span class="string" id="5007396">&#34;)&nbsp;&#34;</span><span class="op" id="5007400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007404">for</span>&nbsp;<span class="ident" id="5007408">_</span><span class="op" id="5007409">,</span>&nbsp;<span class="ident" id="5007411">c</span>&nbsp;<span class="op" id="5007413">:=</span>&nbsp;<span class="keyword" id="5007416">range</span>&nbsp;<span class="ident" id="5007422">line</span>&nbsp;<span class="op" id="5007427">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5007432">print</span><span class="op" id="5007437">(</span><span class="string" id="5007438">&#34;[&#34;</span><span class="op" id="5007441">,</span>&nbsp;<span class="builtintype" id="5007443">string</span><span class="op" id="5007449">(</span><span class="ident" id="5007450">b</span><span class="op" id="5007451">.</span><span class="ident" id="5007452">buf</span><span class="op" id="5007455">.</span><span class="ident" id="5007456">Bytes</span><span class="op" id="5007461">(</span><span class="op" id="5007462">)</span><span class="op" id="5007463">[</span><span class="ident" id="5007464">pos</span><span class="op" id="5007467">:</span><span class="ident" id="5007468">pos</span><span class="op" id="5007471">+</span><span class="ident" id="5007472">c</span><span class="op" id="5007473">.</span><span class="ident" id="5007474">size</span><span class="op" id="5007478">]</span><span class="op" id="5007479">)</span><span class="op" id="5007480">,</span>&nbsp;<span class="string" id="5007482">&#34;]&#34;</span><span class="op" id="5007485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007490">pos</span>&nbsp;<span class="op" id="5007494">+=</span>&nbsp;<span class="ident" id="5007497">c</span><span class="op" id="5007498">.</span><span class="ident" id="5007499">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5007506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5007510">print</span><span class="op" id="5007515">(</span><span class="string" id="5007516">&#34;\n&#34;</span><span class="op" id="5007520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5007523">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5007526">print</span><span class="op" id="5007531">(</span><span class="string" id="5007532">&#34;\n&#34;</span><span class="op" id="5007536">)</span><br>
<span class="lineno"></span><span class="op" id="5007538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5007541">//&nbsp;local&nbsp;error&nbsp;wrapper&nbsp;so&nbsp;we&nbsp;can&nbsp;distinguish&nbsp;errors&nbsp;we&nbsp;want&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5007611">//&nbsp;as&nbsp;errors&nbsp;from&nbsp;genuine&nbsp;panics&nbsp;(which&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;return&nbsp;as&nbsp;errors)</span><br>
<span class="lineno">210</span><span class="keyword" id="5007686">type</span>&nbsp;<span class="ident" id="5007691">osError</span>&nbsp;<span class="keyword" id="5007699">struct</span>&nbsp;<span class="op" id="5007706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007709">err</span>&nbsp;<span class="builtintype" id="5007713">error</span><br>
<span class="lineno"></span><span class="op" id="5007719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5007722">func</span>&nbsp;<span class="op" id="5007727">(</span><span class="ident" id="5007728">b</span>&nbsp;<span class="op" id="5007730">*</span><span class="ident" id="5007731">Writer</span><span class="op" id="5007737">)</span>&nbsp;<span class="ident" id="5007739">write0</span><span class="op" id="5007745">(</span><span class="ident" id="5007746">buf</span>&nbsp;<span class="op" id="5007750">[</span><span class="op" id="5007751">]</span><span class="builtintype" id="5007752">byte</span><span class="op" id="5007756">)</span>&nbsp;<span class="op" id="5007758">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007761">n</span><span class="op" id="5007762">,</span>&nbsp;<span class="ident" id="5007764">err</span>&nbsp;<span class="op" id="5007768">:=</span>&nbsp;<span class="ident" id="5007771">b</span><span class="op" id="5007772">.</span><span class="ident" id="5007773">output</span><span class="op" id="5007779">.</span><span class="ident" id="5007780">Write</span><span class="op" id="5007785">(</span><span class="ident" id="5007786">buf</span><span class="op" id="5007789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007792">if</span>&nbsp;<span class="ident" id="5007795">n</span>&nbsp;<span class="op" id="5007797">!=</span>&nbsp;<span class="builtinfunc" id="5007800">len</span><span class="op" id="5007803">(</span><span class="ident" id="5007804">buf</span><span class="op" id="5007807">)</span>&nbsp;<span class="op" id="5007809">&amp;&amp;</span>&nbsp;<span class="ident" id="5007812">err</span>&nbsp;<span class="op" id="5007816">==</span>&nbsp;<span class="builtintype" id="5007819">nil</span>&nbsp;<span class="op" id="5007823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007827">err</span>&nbsp;<span class="op" id="5007831">=</span>&nbsp;<span class="ident" id="5007833">io</span><span class="op" id="5007835">.</span><span class="ident" id="5007836">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5007851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007854">if</span>&nbsp;<span class="ident" id="5007857">err</span>&nbsp;<span class="op" id="5007861">!=</span>&nbsp;<span class="builtintype" id="5007864">nil</span>&nbsp;<span class="op" id="5007868">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5007872">panic</span><span class="op" id="5007877">(</span><span class="ident" id="5007878">osError</span><span class="op" id="5007885">{</span><span class="ident" id="5007886">err</span><span class="op" id="5007889">}</span><span class="op" id="5007890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5007893">}</span><br>
<span class="lineno"></span><span class="op" id="5007895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5007898">func</span>&nbsp;<span class="op" id="5007903">(</span><span class="ident" id="5007904">b</span>&nbsp;<span class="op" id="5007906">*</span><span class="ident" id="5007907">Writer</span><span class="op" id="5007913">)</span>&nbsp;<span class="ident" id="5007915">writeN</span><span class="op" id="5007921">(</span><span class="ident" id="5007922">src</span>&nbsp;<span class="op" id="5007926">[</span><span class="op" id="5007927">]</span><span class="builtintype" id="5007928">byte</span><span class="op" id="5007932">,</span>&nbsp;<span class="ident" id="5007934">n</span>&nbsp;<span class="builtintype" id="5007936">int</span><span class="op" id="5007939">)</span>&nbsp;<span class="op" id="5007941">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007944">for</span>&nbsp;<span class="ident" id="5007948">n</span>&nbsp;<span class="op" id="5007950">&gt;</span>&nbsp;<span class="builtinfunc" id="5007952">len</span><span class="op" id="5007955">(</span><span class="ident" id="5007956">src</span><span class="op" id="5007959">)</span>&nbsp;<span class="op" id="5007961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007965">b</span><span class="op" id="5007966">.</span><span class="ident" id="5007967">write0</span><span class="op" id="5007973">(</span><span class="ident" id="5007974">src</span><span class="op" id="5007977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007981">n</span>&nbsp;<span class="op" id="5007983">-=</span>&nbsp;<span class="builtinfunc" id="5007986">len</span><span class="op" id="5007989">(</span><span class="ident" id="5007990">src</span><span class="op" id="5007993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5007996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007999">b</span><span class="op" id="5008000">.</span><span class="ident" id="5008001">write0</span><span class="op" id="5008007">(</span><span class="ident" id="5008008">src</span><span class="op" id="5008011">[</span><span class="num" id="5008012">0</span><span class="op" id="5008013">:</span><span class="ident" id="5008014">n</span><span class="op" id="5008015">]</span><span class="op" id="5008016">)</span><br>
<span class="lineno">230</span><span class="op" id="5008018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5008021">var</span>&nbsp;<span class="op" id="5008025">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008028">newline</span>&nbsp;<span class="op" id="5008036">=</span>&nbsp;<span class="op" id="5008038">[</span><span class="op" id="5008039">]</span><span class="builtintype" id="5008040">byte</span><span class="op" id="5008044">{</span><span class="string" id="5008045">&#39;\n&#39;</span><span class="op" id="5008049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008052">tabs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5008060">=</span>&nbsp;<span class="op" id="5008062">[</span><span class="op" id="5008063">]</span><span class="builtintype" id="5008064">byte</span><span class="op" id="5008068">(</span><span class="string" id="5008069">&#34;\t\t\t\t\t\t\t\t&#34;</span><span class="op" id="5008087">)</span><br>
<span class="lineno">235</span><span class="op" id="5008089">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5008092">func</span>&nbsp;<span class="op" id="5008097">(</span><span class="ident" id="5008098">b</span>&nbsp;<span class="op" id="5008100">*</span><span class="ident" id="5008101">Writer</span><span class="op" id="5008107">)</span>&nbsp;<span class="ident" id="5008109">writePadding</span><span class="op" id="5008121">(</span><span class="ident" id="5008122">textw</span><span class="op" id="5008127">,</span>&nbsp;<span class="ident" id="5008129">cellw</span>&nbsp;<span class="builtintype" id="5008135">int</span><span class="op" id="5008138">,</span>&nbsp;<span class="ident" id="5008140">useTabs</span>&nbsp;<span class="builtintype" id="5008148">bool</span><span class="op" id="5008152">)</span>&nbsp;<span class="op" id="5008154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008157">if</span>&nbsp;<span class="ident" id="5008160">b</span><span class="op" id="5008161">.</span><span class="ident" id="5008162">padbytes</span><span class="op" id="5008170">[</span><span class="num" id="5008171">0</span><span class="op" id="5008172">]</span>&nbsp;<span class="op" id="5008174">==</span>&nbsp;<span class="string" id="5008177">&#39;\t&#39;</span>&nbsp;<span class="op" id="5008182">||</span>&nbsp;<span class="ident" id="5008185">useTabs</span>&nbsp;<span class="op" id="5008193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5008197">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;tabs</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008228">if</span>&nbsp;<span class="ident" id="5008231">b</span><span class="op" id="5008232">.</span><span class="ident" id="5008233">tabwidth</span>&nbsp;<span class="op" id="5008242">==</span>&nbsp;<span class="num" id="5008245">0</span>&nbsp;<span class="op" id="5008247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008252">return</span>&nbsp;<span class="comment" id="5008259">//&nbsp;tabs&nbsp;have&nbsp;no&nbsp;width&nbsp;-&nbsp;can&#39;t&nbsp;do&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5008306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5008310">//&nbsp;make&nbsp;cellw&nbsp;the&nbsp;smallest&nbsp;multiple&nbsp;of&nbsp;b.tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008362">cellw</span>&nbsp;<span class="op" id="5008368">=</span>&nbsp;<span class="op" id="5008370">(</span><span class="ident" id="5008371">cellw</span>&nbsp;<span class="op" id="5008377">+</span>&nbsp;<span class="ident" id="5008379">b</span><span class="op" id="5008380">.</span><span class="ident" id="5008381">tabwidth</span>&nbsp;<span class="op" id="5008390">-</span>&nbsp;<span class="num" id="5008392">1</span><span class="op" id="5008393">)</span>&nbsp;<span class="op" id="5008395">/</span>&nbsp;<span class="ident" id="5008397">b</span><span class="op" id="5008398">.</span><span class="ident" id="5008399">tabwidth</span>&nbsp;<span class="op" id="5008408">*</span>&nbsp;<span class="ident" id="5008410">b</span><span class="op" id="5008411">.</span><span class="ident" id="5008412">tabwidth</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008423">n</span>&nbsp;<span class="op" id="5008425">:=</span>&nbsp;<span class="ident" id="5008428">cellw</span>&nbsp;<span class="op" id="5008434">-</span>&nbsp;<span class="ident" id="5008436">textw</span>&nbsp;<span class="comment" id="5008442">//&nbsp;amount&nbsp;of&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008465">if</span>&nbsp;<span class="ident" id="5008468">n</span>&nbsp;<span class="op" id="5008470">&lt;</span>&nbsp;<span class="num" id="5008472">0</span>&nbsp;<span class="op" id="5008474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5008479">panic</span><span class="op" id="5008484">(</span><span class="string" id="5008485">&#34;internal&nbsp;error&#34;</span><span class="op" id="5008501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5008505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008509">b</span><span class="op" id="5008510">.</span><span class="ident" id="5008511">writeN</span><span class="op" id="5008517">(</span><span class="ident" id="5008518">tabs</span><span class="op" id="5008522">,</span>&nbsp;<span class="op" id="5008524">(</span><span class="ident" id="5008525">n</span><span class="op" id="5008526">+</span><span class="ident" id="5008527">b</span><span class="op" id="5008528">.</span><span class="ident" id="5008529">tabwidth</span><span class="op" id="5008537">-</span><span class="num" id="5008538">1</span><span class="op" id="5008539">)</span><span class="op" id="5008540">/</span><span class="ident" id="5008541">b</span><span class="op" id="5008542">.</span><span class="ident" id="5008543">tabwidth</span><span class="op" id="5008551">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008555">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5008563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5008567">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;non-tab&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008611">b</span><span class="op" id="5008612">.</span><span class="ident" id="5008613">writeN</span><span class="op" id="5008619">(</span><span class="ident" id="5008620">b</span><span class="op" id="5008621">.</span><span class="ident" id="5008622">padbytes</span><span class="op" id="5008630">[</span><span class="num" id="5008631">0</span><span class="op" id="5008632">:</span><span class="op" id="5008633">]</span><span class="op" id="5008634">,</span>&nbsp;<span class="ident" id="5008636">cellw</span><span class="op" id="5008641">-</span><span class="ident" id="5008642">textw</span><span class="op" id="5008647">)</span><br>
<span class="lineno">255</span><span class="op" id="5008649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5008652">var</span>&nbsp;<span class="ident" id="5008656">vbar</span>&nbsp;<span class="op" id="5008661">=</span>&nbsp;<span class="op" id="5008663">[</span><span class="op" id="5008664">]</span><span class="builtintype" id="5008665">byte</span><span class="op" id="5008669">{</span><span class="string" id="5008670">&#39;|&#39;</span><span class="op" id="5008673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5008676">func</span>&nbsp;<span class="op" id="5008681">(</span><span class="ident" id="5008682">b</span>&nbsp;<span class="op" id="5008684">*</span><span class="ident" id="5008685">Writer</span><span class="op" id="5008691">)</span>&nbsp;<span class="ident" id="5008693">writeLines</span><span class="op" id="5008703">(</span><span class="ident" id="5008704">pos0</span>&nbsp;<span class="builtintype" id="5008709">int</span><span class="op" id="5008712">,</span>&nbsp;<span class="ident" id="5008714">line0</span><span class="op" id="5008719">,</span>&nbsp;<span class="ident" id="5008721">line1</span>&nbsp;<span class="builtintype" id="5008727">int</span><span class="op" id="5008730">)</span>&nbsp;<span class="op" id="5008732">(</span><span class="ident" id="5008733">pos</span>&nbsp;<span class="builtintype" id="5008737">int</span><span class="op" id="5008740">)</span>&nbsp;<span class="op" id="5008742">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008745">pos</span>&nbsp;<span class="op" id="5008749">=</span>&nbsp;<span class="ident" id="5008751">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008757">for</span>&nbsp;<span class="ident" id="5008761">i</span>&nbsp;<span class="op" id="5008763">:=</span>&nbsp;<span class="ident" id="5008766">line0</span><span class="op" id="5008771">;</span>&nbsp;<span class="ident" id="5008773">i</span>&nbsp;<span class="op" id="5008775">&lt;</span>&nbsp;<span class="ident" id="5008777">line1</span><span class="op" id="5008782">;</span>&nbsp;<span class="ident" id="5008784">i</span><span class="op" id="5008785">++</span>&nbsp;<span class="op" id="5008788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008792">line</span>&nbsp;<span class="op" id="5008797">:=</span>&nbsp;<span class="ident" id="5008800">b</span><span class="op" id="5008801">.</span><span class="ident" id="5008802">lines</span><span class="op" id="5008807">[</span><span class="ident" id="5008808">i</span><span class="op" id="5008809">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5008814">//&nbsp;if&nbsp;TabIndent&nbsp;is&nbsp;set,&nbsp;use&nbsp;tabs&nbsp;to&nbsp;pad&nbsp;leading&nbsp;empty&nbsp;cells</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008876">useTabs</span>&nbsp;<span class="op" id="5008884">:=</span>&nbsp;<span class="ident" id="5008887">b</span><span class="op" id="5008888">.</span><span class="ident" id="5008889">flags</span><span class="op" id="5008894">&amp;</span><span class="ident" id="5008895">TabIndent</span>&nbsp;<span class="op" id="5008905">!=</span>&nbsp;<span class="num" id="5008908">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008913">for</span>&nbsp;<span class="ident" id="5008917">j</span><span class="op" id="5008918">,</span>&nbsp;<span class="ident" id="5008920">c</span>&nbsp;<span class="op" id="5008922">:=</span>&nbsp;<span class="keyword" id="5008925">range</span>&nbsp;<span class="ident" id="5008931">line</span>&nbsp;<span class="op" id="5008936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008941">if</span>&nbsp;<span class="ident" id="5008944">j</span>&nbsp;<span class="op" id="5008946">&gt;</span>&nbsp;<span class="num" id="5008948">0</span>&nbsp;<span class="op" id="5008950">&amp;&amp;</span>&nbsp;<span class="ident" id="5008953">b</span><span class="op" id="5008954">.</span><span class="ident" id="5008955">flags</span><span class="op" id="5008960">&amp;</span><span class="ident" id="5008961">Debug</span>&nbsp;<span class="op" id="5008967">!=</span>&nbsp;<span class="num" id="5008970">0</span>&nbsp;<span class="op" id="5008972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5008978">//&nbsp;indicate&nbsp;column&nbsp;break</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009007">b</span><span class="op" id="5009008">.</span><span class="ident" id="5009009">write0</span><span class="op" id="5009015">(</span><span class="ident" id="5009016">vbar</span><span class="op" id="5009020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5009025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5009031">if</span>&nbsp;<span class="ident" id="5009034">c</span><span class="op" id="5009035">.</span><span class="ident" id="5009036">size</span>&nbsp;<span class="op" id="5009041">==</span>&nbsp;<span class="num" id="5009044">0</span>&nbsp;<span class="op" id="5009046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5009052">//&nbsp;empty&nbsp;cell</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5009070">if</span>&nbsp;<span class="ident" id="5009073">j</span>&nbsp;<span class="op" id="5009075">&lt;</span>&nbsp;<span class="builtinfunc" id="5009077">len</span><span class="op" id="5009080">(</span><span class="ident" id="5009081">b</span><span class="op" id="5009082">.</span><span class="ident" id="5009083">widths</span><span class="op" id="5009089">)</span>&nbsp;<span class="op" id="5009091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009098">b</span><span class="op" id="5009099">.</span><span class="ident" id="5009100">writePadding</span><span class="op" id="5009112">(</span><span class="ident" id="5009113">c</span><span class="op" id="5009114">.</span><span class="ident" id="5009115">width</span><span class="op" id="5009120">,</span>&nbsp;<span class="ident" id="5009122">b</span><span class="op" id="5009123">.</span><span class="ident" id="5009124">widths</span><span class="op" id="5009130">[</span><span class="ident" id="5009131">j</span><span class="op" id="5009132">]</span><span class="op" id="5009133">,</span>&nbsp;<span class="ident" id="5009135">useTabs</span><span class="op" id="5009142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5009148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5009153">}</span>&nbsp;<span class="keyword" id="5009155">else</span>&nbsp;<span class="op" id="5009160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5009166">//&nbsp;non-empty&nbsp;cell</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009188">useTabs</span>&nbsp;<span class="op" id="5009196">=</span>&nbsp;<span class="builtintype" id="5009198">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5009208">if</span>&nbsp;<span class="ident" id="5009211">b</span><span class="op" id="5009212">.</span><span class="ident" id="5009213">flags</span><span class="op" id="5009218">&amp;</span><span class="ident" id="5009219">AlignRight</span>&nbsp;<span class="op" id="5009230">==</span>&nbsp;<span class="num" id="5009233">0</span>&nbsp;<span class="op" id="5009235">{</span>&nbsp;<span class="comment" id="5009237">//&nbsp;align&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009256">b</span><span class="op" id="5009257">.</span><span class="ident" id="5009258">write0</span><span class="op" id="5009264">(</span><span class="ident" id="5009265">b</span><span class="op" id="5009266">.</span><span class="ident" id="5009267">buf</span><span class="op" id="5009270">.</span><span class="ident" id="5009271">Bytes</span><span class="op" id="5009276">(</span><span class="op" id="5009277">)</span><span class="op" id="5009278">[</span><span class="ident" id="5009279">pos</span>&nbsp;<span class="op" id="5009283">:</span>&nbsp;<span class="ident" id="5009285">pos</span><span class="op" id="5009288">+</span><span class="ident" id="5009289">c</span><span class="op" id="5009290">.</span><span class="ident" id="5009291">size</span><span class="op" id="5009295">]</span><span class="op" id="5009296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009303">pos</span>&nbsp;<span class="op" id="5009307">+=</span>&nbsp;<span class="ident" id="5009310">c</span><span class="op" id="5009311">.</span><span class="ident" id="5009312">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5009322">if</span>&nbsp;<span class="ident" id="5009325">j</span>&nbsp;<span class="op" id="5009327">&lt;</span>&nbsp;<span class="builtinfunc" id="5009329">len</span><span class="op" id="5009332">(</span><span class="ident" id="5009333">b</span><span class="op" id="5009334">.</span><span class="ident" id="5009335">widths</span><span class="op" id="5009341">)</span>&nbsp;<span class="op" id="5009343">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009351">b</span><span class="op" id="5009352">.</span><span class="ident" id="5009353">writePadding</span><span class="op" id="5009365">(</span><span class="ident" id="5009366">c</span><span class="op" id="5009367">.</span><span class="ident" id="5009368">width</span><span class="op" id="5009373">,</span>&nbsp;<span class="ident" id="5009375">b</span><span class="op" id="5009376">.</span><span class="ident" id="5009377">widths</span><span class="op" id="5009383">[</span><span class="ident" id="5009384">j</span><span class="op" id="5009385">]</span><span class="op" id="5009386">,</span>&nbsp;<span class="builtintype" id="5009388">false</span><span class="op" id="5009393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5009400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5009406">}</span>&nbsp;<span class="keyword" id="5009408">else</span>&nbsp;<span class="op" id="5009413">{</span>&nbsp;<span class="comment" id="5009415">//&nbsp;align&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5009435">if</span>&nbsp;<span class="ident" id="5009438">j</span>&nbsp;<span class="op" id="5009440">&lt;</span>&nbsp;<span class="builtinfunc" id="5009442">len</span><span class="op" id="5009445">(</span><span class="ident" id="5009446">b</span><span class="op" id="5009447">.</span><span class="ident" id="5009448">widths</span><span class="op" id="5009454">)</span>&nbsp;<span class="op" id="5009456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009464">b</span><span class="op" id="5009465">.</span><span class="ident" id="5009466">writePadding</span><span class="op" id="5009478">(</span><span class="ident" id="5009479">c</span><span class="op" id="5009480">.</span><span class="ident" id="5009481">width</span><span class="op" id="5009486">,</span>&nbsp;<span class="ident" id="5009488">b</span><span class="op" id="5009489">.</span><span class="ident" id="5009490">widths</span><span class="op" id="5009496">[</span><span class="ident" id="5009497">j</span><span class="op" id="5009498">]</span><span class="op" id="5009499">,</span>&nbsp;<span class="builtintype" id="5009501">false</span><span class="op" id="5009506">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5009513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009520">b</span><span class="op" id="5009521">.</span><span class="ident" id="5009522">write0</span><span class="op" id="5009528">(</span><span class="ident" id="5009529">b</span><span class="op" id="5009530">.</span><span class="ident" id="5009531">buf</span><span class="op" id="5009534">.</span><span class="ident" id="5009535">Bytes</span><span class="op" id="5009540">(</span><span class="op" id="5009541">)</span><span class="op" id="5009542">[</span><span class="ident" id="5009543">pos</span>&nbsp;<span class="op" id="5009547">:</span>&nbsp;<span class="ident" id="5009549">pos</span><span class="op" id="5009552">+</span><span class="ident" id="5009553">c</span><span class="op" id="5009554">.</span><span class="ident" id="5009555">size</span><span class="op" id="5009559">]</span><span class="op" id="5009560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009567">pos</span>&nbsp;<span class="op" id="5009571">+=</span>&nbsp;<span class="ident" id="5009574">c</span><span class="op" id="5009575">.</span><span class="ident" id="5009576">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5009585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5009590">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5009594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5009599">if</span>&nbsp;<span class="ident" id="5009602">i</span><span class="op" id="5009603">+</span><span class="num" id="5009604">1</span>&nbsp;<span class="op" id="5009606">==</span>&nbsp;<span class="builtinfunc" id="5009609">len</span><span class="op" id="5009612">(</span><span class="ident" id="5009613">b</span><span class="op" id="5009614">.</span><span class="ident" id="5009615">lines</span><span class="op" id="5009620">)</span>&nbsp;<span class="op" id="5009622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5009627">//&nbsp;last&nbsp;buffered&nbsp;line&nbsp;-&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;newline,&nbsp;so&nbsp;just&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5009693">//&nbsp;any&nbsp;outstanding&nbsp;buffered&nbsp;data</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009729">b</span><span class="op" id="5009730">.</span><span class="ident" id="5009731">write0</span><span class="op" id="5009737">(</span><span class="ident" id="5009738">b</span><span class="op" id="5009739">.</span><span class="ident" id="5009740">buf</span><span class="op" id="5009743">.</span><span class="ident" id="5009744">Bytes</span><span class="op" id="5009749">(</span><span class="op" id="5009750">)</span><span class="op" id="5009751">[</span><span class="ident" id="5009752">pos</span>&nbsp;<span class="op" id="5009756">:</span>&nbsp;<span class="ident" id="5009758">pos</span><span class="op" id="5009761">+</span><span class="ident" id="5009762">b</span><span class="op" id="5009763">.</span><span class="ident" id="5009764">cell</span><span class="op" id="5009768">.</span><span class="ident" id="5009769">size</span><span class="op" id="5009773">]</span><span class="op" id="5009774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009779">pos</span>&nbsp;<span class="op" id="5009783">+=</span>&nbsp;<span class="ident" id="5009786">b</span><span class="op" id="5009787">.</span><span class="ident" id="5009788">cell</span><span class="op" id="5009792">.</span><span class="ident" id="5009793">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5009800">}</span>&nbsp;<span class="keyword" id="5009802">else</span>&nbsp;<span class="op" id="5009807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5009812">//&nbsp;not&nbsp;the&nbsp;last&nbsp;line&nbsp;-&nbsp;write&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009852">b</span><span class="op" id="5009853">.</span><span class="ident" id="5009854">write0</span><span class="op" id="5009860">(</span><span class="ident" id="5009861">newline</span><span class="op" id="5009868">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5009872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5009875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5009878">return</span><br>
<span class="lineno"></span><span class="op" id="5009885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="5009888">//&nbsp;Format&nbsp;the&nbsp;text&nbsp;between&nbsp;line0&nbsp;and&nbsp;line1&nbsp;(excluding&nbsp;line1);&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="5009954">//&nbsp;is&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;line0.</span><br>
<span class="lineno"></span><span class="comment" id="5010021">//&nbsp;Returns&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5010086">//&nbsp;line1&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="5010117">//</span><br>
<span class="lineno">315</span><span class="keyword" id="5010120">func</span>&nbsp;<span class="op" id="5010125">(</span><span class="ident" id="5010126">b</span>&nbsp;<span class="op" id="5010128">*</span><span class="ident" id="5010129">Writer</span><span class="op" id="5010135">)</span>&nbsp;<span class="ident" id="5010137">format</span><span class="op" id="5010143">(</span><span class="ident" id="5010144">pos0</span>&nbsp;<span class="builtintype" id="5010149">int</span><span class="op" id="5010152">,</span>&nbsp;<span class="ident" id="5010154">line0</span><span class="op" id="5010159">,</span>&nbsp;<span class="ident" id="5010161">line1</span>&nbsp;<span class="builtintype" id="5010167">int</span><span class="op" id="5010170">)</span>&nbsp;<span class="op" id="5010172">(</span><span class="ident" id="5010173">pos</span>&nbsp;<span class="builtintype" id="5010177">int</span><span class="op" id="5010180">)</span>&nbsp;<span class="op" id="5010182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010185">pos</span>&nbsp;<span class="op" id="5010189">=</span>&nbsp;<span class="ident" id="5010191">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010197">column</span>&nbsp;<span class="op" id="5010204">:=</span>&nbsp;<span class="builtinfunc" id="5010207">len</span><span class="op" id="5010210">(</span><span class="ident" id="5010211">b</span><span class="op" id="5010212">.</span><span class="ident" id="5010213">widths</span><span class="op" id="5010219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5010222">for</span>&nbsp;<span class="ident" id="5010226">this</span>&nbsp;<span class="op" id="5010231">:=</span>&nbsp;<span class="ident" id="5010234">line0</span><span class="op" id="5010239">;</span>&nbsp;<span class="ident" id="5010241">this</span>&nbsp;<span class="op" id="5010246">&lt;</span>&nbsp;<span class="ident" id="5010248">line1</span><span class="op" id="5010253">;</span>&nbsp;<span class="ident" id="5010255">this</span><span class="op" id="5010259">++</span>&nbsp;<span class="op" id="5010262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010266">line</span>&nbsp;<span class="op" id="5010271">:=</span>&nbsp;<span class="ident" id="5010274">b</span><span class="op" id="5010275">.</span><span class="ident" id="5010276">lines</span><span class="op" id="5010281">[</span><span class="ident" id="5010282">this</span><span class="op" id="5010286">]</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5010291">if</span>&nbsp;<span class="ident" id="5010294">column</span>&nbsp;<span class="op" id="5010301">&lt;</span>&nbsp;<span class="builtinfunc" id="5010303">len</span><span class="op" id="5010306">(</span><span class="ident" id="5010307">line</span><span class="op" id="5010311">)</span><span class="op" id="5010312">-</span><span class="num" id="5010313">1</span>&nbsp;<span class="op" id="5010315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010320">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column&nbsp;=&gt;&nbsp;this&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010366">//&nbsp;has&nbsp;more&nbsp;cells&nbsp;than&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010410">//&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;is&nbsp;ignored&nbsp;because&nbsp;cells&nbsp;are</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010469">//&nbsp;tab-terminated;&nbsp;the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010528">//&nbsp;text&nbsp;before&nbsp;the&nbsp;newline/formfeed&nbsp;and&nbsp;does&nbsp;not&nbsp;belong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010587">//&nbsp;to&nbsp;a&nbsp;column)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010607">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;beginning&nbsp;of&nbsp;block</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010660">pos</span>&nbsp;<span class="op" id="5010664">=</span>&nbsp;<span class="ident" id="5010666">b</span><span class="op" id="5010667">.</span><span class="ident" id="5010668">writeLines</span><span class="op" id="5010678">(</span><span class="ident" id="5010679">pos</span><span class="op" id="5010682">,</span>&nbsp;<span class="ident" id="5010684">line0</span><span class="op" id="5010689">,</span>&nbsp;<span class="ident" id="5010691">this</span><span class="op" id="5010695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010700">line0</span>&nbsp;<span class="op" id="5010706">=</span>&nbsp;<span class="ident" id="5010708">this</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010717">//&nbsp;column&nbsp;block&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010742">width</span>&nbsp;<span class="op" id="5010748">:=</span>&nbsp;<span class="ident" id="5010751">b</span><span class="op" id="5010752">.</span><span class="ident" id="5010753">minwidth</span>&nbsp;<span class="comment" id="5010762">//&nbsp;minimal&nbsp;column&nbsp;width</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010789">discardable</span>&nbsp;<span class="op" id="5010801">:=</span>&nbsp;<span class="builtintype" id="5010804">true</span>&nbsp;<span class="comment" id="5010809">//&nbsp;true&nbsp;if&nbsp;all&nbsp;cells&nbsp;in&nbsp;this&nbsp;column&nbsp;are&nbsp;empty&nbsp;and&nbsp;&#34;soft&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5010869">for</span>&nbsp;<span class="op" id="5010873">;</span>&nbsp;<span class="ident" id="5010875">this</span>&nbsp;<span class="op" id="5010880">&lt;</span>&nbsp;<span class="ident" id="5010882">line1</span><span class="op" id="5010887">;</span>&nbsp;<span class="ident" id="5010889">this</span><span class="op" id="5010893">++</span>&nbsp;<span class="op" id="5010896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010902">line</span>&nbsp;<span class="op" id="5010907">=</span>&nbsp;<span class="ident" id="5010909">b</span><span class="op" id="5010910">.</span><span class="ident" id="5010911">lines</span><span class="op" id="5010916">[</span><span class="ident" id="5010917">this</span><span class="op" id="5010921">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5010927">if</span>&nbsp;<span class="ident" id="5010930">column</span>&nbsp;<span class="op" id="5010937">&lt;</span>&nbsp;<span class="builtinfunc" id="5010939">len</span><span class="op" id="5010942">(</span><span class="ident" id="5010943">line</span><span class="op" id="5010947">)</span><span class="op" id="5010948">-</span><span class="num" id="5010949">1</span>&nbsp;<span class="op" id="5010951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010958">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010993">c</span>&nbsp;<span class="op" id="5010995">:=</span>&nbsp;<span class="ident" id="5010998">line</span><span class="op" id="5011002">[</span><span class="ident" id="5011003">column</span><span class="op" id="5011009">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5011016">//&nbsp;update&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5011037">if</span>&nbsp;<span class="ident" id="5011040">w</span>&nbsp;<span class="op" id="5011042">:=</span>&nbsp;<span class="ident" id="5011045">c</span><span class="op" id="5011046">.</span><span class="ident" id="5011047">width</span>&nbsp;<span class="op" id="5011053">+</span>&nbsp;<span class="ident" id="5011055">b</span><span class="op" id="5011056">.</span><span class="ident" id="5011057">padding</span><span class="op" id="5011064">;</span>&nbsp;<span class="ident" id="5011066">w</span>&nbsp;<span class="op" id="5011068">&gt;</span>&nbsp;<span class="ident" id="5011070">width</span>&nbsp;<span class="op" id="5011076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011084">width</span>&nbsp;<span class="op" id="5011090">=</span>&nbsp;<span class="ident" id="5011092">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5011099">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5011106">//&nbsp;update&nbsp;discardable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5011133">if</span>&nbsp;<span class="ident" id="5011136">c</span><span class="op" id="5011137">.</span><span class="ident" id="5011138">width</span>&nbsp;<span class="op" id="5011144">&gt;</span>&nbsp;<span class="num" id="5011146">0</span>&nbsp;<span class="op" id="5011148">||</span>&nbsp;<span class="ident" id="5011151">c</span><span class="op" id="5011152">.</span><span class="ident" id="5011153">htab</span>&nbsp;<span class="op" id="5011158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011166">discardable</span>&nbsp;<span class="op" id="5011178">=</span>&nbsp;<span class="builtintype" id="5011180">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5011191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5011197">}</span>&nbsp;<span class="keyword" id="5011199">else</span>&nbsp;<span class="op" id="5011204">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5011211">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5011221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5011226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5011231">//&nbsp;column&nbsp;block&nbsp;end</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5011255">//&nbsp;discard&nbsp;empty&nbsp;columns&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5011296">if</span>&nbsp;<span class="ident" id="5011299">discardable</span>&nbsp;<span class="op" id="5011311">&amp;&amp;</span>&nbsp;<span class="ident" id="5011314">b</span><span class="op" id="5011315">.</span><span class="ident" id="5011316">flags</span><span class="op" id="5011321">&amp;</span><span class="ident" id="5011322">DiscardEmptyColumns</span>&nbsp;<span class="op" id="5011342">!=</span>&nbsp;<span class="num" id="5011345">0</span>&nbsp;<span class="op" id="5011347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011353">width</span>&nbsp;<span class="op" id="5011359">=</span>&nbsp;<span class="num" id="5011361">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5011366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5011372">//&nbsp;format&nbsp;and&nbsp;print&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;right&nbsp;of&nbsp;this&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5011435">//&nbsp;(we&nbsp;know&nbsp;the&nbsp;widths&nbsp;of&nbsp;this&nbsp;column&nbsp;and&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;left)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011505">b</span><span class="op" id="5011506">.</span><span class="ident" id="5011507">widths</span>&nbsp;<span class="op" id="5011514">=</span>&nbsp;<span class="builtinfunc" id="5011516">append</span><span class="op" id="5011522">(</span><span class="ident" id="5011523">b</span><span class="op" id="5011524">.</span><span class="ident" id="5011525">widths</span><span class="op" id="5011531">,</span>&nbsp;<span class="ident" id="5011533">width</span><span class="op" id="5011538">)</span>&nbsp;<span class="comment" id="5011540">//&nbsp;push&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011557">pos</span>&nbsp;<span class="op" id="5011561">=</span>&nbsp;<span class="ident" id="5011563">b</span><span class="op" id="5011564">.</span><span class="ident" id="5011565">format</span><span class="op" id="5011571">(</span><span class="ident" id="5011572">pos</span><span class="op" id="5011575">,</span>&nbsp;<span class="ident" id="5011577">line0</span><span class="op" id="5011582">,</span>&nbsp;<span class="ident" id="5011584">this</span><span class="op" id="5011588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011593">b</span><span class="op" id="5011594">.</span><span class="ident" id="5011595">widths</span>&nbsp;<span class="op" id="5011602">=</span>&nbsp;<span class="ident" id="5011604">b</span><span class="op" id="5011605">.</span><span class="ident" id="5011606">widths</span><span class="op" id="5011612">[</span><span class="num" id="5011613">0</span>&nbsp;<span class="op" id="5011615">:</span>&nbsp;<span class="builtinfunc" id="5011617">len</span><span class="op" id="5011620">(</span><span class="ident" id="5011621">b</span><span class="op" id="5011622">.</span><span class="ident" id="5011623">widths</span><span class="op" id="5011629">)</span><span class="op" id="5011630">-</span><span class="num" id="5011631">1</span><span class="op" id="5011632">]</span>&nbsp;<span class="comment" id="5011634">//&nbsp;pop&nbsp;width</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011650">line0</span>&nbsp;<span class="op" id="5011656">=</span>&nbsp;<span class="ident" id="5011658">this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5011665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5011668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5011672">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;end</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5011708">return</span>&nbsp;<span class="ident" id="5011715">b</span><span class="op" id="5011716">.</span><span class="ident" id="5011717">writeLines</span><span class="op" id="5011727">(</span><span class="ident" id="5011728">pos</span><span class="op" id="5011731">,</span>&nbsp;<span class="ident" id="5011733">line0</span><span class="op" id="5011738">,</span>&nbsp;<span class="ident" id="5011740">line1</span><span class="op" id="5011745">)</span><br>
<span class="lineno"></span><span class="op" id="5011747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5011750">//&nbsp;Append&nbsp;text&nbsp;to&nbsp;current&nbsp;cell.</span><br>
<span class="lineno"></span><span class="keyword" id="5011782">func</span>&nbsp;<span class="op" id="5011787">(</span><span class="ident" id="5011788">b</span>&nbsp;<span class="op" id="5011790">*</span><span class="ident" id="5011791">Writer</span><span class="op" id="5011797">)</span>&nbsp;<span class="builtinfunc" id="5011799">append</span><span class="op" id="5011805">(</span><span class="ident" id="5011806">text</span>&nbsp;<span class="op" id="5011811">[</span><span class="op" id="5011812">]</span><span class="builtintype" id="5011813">byte</span><span class="op" id="5011817">)</span>&nbsp;<span class="op" id="5011819">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011822">b</span><span class="op" id="5011823">.</span><span class="ident" id="5011824">buf</span><span class="op" id="5011827">.</span><span class="ident" id="5011828">Write</span><span class="op" id="5011833">(</span><span class="ident" id="5011834">text</span><span class="op" id="5011838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011841">b</span><span class="op" id="5011842">.</span><span class="ident" id="5011843">cell</span><span class="op" id="5011847">.</span><span class="ident" id="5011848">size</span>&nbsp;<span class="op" id="5011853">+=</span>&nbsp;<span class="builtinfunc" id="5011856">len</span><span class="op" id="5011859">(</span><span class="ident" id="5011860">text</span><span class="op" id="5011864">)</span><br>
<span class="lineno"></span><span class="op" id="5011866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5011869">//&nbsp;Update&nbsp;the&nbsp;cell&nbsp;width.</span><br>
<span class="lineno">380</span><span class="keyword" id="5011895">func</span>&nbsp;<span class="op" id="5011900">(</span><span class="ident" id="5011901">b</span>&nbsp;<span class="op" id="5011903">*</span><span class="ident" id="5011904">Writer</span><span class="op" id="5011910">)</span>&nbsp;<span class="ident" id="5011912">updateWidth</span><span class="op" id="5011923">(</span><span class="op" id="5011924">)</span>&nbsp;<span class="op" id="5011926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011929">b</span><span class="op" id="5011930">.</span><span class="ident" id="5011931">cell</span><span class="op" id="5011935">.</span><span class="ident" id="5011936">width</span>&nbsp;<span class="op" id="5011942">+=</span>&nbsp;<span class="ident" id="5011945">utf8</span><span class="op" id="5011949">.</span><span class="ident" id="5011950">RuneCount</span><span class="op" id="5011959">(</span><span class="ident" id="5011960">b</span><span class="op" id="5011961">.</span><span class="ident" id="5011962">buf</span><span class="op" id="5011965">.</span><span class="ident" id="5011966">Bytes</span><span class="op" id="5011971">(</span><span class="op" id="5011972">)</span><span class="op" id="5011973">[</span><span class="ident" id="5011974">b</span><span class="op" id="5011975">.</span><span class="ident" id="5011976">pos</span><span class="op" id="5011979">:</span><span class="ident" id="5011980">b</span><span class="op" id="5011981">.</span><span class="ident" id="5011982">buf</span><span class="op" id="5011985">.</span><span class="ident" id="5011986">Len</span><span class="op" id="5011989">(</span><span class="op" id="5011990">)</span><span class="op" id="5011991">]</span><span class="op" id="5011992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011995">b</span><span class="op" id="5011996">.</span><span class="ident" id="5011997">pos</span>&nbsp;<span class="op" id="5012001">=</span>&nbsp;<span class="ident" id="5012003">b</span><span class="op" id="5012004">.</span><span class="ident" id="5012005">buf</span><span class="op" id="5012008">.</span><span class="ident" id="5012009">Len</span><span class="op" id="5012012">(</span><span class="op" id="5012013">)</span><br>
<span class="lineno"></span><span class="op" id="5012015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="5012018">//&nbsp;To&nbsp;escape&nbsp;a&nbsp;text&nbsp;segment,&nbsp;bracket&nbsp;it&nbsp;with&nbsp;Escape&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="5012082">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;tab&nbsp;in&nbsp;this&nbsp;string&nbsp;&#34;Ignore&nbsp;this&nbsp;tab:&nbsp;\xff\t\xff&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5012152">//&nbsp;does&nbsp;not&nbsp;terminate&nbsp;a&nbsp;cell&nbsp;and&nbsp;constitutes&nbsp;a&nbsp;single&nbsp;character&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5012219">//&nbsp;width&nbsp;one&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="5012257">//</span><br>
<span class="lineno">390</span><span class="comment" id="5012260">//&nbsp;The&nbsp;value&nbsp;0xff&nbsp;was&nbsp;chosen&nbsp;because&nbsp;it&nbsp;cannot&nbsp;appear&nbsp;in&nbsp;a&nbsp;valid&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="5012341">//</span><br>
<span class="lineno"></span><span class="keyword" id="5012344">const</span>&nbsp;<span class="ident" id="5012350">Escape</span>&nbsp;<span class="op" id="5012357">=</span>&nbsp;<span class="string" id="5012359">&#39;\xff&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5012367">//&nbsp;Start&nbsp;escaped&nbsp;mode.</span><br>
<span class="lineno">395</span><span class="keyword" id="5012390">func</span>&nbsp;<span class="op" id="5012395">(</span><span class="ident" id="5012396">b</span>&nbsp;<span class="op" id="5012398">*</span><span class="ident" id="5012399">Writer</span><span class="op" id="5012405">)</span>&nbsp;<span class="ident" id="5012407">startEscape</span><span class="op" id="5012418">(</span><span class="ident" id="5012419">ch</span>&nbsp;<span class="builtintype" id="5012422">byte</span><span class="op" id="5012426">)</span>&nbsp;<span class="op" id="5012428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5012431">switch</span>&nbsp;<span class="ident" id="5012438">ch</span>&nbsp;<span class="op" id="5012441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5012444">case</span>&nbsp;<span class="ident" id="5012449">Escape</span><span class="op" id="5012455">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5012459">b</span><span class="op" id="5012460">.</span><span class="ident" id="5012461">endChar</span>&nbsp;<span class="op" id="5012469">=</span>&nbsp;<span class="ident" id="5012471">Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5012479">case</span>&nbsp;<span class="string" id="5012484">&#39;&lt;&#39;</span><span class="op" id="5012487">:</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5012491">b</span><span class="op" id="5012492">.</span><span class="ident" id="5012493">endChar</span>&nbsp;<span class="op" id="5012501">=</span>&nbsp;<span class="string" id="5012503">&#39;&gt;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5012508">case</span>&nbsp;<span class="string" id="5012513">&#39;&amp;&#39;</span><span class="op" id="5012516">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5012520">b</span><span class="op" id="5012521">.</span><span class="ident" id="5012522">endChar</span>&nbsp;<span class="op" id="5012530">=</span>&nbsp;<span class="string" id="5012532">&#39;;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5012537">}</span><br>
<span class="lineno"></span><span class="op" id="5012539">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="5012542">//&nbsp;Terminate&nbsp;escaped&nbsp;mode.&nbsp;If&nbsp;the&nbsp;escaped&nbsp;text&nbsp;was&nbsp;an&nbsp;HTML&nbsp;tag,&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="5012616">//&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;for&nbsp;formatting&nbsp;purposes;&nbsp;if&nbsp;it&nbsp;was&nbsp;an&nbsp;HTML&nbsp;entity,</span><br>
<span class="lineno"></span><span class="comment" id="5012692">//&nbsp;its&nbsp;width&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;one.&nbsp;In&nbsp;all&nbsp;other&nbsp;cases,&nbsp;the&nbsp;width&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5012764">//&nbsp;unicode&nbsp;width&nbsp;of&nbsp;the&nbsp;text.</span><br>
<span class="lineno">410</span><span class="comment" id="5012794">//</span><br>
<span class="lineno"></span><span class="keyword" id="5012797">func</span>&nbsp;<span class="op" id="5012802">(</span><span class="ident" id="5012803">b</span>&nbsp;<span class="op" id="5012805">*</span><span class="ident" id="5012806">Writer</span><span class="op" id="5012812">)</span>&nbsp;<span class="ident" id="5012814">endEscape</span><span class="op" id="5012823">(</span><span class="op" id="5012824">)</span>&nbsp;<span class="op" id="5012826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5012829">switch</span>&nbsp;<span class="ident" id="5012836">b</span><span class="op" id="5012837">.</span><span class="ident" id="5012838">endChar</span>&nbsp;<span class="op" id="5012846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5012849">case</span>&nbsp;<span class="ident" id="5012854">Escape</span><span class="op" id="5012860">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5012864">b</span><span class="op" id="5012865">.</span><span class="ident" id="5012866">updateWidth</span><span class="op" id="5012877">(</span><span class="op" id="5012878">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5012882">if</span>&nbsp;<span class="ident" id="5012885">b</span><span class="op" id="5012886">.</span><span class="ident" id="5012887">flags</span><span class="op" id="5012892">&amp;</span><span class="ident" id="5012893">StripEscape</span>&nbsp;<span class="op" id="5012905">==</span>&nbsp;<span class="num" id="5012908">0</span>&nbsp;<span class="op" id="5012910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5012915">b</span><span class="op" id="5012916">.</span><span class="ident" id="5012917">cell</span><span class="op" id="5012921">.</span><span class="ident" id="5012922">width</span>&nbsp;<span class="op" id="5012928">-=</span>&nbsp;<span class="num" id="5012931">2</span>&nbsp;<span class="comment" id="5012933">//&nbsp;don&#39;t&nbsp;count&nbsp;the&nbsp;Escape&nbsp;chars</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5012967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5012970">case</span>&nbsp;<span class="string" id="5012975">&#39;&gt;&#39;</span><span class="op" id="5012978">:</span>&nbsp;<span class="comment" id="5012980">//&nbsp;tag&nbsp;of&nbsp;zero&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5013002">case</span>&nbsp;<span class="string" id="5013007">&#39;;&#39;</span><span class="op" id="5013010">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013014">b</span><span class="op" id="5013015">.</span><span class="ident" id="5013016">cell</span><span class="op" id="5013020">.</span><span class="ident" id="5013021">width</span><span class="op" id="5013026">++</span>&nbsp;<span class="comment" id="5013029">//&nbsp;entity,&nbsp;count&nbsp;as&nbsp;one&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013062">b</span><span class="op" id="5013063">.</span><span class="ident" id="5013064">pos</span>&nbsp;<span class="op" id="5013068">=</span>&nbsp;<span class="ident" id="5013070">b</span><span class="op" id="5013071">.</span><span class="ident" id="5013072">buf</span><span class="op" id="5013075">.</span><span class="ident" id="5013076">Len</span><span class="op" id="5013079">(</span><span class="op" id="5013080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013083">b</span><span class="op" id="5013084">.</span><span class="ident" id="5013085">endChar</span>&nbsp;<span class="op" id="5013093">=</span>&nbsp;<span class="num" id="5013095">0</span><br>
<span class="lineno"></span><span class="op" id="5013097">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="comment" id="5013100">//&nbsp;Terminate&nbsp;the&nbsp;current&nbsp;cell&nbsp;by&nbsp;adding&nbsp;it&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;cells&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5013171">//&nbsp;current&nbsp;line.&nbsp;Returns&nbsp;the&nbsp;number&nbsp;of&nbsp;cells&nbsp;in&nbsp;that&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="5013230">//</span><br>
<span class="lineno"></span><span class="keyword" id="5013233">func</span>&nbsp;<span class="op" id="5013238">(</span><span class="ident" id="5013239">b</span>&nbsp;<span class="op" id="5013241">*</span><span class="ident" id="5013242">Writer</span><span class="op" id="5013248">)</span>&nbsp;<span class="ident" id="5013250">terminateCell</span><span class="op" id="5013263">(</span><span class="ident" id="5013264">htab</span>&nbsp;<span class="builtintype" id="5013269">bool</span><span class="op" id="5013273">)</span>&nbsp;<span class="builtintype" id="5013275">int</span>&nbsp;<span class="op" id="5013279">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013282">b</span><span class="op" id="5013283">.</span><span class="ident" id="5013284">cell</span><span class="op" id="5013288">.</span><span class="ident" id="5013289">htab</span>&nbsp;<span class="op" id="5013294">=</span>&nbsp;<span class="ident" id="5013296">htab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013302">line</span>&nbsp;<span class="op" id="5013307">:=</span>&nbsp;<span class="op" id="5013310">&amp;</span><span class="ident" id="5013311">b</span><span class="op" id="5013312">.</span><span class="ident" id="5013313">lines</span><span class="op" id="5013318">[</span><span class="builtinfunc" id="5013319">len</span><span class="op" id="5013322">(</span><span class="ident" id="5013323">b</span><span class="op" id="5013324">.</span><span class="ident" id="5013325">lines</span><span class="op" id="5013330">)</span><span class="op" id="5013331">-</span><span class="num" id="5013332">1</span><span class="op" id="5013333">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013336">*</span><span class="ident" id="5013337">line</span>&nbsp;<span class="op" id="5013342">=</span>&nbsp;<span class="builtinfunc" id="5013344">append</span><span class="op" id="5013350">(</span><span class="op" id="5013351">*</span><span class="ident" id="5013352">line</span><span class="op" id="5013356">,</span>&nbsp;<span class="ident" id="5013358">b</span><span class="op" id="5013359">.</span><span class="ident" id="5013360">cell</span><span class="op" id="5013364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013367">b</span><span class="op" id="5013368">.</span><span class="ident" id="5013369">cell</span>&nbsp;<span class="op" id="5013374">=</span>&nbsp;<span class="ident" id="5013376">cell</span><span class="op" id="5013380">{</span><span class="op" id="5013381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5013384">return</span>&nbsp;<span class="builtinfunc" id="5013391">len</span><span class="op" id="5013394">(</span><span class="op" id="5013395">*</span><span class="ident" id="5013396">line</span><span class="op" id="5013400">)</span><br>
<span class="lineno">435</span><span class="op" id="5013402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5013405">func</span>&nbsp;<span class="ident" id="5013410">handlePanic</span><span class="op" id="5013421">(</span><span class="ident" id="5013422">err</span>&nbsp;<span class="op" id="5013426">*</span><span class="builtintype" id="5013427">error</span><span class="op" id="5013432">,</span>&nbsp;<span class="ident" id="5013434">op</span>&nbsp;<span class="builtintype" id="5013437">string</span><span class="op" id="5013443">)</span>&nbsp;<span class="op" id="5013445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5013448">if</span>&nbsp;<span class="ident" id="5013451">e</span>&nbsp;<span class="op" id="5013453">:=</span>&nbsp;<span class="builtinfunc" id="5013456">recover</span><span class="op" id="5013463">(</span><span class="op" id="5013464">)</span><span class="op" id="5013465">;</span>&nbsp;<span class="ident" id="5013467">e</span>&nbsp;<span class="op" id="5013469">!=</span>&nbsp;<span class="builtintype" id="5013472">nil</span>&nbsp;<span class="op" id="5013476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5013480">if</span>&nbsp;<span class="ident" id="5013483">nerr</span><span class="op" id="5013487">,</span>&nbsp;<span class="ident" id="5013489">ok</span>&nbsp;<span class="op" id="5013492">:=</span>&nbsp;<span class="ident" id="5013495">e</span><span class="op" id="5013496">.</span><span class="op" id="5013497">(</span><span class="ident" id="5013498">osError</span><span class="op" id="5013505">)</span><span class="op" id="5013506">;</span>&nbsp;<span class="ident" id="5013508">ok</span>&nbsp;<span class="op" id="5013511">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013516">*</span><span class="ident" id="5013517">err</span>&nbsp;<span class="op" id="5013521">=</span>&nbsp;<span class="ident" id="5013523">nerr</span><span class="op" id="5013527">.</span><span class="ident" id="5013528">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5013535">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5013548">panic</span><span class="op" id="5013553">(</span><span class="string" id="5013554">&#34;tabwriter:&nbsp;panic&nbsp;during&nbsp;&#34;</span>&nbsp;<span class="op" id="5013581">+</span>&nbsp;<span class="ident" id="5013583">op</span><span class="op" id="5013585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013588">}</span><br>
<span class="lineno">445</span><span class="op" id="5013590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5013593">//&nbsp;Flush&nbsp;should&nbsp;be&nbsp;called&nbsp;after&nbsp;the&nbsp;last&nbsp;call&nbsp;to&nbsp;Write&nbsp;to&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="5013658">//&nbsp;that&nbsp;any&nbsp;data&nbsp;buffered&nbsp;in&nbsp;the&nbsp;Writer&nbsp;is&nbsp;written&nbsp;to&nbsp;output.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="5013724">//&nbsp;incomplete&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;end&nbsp;is&nbsp;considered</span><br>
<span class="lineno">450</span><span class="comment" id="5013779">//&nbsp;complete&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="5013816">//</span><br>
<span class="lineno"></span><span class="keyword" id="5013819">func</span>&nbsp;<span class="op" id="5013824">(</span><span class="ident" id="5013825">b</span>&nbsp;<span class="op" id="5013827">*</span><span class="ident" id="5013828">Writer</span><span class="op" id="5013834">)</span>&nbsp;<span class="ident" id="5013836">Flush</span><span class="op" id="5013841">(</span><span class="op" id="5013842">)</span>&nbsp;<span class="op" id="5013844">(</span><span class="ident" id="5013845">err</span>&nbsp;<span class="builtintype" id="5013849">error</span><span class="op" id="5013854">)</span>&nbsp;<span class="op" id="5013856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5013859">defer</span>&nbsp;<span class="ident" id="5013865">b</span><span class="op" id="5013866">.</span><span class="ident" id="5013867">reset</span><span class="op" id="5013872">(</span><span class="op" id="5013873">)</span>&nbsp;<span class="comment" id="5013875">//&nbsp;even&nbsp;in&nbsp;the&nbsp;presence&nbsp;of&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5013910">defer</span>&nbsp;<span class="ident" id="5013916">handlePanic</span><span class="op" id="5013927">(</span><span class="op" id="5013928">&amp;</span><span class="ident" id="5013929">err</span><span class="op" id="5013932">,</span>&nbsp;<span class="string" id="5013934">&#34;Flush&#34;</span><span class="op" id="5013941">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5013945">//&nbsp;add&nbsp;current&nbsp;cell&nbsp;if&nbsp;not&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5013979">if</span>&nbsp;<span class="ident" id="5013982">b</span><span class="op" id="5013983">.</span><span class="ident" id="5013984">cell</span><span class="op" id="5013988">.</span><span class="ident" id="5013989">size</span>&nbsp;<span class="op" id="5013994">&gt;</span>&nbsp;<span class="num" id="5013996">0</span>&nbsp;<span class="op" id="5013998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5014002">if</span>&nbsp;<span class="ident" id="5014005">b</span><span class="op" id="5014006">.</span><span class="ident" id="5014007">endChar</span>&nbsp;<span class="op" id="5014015">!=</span>&nbsp;<span class="num" id="5014018">0</span>&nbsp;<span class="op" id="5014020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5014025">//&nbsp;inside&nbsp;escape&nbsp;-&nbsp;terminate&nbsp;it&nbsp;even&nbsp;if&nbsp;incomplete</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014079">b</span><span class="op" id="5014080">.</span><span class="ident" id="5014081">endEscape</span><span class="op" id="5014090">(</span><span class="op" id="5014091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5014095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014099">b</span><span class="op" id="5014100">.</span><span class="ident" id="5014101">terminateCell</span><span class="op" id="5014114">(</span><span class="builtintype" id="5014115">false</span><span class="op" id="5014120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5014123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5014127">//&nbsp;format&nbsp;contents&nbsp;of&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014157">b</span><span class="op" id="5014158">.</span><span class="ident" id="5014159">format</span><span class="op" id="5014165">(</span><span class="num" id="5014166">0</span><span class="op" id="5014167">,</span>&nbsp;<span class="num" id="5014169">0</span><span class="op" id="5014170">,</span>&nbsp;<span class="builtinfunc" id="5014172">len</span><span class="op" id="5014175">(</span><span class="ident" id="5014176">b</span><span class="op" id="5014177">.</span><span class="ident" id="5014178">lines</span><span class="op" id="5014183">)</span><span class="op" id="5014184">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5014188">return</span><br>
<span class="lineno"></span><span class="op" id="5014195">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="5014198">var</span>&nbsp;<span class="ident" id="5014202">hbar</span>&nbsp;<span class="op" id="5014207">=</span>&nbsp;<span class="op" id="5014209">[</span><span class="op" id="5014210">]</span><span class="builtintype" id="5014211">byte</span><span class="op" id="5014215">(</span><span class="string" id="5014216">&#34;---\n&#34;</span><span class="op" id="5014223">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5014226">//&nbsp;Write&nbsp;writes&nbsp;buf&nbsp;to&nbsp;the&nbsp;writer&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="5014263">//&nbsp;The&nbsp;only&nbsp;errors&nbsp;returned&nbsp;are&nbsp;ones&nbsp;encountered</span><br>
<span class="lineno">475</span><span class="comment" id="5014312">//&nbsp;while&nbsp;writing&nbsp;to&nbsp;the&nbsp;underlying&nbsp;output&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="5014362">//</span><br>
<span class="lineno"></span><span class="keyword" id="5014365">func</span>&nbsp;<span class="op" id="5014370">(</span><span class="ident" id="5014371">b</span>&nbsp;<span class="op" id="5014373">*</span><span class="ident" id="5014374">Writer</span><span class="op" id="5014380">)</span>&nbsp;<span class="ident" id="5014382">Write</span><span class="op" id="5014387">(</span><span class="ident" id="5014388">buf</span>&nbsp;<span class="op" id="5014392">[</span><span class="op" id="5014393">]</span><span class="builtintype" id="5014394">byte</span><span class="op" id="5014398">)</span>&nbsp;<span class="op" id="5014400">(</span><span class="ident" id="5014401">n</span>&nbsp;<span class="builtintype" id="5014403">int</span><span class="op" id="5014406">,</span>&nbsp;<span class="ident" id="5014408">err</span>&nbsp;<span class="builtintype" id="5014412">error</span><span class="op" id="5014417">)</span>&nbsp;<span class="op" id="5014419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5014422">defer</span>&nbsp;<span class="ident" id="5014428">handlePanic</span><span class="op" id="5014439">(</span><span class="op" id="5014440">&amp;</span><span class="ident" id="5014441">err</span><span class="op" id="5014444">,</span>&nbsp;<span class="string" id="5014446">&#34;Write&#34;</span><span class="op" id="5014453">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5014457">//&nbsp;split&nbsp;text&nbsp;into&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014483">n</span>&nbsp;<span class="op" id="5014485">=</span>&nbsp;<span class="num" id="5014487">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5014490">for</span>&nbsp;<span class="ident" id="5014494">i</span><span class="op" id="5014495">,</span>&nbsp;<span class="ident" id="5014497">ch</span>&nbsp;<span class="op" id="5014500">:=</span>&nbsp;<span class="keyword" id="5014503">range</span>&nbsp;<span class="ident" id="5014509">buf</span>&nbsp;<span class="op" id="5014513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5014517">if</span>&nbsp;<span class="ident" id="5014520">b</span><span class="op" id="5014521">.</span><span class="ident" id="5014522">endChar</span>&nbsp;<span class="op" id="5014530">==</span>&nbsp;<span class="num" id="5014533">0</span>&nbsp;<span class="op" id="5014535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5014540">//&nbsp;outside&nbsp;escape</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5014561">switch</span>&nbsp;<span class="ident" id="5014568">ch</span>&nbsp;<span class="op" id="5014571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5014576">case</span>&nbsp;<span class="string" id="5014581">&#39;\t&#39;</span><span class="op" id="5014585">,</span>&nbsp;<span class="string" id="5014587">&#39;\v&#39;</span><span class="op" id="5014591">,</span>&nbsp;<span class="string" id="5014593">&#39;\n&#39;</span><span class="op" id="5014597">,</span>&nbsp;<span class="string" id="5014599">&#39;\f&#39;</span><span class="op" id="5014603">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5014609">//&nbsp;end&nbsp;of&nbsp;cell</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014628">b</span><span class="op" id="5014629">.</span><span class="builtinfunc" id="5014630">append</span><span class="op" id="5014636">(</span><span class="ident" id="5014637">buf</span><span class="op" id="5014640">[</span><span class="ident" id="5014641">n</span><span class="op" id="5014642">:</span><span class="ident" id="5014643">i</span><span class="op" id="5014644">]</span><span class="op" id="5014645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014651">b</span><span class="op" id="5014652">.</span><span class="ident" id="5014653">updateWidth</span><span class="op" id="5014664">(</span><span class="op" id="5014665">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014671">n</span>&nbsp;<span class="op" id="5014673">=</span>&nbsp;<span class="ident" id="5014675">i</span>&nbsp;<span class="op" id="5014677">+</span>&nbsp;<span class="num" id="5014679">1</span>&nbsp;<span class="comment" id="5014681">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014700">ncells</span>&nbsp;<span class="op" id="5014707">:=</span>&nbsp;<span class="ident" id="5014710">b</span><span class="op" id="5014711">.</span><span class="ident" id="5014712">terminateCell</span><span class="op" id="5014725">(</span><span class="ident" id="5014726">ch</span>&nbsp;<span class="op" id="5014729">==</span>&nbsp;<span class="string" id="5014732">&#39;\t&#39;</span><span class="op" id="5014736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5014742">if</span>&nbsp;<span class="ident" id="5014745">ch</span>&nbsp;<span class="op" id="5014748">==</span>&nbsp;<span class="string" id="5014751">&#39;\n&#39;</span>&nbsp;<span class="op" id="5014756">||</span>&nbsp;<span class="ident" id="5014759">ch</span>&nbsp;<span class="op" id="5014762">==</span>&nbsp;<span class="string" id="5014765">&#39;\f&#39;</span>&nbsp;<span class="op" id="5014770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5014777">//&nbsp;terminate&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014800">b</span><span class="op" id="5014801">.</span><span class="ident" id="5014802">addLine</span><span class="op" id="5014809">(</span><span class="op" id="5014810">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5014817">if</span>&nbsp;<span class="ident" id="5014820">ch</span>&nbsp;<span class="op" id="5014823">==</span>&nbsp;<span class="string" id="5014826">&#39;\f&#39;</span>&nbsp;<span class="op" id="5014831">||</span>&nbsp;<span class="ident" id="5014834">ncells</span>&nbsp;<span class="op" id="5014841">==</span>&nbsp;<span class="num" id="5014844">1</span>&nbsp;<span class="op" id="5014846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5014854">//&nbsp;A&nbsp;&#39;\f&#39;&nbsp;always&nbsp;forces&nbsp;a&nbsp;flush.&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;previous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5014920">//&nbsp;line&nbsp;has&nbsp;only&nbsp;one&nbsp;cell&nbsp;which&nbsp;does&nbsp;not&nbsp;have&nbsp;an&nbsp;impact&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5014985">//&nbsp;the&nbsp;formatting&nbsp;of&nbsp;the&nbsp;following&nbsp;lines&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5015051">//&nbsp;line&nbsp;is&nbsp;ignored&nbsp;by&nbsp;format()),&nbsp;thus&nbsp;we&nbsp;can&nbsp;flush&nbsp;the</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5015112">//&nbsp;Writer&nbsp;contents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5015138">if</span>&nbsp;<span class="ident" id="5015141">err</span>&nbsp;<span class="op" id="5015145">=</span>&nbsp;<span class="ident" id="5015147">b</span><span class="op" id="5015148">.</span><span class="ident" id="5015149">Flush</span><span class="op" id="5015154">(</span><span class="op" id="5015155">)</span><span class="op" id="5015156">;</span>&nbsp;<span class="ident" id="5015158">err</span>&nbsp;<span class="op" id="5015162">!=</span>&nbsp;<span class="builtintype" id="5015165">nil</span>&nbsp;<span class="op" id="5015169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5015178">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5015191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5015199">if</span>&nbsp;<span class="ident" id="5015202">ch</span>&nbsp;<span class="op" id="5015205">==</span>&nbsp;<span class="string" id="5015208">&#39;\f&#39;</span>&nbsp;<span class="op" id="5015213">&amp;&amp;</span>&nbsp;<span class="ident" id="5015216">b</span><span class="op" id="5015217">.</span><span class="ident" id="5015218">flags</span><span class="op" id="5015223">&amp;</span><span class="ident" id="5015224">Debug</span>&nbsp;<span class="op" id="5015230">!=</span>&nbsp;<span class="num" id="5015233">0</span>&nbsp;<span class="op" id="5015235">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5015244">//&nbsp;indicate&nbsp;section&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5015277">b</span><span class="op" id="5015278">.</span><span class="ident" id="5015279">write0</span><span class="op" id="5015285">(</span><span class="ident" id="5015286">hbar</span><span class="op" id="5015290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5015298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5015305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5015311">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5015317">case</span>&nbsp;<span class="ident" id="5015322">Escape</span><span class="op" id="5015328">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5015334">//&nbsp;start&nbsp;of&nbsp;escaped&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5015367">b</span><span class="op" id="5015368">.</span><span class="builtinfunc" id="5015369">append</span><span class="op" id="5015375">(</span><span class="ident" id="5015376">buf</span><span class="op" id="5015379">[</span><span class="ident" id="5015380">n</span><span class="op" id="5015381">:</span><span class="ident" id="5015382">i</span><span class="op" id="5015383">]</span><span class="op" id="5015384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5015390">b</span><span class="op" id="5015391">.</span><span class="ident" id="5015392">updateWidth</span><span class="op" id="5015403">(</span><span class="op" id="5015404">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5015410">n</span>&nbsp;<span class="op" id="5015412">=</span>&nbsp;<span class="ident" id="5015414">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5015420">if</span>&nbsp;<span class="ident" id="5015423">b</span><span class="op" id="5015424">.</span><span class="ident" id="5015425">flags</span><span class="op" id="5015430">&amp;</span><span class="ident" id="5015431">StripEscape</span>&nbsp;<span class="op" id="5015443">!=</span>&nbsp;<span class="num" id="5015446">0</span>&nbsp;<span class="op" id="5015448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5015455">n</span><span class="op" id="5015456">++</span>&nbsp;<span class="comment" id="5015459">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5015479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5015485">b</span><span class="op" id="5015486">.</span><span class="ident" id="5015487">startEscape</span><span class="op" id="5015498">(</span><span class="ident" id="5015499">Escape</span><span class="op" id="5015505">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5015511">case</span>&nbsp;<span class="string" id="5015516">&#39;&lt;&#39;</span><span class="op" id="5015519">,</span>&nbsp;<span class="string" id="5015521">&#39;&amp;&#39;</span><span class="op" id="5015524">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5015530">//&nbsp;possibly&nbsp;an&nbsp;html&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5015565">if</span>&nbsp;<span class="ident" id="5015568">b</span><span class="op" id="5015569">.</span><span class="ident" id="5015570">flags</span><span class="op" id="5015575">&amp;</span><span class="ident" id="5015576">FilterHTML</span>&nbsp;<span class="op" id="5015587">!=</span>&nbsp;<span class="num" id="5015590">0</span>&nbsp;<span class="op" id="5015592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5015599">//&nbsp;begin&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5015627">b</span><span class="op" id="5015628">.</span><span class="builtinfunc" id="5015629">append</span><span class="op" id="5015635">(</span><span class="ident" id="5015636">buf</span><span class="op" id="5015639">[</span><span class="ident" id="5015640">n</span><span class="op" id="5015641">:</span><span class="ident" id="5015642">i</span><span class="op" id="5015643">]</span><span class="op" id="5015644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5015651">b</span><span class="op" id="5015652">.</span><span class="ident" id="5015653">updateWidth</span><span class="op" id="5015664">(</span><span class="op" id="5015665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5015672">n</span>&nbsp;<span class="op" id="5015674">=</span>&nbsp;<span class="ident" id="5015676">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5015683">b</span><span class="op" id="5015684">.</span><span class="ident" id="5015685">startEscape</span><span class="op" id="5015696">(</span><span class="ident" id="5015697">ch</span><span class="op" id="5015699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5015705">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5015710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5015715">}</span>&nbsp;<span class="keyword" id="5015717">else</span>&nbsp;<span class="op" id="5015722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5015727">//&nbsp;inside&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5015747">if</span>&nbsp;<span class="ident" id="5015750">ch</span>&nbsp;<span class="op" id="5015753">==</span>&nbsp;<span class="ident" id="5015756">b</span><span class="op" id="5015757">.</span><span class="ident" id="5015758">endChar</span>&nbsp;<span class="op" id="5015766">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5015772">//&nbsp;end&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5015797">j</span>&nbsp;<span class="op" id="5015799">:=</span>&nbsp;<span class="ident" id="5015802">i</span>&nbsp;<span class="op" id="5015804">+</span>&nbsp;<span class="num" id="5015806">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5015812">if</span>&nbsp;<span class="ident" id="5015815">ch</span>&nbsp;<span class="op" id="5015818">==</span>&nbsp;<span class="ident" id="5015821">Escape</span>&nbsp;<span class="op" id="5015828">&amp;&amp;</span>&nbsp;<span class="ident" id="5015831">b</span><span class="op" id="5015832">.</span><span class="ident" id="5015833">flags</span><span class="op" id="5015838">&amp;</span><span class="ident" id="5015839">StripEscape</span>&nbsp;<span class="op" id="5015851">!=</span>&nbsp;<span class="num" id="5015854">0</span>&nbsp;<span class="op" id="5015856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5015863">j</span>&nbsp;<span class="op" id="5015865">=</span>&nbsp;<span class="ident" id="5015867">i</span>&nbsp;<span class="comment" id="5015869">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5015889">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5015895">b</span><span class="op" id="5015896">.</span><span class="builtinfunc" id="5015897">append</span><span class="op" id="5015903">(</span><span class="ident" id="5015904">buf</span><span class="op" id="5015907">[</span><span class="ident" id="5015908">n</span><span class="op" id="5015909">:</span><span class="ident" id="5015910">j</span><span class="op" id="5015911">]</span><span class="op" id="5015912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5015918">n</span>&nbsp;<span class="op" id="5015920">=</span>&nbsp;<span class="ident" id="5015922">i</span>&nbsp;<span class="op" id="5015924">+</span>&nbsp;<span class="num" id="5015926">1</span>&nbsp;<span class="comment" id="5015928">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5015947">b</span><span class="op" id="5015948">.</span><span class="ident" id="5015949">endEscape</span><span class="op" id="5015958">(</span><span class="op" id="5015959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5015964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5015968">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5015971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5015975">//&nbsp;append&nbsp;leftover&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5016000">b</span><span class="op" id="5016001">.</span><span class="builtinfunc" id="5016002">append</span><span class="op" id="5016008">(</span><span class="ident" id="5016009">buf</span><span class="op" id="5016012">[</span><span class="ident" id="5016013">n</span><span class="op" id="5016014">:</span><span class="op" id="5016015">]</span><span class="op" id="5016016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5016019">n</span>&nbsp;<span class="op" id="5016021">=</span>&nbsp;<span class="builtinfunc" id="5016023">len</span><span class="op" id="5016026">(</span><span class="ident" id="5016027">buf</span><span class="op" id="5016030">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5016033">return</span><br>
<span class="lineno"></span><span class="op" id="5016040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5016043">//&nbsp;NewWriter&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;tabwriter.Writer.</span><br>
<span class="lineno"></span><span class="comment" id="5016106">//&nbsp;The&nbsp;parameters&nbsp;are&nbsp;the&nbsp;same&nbsp;as&nbsp;for&nbsp;the&nbsp;Init&nbsp;function.</span><br>
<span class="lineno">555</span><span class="comment" id="5016163">//</span><br>
<span class="lineno"></span><span class="keyword" id="5016166">func</span>&nbsp;<span class="ident" id="5016171">NewWriter</span><span class="op" id="5016180">(</span><span class="ident" id="5016181">output</span>&nbsp;<span class="ident" id="5016188">io</span><span class="op" id="5016190">.</span><span class="ident" id="5016191">Writer</span><span class="op" id="5016197">,</span>&nbsp;<span class="ident" id="5016199">minwidth</span><span class="op" id="5016207">,</span>&nbsp;<span class="ident" id="5016209">tabwidth</span><span class="op" id="5016217">,</span>&nbsp;<span class="ident" id="5016219">padding</span>&nbsp;<span class="builtintype" id="5016227">int</span><span class="op" id="5016230">,</span>&nbsp;<span class="ident" id="5016232">padchar</span>&nbsp;<span class="builtintype" id="5016240">byte</span><span class="op" id="5016244">,</span>&nbsp;<span class="ident" id="5016246">flags</span>&nbsp;<span class="builtintype" id="5016252">uint</span><span class="op" id="5016256">)</span>&nbsp;<span class="op" id="5016258">*</span><span class="ident" id="5016259">Writer</span>&nbsp;<span class="op" id="5016266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5016269">return</span>&nbsp;<span class="builtinfunc" id="5016276">new</span><span class="op" id="5016279">(</span><span class="ident" id="5016280">Writer</span><span class="op" id="5016286">)</span><span class="op" id="5016287">.</span><span class="ident" id="5016288">Init</span><span class="op" id="5016292">(</span><span class="ident" id="5016293">output</span><span class="op" id="5016299">,</span>&nbsp;<span class="ident" id="5016301">minwidth</span><span class="op" id="5016309">,</span>&nbsp;<span class="ident" id="5016311">tabwidth</span><span class="op" id="5016319">,</span>&nbsp;<span class="ident" id="5016321">padding</span><span class="op" id="5016328">,</span>&nbsp;<span class="ident" id="5016330">padchar</span><span class="op" id="5016337">,</span>&nbsp;<span class="ident" id="5016339">flags</span><span class="op" id="5016344">)</span><br>
<span class="lineno"></span><span class="op" id="5016346">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
