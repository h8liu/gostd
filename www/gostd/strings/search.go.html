<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strings</h2>
<ul>
<li><a href="/gostd/strings/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/strings/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/strings/reader.go.html">reader.go</a></li>
<li><a href="/gostd/strings/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/strings/replace.go.html">replace.go</a></li>
<li><a href="/gostd/strings/replace_test.go.html">replace_test.go</a></li>
<li><a href="/gostd/strings/search.go.html" class="current">search.go</a></li>
<li><a href="/gostd/strings/search_test.go.html">search_test.go</a></li>
<li><a href="/gostd/strings/strings.go.html">strings.go</a></li>
<li><a href="/gostd/strings/strings_decl.go.html">strings_decl.go</a></li>
<li><a href="/gostd/strings/strings_test.go.html">strings_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2896809">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2896864">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2896918">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2896969">package</span>&nbsp;<span class="ident" id="2896977">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2896986">//&nbsp;stringFinder&nbsp;efficiently&nbsp;finds&nbsp;strings&nbsp;in&nbsp;a&nbsp;source&nbsp;text.&nbsp;It&#39;s&nbsp;implemented</span><br>
<span class="lineno"></span><span class="comment" id="2897063">//&nbsp;using&nbsp;the&nbsp;Boyer-Moore&nbsp;string&nbsp;search&nbsp;algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2897113">//&nbsp;http://en.wikipedia.org/wiki/Boyer-Moore_string_search_algorithm</span><br>
<span class="lineno">10</span><span class="comment" id="2897181">//&nbsp;http://www.cs.utexas.edu/~moore/publications/fstrpos.pdf&nbsp;(note:&nbsp;this&nbsp;aged</span><br>
<span class="lineno"></span><span class="comment" id="2897258">//&nbsp;document&nbsp;uses&nbsp;1-based&nbsp;indexing)</span><br>
<span class="lineno"></span><span class="keyword" id="2897293">type</span>&nbsp;<span class="ident" id="2897298">stringFinder</span>&nbsp;<span class="keyword" id="2897311">struct</span>&nbsp;<span class="op" id="2897318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2897321">//&nbsp;pattern&nbsp;is&nbsp;the&nbsp;string&nbsp;that&nbsp;we&nbsp;are&nbsp;searching&nbsp;for&nbsp;in&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2897386">pattern</span>&nbsp;<span class="builtintype" id="2897394">string</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2897403">//&nbsp;badCharSkip[b]&nbsp;contains&nbsp;the&nbsp;distance&nbsp;between&nbsp;the&nbsp;last&nbsp;byte&nbsp;of&nbsp;pattern</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2897477">//&nbsp;and&nbsp;the&nbsp;rightmost&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;pattern.&nbsp;If&nbsp;b&nbsp;is&nbsp;not&nbsp;in&nbsp;pattern,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2897551">//&nbsp;badCharSkip[b]&nbsp;is&nbsp;len(pattern).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2897587">//</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2897591">//&nbsp;Whenever&nbsp;a&nbsp;mismatch&nbsp;is&nbsp;found&nbsp;with&nbsp;byte&nbsp;b&nbsp;in&nbsp;the&nbsp;text,&nbsp;we&nbsp;can&nbsp;safely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2897663">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;at&nbsp;least&nbsp;badCharSkip[b]&nbsp;until&nbsp;the&nbsp;next&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2897736">//&nbsp;the&nbsp;matching&nbsp;char&nbsp;could&nbsp;be&nbsp;in&nbsp;alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2897781">badCharSkip</span>&nbsp;<span class="op" id="2897793">[</span><span class="num" id="2897794">256</span><span class="op" id="2897797">]</span><span class="builtintype" id="2897798">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2897804">//&nbsp;goodSuffixSkip[i]&nbsp;defines&nbsp;how&nbsp;far&nbsp;we&nbsp;can&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2897880">//&nbsp;that&nbsp;the&nbsp;suffix&nbsp;pattern[i+1:]&nbsp;matches,&nbsp;but&nbsp;the&nbsp;byte&nbsp;pattern[i]&nbsp;does</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2897952">//&nbsp;not.&nbsp;There&nbsp;are&nbsp;two&nbsp;cases&nbsp;to&nbsp;consider:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2897994">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2897998">//&nbsp;1.&nbsp;The&nbsp;matched&nbsp;suffix&nbsp;occurs&nbsp;elsewhere&nbsp;in&nbsp;pattern&nbsp;(with&nbsp;a&nbsp;different</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2898070">//&nbsp;byte&nbsp;preceding&nbsp;it&nbsp;that&nbsp;we&nbsp;might&nbsp;possibly&nbsp;match).&nbsp;In&nbsp;this&nbsp;case,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2898144">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;to&nbsp;align&nbsp;with&nbsp;the&nbsp;next&nbsp;suffix&nbsp;chunk.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2898214">//&nbsp;example,&nbsp;the&nbsp;pattern&nbsp;&#34;mississi&#34;&nbsp;has&nbsp;the&nbsp;suffix&nbsp;&#34;issi&#34;&nbsp;next&nbsp;occurring</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2898287">//&nbsp;(in&nbsp;right-to-left&nbsp;order)&nbsp;at&nbsp;index&nbsp;1,&nbsp;so&nbsp;goodSuffixSkip[3]&nbsp;==</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2898352">//&nbsp;shift+len(suffix)&nbsp;==&nbsp;3+4&nbsp;==&nbsp;7.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2898387">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2898391">//&nbsp;2.&nbsp;If&nbsp;the&nbsp;matched&nbsp;suffix&nbsp;does&nbsp;not&nbsp;occur&nbsp;elsewhere&nbsp;in&nbsp;pattern,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2898466">//&nbsp;matching&nbsp;frame&nbsp;may&nbsp;share&nbsp;part&nbsp;of&nbsp;its&nbsp;prefix&nbsp;with&nbsp;the&nbsp;end&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2898534">//&nbsp;matching&nbsp;suffix.&nbsp;In&nbsp;this&nbsp;case,&nbsp;goodSuffixSkip[i]&nbsp;will&nbsp;contain&nbsp;how&nbsp;far</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2898608">//&nbsp;to&nbsp;shift&nbsp;the&nbsp;frame&nbsp;to&nbsp;align&nbsp;this&nbsp;portion&nbsp;of&nbsp;the&nbsp;prefix&nbsp;to&nbsp;the</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2898674">//&nbsp;suffix.&nbsp;For&nbsp;example,&nbsp;in&nbsp;the&nbsp;pattern&nbsp;&#34;abcxxxabc&#34;,&nbsp;when&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2898742">//&nbsp;mismatch&nbsp;from&nbsp;the&nbsp;back&nbsp;is&nbsp;found&nbsp;to&nbsp;be&nbsp;in&nbsp;position&nbsp;3,&nbsp;the&nbsp;matching</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2898812">//&nbsp;suffix&nbsp;&#34;xxabc&#34;&nbsp;is&nbsp;not&nbsp;found&nbsp;elsewhere&nbsp;in&nbsp;the&nbsp;pattern.&nbsp;However,&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2898883">//&nbsp;rightmost&nbsp;&#34;abc&#34;&nbsp;(at&nbsp;position&nbsp;6)&nbsp;is&nbsp;a&nbsp;prefix&nbsp;of&nbsp;the&nbsp;whole&nbsp;pattern,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2898956">//&nbsp;goodSuffixSkip[3]&nbsp;==&nbsp;shift+len(suffix)&nbsp;==&nbsp;6+5&nbsp;==&nbsp;11.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2899013">goodSuffixSkip</span>&nbsp;<span class="op" id="2899028">[</span><span class="op" id="2899029">]</span><span class="builtintype" id="2899030">int</span><br>
<span class="lineno"></span><span class="op" id="2899034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2899037">func</span>&nbsp;<span class="ident" id="2899042">makeStringFinder</span><span class="op" id="2899058">(</span><span class="ident" id="2899059">pattern</span>&nbsp;<span class="builtintype" id="2899067">string</span><span class="op" id="2899073">)</span>&nbsp;<span class="op" id="2899075">*</span><span class="ident" id="2899076">stringFinder</span>&nbsp;<span class="op" id="2899089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2899092">f</span>&nbsp;<span class="op" id="2899094">:=</span>&nbsp;<span class="op" id="2899097">&amp;</span><span class="ident" id="2899098">stringFinder</span><span class="op" id="2899110">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2899114">pattern</span><span class="op" id="2899121">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2899130">pattern</span><span class="op" id="2899137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2899141">goodSuffixSkip</span><span class="op" id="2899155">:</span>&nbsp;<span class="builtinfunc" id="2899157">make</span><span class="op" id="2899161">(</span><span class="op" id="2899162">[</span><span class="op" id="2899163">]</span><span class="builtintype" id="2899164">int</span><span class="op" id="2899167">,</span>&nbsp;<span class="builtinfunc" id="2899169">len</span><span class="op" id="2899172">(</span><span class="ident" id="2899173">pattern</span><span class="op" id="2899180">)</span><span class="op" id="2899181">)</span><span class="op" id="2899182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2899185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2899188">//&nbsp;last&nbsp;is&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;character&nbsp;in&nbsp;the&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2899248">last</span>&nbsp;<span class="op" id="2899253">:=</span>&nbsp;<span class="builtinfunc" id="2899256">len</span><span class="op" id="2899259">(</span><span class="ident" id="2899260">pattern</span><span class="op" id="2899267">)</span>&nbsp;<span class="op" id="2899269">-</span>&nbsp;<span class="num" id="2899271">1</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2899275">//&nbsp;Build&nbsp;bad&nbsp;character&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2899306">//&nbsp;Bytes&nbsp;not&nbsp;in&nbsp;the&nbsp;pattern&nbsp;can&nbsp;skip&nbsp;one&nbsp;pattern&#39;s&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2899366">for</span>&nbsp;<span class="ident" id="2899370">i</span>&nbsp;<span class="op" id="2899372">:=</span>&nbsp;<span class="keyword" id="2899375">range</span>&nbsp;<span class="ident" id="2899381">f</span><span class="op" id="2899382">.</span><span class="ident" id="2899383">badCharSkip</span>&nbsp;<span class="op" id="2899395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2899399">f</span><span class="op" id="2899400">.</span><span class="ident" id="2899401">badCharSkip</span><span class="op" id="2899412">[</span><span class="ident" id="2899413">i</span><span class="op" id="2899414">]</span>&nbsp;<span class="op" id="2899416">=</span>&nbsp;<span class="builtinfunc" id="2899418">len</span><span class="op" id="2899421">(</span><span class="ident" id="2899422">pattern</span><span class="op" id="2899429">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2899432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2899435">//&nbsp;The&nbsp;loop&nbsp;condition&nbsp;is&nbsp;&lt;&nbsp;instead&nbsp;of&nbsp;&lt;=&nbsp;so&nbsp;that&nbsp;the&nbsp;last&nbsp;byte&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2899508">//&nbsp;have&nbsp;a&nbsp;zero&nbsp;distance&nbsp;to&nbsp;itself.&nbsp;Finding&nbsp;this&nbsp;byte&nbsp;out&nbsp;of&nbsp;place&nbsp;implies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2899583">//&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;last&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2899624">for</span>&nbsp;<span class="ident" id="2899628">i</span>&nbsp;<span class="op" id="2899630">:=</span>&nbsp;<span class="num" id="2899633">0</span><span class="op" id="2899634">;</span>&nbsp;<span class="ident" id="2899636">i</span>&nbsp;<span class="op" id="2899638">&lt;</span>&nbsp;<span class="ident" id="2899640">last</span><span class="op" id="2899644">;</span>&nbsp;<span class="ident" id="2899646">i</span><span class="op" id="2899647">++</span>&nbsp;<span class="op" id="2899650">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2899654">f</span><span class="op" id="2899655">.</span><span class="ident" id="2899656">badCharSkip</span><span class="op" id="2899667">[</span><span class="ident" id="2899668">pattern</span><span class="op" id="2899675">[</span><span class="ident" id="2899676">i</span><span class="op" id="2899677">]</span><span class="op" id="2899678">]</span>&nbsp;<span class="op" id="2899680">=</span>&nbsp;<span class="ident" id="2899682">last</span>&nbsp;<span class="op" id="2899687">-</span>&nbsp;<span class="ident" id="2899689">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2899692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2899696">//&nbsp;Build&nbsp;good&nbsp;suffix&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2899725">//&nbsp;First&nbsp;pass:&nbsp;set&nbsp;each&nbsp;value&nbsp;to&nbsp;the&nbsp;next&nbsp;index&nbsp;which&nbsp;starts&nbsp;a&nbsp;prefix&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2899799">//&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2899812">lastPrefix</span>&nbsp;<span class="op" id="2899823">:=</span>&nbsp;<span class="ident" id="2899826">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2899832">for</span>&nbsp;<span class="ident" id="2899836">i</span>&nbsp;<span class="op" id="2899838">:=</span>&nbsp;<span class="ident" id="2899841">last</span><span class="op" id="2899845">;</span>&nbsp;<span class="ident" id="2899847">i</span>&nbsp;<span class="op" id="2899849">&gt;=</span>&nbsp;<span class="num" id="2899852">0</span><span class="op" id="2899853">;</span>&nbsp;<span class="ident" id="2899855">i</span><span class="op" id="2899856">--</span>&nbsp;<span class="op" id="2899859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2899863">if</span>&nbsp;<span class="ident" id="2899866">HasPrefix</span><span class="op" id="2899875">(</span><span class="ident" id="2899876">pattern</span><span class="op" id="2899883">,</span>&nbsp;<span class="ident" id="2899885">pattern</span><span class="op" id="2899892">[</span><span class="ident" id="2899893">i</span><span class="op" id="2899894">+</span><span class="num" id="2899895">1</span><span class="op" id="2899896">:</span><span class="op" id="2899897">]</span><span class="op" id="2899898">)</span>&nbsp;<span class="op" id="2899900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2899905">lastPrefix</span>&nbsp;<span class="op" id="2899916">=</span>&nbsp;<span class="ident" id="2899918">i</span>&nbsp;<span class="op" id="2899920">+</span>&nbsp;<span class="num" id="2899922">1</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2899926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2899930">//&nbsp;lastPrefix&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;(last-i)&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2899989">f</span><span class="op" id="2899990">.</span><span class="ident" id="2899991">goodSuffixSkip</span><span class="op" id="2900005">[</span><span class="ident" id="2900006">i</span><span class="op" id="2900007">]</span>&nbsp;<span class="op" id="2900009">=</span>&nbsp;<span class="ident" id="2900011">lastPrefix</span>&nbsp;<span class="op" id="2900022">+</span>&nbsp;<span class="ident" id="2900024">last</span>&nbsp;<span class="op" id="2900029">-</span>&nbsp;<span class="ident" id="2900031">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2900034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2900037">//&nbsp;Second&nbsp;pass:&nbsp;find&nbsp;repeats&nbsp;of&nbsp;pattern&#39;s&nbsp;suffix&nbsp;starting&nbsp;from&nbsp;the&nbsp;front.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2900112">for</span>&nbsp;<span class="ident" id="2900116">i</span>&nbsp;<span class="op" id="2900118">:=</span>&nbsp;<span class="num" id="2900121">0</span><span class="op" id="2900122">;</span>&nbsp;<span class="ident" id="2900124">i</span>&nbsp;<span class="op" id="2900126">&lt;</span>&nbsp;<span class="ident" id="2900128">last</span><span class="op" id="2900132">;</span>&nbsp;<span class="ident" id="2900134">i</span><span class="op" id="2900135">++</span>&nbsp;<span class="op" id="2900138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2900142">lenSuffix</span>&nbsp;<span class="op" id="2900152">:=</span>&nbsp;<span class="ident" id="2900155">longestCommonSuffix</span><span class="op" id="2900174">(</span><span class="ident" id="2900175">pattern</span><span class="op" id="2900182">,</span>&nbsp;<span class="ident" id="2900184">pattern</span><span class="op" id="2900191">[</span><span class="num" id="2900192">1</span><span class="op" id="2900193">:</span><span class="ident" id="2900194">i</span><span class="op" id="2900195">+</span><span class="num" id="2900196">1</span><span class="op" id="2900197">]</span><span class="op" id="2900198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2900202">if</span>&nbsp;<span class="ident" id="2900205">pattern</span><span class="op" id="2900212">[</span><span class="ident" id="2900213">i</span><span class="op" id="2900214">-</span><span class="ident" id="2900215">lenSuffix</span><span class="op" id="2900224">]</span>&nbsp;<span class="op" id="2900226">!=</span>&nbsp;<span class="ident" id="2900229">pattern</span><span class="op" id="2900236">[</span><span class="ident" id="2900237">last</span><span class="op" id="2900241">-</span><span class="ident" id="2900242">lenSuffix</span><span class="op" id="2900251">]</span>&nbsp;<span class="op" id="2900253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2900258">//&nbsp;(last-i)&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;lenSuffix&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2900317">f</span><span class="op" id="2900318">.</span><span class="ident" id="2900319">goodSuffixSkip</span><span class="op" id="2900333">[</span><span class="ident" id="2900334">last</span><span class="op" id="2900338">-</span><span class="ident" id="2900339">lenSuffix</span><span class="op" id="2900348">]</span>&nbsp;<span class="op" id="2900350">=</span>&nbsp;<span class="ident" id="2900352">lenSuffix</span>&nbsp;<span class="op" id="2900362">+</span>&nbsp;<span class="ident" id="2900364">last</span>&nbsp;<span class="op" id="2900369">-</span>&nbsp;<span class="ident" id="2900371">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2900375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2900378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2900382">return</span>&nbsp;<span class="ident" id="2900389">f</span><br>
<span class="lineno"></span><span class="op" id="2900391">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="2900394">func</span>&nbsp;<span class="ident" id="2900399">longestCommonSuffix</span><span class="op" id="2900418">(</span><span class="ident" id="2900419">a</span><span class="op" id="2900420">,</span>&nbsp;<span class="ident" id="2900422">b</span>&nbsp;<span class="builtintype" id="2900424">string</span><span class="op" id="2900430">)</span>&nbsp;<span class="op" id="2900432">(</span><span class="ident" id="2900433">i</span>&nbsp;<span class="builtintype" id="2900435">int</span><span class="op" id="2900438">)</span>&nbsp;<span class="op" id="2900440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2900443">for</span>&nbsp;<span class="op" id="2900447">;</span>&nbsp;<span class="ident" id="2900449">i</span>&nbsp;<span class="op" id="2900451">&lt;</span>&nbsp;<span class="builtinfunc" id="2900453">len</span><span class="op" id="2900456">(</span><span class="ident" id="2900457">a</span><span class="op" id="2900458">)</span>&nbsp;<span class="op" id="2900460">&amp;&amp;</span>&nbsp;<span class="ident" id="2900463">i</span>&nbsp;<span class="op" id="2900465">&lt;</span>&nbsp;<span class="builtinfunc" id="2900467">len</span><span class="op" id="2900470">(</span><span class="ident" id="2900471">b</span><span class="op" id="2900472">)</span><span class="op" id="2900473">;</span>&nbsp;<span class="ident" id="2900475">i</span><span class="op" id="2900476">++</span>&nbsp;<span class="op" id="2900479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2900483">if</span>&nbsp;<span class="ident" id="2900486">a</span><span class="op" id="2900487">[</span><span class="builtinfunc" id="2900488">len</span><span class="op" id="2900491">(</span><span class="ident" id="2900492">a</span><span class="op" id="2900493">)</span><span class="op" id="2900494">-</span><span class="num" id="2900495">1</span><span class="op" id="2900496">-</span><span class="ident" id="2900497">i</span><span class="op" id="2900498">]</span>&nbsp;<span class="op" id="2900500">!=</span>&nbsp;<span class="ident" id="2900503">b</span><span class="op" id="2900504">[</span><span class="builtinfunc" id="2900505">len</span><span class="op" id="2900508">(</span><span class="ident" id="2900509">b</span><span class="op" id="2900510">)</span><span class="op" id="2900511">-</span><span class="num" id="2900512">1</span><span class="op" id="2900513">-</span><span class="ident" id="2900514">i</span><span class="op" id="2900515">]</span>&nbsp;<span class="op" id="2900517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2900522">break</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2900530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2900533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2900536">return</span><br>
<span class="lineno"></span><span class="op" id="2900543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="2900546">//&nbsp;next&nbsp;returns&nbsp;the&nbsp;index&nbsp;in&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;the&nbsp;pattern.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="2900623">//&nbsp;the&nbsp;pattern&nbsp;is&nbsp;not&nbsp;found,&nbsp;it&nbsp;returns&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2900667">func</span>&nbsp;<span class="op" id="2900672">(</span><span class="ident" id="2900673">f</span>&nbsp;<span class="op" id="2900675">*</span><span class="ident" id="2900676">stringFinder</span><span class="op" id="2900688">)</span>&nbsp;<span class="ident" id="2900690">next</span><span class="op" id="2900694">(</span><span class="ident" id="2900695">text</span>&nbsp;<span class="builtintype" id="2900700">string</span><span class="op" id="2900706">)</span>&nbsp;<span class="builtintype" id="2900708">int</span>&nbsp;<span class="op" id="2900712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2900715">i</span>&nbsp;<span class="op" id="2900717">:=</span>&nbsp;<span class="builtinfunc" id="2900720">len</span><span class="op" id="2900723">(</span><span class="ident" id="2900724">f</span><span class="op" id="2900725">.</span><span class="ident" id="2900726">pattern</span><span class="op" id="2900733">)</span>&nbsp;<span class="op" id="2900735">-</span>&nbsp;<span class="num" id="2900737">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2900740">for</span>&nbsp;<span class="ident" id="2900744">i</span>&nbsp;<span class="op" id="2900746">&lt;</span>&nbsp;<span class="builtinfunc" id="2900748">len</span><span class="op" id="2900751">(</span><span class="ident" id="2900752">text</span><span class="op" id="2900756">)</span>&nbsp;<span class="op" id="2900758">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2900762">//&nbsp;Compare&nbsp;backwards&nbsp;from&nbsp;the&nbsp;end&nbsp;until&nbsp;the&nbsp;first&nbsp;unmatching&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2900836">j</span>&nbsp;<span class="op" id="2900838">:=</span>&nbsp;<span class="builtinfunc" id="2900841">len</span><span class="op" id="2900844">(</span><span class="ident" id="2900845">f</span><span class="op" id="2900846">.</span><span class="ident" id="2900847">pattern</span><span class="op" id="2900854">)</span>&nbsp;<span class="op" id="2900856">-</span>&nbsp;<span class="num" id="2900858">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2900862">for</span>&nbsp;<span class="ident" id="2900866">j</span>&nbsp;<span class="op" id="2900868">&gt;=</span>&nbsp;<span class="num" id="2900871">0</span>&nbsp;<span class="op" id="2900873">&amp;&amp;</span>&nbsp;<span class="ident" id="2900876">text</span><span class="op" id="2900880">[</span><span class="ident" id="2900881">i</span><span class="op" id="2900882">]</span>&nbsp;<span class="op" id="2900884">==</span>&nbsp;<span class="ident" id="2900887">f</span><span class="op" id="2900888">.</span><span class="ident" id="2900889">pattern</span><span class="op" id="2900896">[</span><span class="ident" id="2900897">j</span><span class="op" id="2900898">]</span>&nbsp;<span class="op" id="2900900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2900905">i</span><span class="op" id="2900906">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2900912">j</span><span class="op" id="2900913">--</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2900918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2900922">if</span>&nbsp;<span class="ident" id="2900925">j</span>&nbsp;<span class="op" id="2900927">&lt;</span>&nbsp;<span class="num" id="2900929">0</span>&nbsp;<span class="op" id="2900931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2900936">return</span>&nbsp;<span class="ident" id="2900943">i</span>&nbsp;<span class="op" id="2900945">+</span>&nbsp;<span class="num" id="2900947">1</span>&nbsp;<span class="comment" id="2900949">//&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2900960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2900964">i</span>&nbsp;<span class="op" id="2900966">+=</span>&nbsp;<span class="ident" id="2900969">max</span><span class="op" id="2900972">(</span><span class="ident" id="2900973">f</span><span class="op" id="2900974">.</span><span class="ident" id="2900975">badCharSkip</span><span class="op" id="2900986">[</span><span class="ident" id="2900987">text</span><span class="op" id="2900991">[</span><span class="ident" id="2900992">i</span><span class="op" id="2900993">]</span><span class="op" id="2900994">]</span><span class="op" id="2900995">,</span>&nbsp;<span class="ident" id="2900997">f</span><span class="op" id="2900998">.</span><span class="ident" id="2900999">goodSuffixSkip</span><span class="op" id="2901013">[</span><span class="ident" id="2901014">j</span><span class="op" id="2901015">]</span><span class="op" id="2901016">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2901019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2901022">return</span>&nbsp;<span class="op" id="2901029">-</span><span class="num" id="2901030">1</span><br>
<span class="lineno"></span><span class="op" id="2901032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2901035">func</span>&nbsp;<span class="ident" id="2901040">max</span><span class="op" id="2901043">(</span><span class="ident" id="2901044">a</span><span class="op" id="2901045">,</span>&nbsp;<span class="ident" id="2901047">b</span>&nbsp;<span class="builtintype" id="2901049">int</span><span class="op" id="2901052">)</span>&nbsp;<span class="builtintype" id="2901054">int</span>&nbsp;<span class="op" id="2901058">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2901061">if</span>&nbsp;<span class="ident" id="2901064">a</span>&nbsp;<span class="op" id="2901066">&gt;</span>&nbsp;<span class="ident" id="2901068">b</span>&nbsp;<span class="op" id="2901070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2901074">return</span>&nbsp;<span class="ident" id="2901081">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2901084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2901087">return</span>&nbsp;<span class="ident" id="2901094">b</span><br>
<span class="lineno"></span><span class="op" id="2901096">}</span>
</div>
</body>
</html>
