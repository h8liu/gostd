<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html" class="current">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4200687">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4200742">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4200796">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4200847">package</span>&nbsp;<span class="ident" id="4200855">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4200861">import</span>&nbsp;<span class="op" id="4200868">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4200871">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4200889">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4200899">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4200906">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4200914">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4200928">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4200933">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4200936">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="4201016">//&nbsp;&#34;compress/gzip&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4201082">const</span>&nbsp;<span class="op" id="4201088">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4201091">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4201110">=</span>&nbsp;<span class="ident" id="4201112">flate</span><span class="op" id="4201117">.</span><span class="ident" id="4201118">NoCompression</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4201133">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4201152">=</span>&nbsp;<span class="ident" id="4201154">flate</span><span class="op" id="4201159">.</span><span class="ident" id="4201160">BestSpeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4201171">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4201190">=</span>&nbsp;<span class="ident" id="4201192">flate</span><span class="op" id="4201197">.</span><span class="ident" id="4201198">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4201215">DefaultCompression</span>&nbsp;<span class="op" id="4201234">=</span>&nbsp;<span class="ident" id="4201236">flate</span><span class="op" id="4201241">.</span><span class="ident" id="4201242">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="4201261">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4201264">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;an&nbsp;io.WriteCloser.</span><br>
<span class="lineno"></span><span class="comment" id="4201298">//&nbsp;Writes&nbsp;to&nbsp;a&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4201353">type</span>&nbsp;<span class="ident" id="4201358">Writer</span>&nbsp;<span class="keyword" id="4201365">struct</span>&nbsp;<span class="op" id="4201372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4201375">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4201383">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4201395">io</span><span class="op" id="4201397">.</span><span class="ident" id="4201398">Writer</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4201406">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4201418">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4201423">wroteHeader</span>&nbsp;<span class="builtintype" id="4201435">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4201441">compressor</span>&nbsp;&nbsp;<span class="op" id="4201453">*</span><span class="ident" id="4201454">flate</span><span class="op" id="4201459">.</span><span class="ident" id="4201460">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4201468">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4201480">hash</span><span class="op" id="4201484">.</span><span class="ident" id="4201485">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4201493">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4201505">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4201513">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4201525">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4201531">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4201543">[</span><span class="num" id="4201544">10</span><span class="op" id="4201546">]</span><span class="builtintype" id="4201547">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4201553">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4201565">error</span><br>
<span class="lineno"></span><span class="op" id="4201571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="4201574">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="4201609">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4201675">//</span><br>
<span class="lineno"></span><span class="comment" id="4201678">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="4201759">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno">45</span><span class="comment" id="4201814">//</span><br>
<span class="lineno"></span><span class="comment" id="4201817">//&nbsp;Callers&nbsp;that&nbsp;wish&nbsp;to&nbsp;set&nbsp;the&nbsp;fields&nbsp;in&nbsp;Writer.Header&nbsp;must&nbsp;do&nbsp;so&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="4201891">//&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;Close.&nbsp;The&nbsp;Comment&nbsp;and&nbsp;Name&nbsp;header&nbsp;fields&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4201967">//&nbsp;UTF-8&nbsp;strings&nbsp;in&nbsp;Go,&nbsp;but&nbsp;the&nbsp;underlying&nbsp;format&nbsp;requires&nbsp;NUL-terminated&nbsp;ISO</span><br>
<span class="lineno"></span><span class="comment" id="4202045">//&nbsp;8859-1&nbsp;(Latin-1).&nbsp;NUL&nbsp;or&nbsp;non-Latin-1&nbsp;runes&nbsp;in&nbsp;those&nbsp;strings&nbsp;will&nbsp;lead&nbsp;to&nbsp;an</span><br>
<span class="lineno">50</span><span class="comment" id="4202124">//&nbsp;error&nbsp;on&nbsp;Write.</span><br>
<span class="lineno"></span><span class="keyword" id="4202143">func</span>&nbsp;<span class="ident" id="4202148">NewWriter</span><span class="op" id="4202157">(</span><span class="ident" id="4202158">w</span>&nbsp;<span class="ident" id="4202160">io</span><span class="op" id="4202162">.</span><span class="ident" id="4202163">Writer</span><span class="op" id="4202169">)</span>&nbsp;<span class="op" id="4202171">*</span><span class="ident" id="4202172">Writer</span>&nbsp;<span class="op" id="4202179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4202182">z</span><span class="op" id="4202183">,</span>&nbsp;<span class="ident" id="4202185">_</span>&nbsp;<span class="op" id="4202187">:=</span>&nbsp;<span class="ident" id="4202190">NewWriterLevel</span><span class="op" id="4202204">(</span><span class="ident" id="4202205">w</span><span class="op" id="4202206">,</span>&nbsp;<span class="ident" id="4202208">DefaultCompression</span><span class="op" id="4202226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4202229">return</span>&nbsp;<span class="ident" id="4202236">z</span><br>
<span class="lineno"></span><span class="op" id="4202238">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="4202241">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="4202321">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="4202356">//</span><br>
<span class="lineno"></span><span class="comment" id="4202359">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno">60</span><span class="comment" id="4202433">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4202509">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4202556">func</span>&nbsp;<span class="ident" id="4202561">NewWriterLevel</span><span class="op" id="4202575">(</span><span class="ident" id="4202576">w</span>&nbsp;<span class="ident" id="4202578">io</span><span class="op" id="4202580">.</span><span class="ident" id="4202581">Writer</span><span class="op" id="4202587">,</span>&nbsp;<span class="ident" id="4202589">level</span>&nbsp;<span class="builtintype" id="4202595">int</span><span class="op" id="4202598">)</span>&nbsp;<span class="op" id="4202600">(</span><span class="op" id="4202601">*</span><span class="ident" id="4202602">Writer</span><span class="op" id="4202608">,</span>&nbsp;<span class="builtintype" id="4202610">error</span><span class="op" id="4202615">)</span>&nbsp;<span class="op" id="4202617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4202620">if</span>&nbsp;<span class="ident" id="4202623">level</span>&nbsp;<span class="op" id="4202629">&lt;</span>&nbsp;<span class="ident" id="4202631">DefaultCompression</span>&nbsp;<span class="op" id="4202650">||</span>&nbsp;<span class="ident" id="4202653">level</span>&nbsp;<span class="op" id="4202659">&gt;</span>&nbsp;<span class="ident" id="4202661">BestCompression</span>&nbsp;<span class="op" id="4202677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4202681">return</span>&nbsp;<span class="builtintype" id="4202688">nil</span><span class="op" id="4202691">,</span>&nbsp;<span class="ident" id="4202693">fmt</span><span class="op" id="4202696">.</span><span class="ident" id="4202697">Errorf</span><span class="op" id="4202703">(</span><span class="string" id="4202704">&#34;gzip:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="4202741">,</span>&nbsp;<span class="ident" id="4202743">level</span><span class="op" id="4202748">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4202751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4202754">z</span>&nbsp;<span class="op" id="4202756">:=</span>&nbsp;<span class="builtinfunc" id="4202759">new</span><span class="op" id="4202762">(</span><span class="ident" id="4202763">Writer</span><span class="op" id="4202769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4202772">z</span><span class="op" id="4202773">.</span><span class="ident" id="4202774">init</span><span class="op" id="4202778">(</span><span class="ident" id="4202779">w</span><span class="op" id="4202780">,</span>&nbsp;<span class="ident" id="4202782">level</span><span class="op" id="4202787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4202790">return</span>&nbsp;<span class="ident" id="4202797">z</span><span class="op" id="4202798">,</span>&nbsp;<span class="builtintype" id="4202800">nil</span><br>
<span class="lineno"></span><span class="op" id="4202804">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4202807">func</span>&nbsp;<span class="op" id="4202812">(</span><span class="ident" id="4202813">z</span>&nbsp;<span class="op" id="4202815">*</span><span class="ident" id="4202816">Writer</span><span class="op" id="4202822">)</span>&nbsp;<span class="ident" id="4202824">init</span><span class="op" id="4202828">(</span><span class="ident" id="4202829">w</span>&nbsp;<span class="ident" id="4202831">io</span><span class="op" id="4202833">.</span><span class="ident" id="4202834">Writer</span><span class="op" id="4202840">,</span>&nbsp;<span class="ident" id="4202842">level</span>&nbsp;<span class="builtintype" id="4202848">int</span><span class="op" id="4202851">)</span>&nbsp;<span class="op" id="4202853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4202856">digest</span>&nbsp;<span class="op" id="4202863">:=</span>&nbsp;<span class="ident" id="4202866">z</span><span class="op" id="4202867">.</span><span class="ident" id="4202868">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4202876">if</span>&nbsp;<span class="ident" id="4202879">digest</span>&nbsp;<span class="op" id="4202886">!=</span>&nbsp;<span class="builtintype" id="4202889">nil</span>&nbsp;<span class="op" id="4202893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4202897">digest</span><span class="op" id="4202903">.</span><span class="ident" id="4202904">Reset</span><span class="op" id="4202909">(</span><span class="op" id="4202910">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4202913">}</span>&nbsp;<span class="keyword" id="4202915">else</span>&nbsp;<span class="op" id="4202920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4202924">digest</span>&nbsp;<span class="op" id="4202931">=</span>&nbsp;<span class="ident" id="4202933">crc32</span><span class="op" id="4202938">.</span><span class="ident" id="4202939">NewIEEE</span><span class="op" id="4202946">(</span><span class="op" id="4202947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4202950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4202953">compressor</span>&nbsp;<span class="op" id="4202964">:=</span>&nbsp;<span class="ident" id="4202967">z</span><span class="op" id="4202968">.</span><span class="ident" id="4202969">compressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4202981">if</span>&nbsp;<span class="ident" id="4202984">compressor</span>&nbsp;<span class="op" id="4202995">!=</span>&nbsp;<span class="builtintype" id="4202998">nil</span>&nbsp;<span class="op" id="4203002">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4203006">compressor</span><span class="op" id="4203016">.</span><span class="ident" id="4203017">Reset</span><span class="op" id="4203022">(</span><span class="ident" id="4203023">w</span><span class="op" id="4203024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4203027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4203030">*</span><span class="ident" id="4203031">z</span>&nbsp;<span class="op" id="4203033">=</span>&nbsp;<span class="ident" id="4203035">Writer</span><span class="op" id="4203041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4203045">Header</span><span class="op" id="4203051">:</span>&nbsp;<span class="ident" id="4203053">Header</span><span class="op" id="4203059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4203064">OS</span><span class="op" id="4203066">:</span>&nbsp;<span class="num" id="4203068">255</span><span class="op" id="4203071">,</span>&nbsp;<span class="comment" id="4203073">//&nbsp;unknown</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4203086">}</span><span class="op" id="4203087">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4203091">w</span><span class="op" id="4203092">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4203103">w</span><span class="op" id="4203104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4203108">level</span><span class="op" id="4203113">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4203120">level</span><span class="op" id="4203125">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4203129">digest</span><span class="op" id="4203135">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4203141">digest</span><span class="op" id="4203147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4203151">compressor</span><span class="op" id="4203161">:</span>&nbsp;<span class="ident" id="4203163">compressor</span><span class="op" id="4203173">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4203176">}</span><br>
<span class="lineno"></span><span class="op" id="4203178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4203181">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Writer&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4203251">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewWriter&nbsp;or&nbsp;NewWriterLevel,&nbsp;but</span><br>
<span class="lineno">95</span><span class="comment" id="4203321">//&nbsp;writing&nbsp;to&nbsp;w&nbsp;instead.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Writer&nbsp;rather&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="4203388">//&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4203413">func</span>&nbsp;<span class="op" id="4203418">(</span><span class="ident" id="4203419">z</span>&nbsp;<span class="op" id="4203421">*</span><span class="ident" id="4203422">Writer</span><span class="op" id="4203428">)</span>&nbsp;<span class="ident" id="4203430">Reset</span><span class="op" id="4203435">(</span><span class="ident" id="4203436">w</span>&nbsp;<span class="ident" id="4203438">io</span><span class="op" id="4203440">.</span><span class="ident" id="4203441">Writer</span><span class="op" id="4203447">)</span>&nbsp;<span class="op" id="4203449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4203452">z</span><span class="op" id="4203453">.</span><span class="ident" id="4203454">init</span><span class="op" id="4203458">(</span><span class="ident" id="4203459">w</span><span class="op" id="4203460">,</span>&nbsp;<span class="ident" id="4203462">z</span><span class="op" id="4203463">.</span><span class="ident" id="4203464">level</span><span class="op" id="4203469">)</span><br>
<span class="lineno"></span><span class="op" id="4203471">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="4203474">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="4203535">func</span>&nbsp;<span class="ident" id="4203540">put2</span><span class="op" id="4203544">(</span><span class="ident" id="4203545">p</span>&nbsp;<span class="op" id="4203547">[</span><span class="op" id="4203548">]</span><span class="builtintype" id="4203549">byte</span><span class="op" id="4203553">,</span>&nbsp;<span class="ident" id="4203555">v</span>&nbsp;<span class="builtintype" id="4203557">uint16</span><span class="op" id="4203563">)</span>&nbsp;<span class="op" id="4203565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4203568">p</span><span class="op" id="4203569">[</span><span class="num" id="4203570">0</span><span class="op" id="4203571">]</span>&nbsp;<span class="op" id="4203573">=</span>&nbsp;<span class="builtintype" id="4203575">uint8</span><span class="op" id="4203580">(</span><span class="ident" id="4203581">v</span>&nbsp;<span class="op" id="4203583">&gt;&gt;</span>&nbsp;<span class="num" id="4203586">0</span><span class="op" id="4203587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4203590">p</span><span class="op" id="4203591">[</span><span class="num" id="4203592">1</span><span class="op" id="4203593">]</span>&nbsp;<span class="op" id="4203595">=</span>&nbsp;<span class="builtintype" id="4203597">uint8</span><span class="op" id="4203602">(</span><span class="ident" id="4203603">v</span>&nbsp;<span class="op" id="4203605">&gt;&gt;</span>&nbsp;<span class="num" id="4203608">8</span><span class="op" id="4203609">)</span><br>
<span class="lineno">105</span><span class="op" id="4203611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4203614">func</span>&nbsp;<span class="ident" id="4203619">put4</span><span class="op" id="4203623">(</span><span class="ident" id="4203624">p</span>&nbsp;<span class="op" id="4203626">[</span><span class="op" id="4203627">]</span><span class="builtintype" id="4203628">byte</span><span class="op" id="4203632">,</span>&nbsp;<span class="ident" id="4203634">v</span>&nbsp;<span class="builtintype" id="4203636">uint32</span><span class="op" id="4203642">)</span>&nbsp;<span class="op" id="4203644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4203647">p</span><span class="op" id="4203648">[</span><span class="num" id="4203649">0</span><span class="op" id="4203650">]</span>&nbsp;<span class="op" id="4203652">=</span>&nbsp;<span class="builtintype" id="4203654">uint8</span><span class="op" id="4203659">(</span><span class="ident" id="4203660">v</span>&nbsp;<span class="op" id="4203662">&gt;&gt;</span>&nbsp;<span class="num" id="4203665">0</span><span class="op" id="4203666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4203669">p</span><span class="op" id="4203670">[</span><span class="num" id="4203671">1</span><span class="op" id="4203672">]</span>&nbsp;<span class="op" id="4203674">=</span>&nbsp;<span class="builtintype" id="4203676">uint8</span><span class="op" id="4203681">(</span><span class="ident" id="4203682">v</span>&nbsp;<span class="op" id="4203684">&gt;&gt;</span>&nbsp;<span class="num" id="4203687">8</span><span class="op" id="4203688">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4203691">p</span><span class="op" id="4203692">[</span><span class="num" id="4203693">2</span><span class="op" id="4203694">]</span>&nbsp;<span class="op" id="4203696">=</span>&nbsp;<span class="builtintype" id="4203698">uint8</span><span class="op" id="4203703">(</span><span class="ident" id="4203704">v</span>&nbsp;<span class="op" id="4203706">&gt;&gt;</span>&nbsp;<span class="num" id="4203709">16</span><span class="op" id="4203711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4203714">p</span><span class="op" id="4203715">[</span><span class="num" id="4203716">3</span><span class="op" id="4203717">]</span>&nbsp;<span class="op" id="4203719">=</span>&nbsp;<span class="builtintype" id="4203721">uint8</span><span class="op" id="4203726">(</span><span class="ident" id="4203727">v</span>&nbsp;<span class="op" id="4203729">&gt;&gt;</span>&nbsp;<span class="num" id="4203732">24</span><span class="op" id="4203734">)</span><br>
<span class="lineno"></span><span class="op" id="4203736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4203739">//&nbsp;writeBytes&nbsp;writes&nbsp;a&nbsp;length-prefixed&nbsp;byte&nbsp;slice&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno">115</span><span class="keyword" id="4203797">func</span>&nbsp;<span class="op" id="4203802">(</span><span class="ident" id="4203803">z</span>&nbsp;<span class="op" id="4203805">*</span><span class="ident" id="4203806">Writer</span><span class="op" id="4203812">)</span>&nbsp;<span class="ident" id="4203814">writeBytes</span><span class="op" id="4203824">(</span><span class="ident" id="4203825">b</span>&nbsp;<span class="op" id="4203827">[</span><span class="op" id="4203828">]</span><span class="builtintype" id="4203829">byte</span><span class="op" id="4203833">)</span>&nbsp;<span class="builtintype" id="4203835">error</span>&nbsp;<span class="op" id="4203841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4203844">if</span>&nbsp;<span class="builtinfunc" id="4203847">len</span><span class="op" id="4203850">(</span><span class="ident" id="4203851">b</span><span class="op" id="4203852">)</span>&nbsp;<span class="op" id="4203854">&gt;</span>&nbsp;<span class="num" id="4203856">0xffff</span>&nbsp;<span class="op" id="4203863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4203867">return</span>&nbsp;<span class="ident" id="4203874">errors</span><span class="op" id="4203880">.</span><span class="ident" id="4203881">New</span><span class="op" id="4203884">(</span><span class="string" id="4203885">&#34;gzip.Write:&nbsp;Extra&nbsp;data&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="4203922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4203925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4203928">put2</span><span class="op" id="4203932">(</span><span class="ident" id="4203933">z</span><span class="op" id="4203934">.</span><span class="ident" id="4203935">buf</span><span class="op" id="4203938">[</span><span class="num" id="4203939">0</span><span class="op" id="4203940">:</span><span class="num" id="4203941">2</span><span class="op" id="4203942">]</span><span class="op" id="4203943">,</span>&nbsp;<span class="builtintype" id="4203945">uint16</span><span class="op" id="4203951">(</span><span class="builtinfunc" id="4203952">len</span><span class="op" id="4203955">(</span><span class="ident" id="4203956">b</span><span class="op" id="4203957">)</span><span class="op" id="4203958">)</span><span class="op" id="4203959">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4203962">_</span><span class="op" id="4203963">,</span>&nbsp;<span class="ident" id="4203965">err</span>&nbsp;<span class="op" id="4203969">:=</span>&nbsp;<span class="ident" id="4203972">z</span><span class="op" id="4203973">.</span><span class="ident" id="4203974">w</span><span class="op" id="4203975">.</span><span class="ident" id="4203976">Write</span><span class="op" id="4203981">(</span><span class="ident" id="4203982">z</span><span class="op" id="4203983">.</span><span class="ident" id="4203984">buf</span><span class="op" id="4203987">[</span><span class="num" id="4203988">0</span><span class="op" id="4203989">:</span><span class="num" id="4203990">2</span><span class="op" id="4203991">]</span><span class="op" id="4203992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4203995">if</span>&nbsp;<span class="ident" id="4203998">err</span>&nbsp;<span class="op" id="4204002">!=</span>&nbsp;<span class="builtintype" id="4204005">nil</span>&nbsp;<span class="op" id="4204009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4204013">return</span>&nbsp;<span class="ident" id="4204020">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4204025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4204028">_</span><span class="op" id="4204029">,</span>&nbsp;<span class="ident" id="4204031">err</span>&nbsp;<span class="op" id="4204035">=</span>&nbsp;<span class="ident" id="4204037">z</span><span class="op" id="4204038">.</span><span class="ident" id="4204039">w</span><span class="op" id="4204040">.</span><span class="ident" id="4204041">Write</span><span class="op" id="4204046">(</span><span class="ident" id="4204047">b</span><span class="op" id="4204048">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4204051">return</span>&nbsp;<span class="ident" id="4204058">err</span><br>
<span class="lineno"></span><span class="op" id="4204062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4204065">//&nbsp;writeString&nbsp;writes&nbsp;a&nbsp;UTF-8&nbsp;string&nbsp;s&nbsp;in&nbsp;GZIP&#39;s&nbsp;format&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno"></span><span class="comment" id="4204129">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno">130</span><span class="keyword" id="4204212">func</span>&nbsp;<span class="op" id="4204217">(</span><span class="ident" id="4204218">z</span>&nbsp;<span class="op" id="4204220">*</span><span class="ident" id="4204221">Writer</span><span class="op" id="4204227">)</span>&nbsp;<span class="ident" id="4204229">writeString</span><span class="op" id="4204240">(</span><span class="ident" id="4204241">s</span>&nbsp;<span class="builtintype" id="4204243">string</span><span class="op" id="4204249">)</span>&nbsp;<span class="op" id="4204251">(</span><span class="ident" id="4204252">err</span>&nbsp;<span class="builtintype" id="4204256">error</span><span class="op" id="4204261">)</span>&nbsp;<span class="op" id="4204263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4204266">//&nbsp;GZIP&nbsp;stores&nbsp;Latin-1&nbsp;strings;&nbsp;error&nbsp;if&nbsp;non-Latin-1;&nbsp;convert&nbsp;if&nbsp;non-ASCII.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4204343">needconv</span>&nbsp;<span class="op" id="4204352">:=</span>&nbsp;<span class="builtintype" id="4204355">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4204362">for</span>&nbsp;<span class="ident" id="4204366">_</span><span class="op" id="4204367">,</span>&nbsp;<span class="ident" id="4204369">v</span>&nbsp;<span class="op" id="4204371">:=</span>&nbsp;<span class="keyword" id="4204374">range</span>&nbsp;<span class="ident" id="4204380">s</span>&nbsp;<span class="op" id="4204382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4204386">if</span>&nbsp;<span class="ident" id="4204389">v</span>&nbsp;<span class="op" id="4204391">==</span>&nbsp;<span class="num" id="4204394">0</span>&nbsp;<span class="op" id="4204396">||</span>&nbsp;<span class="ident" id="4204399">v</span>&nbsp;<span class="op" id="4204401">&gt;</span>&nbsp;<span class="num" id="4204403">0xff</span>&nbsp;<span class="op" id="4204408">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4204413">return</span>&nbsp;<span class="ident" id="4204420">errors</span><span class="op" id="4204426">.</span><span class="ident" id="4204427">New</span><span class="op" id="4204430">(</span><span class="string" id="4204431">&#34;gzip.Write:&nbsp;non-Latin-1&nbsp;header&nbsp;string&#34;</span><span class="op" id="4204470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4204474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4204478">if</span>&nbsp;<span class="ident" id="4204481">v</span>&nbsp;<span class="op" id="4204483">&gt;</span>&nbsp;<span class="num" id="4204485">0x7f</span>&nbsp;<span class="op" id="4204490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4204495">needconv</span>&nbsp;<span class="op" id="4204504">=</span>&nbsp;<span class="builtintype" id="4204506">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4204513">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4204516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4204519">if</span>&nbsp;<span class="ident" id="4204522">needconv</span>&nbsp;<span class="op" id="4204531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4204535">b</span>&nbsp;<span class="op" id="4204537">:=</span>&nbsp;<span class="builtinfunc" id="4204540">make</span><span class="op" id="4204544">(</span><span class="op" id="4204545">[</span><span class="op" id="4204546">]</span><span class="builtintype" id="4204547">byte</span><span class="op" id="4204551">,</span>&nbsp;<span class="num" id="4204553">0</span><span class="op" id="4204554">,</span>&nbsp;<span class="builtinfunc" id="4204556">len</span><span class="op" id="4204559">(</span><span class="ident" id="4204560">s</span><span class="op" id="4204561">)</span><span class="op" id="4204562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4204566">for</span>&nbsp;<span class="ident" id="4204570">_</span><span class="op" id="4204571">,</span>&nbsp;<span class="ident" id="4204573">v</span>&nbsp;<span class="op" id="4204575">:=</span>&nbsp;<span class="keyword" id="4204578">range</span>&nbsp;<span class="ident" id="4204584">s</span>&nbsp;<span class="op" id="4204586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4204591">b</span>&nbsp;<span class="op" id="4204593">=</span>&nbsp;<span class="builtinfunc" id="4204595">append</span><span class="op" id="4204601">(</span><span class="ident" id="4204602">b</span><span class="op" id="4204603">,</span>&nbsp;<span class="builtintype" id="4204605">byte</span><span class="op" id="4204609">(</span><span class="ident" id="4204610">v</span><span class="op" id="4204611">)</span><span class="op" id="4204612">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4204616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4204620">_</span><span class="op" id="4204621">,</span>&nbsp;<span class="ident" id="4204623">err</span>&nbsp;<span class="op" id="4204627">=</span>&nbsp;<span class="ident" id="4204629">z</span><span class="op" id="4204630">.</span><span class="ident" id="4204631">w</span><span class="op" id="4204632">.</span><span class="ident" id="4204633">Write</span><span class="op" id="4204638">(</span><span class="ident" id="4204639">b</span><span class="op" id="4204640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4204643">}</span>&nbsp;<span class="keyword" id="4204645">else</span>&nbsp;<span class="op" id="4204650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4204654">_</span><span class="op" id="4204655">,</span>&nbsp;<span class="ident" id="4204657">err</span>&nbsp;<span class="op" id="4204661">=</span>&nbsp;<span class="ident" id="4204663">io</span><span class="op" id="4204665">.</span><span class="ident" id="4204666">WriteString</span><span class="op" id="4204677">(</span><span class="ident" id="4204678">z</span><span class="op" id="4204679">.</span><span class="ident" id="4204680">w</span><span class="op" id="4204681">,</span>&nbsp;<span class="ident" id="4204683">s</span><span class="op" id="4204684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4204687">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4204690">if</span>&nbsp;<span class="ident" id="4204693">err</span>&nbsp;<span class="op" id="4204697">!=</span>&nbsp;<span class="builtintype" id="4204700">nil</span>&nbsp;<span class="op" id="4204704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4204708">return</span>&nbsp;<span class="ident" id="4204715">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4204720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4204723">//&nbsp;GZIP&nbsp;strings&nbsp;are&nbsp;NUL-terminated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4204760">z</span><span class="op" id="4204761">.</span><span class="ident" id="4204762">buf</span><span class="op" id="4204765">[</span><span class="num" id="4204766">0</span><span class="op" id="4204767">]</span>&nbsp;<span class="op" id="4204769">=</span>&nbsp;<span class="num" id="4204771">0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4204774">_</span><span class="op" id="4204775">,</span>&nbsp;<span class="ident" id="4204777">err</span>&nbsp;<span class="op" id="4204781">=</span>&nbsp;<span class="ident" id="4204783">z</span><span class="op" id="4204784">.</span><span class="ident" id="4204785">w</span><span class="op" id="4204786">.</span><span class="ident" id="4204787">Write</span><span class="op" id="4204792">(</span><span class="ident" id="4204793">z</span><span class="op" id="4204794">.</span><span class="ident" id="4204795">buf</span><span class="op" id="4204798">[</span><span class="num" id="4204799">0</span><span class="op" id="4204800">:</span><span class="num" id="4204801">1</span><span class="op" id="4204802">]</span><span class="op" id="4204803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4204806">return</span>&nbsp;<span class="ident" id="4204813">err</span><br>
<span class="lineno"></span><span class="op" id="4204817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4204820">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno">160</span><span class="comment" id="4204892">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="4204968">func</span>&nbsp;<span class="op" id="4204973">(</span><span class="ident" id="4204974">z</span>&nbsp;<span class="op" id="4204976">*</span><span class="ident" id="4204977">Writer</span><span class="op" id="4204983">)</span>&nbsp;<span class="ident" id="4204985">Write</span><span class="op" id="4204990">(</span><span class="ident" id="4204991">p</span>&nbsp;<span class="op" id="4204993">[</span><span class="op" id="4204994">]</span><span class="builtintype" id="4204995">byte</span><span class="op" id="4204999">)</span>&nbsp;<span class="op" id="4205001">(</span><span class="builtintype" id="4205002">int</span><span class="op" id="4205005">,</span>&nbsp;<span class="builtintype" id="4205007">error</span><span class="op" id="4205012">)</span>&nbsp;<span class="op" id="4205014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4205017">if</span>&nbsp;<span class="ident" id="4205020">z</span><span class="op" id="4205021">.</span><span class="ident" id="4205022">err</span>&nbsp;<span class="op" id="4205026">!=</span>&nbsp;<span class="builtintype" id="4205029">nil</span>&nbsp;<span class="op" id="4205033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4205037">return</span>&nbsp;<span class="num" id="4205044">0</span><span class="op" id="4205045">,</span>&nbsp;<span class="ident" id="4205047">z</span><span class="op" id="4205048">.</span><span class="ident" id="4205049">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4205054">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4205057">var</span>&nbsp;<span class="ident" id="4205061">n</span>&nbsp;<span class="builtintype" id="4205063">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4205068">//&nbsp;Write&nbsp;the&nbsp;GZIP&nbsp;header&nbsp;lazily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4205102">if</span>&nbsp;<span class="op" id="4205105">!</span><span class="ident" id="4205106">z</span><span class="op" id="4205107">.</span><span class="ident" id="4205108">wroteHeader</span>&nbsp;<span class="op" id="4205120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4205124">z</span><span class="op" id="4205125">.</span><span class="ident" id="4205126">wroteHeader</span>&nbsp;<span class="op" id="4205138">=</span>&nbsp;<span class="builtintype" id="4205140">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4205147">z</span><span class="op" id="4205148">.</span><span class="ident" id="4205149">buf</span><span class="op" id="4205152">[</span><span class="num" id="4205153">0</span><span class="op" id="4205154">]</span>&nbsp;<span class="op" id="4205156">=</span>&nbsp;<span class="ident" id="4205158">gzipID1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4205168">z</span><span class="op" id="4205169">.</span><span class="ident" id="4205170">buf</span><span class="op" id="4205173">[</span><span class="num" id="4205174">1</span><span class="op" id="4205175">]</span>&nbsp;<span class="op" id="4205177">=</span>&nbsp;<span class="ident" id="4205179">gzipID2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4205189">z</span><span class="op" id="4205190">.</span><span class="ident" id="4205191">buf</span><span class="op" id="4205194">[</span><span class="num" id="4205195">2</span><span class="op" id="4205196">]</span>&nbsp;<span class="op" id="4205198">=</span>&nbsp;<span class="ident" id="4205200">gzipDeflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4205214">z</span><span class="op" id="4205215">.</span><span class="ident" id="4205216">buf</span><span class="op" id="4205219">[</span><span class="num" id="4205220">3</span><span class="op" id="4205221">]</span>&nbsp;<span class="op" id="4205223">=</span>&nbsp;<span class="num" id="4205225">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4205229">if</span>&nbsp;<span class="ident" id="4205232">z</span><span class="op" id="4205233">.</span><span class="ident" id="4205234">Extra</span>&nbsp;<span class="op" id="4205240">!=</span>&nbsp;<span class="builtintype" id="4205243">nil</span>&nbsp;<span class="op" id="4205247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4205252">z</span><span class="op" id="4205253">.</span><span class="ident" id="4205254">buf</span><span class="op" id="4205257">[</span><span class="num" id="4205258">3</span><span class="op" id="4205259">]</span>&nbsp;<span class="op" id="4205261">|=</span>&nbsp;<span class="num" id="4205264">0x04</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4205271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4205275">if</span>&nbsp;<span class="ident" id="4205278">z</span><span class="op" id="4205279">.</span><span class="ident" id="4205280">Name</span>&nbsp;<span class="op" id="4205285">!=</span>&nbsp;<span class="string" id="4205288">&#34;&#34;</span>&nbsp;<span class="op" id="4205291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4205296">z</span><span class="op" id="4205297">.</span><span class="ident" id="4205298">buf</span><span class="op" id="4205301">[</span><span class="num" id="4205302">3</span><span class="op" id="4205303">]</span>&nbsp;<span class="op" id="4205305">|=</span>&nbsp;<span class="num" id="4205308">0x08</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4205315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4205319">if</span>&nbsp;<span class="ident" id="4205322">z</span><span class="op" id="4205323">.</span><span class="ident" id="4205324">Comment</span>&nbsp;<span class="op" id="4205332">!=</span>&nbsp;<span class="string" id="4205335">&#34;&#34;</span>&nbsp;<span class="op" id="4205338">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4205343">z</span><span class="op" id="4205344">.</span><span class="ident" id="4205345">buf</span><span class="op" id="4205348">[</span><span class="num" id="4205349">3</span><span class="op" id="4205350">]</span>&nbsp;<span class="op" id="4205352">|=</span>&nbsp;<span class="num" id="4205355">0x10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4205362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4205366">put4</span><span class="op" id="4205370">(</span><span class="ident" id="4205371">z</span><span class="op" id="4205372">.</span><span class="ident" id="4205373">buf</span><span class="op" id="4205376">[</span><span class="num" id="4205377">4</span><span class="op" id="4205378">:</span><span class="num" id="4205379">8</span><span class="op" id="4205380">]</span><span class="op" id="4205381">,</span>&nbsp;<span class="builtintype" id="4205383">uint32</span><span class="op" id="4205389">(</span><span class="ident" id="4205390">z</span><span class="op" id="4205391">.</span><span class="ident" id="4205392">ModTime</span><span class="op" id="4205399">.</span><span class="ident" id="4205400">Unix</span><span class="op" id="4205404">(</span><span class="op" id="4205405">)</span><span class="op" id="4205406">)</span><span class="op" id="4205407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4205411">if</span>&nbsp;<span class="ident" id="4205414">z</span><span class="op" id="4205415">.</span><span class="ident" id="4205416">level</span>&nbsp;<span class="op" id="4205422">==</span>&nbsp;<span class="ident" id="4205425">BestCompression</span>&nbsp;<span class="op" id="4205441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4205446">z</span><span class="op" id="4205447">.</span><span class="ident" id="4205448">buf</span><span class="op" id="4205451">[</span><span class="num" id="4205452">8</span><span class="op" id="4205453">]</span>&nbsp;<span class="op" id="4205455">=</span>&nbsp;<span class="num" id="4205457">2</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4205461">}</span>&nbsp;<span class="keyword" id="4205463">else</span>&nbsp;<span class="keyword" id="4205468">if</span>&nbsp;<span class="ident" id="4205471">z</span><span class="op" id="4205472">.</span><span class="ident" id="4205473">level</span>&nbsp;<span class="op" id="4205479">==</span>&nbsp;<span class="ident" id="4205482">BestSpeed</span>&nbsp;<span class="op" id="4205492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4205497">z</span><span class="op" id="4205498">.</span><span class="ident" id="4205499">buf</span><span class="op" id="4205502">[</span><span class="num" id="4205503">8</span><span class="op" id="4205504">]</span>&nbsp;<span class="op" id="4205506">=</span>&nbsp;<span class="num" id="4205508">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4205512">}</span>&nbsp;<span class="keyword" id="4205514">else</span>&nbsp;<span class="op" id="4205519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4205524">z</span><span class="op" id="4205525">.</span><span class="ident" id="4205526">buf</span><span class="op" id="4205529">[</span><span class="num" id="4205530">8</span><span class="op" id="4205531">]</span>&nbsp;<span class="op" id="4205533">=</span>&nbsp;<span class="num" id="4205535">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4205539">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4205543">z</span><span class="op" id="4205544">.</span><span class="ident" id="4205545">buf</span><span class="op" id="4205548">[</span><span class="num" id="4205549">9</span><span class="op" id="4205550">]</span>&nbsp;<span class="op" id="4205552">=</span>&nbsp;<span class="ident" id="4205554">z</span><span class="op" id="4205555">.</span><span class="ident" id="4205556">OS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4205561">n</span><span class="op" id="4205562">,</span>&nbsp;<span class="ident" id="4205564">z</span><span class="op" id="4205565">.</span><span class="ident" id="4205566">err</span>&nbsp;<span class="op" id="4205570">=</span>&nbsp;<span class="ident" id="4205572">z</span><span class="op" id="4205573">.</span><span class="ident" id="4205574">w</span><span class="op" id="4205575">.</span><span class="ident" id="4205576">Write</span><span class="op" id="4205581">(</span><span class="ident" id="4205582">z</span><span class="op" id="4205583">.</span><span class="ident" id="4205584">buf</span><span class="op" id="4205587">[</span><span class="num" id="4205588">0</span><span class="op" id="4205589">:</span><span class="num" id="4205590">10</span><span class="op" id="4205592">]</span><span class="op" id="4205593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4205597">if</span>&nbsp;<span class="ident" id="4205600">z</span><span class="op" id="4205601">.</span><span class="ident" id="4205602">err</span>&nbsp;<span class="op" id="4205606">!=</span>&nbsp;<span class="builtintype" id="4205609">nil</span>&nbsp;<span class="op" id="4205613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4205618">return</span>&nbsp;<span class="ident" id="4205625">n</span><span class="op" id="4205626">,</span>&nbsp;<span class="ident" id="4205628">z</span><span class="op" id="4205629">.</span><span class="ident" id="4205630">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4205636">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4205640">if</span>&nbsp;<span class="ident" id="4205643">z</span><span class="op" id="4205644">.</span><span class="ident" id="4205645">Extra</span>&nbsp;<span class="op" id="4205651">!=</span>&nbsp;<span class="builtintype" id="4205654">nil</span>&nbsp;<span class="op" id="4205658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4205663">z</span><span class="op" id="4205664">.</span><span class="ident" id="4205665">err</span>&nbsp;<span class="op" id="4205669">=</span>&nbsp;<span class="ident" id="4205671">z</span><span class="op" id="4205672">.</span><span class="ident" id="4205673">writeBytes</span><span class="op" id="4205683">(</span><span class="ident" id="4205684">z</span><span class="op" id="4205685">.</span><span class="ident" id="4205686">Extra</span><span class="op" id="4205691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4205696">if</span>&nbsp;<span class="ident" id="4205699">z</span><span class="op" id="4205700">.</span><span class="ident" id="4205701">err</span>&nbsp;<span class="op" id="4205705">!=</span>&nbsp;<span class="builtintype" id="4205708">nil</span>&nbsp;<span class="op" id="4205712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4205718">return</span>&nbsp;<span class="ident" id="4205725">n</span><span class="op" id="4205726">,</span>&nbsp;<span class="ident" id="4205728">z</span><span class="op" id="4205729">.</span><span class="ident" id="4205730">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4205737">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4205741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4205745">if</span>&nbsp;<span class="ident" id="4205748">z</span><span class="op" id="4205749">.</span><span class="ident" id="4205750">Name</span>&nbsp;<span class="op" id="4205755">!=</span>&nbsp;<span class="string" id="4205758">&#34;&#34;</span>&nbsp;<span class="op" id="4205761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4205766">z</span><span class="op" id="4205767">.</span><span class="ident" id="4205768">err</span>&nbsp;<span class="op" id="4205772">=</span>&nbsp;<span class="ident" id="4205774">z</span><span class="op" id="4205775">.</span><span class="ident" id="4205776">writeString</span><span class="op" id="4205787">(</span><span class="ident" id="4205788">z</span><span class="op" id="4205789">.</span><span class="ident" id="4205790">Name</span><span class="op" id="4205794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4205799">if</span>&nbsp;<span class="ident" id="4205802">z</span><span class="op" id="4205803">.</span><span class="ident" id="4205804">err</span>&nbsp;<span class="op" id="4205808">!=</span>&nbsp;<span class="builtintype" id="4205811">nil</span>&nbsp;<span class="op" id="4205815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4205821">return</span>&nbsp;<span class="ident" id="4205828">n</span><span class="op" id="4205829">,</span>&nbsp;<span class="ident" id="4205831">z</span><span class="op" id="4205832">.</span><span class="ident" id="4205833">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4205840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4205844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4205848">if</span>&nbsp;<span class="ident" id="4205851">z</span><span class="op" id="4205852">.</span><span class="ident" id="4205853">Comment</span>&nbsp;<span class="op" id="4205861">!=</span>&nbsp;<span class="string" id="4205864">&#34;&#34;</span>&nbsp;<span class="op" id="4205867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4205872">z</span><span class="op" id="4205873">.</span><span class="ident" id="4205874">err</span>&nbsp;<span class="op" id="4205878">=</span>&nbsp;<span class="ident" id="4205880">z</span><span class="op" id="4205881">.</span><span class="ident" id="4205882">writeString</span><span class="op" id="4205893">(</span><span class="ident" id="4205894">z</span><span class="op" id="4205895">.</span><span class="ident" id="4205896">Comment</span><span class="op" id="4205903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4205908">if</span>&nbsp;<span class="ident" id="4205911">z</span><span class="op" id="4205912">.</span><span class="ident" id="4205913">err</span>&nbsp;<span class="op" id="4205917">!=</span>&nbsp;<span class="builtintype" id="4205920">nil</span>&nbsp;<span class="op" id="4205924">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4205930">return</span>&nbsp;<span class="ident" id="4205937">n</span><span class="op" id="4205938">,</span>&nbsp;<span class="ident" id="4205940">z</span><span class="op" id="4205941">.</span><span class="ident" id="4205942">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4205949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4205953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4205957">if</span>&nbsp;<span class="ident" id="4205960">z</span><span class="op" id="4205961">.</span><span class="ident" id="4205962">compressor</span>&nbsp;<span class="op" id="4205973">==</span>&nbsp;<span class="builtintype" id="4205976">nil</span>&nbsp;<span class="op" id="4205980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4205985">z</span><span class="op" id="4205986">.</span><span class="ident" id="4205987">compressor</span><span class="op" id="4205997">,</span>&nbsp;<span class="ident" id="4205999">_</span>&nbsp;<span class="op" id="4206001">=</span>&nbsp;<span class="ident" id="4206003">flate</span><span class="op" id="4206008">.</span><span class="ident" id="4206009">NewWriter</span><span class="op" id="4206018">(</span><span class="ident" id="4206019">z</span><span class="op" id="4206020">.</span><span class="ident" id="4206021">w</span><span class="op" id="4206022">,</span>&nbsp;<span class="ident" id="4206024">z</span><span class="op" id="4206025">.</span><span class="ident" id="4206026">level</span><span class="op" id="4206031">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4206035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4206038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4206041">z</span><span class="op" id="4206042">.</span><span class="ident" id="4206043">size</span>&nbsp;<span class="op" id="4206048">+=</span>&nbsp;<span class="builtintype" id="4206051">uint32</span><span class="op" id="4206057">(</span><span class="builtinfunc" id="4206058">len</span><span class="op" id="4206061">(</span><span class="ident" id="4206062">p</span><span class="op" id="4206063">)</span><span class="op" id="4206064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4206067">z</span><span class="op" id="4206068">.</span><span class="ident" id="4206069">digest</span><span class="op" id="4206075">.</span><span class="ident" id="4206076">Write</span><span class="op" id="4206081">(</span><span class="ident" id="4206082">p</span><span class="op" id="4206083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4206086">n</span><span class="op" id="4206087">,</span>&nbsp;<span class="ident" id="4206089">z</span><span class="op" id="4206090">.</span><span class="ident" id="4206091">err</span>&nbsp;<span class="op" id="4206095">=</span>&nbsp;<span class="ident" id="4206097">z</span><span class="op" id="4206098">.</span><span class="ident" id="4206099">compressor</span><span class="op" id="4206109">.</span><span class="ident" id="4206110">Write</span><span class="op" id="4206115">(</span><span class="ident" id="4206116">p</span><span class="op" id="4206117">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4206120">return</span>&nbsp;<span class="ident" id="4206127">n</span><span class="op" id="4206128">,</span>&nbsp;<span class="ident" id="4206130">z</span><span class="op" id="4206131">.</span><span class="ident" id="4206132">err</span><br>
<span class="lineno"></span><span class="op" id="4206136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4206139">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;compressed&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="4206210">//</span><br>
<span class="lineno">225</span><span class="comment" id="4206213">//&nbsp;It&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;in&nbsp;compressed&nbsp;network&nbsp;protocols,&nbsp;to&nbsp;ensure&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4206284">//&nbsp;a&nbsp;remote&nbsp;reader&nbsp;has&nbsp;enough&nbsp;data&nbsp;to&nbsp;reconstruct&nbsp;a&nbsp;packet.&nbsp;Flush&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="4206355">//&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;data&nbsp;has&nbsp;been&nbsp;written.&nbsp;If&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4206420">//&nbsp;writer&nbsp;returns&nbsp;an&nbsp;error,&nbsp;Flush&nbsp;returns&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4206474">//</span><br>
<span class="lineno">230</span><span class="comment" id="4206477">//&nbsp;In&nbsp;the&nbsp;terminology&nbsp;of&nbsp;the&nbsp;zlib&nbsp;library,&nbsp;Flush&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Z_SYNC_FLUSH.</span><br>
<span class="lineno"></span><span class="keyword" id="4206557">func</span>&nbsp;<span class="op" id="4206562">(</span><span class="ident" id="4206563">z</span>&nbsp;<span class="op" id="4206565">*</span><span class="ident" id="4206566">Writer</span><span class="op" id="4206572">)</span>&nbsp;<span class="ident" id="4206574">Flush</span><span class="op" id="4206579">(</span><span class="op" id="4206580">)</span>&nbsp;<span class="builtintype" id="4206582">error</span>&nbsp;<span class="op" id="4206588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4206591">if</span>&nbsp;<span class="ident" id="4206594">z</span><span class="op" id="4206595">.</span><span class="ident" id="4206596">err</span>&nbsp;<span class="op" id="4206600">!=</span>&nbsp;<span class="builtintype" id="4206603">nil</span>&nbsp;<span class="op" id="4206607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4206611">return</span>&nbsp;<span class="ident" id="4206618">z</span><span class="op" id="4206619">.</span><span class="ident" id="4206620">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4206625">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4206628">if</span>&nbsp;<span class="ident" id="4206631">z</span><span class="op" id="4206632">.</span><span class="ident" id="4206633">closed</span>&nbsp;<span class="op" id="4206640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4206644">return</span>&nbsp;<span class="builtintype" id="4206651">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4206656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4206659">if</span>&nbsp;<span class="op" id="4206662">!</span><span class="ident" id="4206663">z</span><span class="op" id="4206664">.</span><span class="ident" id="4206665">wroteHeader</span>&nbsp;<span class="op" id="4206677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4206681">z</span><span class="op" id="4206682">.</span><span class="ident" id="4206683">Write</span><span class="op" id="4206688">(</span><span class="builtintype" id="4206689">nil</span><span class="op" id="4206692">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4206696">if</span>&nbsp;<span class="ident" id="4206699">z</span><span class="op" id="4206700">.</span><span class="ident" id="4206701">err</span>&nbsp;<span class="op" id="4206705">!=</span>&nbsp;<span class="builtintype" id="4206708">nil</span>&nbsp;<span class="op" id="4206712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4206717">return</span>&nbsp;<span class="ident" id="4206724">z</span><span class="op" id="4206725">.</span><span class="ident" id="4206726">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4206732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4206735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4206738">z</span><span class="op" id="4206739">.</span><span class="ident" id="4206740">err</span>&nbsp;<span class="op" id="4206744">=</span>&nbsp;<span class="ident" id="4206746">z</span><span class="op" id="4206747">.</span><span class="ident" id="4206748">compressor</span><span class="op" id="4206758">.</span><span class="ident" id="4206759">Flush</span><span class="op" id="4206764">(</span><span class="op" id="4206765">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4206768">return</span>&nbsp;<span class="ident" id="4206775">z</span><span class="op" id="4206776">.</span><span class="ident" id="4206777">err</span><br>
<span class="lineno"></span><span class="op" id="4206781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4206784">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4206858">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">250</span><span class="keyword" id="4206917">func</span>&nbsp;<span class="op" id="4206922">(</span><span class="ident" id="4206923">z</span>&nbsp;<span class="op" id="4206925">*</span><span class="ident" id="4206926">Writer</span><span class="op" id="4206932">)</span>&nbsp;<span class="ident" id="4206934">Close</span><span class="op" id="4206939">(</span><span class="op" id="4206940">)</span>&nbsp;<span class="builtintype" id="4206942">error</span>&nbsp;<span class="op" id="4206948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4206951">if</span>&nbsp;<span class="ident" id="4206954">z</span><span class="op" id="4206955">.</span><span class="ident" id="4206956">err</span>&nbsp;<span class="op" id="4206960">!=</span>&nbsp;<span class="builtintype" id="4206963">nil</span>&nbsp;<span class="op" id="4206967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4206971">return</span>&nbsp;<span class="ident" id="4206978">z</span><span class="op" id="4206979">.</span><span class="ident" id="4206980">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4206985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4206988">if</span>&nbsp;<span class="ident" id="4206991">z</span><span class="op" id="4206992">.</span><span class="ident" id="4206993">closed</span>&nbsp;<span class="op" id="4207000">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4207004">return</span>&nbsp;<span class="builtintype" id="4207011">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4207016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4207019">z</span><span class="op" id="4207020">.</span><span class="ident" id="4207021">closed</span>&nbsp;<span class="op" id="4207028">=</span>&nbsp;<span class="builtintype" id="4207030">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4207036">if</span>&nbsp;<span class="op" id="4207039">!</span><span class="ident" id="4207040">z</span><span class="op" id="4207041">.</span><span class="ident" id="4207042">wroteHeader</span>&nbsp;<span class="op" id="4207054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4207058">z</span><span class="op" id="4207059">.</span><span class="ident" id="4207060">Write</span><span class="op" id="4207065">(</span><span class="builtintype" id="4207066">nil</span><span class="op" id="4207069">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4207073">if</span>&nbsp;<span class="ident" id="4207076">z</span><span class="op" id="4207077">.</span><span class="ident" id="4207078">err</span>&nbsp;<span class="op" id="4207082">!=</span>&nbsp;<span class="builtintype" id="4207085">nil</span>&nbsp;<span class="op" id="4207089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4207094">return</span>&nbsp;<span class="ident" id="4207101">z</span><span class="op" id="4207102">.</span><span class="ident" id="4207103">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4207109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4207112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4207115">z</span><span class="op" id="4207116">.</span><span class="ident" id="4207117">err</span>&nbsp;<span class="op" id="4207121">=</span>&nbsp;<span class="ident" id="4207123">z</span><span class="op" id="4207124">.</span><span class="ident" id="4207125">compressor</span><span class="op" id="4207135">.</span><span class="ident" id="4207136">Close</span><span class="op" id="4207141">(</span><span class="op" id="4207142">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4207145">if</span>&nbsp;<span class="ident" id="4207148">z</span><span class="op" id="4207149">.</span><span class="ident" id="4207150">err</span>&nbsp;<span class="op" id="4207154">!=</span>&nbsp;<span class="builtintype" id="4207157">nil</span>&nbsp;<span class="op" id="4207161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4207165">return</span>&nbsp;<span class="ident" id="4207172">z</span><span class="op" id="4207173">.</span><span class="ident" id="4207174">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4207179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4207182">put4</span><span class="op" id="4207186">(</span><span class="ident" id="4207187">z</span><span class="op" id="4207188">.</span><span class="ident" id="4207189">buf</span><span class="op" id="4207192">[</span><span class="num" id="4207193">0</span><span class="op" id="4207194">:</span><span class="num" id="4207195">4</span><span class="op" id="4207196">]</span><span class="op" id="4207197">,</span>&nbsp;<span class="ident" id="4207199">z</span><span class="op" id="4207200">.</span><span class="ident" id="4207201">digest</span><span class="op" id="4207207">.</span><span class="ident" id="4207208">Sum32</span><span class="op" id="4207213">(</span><span class="op" id="4207214">)</span><span class="op" id="4207215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4207218">put4</span><span class="op" id="4207222">(</span><span class="ident" id="4207223">z</span><span class="op" id="4207224">.</span><span class="ident" id="4207225">buf</span><span class="op" id="4207228">[</span><span class="num" id="4207229">4</span><span class="op" id="4207230">:</span><span class="num" id="4207231">8</span><span class="op" id="4207232">]</span><span class="op" id="4207233">,</span>&nbsp;<span class="ident" id="4207235">z</span><span class="op" id="4207236">.</span><span class="ident" id="4207237">size</span><span class="op" id="4207241">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4207244">_</span><span class="op" id="4207245">,</span>&nbsp;<span class="ident" id="4207247">z</span><span class="op" id="4207248">.</span><span class="ident" id="4207249">err</span>&nbsp;<span class="op" id="4207253">=</span>&nbsp;<span class="ident" id="4207255">z</span><span class="op" id="4207256">.</span><span class="ident" id="4207257">w</span><span class="op" id="4207258">.</span><span class="ident" id="4207259">Write</span><span class="op" id="4207264">(</span><span class="ident" id="4207265">z</span><span class="op" id="4207266">.</span><span class="ident" id="4207267">buf</span><span class="op" id="4207270">[</span><span class="num" id="4207271">0</span><span class="op" id="4207272">:</span><span class="num" id="4207273">8</span><span class="op" id="4207274">]</span><span class="op" id="4207275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4207278">return</span>&nbsp;<span class="ident" id="4207285">z</span><span class="op" id="4207286">.</span><span class="ident" id="4207287">err</span><br>
<span class="lineno"></span><span class="op" id="4207291">}</span>
</div>
</body>
</html>
