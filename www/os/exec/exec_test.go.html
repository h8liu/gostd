<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="676622">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="676677">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="676731">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="676782">//&nbsp;Use&nbsp;an&nbsp;external&nbsp;test&nbsp;to&nbsp;avoid&nbsp;os/exec&nbsp;-&gt;&nbsp;net/http&nbsp;-&gt;&nbsp;crypto/x509&nbsp;-&gt;&nbsp;os/exec</span><br>
<span class="lineno"></span><span class="comment" id="676861">//&nbsp;circular&nbsp;dependency&nbsp;on&nbsp;non-cgo&nbsp;darwin.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="676904">package</span>&nbsp;<span class="ident" id="676912">exec_test</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="676923">import</span>&nbsp;<span class="op" id="676930">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="676933">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="676942">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="676951">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="676958">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="676964">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="676977">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="676984">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="676991">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="677003">&#34;net/http/httptest&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="677024">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="677030">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="677041">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="677058">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="677069">&#34;strconv&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="677080">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="677091">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="677102">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="677109">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="677112">func</span>&nbsp;<span class="ident" id="677117">helperCommand</span><span class="op" id="677130">(</span><span class="ident" id="677131">t</span>&nbsp;<span class="op" id="677133">*</span><span class="ident" id="677134">testing</span><span class="op" id="677141">.</span><span class="ident" id="677142">T</span><span class="op" id="677143">,</span>&nbsp;<span class="ident" id="677145">s</span>&nbsp;<span class="op" id="677147">...</span><span class="builtintype" id="677150">string</span><span class="op" id="677156">)</span>&nbsp;<span class="op" id="677158">*</span><span class="ident" id="677159">exec</span><span class="op" id="677163">.</span><span class="ident" id="677164">Cmd</span>&nbsp;<span class="op" id="677168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="677171">if</span>&nbsp;<span class="ident" id="677174">runtime</span><span class="op" id="677181">.</span><span class="ident" id="677182">GOOS</span>&nbsp;<span class="op" id="677187">==</span>&nbsp;<span class="string" id="677190">&#34;nacl&#34;</span>&nbsp;<span class="op" id="677197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="677201">t</span><span class="op" id="677202">.</span><span class="ident" id="677203">Skip</span><span class="op" id="677207">(</span><span class="string" id="677208">&#34;skipping&nbsp;on&nbsp;nacl&#34;</span><span class="op" id="677226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="677229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="677232">cs</span>&nbsp;<span class="op" id="677235">:=</span>&nbsp;<span class="op" id="677238">[</span><span class="op" id="677239">]</span><span class="builtintype" id="677240">string</span><span class="op" id="677246">{</span><span class="string" id="677247">&#34;-test.run=TestHelperProcess&#34;</span><span class="op" id="677276">,</span>&nbsp;<span class="string" id="677278">&#34;--&#34;</span><span class="op" id="677282">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="677285">cs</span>&nbsp;<span class="op" id="677288">=</span>&nbsp;<span class="builtinfunc" id="677290">append</span><span class="op" id="677296">(</span><span class="ident" id="677297">cs</span><span class="op" id="677299">,</span>&nbsp;<span class="ident" id="677301">s</span><span class="op" id="677302">...</span><span class="op" id="677305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="677308">cmd</span>&nbsp;<span class="op" id="677312">:=</span>&nbsp;<span class="ident" id="677315">exec</span><span class="op" id="677319">.</span><span class="ident" id="677320">Command</span><span class="op" id="677327">(</span><span class="ident" id="677328">os</span><span class="op" id="677330">.</span><span class="ident" id="677331">Args</span><span class="op" id="677335">[</span><span class="num" id="677336">0</span><span class="op" id="677337">]</span><span class="op" id="677338">,</span>&nbsp;<span class="ident" id="677340">cs</span><span class="op" id="677342">...</span><span class="op" id="677345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="677348">cmd</span><span class="op" id="677351">.</span><span class="ident" id="677352">Env</span>&nbsp;<span class="op" id="677356">=</span>&nbsp;<span class="op" id="677358">[</span><span class="op" id="677359">]</span><span class="builtintype" id="677360">string</span><span class="op" id="677366">{</span><span class="string" id="677367">&#34;GO_WANT_HELPER_PROCESS=1&#34;</span><span class="op" id="677393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="677396">return</span>&nbsp;<span class="ident" id="677403">cmd</span><br>
<span class="lineno"></span><span class="op" id="677407">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="677410">func</span>&nbsp;<span class="ident" id="677415">TestEcho</span><span class="op" id="677423">(</span><span class="ident" id="677424">t</span>&nbsp;<span class="op" id="677426">*</span><span class="ident" id="677427">testing</span><span class="op" id="677434">.</span><span class="ident" id="677435">T</span><span class="op" id="677436">)</span>&nbsp;<span class="op" id="677438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="677441">bs</span><span class="op" id="677443">,</span>&nbsp;<span class="ident" id="677445">err</span>&nbsp;<span class="op" id="677449">:=</span>&nbsp;<span class="ident" id="677452">helperCommand</span><span class="op" id="677465">(</span><span class="ident" id="677466">t</span><span class="op" id="677467">,</span>&nbsp;<span class="string" id="677469">&#34;echo&#34;</span><span class="op" id="677475">,</span>&nbsp;<span class="string" id="677477">&#34;foo&nbsp;bar&#34;</span><span class="op" id="677486">,</span>&nbsp;<span class="string" id="677488">&#34;baz&#34;</span><span class="op" id="677493">)</span><span class="op" id="677494">.</span><span class="ident" id="677495">Output</span><span class="op" id="677501">(</span><span class="op" id="677502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="677505">if</span>&nbsp;<span class="ident" id="677508">err</span>&nbsp;<span class="op" id="677512">!=</span>&nbsp;<span class="ident" id="677515">nil</span>&nbsp;<span class="op" id="677519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="677523">t</span><span class="op" id="677524">.</span><span class="ident" id="677525">Errorf</span><span class="op" id="677531">(</span><span class="string" id="677532">&#34;echo:&nbsp;%v&#34;</span><span class="op" id="677542">,</span>&nbsp;<span class="ident" id="677544">err</span><span class="op" id="677547">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="677550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="677553">if</span>&nbsp;<span class="ident" id="677556">g</span><span class="op" id="677557">,</span>&nbsp;<span class="ident" id="677559">e</span>&nbsp;<span class="op" id="677561">:=</span>&nbsp;<span class="builtintype" id="677564">string</span><span class="op" id="677570">(</span><span class="ident" id="677571">bs</span><span class="op" id="677573">)</span><span class="op" id="677574">,</span>&nbsp;<span class="string" id="677576">&#34;foo&nbsp;bar&nbsp;baz\n&#34;</span><span class="op" id="677591">;</span>&nbsp;<span class="ident" id="677593">g</span>&nbsp;<span class="op" id="677595">!=</span>&nbsp;<span class="ident" id="677598">e</span>&nbsp;<span class="op" id="677600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="677604">t</span><span class="op" id="677605">.</span><span class="ident" id="677606">Errorf</span><span class="op" id="677612">(</span><span class="string" id="677613">&#34;echo:&nbsp;want&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="677636">,</span>&nbsp;<span class="ident" id="677638">e</span><span class="op" id="677639">,</span>&nbsp;<span class="ident" id="677641">g</span><span class="op" id="677642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="677645">}</span><br>
<span class="lineno"></span><span class="op" id="677647">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="677650">func</span>&nbsp;<span class="ident" id="677655">TestCommandRelativeName</span><span class="op" id="677678">(</span><span class="ident" id="677679">t</span>&nbsp;<span class="op" id="677681">*</span><span class="ident" id="677682">testing</span><span class="op" id="677689">.</span><span class="ident" id="677690">T</span><span class="op" id="677691">)</span>&nbsp;<span class="op" id="677693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="677696">//&nbsp;Run&nbsp;our&nbsp;own&nbsp;binary&nbsp;as&nbsp;a&nbsp;relative&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="677738">//&nbsp;(e.g.&nbsp;&#34;_test/exec.test&#34;)&nbsp;our&nbsp;parent&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="677789">base</span>&nbsp;<span class="op" id="677794">:=</span>&nbsp;<span class="ident" id="677797">filepath</span><span class="op" id="677805">.</span><span class="ident" id="677806">Base</span><span class="op" id="677810">(</span><span class="ident" id="677811">os</span><span class="op" id="677813">.</span><span class="ident" id="677814">Args</span><span class="op" id="677818">[</span><span class="num" id="677819">0</span><span class="op" id="677820">]</span><span class="op" id="677821">)</span>&nbsp;<span class="comment" id="677823">//&nbsp;&#34;exec.test&#34;</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="677839">dir</span>&nbsp;<span class="op" id="677843">:=</span>&nbsp;<span class="ident" id="677846">filepath</span><span class="op" id="677854">.</span><span class="ident" id="677855">Dir</span><span class="op" id="677858">(</span><span class="ident" id="677859">os</span><span class="op" id="677861">.</span><span class="ident" id="677862">Args</span><span class="op" id="677866">[</span><span class="num" id="677867">0</span><span class="op" id="677868">]</span><span class="op" id="677869">)</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="677873">//&nbsp;&#34;/tmp/go-buildNNNN/os/exec/_test&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="677911">if</span>&nbsp;<span class="ident" id="677914">dir</span>&nbsp;<span class="op" id="677918">==</span>&nbsp;<span class="string" id="677921">&#34;.&#34;</span>&nbsp;<span class="op" id="677925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="677929">t</span><span class="op" id="677930">.</span><span class="ident" id="677931">Skip</span><span class="op" id="677935">(</span><span class="string" id="677936">&#34;skipping;&nbsp;running&nbsp;test&nbsp;at&nbsp;root&nbsp;somehow&#34;</span><span class="op" id="677976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="677979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="677982">parentDir</span>&nbsp;<span class="op" id="677992">:=</span>&nbsp;<span class="ident" id="677995">filepath</span><span class="op" id="678003">.</span><span class="ident" id="678004">Dir</span><span class="op" id="678007">(</span><span class="ident" id="678008">dir</span><span class="op" id="678011">)</span>&nbsp;<span class="comment" id="678013">//&nbsp;&#34;/tmp/go-buildNNNN/os/exec&#34;</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="678045">dirBase</span>&nbsp;<span class="op" id="678053">:=</span>&nbsp;<span class="ident" id="678056">filepath</span><span class="op" id="678064">.</span><span class="ident" id="678065">Base</span><span class="op" id="678069">(</span><span class="ident" id="678070">dir</span><span class="op" id="678073">)</span>&nbsp;&nbsp;<span class="comment" id="678076">//&nbsp;&#34;_test&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="678088">if</span>&nbsp;<span class="ident" id="678091">dirBase</span>&nbsp;<span class="op" id="678099">==</span>&nbsp;<span class="string" id="678102">&#34;.&#34;</span>&nbsp;<span class="op" id="678106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="678110">t</span><span class="op" id="678111">.</span><span class="ident" id="678112">Skipf</span><span class="op" id="678117">(</span><span class="string" id="678118">&#34;skipping;&nbsp;unexpected&nbsp;shallow&nbsp;dir&nbsp;of&nbsp;%q&#34;</span><span class="op" id="678158">,</span>&nbsp;<span class="ident" id="678160">dir</span><span class="op" id="678163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="678166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="678170">cmd</span>&nbsp;<span class="op" id="678174">:=</span>&nbsp;<span class="ident" id="678177">exec</span><span class="op" id="678181">.</span><span class="ident" id="678182">Command</span><span class="op" id="678189">(</span><span class="ident" id="678190">filepath</span><span class="op" id="678198">.</span><span class="ident" id="678199">Join</span><span class="op" id="678203">(</span><span class="ident" id="678204">dirBase</span><span class="op" id="678211">,</span>&nbsp;<span class="ident" id="678213">base</span><span class="op" id="678217">)</span><span class="op" id="678218">,</span>&nbsp;<span class="string" id="678220">&#34;-test.run=TestHelperProcess&#34;</span><span class="op" id="678249">,</span>&nbsp;<span class="string" id="678251">&#34;--&#34;</span><span class="op" id="678255">,</span>&nbsp;<span class="string" id="678257">&#34;echo&#34;</span><span class="op" id="678263">,</span>&nbsp;<span class="string" id="678265">&#34;foo&#34;</span><span class="op" id="678270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="678273">cmd</span><span class="op" id="678276">.</span><span class="ident" id="678277">Dir</span>&nbsp;<span class="op" id="678281">=</span>&nbsp;<span class="ident" id="678283">parentDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="678294">cmd</span><span class="op" id="678297">.</span><span class="ident" id="678298">Env</span>&nbsp;<span class="op" id="678302">=</span>&nbsp;<span class="op" id="678304">[</span><span class="op" id="678305">]</span><span class="builtintype" id="678306">string</span><span class="op" id="678312">{</span><span class="string" id="678313">&#34;GO_WANT_HELPER_PROCESS=1&#34;</span><span class="op" id="678339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="678343">out</span><span class="op" id="678346">,</span>&nbsp;<span class="ident" id="678348">err</span>&nbsp;<span class="op" id="678352">:=</span>&nbsp;<span class="ident" id="678355">cmd</span><span class="op" id="678358">.</span><span class="ident" id="678359">Output</span><span class="op" id="678365">(</span><span class="op" id="678366">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="678369">if</span>&nbsp;<span class="ident" id="678372">err</span>&nbsp;<span class="op" id="678376">!=</span>&nbsp;<span class="ident" id="678379">nil</span>&nbsp;<span class="op" id="678383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="678387">t</span><span class="op" id="678388">.</span><span class="ident" id="678389">Errorf</span><span class="op" id="678395">(</span><span class="string" id="678396">&#34;echo:&nbsp;%v&#34;</span><span class="op" id="678406">,</span>&nbsp;<span class="ident" id="678408">err</span><span class="op" id="678411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="678414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="678417">if</span>&nbsp;<span class="ident" id="678420">g</span><span class="op" id="678421">,</span>&nbsp;<span class="ident" id="678423">e</span>&nbsp;<span class="op" id="678425">:=</span>&nbsp;<span class="builtintype" id="678428">string</span><span class="op" id="678434">(</span><span class="ident" id="678435">out</span><span class="op" id="678438">)</span><span class="op" id="678439">,</span>&nbsp;<span class="string" id="678441">&#34;foo\n&#34;</span><span class="op" id="678448">;</span>&nbsp;<span class="ident" id="678450">g</span>&nbsp;<span class="op" id="678452">!=</span>&nbsp;<span class="ident" id="678455">e</span>&nbsp;<span class="op" id="678457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="678461">t</span><span class="op" id="678462">.</span><span class="ident" id="678463">Errorf</span><span class="op" id="678469">(</span><span class="string" id="678470">&#34;echo:&nbsp;want&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="678493">,</span>&nbsp;<span class="ident" id="678495">e</span><span class="op" id="678496">,</span>&nbsp;<span class="ident" id="678498">g</span><span class="op" id="678499">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="678502">}</span><br>
<span class="lineno"></span><span class="op" id="678504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="678507">func</span>&nbsp;<span class="ident" id="678512">TestCatStdin</span><span class="op" id="678524">(</span><span class="ident" id="678525">t</span>&nbsp;<span class="op" id="678527">*</span><span class="ident" id="678528">testing</span><span class="op" id="678535">.</span><span class="ident" id="678536">T</span><span class="op" id="678537">)</span>&nbsp;<span class="op" id="678539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="678542">//&nbsp;Cat,&nbsp;testing&nbsp;stdin&nbsp;and&nbsp;stdout.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="678577">input</span>&nbsp;<span class="op" id="678583">:=</span>&nbsp;<span class="string" id="678586">&#34;Input&nbsp;string\nLine&nbsp;2&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="678610">p</span>&nbsp;<span class="op" id="678612">:=</span>&nbsp;<span class="ident" id="678615">helperCommand</span><span class="op" id="678628">(</span><span class="ident" id="678629">t</span><span class="op" id="678630">,</span>&nbsp;<span class="string" id="678632">&#34;cat&#34;</span><span class="op" id="678637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="678640">p</span><span class="op" id="678641">.</span><span class="ident" id="678642">Stdin</span>&nbsp;<span class="op" id="678648">=</span>&nbsp;<span class="ident" id="678650">strings</span><span class="op" id="678657">.</span><span class="ident" id="678658">NewReader</span><span class="op" id="678667">(</span><span class="ident" id="678668">input</span><span class="op" id="678673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="678676">bs</span><span class="op" id="678678">,</span>&nbsp;<span class="ident" id="678680">err</span>&nbsp;<span class="op" id="678684">:=</span>&nbsp;<span class="ident" id="678687">p</span><span class="op" id="678688">.</span><span class="ident" id="678689">Output</span><span class="op" id="678695">(</span><span class="op" id="678696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="678699">if</span>&nbsp;<span class="ident" id="678702">err</span>&nbsp;<span class="op" id="678706">!=</span>&nbsp;<span class="ident" id="678709">nil</span>&nbsp;<span class="op" id="678713">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="678717">t</span><span class="op" id="678718">.</span><span class="ident" id="678719">Errorf</span><span class="op" id="678725">(</span><span class="string" id="678726">&#34;cat:&nbsp;%v&#34;</span><span class="op" id="678735">,</span>&nbsp;<span class="ident" id="678737">err</span><span class="op" id="678740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="678743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="678746">s</span>&nbsp;<span class="op" id="678748">:=</span>&nbsp;<span class="builtintype" id="678751">string</span><span class="op" id="678757">(</span><span class="ident" id="678758">bs</span><span class="op" id="678760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="678763">if</span>&nbsp;<span class="ident" id="678766">s</span>&nbsp;<span class="op" id="678768">!=</span>&nbsp;<span class="ident" id="678771">input</span>&nbsp;<span class="op" id="678777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="678781">t</span><span class="op" id="678782">.</span><span class="ident" id="678783">Errorf</span><span class="op" id="678789">(</span><span class="string" id="678790">&#34;cat:&nbsp;want&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="678812">,</span>&nbsp;<span class="ident" id="678814">input</span><span class="op" id="678819">,</span>&nbsp;<span class="ident" id="678821">s</span><span class="op" id="678822">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="678825">}</span><br>
<span class="lineno"></span><span class="op" id="678827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="678830">func</span>&nbsp;<span class="ident" id="678835">TestCatGoodAndBadFile</span><span class="op" id="678856">(</span><span class="ident" id="678857">t</span>&nbsp;<span class="op" id="678859">*</span><span class="ident" id="678860">testing</span><span class="op" id="678867">.</span><span class="ident" id="678868">T</span><span class="op" id="678869">)</span>&nbsp;<span class="op" id="678871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="678874">//&nbsp;Testing&nbsp;combined&nbsp;output&nbsp;and&nbsp;error&nbsp;values.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="678920">bs</span><span class="op" id="678922">,</span>&nbsp;<span class="ident" id="678924">err</span>&nbsp;<span class="op" id="678928">:=</span>&nbsp;<span class="ident" id="678931">helperCommand</span><span class="op" id="678944">(</span><span class="ident" id="678945">t</span><span class="op" id="678946">,</span>&nbsp;<span class="string" id="678948">&#34;cat&#34;</span><span class="op" id="678953">,</span>&nbsp;<span class="string" id="678955">&#34;/bogus/file.foo&#34;</span><span class="op" id="678972">,</span>&nbsp;<span class="string" id="678974">&#34;exec_test.go&#34;</span><span class="op" id="678988">)</span><span class="op" id="678989">.</span><span class="ident" id="678990">CombinedOutput</span><span class="op" id="679004">(</span><span class="op" id="679005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="679008">if</span>&nbsp;<span class="ident" id="679011">_</span><span class="op" id="679012">,</span>&nbsp;<span class="ident" id="679014">ok</span>&nbsp;<span class="op" id="679017">:=</span>&nbsp;<span class="ident" id="679020">err</span><span class="op" id="679023">.</span><span class="op" id="679024">(</span><span class="op" id="679025">*</span><span class="ident" id="679026">exec</span><span class="op" id="679030">.</span><span class="ident" id="679031">ExitError</span><span class="op" id="679040">)</span><span class="op" id="679041">;</span>&nbsp;<span class="op" id="679043">!</span><span class="ident" id="679044">ok</span>&nbsp;<span class="op" id="679047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="679051">t</span><span class="op" id="679052">.</span><span class="ident" id="679053">Errorf</span><span class="op" id="679059">(</span><span class="string" id="679060">&#34;expected&nbsp;*exec.ExitError&nbsp;from&nbsp;cat&nbsp;combined;&nbsp;got&nbsp;%T:&nbsp;%v&#34;</span><span class="op" id="679116">,</span>&nbsp;<span class="ident" id="679118">err</span><span class="op" id="679121">,</span>&nbsp;<span class="ident" id="679123">err</span><span class="op" id="679126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="679129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="679132">s</span>&nbsp;<span class="op" id="679134">:=</span>&nbsp;<span class="builtintype" id="679137">string</span><span class="op" id="679143">(</span><span class="ident" id="679144">bs</span><span class="op" id="679146">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="679149">sp</span>&nbsp;<span class="op" id="679152">:=</span>&nbsp;<span class="ident" id="679155">strings</span><span class="op" id="679162">.</span><span class="ident" id="679163">SplitN</span><span class="op" id="679169">(</span><span class="ident" id="679170">s</span><span class="op" id="679171">,</span>&nbsp;<span class="string" id="679173">&#34;\n&#34;</span><span class="op" id="679177">,</span>&nbsp;<span class="num" id="679179">2</span><span class="op" id="679180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="679183">if</span>&nbsp;<span class="builtinfunc" id="679186">len</span><span class="op" id="679189">(</span><span class="ident" id="679190">sp</span><span class="op" id="679192">)</span>&nbsp;<span class="op" id="679194">!=</span>&nbsp;<span class="num" id="679197">2</span>&nbsp;<span class="op" id="679199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="679203">t</span><span class="op" id="679204">.</span><span class="ident" id="679205">Fatalf</span><span class="op" id="679211">(</span><span class="string" id="679212">&#34;expected&nbsp;two&nbsp;lines&nbsp;from&nbsp;cat;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="679249">,</span>&nbsp;<span class="ident" id="679251">s</span><span class="op" id="679252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="679255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="679258">errLine</span><span class="op" id="679265">,</span>&nbsp;<span class="ident" id="679267">body</span>&nbsp;<span class="op" id="679272">:=</span>&nbsp;<span class="ident" id="679275">sp</span><span class="op" id="679277">[</span><span class="num" id="679278">0</span><span class="op" id="679279">]</span><span class="op" id="679280">,</span>&nbsp;<span class="ident" id="679282">sp</span><span class="op" id="679284">[</span><span class="num" id="679285">1</span><span class="op" id="679286">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="679289">if</span>&nbsp;<span class="op" id="679292">!</span><span class="ident" id="679293">strings</span><span class="op" id="679300">.</span><span class="ident" id="679301">HasPrefix</span><span class="op" id="679310">(</span><span class="ident" id="679311">errLine</span><span class="op" id="679318">,</span>&nbsp;<span class="string" id="679320">&#34;Error:&nbsp;open&nbsp;/bogus/file.foo&#34;</span><span class="op" id="679349">)</span>&nbsp;<span class="op" id="679351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="679355">t</span><span class="op" id="679356">.</span><span class="ident" id="679357">Errorf</span><span class="op" id="679363">(</span><span class="string" id="679364">&#34;expected&nbsp;stderr&nbsp;to&nbsp;complain&nbsp;about&nbsp;file;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="679412">,</span>&nbsp;<span class="ident" id="679414">errLine</span><span class="op" id="679421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="679424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="679427">if</span>&nbsp;<span class="op" id="679430">!</span><span class="ident" id="679431">strings</span><span class="op" id="679438">.</span><span class="ident" id="679439">Contains</span><span class="op" id="679447">(</span><span class="ident" id="679448">body</span><span class="op" id="679452">,</span>&nbsp;<span class="string" id="679454">&#34;func&nbsp;TestHelperProcess(t&nbsp;*testing.T)&#34;</span><span class="op" id="679492">)</span>&nbsp;<span class="op" id="679494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="679498">t</span><span class="op" id="679499">.</span><span class="ident" id="679500">Errorf</span><span class="op" id="679506">(</span><span class="string" id="679507">&#34;expected&nbsp;test&nbsp;code;&nbsp;got&nbsp;%q&nbsp;(len&nbsp;%d)&#34;</span><span class="op" id="679544">,</span>&nbsp;<span class="ident" id="679546">body</span><span class="op" id="679550">,</span>&nbsp;<span class="builtinfunc" id="679552">len</span><span class="op" id="679555">(</span><span class="ident" id="679556">body</span><span class="op" id="679560">)</span><span class="op" id="679561">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="679564">}</span><br>
<span class="lineno"></span><span class="op" id="679566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="679569">func</span>&nbsp;<span class="ident" id="679574">TestNoExistBinary</span><span class="op" id="679591">(</span><span class="ident" id="679592">t</span>&nbsp;<span class="op" id="679594">*</span><span class="ident" id="679595">testing</span><span class="op" id="679602">.</span><span class="ident" id="679603">T</span><span class="op" id="679604">)</span>&nbsp;<span class="op" id="679606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="679609">//&nbsp;Can&#39;t&nbsp;run&nbsp;a&nbsp;non-existent&nbsp;binary</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="679645">err</span>&nbsp;<span class="op" id="679649">:=</span>&nbsp;<span class="ident" id="679652">exec</span><span class="op" id="679656">.</span><span class="ident" id="679657">Command</span><span class="op" id="679664">(</span><span class="string" id="679665">&#34;/no-exist-binary&#34;</span><span class="op" id="679683">)</span><span class="op" id="679684">.</span><span class="ident" id="679685">Run</span><span class="op" id="679688">(</span><span class="op" id="679689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="679692">if</span>&nbsp;<span class="ident" id="679695">err</span>&nbsp;<span class="op" id="679699">==</span>&nbsp;<span class="ident" id="679702">nil</span>&nbsp;<span class="op" id="679706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="679710">t</span><span class="op" id="679711">.</span><span class="ident" id="679712">Error</span><span class="op" id="679717">(</span><span class="string" id="679718">&#34;expected&nbsp;error&nbsp;from&nbsp;/no-exist-binary&#34;</span><span class="op" id="679756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="679759">}</span><br>
<span class="lineno"></span><span class="op" id="679761">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="679764">func</span>&nbsp;<span class="ident" id="679769">TestExitStatus</span><span class="op" id="679783">(</span><span class="ident" id="679784">t</span>&nbsp;<span class="op" id="679786">*</span><span class="ident" id="679787">testing</span><span class="op" id="679794">.</span><span class="ident" id="679795">T</span><span class="op" id="679796">)</span>&nbsp;<span class="op" id="679798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="679801">//&nbsp;Test&nbsp;that&nbsp;exit&nbsp;values&nbsp;are&nbsp;returned&nbsp;correctly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="679850">cmd</span>&nbsp;<span class="op" id="679854">:=</span>&nbsp;<span class="ident" id="679857">helperCommand</span><span class="op" id="679870">(</span><span class="ident" id="679871">t</span><span class="op" id="679872">,</span>&nbsp;<span class="string" id="679874">&#34;exit&#34;</span><span class="op" id="679880">,</span>&nbsp;<span class="string" id="679882">&#34;42&#34;</span><span class="op" id="679886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="679889">err</span>&nbsp;<span class="op" id="679893">:=</span>&nbsp;<span class="ident" id="679896">cmd</span><span class="op" id="679899">.</span><span class="ident" id="679900">Run</span><span class="op" id="679903">(</span><span class="op" id="679904">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="679907">want</span>&nbsp;<span class="op" id="679912">:=</span>&nbsp;<span class="string" id="679915">&#34;exit&nbsp;status&nbsp;42&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="679933">switch</span>&nbsp;<span class="ident" id="679940">runtime</span><span class="op" id="679947">.</span><span class="ident" id="679948">GOOS</span>&nbsp;<span class="op" id="679953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="679956">case</span>&nbsp;<span class="string" id="679961">&#34;plan9&#34;</span><span class="op" id="679968">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="679972">want</span>&nbsp;<span class="op" id="679977">=</span>&nbsp;<span class="ident" id="679979">fmt</span><span class="op" id="679982">.</span><span class="ident" id="679983">Sprintf</span><span class="op" id="679990">(</span><span class="string" id="679991">&#34;exit&nbsp;status:&nbsp;&#39;%s&nbsp;%d:&nbsp;42&#39;&#34;</span><span class="op" id="680017">,</span>&nbsp;<span class="ident" id="680019">filepath</span><span class="op" id="680027">.</span><span class="ident" id="680028">Base</span><span class="op" id="680032">(</span><span class="ident" id="680033">cmd</span><span class="op" id="680036">.</span><span class="ident" id="680037">Path</span><span class="op" id="680041">)</span><span class="op" id="680042">,</span>&nbsp;<span class="ident" id="680044">cmd</span><span class="op" id="680047">.</span><span class="ident" id="680048">ProcessState</span><span class="op" id="680060">.</span><span class="ident" id="680061">Pid</span><span class="op" id="680064">(</span><span class="op" id="680065">)</span><span class="op" id="680066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="680069">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="680072">if</span>&nbsp;<span class="ident" id="680075">werr</span><span class="op" id="680079">,</span>&nbsp;<span class="ident" id="680081">ok</span>&nbsp;<span class="op" id="680084">:=</span>&nbsp;<span class="ident" id="680087">err</span><span class="op" id="680090">.</span><span class="op" id="680091">(</span><span class="op" id="680092">*</span><span class="ident" id="680093">exec</span><span class="op" id="680097">.</span><span class="ident" id="680098">ExitError</span><span class="op" id="680107">)</span><span class="op" id="680108">;</span>&nbsp;<span class="ident" id="680110">ok</span>&nbsp;<span class="op" id="680113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="680117">if</span>&nbsp;<span class="ident" id="680120">s</span>&nbsp;<span class="op" id="680122">:=</span>&nbsp;<span class="ident" id="680125">werr</span><span class="op" id="680129">.</span><span class="ident" id="680130">Error</span><span class="op" id="680135">(</span><span class="op" id="680136">)</span><span class="op" id="680137">;</span>&nbsp;<span class="ident" id="680139">s</span>&nbsp;<span class="op" id="680141">!=</span>&nbsp;<span class="ident" id="680144">want</span>&nbsp;<span class="op" id="680149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="680154">t</span><span class="op" id="680155">.</span><span class="ident" id="680156">Errorf</span><span class="op" id="680162">(</span><span class="string" id="680163">&#34;from&nbsp;exit&nbsp;42&nbsp;got&nbsp;exit&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="680198">,</span>&nbsp;<span class="ident" id="680200">s</span><span class="op" id="680201">,</span>&nbsp;<span class="ident" id="680203">want</span><span class="op" id="680207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="680211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="680214">}</span>&nbsp;<span class="keyword" id="680216">else</span>&nbsp;<span class="op" id="680221">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="680225">t</span><span class="op" id="680226">.</span><span class="ident" id="680227">Fatalf</span><span class="op" id="680233">(</span><span class="string" id="680234">&#34;expected&nbsp;*exec.ExitError&nbsp;from&nbsp;exit&nbsp;42;&nbsp;got&nbsp;%T:&nbsp;%v&#34;</span><span class="op" id="680285">,</span>&nbsp;<span class="ident" id="680287">err</span><span class="op" id="680290">,</span>&nbsp;<span class="ident" id="680292">err</span><span class="op" id="680295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="680298">}</span><br>
<span class="lineno"></span><span class="op" id="680300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="680303">func</span>&nbsp;<span class="ident" id="680308">TestPipes</span><span class="op" id="680317">(</span><span class="ident" id="680318">t</span>&nbsp;<span class="op" id="680320">*</span><span class="ident" id="680321">testing</span><span class="op" id="680328">.</span><span class="ident" id="680329">T</span><span class="op" id="680330">)</span>&nbsp;<span class="op" id="680332">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="680335">check</span>&nbsp;<span class="op" id="680341">:=</span>&nbsp;<span class="keyword" id="680344">func</span><span class="op" id="680348">(</span><span class="ident" id="680349">what</span>&nbsp;<span class="builtintype" id="680354">string</span><span class="op" id="680360">,</span>&nbsp;<span class="ident" id="680362">err</span>&nbsp;<span class="builtintype" id="680366">error</span><span class="op" id="680371">)</span>&nbsp;<span class="op" id="680373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="680377">if</span>&nbsp;<span class="ident" id="680380">err</span>&nbsp;<span class="op" id="680384">!=</span>&nbsp;<span class="ident" id="680387">nil</span>&nbsp;<span class="op" id="680391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="680396">t</span><span class="op" id="680397">.</span><span class="ident" id="680398">Fatalf</span><span class="op" id="680404">(</span><span class="string" id="680405">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="680413">,</span>&nbsp;<span class="ident" id="680415">what</span><span class="op" id="680419">,</span>&nbsp;<span class="ident" id="680421">err</span><span class="op" id="680424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="680428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="680431">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="680434">//&nbsp;Cat,&nbsp;testing&nbsp;stdin&nbsp;and&nbsp;stdout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="680469">c</span>&nbsp;<span class="op" id="680471">:=</span>&nbsp;<span class="ident" id="680474">helperCommand</span><span class="op" id="680487">(</span><span class="ident" id="680488">t</span><span class="op" id="680489">,</span>&nbsp;<span class="string" id="680491">&#34;pipetest&#34;</span><span class="op" id="680501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="680504">stdin</span><span class="op" id="680509">,</span>&nbsp;<span class="ident" id="680511">err</span>&nbsp;<span class="op" id="680515">:=</span>&nbsp;<span class="ident" id="680518">c</span><span class="op" id="680519">.</span><span class="ident" id="680520">StdinPipe</span><span class="op" id="680529">(</span><span class="op" id="680530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="680533">check</span><span class="op" id="680538">(</span><span class="string" id="680539">&#34;StdinPipe&#34;</span><span class="op" id="680550">,</span>&nbsp;<span class="ident" id="680552">err</span><span class="op" id="680555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="680558">stdout</span><span class="op" id="680564">,</span>&nbsp;<span class="ident" id="680566">err</span>&nbsp;<span class="op" id="680570">:=</span>&nbsp;<span class="ident" id="680573">c</span><span class="op" id="680574">.</span><span class="ident" id="680575">StdoutPipe</span><span class="op" id="680585">(</span><span class="op" id="680586">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="680589">check</span><span class="op" id="680594">(</span><span class="string" id="680595">&#34;StdoutPipe&#34;</span><span class="op" id="680607">,</span>&nbsp;<span class="ident" id="680609">err</span><span class="op" id="680612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="680615">stderr</span><span class="op" id="680621">,</span>&nbsp;<span class="ident" id="680623">err</span>&nbsp;<span class="op" id="680627">:=</span>&nbsp;<span class="ident" id="680630">c</span><span class="op" id="680631">.</span><span class="ident" id="680632">StderrPipe</span><span class="op" id="680642">(</span><span class="op" id="680643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="680646">check</span><span class="op" id="680651">(</span><span class="string" id="680652">&#34;StderrPipe&#34;</span><span class="op" id="680664">,</span>&nbsp;<span class="ident" id="680666">err</span><span class="op" id="680669">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="680673">outbr</span>&nbsp;<span class="op" id="680679">:=</span>&nbsp;<span class="ident" id="680682">bufio</span><span class="op" id="680687">.</span><span class="ident" id="680688">NewReader</span><span class="op" id="680697">(</span><span class="ident" id="680698">stdout</span><span class="op" id="680704">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="680707">errbr</span>&nbsp;<span class="op" id="680713">:=</span>&nbsp;<span class="ident" id="680716">bufio</span><span class="op" id="680721">.</span><span class="ident" id="680722">NewReader</span><span class="op" id="680731">(</span><span class="ident" id="680732">stderr</span><span class="op" id="680738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="680741">line</span>&nbsp;<span class="op" id="680746">:=</span>&nbsp;<span class="keyword" id="680749">func</span><span class="op" id="680753">(</span><span class="ident" id="680754">what</span>&nbsp;<span class="builtintype" id="680759">string</span><span class="op" id="680765">,</span>&nbsp;<span class="ident" id="680767">br</span>&nbsp;<span class="op" id="680770">*</span><span class="ident" id="680771">bufio</span><span class="op" id="680776">.</span><span class="ident" id="680777">Reader</span><span class="op" id="680783">)</span>&nbsp;<span class="builtintype" id="680785">string</span>&nbsp;<span class="op" id="680792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="680796">line</span><span class="op" id="680800">,</span>&nbsp;<span class="ident" id="680802">_</span><span class="op" id="680803">,</span>&nbsp;<span class="ident" id="680805">err</span>&nbsp;<span class="op" id="680809">:=</span>&nbsp;<span class="ident" id="680812">br</span><span class="op" id="680814">.</span><span class="ident" id="680815">ReadLine</span><span class="op" id="680823">(</span><span class="op" id="680824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="680828">if</span>&nbsp;<span class="ident" id="680831">err</span>&nbsp;<span class="op" id="680835">!=</span>&nbsp;<span class="ident" id="680838">nil</span>&nbsp;<span class="op" id="680842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="680847">t</span><span class="op" id="680848">.</span><span class="ident" id="680849">Fatalf</span><span class="op" id="680855">(</span><span class="string" id="680856">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="680864">,</span>&nbsp;<span class="ident" id="680866">what</span><span class="op" id="680870">,</span>&nbsp;<span class="ident" id="680872">err</span><span class="op" id="680875">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="680879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="680883">return</span>&nbsp;<span class="builtintype" id="680890">string</span><span class="op" id="680896">(</span><span class="ident" id="680897">line</span><span class="op" id="680901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="680904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="680908">err</span>&nbsp;<span class="op" id="680912">=</span>&nbsp;<span class="ident" id="680914">c</span><span class="op" id="680915">.</span><span class="ident" id="680916">Start</span><span class="op" id="680921">(</span><span class="op" id="680922">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="680925">check</span><span class="op" id="680930">(</span><span class="string" id="680931">&#34;Start&#34;</span><span class="op" id="680938">,</span>&nbsp;<span class="ident" id="680940">err</span><span class="op" id="680943">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="680947">_</span><span class="op" id="680948">,</span>&nbsp;<span class="ident" id="680950">err</span>&nbsp;<span class="op" id="680954">=</span>&nbsp;<span class="ident" id="680956">stdin</span><span class="op" id="680961">.</span><span class="ident" id="680962">Write</span><span class="op" id="680967">(</span><span class="op" id="680968">[</span><span class="op" id="680969">]</span><span class="builtintype" id="680970">byte</span><span class="op" id="680974">(</span><span class="string" id="680975">&#34;O:I&nbsp;am&nbsp;output\n&#34;</span><span class="op" id="680992">)</span><span class="op" id="680993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="680996">check</span><span class="op" id="681001">(</span><span class="string" id="681002">&#34;first&nbsp;stdin&nbsp;Write&#34;</span><span class="op" id="681021">,</span>&nbsp;<span class="ident" id="681023">err</span><span class="op" id="681026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="681029">if</span>&nbsp;<span class="ident" id="681032">g</span><span class="op" id="681033">,</span>&nbsp;<span class="ident" id="681035">e</span>&nbsp;<span class="op" id="681037">:=</span>&nbsp;<span class="ident" id="681040">line</span><span class="op" id="681044">(</span><span class="string" id="681045">&#34;first&nbsp;output&nbsp;line&#34;</span><span class="op" id="681064">,</span>&nbsp;<span class="ident" id="681066">outbr</span><span class="op" id="681071">)</span><span class="op" id="681072">,</span>&nbsp;<span class="string" id="681074">&#34;O:I&nbsp;am&nbsp;output&#34;</span><span class="op" id="681089">;</span>&nbsp;<span class="ident" id="681091">g</span>&nbsp;<span class="op" id="681093">!=</span>&nbsp;<span class="ident" id="681096">e</span>&nbsp;<span class="op" id="681098">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="681102">t</span><span class="op" id="681103">.</span><span class="ident" id="681104">Errorf</span><span class="op" id="681110">(</span><span class="string" id="681111">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="681128">,</span>&nbsp;<span class="ident" id="681130">g</span><span class="op" id="681131">,</span>&nbsp;<span class="ident" id="681133">e</span><span class="op" id="681134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="681137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="681141">_</span><span class="op" id="681142">,</span>&nbsp;<span class="ident" id="681144">err</span>&nbsp;<span class="op" id="681148">=</span>&nbsp;<span class="ident" id="681150">stdin</span><span class="op" id="681155">.</span><span class="ident" id="681156">Write</span><span class="op" id="681161">(</span><span class="op" id="681162">[</span><span class="op" id="681163">]</span><span class="builtintype" id="681164">byte</span><span class="op" id="681168">(</span><span class="string" id="681169">&#34;E:I&nbsp;am&nbsp;error\n&#34;</span><span class="op" id="681185">)</span><span class="op" id="681186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="681189">check</span><span class="op" id="681194">(</span><span class="string" id="681195">&#34;second&nbsp;stdin&nbsp;Write&#34;</span><span class="op" id="681215">,</span>&nbsp;<span class="ident" id="681217">err</span><span class="op" id="681220">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="681223">if</span>&nbsp;<span class="ident" id="681226">g</span><span class="op" id="681227">,</span>&nbsp;<span class="ident" id="681229">e</span>&nbsp;<span class="op" id="681231">:=</span>&nbsp;<span class="ident" id="681234">line</span><span class="op" id="681238">(</span><span class="string" id="681239">&#34;first&nbsp;error&nbsp;line&#34;</span><span class="op" id="681257">,</span>&nbsp;<span class="ident" id="681259">errbr</span><span class="op" id="681264">)</span><span class="op" id="681265">,</span>&nbsp;<span class="string" id="681267">&#34;E:I&nbsp;am&nbsp;error&#34;</span><span class="op" id="681281">;</span>&nbsp;<span class="ident" id="681283">g</span>&nbsp;<span class="op" id="681285">!=</span>&nbsp;<span class="ident" id="681288">e</span>&nbsp;<span class="op" id="681290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="681294">t</span><span class="op" id="681295">.</span><span class="ident" id="681296">Errorf</span><span class="op" id="681302">(</span><span class="string" id="681303">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="681320">,</span>&nbsp;<span class="ident" id="681322">g</span><span class="op" id="681323">,</span>&nbsp;<span class="ident" id="681325">e</span><span class="op" id="681326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="681329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="681333">_</span><span class="op" id="681334">,</span>&nbsp;<span class="ident" id="681336">err</span>&nbsp;<span class="op" id="681340">=</span>&nbsp;<span class="ident" id="681342">stdin</span><span class="op" id="681347">.</span><span class="ident" id="681348">Write</span><span class="op" id="681353">(</span><span class="op" id="681354">[</span><span class="op" id="681355">]</span><span class="builtintype" id="681356">byte</span><span class="op" id="681360">(</span><span class="string" id="681361">&#34;O:I&nbsp;am&nbsp;output2\n&#34;</span><span class="op" id="681379">)</span><span class="op" id="681380">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="681383">check</span><span class="op" id="681388">(</span><span class="string" id="681389">&#34;third&nbsp;stdin&nbsp;Write&nbsp;3&#34;</span><span class="op" id="681410">,</span>&nbsp;<span class="ident" id="681412">err</span><span class="op" id="681415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="681418">if</span>&nbsp;<span class="ident" id="681421">g</span><span class="op" id="681422">,</span>&nbsp;<span class="ident" id="681424">e</span>&nbsp;<span class="op" id="681426">:=</span>&nbsp;<span class="ident" id="681429">line</span><span class="op" id="681433">(</span><span class="string" id="681434">&#34;second&nbsp;output&nbsp;line&#34;</span><span class="op" id="681454">,</span>&nbsp;<span class="ident" id="681456">outbr</span><span class="op" id="681461">)</span><span class="op" id="681462">,</span>&nbsp;<span class="string" id="681464">&#34;O:I&nbsp;am&nbsp;output2&#34;</span><span class="op" id="681480">;</span>&nbsp;<span class="ident" id="681482">g</span>&nbsp;<span class="op" id="681484">!=</span>&nbsp;<span class="ident" id="681487">e</span>&nbsp;<span class="op" id="681489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="681493">t</span><span class="op" id="681494">.</span><span class="ident" id="681495">Errorf</span><span class="op" id="681501">(</span><span class="string" id="681502">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="681519">,</span>&nbsp;<span class="ident" id="681521">g</span><span class="op" id="681522">,</span>&nbsp;<span class="ident" id="681524">e</span><span class="op" id="681525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="681528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="681532">stdin</span><span class="op" id="681537">.</span><span class="ident" id="681538">Close</span><span class="op" id="681543">(</span><span class="op" id="681544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="681547">err</span>&nbsp;<span class="op" id="681551">=</span>&nbsp;<span class="ident" id="681553">c</span><span class="op" id="681554">.</span><span class="ident" id="681555">Wait</span><span class="op" id="681559">(</span><span class="op" id="681560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="681563">check</span><span class="op" id="681568">(</span><span class="string" id="681569">&#34;Wait&#34;</span><span class="op" id="681575">,</span>&nbsp;<span class="ident" id="681577">err</span><span class="op" id="681580">)</span><br>
<span class="lineno"></span><span class="op" id="681582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="681585">const</span>&nbsp;<span class="ident" id="681591">stdinCloseTestString</span>&nbsp;<span class="op" id="681612">=</span>&nbsp;<span class="string" id="681614">&#34;Some&nbsp;test&nbsp;string.&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="681635">//&nbsp;Issue&nbsp;6270.</span><br>
<span class="lineno"></span><span class="keyword" id="681650">func</span>&nbsp;<span class="ident" id="681655">TestStdinClose</span><span class="op" id="681669">(</span><span class="ident" id="681670">t</span>&nbsp;<span class="op" id="681672">*</span><span class="ident" id="681673">testing</span><span class="op" id="681680">.</span><span class="ident" id="681681">T</span><span class="op" id="681682">)</span>&nbsp;<span class="op" id="681684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="681687">check</span>&nbsp;<span class="op" id="681693">:=</span>&nbsp;<span class="keyword" id="681696">func</span><span class="op" id="681700">(</span><span class="ident" id="681701">what</span>&nbsp;<span class="builtintype" id="681706">string</span><span class="op" id="681712">,</span>&nbsp;<span class="ident" id="681714">err</span>&nbsp;<span class="builtintype" id="681718">error</span><span class="op" id="681723">)</span>&nbsp;<span class="op" id="681725">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="681729">if</span>&nbsp;<span class="ident" id="681732">err</span>&nbsp;<span class="op" id="681736">!=</span>&nbsp;<span class="ident" id="681739">nil</span>&nbsp;<span class="op" id="681743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="681748">t</span><span class="op" id="681749">.</span><span class="ident" id="681750">Fatalf</span><span class="op" id="681756">(</span><span class="string" id="681757">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="681765">,</span>&nbsp;<span class="ident" id="681767">what</span><span class="op" id="681771">,</span>&nbsp;<span class="ident" id="681773">err</span><span class="op" id="681776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="681780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="681783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="681786">cmd</span>&nbsp;<span class="op" id="681790">:=</span>&nbsp;<span class="ident" id="681793">helperCommand</span><span class="op" id="681806">(</span><span class="ident" id="681807">t</span><span class="op" id="681808">,</span>&nbsp;<span class="string" id="681810">&#34;stdinClose&#34;</span><span class="op" id="681822">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="681825">stdin</span><span class="op" id="681830">,</span>&nbsp;<span class="ident" id="681832">err</span>&nbsp;<span class="op" id="681836">:=</span>&nbsp;<span class="ident" id="681839">cmd</span><span class="op" id="681842">.</span><span class="ident" id="681843">StdinPipe</span><span class="op" id="681852">(</span><span class="op" id="681853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="681856">check</span><span class="op" id="681861">(</span><span class="string" id="681862">&#34;StdinPipe&#34;</span><span class="op" id="681873">,</span>&nbsp;<span class="ident" id="681875">err</span><span class="op" id="681878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="681881">//&nbsp;Check&nbsp;that&nbsp;we&nbsp;can&nbsp;access&nbsp;methods&nbsp;of&nbsp;the&nbsp;underlying&nbsp;os.File.`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="681946">if</span>&nbsp;<span class="ident" id="681949">_</span><span class="op" id="681950">,</span>&nbsp;<span class="ident" id="681952">ok</span>&nbsp;<span class="op" id="681955">:=</span>&nbsp;<span class="ident" id="681958">stdin</span><span class="op" id="681963">.</span><span class="op" id="681964">(</span><span class="keyword" id="681965">interface</span>&nbsp;<span class="op" id="681975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="681979">Fd</span><span class="op" id="681981">(</span><span class="op" id="681982">)</span>&nbsp;<span class="builtintype" id="681984">uintptr</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="681993">}</span><span class="op" id="681994">)</span><span class="op" id="681995">;</span>&nbsp;<span class="op" id="681997">!</span><span class="ident" id="681998">ok</span>&nbsp;<span class="op" id="682001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="682005">t</span><span class="op" id="682006">.</span><span class="ident" id="682007">Error</span><span class="op" id="682012">(</span><span class="string" id="682013">&#34;can&#39;t&nbsp;access&nbsp;methods&nbsp;of&nbsp;underlying&nbsp;*os.File&#34;</span><span class="op" id="682058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="682061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="682064">check</span><span class="op" id="682069">(</span><span class="string" id="682070">&#34;Start&#34;</span><span class="op" id="682077">,</span>&nbsp;<span class="ident" id="682079">cmd</span><span class="op" id="682082">.</span><span class="ident" id="682083">Start</span><span class="op" id="682088">(</span><span class="op" id="682089">)</span><span class="op" id="682090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="682093">go</span>&nbsp;<span class="keyword" id="682096">func</span><span class="op" id="682100">(</span><span class="op" id="682101">)</span>&nbsp;<span class="op" id="682103">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="682107">_</span><span class="op" id="682108">,</span>&nbsp;<span class="ident" id="682110">err</span>&nbsp;<span class="op" id="682114">:=</span>&nbsp;<span class="ident" id="682117">io</span><span class="op" id="682119">.</span><span class="ident" id="682120">Copy</span><span class="op" id="682124">(</span><span class="ident" id="682125">stdin</span><span class="op" id="682130">,</span>&nbsp;<span class="ident" id="682132">strings</span><span class="op" id="682139">.</span><span class="ident" id="682140">NewReader</span><span class="op" id="682149">(</span><span class="ident" id="682150">stdinCloseTestString</span><span class="op" id="682170">)</span><span class="op" id="682171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="682175">check</span><span class="op" id="682180">(</span><span class="string" id="682181">&#34;Copy&#34;</span><span class="op" id="682187">,</span>&nbsp;<span class="ident" id="682189">err</span><span class="op" id="682192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="682196">//&nbsp;Before&nbsp;the&nbsp;fix,&nbsp;this&nbsp;next&nbsp;line&nbsp;would&nbsp;race&nbsp;with&nbsp;cmd.Wait.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="682258">check</span><span class="op" id="682263">(</span><span class="string" id="682264">&#34;Close&#34;</span><span class="op" id="682271">,</span>&nbsp;<span class="ident" id="682273">stdin</span><span class="op" id="682278">.</span><span class="ident" id="682279">Close</span><span class="op" id="682284">(</span><span class="op" id="682285">)</span><span class="op" id="682286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="682289">}</span><span class="op" id="682290">(</span><span class="op" id="682291">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="682294">check</span><span class="op" id="682299">(</span><span class="string" id="682300">&#34;Wait&#34;</span><span class="op" id="682306">,</span>&nbsp;<span class="ident" id="682308">cmd</span><span class="op" id="682311">.</span><span class="ident" id="682312">Wait</span><span class="op" id="682316">(</span><span class="op" id="682317">)</span><span class="op" id="682318">)</span><br>
<span class="lineno"></span><span class="op" id="682320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="682323">//&nbsp;Issue&nbsp;5071</span><br>
<span class="lineno"></span><span class="keyword" id="682337">func</span>&nbsp;<span class="ident" id="682342">TestPipeLookPathLeak</span><span class="op" id="682362">(</span><span class="ident" id="682363">t</span>&nbsp;<span class="op" id="682365">*</span><span class="ident" id="682366">testing</span><span class="op" id="682373">.</span><span class="ident" id="682374">T</span><span class="op" id="682375">)</span>&nbsp;<span class="op" id="682377">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="682380">fd0</span><span class="op" id="682383">,</span>&nbsp;<span class="ident" id="682385">lsof0</span>&nbsp;<span class="op" id="682391">:=</span>&nbsp;<span class="ident" id="682394">numOpenFDS</span><span class="op" id="682404">(</span><span class="ident" id="682405">t</span><span class="op" id="682406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="682409">for</span>&nbsp;<span class="ident" id="682413">i</span>&nbsp;<span class="op" id="682415">:=</span>&nbsp;<span class="num" id="682418">0</span><span class="op" id="682419">;</span>&nbsp;<span class="ident" id="682421">i</span>&nbsp;<span class="op" id="682423">&lt;</span>&nbsp;<span class="num" id="682425">4</span><span class="op" id="682426">;</span>&nbsp;<span class="ident" id="682428">i</span><span class="op" id="682429">++</span>&nbsp;<span class="op" id="682432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="682436">cmd</span>&nbsp;<span class="op" id="682440">:=</span>&nbsp;<span class="ident" id="682443">exec</span><span class="op" id="682447">.</span><span class="ident" id="682448">Command</span><span class="op" id="682455">(</span><span class="string" id="682456">&#34;something-that-does-not-exist-binary&#34;</span><span class="op" id="682494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="682498">cmd</span><span class="op" id="682501">.</span><span class="ident" id="682502">StdoutPipe</span><span class="op" id="682512">(</span><span class="op" id="682513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="682517">cmd</span><span class="op" id="682520">.</span><span class="ident" id="682521">StderrPipe</span><span class="op" id="682531">(</span><span class="op" id="682532">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="682536">cmd</span><span class="op" id="682539">.</span><span class="ident" id="682540">StdinPipe</span><span class="op" id="682549">(</span><span class="op" id="682550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="682554">if</span>&nbsp;<span class="ident" id="682557">err</span>&nbsp;<span class="op" id="682561">:=</span>&nbsp;<span class="ident" id="682564">cmd</span><span class="op" id="682567">.</span><span class="ident" id="682568">Run</span><span class="op" id="682571">(</span><span class="op" id="682572">)</span><span class="op" id="682573">;</span>&nbsp;<span class="ident" id="682575">err</span>&nbsp;<span class="op" id="682579">==</span>&nbsp;<span class="ident" id="682582">nil</span>&nbsp;<span class="op" id="682586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="682591">t</span><span class="op" id="682592">.</span><span class="ident" id="682593">Fatal</span><span class="op" id="682598">(</span><span class="string" id="682599">&#34;unexpected&nbsp;success&#34;</span><span class="op" id="682619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="682623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="682626">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="682629">for</span>&nbsp;<span class="ident" id="682633">triesLeft</span>&nbsp;<span class="op" id="682643">:=</span>&nbsp;<span class="num" id="682646">3</span><span class="op" id="682647">;</span>&nbsp;<span class="ident" id="682649">triesLeft</span>&nbsp;<span class="op" id="682659">&gt;=</span>&nbsp;<span class="num" id="682662">0</span><span class="op" id="682663">;</span>&nbsp;<span class="ident" id="682665">triesLeft</span><span class="op" id="682674">--</span>&nbsp;<span class="op" id="682677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="682681">open</span><span class="op" id="682685">,</span>&nbsp;<span class="ident" id="682687">lsof</span>&nbsp;<span class="op" id="682692">:=</span>&nbsp;<span class="ident" id="682695">numOpenFDS</span><span class="op" id="682705">(</span><span class="ident" id="682706">t</span><span class="op" id="682707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="682711">fdGrowth</span>&nbsp;<span class="op" id="682720">:=</span>&nbsp;<span class="ident" id="682723">open</span>&nbsp;<span class="op" id="682728">-</span>&nbsp;<span class="ident" id="682730">fd0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="682736">if</span>&nbsp;<span class="ident" id="682739">fdGrowth</span>&nbsp;<span class="op" id="682748">&gt;</span>&nbsp;<span class="num" id="682750">2</span>&nbsp;<span class="op" id="682752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="682757">if</span>&nbsp;<span class="ident" id="682760">triesLeft</span>&nbsp;<span class="op" id="682770">&gt;</span>&nbsp;<span class="num" id="682772">0</span>&nbsp;<span class="op" id="682774">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="682780">//&nbsp;Work&nbsp;around&nbsp;what&nbsp;appears&nbsp;to&nbsp;be&nbsp;a&nbsp;race&nbsp;with&nbsp;Linux&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="682838">//&nbsp;proc&nbsp;filesystem&nbsp;(as&nbsp;used&nbsp;by&nbsp;lsof).&nbsp;It&nbsp;seems&nbsp;to&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="682897">//&nbsp;be&nbsp;eventually&nbsp;consistent.&nbsp;Give&nbsp;it&nbsp;awhile&nbsp;to&nbsp;settle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="682956">//&nbsp;See&nbsp;golang.org/issue/7808</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="682989">time</span><span class="op" id="682993">.</span><span class="ident" id="682994">Sleep</span><span class="op" id="682999">(</span><span class="num" id="683000">100</span>&nbsp;<span class="op" id="683004">*</span>&nbsp;<span class="ident" id="683006">time</span><span class="op" id="683010">.</span><span class="ident" id="683011">Millisecond</span><span class="op" id="683022">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="683028">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="683040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="683045">t</span><span class="op" id="683046">.</span><span class="ident" id="683047">Errorf</span><span class="op" id="683053">(</span><span class="string" id="683054">&#34;leaked&nbsp;%d&nbsp;fds;&nbsp;want&nbsp;~0;&nbsp;have:\n%s\noriginally:\n%s&#34;</span><span class="op" id="683106">,</span>&nbsp;<span class="ident" id="683108">fdGrowth</span><span class="op" id="683116">,</span>&nbsp;<span class="ident" id="683118">lsof</span><span class="op" id="683122">,</span>&nbsp;<span class="ident" id="683124">lsof0</span><span class="op" id="683129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="683133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="683137">break</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="683144">}</span><br>
<span class="lineno"></span><span class="op" id="683146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="683149">func</span>&nbsp;<span class="ident" id="683154">numOpenFDS</span><span class="op" id="683164">(</span><span class="ident" id="683165">t</span>&nbsp;<span class="op" id="683167">*</span><span class="ident" id="683168">testing</span><span class="op" id="683175">.</span><span class="ident" id="683176">T</span><span class="op" id="683177">)</span>&nbsp;<span class="op" id="683179">(</span><span class="ident" id="683180">n</span>&nbsp;<span class="builtintype" id="683182">int</span><span class="op" id="683185">,</span>&nbsp;<span class="ident" id="683187">lsof</span>&nbsp;<span class="op" id="683192">[</span><span class="op" id="683193">]</span><span class="builtintype" id="683194">byte</span><span class="op" id="683198">)</span>&nbsp;<span class="op" id="683200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="683203">lsof</span><span class="op" id="683207">,</span>&nbsp;<span class="ident" id="683209">err</span>&nbsp;<span class="op" id="683213">:=</span>&nbsp;<span class="ident" id="683216">exec</span><span class="op" id="683220">.</span><span class="ident" id="683221">Command</span><span class="op" id="683228">(</span><span class="string" id="683229">&#34;lsof&#34;</span><span class="op" id="683235">,</span>&nbsp;<span class="string" id="683237">&#34;-b&#34;</span><span class="op" id="683241">,</span>&nbsp;<span class="string" id="683243">&#34;-n&#34;</span><span class="op" id="683247">,</span>&nbsp;<span class="string" id="683249">&#34;-p&#34;</span><span class="op" id="683253">,</span>&nbsp;<span class="ident" id="683255">strconv</span><span class="op" id="683262">.</span><span class="ident" id="683263">Itoa</span><span class="op" id="683267">(</span><span class="ident" id="683268">os</span><span class="op" id="683270">.</span><span class="ident" id="683271">Getpid</span><span class="op" id="683277">(</span><span class="op" id="683278">)</span><span class="op" id="683279">)</span><span class="op" id="683280">)</span><span class="op" id="683281">.</span><span class="ident" id="683282">Output</span><span class="op" id="683288">(</span><span class="op" id="683289">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="683292">if</span>&nbsp;<span class="ident" id="683295">err</span>&nbsp;<span class="op" id="683299">!=</span>&nbsp;<span class="ident" id="683302">nil</span>&nbsp;<span class="op" id="683306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="683310">t</span><span class="op" id="683311">.</span><span class="ident" id="683312">Skip</span><span class="op" id="683316">(</span><span class="string" id="683317">&#34;skipping&nbsp;test;&nbsp;error&nbsp;finding&nbsp;or&nbsp;running&nbsp;lsof&#34;</span><span class="op" id="683363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="683366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="683369">return</span>&nbsp;<span class="ident" id="683376">bytes</span><span class="op" id="683381">.</span><span class="ident" id="683382">Count</span><span class="op" id="683387">(</span><span class="ident" id="683388">lsof</span><span class="op" id="683392">,</span>&nbsp;<span class="op" id="683394">[</span><span class="op" id="683395">]</span><span class="builtintype" id="683396">byte</span><span class="op" id="683400">(</span><span class="string" id="683401">&#34;\n&#34;</span><span class="op" id="683405">)</span><span class="op" id="683406">)</span><span class="op" id="683407">,</span>&nbsp;<span class="ident" id="683409">lsof</span><br>
<span class="lineno"></span><span class="op" id="683414">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="683417">var</span>&nbsp;<span class="ident" id="683421">testedAlreadyLeaked</span>&nbsp;<span class="op" id="683441">=</span>&nbsp;<span class="ident" id="683443">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="683450">//&nbsp;basefds&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;expected&nbsp;file&nbsp;descriptors</span><br>
<span class="lineno"></span><span class="comment" id="683509">//&nbsp;to&nbsp;be&nbsp;present&nbsp;in&nbsp;a&nbsp;process&nbsp;at&nbsp;start.</span><br>
<span class="lineno">260</span><span class="keyword" id="683549">func</span>&nbsp;<span class="ident" id="683554">basefds</span><span class="op" id="683561">(</span><span class="op" id="683562">)</span>&nbsp;<span class="builtintype" id="683564">uintptr</span>&nbsp;<span class="op" id="683572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="683575">return</span>&nbsp;<span class="ident" id="683582">os</span><span class="op" id="683584">.</span><span class="ident" id="683585">Stderr</span><span class="op" id="683591">.</span><span class="ident" id="683592">Fd</span><span class="op" id="683594">(</span><span class="op" id="683595">)</span>&nbsp;<span class="op" id="683597">+</span>&nbsp;<span class="num" id="683599">1</span><br>
<span class="lineno"></span><span class="op" id="683601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="683604">func</span>&nbsp;<span class="ident" id="683609">closeUnexpectedFds</span><span class="op" id="683627">(</span><span class="ident" id="683628">t</span>&nbsp;<span class="op" id="683630">*</span><span class="ident" id="683631">testing</span><span class="op" id="683638">.</span><span class="ident" id="683639">T</span><span class="op" id="683640">,</span>&nbsp;<span class="ident" id="683642">m</span>&nbsp;<span class="builtintype" id="683644">string</span><span class="op" id="683650">)</span>&nbsp;<span class="op" id="683652">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="683655">for</span>&nbsp;<span class="ident" id="683659">fd</span>&nbsp;<span class="op" id="683662">:=</span>&nbsp;<span class="ident" id="683665">basefds</span><span class="op" id="683672">(</span><span class="op" id="683673">)</span><span class="op" id="683674">;</span>&nbsp;<span class="ident" id="683676">fd</span>&nbsp;<span class="op" id="683679">&lt;=</span>&nbsp;<span class="num" id="683682">101</span><span class="op" id="683685">;</span>&nbsp;<span class="ident" id="683687">fd</span><span class="op" id="683689">++</span>&nbsp;<span class="op" id="683692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="683696">err</span>&nbsp;<span class="op" id="683700">:=</span>&nbsp;<span class="ident" id="683703">os</span><span class="op" id="683705">.</span><span class="ident" id="683706">NewFile</span><span class="op" id="683713">(</span><span class="ident" id="683714">fd</span><span class="op" id="683716">,</span>&nbsp;<span class="string" id="683718">&#34;&#34;</span><span class="op" id="683720">)</span><span class="op" id="683721">.</span><span class="ident" id="683722">Close</span><span class="op" id="683727">(</span><span class="op" id="683728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="683732">if</span>&nbsp;<span class="ident" id="683735">err</span>&nbsp;<span class="op" id="683739">==</span>&nbsp;<span class="ident" id="683742">nil</span>&nbsp;<span class="op" id="683746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="683751">t</span><span class="op" id="683752">.</span><span class="ident" id="683753">Logf</span><span class="op" id="683757">(</span><span class="string" id="683758">&#34;%s:&nbsp;Something&nbsp;already&nbsp;leaked&nbsp;-&nbsp;closed&nbsp;fd&nbsp;%d&#34;</span><span class="op" id="683803">,</span>&nbsp;<span class="ident" id="683805">m</span><span class="op" id="683806">,</span>&nbsp;<span class="ident" id="683808">fd</span><span class="op" id="683810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="683814">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="683817">}</span><br>
<span class="lineno"></span><span class="op" id="683819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="683822">func</span>&nbsp;<span class="ident" id="683827">TestExtraFilesFDShuffle</span><span class="op" id="683850">(</span><span class="ident" id="683851">t</span>&nbsp;<span class="op" id="683853">*</span><span class="ident" id="683854">testing</span><span class="op" id="683861">.</span><span class="ident" id="683862">T</span><span class="op" id="683863">)</span>&nbsp;<span class="op" id="683865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="683868">t</span><span class="op" id="683869">.</span><span class="ident" id="683870">Skip</span><span class="op" id="683874">(</span><span class="string" id="683875">&#34;flaky&nbsp;test;&nbsp;see&nbsp;http://golang.org/issue/5780&#34;</span><span class="op" id="683921">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="683924">switch</span>&nbsp;<span class="ident" id="683931">runtime</span><span class="op" id="683938">.</span><span class="ident" id="683939">GOOS</span>&nbsp;<span class="op" id="683944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="683947">case</span>&nbsp;<span class="string" id="683952">&#34;darwin&#34;</span><span class="op" id="683960">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="683964">//&nbsp;TODO(cnicolaou):&nbsp;http://golang.org/issue/2603</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="684015">//&nbsp;leads&nbsp;to&nbsp;leaked&nbsp;file&nbsp;descriptors&nbsp;in&nbsp;this&nbsp;test&nbsp;when&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="684076">//&nbsp;run&nbsp;from&nbsp;a&nbsp;builder.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="684101">closeUnexpectedFds</span><span class="op" id="684119">(</span><span class="ident" id="684120">t</span><span class="op" id="684121">,</span>&nbsp;<span class="string" id="684123">&#34;TestExtraFilesFDShuffle&#34;</span><span class="op" id="684148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="684151">case</span>&nbsp;<span class="string" id="684156">&#34;netbsd&#34;</span><span class="op" id="684164">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="684168">//&nbsp;http://golang.org/issue/3955</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="684202">closeUnexpectedFds</span><span class="op" id="684220">(</span><span class="ident" id="684221">t</span><span class="op" id="684222">,</span>&nbsp;<span class="string" id="684224">&#34;TestExtraFilesFDShuffle&#34;</span><span class="op" id="684249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="684252">case</span>&nbsp;<span class="string" id="684257">&#34;windows&#34;</span><span class="op" id="684266">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="684270">t</span><span class="op" id="684271">.</span><span class="ident" id="684272">Skip</span><span class="op" id="684276">(</span><span class="string" id="684277">&#34;no&nbsp;operating&nbsp;system&nbsp;support;&nbsp;skipping&#34;</span><span class="op" id="684316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="684319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="684323">//&nbsp;syscall.StartProcess&nbsp;maps&nbsp;all&nbsp;the&nbsp;FDs&nbsp;passed&nbsp;to&nbsp;it&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="684381">//&nbsp;ProcAttr.Files&nbsp;(the&nbsp;concatenation&nbsp;of&nbsp;stdin,stdout,stderr&nbsp;and</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="684446">//&nbsp;ExtraFiles)&nbsp;into&nbsp;consecutive&nbsp;FDs&nbsp;in&nbsp;the&nbsp;child,&nbsp;that&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="684506">//&nbsp;Files{11,&nbsp;12,&nbsp;6,&nbsp;7,&nbsp;9,&nbsp;3}&nbsp;should&nbsp;result&nbsp;in&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="684562">//&nbsp;represented&nbsp;by&nbsp;FD&nbsp;11&nbsp;in&nbsp;the&nbsp;parent&nbsp;being&nbsp;made&nbsp;available&nbsp;as&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="684627">//&nbsp;in&nbsp;the&nbsp;child,&nbsp;12&nbsp;as&nbsp;1,&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="684659">//</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="684663">//&nbsp;We&nbsp;want&nbsp;to&nbsp;test&nbsp;that&nbsp;FDs&nbsp;in&nbsp;the&nbsp;child&nbsp;do&nbsp;not&nbsp;get&nbsp;overwritten</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="684728">//&nbsp;by&nbsp;one&nbsp;another&nbsp;as&nbsp;this&nbsp;shuffle&nbsp;occurs.&nbsp;The&nbsp;original&nbsp;implementation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="684799">//&nbsp;was&nbsp;buggy&nbsp;in&nbsp;that&nbsp;in&nbsp;some&nbsp;data&nbsp;dependent&nbsp;cases&nbsp;it&nbsp;would&nbsp;ovewrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="684868">//&nbsp;stderr&nbsp;in&nbsp;the&nbsp;child&nbsp;with&nbsp;one&nbsp;of&nbsp;the&nbsp;ExtraFile&nbsp;members.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="684927">//&nbsp;Testing&nbsp;for&nbsp;this&nbsp;case&nbsp;is&nbsp;difficult&nbsp;because&nbsp;it&nbsp;relies&nbsp;on&nbsp;using</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="684993">//&nbsp;the&nbsp;same&nbsp;FD&nbsp;values&nbsp;as&nbsp;that&nbsp;case.&nbsp;In&nbsp;particular,&nbsp;an&nbsp;FD&nbsp;of&nbsp;3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="685056">//&nbsp;must&nbsp;be&nbsp;at&nbsp;an&nbsp;index&nbsp;of&nbsp;4&nbsp;or&nbsp;higher&nbsp;in&nbsp;ProcAttr.Files&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="685117">//&nbsp;the&nbsp;FD&nbsp;of&nbsp;the&nbsp;write&nbsp;end&nbsp;of&nbsp;the&nbsp;Stderr&nbsp;pipe&nbsp;(as&nbsp;obtained&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="685180">//&nbsp;StderrPipe())&nbsp;must&nbsp;be&nbsp;the&nbsp;same&nbsp;as&nbsp;the&nbsp;size&nbsp;of&nbsp;ProcAttr.Files;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="685246">//&nbsp;therefore&nbsp;we&nbsp;test&nbsp;that&nbsp;the&nbsp;read&nbsp;end&nbsp;of&nbsp;this&nbsp;pipe&nbsp;(which&nbsp;is&nbsp;what</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="685314">//&nbsp;is&nbsp;returned&nbsp;to&nbsp;the&nbsp;parent&nbsp;by&nbsp;StderrPipe()&nbsp;being&nbsp;one&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="685380">//&nbsp;the&nbsp;size&nbsp;of&nbsp;ProcAttr.Files,&nbsp;i.e.&nbsp;3+len(cmd.ExtraFiles).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="685440">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="685444">//&nbsp;Moving&nbsp;this&nbsp;test&nbsp;case&nbsp;around&nbsp;within&nbsp;the&nbsp;overall&nbsp;tests&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="685506">//&nbsp;affect&nbsp;the&nbsp;FDs&nbsp;obtained&nbsp;and&nbsp;hence&nbsp;the&nbsp;checks&nbsp;to&nbsp;catch&nbsp;these&nbsp;cases.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="685577">npipes</span>&nbsp;<span class="op" id="685584">:=</span>&nbsp;<span class="num" id="685587">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="685590">c</span>&nbsp;<span class="op" id="685592">:=</span>&nbsp;<span class="ident" id="685595">helperCommand</span><span class="op" id="685608">(</span><span class="ident" id="685609">t</span><span class="op" id="685610">,</span>&nbsp;<span class="string" id="685612">&#34;extraFilesAndPipes&#34;</span><span class="op" id="685632">,</span>&nbsp;<span class="ident" id="685634">strconv</span><span class="op" id="685641">.</span><span class="ident" id="685642">Itoa</span><span class="op" id="685646">(</span><span class="ident" id="685647">npipes</span><span class="op" id="685653">+</span><span class="num" id="685654">1</span><span class="op" id="685655">)</span><span class="op" id="685656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="685659">rd</span><span class="op" id="685661">,</span>&nbsp;<span class="ident" id="685663">wr</span><span class="op" id="685665">,</span>&nbsp;<span class="ident" id="685667">_</span>&nbsp;<span class="op" id="685669">:=</span>&nbsp;<span class="ident" id="685672">os</span><span class="op" id="685674">.</span><span class="ident" id="685675">Pipe</span><span class="op" id="685679">(</span><span class="op" id="685680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="685683">defer</span>&nbsp;<span class="ident" id="685689">rd</span><span class="op" id="685691">.</span><span class="ident" id="685692">Close</span><span class="op" id="685697">(</span><span class="op" id="685698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="685701">if</span>&nbsp;<span class="ident" id="685704">rd</span><span class="op" id="685706">.</span><span class="ident" id="685707">Fd</span><span class="op" id="685709">(</span><span class="op" id="685710">)</span>&nbsp;<span class="op" id="685712">!=</span>&nbsp;<span class="num" id="685715">3</span>&nbsp;<span class="op" id="685717">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="685721">t</span><span class="op" id="685722">.</span><span class="ident" id="685723">Errorf</span><span class="op" id="685729">(</span><span class="string" id="685730">&#34;bad&nbsp;test&nbsp;value&nbsp;for&nbsp;test&nbsp;pipe:&nbsp;fd&nbsp;%d&#34;</span><span class="op" id="685767">,</span>&nbsp;<span class="ident" id="685769">rd</span><span class="op" id="685771">.</span><span class="ident" id="685772">Fd</span><span class="op" id="685774">(</span><span class="op" id="685775">)</span><span class="op" id="685776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="685779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="685782">stderr</span><span class="op" id="685788">,</span>&nbsp;<span class="ident" id="685790">_</span>&nbsp;<span class="op" id="685792">:=</span>&nbsp;<span class="ident" id="685795">c</span><span class="op" id="685796">.</span><span class="ident" id="685797">StderrPipe</span><span class="op" id="685807">(</span><span class="op" id="685808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="685811">wr</span><span class="op" id="685813">.</span><span class="ident" id="685814">WriteString</span><span class="op" id="685825">(</span><span class="string" id="685826">&#34;_LAST&#34;</span><span class="op" id="685833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="685836">wr</span><span class="op" id="685838">.</span><span class="ident" id="685839">Close</span><span class="op" id="685844">(</span><span class="op" id="685845">)</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="685849">pipes</span>&nbsp;<span class="op" id="685855">:=</span>&nbsp;<span class="builtinfunc" id="685858">make</span><span class="op" id="685862">(</span><span class="op" id="685863">[</span><span class="op" id="685864">]</span><span class="keyword" id="685865">struct</span>&nbsp;<span class="op" id="685872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="685876">r</span><span class="op" id="685877">,</span>&nbsp;<span class="ident" id="685879">w</span>&nbsp;<span class="op" id="685881">*</span><span class="ident" id="685882">os</span><span class="op" id="685884">.</span><span class="ident" id="685885">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="685891">}</span><span class="op" id="685892">,</span>&nbsp;<span class="ident" id="685894">npipes</span><span class="op" id="685900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="685903">data</span>&nbsp;<span class="op" id="685908">:=</span>&nbsp;<span class="op" id="685911">[</span><span class="op" id="685912">]</span><span class="builtintype" id="685913">string</span><span class="op" id="685919">{</span><span class="string" id="685920">&#34;a&#34;</span><span class="op" id="685923">,</span>&nbsp;<span class="string" id="685925">&#34;b&#34;</span><span class="op" id="685928">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="685932">for</span>&nbsp;<span class="ident" id="685936">i</span>&nbsp;<span class="op" id="685938">:=</span>&nbsp;<span class="num" id="685941">0</span><span class="op" id="685942">;</span>&nbsp;<span class="ident" id="685944">i</span>&nbsp;<span class="op" id="685946">&lt;</span>&nbsp;<span class="ident" id="685948">npipes</span><span class="op" id="685954">;</span>&nbsp;<span class="ident" id="685956">i</span><span class="op" id="685957">++</span>&nbsp;<span class="op" id="685960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="685964">r</span><span class="op" id="685965">,</span>&nbsp;<span class="ident" id="685967">w</span><span class="op" id="685968">,</span>&nbsp;<span class="ident" id="685970">err</span>&nbsp;<span class="op" id="685974">:=</span>&nbsp;<span class="ident" id="685977">os</span><span class="op" id="685979">.</span><span class="ident" id="685980">Pipe</span><span class="op" id="685984">(</span><span class="op" id="685985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="685989">if</span>&nbsp;<span class="ident" id="685992">err</span>&nbsp;<span class="op" id="685996">!=</span>&nbsp;<span class="ident" id="685999">nil</span>&nbsp;<span class="op" id="686003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686008">t</span><span class="op" id="686009">.</span><span class="ident" id="686010">Fatalf</span><span class="op" id="686016">(</span><span class="string" id="686017">&#34;unexpected&nbsp;error&nbsp;creating&nbsp;pipe:&nbsp;%s&#34;</span><span class="op" id="686053">,</span>&nbsp;<span class="ident" id="686055">err</span><span class="op" id="686058">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="686062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686066">pipes</span><span class="op" id="686071">[</span><span class="ident" id="686072">i</span><span class="op" id="686073">]</span><span class="op" id="686074">.</span><span class="ident" id="686075">r</span>&nbsp;<span class="op" id="686077">=</span>&nbsp;<span class="ident" id="686079">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686083">pipes</span><span class="op" id="686088">[</span><span class="ident" id="686089">i</span><span class="op" id="686090">]</span><span class="op" id="686091">.</span><span class="ident" id="686092">w</span>&nbsp;<span class="op" id="686094">=</span>&nbsp;<span class="ident" id="686096">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686100">w</span><span class="op" id="686101">.</span><span class="ident" id="686102">WriteString</span><span class="op" id="686113">(</span><span class="ident" id="686114">data</span><span class="op" id="686118">[</span><span class="ident" id="686119">i</span><span class="op" id="686120">]</span><span class="op" id="686121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686125">c</span><span class="op" id="686126">.</span><span class="ident" id="686127">ExtraFiles</span>&nbsp;<span class="op" id="686138">=</span>&nbsp;<span class="builtinfunc" id="686140">append</span><span class="op" id="686146">(</span><span class="ident" id="686147">c</span><span class="op" id="686148">.</span><span class="ident" id="686149">ExtraFiles</span><span class="op" id="686159">,</span>&nbsp;<span class="ident" id="686161">pipes</span><span class="op" id="686166">[</span><span class="ident" id="686167">i</span><span class="op" id="686168">]</span><span class="op" id="686169">.</span><span class="ident" id="686170">r</span><span class="op" id="686171">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="686175">defer</span>&nbsp;<span class="keyword" id="686181">func</span><span class="op" id="686185">(</span><span class="op" id="686186">)</span>&nbsp;<span class="op" id="686188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686193">r</span><span class="op" id="686194">.</span><span class="ident" id="686195">Close</span><span class="op" id="686200">(</span><span class="op" id="686201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686206">w</span><span class="op" id="686207">.</span><span class="ident" id="686208">Close</span><span class="op" id="686213">(</span><span class="op" id="686214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="686218">}</span><span class="op" id="686219">(</span><span class="op" id="686220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="686223">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="686226">//&nbsp;Put&nbsp;fd&nbsp;3&nbsp;at&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686251">c</span><span class="op" id="686252">.</span><span class="ident" id="686253">ExtraFiles</span>&nbsp;<span class="op" id="686264">=</span>&nbsp;<span class="builtinfunc" id="686266">append</span><span class="op" id="686272">(</span><span class="ident" id="686273">c</span><span class="op" id="686274">.</span><span class="ident" id="686275">ExtraFiles</span><span class="op" id="686285">,</span>&nbsp;<span class="ident" id="686287">rd</span><span class="op" id="686289">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686293">stderrFd</span>&nbsp;<span class="op" id="686302">:=</span>&nbsp;<span class="builtintype" id="686305">int</span><span class="op" id="686308">(</span><span class="ident" id="686309">stderr</span><span class="op" id="686315">.</span><span class="op" id="686316">(</span><span class="op" id="686317">*</span><span class="ident" id="686318">os</span><span class="op" id="686320">.</span><span class="ident" id="686321">File</span><span class="op" id="686325">)</span><span class="op" id="686326">.</span><span class="ident" id="686327">Fd</span><span class="op" id="686329">(</span><span class="op" id="686330">)</span><span class="op" id="686331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="686334">if</span>&nbsp;<span class="ident" id="686337">stderrFd</span>&nbsp;<span class="op" id="686346">!=</span>&nbsp;<span class="op" id="686349">(</span><span class="op" id="686350">(</span><span class="builtinfunc" id="686351">len</span><span class="op" id="686354">(</span><span class="ident" id="686355">c</span><span class="op" id="686356">.</span><span class="ident" id="686357">ExtraFiles</span><span class="op" id="686367">)</span>&nbsp;<span class="op" id="686369">+</span>&nbsp;<span class="num" id="686371">3</span><span class="op" id="686372">)</span>&nbsp;<span class="op" id="686374">-</span>&nbsp;<span class="num" id="686376">1</span><span class="op" id="686377">)</span>&nbsp;<span class="op" id="686379">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686383">t</span><span class="op" id="686384">.</span><span class="ident" id="686385">Errorf</span><span class="op" id="686391">(</span><span class="string" id="686392">&#34;bad&nbsp;test&nbsp;value&nbsp;for&nbsp;stderr&nbsp;pipe&#34;</span><span class="op" id="686424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="686427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686431">expected</span>&nbsp;<span class="op" id="686440">:=</span>&nbsp;<span class="string" id="686443">&#34;child:&nbsp;&#34;</span>&nbsp;<span class="op" id="686453">+</span>&nbsp;<span class="ident" id="686455">strings</span><span class="op" id="686462">.</span><span class="ident" id="686463">Join</span><span class="op" id="686467">(</span><span class="ident" id="686468">data</span><span class="op" id="686472">,</span>&nbsp;<span class="string" id="686474">&#34;&#34;</span><span class="op" id="686476">)</span>&nbsp;<span class="op" id="686478">+</span>&nbsp;<span class="string" id="686480">&#34;_LAST&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686490">err</span>&nbsp;<span class="op" id="686494">:=</span>&nbsp;<span class="ident" id="686497">c</span><span class="op" id="686498">.</span><span class="ident" id="686499">Start</span><span class="op" id="686504">(</span><span class="op" id="686505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="686508">if</span>&nbsp;<span class="ident" id="686511">err</span>&nbsp;<span class="op" id="686515">!=</span>&nbsp;<span class="ident" id="686518">nil</span>&nbsp;<span class="op" id="686522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686526">t</span><span class="op" id="686527">.</span><span class="ident" id="686528">Fatalf</span><span class="op" id="686534">(</span><span class="string" id="686535">&#34;Run:&nbsp;%v&#34;</span><span class="op" id="686544">,</span>&nbsp;<span class="ident" id="686546">err</span><span class="op" id="686549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="686552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686555">ch</span>&nbsp;<span class="op" id="686558">:=</span>&nbsp;<span class="builtinfunc" id="686561">make</span><span class="op" id="686565">(</span><span class="keyword" id="686566">chan</span>&nbsp;<span class="builtintype" id="686571">string</span><span class="op" id="686577">,</span>&nbsp;<span class="num" id="686579">1</span><span class="op" id="686580">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="686583">go</span>&nbsp;<span class="keyword" id="686586">func</span><span class="op" id="686590">(</span><span class="ident" id="686591">ch</span>&nbsp;<span class="keyword" id="686594">chan</span>&nbsp;<span class="builtintype" id="686599">string</span><span class="op" id="686605">)</span>&nbsp;<span class="op" id="686607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686611">buf</span>&nbsp;<span class="op" id="686615">:=</span>&nbsp;<span class="builtinfunc" id="686618">make</span><span class="op" id="686622">(</span><span class="op" id="686623">[</span><span class="op" id="686624">]</span><span class="builtintype" id="686625">byte</span><span class="op" id="686629">,</span>&nbsp;<span class="num" id="686631">512</span><span class="op" id="686634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686638">n</span><span class="op" id="686639">,</span>&nbsp;<span class="ident" id="686641">err</span>&nbsp;<span class="op" id="686645">:=</span>&nbsp;<span class="ident" id="686648">stderr</span><span class="op" id="686654">.</span><span class="ident" id="686655">Read</span><span class="op" id="686659">(</span><span class="ident" id="686660">buf</span><span class="op" id="686663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="686667">if</span>&nbsp;<span class="ident" id="686670">err</span>&nbsp;<span class="op" id="686674">!=</span>&nbsp;<span class="ident" id="686677">nil</span>&nbsp;<span class="op" id="686681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686686">t</span><span class="op" id="686687">.</span><span class="ident" id="686688">Fatalf</span><span class="op" id="686694">(</span><span class="string" id="686695">&#34;Read:&nbsp;%s&#34;</span><span class="op" id="686705">,</span>&nbsp;<span class="ident" id="686707">err</span><span class="op" id="686710">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686715">ch</span>&nbsp;<span class="op" id="686718">&lt;-</span>&nbsp;<span class="ident" id="686721">err</span><span class="op" id="686724">.</span><span class="ident" id="686725">Error</span><span class="op" id="686730">(</span><span class="op" id="686731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="686735">}</span>&nbsp;<span class="keyword" id="686737">else</span>&nbsp;<span class="op" id="686742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686747">ch</span>&nbsp;<span class="op" id="686750">&lt;-</span>&nbsp;<span class="builtintype" id="686753">string</span><span class="op" id="686759">(</span><span class="ident" id="686760">buf</span><span class="op" id="686763">[</span><span class="op" id="686764">:</span><span class="ident" id="686765">n</span><span class="op" id="686766">]</span><span class="op" id="686767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="686771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="686775">close</span><span class="op" id="686780">(</span><span class="ident" id="686781">ch</span><span class="op" id="686783">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="686786">}</span><span class="op" id="686787">(</span><span class="ident" id="686788">ch</span><span class="op" id="686790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="686793">select</span>&nbsp;<span class="op" id="686800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="686803">case</span>&nbsp;<span class="ident" id="686808">m</span>&nbsp;<span class="op" id="686810">:=</span>&nbsp;<span class="op" id="686813">&lt;-</span><span class="ident" id="686815">ch</span><span class="op" id="686817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="686821">if</span>&nbsp;<span class="ident" id="686824">m</span>&nbsp;<span class="op" id="686826">!=</span>&nbsp;<span class="ident" id="686829">expected</span>&nbsp;<span class="op" id="686838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686843">t</span><span class="op" id="686844">.</span><span class="ident" id="686845">Errorf</span><span class="op" id="686851">(</span><span class="string" id="686852">&#34;Read:&nbsp;&#39;%s&#39;&nbsp;not&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="686873">,</span>&nbsp;<span class="ident" id="686875">m</span><span class="op" id="686876">,</span>&nbsp;<span class="ident" id="686878">expected</span><span class="op" id="686886">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="686890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="686893">case</span>&nbsp;<span class="op" id="686898">&lt;-</span><span class="ident" id="686900">time</span><span class="op" id="686904">.</span><span class="ident" id="686905">After</span><span class="op" id="686910">(</span><span class="num" id="686911">5</span>&nbsp;<span class="op" id="686913">*</span>&nbsp;<span class="ident" id="686915">time</span><span class="op" id="686919">.</span><span class="ident" id="686920">Second</span><span class="op" id="686926">)</span><span class="op" id="686927">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686931">t</span><span class="op" id="686932">.</span><span class="ident" id="686933">Errorf</span><span class="op" id="686939">(</span><span class="string" id="686940">&#34;Read&nbsp;timedout&#34;</span><span class="op" id="686955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="686958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="686961">c</span><span class="op" id="686962">.</span><span class="ident" id="686963">Wait</span><span class="op" id="686967">(</span><span class="op" id="686968">)</span><br>
<span class="lineno">375</span><span class="op" id="686970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="686973">func</span>&nbsp;<span class="ident" id="686978">TestExtraFiles</span><span class="op" id="686992">(</span><span class="ident" id="686993">t</span>&nbsp;<span class="op" id="686995">*</span><span class="ident" id="686996">testing</span><span class="op" id="687003">.</span><span class="ident" id="687004">T</span><span class="op" id="687005">)</span>&nbsp;<span class="op" id="687007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="687010">switch</span>&nbsp;<span class="ident" id="687017">runtime</span><span class="op" id="687024">.</span><span class="ident" id="687025">GOOS</span>&nbsp;<span class="op" id="687030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="687033">case</span>&nbsp;<span class="string" id="687038">&#34;nacl&#34;</span><span class="op" id="687044">,</span>&nbsp;<span class="string" id="687046">&#34;windows&#34;</span><span class="op" id="687055">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="687059">t</span><span class="op" id="687060">.</span><span class="ident" id="687061">Skipf</span><span class="op" id="687066">(</span><span class="string" id="687067">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="687088">,</span>&nbsp;<span class="ident" id="687090">runtime</span><span class="op" id="687097">.</span><span class="ident" id="687098">GOOS</span><span class="op" id="687102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="687105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="687109">//&nbsp;Ensure&nbsp;that&nbsp;file&nbsp;descriptors&nbsp;have&nbsp;not&nbsp;already&nbsp;been&nbsp;leaked&nbsp;into</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="687176">//&nbsp;our&nbsp;environment.</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="687197">if</span>&nbsp;<span class="op" id="687200">!</span><span class="ident" id="687201">testedAlreadyLeaked</span>&nbsp;<span class="op" id="687221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="687225">testedAlreadyLeaked</span>&nbsp;<span class="op" id="687245">=</span>&nbsp;<span class="ident" id="687247">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="687254">closeUnexpectedFds</span><span class="op" id="687272">(</span><span class="ident" id="687273">t</span><span class="op" id="687274">,</span>&nbsp;<span class="string" id="687276">&#34;TestExtraFiles&#34;</span><span class="op" id="687292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="687295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="687299">//&nbsp;Force&nbsp;network&nbsp;usage,&nbsp;to&nbsp;verify&nbsp;the&nbsp;epoll&nbsp;(or&nbsp;whatever)&nbsp;fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="687361">//&nbsp;doesn&#39;t&nbsp;leak&nbsp;to&nbsp;the&nbsp;child,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="687392">ln</span><span class="op" id="687394">,</span>&nbsp;<span class="ident" id="687396">err</span>&nbsp;<span class="op" id="687400">:=</span>&nbsp;<span class="ident" id="687403">net</span><span class="op" id="687406">.</span><span class="ident" id="687407">Listen</span><span class="op" id="687413">(</span><span class="string" id="687414">&#34;tcp&#34;</span><span class="op" id="687419">,</span>&nbsp;<span class="string" id="687421">&#34;127.0.0.1:0&#34;</span><span class="op" id="687434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="687437">if</span>&nbsp;<span class="ident" id="687440">err</span>&nbsp;<span class="op" id="687444">!=</span>&nbsp;<span class="ident" id="687447">nil</span>&nbsp;<span class="op" id="687451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="687455">t</span><span class="op" id="687456">.</span><span class="ident" id="687457">Fatal</span><span class="op" id="687462">(</span><span class="ident" id="687463">err</span><span class="op" id="687466">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="687469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="687472">defer</span>&nbsp;<span class="ident" id="687478">ln</span><span class="op" id="687480">.</span><span class="ident" id="687481">Close</span><span class="op" id="687486">(</span><span class="op" id="687487">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="687491">//&nbsp;Make&nbsp;sure&nbsp;duplicated&nbsp;fds&nbsp;don&#39;t&nbsp;leak&nbsp;to&nbsp;the&nbsp;child.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="687545">f</span><span class="op" id="687546">,</span>&nbsp;<span class="ident" id="687548">err</span>&nbsp;<span class="op" id="687552">:=</span>&nbsp;<span class="ident" id="687555">ln</span><span class="op" id="687557">.</span><span class="op" id="687558">(</span><span class="op" id="687559">*</span><span class="ident" id="687560">net</span><span class="op" id="687563">.</span><span class="ident" id="687564">TCPListener</span><span class="op" id="687575">)</span><span class="op" id="687576">.</span><span class="ident" id="687577">File</span><span class="op" id="687581">(</span><span class="op" id="687582">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="687585">if</span>&nbsp;<span class="ident" id="687588">err</span>&nbsp;<span class="op" id="687592">!=</span>&nbsp;<span class="ident" id="687595">nil</span>&nbsp;<span class="op" id="687599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="687603">t</span><span class="op" id="687604">.</span><span class="ident" id="687605">Fatal</span><span class="op" id="687610">(</span><span class="ident" id="687611">err</span><span class="op" id="687614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="687617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="687620">defer</span>&nbsp;<span class="ident" id="687626">f</span><span class="op" id="687627">.</span><span class="ident" id="687628">Close</span><span class="op" id="687633">(</span><span class="op" id="687634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="687637">ln2</span><span class="op" id="687640">,</span>&nbsp;<span class="ident" id="687642">err</span>&nbsp;<span class="op" id="687646">:=</span>&nbsp;<span class="ident" id="687649">net</span><span class="op" id="687652">.</span><span class="ident" id="687653">FileListener</span><span class="op" id="687665">(</span><span class="ident" id="687666">f</span><span class="op" id="687667">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="687670">if</span>&nbsp;<span class="ident" id="687673">err</span>&nbsp;<span class="op" id="687677">!=</span>&nbsp;<span class="ident" id="687680">nil</span>&nbsp;<span class="op" id="687684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="687688">t</span><span class="op" id="687689">.</span><span class="ident" id="687690">Fatal</span><span class="op" id="687695">(</span><span class="ident" id="687696">err</span><span class="op" id="687699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="687702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="687705">defer</span>&nbsp;<span class="ident" id="687711">ln2</span><span class="op" id="687714">.</span><span class="ident" id="687715">Close</span><span class="op" id="687720">(</span><span class="op" id="687721">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="687725">//&nbsp;Force&nbsp;TLS&nbsp;root&nbsp;certs&nbsp;to&nbsp;be&nbsp;loaded&nbsp;(which&nbsp;might&nbsp;involve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="687784">//&nbsp;cgo),&nbsp;to&nbsp;make&nbsp;sure&nbsp;none&nbsp;of&nbsp;that&nbsp;potential&nbsp;C&nbsp;code&nbsp;leaks&nbsp;fds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="687848">ts</span>&nbsp;<span class="op" id="687851">:=</span>&nbsp;<span class="ident" id="687854">httptest</span><span class="op" id="687862">.</span><span class="ident" id="687863">NewUnstartedServer</span><span class="op" id="687881">(</span><span class="ident" id="687882">http</span><span class="op" id="687886">.</span><span class="ident" id="687887">HandlerFunc</span><span class="op" id="687898">(</span><span class="keyword" id="687899">func</span><span class="op" id="687903">(</span><span class="ident" id="687904">w</span>&nbsp;<span class="ident" id="687906">http</span><span class="op" id="687910">.</span><span class="ident" id="687911">ResponseWriter</span><span class="op" id="687925">,</span>&nbsp;<span class="ident" id="687927">r</span>&nbsp;<span class="op" id="687929">*</span><span class="ident" id="687930">http</span><span class="op" id="687934">.</span><span class="ident" id="687935">Request</span><span class="op" id="687942">)</span>&nbsp;<span class="op" id="687944">{</span><span class="op" id="687945">}</span><span class="op" id="687946">)</span><span class="op" id="687947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="687950">//&nbsp;quiet&nbsp;expected&nbsp;TLS&nbsp;handshake&nbsp;error&nbsp;&#34;remote&nbsp;error:&nbsp;bad&nbsp;certificate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="688021">ts</span><span class="op" id="688023">.</span><span class="ident" id="688024">Config</span><span class="op" id="688030">.</span><span class="ident" id="688031">ErrorLog</span>&nbsp;<span class="op" id="688040">=</span>&nbsp;<span class="ident" id="688042">log</span><span class="op" id="688045">.</span><span class="ident" id="688046">New</span><span class="op" id="688049">(</span><span class="ident" id="688050">ioutil</span><span class="op" id="688056">.</span><span class="ident" id="688057">Discard</span><span class="op" id="688064">,</span>&nbsp;<span class="string" id="688066">&#34;&#34;</span><span class="op" id="688068">,</span>&nbsp;<span class="num" id="688070">0</span><span class="op" id="688071">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="688074">ts</span><span class="op" id="688076">.</span><span class="ident" id="688077">StartTLS</span><span class="op" id="688085">(</span><span class="op" id="688086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="688089">defer</span>&nbsp;<span class="ident" id="688095">ts</span><span class="op" id="688097">.</span><span class="ident" id="688098">Close</span><span class="op" id="688103">(</span><span class="op" id="688104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="688107">_</span><span class="op" id="688108">,</span>&nbsp;<span class="ident" id="688110">err</span>&nbsp;<span class="op" id="688114">=</span>&nbsp;<span class="ident" id="688116">http</span><span class="op" id="688120">.</span><span class="ident" id="688121">Get</span><span class="op" id="688124">(</span><span class="ident" id="688125">ts</span><span class="op" id="688127">.</span><span class="ident" id="688128">URL</span><span class="op" id="688131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="688134">if</span>&nbsp;<span class="ident" id="688137">err</span>&nbsp;<span class="op" id="688141">==</span>&nbsp;<span class="ident" id="688144">nil</span>&nbsp;<span class="op" id="688148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="688152">t</span><span class="op" id="688153">.</span><span class="ident" id="688154">Errorf</span><span class="op" id="688160">(</span><span class="string" id="688161">&#34;success&nbsp;trying&nbsp;to&nbsp;fetch&nbsp;%s;&nbsp;want&nbsp;an&nbsp;error&#34;</span><span class="op" id="688204">,</span>&nbsp;<span class="ident" id="688206">ts</span><span class="op" id="688208">.</span><span class="ident" id="688209">URL</span><span class="op" id="688212">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="688215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="688219">tf</span><span class="op" id="688221">,</span>&nbsp;<span class="ident" id="688223">err</span>&nbsp;<span class="op" id="688227">:=</span>&nbsp;<span class="ident" id="688230">ioutil</span><span class="op" id="688236">.</span><span class="ident" id="688237">TempFile</span><span class="op" id="688245">(</span><span class="string" id="688246">&#34;&#34;</span><span class="op" id="688248">,</span>&nbsp;<span class="string" id="688250">&#34;&#34;</span><span class="op" id="688252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="688255">if</span>&nbsp;<span class="ident" id="688258">err</span>&nbsp;<span class="op" id="688262">!=</span>&nbsp;<span class="ident" id="688265">nil</span>&nbsp;<span class="op" id="688269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="688273">t</span><span class="op" id="688274">.</span><span class="ident" id="688275">Fatalf</span><span class="op" id="688281">(</span><span class="string" id="688282">&#34;TempFile:&nbsp;%v&#34;</span><span class="op" id="688296">,</span>&nbsp;<span class="ident" id="688298">err</span><span class="op" id="688301">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="688304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="688307">defer</span>&nbsp;<span class="ident" id="688313">os</span><span class="op" id="688315">.</span><span class="ident" id="688316">Remove</span><span class="op" id="688322">(</span><span class="ident" id="688323">tf</span><span class="op" id="688325">.</span><span class="ident" id="688326">Name</span><span class="op" id="688330">(</span><span class="op" id="688331">)</span><span class="op" id="688332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="688335">defer</span>&nbsp;<span class="ident" id="688341">tf</span><span class="op" id="688343">.</span><span class="ident" id="688344">Close</span><span class="op" id="688349">(</span><span class="op" id="688350">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="688354">const</span>&nbsp;<span class="ident" id="688360">text</span>&nbsp;<span class="op" id="688365">=</span>&nbsp;<span class="string" id="688367">&#34;Hello,&nbsp;fd&nbsp;3!&#34;</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="688383">_</span><span class="op" id="688384">,</span>&nbsp;<span class="ident" id="688386">err</span>&nbsp;<span class="op" id="688390">=</span>&nbsp;<span class="ident" id="688392">tf</span><span class="op" id="688394">.</span><span class="ident" id="688395">Write</span><span class="op" id="688400">(</span><span class="op" id="688401">[</span><span class="op" id="688402">]</span><span class="builtintype" id="688403">byte</span><span class="op" id="688407">(</span><span class="ident" id="688408">text</span><span class="op" id="688412">)</span><span class="op" id="688413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="688416">if</span>&nbsp;<span class="ident" id="688419">err</span>&nbsp;<span class="op" id="688423">!=</span>&nbsp;<span class="ident" id="688426">nil</span>&nbsp;<span class="op" id="688430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="688434">t</span><span class="op" id="688435">.</span><span class="ident" id="688436">Fatalf</span><span class="op" id="688442">(</span><span class="string" id="688443">&#34;Write:&nbsp;%v&#34;</span><span class="op" id="688454">,</span>&nbsp;<span class="ident" id="688456">err</span><span class="op" id="688459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="688462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="688465">_</span><span class="op" id="688466">,</span>&nbsp;<span class="ident" id="688468">err</span>&nbsp;<span class="op" id="688472">=</span>&nbsp;<span class="ident" id="688474">tf</span><span class="op" id="688476">.</span><span class="ident" id="688477">Seek</span><span class="op" id="688481">(</span><span class="num" id="688482">0</span><span class="op" id="688483">,</span>&nbsp;<span class="ident" id="688485">os</span><span class="op" id="688487">.</span><span class="ident" id="688488">SEEK_SET</span><span class="op" id="688496">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="688499">if</span>&nbsp;<span class="ident" id="688502">err</span>&nbsp;<span class="op" id="688506">!=</span>&nbsp;<span class="ident" id="688509">nil</span>&nbsp;<span class="op" id="688513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="688517">t</span><span class="op" id="688518">.</span><span class="ident" id="688519">Fatalf</span><span class="op" id="688525">(</span><span class="string" id="688526">&#34;Seek:&nbsp;%v&#34;</span><span class="op" id="688536">,</span>&nbsp;<span class="ident" id="688538">err</span><span class="op" id="688541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="688544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="688548">c</span>&nbsp;<span class="op" id="688550">:=</span>&nbsp;<span class="ident" id="688553">helperCommand</span><span class="op" id="688566">(</span><span class="ident" id="688567">t</span><span class="op" id="688568">,</span>&nbsp;<span class="string" id="688570">&#34;read3&#34;</span><span class="op" id="688577">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="688580">var</span>&nbsp;<span class="ident" id="688584">stdout</span><span class="op" id="688590">,</span>&nbsp;<span class="ident" id="688592">stderr</span>&nbsp;<span class="ident" id="688599">bytes</span><span class="op" id="688604">.</span><span class="ident" id="688605">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="688613">c</span><span class="op" id="688614">.</span><span class="ident" id="688615">Stdout</span>&nbsp;<span class="op" id="688622">=</span>&nbsp;<span class="op" id="688624">&amp;</span><span class="ident" id="688625">stdout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="688633">c</span><span class="op" id="688634">.</span><span class="ident" id="688635">Stderr</span>&nbsp;<span class="op" id="688642">=</span>&nbsp;<span class="op" id="688644">&amp;</span><span class="ident" id="688645">stderr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="688653">c</span><span class="op" id="688654">.</span><span class="ident" id="688655">ExtraFiles</span>&nbsp;<span class="op" id="688666">=</span>&nbsp;<span class="op" id="688668">[</span><span class="op" id="688669">]</span><span class="op" id="688670">*</span><span class="ident" id="688671">os</span><span class="op" id="688673">.</span><span class="ident" id="688674">File</span><span class="op" id="688678">{</span><span class="ident" id="688679">tf</span><span class="op" id="688681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="688684">err</span>&nbsp;<span class="op" id="688688">=</span>&nbsp;<span class="ident" id="688690">c</span><span class="op" id="688691">.</span><span class="ident" id="688692">Run</span><span class="op" id="688695">(</span><span class="op" id="688696">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="688699">if</span>&nbsp;<span class="ident" id="688702">err</span>&nbsp;<span class="op" id="688706">!=</span>&nbsp;<span class="ident" id="688709">nil</span>&nbsp;<span class="op" id="688713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="688717">t</span><span class="op" id="688718">.</span><span class="ident" id="688719">Fatalf</span><span class="op" id="688725">(</span><span class="string" id="688726">&#34;Run:&nbsp;%v;&nbsp;stdout&nbsp;%q,&nbsp;stderr&nbsp;%q&#34;</span><span class="op" id="688757">,</span>&nbsp;<span class="ident" id="688759">err</span><span class="op" id="688762">,</span>&nbsp;<span class="ident" id="688764">stdout</span><span class="op" id="688770">.</span><span class="ident" id="688771">Bytes</span><span class="op" id="688776">(</span><span class="op" id="688777">)</span><span class="op" id="688778">,</span>&nbsp;<span class="ident" id="688780">stderr</span><span class="op" id="688786">.</span><span class="ident" id="688787">Bytes</span><span class="op" id="688792">(</span><span class="op" id="688793">)</span><span class="op" id="688794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="688797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="688800">if</span>&nbsp;<span class="ident" id="688803">stdout</span><span class="op" id="688809">.</span><span class="ident" id="688810">String</span><span class="op" id="688816">(</span><span class="op" id="688817">)</span>&nbsp;<span class="op" id="688819">!=</span>&nbsp;<span class="ident" id="688822">text</span>&nbsp;<span class="op" id="688827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="688831">t</span><span class="op" id="688832">.</span><span class="ident" id="688833">Errorf</span><span class="op" id="688839">(</span><span class="string" id="688840">&#34;got&nbsp;stdout&nbsp;%q,&nbsp;stderr&nbsp;%q;&nbsp;want&nbsp;%q&nbsp;on&nbsp;stdout&#34;</span><span class="op" id="688885">,</span>&nbsp;<span class="ident" id="688887">stdout</span><span class="op" id="688893">.</span><span class="ident" id="688894">String</span><span class="op" id="688900">(</span><span class="op" id="688901">)</span><span class="op" id="688902">,</span>&nbsp;<span class="ident" id="688904">stderr</span><span class="op" id="688910">.</span><span class="ident" id="688911">String</span><span class="op" id="688917">(</span><span class="op" id="688918">)</span><span class="op" id="688919">,</span>&nbsp;<span class="ident" id="688921">text</span><span class="op" id="688925">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="688928">}</span><br>
<span class="lineno"></span><span class="op" id="688930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="688933">func</span>&nbsp;<span class="ident" id="688938">TestExtraFilesRace</span><span class="op" id="688956">(</span><span class="ident" id="688957">t</span>&nbsp;<span class="op" id="688959">*</span><span class="ident" id="688960">testing</span><span class="op" id="688967">.</span><span class="ident" id="688968">T</span><span class="op" id="688969">)</span>&nbsp;<span class="op" id="688971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="688974">if</span>&nbsp;<span class="ident" id="688977">runtime</span><span class="op" id="688984">.</span><span class="ident" id="688985">GOOS</span>&nbsp;<span class="op" id="688990">==</span>&nbsp;<span class="string" id="688993">&#34;windows&#34;</span>&nbsp;<span class="op" id="689003">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="689007">t</span><span class="op" id="689008">.</span><span class="ident" id="689009">Skip</span><span class="op" id="689013">(</span><span class="string" id="689014">&#34;no&nbsp;operating&nbsp;system&nbsp;support;&nbsp;skipping&#34;</span><span class="op" id="689053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="689056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="689059">listen</span>&nbsp;<span class="op" id="689066">:=</span>&nbsp;<span class="keyword" id="689069">func</span><span class="op" id="689073">(</span><span class="op" id="689074">)</span>&nbsp;<span class="ident" id="689076">net</span><span class="op" id="689079">.</span><span class="ident" id="689080">Listener</span>&nbsp;<span class="op" id="689089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="689093">ln</span><span class="op" id="689095">,</span>&nbsp;<span class="ident" id="689097">err</span>&nbsp;<span class="op" id="689101">:=</span>&nbsp;<span class="ident" id="689104">net</span><span class="op" id="689107">.</span><span class="ident" id="689108">Listen</span><span class="op" id="689114">(</span><span class="string" id="689115">&#34;tcp&#34;</span><span class="op" id="689120">,</span>&nbsp;<span class="string" id="689122">&#34;127.0.0.1:0&#34;</span><span class="op" id="689135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="689139">if</span>&nbsp;<span class="ident" id="689142">err</span>&nbsp;<span class="op" id="689146">!=</span>&nbsp;<span class="ident" id="689149">nil</span>&nbsp;<span class="op" id="689153">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="689158">t</span><span class="op" id="689159">.</span><span class="ident" id="689160">Fatal</span><span class="op" id="689165">(</span><span class="ident" id="689166">err</span><span class="op" id="689169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="689173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="689177">return</span>&nbsp;<span class="ident" id="689184">ln</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="689188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="689191">listenerFile</span>&nbsp;<span class="op" id="689204">:=</span>&nbsp;<span class="keyword" id="689207">func</span><span class="op" id="689211">(</span><span class="ident" id="689212">ln</span>&nbsp;<span class="ident" id="689215">net</span><span class="op" id="689218">.</span><span class="ident" id="689219">Listener</span><span class="op" id="689227">)</span>&nbsp;<span class="op" id="689229">*</span><span class="ident" id="689230">os</span><span class="op" id="689232">.</span><span class="ident" id="689233">File</span>&nbsp;<span class="op" id="689238">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="689242">f</span><span class="op" id="689243">,</span>&nbsp;<span class="ident" id="689245">err</span>&nbsp;<span class="op" id="689249">:=</span>&nbsp;<span class="ident" id="689252">ln</span><span class="op" id="689254">.</span><span class="op" id="689255">(</span><span class="op" id="689256">*</span><span class="ident" id="689257">net</span><span class="op" id="689260">.</span><span class="ident" id="689261">TCPListener</span><span class="op" id="689272">)</span><span class="op" id="689273">.</span><span class="ident" id="689274">File</span><span class="op" id="689278">(</span><span class="op" id="689279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="689283">if</span>&nbsp;<span class="ident" id="689286">err</span>&nbsp;<span class="op" id="689290">!=</span>&nbsp;<span class="ident" id="689293">nil</span>&nbsp;<span class="op" id="689297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="689302">t</span><span class="op" id="689303">.</span><span class="ident" id="689304">Fatal</span><span class="op" id="689309">(</span><span class="ident" id="689310">err</span><span class="op" id="689313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="689317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="689321">return</span>&nbsp;<span class="ident" id="689328">f</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="689331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="689334">runCommand</span>&nbsp;<span class="op" id="689345">:=</span>&nbsp;<span class="keyword" id="689348">func</span><span class="op" id="689352">(</span><span class="ident" id="689353">c</span>&nbsp;<span class="op" id="689355">*</span><span class="ident" id="689356">exec</span><span class="op" id="689360">.</span><span class="ident" id="689361">Cmd</span><span class="op" id="689364">,</span>&nbsp;<span class="ident" id="689366">out</span>&nbsp;<span class="keyword" id="689370">chan</span><span class="op" id="689374">&lt;-</span>&nbsp;<span class="builtintype" id="689377">string</span><span class="op" id="689383">)</span>&nbsp;<span class="op" id="689385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="689389">bout</span><span class="op" id="689393">,</span>&nbsp;<span class="ident" id="689395">err</span>&nbsp;<span class="op" id="689399">:=</span>&nbsp;<span class="ident" id="689402">c</span><span class="op" id="689403">.</span><span class="ident" id="689404">CombinedOutput</span><span class="op" id="689418">(</span><span class="op" id="689419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="689423">if</span>&nbsp;<span class="ident" id="689426">err</span>&nbsp;<span class="op" id="689430">!=</span>&nbsp;<span class="ident" id="689433">nil</span>&nbsp;<span class="op" id="689437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="689442">out</span>&nbsp;<span class="op" id="689446">&lt;-</span>&nbsp;<span class="string" id="689449">&#34;ERROR:&#34;</span>&nbsp;<span class="op" id="689458">+</span>&nbsp;<span class="ident" id="689460">err</span><span class="op" id="689463">.</span><span class="ident" id="689464">Error</span><span class="op" id="689469">(</span><span class="op" id="689470">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="689474">}</span>&nbsp;<span class="keyword" id="689476">else</span>&nbsp;<span class="op" id="689481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="689486">out</span>&nbsp;<span class="op" id="689490">&lt;-</span>&nbsp;<span class="builtintype" id="689493">string</span><span class="op" id="689499">(</span><span class="ident" id="689500">bout</span><span class="op" id="689504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="689508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="689511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="689515">for</span>&nbsp;<span class="ident" id="689519">i</span>&nbsp;<span class="op" id="689521">:=</span>&nbsp;<span class="num" id="689524">0</span><span class="op" id="689525">;</span>&nbsp;<span class="ident" id="689527">i</span>&nbsp;<span class="op" id="689529">&lt;</span>&nbsp;<span class="num" id="689531">10</span><span class="op" id="689533">;</span>&nbsp;<span class="ident" id="689535">i</span><span class="op" id="689536">++</span>&nbsp;<span class="op" id="689539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="689543">la</span>&nbsp;<span class="op" id="689546">:=</span>&nbsp;<span class="ident" id="689549">listen</span><span class="op" id="689555">(</span><span class="op" id="689556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="689560">ca</span>&nbsp;<span class="op" id="689563">:=</span>&nbsp;<span class="ident" id="689566">helperCommand</span><span class="op" id="689579">(</span><span class="ident" id="689580">t</span><span class="op" id="689581">,</span>&nbsp;<span class="string" id="689583">&#34;describefiles&#34;</span><span class="op" id="689598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="689602">ca</span><span class="op" id="689604">.</span><span class="ident" id="689605">ExtraFiles</span>&nbsp;<span class="op" id="689616">=</span>&nbsp;<span class="op" id="689618">[</span><span class="op" id="689619">]</span><span class="op" id="689620">*</span><span class="ident" id="689621">os</span><span class="op" id="689623">.</span><span class="ident" id="689624">File</span><span class="op" id="689628">{</span><span class="ident" id="689629">listenerFile</span><span class="op" id="689641">(</span><span class="ident" id="689642">la</span><span class="op" id="689644">)</span><span class="op" id="689645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="689649">lb</span>&nbsp;<span class="op" id="689652">:=</span>&nbsp;<span class="ident" id="689655">listen</span><span class="op" id="689661">(</span><span class="op" id="689662">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="689666">cb</span>&nbsp;<span class="op" id="689669">:=</span>&nbsp;<span class="ident" id="689672">helperCommand</span><span class="op" id="689685">(</span><span class="ident" id="689686">t</span><span class="op" id="689687">,</span>&nbsp;<span class="string" id="689689">&#34;describefiles&#34;</span><span class="op" id="689704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="689708">cb</span><span class="op" id="689710">.</span><span class="ident" id="689711">ExtraFiles</span>&nbsp;<span class="op" id="689722">=</span>&nbsp;<span class="op" id="689724">[</span><span class="op" id="689725">]</span><span class="op" id="689726">*</span><span class="ident" id="689727">os</span><span class="op" id="689729">.</span><span class="ident" id="689730">File</span><span class="op" id="689734">{</span><span class="ident" id="689735">listenerFile</span><span class="op" id="689747">(</span><span class="ident" id="689748">lb</span><span class="op" id="689750">)</span><span class="op" id="689751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="689755">ares</span>&nbsp;<span class="op" id="689760">:=</span>&nbsp;<span class="builtinfunc" id="689763">make</span><span class="op" id="689767">(</span><span class="keyword" id="689768">chan</span>&nbsp;<span class="builtintype" id="689773">string</span><span class="op" id="689779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="689783">bres</span>&nbsp;<span class="op" id="689788">:=</span>&nbsp;<span class="builtinfunc" id="689791">make</span><span class="op" id="689795">(</span><span class="keyword" id="689796">chan</span>&nbsp;<span class="builtintype" id="689801">string</span><span class="op" id="689807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="689811">go</span>&nbsp;<span class="ident" id="689814">runCommand</span><span class="op" id="689824">(</span><span class="ident" id="689825">ca</span><span class="op" id="689827">,</span>&nbsp;<span class="ident" id="689829">ares</span><span class="op" id="689833">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="689837">go</span>&nbsp;<span class="ident" id="689840">runCommand</span><span class="op" id="689850">(</span><span class="ident" id="689851">cb</span><span class="op" id="689853">,</span>&nbsp;<span class="ident" id="689855">bres</span><span class="op" id="689859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="689863">if</span>&nbsp;<span class="ident" id="689866">got</span><span class="op" id="689869">,</span>&nbsp;<span class="ident" id="689871">want</span>&nbsp;<span class="op" id="689876">:=</span>&nbsp;<span class="op" id="689879">&lt;-</span><span class="ident" id="689881">ares</span><span class="op" id="689885">,</span>&nbsp;<span class="ident" id="689887">fmt</span><span class="op" id="689890">.</span><span class="ident" id="689891">Sprintf</span><span class="op" id="689898">(</span><span class="string" id="689899">&#34;fd3:&nbsp;listener&nbsp;%s\n&#34;</span><span class="op" id="689919">,</span>&nbsp;<span class="ident" id="689921">la</span><span class="op" id="689923">.</span><span class="ident" id="689924">Addr</span><span class="op" id="689928">(</span><span class="op" id="689929">)</span><span class="op" id="689930">)</span><span class="op" id="689931">;</span>&nbsp;<span class="ident" id="689933">got</span>&nbsp;<span class="op" id="689937">!=</span>&nbsp;<span class="ident" id="689940">want</span>&nbsp;<span class="op" id="689945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="689950">t</span><span class="op" id="689951">.</span><span class="ident" id="689952">Errorf</span><span class="op" id="689958">(</span><span class="string" id="689959">&#34;iteration&nbsp;%d,&nbsp;process&nbsp;A&nbsp;got:\n%s\nwant:\n%s\n&#34;</span><span class="op" id="690006">,</span>&nbsp;<span class="ident" id="690008">i</span><span class="op" id="690009">,</span>&nbsp;<span class="ident" id="690011">got</span><span class="op" id="690014">,</span>&nbsp;<span class="ident" id="690016">want</span><span class="op" id="690020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="690024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="690028">if</span>&nbsp;<span class="ident" id="690031">got</span><span class="op" id="690034">,</span>&nbsp;<span class="ident" id="690036">want</span>&nbsp;<span class="op" id="690041">:=</span>&nbsp;<span class="op" id="690044">&lt;-</span><span class="ident" id="690046">bres</span><span class="op" id="690050">,</span>&nbsp;<span class="ident" id="690052">fmt</span><span class="op" id="690055">.</span><span class="ident" id="690056">Sprintf</span><span class="op" id="690063">(</span><span class="string" id="690064">&#34;fd3:&nbsp;listener&nbsp;%s\n&#34;</span><span class="op" id="690084">,</span>&nbsp;<span class="ident" id="690086">lb</span><span class="op" id="690088">.</span><span class="ident" id="690089">Addr</span><span class="op" id="690093">(</span><span class="op" id="690094">)</span><span class="op" id="690095">)</span><span class="op" id="690096">;</span>&nbsp;<span class="ident" id="690098">got</span>&nbsp;<span class="op" id="690102">!=</span>&nbsp;<span class="ident" id="690105">want</span>&nbsp;<span class="op" id="690110">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="690115">t</span><span class="op" id="690116">.</span><span class="ident" id="690117">Errorf</span><span class="op" id="690123">(</span><span class="string" id="690124">&#34;iteration&nbsp;%d,&nbsp;process&nbsp;B&nbsp;got:\n%s\nwant:\n%s\n&#34;</span><span class="op" id="690171">,</span>&nbsp;<span class="ident" id="690173">i</span><span class="op" id="690174">,</span>&nbsp;<span class="ident" id="690176">got</span><span class="op" id="690179">,</span>&nbsp;<span class="ident" id="690181">want</span><span class="op" id="690185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="690189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="690193">la</span><span class="op" id="690195">.</span><span class="ident" id="690196">Close</span><span class="op" id="690201">(</span><span class="op" id="690202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="690206">lb</span><span class="op" id="690208">.</span><span class="ident" id="690209">Close</span><span class="op" id="690214">(</span><span class="op" id="690215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="690219">for</span>&nbsp;<span class="ident" id="690223">_</span><span class="op" id="690224">,</span>&nbsp;<span class="ident" id="690226">f</span>&nbsp;<span class="op" id="690228">:=</span>&nbsp;<span class="keyword" id="690231">range</span>&nbsp;<span class="ident" id="690237">ca</span><span class="op" id="690239">.</span><span class="ident" id="690240">ExtraFiles</span>&nbsp;<span class="op" id="690251">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="690256">f</span><span class="op" id="690257">.</span><span class="ident" id="690258">Close</span><span class="op" id="690263">(</span><span class="op" id="690264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="690268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="690272">for</span>&nbsp;<span class="ident" id="690276">_</span><span class="op" id="690277">,</span>&nbsp;<span class="ident" id="690279">f</span>&nbsp;<span class="op" id="690281">:=</span>&nbsp;<span class="keyword" id="690284">range</span>&nbsp;<span class="ident" id="690290">cb</span><span class="op" id="690292">.</span><span class="ident" id="690293">ExtraFiles</span>&nbsp;<span class="op" id="690304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="690309">f</span><span class="op" id="690310">.</span><span class="ident" id="690311">Close</span><span class="op" id="690316">(</span><span class="op" id="690317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="690321">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="690325">}</span><br>
<span class="lineno"></span><span class="op" id="690327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="690330">//&nbsp;TestHelperProcess&nbsp;isn&#39;t&nbsp;a&nbsp;real&nbsp;test.&nbsp;It&#39;s&nbsp;used&nbsp;as&nbsp;a&nbsp;helper&nbsp;process</span><br>
<span class="lineno">510</span><span class="comment" id="690400">//&nbsp;for&nbsp;TestParameterRun.</span><br>
<span class="lineno"></span><span class="keyword" id="690425">func</span>&nbsp;<span class="ident" id="690430">TestHelperProcess</span><span class="op" id="690447">(</span><span class="op" id="690448">*</span><span class="ident" id="690449">testing</span><span class="op" id="690456">.</span><span class="ident" id="690457">T</span><span class="op" id="690458">)</span>&nbsp;<span class="op" id="690460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="690463">if</span>&nbsp;<span class="ident" id="690466">os</span><span class="op" id="690468">.</span><span class="ident" id="690469">Getenv</span><span class="op" id="690475">(</span><span class="string" id="690476">&#34;GO_WANT_HELPER_PROCESS&#34;</span><span class="op" id="690500">)</span>&nbsp;<span class="op" id="690502">!=</span>&nbsp;<span class="string" id="690505">&#34;1&#34;</span>&nbsp;<span class="op" id="690509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="690513">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="690521">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="690524">defer</span>&nbsp;<span class="ident" id="690530">os</span><span class="op" id="690532">.</span><span class="ident" id="690533">Exit</span><span class="op" id="690537">(</span><span class="num" id="690538">0</span><span class="op" id="690539">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="690543">//&nbsp;Determine&nbsp;which&nbsp;command&nbsp;to&nbsp;use&nbsp;to&nbsp;display&nbsp;open&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="690601">ofcmd</span>&nbsp;<span class="op" id="690607">:=</span>&nbsp;<span class="string" id="690610">&#34;lsof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="690618">switch</span>&nbsp;<span class="ident" id="690625">runtime</span><span class="op" id="690632">.</span><span class="ident" id="690633">GOOS</span>&nbsp;<span class="op" id="690638">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="690641">case</span>&nbsp;<span class="string" id="690646">&#34;dragonfly&#34;</span><span class="op" id="690657">,</span>&nbsp;<span class="string" id="690659">&#34;freebsd&#34;</span><span class="op" id="690668">,</span>&nbsp;<span class="string" id="690670">&#34;netbsd&#34;</span><span class="op" id="690678">,</span>&nbsp;<span class="string" id="690680">&#34;openbsd&#34;</span><span class="op" id="690689">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="690693">ofcmd</span>&nbsp;<span class="op" id="690699">=</span>&nbsp;<span class="string" id="690701">&#34;fstat&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="690710">case</span>&nbsp;<span class="string" id="690715">&#34;plan9&#34;</span><span class="op" id="690722">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="690726">ofcmd</span>&nbsp;<span class="op" id="690732">=</span>&nbsp;<span class="string" id="690734">&#34;/bin/cat&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="690746">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="690750">args</span>&nbsp;<span class="op" id="690755">:=</span>&nbsp;<span class="ident" id="690758">os</span><span class="op" id="690760">.</span><span class="ident" id="690761">Args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="690767">for</span>&nbsp;<span class="builtinfunc" id="690771">len</span><span class="op" id="690774">(</span><span class="ident" id="690775">args</span><span class="op" id="690779">)</span>&nbsp;<span class="op" id="690781">&gt;</span>&nbsp;<span class="num" id="690783">0</span>&nbsp;<span class="op" id="690785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="690789">if</span>&nbsp;<span class="ident" id="690792">args</span><span class="op" id="690796">[</span><span class="num" id="690797">0</span><span class="op" id="690798">]</span>&nbsp;<span class="op" id="690800">==</span>&nbsp;<span class="string" id="690803">&#34;--&#34;</span>&nbsp;<span class="op" id="690808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="690813">args</span>&nbsp;<span class="op" id="690818">=</span>&nbsp;<span class="ident" id="690820">args</span><span class="op" id="690824">[</span><span class="num" id="690825">1</span><span class="op" id="690826">:</span><span class="op" id="690827">]</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="690832">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="690840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="690844">args</span>&nbsp;<span class="op" id="690849">=</span>&nbsp;<span class="ident" id="690851">args</span><span class="op" id="690855">[</span><span class="num" id="690856">1</span><span class="op" id="690857">:</span><span class="op" id="690858">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="690861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="690864">if</span>&nbsp;<span class="builtinfunc" id="690867">len</span><span class="op" id="690870">(</span><span class="ident" id="690871">args</span><span class="op" id="690875">)</span>&nbsp;<span class="op" id="690877">==</span>&nbsp;<span class="num" id="690880">0</span>&nbsp;<span class="op" id="690882">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="690886">fmt</span><span class="op" id="690889">.</span><span class="ident" id="690890">Fprintf</span><span class="op" id="690897">(</span><span class="ident" id="690898">os</span><span class="op" id="690900">.</span><span class="ident" id="690901">Stderr</span><span class="op" id="690907">,</span>&nbsp;<span class="string" id="690909">&#34;No&nbsp;command\n&#34;</span><span class="op" id="690923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="690927">os</span><span class="op" id="690929">.</span><span class="ident" id="690930">Exit</span><span class="op" id="690934">(</span><span class="num" id="690935">2</span><span class="op" id="690936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="690939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="690943">cmd</span><span class="op" id="690946">,</span>&nbsp;<span class="ident" id="690948">args</span>&nbsp;<span class="op" id="690953">:=</span>&nbsp;<span class="ident" id="690956">args</span><span class="op" id="690960">[</span><span class="num" id="690961">0</span><span class="op" id="690962">]</span><span class="op" id="690963">,</span>&nbsp;<span class="ident" id="690965">args</span><span class="op" id="690969">[</span><span class="num" id="690970">1</span><span class="op" id="690971">:</span><span class="op" id="690972">]</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="690975">switch</span>&nbsp;<span class="ident" id="690982">cmd</span>&nbsp;<span class="op" id="690986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="690989">case</span>&nbsp;<span class="string" id="690994">&#34;echo&#34;</span><span class="op" id="691000">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691004">iargs</span>&nbsp;<span class="op" id="691010">:=</span>&nbsp;<span class="op" id="691013">[</span><span class="op" id="691014">]</span><span class="keyword" id="691015">interface</span><span class="op" id="691024">{</span><span class="op" id="691025">}</span><span class="op" id="691026">{</span><span class="op" id="691027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="691031">for</span>&nbsp;<span class="ident" id="691035">_</span><span class="op" id="691036">,</span>&nbsp;<span class="ident" id="691038">s</span>&nbsp;<span class="op" id="691040">:=</span>&nbsp;<span class="keyword" id="691043">range</span>&nbsp;<span class="ident" id="691049">args</span>&nbsp;<span class="op" id="691054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691059">iargs</span>&nbsp;<span class="op" id="691065">=</span>&nbsp;<span class="builtinfunc" id="691067">append</span><span class="op" id="691073">(</span><span class="ident" id="691074">iargs</span><span class="op" id="691079">,</span>&nbsp;<span class="ident" id="691081">s</span><span class="op" id="691082">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="691086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691090">fmt</span><span class="op" id="691093">.</span><span class="ident" id="691094">Println</span><span class="op" id="691101">(</span><span class="ident" id="691102">iargs</span><span class="op" id="691107">...</span><span class="op" id="691110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="691113">case</span>&nbsp;<span class="string" id="691118">&#34;cat&#34;</span><span class="op" id="691123">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="691127">if</span>&nbsp;<span class="builtinfunc" id="691130">len</span><span class="op" id="691133">(</span><span class="ident" id="691134">args</span><span class="op" id="691138">)</span>&nbsp;<span class="op" id="691140">==</span>&nbsp;<span class="num" id="691143">0</span>&nbsp;<span class="op" id="691145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691150">io</span><span class="op" id="691152">.</span><span class="ident" id="691153">Copy</span><span class="op" id="691157">(</span><span class="ident" id="691158">os</span><span class="op" id="691160">.</span><span class="ident" id="691161">Stdout</span><span class="op" id="691167">,</span>&nbsp;<span class="ident" id="691169">os</span><span class="op" id="691171">.</span><span class="ident" id="691172">Stdin</span><span class="op" id="691177">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="691182">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="691191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691195">exit</span>&nbsp;<span class="op" id="691200">:=</span>&nbsp;<span class="num" id="691203">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="691207">for</span>&nbsp;<span class="ident" id="691211">_</span><span class="op" id="691212">,</span>&nbsp;<span class="ident" id="691214">fn</span>&nbsp;<span class="op" id="691217">:=</span>&nbsp;<span class="keyword" id="691220">range</span>&nbsp;<span class="ident" id="691226">args</span>&nbsp;<span class="op" id="691231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691236">f</span><span class="op" id="691237">,</span>&nbsp;<span class="ident" id="691239">err</span>&nbsp;<span class="op" id="691243">:=</span>&nbsp;<span class="ident" id="691246">os</span><span class="op" id="691248">.</span><span class="ident" id="691249">Open</span><span class="op" id="691253">(</span><span class="ident" id="691254">fn</span><span class="op" id="691256">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="691261">if</span>&nbsp;<span class="ident" id="691264">err</span>&nbsp;<span class="op" id="691268">!=</span>&nbsp;<span class="ident" id="691271">nil</span>&nbsp;<span class="op" id="691275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691281">fmt</span><span class="op" id="691284">.</span><span class="ident" id="691285">Fprintf</span><span class="op" id="691292">(</span><span class="ident" id="691293">os</span><span class="op" id="691295">.</span><span class="ident" id="691296">Stderr</span><span class="op" id="691302">,</span>&nbsp;<span class="string" id="691304">&#34;Error:&nbsp;%v\n&#34;</span><span class="op" id="691317">,</span>&nbsp;<span class="ident" id="691319">err</span><span class="op" id="691322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691328">exit</span>&nbsp;<span class="op" id="691333">=</span>&nbsp;<span class="num" id="691335">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="691340">}</span>&nbsp;<span class="keyword" id="691342">else</span>&nbsp;<span class="op" id="691347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="691353">defer</span>&nbsp;<span class="ident" id="691359">f</span><span class="op" id="691360">.</span><span class="ident" id="691361">Close</span><span class="op" id="691366">(</span><span class="op" id="691367">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691373">io</span><span class="op" id="691375">.</span><span class="ident" id="691376">Copy</span><span class="op" id="691380">(</span><span class="ident" id="691381">os</span><span class="op" id="691383">.</span><span class="ident" id="691384">Stdout</span><span class="op" id="691390">,</span>&nbsp;<span class="ident" id="691392">f</span><span class="op" id="691393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="691398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="691402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691406">os</span><span class="op" id="691408">.</span><span class="ident" id="691409">Exit</span><span class="op" id="691413">(</span><span class="ident" id="691414">exit</span><span class="op" id="691418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="691421">case</span>&nbsp;<span class="string" id="691426">&#34;pipetest&#34;</span><span class="op" id="691436">:</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691440">bufr</span>&nbsp;<span class="op" id="691445">:=</span>&nbsp;<span class="ident" id="691448">bufio</span><span class="op" id="691453">.</span><span class="ident" id="691454">NewReader</span><span class="op" id="691463">(</span><span class="ident" id="691464">os</span><span class="op" id="691466">.</span><span class="ident" id="691467">Stdin</span><span class="op" id="691472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="691476">for</span>&nbsp;<span class="op" id="691480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691485">line</span><span class="op" id="691489">,</span>&nbsp;<span class="ident" id="691491">_</span><span class="op" id="691492">,</span>&nbsp;<span class="ident" id="691494">err</span>&nbsp;<span class="op" id="691498">:=</span>&nbsp;<span class="ident" id="691501">bufr</span><span class="op" id="691505">.</span><span class="ident" id="691506">ReadLine</span><span class="op" id="691514">(</span><span class="op" id="691515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="691520">if</span>&nbsp;<span class="ident" id="691523">err</span>&nbsp;<span class="op" id="691527">==</span>&nbsp;<span class="ident" id="691530">io</span><span class="op" id="691532">.</span><span class="ident" id="691533">EOF</span>&nbsp;<span class="op" id="691537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="691543">break</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="691552">}</span>&nbsp;<span class="keyword" id="691554">else</span>&nbsp;<span class="keyword" id="691559">if</span>&nbsp;<span class="ident" id="691562">err</span>&nbsp;<span class="op" id="691566">!=</span>&nbsp;<span class="ident" id="691569">nil</span>&nbsp;<span class="op" id="691573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691579">os</span><span class="op" id="691581">.</span><span class="ident" id="691582">Exit</span><span class="op" id="691586">(</span><span class="num" id="691587">1</span><span class="op" id="691588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="691593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="691598">if</span>&nbsp;<span class="ident" id="691601">bytes</span><span class="op" id="691606">.</span><span class="ident" id="691607">HasPrefix</span><span class="op" id="691616">(</span><span class="ident" id="691617">line</span><span class="op" id="691621">,</span>&nbsp;<span class="op" id="691623">[</span><span class="op" id="691624">]</span><span class="builtintype" id="691625">byte</span><span class="op" id="691629">(</span><span class="string" id="691630">&#34;O:&#34;</span><span class="op" id="691634">)</span><span class="op" id="691635">)</span>&nbsp;<span class="op" id="691637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691643">os</span><span class="op" id="691645">.</span><span class="ident" id="691646">Stdout</span><span class="op" id="691652">.</span><span class="ident" id="691653">Write</span><span class="op" id="691658">(</span><span class="ident" id="691659">line</span><span class="op" id="691663">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691669">os</span><span class="op" id="691671">.</span><span class="ident" id="691672">Stdout</span><span class="op" id="691678">.</span><span class="ident" id="691679">Write</span><span class="op" id="691684">(</span><span class="op" id="691685">[</span><span class="op" id="691686">]</span><span class="builtintype" id="691687">byte</span><span class="op" id="691691">{</span><span class="string" id="691692">&#39;\n&#39;</span><span class="op" id="691696">}</span><span class="op" id="691697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="691702">}</span>&nbsp;<span class="keyword" id="691704">else</span>&nbsp;<span class="keyword" id="691709">if</span>&nbsp;<span class="ident" id="691712">bytes</span><span class="op" id="691717">.</span><span class="ident" id="691718">HasPrefix</span><span class="op" id="691727">(</span><span class="ident" id="691728">line</span><span class="op" id="691732">,</span>&nbsp;<span class="op" id="691734">[</span><span class="op" id="691735">]</span><span class="builtintype" id="691736">byte</span><span class="op" id="691740">(</span><span class="string" id="691741">&#34;E:&#34;</span><span class="op" id="691745">)</span><span class="op" id="691746">)</span>&nbsp;<span class="op" id="691748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691754">os</span><span class="op" id="691756">.</span><span class="ident" id="691757">Stderr</span><span class="op" id="691763">.</span><span class="ident" id="691764">Write</span><span class="op" id="691769">(</span><span class="ident" id="691770">line</span><span class="op" id="691774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691780">os</span><span class="op" id="691782">.</span><span class="ident" id="691783">Stderr</span><span class="op" id="691789">.</span><span class="ident" id="691790">Write</span><span class="op" id="691795">(</span><span class="op" id="691796">[</span><span class="op" id="691797">]</span><span class="builtintype" id="691798">byte</span><span class="op" id="691802">{</span><span class="string" id="691803">&#39;\n&#39;</span><span class="op" id="691807">}</span><span class="op" id="691808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="691813">}</span>&nbsp;<span class="keyword" id="691815">else</span>&nbsp;<span class="op" id="691820">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691826">os</span><span class="op" id="691828">.</span><span class="ident" id="691829">Exit</span><span class="op" id="691833">(</span><span class="num" id="691834">1</span><span class="op" id="691835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="691840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="691844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="691847">case</span>&nbsp;<span class="string" id="691852">&#34;stdinClose&#34;</span><span class="op" id="691864">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691868">b</span><span class="op" id="691869">,</span>&nbsp;<span class="ident" id="691871">err</span>&nbsp;<span class="op" id="691875">:=</span>&nbsp;<span class="ident" id="691878">ioutil</span><span class="op" id="691884">.</span><span class="ident" id="691885">ReadAll</span><span class="op" id="691892">(</span><span class="ident" id="691893">os</span><span class="op" id="691895">.</span><span class="ident" id="691896">Stdin</span><span class="op" id="691901">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="691905">if</span>&nbsp;<span class="ident" id="691908">err</span>&nbsp;<span class="op" id="691912">!=</span>&nbsp;<span class="ident" id="691915">nil</span>&nbsp;<span class="op" id="691919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691924">fmt</span><span class="op" id="691927">.</span><span class="ident" id="691928">Fprintf</span><span class="op" id="691935">(</span><span class="ident" id="691936">os</span><span class="op" id="691938">.</span><span class="ident" id="691939">Stderr</span><span class="op" id="691945">,</span>&nbsp;<span class="string" id="691947">&#34;Error:&nbsp;%v\n&#34;</span><span class="op" id="691960">,</span>&nbsp;<span class="ident" id="691962">err</span><span class="op" id="691965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="691970">os</span><span class="op" id="691972">.</span><span class="ident" id="691973">Exit</span><span class="op" id="691977">(</span><span class="num" id="691978">1</span><span class="op" id="691979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="691983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="691987">if</span>&nbsp;<span class="ident" id="691990">s</span>&nbsp;<span class="op" id="691992">:=</span>&nbsp;<span class="builtintype" id="691995">string</span><span class="op" id="692001">(</span><span class="ident" id="692002">b</span><span class="op" id="692003">)</span><span class="op" id="692004">;</span>&nbsp;<span class="ident" id="692006">s</span>&nbsp;<span class="op" id="692008">!=</span>&nbsp;<span class="ident" id="692011">stdinCloseTestString</span>&nbsp;<span class="op" id="692032">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="692037">fmt</span><span class="op" id="692040">.</span><span class="ident" id="692041">Fprintf</span><span class="op" id="692048">(</span><span class="ident" id="692049">os</span><span class="op" id="692051">.</span><span class="ident" id="692052">Stderr</span><span class="op" id="692058">,</span>&nbsp;<span class="string" id="692060">&#34;Error:&nbsp;Read&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="692085">,</span>&nbsp;<span class="ident" id="692087">s</span><span class="op" id="692088">,</span>&nbsp;<span class="ident" id="692090">stdinCloseTestString</span><span class="op" id="692110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="692115">os</span><span class="op" id="692117">.</span><span class="ident" id="692118">Exit</span><span class="op" id="692122">(</span><span class="num" id="692123">1</span><span class="op" id="692124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="692128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="692132">os</span><span class="op" id="692134">.</span><span class="ident" id="692135">Exit</span><span class="op" id="692139">(</span><span class="num" id="692140">0</span><span class="op" id="692141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="692144">case</span>&nbsp;<span class="string" id="692149">&#34;read3&#34;</span><span class="op" id="692156">:</span>&nbsp;<span class="comment" id="692158">//&nbsp;read&nbsp;fd&nbsp;3</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="692173">fd3</span>&nbsp;<span class="op" id="692177">:=</span>&nbsp;<span class="ident" id="692180">os</span><span class="op" id="692182">.</span><span class="ident" id="692183">NewFile</span><span class="op" id="692190">(</span><span class="num" id="692191">3</span><span class="op" id="692192">,</span>&nbsp;<span class="string" id="692194">&#34;fd3&#34;</span><span class="op" id="692199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="692203">bs</span><span class="op" id="692205">,</span>&nbsp;<span class="ident" id="692207">err</span>&nbsp;<span class="op" id="692211">:=</span>&nbsp;<span class="ident" id="692214">ioutil</span><span class="op" id="692220">.</span><span class="ident" id="692221">ReadAll</span><span class="op" id="692228">(</span><span class="ident" id="692229">fd3</span><span class="op" id="692232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="692236">if</span>&nbsp;<span class="ident" id="692239">err</span>&nbsp;<span class="op" id="692243">!=</span>&nbsp;<span class="ident" id="692246">nil</span>&nbsp;<span class="op" id="692250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="692255">fmt</span><span class="op" id="692258">.</span><span class="ident" id="692259">Printf</span><span class="op" id="692265">(</span><span class="string" id="692266">&#34;ReadAll&nbsp;from&nbsp;fd&nbsp;3:&nbsp;%v&#34;</span><span class="op" id="692289">,</span>&nbsp;<span class="ident" id="692291">err</span><span class="op" id="692294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="692299">os</span><span class="op" id="692301">.</span><span class="ident" id="692302">Exit</span><span class="op" id="692306">(</span><span class="num" id="692307">1</span><span class="op" id="692308">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="692312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="692316">switch</span>&nbsp;<span class="ident" id="692323">runtime</span><span class="op" id="692330">.</span><span class="ident" id="692331">GOOS</span>&nbsp;<span class="op" id="692336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="692340">case</span>&nbsp;<span class="string" id="692345">&#34;dragonfly&#34;</span><span class="op" id="692356">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="692361">//&nbsp;TODO(jsing):&nbsp;Determine&nbsp;why&nbsp;DragonFly&nbsp;is&nbsp;leaking</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="692415">//&nbsp;file&nbsp;descriptors...</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="692440">case</span>&nbsp;<span class="string" id="692445">&#34;darwin&#34;</span><span class="op" id="692453">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="692458">//&nbsp;TODO(bradfitz):&nbsp;broken?&nbsp;Sometimes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="692499">//&nbsp;http://golang.org/issue/2603</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="692534">//&nbsp;Skip&nbsp;this&nbsp;additional&nbsp;part&nbsp;of&nbsp;the&nbsp;test&nbsp;for&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="692586">case</span>&nbsp;<span class="string" id="692591">&#34;netbsd&#34;</span><span class="op" id="692599">:</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="692604">//&nbsp;TODO(jsing):&nbsp;This&nbsp;currently&nbsp;fails&nbsp;on&nbsp;NetBSD&nbsp;due&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="692661">//&nbsp;the&nbsp;cloned&nbsp;file&nbsp;descriptors&nbsp;that&nbsp;result&nbsp;from&nbsp;opening</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="692720">//&nbsp;/dev/urandom.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="692740">//&nbsp;http://golang.org/issue/3955</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="692774">case</span>&nbsp;<span class="string" id="692779">&#34;plan9&#34;</span><span class="op" id="692786">:</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="692791">//&nbsp;TODO(0intro):&nbsp;Determine&nbsp;why&nbsp;Plan&nbsp;9&nbsp;is&nbsp;leaking</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="692843">//&nbsp;file&nbsp;descriptors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="692867">//&nbsp;http://golang.org/issue/7118</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="692901">case</span>&nbsp;<span class="string" id="692906">&#34;solaris&#34;</span><span class="op" id="692915">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="692920">//&nbsp;TODO(aram):&nbsp;This&nbsp;fails&nbsp;on&nbsp;Solaris&nbsp;because&nbsp;libc&nbsp;opens</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="692979">//&nbsp;its&nbsp;own&nbsp;files,&nbsp;as&nbsp;it&nbsp;sees&nbsp;fit.&nbsp;Darwin&nbsp;does&nbsp;the&nbsp;same,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="693038">//&nbsp;see:&nbsp;http://golang.org/issue/2603</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="693077">default</span><span class="op" id="693084">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="693089">//&nbsp;Now&nbsp;verify&nbsp;that&nbsp;there&nbsp;are&nbsp;no&nbsp;other&nbsp;open&nbsp;fds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="693140">var</span>&nbsp;<span class="ident" id="693144">files</span>&nbsp;<span class="op" id="693150">[</span><span class="op" id="693151">]</span><span class="op" id="693152">*</span><span class="ident" id="693153">os</span><span class="op" id="693155">.</span><span class="ident" id="693156">File</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="693164">for</span>&nbsp;<span class="ident" id="693168">wantfd</span>&nbsp;<span class="op" id="693175">:=</span>&nbsp;<span class="ident" id="693178">basefds</span><span class="op" id="693185">(</span><span class="op" id="693186">)</span>&nbsp;<span class="op" id="693188">+</span>&nbsp;<span class="num" id="693190">1</span><span class="op" id="693191">;</span>&nbsp;<span class="ident" id="693193">wantfd</span>&nbsp;<span class="op" id="693200">&lt;=</span>&nbsp;<span class="num" id="693203">100</span><span class="op" id="693206">;</span>&nbsp;<span class="ident" id="693208">wantfd</span><span class="op" id="693214">++</span>&nbsp;<span class="op" id="693217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="693223">f</span><span class="op" id="693224">,</span>&nbsp;<span class="ident" id="693226">err</span>&nbsp;<span class="op" id="693230">:=</span>&nbsp;<span class="ident" id="693233">os</span><span class="op" id="693235">.</span><span class="ident" id="693236">Open</span><span class="op" id="693240">(</span><span class="ident" id="693241">os</span><span class="op" id="693243">.</span><span class="ident" id="693244">Args</span><span class="op" id="693248">[</span><span class="num" id="693249">0</span><span class="op" id="693250">]</span><span class="op" id="693251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="693257">if</span>&nbsp;<span class="ident" id="693260">err</span>&nbsp;<span class="op" id="693264">!=</span>&nbsp;<span class="ident" id="693267">nil</span>&nbsp;<span class="op" id="693271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="693278">fmt</span><span class="op" id="693281">.</span><span class="ident" id="693282">Printf</span><span class="op" id="693288">(</span><span class="string" id="693289">&#34;error&nbsp;opening&nbsp;file&nbsp;with&nbsp;expected&nbsp;fd&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="693333">,</span>&nbsp;<span class="ident" id="693335">wantfd</span><span class="op" id="693341">,</span>&nbsp;<span class="ident" id="693343">err</span><span class="op" id="693346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="693353">os</span><span class="op" id="693355">.</span><span class="ident" id="693356">Exit</span><span class="op" id="693360">(</span><span class="num" id="693361">1</span><span class="op" id="693362">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="693368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="693374">if</span>&nbsp;<span class="ident" id="693377">got</span>&nbsp;<span class="op" id="693381">:=</span>&nbsp;<span class="ident" id="693384">f</span><span class="op" id="693385">.</span><span class="ident" id="693386">Fd</span><span class="op" id="693388">(</span><span class="op" id="693389">)</span><span class="op" id="693390">;</span>&nbsp;<span class="ident" id="693392">got</span>&nbsp;<span class="op" id="693396">!=</span>&nbsp;<span class="ident" id="693399">wantfd</span>&nbsp;<span class="op" id="693406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="693413">fmt</span><span class="op" id="693416">.</span><span class="ident" id="693417">Printf</span><span class="op" id="693423">(</span><span class="string" id="693424">&#34;leaked&nbsp;parent&nbsp;file.&nbsp;fd&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="693464">,</span>&nbsp;<span class="ident" id="693466">got</span><span class="op" id="693469">,</span>&nbsp;<span class="ident" id="693471">wantfd</span><span class="op" id="693477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="693484">var</span>&nbsp;<span class="ident" id="693488">args</span>&nbsp;<span class="op" id="693493">[</span><span class="op" id="693494">]</span><span class="builtintype" id="693495">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="693507">switch</span>&nbsp;<span class="ident" id="693514">runtime</span><span class="op" id="693521">.</span><span class="ident" id="693522">GOOS</span>&nbsp;<span class="op" id="693527">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="693534">case</span>&nbsp;<span class="string" id="693539">&#34;plan9&#34;</span><span class="op" id="693546">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="693554">args</span>&nbsp;<span class="op" id="693559">=</span>&nbsp;<span class="op" id="693561">[</span><span class="op" id="693562">]</span><span class="builtintype" id="693563">string</span><span class="op" id="693569">{</span><span class="ident" id="693570">fmt</span><span class="op" id="693573">.</span><span class="ident" id="693574">Sprintf</span><span class="op" id="693581">(</span><span class="string" id="693582">&#34;/proc/%d/fd&#34;</span><span class="op" id="693595">,</span>&nbsp;<span class="ident" id="693597">os</span><span class="op" id="693599">.</span><span class="ident" id="693600">Getpid</span><span class="op" id="693606">(</span><span class="op" id="693607">)</span><span class="op" id="693608">)</span><span class="op" id="693609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="693616">default</span><span class="op" id="693623">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="693631">args</span>&nbsp;<span class="op" id="693636">=</span>&nbsp;<span class="op" id="693638">[</span><span class="op" id="693639">]</span><span class="builtintype" id="693640">string</span><span class="op" id="693646">{</span><span class="string" id="693647">&#34;-p&#34;</span><span class="op" id="693651">,</span>&nbsp;<span class="ident" id="693653">fmt</span><span class="op" id="693656">.</span><span class="ident" id="693657">Sprint</span><span class="op" id="693663">(</span><span class="ident" id="693664">os</span><span class="op" id="693666">.</span><span class="ident" id="693667">Getpid</span><span class="op" id="693673">(</span><span class="op" id="693674">)</span><span class="op" id="693675">)</span><span class="op" id="693676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="693683">}</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="693690">out</span><span class="op" id="693693">,</span>&nbsp;<span class="ident" id="693695">_</span>&nbsp;<span class="op" id="693697">:=</span>&nbsp;<span class="ident" id="693700">exec</span><span class="op" id="693704">.</span><span class="ident" id="693705">Command</span><span class="op" id="693712">(</span><span class="ident" id="693713">ofcmd</span><span class="op" id="693718">,</span>&nbsp;<span class="ident" id="693720">args</span><span class="op" id="693724">...</span><span class="op" id="693727">)</span><span class="op" id="693728">.</span><span class="ident" id="693729">CombinedOutput</span><span class="op" id="693743">(</span><span class="op" id="693744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="693751">fmt</span><span class="op" id="693754">.</span><span class="ident" id="693755">Print</span><span class="op" id="693760">(</span><span class="builtintype" id="693761">string</span><span class="op" id="693767">(</span><span class="ident" id="693768">out</span><span class="op" id="693771">)</span><span class="op" id="693772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="693779">os</span><span class="op" id="693781">.</span><span class="ident" id="693782">Exit</span><span class="op" id="693786">(</span><span class="num" id="693787">1</span><span class="op" id="693788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="693794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="693800">files</span>&nbsp;<span class="op" id="693806">=</span>&nbsp;<span class="builtinfunc" id="693808">append</span><span class="op" id="693814">(</span><span class="ident" id="693815">files</span><span class="op" id="693820">,</span>&nbsp;<span class="ident" id="693822">f</span><span class="op" id="693823">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="693828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="693833">for</span>&nbsp;<span class="ident" id="693837">_</span><span class="op" id="693838">,</span>&nbsp;<span class="ident" id="693840">f</span>&nbsp;<span class="op" id="693842">:=</span>&nbsp;<span class="keyword" id="693845">range</span>&nbsp;<span class="ident" id="693851">files</span>&nbsp;<span class="op" id="693857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="693863">f</span><span class="op" id="693864">.</span><span class="ident" id="693865">Close</span><span class="op" id="693870">(</span><span class="op" id="693871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="693876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="693880">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="693884">//&nbsp;Referring&nbsp;to&nbsp;fd3&nbsp;here&nbsp;ensures&nbsp;that&nbsp;it&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="693934">//&nbsp;garbage&nbsp;collected,&nbsp;and&nbsp;therefore&nbsp;closed,&nbsp;while</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="693986">//&nbsp;executing&nbsp;the&nbsp;wantfd&nbsp;loop&nbsp;above.&nbsp;&nbsp;It&nbsp;doesn&#39;t&nbsp;matter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="694043">//&nbsp;what&nbsp;we&nbsp;do&nbsp;with&nbsp;fd3&nbsp;as&nbsp;long&nbsp;as&nbsp;we&nbsp;refer&nbsp;to&nbsp;it;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="694095">//&nbsp;closing&nbsp;it&nbsp;is&nbsp;the&nbsp;easy&nbsp;choice.</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="694131">fd3</span><span class="op" id="694134">.</span><span class="ident" id="694135">Close</span><span class="op" id="694140">(</span><span class="op" id="694141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="694145">os</span><span class="op" id="694147">.</span><span class="ident" id="694148">Stdout</span><span class="op" id="694154">.</span><span class="ident" id="694155">Write</span><span class="op" id="694160">(</span><span class="ident" id="694161">bs</span><span class="op" id="694163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="694166">case</span>&nbsp;<span class="string" id="694171">&#34;exit&#34;</span><span class="op" id="694177">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="694181">n</span><span class="op" id="694182">,</span>&nbsp;<span class="ident" id="694184">_</span>&nbsp;<span class="op" id="694186">:=</span>&nbsp;<span class="ident" id="694189">strconv</span><span class="op" id="694196">.</span><span class="ident" id="694197">Atoi</span><span class="op" id="694201">(</span><span class="ident" id="694202">args</span><span class="op" id="694206">[</span><span class="num" id="694207">0</span><span class="op" id="694208">]</span><span class="op" id="694209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="694213">os</span><span class="op" id="694215">.</span><span class="ident" id="694216">Exit</span><span class="op" id="694220">(</span><span class="ident" id="694221">n</span><span class="op" id="694222">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="694225">case</span>&nbsp;<span class="string" id="694230">&#34;describefiles&#34;</span><span class="op" id="694245">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="694249">f</span>&nbsp;<span class="op" id="694251">:=</span>&nbsp;<span class="ident" id="694254">os</span><span class="op" id="694256">.</span><span class="ident" id="694257">NewFile</span><span class="op" id="694264">(</span><span class="num" id="694265">3</span><span class="op" id="694266">,</span>&nbsp;<span class="ident" id="694268">fmt</span><span class="op" id="694271">.</span><span class="ident" id="694272">Sprintf</span><span class="op" id="694279">(</span><span class="string" id="694280">&#34;fd3&#34;</span><span class="op" id="694285">)</span><span class="op" id="694286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="694290">ln</span><span class="op" id="694292">,</span>&nbsp;<span class="ident" id="694294">err</span>&nbsp;<span class="op" id="694298">:=</span>&nbsp;<span class="ident" id="694301">net</span><span class="op" id="694304">.</span><span class="ident" id="694305">FileListener</span><span class="op" id="694317">(</span><span class="ident" id="694318">f</span><span class="op" id="694319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="694323">if</span>&nbsp;<span class="ident" id="694326">err</span>&nbsp;<span class="op" id="694330">==</span>&nbsp;<span class="ident" id="694333">nil</span>&nbsp;<span class="op" id="694337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="694342">fmt</span><span class="op" id="694345">.</span><span class="ident" id="694346">Printf</span><span class="op" id="694352">(</span><span class="string" id="694353">&#34;fd3:&nbsp;listener&nbsp;%s\n&#34;</span><span class="op" id="694373">,</span>&nbsp;<span class="ident" id="694375">ln</span><span class="op" id="694377">.</span><span class="ident" id="694378">Addr</span><span class="op" id="694382">(</span><span class="op" id="694383">)</span><span class="op" id="694384">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="694389">ln</span><span class="op" id="694391">.</span><span class="ident" id="694392">Close</span><span class="op" id="694397">(</span><span class="op" id="694398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="694402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="694406">os</span><span class="op" id="694408">.</span><span class="ident" id="694409">Exit</span><span class="op" id="694413">(</span><span class="num" id="694414">0</span><span class="op" id="694415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="694418">case</span>&nbsp;<span class="string" id="694423">&#34;extraFilesAndPipes&#34;</span><span class="op" id="694443">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="694447">n</span><span class="op" id="694448">,</span>&nbsp;<span class="ident" id="694450">_</span>&nbsp;<span class="op" id="694452">:=</span>&nbsp;<span class="ident" id="694455">strconv</span><span class="op" id="694462">.</span><span class="ident" id="694463">Atoi</span><span class="op" id="694467">(</span><span class="ident" id="694468">args</span><span class="op" id="694472">[</span><span class="num" id="694473">0</span><span class="op" id="694474">]</span><span class="op" id="694475">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="694479">pipes</span>&nbsp;<span class="op" id="694485">:=</span>&nbsp;<span class="builtinfunc" id="694488">make</span><span class="op" id="694492">(</span><span class="op" id="694493">[</span><span class="op" id="694494">]</span><span class="op" id="694495">*</span><span class="ident" id="694496">os</span><span class="op" id="694498">.</span><span class="ident" id="694499">File</span><span class="op" id="694503">,</span>&nbsp;<span class="ident" id="694505">n</span><span class="op" id="694506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="694510">for</span>&nbsp;<span class="ident" id="694514">i</span>&nbsp;<span class="op" id="694516">:=</span>&nbsp;<span class="num" id="694519">0</span><span class="op" id="694520">;</span>&nbsp;<span class="ident" id="694522">i</span>&nbsp;<span class="op" id="694524">&lt;</span>&nbsp;<span class="ident" id="694526">n</span><span class="op" id="694527">;</span>&nbsp;<span class="ident" id="694529">i</span><span class="op" id="694530">++</span>&nbsp;<span class="op" id="694533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="694538">pipes</span><span class="op" id="694543">[</span><span class="ident" id="694544">i</span><span class="op" id="694545">]</span>&nbsp;<span class="op" id="694547">=</span>&nbsp;<span class="ident" id="694549">os</span><span class="op" id="694551">.</span><span class="ident" id="694552">NewFile</span><span class="op" id="694559">(</span><span class="builtintype" id="694560">uintptr</span><span class="op" id="694567">(</span><span class="num" id="694568">3</span><span class="op" id="694569">+</span><span class="ident" id="694570">i</span><span class="op" id="694571">)</span><span class="op" id="694572">,</span>&nbsp;<span class="ident" id="694574">strconv</span><span class="op" id="694581">.</span><span class="ident" id="694582">Itoa</span><span class="op" id="694586">(</span><span class="ident" id="694587">i</span><span class="op" id="694588">)</span><span class="op" id="694589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="694593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="694597">response</span>&nbsp;<span class="op" id="694606">:=</span>&nbsp;<span class="string" id="694609">&#34;&#34;</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="694614">for</span>&nbsp;<span class="ident" id="694618">i</span><span class="op" id="694619">,</span>&nbsp;<span class="ident" id="694621">r</span>&nbsp;<span class="op" id="694623">:=</span>&nbsp;<span class="keyword" id="694626">range</span>&nbsp;<span class="ident" id="694632">pipes</span>&nbsp;<span class="op" id="694638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="694643">ch</span>&nbsp;<span class="op" id="694646">:=</span>&nbsp;<span class="builtinfunc" id="694649">make</span><span class="op" id="694653">(</span><span class="keyword" id="694654">chan</span>&nbsp;<span class="builtintype" id="694659">string</span><span class="op" id="694665">,</span>&nbsp;<span class="num" id="694667">1</span><span class="op" id="694668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="694673">go</span>&nbsp;<span class="keyword" id="694676">func</span><span class="op" id="694680">(</span><span class="ident" id="694681">c</span>&nbsp;<span class="keyword" id="694683">chan</span>&nbsp;<span class="builtintype" id="694688">string</span><span class="op" id="694694">)</span>&nbsp;<span class="op" id="694696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="694702">buf</span>&nbsp;<span class="op" id="694706">:=</span>&nbsp;<span class="builtinfunc" id="694709">make</span><span class="op" id="694713">(</span><span class="op" id="694714">[</span><span class="op" id="694715">]</span><span class="builtintype" id="694716">byte</span><span class="op" id="694720">,</span>&nbsp;<span class="num" id="694722">10</span><span class="op" id="694724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="694730">n</span><span class="op" id="694731">,</span>&nbsp;<span class="ident" id="694733">err</span>&nbsp;<span class="op" id="694737">:=</span>&nbsp;<span class="ident" id="694740">r</span><span class="op" id="694741">.</span><span class="ident" id="694742">Read</span><span class="op" id="694746">(</span><span class="ident" id="694747">buf</span><span class="op" id="694750">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="694756">if</span>&nbsp;<span class="ident" id="694759">err</span>&nbsp;<span class="op" id="694763">!=</span>&nbsp;<span class="ident" id="694766">nil</span>&nbsp;<span class="op" id="694770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="694777">fmt</span><span class="op" id="694780">.</span><span class="ident" id="694781">Fprintf</span><span class="op" id="694788">(</span><span class="ident" id="694789">os</span><span class="op" id="694791">.</span><span class="ident" id="694792">Stderr</span><span class="op" id="694798">,</span>&nbsp;<span class="string" id="694800">&#34;Child:&nbsp;read&nbsp;error:&nbsp;%v&nbsp;on&nbsp;pipe&nbsp;%d\n&#34;</span><span class="op" id="694836">,</span>&nbsp;<span class="ident" id="694838">err</span><span class="op" id="694841">,</span>&nbsp;<span class="ident" id="694843">i</span><span class="op" id="694844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="694851">os</span><span class="op" id="694853">.</span><span class="ident" id="694854">Exit</span><span class="op" id="694858">(</span><span class="num" id="694859">1</span><span class="op" id="694860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="694866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="694872">c</span>&nbsp;<span class="op" id="694874">&lt;-</span>&nbsp;<span class="builtintype" id="694877">string</span><span class="op" id="694883">(</span><span class="ident" id="694884">buf</span><span class="op" id="694887">[</span><span class="op" id="694888">:</span><span class="ident" id="694889">n</span><span class="op" id="694890">]</span><span class="op" id="694891">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="694897">close</span><span class="op" id="694902">(</span><span class="ident" id="694903">c</span><span class="op" id="694904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="694909">}</span><span class="op" id="694910">(</span><span class="ident" id="694911">ch</span><span class="op" id="694913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="694918">select</span>&nbsp;<span class="op" id="694925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="694930">case</span>&nbsp;<span class="ident" id="694935">m</span>&nbsp;<span class="op" id="694937">:=</span>&nbsp;<span class="op" id="694940">&lt;-</span><span class="ident" id="694942">ch</span><span class="op" id="694944">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="694950">response</span>&nbsp;<span class="op" id="694959">=</span>&nbsp;<span class="ident" id="694961">response</span>&nbsp;<span class="op" id="694970">+</span>&nbsp;<span class="ident" id="694972">m</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="694977">case</span>&nbsp;<span class="op" id="694982">&lt;-</span><span class="ident" id="694984">time</span><span class="op" id="694988">.</span><span class="ident" id="694989">After</span><span class="op" id="694994">(</span><span class="num" id="694995">5</span>&nbsp;<span class="op" id="694997">*</span>&nbsp;<span class="ident" id="694999">time</span><span class="op" id="695003">.</span><span class="ident" id="695004">Second</span><span class="op" id="695010">)</span><span class="op" id="695011">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="695017">fmt</span><span class="op" id="695020">.</span><span class="ident" id="695021">Fprintf</span><span class="op" id="695028">(</span><span class="ident" id="695029">os</span><span class="op" id="695031">.</span><span class="ident" id="695032">Stderr</span><span class="op" id="695038">,</span>&nbsp;<span class="string" id="695040">&#34;Child:&nbsp;Timeout&nbsp;reading&nbsp;from&nbsp;pipe:&nbsp;%d\n&#34;</span><span class="op" id="695080">,</span>&nbsp;<span class="ident" id="695082">i</span><span class="op" id="695083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="695089">os</span><span class="op" id="695091">.</span><span class="ident" id="695092">Exit</span><span class="op" id="695096">(</span><span class="num" id="695097">1</span><span class="op" id="695098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="695103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="695107">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="695111">fmt</span><span class="op" id="695114">.</span><span class="ident" id="695115">Fprintf</span><span class="op" id="695122">(</span><span class="ident" id="695123">os</span><span class="op" id="695125">.</span><span class="ident" id="695126">Stderr</span><span class="op" id="695132">,</span>&nbsp;<span class="string" id="695134">&#34;child:&nbsp;%s&#34;</span><span class="op" id="695145">,</span>&nbsp;<span class="ident" id="695147">response</span><span class="op" id="695155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="695159">os</span><span class="op" id="695161">.</span><span class="ident" id="695162">Exit</span><span class="op" id="695166">(</span><span class="num" id="695167">0</span><span class="op" id="695168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="695171">case</span>&nbsp;<span class="string" id="695176">&#34;exec&#34;</span><span class="op" id="695182">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="695186">cmd</span>&nbsp;<span class="op" id="695190">:=</span>&nbsp;<span class="ident" id="695193">exec</span><span class="op" id="695197">.</span><span class="ident" id="695198">Command</span><span class="op" id="695205">(</span><span class="ident" id="695206">args</span><span class="op" id="695210">[</span><span class="num" id="695211">1</span><span class="op" id="695212">]</span><span class="op" id="695213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="695217">cmd</span><span class="op" id="695220">.</span><span class="ident" id="695221">Dir</span>&nbsp;<span class="op" id="695225">=</span>&nbsp;<span class="ident" id="695227">args</span><span class="op" id="695231">[</span><span class="num" id="695232">0</span><span class="op" id="695233">]</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="695237">output</span><span class="op" id="695243">,</span>&nbsp;<span class="ident" id="695245">err</span>&nbsp;<span class="op" id="695249">:=</span>&nbsp;<span class="ident" id="695252">cmd</span><span class="op" id="695255">.</span><span class="ident" id="695256">CombinedOutput</span><span class="op" id="695270">(</span><span class="op" id="695271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="695275">if</span>&nbsp;<span class="ident" id="695278">err</span>&nbsp;<span class="op" id="695282">!=</span>&nbsp;<span class="ident" id="695285">nil</span>&nbsp;<span class="op" id="695289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="695294">fmt</span><span class="op" id="695297">.</span><span class="ident" id="695298">Fprintf</span><span class="op" id="695305">(</span><span class="ident" id="695306">os</span><span class="op" id="695308">.</span><span class="ident" id="695309">Stderr</span><span class="op" id="695315">,</span>&nbsp;<span class="string" id="695317">&#34;Child:&nbsp;%s&nbsp;%s&#34;</span><span class="op" id="695331">,</span>&nbsp;<span class="ident" id="695333">err</span><span class="op" id="695336">,</span>&nbsp;<span class="builtintype" id="695338">string</span><span class="op" id="695344">(</span><span class="ident" id="695345">output</span><span class="op" id="695351">)</span><span class="op" id="695352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="695357">os</span><span class="op" id="695359">.</span><span class="ident" id="695360">Exit</span><span class="op" id="695364">(</span><span class="num" id="695365">1</span><span class="op" id="695366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="695370">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="695374">fmt</span><span class="op" id="695377">.</span><span class="ident" id="695378">Printf</span><span class="op" id="695384">(</span><span class="string" id="695385">&#34;%s&#34;</span><span class="op" id="695389">,</span>&nbsp;<span class="builtintype" id="695391">string</span><span class="op" id="695397">(</span><span class="ident" id="695398">output</span><span class="op" id="695404">)</span><span class="op" id="695405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="695409">os</span><span class="op" id="695411">.</span><span class="ident" id="695412">Exit</span><span class="op" id="695416">(</span><span class="num" id="695417">0</span><span class="op" id="695418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="695421">case</span>&nbsp;<span class="string" id="695426">&#34;lookpath&#34;</span><span class="op" id="695436">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="695440">p</span><span class="op" id="695441">,</span>&nbsp;<span class="ident" id="695443">err</span>&nbsp;<span class="op" id="695447">:=</span>&nbsp;<span class="ident" id="695450">exec</span><span class="op" id="695454">.</span><span class="ident" id="695455">LookPath</span><span class="op" id="695463">(</span><span class="ident" id="695464">args</span><span class="op" id="695468">[</span><span class="num" id="695469">0</span><span class="op" id="695470">]</span><span class="op" id="695471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="695475">if</span>&nbsp;<span class="ident" id="695478">err</span>&nbsp;<span class="op" id="695482">!=</span>&nbsp;<span class="ident" id="695485">nil</span>&nbsp;<span class="op" id="695489">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="695494">fmt</span><span class="op" id="695497">.</span><span class="ident" id="695498">Fprintf</span><span class="op" id="695505">(</span><span class="ident" id="695506">os</span><span class="op" id="695508">.</span><span class="ident" id="695509">Stderr</span><span class="op" id="695515">,</span>&nbsp;<span class="string" id="695517">&#34;LookPath&nbsp;failed:&nbsp;%v\n&#34;</span><span class="op" id="695540">,</span>&nbsp;<span class="ident" id="695542">err</span><span class="op" id="695545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="695550">os</span><span class="op" id="695552">.</span><span class="ident" id="695553">Exit</span><span class="op" id="695557">(</span><span class="num" id="695558">1</span><span class="op" id="695559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="695563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="695567">fmt</span><span class="op" id="695570">.</span><span class="ident" id="695571">Print</span><span class="op" id="695576">(</span><span class="ident" id="695577">p</span><span class="op" id="695578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="695582">os</span><span class="op" id="695584">.</span><span class="ident" id="695585">Exit</span><span class="op" id="695589">(</span><span class="num" id="695590">0</span><span class="op" id="695591">)</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="695594">default</span><span class="op" id="695601">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="695605">fmt</span><span class="op" id="695608">.</span><span class="ident" id="695609">Fprintf</span><span class="op" id="695616">(</span><span class="ident" id="695617">os</span><span class="op" id="695619">.</span><span class="ident" id="695620">Stderr</span><span class="op" id="695626">,</span>&nbsp;<span class="string" id="695628">&#34;Unknown&nbsp;command&nbsp;%q\n&#34;</span><span class="op" id="695650">,</span>&nbsp;<span class="ident" id="695652">cmd</span><span class="op" id="695655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="695659">os</span><span class="op" id="695661">.</span><span class="ident" id="695662">Exit</span><span class="op" id="695666">(</span><span class="num" id="695667">2</span><span class="op" id="695668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="695671">}</span><br>
<span class="lineno"></span><span class="op" id="695673">}</span>
</div>
</body>
</html>
