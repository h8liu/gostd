<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html" class="current">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4816973">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4817028">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4817082">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4817133">//go:generate&nbsp;go&nbsp;run&nbsp;gen.go&nbsp;-output&nbsp;fixedhuff.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4817183">//&nbsp;Package&nbsp;flate&nbsp;implements&nbsp;the&nbsp;DEFLATE&nbsp;compressed&nbsp;data&nbsp;format,&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4817260">//&nbsp;RFC&nbsp;1951.&nbsp;&nbsp;The&nbsp;gzip&nbsp;and&nbsp;zlib&nbsp;packages&nbsp;implement&nbsp;access&nbsp;to&nbsp;DEFLATE-based&nbsp;file</span><br>
<span class="lineno"></span><span class="comment" id="4817340">//&nbsp;formats.</span><br>
<span class="lineno">10</span><span class="keyword" id="4817352">package</span>&nbsp;<span class="ident" id="4817360">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4817367">import</span>&nbsp;<span class="op" id="4817374">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4817377">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4817386">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4817392">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="4817402">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4817405">const</span>&nbsp;<span class="op" id="4817411">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4817414">maxCodeLen</span>&nbsp;<span class="op" id="4817425">=</span>&nbsp;<span class="num" id="4817427">16</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4817433">//&nbsp;max&nbsp;length&nbsp;of&nbsp;Huffman&nbsp;code</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4817464">maxHist</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4817475">=</span>&nbsp;<span class="num" id="4817477">32768</span>&nbsp;<span class="comment" id="4817483">//&nbsp;max&nbsp;history&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4817508">//&nbsp;The&nbsp;next&nbsp;three&nbsp;numbers&nbsp;come&nbsp;from&nbsp;the&nbsp;RFC,&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4817569">maxLit</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4817578">=</span>&nbsp;<span class="num" id="4817580">286</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4817585">maxDist</span>&nbsp;&nbsp;<span class="op" id="4817594">=</span>&nbsp;<span class="num" id="4817596">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4817600">numCodes</span>&nbsp;<span class="op" id="4817609">=</span>&nbsp;<span class="num" id="4817611">19</span>&nbsp;<span class="comment" id="4817614">//&nbsp;number&nbsp;of&nbsp;codes&nbsp;in&nbsp;Huffman&nbsp;meta-code</span><br>
<span class="lineno">25</span><span class="op" id="4817654">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4817657">//&nbsp;A&nbsp;CorruptInputError&nbsp;reports&nbsp;the&nbsp;presence&nbsp;of&nbsp;corrupt&nbsp;input&nbsp;at&nbsp;a&nbsp;given&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="4817737">type</span>&nbsp;<span class="ident" id="4817742">CorruptInputError</span>&nbsp;<span class="ident" id="4817760">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4817767">func</span>&nbsp;<span class="op" id="4817772">(</span><span class="ident" id="4817773">e</span>&nbsp;<span class="ident" id="4817775">CorruptInputError</span><span class="op" id="4817792">)</span>&nbsp;<span class="ident" id="4817794">Error</span><span class="op" id="4817799">(</span><span class="op" id="4817800">)</span>&nbsp;<span class="builtintype" id="4817802">string</span>&nbsp;<span class="op" id="4817809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4817812">return</span>&nbsp;<span class="string" id="4817819">&#34;flate:&nbsp;corrupt&nbsp;input&nbsp;before&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4817857">+</span>&nbsp;<span class="ident" id="4817859">strconv</span><span class="op" id="4817866">.</span><span class="ident" id="4817867">FormatInt</span><span class="op" id="4817876">(</span><span class="ident" id="4817877">int64</span><span class="op" id="4817882">(</span><span class="ident" id="4817883">e</span><span class="op" id="4817884">)</span><span class="op" id="4817885">,</span>&nbsp;<span class="num" id="4817887">10</span><span class="op" id="4817889">)</span><br>
<span class="lineno"></span><span class="op" id="4817891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4817894">//&nbsp;An&nbsp;InternalError&nbsp;reports&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;flate&nbsp;code&nbsp;itself.</span><br>
<span class="lineno">35</span><span class="keyword" id="4817957">type</span>&nbsp;<span class="ident" id="4817962">InternalError</span>&nbsp;<span class="builtintype" id="4817976">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4817984">func</span>&nbsp;<span class="op" id="4817989">(</span><span class="ident" id="4817990">e</span>&nbsp;<span class="ident" id="4817992">InternalError</span><span class="op" id="4818005">)</span>&nbsp;<span class="ident" id="4818007">Error</span><span class="op" id="4818012">(</span><span class="op" id="4818013">)</span>&nbsp;<span class="builtintype" id="4818015">string</span>&nbsp;<span class="op" id="4818022">{</span>&nbsp;<span class="keyword" id="4818024">return</span>&nbsp;<span class="string" id="4818031">&#34;flate:&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="4818057">+</span>&nbsp;<span class="builtintype" id="4818059">string</span><span class="op" id="4818065">(</span><span class="ident" id="4818066">e</span><span class="op" id="4818067">)</span>&nbsp;<span class="op" id="4818069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4818072">//&nbsp;A&nbsp;ReadError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;reading&nbsp;input.</span><br>
<span class="lineno">40</span><span class="keyword" id="4818137">type</span>&nbsp;<span class="ident" id="4818142">ReadError</span>&nbsp;<span class="keyword" id="4818152">struct</span>&nbsp;<span class="op" id="4818159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4818162">Offset</span>&nbsp;<span class="ident" id="4818169">int64</span>&nbsp;<span class="comment" id="4818175">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4818212">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4818219">error</span>&nbsp;<span class="comment" id="4818225">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Read</span><br>
<span class="lineno"></span><span class="op" id="4818262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="4818265">func</span>&nbsp;<span class="op" id="4818270">(</span><span class="ident" id="4818271">e</span>&nbsp;<span class="op" id="4818273">*</span><span class="ident" id="4818274">ReadError</span><span class="op" id="4818283">)</span>&nbsp;<span class="ident" id="4818285">Error</span><span class="op" id="4818290">(</span><span class="op" id="4818291">)</span>&nbsp;<span class="builtintype" id="4818293">string</span>&nbsp;<span class="op" id="4818300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4818303">return</span>&nbsp;<span class="string" id="4818310">&#34;flate:&nbsp;read&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4818341">+</span>&nbsp;<span class="ident" id="4818343">strconv</span><span class="op" id="4818350">.</span><span class="ident" id="4818351">FormatInt</span><span class="op" id="4818360">(</span><span class="ident" id="4818361">e</span><span class="op" id="4818362">.</span><span class="ident" id="4818363">Offset</span><span class="op" id="4818369">,</span>&nbsp;<span class="num" id="4818371">10</span><span class="op" id="4818373">)</span>&nbsp;<span class="op" id="4818375">+</span>&nbsp;<span class="string" id="4818377">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4818382">+</span>&nbsp;<span class="ident" id="4818384">e</span><span class="op" id="4818385">.</span><span class="ident" id="4818386">Err</span><span class="op" id="4818389">.</span><span class="ident" id="4818390">Error</span><span class="op" id="4818395">(</span><span class="op" id="4818396">)</span><br>
<span class="lineno"></span><span class="op" id="4818398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4818401">//&nbsp;A&nbsp;WriteError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;writing&nbsp;output.</span><br>
<span class="lineno">50</span><span class="keyword" id="4818468">type</span>&nbsp;<span class="ident" id="4818473">WriteError</span>&nbsp;<span class="keyword" id="4818484">struct</span>&nbsp;<span class="op" id="4818491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4818494">Offset</span>&nbsp;<span class="ident" id="4818501">int64</span>&nbsp;<span class="comment" id="4818507">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4818544">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4818551">error</span>&nbsp;<span class="comment" id="4818557">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="4818595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4818598">func</span>&nbsp;<span class="op" id="4818603">(</span><span class="ident" id="4818604">e</span>&nbsp;<span class="op" id="4818606">*</span><span class="ident" id="4818607">WriteError</span><span class="op" id="4818617">)</span>&nbsp;<span class="ident" id="4818619">Error</span><span class="op" id="4818624">(</span><span class="op" id="4818625">)</span>&nbsp;<span class="builtintype" id="4818627">string</span>&nbsp;<span class="op" id="4818634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4818637">return</span>&nbsp;<span class="string" id="4818644">&#34;flate:&nbsp;write&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4818676">+</span>&nbsp;<span class="ident" id="4818678">strconv</span><span class="op" id="4818685">.</span><span class="ident" id="4818686">FormatInt</span><span class="op" id="4818695">(</span><span class="ident" id="4818696">e</span><span class="op" id="4818697">.</span><span class="ident" id="4818698">Offset</span><span class="op" id="4818704">,</span>&nbsp;<span class="num" id="4818706">10</span><span class="op" id="4818708">)</span>&nbsp;<span class="op" id="4818710">+</span>&nbsp;<span class="string" id="4818712">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4818717">+</span>&nbsp;<span class="ident" id="4818719">e</span><span class="op" id="4818720">.</span><span class="ident" id="4818721">Err</span><span class="op" id="4818724">.</span><span class="ident" id="4818725">Error</span><span class="op" id="4818730">(</span><span class="op" id="4818731">)</span><br>
<span class="lineno"></span><span class="op" id="4818733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4818736">//&nbsp;Resetter&nbsp;resets&nbsp;a&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;or&nbsp;NewReaderDict&nbsp;to</span><br>
<span class="lineno">60</span><span class="comment" id="4818810">//&nbsp;to&nbsp;switch&nbsp;to&nbsp;a&nbsp;new&nbsp;underlying&nbsp;Reader.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;ReadCloser</span><br>
<span class="lineno"></span><span class="comment" id="4818885">//&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4818921">type</span>&nbsp;<span class="ident" id="4818926">Resetter</span>&nbsp;<span class="keyword" id="4818935">interface</span>&nbsp;<span class="op" id="4818945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4818948">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;buffered&nbsp;data&nbsp;and&nbsp;resets&nbsp;the&nbsp;Resetter&nbsp;as&nbsp;if&nbsp;it&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4819022">//&nbsp;newly&nbsp;initialized&nbsp;with&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4819067">Reset</span><span class="op" id="4819072">(</span><span class="ident" id="4819073">r</span>&nbsp;<span class="ident" id="4819075">io</span><span class="op" id="4819077">.</span><span class="ident" id="4819078">Reader</span><span class="op" id="4819084">,</span>&nbsp;<span class="ident" id="4819086">dict</span>&nbsp;<span class="op" id="4819091">[</span><span class="op" id="4819092">]</span><span class="builtintype" id="4819093">byte</span><span class="op" id="4819097">)</span>&nbsp;<span class="builtintype" id="4819099">error</span><br>
<span class="lineno"></span><span class="op" id="4819105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4819108">//&nbsp;Note&nbsp;that&nbsp;much&nbsp;of&nbsp;the&nbsp;implementation&nbsp;of&nbsp;huffmanDecoder&nbsp;is&nbsp;also&nbsp;copied</span><br>
<span class="lineno"></span><span class="comment" id="4819181">//&nbsp;into&nbsp;gen.go&nbsp;(in&nbsp;package&nbsp;main)&nbsp;for&nbsp;the&nbsp;purpose&nbsp;of&nbsp;precomputing&nbsp;the</span><br>
<span class="lineno">70</span><span class="comment" id="4819250">//&nbsp;fixed&nbsp;huffman&nbsp;tables&nbsp;so&nbsp;they&nbsp;can&nbsp;be&nbsp;included&nbsp;statically.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4819311">//&nbsp;The&nbsp;data&nbsp;structure&nbsp;for&nbsp;decoding&nbsp;Huffman&nbsp;tables&nbsp;is&nbsp;based&nbsp;on&nbsp;that&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4819381">//&nbsp;zlib.&nbsp;There&nbsp;is&nbsp;a&nbsp;lookup&nbsp;table&nbsp;of&nbsp;a&nbsp;fixed&nbsp;bit&nbsp;width&nbsp;(huffmanChunkBits),</span><br>
<span class="lineno"></span><span class="comment" id="4819455">//&nbsp;For&nbsp;codes&nbsp;smaller&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;there&nbsp;are&nbsp;multiple&nbsp;entries</span><br>
<span class="lineno">75</span><span class="comment" id="4819525">//&nbsp;(each&nbsp;combination&nbsp;of&nbsp;trailing&nbsp;bits&nbsp;has&nbsp;the&nbsp;same&nbsp;value).&nbsp;For&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="4819594">//&nbsp;larger&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;the&nbsp;table&nbsp;contains&nbsp;a&nbsp;link&nbsp;to&nbsp;an&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="4819667">//&nbsp;table.&nbsp;The&nbsp;width&nbsp;of&nbsp;each&nbsp;entry&nbsp;in&nbsp;the&nbsp;link&nbsp;table&nbsp;is&nbsp;the&nbsp;maximum&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="4819739">//&nbsp;size&nbsp;minus&nbsp;the&nbsp;chunk&nbsp;width.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4819771">//&nbsp;Note&nbsp;that&nbsp;you&nbsp;can&nbsp;do&nbsp;a&nbsp;lookup&nbsp;in&nbsp;the&nbsp;table&nbsp;even&nbsp;without&nbsp;all&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4819839">//&nbsp;filled.&nbsp;Since&nbsp;the&nbsp;extra&nbsp;bits&nbsp;are&nbsp;zero,&nbsp;and&nbsp;the&nbsp;DEFLATE&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="4819911">//&nbsp;have&nbsp;the&nbsp;property&nbsp;that&nbsp;shorter&nbsp;codes&nbsp;come&nbsp;before&nbsp;longer&nbsp;ones,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4819980">//&nbsp;bit&nbsp;length&nbsp;estimate&nbsp;in&nbsp;the&nbsp;result&nbsp;is&nbsp;a&nbsp;lower&nbsp;bound&nbsp;on&nbsp;the&nbsp;actual</span><br>
<span class="lineno"></span><span class="comment" id="4820048">//&nbsp;number&nbsp;of&nbsp;bits.</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4820068">//&nbsp;chunk&nbsp;&amp;&nbsp;15&nbsp;is&nbsp;number&nbsp;of&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4820100">//&nbsp;chunk&nbsp;&gt;&gt;&nbsp;4&nbsp;is&nbsp;value,&nbsp;including&nbsp;table&nbsp;link</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4820146">const</span>&nbsp;<span class="op" id="4820152">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820155">huffmanChunkBits</span>&nbsp;&nbsp;<span class="op" id="4820173">=</span>&nbsp;<span class="num" id="4820175">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820178">huffmanNumChunks</span>&nbsp;&nbsp;<span class="op" id="4820196">=</span>&nbsp;<span class="num" id="4820198">1</span>&nbsp;<span class="op" id="4820200">&lt;&lt;</span>&nbsp;<span class="ident" id="4820203">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820221">huffmanCountMask</span>&nbsp;&nbsp;<span class="op" id="4820239">=</span>&nbsp;<span class="num" id="4820241">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820245">huffmanValueShift</span>&nbsp;<span class="op" id="4820263">=</span>&nbsp;<span class="num" id="4820265">4</span><br>
<span class="lineno"></span><span class="op" id="4820267">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="4820270">type</span>&nbsp;<span class="ident" id="4820275">huffmanDecoder</span>&nbsp;<span class="keyword" id="4820290">struct</span>&nbsp;<span class="op" id="4820297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820300">min</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4820309">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4820334">//&nbsp;the&nbsp;minimum&nbsp;code&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820362">chunks</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4820371">[</span><span class="ident" id="4820372">huffmanNumChunks</span><span class="op" id="4820388">]</span><span class="builtintype" id="4820389">uint32</span>&nbsp;<span class="comment" id="4820396">//&nbsp;chunks&nbsp;as&nbsp;described&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820426">links</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4820435">[</span><span class="op" id="4820436">]</span><span class="op" id="4820437">[</span><span class="op" id="4820438">]</span><span class="builtintype" id="4820439">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4820460">//&nbsp;overflow&nbsp;links</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820479">linkMask</span>&nbsp;<span class="builtintype" id="4820488">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4820513">//&nbsp;mask&nbsp;the&nbsp;width&nbsp;of&nbsp;the&nbsp;link&nbsp;table</span><br>
<span class="lineno"></span><span class="op" id="4820549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4820552">//&nbsp;Initialize&nbsp;Huffman&nbsp;decoding&nbsp;tables&nbsp;from&nbsp;array&nbsp;of&nbsp;code&nbsp;lengths.</span><br>
<span class="lineno"></span><span class="keyword" id="4820618">func</span>&nbsp;<span class="op" id="4820623">(</span><span class="ident" id="4820624">h</span>&nbsp;<span class="op" id="4820626">*</span><span class="ident" id="4820627">huffmanDecoder</span><span class="op" id="4820641">)</span>&nbsp;<span class="ident" id="4820643">init</span><span class="op" id="4820647">(</span><span class="ident" id="4820648">bits</span>&nbsp;<span class="op" id="4820653">[</span><span class="op" id="4820654">]</span><span class="builtintype" id="4820655">int</span><span class="op" id="4820658">)</span>&nbsp;<span class="builtintype" id="4820660">bool</span>&nbsp;<span class="op" id="4820665">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4820668">if</span>&nbsp;<span class="ident" id="4820671">h</span><span class="op" id="4820672">.</span><span class="ident" id="4820673">min</span>&nbsp;<span class="op" id="4820677">!=</span>&nbsp;<span class="num" id="4820680">0</span>&nbsp;<span class="op" id="4820682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4820686">*</span><span class="ident" id="4820687">h</span>&nbsp;<span class="op" id="4820689">=</span>&nbsp;<span class="ident" id="4820691">huffmanDecoder</span><span class="op" id="4820705">{</span><span class="op" id="4820706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4820709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4820713">//&nbsp;Count&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;each&nbsp;length,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4820755">//&nbsp;compute&nbsp;min&nbsp;and&nbsp;max&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4820787">var</span>&nbsp;<span class="ident" id="4820791">count</span>&nbsp;<span class="op" id="4820797">[</span><span class="ident" id="4820798">maxCodeLen</span><span class="op" id="4820808">]</span><span class="builtintype" id="4820809">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4820814">var</span>&nbsp;<span class="ident" id="4820818">min</span><span class="op" id="4820821">,</span>&nbsp;<span class="ident" id="4820823">max</span>&nbsp;<span class="builtintype" id="4820827">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4820832">for</span>&nbsp;<span class="ident" id="4820836">_</span><span class="op" id="4820837">,</span>&nbsp;<span class="ident" id="4820839">n</span>&nbsp;<span class="op" id="4820841">:=</span>&nbsp;<span class="keyword" id="4820844">range</span>&nbsp;<span class="ident" id="4820850">bits</span>&nbsp;<span class="op" id="4820855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4820859">if</span>&nbsp;<span class="ident" id="4820862">n</span>&nbsp;<span class="op" id="4820864">==</span>&nbsp;<span class="num" id="4820867">0</span>&nbsp;<span class="op" id="4820869">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4820874">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4820885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4820889">if</span>&nbsp;<span class="ident" id="4820892">min</span>&nbsp;<span class="op" id="4820896">==</span>&nbsp;<span class="num" id="4820899">0</span>&nbsp;<span class="op" id="4820901">||</span>&nbsp;<span class="ident" id="4820904">n</span>&nbsp;<span class="op" id="4820906">&lt;</span>&nbsp;<span class="ident" id="4820908">min</span>&nbsp;<span class="op" id="4820912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820917">min</span>&nbsp;<span class="op" id="4820921">=</span>&nbsp;<span class="ident" id="4820923">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4820927">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4820931">if</span>&nbsp;<span class="ident" id="4820934">n</span>&nbsp;<span class="op" id="4820936">&gt;</span>&nbsp;<span class="ident" id="4820938">max</span>&nbsp;<span class="op" id="4820942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820947">max</span>&nbsp;<span class="op" id="4820951">=</span>&nbsp;<span class="ident" id="4820953">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4820957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820961">count</span><span class="op" id="4820966">[</span><span class="ident" id="4820967">n</span><span class="op" id="4820968">]</span><span class="op" id="4820969">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4820973">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4820976">if</span>&nbsp;<span class="ident" id="4820979">max</span>&nbsp;<span class="op" id="4820983">==</span>&nbsp;<span class="num" id="4820986">0</span>&nbsp;<span class="op" id="4820988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4820992">return</span>&nbsp;<span class="builtintype" id="4820999">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4821006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821010">h</span><span class="op" id="4821011">.</span><span class="ident" id="4821012">min</span>&nbsp;<span class="op" id="4821016">=</span>&nbsp;<span class="ident" id="4821018">min</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821023">var</span>&nbsp;<span class="ident" id="4821027">linkBits</span>&nbsp;<span class="builtintype" id="4821036">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821042">var</span>&nbsp;<span class="ident" id="4821046">numLinks</span>&nbsp;<span class="builtintype" id="4821055">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821060">if</span>&nbsp;<span class="ident" id="4821063">max</span>&nbsp;<span class="op" id="4821067">&gt;</span>&nbsp;<span class="ident" id="4821069">huffmanChunkBits</span>&nbsp;<span class="op" id="4821086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821090">linkBits</span>&nbsp;<span class="op" id="4821099">=</span>&nbsp;<span class="builtintype" id="4821101">uint</span><span class="op" id="4821105">(</span><span class="ident" id="4821106">max</span><span class="op" id="4821109">)</span>&nbsp;<span class="op" id="4821111">-</span>&nbsp;<span class="ident" id="4821113">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821132">numLinks</span>&nbsp;<span class="op" id="4821141">=</span>&nbsp;<span class="num" id="4821143">1</span>&nbsp;<span class="op" id="4821145">&lt;&lt;</span>&nbsp;<span class="ident" id="4821148">linkBits</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821159">h</span><span class="op" id="4821160">.</span><span class="ident" id="4821161">linkMask</span>&nbsp;<span class="op" id="4821170">=</span>&nbsp;<span class="builtintype" id="4821172">uint32</span><span class="op" id="4821178">(</span><span class="ident" id="4821179">numLinks</span>&nbsp;<span class="op" id="4821188">-</span>&nbsp;<span class="num" id="4821190">1</span><span class="op" id="4821191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4821194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821197">code</span>&nbsp;<span class="op" id="4821202">:=</span>&nbsp;<span class="num" id="4821205">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821208">var</span>&nbsp;<span class="ident" id="4821212">nextcode</span>&nbsp;<span class="op" id="4821221">[</span><span class="ident" id="4821222">maxCodeLen</span><span class="op" id="4821232">]</span><span class="builtintype" id="4821233">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821238">for</span>&nbsp;<span class="ident" id="4821242">i</span>&nbsp;<span class="op" id="4821244">:=</span>&nbsp;<span class="ident" id="4821247">min</span><span class="op" id="4821250">;</span>&nbsp;<span class="ident" id="4821252">i</span>&nbsp;<span class="op" id="4821254">&lt;=</span>&nbsp;<span class="ident" id="4821257">max</span><span class="op" id="4821260">;</span>&nbsp;<span class="ident" id="4821262">i</span><span class="op" id="4821263">++</span>&nbsp;<span class="op" id="4821266">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821270">if</span>&nbsp;<span class="ident" id="4821273">i</span>&nbsp;<span class="op" id="4821275">==</span>&nbsp;<span class="ident" id="4821278">huffmanChunkBits</span><span class="op" id="4821294">+</span><span class="num" id="4821295">1</span>&nbsp;<span class="op" id="4821297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4821302">//&nbsp;create&nbsp;link&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821327">link</span>&nbsp;<span class="op" id="4821332">:=</span>&nbsp;<span class="ident" id="4821335">code</span>&nbsp;<span class="op" id="4821340">&gt;&gt;</span>&nbsp;<span class="num" id="4821343">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821348">if</span>&nbsp;<span class="ident" id="4821351">huffmanNumChunks</span>&nbsp;<span class="op" id="4821368">&lt;</span>&nbsp;<span class="ident" id="4821370">link</span>&nbsp;<span class="op" id="4821375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821381">return</span>&nbsp;<span class="builtintype" id="4821388">false</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4821397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821402">h</span><span class="op" id="4821403">.</span><span class="ident" id="4821404">links</span>&nbsp;<span class="op" id="4821410">=</span>&nbsp;<span class="builtinfunc" id="4821412">make</span><span class="op" id="4821416">(</span><span class="op" id="4821417">[</span><span class="op" id="4821418">]</span><span class="op" id="4821419">[</span><span class="op" id="4821420">]</span><span class="builtintype" id="4821421">uint32</span><span class="op" id="4821427">,</span>&nbsp;<span class="ident" id="4821429">huffmanNumChunks</span><span class="op" id="4821445">-</span><span class="ident" id="4821446">link</span><span class="op" id="4821450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821455">for</span>&nbsp;<span class="ident" id="4821459">j</span>&nbsp;<span class="op" id="4821461">:=</span>&nbsp;<span class="builtintype" id="4821464">uint</span><span class="op" id="4821468">(</span><span class="ident" id="4821469">link</span><span class="op" id="4821473">)</span><span class="op" id="4821474">;</span>&nbsp;<span class="ident" id="4821476">j</span>&nbsp;<span class="op" id="4821478">&lt;</span>&nbsp;<span class="ident" id="4821480">huffmanNumChunks</span><span class="op" id="4821496">;</span>&nbsp;<span class="ident" id="4821498">j</span><span class="op" id="4821499">++</span>&nbsp;<span class="op" id="4821502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821508">reverse</span>&nbsp;<span class="op" id="4821516">:=</span>&nbsp;<span class="builtintype" id="4821519">int</span><span class="op" id="4821522">(</span><span class="ident" id="4821523">reverseByte</span><span class="op" id="4821534">[</span><span class="ident" id="4821535">j</span><span class="op" id="4821536">&gt;&gt;</span><span class="num" id="4821538">8</span><span class="op" id="4821539">]</span><span class="op" id="4821540">)</span>&nbsp;<span class="op" id="4821542">|</span>&nbsp;<span class="builtintype" id="4821544">int</span><span class="op" id="4821547">(</span><span class="ident" id="4821548">reverseByte</span><span class="op" id="4821559">[</span><span class="ident" id="4821560">j</span><span class="op" id="4821561">&amp;</span><span class="num" id="4821562">0xff</span><span class="op" id="4821566">]</span><span class="op" id="4821567">)</span><span class="op" id="4821568">&lt;&lt;</span><span class="num" id="4821570">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821576">reverse</span>&nbsp;<span class="op" id="4821584">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4821588">uint</span><span class="op" id="4821592">(</span><span class="num" id="4821593">16</span>&nbsp;<span class="op" id="4821596">-</span>&nbsp;<span class="ident" id="4821598">huffmanChunkBits</span><span class="op" id="4821614">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821620">off</span>&nbsp;<span class="op" id="4821624">:=</span>&nbsp;<span class="ident" id="4821627">j</span>&nbsp;<span class="op" id="4821629">-</span>&nbsp;<span class="builtintype" id="4821631">uint</span><span class="op" id="4821635">(</span><span class="ident" id="4821636">link</span><span class="op" id="4821640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821646">h</span><span class="op" id="4821647">.</span><span class="ident" id="4821648">chunks</span><span class="op" id="4821654">[</span><span class="ident" id="4821655">reverse</span><span class="op" id="4821662">]</span>&nbsp;<span class="op" id="4821664">=</span>&nbsp;<span class="builtintype" id="4821666">uint32</span><span class="op" id="4821672">(</span><span class="ident" id="4821673">off</span><span class="op" id="4821676">&lt;&lt;</span><span class="ident" id="4821678">huffmanValueShift</span>&nbsp;<span class="op" id="4821696">+</span>&nbsp;<span class="builtintype" id="4821698">uint</span><span class="op" id="4821702">(</span><span class="ident" id="4821703">i</span><span class="op" id="4821704">)</span><span class="op" id="4821705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821711">h</span><span class="op" id="4821712">.</span><span class="ident" id="4821713">links</span><span class="op" id="4821718">[</span><span class="ident" id="4821719">off</span><span class="op" id="4821722">]</span>&nbsp;<span class="op" id="4821724">=</span>&nbsp;<span class="builtinfunc" id="4821726">make</span><span class="op" id="4821730">(</span><span class="op" id="4821731">[</span><span class="op" id="4821732">]</span><span class="builtintype" id="4821733">uint32</span><span class="op" id="4821739">,</span>&nbsp;<span class="num" id="4821741">1</span><span class="op" id="4821742">&lt;&lt;</span><span class="ident" id="4821744">linkBits</span><span class="op" id="4821752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4821757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4821761">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821765">n</span>&nbsp;<span class="op" id="4821767">:=</span>&nbsp;<span class="ident" id="4821770">count</span><span class="op" id="4821775">[</span><span class="ident" id="4821776">i</span><span class="op" id="4821777">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821781">nextcode</span><span class="op" id="4821789">[</span><span class="ident" id="4821790">i</span><span class="op" id="4821791">]</span>&nbsp;<span class="op" id="4821793">=</span>&nbsp;<span class="ident" id="4821795">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821802">code</span>&nbsp;<span class="op" id="4821807">+=</span>&nbsp;<span class="ident" id="4821810">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821814">code</span>&nbsp;<span class="op" id="4821819">&lt;&lt;=</span>&nbsp;<span class="num" id="4821823">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4821826">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821830">for</span>&nbsp;<span class="ident" id="4821834">i</span><span class="op" id="4821835">,</span>&nbsp;<span class="ident" id="4821837">n</span>&nbsp;<span class="op" id="4821839">:=</span>&nbsp;<span class="keyword" id="4821842">range</span>&nbsp;<span class="ident" id="4821848">bits</span>&nbsp;<span class="op" id="4821853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821857">if</span>&nbsp;<span class="ident" id="4821860">n</span>&nbsp;<span class="op" id="4821862">==</span>&nbsp;<span class="num" id="4821865">0</span>&nbsp;<span class="op" id="4821867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821872">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4821883">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821887">code</span>&nbsp;<span class="op" id="4821892">:=</span>&nbsp;<span class="ident" id="4821895">nextcode</span><span class="op" id="4821903">[</span><span class="ident" id="4821904">n</span><span class="op" id="4821905">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821909">nextcode</span><span class="op" id="4821917">[</span><span class="ident" id="4821918">n</span><span class="op" id="4821919">]</span><span class="op" id="4821920">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821925">chunk</span>&nbsp;<span class="op" id="4821931">:=</span>&nbsp;<span class="builtintype" id="4821934">uint32</span><span class="op" id="4821940">(</span><span class="ident" id="4821941">i</span><span class="op" id="4821942">&lt;&lt;</span><span class="ident" id="4821944">huffmanValueShift</span>&nbsp;<span class="op" id="4821962">|</span>&nbsp;<span class="ident" id="4821964">n</span><span class="op" id="4821965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821969">reverse</span>&nbsp;<span class="op" id="4821977">:=</span>&nbsp;<span class="builtintype" id="4821980">int</span><span class="op" id="4821983">(</span><span class="ident" id="4821984">reverseByte</span><span class="op" id="4821995">[</span><span class="ident" id="4821996">code</span><span class="op" id="4822000">&gt;&gt;</span><span class="num" id="4822002">8</span><span class="op" id="4822003">]</span><span class="op" id="4822004">)</span>&nbsp;<span class="op" id="4822006">|</span>&nbsp;<span class="builtintype" id="4822008">int</span><span class="op" id="4822011">(</span><span class="ident" id="4822012">reverseByte</span><span class="op" id="4822023">[</span><span class="ident" id="4822024">code</span><span class="op" id="4822028">&amp;</span><span class="num" id="4822029">0xff</span><span class="op" id="4822033">]</span><span class="op" id="4822034">)</span><span class="op" id="4822035">&lt;&lt;</span><span class="num" id="4822037">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822041">reverse</span>&nbsp;<span class="op" id="4822049">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4822053">uint</span><span class="op" id="4822057">(</span><span class="num" id="4822058">16</span>&nbsp;<span class="op" id="4822061">-</span>&nbsp;<span class="ident" id="4822063">n</span><span class="op" id="4822064">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822068">if</span>&nbsp;<span class="ident" id="4822071">n</span>&nbsp;<span class="op" id="4822073">&lt;=</span>&nbsp;<span class="ident" id="4822076">huffmanChunkBits</span>&nbsp;<span class="op" id="4822093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822098">for</span>&nbsp;<span class="ident" id="4822102">off</span>&nbsp;<span class="op" id="4822106">:=</span>&nbsp;<span class="ident" id="4822109">reverse</span><span class="op" id="4822116">;</span>&nbsp;<span class="ident" id="4822118">off</span>&nbsp;<span class="op" id="4822122">&lt;</span>&nbsp;<span class="ident" id="4822124">huffmanNumChunks</span><span class="op" id="4822140">;</span>&nbsp;<span class="ident" id="4822142">off</span>&nbsp;<span class="op" id="4822146">+=</span>&nbsp;<span class="num" id="4822149">1</span>&nbsp;<span class="op" id="4822151">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4822154">uint</span><span class="op" id="4822158">(</span><span class="ident" id="4822159">n</span><span class="op" id="4822160">)</span>&nbsp;<span class="op" id="4822162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822168">h</span><span class="op" id="4822169">.</span><span class="ident" id="4822170">chunks</span><span class="op" id="4822176">[</span><span class="ident" id="4822177">off</span><span class="op" id="4822180">]</span>&nbsp;<span class="op" id="4822182">=</span>&nbsp;<span class="ident" id="4822184">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4822193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4822197">}</span>&nbsp;<span class="keyword" id="4822199">else</span>&nbsp;<span class="op" id="4822204">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822209">value</span>&nbsp;<span class="op" id="4822215">:=</span>&nbsp;<span class="ident" id="4822218">h</span><span class="op" id="4822219">.</span><span class="ident" id="4822220">chunks</span><span class="op" id="4822226">[</span><span class="ident" id="4822227">reverse</span><span class="op" id="4822234">&amp;</span><span class="op" id="4822235">(</span><span class="ident" id="4822236">huffmanNumChunks</span><span class="op" id="4822252">-</span><span class="num" id="4822253">1</span><span class="op" id="4822254">)</span><span class="op" id="4822255">]</span>&nbsp;<span class="op" id="4822257">&gt;&gt;</span>&nbsp;<span class="ident" id="4822260">huffmanValueShift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822281">if</span>&nbsp;<span class="ident" id="4822284">value</span>&nbsp;<span class="op" id="4822290">&gt;=</span>&nbsp;<span class="builtintype" id="4822293">uint32</span><span class="op" id="4822299">(</span><span class="builtinfunc" id="4822300">len</span><span class="op" id="4822303">(</span><span class="ident" id="4822304">h</span><span class="op" id="4822305">.</span><span class="ident" id="4822306">links</span><span class="op" id="4822311">)</span><span class="op" id="4822312">)</span>&nbsp;<span class="op" id="4822314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822320">return</span>&nbsp;<span class="builtintype" id="4822327">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4822336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822341">linktab</span>&nbsp;<span class="op" id="4822349">:=</span>&nbsp;<span class="ident" id="4822352">h</span><span class="op" id="4822353">.</span><span class="ident" id="4822354">links</span><span class="op" id="4822359">[</span><span class="ident" id="4822360">value</span><span class="op" id="4822365">]</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822370">reverse</span>&nbsp;<span class="op" id="4822378">&gt;&gt;=</span>&nbsp;<span class="ident" id="4822382">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822402">for</span>&nbsp;<span class="ident" id="4822406">off</span>&nbsp;<span class="op" id="4822410">:=</span>&nbsp;<span class="ident" id="4822413">reverse</span><span class="op" id="4822420">;</span>&nbsp;<span class="ident" id="4822422">off</span>&nbsp;<span class="op" id="4822426">&lt;</span>&nbsp;<span class="ident" id="4822428">numLinks</span><span class="op" id="4822436">;</span>&nbsp;<span class="ident" id="4822438">off</span>&nbsp;<span class="op" id="4822442">+=</span>&nbsp;<span class="num" id="4822445">1</span>&nbsp;<span class="op" id="4822447">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4822450">uint</span><span class="op" id="4822454">(</span><span class="ident" id="4822455">n</span><span class="op" id="4822456">-</span><span class="ident" id="4822457">huffmanChunkBits</span><span class="op" id="4822473">)</span>&nbsp;<span class="op" id="4822475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822481">linktab</span><span class="op" id="4822488">[</span><span class="ident" id="4822489">off</span><span class="op" id="4822492">]</span>&nbsp;<span class="op" id="4822494">=</span>&nbsp;<span class="ident" id="4822496">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4822505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4822509">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4822512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822515">return</span>&nbsp;<span class="builtintype" id="4822522">true</span><br>
<span class="lineno"></span><span class="op" id="4822527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4822530">//&nbsp;The&nbsp;actual&nbsp;read&nbsp;interface&nbsp;needed&nbsp;by&nbsp;NewReader.</span><br>
<span class="lineno">190</span><span class="comment" id="4822580">//&nbsp;If&nbsp;the&nbsp;passed&nbsp;in&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,</span><br>
<span class="lineno"></span><span class="comment" id="4822639">//&nbsp;the&nbsp;NewReader&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="4822690">type</span>&nbsp;<span class="ident" id="4822695">Reader</span>&nbsp;<span class="keyword" id="4822702">interface</span>&nbsp;<span class="op" id="4822712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822715">io</span><span class="op" id="4822717">.</span><span class="ident" id="4822718">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822726">io</span><span class="op" id="4822728">.</span><span class="ident" id="4822729">ByteReader</span><br>
<span class="lineno">195</span><span class="op" id="4822740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4822743">//&nbsp;Decompress&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4822764">type</span>&nbsp;<span class="ident" id="4822769">decompressor</span>&nbsp;<span class="keyword" id="4822782">struct</span>&nbsp;<span class="op" id="4822789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4822792">//&nbsp;Input&nbsp;source.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822810">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822818">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822826">roffset</span>&nbsp;<span class="ident" id="4822834">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822841">woffset</span>&nbsp;<span class="ident" id="4822849">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4822857">//&nbsp;Input&nbsp;bits,&nbsp;in&nbsp;top&nbsp;of&nbsp;b.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822886">b</span>&nbsp;&nbsp;<span class="builtintype" id="4822889">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822897">nb</span>&nbsp;<span class="builtintype" id="4822900">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4822907">//&nbsp;Huffman&nbsp;decoders&nbsp;for&nbsp;literal/length,&nbsp;distance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822958">h1</span><span class="op" id="4822960">,</span>&nbsp;<span class="ident" id="4822962">h2</span>&nbsp;<span class="ident" id="4822965">huffmanDecoder</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4822982">//&nbsp;Length&nbsp;arrays&nbsp;used&nbsp;to&nbsp;define&nbsp;Huffman&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823030">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4823039">*</span><span class="op" id="4823040">[</span><span class="ident" id="4823041">maxLit</span>&nbsp;<span class="op" id="4823048">+</span>&nbsp;<span class="ident" id="4823050">maxDist</span><span class="op" id="4823057">]</span><span class="builtintype" id="4823058">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823063">codebits</span>&nbsp;<span class="op" id="4823072">*</span><span class="op" id="4823073">[</span><span class="ident" id="4823074">numCodes</span><span class="op" id="4823082">]</span><span class="builtintype" id="4823083">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4823089">//&nbsp;Output&nbsp;history,&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823117">hist</span>&nbsp;&nbsp;<span class="op" id="4823123">*</span><span class="op" id="4823124">[</span><span class="ident" id="4823125">maxHist</span><span class="op" id="4823132">]</span><span class="builtintype" id="4823133">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823139">hp</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4823145">int</span>&nbsp;&nbsp;<span class="comment" id="4823150">//&nbsp;current&nbsp;output&nbsp;position&nbsp;in&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823188">hw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4823194">int</span>&nbsp;&nbsp;<span class="comment" id="4823199">//&nbsp;have&nbsp;written&nbsp;hist[0:hw]&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823235">hfull</span>&nbsp;<span class="builtintype" id="4823241">bool</span>&nbsp;<span class="comment" id="4823246">//&nbsp;buffer&nbsp;has&nbsp;filled&nbsp;at&nbsp;least&nbsp;once</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4823283">//&nbsp;Temporary&nbsp;buffer&nbsp;(avoids&nbsp;repeated&nbsp;allocation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823334">buf</span>&nbsp;<span class="op" id="4823338">[</span><span class="num" id="4823339">4</span><span class="op" id="4823340">]</span><span class="builtintype" id="4823341">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4823348">//&nbsp;Next&nbsp;step&nbsp;in&nbsp;the&nbsp;decompression,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4823384">//&nbsp;and&nbsp;decompression&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823413">step</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823422">func</span><span class="op" id="4823426">(</span><span class="op" id="4823427">*</span><span class="ident" id="4823428">decompressor</span><span class="op" id="4823440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823443">final</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4823452">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823458">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4823467">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823474">toRead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4823483">[</span><span class="op" id="4823484">]</span><span class="builtintype" id="4823485">byte</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823491">hl</span><span class="op" id="4823493">,</span>&nbsp;<span class="ident" id="4823495">hd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4823500">*</span><span class="ident" id="4823501">huffmanDecoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823517">copyLen</span>&nbsp;&nbsp;<span class="builtintype" id="4823526">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823531">copyDist</span>&nbsp;<span class="builtintype" id="4823540">int</span><br>
<span class="lineno"></span><span class="op" id="4823544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="4823547">func</span>&nbsp;<span class="op" id="4823552">(</span><span class="ident" id="4823553">f</span>&nbsp;<span class="op" id="4823555">*</span><span class="ident" id="4823556">decompressor</span><span class="op" id="4823568">)</span>&nbsp;<span class="ident" id="4823570">nextBlock</span><span class="op" id="4823579">(</span><span class="op" id="4823580">)</span>&nbsp;<span class="op" id="4823582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823585">if</span>&nbsp;<span class="ident" id="4823588">f</span><span class="op" id="4823589">.</span><span class="ident" id="4823590">final</span>&nbsp;<span class="op" id="4823596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823600">if</span>&nbsp;<span class="ident" id="4823603">f</span><span class="op" id="4823604">.</span><span class="ident" id="4823605">hw</span>&nbsp;<span class="op" id="4823608">!=</span>&nbsp;<span class="ident" id="4823611">f</span><span class="op" id="4823612">.</span><span class="ident" id="4823613">hp</span>&nbsp;<span class="op" id="4823616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823621">f</span><span class="op" id="4823622">.</span><span class="ident" id="4823623">flush</span><span class="op" id="4823628">(</span><span class="op" id="4823629">(</span><span class="op" id="4823630">*</span><span class="ident" id="4823631">decompressor</span><span class="op" id="4823643">)</span><span class="op" id="4823644">.</span><span class="ident" id="4823645">nextBlock</span><span class="op" id="4823654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823659">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4823668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823672">f</span><span class="op" id="4823673">.</span><span class="ident" id="4823674">err</span>&nbsp;<span class="op" id="4823678">=</span>&nbsp;<span class="ident" id="4823680">io</span><span class="op" id="4823682">.</span><span class="ident" id="4823683">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823689">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4823697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823700">for</span>&nbsp;<span class="ident" id="4823704">f</span><span class="op" id="4823705">.</span><span class="ident" id="4823706">nb</span>&nbsp;<span class="op" id="4823709">&lt;</span>&nbsp;<span class="num" id="4823711">1</span><span class="op" id="4823712">+</span><span class="num" id="4823713">2</span>&nbsp;<span class="op" id="4823715">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823719">if</span>&nbsp;<span class="ident" id="4823722">f</span><span class="op" id="4823723">.</span><span class="ident" id="4823724">err</span>&nbsp;<span class="op" id="4823728">=</span>&nbsp;<span class="ident" id="4823730">f</span><span class="op" id="4823731">.</span><span class="ident" id="4823732">moreBits</span><span class="op" id="4823740">(</span><span class="op" id="4823741">)</span><span class="op" id="4823742">;</span>&nbsp;<span class="ident" id="4823744">f</span><span class="op" id="4823745">.</span><span class="ident" id="4823746">err</span>&nbsp;<span class="op" id="4823750">!=</span>&nbsp;<span class="builtintype" id="4823753">nil</span>&nbsp;<span class="op" id="4823757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823762">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4823771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4823774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823777">f</span><span class="op" id="4823778">.</span><span class="ident" id="4823779">final</span>&nbsp;<span class="op" id="4823785">=</span>&nbsp;<span class="ident" id="4823787">f</span><span class="op" id="4823788">.</span><span class="ident" id="4823789">b</span><span class="op" id="4823790">&amp;</span><span class="num" id="4823791">1</span>&nbsp;<span class="op" id="4823793">==</span>&nbsp;<span class="num" id="4823796">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823799">f</span><span class="op" id="4823800">.</span><span class="ident" id="4823801">b</span>&nbsp;<span class="op" id="4823803">&gt;&gt;=</span>&nbsp;<span class="num" id="4823807">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823810">typ</span>&nbsp;<span class="op" id="4823814">:=</span>&nbsp;<span class="ident" id="4823817">f</span><span class="op" id="4823818">.</span><span class="ident" id="4823819">b</span>&nbsp;<span class="op" id="4823821">&amp;</span>&nbsp;<span class="num" id="4823823">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823826">f</span><span class="op" id="4823827">.</span><span class="ident" id="4823828">b</span>&nbsp;<span class="op" id="4823830">&gt;&gt;=</span>&nbsp;<span class="num" id="4823834">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823837">f</span><span class="op" id="4823838">.</span><span class="ident" id="4823839">nb</span>&nbsp;<span class="op" id="4823842">-=</span>&nbsp;<span class="num" id="4823845">1</span>&nbsp;<span class="op" id="4823847">+</span>&nbsp;<span class="num" id="4823849">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823852">switch</span>&nbsp;<span class="ident" id="4823859">typ</span>&nbsp;<span class="op" id="4823863">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823866">case</span>&nbsp;<span class="num" id="4823871">0</span><span class="op" id="4823872">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823876">f</span><span class="op" id="4823877">.</span><span class="ident" id="4823878">dataBlock</span><span class="op" id="4823887">(</span><span class="op" id="4823888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823891">case</span>&nbsp;<span class="num" id="4823896">1</span><span class="op" id="4823897">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4823901">//&nbsp;compressed,&nbsp;fixed&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823939">f</span><span class="op" id="4823940">.</span><span class="ident" id="4823941">hl</span>&nbsp;<span class="op" id="4823944">=</span>&nbsp;<span class="op" id="4823946">&amp;</span><span class="ident" id="4823947">fixedHuffmanDecoder</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823969">f</span><span class="op" id="4823970">.</span><span class="ident" id="4823971">hd</span>&nbsp;<span class="op" id="4823974">=</span>&nbsp;<span class="builtintype" id="4823976">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823982">f</span><span class="op" id="4823983">.</span><span class="ident" id="4823984">huffmanBlock</span><span class="op" id="4823996">(</span><span class="op" id="4823997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4824000">case</span>&nbsp;<span class="num" id="4824005">2</span><span class="op" id="4824006">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4824010">//&nbsp;compressed,&nbsp;dynamic&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4824050">if</span>&nbsp;<span class="ident" id="4824053">f</span><span class="op" id="4824054">.</span><span class="ident" id="4824055">err</span>&nbsp;<span class="op" id="4824059">=</span>&nbsp;<span class="ident" id="4824061">f</span><span class="op" id="4824062">.</span><span class="ident" id="4824063">readHuffman</span><span class="op" id="4824074">(</span><span class="op" id="4824075">)</span><span class="op" id="4824076">;</span>&nbsp;<span class="ident" id="4824078">f</span><span class="op" id="4824079">.</span><span class="ident" id="4824080">err</span>&nbsp;<span class="op" id="4824084">!=</span>&nbsp;<span class="builtintype" id="4824087">nil</span>&nbsp;<span class="op" id="4824091">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4824096">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4824104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4824108">f</span><span class="op" id="4824109">.</span><span class="ident" id="4824110">hl</span>&nbsp;<span class="op" id="4824113">=</span>&nbsp;<span class="op" id="4824115">&amp;</span><span class="ident" id="4824116">f</span><span class="op" id="4824117">.</span><span class="ident" id="4824118">h1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4824123">f</span><span class="op" id="4824124">.</span><span class="ident" id="4824125">hd</span>&nbsp;<span class="op" id="4824128">=</span>&nbsp;<span class="op" id="4824130">&amp;</span><span class="ident" id="4824131">f</span><span class="op" id="4824132">.</span><span class="ident" id="4824133">h2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4824138">f</span><span class="op" id="4824139">.</span><span class="ident" id="4824140">huffmanBlock</span><span class="op" id="4824152">(</span><span class="op" id="4824153">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4824156">default</span><span class="op" id="4824163">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4824167">//&nbsp;3&nbsp;is&nbsp;reserved.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4824187">f</span><span class="op" id="4824188">.</span><span class="ident" id="4824189">err</span>&nbsp;<span class="op" id="4824193">=</span>&nbsp;<span class="ident" id="4824195">CorruptInputError</span><span class="op" id="4824212">(</span><span class="ident" id="4824213">f</span><span class="op" id="4824214">.</span><span class="ident" id="4824215">roffset</span><span class="op" id="4824222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4824225">}</span><br>
<span class="lineno"></span><span class="op" id="4824227">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="4824230">func</span>&nbsp;<span class="op" id="4824235">(</span><span class="ident" id="4824236">f</span>&nbsp;<span class="op" id="4824238">*</span><span class="ident" id="4824239">decompressor</span><span class="op" id="4824251">)</span>&nbsp;<span class="ident" id="4824253">Read</span><span class="op" id="4824257">(</span><span class="ident" id="4824258">b</span>&nbsp;<span class="op" id="4824260">[</span><span class="op" id="4824261">]</span><span class="builtintype" id="4824262">byte</span><span class="op" id="4824266">)</span>&nbsp;<span class="op" id="4824268">(</span><span class="builtintype" id="4824269">int</span><span class="op" id="4824272">,</span>&nbsp;<span class="builtintype" id="4824274">error</span><span class="op" id="4824279">)</span>&nbsp;<span class="op" id="4824281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4824284">for</span>&nbsp;<span class="op" id="4824288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4824292">if</span>&nbsp;<span class="builtinfunc" id="4824295">len</span><span class="op" id="4824298">(</span><span class="ident" id="4824299">f</span><span class="op" id="4824300">.</span><span class="ident" id="4824301">toRead</span><span class="op" id="4824307">)</span>&nbsp;<span class="op" id="4824309">&gt;</span>&nbsp;<span class="num" id="4824311">0</span>&nbsp;<span class="op" id="4824313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4824318">n</span>&nbsp;<span class="op" id="4824320">:=</span>&nbsp;<span class="builtinfunc" id="4824323">copy</span><span class="op" id="4824327">(</span><span class="ident" id="4824328">b</span><span class="op" id="4824329">,</span>&nbsp;<span class="ident" id="4824331">f</span><span class="op" id="4824332">.</span><span class="ident" id="4824333">toRead</span><span class="op" id="4824339">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4824344">f</span><span class="op" id="4824345">.</span><span class="ident" id="4824346">toRead</span>&nbsp;<span class="op" id="4824353">=</span>&nbsp;<span class="ident" id="4824355">f</span><span class="op" id="4824356">.</span><span class="ident" id="4824357">toRead</span><span class="op" id="4824363">[</span><span class="ident" id="4824364">n</span><span class="op" id="4824365">:</span><span class="op" id="4824366">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4824371">return</span>&nbsp;<span class="ident" id="4824378">n</span><span class="op" id="4824379">,</span>&nbsp;<span class="builtintype" id="4824381">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4824387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4824391">if</span>&nbsp;<span class="ident" id="4824394">f</span><span class="op" id="4824395">.</span><span class="ident" id="4824396">err</span>&nbsp;<span class="op" id="4824400">!=</span>&nbsp;<span class="builtintype" id="4824403">nil</span>&nbsp;<span class="op" id="4824407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4824412">return</span>&nbsp;<span class="num" id="4824419">0</span><span class="op" id="4824420">,</span>&nbsp;<span class="ident" id="4824422">f</span><span class="op" id="4824423">.</span><span class="ident" id="4824424">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4824430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4824434">f</span><span class="op" id="4824435">.</span><span class="ident" id="4824436">step</span><span class="op" id="4824440">(</span><span class="ident" id="4824441">f</span><span class="op" id="4824442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4824445">}</span><br>
<span class="lineno"></span><span class="op" id="4824447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="4824450">func</span>&nbsp;<span class="op" id="4824455">(</span><span class="ident" id="4824456">f</span>&nbsp;<span class="op" id="4824458">*</span><span class="ident" id="4824459">decompressor</span><span class="op" id="4824471">)</span>&nbsp;<span class="ident" id="4824473">Close</span><span class="op" id="4824478">(</span><span class="op" id="4824479">)</span>&nbsp;<span class="builtintype" id="4824481">error</span>&nbsp;<span class="op" id="4824487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4824490">if</span>&nbsp;<span class="ident" id="4824493">f</span><span class="op" id="4824494">.</span><span class="ident" id="4824495">err</span>&nbsp;<span class="op" id="4824499">==</span>&nbsp;<span class="ident" id="4824502">io</span><span class="op" id="4824504">.</span><span class="ident" id="4824505">EOF</span>&nbsp;<span class="op" id="4824509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4824513">return</span>&nbsp;<span class="builtintype" id="4824520">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4824525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4824528">return</span>&nbsp;<span class="ident" id="4824535">f</span><span class="op" id="4824536">.</span><span class="ident" id="4824537">err</span><br>
<span class="lineno">295</span><span class="op" id="4824541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4824544">//&nbsp;RFC&nbsp;1951&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span><span class="comment" id="4824571">//&nbsp;Compression&nbsp;with&nbsp;dynamic&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="4824614">var</span>&nbsp;<span class="ident" id="4824618">codeOrder</span>&nbsp;<span class="op" id="4824628">=</span>&nbsp;<span class="op" id="4824630">[</span><span class="op" id="4824631">...</span><span class="op" id="4824634">]</span><span class="builtintype" id="4824635">int</span><span class="op" id="4824638">{</span><span class="num" id="4824639">16</span><span class="op" id="4824641">,</span>&nbsp;<span class="num" id="4824643">17</span><span class="op" id="4824645">,</span>&nbsp;<span class="num" id="4824647">18</span><span class="op" id="4824649">,</span>&nbsp;<span class="num" id="4824651">0</span><span class="op" id="4824652">,</span>&nbsp;<span class="num" id="4824654">8</span><span class="op" id="4824655">,</span>&nbsp;<span class="num" id="4824657">7</span><span class="op" id="4824658">,</span>&nbsp;<span class="num" id="4824660">9</span><span class="op" id="4824661">,</span>&nbsp;<span class="num" id="4824663">6</span><span class="op" id="4824664">,</span>&nbsp;<span class="num" id="4824666">10</span><span class="op" id="4824668">,</span>&nbsp;<span class="num" id="4824670">5</span><span class="op" id="4824671">,</span>&nbsp;<span class="num" id="4824673">11</span><span class="op" id="4824675">,</span>&nbsp;<span class="num" id="4824677">4</span><span class="op" id="4824678">,</span>&nbsp;<span class="num" id="4824680">12</span><span class="op" id="4824682">,</span>&nbsp;<span class="num" id="4824684">3</span><span class="op" id="4824685">,</span>&nbsp;<span class="num" id="4824687">13</span><span class="op" id="4824689">,</span>&nbsp;<span class="num" id="4824691">2</span><span class="op" id="4824692">,</span>&nbsp;<span class="num" id="4824694">14</span><span class="op" id="4824696">,</span>&nbsp;<span class="num" id="4824698">1</span><span class="op" id="4824699">,</span>&nbsp;<span class="num" id="4824701">15</span><span class="op" id="4824703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4824706">func</span>&nbsp;<span class="op" id="4824711">(</span><span class="ident" id="4824712">f</span>&nbsp;<span class="op" id="4824714">*</span><span class="ident" id="4824715">decompressor</span><span class="op" id="4824727">)</span>&nbsp;<span class="ident" id="4824729">readHuffman</span><span class="op" id="4824740">(</span><span class="op" id="4824741">)</span>&nbsp;<span class="builtintype" id="4824743">error</span>&nbsp;<span class="op" id="4824749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4824752">//&nbsp;HLIT[5],&nbsp;HDIST[5],&nbsp;HCLEN[4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4824785">for</span>&nbsp;<span class="ident" id="4824789">f</span><span class="op" id="4824790">.</span><span class="ident" id="4824791">nb</span>&nbsp;<span class="op" id="4824794">&lt;</span>&nbsp;<span class="num" id="4824796">5</span><span class="op" id="4824797">+</span><span class="num" id="4824798">5</span><span class="op" id="4824799">+</span><span class="num" id="4824800">4</span>&nbsp;<span class="op" id="4824802">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4824806">if</span>&nbsp;<span class="ident" id="4824809">err</span>&nbsp;<span class="op" id="4824813">:=</span>&nbsp;<span class="ident" id="4824816">f</span><span class="op" id="4824817">.</span><span class="ident" id="4824818">moreBits</span><span class="op" id="4824826">(</span><span class="op" id="4824827">)</span><span class="op" id="4824828">;</span>&nbsp;<span class="ident" id="4824830">err</span>&nbsp;<span class="op" id="4824834">!=</span>&nbsp;<span class="builtintype" id="4824837">nil</span>&nbsp;<span class="op" id="4824841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4824846">return</span>&nbsp;<span class="ident" id="4824853">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4824859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4824862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4824865">nlit</span>&nbsp;<span class="op" id="4824870">:=</span>&nbsp;<span class="builtintype" id="4824873">int</span><span class="op" id="4824876">(</span><span class="ident" id="4824877">f</span><span class="op" id="4824878">.</span><span class="ident" id="4824879">b</span><span class="op" id="4824880">&amp;</span><span class="num" id="4824881">0x1F</span><span class="op" id="4824885">)</span>&nbsp;<span class="op" id="4824887">+</span>&nbsp;<span class="num" id="4824889">257</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4824894">if</span>&nbsp;<span class="ident" id="4824897">nlit</span>&nbsp;<span class="op" id="4824902">&gt;</span>&nbsp;<span class="ident" id="4824904">maxLit</span>&nbsp;<span class="op" id="4824911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4824915">return</span>&nbsp;<span class="ident" id="4824922">CorruptInputError</span><span class="op" id="4824939">(</span><span class="ident" id="4824940">f</span><span class="op" id="4824941">.</span><span class="ident" id="4824942">roffset</span><span class="op" id="4824949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4824952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4824955">f</span><span class="op" id="4824956">.</span><span class="ident" id="4824957">b</span>&nbsp;<span class="op" id="4824959">&gt;&gt;=</span>&nbsp;<span class="num" id="4824963">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4824966">ndist</span>&nbsp;<span class="op" id="4824972">:=</span>&nbsp;<span class="builtintype" id="4824975">int</span><span class="op" id="4824978">(</span><span class="ident" id="4824979">f</span><span class="op" id="4824980">.</span><span class="ident" id="4824981">b</span><span class="op" id="4824982">&amp;</span><span class="num" id="4824983">0x1F</span><span class="op" id="4824987">)</span>&nbsp;<span class="op" id="4824989">+</span>&nbsp;<span class="num" id="4824991">1</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4824994">//&nbsp;maxDist&nbsp;is&nbsp;32,&nbsp;so&nbsp;ndist&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825039">f</span><span class="op" id="4825040">.</span><span class="ident" id="4825041">b</span>&nbsp;<span class="op" id="4825043">&gt;&gt;=</span>&nbsp;<span class="num" id="4825047">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825050">nclen</span>&nbsp;<span class="op" id="4825056">:=</span>&nbsp;<span class="builtintype" id="4825059">int</span><span class="op" id="4825062">(</span><span class="ident" id="4825063">f</span><span class="op" id="4825064">.</span><span class="ident" id="4825065">b</span><span class="op" id="4825066">&amp;</span><span class="num" id="4825067">0xF</span><span class="op" id="4825070">)</span>&nbsp;<span class="op" id="4825072">+</span>&nbsp;<span class="num" id="4825074">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4825077">//&nbsp;numCodes&nbsp;is&nbsp;19,&nbsp;so&nbsp;nclen&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825123">f</span><span class="op" id="4825124">.</span><span class="ident" id="4825125">b</span>&nbsp;<span class="op" id="4825127">&gt;&gt;=</span>&nbsp;<span class="num" id="4825131">4</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825134">f</span><span class="op" id="4825135">.</span><span class="ident" id="4825136">nb</span>&nbsp;<span class="op" id="4825139">-=</span>&nbsp;<span class="num" id="4825142">5</span>&nbsp;<span class="op" id="4825144">+</span>&nbsp;<span class="num" id="4825146">5</span>&nbsp;<span class="op" id="4825148">+</span>&nbsp;<span class="num" id="4825150">4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4825154">//&nbsp;(HCLEN+4)*3&nbsp;bits:&nbsp;code&nbsp;lengths&nbsp;in&nbsp;the&nbsp;magic&nbsp;codeOrder&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4825219">for</span>&nbsp;<span class="ident" id="4825223">i</span>&nbsp;<span class="op" id="4825225">:=</span>&nbsp;<span class="num" id="4825228">0</span><span class="op" id="4825229">;</span>&nbsp;<span class="ident" id="4825231">i</span>&nbsp;<span class="op" id="4825233">&lt;</span>&nbsp;<span class="ident" id="4825235">nclen</span><span class="op" id="4825240">;</span>&nbsp;<span class="ident" id="4825242">i</span><span class="op" id="4825243">++</span>&nbsp;<span class="op" id="4825246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4825250">for</span>&nbsp;<span class="ident" id="4825254">f</span><span class="op" id="4825255">.</span><span class="ident" id="4825256">nb</span>&nbsp;<span class="op" id="4825259">&lt;</span>&nbsp;<span class="num" id="4825261">3</span>&nbsp;<span class="op" id="4825263">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4825268">if</span>&nbsp;<span class="ident" id="4825271">err</span>&nbsp;<span class="op" id="4825275">:=</span>&nbsp;<span class="ident" id="4825278">f</span><span class="op" id="4825279">.</span><span class="ident" id="4825280">moreBits</span><span class="op" id="4825288">(</span><span class="op" id="4825289">)</span><span class="op" id="4825290">;</span>&nbsp;<span class="ident" id="4825292">err</span>&nbsp;<span class="op" id="4825296">!=</span>&nbsp;<span class="builtintype" id="4825299">nil</span>&nbsp;<span class="op" id="4825303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4825309">return</span>&nbsp;<span class="ident" id="4825316">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4825323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4825327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825331">f</span><span class="op" id="4825332">.</span><span class="ident" id="4825333">codebits</span><span class="op" id="4825341">[</span><span class="ident" id="4825342">codeOrder</span><span class="op" id="4825351">[</span><span class="ident" id="4825352">i</span><span class="op" id="4825353">]</span><span class="op" id="4825354">]</span>&nbsp;<span class="op" id="4825356">=</span>&nbsp;<span class="builtintype" id="4825358">int</span><span class="op" id="4825361">(</span><span class="ident" id="4825362">f</span><span class="op" id="4825363">.</span><span class="ident" id="4825364">b</span>&nbsp;<span class="op" id="4825366">&amp;</span>&nbsp;<span class="num" id="4825368">0x7</span><span class="op" id="4825371">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825375">f</span><span class="op" id="4825376">.</span><span class="ident" id="4825377">b</span>&nbsp;<span class="op" id="4825379">&gt;&gt;=</span>&nbsp;<span class="num" id="4825383">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825387">f</span><span class="op" id="4825388">.</span><span class="ident" id="4825389">nb</span>&nbsp;<span class="op" id="4825392">-=</span>&nbsp;<span class="num" id="4825395">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4825398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4825401">for</span>&nbsp;<span class="ident" id="4825405">i</span>&nbsp;<span class="op" id="4825407">:=</span>&nbsp;<span class="ident" id="4825410">nclen</span><span class="op" id="4825415">;</span>&nbsp;<span class="ident" id="4825417">i</span>&nbsp;<span class="op" id="4825419">&lt;</span>&nbsp;<span class="builtinfunc" id="4825421">len</span><span class="op" id="4825424">(</span><span class="ident" id="4825425">codeOrder</span><span class="op" id="4825434">)</span><span class="op" id="4825435">;</span>&nbsp;<span class="ident" id="4825437">i</span><span class="op" id="4825438">++</span>&nbsp;<span class="op" id="4825441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825445">f</span><span class="op" id="4825446">.</span><span class="ident" id="4825447">codebits</span><span class="op" id="4825455">[</span><span class="ident" id="4825456">codeOrder</span><span class="op" id="4825465">[</span><span class="ident" id="4825466">i</span><span class="op" id="4825467">]</span><span class="op" id="4825468">]</span>&nbsp;<span class="op" id="4825470">=</span>&nbsp;<span class="num" id="4825472">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4825475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4825478">if</span>&nbsp;<span class="op" id="4825481">!</span><span class="ident" id="4825482">f</span><span class="op" id="4825483">.</span><span class="ident" id="4825484">h1</span><span class="op" id="4825486">.</span><span class="ident" id="4825487">init</span><span class="op" id="4825491">(</span><span class="ident" id="4825492">f</span><span class="op" id="4825493">.</span><span class="ident" id="4825494">codebits</span><span class="op" id="4825502">[</span><span class="num" id="4825503">0</span><span class="op" id="4825504">:</span><span class="op" id="4825505">]</span><span class="op" id="4825506">)</span>&nbsp;<span class="op" id="4825508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4825512">return</span>&nbsp;<span class="ident" id="4825519">CorruptInputError</span><span class="op" id="4825536">(</span><span class="ident" id="4825537">f</span><span class="op" id="4825538">.</span><span class="ident" id="4825539">roffset</span><span class="op" id="4825546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4825549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4825553">//&nbsp;HLIT&nbsp;+&nbsp;257&nbsp;code&nbsp;lengths,&nbsp;HDIST&nbsp;+&nbsp;1&nbsp;code&nbsp;lengths,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4825606">//&nbsp;using&nbsp;the&nbsp;code&nbsp;length&nbsp;Huffman&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4825646">for</span>&nbsp;<span class="ident" id="4825650">i</span><span class="op" id="4825651">,</span>&nbsp;<span class="ident" id="4825653">n</span>&nbsp;<span class="op" id="4825655">:=</span>&nbsp;<span class="num" id="4825658">0</span><span class="op" id="4825659">,</span>&nbsp;<span class="ident" id="4825661">nlit</span><span class="op" id="4825665">+</span><span class="ident" id="4825666">ndist</span><span class="op" id="4825671">;</span>&nbsp;<span class="ident" id="4825673">i</span>&nbsp;<span class="op" id="4825675">&lt;</span>&nbsp;<span class="ident" id="4825677">n</span><span class="op" id="4825678">;</span>&nbsp;<span class="op" id="4825680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825684">x</span><span class="op" id="4825685">,</span>&nbsp;<span class="ident" id="4825687">err</span>&nbsp;<span class="op" id="4825691">:=</span>&nbsp;<span class="ident" id="4825694">f</span><span class="op" id="4825695">.</span><span class="ident" id="4825696">huffSym</span><span class="op" id="4825703">(</span><span class="op" id="4825704">&amp;</span><span class="ident" id="4825705">f</span><span class="op" id="4825706">.</span><span class="ident" id="4825707">h1</span><span class="op" id="4825709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4825713">if</span>&nbsp;<span class="ident" id="4825716">err</span>&nbsp;<span class="op" id="4825720">!=</span>&nbsp;<span class="builtintype" id="4825723">nil</span>&nbsp;<span class="op" id="4825727">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4825732">return</span>&nbsp;<span class="ident" id="4825739">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4825745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4825749">if</span>&nbsp;<span class="ident" id="4825752">x</span>&nbsp;<span class="op" id="4825754">&lt;</span>&nbsp;<span class="num" id="4825756">16</span>&nbsp;<span class="op" id="4825759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4825764">//&nbsp;Actual&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825785">f</span><span class="op" id="4825786">.</span><span class="ident" id="4825787">bits</span><span class="op" id="4825791">[</span><span class="ident" id="4825792">i</span><span class="op" id="4825793">]</span>&nbsp;<span class="op" id="4825795">=</span>&nbsp;<span class="ident" id="4825797">x</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825802">i</span><span class="op" id="4825803">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4825809">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4825820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4825824">//&nbsp;Repeat&nbsp;previous&nbsp;length&nbsp;or&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4825861">var</span>&nbsp;<span class="ident" id="4825865">rep</span>&nbsp;<span class="builtintype" id="4825869">int</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4825875">var</span>&nbsp;<span class="ident" id="4825879">nb</span>&nbsp;<span class="builtintype" id="4825882">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4825889">var</span>&nbsp;<span class="ident" id="4825893">b</span>&nbsp;<span class="builtintype" id="4825895">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4825901">switch</span>&nbsp;<span class="ident" id="4825908">x</span>&nbsp;<span class="op" id="4825910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4825914">default</span><span class="op" id="4825921">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4825926">return</span>&nbsp;<span class="ident" id="4825933">InternalError</span><span class="op" id="4825946">(</span><span class="string" id="4825947">&#34;unexpected&nbsp;length&nbsp;code&#34;</span><span class="op" id="4825971">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4825975">case</span>&nbsp;<span class="num" id="4825980">16</span><span class="op" id="4825982">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825987">rep</span>&nbsp;<span class="op" id="4825991">=</span>&nbsp;<span class="num" id="4825993">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4825998">nb</span>&nbsp;<span class="op" id="4826001">=</span>&nbsp;<span class="num" id="4826003">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826008">if</span>&nbsp;<span class="ident" id="4826011">i</span>&nbsp;<span class="op" id="4826013">==</span>&nbsp;<span class="num" id="4826016">0</span>&nbsp;<span class="op" id="4826018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826024">return</span>&nbsp;<span class="ident" id="4826031">CorruptInputError</span><span class="op" id="4826048">(</span><span class="ident" id="4826049">f</span><span class="op" id="4826050">.</span><span class="ident" id="4826051">roffset</span><span class="op" id="4826058">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4826063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826068">b</span>&nbsp;<span class="op" id="4826070">=</span>&nbsp;<span class="ident" id="4826072">f</span><span class="op" id="4826073">.</span><span class="ident" id="4826074">bits</span><span class="op" id="4826078">[</span><span class="ident" id="4826079">i</span><span class="op" id="4826080">-</span><span class="num" id="4826081">1</span><span class="op" id="4826082">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826086">case</span>&nbsp;<span class="num" id="4826091">17</span><span class="op" id="4826093">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826098">rep</span>&nbsp;<span class="op" id="4826102">=</span>&nbsp;<span class="num" id="4826104">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826109">nb</span>&nbsp;<span class="op" id="4826112">=</span>&nbsp;<span class="num" id="4826114">3</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826119">b</span>&nbsp;<span class="op" id="4826121">=</span>&nbsp;<span class="num" id="4826123">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826127">case</span>&nbsp;<span class="num" id="4826132">18</span><span class="op" id="4826134">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826139">rep</span>&nbsp;<span class="op" id="4826143">=</span>&nbsp;<span class="num" id="4826145">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826151">nb</span>&nbsp;<span class="op" id="4826154">=</span>&nbsp;<span class="num" id="4826156">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826161">b</span>&nbsp;<span class="op" id="4826163">=</span>&nbsp;<span class="num" id="4826165">0</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4826169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826173">for</span>&nbsp;<span class="ident" id="4826177">f</span><span class="op" id="4826178">.</span><span class="ident" id="4826179">nb</span>&nbsp;<span class="op" id="4826182">&lt;</span>&nbsp;<span class="ident" id="4826184">nb</span>&nbsp;<span class="op" id="4826187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826192">if</span>&nbsp;<span class="ident" id="4826195">err</span>&nbsp;<span class="op" id="4826199">:=</span>&nbsp;<span class="ident" id="4826202">f</span><span class="op" id="4826203">.</span><span class="ident" id="4826204">moreBits</span><span class="op" id="4826212">(</span><span class="op" id="4826213">)</span><span class="op" id="4826214">;</span>&nbsp;<span class="ident" id="4826216">err</span>&nbsp;<span class="op" id="4826220">!=</span>&nbsp;<span class="builtintype" id="4826223">nil</span>&nbsp;<span class="op" id="4826227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826233">return</span>&nbsp;<span class="ident" id="4826240">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4826247">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4826251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826255">rep</span>&nbsp;<span class="op" id="4826259">+=</span>&nbsp;<span class="builtintype" id="4826262">int</span><span class="op" id="4826265">(</span><span class="ident" id="4826266">f</span><span class="op" id="4826267">.</span><span class="ident" id="4826268">b</span>&nbsp;<span class="op" id="4826270">&amp;</span>&nbsp;<span class="builtintype" id="4826272">uint32</span><span class="op" id="4826278">(</span><span class="num" id="4826279">1</span><span class="op" id="4826280">&lt;&lt;</span><span class="ident" id="4826282">nb</span><span class="op" id="4826284">-</span><span class="num" id="4826285">1</span><span class="op" id="4826286">)</span><span class="op" id="4826287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826291">f</span><span class="op" id="4826292">.</span><span class="ident" id="4826293">b</span>&nbsp;<span class="op" id="4826295">&gt;&gt;=</span>&nbsp;<span class="ident" id="4826299">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826304">f</span><span class="op" id="4826305">.</span><span class="ident" id="4826306">nb</span>&nbsp;<span class="op" id="4826309">-=</span>&nbsp;<span class="ident" id="4826312">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826317">if</span>&nbsp;<span class="ident" id="4826320">i</span><span class="op" id="4826321">+</span><span class="ident" id="4826322">rep</span>&nbsp;<span class="op" id="4826326">&gt;</span>&nbsp;<span class="ident" id="4826328">n</span>&nbsp;<span class="op" id="4826330">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826335">return</span>&nbsp;<span class="ident" id="4826342">CorruptInputError</span><span class="op" id="4826359">(</span><span class="ident" id="4826360">f</span><span class="op" id="4826361">.</span><span class="ident" id="4826362">roffset</span><span class="op" id="4826369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4826373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826377">for</span>&nbsp;<span class="ident" id="4826381">j</span>&nbsp;<span class="op" id="4826383">:=</span>&nbsp;<span class="num" id="4826386">0</span><span class="op" id="4826387">;</span>&nbsp;<span class="ident" id="4826389">j</span>&nbsp;<span class="op" id="4826391">&lt;</span>&nbsp;<span class="ident" id="4826393">rep</span><span class="op" id="4826396">;</span>&nbsp;<span class="ident" id="4826398">j</span><span class="op" id="4826399">++</span>&nbsp;<span class="op" id="4826402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826407">f</span><span class="op" id="4826408">.</span><span class="ident" id="4826409">bits</span><span class="op" id="4826413">[</span><span class="ident" id="4826414">i</span><span class="op" id="4826415">]</span>&nbsp;<span class="op" id="4826417">=</span>&nbsp;<span class="ident" id="4826419">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826424">i</span><span class="op" id="4826425">++</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4826430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4826433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826437">if</span>&nbsp;<span class="op" id="4826440">!</span><span class="ident" id="4826441">f</span><span class="op" id="4826442">.</span><span class="ident" id="4826443">h1</span><span class="op" id="4826445">.</span><span class="ident" id="4826446">init</span><span class="op" id="4826450">(</span><span class="ident" id="4826451">f</span><span class="op" id="4826452">.</span><span class="ident" id="4826453">bits</span><span class="op" id="4826457">[</span><span class="num" id="4826458">0</span><span class="op" id="4826459">:</span><span class="ident" id="4826460">nlit</span><span class="op" id="4826464">]</span><span class="op" id="4826465">)</span>&nbsp;<span class="op" id="4826467">||</span>&nbsp;<span class="op" id="4826470">!</span><span class="ident" id="4826471">f</span><span class="op" id="4826472">.</span><span class="ident" id="4826473">h2</span><span class="op" id="4826475">.</span><span class="ident" id="4826476">init</span><span class="op" id="4826480">(</span><span class="ident" id="4826481">f</span><span class="op" id="4826482">.</span><span class="ident" id="4826483">bits</span><span class="op" id="4826487">[</span><span class="ident" id="4826488">nlit</span><span class="op" id="4826492">:</span><span class="ident" id="4826493">nlit</span><span class="op" id="4826497">+</span><span class="ident" id="4826498">ndist</span><span class="op" id="4826503">]</span><span class="op" id="4826504">)</span>&nbsp;<span class="op" id="4826506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826510">return</span>&nbsp;<span class="ident" id="4826517">CorruptInputError</span><span class="op" id="4826534">(</span><span class="ident" id="4826535">f</span><span class="op" id="4826536">.</span><span class="ident" id="4826537">roffset</span><span class="op" id="4826544">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4826547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826551">return</span>&nbsp;<span class="builtintype" id="4826558">nil</span><br>
<span class="lineno"></span><span class="op" id="4826562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="4826565">//&nbsp;Decode&nbsp;a&nbsp;single&nbsp;Huffman&nbsp;block&nbsp;from&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="4826606">//&nbsp;hl&nbsp;and&nbsp;hd&nbsp;are&nbsp;the&nbsp;Huffman&nbsp;states&nbsp;for&nbsp;the&nbsp;lit/length&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="4826668">//&nbsp;and&nbsp;the&nbsp;distance&nbsp;values,&nbsp;respectively.&nbsp;&nbsp;If&nbsp;hd&nbsp;==&nbsp;nil,&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4826735">//&nbsp;fixed&nbsp;distance&nbsp;encoding&nbsp;associated&nbsp;with&nbsp;fixed&nbsp;Huffman&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="4826800">func</span>&nbsp;<span class="op" id="4826805">(</span><span class="ident" id="4826806">f</span>&nbsp;<span class="op" id="4826808">*</span><span class="ident" id="4826809">decompressor</span><span class="op" id="4826821">)</span>&nbsp;<span class="ident" id="4826823">huffmanBlock</span><span class="op" id="4826835">(</span><span class="op" id="4826836">)</span>&nbsp;<span class="op" id="4826838">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826841">for</span>&nbsp;<span class="op" id="4826845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826849">v</span><span class="op" id="4826850">,</span>&nbsp;<span class="ident" id="4826852">err</span>&nbsp;<span class="op" id="4826856">:=</span>&nbsp;<span class="ident" id="4826859">f</span><span class="op" id="4826860">.</span><span class="ident" id="4826861">huffSym</span><span class="op" id="4826868">(</span><span class="ident" id="4826869">f</span><span class="op" id="4826870">.</span><span class="ident" id="4826871">hl</span><span class="op" id="4826873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826877">if</span>&nbsp;<span class="ident" id="4826880">err</span>&nbsp;<span class="op" id="4826884">!=</span>&nbsp;<span class="builtintype" id="4826887">nil</span>&nbsp;<span class="op" id="4826891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4826896">f</span><span class="op" id="4826897">.</span><span class="ident" id="4826898">err</span>&nbsp;<span class="op" id="4826902">=</span>&nbsp;<span class="ident" id="4826904">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826911">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4826920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826924">var</span>&nbsp;<span class="ident" id="4826928">n</span>&nbsp;<span class="builtintype" id="4826930">uint</span>&nbsp;<span class="comment" id="4826935">//&nbsp;number&nbsp;of&nbsp;bits&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826961">var</span>&nbsp;<span class="ident" id="4826965">length</span>&nbsp;<span class="builtintype" id="4826972">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826978">switch</span>&nbsp;<span class="op" id="4826985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826989">case</span>&nbsp;<span class="ident" id="4826994">v</span>&nbsp;<span class="op" id="4826996">&lt;</span>&nbsp;<span class="num" id="4826998">256</span><span class="op" id="4827001">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827006">f</span><span class="op" id="4827007">.</span><span class="ident" id="4827008">hist</span><span class="op" id="4827012">[</span><span class="ident" id="4827013">f</span><span class="op" id="4827014">.</span><span class="ident" id="4827015">hp</span><span class="op" id="4827017">]</span>&nbsp;<span class="op" id="4827019">=</span>&nbsp;<span class="builtintype" id="4827021">byte</span><span class="op" id="4827025">(</span><span class="ident" id="4827026">v</span><span class="op" id="4827027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827032">f</span><span class="op" id="4827033">.</span><span class="ident" id="4827034">hp</span><span class="op" id="4827036">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827042">if</span>&nbsp;<span class="ident" id="4827045">f</span><span class="op" id="4827046">.</span><span class="ident" id="4827047">hp</span>&nbsp;<span class="op" id="4827050">==</span>&nbsp;<span class="builtinfunc" id="4827053">len</span><span class="op" id="4827056">(</span><span class="ident" id="4827057">f</span><span class="op" id="4827058">.</span><span class="ident" id="4827059">hist</span><span class="op" id="4827063">)</span>&nbsp;<span class="op" id="4827065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4827071">//&nbsp;After&nbsp;the&nbsp;flush,&nbsp;continue&nbsp;this&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827115">f</span><span class="op" id="4827116">.</span><span class="ident" id="4827117">flush</span><span class="op" id="4827122">(</span><span class="op" id="4827123">(</span><span class="op" id="4827124">*</span><span class="ident" id="4827125">decompressor</span><span class="op" id="4827137">)</span><span class="op" id="4827138">.</span><span class="ident" id="4827139">huffmanBlock</span><span class="op" id="4827151">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827157">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4827167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827172">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827183">case</span>&nbsp;<span class="ident" id="4827188">v</span>&nbsp;<span class="op" id="4827190">==</span>&nbsp;<span class="num" id="4827193">256</span><span class="op" id="4827196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4827201">//&nbsp;Done&nbsp;with&nbsp;huffman&nbsp;block;&nbsp;read&nbsp;next&nbsp;block.</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827249">f</span><span class="op" id="4827250">.</span><span class="ident" id="4827251">step</span>&nbsp;<span class="op" id="4827256">=</span>&nbsp;<span class="op" id="4827258">(</span><span class="op" id="4827259">*</span><span class="ident" id="4827260">decompressor</span><span class="op" id="4827272">)</span><span class="op" id="4827273">.</span><span class="ident" id="4827274">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827287">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4827296">//&nbsp;otherwise,&nbsp;reference&nbsp;to&nbsp;older&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827336">case</span>&nbsp;<span class="ident" id="4827341">v</span>&nbsp;<span class="op" id="4827343">&lt;</span>&nbsp;<span class="num" id="4827345">265</span><span class="op" id="4827348">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827353">length</span>&nbsp;<span class="op" id="4827360">=</span>&nbsp;<span class="ident" id="4827362">v</span>&nbsp;<span class="op" id="4827364">-</span>&nbsp;<span class="op" id="4827366">(</span><span class="num" id="4827367">257</span>&nbsp;<span class="op" id="4827371">-</span>&nbsp;<span class="num" id="4827373">3</span><span class="op" id="4827374">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827379">n</span>&nbsp;<span class="op" id="4827381">=</span>&nbsp;<span class="num" id="4827383">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827387">case</span>&nbsp;<span class="ident" id="4827392">v</span>&nbsp;<span class="op" id="4827394">&lt;</span>&nbsp;<span class="num" id="4827396">269</span><span class="op" id="4827399">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827404">length</span>&nbsp;<span class="op" id="4827411">=</span>&nbsp;<span class="ident" id="4827413">v</span><span class="op" id="4827414">*</span><span class="num" id="4827415">2</span>&nbsp;<span class="op" id="4827417">-</span>&nbsp;<span class="op" id="4827419">(</span><span class="num" id="4827420">265</span><span class="op" id="4827423">*</span><span class="num" id="4827424">2</span>&nbsp;<span class="op" id="4827426">-</span>&nbsp;<span class="num" id="4827428">11</span><span class="op" id="4827430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827435">n</span>&nbsp;<span class="op" id="4827437">=</span>&nbsp;<span class="num" id="4827439">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827443">case</span>&nbsp;<span class="ident" id="4827448">v</span>&nbsp;<span class="op" id="4827450">&lt;</span>&nbsp;<span class="num" id="4827452">273</span><span class="op" id="4827455">:</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827460">length</span>&nbsp;<span class="op" id="4827467">=</span>&nbsp;<span class="ident" id="4827469">v</span><span class="op" id="4827470">*</span><span class="num" id="4827471">4</span>&nbsp;<span class="op" id="4827473">-</span>&nbsp;<span class="op" id="4827475">(</span><span class="num" id="4827476">269</span><span class="op" id="4827479">*</span><span class="num" id="4827480">4</span>&nbsp;<span class="op" id="4827482">-</span>&nbsp;<span class="num" id="4827484">19</span><span class="op" id="4827486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827491">n</span>&nbsp;<span class="op" id="4827493">=</span>&nbsp;<span class="num" id="4827495">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827499">case</span>&nbsp;<span class="ident" id="4827504">v</span>&nbsp;<span class="op" id="4827506">&lt;</span>&nbsp;<span class="num" id="4827508">277</span><span class="op" id="4827511">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827516">length</span>&nbsp;<span class="op" id="4827523">=</span>&nbsp;<span class="ident" id="4827525">v</span><span class="op" id="4827526">*</span><span class="num" id="4827527">8</span>&nbsp;<span class="op" id="4827529">-</span>&nbsp;<span class="op" id="4827531">(</span><span class="num" id="4827532">273</span><span class="op" id="4827535">*</span><span class="num" id="4827536">8</span>&nbsp;<span class="op" id="4827538">-</span>&nbsp;<span class="num" id="4827540">35</span><span class="op" id="4827542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827547">n</span>&nbsp;<span class="op" id="4827549">=</span>&nbsp;<span class="num" id="4827551">3</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827555">case</span>&nbsp;<span class="ident" id="4827560">v</span>&nbsp;<span class="op" id="4827562">&lt;</span>&nbsp;<span class="num" id="4827564">281</span><span class="op" id="4827567">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827572">length</span>&nbsp;<span class="op" id="4827579">=</span>&nbsp;<span class="ident" id="4827581">v</span><span class="op" id="4827582">*</span><span class="num" id="4827583">16</span>&nbsp;<span class="op" id="4827586">-</span>&nbsp;<span class="op" id="4827588">(</span><span class="num" id="4827589">277</span><span class="op" id="4827592">*</span><span class="num" id="4827593">16</span>&nbsp;<span class="op" id="4827596">-</span>&nbsp;<span class="num" id="4827598">67</span><span class="op" id="4827600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827605">n</span>&nbsp;<span class="op" id="4827607">=</span>&nbsp;<span class="num" id="4827609">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827613">case</span>&nbsp;<span class="ident" id="4827618">v</span>&nbsp;<span class="op" id="4827620">&lt;</span>&nbsp;<span class="num" id="4827622">285</span><span class="op" id="4827625">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827630">length</span>&nbsp;<span class="op" id="4827637">=</span>&nbsp;<span class="ident" id="4827639">v</span><span class="op" id="4827640">*</span><span class="num" id="4827641">32</span>&nbsp;<span class="op" id="4827644">-</span>&nbsp;<span class="op" id="4827646">(</span><span class="num" id="4827647">281</span><span class="op" id="4827650">*</span><span class="num" id="4827651">32</span>&nbsp;<span class="op" id="4827654">-</span>&nbsp;<span class="num" id="4827656">131</span><span class="op" id="4827659">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827664">n</span>&nbsp;<span class="op" id="4827666">=</span>&nbsp;<span class="num" id="4827668">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827672">default</span><span class="op" id="4827679">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827684">length</span>&nbsp;<span class="op" id="4827691">=</span>&nbsp;<span class="num" id="4827693">258</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827700">n</span>&nbsp;<span class="op" id="4827702">=</span>&nbsp;<span class="num" id="4827704">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4827708">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827712">if</span>&nbsp;<span class="ident" id="4827715">n</span>&nbsp;<span class="op" id="4827717">&gt;</span>&nbsp;<span class="num" id="4827719">0</span>&nbsp;<span class="op" id="4827721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827726">for</span>&nbsp;<span class="ident" id="4827730">f</span><span class="op" id="4827731">.</span><span class="ident" id="4827732">nb</span>&nbsp;<span class="op" id="4827735">&lt;</span>&nbsp;<span class="ident" id="4827737">n</span>&nbsp;<span class="op" id="4827739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827745">if</span>&nbsp;<span class="ident" id="4827748">err</span>&nbsp;<span class="op" id="4827752">=</span>&nbsp;<span class="ident" id="4827754">f</span><span class="op" id="4827755">.</span><span class="ident" id="4827756">moreBits</span><span class="op" id="4827764">(</span><span class="op" id="4827765">)</span><span class="op" id="4827766">;</span>&nbsp;<span class="ident" id="4827768">err</span>&nbsp;<span class="op" id="4827772">!=</span>&nbsp;<span class="builtintype" id="4827775">nil</span>&nbsp;<span class="op" id="4827779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827786">f</span><span class="op" id="4827787">.</span><span class="ident" id="4827788">err</span>&nbsp;<span class="op" id="4827792">=</span>&nbsp;<span class="ident" id="4827794">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827803">return</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4827814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4827819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827824">length</span>&nbsp;<span class="op" id="4827831">+=</span>&nbsp;<span class="builtintype" id="4827834">int</span><span class="op" id="4827837">(</span><span class="ident" id="4827838">f</span><span class="op" id="4827839">.</span><span class="ident" id="4827840">b</span>&nbsp;<span class="op" id="4827842">&amp;</span>&nbsp;<span class="builtintype" id="4827844">uint32</span><span class="op" id="4827850">(</span><span class="num" id="4827851">1</span><span class="op" id="4827852">&lt;&lt;</span><span class="ident" id="4827854">n</span><span class="op" id="4827855">-</span><span class="num" id="4827856">1</span><span class="op" id="4827857">)</span><span class="op" id="4827858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827863">f</span><span class="op" id="4827864">.</span><span class="ident" id="4827865">b</span>&nbsp;<span class="op" id="4827867">&gt;&gt;=</span>&nbsp;<span class="ident" id="4827871">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827876">f</span><span class="op" id="4827877">.</span><span class="ident" id="4827878">nb</span>&nbsp;<span class="op" id="4827881">-=</span>&nbsp;<span class="ident" id="4827884">n</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4827888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827893">var</span>&nbsp;<span class="ident" id="4827897">dist</span>&nbsp;<span class="builtintype" id="4827902">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827908">if</span>&nbsp;<span class="ident" id="4827911">f</span><span class="op" id="4827912">.</span><span class="ident" id="4827913">hd</span>&nbsp;<span class="op" id="4827916">==</span>&nbsp;<span class="builtintype" id="4827919">nil</span>&nbsp;<span class="op" id="4827923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827928">for</span>&nbsp;<span class="ident" id="4827932">f</span><span class="op" id="4827933">.</span><span class="ident" id="4827934">nb</span>&nbsp;<span class="op" id="4827937">&lt;</span>&nbsp;<span class="num" id="4827939">5</span>&nbsp;<span class="op" id="4827941">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4827947">if</span>&nbsp;<span class="ident" id="4827950">err</span>&nbsp;<span class="op" id="4827954">=</span>&nbsp;<span class="ident" id="4827956">f</span><span class="op" id="4827957">.</span><span class="ident" id="4827958">moreBits</span><span class="op" id="4827966">(</span><span class="op" id="4827967">)</span><span class="op" id="4827968">;</span>&nbsp;<span class="ident" id="4827970">err</span>&nbsp;<span class="op" id="4827974">!=</span>&nbsp;<span class="builtintype" id="4827977">nil</span>&nbsp;<span class="op" id="4827981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827988">f</span><span class="op" id="4827989">.</span><span class="ident" id="4827990">err</span>&nbsp;<span class="op" id="4827994">=</span>&nbsp;<span class="ident" id="4827996">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828005">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4828016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4828021">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828026">dist</span>&nbsp;<span class="op" id="4828031">=</span>&nbsp;<span class="builtintype" id="4828033">int</span><span class="op" id="4828036">(</span><span class="ident" id="4828037">reverseByte</span><span class="op" id="4828048">[</span><span class="op" id="4828049">(</span><span class="ident" id="4828050">f</span><span class="op" id="4828051">.</span><span class="ident" id="4828052">b</span><span class="op" id="4828053">&amp;</span><span class="num" id="4828054">0x1F</span><span class="op" id="4828058">)</span><span class="op" id="4828059">&lt;&lt;</span><span class="num" id="4828061">3</span><span class="op" id="4828062">]</span><span class="op" id="4828063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828068">f</span><span class="op" id="4828069">.</span><span class="ident" id="4828070">b</span>&nbsp;<span class="op" id="4828072">&gt;&gt;=</span>&nbsp;<span class="num" id="4828076">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828081">f</span><span class="op" id="4828082">.</span><span class="ident" id="4828083">nb</span>&nbsp;<span class="op" id="4828086">-=</span>&nbsp;<span class="num" id="4828089">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4828093">}</span>&nbsp;<span class="keyword" id="4828095">else</span>&nbsp;<span class="op" id="4828100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828105">if</span>&nbsp;<span class="ident" id="4828108">dist</span><span class="op" id="4828112">,</span>&nbsp;<span class="ident" id="4828114">err</span>&nbsp;<span class="op" id="4828118">=</span>&nbsp;<span class="ident" id="4828120">f</span><span class="op" id="4828121">.</span><span class="ident" id="4828122">huffSym</span><span class="op" id="4828129">(</span><span class="ident" id="4828130">f</span><span class="op" id="4828131">.</span><span class="ident" id="4828132">hd</span><span class="op" id="4828134">)</span><span class="op" id="4828135">;</span>&nbsp;<span class="ident" id="4828137">err</span>&nbsp;<span class="op" id="4828141">!=</span>&nbsp;<span class="builtintype" id="4828144">nil</span>&nbsp;<span class="op" id="4828148">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828154">f</span><span class="op" id="4828155">.</span><span class="ident" id="4828156">err</span>&nbsp;<span class="op" id="4828160">=</span>&nbsp;<span class="ident" id="4828162">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828170">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4828180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4828184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828189">switch</span>&nbsp;<span class="op" id="4828196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828200">case</span>&nbsp;<span class="ident" id="4828205">dist</span>&nbsp;<span class="op" id="4828210">&lt;</span>&nbsp;<span class="num" id="4828212">4</span><span class="op" id="4828213">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828218">dist</span><span class="op" id="4828222">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828227">case</span>&nbsp;<span class="ident" id="4828232">dist</span>&nbsp;<span class="op" id="4828237">&gt;=</span>&nbsp;<span class="num" id="4828240">30</span><span class="op" id="4828242">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828247">f</span><span class="op" id="4828248">.</span><span class="ident" id="4828249">err</span>&nbsp;<span class="op" id="4828253">=</span>&nbsp;<span class="ident" id="4828255">CorruptInputError</span><span class="op" id="4828272">(</span><span class="ident" id="4828273">f</span><span class="op" id="4828274">.</span><span class="ident" id="4828275">roffset</span><span class="op" id="4828282">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828287">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828296">default</span><span class="op" id="4828303">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828308">nb</span>&nbsp;<span class="op" id="4828311">:=</span>&nbsp;<span class="builtintype" id="4828314">uint</span><span class="op" id="4828318">(</span><span class="ident" id="4828319">dist</span><span class="op" id="4828323">-</span><span class="num" id="4828324">2</span><span class="op" id="4828325">)</span>&nbsp;<span class="op" id="4828327">&gt;&gt;</span>&nbsp;<span class="num" id="4828330">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4828335">//&nbsp;have&nbsp;1&nbsp;bit&nbsp;in&nbsp;bottom&nbsp;of&nbsp;dist,&nbsp;need&nbsp;nb&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828385">extra</span>&nbsp;<span class="op" id="4828391">:=</span>&nbsp;<span class="op" id="4828394">(</span><span class="ident" id="4828395">dist</span>&nbsp;<span class="op" id="4828400">&amp;</span>&nbsp;<span class="num" id="4828402">1</span><span class="op" id="4828403">)</span>&nbsp;<span class="op" id="4828405">&lt;&lt;</span>&nbsp;<span class="ident" id="4828408">nb</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828414">for</span>&nbsp;<span class="ident" id="4828418">f</span><span class="op" id="4828419">.</span><span class="ident" id="4828420">nb</span>&nbsp;<span class="op" id="4828423">&lt;</span>&nbsp;<span class="ident" id="4828425">nb</span>&nbsp;<span class="op" id="4828428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828434">if</span>&nbsp;<span class="ident" id="4828437">err</span>&nbsp;<span class="op" id="4828441">=</span>&nbsp;<span class="ident" id="4828443">f</span><span class="op" id="4828444">.</span><span class="ident" id="4828445">moreBits</span><span class="op" id="4828453">(</span><span class="op" id="4828454">)</span><span class="op" id="4828455">;</span>&nbsp;<span class="ident" id="4828457">err</span>&nbsp;<span class="op" id="4828461">!=</span>&nbsp;<span class="builtintype" id="4828464">nil</span>&nbsp;<span class="op" id="4828468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828475">f</span><span class="op" id="4828476">.</span><span class="ident" id="4828477">err</span>&nbsp;<span class="op" id="4828481">=</span>&nbsp;<span class="ident" id="4828483">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828492">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4828503">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4828508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828513">extra</span>&nbsp;<span class="op" id="4828519">|=</span>&nbsp;<span class="builtintype" id="4828522">int</span><span class="op" id="4828525">(</span><span class="ident" id="4828526">f</span><span class="op" id="4828527">.</span><span class="ident" id="4828528">b</span>&nbsp;<span class="op" id="4828530">&amp;</span>&nbsp;<span class="builtintype" id="4828532">uint32</span><span class="op" id="4828538">(</span><span class="num" id="4828539">1</span><span class="op" id="4828540">&lt;&lt;</span><span class="ident" id="4828542">nb</span><span class="op" id="4828544">-</span><span class="num" id="4828545">1</span><span class="op" id="4828546">)</span><span class="op" id="4828547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828552">f</span><span class="op" id="4828553">.</span><span class="ident" id="4828554">b</span>&nbsp;<span class="op" id="4828556">&gt;&gt;=</span>&nbsp;<span class="ident" id="4828560">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828566">f</span><span class="op" id="4828567">.</span><span class="ident" id="4828568">nb</span>&nbsp;<span class="op" id="4828571">-=</span>&nbsp;<span class="ident" id="4828574">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828580">dist</span>&nbsp;<span class="op" id="4828585">=</span>&nbsp;<span class="num" id="4828587">1</span><span class="op" id="4828588">&lt;&lt;</span><span class="op" id="4828590">(</span><span class="ident" id="4828591">nb</span><span class="op" id="4828593">+</span><span class="num" id="4828594">1</span><span class="op" id="4828595">)</span>&nbsp;<span class="op" id="4828597">+</span>&nbsp;<span class="num" id="4828599">1</span>&nbsp;<span class="op" id="4828601">+</span>&nbsp;<span class="ident" id="4828603">extra</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4828611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4828616">//&nbsp;Copy&nbsp;history[-dist:-dist+length]&nbsp;into&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828667">if</span>&nbsp;<span class="ident" id="4828670">dist</span>&nbsp;<span class="op" id="4828675">&gt;</span>&nbsp;<span class="builtinfunc" id="4828677">len</span><span class="op" id="4828680">(</span><span class="ident" id="4828681">f</span><span class="op" id="4828682">.</span><span class="ident" id="4828683">hist</span><span class="op" id="4828687">)</span>&nbsp;<span class="op" id="4828689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828694">f</span><span class="op" id="4828695">.</span><span class="ident" id="4828696">err</span>&nbsp;<span class="op" id="4828700">=</span>&nbsp;<span class="ident" id="4828702">InternalError</span><span class="op" id="4828715">(</span><span class="string" id="4828716">&#34;bad&nbsp;history&nbsp;distance&#34;</span><span class="op" id="4828738">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828743">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4828752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4828757">//&nbsp;No&nbsp;check&nbsp;on&nbsp;length;&nbsp;encoding&nbsp;can&nbsp;be&nbsp;prescient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828809">if</span>&nbsp;<span class="op" id="4828812">!</span><span class="ident" id="4828813">f</span><span class="op" id="4828814">.</span><span class="ident" id="4828815">hfull</span>&nbsp;<span class="op" id="4828821">&amp;&amp;</span>&nbsp;<span class="ident" id="4828824">dist</span>&nbsp;<span class="op" id="4828829">&gt;</span>&nbsp;<span class="ident" id="4828831">f</span><span class="op" id="4828832">.</span><span class="ident" id="4828833">hp</span>&nbsp;<span class="op" id="4828836">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828841">f</span><span class="op" id="4828842">.</span><span class="ident" id="4828843">err</span>&nbsp;<span class="op" id="4828847">=</span>&nbsp;<span class="ident" id="4828849">CorruptInputError</span><span class="op" id="4828866">(</span><span class="ident" id="4828867">f</span><span class="op" id="4828868">.</span><span class="ident" id="4828869">roffset</span><span class="op" id="4828876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828881">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4828890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828895">f</span><span class="op" id="4828896">.</span><span class="ident" id="4828897">copyLen</span><span class="op" id="4828904">,</span>&nbsp;<span class="ident" id="4828906">f</span><span class="op" id="4828907">.</span><span class="ident" id="4828908">copyDist</span>&nbsp;<span class="op" id="4828917">=</span>&nbsp;<span class="ident" id="4828919">length</span><span class="op" id="4828925">,</span>&nbsp;<span class="ident" id="4828927">dist</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828934">if</span>&nbsp;<span class="ident" id="4828937">f</span><span class="op" id="4828938">.</span><span class="ident" id="4828939">copyHist</span><span class="op" id="4828947">(</span><span class="op" id="4828948">)</span>&nbsp;<span class="op" id="4828950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828955">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4828964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4828967">}</span><br>
<span class="lineno"></span><span class="op" id="4828969">}</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span><span class="comment" id="4828972">//&nbsp;copyHist&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;f.hist&nbsp;(f.copyDist&nbsp;bytes&nbsp;ago)&nbsp;to&nbsp;itself.</span><br>
<span class="lineno"></span><span class="comment" id="4829053">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;the&nbsp;f.hist&nbsp;buffer&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="4829102">func</span>&nbsp;<span class="op" id="4829107">(</span><span class="ident" id="4829108">f</span>&nbsp;<span class="op" id="4829110">*</span><span class="ident" id="4829111">decompressor</span><span class="op" id="4829123">)</span>&nbsp;<span class="ident" id="4829125">copyHist</span><span class="op" id="4829133">(</span><span class="op" id="4829134">)</span>&nbsp;<span class="builtintype" id="4829136">bool</span>&nbsp;<span class="op" id="4829141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829144">p</span>&nbsp;<span class="op" id="4829146">:=</span>&nbsp;<span class="ident" id="4829149">f</span><span class="op" id="4829150">.</span><span class="ident" id="4829151">hp</span>&nbsp;<span class="op" id="4829154">-</span>&nbsp;<span class="ident" id="4829156">f</span><span class="op" id="4829157">.</span><span class="ident" id="4829158">copyDist</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4829168">if</span>&nbsp;<span class="ident" id="4829171">p</span>&nbsp;<span class="op" id="4829173">&lt;</span>&nbsp;<span class="num" id="4829175">0</span>&nbsp;<span class="op" id="4829177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829181">p</span>&nbsp;<span class="op" id="4829183">+=</span>&nbsp;<span class="builtinfunc" id="4829186">len</span><span class="op" id="4829189">(</span><span class="ident" id="4829190">f</span><span class="op" id="4829191">.</span><span class="ident" id="4829192">hist</span><span class="op" id="4829196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4829199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4829202">for</span>&nbsp;<span class="ident" id="4829206">f</span><span class="op" id="4829207">.</span><span class="ident" id="4829208">copyLen</span>&nbsp;<span class="op" id="4829216">&gt;</span>&nbsp;<span class="num" id="4829218">0</span>&nbsp;<span class="op" id="4829220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829224">n</span>&nbsp;<span class="op" id="4829226">:=</span>&nbsp;<span class="ident" id="4829229">f</span><span class="op" id="4829230">.</span><span class="ident" id="4829231">copyLen</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4829241">if</span>&nbsp;<span class="ident" id="4829244">x</span>&nbsp;<span class="op" id="4829246">:=</span>&nbsp;<span class="builtinfunc" id="4829249">len</span><span class="op" id="4829252">(</span><span class="ident" id="4829253">f</span><span class="op" id="4829254">.</span><span class="ident" id="4829255">hist</span><span class="op" id="4829259">)</span>&nbsp;<span class="op" id="4829261">-</span>&nbsp;<span class="ident" id="4829263">f</span><span class="op" id="4829264">.</span><span class="ident" id="4829265">hp</span><span class="op" id="4829267">;</span>&nbsp;<span class="ident" id="4829269">n</span>&nbsp;<span class="op" id="4829271">&gt;</span>&nbsp;<span class="ident" id="4829273">x</span>&nbsp;<span class="op" id="4829275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829280">n</span>&nbsp;<span class="op" id="4829282">=</span>&nbsp;<span class="ident" id="4829284">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4829288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4829292">if</span>&nbsp;<span class="ident" id="4829295">x</span>&nbsp;<span class="op" id="4829297">:=</span>&nbsp;<span class="builtinfunc" id="4829300">len</span><span class="op" id="4829303">(</span><span class="ident" id="4829304">f</span><span class="op" id="4829305">.</span><span class="ident" id="4829306">hist</span><span class="op" id="4829310">)</span>&nbsp;<span class="op" id="4829312">-</span>&nbsp;<span class="ident" id="4829314">p</span><span class="op" id="4829315">;</span>&nbsp;<span class="ident" id="4829317">n</span>&nbsp;<span class="op" id="4829319">&gt;</span>&nbsp;<span class="ident" id="4829321">x</span>&nbsp;<span class="op" id="4829323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829328">n</span>&nbsp;<span class="op" id="4829330">=</span>&nbsp;<span class="ident" id="4829332">x</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4829336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829340">forwardCopy</span><span class="op" id="4829351">(</span><span class="ident" id="4829352">f</span><span class="op" id="4829353">.</span><span class="ident" id="4829354">hist</span><span class="op" id="4829358">[</span><span class="op" id="4829359">:</span><span class="op" id="4829360">]</span><span class="op" id="4829361">,</span>&nbsp;<span class="ident" id="4829363">f</span><span class="op" id="4829364">.</span><span class="ident" id="4829365">hp</span><span class="op" id="4829367">,</span>&nbsp;<span class="ident" id="4829369">p</span><span class="op" id="4829370">,</span>&nbsp;<span class="ident" id="4829372">n</span><span class="op" id="4829373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829377">p</span>&nbsp;<span class="op" id="4829379">+=</span>&nbsp;<span class="ident" id="4829382">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829386">f</span><span class="op" id="4829387">.</span><span class="ident" id="4829388">hp</span>&nbsp;<span class="op" id="4829391">+=</span>&nbsp;<span class="ident" id="4829394">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829398">f</span><span class="op" id="4829399">.</span><span class="ident" id="4829400">copyLen</span>&nbsp;<span class="op" id="4829408">-=</span>&nbsp;<span class="ident" id="4829411">n</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4829415">if</span>&nbsp;<span class="ident" id="4829418">f</span><span class="op" id="4829419">.</span><span class="ident" id="4829420">hp</span>&nbsp;<span class="op" id="4829423">==</span>&nbsp;<span class="builtinfunc" id="4829426">len</span><span class="op" id="4829429">(</span><span class="ident" id="4829430">f</span><span class="op" id="4829431">.</span><span class="ident" id="4829432">hist</span><span class="op" id="4829436">)</span>&nbsp;<span class="op" id="4829438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4829443">//&nbsp;After&nbsp;flush&nbsp;continue&nbsp;copying&nbsp;out&nbsp;of&nbsp;history.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829494">f</span><span class="op" id="4829495">.</span><span class="ident" id="4829496">flush</span><span class="op" id="4829501">(</span><span class="op" id="4829502">(</span><span class="op" id="4829503">*</span><span class="ident" id="4829504">decompressor</span><span class="op" id="4829516">)</span><span class="op" id="4829517">.</span><span class="ident" id="4829518">copyHuff</span><span class="op" id="4829526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4829531">return</span>&nbsp;<span class="builtintype" id="4829538">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4829545">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4829549">if</span>&nbsp;<span class="ident" id="4829552">p</span>&nbsp;<span class="op" id="4829554">==</span>&nbsp;<span class="builtinfunc" id="4829557">len</span><span class="op" id="4829560">(</span><span class="ident" id="4829561">f</span><span class="op" id="4829562">.</span><span class="ident" id="4829563">hist</span><span class="op" id="4829567">)</span>&nbsp;<span class="op" id="4829569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829574">p</span>&nbsp;<span class="op" id="4829576">=</span>&nbsp;<span class="num" id="4829578">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4829582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4829585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4829588">return</span>&nbsp;<span class="builtintype" id="4829595">false</span><br>
<span class="lineno">550</span><span class="op" id="4829601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4829604">func</span>&nbsp;<span class="op" id="4829609">(</span><span class="ident" id="4829610">f</span>&nbsp;<span class="op" id="4829612">*</span><span class="ident" id="4829613">decompressor</span><span class="op" id="4829625">)</span>&nbsp;<span class="ident" id="4829627">copyHuff</span><span class="op" id="4829635">(</span><span class="op" id="4829636">)</span>&nbsp;<span class="op" id="4829638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4829641">if</span>&nbsp;<span class="ident" id="4829644">f</span><span class="op" id="4829645">.</span><span class="ident" id="4829646">copyHist</span><span class="op" id="4829654">(</span><span class="op" id="4829655">)</span>&nbsp;<span class="op" id="4829657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4829661">return</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4829669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829672">f</span><span class="op" id="4829673">.</span><span class="ident" id="4829674">huffmanBlock</span><span class="op" id="4829686">(</span><span class="op" id="4829687">)</span><br>
<span class="lineno"></span><span class="op" id="4829689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4829692">//&nbsp;Copy&nbsp;a&nbsp;single&nbsp;uncompressed&nbsp;data&nbsp;block&nbsp;from&nbsp;input&nbsp;to&nbsp;output.</span><br>
<span class="lineno">560</span><span class="keyword" id="4829755">func</span>&nbsp;<span class="op" id="4829760">(</span><span class="ident" id="4829761">f</span>&nbsp;<span class="op" id="4829763">*</span><span class="ident" id="4829764">decompressor</span><span class="op" id="4829776">)</span>&nbsp;<span class="ident" id="4829778">dataBlock</span><span class="op" id="4829787">(</span><span class="op" id="4829788">)</span>&nbsp;<span class="op" id="4829790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4829793">//&nbsp;Uncompressed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4829811">//&nbsp;Discard&nbsp;current&nbsp;half-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829842">f</span><span class="op" id="4829843">.</span><span class="ident" id="4829844">nb</span>&nbsp;<span class="op" id="4829847">=</span>&nbsp;<span class="num" id="4829849">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829852">f</span><span class="op" id="4829853">.</span><span class="ident" id="4829854">b</span>&nbsp;<span class="op" id="4829856">=</span>&nbsp;<span class="num" id="4829858">0</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4829862">//&nbsp;Length&nbsp;then&nbsp;ones-complement&nbsp;of&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829905">nr</span><span class="op" id="4829907">,</span>&nbsp;<span class="ident" id="4829909">err</span>&nbsp;<span class="op" id="4829913">:=</span>&nbsp;<span class="ident" id="4829916">io</span><span class="op" id="4829918">.</span><span class="ident" id="4829919">ReadFull</span><span class="op" id="4829927">(</span><span class="ident" id="4829928">f</span><span class="op" id="4829929">.</span><span class="ident" id="4829930">r</span><span class="op" id="4829931">,</span>&nbsp;<span class="ident" id="4829933">f</span><span class="op" id="4829934">.</span><span class="ident" id="4829935">buf</span><span class="op" id="4829938">[</span><span class="num" id="4829939">0</span><span class="op" id="4829940">:</span><span class="num" id="4829941">4</span><span class="op" id="4829942">]</span><span class="op" id="4829943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829946">f</span><span class="op" id="4829947">.</span><span class="ident" id="4829948">roffset</span>&nbsp;<span class="op" id="4829956">+=</span>&nbsp;<span class="ident" id="4829959">int64</span><span class="op" id="4829964">(</span><span class="ident" id="4829965">nr</span><span class="op" id="4829967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4829970">if</span>&nbsp;<span class="ident" id="4829973">err</span>&nbsp;<span class="op" id="4829977">!=</span>&nbsp;<span class="builtintype" id="4829980">nil</span>&nbsp;<span class="op" id="4829984">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829988">f</span><span class="op" id="4829989">.</span><span class="ident" id="4829990">err</span>&nbsp;<span class="op" id="4829994">=</span>&nbsp;<span class="op" id="4829996">&amp;</span><span class="ident" id="4829997">ReadError</span><span class="op" id="4830006">{</span><span class="ident" id="4830007">f</span><span class="op" id="4830008">.</span><span class="ident" id="4830009">roffset</span><span class="op" id="4830016">,</span>&nbsp;<span class="ident" id="4830018">err</span><span class="op" id="4830021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830025">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830036">n</span>&nbsp;<span class="op" id="4830038">:=</span>&nbsp;<span class="builtintype" id="4830041">int</span><span class="op" id="4830044">(</span><span class="ident" id="4830045">f</span><span class="op" id="4830046">.</span><span class="ident" id="4830047">buf</span><span class="op" id="4830050">[</span><span class="num" id="4830051">0</span><span class="op" id="4830052">]</span><span class="op" id="4830053">)</span>&nbsp;<span class="op" id="4830055">|</span>&nbsp;<span class="builtintype" id="4830057">int</span><span class="op" id="4830060">(</span><span class="ident" id="4830061">f</span><span class="op" id="4830062">.</span><span class="ident" id="4830063">buf</span><span class="op" id="4830066">[</span><span class="num" id="4830067">1</span><span class="op" id="4830068">]</span><span class="op" id="4830069">)</span><span class="op" id="4830070">&lt;&lt;</span><span class="num" id="4830072">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830075">nn</span>&nbsp;<span class="op" id="4830078">:=</span>&nbsp;<span class="builtintype" id="4830081">int</span><span class="op" id="4830084">(</span><span class="ident" id="4830085">f</span><span class="op" id="4830086">.</span><span class="ident" id="4830087">buf</span><span class="op" id="4830090">[</span><span class="num" id="4830091">2</span><span class="op" id="4830092">]</span><span class="op" id="4830093">)</span>&nbsp;<span class="op" id="4830095">|</span>&nbsp;<span class="builtintype" id="4830097">int</span><span class="op" id="4830100">(</span><span class="ident" id="4830101">f</span><span class="op" id="4830102">.</span><span class="ident" id="4830103">buf</span><span class="op" id="4830106">[</span><span class="num" id="4830107">3</span><span class="op" id="4830108">]</span><span class="op" id="4830109">)</span><span class="op" id="4830110">&lt;&lt;</span><span class="num" id="4830112">8</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830115">if</span>&nbsp;<span class="builtintype" id="4830118">uint16</span><span class="op" id="4830124">(</span><span class="ident" id="4830125">nn</span><span class="op" id="4830127">)</span>&nbsp;<span class="op" id="4830129">!=</span>&nbsp;<span class="builtintype" id="4830132">uint16</span><span class="op" id="4830138">(</span><span class="op" id="4830139">^</span><span class="ident" id="4830140">n</span><span class="op" id="4830141">)</span>&nbsp;<span class="op" id="4830143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830147">f</span><span class="op" id="4830148">.</span><span class="ident" id="4830149">err</span>&nbsp;<span class="op" id="4830153">=</span>&nbsp;<span class="ident" id="4830155">CorruptInputError</span><span class="op" id="4830172">(</span><span class="ident" id="4830173">f</span><span class="op" id="4830174">.</span><span class="ident" id="4830175">roffset</span><span class="op" id="4830182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830186">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830198">if</span>&nbsp;<span class="ident" id="4830201">n</span>&nbsp;<span class="op" id="4830203">==</span>&nbsp;<span class="num" id="4830206">0</span>&nbsp;<span class="op" id="4830208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4830212">//&nbsp;0-length&nbsp;block&nbsp;means&nbsp;sync</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830243">f</span><span class="op" id="4830244">.</span><span class="ident" id="4830245">flush</span><span class="op" id="4830250">(</span><span class="op" id="4830251">(</span><span class="op" id="4830252">*</span><span class="ident" id="4830253">decompressor</span><span class="op" id="4830265">)</span><span class="op" id="4830266">.</span><span class="ident" id="4830267">nextBlock</span><span class="op" id="4830276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830280">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830288">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830292">f</span><span class="op" id="4830293">.</span><span class="ident" id="4830294">copyLen</span>&nbsp;<span class="op" id="4830302">=</span>&nbsp;<span class="ident" id="4830304">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830307">f</span><span class="op" id="4830308">.</span><span class="ident" id="4830309">copyData</span><span class="op" id="4830317">(</span><span class="op" id="4830318">)</span><br>
<span class="lineno"></span><span class="op" id="4830320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="4830323">//&nbsp;copyData&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;into&nbsp;f.hist.</span><br>
<span class="lineno"></span><span class="comment" id="4830398">//&nbsp;It&nbsp;pauses&nbsp;for&nbsp;reads&nbsp;when&nbsp;f.hist&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="4830442">func</span>&nbsp;<span class="op" id="4830447">(</span><span class="ident" id="4830448">f</span>&nbsp;<span class="op" id="4830450">*</span><span class="ident" id="4830451">decompressor</span><span class="op" id="4830463">)</span>&nbsp;<span class="ident" id="4830465">copyData</span><span class="op" id="4830473">(</span><span class="op" id="4830474">)</span>&nbsp;<span class="op" id="4830476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830479">n</span>&nbsp;<span class="op" id="4830481">:=</span>&nbsp;<span class="ident" id="4830484">f</span><span class="op" id="4830485">.</span><span class="ident" id="4830486">copyLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830495">for</span>&nbsp;<span class="ident" id="4830499">n</span>&nbsp;<span class="op" id="4830501">&gt;</span>&nbsp;<span class="num" id="4830503">0</span>&nbsp;<span class="op" id="4830505">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830509">m</span>&nbsp;<span class="op" id="4830511">:=</span>&nbsp;<span class="builtinfunc" id="4830514">len</span><span class="op" id="4830517">(</span><span class="ident" id="4830518">f</span><span class="op" id="4830519">.</span><span class="ident" id="4830520">hist</span><span class="op" id="4830524">)</span>&nbsp;<span class="op" id="4830526">-</span>&nbsp;<span class="ident" id="4830528">f</span><span class="op" id="4830529">.</span><span class="ident" id="4830530">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830535">if</span>&nbsp;<span class="ident" id="4830538">m</span>&nbsp;<span class="op" id="4830540">&gt;</span>&nbsp;<span class="ident" id="4830542">n</span>&nbsp;<span class="op" id="4830544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830549">m</span>&nbsp;<span class="op" id="4830551">=</span>&nbsp;<span class="ident" id="4830553">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830561">m</span><span class="op" id="4830562">,</span>&nbsp;<span class="ident" id="4830564">err</span>&nbsp;<span class="op" id="4830568">:=</span>&nbsp;<span class="ident" id="4830571">io</span><span class="op" id="4830573">.</span><span class="ident" id="4830574">ReadFull</span><span class="op" id="4830582">(</span><span class="ident" id="4830583">f</span><span class="op" id="4830584">.</span><span class="ident" id="4830585">r</span><span class="op" id="4830586">,</span>&nbsp;<span class="ident" id="4830588">f</span><span class="op" id="4830589">.</span><span class="ident" id="4830590">hist</span><span class="op" id="4830594">[</span><span class="ident" id="4830595">f</span><span class="op" id="4830596">.</span><span class="ident" id="4830597">hp</span><span class="op" id="4830599">:</span><span class="ident" id="4830600">f</span><span class="op" id="4830601">.</span><span class="ident" id="4830602">hp</span><span class="op" id="4830604">+</span><span class="ident" id="4830605">m</span><span class="op" id="4830606">]</span><span class="op" id="4830607">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830611">f</span><span class="op" id="4830612">.</span><span class="ident" id="4830613">roffset</span>&nbsp;<span class="op" id="4830621">+=</span>&nbsp;<span class="ident" id="4830624">int64</span><span class="op" id="4830629">(</span><span class="ident" id="4830630">m</span><span class="op" id="4830631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830635">if</span>&nbsp;<span class="ident" id="4830638">err</span>&nbsp;<span class="op" id="4830642">!=</span>&nbsp;<span class="builtintype" id="4830645">nil</span>&nbsp;<span class="op" id="4830649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830654">f</span><span class="op" id="4830655">.</span><span class="ident" id="4830656">err</span>&nbsp;<span class="op" id="4830660">=</span>&nbsp;<span class="op" id="4830662">&amp;</span><span class="ident" id="4830663">ReadError</span><span class="op" id="4830672">{</span><span class="ident" id="4830673">f</span><span class="op" id="4830674">.</span><span class="ident" id="4830675">roffset</span><span class="op" id="4830682">,</span>&nbsp;<span class="ident" id="4830684">err</span><span class="op" id="4830687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830692">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830701">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830705">n</span>&nbsp;<span class="op" id="4830707">-=</span>&nbsp;<span class="ident" id="4830710">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830714">f</span><span class="op" id="4830715">.</span><span class="ident" id="4830716">hp</span>&nbsp;<span class="op" id="4830719">+=</span>&nbsp;<span class="ident" id="4830722">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830726">if</span>&nbsp;<span class="ident" id="4830729">f</span><span class="op" id="4830730">.</span><span class="ident" id="4830731">hp</span>&nbsp;<span class="op" id="4830734">==</span>&nbsp;<span class="builtinfunc" id="4830737">len</span><span class="op" id="4830740">(</span><span class="ident" id="4830741">f</span><span class="op" id="4830742">.</span><span class="ident" id="4830743">hist</span><span class="op" id="4830747">)</span>&nbsp;<span class="op" id="4830749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830754">f</span><span class="op" id="4830755">.</span><span class="ident" id="4830756">copyLen</span>&nbsp;<span class="op" id="4830764">=</span>&nbsp;<span class="ident" id="4830766">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830771">f</span><span class="op" id="4830772">.</span><span class="ident" id="4830773">flush</span><span class="op" id="4830778">(</span><span class="op" id="4830779">(</span><span class="op" id="4830780">*</span><span class="ident" id="4830781">decompressor</span><span class="op" id="4830793">)</span><span class="op" id="4830794">.</span><span class="ident" id="4830795">copyData</span><span class="op" id="4830803">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830808">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830823">f</span><span class="op" id="4830824">.</span><span class="ident" id="4830825">step</span>&nbsp;<span class="op" id="4830830">=</span>&nbsp;<span class="op" id="4830832">(</span><span class="op" id="4830833">*</span><span class="ident" id="4830834">decompressor</span><span class="op" id="4830846">)</span><span class="op" id="4830847">.</span><span class="ident" id="4830848">nextBlock</span><br>
<span class="lineno"></span><span class="op" id="4830858">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="4830861">func</span>&nbsp;<span class="op" id="4830866">(</span><span class="ident" id="4830867">f</span>&nbsp;<span class="op" id="4830869">*</span><span class="ident" id="4830870">decompressor</span><span class="op" id="4830882">)</span>&nbsp;<span class="ident" id="4830884">setDict</span><span class="op" id="4830891">(</span><span class="ident" id="4830892">dict</span>&nbsp;<span class="op" id="4830897">[</span><span class="op" id="4830898">]</span><span class="builtintype" id="4830899">byte</span><span class="op" id="4830903">)</span>&nbsp;<span class="op" id="4830905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830908">if</span>&nbsp;<span class="builtinfunc" id="4830911">len</span><span class="op" id="4830914">(</span><span class="ident" id="4830915">dict</span><span class="op" id="4830919">)</span>&nbsp;<span class="op" id="4830921">&gt;</span>&nbsp;<span class="builtinfunc" id="4830923">len</span><span class="op" id="4830926">(</span><span class="ident" id="4830927">f</span><span class="op" id="4830928">.</span><span class="ident" id="4830929">hist</span><span class="op" id="4830933">)</span>&nbsp;<span class="op" id="4830935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4830939">//&nbsp;Will&nbsp;only&nbsp;remember&nbsp;the&nbsp;tail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830973">dict</span>&nbsp;<span class="op" id="4830978">=</span>&nbsp;<span class="ident" id="4830980">dict</span><span class="op" id="4830984">[</span><span class="builtinfunc" id="4830985">len</span><span class="op" id="4830988">(</span><span class="ident" id="4830989">dict</span><span class="op" id="4830993">)</span><span class="op" id="4830994">-</span><span class="builtinfunc" id="4830995">len</span><span class="op" id="4830998">(</span><span class="ident" id="4830999">f</span><span class="op" id="4831000">.</span><span class="ident" id="4831001">hist</span><span class="op" id="4831005">)</span><span class="op" id="4831006">:</span><span class="op" id="4831007">]</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831014">f</span><span class="op" id="4831015">.</span><span class="ident" id="4831016">hp</span>&nbsp;<span class="op" id="4831019">=</span>&nbsp;<span class="builtinfunc" id="4831021">copy</span><span class="op" id="4831025">(</span><span class="ident" id="4831026">f</span><span class="op" id="4831027">.</span><span class="ident" id="4831028">hist</span><span class="op" id="4831032">[</span><span class="op" id="4831033">:</span><span class="op" id="4831034">]</span><span class="op" id="4831035">,</span>&nbsp;<span class="ident" id="4831037">dict</span><span class="op" id="4831041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831044">if</span>&nbsp;<span class="ident" id="4831047">f</span><span class="op" id="4831048">.</span><span class="ident" id="4831049">hp</span>&nbsp;<span class="op" id="4831052">==</span>&nbsp;<span class="builtinfunc" id="4831055">len</span><span class="op" id="4831058">(</span><span class="ident" id="4831059">f</span><span class="op" id="4831060">.</span><span class="ident" id="4831061">hist</span><span class="op" id="4831065">)</span>&nbsp;<span class="op" id="4831067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831071">f</span><span class="op" id="4831072">.</span><span class="ident" id="4831073">hp</span>&nbsp;<span class="op" id="4831076">=</span>&nbsp;<span class="num" id="4831078">0</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831082">f</span><span class="op" id="4831083">.</span><span class="ident" id="4831084">hfull</span>&nbsp;<span class="op" id="4831090">=</span>&nbsp;<span class="builtintype" id="4831092">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831101">f</span><span class="op" id="4831102">.</span><span class="ident" id="4831103">hw</span>&nbsp;<span class="op" id="4831106">=</span>&nbsp;<span class="ident" id="4831108">f</span><span class="op" id="4831109">.</span><span class="ident" id="4831110">hp</span><br>
<span class="lineno"></span><span class="op" id="4831113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="keyword" id="4831116">func</span>&nbsp;<span class="op" id="4831121">(</span><span class="ident" id="4831122">f</span>&nbsp;<span class="op" id="4831124">*</span><span class="ident" id="4831125">decompressor</span><span class="op" id="4831137">)</span>&nbsp;<span class="ident" id="4831139">moreBits</span><span class="op" id="4831147">(</span><span class="op" id="4831148">)</span>&nbsp;<span class="builtintype" id="4831150">error</span>&nbsp;<span class="op" id="4831156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831159">c</span><span class="op" id="4831160">,</span>&nbsp;<span class="ident" id="4831162">err</span>&nbsp;<span class="op" id="4831166">:=</span>&nbsp;<span class="ident" id="4831169">f</span><span class="op" id="4831170">.</span><span class="ident" id="4831171">r</span><span class="op" id="4831172">.</span><span class="ident" id="4831173">ReadByte</span><span class="op" id="4831181">(</span><span class="op" id="4831182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831185">if</span>&nbsp;<span class="ident" id="4831188">err</span>&nbsp;<span class="op" id="4831192">!=</span>&nbsp;<span class="builtintype" id="4831195">nil</span>&nbsp;<span class="op" id="4831199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831203">if</span>&nbsp;<span class="ident" id="4831206">err</span>&nbsp;<span class="op" id="4831210">==</span>&nbsp;<span class="ident" id="4831213">io</span><span class="op" id="4831215">.</span><span class="ident" id="4831216">EOF</span>&nbsp;<span class="op" id="4831220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831225">err</span>&nbsp;<span class="op" id="4831229">=</span>&nbsp;<span class="ident" id="4831231">io</span><span class="op" id="4831233">.</span><span class="ident" id="4831234">ErrUnexpectedEOF</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831257">return</span>&nbsp;<span class="ident" id="4831264">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831272">f</span><span class="op" id="4831273">.</span><span class="ident" id="4831274">roffset</span><span class="op" id="4831281">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831285">f</span><span class="op" id="4831286">.</span><span class="ident" id="4831287">b</span>&nbsp;<span class="op" id="4831289">|=</span>&nbsp;<span class="builtintype" id="4831292">uint32</span><span class="op" id="4831298">(</span><span class="ident" id="4831299">c</span><span class="op" id="4831300">)</span>&nbsp;<span class="op" id="4831302">&lt;&lt;</span>&nbsp;<span class="ident" id="4831305">f</span><span class="op" id="4831306">.</span><span class="ident" id="4831307">nb</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831311">f</span><span class="op" id="4831312">.</span><span class="ident" id="4831313">nb</span>&nbsp;<span class="op" id="4831316">+=</span>&nbsp;<span class="num" id="4831319">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831322">return</span>&nbsp;<span class="builtintype" id="4831329">nil</span><br>
<span class="lineno"></span><span class="op" id="4831333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4831336">//&nbsp;Read&nbsp;the&nbsp;next&nbsp;Huffman-encoded&nbsp;symbol&nbsp;from&nbsp;f&nbsp;according&nbsp;to&nbsp;h.</span><br>
<span class="lineno">645</span><span class="keyword" id="4831399">func</span>&nbsp;<span class="op" id="4831404">(</span><span class="ident" id="4831405">f</span>&nbsp;<span class="op" id="4831407">*</span><span class="ident" id="4831408">decompressor</span><span class="op" id="4831420">)</span>&nbsp;<span class="ident" id="4831422">huffSym</span><span class="op" id="4831429">(</span><span class="ident" id="4831430">h</span>&nbsp;<span class="op" id="4831432">*</span><span class="ident" id="4831433">huffmanDecoder</span><span class="op" id="4831447">)</span>&nbsp;<span class="op" id="4831449">(</span><span class="builtintype" id="4831450">int</span><span class="op" id="4831453">,</span>&nbsp;<span class="builtintype" id="4831455">error</span><span class="op" id="4831460">)</span>&nbsp;<span class="op" id="4831462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831465">n</span>&nbsp;<span class="op" id="4831467">:=</span>&nbsp;<span class="builtintype" id="4831470">uint</span><span class="op" id="4831474">(</span><span class="ident" id="4831475">h</span><span class="op" id="4831476">.</span><span class="ident" id="4831477">min</span><span class="op" id="4831480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831483">for</span>&nbsp;<span class="op" id="4831487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831491">for</span>&nbsp;<span class="ident" id="4831495">f</span><span class="op" id="4831496">.</span><span class="ident" id="4831497">nb</span>&nbsp;<span class="op" id="4831500">&lt;</span>&nbsp;<span class="ident" id="4831502">n</span>&nbsp;<span class="op" id="4831504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831509">if</span>&nbsp;<span class="ident" id="4831512">err</span>&nbsp;<span class="op" id="4831516">:=</span>&nbsp;<span class="ident" id="4831519">f</span><span class="op" id="4831520">.</span><span class="ident" id="4831521">moreBits</span><span class="op" id="4831529">(</span><span class="op" id="4831530">)</span><span class="op" id="4831531">;</span>&nbsp;<span class="ident" id="4831533">err</span>&nbsp;<span class="op" id="4831537">!=</span>&nbsp;<span class="builtintype" id="4831540">nil</span>&nbsp;<span class="op" id="4831544">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831550">return</span>&nbsp;<span class="num" id="4831557">0</span><span class="op" id="4831558">,</span>&nbsp;<span class="ident" id="4831560">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831575">chunk</span>&nbsp;<span class="op" id="4831581">:=</span>&nbsp;<span class="ident" id="4831584">h</span><span class="op" id="4831585">.</span><span class="ident" id="4831586">chunks</span><span class="op" id="4831592">[</span><span class="ident" id="4831593">f</span><span class="op" id="4831594">.</span><span class="ident" id="4831595">b</span><span class="op" id="4831596">&amp;</span><span class="op" id="4831597">(</span><span class="ident" id="4831598">huffmanNumChunks</span><span class="op" id="4831614">-</span><span class="num" id="4831615">1</span><span class="op" id="4831616">)</span><span class="op" id="4831617">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831621">n</span>&nbsp;<span class="op" id="4831623">=</span>&nbsp;<span class="builtintype" id="4831625">uint</span><span class="op" id="4831629">(</span><span class="ident" id="4831630">chunk</span>&nbsp;<span class="op" id="4831636">&amp;</span>&nbsp;<span class="ident" id="4831638">huffmanCountMask</span><span class="op" id="4831654">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831658">if</span>&nbsp;<span class="ident" id="4831661">n</span>&nbsp;<span class="op" id="4831663">&gt;</span>&nbsp;<span class="ident" id="4831665">huffmanChunkBits</span>&nbsp;<span class="op" id="4831682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831687">chunk</span>&nbsp;<span class="op" id="4831693">=</span>&nbsp;<span class="ident" id="4831695">h</span><span class="op" id="4831696">.</span><span class="ident" id="4831697">links</span><span class="op" id="4831702">[</span><span class="ident" id="4831703">chunk</span><span class="op" id="4831708">&gt;&gt;</span><span class="ident" id="4831710">huffmanValueShift</span><span class="op" id="4831727">]</span><span class="op" id="4831728">[</span><span class="op" id="4831729">(</span><span class="ident" id="4831730">f</span><span class="op" id="4831731">.</span><span class="ident" id="4831732">b</span><span class="op" id="4831733">&gt;&gt;</span><span class="ident" id="4831735">huffmanChunkBits</span><span class="op" id="4831751">)</span><span class="op" id="4831752">&amp;</span><span class="ident" id="4831753">h</span><span class="op" id="4831754">.</span><span class="ident" id="4831755">linkMask</span><span class="op" id="4831763">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831768">n</span>&nbsp;<span class="op" id="4831770">=</span>&nbsp;<span class="builtintype" id="4831772">uint</span><span class="op" id="4831776">(</span><span class="ident" id="4831777">chunk</span>&nbsp;<span class="op" id="4831783">&amp;</span>&nbsp;<span class="ident" id="4831785">huffmanCountMask</span><span class="op" id="4831801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831806">if</span>&nbsp;<span class="ident" id="4831809">n</span>&nbsp;<span class="op" id="4831811">==</span>&nbsp;<span class="num" id="4831814">0</span>&nbsp;<span class="op" id="4831816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831822">f</span><span class="op" id="4831823">.</span><span class="ident" id="4831824">err</span>&nbsp;<span class="op" id="4831828">=</span>&nbsp;<span class="ident" id="4831830">CorruptInputError</span><span class="op" id="4831847">(</span><span class="ident" id="4831848">f</span><span class="op" id="4831849">.</span><span class="ident" id="4831850">roffset</span><span class="op" id="4831857">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831863">return</span>&nbsp;<span class="num" id="4831870">0</span><span class="op" id="4831871">,</span>&nbsp;<span class="ident" id="4831873">f</span><span class="op" id="4831874">.</span><span class="ident" id="4831875">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831890">if</span>&nbsp;<span class="ident" id="4831893">n</span>&nbsp;<span class="op" id="4831895">&lt;=</span>&nbsp;<span class="ident" id="4831898">f</span><span class="op" id="4831899">.</span><span class="ident" id="4831900">nb</span>&nbsp;<span class="op" id="4831903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831908">f</span><span class="op" id="4831909">.</span><span class="ident" id="4831910">b</span>&nbsp;<span class="op" id="4831912">&gt;&gt;=</span>&nbsp;<span class="ident" id="4831916">n</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831921">f</span><span class="op" id="4831922">.</span><span class="ident" id="4831923">nb</span>&nbsp;<span class="op" id="4831926">-=</span>&nbsp;<span class="ident" id="4831929">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831934">return</span>&nbsp;<span class="builtintype" id="4831941">int</span><span class="op" id="4831944">(</span><span class="ident" id="4831945">chunk</span>&nbsp;<span class="op" id="4831951">&gt;&gt;</span>&nbsp;<span class="ident" id="4831954">huffmanValueShift</span><span class="op" id="4831971">)</span><span class="op" id="4831972">,</span>&nbsp;<span class="builtintype" id="4831974">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831983">}</span><br>
<span class="lineno"></span><span class="op" id="4831985">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="4831988">//&nbsp;Flush&nbsp;any&nbsp;buffered&nbsp;output&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4832043">func</span>&nbsp;<span class="op" id="4832048">(</span><span class="ident" id="4832049">f</span>&nbsp;<span class="op" id="4832051">*</span><span class="ident" id="4832052">decompressor</span><span class="op" id="4832064">)</span>&nbsp;<span class="ident" id="4832066">flush</span><span class="op" id="4832071">(</span><span class="ident" id="4832072">step</span>&nbsp;<span class="keyword" id="4832077">func</span><span class="op" id="4832081">(</span><span class="op" id="4832082">*</span><span class="ident" id="4832083">decompressor</span><span class="op" id="4832095">)</span><span class="op" id="4832096">)</span>&nbsp;<span class="op" id="4832098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832101">f</span><span class="op" id="4832102">.</span><span class="ident" id="4832103">toRead</span>&nbsp;<span class="op" id="4832110">=</span>&nbsp;<span class="ident" id="4832112">f</span><span class="op" id="4832113">.</span><span class="ident" id="4832114">hist</span><span class="op" id="4832118">[</span><span class="ident" id="4832119">f</span><span class="op" id="4832120">.</span><span class="ident" id="4832121">hw</span><span class="op" id="4832123">:</span><span class="ident" id="4832124">f</span><span class="op" id="4832125">.</span><span class="ident" id="4832126">hp</span><span class="op" id="4832128">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832131">f</span><span class="op" id="4832132">.</span><span class="ident" id="4832133">woffset</span>&nbsp;<span class="op" id="4832141">+=</span>&nbsp;<span class="ident" id="4832144">int64</span><span class="op" id="4832149">(</span><span class="ident" id="4832150">f</span><span class="op" id="4832151">.</span><span class="ident" id="4832152">hp</span>&nbsp;<span class="op" id="4832155">-</span>&nbsp;<span class="ident" id="4832157">f</span><span class="op" id="4832158">.</span><span class="ident" id="4832159">hw</span><span class="op" id="4832161">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832164">f</span><span class="op" id="4832165">.</span><span class="ident" id="4832166">hw</span>&nbsp;<span class="op" id="4832169">=</span>&nbsp;<span class="ident" id="4832171">f</span><span class="op" id="4832172">.</span><span class="ident" id="4832173">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4832177">if</span>&nbsp;<span class="ident" id="4832180">f</span><span class="op" id="4832181">.</span><span class="ident" id="4832182">hp</span>&nbsp;<span class="op" id="4832185">==</span>&nbsp;<span class="builtinfunc" id="4832188">len</span><span class="op" id="4832191">(</span><span class="ident" id="4832192">f</span><span class="op" id="4832193">.</span><span class="ident" id="4832194">hist</span><span class="op" id="4832198">)</span>&nbsp;<span class="op" id="4832200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832204">f</span><span class="op" id="4832205">.</span><span class="ident" id="4832206">hp</span>&nbsp;<span class="op" id="4832209">=</span>&nbsp;<span class="num" id="4832211">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832215">f</span><span class="op" id="4832216">.</span><span class="ident" id="4832217">hw</span>&nbsp;<span class="op" id="4832220">=</span>&nbsp;<span class="num" id="4832222">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832226">f</span><span class="op" id="4832227">.</span><span class="ident" id="4832228">hfull</span>&nbsp;<span class="op" id="4832234">=</span>&nbsp;<span class="builtintype" id="4832236">true</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4832242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832245">f</span><span class="op" id="4832246">.</span><span class="ident" id="4832247">step</span>&nbsp;<span class="op" id="4832252">=</span>&nbsp;<span class="ident" id="4832254">step</span><br>
<span class="lineno"></span><span class="op" id="4832259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4832262">func</span>&nbsp;<span class="ident" id="4832267">makeReader</span><span class="op" id="4832277">(</span><span class="ident" id="4832278">r</span>&nbsp;<span class="ident" id="4832280">io</span><span class="op" id="4832282">.</span><span class="ident" id="4832283">Reader</span><span class="op" id="4832289">)</span>&nbsp;<span class="ident" id="4832291">Reader</span>&nbsp;<span class="op" id="4832298">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4832301">if</span>&nbsp;<span class="ident" id="4832304">rr</span><span class="op" id="4832306">,</span>&nbsp;<span class="ident" id="4832308">ok</span>&nbsp;<span class="op" id="4832311">:=</span>&nbsp;<span class="ident" id="4832314">r</span><span class="op" id="4832315">.</span><span class="op" id="4832316">(</span><span class="ident" id="4832317">Reader</span><span class="op" id="4832323">)</span><span class="op" id="4832324">;</span>&nbsp;<span class="ident" id="4832326">ok</span>&nbsp;<span class="op" id="4832329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4832333">return</span>&nbsp;<span class="ident" id="4832340">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4832344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4832347">return</span>&nbsp;<span class="ident" id="4832354">bufio</span><span class="op" id="4832359">.</span><span class="ident" id="4832360">NewReader</span><span class="op" id="4832369">(</span><span class="ident" id="4832370">r</span><span class="op" id="4832371">)</span><br>
<span class="lineno"></span><span class="op" id="4832373">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="4832376">func</span>&nbsp;<span class="op" id="4832381">(</span><span class="ident" id="4832382">f</span>&nbsp;<span class="op" id="4832384">*</span><span class="ident" id="4832385">decompressor</span><span class="op" id="4832397">)</span>&nbsp;<span class="ident" id="4832399">Reset</span><span class="op" id="4832404">(</span><span class="ident" id="4832405">r</span>&nbsp;<span class="ident" id="4832407">io</span><span class="op" id="4832409">.</span><span class="ident" id="4832410">Reader</span><span class="op" id="4832416">,</span>&nbsp;<span class="ident" id="4832418">dict</span>&nbsp;<span class="op" id="4832423">[</span><span class="op" id="4832424">]</span><span class="builtintype" id="4832425">byte</span><span class="op" id="4832429">)</span>&nbsp;<span class="builtintype" id="4832431">error</span>&nbsp;<span class="op" id="4832437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4832440">*</span><span class="ident" id="4832441">f</span>&nbsp;<span class="op" id="4832443">=</span>&nbsp;<span class="ident" id="4832445">decompressor</span><span class="op" id="4832457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832461">r</span><span class="op" id="4832462">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832471">makeReader</span><span class="op" id="4832481">(</span><span class="ident" id="4832482">r</span><span class="op" id="4832483">)</span><span class="op" id="4832484">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832488">bits</span><span class="op" id="4832492">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832498">f</span><span class="op" id="4832499">.</span><span class="ident" id="4832500">bits</span><span class="op" id="4832504">,</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832508">codebits</span><span class="op" id="4832516">:</span>&nbsp;<span class="ident" id="4832518">f</span><span class="op" id="4832519">.</span><span class="ident" id="4832520">codebits</span><span class="op" id="4832528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832532">hist</span><span class="op" id="4832536">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832542">f</span><span class="op" id="4832543">.</span><span class="ident" id="4832544">hist</span><span class="op" id="4832548">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832552">step</span><span class="op" id="4832556">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4832562">(</span><span class="op" id="4832563">*</span><span class="ident" id="4832564">decompressor</span><span class="op" id="4832576">)</span><span class="op" id="4832577">.</span><span class="ident" id="4832578">nextBlock</span><span class="op" id="4832587">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4832590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4832593">if</span>&nbsp;<span class="ident" id="4832596">dict</span>&nbsp;<span class="op" id="4832601">!=</span>&nbsp;<span class="builtintype" id="4832604">nil</span>&nbsp;<span class="op" id="4832608">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832612">f</span><span class="op" id="4832613">.</span><span class="ident" id="4832614">setDict</span><span class="op" id="4832621">(</span><span class="ident" id="4832622">dict</span><span class="op" id="4832626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4832629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4832632">return</span>&nbsp;<span class="builtintype" id="4832639">nil</span><br>
<span class="lineno"></span><span class="op" id="4832643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="4832646">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;ReadCloser&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4832701">//&nbsp;to&nbsp;read&nbsp;the&nbsp;uncompressed&nbsp;version&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4832743">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4832790">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4832852">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;ReadCloser</span><br>
<span class="lineno">710</span><span class="comment" id="4832921">//&nbsp;when&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="comment" id="4832947">//</span><br>
<span class="lineno"></span><span class="comment" id="4832950">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno"></span><span class="keyword" id="4833016">func</span>&nbsp;<span class="ident" id="4833021">NewReader</span><span class="op" id="4833030">(</span><span class="ident" id="4833031">r</span>&nbsp;<span class="ident" id="4833033">io</span><span class="op" id="4833035">.</span><span class="ident" id="4833036">Reader</span><span class="op" id="4833042">)</span>&nbsp;<span class="ident" id="4833044">io</span><span class="op" id="4833046">.</span><span class="ident" id="4833047">ReadCloser</span>&nbsp;<span class="op" id="4833058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833061">var</span>&nbsp;<span class="ident" id="4833065">f</span>&nbsp;<span class="ident" id="4833067">decompressor</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833081">f</span><span class="op" id="4833082">.</span><span class="ident" id="4833083">bits</span>&nbsp;<span class="op" id="4833088">=</span>&nbsp;<span class="builtinfunc" id="4833090">new</span><span class="op" id="4833093">(</span><span class="op" id="4833094">[</span><span class="ident" id="4833095">maxLit</span>&nbsp;<span class="op" id="4833102">+</span>&nbsp;<span class="ident" id="4833104">maxDist</span><span class="op" id="4833111">]</span><span class="builtintype" id="4833112">int</span><span class="op" id="4833115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833118">f</span><span class="op" id="4833119">.</span><span class="ident" id="4833120">codebits</span>&nbsp;<span class="op" id="4833129">=</span>&nbsp;<span class="builtinfunc" id="4833131">new</span><span class="op" id="4833134">(</span><span class="op" id="4833135">[</span><span class="ident" id="4833136">numCodes</span><span class="op" id="4833144">]</span><span class="builtintype" id="4833145">int</span><span class="op" id="4833148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833151">f</span><span class="op" id="4833152">.</span><span class="ident" id="4833153">r</span>&nbsp;<span class="op" id="4833155">=</span>&nbsp;<span class="ident" id="4833157">makeReader</span><span class="op" id="4833167">(</span><span class="ident" id="4833168">r</span><span class="op" id="4833169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833172">f</span><span class="op" id="4833173">.</span><span class="ident" id="4833174">hist</span>&nbsp;<span class="op" id="4833179">=</span>&nbsp;<span class="builtinfunc" id="4833181">new</span><span class="op" id="4833184">(</span><span class="op" id="4833185">[</span><span class="ident" id="4833186">maxHist</span><span class="op" id="4833193">]</span><span class="builtintype" id="4833194">byte</span><span class="op" id="4833198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833201">f</span><span class="op" id="4833202">.</span><span class="ident" id="4833203">step</span>&nbsp;<span class="op" id="4833208">=</span>&nbsp;<span class="op" id="4833210">(</span><span class="op" id="4833211">*</span><span class="ident" id="4833212">decompressor</span><span class="op" id="4833224">)</span><span class="op" id="4833225">.</span><span class="ident" id="4833226">nextBlock</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833237">return</span>&nbsp;<span class="op" id="4833244">&amp;</span><span class="ident" id="4833245">f</span><br>
<span class="lineno"></span><span class="op" id="4833247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4833250">//&nbsp;NewReaderDict&nbsp;is&nbsp;like&nbsp;NewReader&nbsp;but&nbsp;initializes&nbsp;the&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="4833312">//&nbsp;with&nbsp;a&nbsp;preset&nbsp;dictionary.&nbsp;&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;behaves&nbsp;as&nbsp;if</span><br>
<span class="lineno">725</span><span class="comment" id="4833376">//&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;stream&nbsp;started&nbsp;with&nbsp;the&nbsp;given&nbsp;dictionary,</span><br>
<span class="lineno"></span><span class="comment" id="4833443">//&nbsp;which&nbsp;has&nbsp;already&nbsp;been&nbsp;read.&nbsp;&nbsp;NewReaderDict&nbsp;is&nbsp;typically&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4833508">//&nbsp;to&nbsp;read&nbsp;data&nbsp;compressed&nbsp;by&nbsp;NewWriterDict.</span><br>
<span class="lineno"></span><span class="comment" id="4833553">//</span><br>
<span class="lineno"></span><span class="comment" id="4833556">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno">730</span><span class="keyword" id="4833622">func</span>&nbsp;<span class="ident" id="4833627">NewReaderDict</span><span class="op" id="4833640">(</span><span class="ident" id="4833641">r</span>&nbsp;<span class="ident" id="4833643">io</span><span class="op" id="4833645">.</span><span class="ident" id="4833646">Reader</span><span class="op" id="4833652">,</span>&nbsp;<span class="ident" id="4833654">dict</span>&nbsp;<span class="op" id="4833659">[</span><span class="op" id="4833660">]</span><span class="builtintype" id="4833661">byte</span><span class="op" id="4833665">)</span>&nbsp;<span class="ident" id="4833667">io</span><span class="op" id="4833669">.</span><span class="ident" id="4833670">ReadCloser</span>&nbsp;<span class="op" id="4833681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833684">var</span>&nbsp;<span class="ident" id="4833688">f</span>&nbsp;<span class="ident" id="4833690">decompressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833704">f</span><span class="op" id="4833705">.</span><span class="ident" id="4833706">r</span>&nbsp;<span class="op" id="4833708">=</span>&nbsp;<span class="ident" id="4833710">makeReader</span><span class="op" id="4833720">(</span><span class="ident" id="4833721">r</span><span class="op" id="4833722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833725">f</span><span class="op" id="4833726">.</span><span class="ident" id="4833727">hist</span>&nbsp;<span class="op" id="4833732">=</span>&nbsp;<span class="builtinfunc" id="4833734">new</span><span class="op" id="4833737">(</span><span class="op" id="4833738">[</span><span class="ident" id="4833739">maxHist</span><span class="op" id="4833746">]</span><span class="builtintype" id="4833747">byte</span><span class="op" id="4833751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833754">f</span><span class="op" id="4833755">.</span><span class="ident" id="4833756">bits</span>&nbsp;<span class="op" id="4833761">=</span>&nbsp;<span class="builtinfunc" id="4833763">new</span><span class="op" id="4833766">(</span><span class="op" id="4833767">[</span><span class="ident" id="4833768">maxLit</span>&nbsp;<span class="op" id="4833775">+</span>&nbsp;<span class="ident" id="4833777">maxDist</span><span class="op" id="4833784">]</span><span class="builtintype" id="4833785">int</span><span class="op" id="4833788">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833791">f</span><span class="op" id="4833792">.</span><span class="ident" id="4833793">codebits</span>&nbsp;<span class="op" id="4833802">=</span>&nbsp;<span class="builtinfunc" id="4833804">new</span><span class="op" id="4833807">(</span><span class="op" id="4833808">[</span><span class="ident" id="4833809">numCodes</span><span class="op" id="4833817">]</span><span class="builtintype" id="4833818">int</span><span class="op" id="4833821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833824">f</span><span class="op" id="4833825">.</span><span class="ident" id="4833826">step</span>&nbsp;<span class="op" id="4833831">=</span>&nbsp;<span class="op" id="4833833">(</span><span class="op" id="4833834">*</span><span class="ident" id="4833835">decompressor</span><span class="op" id="4833847">)</span><span class="op" id="4833848">.</span><span class="ident" id="4833849">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833860">f</span><span class="op" id="4833861">.</span><span class="ident" id="4833862">setDict</span><span class="op" id="4833869">(</span><span class="ident" id="4833870">dict</span><span class="op" id="4833874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4833877">return</span>&nbsp;<span class="op" id="4833884">&amp;</span><span class="ident" id="4833885">f</span><br>
<span class="lineno"></span><span class="op" id="4833887">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
