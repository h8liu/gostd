<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8666627">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8666683">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8666737">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8666788">package</span>&nbsp;<span class="ident" id="8666796">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8666803">import</span>&nbsp;<span class="op" id="8666810">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8666813">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8666824">&#34;testing&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8666835">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8666842">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8666845">func</span>&nbsp;<span class="ident" id="8666850">TestReadGCStats</span><span class="op" id="8666865">(</span><span class="ident" id="8666866">t</span>&nbsp;<span class="op" id="8666868">*</span><span class="ident" id="8666869"><a href="/runtime/debug/garbage_test.go.html#8666824">testing</a></span><span class="op" id="8666876">.</span><span class="ident" id="8666877">T</span><span class="op" id="8666878">)</span>&nbsp;<span class="op" id="8666880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8666883">defer</span>&nbsp;<span class="ident" id="8666889"><a href="/runtime/debug/garbage.go.html#6018600">SetGCPercent</a></span><span class="op" id="8666901">(</span><span class="ident" id="8666902"><a href="/runtime/debug/garbage.go.html#6018600">SetGCPercent</a></span><span class="op" id="8666914">(</span><span class="op" id="8666915">-</span><span class="num" id="8666916">1</span><span class="op" id="8666917">)</span><span class="op" id="8666918">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8666922">var</span>&nbsp;<span class="ident" id="8666926">stats</span>&nbsp;<span class="ident" id="8666932"><a href="/runtime/debug/garbage.go.html#6015173">GCStats</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8666941">var</span>&nbsp;<span class="ident" id="8666945">mstats</span>&nbsp;<span class="ident" id="8666952"><a href="/runtime/debug/garbage_test.go.html#8666813">runtime</a></span><span class="op" id="8666959">.</span><span class="ident" id="8666960">MemStats</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8666970">var</span>&nbsp;<span class="ident" id="8666974">min</span><span class="op" id="8666977">,</span>&nbsp;<span class="ident" id="8666979">max</span>&nbsp;<span class="ident" id="8666983"><a href="/runtime/debug/garbage_test.go.html#8666835">time</a></span><span class="op" id="8666987">.</span><span class="ident" id="8666988">Duration</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8666999">//&nbsp;First&nbsp;ReadGCStats&nbsp;will&nbsp;allocate,&nbsp;second&nbsp;should&nbsp;not,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8667055">//&nbsp;especially&nbsp;if&nbsp;we&nbsp;follow&nbsp;up&nbsp;with&nbsp;an&nbsp;explicit&nbsp;garbage&nbsp;collection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8667123"><a href="/runtime/debug/garbage_test.go.html#8666926">stats</a></span><span class="op" id="8667128">.</span><span class="ident" id="8667129">PauseQuantiles</span>&nbsp;<span class="op" id="8667144">=</span>&nbsp;<span class="builtinfunc" id="8667146">make</span><span class="op" id="8667150">(</span><span class="op" id="8667151">[</span><span class="op" id="8667152">]</span><span class="ident" id="8667153"><a href="/runtime/debug/garbage_test.go.html#8666835">time</a></span><span class="op" id="8667157">.</span><span class="ident" id="8667158">Duration</span><span class="op" id="8667166">,</span>&nbsp;<span class="num" id="8667168">10</span><span class="op" id="8667170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8667173"><a href="/runtime/debug/garbage.go.html#6016100">ReadGCStats</a></span><span class="op" id="8667184">(</span><span class="op" id="8667185">&amp;</span><span class="ident" id="8667186"><a href="/runtime/debug/garbage_test.go.html#8666926">stats</a></span><span class="op" id="8667191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8667194"><a href="/runtime/debug/garbage_test.go.html#8666813">runtime</a></span><span class="op" id="8667201">.</span><span class="ident" id="8667202">GC</span><span class="op" id="8667204">(</span><span class="op" id="8667205">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8667209">//&nbsp;Assume&nbsp;these&nbsp;will&nbsp;return&nbsp;same&nbsp;data:&nbsp;no&nbsp;GC&nbsp;during&nbsp;ReadGCStats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8667275"><a href="/runtime/debug/garbage.go.html#6016100">ReadGCStats</a></span><span class="op" id="8667286">(</span><span class="op" id="8667287">&amp;</span><span class="ident" id="8667288"><a href="/runtime/debug/garbage_test.go.html#8666926">stats</a></span><span class="op" id="8667293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8667296"><a href="/runtime/debug/garbage_test.go.html#8666813">runtime</a></span><span class="op" id="8667303">.</span><span class="ident" id="8667304">ReadMemStats</span><span class="op" id="8667316">(</span><span class="op" id="8667317">&amp;</span><span class="ident" id="8667318"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8667324">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8667328">if</span>&nbsp;<span class="ident" id="8667331"><a href="/runtime/debug/garbage_test.go.html#8666926">stats</a></span><span class="op" id="8667336">.</span><span class="ident" id="8667337">NumGC</span>&nbsp;<span class="op" id="8667343">!=</span>&nbsp;<span class="ident" id="8667346">int64</span><span class="op" id="8667351">(</span><span class="ident" id="8667352"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8667358">.</span><span class="ident" id="8667359">NumGC</span><span class="op" id="8667364">)</span>&nbsp;<span class="op" id="8667366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8667370"><a href="/runtime/debug/garbage_test.go.html#8666866">t</a></span><span class="op" id="8667371">.</span><span class="ident" id="8667372">Errorf</span><span class="op" id="8667378">(</span><span class="string" id="8667379">&#34;stats.NumGC&nbsp;=&nbsp;%d,&nbsp;but&nbsp;mstats.NumGC&nbsp;=&nbsp;%d&#34;</span><span class="op" id="8667420">,</span>&nbsp;<span class="ident" id="8667422"><a href="/runtime/debug/garbage_test.go.html#8666926">stats</a></span><span class="op" id="8667427">.</span><span class="ident" id="8667428">NumGC</span><span class="op" id="8667433">,</span>&nbsp;<span class="ident" id="8667435"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8667441">.</span><span class="ident" id="8667442">NumGC</span><span class="op" id="8667447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8667450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8667453">if</span>&nbsp;<span class="ident" id="8667456"><a href="/runtime/debug/garbage_test.go.html#8666926">stats</a></span><span class="op" id="8667461">.</span><span class="ident" id="8667462">PauseTotal</span>&nbsp;<span class="op" id="8667473">!=</span>&nbsp;<span class="ident" id="8667476"><a href="/runtime/debug/garbage_test.go.html#8666835">time</a></span><span class="op" id="8667480">.</span><span class="ident" id="8667481">Duration</span><span class="op" id="8667489">(</span><span class="ident" id="8667490"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8667496">.</span><span class="ident" id="8667497">PauseTotalNs</span><span class="op" id="8667509">)</span>&nbsp;<span class="op" id="8667511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8667515"><a href="/runtime/debug/garbage_test.go.html#8666866">t</a></span><span class="op" id="8667516">.</span><span class="ident" id="8667517">Errorf</span><span class="op" id="8667523">(</span><span class="string" id="8667524">&#34;stats.PauseTotal&nbsp;=&nbsp;%d,&nbsp;but&nbsp;mstats.PauseTotalNs&nbsp;=&nbsp;%d&#34;</span><span class="op" id="8667577">,</span>&nbsp;<span class="ident" id="8667579"><a href="/runtime/debug/garbage_test.go.html#8666926">stats</a></span><span class="op" id="8667584">.</span><span class="ident" id="8667585">PauseTotal</span><span class="op" id="8667595">,</span>&nbsp;<span class="ident" id="8667597"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8667603">.</span><span class="ident" id="8667604">PauseTotalNs</span><span class="op" id="8667616">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8667619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8667622">if</span>&nbsp;<span class="ident" id="8667625"><a href="/runtime/debug/garbage_test.go.html#8666926">stats</a></span><span class="op" id="8667630">.</span><span class="ident" id="8667631">LastGC</span><span class="op" id="8667637">.</span><span class="ident" id="8667638">UnixNano</span><span class="op" id="8667646">(</span><span class="op" id="8667647">)</span>&nbsp;<span class="op" id="8667649">!=</span>&nbsp;<span class="ident" id="8667652">int64</span><span class="op" id="8667657">(</span><span class="ident" id="8667658"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8667664">.</span><span class="ident" id="8667665">LastGC</span><span class="op" id="8667671">)</span>&nbsp;<span class="op" id="8667673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8667677"><a href="/runtime/debug/garbage_test.go.html#8666866">t</a></span><span class="op" id="8667678">.</span><span class="ident" id="8667679">Errorf</span><span class="op" id="8667685">(</span><span class="string" id="8667686">&#34;stats.LastGC.UnixNano&nbsp;=&nbsp;%d,&nbsp;but&nbsp;mstats.LastGC&nbsp;=&nbsp;%d&#34;</span><span class="op" id="8667738">,</span>&nbsp;<span class="ident" id="8667740"><a href="/runtime/debug/garbage_test.go.html#8666926">stats</a></span><span class="op" id="8667745">.</span><span class="ident" id="8667746">LastGC</span><span class="op" id="8667752">.</span><span class="ident" id="8667753">UnixNano</span><span class="op" id="8667761">(</span><span class="op" id="8667762">)</span><span class="op" id="8667763">,</span>&nbsp;<span class="ident" id="8667765"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8667771">.</span><span class="ident" id="8667772">LastGC</span><span class="op" id="8667778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8667781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8667784">n</span>&nbsp;<span class="op" id="8667786">:=</span>&nbsp;<span class="builtintype" id="8667789">int</span><span class="op" id="8667792">(</span><span class="ident" id="8667793"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8667799">.</span><span class="ident" id="8667800">NumGC</span><span class="op" id="8667805">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8667808">if</span>&nbsp;<span class="ident" id="8667811"><a href="/runtime/debug/garbage_test.go.html#8667784">n</a></span>&nbsp;<span class="op" id="8667813">&gt;</span>&nbsp;<span class="builtinfunc" id="8667815">len</span><span class="op" id="8667818">(</span><span class="ident" id="8667819"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8667825">.</span><span class="ident" id="8667826">PauseNs</span><span class="op" id="8667833">)</span>&nbsp;<span class="op" id="8667835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8667839"><a href="/runtime/debug/garbage_test.go.html#8667784">n</a></span>&nbsp;<span class="op" id="8667841">=</span>&nbsp;<span class="builtinfunc" id="8667843">len</span><span class="op" id="8667846">(</span><span class="ident" id="8667847"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8667853">.</span><span class="ident" id="8667854">PauseNs</span><span class="op" id="8667861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8667864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8667867">if</span>&nbsp;<span class="builtinfunc" id="8667870">len</span><span class="op" id="8667873">(</span><span class="ident" id="8667874"><a href="/runtime/debug/garbage_test.go.html#8666926">stats</a></span><span class="op" id="8667879">.</span><span class="ident" id="8667880">Pause</span><span class="op" id="8667885">)</span>&nbsp;<span class="op" id="8667887">!=</span>&nbsp;<span class="ident" id="8667890"><a href="/runtime/debug/garbage_test.go.html#8667784">n</a></span>&nbsp;<span class="op" id="8667892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8667896"><a href="/runtime/debug/garbage_test.go.html#8666866">t</a></span><span class="op" id="8667897">.</span><span class="ident" id="8667898">Errorf</span><span class="op" id="8667904">(</span><span class="string" id="8667905">&#34;len(stats.Pause)&nbsp;=&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8667937">,</span>&nbsp;<span class="builtinfunc" id="8667939">len</span><span class="op" id="8667942">(</span><span class="ident" id="8667943"><a href="/runtime/debug/garbage_test.go.html#8666926">stats</a></span><span class="op" id="8667948">.</span><span class="ident" id="8667949">Pause</span><span class="op" id="8667954">)</span><span class="op" id="8667955">,</span>&nbsp;<span class="ident" id="8667957"><a href="/runtime/debug/garbage_test.go.html#8667784">n</a></span><span class="op" id="8667958">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8667961">}</span>&nbsp;<span class="keyword" id="8667963">else</span>&nbsp;<span class="op" id="8667968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8667972">off</span>&nbsp;<span class="op" id="8667976">:=</span>&nbsp;<span class="op" id="8667979">(</span><span class="builtintype" id="8667980">int</span><span class="op" id="8667983">(</span><span class="ident" id="8667984"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8667990">.</span><span class="ident" id="8667991">NumGC</span><span class="op" id="8667996">)</span>&nbsp;<span class="op" id="8667998">+</span>&nbsp;<span class="builtinfunc" id="8668000">len</span><span class="op" id="8668003">(</span><span class="ident" id="8668004"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8668010">.</span><span class="ident" id="8668011">PauseNs</span><span class="op" id="8668018">)</span>&nbsp;<span class="op" id="8668020">-</span>&nbsp;<span class="num" id="8668022">1</span><span class="op" id="8668023">)</span>&nbsp;<span class="op" id="8668025">%</span>&nbsp;<span class="builtinfunc" id="8668027">len</span><span class="op" id="8668030">(</span><span class="ident" id="8668031"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8668037">.</span><span class="ident" id="8668038">PauseNs</span><span class="op" id="8668045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8668049">for</span>&nbsp;<span class="ident" id="8668053">i</span>&nbsp;<span class="op" id="8668055">:=</span>&nbsp;<span class="num" id="8668058">0</span><span class="op" id="8668059">;</span>&nbsp;<span class="ident" id="8668061"><a href="/runtime/debug/garbage_test.go.html#8668053">i</a></span>&nbsp;<span class="op" id="8668063">&lt;</span>&nbsp;<span class="ident" id="8668065"><a href="/runtime/debug/garbage_test.go.html#8667784">n</a></span><span class="op" id="8668066">;</span>&nbsp;<span class="ident" id="8668068"><a href="/runtime/debug/garbage_test.go.html#8668053">i</a></span><span class="op" id="8668069">++</span>&nbsp;<span class="op" id="8668072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8668077">dt</span>&nbsp;<span class="op" id="8668080">:=</span>&nbsp;<span class="ident" id="8668083"><a href="/runtime/debug/garbage_test.go.html#8666926">stats</a></span><span class="op" id="8668088">.</span><span class="ident" id="8668089">Pause</span><span class="op" id="8668094">[</span><span class="ident" id="8668095"><a href="/runtime/debug/garbage_test.go.html#8668053">i</a></span><span class="op" id="8668096">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8668101">if</span>&nbsp;<span class="ident" id="8668104"><a href="/runtime/debug/garbage_test.go.html#8668077">dt</a></span>&nbsp;<span class="op" id="8668107">!=</span>&nbsp;<span class="ident" id="8668110"><a href="/runtime/debug/garbage_test.go.html#8666835">time</a></span><span class="op" id="8668114">.</span><span class="ident" id="8668115">Duration</span><span class="op" id="8668123">(</span><span class="ident" id="8668124"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8668130">.</span><span class="ident" id="8668131">PauseNs</span><span class="op" id="8668138">[</span><span class="ident" id="8668139"><a href="/runtime/debug/garbage_test.go.html#8667972">off</a></span><span class="op" id="8668142">]</span><span class="op" id="8668143">)</span>&nbsp;<span class="op" id="8668145">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8668151"><a href="/runtime/debug/garbage_test.go.html#8666866">t</a></span><span class="op" id="8668152">.</span><span class="ident" id="8668153">Errorf</span><span class="op" id="8668159">(</span><span class="string" id="8668160">&#34;stats.Pause[%d]&nbsp;=&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8668191">,</span>&nbsp;<span class="ident" id="8668193"><a href="/runtime/debug/garbage_test.go.html#8668053">i</a></span><span class="op" id="8668194">,</span>&nbsp;<span class="ident" id="8668196"><a href="/runtime/debug/garbage_test.go.html#8668077">dt</a></span><span class="op" id="8668198">,</span>&nbsp;<span class="ident" id="8668200"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8668206">.</span><span class="ident" id="8668207">PauseNs</span><span class="op" id="8668214">[</span><span class="ident" id="8668215"><a href="/runtime/debug/garbage_test.go.html#8667972">off</a></span><span class="op" id="8668218">]</span><span class="op" id="8668219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8668224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8668229">if</span>&nbsp;<span class="ident" id="8668232"><a href="/runtime/debug/garbage_test.go.html#8666979">max</a></span>&nbsp;<span class="op" id="8668236">&lt;</span>&nbsp;<span class="ident" id="8668238"><a href="/runtime/debug/garbage_test.go.html#8668077">dt</a></span>&nbsp;<span class="op" id="8668241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8668247"><a href="/runtime/debug/garbage_test.go.html#8666979">max</a></span>&nbsp;<span class="op" id="8668251">=</span>&nbsp;<span class="ident" id="8668253"><a href="/runtime/debug/garbage_test.go.html#8668077">dt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8668259">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8668264">if</span>&nbsp;<span class="ident" id="8668267"><a href="/runtime/debug/garbage_test.go.html#8666974">min</a></span>&nbsp;<span class="op" id="8668271">&gt;</span>&nbsp;<span class="ident" id="8668273"><a href="/runtime/debug/garbage_test.go.html#8668077">dt</a></span>&nbsp;<span class="op" id="8668276">||</span>&nbsp;<span class="ident" id="8668279"><a href="/runtime/debug/garbage_test.go.html#8668053">i</a></span>&nbsp;<span class="op" id="8668281">==</span>&nbsp;<span class="num" id="8668284">0</span>&nbsp;<span class="op" id="8668286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8668292"><a href="/runtime/debug/garbage_test.go.html#8666974">min</a></span>&nbsp;<span class="op" id="8668296">=</span>&nbsp;<span class="ident" id="8668298"><a href="/runtime/debug/garbage_test.go.html#8668077">dt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8668304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8668309"><a href="/runtime/debug/garbage_test.go.html#8667972">off</a></span>&nbsp;<span class="op" id="8668313">=</span>&nbsp;<span class="op" id="8668315">(</span><span class="ident" id="8668316"><a href="/runtime/debug/garbage_test.go.html#8667972">off</a></span>&nbsp;<span class="op" id="8668320">+</span>&nbsp;<span class="builtinfunc" id="8668322">len</span><span class="op" id="8668325">(</span><span class="ident" id="8668326"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8668332">.</span><span class="ident" id="8668333">PauseNs</span><span class="op" id="8668340">)</span>&nbsp;<span class="op" id="8668342">-</span>&nbsp;<span class="num" id="8668344">1</span><span class="op" id="8668345">)</span>&nbsp;<span class="op" id="8668347">%</span>&nbsp;<span class="builtinfunc" id="8668349">len</span><span class="op" id="8668352">(</span><span class="ident" id="8668353"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8668359">.</span><span class="ident" id="8668360">PauseNs</span><span class="op" id="8668367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8668371">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8668374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8668378">q</span>&nbsp;<span class="op" id="8668380">:=</span>&nbsp;<span class="ident" id="8668383"><a href="/runtime/debug/garbage_test.go.html#8666926">stats</a></span><span class="op" id="8668388">.</span><span class="ident" id="8668389">PauseQuantiles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8668405">nq</span>&nbsp;<span class="op" id="8668408">:=</span>&nbsp;<span class="builtinfunc" id="8668411">len</span><span class="op" id="8668414">(</span><span class="ident" id="8668415"><a href="/runtime/debug/garbage_test.go.html#8668378">q</a></span><span class="op" id="8668416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8668419">if</span>&nbsp;<span class="ident" id="8668422"><a href="/runtime/debug/garbage_test.go.html#8668378">q</a></span><span class="op" id="8668423">[</span><span class="num" id="8668424">0</span><span class="op" id="8668425">]</span>&nbsp;<span class="op" id="8668427">!=</span>&nbsp;<span class="ident" id="8668430"><a href="/runtime/debug/garbage_test.go.html#8666974">min</a></span>&nbsp;<span class="op" id="8668434">||</span>&nbsp;<span class="ident" id="8668437"><a href="/runtime/debug/garbage_test.go.html#8668378">q</a></span><span class="op" id="8668438">[</span><span class="ident" id="8668439"><a href="/runtime/debug/garbage_test.go.html#8668405">nq</a></span><span class="op" id="8668441">-</span><span class="num" id="8668442">1</span><span class="op" id="8668443">]</span>&nbsp;<span class="op" id="8668445">!=</span>&nbsp;<span class="ident" id="8668448"><a href="/runtime/debug/garbage_test.go.html#8666979">max</a></span>&nbsp;<span class="op" id="8668452">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8668456"><a href="/runtime/debug/garbage_test.go.html#8666866">t</a></span><span class="op" id="8668457">.</span><span class="ident" id="8668458">Errorf</span><span class="op" id="8668464">(</span><span class="string" id="8668465">&#34;stats.PauseQuantiles&nbsp;=&nbsp;[%d,&nbsp;...,&nbsp;%d],&nbsp;want&nbsp;[%d,&nbsp;...,&nbsp;%d]&#34;</span><span class="op" id="8668523">,</span>&nbsp;<span class="ident" id="8668525"><a href="/runtime/debug/garbage_test.go.html#8668378">q</a></span><span class="op" id="8668526">[</span><span class="num" id="8668527">0</span><span class="op" id="8668528">]</span><span class="op" id="8668529">,</span>&nbsp;<span class="ident" id="8668531"><a href="/runtime/debug/garbage_test.go.html#8668378">q</a></span><span class="op" id="8668532">[</span><span class="ident" id="8668533"><a href="/runtime/debug/garbage_test.go.html#8668405">nq</a></span><span class="op" id="8668535">-</span><span class="num" id="8668536">1</span><span class="op" id="8668537">]</span><span class="op" id="8668538">,</span>&nbsp;<span class="ident" id="8668540"><a href="/runtime/debug/garbage_test.go.html#8666974">min</a></span><span class="op" id="8668543">,</span>&nbsp;<span class="ident" id="8668545"><a href="/runtime/debug/garbage_test.go.html#8666979">max</a></span><span class="op" id="8668548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8668551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8668555">for</span>&nbsp;<span class="ident" id="8668559">i</span>&nbsp;<span class="op" id="8668561">:=</span>&nbsp;<span class="num" id="8668564">0</span><span class="op" id="8668565">;</span>&nbsp;<span class="ident" id="8668567"><a href="/runtime/debug/garbage_test.go.html#8668559">i</a></span>&nbsp;<span class="op" id="8668569">&lt;</span>&nbsp;<span class="ident" id="8668571"><a href="/runtime/debug/garbage_test.go.html#8668405">nq</a></span><span class="op" id="8668573">-</span><span class="num" id="8668574">1</span><span class="op" id="8668575">;</span>&nbsp;<span class="ident" id="8668577"><a href="/runtime/debug/garbage_test.go.html#8668559">i</a></span><span class="op" id="8668578">++</span>&nbsp;<span class="op" id="8668581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8668585">if</span>&nbsp;<span class="ident" id="8668588"><a href="/runtime/debug/garbage_test.go.html#8668378">q</a></span><span class="op" id="8668589">[</span><span class="ident" id="8668590"><a href="/runtime/debug/garbage_test.go.html#8668559">i</a></span><span class="op" id="8668591">]</span>&nbsp;<span class="op" id="8668593">&gt;</span>&nbsp;<span class="ident" id="8668595"><a href="/runtime/debug/garbage_test.go.html#8668378">q</a></span><span class="op" id="8668596">[</span><span class="ident" id="8668597"><a href="/runtime/debug/garbage_test.go.html#8668559">i</a></span><span class="op" id="8668598">+</span><span class="num" id="8668599">1</span><span class="op" id="8668600">]</span>&nbsp;<span class="op" id="8668602">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8668607"><a href="/runtime/debug/garbage_test.go.html#8666866">t</a></span><span class="op" id="8668608">.</span><span class="ident" id="8668609">Errorf</span><span class="op" id="8668615">(</span><span class="string" id="8668616">&#34;stats.PauseQuantiles[%d]=%d&nbsp;&gt;&nbsp;stats.PauseQuantiles[%d]=%d&#34;</span><span class="op" id="8668675">,</span>&nbsp;<span class="ident" id="8668677"><a href="/runtime/debug/garbage_test.go.html#8668559">i</a></span><span class="op" id="8668678">,</span>&nbsp;<span class="ident" id="8668680"><a href="/runtime/debug/garbage_test.go.html#8668378">q</a></span><span class="op" id="8668681">[</span><span class="ident" id="8668682"><a href="/runtime/debug/garbage_test.go.html#8668559">i</a></span><span class="op" id="8668683">]</span><span class="op" id="8668684">,</span>&nbsp;<span class="ident" id="8668686"><a href="/runtime/debug/garbage_test.go.html#8668559">i</a></span><span class="op" id="8668687">+</span><span class="num" id="8668688">1</span><span class="op" id="8668689">,</span>&nbsp;<span class="ident" id="8668691"><a href="/runtime/debug/garbage_test.go.html#8668378">q</a></span><span class="op" id="8668692">[</span><span class="ident" id="8668693"><a href="/runtime/debug/garbage_test.go.html#8668559">i</a></span><span class="op" id="8668694">+</span><span class="num" id="8668695">1</span><span class="op" id="8668696">]</span><span class="op" id="8668697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8668701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8668704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8668708">//&nbsp;compare&nbsp;memory&nbsp;stats&nbsp;with&nbsp;gc&nbsp;stats:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8668748">if</span>&nbsp;<span class="builtinfunc" id="8668751">len</span><span class="op" id="8668754">(</span><span class="ident" id="8668755"><a href="/runtime/debug/garbage_test.go.html#8666926">stats</a></span><span class="op" id="8668760">.</span><span class="ident" id="8668761">PauseEnd</span><span class="op" id="8668769">)</span>&nbsp;<span class="op" id="8668771">!=</span>&nbsp;<span class="ident" id="8668774"><a href="/runtime/debug/garbage_test.go.html#8667784">n</a></span>&nbsp;<span class="op" id="8668776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8668780"><a href="/runtime/debug/garbage_test.go.html#8666866">t</a></span><span class="op" id="8668781">.</span><span class="ident" id="8668782">Fatalf</span><span class="op" id="8668788">(</span><span class="string" id="8668789">&#34;len(stats.PauseEnd)&nbsp;=&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8668824">,</span>&nbsp;<span class="builtinfunc" id="8668826">len</span><span class="op" id="8668829">(</span><span class="ident" id="8668830"><a href="/runtime/debug/garbage_test.go.html#8666926">stats</a></span><span class="op" id="8668835">.</span><span class="ident" id="8668836">PauseEnd</span><span class="op" id="8668844">)</span><span class="op" id="8668845">,</span>&nbsp;<span class="ident" id="8668847"><a href="/runtime/debug/garbage_test.go.html#8667784">n</a></span><span class="op" id="8668848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8668851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8668854">off</span>&nbsp;<span class="op" id="8668858">:=</span>&nbsp;<span class="op" id="8668861">(</span><span class="builtintype" id="8668862">int</span><span class="op" id="8668865">(</span><span class="ident" id="8668866"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8668872">.</span><span class="ident" id="8668873">NumGC</span><span class="op" id="8668878">)</span>&nbsp;<span class="op" id="8668880">+</span>&nbsp;<span class="builtinfunc" id="8668882">len</span><span class="op" id="8668885">(</span><span class="ident" id="8668886"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8668892">.</span><span class="ident" id="8668893">PauseEnd</span><span class="op" id="8668901">)</span>&nbsp;<span class="op" id="8668903">-</span>&nbsp;<span class="num" id="8668905">1</span><span class="op" id="8668906">)</span>&nbsp;<span class="op" id="8668908">%</span>&nbsp;<span class="builtinfunc" id="8668910">len</span><span class="op" id="8668913">(</span><span class="ident" id="8668914"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8668920">.</span><span class="ident" id="8668921">PauseEnd</span><span class="op" id="8668929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8668932">for</span>&nbsp;<span class="ident" id="8668936">i</span>&nbsp;<span class="op" id="8668938">:=</span>&nbsp;<span class="num" id="8668941">0</span><span class="op" id="8668942">;</span>&nbsp;<span class="ident" id="8668944"><a href="/runtime/debug/garbage_test.go.html#8668936">i</a></span>&nbsp;<span class="op" id="8668946">&lt;</span>&nbsp;<span class="ident" id="8668948"><a href="/runtime/debug/garbage_test.go.html#8667784">n</a></span><span class="op" id="8668949">;</span>&nbsp;<span class="ident" id="8668951"><a href="/runtime/debug/garbage_test.go.html#8668936">i</a></span><span class="op" id="8668952">++</span>&nbsp;<span class="op" id="8668955">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8668959">dt</span>&nbsp;<span class="op" id="8668962">:=</span>&nbsp;<span class="ident" id="8668965"><a href="/runtime/debug/garbage_test.go.html#8666926">stats</a></span><span class="op" id="8668970">.</span><span class="ident" id="8668971">PauseEnd</span><span class="op" id="8668979">[</span><span class="ident" id="8668980"><a href="/runtime/debug/garbage_test.go.html#8668936">i</a></span><span class="op" id="8668981">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8668985">if</span>&nbsp;<span class="ident" id="8668988"><a href="/runtime/debug/garbage_test.go.html#8668959">dt</a></span><span class="op" id="8668990">.</span><span class="ident" id="8668991">UnixNano</span><span class="op" id="8668999">(</span><span class="op" id="8669000">)</span>&nbsp;<span class="op" id="8669002">!=</span>&nbsp;<span class="ident" id="8669005">int64</span><span class="op" id="8669010">(</span><span class="ident" id="8669011"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8669017">.</span><span class="ident" id="8669018">PauseEnd</span><span class="op" id="8669026">[</span><span class="ident" id="8669027"><a href="/runtime/debug/garbage_test.go.html#8668854">off</a></span><span class="op" id="8669030">]</span><span class="op" id="8669031">)</span>&nbsp;<span class="op" id="8669033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8669038"><a href="/runtime/debug/garbage_test.go.html#8666866">t</a></span><span class="op" id="8669039">.</span><span class="ident" id="8669040">Errorf</span><span class="op" id="8669046">(</span><span class="string" id="8669047">&#34;stats.PauseEnd[%d]&nbsp;=&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8669081">,</span>&nbsp;<span class="ident" id="8669083"><a href="/runtime/debug/garbage_test.go.html#8668936">i</a></span><span class="op" id="8669084">,</span>&nbsp;<span class="ident" id="8669086"><a href="/runtime/debug/garbage_test.go.html#8668959">dt</a></span><span class="op" id="8669088">,</span>&nbsp;<span class="ident" id="8669090"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8669096">.</span><span class="ident" id="8669097">PauseEnd</span><span class="op" id="8669105">[</span><span class="ident" id="8669106"><a href="/runtime/debug/garbage_test.go.html#8668854">off</a></span><span class="op" id="8669109">]</span><span class="op" id="8669110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8669114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8669118"><a href="/runtime/debug/garbage_test.go.html#8668854">off</a></span>&nbsp;<span class="op" id="8669122">=</span>&nbsp;<span class="op" id="8669124">(</span><span class="ident" id="8669125"><a href="/runtime/debug/garbage_test.go.html#8668854">off</a></span>&nbsp;<span class="op" id="8669129">+</span>&nbsp;<span class="builtinfunc" id="8669131">len</span><span class="op" id="8669134">(</span><span class="ident" id="8669135"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8669141">.</span><span class="ident" id="8669142">PauseEnd</span><span class="op" id="8669150">)</span>&nbsp;<span class="op" id="8669152">-</span>&nbsp;<span class="num" id="8669154">1</span><span class="op" id="8669155">)</span>&nbsp;<span class="op" id="8669157">%</span>&nbsp;<span class="builtinfunc" id="8669159">len</span><span class="op" id="8669162">(</span><span class="ident" id="8669163"><a href="/runtime/debug/garbage_test.go.html#8666945">mstats</a></span><span class="op" id="8669169">.</span><span class="ident" id="8669170">PauseEnd</span><span class="op" id="8669178">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8669181">}</span><br>
<span class="lineno"></span><span class="op" id="8669183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8669186">var</span>&nbsp;<span class="ident" id="8669190">big</span>&nbsp;<span class="op" id="8669194">=</span>&nbsp;<span class="builtinfunc" id="8669196">make</span><span class="op" id="8669200">(</span><span class="op" id="8669201">[</span><span class="op" id="8669202">]</span><span class="builtintype" id="8669203">byte</span><span class="op" id="8669207">,</span>&nbsp;<span class="num" id="8669209">1</span><span class="op" id="8669210">&lt;&lt;</span><span class="num" id="8669212">20</span><span class="op" id="8669214">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="8669217">func</span>&nbsp;<span class="ident" id="8669222">TestFreeOSMemory</span><span class="op" id="8669238">(</span><span class="ident" id="8669239">t</span>&nbsp;<span class="op" id="8669241">*</span><span class="ident" id="8669242"><a href="/runtime/debug/garbage_test.go.html#8666824">testing</a></span><span class="op" id="8669249">.</span><span class="ident" id="8669250">T</span><span class="op" id="8669251">)</span>&nbsp;<span class="op" id="8669253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8669256">var</span>&nbsp;<span class="ident" id="8669260">ms1</span><span class="op" id="8669263">,</span>&nbsp;<span class="ident" id="8669265">ms2</span>&nbsp;<span class="ident" id="8669269"><a href="/runtime/debug/garbage_test.go.html#8666813">runtime</a></span><span class="op" id="8669276">.</span><span class="ident" id="8669277">MemStats</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8669288">if</span>&nbsp;<span class="ident" id="8669291"><a href="/runtime/debug/garbage_test.go.html#8669190">big</a></span>&nbsp;<span class="op" id="8669295">==</span>&nbsp;<span class="ident" id="8669298">nil</span>&nbsp;<span class="op" id="8669302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8669306"><a href="/runtime/debug/garbage_test.go.html#8669239">t</a></span><span class="op" id="8669307">.</span><span class="ident" id="8669308">Skip</span><span class="op" id="8669312">(</span><span class="string" id="8669313">&#34;test&nbsp;is&nbsp;not&nbsp;reliable&nbsp;when&nbsp;run&nbsp;multiple&nbsp;times&#34;</span><span class="op" id="8669359">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8669362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8669365"><a href="/runtime/debug/garbage_test.go.html#8669190">big</a></span>&nbsp;<span class="op" id="8669369">=</span>&nbsp;<span class="ident" id="8669371">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8669376"><a href="/runtime/debug/garbage_test.go.html#8666813">runtime</a></span><span class="op" id="8669383">.</span><span class="ident" id="8669384">GC</span><span class="op" id="8669386">(</span><span class="op" id="8669387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8669390"><a href="/runtime/debug/garbage_test.go.html#8666813">runtime</a></span><span class="op" id="8669397">.</span><span class="ident" id="8669398">ReadMemStats</span><span class="op" id="8669410">(</span><span class="op" id="8669411">&amp;</span><span class="ident" id="8669412"><a href="/runtime/debug/garbage_test.go.html#8669260">ms1</a></span><span class="op" id="8669415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8669418"><a href="/runtime/debug/garbage.go.html#6018959">FreeOSMemory</a></span><span class="op" id="8669430">(</span><span class="op" id="8669431">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8669434"><a href="/runtime/debug/garbage_test.go.html#8666813">runtime</a></span><span class="op" id="8669441">.</span><span class="ident" id="8669442">ReadMemStats</span><span class="op" id="8669454">(</span><span class="op" id="8669455">&amp;</span><span class="ident" id="8669456"><a href="/runtime/debug/garbage_test.go.html#8669265">ms2</a></span><span class="op" id="8669459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8669462">if</span>&nbsp;<span class="ident" id="8669465"><a href="/runtime/debug/garbage_test.go.html#8669260">ms1</a></span><span class="op" id="8669468">.</span><span class="ident" id="8669469">HeapReleased</span>&nbsp;<span class="op" id="8669482">&gt;=</span>&nbsp;<span class="ident" id="8669485"><a href="/runtime/debug/garbage_test.go.html#8669265">ms2</a></span><span class="op" id="8669488">.</span><span class="ident" id="8669489">HeapReleased</span>&nbsp;<span class="op" id="8669502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8669506"><a href="/runtime/debug/garbage_test.go.html#8669239">t</a></span><span class="op" id="8669507">.</span><span class="ident" id="8669508">Errorf</span><span class="op" id="8669514">(</span><span class="string" id="8669515">&#34;released&nbsp;before=%d;&nbsp;released&nbsp;after=%d;&nbsp;did&nbsp;not&nbsp;go&nbsp;up&#34;</span><span class="op" id="8669569">,</span>&nbsp;<span class="ident" id="8669571"><a href="/runtime/debug/garbage_test.go.html#8669260">ms1</a></span><span class="op" id="8669574">.</span><span class="ident" id="8669575">HeapReleased</span><span class="op" id="8669587">,</span>&nbsp;<span class="ident" id="8669589"><a href="/runtime/debug/garbage_test.go.html#8669265">ms2</a></span><span class="op" id="8669592">.</span><span class="ident" id="8669593">HeapReleased</span><span class="op" id="8669605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8669608">}</span><br>
<span class="lineno"></span><span class="op" id="8669610">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="8669613">func</span>&nbsp;<span class="ident" id="8669618">TestSetGCPercent</span><span class="op" id="8669634">(</span><span class="ident" id="8669635">t</span>&nbsp;<span class="op" id="8669637">*</span><span class="ident" id="8669638"><a href="/runtime/debug/garbage_test.go.html#8666824">testing</a></span><span class="op" id="8669645">.</span><span class="ident" id="8669646">T</span><span class="op" id="8669647">)</span>&nbsp;<span class="op" id="8669649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8669652">//&nbsp;Test&nbsp;that&nbsp;the&nbsp;variable&nbsp;is&nbsp;being&nbsp;set&nbsp;and&nbsp;returned&nbsp;correctly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8669716">//&nbsp;Assume&nbsp;the&nbsp;percentage&nbsp;itself&nbsp;is&nbsp;implemented&nbsp;fine&nbsp;during&nbsp;GC,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8669780">//&nbsp;which&nbsp;is&nbsp;harder&nbsp;to&nbsp;test.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8669809">old</span>&nbsp;<span class="op" id="8669813">:=</span>&nbsp;<span class="ident" id="8669816"><a href="/runtime/debug/garbage.go.html#6018600">SetGCPercent</a></span><span class="op" id="8669828">(</span><span class="num" id="8669829">123</span><span class="op" id="8669832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8669835">new</span>&nbsp;<span class="op" id="8669839">:=</span>&nbsp;<span class="ident" id="8669842"><a href="/runtime/debug/garbage.go.html#6018600">SetGCPercent</a></span><span class="op" id="8669854">(</span><span class="ident" id="8669855"><a href="/runtime/debug/garbage_test.go.html#8669809">old</a></span><span class="op" id="8669858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8669861">if</span>&nbsp;<span class="builtinfunc" id="8669864"><a href="/runtime/debug/garbage_test.go.html#8669835">new</a></span>&nbsp;<span class="op" id="8669868">!=</span>&nbsp;<span class="num" id="8669871">123</span>&nbsp;<span class="op" id="8669875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8669879"><a href="/runtime/debug/garbage_test.go.html#8669635">t</a></span><span class="op" id="8669880">.</span><span class="ident" id="8669881">Errorf</span><span class="op" id="8669887">(</span><span class="string" id="8669888">&#34;SetGCPercent(123);&nbsp;SetGCPercent(x)&nbsp;=&nbsp;%d,&nbsp;want&nbsp;123&#34;</span><span class="op" id="8669939">,</span>&nbsp;<span class="builtinfunc" id="8669941"><a href="/runtime/debug/garbage_test.go.html#8669835">new</a></span><span class="op" id="8669944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8669947">}</span><br>
<span class="lineno">115</span><span class="op" id="8669949">}</span>
</div>
</body>
</html>
