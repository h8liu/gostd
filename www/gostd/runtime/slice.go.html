<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html" class="current">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1883097">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1883152">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1883206">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1883257">package</span>&nbsp;<span class="ident" id="1883265">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1883274">import</span>&nbsp;<span class="op" id="1883281">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1883284">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1883293">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1883296">type</span>&nbsp;<span class="ident" id="1883301">sliceStruct</span>&nbsp;<span class="keyword" id="1883313">struct</span>&nbsp;<span class="op" id="1883320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1883323">array</span>&nbsp;<span class="ident" id="1883329">unsafe</span><span class="op" id="1883335">.</span><span class="ident" id="1883336">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1883345">len</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1883351">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1883356">cap</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1883362">int</span><br>
<span class="lineno">15</span><span class="op" id="1883366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1883369">//&nbsp;TODO:&nbsp;take&nbsp;uintptrs&nbsp;instead&nbsp;of&nbsp;int64s?</span><br>
<span class="lineno"></span><span class="keyword" id="1883411">func</span>&nbsp;<span class="ident" id="1883416">makeslice</span><span class="op" id="1883425">(</span><span class="ident" id="1883426">t</span>&nbsp;<span class="op" id="1883428">*</span><span class="ident" id="1883429">slicetype</span><span class="op" id="1883438">,</span>&nbsp;<span class="ident" id="1883440">len64</span>&nbsp;<span class="ident" id="1883446">int64</span><span class="op" id="1883451">,</span>&nbsp;<span class="ident" id="1883453">cap64</span>&nbsp;<span class="ident" id="1883459">int64</span><span class="op" id="1883464">)</span>&nbsp;<span class="ident" id="1883466">sliceStruct</span>&nbsp;<span class="op" id="1883478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1883481">//&nbsp;NOTE:&nbsp;The&nbsp;len&nbsp;&gt;&nbsp;MaxMem/elemsize&nbsp;check&nbsp;here&nbsp;is&nbsp;not&nbsp;strictly&nbsp;necessary,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1883555">//&nbsp;but&nbsp;it&nbsp;produces&nbsp;a&nbsp;&#39;len&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;error&nbsp;instead&nbsp;of&nbsp;a&nbsp;&#39;cap&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1883640">//&nbsp;when&nbsp;someone&nbsp;does&nbsp;make([]T,&nbsp;bignumber).&nbsp;&#39;cap&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;is&nbsp;true&nbsp;too,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1883716">//&nbsp;but&nbsp;since&nbsp;the&nbsp;cap&nbsp;is&nbsp;only&nbsp;being&nbsp;supplied&nbsp;implicitly,&nbsp;saying&nbsp;len&nbsp;is&nbsp;clearer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1883796">//&nbsp;See&nbsp;issue&nbsp;4085.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1883816">len</span>&nbsp;<span class="op" id="1883820">:=</span>&nbsp;<span class="builtintype" id="1883823">int</span><span class="op" id="1883826">(</span><span class="ident" id="1883827">len64</span><span class="op" id="1883832">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1883835">if</span>&nbsp;<span class="ident" id="1883838">len64</span>&nbsp;<span class="op" id="1883844">&lt;</span>&nbsp;<span class="num" id="1883846">0</span>&nbsp;<span class="op" id="1883848">||</span>&nbsp;<span class="ident" id="1883851">int64</span><span class="op" id="1883856">(</span><span class="builtinfunc" id="1883857">len</span><span class="op" id="1883860">)</span>&nbsp;<span class="op" id="1883862">!=</span>&nbsp;<span class="ident" id="1883865">len64</span>&nbsp;<span class="op" id="1883871">||</span>&nbsp;<span class="ident" id="1883874">t</span><span class="op" id="1883875">.</span><span class="ident" id="1883876">elem</span><span class="op" id="1883880">.</span><span class="ident" id="1883881">size</span>&nbsp;<span class="op" id="1883886">&gt;</span>&nbsp;<span class="num" id="1883888">0</span>&nbsp;<span class="op" id="1883890">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1883893">uintptr</span><span class="op" id="1883900">(</span><span class="builtinfunc" id="1883901">len</span><span class="op" id="1883904">)</span>&nbsp;<span class="op" id="1883906">&gt;</span>&nbsp;<span class="ident" id="1883908">maxmem</span><span class="op" id="1883914">/</span><span class="builtintype" id="1883915">uintptr</span><span class="op" id="1883922">(</span><span class="ident" id="1883923">t</span><span class="op" id="1883924">.</span><span class="ident" id="1883925">elem</span><span class="op" id="1883929">.</span><span class="ident" id="1883930">size</span><span class="op" id="1883934">)</span>&nbsp;<span class="op" id="1883936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1883940">panic</span><span class="op" id="1883945">(</span><span class="ident" id="1883946">errorString</span><span class="op" id="1883957">(</span><span class="string" id="1883958">&#34;makeslice:&nbsp;len&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1883987">)</span><span class="op" id="1883988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1883991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1883994">cap</span>&nbsp;<span class="op" id="1883998">:=</span>&nbsp;<span class="builtintype" id="1884001">int</span><span class="op" id="1884004">(</span><span class="ident" id="1884005">cap64</span><span class="op" id="1884010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1884013">if</span>&nbsp;<span class="builtinfunc" id="1884016">cap</span>&nbsp;<span class="op" id="1884020">&lt;</span>&nbsp;<span class="builtinfunc" id="1884022">len</span>&nbsp;<span class="op" id="1884026">||</span>&nbsp;<span class="ident" id="1884029">int64</span><span class="op" id="1884034">(</span><span class="builtinfunc" id="1884035">cap</span><span class="op" id="1884038">)</span>&nbsp;<span class="op" id="1884040">!=</span>&nbsp;<span class="ident" id="1884043">cap64</span>&nbsp;<span class="op" id="1884049">||</span>&nbsp;<span class="ident" id="1884052">t</span><span class="op" id="1884053">.</span><span class="ident" id="1884054">elem</span><span class="op" id="1884058">.</span><span class="ident" id="1884059">size</span>&nbsp;<span class="op" id="1884064">&gt;</span>&nbsp;<span class="num" id="1884066">0</span>&nbsp;<span class="op" id="1884068">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1884071">uintptr</span><span class="op" id="1884078">(</span><span class="builtinfunc" id="1884079">cap</span><span class="op" id="1884082">)</span>&nbsp;<span class="op" id="1884084">&gt;</span>&nbsp;<span class="ident" id="1884086">maxmem</span><span class="op" id="1884092">/</span><span class="builtintype" id="1884093">uintptr</span><span class="op" id="1884100">(</span><span class="ident" id="1884101">t</span><span class="op" id="1884102">.</span><span class="ident" id="1884103">elem</span><span class="op" id="1884107">.</span><span class="ident" id="1884108">size</span><span class="op" id="1884112">)</span>&nbsp;<span class="op" id="1884114">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1884118">panic</span><span class="op" id="1884123">(</span><span class="ident" id="1884124">errorString</span><span class="op" id="1884135">(</span><span class="string" id="1884136">&#34;makeslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1884165">)</span><span class="op" id="1884166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1884169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1884172">p</span>&nbsp;<span class="op" id="1884174">:=</span>&nbsp;<span class="ident" id="1884177">newarray</span><span class="op" id="1884185">(</span><span class="ident" id="1884186">t</span><span class="op" id="1884187">.</span><span class="ident" id="1884188">elem</span><span class="op" id="1884192">,</span>&nbsp;<span class="builtintype" id="1884194">uintptr</span><span class="op" id="1884201">(</span><span class="builtinfunc" id="1884202">cap</span><span class="op" id="1884205">)</span><span class="op" id="1884206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1884209">return</span>&nbsp;<span class="ident" id="1884216">sliceStruct</span><span class="op" id="1884227">{</span><span class="ident" id="1884228">p</span><span class="op" id="1884229">,</span>&nbsp;<span class="builtinfunc" id="1884231">len</span><span class="op" id="1884234">,</span>&nbsp;<span class="builtinfunc" id="1884236">cap</span><span class="op" id="1884239">}</span><br>
<span class="lineno"></span><span class="op" id="1884241">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1884244">//&nbsp;TODO:&nbsp;take&nbsp;uintptr&nbsp;instead&nbsp;of&nbsp;int64?</span><br>
<span class="lineno"></span><span class="keyword" id="1884284">func</span>&nbsp;<span class="ident" id="1884289">growslice</span><span class="op" id="1884298">(</span><span class="ident" id="1884299">t</span>&nbsp;<span class="op" id="1884301">*</span><span class="ident" id="1884302">slicetype</span><span class="op" id="1884311">,</span>&nbsp;<span class="ident" id="1884313">old</span>&nbsp;<span class="ident" id="1884317">sliceStruct</span><span class="op" id="1884328">,</span>&nbsp;<span class="ident" id="1884330">n</span>&nbsp;<span class="ident" id="1884332">int64</span><span class="op" id="1884337">)</span>&nbsp;<span class="ident" id="1884339">sliceStruct</span>&nbsp;<span class="op" id="1884351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1884354">if</span>&nbsp;<span class="ident" id="1884357">n</span>&nbsp;<span class="op" id="1884359">&lt;</span>&nbsp;<span class="num" id="1884361">1</span>&nbsp;<span class="op" id="1884363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1884367">panic</span><span class="op" id="1884372">(</span><span class="ident" id="1884373">errorString</span><span class="op" id="1884384">(</span><span class="string" id="1884385">&#34;growslice:&nbsp;invalid&nbsp;n&#34;</span><span class="op" id="1884407">)</span><span class="op" id="1884408">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1884411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1884415">cap64</span>&nbsp;<span class="op" id="1884421">:=</span>&nbsp;<span class="ident" id="1884424">int64</span><span class="op" id="1884429">(</span><span class="ident" id="1884430">old</span><span class="op" id="1884433">.</span><span class="builtinfunc" id="1884434">cap</span><span class="op" id="1884437">)</span>&nbsp;<span class="op" id="1884439">+</span>&nbsp;<span class="ident" id="1884441">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1884444">cap</span>&nbsp;<span class="op" id="1884448">:=</span>&nbsp;<span class="builtintype" id="1884451">int</span><span class="op" id="1884454">(</span><span class="ident" id="1884455">cap64</span><span class="op" id="1884460">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1884464">if</span>&nbsp;<span class="ident" id="1884467">int64</span><span class="op" id="1884472">(</span><span class="builtinfunc" id="1884473">cap</span><span class="op" id="1884476">)</span>&nbsp;<span class="op" id="1884478">!=</span>&nbsp;<span class="ident" id="1884481">cap64</span>&nbsp;<span class="op" id="1884487">||</span>&nbsp;<span class="builtinfunc" id="1884490">cap</span>&nbsp;<span class="op" id="1884494">&lt;</span>&nbsp;<span class="ident" id="1884496">old</span><span class="op" id="1884499">.</span><span class="builtinfunc" id="1884500">cap</span>&nbsp;<span class="op" id="1884504">||</span>&nbsp;<span class="ident" id="1884507">t</span><span class="op" id="1884508">.</span><span class="ident" id="1884509">elem</span><span class="op" id="1884513">.</span><span class="ident" id="1884514">size</span>&nbsp;<span class="op" id="1884519">&gt;</span>&nbsp;<span class="num" id="1884521">0</span>&nbsp;<span class="op" id="1884523">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1884526">uintptr</span><span class="op" id="1884533">(</span><span class="builtinfunc" id="1884534">cap</span><span class="op" id="1884537">)</span>&nbsp;<span class="op" id="1884539">&gt;</span>&nbsp;<span class="ident" id="1884541">maxmem</span><span class="op" id="1884547">/</span><span class="builtintype" id="1884548">uintptr</span><span class="op" id="1884555">(</span><span class="ident" id="1884556">t</span><span class="op" id="1884557">.</span><span class="ident" id="1884558">elem</span><span class="op" id="1884562">.</span><span class="ident" id="1884563">size</span><span class="op" id="1884567">)</span>&nbsp;<span class="op" id="1884569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1884573">panic</span><span class="op" id="1884578">(</span><span class="ident" id="1884579">errorString</span><span class="op" id="1884590">(</span><span class="string" id="1884591">&#34;growslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1884620">)</span><span class="op" id="1884621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1884624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1884628">if</span>&nbsp;<span class="ident" id="1884631">raceenabled</span>&nbsp;<span class="op" id="1884643">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1884647">callerpc</span>&nbsp;<span class="op" id="1884656">:=</span>&nbsp;<span class="ident" id="1884659">getcallerpc</span><span class="op" id="1884670">(</span><span class="ident" id="1884671">unsafe</span><span class="op" id="1884677">.</span><span class="ident" id="1884678">Pointer</span><span class="op" id="1884685">(</span><span class="op" id="1884686">&amp;</span><span class="ident" id="1884687">t</span><span class="op" id="1884688">)</span><span class="op" id="1884689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1884693">racereadrangepc</span><span class="op" id="1884708">(</span><span class="ident" id="1884709">old</span><span class="op" id="1884712">.</span><span class="ident" id="1884713">array</span><span class="op" id="1884718">,</span>&nbsp;<span class="builtintype" id="1884720">uintptr</span><span class="op" id="1884727">(</span><span class="ident" id="1884728">old</span><span class="op" id="1884731">.</span><span class="builtinfunc" id="1884732">len</span><span class="op" id="1884735">*</span><span class="builtintype" id="1884736">int</span><span class="op" id="1884739">(</span><span class="ident" id="1884740">t</span><span class="op" id="1884741">.</span><span class="ident" id="1884742">elem</span><span class="op" id="1884746">.</span><span class="ident" id="1884747">size</span><span class="op" id="1884751">)</span><span class="op" id="1884752">)</span><span class="op" id="1884753">,</span>&nbsp;<span class="ident" id="1884755">callerpc</span><span class="op" id="1884763">,</span>&nbsp;<span class="ident" id="1884765">funcPC</span><span class="op" id="1884771">(</span><span class="ident" id="1884772">growslice</span><span class="op" id="1884781">)</span><span class="op" id="1884782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1884785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1884789">et</span>&nbsp;<span class="op" id="1884792">:=</span>&nbsp;<span class="ident" id="1884795">t</span><span class="op" id="1884796">.</span><span class="ident" id="1884797">elem</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1884803">if</span>&nbsp;<span class="ident" id="1884806">et</span><span class="op" id="1884808">.</span><span class="ident" id="1884809">size</span>&nbsp;<span class="op" id="1884814">==</span>&nbsp;<span class="num" id="1884817">0</span>&nbsp;<span class="op" id="1884819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1884823">return</span>&nbsp;<span class="ident" id="1884830">sliceStruct</span><span class="op" id="1884841">{</span><span class="ident" id="1884842">old</span><span class="op" id="1884845">.</span><span class="ident" id="1884846">array</span><span class="op" id="1884851">,</span>&nbsp;<span class="ident" id="1884853">old</span><span class="op" id="1884856">.</span><span class="builtinfunc" id="1884857">len</span><span class="op" id="1884860">,</span>&nbsp;<span class="builtinfunc" id="1884862">cap</span><span class="op" id="1884865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1884868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1884872">newcap</span>&nbsp;<span class="op" id="1884879">:=</span>&nbsp;<span class="ident" id="1884882">old</span><span class="op" id="1884885">.</span><span class="builtinfunc" id="1884886">cap</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1884891">if</span>&nbsp;<span class="ident" id="1884894">newcap</span><span class="op" id="1884900">+</span><span class="ident" id="1884901">newcap</span>&nbsp;<span class="op" id="1884908">&lt;</span>&nbsp;<span class="builtinfunc" id="1884910">cap</span>&nbsp;<span class="op" id="1884914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1884918">newcap</span>&nbsp;<span class="op" id="1884925">=</span>&nbsp;<span class="builtinfunc" id="1884927">cap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1884932">}</span>&nbsp;<span class="keyword" id="1884934">else</span>&nbsp;<span class="op" id="1884939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1884943">for</span>&nbsp;<span class="op" id="1884947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1884952">if</span>&nbsp;<span class="ident" id="1884955">old</span><span class="op" id="1884958">.</span><span class="builtinfunc" id="1884959">len</span>&nbsp;<span class="op" id="1884963">&lt;</span>&nbsp;<span class="num" id="1884965">1024</span>&nbsp;<span class="op" id="1884970">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1884976">newcap</span>&nbsp;<span class="op" id="1884983">+=</span>&nbsp;<span class="ident" id="1884986">newcap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1884996">}</span>&nbsp;<span class="keyword" id="1884998">else</span>&nbsp;<span class="op" id="1885003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1885009">newcap</span>&nbsp;<span class="op" id="1885016">+=</span>&nbsp;<span class="ident" id="1885019">newcap</span>&nbsp;<span class="op" id="1885026">/</span>&nbsp;<span class="num" id="1885028">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1885033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1885038">if</span>&nbsp;<span class="ident" id="1885041">newcap</span>&nbsp;<span class="op" id="1885048">&gt;=</span>&nbsp;<span class="builtinfunc" id="1885051">cap</span>&nbsp;<span class="op" id="1885055">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1885061">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1885070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1885074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1885077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1885081">if</span>&nbsp;<span class="builtintype" id="1885084">uintptr</span><span class="op" id="1885091">(</span><span class="ident" id="1885092">newcap</span><span class="op" id="1885098">)</span>&nbsp;<span class="op" id="1885100">&gt;=</span>&nbsp;<span class="ident" id="1885103">maxmem</span><span class="op" id="1885109">/</span><span class="builtintype" id="1885110">uintptr</span><span class="op" id="1885117">(</span><span class="ident" id="1885118">et</span><span class="op" id="1885120">.</span><span class="ident" id="1885121">size</span><span class="op" id="1885125">)</span>&nbsp;<span class="op" id="1885127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1885131">panic</span><span class="op" id="1885136">(</span><span class="ident" id="1885137">errorString</span><span class="op" id="1885148">(</span><span class="string" id="1885149">&#34;growslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1885178">)</span><span class="op" id="1885179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1885182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1885185">lenmem</span>&nbsp;<span class="op" id="1885192">:=</span>&nbsp;<span class="builtintype" id="1885195">uintptr</span><span class="op" id="1885202">(</span><span class="ident" id="1885203">old</span><span class="op" id="1885206">.</span><span class="builtinfunc" id="1885207">len</span><span class="op" id="1885210">)</span>&nbsp;<span class="op" id="1885212">*</span>&nbsp;<span class="builtintype" id="1885214">uintptr</span><span class="op" id="1885221">(</span><span class="ident" id="1885222">et</span><span class="op" id="1885224">.</span><span class="ident" id="1885225">size</span><span class="op" id="1885229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1885232">capmem</span>&nbsp;<span class="op" id="1885239">:=</span>&nbsp;<span class="ident" id="1885242">goroundupsize</span><span class="op" id="1885255">(</span><span class="builtintype" id="1885256">uintptr</span><span class="op" id="1885263">(</span><span class="ident" id="1885264">newcap</span><span class="op" id="1885270">)</span>&nbsp;<span class="op" id="1885272">*</span>&nbsp;<span class="builtintype" id="1885274">uintptr</span><span class="op" id="1885281">(</span><span class="ident" id="1885282">et</span><span class="op" id="1885284">.</span><span class="ident" id="1885285">size</span><span class="op" id="1885289">)</span><span class="op" id="1885290">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1885293">newcap</span>&nbsp;<span class="op" id="1885300">=</span>&nbsp;<span class="builtintype" id="1885302">int</span><span class="op" id="1885305">(</span><span class="ident" id="1885306">capmem</span>&nbsp;<span class="op" id="1885313">/</span>&nbsp;<span class="builtintype" id="1885315">uintptr</span><span class="op" id="1885322">(</span><span class="ident" id="1885323">et</span><span class="op" id="1885325">.</span><span class="ident" id="1885326">size</span><span class="op" id="1885330">)</span><span class="op" id="1885331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1885334">var</span>&nbsp;<span class="ident" id="1885338">p</span>&nbsp;<span class="ident" id="1885340">unsafe</span><span class="op" id="1885346">.</span><span class="ident" id="1885347">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1885356">if</span>&nbsp;<span class="ident" id="1885359">et</span><span class="op" id="1885361">.</span><span class="ident" id="1885362">kind</span><span class="op" id="1885366">&amp;</span><span class="ident" id="1885367">kindNoPointers</span>&nbsp;<span class="op" id="1885382">!=</span>&nbsp;<span class="num" id="1885385">0</span>&nbsp;<span class="op" id="1885387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1885391">p</span>&nbsp;<span class="op" id="1885393">=</span>&nbsp;<span class="ident" id="1885395">rawmem</span><span class="op" id="1885401">(</span><span class="ident" id="1885402">capmem</span><span class="op" id="1885408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1885412">memclr</span><span class="op" id="1885418">(</span><span class="ident" id="1885419">add</span><span class="op" id="1885422">(</span><span class="ident" id="1885423">p</span><span class="op" id="1885424">,</span>&nbsp;<span class="ident" id="1885426">lenmem</span><span class="op" id="1885432">)</span><span class="op" id="1885433">,</span>&nbsp;<span class="ident" id="1885435">capmem</span><span class="op" id="1885441">-</span><span class="ident" id="1885442">lenmem</span><span class="op" id="1885448">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1885451">}</span>&nbsp;<span class="keyword" id="1885453">else</span>&nbsp;<span class="op" id="1885458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1885462">//&nbsp;Note:&nbsp;can&#39;t&nbsp;use&nbsp;rawmem&nbsp;(which&nbsp;avoids&nbsp;zeroing&nbsp;of&nbsp;memory),&nbsp;because&nbsp;then&nbsp;GC&nbsp;can&nbsp;scan&nbsp;unitialized&nbsp;memory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1885568">p</span>&nbsp;<span class="op" id="1885570">=</span>&nbsp;<span class="ident" id="1885572">newarray</span><span class="op" id="1885580">(</span><span class="ident" id="1885581">et</span><span class="op" id="1885583">,</span>&nbsp;<span class="builtintype" id="1885585">uintptr</span><span class="op" id="1885592">(</span><span class="ident" id="1885593">newcap</span><span class="op" id="1885599">)</span><span class="op" id="1885600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1885603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1885606">memmove</span><span class="op" id="1885613">(</span><span class="ident" id="1885614">p</span><span class="op" id="1885615">,</span>&nbsp;<span class="ident" id="1885617">old</span><span class="op" id="1885620">.</span><span class="ident" id="1885621">array</span><span class="op" id="1885626">,</span>&nbsp;<span class="ident" id="1885628">lenmem</span><span class="op" id="1885634">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1885638">return</span>&nbsp;<span class="ident" id="1885645">sliceStruct</span><span class="op" id="1885656">{</span><span class="ident" id="1885657">p</span><span class="op" id="1885658">,</span>&nbsp;<span class="ident" id="1885660">old</span><span class="op" id="1885663">.</span><span class="builtinfunc" id="1885664">len</span><span class="op" id="1885667">,</span>&nbsp;<span class="ident" id="1885669">newcap</span><span class="op" id="1885675">}</span><br>
<span class="lineno"></span><span class="op" id="1885677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1885680">func</span>&nbsp;<span class="ident" id="1885685">slicecopy</span><span class="op" id="1885694">(</span><span class="ident" id="1885695">to</span>&nbsp;<span class="ident" id="1885698">sliceStruct</span><span class="op" id="1885709">,</span>&nbsp;<span class="ident" id="1885711">fm</span>&nbsp;<span class="ident" id="1885714">sliceStruct</span><span class="op" id="1885725">,</span>&nbsp;<span class="ident" id="1885727">width</span>&nbsp;<span class="builtintype" id="1885733">uintptr</span><span class="op" id="1885740">)</span>&nbsp;<span class="builtintype" id="1885742">int</span>&nbsp;<span class="op" id="1885746">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1885749">if</span>&nbsp;<span class="ident" id="1885752">fm</span><span class="op" id="1885754">.</span><span class="builtinfunc" id="1885755">len</span>&nbsp;<span class="op" id="1885759">==</span>&nbsp;<span class="num" id="1885762">0</span>&nbsp;<span class="op" id="1885764">||</span>&nbsp;<span class="ident" id="1885767">to</span><span class="op" id="1885769">.</span><span class="builtinfunc" id="1885770">len</span>&nbsp;<span class="op" id="1885774">==</span>&nbsp;<span class="num" id="1885777">0</span>&nbsp;<span class="op" id="1885779">||</span>&nbsp;<span class="ident" id="1885782">width</span>&nbsp;<span class="op" id="1885788">==</span>&nbsp;<span class="num" id="1885791">0</span>&nbsp;<span class="op" id="1885793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1885797">return</span>&nbsp;<span class="num" id="1885804">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1885807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1885811">n</span>&nbsp;<span class="op" id="1885813">:=</span>&nbsp;<span class="ident" id="1885816">fm</span><span class="op" id="1885818">.</span><span class="builtinfunc" id="1885819">len</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1885824">if</span>&nbsp;<span class="ident" id="1885827">to</span><span class="op" id="1885829">.</span><span class="builtinfunc" id="1885830">len</span>&nbsp;<span class="op" id="1885834">&lt;</span>&nbsp;<span class="ident" id="1885836">n</span>&nbsp;<span class="op" id="1885838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1885842">n</span>&nbsp;<span class="op" id="1885844">=</span>&nbsp;<span class="ident" id="1885846">to</span><span class="op" id="1885848">.</span><span class="builtinfunc" id="1885849">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1885854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1885858">if</span>&nbsp;<span class="ident" id="1885861">raceenabled</span>&nbsp;<span class="op" id="1885873">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1885877">callerpc</span>&nbsp;<span class="op" id="1885886">:=</span>&nbsp;<span class="ident" id="1885889">getcallerpc</span><span class="op" id="1885900">(</span><span class="ident" id="1885901">unsafe</span><span class="op" id="1885907">.</span><span class="ident" id="1885908">Pointer</span><span class="op" id="1885915">(</span><span class="op" id="1885916">&amp;</span><span class="ident" id="1885917">to</span><span class="op" id="1885919">)</span><span class="op" id="1885920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1885924">pc</span>&nbsp;<span class="op" id="1885927">:=</span>&nbsp;<span class="ident" id="1885930">funcPC</span><span class="op" id="1885936">(</span><span class="ident" id="1885937">slicecopy</span><span class="op" id="1885946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1885950">racewriterangepc</span><span class="op" id="1885966">(</span><span class="ident" id="1885967">to</span><span class="op" id="1885969">.</span><span class="ident" id="1885970">array</span><span class="op" id="1885975">,</span>&nbsp;<span class="builtintype" id="1885977">uintptr</span><span class="op" id="1885984">(</span><span class="ident" id="1885985">n</span><span class="op" id="1885986">*</span><span class="builtintype" id="1885987">int</span><span class="op" id="1885990">(</span><span class="ident" id="1885991">width</span><span class="op" id="1885996">)</span><span class="op" id="1885997">)</span><span class="op" id="1885998">,</span>&nbsp;<span class="ident" id="1886000">callerpc</span><span class="op" id="1886008">,</span>&nbsp;<span class="ident" id="1886010">pc</span><span class="op" id="1886012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1886016">racereadrangepc</span><span class="op" id="1886031">(</span><span class="ident" id="1886032">fm</span><span class="op" id="1886034">.</span><span class="ident" id="1886035">array</span><span class="op" id="1886040">,</span>&nbsp;<span class="builtintype" id="1886042">uintptr</span><span class="op" id="1886049">(</span><span class="ident" id="1886050">n</span><span class="op" id="1886051">*</span><span class="builtintype" id="1886052">int</span><span class="op" id="1886055">(</span><span class="ident" id="1886056">width</span><span class="op" id="1886061">)</span><span class="op" id="1886062">)</span><span class="op" id="1886063">,</span>&nbsp;<span class="ident" id="1886065">callerpc</span><span class="op" id="1886073">,</span>&nbsp;<span class="ident" id="1886075">pc</span><span class="op" id="1886077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1886080">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1886084">size</span>&nbsp;<span class="op" id="1886089">:=</span>&nbsp;<span class="builtintype" id="1886092">uintptr</span><span class="op" id="1886099">(</span><span class="ident" id="1886100">n</span><span class="op" id="1886101">)</span>&nbsp;<span class="op" id="1886103">*</span>&nbsp;<span class="ident" id="1886105">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1886112">if</span>&nbsp;<span class="ident" id="1886115">size</span>&nbsp;<span class="op" id="1886120">==</span>&nbsp;<span class="num" id="1886123">1</span>&nbsp;<span class="op" id="1886125">{</span>&nbsp;<span class="comment" id="1886127">//&nbsp;common&nbsp;case&nbsp;worth&nbsp;about&nbsp;2x&nbsp;to&nbsp;do&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1886170">//&nbsp;TODO:&nbsp;is&nbsp;this&nbsp;still&nbsp;worth&nbsp;it&nbsp;with&nbsp;new&nbsp;memmove&nbsp;impl?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1886227">*</span><span class="op" id="1886228">(</span><span class="op" id="1886229">*</span><span class="builtintype" id="1886230">byte</span><span class="op" id="1886234">)</span><span class="op" id="1886235">(</span><span class="ident" id="1886236">to</span><span class="op" id="1886238">.</span><span class="ident" id="1886239">array</span><span class="op" id="1886244">)</span>&nbsp;<span class="op" id="1886246">=</span>&nbsp;<span class="op" id="1886248">*</span><span class="op" id="1886249">(</span><span class="op" id="1886250">*</span><span class="builtintype" id="1886251">byte</span><span class="op" id="1886255">)</span><span class="op" id="1886256">(</span><span class="ident" id="1886257">fm</span><span class="op" id="1886259">.</span><span class="ident" id="1886260">array</span><span class="op" id="1886265">)</span>&nbsp;<span class="comment" id="1886267">//&nbsp;known&nbsp;to&nbsp;be&nbsp;a&nbsp;byte&nbsp;pointer</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1886298">}</span>&nbsp;<span class="keyword" id="1886300">else</span>&nbsp;<span class="op" id="1886305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1886309">memmove</span><span class="op" id="1886316">(</span><span class="ident" id="1886317">to</span><span class="op" id="1886319">.</span><span class="ident" id="1886320">array</span><span class="op" id="1886325">,</span>&nbsp;<span class="ident" id="1886327">fm</span><span class="op" id="1886329">.</span><span class="ident" id="1886330">array</span><span class="op" id="1886335">,</span>&nbsp;<span class="ident" id="1886337">size</span><span class="op" id="1886341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1886344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1886347">return</span>&nbsp;<span class="builtintype" id="1886354">int</span><span class="op" id="1886357">(</span><span class="ident" id="1886358">n</span><span class="op" id="1886359">)</span><br>
<span class="lineno"></span><span class="op" id="1886361">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="1886364">func</span>&nbsp;<span class="ident" id="1886369">slicestringcopy</span><span class="op" id="1886384">(</span><span class="ident" id="1886385">to</span>&nbsp;<span class="op" id="1886388">[</span><span class="op" id="1886389">]</span><span class="builtintype" id="1886390">byte</span><span class="op" id="1886394">,</span>&nbsp;<span class="ident" id="1886396">fm</span>&nbsp;<span class="builtintype" id="1886399">string</span><span class="op" id="1886405">)</span>&nbsp;<span class="builtintype" id="1886407">int</span>&nbsp;<span class="op" id="1886411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1886414">if</span>&nbsp;<span class="builtinfunc" id="1886417">len</span><span class="op" id="1886420">(</span><span class="ident" id="1886421">fm</span><span class="op" id="1886423">)</span>&nbsp;<span class="op" id="1886425">==</span>&nbsp;<span class="num" id="1886428">0</span>&nbsp;<span class="op" id="1886430">||</span>&nbsp;<span class="builtinfunc" id="1886433">len</span><span class="op" id="1886436">(</span><span class="ident" id="1886437">to</span><span class="op" id="1886439">)</span>&nbsp;<span class="op" id="1886441">==</span>&nbsp;<span class="num" id="1886444">0</span>&nbsp;<span class="op" id="1886446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1886450">return</span>&nbsp;<span class="num" id="1886457">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1886460">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1886464">n</span>&nbsp;<span class="op" id="1886466">:=</span>&nbsp;<span class="builtinfunc" id="1886469">len</span><span class="op" id="1886472">(</span><span class="ident" id="1886473">fm</span><span class="op" id="1886475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1886478">if</span>&nbsp;<span class="builtinfunc" id="1886481">len</span><span class="op" id="1886484">(</span><span class="ident" id="1886485">to</span><span class="op" id="1886487">)</span>&nbsp;<span class="op" id="1886489">&lt;</span>&nbsp;<span class="ident" id="1886491">n</span>&nbsp;<span class="op" id="1886493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1886497">n</span>&nbsp;<span class="op" id="1886499">=</span>&nbsp;<span class="builtinfunc" id="1886501">len</span><span class="op" id="1886504">(</span><span class="ident" id="1886505">to</span><span class="op" id="1886507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1886510">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1886514">if</span>&nbsp;<span class="ident" id="1886517">raceenabled</span>&nbsp;<span class="op" id="1886529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1886533">callerpc</span>&nbsp;<span class="op" id="1886542">:=</span>&nbsp;<span class="ident" id="1886545">getcallerpc</span><span class="op" id="1886556">(</span><span class="ident" id="1886557">unsafe</span><span class="op" id="1886563">.</span><span class="ident" id="1886564">Pointer</span><span class="op" id="1886571">(</span><span class="op" id="1886572">&amp;</span><span class="ident" id="1886573">to</span><span class="op" id="1886575">)</span><span class="op" id="1886576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1886580">pc</span>&nbsp;<span class="op" id="1886583">:=</span>&nbsp;<span class="ident" id="1886586">funcPC</span><span class="op" id="1886592">(</span><span class="ident" id="1886593">slicestringcopy</span><span class="op" id="1886608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1886612">racewriterangepc</span><span class="op" id="1886628">(</span><span class="ident" id="1886629">unsafe</span><span class="op" id="1886635">.</span><span class="ident" id="1886636">Pointer</span><span class="op" id="1886643">(</span><span class="op" id="1886644">&amp;</span><span class="ident" id="1886645">to</span><span class="op" id="1886647">[</span><span class="num" id="1886648">0</span><span class="op" id="1886649">]</span><span class="op" id="1886650">)</span><span class="op" id="1886651">,</span>&nbsp;<span class="builtintype" id="1886653">uintptr</span><span class="op" id="1886660">(</span><span class="ident" id="1886661">n</span><span class="op" id="1886662">)</span><span class="op" id="1886663">,</span>&nbsp;<span class="ident" id="1886665">callerpc</span><span class="op" id="1886673">,</span>&nbsp;<span class="ident" id="1886675">pc</span><span class="op" id="1886677">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1886680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1886684">memmove</span><span class="op" id="1886691">(</span><span class="ident" id="1886692">unsafe</span><span class="op" id="1886698">.</span><span class="ident" id="1886699">Pointer</span><span class="op" id="1886706">(</span><span class="op" id="1886707">&amp;</span><span class="ident" id="1886708">to</span><span class="op" id="1886710">[</span><span class="num" id="1886711">0</span><span class="op" id="1886712">]</span><span class="op" id="1886713">)</span><span class="op" id="1886714">,</span>&nbsp;<span class="ident" id="1886716">unsafe</span><span class="op" id="1886722">.</span><span class="ident" id="1886723">Pointer</span><span class="op" id="1886730">(</span><span class="op" id="1886731">(</span><span class="op" id="1886732">*</span><span class="ident" id="1886733">stringStruct</span><span class="op" id="1886745">)</span><span class="op" id="1886746">(</span><span class="ident" id="1886747">unsafe</span><span class="op" id="1886753">.</span><span class="ident" id="1886754">Pointer</span><span class="op" id="1886761">(</span><span class="op" id="1886762">&amp;</span><span class="ident" id="1886763">fm</span><span class="op" id="1886765">)</span><span class="op" id="1886766">)</span><span class="op" id="1886767">.</span><span class="ident" id="1886768">str</span><span class="op" id="1886771">)</span><span class="op" id="1886772">,</span>&nbsp;<span class="builtintype" id="1886774">uintptr</span><span class="op" id="1886781">(</span><span class="ident" id="1886782">n</span><span class="op" id="1886783">)</span><span class="op" id="1886784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1886787">return</span>&nbsp;<span class="ident" id="1886794">n</span><br>
<span class="lineno"></span><span class="op" id="1886796">}</span>
</div>
</body>
</html>
