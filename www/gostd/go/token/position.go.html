<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2345879">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2345934">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2345988">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2346039">package</span>&nbsp;<span class="ident" id="2346047">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2346054">import</span>&nbsp;<span class="op" id="2346061">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2346064">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2346071">&#34;sort&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2346079">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="2346086">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2346089">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="2346170">//&nbsp;Positions</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2346184">//&nbsp;Position&nbsp;describes&nbsp;an&nbsp;arbitrary&nbsp;source&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="2346235">//&nbsp;including&nbsp;the&nbsp;file,&nbsp;line,&nbsp;and&nbsp;column&nbsp;location.</span><br>
<span class="lineno"></span><span class="comment" id="2346285">//&nbsp;A&nbsp;Position&nbsp;is&nbsp;valid&nbsp;if&nbsp;the&nbsp;line&nbsp;number&nbsp;is&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="2346335">//</span><br>
<span class="lineno">20</span><span class="keyword" id="2346338">type</span>&nbsp;<span class="ident" id="2346343">Position</span>&nbsp;<span class="keyword" id="2346352">struct</span>&nbsp;<span class="op" id="2346359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2346362">Filename</span>&nbsp;<span class="builtintype" id="2346371">string</span>&nbsp;<span class="comment" id="2346378">//&nbsp;filename,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2346399">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2346408">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2346415">//&nbsp;offset,&nbsp;starting&nbsp;at&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2346441">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2346450">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2346457">//&nbsp;line&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2346488">Column</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2346497">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2346504">//&nbsp;column&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1&nbsp;(character&nbsp;count)</span><br>
<span class="lineno">25</span><span class="op" id="2346554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2346557">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="2346607">func</span>&nbsp;<span class="op" id="2346612">(</span><span class="ident" id="2346613">pos</span>&nbsp;<span class="op" id="2346617">*</span><span class="ident" id="2346618">Position</span><span class="op" id="2346626">)</span>&nbsp;<span class="ident" id="2346628">IsValid</span><span class="op" id="2346635">(</span><span class="op" id="2346636">)</span>&nbsp;<span class="builtintype" id="2346638">bool</span>&nbsp;<span class="op" id="2346643">{</span>&nbsp;<span class="keyword" id="2346645">return</span>&nbsp;<span class="ident" id="2346652">pos</span><span class="op" id="2346655">.</span><span class="ident" id="2346656">Line</span>&nbsp;<span class="op" id="2346661">&gt;</span>&nbsp;<span class="num" id="2346663">0</span>&nbsp;<span class="op" id="2346665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2346668">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;several&nbsp;forms:</span><br>
<span class="lineno"></span><span class="comment" id="2346720">//</span><br>
<span class="lineno"></span><span class="comment" id="2346723">//&nbsp;&nbsp;&nbsp;&nbspfile:line:column&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="2346776">//&nbsp;&nbsp;&nbsp;&nbspline:column&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="2346832">//&nbsp;&nbsp;&nbsp;&nbspfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="2346887">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="2346945">//</span><br>
<span class="lineno"></span><span class="keyword" id="2346948">func</span>&nbsp;<span class="op" id="2346953">(</span><span class="ident" id="2346954">pos</span>&nbsp;<span class="ident" id="2346958">Position</span><span class="op" id="2346966">)</span>&nbsp;<span class="ident" id="2346968">String</span><span class="op" id="2346974">(</span><span class="op" id="2346975">)</span>&nbsp;<span class="builtintype" id="2346977">string</span>&nbsp;<span class="op" id="2346984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2346987">s</span>&nbsp;<span class="op" id="2346989">:=</span>&nbsp;<span class="ident" id="2346992">pos</span><span class="op" id="2346995">.</span><span class="ident" id="2346996">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2347006">if</span>&nbsp;<span class="ident" id="2347009">pos</span><span class="op" id="2347012">.</span><span class="ident" id="2347013">IsValid</span><span class="op" id="2347020">(</span><span class="op" id="2347021">)</span>&nbsp;<span class="op" id="2347023">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2347027">if</span>&nbsp;<span class="ident" id="2347030">s</span>&nbsp;<span class="op" id="2347032">!=</span>&nbsp;<span class="string" id="2347035">&#34;&#34;</span>&nbsp;<span class="op" id="2347038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2347043">s</span>&nbsp;<span class="op" id="2347045">+=</span>&nbsp;<span class="string" id="2347048">&#34;:&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2347054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2347058">s</span>&nbsp;<span class="op" id="2347060">+=</span>&nbsp;<span class="ident" id="2347063">fmt</span><span class="op" id="2347066">.</span><span class="ident" id="2347067">Sprintf</span><span class="op" id="2347074">(</span><span class="string" id="2347075">&#34;%d:%d&#34;</span><span class="op" id="2347082">,</span>&nbsp;<span class="ident" id="2347084">pos</span><span class="op" id="2347087">.</span><span class="ident" id="2347088">Line</span><span class="op" id="2347092">,</span>&nbsp;<span class="ident" id="2347094">pos</span><span class="op" id="2347097">.</span><span class="ident" id="2347098">Column</span><span class="op" id="2347104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2347107">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2347110">if</span>&nbsp;<span class="ident" id="2347113">s</span>&nbsp;<span class="op" id="2347115">==</span>&nbsp;<span class="string" id="2347118">&#34;&#34;</span>&nbsp;<span class="op" id="2347121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2347125">s</span>&nbsp;<span class="op" id="2347127">=</span>&nbsp;<span class="string" id="2347129">&#34;-&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2347134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2347137">return</span>&nbsp;<span class="ident" id="2347144">s</span><br>
<span class="lineno"></span><span class="op" id="2347146">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="2347149">//&nbsp;Pos&nbsp;is&nbsp;a&nbsp;compact&nbsp;encoding&nbsp;of&nbsp;a&nbsp;source&nbsp;position&nbsp;within&nbsp;a&nbsp;file&nbsp;set.</span><br>
<span class="lineno"></span><span class="comment" id="2347218">//&nbsp;It&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;Position&nbsp;for&nbsp;a&nbsp;more&nbsp;convenient,&nbsp;but&nbsp;much</span><br>
<span class="lineno"></span><span class="comment" id="2347289">//&nbsp;larger,&nbsp;representation.</span><br>
<span class="lineno"></span><span class="comment" id="2347316">//</span><br>
<span class="lineno">55</span><span class="comment" id="2347319">//&nbsp;The&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;a&nbsp;number&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size],</span><br>
<span class="lineno"></span><span class="comment" id="2347397">//&nbsp;where&nbsp;base&nbsp;and&nbsp;size&nbsp;are&nbsp;specified&nbsp;when&nbsp;adding&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="2347475">//&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="comment" id="2347487">//</span><br>
<span class="lineno"></span><span class="comment" id="2347490">//&nbsp;To&nbsp;create&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;specific&nbsp;source&nbsp;offset,&nbsp;first&nbsp;add</span><br>
<span class="lineno">60</span><span class="comment" id="2347557">//&nbsp;the&nbsp;respective&nbsp;file&nbsp;to&nbsp;the&nbsp;current&nbsp;file&nbsp;set&nbsp;(via&nbsp;FileSet.AddFile)</span><br>
<span class="lineno"></span><span class="comment" id="2347626">//&nbsp;and&nbsp;then&nbsp;call&nbsp;File.Pos(offset)&nbsp;for&nbsp;that&nbsp;file.&nbsp;Given&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="2347695">//&nbsp;for&nbsp;a&nbsp;specific&nbsp;file&nbsp;set&nbsp;fset,&nbsp;the&nbsp;corresponding&nbsp;Position&nbsp;value&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2347764">//&nbsp;obtained&nbsp;by&nbsp;calling&nbsp;fset.Position(p).</span><br>
<span class="lineno"></span><span class="comment" id="2347805">//</span><br>
<span class="lineno">65</span><span class="comment" id="2347808">//&nbsp;Pos&nbsp;values&nbsp;can&nbsp;be&nbsp;compared&nbsp;directly&nbsp;with&nbsp;the&nbsp;usual&nbsp;comparison&nbsp;operators:</span><br>
<span class="lineno"></span><span class="comment" id="2347884">//&nbsp;If&nbsp;two&nbsp;Pos&nbsp;values&nbsp;p&nbsp;and&nbsp;q&nbsp;are&nbsp;in&nbsp;the&nbsp;same&nbsp;file,&nbsp;comparing&nbsp;p&nbsp;and&nbsp;q&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2347956">//&nbsp;equivalent&nbsp;to&nbsp;comparing&nbsp;the&nbsp;respective&nbsp;source&nbsp;file&nbsp;offsets.&nbsp;If&nbsp;p&nbsp;and&nbsp;q</span><br>
<span class="lineno"></span><span class="comment" id="2348030">//&nbsp;are&nbsp;in&nbsp;different&nbsp;files,&nbsp;p&nbsp;&lt;&nbsp;q&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;p&nbsp;was&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="2348106">//&nbsp;to&nbsp;the&nbsp;respective&nbsp;file&nbsp;set&nbsp;before&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;q.</span><br>
<span class="lineno">70</span><span class="comment" id="2348166">//</span><br>
<span class="lineno"></span><span class="keyword" id="2348169">type</span>&nbsp;<span class="ident" id="2348174">Pos</span>&nbsp;<span class="builtintype" id="2348178">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2348183">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Pos&nbsp;is&nbsp;NoPos;&nbsp;there&nbsp;is&nbsp;no&nbsp;file&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="2348257">//&nbsp;associated&nbsp;with&nbsp;it,&nbsp;and&nbsp;NoPos().IsValid()&nbsp;is&nbsp;false.&nbsp;NoPos&nbsp;is&nbsp;always</span><br>
<span class="lineno">75</span><span class="comment" id="2348328">//&nbsp;smaller&nbsp;than&nbsp;any&nbsp;other&nbsp;Pos&nbsp;value.&nbsp;The&nbsp;corresponding&nbsp;Position&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="2348398">//&nbsp;for&nbsp;NoPos&nbsp;is&nbsp;the&nbsp;zero&nbsp;value&nbsp;for&nbsp;Position.</span><br>
<span class="lineno"></span><span class="comment" id="2348443">//</span><br>
<span class="lineno"></span><span class="keyword" id="2348446">const</span>&nbsp;<span class="ident" id="2348452">NoPos</span>&nbsp;<span class="ident" id="2348458">Pos</span>&nbsp;<span class="op" id="2348462">=</span>&nbsp;<span class="num" id="2348464">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2348467">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="2348517">func</span>&nbsp;<span class="op" id="2348522">(</span><span class="ident" id="2348523">p</span>&nbsp;<span class="ident" id="2348525">Pos</span><span class="op" id="2348528">)</span>&nbsp;<span class="ident" id="2348530">IsValid</span><span class="op" id="2348537">(</span><span class="op" id="2348538">)</span>&nbsp;<span class="builtintype" id="2348540">bool</span>&nbsp;<span class="op" id="2348545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348548">return</span>&nbsp;<span class="ident" id="2348555">p</span>&nbsp;<span class="op" id="2348557">!=</span>&nbsp;<span class="ident" id="2348560">NoPos</span><br>
<span class="lineno"></span><span class="op" id="2348566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="2348569">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="2348650">//&nbsp;File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2348659">//&nbsp;A&nbsp;File&nbsp;is&nbsp;a&nbsp;handle&nbsp;for&nbsp;a&nbsp;file&nbsp;belonging&nbsp;to&nbsp;a&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="comment" id="2348716">//&nbsp;A&nbsp;File&nbsp;has&nbsp;a&nbsp;name,&nbsp;size,&nbsp;and&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno">90</span><span class="comment" id="2348767">//</span><br>
<span class="lineno"></span><span class="keyword" id="2348770">type</span>&nbsp;<span class="ident" id="2348775">File</span>&nbsp;<span class="keyword" id="2348780">struct</span>&nbsp;<span class="op" id="2348787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2348790">set</span>&nbsp;&nbsp;<span class="op" id="2348795">*</span><span class="ident" id="2348796">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2348805">name</span>&nbsp;<span class="builtintype" id="2348810">string</span>&nbsp;<span class="comment" id="2348817">//&nbsp;file&nbsp;name&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2348854">base</span>&nbsp;<span class="builtintype" id="2348859">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2348866">//&nbsp;Pos&nbsp;value&nbsp;range&nbsp;for&nbsp;this&nbsp;file&nbsp;is&nbsp;[base...base+size]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2348922">size</span>&nbsp;<span class="builtintype" id="2348927">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2348934">//&nbsp;file&nbsp;size&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2348972">//&nbsp;lines&nbsp;and&nbsp;infos&nbsp;are&nbsp;protected&nbsp;by&nbsp;set.mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2349019">lines</span>&nbsp;<span class="op" id="2349025">[</span><span class="op" id="2349026">]</span><span class="builtintype" id="2349027">int</span>&nbsp;<span class="comment" id="2349031">//&nbsp;lines&nbsp;contains&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;for&nbsp;each&nbsp;line&nbsp;(the&nbsp;first&nbsp;entry&nbsp;is&nbsp;always&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2349128">infos</span>&nbsp;<span class="op" id="2349134">[</span><span class="op" id="2349135">]</span><span class="ident" id="2349136">lineInfo</span><br>
<span class="lineno">100</span><span class="op" id="2349145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2349148">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="2349216">func</span>&nbsp;<span class="op" id="2349221">(</span><span class="ident" id="2349222">f</span>&nbsp;<span class="op" id="2349224">*</span><span class="ident" id="2349225">File</span><span class="op" id="2349229">)</span>&nbsp;<span class="ident" id="2349231">Name</span><span class="op" id="2349235">(</span><span class="op" id="2349236">)</span>&nbsp;<span class="builtintype" id="2349238">string</span>&nbsp;<span class="op" id="2349245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349248">return</span>&nbsp;<span class="ident" id="2349255">f</span><span class="op" id="2349256">.</span><span class="ident" id="2349257">name</span><br>
<span class="lineno">105</span><span class="op" id="2349262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2349265">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;base&nbsp;offset&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="2349335">func</span>&nbsp;<span class="op" id="2349340">(</span><span class="ident" id="2349341">f</span>&nbsp;<span class="op" id="2349343">*</span><span class="ident" id="2349344">File</span><span class="op" id="2349348">)</span>&nbsp;<span class="ident" id="2349350">Base</span><span class="op" id="2349354">(</span><span class="op" id="2349355">)</span>&nbsp;<span class="builtintype" id="2349357">int</span>&nbsp;<span class="op" id="2349361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349364">return</span>&nbsp;<span class="ident" id="2349371">f</span><span class="op" id="2349372">.</span><span class="ident" id="2349373">base</span><br>
<span class="lineno">110</span><span class="op" id="2349378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2349381">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="2349444">func</span>&nbsp;<span class="op" id="2349449">(</span><span class="ident" id="2349450">f</span>&nbsp;<span class="op" id="2349452">*</span><span class="ident" id="2349453">File</span><span class="op" id="2349457">)</span>&nbsp;<span class="ident" id="2349459">Size</span><span class="op" id="2349463">(</span><span class="op" id="2349464">)</span>&nbsp;<span class="builtintype" id="2349466">int</span>&nbsp;<span class="op" id="2349470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349473">return</span>&nbsp;<span class="ident" id="2349480">f</span><span class="op" id="2349481">.</span><span class="ident" id="2349482">size</span><br>
<span class="lineno">115</span><span class="op" id="2349487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2349490">//&nbsp;LineCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;lines&nbsp;in&nbsp;file&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="2349542">func</span>&nbsp;<span class="op" id="2349547">(</span><span class="ident" id="2349548">f</span>&nbsp;<span class="op" id="2349550">*</span><span class="ident" id="2349551">File</span><span class="op" id="2349555">)</span>&nbsp;<span class="ident" id="2349557">LineCount</span><span class="op" id="2349566">(</span><span class="op" id="2349567">)</span>&nbsp;<span class="builtintype" id="2349569">int</span>&nbsp;<span class="op" id="2349573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2349576">f</span><span class="op" id="2349577">.</span><span class="ident" id="2349578">set</span><span class="op" id="2349581">.</span><span class="ident" id="2349582">mutex</span><span class="op" id="2349587">.</span><span class="ident" id="2349588">RLock</span><span class="op" id="2349593">(</span><span class="op" id="2349594">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2349597">n</span>&nbsp;<span class="op" id="2349599">:=</span>&nbsp;<span class="builtinfunc" id="2349602">len</span><span class="op" id="2349605">(</span><span class="ident" id="2349606">f</span><span class="op" id="2349607">.</span><span class="ident" id="2349608">lines</span><span class="op" id="2349613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2349616">f</span><span class="op" id="2349617">.</span><span class="ident" id="2349618">set</span><span class="op" id="2349621">.</span><span class="ident" id="2349622">mutex</span><span class="op" id="2349627">.</span><span class="ident" id="2349628">RUnlock</span><span class="op" id="2349635">(</span><span class="op" id="2349636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349639">return</span>&nbsp;<span class="ident" id="2349646">n</span><br>
<span class="lineno"></span><span class="op" id="2349648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="2349651">//&nbsp;AddLine&nbsp;adds&nbsp;the&nbsp;line&nbsp;offset&nbsp;for&nbsp;a&nbsp;new&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="2349699">//&nbsp;The&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="2349771">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;line&nbsp;offset&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="2349844">//</span><br>
<span class="lineno"></span><span class="keyword" id="2349847">func</span>&nbsp;<span class="op" id="2349852">(</span><span class="ident" id="2349853">f</span>&nbsp;<span class="op" id="2349855">*</span><span class="ident" id="2349856">File</span><span class="op" id="2349860">)</span>&nbsp;<span class="ident" id="2349862">AddLine</span><span class="op" id="2349869">(</span><span class="ident" id="2349870">offset</span>&nbsp;<span class="builtintype" id="2349877">int</span><span class="op" id="2349880">)</span>&nbsp;<span class="op" id="2349882">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2349885">f</span><span class="op" id="2349886">.</span><span class="ident" id="2349887">set</span><span class="op" id="2349890">.</span><span class="ident" id="2349891">mutex</span><span class="op" id="2349896">.</span><span class="ident" id="2349897">Lock</span><span class="op" id="2349901">(</span><span class="op" id="2349902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349905">if</span>&nbsp;<span class="ident" id="2349908">i</span>&nbsp;<span class="op" id="2349910">:=</span>&nbsp;<span class="builtinfunc" id="2349913">len</span><span class="op" id="2349916">(</span><span class="ident" id="2349917">f</span><span class="op" id="2349918">.</span><span class="ident" id="2349919">lines</span><span class="op" id="2349924">)</span><span class="op" id="2349925">;</span>&nbsp;<span class="op" id="2349927">(</span><span class="ident" id="2349928">i</span>&nbsp;<span class="op" id="2349930">==</span>&nbsp;<span class="num" id="2349933">0</span>&nbsp;<span class="op" id="2349935">||</span>&nbsp;<span class="ident" id="2349938">f</span><span class="op" id="2349939">.</span><span class="ident" id="2349940">lines</span><span class="op" id="2349945">[</span><span class="ident" id="2349946">i</span><span class="op" id="2349947">-</span><span class="num" id="2349948">1</span><span class="op" id="2349949">]</span>&nbsp;<span class="op" id="2349951">&lt;</span>&nbsp;<span class="ident" id="2349953">offset</span><span class="op" id="2349959">)</span>&nbsp;<span class="op" id="2349961">&amp;&amp;</span>&nbsp;<span class="ident" id="2349964">offset</span>&nbsp;<span class="op" id="2349971">&lt;</span>&nbsp;<span class="ident" id="2349973">f</span><span class="op" id="2349974">.</span><span class="ident" id="2349975">size</span>&nbsp;<span class="op" id="2349980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2349984">f</span><span class="op" id="2349985">.</span><span class="ident" id="2349986">lines</span>&nbsp;<span class="op" id="2349992">=</span>&nbsp;<span class="builtinfunc" id="2349994">append</span><span class="op" id="2350000">(</span><span class="ident" id="2350001">f</span><span class="op" id="2350002">.</span><span class="ident" id="2350003">lines</span><span class="op" id="2350008">,</span>&nbsp;<span class="ident" id="2350010">offset</span><span class="op" id="2350016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2350019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2350022">f</span><span class="op" id="2350023">.</span><span class="ident" id="2350024">set</span><span class="op" id="2350027">.</span><span class="ident" id="2350028">mutex</span><span class="op" id="2350033">.</span><span class="ident" id="2350034">Unlock</span><span class="op" id="2350040">(</span><span class="op" id="2350041">)</span><br>
<span class="lineno">135</span><span class="op" id="2350043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2350046">//&nbsp;MergeLine&nbsp;merges&nbsp;a&nbsp;line&nbsp;with&nbsp;the&nbsp;following&nbsp;line.&nbsp;It&nbsp;is&nbsp;akin&nbsp;to&nbsp;replacing</span><br>
<span class="lineno"></span><span class="comment" id="2350122">//&nbsp;the&nbsp;newline&nbsp;character&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;with&nbsp;a&nbsp;space&nbsp;(to&nbsp;not&nbsp;change&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2350202">//&nbsp;remaining&nbsp;offsets).&nbsp;To&nbsp;obtain&nbsp;the&nbsp;line&nbsp;number,&nbsp;consult&nbsp;e.g.&nbsp;Position.Line.</span><br>
<span class="lineno">140</span><span class="comment" id="2350280">//&nbsp;MergeLine&nbsp;will&nbsp;panic&nbsp;if&nbsp;given&nbsp;an&nbsp;invalid&nbsp;line&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="2350337">//</span><br>
<span class="lineno"></span><span class="keyword" id="2350340">func</span>&nbsp;<span class="op" id="2350345">(</span><span class="ident" id="2350346">f</span>&nbsp;<span class="op" id="2350348">*</span><span class="ident" id="2350349">File</span><span class="op" id="2350353">)</span>&nbsp;<span class="ident" id="2350355">MergeLine</span><span class="op" id="2350364">(</span><span class="ident" id="2350365">line</span>&nbsp;<span class="builtintype" id="2350370">int</span><span class="op" id="2350373">)</span>&nbsp;<span class="op" id="2350375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2350378">if</span>&nbsp;<span class="ident" id="2350381">line</span>&nbsp;<span class="op" id="2350386">&lt;=</span>&nbsp;<span class="num" id="2350389">0</span>&nbsp;<span class="op" id="2350391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2350395">panic</span><span class="op" id="2350400">(</span><span class="string" id="2350401">&#34;illegal&nbsp;line&nbsp;number&nbsp;(line&nbsp;numbering&nbsp;starts&nbsp;at&nbsp;1)&#34;</span><span class="op" id="2350451">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2350454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2350457">f</span><span class="op" id="2350458">.</span><span class="ident" id="2350459">set</span><span class="op" id="2350462">.</span><span class="ident" id="2350463">mutex</span><span class="op" id="2350468">.</span><span class="ident" id="2350469">Lock</span><span class="op" id="2350473">(</span><span class="op" id="2350474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2350477">defer</span>&nbsp;<span class="ident" id="2350483">f</span><span class="op" id="2350484">.</span><span class="ident" id="2350485">set</span><span class="op" id="2350488">.</span><span class="ident" id="2350489">mutex</span><span class="op" id="2350494">.</span><span class="ident" id="2350495">Unlock</span><span class="op" id="2350501">(</span><span class="op" id="2350502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2350505">if</span>&nbsp;<span class="ident" id="2350508">line</span>&nbsp;<span class="op" id="2350513">&gt;=</span>&nbsp;<span class="builtinfunc" id="2350516">len</span><span class="op" id="2350519">(</span><span class="ident" id="2350520">f</span><span class="op" id="2350521">.</span><span class="ident" id="2350522">lines</span><span class="op" id="2350527">)</span>&nbsp;<span class="op" id="2350529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2350533">panic</span><span class="op" id="2350538">(</span><span class="string" id="2350539">&#34;illegal&nbsp;line&nbsp;number&#34;</span><span class="op" id="2350560">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2350563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2350566">//&nbsp;To&nbsp;merge&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line&gt;&nbsp;with&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line+1&gt;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2350637">//&nbsp;we&nbsp;need&nbsp;to&nbsp;remove&nbsp;the&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2350704">//&nbsp;numbered&nbsp;&lt;line+1&gt;.&nbsp;The&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2350772">//&nbsp;numbered&nbsp;&lt;line+1&gt;&nbsp;is&nbsp;located&nbsp;at&nbsp;index&nbsp;&lt;line&gt;,&nbsp;since&nbsp;indices&nbsp;in&nbsp;lines</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2350845">//&nbsp;are&nbsp;0-based&nbsp;and&nbsp;line&nbsp;numbers&nbsp;are&nbsp;1-based.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2350891">copy</span><span class="op" id="2350895">(</span><span class="ident" id="2350896">f</span><span class="op" id="2350897">.</span><span class="ident" id="2350898">lines</span><span class="op" id="2350903">[</span><span class="ident" id="2350904">line</span><span class="op" id="2350908">:</span><span class="op" id="2350909">]</span><span class="op" id="2350910">,</span>&nbsp;<span class="ident" id="2350912">f</span><span class="op" id="2350913">.</span><span class="ident" id="2350914">lines</span><span class="op" id="2350919">[</span><span class="ident" id="2350920">line</span><span class="op" id="2350924">+</span><span class="num" id="2350925">1</span><span class="op" id="2350926">:</span><span class="op" id="2350927">]</span><span class="op" id="2350928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2350931">f</span><span class="op" id="2350932">.</span><span class="ident" id="2350933">lines</span>&nbsp;<span class="op" id="2350939">=</span>&nbsp;<span class="ident" id="2350941">f</span><span class="op" id="2350942">.</span><span class="ident" id="2350943">lines</span><span class="op" id="2350948">[</span><span class="op" id="2350949">:</span><span class="builtinfunc" id="2350950">len</span><span class="op" id="2350953">(</span><span class="ident" id="2350954">f</span><span class="op" id="2350955">.</span><span class="ident" id="2350956">lines</span><span class="op" id="2350961">)</span><span class="op" id="2350962">-</span><span class="num" id="2350963">1</span><span class="op" id="2350964">]</span><br>
<span class="lineno"></span><span class="op" id="2350966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="2350969">//&nbsp;SetLines&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;a&nbsp;file&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;successful.</span><br>
<span class="lineno"></span><span class="comment" id="2351046">//&nbsp;The&nbsp;line&nbsp;offsets&nbsp;are&nbsp;the&nbsp;offsets&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;of&nbsp;each&nbsp;line;</span><br>
<span class="lineno"></span><span class="comment" id="2351119">//&nbsp;for&nbsp;instance&nbsp;for&nbsp;the&nbsp;content&nbsp;&#34;ab\nc\n&#34;&nbsp;the&nbsp;line&nbsp;offsets&nbsp;are&nbsp;{0,&nbsp;3}.</span><br>
<span class="lineno"></span><span class="comment" id="2351190">//&nbsp;An&nbsp;empty&nbsp;file&nbsp;has&nbsp;an&nbsp;empty&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno"></span><span class="comment" id="2351239">//&nbsp;Each&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno">165</span><span class="comment" id="2351312">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;SetLines&nbsp;fails&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="2351384">//&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="2351394">//</span><br>
<span class="lineno"></span><span class="keyword" id="2351397">func</span>&nbsp;<span class="op" id="2351402">(</span><span class="ident" id="2351403">f</span>&nbsp;<span class="op" id="2351405">*</span><span class="ident" id="2351406">File</span><span class="op" id="2351410">)</span>&nbsp;<span class="ident" id="2351412">SetLines</span><span class="op" id="2351420">(</span><span class="ident" id="2351421">lines</span>&nbsp;<span class="op" id="2351427">[</span><span class="op" id="2351428">]</span><span class="builtintype" id="2351429">int</span><span class="op" id="2351432">)</span>&nbsp;<span class="builtintype" id="2351434">bool</span>&nbsp;<span class="op" id="2351439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2351442">//&nbsp;verify&nbsp;validity&nbsp;of&nbsp;lines&nbsp;table</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2351477">size</span>&nbsp;<span class="op" id="2351482">:=</span>&nbsp;<span class="ident" id="2351485">f</span><span class="op" id="2351486">.</span><span class="ident" id="2351487">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2351493">for</span>&nbsp;<span class="ident" id="2351497">i</span><span class="op" id="2351498">,</span>&nbsp;<span class="ident" id="2351500">offset</span>&nbsp;<span class="op" id="2351507">:=</span>&nbsp;<span class="keyword" id="2351510">range</span>&nbsp;<span class="ident" id="2351516">lines</span>&nbsp;<span class="op" id="2351522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2351526">if</span>&nbsp;<span class="ident" id="2351529">i</span>&nbsp;<span class="op" id="2351531">&gt;</span>&nbsp;<span class="num" id="2351533">0</span>&nbsp;<span class="op" id="2351535">&amp;&amp;</span>&nbsp;<span class="ident" id="2351538">offset</span>&nbsp;<span class="op" id="2351545">&lt;=</span>&nbsp;<span class="ident" id="2351548">lines</span><span class="op" id="2351553">[</span><span class="ident" id="2351554">i</span><span class="op" id="2351555">-</span><span class="num" id="2351556">1</span><span class="op" id="2351557">]</span>&nbsp;<span class="op" id="2351559">||</span>&nbsp;<span class="ident" id="2351562">size</span>&nbsp;<span class="op" id="2351567">&lt;=</span>&nbsp;<span class="ident" id="2351570">offset</span>&nbsp;<span class="op" id="2351577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2351582">return</span>&nbsp;<span class="builtintype" id="2351589">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2351597">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2351600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2351604">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2351624">f</span><span class="op" id="2351625">.</span><span class="ident" id="2351626">set</span><span class="op" id="2351629">.</span><span class="ident" id="2351630">mutex</span><span class="op" id="2351635">.</span><span class="ident" id="2351636">Lock</span><span class="op" id="2351640">(</span><span class="op" id="2351641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2351644">f</span><span class="op" id="2351645">.</span><span class="ident" id="2351646">lines</span>&nbsp;<span class="op" id="2351652">=</span>&nbsp;<span class="ident" id="2351654">lines</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2351661">f</span><span class="op" id="2351662">.</span><span class="ident" id="2351663">set</span><span class="op" id="2351666">.</span><span class="ident" id="2351667">mutex</span><span class="op" id="2351672">.</span><span class="ident" id="2351673">Unlock</span><span class="op" id="2351679">(</span><span class="op" id="2351680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2351683">return</span>&nbsp;<span class="builtintype" id="2351690">true</span><br>
<span class="lineno"></span><span class="op" id="2351695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2351698">//&nbsp;SetLinesForContent&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;content.</span><br>
<span class="lineno">185</span><span class="comment" id="2351770">//&nbsp;It&nbsp;ignores&nbsp;position-altering&nbsp;//line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="keyword" id="2351819">func</span>&nbsp;<span class="op" id="2351824">(</span><span class="ident" id="2351825">f</span>&nbsp;<span class="op" id="2351827">*</span><span class="ident" id="2351828">File</span><span class="op" id="2351832">)</span>&nbsp;<span class="ident" id="2351834">SetLinesForContent</span><span class="op" id="2351852">(</span><span class="ident" id="2351853">content</span>&nbsp;<span class="op" id="2351861">[</span><span class="op" id="2351862">]</span><span class="builtintype" id="2351863">byte</span><span class="op" id="2351867">)</span>&nbsp;<span class="op" id="2351869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2351872">var</span>&nbsp;<span class="ident" id="2351876">lines</span>&nbsp;<span class="op" id="2351882">[</span><span class="op" id="2351883">]</span><span class="builtintype" id="2351884">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2351889">line</span>&nbsp;<span class="op" id="2351894">:=</span>&nbsp;<span class="num" id="2351897">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2351900">for</span>&nbsp;<span class="ident" id="2351904">offset</span><span class="op" id="2351910">,</span>&nbsp;<span class="ident" id="2351912">b</span>&nbsp;<span class="op" id="2351914">:=</span>&nbsp;<span class="keyword" id="2351917">range</span>&nbsp;<span class="ident" id="2351923">content</span>&nbsp;<span class="op" id="2351931">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2351935">if</span>&nbsp;<span class="ident" id="2351938">line</span>&nbsp;<span class="op" id="2351943">&gt;=</span>&nbsp;<span class="num" id="2351946">0</span>&nbsp;<span class="op" id="2351948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2351953">lines</span>&nbsp;<span class="op" id="2351959">=</span>&nbsp;<span class="builtinfunc" id="2351961">append</span><span class="op" id="2351967">(</span><span class="ident" id="2351968">lines</span><span class="op" id="2351973">,</span>&nbsp;<span class="ident" id="2351975">line</span><span class="op" id="2351979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2351983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2351987">line</span>&nbsp;<span class="op" id="2351992">=</span>&nbsp;<span class="op" id="2351994">-</span><span class="num" id="2351995">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2351999">if</span>&nbsp;<span class="ident" id="2352002">b</span>&nbsp;<span class="op" id="2352004">==</span>&nbsp;<span class="string" id="2352007">&#39;\n&#39;</span>&nbsp;<span class="op" id="2352012">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2352017">line</span>&nbsp;<span class="op" id="2352022">=</span>&nbsp;<span class="ident" id="2352024">offset</span>&nbsp;<span class="op" id="2352031">+</span>&nbsp;<span class="num" id="2352033">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2352037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2352040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2352044">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2352064">f</span><span class="op" id="2352065">.</span><span class="ident" id="2352066">set</span><span class="op" id="2352069">.</span><span class="ident" id="2352070">mutex</span><span class="op" id="2352075">.</span><span class="ident" id="2352076">Lock</span><span class="op" id="2352080">(</span><span class="op" id="2352081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2352084">f</span><span class="op" id="2352085">.</span><span class="ident" id="2352086">lines</span>&nbsp;<span class="op" id="2352092">=</span>&nbsp;<span class="ident" id="2352094">lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2352101">f</span><span class="op" id="2352102">.</span><span class="ident" id="2352103">set</span><span class="op" id="2352106">.</span><span class="ident" id="2352107">mutex</span><span class="op" id="2352112">.</span><span class="ident" id="2352113">Unlock</span><span class="op" id="2352119">(</span><span class="op" id="2352120">)</span><br>
<span class="lineno"></span><span class="op" id="2352122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="2352125">//&nbsp;A&nbsp;lineInfo&nbsp;object&nbsp;describes&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="2352189">//&nbsp;information&nbsp;(such&nbsp;as&nbsp;provided&nbsp;via&nbsp;a&nbsp;//line&nbsp;comment&nbsp;in&nbsp;a&nbsp;.go</span><br>
<span class="lineno"></span><span class="comment" id="2352252">//&nbsp;file)&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="2352286">type</span>&nbsp;<span class="ident" id="2352291">lineInfo</span>&nbsp;<span class="keyword" id="2352300">struct</span>&nbsp;<span class="op" id="2352307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2352310">//&nbsp;fields&nbsp;are&nbsp;exported&nbsp;to&nbsp;make&nbsp;them&nbsp;accessible&nbsp;to&nbsp;gob</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2352365">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2352374">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2352379">Filename</span>&nbsp;<span class="builtintype" id="2352388">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2352396">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2352405">int</span><br>
<span class="lineno"></span><span class="op" id="2352409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="2352412">//&nbsp;AddLineInfo&nbsp;adds&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number&nbsp;information&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="2352481">//&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.&nbsp;The&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="2352551">//&nbsp;the&nbsp;previously&nbsp;added&nbsp;alternative&nbsp;line&nbsp;info&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2352618">//&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;information&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="2352670">//</span><br>
<span class="lineno">220</span><span class="comment" id="2352673">//&nbsp;AddLineInfo&nbsp;is&nbsp;typically&nbsp;used&nbsp;to&nbsp;register&nbsp;alternative&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="2352739">//&nbsp;information&nbsp;for&nbsp;//line&nbsp;filename:line&nbsp;comments&nbsp;in&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="2352805">//</span><br>
<span class="lineno"></span><span class="keyword" id="2352808">func</span>&nbsp;<span class="op" id="2352813">(</span><span class="ident" id="2352814">f</span>&nbsp;<span class="op" id="2352816">*</span><span class="ident" id="2352817">File</span><span class="op" id="2352821">)</span>&nbsp;<span class="ident" id="2352823">AddLineInfo</span><span class="op" id="2352834">(</span><span class="ident" id="2352835">offset</span>&nbsp;<span class="builtintype" id="2352842">int</span><span class="op" id="2352845">,</span>&nbsp;<span class="ident" id="2352847">filename</span>&nbsp;<span class="builtintype" id="2352856">string</span><span class="op" id="2352862">,</span>&nbsp;<span class="ident" id="2352864">line</span>&nbsp;<span class="builtintype" id="2352869">int</span><span class="op" id="2352872">)</span>&nbsp;<span class="op" id="2352874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2352877">f</span><span class="op" id="2352878">.</span><span class="ident" id="2352879">set</span><span class="op" id="2352882">.</span><span class="ident" id="2352883">mutex</span><span class="op" id="2352888">.</span><span class="ident" id="2352889">Lock</span><span class="op" id="2352893">(</span><span class="op" id="2352894">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2352897">if</span>&nbsp;<span class="ident" id="2352900">i</span>&nbsp;<span class="op" id="2352902">:=</span>&nbsp;<span class="builtinfunc" id="2352905">len</span><span class="op" id="2352908">(</span><span class="ident" id="2352909">f</span><span class="op" id="2352910">.</span><span class="ident" id="2352911">infos</span><span class="op" id="2352916">)</span><span class="op" id="2352917">;</span>&nbsp;<span class="ident" id="2352919">i</span>&nbsp;<span class="op" id="2352921">==</span>&nbsp;<span class="num" id="2352924">0</span>&nbsp;<span class="op" id="2352926">||</span>&nbsp;<span class="ident" id="2352929">f</span><span class="op" id="2352930">.</span><span class="ident" id="2352931">infos</span><span class="op" id="2352936">[</span><span class="ident" id="2352937">i</span><span class="op" id="2352938">-</span><span class="num" id="2352939">1</span><span class="op" id="2352940">]</span><span class="op" id="2352941">.</span><span class="ident" id="2352942">Offset</span>&nbsp;<span class="op" id="2352949">&lt;</span>&nbsp;<span class="ident" id="2352951">offset</span>&nbsp;<span class="op" id="2352958">&amp;&amp;</span>&nbsp;<span class="ident" id="2352961">offset</span>&nbsp;<span class="op" id="2352968">&lt;</span>&nbsp;<span class="ident" id="2352970">f</span><span class="op" id="2352971">.</span><span class="ident" id="2352972">size</span>&nbsp;<span class="op" id="2352977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2352981">f</span><span class="op" id="2352982">.</span><span class="ident" id="2352983">infos</span>&nbsp;<span class="op" id="2352989">=</span>&nbsp;<span class="builtinfunc" id="2352991">append</span><span class="op" id="2352997">(</span><span class="ident" id="2352998">f</span><span class="op" id="2352999">.</span><span class="ident" id="2353000">infos</span><span class="op" id="2353005">,</span>&nbsp;<span class="ident" id="2353007">lineInfo</span><span class="op" id="2353015">{</span><span class="ident" id="2353016">offset</span><span class="op" id="2353022">,</span>&nbsp;<span class="ident" id="2353024">filename</span><span class="op" id="2353032">,</span>&nbsp;<span class="ident" id="2353034">line</span><span class="op" id="2353038">}</span><span class="op" id="2353039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2353042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2353045">f</span><span class="op" id="2353046">.</span><span class="ident" id="2353047">set</span><span class="op" id="2353050">.</span><span class="ident" id="2353051">mutex</span><span class="op" id="2353056">.</span><span class="ident" id="2353057">Unlock</span><span class="op" id="2353063">(</span><span class="op" id="2353064">)</span><br>
<span class="lineno"></span><span class="op" id="2353066">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="2353069">//&nbsp;Pos&nbsp;returns&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;offset;</span><br>
<span class="lineno"></span><span class="comment" id="2353125">//&nbsp;the&nbsp;offset&nbsp;must&nbsp;be&nbsp;&lt;=&nbsp;f.Size().</span><br>
<span class="lineno"></span><span class="comment" id="2353160">//&nbsp;f.Pos(f.Offset(p))&nbsp;==&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="2353188">//</span><br>
<span class="lineno">235</span><span class="keyword" id="2353191">func</span>&nbsp;<span class="op" id="2353196">(</span><span class="ident" id="2353197">f</span>&nbsp;<span class="op" id="2353199">*</span><span class="ident" id="2353200">File</span><span class="op" id="2353204">)</span>&nbsp;<span class="ident" id="2353206">Pos</span><span class="op" id="2353209">(</span><span class="ident" id="2353210">offset</span>&nbsp;<span class="builtintype" id="2353217">int</span><span class="op" id="2353220">)</span>&nbsp;<span class="ident" id="2353222">Pos</span>&nbsp;<span class="op" id="2353226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2353229">if</span>&nbsp;<span class="ident" id="2353232">offset</span>&nbsp;<span class="op" id="2353239">&gt;</span>&nbsp;<span class="ident" id="2353241">f</span><span class="op" id="2353242">.</span><span class="ident" id="2353243">size</span>&nbsp;<span class="op" id="2353248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2353252">panic</span><span class="op" id="2353257">(</span><span class="string" id="2353258">&#34;illegal&nbsp;file&nbsp;offset&#34;</span><span class="op" id="2353279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2353282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2353285">return</span>&nbsp;<span class="ident" id="2353292">Pos</span><span class="op" id="2353295">(</span><span class="ident" id="2353296">f</span><span class="op" id="2353297">.</span><span class="ident" id="2353298">base</span>&nbsp;<span class="op" id="2353303">+</span>&nbsp;<span class="ident" id="2353305">offset</span><span class="op" id="2353311">)</span><br>
<span class="lineno">240</span><span class="op" id="2353313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2353316">//&nbsp;Offset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="2353376">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;valid&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2353421">//&nbsp;f.Offset(f.Pos(offset))&nbsp;==&nbsp;offset.</span><br>
<span class="lineno">245</span><span class="comment" id="2353459">//</span><br>
<span class="lineno"></span><span class="keyword" id="2353462">func</span>&nbsp;<span class="op" id="2353467">(</span><span class="ident" id="2353468">f</span>&nbsp;<span class="op" id="2353470">*</span><span class="ident" id="2353471">File</span><span class="op" id="2353475">)</span>&nbsp;<span class="ident" id="2353477">Offset</span><span class="op" id="2353483">(</span><span class="ident" id="2353484">p</span>&nbsp;<span class="ident" id="2353486">Pos</span><span class="op" id="2353489">)</span>&nbsp;<span class="builtintype" id="2353491">int</span>&nbsp;<span class="op" id="2353495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2353498">if</span>&nbsp;<span class="builtintype" id="2353501">int</span><span class="op" id="2353504">(</span><span class="ident" id="2353505">p</span><span class="op" id="2353506">)</span>&nbsp;<span class="op" id="2353508">&lt;</span>&nbsp;<span class="ident" id="2353510">f</span><span class="op" id="2353511">.</span><span class="ident" id="2353512">base</span>&nbsp;<span class="op" id="2353517">||</span>&nbsp;<span class="builtintype" id="2353520">int</span><span class="op" id="2353523">(</span><span class="ident" id="2353524">p</span><span class="op" id="2353525">)</span>&nbsp;<span class="op" id="2353527">&gt;</span>&nbsp;<span class="ident" id="2353529">f</span><span class="op" id="2353530">.</span><span class="ident" id="2353531">base</span><span class="op" id="2353535">+</span><span class="ident" id="2353536">f</span><span class="op" id="2353537">.</span><span class="ident" id="2353538">size</span>&nbsp;<span class="op" id="2353543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2353547">panic</span><span class="op" id="2353552">(</span><span class="string" id="2353553">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="2353572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2353575">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2353578">return</span>&nbsp;<span class="builtintype" id="2353585">int</span><span class="op" id="2353588">(</span><span class="ident" id="2353589">p</span><span class="op" id="2353590">)</span>&nbsp;<span class="op" id="2353592">-</span>&nbsp;<span class="ident" id="2353594">f</span><span class="op" id="2353595">.</span><span class="ident" id="2353596">base</span><br>
<span class="lineno"></span><span class="op" id="2353601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2353604">//&nbsp;Line&nbsp;returns&nbsp;the&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="2353667">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno">255</span><span class="comment" id="2353715">//</span><br>
<span class="lineno"></span><span class="keyword" id="2353718">func</span>&nbsp;<span class="op" id="2353723">(</span><span class="ident" id="2353724">f</span>&nbsp;<span class="op" id="2353726">*</span><span class="ident" id="2353727">File</span><span class="op" id="2353731">)</span>&nbsp;<span class="ident" id="2353733">Line</span><span class="op" id="2353737">(</span><span class="ident" id="2353738">p</span>&nbsp;<span class="ident" id="2353740">Pos</span><span class="op" id="2353743">)</span>&nbsp;<span class="builtintype" id="2353745">int</span>&nbsp;<span class="op" id="2353749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2353752">return</span>&nbsp;<span class="ident" id="2353759">f</span><span class="op" id="2353760">.</span><span class="ident" id="2353761">Position</span><span class="op" id="2353769">(</span><span class="ident" id="2353770">p</span><span class="op" id="2353771">)</span><span class="op" id="2353772">.</span><span class="ident" id="2353773">Line</span><br>
<span class="lineno"></span><span class="op" id="2353778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="2353781">func</span>&nbsp;<span class="ident" id="2353786">searchLineInfos</span><span class="op" id="2353801">(</span><span class="ident" id="2353802">a</span>&nbsp;<span class="op" id="2353804">[</span><span class="op" id="2353805">]</span><span class="ident" id="2353806">lineInfo</span><span class="op" id="2353814">,</span>&nbsp;<span class="ident" id="2353816">x</span>&nbsp;<span class="builtintype" id="2353818">int</span><span class="op" id="2353821">)</span>&nbsp;<span class="builtintype" id="2353823">int</span>&nbsp;<span class="op" id="2353827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2353830">return</span>&nbsp;<span class="ident" id="2353837">sort</span><span class="op" id="2353841">.</span><span class="ident" id="2353842">Search</span><span class="op" id="2353848">(</span><span class="builtinfunc" id="2353849">len</span><span class="op" id="2353852">(</span><span class="ident" id="2353853">a</span><span class="op" id="2353854">)</span><span class="op" id="2353855">,</span>&nbsp;<span class="keyword" id="2353857">func</span><span class="op" id="2353861">(</span><span class="ident" id="2353862">i</span>&nbsp;<span class="builtintype" id="2353864">int</span><span class="op" id="2353867">)</span>&nbsp;<span class="builtintype" id="2353869">bool</span>&nbsp;<span class="op" id="2353874">{</span>&nbsp;<span class="keyword" id="2353876">return</span>&nbsp;<span class="ident" id="2353883">a</span><span class="op" id="2353884">[</span><span class="ident" id="2353885">i</span><span class="op" id="2353886">]</span><span class="op" id="2353887">.</span><span class="ident" id="2353888">Offset</span>&nbsp;<span class="op" id="2353895">&gt;</span>&nbsp;<span class="ident" id="2353897">x</span>&nbsp;<span class="op" id="2353899">}</span><span class="op" id="2353900">)</span>&nbsp;<span class="op" id="2353902">-</span>&nbsp;<span class="num" id="2353904">1</span><br>
<span class="lineno"></span><span class="op" id="2353906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2353909">//&nbsp;unpack&nbsp;returns&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;and&nbsp;column&nbsp;number&nbsp;for&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno">265</span><span class="comment" id="2353986">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;unpack&nbsp;will&nbsp;return&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="2354062">//&nbsp;possibly&nbsp;adjusted&nbsp;by&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="2354141">//</span><br>
<span class="lineno"></span><span class="keyword" id="2354144">func</span>&nbsp;<span class="op" id="2354149">(</span><span class="ident" id="2354150">f</span>&nbsp;<span class="op" id="2354152">*</span><span class="ident" id="2354153">File</span><span class="op" id="2354157">)</span>&nbsp;<span class="ident" id="2354159">unpack</span><span class="op" id="2354165">(</span><span class="ident" id="2354166">offset</span>&nbsp;<span class="builtintype" id="2354173">int</span><span class="op" id="2354176">,</span>&nbsp;<span class="ident" id="2354178">adjusted</span>&nbsp;<span class="builtintype" id="2354187">bool</span><span class="op" id="2354191">)</span>&nbsp;<span class="op" id="2354193">(</span><span class="ident" id="2354194">filename</span>&nbsp;<span class="builtintype" id="2354203">string</span><span class="op" id="2354209">,</span>&nbsp;<span class="ident" id="2354211">line</span><span class="op" id="2354215">,</span>&nbsp;<span class="ident" id="2354217">column</span>&nbsp;<span class="builtintype" id="2354224">int</span><span class="op" id="2354227">)</span>&nbsp;<span class="op" id="2354229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2354232">filename</span>&nbsp;<span class="op" id="2354241">=</span>&nbsp;<span class="ident" id="2354243">f</span><span class="op" id="2354244">.</span><span class="ident" id="2354245">name</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2354251">if</span>&nbsp;<span class="ident" id="2354254">i</span>&nbsp;<span class="op" id="2354256">:=</span>&nbsp;<span class="ident" id="2354259">searchInts</span><span class="op" id="2354269">(</span><span class="ident" id="2354270">f</span><span class="op" id="2354271">.</span><span class="ident" id="2354272">lines</span><span class="op" id="2354277">,</span>&nbsp;<span class="ident" id="2354279">offset</span><span class="op" id="2354285">)</span><span class="op" id="2354286">;</span>&nbsp;<span class="ident" id="2354288">i</span>&nbsp;<span class="op" id="2354290">&gt;=</span>&nbsp;<span class="num" id="2354293">0</span>&nbsp;<span class="op" id="2354295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2354299">line</span><span class="op" id="2354303">,</span>&nbsp;<span class="ident" id="2354305">column</span>&nbsp;<span class="op" id="2354312">=</span>&nbsp;<span class="ident" id="2354314">i</span><span class="op" id="2354315">+</span><span class="num" id="2354316">1</span><span class="op" id="2354317">,</span>&nbsp;<span class="ident" id="2354319">offset</span><span class="op" id="2354325">-</span><span class="ident" id="2354326">f</span><span class="op" id="2354327">.</span><span class="ident" id="2354328">lines</span><span class="op" id="2354333">[</span><span class="ident" id="2354334">i</span><span class="op" id="2354335">]</span><span class="op" id="2354336">+</span><span class="num" id="2354337">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2354340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2354343">if</span>&nbsp;<span class="ident" id="2354346">adjusted</span>&nbsp;<span class="op" id="2354355">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2354358">len</span><span class="op" id="2354361">(</span><span class="ident" id="2354362">f</span><span class="op" id="2354363">.</span><span class="ident" id="2354364">infos</span><span class="op" id="2354369">)</span>&nbsp;<span class="op" id="2354371">&gt;</span>&nbsp;<span class="num" id="2354373">0</span>&nbsp;<span class="op" id="2354375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2354379">//&nbsp;almost&nbsp;no&nbsp;files&nbsp;have&nbsp;extra&nbsp;line&nbsp;infos</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2354422">if</span>&nbsp;<span class="ident" id="2354425">i</span>&nbsp;<span class="op" id="2354427">:=</span>&nbsp;<span class="ident" id="2354430">searchLineInfos</span><span class="op" id="2354445">(</span><span class="ident" id="2354446">f</span><span class="op" id="2354447">.</span><span class="ident" id="2354448">infos</span><span class="op" id="2354453">,</span>&nbsp;<span class="ident" id="2354455">offset</span><span class="op" id="2354461">)</span><span class="op" id="2354462">;</span>&nbsp;<span class="ident" id="2354464">i</span>&nbsp;<span class="op" id="2354466">&gt;=</span>&nbsp;<span class="num" id="2354469">0</span>&nbsp;<span class="op" id="2354471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2354476">alt</span>&nbsp;<span class="op" id="2354480">:=</span>&nbsp;<span class="op" id="2354483">&amp;</span><span class="ident" id="2354484">f</span><span class="op" id="2354485">.</span><span class="ident" id="2354486">infos</span><span class="op" id="2354491">[</span><span class="ident" id="2354492">i</span><span class="op" id="2354493">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2354498">filename</span>&nbsp;<span class="op" id="2354507">=</span>&nbsp;<span class="ident" id="2354509">alt</span><span class="op" id="2354512">.</span><span class="ident" id="2354513">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2354525">if</span>&nbsp;<span class="ident" id="2354528">i</span>&nbsp;<span class="op" id="2354530">:=</span>&nbsp;<span class="ident" id="2354533">searchInts</span><span class="op" id="2354543">(</span><span class="ident" id="2354544">f</span><span class="op" id="2354545">.</span><span class="ident" id="2354546">lines</span><span class="op" id="2354551">,</span>&nbsp;<span class="ident" id="2354553">alt</span><span class="op" id="2354556">.</span><span class="ident" id="2354557">Offset</span><span class="op" id="2354563">)</span><span class="op" id="2354564">;</span>&nbsp;<span class="ident" id="2354566">i</span>&nbsp;<span class="op" id="2354568">&gt;=</span>&nbsp;<span class="num" id="2354571">0</span>&nbsp;<span class="op" id="2354573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2354579">line</span>&nbsp;<span class="op" id="2354584">+=</span>&nbsp;<span class="ident" id="2354587">alt</span><span class="op" id="2354590">.</span><span class="ident" id="2354591">Line</span>&nbsp;<span class="op" id="2354596">-</span>&nbsp;<span class="ident" id="2354598">i</span>&nbsp;<span class="op" id="2354600">-</span>&nbsp;<span class="num" id="2354602">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2354607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2354611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2354614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2354617">return</span><br>
<span class="lineno"></span><span class="op" id="2354624">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="2354627">func</span>&nbsp;<span class="op" id="2354632">(</span><span class="ident" id="2354633">f</span>&nbsp;<span class="op" id="2354635">*</span><span class="ident" id="2354636">File</span><span class="op" id="2354640">)</span>&nbsp;<span class="ident" id="2354642">position</span><span class="op" id="2354650">(</span><span class="ident" id="2354651">p</span>&nbsp;<span class="ident" id="2354653">Pos</span><span class="op" id="2354656">,</span>&nbsp;<span class="ident" id="2354658">adjusted</span>&nbsp;<span class="builtintype" id="2354667">bool</span><span class="op" id="2354671">)</span>&nbsp;<span class="op" id="2354673">(</span><span class="ident" id="2354674">pos</span>&nbsp;<span class="ident" id="2354678">Position</span><span class="op" id="2354686">)</span>&nbsp;<span class="op" id="2354688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2354691">offset</span>&nbsp;<span class="op" id="2354698">:=</span>&nbsp;<span class="builtintype" id="2354701">int</span><span class="op" id="2354704">(</span><span class="ident" id="2354705">p</span><span class="op" id="2354706">)</span>&nbsp;<span class="op" id="2354708">-</span>&nbsp;<span class="ident" id="2354710">f</span><span class="op" id="2354711">.</span><span class="ident" id="2354712">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2354718">pos</span><span class="op" id="2354721">.</span><span class="ident" id="2354722">Offset</span>&nbsp;<span class="op" id="2354729">=</span>&nbsp;<span class="ident" id="2354731">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2354739">pos</span><span class="op" id="2354742">.</span><span class="ident" id="2354743">Filename</span><span class="op" id="2354751">,</span>&nbsp;<span class="ident" id="2354753">pos</span><span class="op" id="2354756">.</span><span class="ident" id="2354757">Line</span><span class="op" id="2354761">,</span>&nbsp;<span class="ident" id="2354763">pos</span><span class="op" id="2354766">.</span><span class="ident" id="2354767">Column</span>&nbsp;<span class="op" id="2354774">=</span>&nbsp;<span class="ident" id="2354776">f</span><span class="op" id="2354777">.</span><span class="ident" id="2354778">unpack</span><span class="op" id="2354784">(</span><span class="ident" id="2354785">offset</span><span class="op" id="2354791">,</span>&nbsp;<span class="ident" id="2354793">adjusted</span><span class="op" id="2354801">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2354804">return</span><br>
<span class="lineno"></span><span class="op" id="2354811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2354814">//&nbsp;PositionFor&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="2354887">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno">295</span><span class="comment" id="2354960">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="2355018">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;f&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="2355058">//</span><br>
<span class="lineno"></span><span class="keyword" id="2355061">func</span>&nbsp;<span class="op" id="2355066">(</span><span class="ident" id="2355067">f</span>&nbsp;<span class="op" id="2355069">*</span><span class="ident" id="2355070">File</span><span class="op" id="2355074">)</span>&nbsp;<span class="ident" id="2355076">PositionFor</span><span class="op" id="2355087">(</span><span class="ident" id="2355088">p</span>&nbsp;<span class="ident" id="2355090">Pos</span><span class="op" id="2355093">,</span>&nbsp;<span class="ident" id="2355095">adjusted</span>&nbsp;<span class="builtintype" id="2355104">bool</span><span class="op" id="2355108">)</span>&nbsp;<span class="op" id="2355110">(</span><span class="ident" id="2355111">pos</span>&nbsp;<span class="ident" id="2355115">Position</span><span class="op" id="2355123">)</span>&nbsp;<span class="op" id="2355125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2355128">if</span>&nbsp;<span class="ident" id="2355131">p</span>&nbsp;<span class="op" id="2355133">!=</span>&nbsp;<span class="ident" id="2355136">NoPos</span>&nbsp;<span class="op" id="2355142">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2355146">if</span>&nbsp;<span class="builtintype" id="2355149">int</span><span class="op" id="2355152">(</span><span class="ident" id="2355153">p</span><span class="op" id="2355154">)</span>&nbsp;<span class="op" id="2355156">&lt;</span>&nbsp;<span class="ident" id="2355158">f</span><span class="op" id="2355159">.</span><span class="ident" id="2355160">base</span>&nbsp;<span class="op" id="2355165">||</span>&nbsp;<span class="builtintype" id="2355168">int</span><span class="op" id="2355171">(</span><span class="ident" id="2355172">p</span><span class="op" id="2355173">)</span>&nbsp;<span class="op" id="2355175">&gt;</span>&nbsp;<span class="ident" id="2355177">f</span><span class="op" id="2355178">.</span><span class="ident" id="2355179">base</span><span class="op" id="2355183">+</span><span class="ident" id="2355184">f</span><span class="op" id="2355185">.</span><span class="ident" id="2355186">size</span>&nbsp;<span class="op" id="2355191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2355196">panic</span><span class="op" id="2355201">(</span><span class="string" id="2355202">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="2355221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2355225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2355229">pos</span>&nbsp;<span class="op" id="2355233">=</span>&nbsp;<span class="ident" id="2355235">f</span><span class="op" id="2355236">.</span><span class="ident" id="2355237">position</span><span class="op" id="2355245">(</span><span class="ident" id="2355246">p</span><span class="op" id="2355247">,</span>&nbsp;<span class="ident" id="2355249">adjusted</span><span class="op" id="2355257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2355260">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2355263">return</span><br>
<span class="lineno"></span><span class="op" id="2355270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2355273">//&nbsp;Position&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="2355343">//&nbsp;Calling&nbsp;f.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;f.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno">310</span><span class="comment" id="2355417">//</span><br>
<span class="lineno"></span><span class="keyword" id="2355420">func</span>&nbsp;<span class="op" id="2355425">(</span><span class="ident" id="2355426">f</span>&nbsp;<span class="op" id="2355428">*</span><span class="ident" id="2355429">File</span><span class="op" id="2355433">)</span>&nbsp;<span class="ident" id="2355435">Position</span><span class="op" id="2355443">(</span><span class="ident" id="2355444">p</span>&nbsp;<span class="ident" id="2355446">Pos</span><span class="op" id="2355449">)</span>&nbsp;<span class="op" id="2355451">(</span><span class="ident" id="2355452">pos</span>&nbsp;<span class="ident" id="2355456">Position</span><span class="op" id="2355464">)</span>&nbsp;<span class="op" id="2355466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2355469">return</span>&nbsp;<span class="ident" id="2355476">f</span><span class="op" id="2355477">.</span><span class="ident" id="2355478">PositionFor</span><span class="op" id="2355489">(</span><span class="ident" id="2355490">p</span><span class="op" id="2355491">,</span>&nbsp;<span class="builtintype" id="2355493">true</span><span class="op" id="2355497">)</span><br>
<span class="lineno"></span><span class="op" id="2355499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="2355502">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="2355583">//&nbsp;FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2355595">//&nbsp;A&nbsp;FileSet&nbsp;represents&nbsp;a&nbsp;set&nbsp;of&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="2355642">//&nbsp;Methods&nbsp;of&nbsp;file&nbsp;sets&nbsp;are&nbsp;synchronized;&nbsp;multiple&nbsp;goroutines</span><br>
<span class="lineno">320</span><span class="comment" id="2355704">//&nbsp;may&nbsp;invoke&nbsp;them&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="comment" id="2355737">//</span><br>
<span class="lineno"></span><span class="keyword" id="2355740">type</span>&nbsp;<span class="ident" id="2355745">FileSet</span>&nbsp;<span class="keyword" id="2355753">struct</span>&nbsp;<span class="op" id="2355760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2355763">mutex</span>&nbsp;<span class="ident" id="2355769">sync</span><span class="op" id="2355773">.</span><span class="ident" id="2355774">RWMutex</span>&nbsp;<span class="comment" id="2355782">//&nbsp;protects&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2355808">base</span>&nbsp;&nbsp;<span class="builtintype" id="2355814">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2355827">//&nbsp;base&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;file</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2355861">files</span>&nbsp;<span class="op" id="2355867">[</span><span class="op" id="2355868">]</span><span class="op" id="2355869">*</span><span class="ident" id="2355870">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2355880">//&nbsp;list&nbsp;of&nbsp;files&nbsp;in&nbsp;the&nbsp;order&nbsp;added&nbsp;to&nbsp;the&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2355928">last</span>&nbsp;&nbsp;<span class="op" id="2355934">*</span><span class="ident" id="2355935">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2355947">//&nbsp;cache&nbsp;of&nbsp;last&nbsp;file&nbsp;looked&nbsp;up</span><br>
<span class="lineno"></span><span class="op" id="2355979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2355982">//&nbsp;NewFileSet&nbsp;creates&nbsp;a&nbsp;new&nbsp;file&nbsp;set.</span><br>
<span class="lineno">330</span><span class="keyword" id="2356020">func</span>&nbsp;<span class="ident" id="2356025">NewFileSet</span><span class="op" id="2356035">(</span><span class="op" id="2356036">)</span>&nbsp;<span class="op" id="2356038">*</span><span class="ident" id="2356039">FileSet</span>&nbsp;<span class="op" id="2356047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2356050">return</span>&nbsp;<span class="op" id="2356057">&amp;</span><span class="ident" id="2356058">FileSet</span><span class="op" id="2356065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2356069">base</span><span class="op" id="2356073">:</span>&nbsp;<span class="num" id="2356075">1</span><span class="op" id="2356076">,</span>&nbsp;<span class="comment" id="2356078">//&nbsp;0&nbsp;==&nbsp;NoPos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2356093">}</span><br>
<span class="lineno"></span><span class="op" id="2356095">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="comment" id="2356098">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;base&nbsp;offset&nbsp;that&nbsp;must&nbsp;be&nbsp;provided&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2356163">//&nbsp;AddFile&nbsp;when&nbsp;adding&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2356201">//</span><br>
<span class="lineno"></span><span class="keyword" id="2356204">func</span>&nbsp;<span class="op" id="2356209">(</span><span class="ident" id="2356210">s</span>&nbsp;<span class="op" id="2356212">*</span><span class="ident" id="2356213">FileSet</span><span class="op" id="2356220">)</span>&nbsp;<span class="ident" id="2356222">Base</span><span class="op" id="2356226">(</span><span class="op" id="2356227">)</span>&nbsp;<span class="builtintype" id="2356229">int</span>&nbsp;<span class="op" id="2356233">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2356236">s</span><span class="op" id="2356237">.</span><span class="ident" id="2356238">mutex</span><span class="op" id="2356243">.</span><span class="ident" id="2356244">RLock</span><span class="op" id="2356249">(</span><span class="op" id="2356250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2356253">b</span>&nbsp;<span class="op" id="2356255">:=</span>&nbsp;<span class="ident" id="2356258">s</span><span class="op" id="2356259">.</span><span class="ident" id="2356260">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2356266">s</span><span class="op" id="2356267">.</span><span class="ident" id="2356268">mutex</span><span class="op" id="2356273">.</span><span class="ident" id="2356274">RUnlock</span><span class="op" id="2356281">(</span><span class="op" id="2356282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2356285">return</span>&nbsp;<span class="ident" id="2356292">b</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="op" id="2356295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2356298">//&nbsp;AddFile&nbsp;adds&nbsp;a&nbsp;new&nbsp;file&nbsp;with&nbsp;a&nbsp;given&nbsp;filename,&nbsp;base&nbsp;offset,&nbsp;and&nbsp;file&nbsp;size</span><br>
<span class="lineno"></span><span class="comment" id="2356375">//&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;s&nbsp;and&nbsp;returns&nbsp;the&nbsp;file.&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;have&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="2356451">//&nbsp;name.&nbsp;The&nbsp;base&nbsp;offset&nbsp;must&nbsp;not&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base(),&nbsp;and</span><br>
<span class="lineno">350</span><span class="comment" id="2356527">//&nbsp;size&nbsp;must&nbsp;not&nbsp;be&nbsp;negative.&nbsp;As&nbsp;a&nbsp;special&nbsp;case,&nbsp;if&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;provided,</span><br>
<span class="lineno"></span><span class="comment" id="2356608">//&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base()&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="2356670">//</span><br>
<span class="lineno"></span><span class="comment" id="2356673">//&nbsp;Adding&nbsp;the&nbsp;file&nbsp;will&nbsp;set&nbsp;the&nbsp;file&nbsp;set&#39;s&nbsp;Base()&nbsp;value&nbsp;to&nbsp;base&nbsp;+&nbsp;size&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="2356748">//&nbsp;as&nbsp;the&nbsp;minimum&nbsp;base&nbsp;value&nbsp;for&nbsp;the&nbsp;next&nbsp;file.&nbsp;The&nbsp;following&nbsp;relationship</span><br>
<span class="lineno">355</span><span class="comment" id="2356823">//&nbsp;exists&nbsp;between&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset&nbsp;offs:</span><br>
<span class="lineno"></span><span class="comment" id="2356885">//</span><br>
<span class="lineno"></span><span class="comment" id="2356888">//&nbsp;&nbsp;&nbsp;&nbspint(p)&nbsp;=&nbsp;base&nbsp;+&nbsp;offs</span><br>
<span class="lineno"></span><span class="comment" id="2356912">//</span><br>
<span class="lineno"></span><span class="comment" id="2356915">//&nbsp;with&nbsp;offs&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;size]&nbsp;and&nbsp;thus&nbsp;p&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size].</span><br>
<span class="lineno">360</span><span class="comment" id="2356994">//&nbsp;For&nbsp;convenience,&nbsp;File.Pos&nbsp;may&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;file-specific&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="2357068">//&nbsp;values&nbsp;from&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="2357098">//</span><br>
<span class="lineno"></span><span class="keyword" id="2357101">func</span>&nbsp;<span class="op" id="2357106">(</span><span class="ident" id="2357107">s</span>&nbsp;<span class="op" id="2357109">*</span><span class="ident" id="2357110">FileSet</span><span class="op" id="2357117">)</span>&nbsp;<span class="ident" id="2357119">AddFile</span><span class="op" id="2357126">(</span><span class="ident" id="2357127">filename</span>&nbsp;<span class="builtintype" id="2357136">string</span><span class="op" id="2357142">,</span>&nbsp;<span class="ident" id="2357144">base</span><span class="op" id="2357148">,</span>&nbsp;<span class="ident" id="2357150">size</span>&nbsp;<span class="builtintype" id="2357155">int</span><span class="op" id="2357158">)</span>&nbsp;<span class="op" id="2357160">*</span><span class="ident" id="2357161">File</span>&nbsp;<span class="op" id="2357166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2357169">s</span><span class="op" id="2357170">.</span><span class="ident" id="2357171">mutex</span><span class="op" id="2357176">.</span><span class="ident" id="2357177">Lock</span><span class="op" id="2357181">(</span><span class="op" id="2357182">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2357185">defer</span>&nbsp;<span class="ident" id="2357191">s</span><span class="op" id="2357192">.</span><span class="ident" id="2357193">mutex</span><span class="op" id="2357198">.</span><span class="ident" id="2357199">Unlock</span><span class="op" id="2357205">(</span><span class="op" id="2357206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2357209">if</span>&nbsp;<span class="ident" id="2357212">base</span>&nbsp;<span class="op" id="2357217">&lt;</span>&nbsp;<span class="num" id="2357219">0</span>&nbsp;<span class="op" id="2357221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2357225">base</span>&nbsp;<span class="op" id="2357230">=</span>&nbsp;<span class="ident" id="2357232">s</span><span class="op" id="2357233">.</span><span class="ident" id="2357234">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2357240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2357243">if</span>&nbsp;<span class="ident" id="2357246">base</span>&nbsp;<span class="op" id="2357251">&lt;</span>&nbsp;<span class="ident" id="2357253">s</span><span class="op" id="2357254">.</span><span class="ident" id="2357255">base</span>&nbsp;<span class="op" id="2357260">||</span>&nbsp;<span class="ident" id="2357263">size</span>&nbsp;<span class="op" id="2357268">&lt;</span>&nbsp;<span class="num" id="2357270">0</span>&nbsp;<span class="op" id="2357272">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2357276">panic</span><span class="op" id="2357281">(</span><span class="string" id="2357282">&#34;illegal&nbsp;base&nbsp;or&nbsp;size&#34;</span><span class="op" id="2357304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2357307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2357310">//&nbsp;base&nbsp;&gt;=&nbsp;s.base&nbsp;&amp;&amp;&nbsp;size&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2357342">f</span>&nbsp;<span class="op" id="2357344">:=</span>&nbsp;<span class="op" id="2357347">&amp;</span><span class="ident" id="2357348">File</span><span class="op" id="2357352">{</span><span class="ident" id="2357353">s</span><span class="op" id="2357354">,</span>&nbsp;<span class="ident" id="2357356">filename</span><span class="op" id="2357364">,</span>&nbsp;<span class="ident" id="2357366">base</span><span class="op" id="2357370">,</span>&nbsp;<span class="ident" id="2357372">size</span><span class="op" id="2357376">,</span>&nbsp;<span class="op" id="2357378">[</span><span class="op" id="2357379">]</span><span class="builtintype" id="2357380">int</span><span class="op" id="2357383">{</span><span class="num" id="2357384">0</span><span class="op" id="2357385">}</span><span class="op" id="2357386">,</span>&nbsp;<span class="ident" id="2357388">nil</span><span class="op" id="2357391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2357394">base</span>&nbsp;<span class="op" id="2357399">+=</span>&nbsp;<span class="ident" id="2357402">size</span>&nbsp;<span class="op" id="2357407">+</span>&nbsp;<span class="num" id="2357409">1</span>&nbsp;<span class="comment" id="2357411">//&nbsp;+1&nbsp;because&nbsp;EOF&nbsp;also&nbsp;has&nbsp;a&nbsp;position</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2357450">if</span>&nbsp;<span class="ident" id="2357453">base</span>&nbsp;<span class="op" id="2357458">&lt;</span>&nbsp;<span class="num" id="2357460">0</span>&nbsp;<span class="op" id="2357462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2357466">panic</span><span class="op" id="2357471">(</span><span class="string" id="2357472">&#34;token.Pos&nbsp;offset&nbsp;overflow&nbsp;(&gt;&nbsp;2G&nbsp;of&nbsp;source&nbsp;code&nbsp;in&nbsp;file&nbsp;set)&#34;</span><span class="op" id="2357533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2357536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2357539">//&nbsp;add&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2357572">s</span><span class="op" id="2357573">.</span><span class="ident" id="2357574">base</span>&nbsp;<span class="op" id="2357579">=</span>&nbsp;<span class="ident" id="2357581">base</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2357587">s</span><span class="op" id="2357588">.</span><span class="ident" id="2357589">files</span>&nbsp;<span class="op" id="2357595">=</span>&nbsp;<span class="builtinfunc" id="2357597">append</span><span class="op" id="2357603">(</span><span class="ident" id="2357604">s</span><span class="op" id="2357605">.</span><span class="ident" id="2357606">files</span><span class="op" id="2357611">,</span>&nbsp;<span class="ident" id="2357613">f</span><span class="op" id="2357614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2357617">s</span><span class="op" id="2357618">.</span><span class="ident" id="2357619">last</span>&nbsp;<span class="op" id="2357624">=</span>&nbsp;<span class="ident" id="2357626">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2357629">return</span>&nbsp;<span class="ident" id="2357636">f</span><br>
<span class="lineno"></span><span class="op" id="2357638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="2357641">//&nbsp;Iterate&nbsp;calls&nbsp;f&nbsp;for&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;file&nbsp;set&nbsp;in&nbsp;the&nbsp;order&nbsp;they&nbsp;were&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="2357719">//&nbsp;until&nbsp;f&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="2357745">//</span><br>
<span class="lineno"></span><span class="keyword" id="2357748">func</span>&nbsp;<span class="op" id="2357753">(</span><span class="ident" id="2357754">s</span>&nbsp;<span class="op" id="2357756">*</span><span class="ident" id="2357757">FileSet</span><span class="op" id="2357764">)</span>&nbsp;<span class="ident" id="2357766">Iterate</span><span class="op" id="2357773">(</span><span class="ident" id="2357774">f</span>&nbsp;<span class="keyword" id="2357776">func</span><span class="op" id="2357780">(</span><span class="op" id="2357781">*</span><span class="ident" id="2357782">File</span><span class="op" id="2357786">)</span>&nbsp;<span class="builtintype" id="2357788">bool</span><span class="op" id="2357792">)</span>&nbsp;<span class="op" id="2357794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2357797">for</span>&nbsp;<span class="ident" id="2357801">i</span>&nbsp;<span class="op" id="2357803">:=</span>&nbsp;<span class="num" id="2357806">0</span><span class="op" id="2357807">;</span>&nbsp;<span class="op" id="2357809">;</span>&nbsp;<span class="ident" id="2357811">i</span><span class="op" id="2357812">++</span>&nbsp;<span class="op" id="2357815">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2357819">var</span>&nbsp;<span class="ident" id="2357823">file</span>&nbsp;<span class="op" id="2357828">*</span><span class="ident" id="2357829">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2357836">s</span><span class="op" id="2357837">.</span><span class="ident" id="2357838">mutex</span><span class="op" id="2357843">.</span><span class="ident" id="2357844">RLock</span><span class="op" id="2357849">(</span><span class="op" id="2357850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2357854">if</span>&nbsp;<span class="ident" id="2357857">i</span>&nbsp;<span class="op" id="2357859">&lt;</span>&nbsp;<span class="builtinfunc" id="2357861">len</span><span class="op" id="2357864">(</span><span class="ident" id="2357865">s</span><span class="op" id="2357866">.</span><span class="ident" id="2357867">files</span><span class="op" id="2357872">)</span>&nbsp;<span class="op" id="2357874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2357879">file</span>&nbsp;<span class="op" id="2357884">=</span>&nbsp;<span class="ident" id="2357886">s</span><span class="op" id="2357887">.</span><span class="ident" id="2357888">files</span><span class="op" id="2357893">[</span><span class="ident" id="2357894">i</span><span class="op" id="2357895">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2357899">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2357903">s</span><span class="op" id="2357904">.</span><span class="ident" id="2357905">mutex</span><span class="op" id="2357910">.</span><span class="ident" id="2357911">RUnlock</span><span class="op" id="2357918">(</span><span class="op" id="2357919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2357923">if</span>&nbsp;<span class="ident" id="2357926">file</span>&nbsp;<span class="op" id="2357931">==</span>&nbsp;<span class="ident" id="2357934">nil</span>&nbsp;<span class="op" id="2357938">||</span>&nbsp;<span class="op" id="2357941">!</span><span class="ident" id="2357942">f</span><span class="op" id="2357943">(</span><span class="ident" id="2357944">file</span><span class="op" id="2357948">)</span>&nbsp;<span class="op" id="2357950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2357955">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2357963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2357966">}</span><br>
<span class="lineno">400</span><span class="op" id="2357968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2357971">func</span>&nbsp;<span class="ident" id="2357976">searchFiles</span><span class="op" id="2357987">(</span><span class="ident" id="2357988">a</span>&nbsp;<span class="op" id="2357990">[</span><span class="op" id="2357991">]</span><span class="op" id="2357992">*</span><span class="ident" id="2357993">File</span><span class="op" id="2357997">,</span>&nbsp;<span class="ident" id="2357999">x</span>&nbsp;<span class="builtintype" id="2358001">int</span><span class="op" id="2358004">)</span>&nbsp;<span class="builtintype" id="2358006">int</span>&nbsp;<span class="op" id="2358010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2358013">return</span>&nbsp;<span class="ident" id="2358020">sort</span><span class="op" id="2358024">.</span><span class="ident" id="2358025">Search</span><span class="op" id="2358031">(</span><span class="builtinfunc" id="2358032">len</span><span class="op" id="2358035">(</span><span class="ident" id="2358036">a</span><span class="op" id="2358037">)</span><span class="op" id="2358038">,</span>&nbsp;<span class="keyword" id="2358040">func</span><span class="op" id="2358044">(</span><span class="ident" id="2358045">i</span>&nbsp;<span class="builtintype" id="2358047">int</span><span class="op" id="2358050">)</span>&nbsp;<span class="builtintype" id="2358052">bool</span>&nbsp;<span class="op" id="2358057">{</span>&nbsp;<span class="keyword" id="2358059">return</span>&nbsp;<span class="ident" id="2358066">a</span><span class="op" id="2358067">[</span><span class="ident" id="2358068">i</span><span class="op" id="2358069">]</span><span class="op" id="2358070">.</span><span class="ident" id="2358071">base</span>&nbsp;<span class="op" id="2358076">&gt;</span>&nbsp;<span class="ident" id="2358078">x</span>&nbsp;<span class="op" id="2358080">}</span><span class="op" id="2358081">)</span>&nbsp;<span class="op" id="2358083">-</span>&nbsp;<span class="num" id="2358085">1</span><br>
<span class="lineno"></span><span class="op" id="2358087">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="2358090">func</span>&nbsp;<span class="op" id="2358095">(</span><span class="ident" id="2358096">s</span>&nbsp;<span class="op" id="2358098">*</span><span class="ident" id="2358099">FileSet</span><span class="op" id="2358106">)</span>&nbsp;<span class="ident" id="2358108">file</span><span class="op" id="2358112">(</span><span class="ident" id="2358113">p</span>&nbsp;<span class="ident" id="2358115">Pos</span><span class="op" id="2358118">)</span>&nbsp;<span class="op" id="2358120">*</span><span class="ident" id="2358121">File</span>&nbsp;<span class="op" id="2358126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2358129">s</span><span class="op" id="2358130">.</span><span class="ident" id="2358131">mutex</span><span class="op" id="2358136">.</span><span class="ident" id="2358137">RLock</span><span class="op" id="2358142">(</span><span class="op" id="2358143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2358146">//&nbsp;common&nbsp;case:&nbsp;p&nbsp;is&nbsp;in&nbsp;last&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2358181">if</span>&nbsp;<span class="ident" id="2358184">f</span>&nbsp;<span class="op" id="2358186">:=</span>&nbsp;<span class="ident" id="2358189">s</span><span class="op" id="2358190">.</span><span class="ident" id="2358191">last</span><span class="op" id="2358195">;</span>&nbsp;<span class="ident" id="2358197">f</span>&nbsp;<span class="op" id="2358199">!=</span>&nbsp;<span class="ident" id="2358202">nil</span>&nbsp;<span class="op" id="2358206">&amp;&amp;</span>&nbsp;<span class="ident" id="2358209">f</span><span class="op" id="2358210">.</span><span class="ident" id="2358211">base</span>&nbsp;<span class="op" id="2358216">&lt;=</span>&nbsp;<span class="builtintype" id="2358219">int</span><span class="op" id="2358222">(</span><span class="ident" id="2358223">p</span><span class="op" id="2358224">)</span>&nbsp;<span class="op" id="2358226">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2358229">int</span><span class="op" id="2358232">(</span><span class="ident" id="2358233">p</span><span class="op" id="2358234">)</span>&nbsp;<span class="op" id="2358236">&lt;=</span>&nbsp;<span class="ident" id="2358239">f</span><span class="op" id="2358240">.</span><span class="ident" id="2358241">base</span><span class="op" id="2358245">+</span><span class="ident" id="2358246">f</span><span class="op" id="2358247">.</span><span class="ident" id="2358248">size</span>&nbsp;<span class="op" id="2358253">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2358257">s</span><span class="op" id="2358258">.</span><span class="ident" id="2358259">mutex</span><span class="op" id="2358264">.</span><span class="ident" id="2358265">RUnlock</span><span class="op" id="2358272">(</span><span class="op" id="2358273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2358277">return</span>&nbsp;<span class="ident" id="2358284">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2358287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2358290">//&nbsp;p&nbsp;is&nbsp;not&nbsp;in&nbsp;last&nbsp;file&nbsp;-&nbsp;search&nbsp;all&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2358335">if</span>&nbsp;<span class="ident" id="2358338">i</span>&nbsp;<span class="op" id="2358340">:=</span>&nbsp;<span class="ident" id="2358343">searchFiles</span><span class="op" id="2358354">(</span><span class="ident" id="2358355">s</span><span class="op" id="2358356">.</span><span class="ident" id="2358357">files</span><span class="op" id="2358362">,</span>&nbsp;<span class="builtintype" id="2358364">int</span><span class="op" id="2358367">(</span><span class="ident" id="2358368">p</span><span class="op" id="2358369">)</span><span class="op" id="2358370">)</span><span class="op" id="2358371">;</span>&nbsp;<span class="ident" id="2358373">i</span>&nbsp;<span class="op" id="2358375">&gt;=</span>&nbsp;<span class="num" id="2358378">0</span>&nbsp;<span class="op" id="2358380">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2358384">f</span>&nbsp;<span class="op" id="2358386">:=</span>&nbsp;<span class="ident" id="2358389">s</span><span class="op" id="2358390">.</span><span class="ident" id="2358391">files</span><span class="op" id="2358396">[</span><span class="ident" id="2358397">i</span><span class="op" id="2358398">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2358402">//&nbsp;f.base&nbsp;&lt;=&nbsp;int(p)&nbsp;by&nbsp;definition&nbsp;of&nbsp;searchFiles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2358453">if</span>&nbsp;<span class="builtintype" id="2358456">int</span><span class="op" id="2358459">(</span><span class="ident" id="2358460">p</span><span class="op" id="2358461">)</span>&nbsp;<span class="op" id="2358463">&lt;=</span>&nbsp;<span class="ident" id="2358466">f</span><span class="op" id="2358467">.</span><span class="ident" id="2358468">base</span><span class="op" id="2358472">+</span><span class="ident" id="2358473">f</span><span class="op" id="2358474">.</span><span class="ident" id="2358475">size</span>&nbsp;<span class="op" id="2358480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2358485">s</span><span class="op" id="2358486">.</span><span class="ident" id="2358487">mutex</span><span class="op" id="2358492">.</span><span class="ident" id="2358493">RUnlock</span><span class="op" id="2358500">(</span><span class="op" id="2358501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2358506">s</span><span class="op" id="2358507">.</span><span class="ident" id="2358508">mutex</span><span class="op" id="2358513">.</span><span class="ident" id="2358514">Lock</span><span class="op" id="2358518">(</span><span class="op" id="2358519">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2358524">s</span><span class="op" id="2358525">.</span><span class="ident" id="2358526">last</span>&nbsp;<span class="op" id="2358531">=</span>&nbsp;<span class="ident" id="2358533">f</span>&nbsp;<span class="comment" id="2358535">//&nbsp;race&nbsp;is&nbsp;ok&nbsp;-&nbsp;s.last&nbsp;is&nbsp;only&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2358577">s</span><span class="op" id="2358578">.</span><span class="ident" id="2358579">mutex</span><span class="op" id="2358584">.</span><span class="ident" id="2358585">Unlock</span><span class="op" id="2358591">(</span><span class="op" id="2358592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2358597">return</span>&nbsp;<span class="ident" id="2358604">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2358608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2358611">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2358614">s</span><span class="op" id="2358615">.</span><span class="ident" id="2358616">mutex</span><span class="op" id="2358621">.</span><span class="ident" id="2358622">RUnlock</span><span class="op" id="2358629">(</span><span class="op" id="2358630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2358633">return</span>&nbsp;<span class="ident" id="2358640">nil</span><br>
<span class="lineno"></span><span class="op" id="2358644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2358647">//&nbsp;File&nbsp;returns&nbsp;the&nbsp;file&nbsp;that&nbsp;contains&nbsp;the&nbsp;position&nbsp;p.</span><br>
<span class="lineno">430</span><span class="comment" id="2358702">//&nbsp;If&nbsp;no&nbsp;such&nbsp;file&nbsp;is&nbsp;found&nbsp;(for&nbsp;instance&nbsp;for&nbsp;p&nbsp;==&nbsp;NoPos),</span><br>
<span class="lineno"></span><span class="comment" id="2358761">//&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="2358783">//</span><br>
<span class="lineno"></span><span class="keyword" id="2358786">func</span>&nbsp;<span class="op" id="2358791">(</span><span class="ident" id="2358792">s</span>&nbsp;<span class="op" id="2358794">*</span><span class="ident" id="2358795">FileSet</span><span class="op" id="2358802">)</span>&nbsp;<span class="ident" id="2358804">File</span><span class="op" id="2358808">(</span><span class="ident" id="2358809">p</span>&nbsp;<span class="ident" id="2358811">Pos</span><span class="op" id="2358814">)</span>&nbsp;<span class="op" id="2358816">(</span><span class="ident" id="2358817">f</span>&nbsp;<span class="op" id="2358819">*</span><span class="ident" id="2358820">File</span><span class="op" id="2358824">)</span>&nbsp;<span class="op" id="2358826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2358829">if</span>&nbsp;<span class="ident" id="2358832">p</span>&nbsp;<span class="op" id="2358834">!=</span>&nbsp;<span class="ident" id="2358837">NoPos</span>&nbsp;<span class="op" id="2358843">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2358847">f</span>&nbsp;<span class="op" id="2358849">=</span>&nbsp;<span class="ident" id="2358851">s</span><span class="op" id="2358852">.</span><span class="ident" id="2358853">file</span><span class="op" id="2358857">(</span><span class="ident" id="2358858">p</span><span class="op" id="2358859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2358862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2358865">return</span><br>
<span class="lineno"></span><span class="op" id="2358872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="comment" id="2358875">//&nbsp;PositionFor&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="2358945">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno"></span><span class="comment" id="2359018">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="2359076">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;s&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="2359116">//</span><br>
<span class="lineno">445</span><span class="keyword" id="2359119">func</span>&nbsp;<span class="op" id="2359124">(</span><span class="ident" id="2359125">s</span>&nbsp;<span class="op" id="2359127">*</span><span class="ident" id="2359128">FileSet</span><span class="op" id="2359135">)</span>&nbsp;<span class="ident" id="2359137">PositionFor</span><span class="op" id="2359148">(</span><span class="ident" id="2359149">p</span>&nbsp;<span class="ident" id="2359151">Pos</span><span class="op" id="2359154">,</span>&nbsp;<span class="ident" id="2359156">adjusted</span>&nbsp;<span class="builtintype" id="2359165">bool</span><span class="op" id="2359169">)</span>&nbsp;<span class="op" id="2359171">(</span><span class="ident" id="2359172">pos</span>&nbsp;<span class="ident" id="2359176">Position</span><span class="op" id="2359184">)</span>&nbsp;<span class="op" id="2359186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2359189">if</span>&nbsp;<span class="ident" id="2359192">p</span>&nbsp;<span class="op" id="2359194">!=</span>&nbsp;<span class="ident" id="2359197">NoPos</span>&nbsp;<span class="op" id="2359203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2359207">if</span>&nbsp;<span class="ident" id="2359210">f</span>&nbsp;<span class="op" id="2359212">:=</span>&nbsp;<span class="ident" id="2359215">s</span><span class="op" id="2359216">.</span><span class="ident" id="2359217">file</span><span class="op" id="2359221">(</span><span class="ident" id="2359222">p</span><span class="op" id="2359223">)</span><span class="op" id="2359224">;</span>&nbsp;<span class="ident" id="2359226">f</span>&nbsp;<span class="op" id="2359228">!=</span>&nbsp;<span class="ident" id="2359231">nil</span>&nbsp;<span class="op" id="2359235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2359240">pos</span>&nbsp;<span class="op" id="2359244">=</span>&nbsp;<span class="ident" id="2359246">f</span><span class="op" id="2359247">.</span><span class="ident" id="2359248">position</span><span class="op" id="2359256">(</span><span class="ident" id="2359257">p</span><span class="op" id="2359258">,</span>&nbsp;<span class="ident" id="2359260">adjusted</span><span class="op" id="2359268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2359272">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2359275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2359278">return</span><br>
<span class="lineno"></span><span class="op" id="2359285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2359288">//&nbsp;Position&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno">455</span><span class="comment" id="2359355">//&nbsp;Calling&nbsp;s.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;s.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno"></span><span class="comment" id="2359429">//</span><br>
<span class="lineno"></span><span class="keyword" id="2359432">func</span>&nbsp;<span class="op" id="2359437">(</span><span class="ident" id="2359438">s</span>&nbsp;<span class="op" id="2359440">*</span><span class="ident" id="2359441">FileSet</span><span class="op" id="2359448">)</span>&nbsp;<span class="ident" id="2359450">Position</span><span class="op" id="2359458">(</span><span class="ident" id="2359459">p</span>&nbsp;<span class="ident" id="2359461">Pos</span><span class="op" id="2359464">)</span>&nbsp;<span class="op" id="2359466">(</span><span class="ident" id="2359467">pos</span>&nbsp;<span class="ident" id="2359471">Position</span><span class="op" id="2359479">)</span>&nbsp;<span class="op" id="2359481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2359484">return</span>&nbsp;<span class="ident" id="2359491">s</span><span class="op" id="2359492">.</span><span class="ident" id="2359493">PositionFor</span><span class="op" id="2359504">(</span><span class="ident" id="2359505">p</span><span class="op" id="2359506">,</span>&nbsp;<span class="builtintype" id="2359508">true</span><span class="op" id="2359512">)</span><br>
<span class="lineno"></span><span class="op" id="2359514">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="2359517">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="2359598">//&nbsp;Helper&nbsp;functions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2359619">func</span>&nbsp;<span class="ident" id="2359624">searchInts</span><span class="op" id="2359634">(</span><span class="ident" id="2359635">a</span>&nbsp;<span class="op" id="2359637">[</span><span class="op" id="2359638">]</span><span class="builtintype" id="2359639">int</span><span class="op" id="2359642">,</span>&nbsp;<span class="ident" id="2359644">x</span>&nbsp;<span class="builtintype" id="2359646">int</span><span class="op" id="2359649">)</span>&nbsp;<span class="builtintype" id="2359651">int</span>&nbsp;<span class="op" id="2359655">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2359658">//&nbsp;This&nbsp;function&nbsp;body&nbsp;is&nbsp;a&nbsp;manually&nbsp;inlined&nbsp;version&nbsp;of:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2359715">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2359719">//&nbsp;&nbsp;&nbsp;return&nbsp;sort.Search(len(a),&nbsp;func(i&nbsp;int)&nbsp;bool&nbsp;{&nbsp;return&nbsp;a[i]&nbsp;&gt;&nbsp;x&nbsp;})&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2359794">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2359798">//&nbsp;With&nbsp;better&nbsp;compiler&nbsp;optimizations,&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;needed&nbsp;in&nbsp;the</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2359868">//&nbsp;future,&nbsp;but&nbsp;at&nbsp;the&nbsp;moment&nbsp;this&nbsp;change&nbsp;improves&nbsp;the&nbsp;go/printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2359934">//&nbsp;benchmark&nbsp;performance&nbsp;by&nbsp;~30%.&nbsp;This&nbsp;has&nbsp;a&nbsp;direct&nbsp;impact&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2360001">//&nbsp;speed&nbsp;of&nbsp;gofmt&nbsp;and&nbsp;thus&nbsp;seems&nbsp;worthwhile&nbsp;(2011-04-29).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2360060">//&nbsp;TODO(gri):&nbsp;Remove&nbsp;this&nbsp;when&nbsp;compilers&nbsp;have&nbsp;caught&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360118">i</span><span class="op" id="2360119">,</span>&nbsp;<span class="ident" id="2360121">j</span>&nbsp;<span class="op" id="2360123">:=</span>&nbsp;<span class="num" id="2360126">0</span><span class="op" id="2360127">,</span>&nbsp;<span class="builtinfunc" id="2360129">len</span><span class="op" id="2360132">(</span><span class="ident" id="2360133">a</span><span class="op" id="2360134">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2360137">for</span>&nbsp;<span class="ident" id="2360141">i</span>&nbsp;<span class="op" id="2360143">&lt;</span>&nbsp;<span class="ident" id="2360145">j</span>&nbsp;<span class="op" id="2360147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360151">h</span>&nbsp;<span class="op" id="2360153">:=</span>&nbsp;<span class="ident" id="2360156">i</span>&nbsp;<span class="op" id="2360158">+</span>&nbsp;<span class="op" id="2360160">(</span><span class="ident" id="2360161">j</span><span class="op" id="2360162">-</span><span class="ident" id="2360163">i</span><span class="op" id="2360164">)</span><span class="op" id="2360165">/</span><span class="num" id="2360166">2</span>&nbsp;<span class="comment" id="2360168">//&nbsp;avoid&nbsp;overflow&nbsp;when&nbsp;computing&nbsp;h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2360205">//&nbsp;i&nbsp;≤&nbsp;h&nbsp;&lt;&nbsp;j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2360222">if</span>&nbsp;<span class="ident" id="2360225">a</span><span class="op" id="2360226">[</span><span class="ident" id="2360227">h</span><span class="op" id="2360228">]</span>&nbsp;<span class="op" id="2360230">&lt;=</span>&nbsp;<span class="ident" id="2360233">x</span>&nbsp;<span class="op" id="2360235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360240">i</span>&nbsp;<span class="op" id="2360242">=</span>&nbsp;<span class="ident" id="2360244">h</span>&nbsp;<span class="op" id="2360246">+</span>&nbsp;<span class="num" id="2360248">1</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2360252">}</span>&nbsp;<span class="keyword" id="2360254">else</span>&nbsp;<span class="op" id="2360259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360264">j</span>&nbsp;<span class="op" id="2360266">=</span>&nbsp;<span class="ident" id="2360268">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2360272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2360275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2360278">return</span>&nbsp;<span class="ident" id="2360285">i</span>&nbsp;<span class="op" id="2360287">-</span>&nbsp;<span class="num" id="2360289">1</span><br>
<span class="lineno">485</span><span class="op" id="2360291">}</span>
</div>
</body>
</html>
