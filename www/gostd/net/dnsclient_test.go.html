<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8188370">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8188425">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8188479">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8188530">package</span>&nbsp;<span class="ident" id="8188538">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8188543">import</span>&nbsp;<span class="op" id="8188550">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8188553">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8188566">&#34;testing&#34;</span><br>
<span class="lineno">10</span><span class="op" id="8188576">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8188579">func</span>&nbsp;<span class="ident" id="8188584">checkDistribution</span><span class="op" id="8188601">(</span><span class="ident" id="8188602">t</span>&nbsp;<span class="op" id="8188604">*</span><span class="ident" id="8188605">testing</span><span class="op" id="8188612">.</span><span class="ident" id="8188613">T</span><span class="op" id="8188614">,</span>&nbsp;<span class="ident" id="8188616">data</span>&nbsp;<span class="op" id="8188621">[</span><span class="op" id="8188622">]</span><span class="op" id="8188623">*</span><span class="ident" id="8188624">SRV</span><span class="op" id="8188627">,</span>&nbsp;<span class="ident" id="8188629">margin</span>&nbsp;<span class="builtintype" id="8188636">float64</span><span class="op" id="8188643">)</span>&nbsp;<span class="op" id="8188645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188648">sum</span>&nbsp;<span class="op" id="8188652">:=</span>&nbsp;<span class="num" id="8188655">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188658">for</span>&nbsp;<span class="ident" id="8188662">_</span><span class="op" id="8188663">,</span>&nbsp;<span class="ident" id="8188665">srv</span>&nbsp;<span class="op" id="8188669">:=</span>&nbsp;<span class="keyword" id="8188672">range</span>&nbsp;<span class="ident" id="8188678">data</span>&nbsp;<span class="op" id="8188683">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188687">sum</span>&nbsp;<span class="op" id="8188691">+=</span>&nbsp;<span class="builtintype" id="8188694">int</span><span class="op" id="8188697">(</span><span class="ident" id="8188698">srv</span><span class="op" id="8188701">.</span><span class="ident" id="8188702">Weight</span><span class="op" id="8188708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188715">results</span>&nbsp;<span class="op" id="8188723">:=</span>&nbsp;<span class="builtinfunc" id="8188726">make</span><span class="op" id="8188730">(</span><span class="keyword" id="8188731">map</span><span class="op" id="8188734">[</span><span class="builtintype" id="8188735">string</span><span class="op" id="8188741">]</span><span class="builtintype" id="8188742">int</span><span class="op" id="8188745">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188749">count</span>&nbsp;<span class="op" id="8188755">:=</span>&nbsp;<span class="num" id="8188758">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188764">for</span>&nbsp;<span class="ident" id="8188768">j</span>&nbsp;<span class="op" id="8188770">:=</span>&nbsp;<span class="num" id="8188773">0</span><span class="op" id="8188774">;</span>&nbsp;<span class="ident" id="8188776">j</span>&nbsp;<span class="op" id="8188778">&lt;</span>&nbsp;<span class="ident" id="8188780">count</span><span class="op" id="8188785">;</span>&nbsp;<span class="ident" id="8188787">j</span><span class="op" id="8188788">++</span>&nbsp;<span class="op" id="8188791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188795">d</span>&nbsp;<span class="op" id="8188797">:=</span>&nbsp;<span class="builtinfunc" id="8188800">make</span><span class="op" id="8188804">(</span><span class="op" id="8188805">[</span><span class="op" id="8188806">]</span><span class="op" id="8188807">*</span><span class="ident" id="8188808">SRV</span><span class="op" id="8188811">,</span>&nbsp;<span class="builtinfunc" id="8188813">len</span><span class="op" id="8188816">(</span><span class="ident" id="8188817">data</span><span class="op" id="8188821">)</span><span class="op" id="8188822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8188826">copy</span><span class="op" id="8188830">(</span><span class="ident" id="8188831">d</span><span class="op" id="8188832">,</span>&nbsp;<span class="ident" id="8188834">data</span><span class="op" id="8188838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188842">byPriorityWeight</span><span class="op" id="8188858">(</span><span class="ident" id="8188859">d</span><span class="op" id="8188860">)</span><span class="op" id="8188861">.</span><span class="ident" id="8188862">shuffleByWeight</span><span class="op" id="8188877">(</span><span class="op" id="8188878">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188882">key</span>&nbsp;<span class="op" id="8188886">:=</span>&nbsp;<span class="ident" id="8188889">d</span><span class="op" id="8188890">[</span><span class="num" id="8188891">0</span><span class="op" id="8188892">]</span><span class="op" id="8188893">.</span><span class="ident" id="8188894">Target</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188903">results</span><span class="op" id="8188910">[</span><span class="ident" id="8188911">key</span><span class="op" id="8188914">]</span>&nbsp;<span class="op" id="8188916">=</span>&nbsp;<span class="ident" id="8188918">results</span><span class="op" id="8188925">[</span><span class="ident" id="8188926">key</span><span class="op" id="8188929">]</span>&nbsp;<span class="op" id="8188931">+</span>&nbsp;<span class="num" id="8188933">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188940">actual</span>&nbsp;<span class="op" id="8188947">:=</span>&nbsp;<span class="ident" id="8188950">results</span><span class="op" id="8188957">[</span><span class="ident" id="8188958">data</span><span class="op" id="8188962">[</span><span class="num" id="8188963">0</span><span class="op" id="8188964">]</span><span class="op" id="8188965">.</span><span class="ident" id="8188966">Target</span><span class="op" id="8188972">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188975">expected</span>&nbsp;<span class="op" id="8188984">:=</span>&nbsp;<span class="builtintype" id="8188987">float64</span><span class="op" id="8188994">(</span><span class="ident" id="8188995">count</span><span class="op" id="8189000">)</span>&nbsp;<span class="op" id="8189002">*</span>&nbsp;<span class="builtintype" id="8189004">float64</span><span class="op" id="8189011">(</span><span class="ident" id="8189012">data</span><span class="op" id="8189016">[</span><span class="num" id="8189017">0</span><span class="op" id="8189018">]</span><span class="op" id="8189019">.</span><span class="ident" id="8189020">Weight</span><span class="op" id="8189026">)</span>&nbsp;<span class="op" id="8189028">/</span>&nbsp;<span class="builtintype" id="8189030">float64</span><span class="op" id="8189037">(</span><span class="ident" id="8189038">sum</span><span class="op" id="8189041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189044">diff</span>&nbsp;<span class="op" id="8189049">:=</span>&nbsp;<span class="builtintype" id="8189052">float64</span><span class="op" id="8189059">(</span><span class="ident" id="8189060">actual</span><span class="op" id="8189066">)</span>&nbsp;<span class="op" id="8189068">-</span>&nbsp;<span class="ident" id="8189070">expected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189080">t</span><span class="op" id="8189081">.</span><span class="ident" id="8189082">Logf</span><span class="op" id="8189086">(</span><span class="string" id="8189087">&#34;actual:&nbsp;%v&nbsp;diff:&nbsp;%v&nbsp;e:&nbsp;%v&nbsp;m:&nbsp;%v&#34;</span><span class="op" id="8189120">,</span>&nbsp;<span class="ident" id="8189122">actual</span><span class="op" id="8189128">,</span>&nbsp;<span class="ident" id="8189130">diff</span><span class="op" id="8189134">,</span>&nbsp;<span class="ident" id="8189136">expected</span><span class="op" id="8189144">,</span>&nbsp;<span class="ident" id="8189146">margin</span><span class="op" id="8189152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189155">if</span>&nbsp;<span class="ident" id="8189158">diff</span>&nbsp;<span class="op" id="8189163">&lt;</span>&nbsp;<span class="num" id="8189165">0</span>&nbsp;<span class="op" id="8189167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189171">diff</span>&nbsp;<span class="op" id="8189176">=</span>&nbsp;<span class="op" id="8189178">-</span><span class="ident" id="8189179">diff</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189188">if</span>&nbsp;<span class="ident" id="8189191">diff</span>&nbsp;<span class="op" id="8189196">&gt;</span>&nbsp;<span class="op" id="8189198">(</span><span class="ident" id="8189199">expected</span>&nbsp;<span class="op" id="8189208">*</span>&nbsp;<span class="ident" id="8189210">margin</span><span class="op" id="8189216">)</span>&nbsp;<span class="op" id="8189218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189222">t</span><span class="op" id="8189223">.</span><span class="ident" id="8189224">Errorf</span><span class="op" id="8189230">(</span><span class="string" id="8189231">&#34;missed&nbsp;target&nbsp;weight:&nbsp;expected&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8189270">,</span>&nbsp;<span class="ident" id="8189272">expected</span><span class="op" id="8189280">,</span>&nbsp;<span class="ident" id="8189282">actual</span><span class="op" id="8189288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189291">}</span><br>
<span class="lineno"></span><span class="op" id="8189293">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="8189296">func</span>&nbsp;<span class="ident" id="8189301">testUniformity</span><span class="op" id="8189315">(</span><span class="ident" id="8189316">t</span>&nbsp;<span class="op" id="8189318">*</span><span class="ident" id="8189319">testing</span><span class="op" id="8189326">.</span><span class="ident" id="8189327">T</span><span class="op" id="8189328">,</span>&nbsp;<span class="ident" id="8189330">size</span>&nbsp;<span class="builtintype" id="8189335">int</span><span class="op" id="8189338">,</span>&nbsp;<span class="ident" id="8189340">margin</span>&nbsp;<span class="builtintype" id="8189347">float64</span><span class="op" id="8189354">)</span>&nbsp;<span class="op" id="8189356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189359">rand</span><span class="op" id="8189363">.</span><span class="ident" id="8189364">Seed</span><span class="op" id="8189368">(</span><span class="num" id="8189369">1</span><span class="op" id="8189370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189373">data</span>&nbsp;<span class="op" id="8189378">:=</span>&nbsp;<span class="builtinfunc" id="8189381">make</span><span class="op" id="8189385">(</span><span class="op" id="8189386">[</span><span class="op" id="8189387">]</span><span class="op" id="8189388">*</span><span class="ident" id="8189389">SRV</span><span class="op" id="8189392">,</span>&nbsp;<span class="ident" id="8189394">size</span><span class="op" id="8189398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189401">for</span>&nbsp;<span class="ident" id="8189405">i</span>&nbsp;<span class="op" id="8189407">:=</span>&nbsp;<span class="num" id="8189410">0</span><span class="op" id="8189411">;</span>&nbsp;<span class="ident" id="8189413">i</span>&nbsp;<span class="op" id="8189415">&lt;</span>&nbsp;<span class="ident" id="8189417">size</span><span class="op" id="8189421">;</span>&nbsp;<span class="ident" id="8189423">i</span><span class="op" id="8189424">++</span>&nbsp;<span class="op" id="8189427">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189431">data</span><span class="op" id="8189435">[</span><span class="ident" id="8189436">i</span><span class="op" id="8189437">]</span>&nbsp;<span class="op" id="8189439">=</span>&nbsp;<span class="op" id="8189441">&amp;</span><span class="ident" id="8189442">SRV</span><span class="op" id="8189445">{</span><span class="ident" id="8189446">Target</span><span class="op" id="8189452">:</span>&nbsp;<span class="builtintype" id="8189454">string</span><span class="op" id="8189460">(</span><span class="string" id="8189461">&#39;a&#39;</span>&nbsp;<span class="op" id="8189465">+</span>&nbsp;<span class="ident" id="8189467">i</span><span class="op" id="8189468">)</span><span class="op" id="8189469">,</span>&nbsp;<span class="ident" id="8189471">Weight</span><span class="op" id="8189477">:</span>&nbsp;<span class="num" id="8189479">1</span><span class="op" id="8189480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189486">checkDistribution</span><span class="op" id="8189503">(</span><span class="ident" id="8189504">t</span><span class="op" id="8189505">,</span>&nbsp;<span class="ident" id="8189507">data</span><span class="op" id="8189511">,</span>&nbsp;<span class="ident" id="8189513">margin</span><span class="op" id="8189519">)</span><br>
<span class="lineno"></span><span class="op" id="8189521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="8189524">func</span>&nbsp;<span class="ident" id="8189529">TestUniformity</span><span class="op" id="8189543">(</span><span class="ident" id="8189544">t</span>&nbsp;<span class="op" id="8189546">*</span><span class="ident" id="8189547">testing</span><span class="op" id="8189554">.</span><span class="ident" id="8189555">T</span><span class="op" id="8189556">)</span>&nbsp;<span class="op" id="8189558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189561">testUniformity</span><span class="op" id="8189575">(</span><span class="ident" id="8189576">t</span><span class="op" id="8189577">,</span>&nbsp;<span class="num" id="8189579">2</span><span class="op" id="8189580">,</span>&nbsp;<span class="num" id="8189582">0.05</span><span class="op" id="8189586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189589">testUniformity</span><span class="op" id="8189603">(</span><span class="ident" id="8189604">t</span><span class="op" id="8189605">,</span>&nbsp;<span class="num" id="8189607">3</span><span class="op" id="8189608">,</span>&nbsp;<span class="num" id="8189610">0.10</span><span class="op" id="8189614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189617">testUniformity</span><span class="op" id="8189631">(</span><span class="ident" id="8189632">t</span><span class="op" id="8189633">,</span>&nbsp;<span class="num" id="8189635">10</span><span class="op" id="8189637">,</span>&nbsp;<span class="num" id="8189639">0.20</span><span class="op" id="8189643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189646">testWeighting</span><span class="op" id="8189659">(</span><span class="ident" id="8189660">t</span><span class="op" id="8189661">,</span>&nbsp;<span class="num" id="8189663">0.05</span><span class="op" id="8189667">)</span><br>
<span class="lineno">55</span><span class="op" id="8189669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8189672">func</span>&nbsp;<span class="ident" id="8189677">testWeighting</span><span class="op" id="8189690">(</span><span class="ident" id="8189691">t</span>&nbsp;<span class="op" id="8189693">*</span><span class="ident" id="8189694">testing</span><span class="op" id="8189701">.</span><span class="ident" id="8189702">T</span><span class="op" id="8189703">,</span>&nbsp;<span class="ident" id="8189705">margin</span>&nbsp;<span class="builtintype" id="8189712">float64</span><span class="op" id="8189719">)</span>&nbsp;<span class="op" id="8189721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189724">rand</span><span class="op" id="8189728">.</span><span class="ident" id="8189729">Seed</span><span class="op" id="8189733">(</span><span class="num" id="8189734">1</span><span class="op" id="8189735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189738">data</span>&nbsp;<span class="op" id="8189743">:=</span>&nbsp;<span class="op" id="8189746">[</span><span class="op" id="8189747">]</span><span class="op" id="8189748">*</span><span class="ident" id="8189749">SRV</span><span class="op" id="8189752">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189756">{</span><span class="ident" id="8189757">Target</span><span class="op" id="8189763">:</span>&nbsp;<span class="string" id="8189765">&#34;a&#34;</span><span class="op" id="8189768">,</span>&nbsp;<span class="ident" id="8189770">Weight</span><span class="op" id="8189776">:</span>&nbsp;<span class="num" id="8189778">60</span><span class="op" id="8189780">}</span><span class="op" id="8189781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189785">{</span><span class="ident" id="8189786">Target</span><span class="op" id="8189792">:</span>&nbsp;<span class="string" id="8189794">&#34;b&#34;</span><span class="op" id="8189797">,</span>&nbsp;<span class="ident" id="8189799">Weight</span><span class="op" id="8189805">:</span>&nbsp;<span class="num" id="8189807">30</span><span class="op" id="8189809">}</span><span class="op" id="8189810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189814">{</span><span class="ident" id="8189815">Target</span><span class="op" id="8189821">:</span>&nbsp;<span class="string" id="8189823">&#34;c&#34;</span><span class="op" id="8189826">,</span>&nbsp;<span class="ident" id="8189828">Weight</span><span class="op" id="8189834">:</span>&nbsp;<span class="num" id="8189836">10</span><span class="op" id="8189838">}</span><span class="op" id="8189839">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189845">checkDistribution</span><span class="op" id="8189862">(</span><span class="ident" id="8189863">t</span><span class="op" id="8189864">,</span>&nbsp;<span class="ident" id="8189866">data</span><span class="op" id="8189870">,</span>&nbsp;<span class="ident" id="8189872">margin</span><span class="op" id="8189878">)</span><br>
<span class="lineno">65</span><span class="op" id="8189880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8189883">func</span>&nbsp;<span class="ident" id="8189888">TestWeighting</span><span class="op" id="8189901">(</span><span class="ident" id="8189902">t</span>&nbsp;<span class="op" id="8189904">*</span><span class="ident" id="8189905">testing</span><span class="op" id="8189912">.</span><span class="ident" id="8189913">T</span><span class="op" id="8189914">)</span>&nbsp;<span class="op" id="8189916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189919">testWeighting</span><span class="op" id="8189932">(</span><span class="ident" id="8189933">t</span><span class="op" id="8189934">,</span>&nbsp;<span class="num" id="8189936">0.05</span><span class="op" id="8189940">)</span><br>
<span class="lineno"></span><span class="op" id="8189942">}</span>
</div>
</body>
</html>
