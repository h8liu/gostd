<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/url</h2>
<ul>
<li><a href="/gostd/net/url/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/url/url.go.html" class="current">url.go</a></li>
<li><a href="/gostd/net/url/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3629264">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3629319">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3629373">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3629424">//&nbsp;Package&nbsp;url&nbsp;parses&nbsp;URLs&nbsp;and&nbsp;implements&nbsp;query&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="comment" id="3629482">//&nbsp;See&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3629499">package</span>&nbsp;<span class="ident" id="3629507">url</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3629512">import</span>&nbsp;<span class="op" id="3629519">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3629522">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3629531">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3629541">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3629549">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3629560">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3629570">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3629573">//&nbsp;Error&nbsp;reports&nbsp;an&nbsp;error&nbsp;and&nbsp;the&nbsp;operation&nbsp;and&nbsp;URL&nbsp;that&nbsp;caused&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3629641">type</span>&nbsp;<span class="ident" id="3629646">Error</span>&nbsp;<span class="keyword" id="3629652">struct</span>&nbsp;<span class="op" id="3629659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3629662">Op</span>&nbsp;&nbsp;<span class="builtintype" id="3629666">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3629674">URL</span>&nbsp;<span class="builtintype" id="3629678">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3629686">Err</span>&nbsp;<span class="builtintype" id="3629690">error</span><br>
<span class="lineno"></span><span class="op" id="3629696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3629699">func</span>&nbsp;<span class="op" id="3629704">(</span><span class="ident" id="3629705">e</span>&nbsp;<span class="op" id="3629707">*</span><span class="ident" id="3629708">Error</span><span class="op" id="3629713">)</span>&nbsp;<span class="ident" id="3629715">Error</span><span class="op" id="3629720">(</span><span class="op" id="3629721">)</span>&nbsp;<span class="builtintype" id="3629723">string</span>&nbsp;<span class="op" id="3629730">{</span>&nbsp;<span class="keyword" id="3629732">return</span>&nbsp;<span class="ident" id="3629739">e</span><span class="op" id="3629740">.</span><span class="ident" id="3629741">Op</span>&nbsp;<span class="op" id="3629744">+</span>&nbsp;<span class="string" id="3629746">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3629750">+</span>&nbsp;<span class="ident" id="3629752">e</span><span class="op" id="3629753">.</span><span class="ident" id="3629754">URL</span>&nbsp;<span class="op" id="3629758">+</span>&nbsp;<span class="string" id="3629760">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3629765">+</span>&nbsp;<span class="ident" id="3629767">e</span><span class="op" id="3629768">.</span><span class="ident" id="3629769">Err</span><span class="op" id="3629772">.</span><span class="ident" id="3629773">Error</span><span class="op" id="3629778">(</span><span class="op" id="3629779">)</span>&nbsp;<span class="op" id="3629781">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3629784">func</span>&nbsp;<span class="ident" id="3629789">ishex</span><span class="op" id="3629794">(</span><span class="ident" id="3629795">c</span>&nbsp;<span class="builtintype" id="3629797">byte</span><span class="op" id="3629801">)</span>&nbsp;<span class="builtintype" id="3629803">bool</span>&nbsp;<span class="op" id="3629808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3629811">switch</span>&nbsp;<span class="op" id="3629818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3629821">case</span>&nbsp;<span class="string" id="3629826">&#39;0&#39;</span>&nbsp;<span class="op" id="3629830">&lt;=</span>&nbsp;<span class="ident" id="3629833">c</span>&nbsp;<span class="op" id="3629835">&amp;&amp;</span>&nbsp;<span class="ident" id="3629838">c</span>&nbsp;<span class="op" id="3629840">&lt;=</span>&nbsp;<span class="string" id="3629843">&#39;9&#39;</span><span class="op" id="3629846">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3629850">return</span>&nbsp;<span class="builtintype" id="3629857">true</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3629863">case</span>&nbsp;<span class="string" id="3629868">&#39;a&#39;</span>&nbsp;<span class="op" id="3629872">&lt;=</span>&nbsp;<span class="ident" id="3629875">c</span>&nbsp;<span class="op" id="3629877">&amp;&amp;</span>&nbsp;<span class="ident" id="3629880">c</span>&nbsp;<span class="op" id="3629882">&lt;=</span>&nbsp;<span class="string" id="3629885">&#39;f&#39;</span><span class="op" id="3629888">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3629892">return</span>&nbsp;<span class="builtintype" id="3629899">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3629905">case</span>&nbsp;<span class="string" id="3629910">&#39;A&#39;</span>&nbsp;<span class="op" id="3629914">&lt;=</span>&nbsp;<span class="ident" id="3629917">c</span>&nbsp;<span class="op" id="3629919">&amp;&amp;</span>&nbsp;<span class="ident" id="3629922">c</span>&nbsp;<span class="op" id="3629924">&lt;=</span>&nbsp;<span class="string" id="3629927">&#39;F&#39;</span><span class="op" id="3629930">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3629934">return</span>&nbsp;<span class="builtintype" id="3629941">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3629947">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3629950">return</span>&nbsp;<span class="builtintype" id="3629957">false</span><br>
<span class="lineno"></span><span class="op" id="3629963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3629966">func</span>&nbsp;<span class="ident" id="3629971">unhex</span><span class="op" id="3629976">(</span><span class="ident" id="3629977">c</span>&nbsp;<span class="builtintype" id="3629979">byte</span><span class="op" id="3629983">)</span>&nbsp;<span class="builtintype" id="3629985">byte</span>&nbsp;<span class="op" id="3629990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3629993">switch</span>&nbsp;<span class="op" id="3630000">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3630003">case</span>&nbsp;<span class="string" id="3630008">&#39;0&#39;</span>&nbsp;<span class="op" id="3630012">&lt;=</span>&nbsp;<span class="ident" id="3630015">c</span>&nbsp;<span class="op" id="3630017">&amp;&amp;</span>&nbsp;<span class="ident" id="3630020">c</span>&nbsp;<span class="op" id="3630022">&lt;=</span>&nbsp;<span class="string" id="3630025">&#39;9&#39;</span><span class="op" id="3630028">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3630032">return</span>&nbsp;<span class="ident" id="3630039">c</span>&nbsp;<span class="op" id="3630041">-</span>&nbsp;<span class="string" id="3630043">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3630048">case</span>&nbsp;<span class="string" id="3630053">&#39;a&#39;</span>&nbsp;<span class="op" id="3630057">&lt;=</span>&nbsp;<span class="ident" id="3630060">c</span>&nbsp;<span class="op" id="3630062">&amp;&amp;</span>&nbsp;<span class="ident" id="3630065">c</span>&nbsp;<span class="op" id="3630067">&lt;=</span>&nbsp;<span class="string" id="3630070">&#39;f&#39;</span><span class="op" id="3630073">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3630077">return</span>&nbsp;<span class="ident" id="3630084">c</span>&nbsp;<span class="op" id="3630086">-</span>&nbsp;<span class="string" id="3630088">&#39;a&#39;</span>&nbsp;<span class="op" id="3630092">+</span>&nbsp;<span class="num" id="3630094">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3630098">case</span>&nbsp;<span class="string" id="3630103">&#39;A&#39;</span>&nbsp;<span class="op" id="3630107">&lt;=</span>&nbsp;<span class="ident" id="3630110">c</span>&nbsp;<span class="op" id="3630112">&amp;&amp;</span>&nbsp;<span class="ident" id="3630115">c</span>&nbsp;<span class="op" id="3630117">&lt;=</span>&nbsp;<span class="string" id="3630120">&#39;F&#39;</span><span class="op" id="3630123">:</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3630127">return</span>&nbsp;<span class="ident" id="3630134">c</span>&nbsp;<span class="op" id="3630136">-</span>&nbsp;<span class="string" id="3630138">&#39;A&#39;</span>&nbsp;<span class="op" id="3630142">+</span>&nbsp;<span class="num" id="3630144">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3630148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3630151">return</span>&nbsp;<span class="num" id="3630158">0</span><br>
<span class="lineno"></span><span class="op" id="3630160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="3630163">type</span>&nbsp;<span class="ident" id="3630168">encoding</span>&nbsp;<span class="builtintype" id="3630177">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3630182">const</span>&nbsp;<span class="op" id="3630188">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3630191">encodePath</span>&nbsp;<span class="ident" id="3630202">encoding</span>&nbsp;<span class="op" id="3630211">=</span>&nbsp;<span class="num" id="3630213">1</span>&nbsp;<span class="op" id="3630215">+</span>&nbsp;<span class="ident" id="3630217">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3630223">encodeUserPassword</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3630243">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3630265">encodeFragment</span><br>
<span class="lineno"></span><span class="op" id="3630280">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3630283">type</span>&nbsp;<span class="ident" id="3630288">EscapeError</span>&nbsp;<span class="builtintype" id="3630300">string</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3630308">func</span>&nbsp;<span class="op" id="3630313">(</span><span class="ident" id="3630314">e</span>&nbsp;<span class="ident" id="3630316">EscapeError</span><span class="op" id="3630327">)</span>&nbsp;<span class="ident" id="3630329">Error</span><span class="op" id="3630334">(</span><span class="op" id="3630335">)</span>&nbsp;<span class="builtintype" id="3630337">string</span>&nbsp;<span class="op" id="3630344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3630347">return</span>&nbsp;<span class="string" id="3630354">&#34;invalid&nbsp;URL&nbsp;escape&nbsp;&#34;</span>&nbsp;<span class="op" id="3630376">+</span>&nbsp;<span class="ident" id="3630378">strconv</span><span class="op" id="3630385">.</span><span class="ident" id="3630386">Quote</span><span class="op" id="3630391">(</span><span class="builtintype" id="3630392">string</span><span class="op" id="3630398">(</span><span class="ident" id="3630399">e</span><span class="op" id="3630400">)</span><span class="op" id="3630401">)</span><br>
<span class="lineno"></span><span class="op" id="3630403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3630406">//&nbsp;Return&nbsp;true&nbsp;if&nbsp;the&nbsp;specified&nbsp;character&nbsp;should&nbsp;be&nbsp;escaped&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="3630471">//&nbsp;appearing&nbsp;in&nbsp;a&nbsp;URL&nbsp;string,&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3630524">func</span>&nbsp;<span class="ident" id="3630529">shouldEscape</span><span class="op" id="3630541">(</span><span class="ident" id="3630542">c</span>&nbsp;<span class="builtintype" id="3630544">byte</span><span class="op" id="3630548">,</span>&nbsp;<span class="ident" id="3630550">mode</span>&nbsp;<span class="ident" id="3630555">encoding</span><span class="op" id="3630563">)</span>&nbsp;<span class="builtintype" id="3630565">bool</span>&nbsp;<span class="op" id="3630570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3630573">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(alphanum)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3630616">if</span>&nbsp;<span class="string" id="3630619">&#39;A&#39;</span>&nbsp;<span class="op" id="3630623">&lt;=</span>&nbsp;<span class="ident" id="3630626">c</span>&nbsp;<span class="op" id="3630628">&amp;&amp;</span>&nbsp;<span class="ident" id="3630631">c</span>&nbsp;<span class="op" id="3630633">&lt;=</span>&nbsp;<span class="string" id="3630636">&#39;Z&#39;</span>&nbsp;<span class="op" id="3630640">||</span>&nbsp;<span class="string" id="3630643">&#39;a&#39;</span>&nbsp;<span class="op" id="3630647">&lt;=</span>&nbsp;<span class="ident" id="3630650">c</span>&nbsp;<span class="op" id="3630652">&amp;&amp;</span>&nbsp;<span class="ident" id="3630655">c</span>&nbsp;<span class="op" id="3630657">&lt;=</span>&nbsp;<span class="string" id="3630660">&#39;z&#39;</span>&nbsp;<span class="op" id="3630664">||</span>&nbsp;<span class="string" id="3630667">&#39;0&#39;</span>&nbsp;<span class="op" id="3630671">&lt;=</span>&nbsp;<span class="ident" id="3630674">c</span>&nbsp;<span class="op" id="3630676">&amp;&amp;</span>&nbsp;<span class="ident" id="3630679">c</span>&nbsp;<span class="op" id="3630681">&lt;=</span>&nbsp;<span class="string" id="3630684">&#39;9&#39;</span>&nbsp;<span class="op" id="3630688">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3630692">return</span>&nbsp;<span class="builtintype" id="3630699">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3630706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3630710">switch</span>&nbsp;<span class="ident" id="3630717">c</span>&nbsp;<span class="op" id="3630719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3630722">case</span>&nbsp;<span class="string" id="3630727">&#39;-&#39;</span><span class="op" id="3630730">,</span>&nbsp;<span class="string" id="3630732">&#39;_&#39;</span><span class="op" id="3630735">,</span>&nbsp;<span class="string" id="3630737">&#39;.&#39;</span><span class="op" id="3630740">,</span>&nbsp;<span class="string" id="3630742">&#39;~&#39;</span><span class="op" id="3630745">:</span>&nbsp;<span class="comment" id="3630747">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(mark)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3630787">return</span>&nbsp;<span class="builtintype" id="3630794">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3630802">case</span>&nbsp;<span class="string" id="3630807">&#39;$&#39;</span><span class="op" id="3630810">,</span>&nbsp;<span class="string" id="3630812">&#39;&amp;&#39;</span><span class="op" id="3630815">,</span>&nbsp;<span class="string" id="3630817">&#39;+&#39;</span><span class="op" id="3630820">,</span>&nbsp;<span class="string" id="3630822">&#39;,&#39;</span><span class="op" id="3630825">,</span>&nbsp;<span class="string" id="3630827">&#39;/&#39;</span><span class="op" id="3630830">,</span>&nbsp;<span class="string" id="3630832">&#39;:&#39;</span><span class="op" id="3630835">,</span>&nbsp;<span class="string" id="3630837">&#39;;&#39;</span><span class="op" id="3630840">,</span>&nbsp;<span class="string" id="3630842">&#39;=&#39;</span><span class="op" id="3630845">,</span>&nbsp;<span class="string" id="3630847">&#39;?&#39;</span><span class="op" id="3630850">,</span>&nbsp;<span class="string" id="3630852">&#39;@&#39;</span><span class="op" id="3630855">:</span>&nbsp;<span class="comment" id="3630857">//&nbsp;§2.2&nbsp;Reserved&nbsp;characters&nbsp;(reserved)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3630899">//&nbsp;Different&nbsp;sections&nbsp;of&nbsp;the&nbsp;URL&nbsp;allow&nbsp;a&nbsp;few&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3630949">//&nbsp;the&nbsp;reserved&nbsp;characters&nbsp;to&nbsp;appear&nbsp;unescaped.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3630999">switch</span>&nbsp;<span class="ident" id="3631006">mode</span>&nbsp;<span class="op" id="3631011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3631015">case</span>&nbsp;<span class="ident" id="3631020">encodePath</span><span class="op" id="3631030">:</span>&nbsp;<span class="comment" id="3631032">//&nbsp;§3.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3631044">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;:&nbsp;@&nbsp;&amp;&nbsp;=&nbsp;+&nbsp;$&nbsp;but&nbsp;saves&nbsp;/&nbsp;;&nbsp;,&nbsp;for&nbsp;assigning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3631107">//&nbsp;meaning&nbsp;to&nbsp;individual&nbsp;path&nbsp;segments.&nbsp;This&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3631163">//&nbsp;only&nbsp;manipulates&nbsp;the&nbsp;path&nbsp;as&nbsp;a&nbsp;whole,&nbsp;so&nbsp;we&nbsp;allow&nbsp;those</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3631225">//&nbsp;last&nbsp;two&nbsp;as&nbsp;well.&nbsp;That&nbsp;leaves&nbsp;only&nbsp;?&nbsp;to&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3631279">return</span>&nbsp;<span class="ident" id="3631286">c</span>&nbsp;<span class="op" id="3631288">==</span>&nbsp;<span class="string" id="3631291">&#39;?&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3631298">case</span>&nbsp;<span class="ident" id="3631303">encodeUserPassword</span><span class="op" id="3631321">:</span>&nbsp;<span class="comment" id="3631323">//&nbsp;§3.2.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3631337">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;&#39;;&#39;,&nbsp;&#39;:&#39;,&nbsp;&#39;&amp;&#39;,&nbsp;&#39;=&#39;,&nbsp;&#39;+&#39;,&nbsp;&#39;$&#39;,&nbsp;and&nbsp;&#39;,&#39;&nbsp;in</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3631399">//&nbsp;userinfo,&nbsp;so&nbsp;we&nbsp;must&nbsp;escape&nbsp;only&nbsp;&#39;@&#39;,&nbsp;&#39;/&#39;,&nbsp;and&nbsp;&#39;?&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3631457">//&nbsp;The&nbsp;parsing&nbsp;of&nbsp;userinfo&nbsp;treats&nbsp;&#39;:&#39;&nbsp;as&nbsp;special&nbsp;so&nbsp;we&nbsp;must&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3631527">//&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3631543">return</span>&nbsp;<span class="ident" id="3631550">c</span>&nbsp;<span class="op" id="3631552">==</span>&nbsp;<span class="string" id="3631555">&#39;@&#39;</span>&nbsp;<span class="op" id="3631559">||</span>&nbsp;<span class="ident" id="3631562">c</span>&nbsp;<span class="op" id="3631564">==</span>&nbsp;<span class="string" id="3631567">&#39;/&#39;</span>&nbsp;<span class="op" id="3631571">||</span>&nbsp;<span class="ident" id="3631574">c</span>&nbsp;<span class="op" id="3631576">==</span>&nbsp;<span class="string" id="3631579">&#39;?&#39;</span>&nbsp;<span class="op" id="3631583">||</span>&nbsp;<span class="ident" id="3631586">c</span>&nbsp;<span class="op" id="3631588">==</span>&nbsp;<span class="string" id="3631591">&#39;:&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3631598">case</span>&nbsp;<span class="ident" id="3631603">encodeQueryComponent</span><span class="op" id="3631623">:</span>&nbsp;<span class="comment" id="3631625">//&nbsp;§3.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3631637">//&nbsp;The&nbsp;RFC&nbsp;reserves&nbsp;(so&nbsp;we&nbsp;must&nbsp;escape)&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3631692">return</span>&nbsp;<span class="builtintype" id="3631699">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3631707">case</span>&nbsp;<span class="ident" id="3631712">encodeFragment</span><span class="op" id="3631726">:</span>&nbsp;<span class="comment" id="3631728">//&nbsp;§4.1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3631740">//&nbsp;The&nbsp;RFC&nbsp;text&nbsp;is&nbsp;silent&nbsp;but&nbsp;the&nbsp;grammar&nbsp;allows</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3631792">//&nbsp;everything,&nbsp;so&nbsp;escape&nbsp;nothing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3631829">return</span>&nbsp;<span class="builtintype" id="3631836">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3631844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3631847">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3631851">//&nbsp;Everything&nbsp;else&nbsp;must&nbsp;be&nbsp;escaped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3631888">return</span>&nbsp;<span class="builtintype" id="3631895">true</span><br>
<span class="lineno"></span><span class="op" id="3631900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="3631903">//&nbsp;QueryUnescape&nbsp;does&nbsp;the&nbsp;inverse&nbsp;transformation&nbsp;of&nbsp;QueryEscape,&nbsp;converting</span><br>
<span class="lineno"></span><span class="comment" id="3631979">//&nbsp;%AB&nbsp;into&nbsp;the&nbsp;byte&nbsp;0xAB&nbsp;and&nbsp;&#39;+&#39;&nbsp;into&nbsp;&#39;&nbsp;&#39;&nbsp;(space).&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3632054">//&nbsp;any&nbsp;%&nbsp;is&nbsp;not&nbsp;followed&nbsp;by&nbsp;two&nbsp;hexadecimal&nbsp;digits.</span><br>
<span class="lineno"></span><span class="keyword" id="3632106">func</span>&nbsp;<span class="ident" id="3632111">QueryUnescape</span><span class="op" id="3632124">(</span><span class="ident" id="3632125">s</span>&nbsp;<span class="builtintype" id="3632127">string</span><span class="op" id="3632133">)</span>&nbsp;<span class="op" id="3632135">(</span><span class="builtintype" id="3632136">string</span><span class="op" id="3632142">,</span>&nbsp;<span class="builtintype" id="3632144">error</span><span class="op" id="3632149">)</span>&nbsp;<span class="op" id="3632151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632154">return</span>&nbsp;<span class="ident" id="3632161">unescape</span><span class="op" id="3632169">(</span><span class="ident" id="3632170">s</span><span class="op" id="3632171">,</span>&nbsp;<span class="ident" id="3632173">encodeQueryComponent</span><span class="op" id="3632193">)</span><br>
<span class="lineno">115</span><span class="op" id="3632195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3632198">//&nbsp;unescape&nbsp;unescapes&nbsp;a&nbsp;string;&nbsp;the&nbsp;mode&nbsp;specifies</span><br>
<span class="lineno"></span><span class="comment" id="3632249">//&nbsp;which&nbsp;section&nbsp;of&nbsp;the&nbsp;URL&nbsp;string&nbsp;is&nbsp;being&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="3632304">func</span>&nbsp;<span class="ident" id="3632309">unescape</span><span class="op" id="3632317">(</span><span class="ident" id="3632318">s</span>&nbsp;<span class="builtintype" id="3632320">string</span><span class="op" id="3632326">,</span>&nbsp;<span class="ident" id="3632328">mode</span>&nbsp;<span class="ident" id="3632333">encoding</span><span class="op" id="3632341">)</span>&nbsp;<span class="op" id="3632343">(</span><span class="builtintype" id="3632344">string</span><span class="op" id="3632350">,</span>&nbsp;<span class="builtintype" id="3632352">error</span><span class="op" id="3632357">)</span>&nbsp;<span class="op" id="3632359">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3632362">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632407">n</span>&nbsp;<span class="op" id="3632409">:=</span>&nbsp;<span class="num" id="3632412">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632415">hasPlus</span>&nbsp;<span class="op" id="3632423">:=</span>&nbsp;<span class="builtintype" id="3632426">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632433">for</span>&nbsp;<span class="ident" id="3632437">i</span>&nbsp;<span class="op" id="3632439">:=</span>&nbsp;<span class="num" id="3632442">0</span><span class="op" id="3632443">;</span>&nbsp;<span class="ident" id="3632445">i</span>&nbsp;<span class="op" id="3632447">&lt;</span>&nbsp;<span class="builtinfunc" id="3632449">len</span><span class="op" id="3632452">(</span><span class="ident" id="3632453">s</span><span class="op" id="3632454">)</span><span class="op" id="3632455">;</span>&nbsp;<span class="op" id="3632457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632461">switch</span>&nbsp;<span class="ident" id="3632468">s</span><span class="op" id="3632469">[</span><span class="ident" id="3632470">i</span><span class="op" id="3632471">]</span>&nbsp;<span class="op" id="3632473">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632477">case</span>&nbsp;<span class="string" id="3632482">&#39;%&#39;</span><span class="op" id="3632485">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632490">n</span><span class="op" id="3632491">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632497">if</span>&nbsp;<span class="ident" id="3632500">i</span><span class="op" id="3632501">+</span><span class="num" id="3632502">2</span>&nbsp;<span class="op" id="3632504">&gt;=</span>&nbsp;<span class="builtinfunc" id="3632507">len</span><span class="op" id="3632510">(</span><span class="ident" id="3632511">s</span><span class="op" id="3632512">)</span>&nbsp;<span class="op" id="3632514">||</span>&nbsp;<span class="op" id="3632517">!</span><span class="ident" id="3632518">ishex</span><span class="op" id="3632523">(</span><span class="ident" id="3632524">s</span><span class="op" id="3632525">[</span><span class="ident" id="3632526">i</span><span class="op" id="3632527">+</span><span class="num" id="3632528">1</span><span class="op" id="3632529">]</span><span class="op" id="3632530">)</span>&nbsp;<span class="op" id="3632532">||</span>&nbsp;<span class="op" id="3632535">!</span><span class="ident" id="3632536">ishex</span><span class="op" id="3632541">(</span><span class="ident" id="3632542">s</span><span class="op" id="3632543">[</span><span class="ident" id="3632544">i</span><span class="op" id="3632545">+</span><span class="num" id="3632546">2</span><span class="op" id="3632547">]</span><span class="op" id="3632548">)</span>&nbsp;<span class="op" id="3632550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632556">s</span>&nbsp;<span class="op" id="3632558">=</span>&nbsp;<span class="ident" id="3632560">s</span><span class="op" id="3632561">[</span><span class="ident" id="3632562">i</span><span class="op" id="3632563">:</span><span class="op" id="3632564">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632570">if</span>&nbsp;<span class="builtinfunc" id="3632573">len</span><span class="op" id="3632576">(</span><span class="ident" id="3632577">s</span><span class="op" id="3632578">)</span>&nbsp;<span class="op" id="3632580">&gt;</span>&nbsp;<span class="num" id="3632582">3</span>&nbsp;<span class="op" id="3632584">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632591">s</span>&nbsp;<span class="op" id="3632593">=</span>&nbsp;<span class="ident" id="3632595">s</span><span class="op" id="3632596">[</span><span class="num" id="3632597">0</span><span class="op" id="3632598">:</span><span class="num" id="3632599">3</span><span class="op" id="3632600">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3632606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632612">return</span>&nbsp;<span class="string" id="3632619">&#34;&#34;</span><span class="op" id="3632621">,</span>&nbsp;<span class="ident" id="3632623">EscapeError</span><span class="op" id="3632634">(</span><span class="ident" id="3632635">s</span><span class="op" id="3632636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3632641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632646">i</span>&nbsp;<span class="op" id="3632648">+=</span>&nbsp;<span class="num" id="3632651">3</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632655">case</span>&nbsp;<span class="string" id="3632660">&#39;+&#39;</span><span class="op" id="3632663">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632668">hasPlus</span>&nbsp;<span class="op" id="3632676">=</span>&nbsp;<span class="ident" id="3632678">mode</span>&nbsp;<span class="op" id="3632683">==</span>&nbsp;<span class="ident" id="3632686">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632710">i</span><span class="op" id="3632711">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632716">default</span><span class="op" id="3632723">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632728">i</span><span class="op" id="3632729">++</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3632734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3632737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632741">if</span>&nbsp;<span class="ident" id="3632744">n</span>&nbsp;<span class="op" id="3632746">==</span>&nbsp;<span class="num" id="3632749">0</span>&nbsp;<span class="op" id="3632751">&amp;&amp;</span>&nbsp;<span class="op" id="3632754">!</span><span class="ident" id="3632755">hasPlus</span>&nbsp;<span class="op" id="3632763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632767">return</span>&nbsp;<span class="ident" id="3632774">s</span><span class="op" id="3632775">,</span>&nbsp;<span class="ident" id="3632777">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3632782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632786">t</span>&nbsp;<span class="op" id="3632788">:=</span>&nbsp;<span class="builtinfunc" id="3632791">make</span><span class="op" id="3632795">(</span><span class="op" id="3632796">[</span><span class="op" id="3632797">]</span><span class="builtintype" id="3632798">byte</span><span class="op" id="3632802">,</span>&nbsp;<span class="builtinfunc" id="3632804">len</span><span class="op" id="3632807">(</span><span class="ident" id="3632808">s</span><span class="op" id="3632809">)</span><span class="op" id="3632810">-</span><span class="num" id="3632811">2</span><span class="op" id="3632812">*</span><span class="ident" id="3632813">n</span><span class="op" id="3632814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632817">j</span>&nbsp;<span class="op" id="3632819">:=</span>&nbsp;<span class="num" id="3632822">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632825">for</span>&nbsp;<span class="ident" id="3632829">i</span>&nbsp;<span class="op" id="3632831">:=</span>&nbsp;<span class="num" id="3632834">0</span><span class="op" id="3632835">;</span>&nbsp;<span class="ident" id="3632837">i</span>&nbsp;<span class="op" id="3632839">&lt;</span>&nbsp;<span class="builtinfunc" id="3632841">len</span><span class="op" id="3632844">(</span><span class="ident" id="3632845">s</span><span class="op" id="3632846">)</span><span class="op" id="3632847">;</span>&nbsp;<span class="op" id="3632849">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632853">switch</span>&nbsp;<span class="ident" id="3632860">s</span><span class="op" id="3632861">[</span><span class="ident" id="3632862">i</span><span class="op" id="3632863">]</span>&nbsp;<span class="op" id="3632865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632869">case</span>&nbsp;<span class="string" id="3632874">&#39;%&#39;</span><span class="op" id="3632877">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632882">t</span><span class="op" id="3632883">[</span><span class="ident" id="3632884">j</span><span class="op" id="3632885">]</span>&nbsp;<span class="op" id="3632887">=</span>&nbsp;<span class="ident" id="3632889">unhex</span><span class="op" id="3632894">(</span><span class="ident" id="3632895">s</span><span class="op" id="3632896">[</span><span class="ident" id="3632897">i</span><span class="op" id="3632898">+</span><span class="num" id="3632899">1</span><span class="op" id="3632900">]</span><span class="op" id="3632901">)</span><span class="op" id="3632902">&lt;&lt;</span><span class="num" id="3632904">4</span>&nbsp;<span class="op" id="3632906">|</span>&nbsp;<span class="ident" id="3632908">unhex</span><span class="op" id="3632913">(</span><span class="ident" id="3632914">s</span><span class="op" id="3632915">[</span><span class="ident" id="3632916">i</span><span class="op" id="3632917">+</span><span class="num" id="3632918">2</span><span class="op" id="3632919">]</span><span class="op" id="3632920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632925">j</span><span class="op" id="3632926">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632932">i</span>&nbsp;<span class="op" id="3632934">+=</span>&nbsp;<span class="num" id="3632937">3</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632941">case</span>&nbsp;<span class="string" id="3632946">&#39;+&#39;</span><span class="op" id="3632949">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632954">if</span>&nbsp;<span class="ident" id="3632957">mode</span>&nbsp;<span class="op" id="3632962">==</span>&nbsp;<span class="ident" id="3632965">encodeQueryComponent</span>&nbsp;<span class="op" id="3632986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632992">t</span><span class="op" id="3632993">[</span><span class="ident" id="3632994">j</span><span class="op" id="3632995">]</span>&nbsp;<span class="op" id="3632997">=</span>&nbsp;<span class="string" id="3632999">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3633006">}</span>&nbsp;<span class="keyword" id="3633008">else</span>&nbsp;<span class="op" id="3633013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633019">t</span><span class="op" id="3633020">[</span><span class="ident" id="3633021">j</span><span class="op" id="3633022">]</span>&nbsp;<span class="op" id="3633024">=</span>&nbsp;<span class="string" id="3633026">&#39;+&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3633033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633038">j</span><span class="op" id="3633039">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633045">i</span><span class="op" id="3633046">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633051">default</span><span class="op" id="3633058">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633063">t</span><span class="op" id="3633064">[</span><span class="ident" id="3633065">j</span><span class="op" id="3633066">]</span>&nbsp;<span class="op" id="3633068">=</span>&nbsp;<span class="ident" id="3633070">s</span><span class="op" id="3633071">[</span><span class="ident" id="3633072">i</span><span class="op" id="3633073">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633078">j</span><span class="op" id="3633079">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633085">i</span><span class="op" id="3633086">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3633091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3633094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633097">return</span>&nbsp;<span class="builtintype" id="3633104">string</span><span class="op" id="3633110">(</span><span class="ident" id="3633111">t</span><span class="op" id="3633112">)</span><span class="op" id="3633113">,</span>&nbsp;<span class="ident" id="3633115">nil</span><br>
<span class="lineno">170</span><span class="op" id="3633119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3633122">//&nbsp;QueryEscape&nbsp;escapes&nbsp;the&nbsp;string&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;safely&nbsp;placed</span><br>
<span class="lineno"></span><span class="comment" id="3633183">//&nbsp;inside&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno"></span><span class="keyword" id="3633206">func</span>&nbsp;<span class="ident" id="3633211">QueryEscape</span><span class="op" id="3633222">(</span><span class="ident" id="3633223">s</span>&nbsp;<span class="builtintype" id="3633225">string</span><span class="op" id="3633231">)</span>&nbsp;<span class="builtintype" id="3633233">string</span>&nbsp;<span class="op" id="3633240">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633243">return</span>&nbsp;<span class="ident" id="3633250">escape</span><span class="op" id="3633256">(</span><span class="ident" id="3633257">s</span><span class="op" id="3633258">,</span>&nbsp;<span class="ident" id="3633260">encodeQueryComponent</span><span class="op" id="3633280">)</span><br>
<span class="lineno"></span><span class="op" id="3633282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3633285">func</span>&nbsp;<span class="ident" id="3633290">escape</span><span class="op" id="3633296">(</span><span class="ident" id="3633297">s</span>&nbsp;<span class="builtintype" id="3633299">string</span><span class="op" id="3633305">,</span>&nbsp;<span class="ident" id="3633307">mode</span>&nbsp;<span class="ident" id="3633312">encoding</span><span class="op" id="3633320">)</span>&nbsp;<span class="builtintype" id="3633322">string</span>&nbsp;<span class="op" id="3633329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633332">spaceCount</span><span class="op" id="3633342">,</span>&nbsp;<span class="ident" id="3633344">hexCount</span>&nbsp;<span class="op" id="3633353">:=</span>&nbsp;<span class="num" id="3633356">0</span><span class="op" id="3633357">,</span>&nbsp;<span class="num" id="3633359">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633362">for</span>&nbsp;<span class="ident" id="3633366">i</span>&nbsp;<span class="op" id="3633368">:=</span>&nbsp;<span class="num" id="3633371">0</span><span class="op" id="3633372">;</span>&nbsp;<span class="ident" id="3633374">i</span>&nbsp;<span class="op" id="3633376">&lt;</span>&nbsp;<span class="builtinfunc" id="3633378">len</span><span class="op" id="3633381">(</span><span class="ident" id="3633382">s</span><span class="op" id="3633383">)</span><span class="op" id="3633384">;</span>&nbsp;<span class="ident" id="3633386">i</span><span class="op" id="3633387">++</span>&nbsp;<span class="op" id="3633390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633394">c</span>&nbsp;<span class="op" id="3633396">:=</span>&nbsp;<span class="ident" id="3633399">s</span><span class="op" id="3633400">[</span><span class="ident" id="3633401">i</span><span class="op" id="3633402">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633406">if</span>&nbsp;<span class="ident" id="3633409">shouldEscape</span><span class="op" id="3633421">(</span><span class="ident" id="3633422">c</span><span class="op" id="3633423">,</span>&nbsp;<span class="ident" id="3633425">mode</span><span class="op" id="3633429">)</span>&nbsp;<span class="op" id="3633431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633436">if</span>&nbsp;<span class="ident" id="3633439">c</span>&nbsp;<span class="op" id="3633441">==</span>&nbsp;<span class="string" id="3633444">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3633448">&amp;&amp;</span>&nbsp;<span class="ident" id="3633451">mode</span>&nbsp;<span class="op" id="3633456">==</span>&nbsp;<span class="ident" id="3633459">encodeQueryComponent</span>&nbsp;<span class="op" id="3633480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633486">spaceCount</span><span class="op" id="3633496">++</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3633502">}</span>&nbsp;<span class="keyword" id="3633504">else</span>&nbsp;<span class="op" id="3633509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633515">hexCount</span><span class="op" id="3633523">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3633529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3633533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3633536">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633540">if</span>&nbsp;<span class="ident" id="3633543">spaceCount</span>&nbsp;<span class="op" id="3633554">==</span>&nbsp;<span class="num" id="3633557">0</span>&nbsp;<span class="op" id="3633559">&amp;&amp;</span>&nbsp;<span class="ident" id="3633562">hexCount</span>&nbsp;<span class="op" id="3633571">==</span>&nbsp;<span class="num" id="3633574">0</span>&nbsp;<span class="op" id="3633576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633580">return</span>&nbsp;<span class="ident" id="3633587">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3633590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633594">t</span>&nbsp;<span class="op" id="3633596">:=</span>&nbsp;<span class="builtinfunc" id="3633599">make</span><span class="op" id="3633603">(</span><span class="op" id="3633604">[</span><span class="op" id="3633605">]</span><span class="builtintype" id="3633606">byte</span><span class="op" id="3633610">,</span>&nbsp;<span class="builtinfunc" id="3633612">len</span><span class="op" id="3633615">(</span><span class="ident" id="3633616">s</span><span class="op" id="3633617">)</span><span class="op" id="3633618">+</span><span class="num" id="3633619">2</span><span class="op" id="3633620">*</span><span class="ident" id="3633621">hexCount</span><span class="op" id="3633629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633632">j</span>&nbsp;<span class="op" id="3633634">:=</span>&nbsp;<span class="num" id="3633637">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633640">for</span>&nbsp;<span class="ident" id="3633644">i</span>&nbsp;<span class="op" id="3633646">:=</span>&nbsp;<span class="num" id="3633649">0</span><span class="op" id="3633650">;</span>&nbsp;<span class="ident" id="3633652">i</span>&nbsp;<span class="op" id="3633654">&lt;</span>&nbsp;<span class="builtinfunc" id="3633656">len</span><span class="op" id="3633659">(</span><span class="ident" id="3633660">s</span><span class="op" id="3633661">)</span><span class="op" id="3633662">;</span>&nbsp;<span class="ident" id="3633664">i</span><span class="op" id="3633665">++</span>&nbsp;<span class="op" id="3633668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633672">switch</span>&nbsp;<span class="ident" id="3633679">c</span>&nbsp;<span class="op" id="3633681">:=</span>&nbsp;<span class="ident" id="3633684">s</span><span class="op" id="3633685">[</span><span class="ident" id="3633686">i</span><span class="op" id="3633687">]</span><span class="op" id="3633688">;</span>&nbsp;<span class="op" id="3633690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633694">case</span>&nbsp;<span class="ident" id="3633699">c</span>&nbsp;<span class="op" id="3633701">==</span>&nbsp;<span class="string" id="3633704">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3633708">&amp;&amp;</span>&nbsp;<span class="ident" id="3633711">mode</span>&nbsp;<span class="op" id="3633716">==</span>&nbsp;<span class="ident" id="3633719">encodeQueryComponent</span><span class="op" id="3633739">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633744">t</span><span class="op" id="3633745">[</span><span class="ident" id="3633746">j</span><span class="op" id="3633747">]</span>&nbsp;<span class="op" id="3633749">=</span>&nbsp;<span class="string" id="3633751">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633758">j</span><span class="op" id="3633759">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633764">case</span>&nbsp;<span class="ident" id="3633769">shouldEscape</span><span class="op" id="3633781">(</span><span class="ident" id="3633782">c</span><span class="op" id="3633783">,</span>&nbsp;<span class="ident" id="3633785">mode</span><span class="op" id="3633789">)</span><span class="op" id="3633790">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633795">t</span><span class="op" id="3633796">[</span><span class="ident" id="3633797">j</span><span class="op" id="3633798">]</span>&nbsp;<span class="op" id="3633800">=</span>&nbsp;<span class="string" id="3633802">&#39;%&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633809">t</span><span class="op" id="3633810">[</span><span class="ident" id="3633811">j</span><span class="op" id="3633812">+</span><span class="num" id="3633813">1</span><span class="op" id="3633814">]</span>&nbsp;<span class="op" id="3633816">=</span>&nbsp;<span class="string" id="3633818">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3633836">[</span><span class="ident" id="3633837">c</span><span class="op" id="3633838">&gt;&gt;</span><span class="num" id="3633840">4</span><span class="op" id="3633841">]</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633846">t</span><span class="op" id="3633847">[</span><span class="ident" id="3633848">j</span><span class="op" id="3633849">+</span><span class="num" id="3633850">2</span><span class="op" id="3633851">]</span>&nbsp;<span class="op" id="3633853">=</span>&nbsp;<span class="string" id="3633855">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3633873">[</span><span class="ident" id="3633874">c</span><span class="op" id="3633875">&amp;</span><span class="num" id="3633876">15</span><span class="op" id="3633878">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633883">j</span>&nbsp;<span class="op" id="3633885">+=</span>&nbsp;<span class="num" id="3633888">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633892">default</span><span class="op" id="3633899">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633904">t</span><span class="op" id="3633905">[</span><span class="ident" id="3633906">j</span><span class="op" id="3633907">]</span>&nbsp;<span class="op" id="3633909">=</span>&nbsp;<span class="ident" id="3633911">s</span><span class="op" id="3633912">[</span><span class="ident" id="3633913">i</span><span class="op" id="3633914">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633919">j</span><span class="op" id="3633920">++</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3633925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3633928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633931">return</span>&nbsp;<span class="builtintype" id="3633938">string</span><span class="op" id="3633944">(</span><span class="ident" id="3633945">t</span><span class="op" id="3633946">)</span><br>
<span class="lineno"></span><span class="op" id="3633948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="3633951">//&nbsp;A&nbsp;URL&nbsp;represents&nbsp;a&nbsp;parsed&nbsp;URL&nbsp;(technically,&nbsp;a&nbsp;URI&nbsp;reference).</span><br>
<span class="lineno"></span><span class="comment" id="3634016">//&nbsp;The&nbsp;general&nbsp;form&nbsp;represented&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3634052">//</span><br>
<span class="lineno"></span><span class="comment" id="3634055">//&nbsp;&nbsp;&nbsp;&nbsp;scheme://[userinfo@]host/path[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3634107">//</span><br>
<span class="lineno">220</span><span class="comment" id="3634110">//&nbsp;URLs&nbsp;that&nbsp;do&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;slash&nbsp;after&nbsp;the&nbsp;scheme&nbsp;are&nbsp;interpreted&nbsp;as:</span><br>
<span class="lineno"></span><span class="comment" id="3634186">//</span><br>
<span class="lineno"></span><span class="comment" id="3634189">//&nbsp;&nbsp;&nbsp;&nbsp;scheme:opaque[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3634225">//</span><br>
<span class="lineno"></span><span class="comment" id="3634228">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;Path&nbsp;field&nbsp;is&nbsp;stored&nbsp;in&nbsp;decoded&nbsp;form:&nbsp;/%47%6f%2f&nbsp;becomes&nbsp;/Go/.</span><br>
<span class="lineno">225</span><span class="comment" id="3634308">//&nbsp;A&nbsp;consequence&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;impossible&nbsp;to&nbsp;tell&nbsp;which&nbsp;slashes&nbsp;in&nbsp;the&nbsp;Path&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="3634389">//&nbsp;slashes&nbsp;in&nbsp;the&nbsp;raw&nbsp;URL&nbsp;and&nbsp;which&nbsp;were&nbsp;%2f.&nbsp;This&nbsp;distinction&nbsp;is&nbsp;rarely&nbsp;important,</span><br>
<span class="lineno"></span><span class="comment" id="3634473">//&nbsp;but&nbsp;when&nbsp;it&nbsp;is&nbsp;a&nbsp;client&nbsp;must&nbsp;use&nbsp;other&nbsp;routines&nbsp;to&nbsp;parse&nbsp;the&nbsp;raw&nbsp;URL&nbsp;or&nbsp;construct</span><br>
<span class="lineno"></span><span class="comment" id="3634558">//&nbsp;the&nbsp;parsed&nbsp;URL.&nbsp;For&nbsp;example,&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;consult&nbsp;req.RequestURI,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3634637">//&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;can&nbsp;use&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Opaque:&nbsp;&#34;//example.com/Go%2f&#34;}</span><br>
<span class="lineno">230</span><span class="comment" id="3634719">//&nbsp;instead&nbsp;of&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Path:&nbsp;&#34;/Go/&#34;}.</span><br>
<span class="lineno"></span><span class="keyword" id="3634773">type</span>&nbsp;<span class="ident" id="3634778">URL</span>&nbsp;<span class="keyword" id="3634782">struct</span>&nbsp;<span class="op" id="3634789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634792">Scheme</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3634801">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634809">Opaque</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3634818">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3634828">//&nbsp;encoded&nbsp;opaque&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634852">User</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3634861">*</span><span class="ident" id="3634862">Userinfo</span>&nbsp;<span class="comment" id="3634871">//&nbsp;username&nbsp;and&nbsp;password&nbsp;information</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634909">Host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3634918">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3634928">//&nbsp;host&nbsp;or&nbsp;host:port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634950">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3634959">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634967">RawQuery</span>&nbsp;<span class="builtintype" id="3634976">string</span>&nbsp;<span class="comment" id="3634983">//&nbsp;encoded&nbsp;query&nbsp;values,&nbsp;without&nbsp;&#39;?&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3635021">Fragment</span>&nbsp;<span class="builtintype" id="3635030">string</span>&nbsp;<span class="comment" id="3635037">//&nbsp;fragment&nbsp;for&nbsp;references,&nbsp;without&nbsp;&#39;#&#39;</span><br>
<span class="lineno"></span><span class="op" id="3635077">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="3635080">//&nbsp;User&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3635140">//&nbsp;and&nbsp;no&nbsp;password&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3635164">func</span>&nbsp;<span class="ident" id="3635169">User</span><span class="op" id="3635173">(</span><span class="ident" id="3635174">username</span>&nbsp;<span class="builtintype" id="3635183">string</span><span class="op" id="3635189">)</span>&nbsp;<span class="op" id="3635191">*</span><span class="ident" id="3635192">Userinfo</span>&nbsp;<span class="op" id="3635201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3635204">return</span>&nbsp;<span class="op" id="3635211">&amp;</span><span class="ident" id="3635212">Userinfo</span><span class="op" id="3635220">{</span><span class="ident" id="3635221">username</span><span class="op" id="3635229">,</span>&nbsp;<span class="string" id="3635231">&#34;&#34;</span><span class="op" id="3635233">,</span>&nbsp;<span class="builtintype" id="3635235">false</span><span class="op" id="3635240">}</span><br>
<span class="lineno">245</span><span class="op" id="3635242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3635245">//&nbsp;UserPassword&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3635313">//&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="3635330">//&nbsp;This&nbsp;functionality&nbsp;should&nbsp;only&nbsp;be&nbsp;used&nbsp;with&nbsp;legacy&nbsp;web&nbsp;sites.</span><br>
<span class="lineno">250</span><span class="comment" id="3635395">//&nbsp;RFC&nbsp;2396&nbsp;warns&nbsp;that&nbsp;interpreting&nbsp;Userinfo&nbsp;this&nbsp;way</span><br>
<span class="lineno"></span><span class="comment" id="3635449">//&nbsp;``is&nbsp;NOT&nbsp;RECOMMENDED,&nbsp;because&nbsp;the&nbsp;passing&nbsp;of&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="3635512">//&nbsp;information&nbsp;in&nbsp;clear&nbsp;text&nbsp;(such&nbsp;as&nbsp;URI)&nbsp;has&nbsp;proven&nbsp;to&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3635574">//&nbsp;security&nbsp;risk&nbsp;in&nbsp;almost&nbsp;every&nbsp;case&nbsp;where&nbsp;it&nbsp;has&nbsp;been&nbsp;used.&#39;&#39;</span><br>
<span class="lineno"></span><span class="keyword" id="3635638">func</span>&nbsp;<span class="ident" id="3635643">UserPassword</span><span class="op" id="3635655">(</span><span class="ident" id="3635656">username</span><span class="op" id="3635664">,</span>&nbsp;<span class="ident" id="3635666">password</span>&nbsp;<span class="builtintype" id="3635675">string</span><span class="op" id="3635681">)</span>&nbsp;<span class="op" id="3635683">*</span><span class="ident" id="3635684">Userinfo</span>&nbsp;<span class="op" id="3635693">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3635696">return</span>&nbsp;<span class="op" id="3635703">&amp;</span><span class="ident" id="3635704">Userinfo</span><span class="op" id="3635712">{</span><span class="ident" id="3635713">username</span><span class="op" id="3635721">,</span>&nbsp;<span class="ident" id="3635723">password</span><span class="op" id="3635731">,</span>&nbsp;<span class="builtintype" id="3635733">true</span><span class="op" id="3635737">}</span><br>
<span class="lineno"></span><span class="op" id="3635739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3635742">//&nbsp;The&nbsp;Userinfo&nbsp;type&nbsp;is&nbsp;an&nbsp;immutable&nbsp;encapsulation&nbsp;of&nbsp;username&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3635809">//&nbsp;password&nbsp;details&nbsp;for&nbsp;a&nbsp;URL.&nbsp;An&nbsp;existing&nbsp;Userinfo&nbsp;value&nbsp;is&nbsp;guaranteed</span><br>
<span class="lineno">260</span><span class="comment" id="3635881">//&nbsp;to&nbsp;have&nbsp;a&nbsp;username&nbsp;set&nbsp;(potentially&nbsp;empty,&nbsp;as&nbsp;allowed&nbsp;by&nbsp;RFC&nbsp;2396),</span><br>
<span class="lineno"></span><span class="comment" id="3635952">//&nbsp;and&nbsp;optionally&nbsp;a&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="3635982">type</span>&nbsp;<span class="ident" id="3635987">Userinfo</span>&nbsp;<span class="keyword" id="3635996">struct</span>&nbsp;<span class="op" id="3636003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3636006">username</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3636018">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3636026">password</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3636038">string</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3636046">passwordSet</span>&nbsp;<span class="builtintype" id="3636058">bool</span><br>
<span class="lineno"></span><span class="op" id="3636063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3636066">//&nbsp;Username&nbsp;returns&nbsp;the&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="3636100">func</span>&nbsp;<span class="op" id="3636105">(</span><span class="ident" id="3636106">u</span>&nbsp;<span class="op" id="3636108">*</span><span class="ident" id="3636109">Userinfo</span><span class="op" id="3636117">)</span>&nbsp;<span class="ident" id="3636119">Username</span><span class="op" id="3636127">(</span><span class="op" id="3636128">)</span>&nbsp;<span class="builtintype" id="3636130">string</span>&nbsp;<span class="op" id="3636137">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3636140">return</span>&nbsp;<span class="ident" id="3636147">u</span><span class="op" id="3636148">.</span><span class="ident" id="3636149">username</span><br>
<span class="lineno"></span><span class="op" id="3636158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3636161">//&nbsp;Password&nbsp;returns&nbsp;the&nbsp;password&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;set,&nbsp;and&nbsp;whether&nbsp;it&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3636236">func</span>&nbsp;<span class="op" id="3636241">(</span><span class="ident" id="3636242">u</span>&nbsp;<span class="op" id="3636244">*</span><span class="ident" id="3636245">Userinfo</span><span class="op" id="3636253">)</span>&nbsp;<span class="ident" id="3636255">Password</span><span class="op" id="3636263">(</span><span class="op" id="3636264">)</span>&nbsp;<span class="op" id="3636266">(</span><span class="builtintype" id="3636267">string</span><span class="op" id="3636273">,</span>&nbsp;<span class="builtintype" id="3636275">bool</span><span class="op" id="3636279">)</span>&nbsp;<span class="op" id="3636281">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3636284">if</span>&nbsp;<span class="ident" id="3636287">u</span><span class="op" id="3636288">.</span><span class="ident" id="3636289">passwordSet</span>&nbsp;<span class="op" id="3636301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3636305">return</span>&nbsp;<span class="ident" id="3636312">u</span><span class="op" id="3636313">.</span><span class="ident" id="3636314">password</span><span class="op" id="3636322">,</span>&nbsp;<span class="builtintype" id="3636324">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3636330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3636333">return</span>&nbsp;<span class="string" id="3636340">&#34;&#34;</span><span class="op" id="3636342">,</span>&nbsp;<span class="builtintype" id="3636344">false</span><br>
<span class="lineno"></span><span class="op" id="3636350">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3636353">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;userinfo&nbsp;information&nbsp;in&nbsp;the&nbsp;standard&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3636425">//&nbsp;of&nbsp;&#34;username[:password]&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3636454">func</span>&nbsp;<span class="op" id="3636459">(</span><span class="ident" id="3636460">u</span>&nbsp;<span class="op" id="3636462">*</span><span class="ident" id="3636463">Userinfo</span><span class="op" id="3636471">)</span>&nbsp;<span class="ident" id="3636473">String</span><span class="op" id="3636479">(</span><span class="op" id="3636480">)</span>&nbsp;<span class="builtintype" id="3636482">string</span>&nbsp;<span class="op" id="3636489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3636492">s</span>&nbsp;<span class="op" id="3636494">:=</span>&nbsp;<span class="ident" id="3636497">escape</span><span class="op" id="3636503">(</span><span class="ident" id="3636504">u</span><span class="op" id="3636505">.</span><span class="ident" id="3636506">username</span><span class="op" id="3636514">,</span>&nbsp;<span class="ident" id="3636516">encodeUserPassword</span><span class="op" id="3636534">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3636537">if</span>&nbsp;<span class="ident" id="3636540">u</span><span class="op" id="3636541">.</span><span class="ident" id="3636542">passwordSet</span>&nbsp;<span class="op" id="3636554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3636558">s</span>&nbsp;<span class="op" id="3636560">+=</span>&nbsp;<span class="string" id="3636563">&#34;:&#34;</span>&nbsp;<span class="op" id="3636567">+</span>&nbsp;<span class="ident" id="3636569">escape</span><span class="op" id="3636575">(</span><span class="ident" id="3636576">u</span><span class="op" id="3636577">.</span><span class="ident" id="3636578">password</span><span class="op" id="3636586">,</span>&nbsp;<span class="ident" id="3636588">encodeUserPassword</span><span class="op" id="3636606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3636609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3636612">return</span>&nbsp;<span class="ident" id="3636619">s</span><br>
<span class="lineno"></span><span class="op" id="3636621">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span><span class="comment" id="3636624">//&nbsp;Maybe&nbsp;rawurl&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;scheme:path.</span><br>
<span class="lineno"></span><span class="comment" id="3636668">//&nbsp;(Scheme&nbsp;must&nbsp;be&nbsp;[a-zA-Z][a-zA-Z0-9+-.]*)</span><br>
<span class="lineno"></span><span class="comment" id="3636712">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;scheme,&nbsp;path;&nbsp;else&nbsp;return&nbsp;&#34;&#34;,&nbsp;rawurl.</span><br>
<span class="lineno"></span><span class="keyword" id="3636767">func</span>&nbsp;<span class="ident" id="3636772">getscheme</span><span class="op" id="3636781">(</span><span class="ident" id="3636782">rawurl</span>&nbsp;<span class="builtintype" id="3636789">string</span><span class="op" id="3636795">)</span>&nbsp;<span class="op" id="3636797">(</span><span class="ident" id="3636798">scheme</span><span class="op" id="3636804">,</span>&nbsp;<span class="ident" id="3636806">path</span>&nbsp;<span class="builtintype" id="3636811">string</span><span class="op" id="3636817">,</span>&nbsp;<span class="ident" id="3636819">err</span>&nbsp;<span class="builtintype" id="3636823">error</span><span class="op" id="3636828">)</span>&nbsp;<span class="op" id="3636830">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3636833">for</span>&nbsp;<span class="ident" id="3636837">i</span>&nbsp;<span class="op" id="3636839">:=</span>&nbsp;<span class="num" id="3636842">0</span><span class="op" id="3636843">;</span>&nbsp;<span class="ident" id="3636845">i</span>&nbsp;<span class="op" id="3636847">&lt;</span>&nbsp;<span class="builtinfunc" id="3636849">len</span><span class="op" id="3636852">(</span><span class="ident" id="3636853">rawurl</span><span class="op" id="3636859">)</span><span class="op" id="3636860">;</span>&nbsp;<span class="ident" id="3636862">i</span><span class="op" id="3636863">++</span>&nbsp;<span class="op" id="3636866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3636870">c</span>&nbsp;<span class="op" id="3636872">:=</span>&nbsp;<span class="ident" id="3636875">rawurl</span><span class="op" id="3636881">[</span><span class="ident" id="3636882">i</span><span class="op" id="3636883">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3636887">switch</span>&nbsp;<span class="op" id="3636894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3636898">case</span>&nbsp;<span class="string" id="3636903">&#39;a&#39;</span>&nbsp;<span class="op" id="3636907">&lt;=</span>&nbsp;<span class="ident" id="3636910">c</span>&nbsp;<span class="op" id="3636912">&amp;&amp;</span>&nbsp;<span class="ident" id="3636915">c</span>&nbsp;<span class="op" id="3636917">&lt;=</span>&nbsp;<span class="string" id="3636920">&#39;z&#39;</span>&nbsp;<span class="op" id="3636924">||</span>&nbsp;<span class="string" id="3636927">&#39;A&#39;</span>&nbsp;<span class="op" id="3636931">&lt;=</span>&nbsp;<span class="ident" id="3636934">c</span>&nbsp;<span class="op" id="3636936">&amp;&amp;</span>&nbsp;<span class="ident" id="3636939">c</span>&nbsp;<span class="op" id="3636941">&lt;=</span>&nbsp;<span class="string" id="3636944">&#39;Z&#39;</span><span class="op" id="3636947">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636951">//&nbsp;do&nbsp;nothing</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3636967">case</span>&nbsp;<span class="string" id="3636972">&#39;0&#39;</span>&nbsp;<span class="op" id="3636976">&lt;=</span>&nbsp;<span class="ident" id="3636979">c</span>&nbsp;<span class="op" id="3636981">&amp;&amp;</span>&nbsp;<span class="ident" id="3636984">c</span>&nbsp;<span class="op" id="3636986">&lt;=</span>&nbsp;<span class="string" id="3636989">&#39;9&#39;</span>&nbsp;<span class="op" id="3636993">||</span>&nbsp;<span class="ident" id="3636996">c</span>&nbsp;<span class="op" id="3636998">==</span>&nbsp;<span class="string" id="3637001">&#39;+&#39;</span>&nbsp;<span class="op" id="3637005">||</span>&nbsp;<span class="ident" id="3637008">c</span>&nbsp;<span class="op" id="3637010">==</span>&nbsp;<span class="string" id="3637013">&#39;-&#39;</span>&nbsp;<span class="op" id="3637017">||</span>&nbsp;<span class="ident" id="3637020">c</span>&nbsp;<span class="op" id="3637022">==</span>&nbsp;<span class="string" id="3637025">&#39;.&#39;</span><span class="op" id="3637028">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637033">if</span>&nbsp;<span class="ident" id="3637036">i</span>&nbsp;<span class="op" id="3637038">==</span>&nbsp;<span class="num" id="3637041">0</span>&nbsp;<span class="op" id="3637043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637049">return</span>&nbsp;<span class="string" id="3637056">&#34;&#34;</span><span class="op" id="3637058">,</span>&nbsp;<span class="ident" id="3637060">rawurl</span><span class="op" id="3637066">,</span>&nbsp;<span class="ident" id="3637068">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3637075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637079">case</span>&nbsp;<span class="ident" id="3637084">c</span>&nbsp;<span class="op" id="3637086">==</span>&nbsp;<span class="string" id="3637089">&#39;:&#39;</span><span class="op" id="3637092">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637097">if</span>&nbsp;<span class="ident" id="3637100">i</span>&nbsp;<span class="op" id="3637102">==</span>&nbsp;<span class="num" id="3637105">0</span>&nbsp;<span class="op" id="3637107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637113">return</span>&nbsp;<span class="string" id="3637120">&#34;&#34;</span><span class="op" id="3637122">,</span>&nbsp;<span class="string" id="3637124">&#34;&#34;</span><span class="op" id="3637126">,</span>&nbsp;<span class="ident" id="3637128">errors</span><span class="op" id="3637134">.</span><span class="ident" id="3637135">New</span><span class="op" id="3637138">(</span><span class="string" id="3637139">&#34;missing&nbsp;protocol&nbsp;scheme&#34;</span><span class="op" id="3637164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3637169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637174">return</span>&nbsp;<span class="ident" id="3637181">rawurl</span><span class="op" id="3637187">[</span><span class="num" id="3637188">0</span><span class="op" id="3637189">:</span><span class="ident" id="3637190">i</span><span class="op" id="3637191">]</span><span class="op" id="3637192">,</span>&nbsp;<span class="ident" id="3637194">rawurl</span><span class="op" id="3637200">[</span><span class="ident" id="3637201">i</span><span class="op" id="3637202">+</span><span class="num" id="3637203">1</span><span class="op" id="3637204">:</span><span class="op" id="3637205">]</span><span class="op" id="3637206">,</span>&nbsp;<span class="ident" id="3637208">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637214">default</span><span class="op" id="3637221">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3637226">//&nbsp;we&nbsp;have&nbsp;encountered&nbsp;an&nbsp;invalid&nbsp;character,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3637274">//&nbsp;so&nbsp;there&nbsp;is&nbsp;no&nbsp;valid&nbsp;scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637308">return</span>&nbsp;<span class="string" id="3637315">&#34;&#34;</span><span class="op" id="3637317">,</span>&nbsp;<span class="ident" id="3637319">rawurl</span><span class="op" id="3637325">,</span>&nbsp;<span class="ident" id="3637327">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3637333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3637336">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637339">return</span>&nbsp;<span class="string" id="3637346">&#34;&#34;</span><span class="op" id="3637348">,</span>&nbsp;<span class="ident" id="3637350">rawurl</span><span class="op" id="3637356">,</span>&nbsp;<span class="ident" id="3637358">nil</span><br>
<span class="lineno"></span><span class="op" id="3637362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3637365">//&nbsp;Maybe&nbsp;s&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;t&nbsp;c&nbsp;u.</span><br>
<span class="lineno"></span><span class="comment" id="3637398">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;t,&nbsp;c&nbsp;u&nbsp;(or&nbsp;t,&nbsp;u&nbsp;if&nbsp;cutc&nbsp;==&nbsp;true).</span><br>
<span class="lineno">320</span><span class="comment" id="3637449">//&nbsp;If&nbsp;not,&nbsp;return&nbsp;s,&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3637474">func</span>&nbsp;<span class="ident" id="3637479">split</span><span class="op" id="3637484">(</span><span class="ident" id="3637485">s</span>&nbsp;<span class="builtintype" id="3637487">string</span><span class="op" id="3637493">,</span>&nbsp;<span class="ident" id="3637495">c</span>&nbsp;<span class="builtintype" id="3637497">string</span><span class="op" id="3637503">,</span>&nbsp;<span class="ident" id="3637505">cutc</span>&nbsp;<span class="builtintype" id="3637510">bool</span><span class="op" id="3637514">)</span>&nbsp;<span class="op" id="3637516">(</span><span class="builtintype" id="3637517">string</span><span class="op" id="3637523">,</span>&nbsp;<span class="builtintype" id="3637525">string</span><span class="op" id="3637531">)</span>&nbsp;<span class="op" id="3637533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3637536">i</span>&nbsp;<span class="op" id="3637538">:=</span>&nbsp;<span class="ident" id="3637541">strings</span><span class="op" id="3637548">.</span><span class="ident" id="3637549">Index</span><span class="op" id="3637554">(</span><span class="ident" id="3637555">s</span><span class="op" id="3637556">,</span>&nbsp;<span class="ident" id="3637558">c</span><span class="op" id="3637559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637562">if</span>&nbsp;<span class="ident" id="3637565">i</span>&nbsp;<span class="op" id="3637567">&lt;</span>&nbsp;<span class="num" id="3637569">0</span>&nbsp;<span class="op" id="3637571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637575">return</span>&nbsp;<span class="ident" id="3637582">s</span><span class="op" id="3637583">,</span>&nbsp;<span class="string" id="3637585">&#34;&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3637589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637592">if</span>&nbsp;<span class="ident" id="3637595">cutc</span>&nbsp;<span class="op" id="3637600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637604">return</span>&nbsp;<span class="ident" id="3637611">s</span><span class="op" id="3637612">[</span><span class="num" id="3637613">0</span><span class="op" id="3637614">:</span><span class="ident" id="3637615">i</span><span class="op" id="3637616">]</span><span class="op" id="3637617">,</span>&nbsp;<span class="ident" id="3637619">s</span><span class="op" id="3637620">[</span><span class="ident" id="3637621">i</span><span class="op" id="3637622">+</span><span class="builtinfunc" id="3637623">len</span><span class="op" id="3637626">(</span><span class="ident" id="3637627">c</span><span class="op" id="3637628">)</span><span class="op" id="3637629">:</span><span class="op" id="3637630">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3637633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637636">return</span>&nbsp;<span class="ident" id="3637643">s</span><span class="op" id="3637644">[</span><span class="num" id="3637645">0</span><span class="op" id="3637646">:</span><span class="ident" id="3637647">i</span><span class="op" id="3637648">]</span><span class="op" id="3637649">,</span>&nbsp;<span class="ident" id="3637651">s</span><span class="op" id="3637652">[</span><span class="ident" id="3637653">i</span><span class="op" id="3637654">:</span><span class="op" id="3637655">]</span><br>
<span class="lineno">330</span><span class="op" id="3637657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3637660">//&nbsp;Parse&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="3637705">//&nbsp;The&nbsp;rawurl&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3637748">func</span>&nbsp;<span class="ident" id="3637753">Parse</span><span class="op" id="3637758">(</span><span class="ident" id="3637759">rawurl</span>&nbsp;<span class="builtintype" id="3637766">string</span><span class="op" id="3637772">)</span>&nbsp;<span class="op" id="3637774">(</span><span class="ident" id="3637775">url</span>&nbsp;<span class="op" id="3637779">*</span><span class="ident" id="3637780">URL</span><span class="op" id="3637783">,</span>&nbsp;<span class="ident" id="3637785">err</span>&nbsp;<span class="builtintype" id="3637789">error</span><span class="op" id="3637794">)</span>&nbsp;<span class="op" id="3637796">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3637799">//&nbsp;Cut&nbsp;off&nbsp;#frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3637817">u</span><span class="op" id="3637818">,</span>&nbsp;<span class="ident" id="3637820">frag</span>&nbsp;<span class="op" id="3637825">:=</span>&nbsp;<span class="ident" id="3637828">split</span><span class="op" id="3637833">(</span><span class="ident" id="3637834">rawurl</span><span class="op" id="3637840">,</span>&nbsp;<span class="string" id="3637842">&#34;#&#34;</span><span class="op" id="3637845">,</span>&nbsp;<span class="builtintype" id="3637847">true</span><span class="op" id="3637851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637854">if</span>&nbsp;<span class="ident" id="3637857">url</span><span class="op" id="3637860">,</span>&nbsp;<span class="ident" id="3637862">err</span>&nbsp;<span class="op" id="3637866">=</span>&nbsp;<span class="ident" id="3637868">parse</span><span class="op" id="3637873">(</span><span class="ident" id="3637874">u</span><span class="op" id="3637875">,</span>&nbsp;<span class="builtintype" id="3637877">false</span><span class="op" id="3637882">)</span><span class="op" id="3637883">;</span>&nbsp;<span class="ident" id="3637885">err</span>&nbsp;<span class="op" id="3637889">!=</span>&nbsp;<span class="ident" id="3637892">nil</span>&nbsp;<span class="op" id="3637896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637900">return</span>&nbsp;<span class="ident" id="3637907">nil</span><span class="op" id="3637910">,</span>&nbsp;<span class="ident" id="3637912">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3637917">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637920">if</span>&nbsp;<span class="ident" id="3637923">frag</span>&nbsp;<span class="op" id="3637928">==</span>&nbsp;<span class="string" id="3637931">&#34;&#34;</span>&nbsp;<span class="op" id="3637934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637938">return</span>&nbsp;<span class="ident" id="3637945">url</span><span class="op" id="3637948">,</span>&nbsp;<span class="ident" id="3637950">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3637955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637958">if</span>&nbsp;<span class="ident" id="3637961">url</span><span class="op" id="3637964">.</span><span class="ident" id="3637965">Fragment</span><span class="op" id="3637973">,</span>&nbsp;<span class="ident" id="3637975">err</span>&nbsp;<span class="op" id="3637979">=</span>&nbsp;<span class="ident" id="3637981">unescape</span><span class="op" id="3637989">(</span><span class="ident" id="3637990">frag</span><span class="op" id="3637994">,</span>&nbsp;<span class="ident" id="3637996">encodeFragment</span><span class="op" id="3638010">)</span><span class="op" id="3638011">;</span>&nbsp;<span class="ident" id="3638013">err</span>&nbsp;<span class="op" id="3638017">!=</span>&nbsp;<span class="ident" id="3638020">nil</span>&nbsp;<span class="op" id="3638024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3638028">return</span>&nbsp;<span class="ident" id="3638035">nil</span><span class="op" id="3638038">,</span>&nbsp;<span class="op" id="3638040">&amp;</span><span class="ident" id="3638041">Error</span><span class="op" id="3638046">{</span><span class="string" id="3638047">&#34;parse&#34;</span><span class="op" id="3638054">,</span>&nbsp;<span class="ident" id="3638056">rawurl</span><span class="op" id="3638062">,</span>&nbsp;<span class="ident" id="3638064">err</span><span class="op" id="3638067">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3638070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3638073">return</span>&nbsp;<span class="ident" id="3638080">url</span><span class="op" id="3638083">,</span>&nbsp;<span class="ident" id="3638085">nil</span><br>
<span class="lineno"></span><span class="op" id="3638089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3638092">//&nbsp;ParseRequestURI&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.&nbsp;&nbsp;It&nbsp;assumes&nbsp;that</span><br>
<span class="lineno">350</span><span class="comment" id="3638164">//&nbsp;rawurl&nbsp;was&nbsp;received&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request,&nbsp;so&nbsp;the&nbsp;rawurl&nbsp;is&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="3638236">//&nbsp;only&nbsp;as&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;or&nbsp;an&nbsp;absolute&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3638284">//&nbsp;The&nbsp;string&nbsp;rawurl&nbsp;is&nbsp;assumed&nbsp;not&nbsp;to&nbsp;have&nbsp;a&nbsp;#fragment&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="comment" id="3638348">//&nbsp;(Web&nbsp;browsers&nbsp;strip&nbsp;#fragment&nbsp;before&nbsp;sending&nbsp;the&nbsp;URL&nbsp;to&nbsp;a&nbsp;web&nbsp;server.)</span><br>
<span class="lineno"></span><span class="keyword" id="3638422">func</span>&nbsp;<span class="ident" id="3638427">ParseRequestURI</span><span class="op" id="3638442">(</span><span class="ident" id="3638443">rawurl</span>&nbsp;<span class="builtintype" id="3638450">string</span><span class="op" id="3638456">)</span>&nbsp;<span class="op" id="3638458">(</span><span class="ident" id="3638459">url</span>&nbsp;<span class="op" id="3638463">*</span><span class="ident" id="3638464">URL</span><span class="op" id="3638467">,</span>&nbsp;<span class="ident" id="3638469">err</span>&nbsp;<span class="builtintype" id="3638473">error</span><span class="op" id="3638478">)</span>&nbsp;<span class="op" id="3638480">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3638483">return</span>&nbsp;<span class="ident" id="3638490">parse</span><span class="op" id="3638495">(</span><span class="ident" id="3638496">rawurl</span><span class="op" id="3638502">,</span>&nbsp;<span class="builtintype" id="3638504">true</span><span class="op" id="3638508">)</span><br>
<span class="lineno"></span><span class="op" id="3638510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3638513">//&nbsp;parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;from&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;two&nbsp;contexts.&nbsp;&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3638577">//&nbsp;viaRequest&nbsp;is&nbsp;true,&nbsp;the&nbsp;URL&nbsp;is&nbsp;assumed&nbsp;to&nbsp;have&nbsp;arrived&nbsp;via&nbsp;an&nbsp;HTTP&nbsp;request,</span><br>
<span class="lineno">360</span><span class="comment" id="3638656">//&nbsp;in&nbsp;which&nbsp;case&nbsp;only&nbsp;absolute&nbsp;URLs&nbsp;or&nbsp;path-absolute&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="3638736">//&nbsp;If&nbsp;viaRequest&nbsp;is&nbsp;false,&nbsp;all&nbsp;forms&nbsp;of&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="keyword" id="3638803">func</span>&nbsp;<span class="ident" id="3638808">parse</span><span class="op" id="3638813">(</span><span class="ident" id="3638814">rawurl</span>&nbsp;<span class="builtintype" id="3638821">string</span><span class="op" id="3638827">,</span>&nbsp;<span class="ident" id="3638829">viaRequest</span>&nbsp;<span class="builtintype" id="3638840">bool</span><span class="op" id="3638844">)</span>&nbsp;<span class="op" id="3638846">(</span><span class="ident" id="3638847">url</span>&nbsp;<span class="op" id="3638851">*</span><span class="ident" id="3638852">URL</span><span class="op" id="3638855">,</span>&nbsp;<span class="ident" id="3638857">err</span>&nbsp;<span class="builtintype" id="3638861">error</span><span class="op" id="3638866">)</span>&nbsp;<span class="op" id="3638868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3638871">var</span>&nbsp;<span class="ident" id="3638875">rest</span>&nbsp;<span class="builtintype" id="3638880">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3638889">if</span>&nbsp;<span class="ident" id="3638892">rawurl</span>&nbsp;<span class="op" id="3638899">==</span>&nbsp;<span class="string" id="3638902">&#34;&#34;</span>&nbsp;<span class="op" id="3638905">&amp;&amp;</span>&nbsp;<span class="ident" id="3638908">viaRequest</span>&nbsp;<span class="op" id="3638919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3638923">err</span>&nbsp;<span class="op" id="3638927">=</span>&nbsp;<span class="ident" id="3638929">errors</span><span class="op" id="3638935">.</span><span class="ident" id="3638936">New</span><span class="op" id="3638939">(</span><span class="string" id="3638940">&#34;empty&nbsp;url&#34;</span><span class="op" id="3638951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3638955">goto</span>&nbsp;<span class="ident" id="3638960">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3638967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3638970">url</span>&nbsp;<span class="op" id="3638974">=</span>&nbsp;<span class="builtinfunc" id="3638976">new</span><span class="op" id="3638979">(</span><span class="ident" id="3638980">URL</span><span class="op" id="3638983">)</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3638987">if</span>&nbsp;<span class="ident" id="3638990">rawurl</span>&nbsp;<span class="op" id="3638997">==</span>&nbsp;<span class="string" id="3639000">&#34;*&#34;</span>&nbsp;<span class="op" id="3639004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3639008">url</span><span class="op" id="3639011">.</span><span class="ident" id="3639012">Path</span>&nbsp;<span class="op" id="3639017">=</span>&nbsp;<span class="string" id="3639019">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639025">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3639033">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3639037">//&nbsp;Split&nbsp;off&nbsp;possible&nbsp;leading&nbsp;&#34;http:&#34;,&nbsp;&#34;mailto:&#34;,&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3639093">//&nbsp;Cannot&nbsp;contain&nbsp;escaped&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639132">if</span>&nbsp;<span class="ident" id="3639135">url</span><span class="op" id="3639138">.</span><span class="ident" id="3639139">Scheme</span><span class="op" id="3639145">,</span>&nbsp;<span class="ident" id="3639147">rest</span><span class="op" id="3639151">,</span>&nbsp;<span class="ident" id="3639153">err</span>&nbsp;<span class="op" id="3639157">=</span>&nbsp;<span class="ident" id="3639159">getscheme</span><span class="op" id="3639168">(</span><span class="ident" id="3639169">rawurl</span><span class="op" id="3639175">)</span><span class="op" id="3639176">;</span>&nbsp;<span class="ident" id="3639178">err</span>&nbsp;<span class="op" id="3639182">!=</span>&nbsp;<span class="ident" id="3639185">nil</span>&nbsp;<span class="op" id="3639189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639193">goto</span>&nbsp;<span class="ident" id="3639198">Error</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3639205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3639208">url</span><span class="op" id="3639211">.</span><span class="ident" id="3639212">Scheme</span>&nbsp;<span class="op" id="3639219">=</span>&nbsp;<span class="ident" id="3639221">strings</span><span class="op" id="3639228">.</span><span class="ident" id="3639229">ToLower</span><span class="op" id="3639236">(</span><span class="ident" id="3639237">url</span><span class="op" id="3639240">.</span><span class="ident" id="3639241">Scheme</span><span class="op" id="3639247">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3639251">rest</span><span class="op" id="3639255">,</span>&nbsp;<span class="ident" id="3639257">url</span><span class="op" id="3639260">.</span><span class="ident" id="3639261">RawQuery</span>&nbsp;<span class="op" id="3639270">=</span>&nbsp;<span class="ident" id="3639272">split</span><span class="op" id="3639277">(</span><span class="ident" id="3639278">rest</span><span class="op" id="3639282">,</span>&nbsp;<span class="string" id="3639284">&#34;?&#34;</span><span class="op" id="3639287">,</span>&nbsp;<span class="builtintype" id="3639289">true</span><span class="op" id="3639293">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639297">if</span>&nbsp;<span class="op" id="3639300">!</span><span class="ident" id="3639301">strings</span><span class="op" id="3639308">.</span><span class="ident" id="3639309">HasPrefix</span><span class="op" id="3639318">(</span><span class="ident" id="3639319">rest</span><span class="op" id="3639323">,</span>&nbsp;<span class="string" id="3639325">&#34;/&#34;</span><span class="op" id="3639328">)</span>&nbsp;<span class="op" id="3639330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639334">if</span>&nbsp;<span class="ident" id="3639337">url</span><span class="op" id="3639340">.</span><span class="ident" id="3639341">Scheme</span>&nbsp;<span class="op" id="3639348">!=</span>&nbsp;<span class="string" id="3639351">&#34;&#34;</span>&nbsp;<span class="op" id="3639354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3639359">//&nbsp;We&nbsp;consider&nbsp;rootless&nbsp;paths&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;as&nbsp;opaque.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3639416">url</span><span class="op" id="3639419">.</span><span class="ident" id="3639420">Opaque</span>&nbsp;<span class="op" id="3639427">=</span>&nbsp;<span class="ident" id="3639429">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639437">return</span>&nbsp;<span class="ident" id="3639444">url</span><span class="op" id="3639447">,</span>&nbsp;<span class="ident" id="3639449">nil</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3639455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639459">if</span>&nbsp;<span class="ident" id="3639462">viaRequest</span>&nbsp;<span class="op" id="3639473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3639478">err</span>&nbsp;<span class="op" id="3639482">=</span>&nbsp;<span class="ident" id="3639484">errors</span><span class="op" id="3639490">.</span><span class="ident" id="3639491">New</span><span class="op" id="3639494">(</span><span class="string" id="3639495">&#34;invalid&nbsp;URI&nbsp;for&nbsp;request&#34;</span><span class="op" id="3639520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639525">goto</span>&nbsp;<span class="ident" id="3639530">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3639538">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3639541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639545">if</span>&nbsp;<span class="op" id="3639548">(</span><span class="ident" id="3639549">url</span><span class="op" id="3639552">.</span><span class="ident" id="3639553">Scheme</span>&nbsp;<span class="op" id="3639560">!=</span>&nbsp;<span class="string" id="3639563">&#34;&#34;</span>&nbsp;<span class="op" id="3639566">||</span>&nbsp;<span class="op" id="3639569">!</span><span class="ident" id="3639570">viaRequest</span>&nbsp;<span class="op" id="3639581">&amp;&amp;</span>&nbsp;<span class="op" id="3639584">!</span><span class="ident" id="3639585">strings</span><span class="op" id="3639592">.</span><span class="ident" id="3639593">HasPrefix</span><span class="op" id="3639602">(</span><span class="ident" id="3639603">rest</span><span class="op" id="3639607">,</span>&nbsp;<span class="string" id="3639609">&#34;///&#34;</span><span class="op" id="3639614">)</span><span class="op" id="3639615">)</span>&nbsp;<span class="op" id="3639617">&amp;&amp;</span>&nbsp;<span class="ident" id="3639620">strings</span><span class="op" id="3639627">.</span><span class="ident" id="3639628">HasPrefix</span><span class="op" id="3639637">(</span><span class="ident" id="3639638">rest</span><span class="op" id="3639642">,</span>&nbsp;<span class="string" id="3639644">&#34;//&#34;</span><span class="op" id="3639648">)</span>&nbsp;<span class="op" id="3639650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639654">var</span>&nbsp;<span class="ident" id="3639658">authority</span>&nbsp;<span class="builtintype" id="3639668">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3639677">authority</span><span class="op" id="3639686">,</span>&nbsp;<span class="ident" id="3639688">rest</span>&nbsp;<span class="op" id="3639693">=</span>&nbsp;<span class="ident" id="3639695">split</span><span class="op" id="3639700">(</span><span class="ident" id="3639701">rest</span><span class="op" id="3639705">[</span><span class="num" id="3639706">2</span><span class="op" id="3639707">:</span><span class="op" id="3639708">]</span><span class="op" id="3639709">,</span>&nbsp;<span class="string" id="3639711">&#34;/&#34;</span><span class="op" id="3639714">,</span>&nbsp;<span class="builtintype" id="3639716">false</span><span class="op" id="3639721">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3639725">url</span><span class="op" id="3639728">.</span><span class="ident" id="3639729">User</span><span class="op" id="3639733">,</span>&nbsp;<span class="ident" id="3639735">url</span><span class="op" id="3639738">.</span><span class="ident" id="3639739">Host</span><span class="op" id="3639743">,</span>&nbsp;<span class="ident" id="3639745">err</span>&nbsp;<span class="op" id="3639749">=</span>&nbsp;<span class="ident" id="3639751">parseAuthority</span><span class="op" id="3639765">(</span><span class="ident" id="3639766">authority</span><span class="op" id="3639775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639779">if</span>&nbsp;<span class="ident" id="3639782">err</span>&nbsp;<span class="op" id="3639786">!=</span>&nbsp;<span class="ident" id="3639789">nil</span>&nbsp;<span class="op" id="3639793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639798">goto</span>&nbsp;<span class="ident" id="3639803">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3639811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639815">if</span>&nbsp;<span class="ident" id="3639818">strings</span><span class="op" id="3639825">.</span><span class="ident" id="3639826">Contains</span><span class="op" id="3639834">(</span><span class="ident" id="3639835">url</span><span class="op" id="3639838">.</span><span class="ident" id="3639839">Host</span><span class="op" id="3639843">,</span>&nbsp;<span class="string" id="3639845">&#34;%&#34;</span><span class="op" id="3639848">)</span>&nbsp;<span class="op" id="3639850">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3639855">err</span>&nbsp;<span class="op" id="3639859">=</span>&nbsp;<span class="ident" id="3639861">errors</span><span class="op" id="3639867">.</span><span class="ident" id="3639868">New</span><span class="op" id="3639871">(</span><span class="string" id="3639872">&#34;hexadecimal&nbsp;escape&nbsp;in&nbsp;host&#34;</span><span class="op" id="3639900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639905">goto</span>&nbsp;<span class="ident" id="3639910">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3639918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3639921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639924">if</span>&nbsp;<span class="ident" id="3639927">url</span><span class="op" id="3639930">.</span><span class="ident" id="3639931">Path</span><span class="op" id="3639935">,</span>&nbsp;<span class="ident" id="3639937">err</span>&nbsp;<span class="op" id="3639941">=</span>&nbsp;<span class="ident" id="3639943">unescape</span><span class="op" id="3639951">(</span><span class="ident" id="3639952">rest</span><span class="op" id="3639956">,</span>&nbsp;<span class="ident" id="3639958">encodePath</span><span class="op" id="3639968">)</span><span class="op" id="3639969">;</span>&nbsp;<span class="ident" id="3639971">err</span>&nbsp;<span class="op" id="3639975">!=</span>&nbsp;<span class="ident" id="3639978">nil</span>&nbsp;<span class="op" id="3639982">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639986">goto</span>&nbsp;<span class="ident" id="3639991">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3639998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3640001">return</span>&nbsp;<span class="ident" id="3640008">url</span><span class="op" id="3640011">,</span>&nbsp;<span class="ident" id="3640013">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3640018">Error</span><span class="op" id="3640023">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3640026">return</span>&nbsp;<span class="ident" id="3640033">nil</span><span class="op" id="3640036">,</span>&nbsp;<span class="op" id="3640038">&amp;</span><span class="ident" id="3640039">Error</span><span class="op" id="3640044">{</span><span class="string" id="3640045">&#34;parse&#34;</span><span class="op" id="3640052">,</span>&nbsp;<span class="ident" id="3640054">rawurl</span><span class="op" id="3640060">,</span>&nbsp;<span class="ident" id="3640062">err</span><span class="op" id="3640065">}</span><br>
<span class="lineno"></span><span class="op" id="3640067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3640070">func</span>&nbsp;<span class="ident" id="3640075">parseAuthority</span><span class="op" id="3640089">(</span><span class="ident" id="3640090">authority</span>&nbsp;<span class="builtintype" id="3640100">string</span><span class="op" id="3640106">)</span>&nbsp;<span class="op" id="3640108">(</span><span class="ident" id="3640109">user</span>&nbsp;<span class="op" id="3640114">*</span><span class="ident" id="3640115">Userinfo</span><span class="op" id="3640123">,</span>&nbsp;<span class="ident" id="3640125">host</span>&nbsp;<span class="builtintype" id="3640130">string</span><span class="op" id="3640136">,</span>&nbsp;<span class="ident" id="3640138">err</span>&nbsp;<span class="builtintype" id="3640142">error</span><span class="op" id="3640147">)</span>&nbsp;<span class="op" id="3640149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3640152">i</span>&nbsp;<span class="op" id="3640154">:=</span>&nbsp;<span class="ident" id="3640157">strings</span><span class="op" id="3640164">.</span><span class="ident" id="3640165">LastIndex</span><span class="op" id="3640174">(</span><span class="ident" id="3640175">authority</span><span class="op" id="3640184">,</span>&nbsp;<span class="string" id="3640186">&#34;@&#34;</span><span class="op" id="3640189">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3640192">if</span>&nbsp;<span class="ident" id="3640195">i</span>&nbsp;<span class="op" id="3640197">&lt;</span>&nbsp;<span class="num" id="3640199">0</span>&nbsp;<span class="op" id="3640201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3640205">host</span>&nbsp;<span class="op" id="3640210">=</span>&nbsp;<span class="ident" id="3640212">authority</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3640224">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3640232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3640235">userinfo</span><span class="op" id="3640243">,</span>&nbsp;<span class="ident" id="3640245">host</span>&nbsp;<span class="op" id="3640250">:=</span>&nbsp;<span class="ident" id="3640253">authority</span><span class="op" id="3640262">[</span><span class="op" id="3640263">:</span><span class="ident" id="3640264">i</span><span class="op" id="3640265">]</span><span class="op" id="3640266">,</span>&nbsp;<span class="ident" id="3640268">authority</span><span class="op" id="3640277">[</span><span class="ident" id="3640278">i</span><span class="op" id="3640279">+</span><span class="num" id="3640280">1</span><span class="op" id="3640281">:</span><span class="op" id="3640282">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3640285">if</span>&nbsp;<span class="ident" id="3640288">strings</span><span class="op" id="3640295">.</span><span class="ident" id="3640296">Index</span><span class="op" id="3640301">(</span><span class="ident" id="3640302">userinfo</span><span class="op" id="3640310">,</span>&nbsp;<span class="string" id="3640312">&#34;:&#34;</span><span class="op" id="3640315">)</span>&nbsp;<span class="op" id="3640317">&lt;</span>&nbsp;<span class="num" id="3640319">0</span>&nbsp;<span class="op" id="3640321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3640325">if</span>&nbsp;<span class="ident" id="3640328">userinfo</span><span class="op" id="3640336">,</span>&nbsp;<span class="ident" id="3640338">err</span>&nbsp;<span class="op" id="3640342">=</span>&nbsp;<span class="ident" id="3640344">unescape</span><span class="op" id="3640352">(</span><span class="ident" id="3640353">userinfo</span><span class="op" id="3640361">,</span>&nbsp;<span class="ident" id="3640363">encodeUserPassword</span><span class="op" id="3640381">)</span><span class="op" id="3640382">;</span>&nbsp;<span class="ident" id="3640384">err</span>&nbsp;<span class="op" id="3640388">!=</span>&nbsp;<span class="ident" id="3640391">nil</span>&nbsp;<span class="op" id="3640395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3640400">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3640409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3640413">user</span>&nbsp;<span class="op" id="3640418">=</span>&nbsp;<span class="ident" id="3640420">User</span><span class="op" id="3640424">(</span><span class="ident" id="3640425">userinfo</span><span class="op" id="3640433">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3640436">}</span>&nbsp;<span class="keyword" id="3640438">else</span>&nbsp;<span class="op" id="3640443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3640447">username</span><span class="op" id="3640455">,</span>&nbsp;<span class="ident" id="3640457">password</span>&nbsp;<span class="op" id="3640466">:=</span>&nbsp;<span class="ident" id="3640469">split</span><span class="op" id="3640474">(</span><span class="ident" id="3640475">userinfo</span><span class="op" id="3640483">,</span>&nbsp;<span class="string" id="3640485">&#34;:&#34;</span><span class="op" id="3640488">,</span>&nbsp;<span class="builtintype" id="3640490">true</span><span class="op" id="3640494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3640498">if</span>&nbsp;<span class="ident" id="3640501">username</span><span class="op" id="3640509">,</span>&nbsp;<span class="ident" id="3640511">err</span>&nbsp;<span class="op" id="3640515">=</span>&nbsp;<span class="ident" id="3640517">unescape</span><span class="op" id="3640525">(</span><span class="ident" id="3640526">username</span><span class="op" id="3640534">,</span>&nbsp;<span class="ident" id="3640536">encodeUserPassword</span><span class="op" id="3640554">)</span><span class="op" id="3640555">;</span>&nbsp;<span class="ident" id="3640557">err</span>&nbsp;<span class="op" id="3640561">!=</span>&nbsp;<span class="ident" id="3640564">nil</span>&nbsp;<span class="op" id="3640568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3640573">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3640582">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3640586">if</span>&nbsp;<span class="ident" id="3640589">password</span><span class="op" id="3640597">,</span>&nbsp;<span class="ident" id="3640599">err</span>&nbsp;<span class="op" id="3640603">=</span>&nbsp;<span class="ident" id="3640605">unescape</span><span class="op" id="3640613">(</span><span class="ident" id="3640614">password</span><span class="op" id="3640622">,</span>&nbsp;<span class="ident" id="3640624">encodeUserPassword</span><span class="op" id="3640642">)</span><span class="op" id="3640643">;</span>&nbsp;<span class="ident" id="3640645">err</span>&nbsp;<span class="op" id="3640649">!=</span>&nbsp;<span class="ident" id="3640652">nil</span>&nbsp;<span class="op" id="3640656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3640661">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3640670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3640674">user</span>&nbsp;<span class="op" id="3640679">=</span>&nbsp;<span class="ident" id="3640681">UserPassword</span><span class="op" id="3640693">(</span><span class="ident" id="3640694">username</span><span class="op" id="3640702">,</span>&nbsp;<span class="ident" id="3640704">password</span><span class="op" id="3640712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3640715">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3640718">return</span><br>
<span class="lineno"></span><span class="op" id="3640725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3640728">//&nbsp;String&nbsp;reassembles&nbsp;the&nbsp;URL&nbsp;into&nbsp;a&nbsp;valid&nbsp;URL&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3640783">//&nbsp;The&nbsp;general&nbsp;form&nbsp;of&nbsp;the&nbsp;result&nbsp;is&nbsp;one&nbsp;of:</span><br>
<span class="lineno">445</span><span class="comment" id="3640828">//</span><br>
<span class="lineno"></span><span class="comment" id="3640831">//&nbsp;&nbsp;&nbsp;&nbsp;scheme:opaque</span><br>
<span class="lineno"></span><span class="comment" id="3640848">//&nbsp;&nbsp;&nbsp;&nbsp;scheme://userinfo@host/path?query#fragment</span><br>
<span class="lineno"></span><span class="comment" id="3640894">//</span><br>
<span class="lineno"></span><span class="comment" id="3640897">//&nbsp;If&nbsp;u.Opaque&nbsp;is&nbsp;non-empty,&nbsp;String&nbsp;uses&nbsp;the&nbsp;first&nbsp;form;</span><br>
<span class="lineno">450</span><span class="comment" id="3640954">//&nbsp;otherwise&nbsp;it&nbsp;uses&nbsp;the&nbsp;second&nbsp;form.</span><br>
<span class="lineno"></span><span class="comment" id="3640992">//</span><br>
<span class="lineno"></span><span class="comment" id="3640995">//&nbsp;In&nbsp;the&nbsp;second&nbsp;form,&nbsp;the&nbsp;following&nbsp;rules&nbsp;apply:</span><br>
<span class="lineno"></span><span class="comment" id="3641045">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.Scheme&nbsp;is&nbsp;empty,&nbsp;scheme:&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3641092">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.User&nbsp;is&nbsp;nil,&nbsp;userinfo@&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno">455</span><span class="comment" id="3641137">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;empty,&nbsp;host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3641180">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.Scheme&nbsp;and&nbsp;u.Host&nbsp;are&nbsp;empty&nbsp;and&nbsp;u.User&nbsp;is&nbsp;nil,</span><br>
<span class="lineno"></span><span class="comment" id="3641237">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;entire&nbsp;scheme://userinfo@host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3641290">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;non-empty&nbsp;and&nbsp;u.Path&nbsp;begins&nbsp;with&nbsp;a&nbsp;/,</span><br>
<span class="lineno"></span><span class="comment" id="3641346">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;form&nbsp;host/path&nbsp;does&nbsp;not&nbsp;add&nbsp;its&nbsp;own&nbsp;/.</span><br>
<span class="lineno">460</span><span class="comment" id="3641395">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.RawQuery&nbsp;is&nbsp;empty,&nbsp;?query&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3641443">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.Fragment&nbsp;is&nbsp;empty,&nbsp;#fragment&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="keyword" id="3641494">func</span>&nbsp;<span class="op" id="3641499">(</span><span class="ident" id="3641500">u</span>&nbsp;<span class="op" id="3641502">*</span><span class="ident" id="3641503">URL</span><span class="op" id="3641506">)</span>&nbsp;<span class="ident" id="3641508">String</span><span class="op" id="3641514">(</span><span class="op" id="3641515">)</span>&nbsp;<span class="builtintype" id="3641517">string</span>&nbsp;<span class="op" id="3641524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641527">var</span>&nbsp;<span class="ident" id="3641531">buf</span>&nbsp;<span class="ident" id="3641535">bytes</span><span class="op" id="3641540">.</span><span class="ident" id="3641541">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641549">if</span>&nbsp;<span class="ident" id="3641552">u</span><span class="op" id="3641553">.</span><span class="ident" id="3641554">Scheme</span>&nbsp;<span class="op" id="3641561">!=</span>&nbsp;<span class="string" id="3641564">&#34;&#34;</span>&nbsp;<span class="op" id="3641567">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641571">buf</span><span class="op" id="3641574">.</span><span class="ident" id="3641575">WriteString</span><span class="op" id="3641586">(</span><span class="ident" id="3641587">u</span><span class="op" id="3641588">.</span><span class="ident" id="3641589">Scheme</span><span class="op" id="3641595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641599">buf</span><span class="op" id="3641602">.</span><span class="ident" id="3641603">WriteByte</span><span class="op" id="3641612">(</span><span class="string" id="3641613">&#39;:&#39;</span><span class="op" id="3641616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3641619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641622">if</span>&nbsp;<span class="ident" id="3641625">u</span><span class="op" id="3641626">.</span><span class="ident" id="3641627">Opaque</span>&nbsp;<span class="op" id="3641634">!=</span>&nbsp;<span class="string" id="3641637">&#34;&#34;</span>&nbsp;<span class="op" id="3641640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641644">buf</span><span class="op" id="3641647">.</span><span class="ident" id="3641648">WriteString</span><span class="op" id="3641659">(</span><span class="ident" id="3641660">u</span><span class="op" id="3641661">.</span><span class="ident" id="3641662">Opaque</span><span class="op" id="3641668">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3641671">}</span>&nbsp;<span class="keyword" id="3641673">else</span>&nbsp;<span class="op" id="3641678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641682">if</span>&nbsp;<span class="ident" id="3641685">u</span><span class="op" id="3641686">.</span><span class="ident" id="3641687">Scheme</span>&nbsp;<span class="op" id="3641694">!=</span>&nbsp;<span class="string" id="3641697">&#34;&#34;</span>&nbsp;<span class="op" id="3641700">||</span>&nbsp;<span class="ident" id="3641703">u</span><span class="op" id="3641704">.</span><span class="ident" id="3641705">Host</span>&nbsp;<span class="op" id="3641710">!=</span>&nbsp;<span class="string" id="3641713">&#34;&#34;</span>&nbsp;<span class="op" id="3641716">||</span>&nbsp;<span class="ident" id="3641719">u</span><span class="op" id="3641720">.</span><span class="ident" id="3641721">User</span>&nbsp;<span class="op" id="3641726">!=</span>&nbsp;<span class="ident" id="3641729">nil</span>&nbsp;<span class="op" id="3641733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641738">buf</span><span class="op" id="3641741">.</span><span class="ident" id="3641742">WriteString</span><span class="op" id="3641753">(</span><span class="string" id="3641754">&#34;//&#34;</span><span class="op" id="3641758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641763">if</span>&nbsp;<span class="ident" id="3641766">ui</span>&nbsp;<span class="op" id="3641769">:=</span>&nbsp;<span class="ident" id="3641772">u</span><span class="op" id="3641773">.</span><span class="ident" id="3641774">User</span><span class="op" id="3641778">;</span>&nbsp;<span class="ident" id="3641780">ui</span>&nbsp;<span class="op" id="3641783">!=</span>&nbsp;<span class="ident" id="3641786">nil</span>&nbsp;<span class="op" id="3641790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641796">buf</span><span class="op" id="3641799">.</span><span class="ident" id="3641800">WriteString</span><span class="op" id="3641811">(</span><span class="ident" id="3641812">ui</span><span class="op" id="3641814">.</span><span class="ident" id="3641815">String</span><span class="op" id="3641821">(</span><span class="op" id="3641822">)</span><span class="op" id="3641823">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641829">buf</span><span class="op" id="3641832">.</span><span class="ident" id="3641833">WriteByte</span><span class="op" id="3641842">(</span><span class="string" id="3641843">&#39;@&#39;</span><span class="op" id="3641846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3641851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641856">if</span>&nbsp;<span class="ident" id="3641859">h</span>&nbsp;<span class="op" id="3641861">:=</span>&nbsp;<span class="ident" id="3641864">u</span><span class="op" id="3641865">.</span><span class="ident" id="3641866">Host</span><span class="op" id="3641870">;</span>&nbsp;<span class="ident" id="3641872">h</span>&nbsp;<span class="op" id="3641874">!=</span>&nbsp;<span class="string" id="3641877">&#34;&#34;</span>&nbsp;<span class="op" id="3641880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641886">buf</span><span class="op" id="3641889">.</span><span class="ident" id="3641890">WriteString</span><span class="op" id="3641901">(</span><span class="ident" id="3641902">h</span><span class="op" id="3641903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3641908">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3641912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641916">if</span>&nbsp;<span class="ident" id="3641919">u</span><span class="op" id="3641920">.</span><span class="ident" id="3641921">Path</span>&nbsp;<span class="op" id="3641926">!=</span>&nbsp;<span class="string" id="3641929">&#34;&#34;</span>&nbsp;<span class="op" id="3641932">&amp;&amp;</span>&nbsp;<span class="ident" id="3641935">u</span><span class="op" id="3641936">.</span><span class="ident" id="3641937">Path</span><span class="op" id="3641941">[</span><span class="num" id="3641942">0</span><span class="op" id="3641943">]</span>&nbsp;<span class="op" id="3641945">!=</span>&nbsp;<span class="string" id="3641948">&#39;/&#39;</span>&nbsp;<span class="op" id="3641952">&amp;&amp;</span>&nbsp;<span class="ident" id="3641955">u</span><span class="op" id="3641956">.</span><span class="ident" id="3641957">Host</span>&nbsp;<span class="op" id="3641962">!=</span>&nbsp;<span class="string" id="3641965">&#34;&#34;</span>&nbsp;<span class="op" id="3641968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641973">buf</span><span class="op" id="3641976">.</span><span class="ident" id="3641977">WriteByte</span><span class="op" id="3641986">(</span><span class="string" id="3641987">&#39;/&#39;</span><span class="op" id="3641990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3641994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641998">buf</span><span class="op" id="3642001">.</span><span class="ident" id="3642002">WriteString</span><span class="op" id="3642013">(</span><span class="ident" id="3642014">escape</span><span class="op" id="3642020">(</span><span class="ident" id="3642021">u</span><span class="op" id="3642022">.</span><span class="ident" id="3642023">Path</span><span class="op" id="3642027">,</span>&nbsp;<span class="ident" id="3642029">encodePath</span><span class="op" id="3642039">)</span><span class="op" id="3642040">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3642043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642046">if</span>&nbsp;<span class="ident" id="3642049">u</span><span class="op" id="3642050">.</span><span class="ident" id="3642051">RawQuery</span>&nbsp;<span class="op" id="3642060">!=</span>&nbsp;<span class="string" id="3642063">&#34;&#34;</span>&nbsp;<span class="op" id="3642066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3642070">buf</span><span class="op" id="3642073">.</span><span class="ident" id="3642074">WriteByte</span><span class="op" id="3642083">(</span><span class="string" id="3642084">&#39;?&#39;</span><span class="op" id="3642087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3642091">buf</span><span class="op" id="3642094">.</span><span class="ident" id="3642095">WriteString</span><span class="op" id="3642106">(</span><span class="ident" id="3642107">u</span><span class="op" id="3642108">.</span><span class="ident" id="3642109">RawQuery</span><span class="op" id="3642117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3642120">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642123">if</span>&nbsp;<span class="ident" id="3642126">u</span><span class="op" id="3642127">.</span><span class="ident" id="3642128">Fragment</span>&nbsp;<span class="op" id="3642137">!=</span>&nbsp;<span class="string" id="3642140">&#34;&#34;</span>&nbsp;<span class="op" id="3642143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3642147">buf</span><span class="op" id="3642150">.</span><span class="ident" id="3642151">WriteByte</span><span class="op" id="3642160">(</span><span class="string" id="3642161">&#39;#&#39;</span><span class="op" id="3642164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3642168">buf</span><span class="op" id="3642171">.</span><span class="ident" id="3642172">WriteString</span><span class="op" id="3642183">(</span><span class="ident" id="3642184">escape</span><span class="op" id="3642190">(</span><span class="ident" id="3642191">u</span><span class="op" id="3642192">.</span><span class="ident" id="3642193">Fragment</span><span class="op" id="3642201">,</span>&nbsp;<span class="ident" id="3642203">encodeFragment</span><span class="op" id="3642217">)</span><span class="op" id="3642218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3642221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642224">return</span>&nbsp;<span class="ident" id="3642231">buf</span><span class="op" id="3642234">.</span><span class="ident" id="3642235">String</span><span class="op" id="3642241">(</span><span class="op" id="3642242">)</span><br>
<span class="lineno">495</span><span class="op" id="3642244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3642247">//&nbsp;Values&nbsp;maps&nbsp;a&nbsp;string&nbsp;key&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3642296">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;for&nbsp;query&nbsp;parameters&nbsp;and&nbsp;form&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3642358">//&nbsp;Unlike&nbsp;in&nbsp;the&nbsp;http.Header&nbsp;map,&nbsp;the&nbsp;keys&nbsp;in&nbsp;a&nbsp;Values&nbsp;map</span><br>
<span class="lineno">500</span><span class="comment" id="3642417">//&nbsp;are&nbsp;case-sensitive.</span><br>
<span class="lineno"></span><span class="keyword" id="3642440">type</span>&nbsp;<span class="ident" id="3642445">Values</span>&nbsp;<span class="keyword" id="3642452">map</span><span class="op" id="3642455">[</span><span class="builtintype" id="3642456">string</span><span class="op" id="3642462">]</span><span class="op" id="3642463">[</span><span class="op" id="3642464">]</span><span class="builtintype" id="3642465">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3642473">//&nbsp;Get&nbsp;gets&nbsp;the&nbsp;first&nbsp;value&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3642532">//&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;values&nbsp;associated&nbsp;with&nbsp;the&nbsp;key,&nbsp;Get&nbsp;returns</span><br>
<span class="lineno">505</span><span class="comment" id="3642595">//&nbsp;the&nbsp;empty&nbsp;string.&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values,&nbsp;use&nbsp;the&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="3642655">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3642668">func</span>&nbsp;<span class="op" id="3642673">(</span><span class="ident" id="3642674">v</span>&nbsp;<span class="ident" id="3642676">Values</span><span class="op" id="3642682">)</span>&nbsp;<span class="ident" id="3642684">Get</span><span class="op" id="3642687">(</span><span class="ident" id="3642688">key</span>&nbsp;<span class="builtintype" id="3642692">string</span><span class="op" id="3642698">)</span>&nbsp;<span class="builtintype" id="3642700">string</span>&nbsp;<span class="op" id="3642707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642710">if</span>&nbsp;<span class="ident" id="3642713">v</span>&nbsp;<span class="op" id="3642715">==</span>&nbsp;<span class="ident" id="3642718">nil</span>&nbsp;<span class="op" id="3642722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642726">return</span>&nbsp;<span class="string" id="3642733">&#34;&#34;</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3642737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3642740">vs</span><span class="op" id="3642742">,</span>&nbsp;<span class="ident" id="3642744">ok</span>&nbsp;<span class="op" id="3642747">:=</span>&nbsp;<span class="ident" id="3642750">v</span><span class="op" id="3642751">[</span><span class="ident" id="3642752">key</span><span class="op" id="3642755">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642758">if</span>&nbsp;<span class="op" id="3642761">!</span><span class="ident" id="3642762">ok</span>&nbsp;<span class="op" id="3642765">||</span>&nbsp;<span class="builtinfunc" id="3642768">len</span><span class="op" id="3642771">(</span><span class="ident" id="3642772">vs</span><span class="op" id="3642774">)</span>&nbsp;<span class="op" id="3642776">==</span>&nbsp;<span class="num" id="3642779">0</span>&nbsp;<span class="op" id="3642781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642785">return</span>&nbsp;<span class="string" id="3642792">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3642796">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642799">return</span>&nbsp;<span class="ident" id="3642806">vs</span><span class="op" id="3642808">[</span><span class="num" id="3642809">0</span><span class="op" id="3642810">]</span><br>
<span class="lineno"></span><span class="op" id="3642812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3642815">//&nbsp;Set&nbsp;sets&nbsp;the&nbsp;key&nbsp;to&nbsp;value.&nbsp;It&nbsp;replaces&nbsp;any&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="3642870">//&nbsp;values.</span><br>
<span class="lineno">520</span><span class="keyword" id="3642881">func</span>&nbsp;<span class="op" id="3642886">(</span><span class="ident" id="3642887">v</span>&nbsp;<span class="ident" id="3642889">Values</span><span class="op" id="3642895">)</span>&nbsp;<span class="ident" id="3642897">Set</span><span class="op" id="3642900">(</span><span class="ident" id="3642901">key</span><span class="op" id="3642904">,</span>&nbsp;<span class="ident" id="3642906">value</span>&nbsp;<span class="builtintype" id="3642912">string</span><span class="op" id="3642918">)</span>&nbsp;<span class="op" id="3642920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3642923">v</span><span class="op" id="3642924">[</span><span class="ident" id="3642925">key</span><span class="op" id="3642928">]</span>&nbsp;<span class="op" id="3642930">=</span>&nbsp;<span class="op" id="3642932">[</span><span class="op" id="3642933">]</span><span class="builtintype" id="3642934">string</span><span class="op" id="3642940">{</span><span class="ident" id="3642941">value</span><span class="op" id="3642946">}</span><br>
<span class="lineno"></span><span class="op" id="3642948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3642951">//&nbsp;Add&nbsp;adds&nbsp;the&nbsp;value&nbsp;to&nbsp;key.&nbsp;It&nbsp;appends&nbsp;to&nbsp;any&nbsp;existing</span><br>
<span class="lineno">525</span><span class="comment" id="3643008">//&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3643039">func</span>&nbsp;<span class="op" id="3643044">(</span><span class="ident" id="3643045">v</span>&nbsp;<span class="ident" id="3643047">Values</span><span class="op" id="3643053">)</span>&nbsp;<span class="ident" id="3643055">Add</span><span class="op" id="3643058">(</span><span class="ident" id="3643059">key</span><span class="op" id="3643062">,</span>&nbsp;<span class="ident" id="3643064">value</span>&nbsp;<span class="builtintype" id="3643070">string</span><span class="op" id="3643076">)</span>&nbsp;<span class="op" id="3643078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643081">v</span><span class="op" id="3643082">[</span><span class="ident" id="3643083">key</span><span class="op" id="3643086">]</span>&nbsp;<span class="op" id="3643088">=</span>&nbsp;<span class="builtinfunc" id="3643090">append</span><span class="op" id="3643096">(</span><span class="ident" id="3643097">v</span><span class="op" id="3643098">[</span><span class="ident" id="3643099">key</span><span class="op" id="3643102">]</span><span class="op" id="3643103">,</span>&nbsp;<span class="ident" id="3643105">value</span><span class="op" id="3643110">)</span><br>
<span class="lineno"></span><span class="op" id="3643112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="3643115">//&nbsp;Del&nbsp;deletes&nbsp;the&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3643162">func</span>&nbsp;<span class="op" id="3643167">(</span><span class="ident" id="3643168">v</span>&nbsp;<span class="ident" id="3643170">Values</span><span class="op" id="3643176">)</span>&nbsp;<span class="ident" id="3643178">Del</span><span class="op" id="3643181">(</span><span class="ident" id="3643182">key</span>&nbsp;<span class="builtintype" id="3643186">string</span><span class="op" id="3643192">)</span>&nbsp;<span class="op" id="3643194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3643197">delete</span><span class="op" id="3643203">(</span><span class="ident" id="3643204">v</span><span class="op" id="3643205">,</span>&nbsp;<span class="ident" id="3643207">key</span><span class="op" id="3643210">)</span><br>
<span class="lineno"></span><span class="op" id="3643212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3643215">//&nbsp;ParseQuery&nbsp;parses&nbsp;the&nbsp;URL-encoded&nbsp;query&nbsp;string&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3643277">//&nbsp;a&nbsp;map&nbsp;listing&nbsp;the&nbsp;values&nbsp;specified&nbsp;for&nbsp;each&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3643329">//&nbsp;ParseQuery&nbsp;always&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;map&nbsp;containing&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3643391">//&nbsp;valid&nbsp;query&nbsp;parameters&nbsp;found;&nbsp;err&nbsp;describes&nbsp;the&nbsp;first&nbsp;decoding&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="3643463">//&nbsp;encountered,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">540</span><span class="keyword" id="3643487">func</span>&nbsp;<span class="ident" id="3643492">ParseQuery</span><span class="op" id="3643502">(</span><span class="ident" id="3643503">query</span>&nbsp;<span class="builtintype" id="3643509">string</span><span class="op" id="3643515">)</span>&nbsp;<span class="op" id="3643517">(</span><span class="ident" id="3643518">m</span>&nbsp;<span class="ident" id="3643520">Values</span><span class="op" id="3643526">,</span>&nbsp;<span class="ident" id="3643528">err</span>&nbsp;<span class="builtintype" id="3643532">error</span><span class="op" id="3643537">)</span>&nbsp;<span class="op" id="3643539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643542">m</span>&nbsp;<span class="op" id="3643544">=</span>&nbsp;<span class="builtinfunc" id="3643546">make</span><span class="op" id="3643550">(</span><span class="ident" id="3643551">Values</span><span class="op" id="3643557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643560">err</span>&nbsp;<span class="op" id="3643564">=</span>&nbsp;<span class="ident" id="3643566">parseQuery</span><span class="op" id="3643576">(</span><span class="ident" id="3643577">m</span><span class="op" id="3643578">,</span>&nbsp;<span class="ident" id="3643580">query</span><span class="op" id="3643585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3643588">return</span><br>
<span class="lineno"></span><span class="op" id="3643595">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="keyword" id="3643598">func</span>&nbsp;<span class="ident" id="3643603">parseQuery</span><span class="op" id="3643613">(</span><span class="ident" id="3643614">m</span>&nbsp;<span class="ident" id="3643616">Values</span><span class="op" id="3643622">,</span>&nbsp;<span class="ident" id="3643624">query</span>&nbsp;<span class="builtintype" id="3643630">string</span><span class="op" id="3643636">)</span>&nbsp;<span class="op" id="3643638">(</span><span class="ident" id="3643639">err</span>&nbsp;<span class="builtintype" id="3643643">error</span><span class="op" id="3643648">)</span>&nbsp;<span class="op" id="3643650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3643653">for</span>&nbsp;<span class="ident" id="3643657">query</span>&nbsp;<span class="op" id="3643663">!=</span>&nbsp;<span class="string" id="3643666">&#34;&#34;</span>&nbsp;<span class="op" id="3643669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643673">key</span>&nbsp;<span class="op" id="3643677">:=</span>&nbsp;<span class="ident" id="3643680">query</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3643688">if</span>&nbsp;<span class="ident" id="3643691">i</span>&nbsp;<span class="op" id="3643693">:=</span>&nbsp;<span class="ident" id="3643696">strings</span><span class="op" id="3643703">.</span><span class="ident" id="3643704">IndexAny</span><span class="op" id="3643712">(</span><span class="ident" id="3643713">key</span><span class="op" id="3643716">,</span>&nbsp;<span class="string" id="3643718">&#34;&amp;;&#34;</span><span class="op" id="3643722">)</span><span class="op" id="3643723">;</span>&nbsp;<span class="ident" id="3643725">i</span>&nbsp;<span class="op" id="3643727">&gt;=</span>&nbsp;<span class="num" id="3643730">0</span>&nbsp;<span class="op" id="3643732">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643737">key</span><span class="op" id="3643740">,</span>&nbsp;<span class="ident" id="3643742">query</span>&nbsp;<span class="op" id="3643748">=</span>&nbsp;<span class="ident" id="3643750">key</span><span class="op" id="3643753">[</span><span class="op" id="3643754">:</span><span class="ident" id="3643755">i</span><span class="op" id="3643756">]</span><span class="op" id="3643757">,</span>&nbsp;<span class="ident" id="3643759">key</span><span class="op" id="3643762">[</span><span class="ident" id="3643763">i</span><span class="op" id="3643764">+</span><span class="num" id="3643765">1</span><span class="op" id="3643766">:</span><span class="op" id="3643767">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3643771">}</span>&nbsp;<span class="keyword" id="3643773">else</span>&nbsp;<span class="op" id="3643778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643783">query</span>&nbsp;<span class="op" id="3643789">=</span>&nbsp;<span class="string" id="3643791">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3643796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3643800">if</span>&nbsp;<span class="ident" id="3643803">key</span>&nbsp;<span class="op" id="3643807">==</span>&nbsp;<span class="string" id="3643810">&#34;&#34;</span>&nbsp;<span class="op" id="3643813">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3643818">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3643829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643833">value</span>&nbsp;<span class="op" id="3643839">:=</span>&nbsp;<span class="string" id="3643842">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3643847">if</span>&nbsp;<span class="ident" id="3643850">i</span>&nbsp;<span class="op" id="3643852">:=</span>&nbsp;<span class="ident" id="3643855">strings</span><span class="op" id="3643862">.</span><span class="ident" id="3643863">Index</span><span class="op" id="3643868">(</span><span class="ident" id="3643869">key</span><span class="op" id="3643872">,</span>&nbsp;<span class="string" id="3643874">&#34;=&#34;</span><span class="op" id="3643877">)</span><span class="op" id="3643878">;</span>&nbsp;<span class="ident" id="3643880">i</span>&nbsp;<span class="op" id="3643882">&gt;=</span>&nbsp;<span class="num" id="3643885">0</span>&nbsp;<span class="op" id="3643887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643892">key</span><span class="op" id="3643895">,</span>&nbsp;<span class="ident" id="3643897">value</span>&nbsp;<span class="op" id="3643903">=</span>&nbsp;<span class="ident" id="3643905">key</span><span class="op" id="3643908">[</span><span class="op" id="3643909">:</span><span class="ident" id="3643910">i</span><span class="op" id="3643911">]</span><span class="op" id="3643912">,</span>&nbsp;<span class="ident" id="3643914">key</span><span class="op" id="3643917">[</span><span class="ident" id="3643918">i</span><span class="op" id="3643919">+</span><span class="num" id="3643920">1</span><span class="op" id="3643921">:</span><span class="op" id="3643922">]</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3643926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643930">key</span><span class="op" id="3643933">,</span>&nbsp;<span class="ident" id="3643935">err1</span>&nbsp;<span class="op" id="3643940">:=</span>&nbsp;<span class="ident" id="3643943">QueryUnescape</span><span class="op" id="3643956">(</span><span class="ident" id="3643957">key</span><span class="op" id="3643960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3643964">if</span>&nbsp;<span class="ident" id="3643967">err1</span>&nbsp;<span class="op" id="3643972">!=</span>&nbsp;<span class="ident" id="3643975">nil</span>&nbsp;<span class="op" id="3643979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3643984">if</span>&nbsp;<span class="ident" id="3643987">err</span>&nbsp;<span class="op" id="3643991">==</span>&nbsp;<span class="ident" id="3643994">nil</span>&nbsp;<span class="op" id="3643998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644004">err</span>&nbsp;<span class="op" id="3644008">=</span>&nbsp;<span class="ident" id="3644010">err1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3644018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644023">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3644034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644038">value</span><span class="op" id="3644043">,</span>&nbsp;<span class="ident" id="3644045">err1</span>&nbsp;<span class="op" id="3644050">=</span>&nbsp;<span class="ident" id="3644052">QueryUnescape</span><span class="op" id="3644065">(</span><span class="ident" id="3644066">value</span><span class="op" id="3644071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644075">if</span>&nbsp;<span class="ident" id="3644078">err1</span>&nbsp;<span class="op" id="3644083">!=</span>&nbsp;<span class="ident" id="3644086">nil</span>&nbsp;<span class="op" id="3644090">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644095">if</span>&nbsp;<span class="ident" id="3644098">err</span>&nbsp;<span class="op" id="3644102">==</span>&nbsp;<span class="ident" id="3644105">nil</span>&nbsp;<span class="op" id="3644109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644115">err</span>&nbsp;<span class="op" id="3644119">=</span>&nbsp;<span class="ident" id="3644121">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3644129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644134">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3644145">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644149">m</span><span class="op" id="3644150">[</span><span class="ident" id="3644151">key</span><span class="op" id="3644154">]</span>&nbsp;<span class="op" id="3644156">=</span>&nbsp;<span class="builtinfunc" id="3644158">append</span><span class="op" id="3644164">(</span><span class="ident" id="3644165">m</span><span class="op" id="3644166">[</span><span class="ident" id="3644167">key</span><span class="op" id="3644170">]</span><span class="op" id="3644171">,</span>&nbsp;<span class="ident" id="3644173">value</span><span class="op" id="3644178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3644181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644184">return</span>&nbsp;<span class="ident" id="3644191">err</span><br>
<span class="lineno"></span><span class="op" id="3644195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span><span class="comment" id="3644198">//&nbsp;Encode&nbsp;encodes&nbsp;the&nbsp;values&nbsp;into&nbsp;``URL&nbsp;encoded&#39;&#39;&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3644253">//&nbsp;(&#34;bar=baz&amp;foo=quux&#34;)&nbsp;sorted&nbsp;by&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3644292">func</span>&nbsp;<span class="op" id="3644297">(</span><span class="ident" id="3644298">v</span>&nbsp;<span class="ident" id="3644300">Values</span><span class="op" id="3644306">)</span>&nbsp;<span class="ident" id="3644308">Encode</span><span class="op" id="3644314">(</span><span class="op" id="3644315">)</span>&nbsp;<span class="builtintype" id="3644317">string</span>&nbsp;<span class="op" id="3644324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644327">if</span>&nbsp;<span class="ident" id="3644330">v</span>&nbsp;<span class="op" id="3644332">==</span>&nbsp;<span class="ident" id="3644335">nil</span>&nbsp;<span class="op" id="3644339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644343">return</span>&nbsp;<span class="string" id="3644350">&#34;&#34;</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3644354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644357">var</span>&nbsp;<span class="ident" id="3644361">buf</span>&nbsp;<span class="ident" id="3644365">bytes</span><span class="op" id="3644370">.</span><span class="ident" id="3644371">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644379">keys</span>&nbsp;<span class="op" id="3644384">:=</span>&nbsp;<span class="builtinfunc" id="3644387">make</span><span class="op" id="3644391">(</span><span class="op" id="3644392">[</span><span class="op" id="3644393">]</span><span class="builtintype" id="3644394">string</span><span class="op" id="3644400">,</span>&nbsp;<span class="num" id="3644402">0</span><span class="op" id="3644403">,</span>&nbsp;<span class="builtinfunc" id="3644405">len</span><span class="op" id="3644408">(</span><span class="ident" id="3644409">v</span><span class="op" id="3644410">)</span><span class="op" id="3644411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644414">for</span>&nbsp;<span class="ident" id="3644418">k</span>&nbsp;<span class="op" id="3644420">:=</span>&nbsp;<span class="keyword" id="3644423">range</span>&nbsp;<span class="ident" id="3644429">v</span>&nbsp;<span class="op" id="3644431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644435">keys</span>&nbsp;<span class="op" id="3644440">=</span>&nbsp;<span class="builtinfunc" id="3644442">append</span><span class="op" id="3644448">(</span><span class="ident" id="3644449">keys</span><span class="op" id="3644453">,</span>&nbsp;<span class="ident" id="3644455">k</span><span class="op" id="3644456">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3644459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644462">sort</span><span class="op" id="3644466">.</span><span class="ident" id="3644467">Strings</span><span class="op" id="3644474">(</span><span class="ident" id="3644475">keys</span><span class="op" id="3644479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644482">for</span>&nbsp;<span class="ident" id="3644486">_</span><span class="op" id="3644487">,</span>&nbsp;<span class="ident" id="3644489">k</span>&nbsp;<span class="op" id="3644491">:=</span>&nbsp;<span class="keyword" id="3644494">range</span>&nbsp;<span class="ident" id="3644500">keys</span>&nbsp;<span class="op" id="3644505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644509">vs</span>&nbsp;<span class="op" id="3644512">:=</span>&nbsp;<span class="ident" id="3644515">v</span><span class="op" id="3644516">[</span><span class="ident" id="3644517">k</span><span class="op" id="3644518">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644522">prefix</span>&nbsp;<span class="op" id="3644529">:=</span>&nbsp;<span class="ident" id="3644532">QueryEscape</span><span class="op" id="3644543">(</span><span class="ident" id="3644544">k</span><span class="op" id="3644545">)</span>&nbsp;<span class="op" id="3644547">+</span>&nbsp;<span class="string" id="3644549">&#34;=&#34;</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644555">for</span>&nbsp;<span class="ident" id="3644559">_</span><span class="op" id="3644560">,</span>&nbsp;<span class="ident" id="3644562">v</span>&nbsp;<span class="op" id="3644564">:=</span>&nbsp;<span class="keyword" id="3644567">range</span>&nbsp;<span class="ident" id="3644573">vs</span>&nbsp;<span class="op" id="3644576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644581">if</span>&nbsp;<span class="ident" id="3644584">buf</span><span class="op" id="3644587">.</span><span class="ident" id="3644588">Len</span><span class="op" id="3644591">(</span><span class="op" id="3644592">)</span>&nbsp;<span class="op" id="3644594">&gt;</span>&nbsp;<span class="num" id="3644596">0</span>&nbsp;<span class="op" id="3644598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644604">buf</span><span class="op" id="3644607">.</span><span class="ident" id="3644608">WriteByte</span><span class="op" id="3644617">(</span><span class="string" id="3644618">&#39;&amp;&#39;</span><span class="op" id="3644621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3644626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644631">buf</span><span class="op" id="3644634">.</span><span class="ident" id="3644635">WriteString</span><span class="op" id="3644646">(</span><span class="ident" id="3644647">prefix</span><span class="op" id="3644653">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644658">buf</span><span class="op" id="3644661">.</span><span class="ident" id="3644662">WriteString</span><span class="op" id="3644673">(</span><span class="ident" id="3644674">QueryEscape</span><span class="op" id="3644685">(</span><span class="ident" id="3644686">v</span><span class="op" id="3644687">)</span><span class="op" id="3644688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3644692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3644695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644698">return</span>&nbsp;<span class="ident" id="3644705">buf</span><span class="op" id="3644708">.</span><span class="ident" id="3644709">String</span><span class="op" id="3644715">(</span><span class="op" id="3644716">)</span><br>
<span class="lineno"></span><span class="op" id="3644718">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="comment" id="3644721">//&nbsp;resolvePath&nbsp;applies&nbsp;special&nbsp;path&nbsp;segments&nbsp;from&nbsp;refs&nbsp;and&nbsp;applies</span><br>
<span class="lineno"></span><span class="comment" id="3644788">//&nbsp;them&nbsp;to&nbsp;base,&nbsp;per&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3644819">func</span>&nbsp;<span class="ident" id="3644824">resolvePath</span><span class="op" id="3644835">(</span><span class="ident" id="3644836">base</span><span class="op" id="3644840">,</span>&nbsp;<span class="ident" id="3644842">ref</span>&nbsp;<span class="builtintype" id="3644846">string</span><span class="op" id="3644852">)</span>&nbsp;<span class="builtintype" id="3644854">string</span>&nbsp;<span class="op" id="3644861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644864">var</span>&nbsp;<span class="ident" id="3644868">full</span>&nbsp;<span class="builtintype" id="3644873">string</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644881">if</span>&nbsp;<span class="ident" id="3644884">ref</span>&nbsp;<span class="op" id="3644888">==</span>&nbsp;<span class="string" id="3644891">&#34;&#34;</span>&nbsp;<span class="op" id="3644894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644898">full</span>&nbsp;<span class="op" id="3644903">=</span>&nbsp;<span class="ident" id="3644905">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3644911">}</span>&nbsp;<span class="keyword" id="3644913">else</span>&nbsp;<span class="keyword" id="3644918">if</span>&nbsp;<span class="ident" id="3644921">ref</span><span class="op" id="3644924">[</span><span class="num" id="3644925">0</span><span class="op" id="3644926">]</span>&nbsp;<span class="op" id="3644928">!=</span>&nbsp;<span class="string" id="3644931">&#39;/&#39;</span>&nbsp;<span class="op" id="3644935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644939">i</span>&nbsp;<span class="op" id="3644941">:=</span>&nbsp;<span class="ident" id="3644944">strings</span><span class="op" id="3644951">.</span><span class="ident" id="3644952">LastIndex</span><span class="op" id="3644961">(</span><span class="ident" id="3644962">base</span><span class="op" id="3644966">,</span>&nbsp;<span class="string" id="3644968">&#34;/&#34;</span><span class="op" id="3644971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644975">full</span>&nbsp;<span class="op" id="3644980">=</span>&nbsp;<span class="ident" id="3644982">base</span><span class="op" id="3644986">[</span><span class="op" id="3644987">:</span><span class="ident" id="3644988">i</span><span class="op" id="3644989">+</span><span class="num" id="3644990">1</span><span class="op" id="3644991">]</span>&nbsp;<span class="op" id="3644993">+</span>&nbsp;<span class="ident" id="3644995">ref</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3645000">}</span>&nbsp;<span class="keyword" id="3645002">else</span>&nbsp;<span class="op" id="3645007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3645011">full</span>&nbsp;<span class="op" id="3645016">=</span>&nbsp;<span class="ident" id="3645018">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3645023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645026">if</span>&nbsp;<span class="ident" id="3645029">full</span>&nbsp;<span class="op" id="3645034">==</span>&nbsp;<span class="string" id="3645037">&#34;&#34;</span>&nbsp;<span class="op" id="3645040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645044">return</span>&nbsp;<span class="string" id="3645051">&#34;&#34;</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3645055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645058">var</span>&nbsp;<span class="ident" id="3645062">dst</span>&nbsp;<span class="op" id="3645066">[</span><span class="op" id="3645067">]</span><span class="builtintype" id="3645068">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3645076">src</span>&nbsp;<span class="op" id="3645080">:=</span>&nbsp;<span class="ident" id="3645083">strings</span><span class="op" id="3645090">.</span><span class="ident" id="3645091">Split</span><span class="op" id="3645096">(</span><span class="ident" id="3645097">full</span><span class="op" id="3645101">,</span>&nbsp;<span class="string" id="3645103">&#34;/&#34;</span><span class="op" id="3645106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645109">for</span>&nbsp;<span class="ident" id="3645113">_</span><span class="op" id="3645114">,</span>&nbsp;<span class="ident" id="3645116">elem</span>&nbsp;<span class="op" id="3645121">:=</span>&nbsp;<span class="keyword" id="3645124">range</span>&nbsp;<span class="ident" id="3645130">src</span>&nbsp;<span class="op" id="3645134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645138">switch</span>&nbsp;<span class="ident" id="3645145">elem</span>&nbsp;<span class="op" id="3645150">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645154">case</span>&nbsp;<span class="string" id="3645159">&#34;.&#34;</span><span class="op" id="3645162">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3645167">//&nbsp;drop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645177">case</span>&nbsp;<span class="string" id="3645182">&#34;..&#34;</span><span class="op" id="3645186">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645191">if</span>&nbsp;<span class="builtinfunc" id="3645194">len</span><span class="op" id="3645197">(</span><span class="ident" id="3645198">dst</span><span class="op" id="3645201">)</span>&nbsp;<span class="op" id="3645203">&gt;</span>&nbsp;<span class="num" id="3645205">0</span>&nbsp;<span class="op" id="3645207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3645213">dst</span>&nbsp;<span class="op" id="3645217">=</span>&nbsp;<span class="ident" id="3645219">dst</span><span class="op" id="3645222">[</span><span class="op" id="3645223">:</span><span class="builtinfunc" id="3645224">len</span><span class="op" id="3645227">(</span><span class="ident" id="3645228">dst</span><span class="op" id="3645231">)</span><span class="op" id="3645232">-</span><span class="num" id="3645233">1</span><span class="op" id="3645234">]</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3645239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645243">default</span><span class="op" id="3645250">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3645255">dst</span>&nbsp;<span class="op" id="3645259">=</span>&nbsp;<span class="builtinfunc" id="3645261">append</span><span class="op" id="3645267">(</span><span class="ident" id="3645268">dst</span><span class="op" id="3645271">,</span>&nbsp;<span class="ident" id="3645273">elem</span><span class="op" id="3645277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3645281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3645284">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645287">if</span>&nbsp;<span class="ident" id="3645290">last</span>&nbsp;<span class="op" id="3645295">:=</span>&nbsp;<span class="ident" id="3645298">src</span><span class="op" id="3645301">[</span><span class="builtinfunc" id="3645302">len</span><span class="op" id="3645305">(</span><span class="ident" id="3645306">src</span><span class="op" id="3645309">)</span><span class="op" id="3645310">-</span><span class="num" id="3645311">1</span><span class="op" id="3645312">]</span><span class="op" id="3645313">;</span>&nbsp;<span class="ident" id="3645315">last</span>&nbsp;<span class="op" id="3645320">==</span>&nbsp;<span class="string" id="3645323">&#34;.&#34;</span>&nbsp;<span class="op" id="3645327">||</span>&nbsp;<span class="ident" id="3645330">last</span>&nbsp;<span class="op" id="3645335">==</span>&nbsp;<span class="string" id="3645338">&#34;..&#34;</span>&nbsp;<span class="op" id="3645343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3645347">//&nbsp;Add&nbsp;final&nbsp;slash&nbsp;to&nbsp;the&nbsp;joined&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3645388">dst</span>&nbsp;<span class="op" id="3645392">=</span>&nbsp;<span class="builtinfunc" id="3645394">append</span><span class="op" id="3645400">(</span><span class="ident" id="3645401">dst</span><span class="op" id="3645404">,</span>&nbsp;<span class="string" id="3645406">&#34;&#34;</span><span class="op" id="3645408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3645411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645414">return</span>&nbsp;<span class="string" id="3645421">&#34;/&#34;</span>&nbsp;<span class="op" id="3645425">+</span>&nbsp;<span class="ident" id="3645427">strings</span><span class="op" id="3645434">.</span><span class="ident" id="3645435">TrimLeft</span><span class="op" id="3645443">(</span><span class="ident" id="3645444">strings</span><span class="op" id="3645451">.</span><span class="ident" id="3645452">Join</span><span class="op" id="3645456">(</span><span class="ident" id="3645457">dst</span><span class="op" id="3645460">,</span>&nbsp;<span class="string" id="3645462">&#34;/&#34;</span><span class="op" id="3645465">)</span><span class="op" id="3645466">,</span>&nbsp;<span class="string" id="3645468">&#34;/&#34;</span><span class="op" id="3645471">)</span><br>
<span class="lineno">640</span><span class="op" id="3645473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3645476">//&nbsp;IsAbs&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;URL&nbsp;is&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3645522">func</span>&nbsp;<span class="op" id="3645527">(</span><span class="ident" id="3645528">u</span>&nbsp;<span class="op" id="3645530">*</span><span class="ident" id="3645531">URL</span><span class="op" id="3645534">)</span>&nbsp;<span class="ident" id="3645536">IsAbs</span><span class="op" id="3645541">(</span><span class="op" id="3645542">)</span>&nbsp;<span class="builtintype" id="3645544">bool</span>&nbsp;<span class="op" id="3645549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645552">return</span>&nbsp;<span class="ident" id="3645559">u</span><span class="op" id="3645560">.</span><span class="ident" id="3645561">Scheme</span>&nbsp;<span class="op" id="3645568">!=</span>&nbsp;<span class="string" id="3645571">&#34;&#34;</span><br>
<span class="lineno">645</span><span class="op" id="3645574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3645577">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;in&nbsp;the&nbsp;context&nbsp;of&nbsp;the&nbsp;receiver.&nbsp;&nbsp;The&nbsp;provided&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="3645649">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;Parse&nbsp;returns&nbsp;nil,&nbsp;err&nbsp;on&nbsp;parse</span><br>
<span class="lineno"></span><span class="comment" id="3645714">//&nbsp;failure,&nbsp;otherwise&nbsp;its&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;ResolveReference.</span><br>
<span class="lineno">650</span><span class="keyword" id="3645786">func</span>&nbsp;<span class="op" id="3645791">(</span><span class="ident" id="3645792">u</span>&nbsp;<span class="op" id="3645794">*</span><span class="ident" id="3645795">URL</span><span class="op" id="3645798">)</span>&nbsp;<span class="ident" id="3645800">Parse</span><span class="op" id="3645805">(</span><span class="ident" id="3645806">ref</span>&nbsp;<span class="builtintype" id="3645810">string</span><span class="op" id="3645816">)</span>&nbsp;<span class="op" id="3645818">(</span><span class="op" id="3645819">*</span><span class="ident" id="3645820">URL</span><span class="op" id="3645823">,</span>&nbsp;<span class="builtintype" id="3645825">error</span><span class="op" id="3645830">)</span>&nbsp;<span class="op" id="3645832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3645835">refurl</span><span class="op" id="3645841">,</span>&nbsp;<span class="ident" id="3645843">err</span>&nbsp;<span class="op" id="3645847">:=</span>&nbsp;<span class="ident" id="3645850">Parse</span><span class="op" id="3645855">(</span><span class="ident" id="3645856">ref</span><span class="op" id="3645859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645862">if</span>&nbsp;<span class="ident" id="3645865">err</span>&nbsp;<span class="op" id="3645869">!=</span>&nbsp;<span class="ident" id="3645872">nil</span>&nbsp;<span class="op" id="3645876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645880">return</span>&nbsp;<span class="ident" id="3645887">nil</span><span class="op" id="3645890">,</span>&nbsp;<span class="ident" id="3645892">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3645897">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645900">return</span>&nbsp;<span class="ident" id="3645907">u</span><span class="op" id="3645908">.</span><span class="ident" id="3645909">ResolveReference</span><span class="op" id="3645925">(</span><span class="ident" id="3645926">refurl</span><span class="op" id="3645932">)</span><span class="op" id="3645933">,</span>&nbsp;<span class="ident" id="3645935">nil</span><br>
<span class="lineno"></span><span class="op" id="3645939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3645942">//&nbsp;ResolveReference&nbsp;resolves&nbsp;a&nbsp;URI&nbsp;reference&nbsp;to&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3646011">//&nbsp;an&nbsp;absolute&nbsp;base&nbsp;URI,&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;Section&nbsp;5.2.&nbsp;&nbsp;The&nbsp;URI&nbsp;reference</span><br>
<span class="lineno">660</span><span class="comment" id="3646081">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;ResolveReference&nbsp;always&nbsp;returns&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3646152">//&nbsp;URL&nbsp;instance,&nbsp;even&nbsp;if&nbsp;the&nbsp;returned&nbsp;URL&nbsp;is&nbsp;identical&nbsp;to&nbsp;either&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3646221">//&nbsp;base&nbsp;or&nbsp;reference.&nbsp;If&nbsp;ref&nbsp;is&nbsp;an&nbsp;absolute&nbsp;URL,&nbsp;then&nbsp;ResolveReference</span><br>
<span class="lineno"></span><span class="comment" id="3646292">//&nbsp;ignores&nbsp;base&nbsp;and&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;ref.</span><br>
<span class="lineno"></span><span class="keyword" id="3646335">func</span>&nbsp;<span class="op" id="3646340">(</span><span class="ident" id="3646341">u</span>&nbsp;<span class="op" id="3646343">*</span><span class="ident" id="3646344">URL</span><span class="op" id="3646347">)</span>&nbsp;<span class="ident" id="3646349">ResolveReference</span><span class="op" id="3646365">(</span><span class="ident" id="3646366">ref</span>&nbsp;<span class="op" id="3646370">*</span><span class="ident" id="3646371">URL</span><span class="op" id="3646374">)</span>&nbsp;<span class="op" id="3646376">*</span><span class="ident" id="3646377">URL</span>&nbsp;<span class="op" id="3646381">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646384">url</span>&nbsp;<span class="op" id="3646388">:=</span>&nbsp;<span class="op" id="3646391">*</span><span class="ident" id="3646392">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646397">if</span>&nbsp;<span class="ident" id="3646400">ref</span><span class="op" id="3646403">.</span><span class="ident" id="3646404">Scheme</span>&nbsp;<span class="op" id="3646411">==</span>&nbsp;<span class="string" id="3646414">&#34;&#34;</span>&nbsp;<span class="op" id="3646417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646421">url</span><span class="op" id="3646424">.</span><span class="ident" id="3646425">Scheme</span>&nbsp;<span class="op" id="3646432">=</span>&nbsp;<span class="ident" id="3646434">u</span><span class="op" id="3646435">.</span><span class="ident" id="3646436">Scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3646444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646447">if</span>&nbsp;<span class="ident" id="3646450">ref</span><span class="op" id="3646453">.</span><span class="ident" id="3646454">Scheme</span>&nbsp;<span class="op" id="3646461">!=</span>&nbsp;<span class="string" id="3646464">&#34;&#34;</span>&nbsp;<span class="op" id="3646467">||</span>&nbsp;<span class="ident" id="3646470">ref</span><span class="op" id="3646473">.</span><span class="ident" id="3646474">Host</span>&nbsp;<span class="op" id="3646479">!=</span>&nbsp;<span class="string" id="3646482">&#34;&#34;</span>&nbsp;<span class="op" id="3646485">||</span>&nbsp;<span class="ident" id="3646488">ref</span><span class="op" id="3646491">.</span><span class="ident" id="3646492">User</span>&nbsp;<span class="op" id="3646497">!=</span>&nbsp;<span class="ident" id="3646500">nil</span>&nbsp;<span class="op" id="3646504">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3646508">//&nbsp;The&nbsp;&#34;absoluteURI&#34;&nbsp;or&nbsp;&#34;net_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646552">url</span><span class="op" id="3646555">.</span><span class="ident" id="3646556">Path</span>&nbsp;<span class="op" id="3646561">=</span>&nbsp;<span class="ident" id="3646563">resolvePath</span><span class="op" id="3646574">(</span><span class="ident" id="3646575">ref</span><span class="op" id="3646578">.</span><span class="ident" id="3646579">Path</span><span class="op" id="3646583">,</span>&nbsp;<span class="string" id="3646585">&#34;&#34;</span><span class="op" id="3646587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646591">return</span>&nbsp;<span class="op" id="3646598">&amp;</span><span class="ident" id="3646599">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3646604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646607">if</span>&nbsp;<span class="ident" id="3646610">ref</span><span class="op" id="3646613">.</span><span class="ident" id="3646614">Opaque</span>&nbsp;<span class="op" id="3646621">!=</span>&nbsp;<span class="string" id="3646624">&#34;&#34;</span>&nbsp;<span class="op" id="3646627">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646631">url</span><span class="op" id="3646634">.</span><span class="ident" id="3646635">User</span>&nbsp;<span class="op" id="3646640">=</span>&nbsp;<span class="ident" id="3646642">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646648">url</span><span class="op" id="3646651">.</span><span class="ident" id="3646652">Host</span>&nbsp;<span class="op" id="3646657">=</span>&nbsp;<span class="string" id="3646659">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646664">url</span><span class="op" id="3646667">.</span><span class="ident" id="3646668">Path</span>&nbsp;<span class="op" id="3646673">=</span>&nbsp;<span class="string" id="3646675">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646680">return</span>&nbsp;<span class="op" id="3646687">&amp;</span><span class="ident" id="3646688">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3646693">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646696">if</span>&nbsp;<span class="ident" id="3646699">ref</span><span class="op" id="3646702">.</span><span class="ident" id="3646703">Path</span>&nbsp;<span class="op" id="3646708">==</span>&nbsp;<span class="string" id="3646711">&#34;&#34;</span>&nbsp;<span class="op" id="3646714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646718">if</span>&nbsp;<span class="ident" id="3646721">ref</span><span class="op" id="3646724">.</span><span class="ident" id="3646725">RawQuery</span>&nbsp;<span class="op" id="3646734">==</span>&nbsp;<span class="string" id="3646737">&#34;&#34;</span>&nbsp;<span class="op" id="3646740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646745">url</span><span class="op" id="3646748">.</span><span class="ident" id="3646749">RawQuery</span>&nbsp;<span class="op" id="3646758">=</span>&nbsp;<span class="ident" id="3646760">u</span><span class="op" id="3646761">.</span><span class="ident" id="3646762">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646774">if</span>&nbsp;<span class="ident" id="3646777">ref</span><span class="op" id="3646780">.</span><span class="ident" id="3646781">Fragment</span>&nbsp;<span class="op" id="3646790">==</span>&nbsp;<span class="string" id="3646793">&#34;&#34;</span>&nbsp;<span class="op" id="3646796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646802">url</span><span class="op" id="3646805">.</span><span class="ident" id="3646806">Fragment</span>&nbsp;<span class="op" id="3646815">=</span>&nbsp;<span class="ident" id="3646817">u</span><span class="op" id="3646818">.</span><span class="ident" id="3646819">Fragment</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3646831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3646835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3646838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3646841">//&nbsp;The&nbsp;&#34;abs_path&#34;&nbsp;or&nbsp;&#34;rel_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646881">url</span><span class="op" id="3646884">.</span><span class="ident" id="3646885">Host</span>&nbsp;<span class="op" id="3646890">=</span>&nbsp;<span class="ident" id="3646892">u</span><span class="op" id="3646893">.</span><span class="ident" id="3646894">Host</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646900">url</span><span class="op" id="3646903">.</span><span class="ident" id="3646904">User</span>&nbsp;<span class="op" id="3646909">=</span>&nbsp;<span class="ident" id="3646911">u</span><span class="op" id="3646912">.</span><span class="ident" id="3646913">User</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646919">url</span><span class="op" id="3646922">.</span><span class="ident" id="3646923">Path</span>&nbsp;<span class="op" id="3646928">=</span>&nbsp;<span class="ident" id="3646930">resolvePath</span><span class="op" id="3646941">(</span><span class="ident" id="3646942">u</span><span class="op" id="3646943">.</span><span class="ident" id="3646944">Path</span><span class="op" id="3646948">,</span>&nbsp;<span class="ident" id="3646950">ref</span><span class="op" id="3646953">.</span><span class="ident" id="3646954">Path</span><span class="op" id="3646958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646961">return</span>&nbsp;<span class="op" id="3646968">&amp;</span><span class="ident" id="3646969">url</span><br>
<span class="lineno"></span><span class="op" id="3646973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="3646976">//&nbsp;Query&nbsp;parses&nbsp;RawQuery&nbsp;and&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3647039">func</span>&nbsp;<span class="op" id="3647044">(</span><span class="ident" id="3647045">u</span>&nbsp;<span class="op" id="3647047">*</span><span class="ident" id="3647048">URL</span><span class="op" id="3647051">)</span>&nbsp;<span class="ident" id="3647053">Query</span><span class="op" id="3647058">(</span><span class="op" id="3647059">)</span>&nbsp;<span class="ident" id="3647061">Values</span>&nbsp;<span class="op" id="3647068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3647071">v</span><span class="op" id="3647072">,</span>&nbsp;<span class="ident" id="3647074">_</span>&nbsp;<span class="op" id="3647076">:=</span>&nbsp;<span class="ident" id="3647079">ParseQuery</span><span class="op" id="3647089">(</span><span class="ident" id="3647090">u</span><span class="op" id="3647091">.</span><span class="ident" id="3647092">RawQuery</span><span class="op" id="3647100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3647103">return</span>&nbsp;<span class="ident" id="3647110">v</span><br>
<span class="lineno"></span><span class="op" id="3647112">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="comment" id="3647115">//&nbsp;RequestURI&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;path?query&nbsp;or&nbsp;opaque?query</span><br>
<span class="lineno"></span><span class="comment" id="3647176">//&nbsp;string&nbsp;that&nbsp;would&nbsp;be&nbsp;used&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;for&nbsp;u.</span><br>
<span class="lineno"></span><span class="keyword" id="3647231">func</span>&nbsp;<span class="op" id="3647236">(</span><span class="ident" id="3647237">u</span>&nbsp;<span class="op" id="3647239">*</span><span class="ident" id="3647240">URL</span><span class="op" id="3647243">)</span>&nbsp;<span class="ident" id="3647245">RequestURI</span><span class="op" id="3647255">(</span><span class="op" id="3647256">)</span>&nbsp;<span class="builtintype" id="3647258">string</span>&nbsp;<span class="op" id="3647265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3647268">result</span>&nbsp;<span class="op" id="3647275">:=</span>&nbsp;<span class="ident" id="3647278">u</span><span class="op" id="3647279">.</span><span class="ident" id="3647280">Opaque</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3647288">if</span>&nbsp;<span class="ident" id="3647291">result</span>&nbsp;<span class="op" id="3647298">==</span>&nbsp;<span class="string" id="3647301">&#34;&#34;</span>&nbsp;<span class="op" id="3647304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3647308">result</span>&nbsp;<span class="op" id="3647315">=</span>&nbsp;<span class="ident" id="3647317">escape</span><span class="op" id="3647323">(</span><span class="ident" id="3647324">u</span><span class="op" id="3647325">.</span><span class="ident" id="3647326">Path</span><span class="op" id="3647330">,</span>&nbsp;<span class="ident" id="3647332">encodePath</span><span class="op" id="3647342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3647346">if</span>&nbsp;<span class="ident" id="3647349">result</span>&nbsp;<span class="op" id="3647356">==</span>&nbsp;<span class="string" id="3647359">&#34;&#34;</span>&nbsp;<span class="op" id="3647362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3647367">result</span>&nbsp;<span class="op" id="3647374">=</span>&nbsp;<span class="string" id="3647376">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3647382">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3647385">}</span>&nbsp;<span class="keyword" id="3647387">else</span>&nbsp;<span class="op" id="3647392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3647396">if</span>&nbsp;<span class="ident" id="3647399">strings</span><span class="op" id="3647406">.</span><span class="ident" id="3647407">HasPrefix</span><span class="op" id="3647416">(</span><span class="ident" id="3647417">result</span><span class="op" id="3647423">,</span>&nbsp;<span class="string" id="3647425">&#34;//&#34;</span><span class="op" id="3647429">)</span>&nbsp;<span class="op" id="3647431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3647436">result</span>&nbsp;<span class="op" id="3647443">=</span>&nbsp;<span class="ident" id="3647445">u</span><span class="op" id="3647446">.</span><span class="ident" id="3647447">Scheme</span>&nbsp;<span class="op" id="3647454">+</span>&nbsp;<span class="string" id="3647456">&#34;:&#34;</span>&nbsp;<span class="op" id="3647460">+</span>&nbsp;<span class="ident" id="3647462">result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3647471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3647474">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3647477">if</span>&nbsp;<span class="ident" id="3647480">u</span><span class="op" id="3647481">.</span><span class="ident" id="3647482">RawQuery</span>&nbsp;<span class="op" id="3647491">!=</span>&nbsp;<span class="string" id="3647494">&#34;&#34;</span>&nbsp;<span class="op" id="3647497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3647501">result</span>&nbsp;<span class="op" id="3647508">+=</span>&nbsp;<span class="string" id="3647511">&#34;?&#34;</span>&nbsp;<span class="op" id="3647515">+</span>&nbsp;<span class="ident" id="3647517">u</span><span class="op" id="3647518">.</span><span class="ident" id="3647519">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3647529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3647532">return</span>&nbsp;<span class="ident" id="3647539">result</span><br>
<span class="lineno"></span><span class="op" id="3647546">}</span>
</div>
</body>
</html>
