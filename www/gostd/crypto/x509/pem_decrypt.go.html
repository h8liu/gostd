<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3576067">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3576122">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3576176">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3576227">package</span>&nbsp;<span class="ident" id="3576235">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3576241">//&nbsp;RFC&nbsp;1423&nbsp;describes&nbsp;the&nbsp;encryption&nbsp;of&nbsp;PEM&nbsp;blocks.&nbsp;The&nbsp;algorithm&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3576315">//&nbsp;generate&nbsp;a&nbsp;key&nbsp;from&nbsp;the&nbsp;password&nbsp;was&nbsp;derived&nbsp;by&nbsp;looking&nbsp;at&nbsp;the&nbsp;OpenSSL</span><br>
<span class="lineno"></span><span class="comment" id="3576389">//&nbsp;implementation.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="3576409">import</span>&nbsp;<span class="op" id="3576416">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3576419">&#34;crypto/aes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3576433">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3576450">&#34;crypto/des&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3576464">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3576478">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3576494">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3576510">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3576520">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3576526">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3576536">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3576539">type</span>&nbsp;<span class="ident" id="3576544">PEMCipher</span>&nbsp;<span class="builtintype" id="3576554">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3576559">//&nbsp;Possible&nbsp;values&nbsp;for&nbsp;the&nbsp;EncryptPEMBlock&nbsp;encryption&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="3576624">const</span>&nbsp;<span class="op" id="3576630">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576633">_</span>&nbsp;<span class="ident" id="3576635">PEMCipher</span>&nbsp;<span class="op" id="3576645">=</span>&nbsp;<span class="ident" id="3576647">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576653">PEMCipherDES</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576667">PEMCipher3DES</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576682">PEMCipherAES128</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576699">PEMCipherAES192</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576716">PEMCipherAES256</span><br>
<span class="lineno"></span><span class="op" id="3576732">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3576735">//&nbsp;rfc1423Algo&nbsp;holds&nbsp;a&nbsp;method&nbsp;for&nbsp;enciphering&nbsp;a&nbsp;PEM&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="3576794">type</span>&nbsp;<span class="ident" id="3576799">rfc1423Algo</span>&nbsp;<span class="keyword" id="3576811">struct</span>&nbsp;<span class="op" id="3576818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576821">cipher</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3576832">PEMCipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576843">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3576854">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576862">cipherFunc</span>&nbsp;<span class="keyword" id="3576873">func</span><span class="op" id="3576877">(</span><span class="ident" id="3576878">key</span>&nbsp;<span class="op" id="3576882">[</span><span class="op" id="3576883">]</span><span class="builtintype" id="3576884">byte</span><span class="op" id="3576888">)</span>&nbsp;<span class="op" id="3576890">(</span><span class="ident" id="3576891">cipher</span><span class="op" id="3576897">.</span><span class="ident" id="3576898">Block</span><span class="op" id="3576903">,</span>&nbsp;<span class="builtintype" id="3576905">error</span><span class="op" id="3576910">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576913">keySize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3576924">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576929">blockSize</span>&nbsp;&nbsp;<span class="builtintype" id="3576940">int</span><br>
<span class="lineno"></span><span class="op" id="3576944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3576947">//&nbsp;rfc1423Algos&nbsp;holds&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;possible&nbsp;ways&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;PEM</span><br>
<span class="lineno">45</span><span class="comment" id="3577015">//&nbsp;block.&nbsp;&nbsp;The&nbsp;ivSize&nbsp;numbers&nbsp;were&nbsp;taken&nbsp;from&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="3577081">var</span>&nbsp;<span class="ident" id="3577085">rfc1423Algos</span>&nbsp;<span class="op" id="3577098">=</span>&nbsp;<span class="op" id="3577100">[</span><span class="op" id="3577101">]</span><span class="ident" id="3577102">rfc1423Algo</span><span class="op" id="3577113">{</span><span class="op" id="3577114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577117">cipher</span><span class="op" id="3577123">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3577129">PEMCipherDES</span><span class="op" id="3577141">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577144">name</span><span class="op" id="3577148">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3577156">&#34;DES-CBC&#34;</span><span class="op" id="3577165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577168">cipherFunc</span><span class="op" id="3577178">:</span>&nbsp;<span class="ident" id="3577180">des</span><span class="op" id="3577183">.</span><span class="ident" id="3577184">NewCipher</span><span class="op" id="3577193">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577196">keySize</span><span class="op" id="3577203">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3577208">8</span><span class="op" id="3577209">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577212">blockSize</span><span class="op" id="3577221">:</span>&nbsp;&nbsp;<span class="ident" id="3577224">des</span><span class="op" id="3577227">.</span><span class="ident" id="3577228">BlockSize</span><span class="op" id="3577237">,</span><br>
<span class="lineno"></span><span class="op" id="3577239">}</span><span class="op" id="3577240">,</span>&nbsp;<span class="op" id="3577242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577245">cipher</span><span class="op" id="3577251">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3577257">PEMCipher3DES</span><span class="op" id="3577270">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577273">name</span><span class="op" id="3577277">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3577285">&#34;DES-EDE3-CBC&#34;</span><span class="op" id="3577299">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577302">cipherFunc</span><span class="op" id="3577312">:</span>&nbsp;<span class="ident" id="3577314">des</span><span class="op" id="3577317">.</span><span class="ident" id="3577318">NewTripleDESCipher</span><span class="op" id="3577336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577339">keySize</span><span class="op" id="3577346">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3577351">24</span><span class="op" id="3577353">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577356">blockSize</span><span class="op" id="3577365">:</span>&nbsp;&nbsp;<span class="ident" id="3577368">des</span><span class="op" id="3577371">.</span><span class="ident" id="3577372">BlockSize</span><span class="op" id="3577381">,</span><br>
<span class="lineno"></span><span class="op" id="3577383">}</span><span class="op" id="3577384">,</span>&nbsp;<span class="op" id="3577386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577389">cipher</span><span class="op" id="3577395">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3577401">PEMCipherAES128</span><span class="op" id="3577416">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577419">name</span><span class="op" id="3577423">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3577431">&#34;AES-128-CBC&#34;</span><span class="op" id="3577444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577447">cipherFunc</span><span class="op" id="3577457">:</span>&nbsp;<span class="ident" id="3577459">aes</span><span class="op" id="3577462">.</span><span class="ident" id="3577463">NewCipher</span><span class="op" id="3577472">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577475">keySize</span><span class="op" id="3577482">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3577487">16</span><span class="op" id="3577489">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577492">blockSize</span><span class="op" id="3577501">:</span>&nbsp;&nbsp;<span class="ident" id="3577504">aes</span><span class="op" id="3577507">.</span><span class="ident" id="3577508">BlockSize</span><span class="op" id="3577517">,</span><br>
<span class="lineno"></span><span class="op" id="3577519">}</span><span class="op" id="3577520">,</span>&nbsp;<span class="op" id="3577522">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577525">cipher</span><span class="op" id="3577531">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3577537">PEMCipherAES192</span><span class="op" id="3577552">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577555">name</span><span class="op" id="3577559">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3577567">&#34;AES-192-CBC&#34;</span><span class="op" id="3577580">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577583">cipherFunc</span><span class="op" id="3577593">:</span>&nbsp;<span class="ident" id="3577595">aes</span><span class="op" id="3577598">.</span><span class="ident" id="3577599">NewCipher</span><span class="op" id="3577608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577611">keySize</span><span class="op" id="3577618">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3577623">24</span><span class="op" id="3577625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577628">blockSize</span><span class="op" id="3577637">:</span>&nbsp;&nbsp;<span class="ident" id="3577640">aes</span><span class="op" id="3577643">.</span><span class="ident" id="3577644">BlockSize</span><span class="op" id="3577653">,</span><br>
<span class="lineno">70</span><span class="op" id="3577655">}</span><span class="op" id="3577656">,</span>&nbsp;<span class="op" id="3577658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577661">cipher</span><span class="op" id="3577667">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3577673">PEMCipherAES256</span><span class="op" id="3577688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577691">name</span><span class="op" id="3577695">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3577703">&#34;AES-256-CBC&#34;</span><span class="op" id="3577716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577719">cipherFunc</span><span class="op" id="3577729">:</span>&nbsp;<span class="ident" id="3577731">aes</span><span class="op" id="3577734">.</span><span class="ident" id="3577735">NewCipher</span><span class="op" id="3577744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577747">keySize</span><span class="op" id="3577754">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3577759">32</span><span class="op" id="3577761">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577764">blockSize</span><span class="op" id="3577773">:</span>&nbsp;&nbsp;<span class="ident" id="3577776">aes</span><span class="op" id="3577779">.</span><span class="ident" id="3577780">BlockSize</span><span class="op" id="3577789">,</span><br>
<span class="lineno"></span><span class="op" id="3577791">}</span><span class="op" id="3577792">,</span><br>
<span class="lineno"></span><span class="op" id="3577794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3577797">//&nbsp;deriveKey&nbsp;uses&nbsp;a&nbsp;key&nbsp;derivation&nbsp;function&nbsp;to&nbsp;stretch&nbsp;the&nbsp;password&nbsp;into&nbsp;a&nbsp;key</span><br>
<span class="lineno">80</span><span class="comment" id="3577876">//&nbsp;with&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;our&nbsp;cipher&nbsp;requires.&nbsp;This&nbsp;algorithm&nbsp;was&nbsp;derived&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3577956">//&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="3577979">func</span>&nbsp;<span class="op" id="3577984">(</span><span class="ident" id="3577985">c</span>&nbsp;<span class="ident" id="3577987">rfc1423Algo</span><span class="op" id="3577998">)</span>&nbsp;<span class="ident" id="3578000">deriveKey</span><span class="op" id="3578009">(</span><span class="ident" id="3578010">password</span><span class="op" id="3578018">,</span>&nbsp;<span class="ident" id="3578020">salt</span>&nbsp;<span class="op" id="3578025">[</span><span class="op" id="3578026">]</span><span class="builtintype" id="3578027">byte</span><span class="op" id="3578031">)</span>&nbsp;<span class="op" id="3578033">[</span><span class="op" id="3578034">]</span><span class="builtintype" id="3578035">byte</span>&nbsp;<span class="op" id="3578040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578043">hash</span>&nbsp;<span class="op" id="3578048">:=</span>&nbsp;<span class="ident" id="3578051">md5</span><span class="op" id="3578054">.</span><span class="ident" id="3578055">New</span><span class="op" id="3578058">(</span><span class="op" id="3578059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578062">out</span>&nbsp;<span class="op" id="3578066">:=</span>&nbsp;<span class="builtinfunc" id="3578069">make</span><span class="op" id="3578073">(</span><span class="op" id="3578074">[</span><span class="op" id="3578075">]</span><span class="builtintype" id="3578076">byte</span><span class="op" id="3578080">,</span>&nbsp;<span class="ident" id="3578082">c</span><span class="op" id="3578083">.</span><span class="ident" id="3578084">keySize</span><span class="op" id="3578091">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578094">var</span>&nbsp;<span class="ident" id="3578098">digest</span>&nbsp;<span class="op" id="3578105">[</span><span class="op" id="3578106">]</span><span class="builtintype" id="3578107">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578114">for</span>&nbsp;<span class="ident" id="3578118">i</span>&nbsp;<span class="op" id="3578120">:=</span>&nbsp;<span class="num" id="3578123">0</span><span class="op" id="3578124">;</span>&nbsp;<span class="ident" id="3578126">i</span>&nbsp;<span class="op" id="3578128">&lt;</span>&nbsp;<span class="builtinfunc" id="3578130">len</span><span class="op" id="3578133">(</span><span class="ident" id="3578134">out</span><span class="op" id="3578137">)</span><span class="op" id="3578138">;</span>&nbsp;<span class="ident" id="3578140">i</span>&nbsp;<span class="op" id="3578142">+=</span>&nbsp;<span class="builtinfunc" id="3578145">len</span><span class="op" id="3578148">(</span><span class="ident" id="3578149">digest</span><span class="op" id="3578155">)</span>&nbsp;<span class="op" id="3578157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578161">hash</span><span class="op" id="3578165">.</span><span class="ident" id="3578166">Reset</span><span class="op" id="3578171">(</span><span class="op" id="3578172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578176">hash</span><span class="op" id="3578180">.</span><span class="ident" id="3578181">Write</span><span class="op" id="3578186">(</span><span class="ident" id="3578187">digest</span><span class="op" id="3578193">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578197">hash</span><span class="op" id="3578201">.</span><span class="ident" id="3578202">Write</span><span class="op" id="3578207">(</span><span class="ident" id="3578208">password</span><span class="op" id="3578216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578220">hash</span><span class="op" id="3578224">.</span><span class="ident" id="3578225">Write</span><span class="op" id="3578230">(</span><span class="ident" id="3578231">salt</span><span class="op" id="3578235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578239">digest</span>&nbsp;<span class="op" id="3578246">=</span>&nbsp;<span class="ident" id="3578248">hash</span><span class="op" id="3578252">.</span><span class="ident" id="3578253">Sum</span><span class="op" id="3578256">(</span><span class="ident" id="3578257">digest</span><span class="op" id="3578263">[</span><span class="op" id="3578264">:</span><span class="num" id="3578265">0</span><span class="op" id="3578266">]</span><span class="op" id="3578267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3578271">copy</span><span class="op" id="3578275">(</span><span class="ident" id="3578276">out</span><span class="op" id="3578279">[</span><span class="ident" id="3578280">i</span><span class="op" id="3578281">:</span><span class="op" id="3578282">]</span><span class="op" id="3578283">,</span>&nbsp;<span class="ident" id="3578285">digest</span><span class="op" id="3578291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3578294">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578297">return</span>&nbsp;<span class="ident" id="3578304">out</span><br>
<span class="lineno"></span><span class="op" id="3578308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3578311">//&nbsp;IsEncryptedPEMBlock&nbsp;returns&nbsp;if&nbsp;the&nbsp;PEM&nbsp;block&nbsp;is&nbsp;password&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="3578382">func</span>&nbsp;<span class="ident" id="3578387">IsEncryptedPEMBlock</span><span class="op" id="3578406">(</span><span class="ident" id="3578407">b</span>&nbsp;<span class="op" id="3578409">*</span><span class="ident" id="3578410">pem</span><span class="op" id="3578413">.</span><span class="ident" id="3578414">Block</span><span class="op" id="3578419">)</span>&nbsp;<span class="builtintype" id="3578421">bool</span>&nbsp;<span class="op" id="3578426">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578429">_</span><span class="op" id="3578430">,</span>&nbsp;<span class="ident" id="3578432">ok</span>&nbsp;<span class="op" id="3578435">:=</span>&nbsp;<span class="ident" id="3578438">b</span><span class="op" id="3578439">.</span><span class="ident" id="3578440">Headers</span><span class="op" id="3578447">[</span><span class="string" id="3578448">&#34;DEK-Info&#34;</span><span class="op" id="3578458">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578461">return</span>&nbsp;<span class="ident" id="3578468">ok</span><br>
<span class="lineno"></span><span class="op" id="3578471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3578474">//&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned&nbsp;when&nbsp;an&nbsp;incorrect&nbsp;password&nbsp;is&nbsp;detected.</span><br>
<span class="lineno">105</span><span class="keyword" id="3578552">var</span>&nbsp;<span class="ident" id="3578556">IncorrectPasswordError</span>&nbsp;<span class="op" id="3578579">=</span>&nbsp;<span class="ident" id="3578581">errors</span><span class="op" id="3578587">.</span><span class="ident" id="3578588">New</span><span class="op" id="3578591">(</span><span class="string" id="3578592">&#34;x509:&nbsp;decryption&nbsp;password&nbsp;incorrect&#34;</span><span class="op" id="3578629">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3578632">//&nbsp;DecryptPEMBlock&nbsp;takes&nbsp;a&nbsp;password&nbsp;encrypted&nbsp;PEM&nbsp;block&nbsp;and&nbsp;the&nbsp;password&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3578713">//&nbsp;encrypt&nbsp;it&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;decrypted&nbsp;DER&nbsp;encoded&nbsp;bytes.&nbsp;It&nbsp;inspects</span><br>
<span class="lineno"></span><span class="comment" id="3578791">//&nbsp;the&nbsp;DEK-Info&nbsp;header&nbsp;to&nbsp;determine&nbsp;the&nbsp;algorithm&nbsp;used&nbsp;for&nbsp;decryption.&nbsp;If&nbsp;no</span><br>
<span class="lineno">110</span><span class="comment" id="3578868">//&nbsp;DEK-Info&nbsp;header&nbsp;is&nbsp;present,&nbsp;an&nbsp;error&nbsp;is&nbsp;returned.&nbsp;If&nbsp;an&nbsp;incorrect&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="3578946">//&nbsp;is&nbsp;detected&nbsp;an&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="3579000">func</span>&nbsp;<span class="ident" id="3579005">DecryptPEMBlock</span><span class="op" id="3579020">(</span><span class="ident" id="3579021">b</span>&nbsp;<span class="op" id="3579023">*</span><span class="ident" id="3579024">pem</span><span class="op" id="3579027">.</span><span class="ident" id="3579028">Block</span><span class="op" id="3579033">,</span>&nbsp;<span class="ident" id="3579035">password</span>&nbsp;<span class="op" id="3579044">[</span><span class="op" id="3579045">]</span><span class="builtintype" id="3579046">byte</span><span class="op" id="3579050">)</span>&nbsp;<span class="op" id="3579052">(</span><span class="op" id="3579053">[</span><span class="op" id="3579054">]</span><span class="builtintype" id="3579055">byte</span><span class="op" id="3579059">,</span>&nbsp;<span class="builtintype" id="3579061">error</span><span class="op" id="3579066">)</span>&nbsp;<span class="op" id="3579068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579071">dek</span><span class="op" id="3579074">,</span>&nbsp;<span class="ident" id="3579076">ok</span>&nbsp;<span class="op" id="3579079">:=</span>&nbsp;<span class="ident" id="3579082">b</span><span class="op" id="3579083">.</span><span class="ident" id="3579084">Headers</span><span class="op" id="3579091">[</span><span class="string" id="3579092">&#34;DEK-Info&#34;</span><span class="op" id="3579102">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579105">if</span>&nbsp;<span class="op" id="3579108">!</span><span class="ident" id="3579109">ok</span>&nbsp;<span class="op" id="3579112">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579116">return</span>&nbsp;<span class="ident" id="3579123">nil</span><span class="op" id="3579126">,</span>&nbsp;<span class="ident" id="3579128">errors</span><span class="op" id="3579134">.</span><span class="ident" id="3579135">New</span><span class="op" id="3579138">(</span><span class="string" id="3579139">&#34;x509:&nbsp;no&nbsp;DEK-Info&nbsp;header&nbsp;in&nbsp;block&#34;</span><span class="op" id="3579174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3579177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579181">idx</span>&nbsp;<span class="op" id="3579185">:=</span>&nbsp;<span class="ident" id="3579188">strings</span><span class="op" id="3579195">.</span><span class="ident" id="3579196">Index</span><span class="op" id="3579201">(</span><span class="ident" id="3579202">dek</span><span class="op" id="3579205">,</span>&nbsp;<span class="string" id="3579207">&#34;,&#34;</span><span class="op" id="3579210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579213">if</span>&nbsp;<span class="ident" id="3579216">idx</span>&nbsp;<span class="op" id="3579220">==</span>&nbsp;<span class="op" id="3579223">-</span><span class="num" id="3579224">1</span>&nbsp;<span class="op" id="3579226">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579230">return</span>&nbsp;<span class="ident" id="3579237">nil</span><span class="op" id="3579240">,</span>&nbsp;<span class="ident" id="3579242">errors</span><span class="op" id="3579248">.</span><span class="ident" id="3579249">New</span><span class="op" id="3579252">(</span><span class="string" id="3579253">&#34;x509:&nbsp;malformed&nbsp;DEK-Info&nbsp;header&#34;</span><span class="op" id="3579286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3579289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579293">mode</span><span class="op" id="3579297">,</span>&nbsp;<span class="ident" id="3579299">hexIV</span>&nbsp;<span class="op" id="3579305">:=</span>&nbsp;<span class="ident" id="3579308">dek</span><span class="op" id="3579311">[</span><span class="op" id="3579312">:</span><span class="ident" id="3579313">idx</span><span class="op" id="3579316">]</span><span class="op" id="3579317">,</span>&nbsp;<span class="ident" id="3579319">dek</span><span class="op" id="3579322">[</span><span class="ident" id="3579323">idx</span><span class="op" id="3579326">+</span><span class="num" id="3579327">1</span><span class="op" id="3579328">:</span><span class="op" id="3579329">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579332">ciph</span>&nbsp;<span class="op" id="3579337">:=</span>&nbsp;<span class="ident" id="3579340">cipherByName</span><span class="op" id="3579352">(</span><span class="ident" id="3579353">mode</span><span class="op" id="3579357">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579360">if</span>&nbsp;<span class="ident" id="3579363">ciph</span>&nbsp;<span class="op" id="3579368">==</span>&nbsp;<span class="ident" id="3579371">nil</span>&nbsp;<span class="op" id="3579375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579379">return</span>&nbsp;<span class="ident" id="3579386">nil</span><span class="op" id="3579389">,</span>&nbsp;<span class="ident" id="3579391">errors</span><span class="op" id="3579397">.</span><span class="ident" id="3579398">New</span><span class="op" id="3579401">(</span><span class="string" id="3579402">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="3579433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3579436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579439">iv</span><span class="op" id="3579441">,</span>&nbsp;<span class="ident" id="3579443">err</span>&nbsp;<span class="op" id="3579447">:=</span>&nbsp;<span class="ident" id="3579450">hex</span><span class="op" id="3579453">.</span><span class="ident" id="3579454">DecodeString</span><span class="op" id="3579466">(</span><span class="ident" id="3579467">hexIV</span><span class="op" id="3579472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579475">if</span>&nbsp;<span class="ident" id="3579478">err</span>&nbsp;<span class="op" id="3579482">!=</span>&nbsp;<span class="ident" id="3579485">nil</span>&nbsp;<span class="op" id="3579489">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579493">return</span>&nbsp;<span class="ident" id="3579500">nil</span><span class="op" id="3579503">,</span>&nbsp;<span class="ident" id="3579505">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3579510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579513">if</span>&nbsp;<span class="builtinfunc" id="3579516">len</span><span class="op" id="3579519">(</span><span class="ident" id="3579520">iv</span><span class="op" id="3579522">)</span>&nbsp;<span class="op" id="3579524">!=</span>&nbsp;<span class="ident" id="3579527">ciph</span><span class="op" id="3579531">.</span><span class="ident" id="3579532">blockSize</span>&nbsp;<span class="op" id="3579542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579546">return</span>&nbsp;<span class="ident" id="3579553">nil</span><span class="op" id="3579556">,</span>&nbsp;<span class="ident" id="3579558">errors</span><span class="op" id="3579564">.</span><span class="ident" id="3579565">New</span><span class="op" id="3579568">(</span><span class="string" id="3579569">&#34;x509:&nbsp;incorrect&nbsp;IV&nbsp;size&#34;</span><span class="op" id="3579594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3579597">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3579601">//&nbsp;Based&nbsp;on&nbsp;the&nbsp;OpenSSL&nbsp;implementation.&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3579672">//&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579706">key</span>&nbsp;<span class="op" id="3579710">:=</span>&nbsp;<span class="ident" id="3579713">ciph</span><span class="op" id="3579717">.</span><span class="ident" id="3579718">deriveKey</span><span class="op" id="3579727">(</span><span class="ident" id="3579728">password</span><span class="op" id="3579736">,</span>&nbsp;<span class="ident" id="3579738">iv</span><span class="op" id="3579740">[</span><span class="op" id="3579741">:</span><span class="num" id="3579742">8</span><span class="op" id="3579743">]</span><span class="op" id="3579744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579747">block</span><span class="op" id="3579752">,</span>&nbsp;<span class="ident" id="3579754">err</span>&nbsp;<span class="op" id="3579758">:=</span>&nbsp;<span class="ident" id="3579761">ciph</span><span class="op" id="3579765">.</span><span class="ident" id="3579766">cipherFunc</span><span class="op" id="3579776">(</span><span class="ident" id="3579777">key</span><span class="op" id="3579780">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579783">if</span>&nbsp;<span class="ident" id="3579786">err</span>&nbsp;<span class="op" id="3579790">!=</span>&nbsp;<span class="ident" id="3579793">nil</span>&nbsp;<span class="op" id="3579797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579801">return</span>&nbsp;<span class="ident" id="3579808">nil</span><span class="op" id="3579811">,</span>&nbsp;<span class="ident" id="3579813">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3579818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579822">data</span>&nbsp;<span class="op" id="3579827">:=</span>&nbsp;<span class="builtinfunc" id="3579830">make</span><span class="op" id="3579834">(</span><span class="op" id="3579835">[</span><span class="op" id="3579836">]</span><span class="builtintype" id="3579837">byte</span><span class="op" id="3579841">,</span>&nbsp;<span class="builtinfunc" id="3579843">len</span><span class="op" id="3579846">(</span><span class="ident" id="3579847">b</span><span class="op" id="3579848">.</span><span class="ident" id="3579849">Bytes</span><span class="op" id="3579854">)</span><span class="op" id="3579855">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579858">dec</span>&nbsp;<span class="op" id="3579862">:=</span>&nbsp;<span class="ident" id="3579865">cipher</span><span class="op" id="3579871">.</span><span class="ident" id="3579872">NewCBCDecrypter</span><span class="op" id="3579887">(</span><span class="ident" id="3579888">block</span><span class="op" id="3579893">,</span>&nbsp;<span class="ident" id="3579895">iv</span><span class="op" id="3579897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579900">dec</span><span class="op" id="3579903">.</span><span class="ident" id="3579904">CryptBlocks</span><span class="op" id="3579915">(</span><span class="ident" id="3579916">data</span><span class="op" id="3579920">,</span>&nbsp;<span class="ident" id="3579922">b</span><span class="op" id="3579923">.</span><span class="ident" id="3579924">Bytes</span><span class="op" id="3579929">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3579933">//&nbsp;Blocks&nbsp;are&nbsp;padded&nbsp;using&nbsp;a&nbsp;scheme&nbsp;where&nbsp;the&nbsp;last&nbsp;n&nbsp;bytes&nbsp;of&nbsp;padding&nbsp;are&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3580012">//&nbsp;equal&nbsp;to&nbsp;n.&nbsp;It&nbsp;can&nbsp;pad&nbsp;from&nbsp;1&nbsp;to&nbsp;blocksize&nbsp;bytes&nbsp;inclusive.&nbsp;See&nbsp;RFC&nbsp;1423.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3580090">//&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3580107">//&nbsp;&nbsp;&nbsp;&nbsp[x&nbsp;y&nbsp;z&nbsp;2&nbsp;2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3580123">//&nbsp;&nbsp;&nbsp;&nbsp[x&nbsp;y&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3580147">//&nbsp;If&nbsp;we&nbsp;detect&nbsp;a&nbsp;bad&nbsp;padding,&nbsp;we&nbsp;assume&nbsp;it&nbsp;is&nbsp;an&nbsp;invalid&nbsp;password.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3580216">dlen</span>&nbsp;<span class="op" id="3580221">:=</span>&nbsp;<span class="builtinfunc" id="3580224">len</span><span class="op" id="3580227">(</span><span class="ident" id="3580228">data</span><span class="op" id="3580232">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580235">if</span>&nbsp;<span class="ident" id="3580238">dlen</span>&nbsp;<span class="op" id="3580243">==</span>&nbsp;<span class="num" id="3580246">0</span>&nbsp;<span class="op" id="3580248">||</span>&nbsp;<span class="ident" id="3580251">dlen</span><span class="op" id="3580255">%</span><span class="ident" id="3580256">ciph</span><span class="op" id="3580260">.</span><span class="ident" id="3580261">blockSize</span>&nbsp;<span class="op" id="3580271">!=</span>&nbsp;<span class="num" id="3580274">0</span>&nbsp;<span class="op" id="3580276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580280">return</span>&nbsp;<span class="ident" id="3580287">nil</span><span class="op" id="3580290">,</span>&nbsp;<span class="ident" id="3580292">errors</span><span class="op" id="3580298">.</span><span class="ident" id="3580299">New</span><span class="op" id="3580302">(</span><span class="string" id="3580303">&#34;x509:&nbsp;invalid&nbsp;padding&#34;</span><span class="op" id="3580326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3580329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3580332">last</span>&nbsp;<span class="op" id="3580337">:=</span>&nbsp;<span class="builtintype" id="3580340">int</span><span class="op" id="3580343">(</span><span class="ident" id="3580344">data</span><span class="op" id="3580348">[</span><span class="ident" id="3580349">dlen</span><span class="op" id="3580353">-</span><span class="num" id="3580354">1</span><span class="op" id="3580355">]</span><span class="op" id="3580356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580359">if</span>&nbsp;<span class="ident" id="3580362">dlen</span>&nbsp;<span class="op" id="3580367">&lt;</span>&nbsp;<span class="ident" id="3580369">last</span>&nbsp;<span class="op" id="3580374">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580378">return</span>&nbsp;<span class="ident" id="3580385">nil</span><span class="op" id="3580388">,</span>&nbsp;<span class="ident" id="3580390">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3580414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580417">if</span>&nbsp;<span class="ident" id="3580420">last</span>&nbsp;<span class="op" id="3580425">==</span>&nbsp;<span class="num" id="3580428">0</span>&nbsp;<span class="op" id="3580430">||</span>&nbsp;<span class="ident" id="3580433">last</span>&nbsp;<span class="op" id="3580438">&gt;</span>&nbsp;<span class="ident" id="3580440">ciph</span><span class="op" id="3580444">.</span><span class="ident" id="3580445">blockSize</span>&nbsp;<span class="op" id="3580455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580459">return</span>&nbsp;<span class="ident" id="3580466">nil</span><span class="op" id="3580469">,</span>&nbsp;<span class="ident" id="3580471">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3580495">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580498">for</span>&nbsp;<span class="ident" id="3580502">_</span><span class="op" id="3580503">,</span>&nbsp;<span class="ident" id="3580505">val</span>&nbsp;<span class="op" id="3580509">:=</span>&nbsp;<span class="keyword" id="3580512">range</span>&nbsp;<span class="ident" id="3580518">data</span><span class="op" id="3580522">[</span><span class="ident" id="3580523">dlen</span><span class="op" id="3580527">-</span><span class="ident" id="3580528">last</span><span class="op" id="3580532">:</span><span class="op" id="3580533">]</span>&nbsp;<span class="op" id="3580535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580539">if</span>&nbsp;<span class="builtintype" id="3580542">int</span><span class="op" id="3580545">(</span><span class="ident" id="3580546">val</span><span class="op" id="3580549">)</span>&nbsp;<span class="op" id="3580551">!=</span>&nbsp;<span class="ident" id="3580554">last</span>&nbsp;<span class="op" id="3580559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580564">return</span>&nbsp;<span class="ident" id="3580571">nil</span><span class="op" id="3580574">,</span>&nbsp;<span class="ident" id="3580576">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3580601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3580604">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580607">return</span>&nbsp;<span class="ident" id="3580614">data</span><span class="op" id="3580618">[</span><span class="op" id="3580619">:</span><span class="ident" id="3580620">dlen</span><span class="op" id="3580624">-</span><span class="ident" id="3580625">last</span><span class="op" id="3580629">]</span><span class="op" id="3580630">,</span>&nbsp;<span class="ident" id="3580632">nil</span><br>
<span class="lineno"></span><span class="op" id="3580636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3580639">//&nbsp;EncryptPEMBlock&nbsp;returns&nbsp;a&nbsp;PEM&nbsp;block&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;holding&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3580712">//&nbsp;given&nbsp;DER-encoded&nbsp;data&nbsp;encrypted&nbsp;with&nbsp;the&nbsp;specified&nbsp;algorithm&nbsp;and</span><br>
<span class="lineno">175</span><span class="comment" id="3580781">//&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="3580794">func</span>&nbsp;<span class="ident" id="3580799">EncryptPEMBlock</span><span class="op" id="3580814">(</span><span class="ident" id="3580815">rand</span>&nbsp;<span class="ident" id="3580820">io</span><span class="op" id="3580822">.</span><span class="ident" id="3580823">Reader</span><span class="op" id="3580829">,</span>&nbsp;<span class="ident" id="3580831">blockType</span>&nbsp;<span class="builtintype" id="3580841">string</span><span class="op" id="3580847">,</span>&nbsp;<span class="ident" id="3580849">data</span><span class="op" id="3580853">,</span>&nbsp;<span class="ident" id="3580855">password</span>&nbsp;<span class="op" id="3580864">[</span><span class="op" id="3580865">]</span><span class="builtintype" id="3580866">byte</span><span class="op" id="3580870">,</span>&nbsp;<span class="ident" id="3580872">alg</span>&nbsp;<span class="ident" id="3580876">PEMCipher</span><span class="op" id="3580885">)</span>&nbsp;<span class="op" id="3580887">(</span><span class="op" id="3580888">*</span><span class="ident" id="3580889">pem</span><span class="op" id="3580892">.</span><span class="ident" id="3580893">Block</span><span class="op" id="3580898">,</span>&nbsp;<span class="builtintype" id="3580900">error</span><span class="op" id="3580905">)</span>&nbsp;<span class="op" id="3580907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3580910">ciph</span>&nbsp;<span class="op" id="3580915">:=</span>&nbsp;<span class="ident" id="3580918">cipherByKey</span><span class="op" id="3580929">(</span><span class="ident" id="3580930">alg</span><span class="op" id="3580933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580936">if</span>&nbsp;<span class="ident" id="3580939">ciph</span>&nbsp;<span class="op" id="3580944">==</span>&nbsp;<span class="ident" id="3580947">nil</span>&nbsp;<span class="op" id="3580951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580955">return</span>&nbsp;<span class="ident" id="3580962">nil</span><span class="op" id="3580965">,</span>&nbsp;<span class="ident" id="3580967">errors</span><span class="op" id="3580973">.</span><span class="ident" id="3580974">New</span><span class="op" id="3580977">(</span><span class="string" id="3580978">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="3581009">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3581012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3581015">iv</span>&nbsp;<span class="op" id="3581018">:=</span>&nbsp;<span class="builtinfunc" id="3581021">make</span><span class="op" id="3581025">(</span><span class="op" id="3581026">[</span><span class="op" id="3581027">]</span><span class="builtintype" id="3581028">byte</span><span class="op" id="3581032">,</span>&nbsp;<span class="ident" id="3581034">ciph</span><span class="op" id="3581038">.</span><span class="ident" id="3581039">blockSize</span><span class="op" id="3581048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3581051">if</span>&nbsp;<span class="ident" id="3581054">_</span><span class="op" id="3581055">,</span>&nbsp;<span class="ident" id="3581057">err</span>&nbsp;<span class="op" id="3581061">:=</span>&nbsp;<span class="ident" id="3581064">io</span><span class="op" id="3581066">.</span><span class="ident" id="3581067">ReadFull</span><span class="op" id="3581075">(</span><span class="ident" id="3581076">rand</span><span class="op" id="3581080">,</span>&nbsp;<span class="ident" id="3581082">iv</span><span class="op" id="3581084">)</span><span class="op" id="3581085">;</span>&nbsp;<span class="ident" id="3581087">err</span>&nbsp;<span class="op" id="3581091">!=</span>&nbsp;<span class="ident" id="3581094">nil</span>&nbsp;<span class="op" id="3581098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3581102">return</span>&nbsp;<span class="ident" id="3581109">nil</span><span class="op" id="3581112">,</span>&nbsp;<span class="ident" id="3581114">errors</span><span class="op" id="3581120">.</span><span class="ident" id="3581121">New</span><span class="op" id="3581124">(</span><span class="string" id="3581125">&#34;x509:&nbsp;cannot&nbsp;generate&nbsp;IV:&nbsp;&#34;</span>&nbsp;<span class="op" id="3581154">+</span>&nbsp;<span class="ident" id="3581156">err</span><span class="op" id="3581159">.</span><span class="ident" id="3581160">Error</span><span class="op" id="3581165">(</span><span class="op" id="3581166">)</span><span class="op" id="3581167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3581170">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3581173">//&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3581237">//&nbsp;matching&nbsp;the&nbsp;key&nbsp;derivation&nbsp;in&nbsp;DecryptPEMBlock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3581289">key</span>&nbsp;<span class="op" id="3581293">:=</span>&nbsp;<span class="ident" id="3581296">ciph</span><span class="op" id="3581300">.</span><span class="ident" id="3581301">deriveKey</span><span class="op" id="3581310">(</span><span class="ident" id="3581311">password</span><span class="op" id="3581319">,</span>&nbsp;<span class="ident" id="3581321">iv</span><span class="op" id="3581323">[</span><span class="op" id="3581324">:</span><span class="num" id="3581325">8</span><span class="op" id="3581326">]</span><span class="op" id="3581327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3581330">block</span><span class="op" id="3581335">,</span>&nbsp;<span class="ident" id="3581337">err</span>&nbsp;<span class="op" id="3581341">:=</span>&nbsp;<span class="ident" id="3581344">ciph</span><span class="op" id="3581348">.</span><span class="ident" id="3581349">cipherFunc</span><span class="op" id="3581359">(</span><span class="ident" id="3581360">key</span><span class="op" id="3581363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3581366">if</span>&nbsp;<span class="ident" id="3581369">err</span>&nbsp;<span class="op" id="3581373">!=</span>&nbsp;<span class="ident" id="3581376">nil</span>&nbsp;<span class="op" id="3581380">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3581384">return</span>&nbsp;<span class="ident" id="3581391">nil</span><span class="op" id="3581394">,</span>&nbsp;<span class="ident" id="3581396">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3581401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3581404">enc</span>&nbsp;<span class="op" id="3581408">:=</span>&nbsp;<span class="ident" id="3581411">cipher</span><span class="op" id="3581417">.</span><span class="ident" id="3581418">NewCBCEncrypter</span><span class="op" id="3581433">(</span><span class="ident" id="3581434">block</span><span class="op" id="3581439">,</span>&nbsp;<span class="ident" id="3581441">iv</span><span class="op" id="3581443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3581446">pad</span>&nbsp;<span class="op" id="3581450">:=</span>&nbsp;<span class="ident" id="3581453">ciph</span><span class="op" id="3581457">.</span><span class="ident" id="3581458">blockSize</span>&nbsp;<span class="op" id="3581468">-</span>&nbsp;<span class="builtinfunc" id="3581470">len</span><span class="op" id="3581473">(</span><span class="ident" id="3581474">data</span><span class="op" id="3581478">)</span><span class="op" id="3581479">%</span><span class="ident" id="3581480">ciph</span><span class="op" id="3581484">.</span><span class="ident" id="3581485">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3581496">encrypted</span>&nbsp;<span class="op" id="3581506">:=</span>&nbsp;<span class="builtinfunc" id="3581509">make</span><span class="op" id="3581513">(</span><span class="op" id="3581514">[</span><span class="op" id="3581515">]</span><span class="builtintype" id="3581516">byte</span><span class="op" id="3581520">,</span>&nbsp;<span class="builtinfunc" id="3581522">len</span><span class="op" id="3581525">(</span><span class="ident" id="3581526">data</span><span class="op" id="3581530">)</span><span class="op" id="3581531">,</span>&nbsp;<span class="builtinfunc" id="3581533">len</span><span class="op" id="3581536">(</span><span class="ident" id="3581537">data</span><span class="op" id="3581541">)</span><span class="op" id="3581542">+</span><span class="ident" id="3581543">pad</span><span class="op" id="3581546">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3581549">//&nbsp;We&nbsp;could&nbsp;save&nbsp;this&nbsp;copy&nbsp;by&nbsp;encrypting&nbsp;all&nbsp;the&nbsp;whole&nbsp;blocks&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3581615">//&nbsp;the&nbsp;data&nbsp;separately,&nbsp;but&nbsp;it&nbsp;doesn&#39;t&nbsp;seem&nbsp;worth&nbsp;the&nbsp;additional</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3581681">//&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3581691">copy</span><span class="op" id="3581695">(</span><span class="ident" id="3581696">encrypted</span><span class="op" id="3581705">,</span>&nbsp;<span class="ident" id="3581707">data</span><span class="op" id="3581711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3581714">//&nbsp;See&nbsp;RFC&nbsp;1423,&nbsp;section&nbsp;1.1</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3581744">for</span>&nbsp;<span class="ident" id="3581748">i</span>&nbsp;<span class="op" id="3581750">:=</span>&nbsp;<span class="num" id="3581753">0</span><span class="op" id="3581754">;</span>&nbsp;<span class="ident" id="3581756">i</span>&nbsp;<span class="op" id="3581758">&lt;</span>&nbsp;<span class="ident" id="3581760">pad</span><span class="op" id="3581763">;</span>&nbsp;<span class="ident" id="3581765">i</span><span class="op" id="3581766">++</span>&nbsp;<span class="op" id="3581769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3581773">encrypted</span>&nbsp;<span class="op" id="3581783">=</span>&nbsp;<span class="builtinfunc" id="3581785">append</span><span class="op" id="3581791">(</span><span class="ident" id="3581792">encrypted</span><span class="op" id="3581801">,</span>&nbsp;<span class="builtintype" id="3581803">byte</span><span class="op" id="3581807">(</span><span class="ident" id="3581808">pad</span><span class="op" id="3581811">)</span><span class="op" id="3581812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3581815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3581818">enc</span><span class="op" id="3581821">.</span><span class="ident" id="3581822">CryptBlocks</span><span class="op" id="3581833">(</span><span class="ident" id="3581834">encrypted</span><span class="op" id="3581843">,</span>&nbsp;<span class="ident" id="3581845">encrypted</span><span class="op" id="3581854">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3581858">return</span>&nbsp;<span class="op" id="3581865">&amp;</span><span class="ident" id="3581866">pem</span><span class="op" id="3581869">.</span><span class="ident" id="3581870">Block</span><span class="op" id="3581875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3581879">Type</span><span class="op" id="3581883">:</span>&nbsp;<span class="ident" id="3581885">blockType</span><span class="op" id="3581894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3581898">Headers</span><span class="op" id="3581905">:</span>&nbsp;<span class="keyword" id="3581907">map</span><span class="op" id="3581910">[</span><span class="builtintype" id="3581911">string</span><span class="op" id="3581917">]</span><span class="builtintype" id="3581918">string</span><span class="op" id="3581924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3581929">&#34;Proc-Type&#34;</span><span class="op" id="3581940">:</span>&nbsp;<span class="string" id="3581942">&#34;4,ENCRYPTED&#34;</span><span class="op" id="3581955">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3581960">&#34;DEK-Info&#34;</span><span class="op" id="3581970">:</span>&nbsp;&nbsp;<span class="ident" id="3581973">ciph</span><span class="op" id="3581977">.</span><span class="ident" id="3581978">name</span>&nbsp;<span class="op" id="3581983">+</span>&nbsp;<span class="string" id="3581985">&#34;,&#34;</span>&nbsp;<span class="op" id="3581989">+</span>&nbsp;<span class="ident" id="3581991">hex</span><span class="op" id="3581994">.</span><span class="ident" id="3581995">EncodeToString</span><span class="op" id="3582009">(</span><span class="ident" id="3582010">iv</span><span class="op" id="3582012">)</span><span class="op" id="3582013">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3582017">}</span><span class="op" id="3582018">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3582022">Bytes</span><span class="op" id="3582027">:</span>&nbsp;<span class="ident" id="3582029">encrypted</span><span class="op" id="3582038">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3582041">}</span><span class="op" id="3582042">,</span>&nbsp;<span class="ident" id="3582044">nil</span><br>
<span class="lineno"></span><span class="op" id="3582048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="3582051">func</span>&nbsp;<span class="ident" id="3582056">cipherByName</span><span class="op" id="3582068">(</span><span class="ident" id="3582069">name</span>&nbsp;<span class="builtintype" id="3582074">string</span><span class="op" id="3582080">)</span>&nbsp;<span class="op" id="3582082">*</span><span class="ident" id="3582083">rfc1423Algo</span>&nbsp;<span class="op" id="3582095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3582098">for</span>&nbsp;<span class="ident" id="3582102">i</span>&nbsp;<span class="op" id="3582104">:=</span>&nbsp;<span class="keyword" id="3582107">range</span>&nbsp;<span class="ident" id="3582113">rfc1423Algos</span>&nbsp;<span class="op" id="3582126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3582130">alg</span>&nbsp;<span class="op" id="3582134">:=</span>&nbsp;<span class="op" id="3582137">&amp;</span><span class="ident" id="3582138">rfc1423Algos</span><span class="op" id="3582150">[</span><span class="ident" id="3582151">i</span><span class="op" id="3582152">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3582156">if</span>&nbsp;<span class="ident" id="3582159">alg</span><span class="op" id="3582162">.</span><span class="ident" id="3582163">name</span>&nbsp;<span class="op" id="3582168">==</span>&nbsp;<span class="ident" id="3582171">name</span>&nbsp;<span class="op" id="3582176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3582181">return</span>&nbsp;<span class="ident" id="3582188">alg</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3582194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3582197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3582200">return</span>&nbsp;<span class="ident" id="3582207">nil</span><br>
<span class="lineno"></span><span class="op" id="3582211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="3582214">func</span>&nbsp;<span class="ident" id="3582219">cipherByKey</span><span class="op" id="3582230">(</span><span class="ident" id="3582231">key</span>&nbsp;<span class="ident" id="3582235">PEMCipher</span><span class="op" id="3582244">)</span>&nbsp;<span class="op" id="3582246">*</span><span class="ident" id="3582247">rfc1423Algo</span>&nbsp;<span class="op" id="3582259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3582262">for</span>&nbsp;<span class="ident" id="3582266">i</span>&nbsp;<span class="op" id="3582268">:=</span>&nbsp;<span class="keyword" id="3582271">range</span>&nbsp;<span class="ident" id="3582277">rfc1423Algos</span>&nbsp;<span class="op" id="3582290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3582294">alg</span>&nbsp;<span class="op" id="3582298">:=</span>&nbsp;<span class="op" id="3582301">&amp;</span><span class="ident" id="3582302">rfc1423Algos</span><span class="op" id="3582314">[</span><span class="ident" id="3582315">i</span><span class="op" id="3582316">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3582320">if</span>&nbsp;<span class="ident" id="3582323">alg</span><span class="op" id="3582326">.</span><span class="ident" id="3582327">cipher</span>&nbsp;<span class="op" id="3582334">==</span>&nbsp;<span class="ident" id="3582337">key</span>&nbsp;<span class="op" id="3582341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3582346">return</span>&nbsp;<span class="ident" id="3582353">alg</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3582359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3582362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3582365">return</span>&nbsp;<span class="ident" id="3582372">nil</span><br>
<span class="lineno"></span><span class="op" id="3582376">}</span>
</div>
</body>
</html>
