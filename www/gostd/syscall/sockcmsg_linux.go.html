<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html" class="current">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2394009">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2394065">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2394119">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2394170">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2394198">package</span>&nbsp;<span class="ident" id="2394206">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2394215">import</span>&nbsp;<span class="string" id="2394222">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2394232">//&nbsp;UnixCredentials&nbsp;encodes&nbsp;credentials&nbsp;into&nbsp;a&nbsp;socket&nbsp;control&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="2394301">//&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="2394357">//&nbsp;authentication.</span><br>
<span class="lineno"></span><span class="keyword" id="2394376">func</span>&nbsp;<span class="ident" id="2394381">UnixCredentials</span><span class="op" id="2394396">(</span><span class="ident" id="2394397">ucred</span>&nbsp;<span class="op" id="2394403">*</span><span class="ident" id="2394404">Ucred</span><span class="op" id="2394409">)</span>&nbsp;<span class="op" id="2394411">[</span><span class="op" id="2394412">]</span><span class="builtintype" id="2394413">byte</span>&nbsp;<span class="op" id="2394418">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2394421">b</span>&nbsp;<span class="op" id="2394423">:=</span>&nbsp;<span class="builtinfunc" id="2394426">make</span><span class="op" id="2394430">(</span><span class="op" id="2394431">[</span><span class="op" id="2394432">]</span><span class="builtintype" id="2394433">byte</span><span class="op" id="2394437">,</span>&nbsp;<span class="ident" id="2394439">CmsgSpace</span><span class="op" id="2394448">(</span><span class="ident" id="2394449">SizeofUcred</span><span class="op" id="2394460">)</span><span class="op" id="2394461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2394464">h</span>&nbsp;<span class="op" id="2394466">:=</span>&nbsp;<span class="op" id="2394469">(</span><span class="op" id="2394470">*</span><span class="ident" id="2394471">Cmsghdr</span><span class="op" id="2394478">)</span><span class="op" id="2394479">(</span><span class="ident" id="2394480">unsafe</span><span class="op" id="2394486">.</span><span class="ident" id="2394487">Pointer</span><span class="op" id="2394494">(</span><span class="op" id="2394495">&amp;</span><span class="ident" id="2394496">b</span><span class="op" id="2394497">[</span><span class="num" id="2394498">0</span><span class="op" id="2394499">]</span><span class="op" id="2394500">)</span><span class="op" id="2394501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2394504">h</span><span class="op" id="2394505">.</span><span class="ident" id="2394506">Level</span>&nbsp;<span class="op" id="2394512">=</span>&nbsp;<span class="ident" id="2394514">SOL_SOCKET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2394526">h</span><span class="op" id="2394527">.</span><span class="ident" id="2394528">Type</span>&nbsp;<span class="op" id="2394533">=</span>&nbsp;<span class="ident" id="2394535">SCM_CREDENTIALS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2394552">h</span><span class="op" id="2394553">.</span><span class="ident" id="2394554">SetLen</span><span class="op" id="2394560">(</span><span class="ident" id="2394561">CmsgLen</span><span class="op" id="2394568">(</span><span class="ident" id="2394569">SizeofUcred</span><span class="op" id="2394580">)</span><span class="op" id="2394581">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2394584">*</span><span class="op" id="2394585">(</span><span class="op" id="2394586">(</span><span class="op" id="2394587">*</span><span class="ident" id="2394588">Ucred</span><span class="op" id="2394593">)</span><span class="op" id="2394594">(</span><span class="ident" id="2394595">cmsgData</span><span class="op" id="2394603">(</span><span class="ident" id="2394604">h</span><span class="op" id="2394605">)</span><span class="op" id="2394606">)</span><span class="op" id="2394607">)</span>&nbsp;<span class="op" id="2394609">=</span>&nbsp;<span class="op" id="2394611">*</span><span class="ident" id="2394612">ucred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2394619">return</span>&nbsp;<span class="ident" id="2394626">b</span><br>
<span class="lineno"></span><span class="op" id="2394628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2394631">//&nbsp;ParseUnixCredentials&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains</span><br>
<span class="lineno">25</span><span class="comment" id="2394702">//&nbsp;credentials&nbsp;in&nbsp;a&nbsp;Ucred&nbsp;structure.&nbsp;To&nbsp;receive&nbsp;such&nbsp;a&nbsp;message,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2394770">//&nbsp;SO_PASSCRED&nbsp;option&nbsp;must&nbsp;be&nbsp;enabled&nbsp;on&nbsp;the&nbsp;socket.</span><br>
<span class="lineno"></span><span class="keyword" id="2394823">func</span>&nbsp;<span class="ident" id="2394828">ParseUnixCredentials</span><span class="op" id="2394848">(</span><span class="ident" id="2394849">m</span>&nbsp;<span class="op" id="2394851">*</span><span class="ident" id="2394852">SocketControlMessage</span><span class="op" id="2394872">)</span>&nbsp;<span class="op" id="2394874">(</span><span class="op" id="2394875">*</span><span class="ident" id="2394876">Ucred</span><span class="op" id="2394881">,</span>&nbsp;<span class="builtintype" id="2394883">error</span><span class="op" id="2394888">)</span>&nbsp;<span class="op" id="2394890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2394893">if</span>&nbsp;<span class="ident" id="2394896">m</span><span class="op" id="2394897">.</span><span class="ident" id="2394898">Header</span><span class="op" id="2394904">.</span><span class="ident" id="2394905">Level</span>&nbsp;<span class="op" id="2394911">!=</span>&nbsp;<span class="ident" id="2394914">SOL_SOCKET</span>&nbsp;<span class="op" id="2394925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2394929">return</span>&nbsp;<span class="ident" id="2394936">nil</span><span class="op" id="2394939">,</span>&nbsp;<span class="ident" id="2394941">EINVAL</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2394949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2394952">if</span>&nbsp;<span class="ident" id="2394955">m</span><span class="op" id="2394956">.</span><span class="ident" id="2394957">Header</span><span class="op" id="2394963">.</span><span class="ident" id="2394964">Type</span>&nbsp;<span class="op" id="2394969">!=</span>&nbsp;<span class="ident" id="2394972">SCM_CREDENTIALS</span>&nbsp;<span class="op" id="2394988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2394992">return</span>&nbsp;<span class="ident" id="2394999">nil</span><span class="op" id="2395002">,</span>&nbsp;<span class="ident" id="2395004">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2395012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2395015">ucred</span>&nbsp;<span class="op" id="2395021">:=</span>&nbsp;<span class="op" id="2395024">*</span><span class="op" id="2395025">(</span><span class="op" id="2395026">*</span><span class="ident" id="2395027">Ucred</span><span class="op" id="2395032">)</span><span class="op" id="2395033">(</span><span class="ident" id="2395034">unsafe</span><span class="op" id="2395040">.</span><span class="ident" id="2395041">Pointer</span><span class="op" id="2395048">(</span><span class="op" id="2395049">&amp;</span><span class="ident" id="2395050">m</span><span class="op" id="2395051">.</span><span class="ident" id="2395052">Data</span><span class="op" id="2395056">[</span><span class="num" id="2395057">0</span><span class="op" id="2395058">]</span><span class="op" id="2395059">)</span><span class="op" id="2395060">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2395063">return</span>&nbsp;<span class="op" id="2395070">&amp;</span><span class="ident" id="2395071">ucred</span><span class="op" id="2395076">,</span>&nbsp;<span class="ident" id="2395078">nil</span><br>
<span class="lineno"></span><span class="op" id="2395082">}</span>
</div>
</body>
</html>
