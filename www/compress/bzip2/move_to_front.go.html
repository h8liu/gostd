<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5539815">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5539870">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5539924">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5539975">package</span>&nbsp;<span class="ident" id="5539983">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5539990">//&nbsp;moveToFrontDecoder&nbsp;implements&nbsp;a&nbsp;move-to-front&nbsp;list.&nbsp;Such&nbsp;a&nbsp;list&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5540063">//&nbsp;efficient&nbsp;way&nbsp;to&nbsp;transform&nbsp;a&nbsp;string&nbsp;with&nbsp;repeating&nbsp;elements&nbsp;into&nbsp;one&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5540140">//&nbsp;many&nbsp;small&nbsp;valued&nbsp;numbers,&nbsp;which&nbsp;is&nbsp;suitable&nbsp;for&nbsp;entropy&nbsp;encoding.&nbsp;It&nbsp;works</span><br>
<span class="lineno">10</span><span class="comment" id="5540219">//&nbsp;by&nbsp;starting&nbsp;with&nbsp;an&nbsp;initial&nbsp;list&nbsp;of&nbsp;symbols&nbsp;and&nbsp;references&nbsp;symbols&nbsp;by&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="5540298">//&nbsp;index&nbsp;into&nbsp;that&nbsp;list.&nbsp;When&nbsp;a&nbsp;symbol&nbsp;is&nbsp;referenced,&nbsp;it&#39;s&nbsp;moved&nbsp;to&nbsp;the&nbsp;front</span><br>
<span class="lineno"></span><span class="comment" id="5540376">//&nbsp;of&nbsp;the&nbsp;list.&nbsp;Thus,&nbsp;a&nbsp;repeated&nbsp;symbol&nbsp;ends&nbsp;up&nbsp;being&nbsp;encoded&nbsp;with&nbsp;many&nbsp;zeros,</span><br>
<span class="lineno"></span><span class="comment" id="5540455">//&nbsp;as&nbsp;the&nbsp;symbol&nbsp;will&nbsp;be&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list&nbsp;after&nbsp;the&nbsp;first&nbsp;access.</span><br>
<span class="lineno"></span><span class="keyword" id="5540529">type</span>&nbsp;<span class="ident" id="5540534">moveToFrontDecoder</span>&nbsp;<span class="op" id="5540553">[</span><span class="op" id="5540554">]</span><span class="builtintype" id="5540555">byte</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5540561">//&nbsp;newMTFDecoder&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;explicit&nbsp;initial&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="5540640">//&nbsp;of&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="5540655">func</span>&nbsp;<span class="ident" id="5540660">newMTFDecoder</span><span class="op" id="5540673">(</span><span class="ident" id="5540674">symbols</span>&nbsp;<span class="op" id="5540682">[</span><span class="op" id="5540683">]</span><span class="builtintype" id="5540684">byte</span><span class="op" id="5540688">)</span>&nbsp;<span class="ident" id="5540690"><a href="/compress/bzip2/move_to_front.go.html#5540534">moveToFrontDecoder</a></span>&nbsp;<span class="op" id="5540709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540712">if</span>&nbsp;<span class="builtinfunc" id="5540715">len</span><span class="op" id="5540718">(</span><span class="ident" id="5540719"><a href="/compress/bzip2/move_to_front.go.html#5540674">symbols</a></span><span class="op" id="5540726">)</span>&nbsp;<span class="op" id="5540728">&gt;</span>&nbsp;<span class="num" id="5540730">256</span>&nbsp;<span class="op" id="5540734">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5540738">panic</span><span class="op" id="5540743">(</span><span class="string" id="5540744">&#34;too&nbsp;many&nbsp;symbols&#34;</span><span class="op" id="5540762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5540765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540768">return</span>&nbsp;<span class="ident" id="5540775"><a href="/compress/bzip2/move_to_front.go.html#5540534">moveToFrontDecoder</a></span><span class="op" id="5540793">(</span><span class="ident" id="5540794"><a href="/compress/bzip2/move_to_front.go.html#5540674">symbols</a></span><span class="op" id="5540801">)</span><br>
<span class="lineno"></span><span class="op" id="5540803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5540806">//&nbsp;newMTFDecoderWithRange&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="5540880">//&nbsp;symbol&nbsp;list&nbsp;of&nbsp;0...n-1.</span><br>
<span class="lineno"></span><span class="keyword" id="5540907">func</span>&nbsp;<span class="ident" id="5540912">newMTFDecoderWithRange</span><span class="op" id="5540934">(</span><span class="ident" id="5540935">n</span>&nbsp;<span class="builtintype" id="5540937">int</span><span class="op" id="5540940">)</span>&nbsp;<span class="ident" id="5540942"><a href="/compress/bzip2/move_to_front.go.html#5540534">moveToFrontDecoder</a></span>&nbsp;<span class="op" id="5540961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540964">if</span>&nbsp;<span class="ident" id="5540967"><a href="/compress/bzip2/move_to_front.go.html#5540935">n</a></span>&nbsp;<span class="op" id="5540969">&gt;</span>&nbsp;<span class="num" id="5540971">256</span>&nbsp;<span class="op" id="5540975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5540979">panic</span><span class="op" id="5540984">(</span><span class="string" id="5540985">&#34;newMTFDecoderWithRange:&nbsp;cannot&nbsp;have&nbsp;&gt;&nbsp;256&nbsp;symbols&#34;</span><span class="op" id="5541036">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5541039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541043">m</span>&nbsp;<span class="op" id="5541045">:=</span>&nbsp;<span class="builtinfunc" id="5541048">make</span><span class="op" id="5541052">(</span><span class="op" id="5541053">[</span><span class="op" id="5541054">]</span><span class="builtintype" id="5541055">byte</span><span class="op" id="5541059">,</span>&nbsp;<span class="ident" id="5541061"><a href="/compress/bzip2/move_to_front.go.html#5540935">n</a></span><span class="op" id="5541062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541065">for</span>&nbsp;<span class="ident" id="5541069">i</span>&nbsp;<span class="op" id="5541071">:=</span>&nbsp;<span class="num" id="5541074">0</span><span class="op" id="5541075">;</span>&nbsp;<span class="ident" id="5541077"><a href="/compress/bzip2/move_to_front.go.html#5541069">i</a></span>&nbsp;<span class="op" id="5541079">&lt;</span>&nbsp;<span class="ident" id="5541081"><a href="/compress/bzip2/move_to_front.go.html#5540935">n</a></span><span class="op" id="5541082">;</span>&nbsp;<span class="ident" id="5541084"><a href="/compress/bzip2/move_to_front.go.html#5541069">i</a></span><span class="op" id="5541085">++</span>&nbsp;<span class="op" id="5541088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541092"><a href="/compress/bzip2/move_to_front.go.html#5541043">m</a></span><span class="op" id="5541093">[</span><span class="ident" id="5541094"><a href="/compress/bzip2/move_to_front.go.html#5541069">i</a></span><span class="op" id="5541095">]</span>&nbsp;<span class="op" id="5541097">=</span>&nbsp;<span class="builtintype" id="5541099">byte</span><span class="op" id="5541103">(</span><span class="ident" id="5541104"><a href="/compress/bzip2/move_to_front.go.html#5541069">i</a></span><span class="op" id="5541105">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5541108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541111">return</span>&nbsp;<span class="ident" id="5541118"><a href="/compress/bzip2/move_to_front.go.html#5540534">moveToFrontDecoder</a></span><span class="op" id="5541136">(</span><span class="ident" id="5541137"><a href="/compress/bzip2/move_to_front.go.html#5541043">m</a></span><span class="op" id="5541138">)</span><br>
<span class="lineno"></span><span class="op" id="5541140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5541143">func</span>&nbsp;<span class="op" id="5541148">(</span><span class="ident" id="5541149">m</span>&nbsp;<span class="ident" id="5541151"><a href="/compress/bzip2/move_to_front.go.html#5540534">moveToFrontDecoder</a></span><span class="op" id="5541169">)</span>&nbsp;<span class="ident" id="5541171">Decode</span><span class="op" id="5541177">(</span><span class="ident" id="5541178">n</span>&nbsp;<span class="builtintype" id="5541180">int</span><span class="op" id="5541183">)</span>&nbsp;<span class="op" id="5541185">(</span><span class="ident" id="5541186">b</span>&nbsp;<span class="builtintype" id="5541188">byte</span><span class="op" id="5541192">)</span>&nbsp;<span class="op" id="5541194">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5541197">//&nbsp;Implement&nbsp;move-to-front&nbsp;with&nbsp;a&nbsp;simple&nbsp;copy.&nbsp;This&nbsp;approach</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5541259">//&nbsp;beats&nbsp;more&nbsp;sophisticated&nbsp;approaches&nbsp;in&nbsp;benchmarking,&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5541325">//&nbsp;because&nbsp;it&nbsp;has&nbsp;high&nbsp;locality&nbsp;of&nbsp;reference&nbsp;inside&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5541383">//&nbsp;single&nbsp;cache&nbsp;line&nbsp;(most&nbsp;move-to-front&nbsp;operations&nbsp;have&nbsp;n&nbsp;&lt;&nbsp;64).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541450"><a href="/compress/bzip2/move_to_front.go.html#5541186">b</a></span>&nbsp;<span class="op" id="5541452">=</span>&nbsp;<span class="ident" id="5541454"><a href="/compress/bzip2/move_to_front.go.html#5541149">m</a></span><span class="op" id="5541455">[</span><span class="ident" id="5541456"><a href="/compress/bzip2/move_to_front.go.html#5541178">n</a></span><span class="op" id="5541457">]</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5541460">copy</span><span class="op" id="5541464">(</span><span class="ident" id="5541465"><a href="/compress/bzip2/move_to_front.go.html#5541149">m</a></span><span class="op" id="5541466">[</span><span class="num" id="5541467">1</span><span class="op" id="5541468">:</span><span class="op" id="5541469">]</span><span class="op" id="5541470">,</span>&nbsp;<span class="ident" id="5541472"><a href="/compress/bzip2/move_to_front.go.html#5541149">m</a></span><span class="op" id="5541473">[</span><span class="op" id="5541474">:</span><span class="ident" id="5541475"><a href="/compress/bzip2/move_to_front.go.html#5541178">n</a></span><span class="op" id="5541476">]</span><span class="op" id="5541477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541480"><a href="/compress/bzip2/move_to_front.go.html#5541149">m</a></span><span class="op" id="5541481">[</span><span class="num" id="5541482">0</span><span class="op" id="5541483">]</span>&nbsp;<span class="op" id="5541485">=</span>&nbsp;<span class="ident" id="5541487"><a href="/compress/bzip2/move_to_front.go.html#5541186">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541490">return</span><br>
<span class="lineno"></span><span class="op" id="5541497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5541500">//&nbsp;First&nbsp;returns&nbsp;the&nbsp;symbol&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="5541554">func</span>&nbsp;<span class="op" id="5541559">(</span><span class="ident" id="5541560">m</span>&nbsp;<span class="ident" id="5541562"><a href="/compress/bzip2/move_to_front.go.html#5540534">moveToFrontDecoder</a></span><span class="op" id="5541580">)</span>&nbsp;<span class="ident" id="5541582">First</span><span class="op" id="5541587">(</span><span class="op" id="5541588">)</span>&nbsp;<span class="builtintype" id="5541590">byte</span>&nbsp;<span class="op" id="5541595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541598">return</span>&nbsp;<span class="ident" id="5541605"><a href="/compress/bzip2/move_to_front.go.html#5541560">m</a></span><span class="op" id="5541606">[</span><span class="num" id="5541607">0</span><span class="op" id="5541608">]</span><br>
<span class="lineno"></span><span class="op" id="5541610">}</span>
</div>
</body>
</html>
