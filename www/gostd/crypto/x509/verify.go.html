<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html" class="current">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4057069">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4057124">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4057178">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4057229">package</span>&nbsp;<span class="ident" id="4057237">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4057243">import</span>&nbsp;<span class="op" id="4057250">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4057253">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4057260">&#34;net&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4057267">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4057278">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4057289">&#34;time&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4057297">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4057312">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="4057315">type</span>&nbsp;<span class="ident" id="4057320">InvalidReason</span>&nbsp;<span class="builtintype" id="4057334">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4057339">const</span>&nbsp;<span class="op" id="4057345">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4057348">//&nbsp;NotAuthorizedToSign&nbsp;results&nbsp;when&nbsp;a&nbsp;certificate&nbsp;is&nbsp;signed&nbsp;by&nbsp;another</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4057420">//&nbsp;which&nbsp;isn&#39;t&nbsp;marked&nbsp;as&nbsp;a&nbsp;CA&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4057464">NotAuthorizedToSign</span>&nbsp;<span class="ident" id="4057484">InvalidReason</span>&nbsp;<span class="op" id="4057498">=</span>&nbsp;<span class="ident" id="4057500">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4057506">//&nbsp;Expired&nbsp;results&nbsp;when&nbsp;a&nbsp;certificate&nbsp;has&nbsp;expired,&nbsp;based&nbsp;on&nbsp;the&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4057576">//&nbsp;given&nbsp;in&nbsp;the&nbsp;VerifyOptions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4057608">Expired</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4057617">//&nbsp;CANotAuthorizedForThisName&nbsp;results&nbsp;when&nbsp;an&nbsp;intermediate&nbsp;or&nbsp;root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4057685">//&nbsp;certificate&nbsp;has&nbsp;a&nbsp;name&nbsp;constraint&nbsp;which&nbsp;doesn&#39;t&nbsp;include&nbsp;the&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4057754">//&nbsp;being&nbsp;checked.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4057773">CANotAuthorizedForThisName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4057801">//&nbsp;TooManyIntermediates&nbsp;results&nbsp;when&nbsp;a&nbsp;path&nbsp;length&nbsp;constraint&nbsp;is</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4057867">//&nbsp;violated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4057881">TooManyIntermediates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4057903">//&nbsp;IncompatibleUsage&nbsp;results&nbsp;when&nbsp;the&nbsp;certificate&#39;s&nbsp;key&nbsp;usage&nbsp;indicates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4057976">//&nbsp;that&nbsp;it&nbsp;may&nbsp;only&nbsp;be&nbsp;used&nbsp;for&nbsp;a&nbsp;different&nbsp;purpose.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4058030">IncompatibleUsage</span><br>
<span class="lineno">35</span><span class="op" id="4058048">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4058051">//&nbsp;CertificateInvalidError&nbsp;results&nbsp;when&nbsp;an&nbsp;odd&nbsp;error&nbsp;occurs.&nbsp;Users&nbsp;of&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="4058126">//&nbsp;library&nbsp;probably&nbsp;want&nbsp;to&nbsp;handle&nbsp;all&nbsp;these&nbsp;errors&nbsp;uniformly.</span><br>
<span class="lineno"></span><span class="keyword" id="4058189">type</span>&nbsp;<span class="ident" id="4058194">CertificateInvalidError</span>&nbsp;<span class="keyword" id="4058218">struct</span>&nbsp;<span class="op" id="4058225">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4058228">Cert</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4058235">*</span><span class="ident" id="4058236">Certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4058249">Reason</span>&nbsp;<span class="ident" id="4058256">InvalidReason</span><br>
<span class="lineno"></span><span class="op" id="4058270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4058273">func</span>&nbsp;<span class="op" id="4058278">(</span><span class="ident" id="4058279">e</span>&nbsp;<span class="ident" id="4058281">CertificateInvalidError</span><span class="op" id="4058304">)</span>&nbsp;<span class="ident" id="4058306">Error</span><span class="op" id="4058311">(</span><span class="op" id="4058312">)</span>&nbsp;<span class="builtintype" id="4058314">string</span>&nbsp;<span class="op" id="4058321">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4058324">switch</span>&nbsp;<span class="ident" id="4058331">e</span><span class="op" id="4058332">.</span><span class="ident" id="4058333">Reason</span>&nbsp;<span class="op" id="4058340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4058343">case</span>&nbsp;<span class="ident" id="4058348">NotAuthorizedToSign</span><span class="op" id="4058367">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4058371">return</span>&nbsp;<span class="string" id="4058378">&#34;x509:&nbsp;certificate&nbsp;is&nbsp;not&nbsp;authorized&nbsp;to&nbsp;sign&nbsp;other&nbsp;certificates&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4058444">case</span>&nbsp;<span class="ident" id="4058449">Expired</span><span class="op" id="4058456">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4058460">return</span>&nbsp;<span class="string" id="4058467">&#34;x509:&nbsp;certificate&nbsp;has&nbsp;expired&nbsp;or&nbsp;is&nbsp;not&nbsp;yet&nbsp;valid&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4058520">case</span>&nbsp;<span class="ident" id="4058525">CANotAuthorizedForThisName</span><span class="op" id="4058551">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4058555">return</span>&nbsp;<span class="string" id="4058562">&#34;x509:&nbsp;a&nbsp;root&nbsp;or&nbsp;intermediate&nbsp;certificate&nbsp;is&nbsp;not&nbsp;authorized&nbsp;to&nbsp;sign&nbsp;in&nbsp;this&nbsp;domain&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4058647">case</span>&nbsp;<span class="ident" id="4058652">TooManyIntermediates</span><span class="op" id="4058672">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4058676">return</span>&nbsp;<span class="string" id="4058683">&#34;x509:&nbsp;too&nbsp;many&nbsp;intermediates&nbsp;for&nbsp;path&nbsp;length&nbsp;constraint&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4058742">case</span>&nbsp;<span class="ident" id="4058747">IncompatibleUsage</span><span class="op" id="4058764">:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4058768">return</span>&nbsp;<span class="string" id="4058775">&#34;x509:&nbsp;certificate&nbsp;specifies&nbsp;an&nbsp;incompatible&nbsp;key&nbsp;usage&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4058832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4058835">return</span>&nbsp;<span class="string" id="4058842">&#34;x509:&nbsp;unknown&nbsp;error&#34;</span><br>
<span class="lineno"></span><span class="op" id="4058864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="4058867">//&nbsp;HostnameError&nbsp;results&nbsp;when&nbsp;the&nbsp;set&nbsp;of&nbsp;authorized&nbsp;names&nbsp;doesn&#39;t&nbsp;match&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4058943">//&nbsp;requested&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4058962">type</span>&nbsp;<span class="ident" id="4058967">HostnameError</span>&nbsp;<span class="keyword" id="4058981">struct</span>&nbsp;<span class="op" id="4058988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4058991">Certificate</span>&nbsp;<span class="op" id="4059003">*</span><span class="ident" id="4059004">Certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4059017">Host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4059029">string</span><br>
<span class="lineno">65</span><span class="op" id="4059036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4059039">func</span>&nbsp;<span class="op" id="4059044">(</span><span class="ident" id="4059045">h</span>&nbsp;<span class="ident" id="4059047">HostnameError</span><span class="op" id="4059060">)</span>&nbsp;<span class="ident" id="4059062">Error</span><span class="op" id="4059067">(</span><span class="op" id="4059068">)</span>&nbsp;<span class="builtintype" id="4059070">string</span>&nbsp;<span class="op" id="4059077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4059080">c</span>&nbsp;<span class="op" id="4059082">:=</span>&nbsp;<span class="ident" id="4059085">h</span><span class="op" id="4059086">.</span><span class="ident" id="4059087">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4059101">var</span>&nbsp;<span class="ident" id="4059105">valid</span>&nbsp;<span class="builtintype" id="4059111">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4059119">if</span>&nbsp;<span class="ident" id="4059122">ip</span>&nbsp;<span class="op" id="4059125">:=</span>&nbsp;<span class="ident" id="4059128">net</span><span class="op" id="4059131">.</span><span class="ident" id="4059132">ParseIP</span><span class="op" id="4059139">(</span><span class="ident" id="4059140">h</span><span class="op" id="4059141">.</span><span class="ident" id="4059142">Host</span><span class="op" id="4059146">)</span><span class="op" id="4059147">;</span>&nbsp;<span class="ident" id="4059149">ip</span>&nbsp;<span class="op" id="4059152">!=</span>&nbsp;<span class="ident" id="4059155">nil</span>&nbsp;<span class="op" id="4059159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4059163">//&nbsp;Trying&nbsp;to&nbsp;validate&nbsp;an&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4059193">if</span>&nbsp;<span class="builtinfunc" id="4059196">len</span><span class="op" id="4059199">(</span><span class="ident" id="4059200">c</span><span class="op" id="4059201">.</span><span class="ident" id="4059202">IPAddresses</span><span class="op" id="4059213">)</span>&nbsp;<span class="op" id="4059215">==</span>&nbsp;<span class="num" id="4059218">0</span>&nbsp;<span class="op" id="4059220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4059225">return</span>&nbsp;<span class="string" id="4059232">&#34;x509:&nbsp;cannot&nbsp;validate&nbsp;certificate&nbsp;for&nbsp;&#34;</span>&nbsp;<span class="op" id="4059273">+</span>&nbsp;<span class="ident" id="4059275">h</span><span class="op" id="4059276">.</span><span class="ident" id="4059277">Host</span>&nbsp;<span class="op" id="4059282">+</span>&nbsp;<span class="string" id="4059284">&#34;&nbsp;because&nbsp;it&nbsp;doesn&#39;t&nbsp;contain&nbsp;any&nbsp;IP&nbsp;SANs&#34;</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4059328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4059332">for</span>&nbsp;<span class="ident" id="4059336">_</span><span class="op" id="4059337">,</span>&nbsp;<span class="ident" id="4059339">san</span>&nbsp;<span class="op" id="4059343">:=</span>&nbsp;<span class="keyword" id="4059346">range</span>&nbsp;<span class="ident" id="4059352">c</span><span class="op" id="4059353">.</span><span class="ident" id="4059354">IPAddresses</span>&nbsp;<span class="op" id="4059366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4059371">if</span>&nbsp;<span class="builtinfunc" id="4059374">len</span><span class="op" id="4059377">(</span><span class="ident" id="4059378">valid</span><span class="op" id="4059383">)</span>&nbsp;<span class="op" id="4059385">&gt;</span>&nbsp;<span class="num" id="4059387">0</span>&nbsp;<span class="op" id="4059389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4059395">valid</span>&nbsp;<span class="op" id="4059401">+=</span>&nbsp;<span class="string" id="4059404">&#34;,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4059412">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4059417">valid</span>&nbsp;<span class="op" id="4059423">+=</span>&nbsp;<span class="ident" id="4059426">san</span><span class="op" id="4059429">.</span><span class="ident" id="4059430">String</span><span class="op" id="4059436">(</span><span class="op" id="4059437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4059441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4059444">}</span>&nbsp;<span class="keyword" id="4059446">else</span>&nbsp;<span class="op" id="4059451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4059455">if</span>&nbsp;<span class="builtinfunc" id="4059458">len</span><span class="op" id="4059461">(</span><span class="ident" id="4059462">c</span><span class="op" id="4059463">.</span><span class="ident" id="4059464">DNSNames</span><span class="op" id="4059472">)</span>&nbsp;<span class="op" id="4059474">&gt;</span>&nbsp;<span class="num" id="4059476">0</span>&nbsp;<span class="op" id="4059478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4059483">valid</span>&nbsp;<span class="op" id="4059489">=</span>&nbsp;<span class="ident" id="4059491">strings</span><span class="op" id="4059498">.</span><span class="ident" id="4059499">Join</span><span class="op" id="4059503">(</span><span class="ident" id="4059504">c</span><span class="op" id="4059505">.</span><span class="ident" id="4059506">DNSNames</span><span class="op" id="4059514">,</span>&nbsp;<span class="string" id="4059516">&#34;,&nbsp;&#34;</span><span class="op" id="4059520">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4059524">}</span>&nbsp;<span class="keyword" id="4059526">else</span>&nbsp;<span class="op" id="4059531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4059536">valid</span>&nbsp;<span class="op" id="4059542">=</span>&nbsp;<span class="ident" id="4059544">c</span><span class="op" id="4059545">.</span><span class="ident" id="4059546">Subject</span><span class="op" id="4059553">.</span><span class="ident" id="4059554">CommonName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4059567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4059570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4059573">return</span>&nbsp;<span class="string" id="4059580">&#34;x509:&nbsp;certificate&nbsp;is&nbsp;valid&nbsp;for&nbsp;&#34;</span>&nbsp;<span class="op" id="4059614">+</span>&nbsp;<span class="ident" id="4059616">valid</span>&nbsp;<span class="op" id="4059622">+</span>&nbsp;<span class="string" id="4059624">&#34;,&nbsp;not&nbsp;&#34;</span>&nbsp;<span class="op" id="4059633">+</span>&nbsp;<span class="ident" id="4059635">h</span><span class="op" id="4059636">.</span><span class="ident" id="4059637">Host</span><br>
<span class="lineno">90</span><span class="op" id="4059642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4059645">//&nbsp;UnknownAuthorityError&nbsp;results&nbsp;when&nbsp;the&nbsp;certificate&nbsp;issuer&nbsp;is&nbsp;unknown</span><br>
<span class="lineno"></span><span class="keyword" id="4059717">type</span>&nbsp;<span class="ident" id="4059722">UnknownAuthorityError</span>&nbsp;<span class="keyword" id="4059744">struct</span>&nbsp;<span class="op" id="4059751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4059754">cert</span>&nbsp;<span class="op" id="4059759">*</span><span class="ident" id="4059760">Certificate</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4059773">//&nbsp;hintErr&nbsp;contains&nbsp;an&nbsp;error&nbsp;that&nbsp;may&nbsp;be&nbsp;helpful&nbsp;in&nbsp;determining&nbsp;why&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4059845">//&nbsp;authority&nbsp;wasn&#39;t&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4059873">hintErr</span>&nbsp;<span class="builtintype" id="4059881">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4059888">//&nbsp;hintCert&nbsp;contains&nbsp;a&nbsp;possible&nbsp;authority&nbsp;certificate&nbsp;that&nbsp;was&nbsp;rejected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4059961">//&nbsp;because&nbsp;of&nbsp;the&nbsp;error&nbsp;in&nbsp;hintErr.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4059998">hintCert</span>&nbsp;<span class="op" id="4060007">*</span><span class="ident" id="4060008">Certificate</span><br>
<span class="lineno"></span><span class="op" id="4060020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4060023">func</span>&nbsp;<span class="op" id="4060028">(</span><span class="ident" id="4060029">e</span>&nbsp;<span class="ident" id="4060031">UnknownAuthorityError</span><span class="op" id="4060052">)</span>&nbsp;<span class="ident" id="4060054">Error</span><span class="op" id="4060059">(</span><span class="op" id="4060060">)</span>&nbsp;<span class="builtintype" id="4060062">string</span>&nbsp;<span class="op" id="4060069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4060072">s</span>&nbsp;<span class="op" id="4060074">:=</span>&nbsp;<span class="string" id="4060077">&#34;x509:&nbsp;certificate&nbsp;signed&nbsp;by&nbsp;unknown&nbsp;authority&#34;</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4060126">if</span>&nbsp;<span class="ident" id="4060129">e</span><span class="op" id="4060130">.</span><span class="ident" id="4060131">hintErr</span>&nbsp;<span class="op" id="4060139">!=</span>&nbsp;<span class="ident" id="4060142">nil</span>&nbsp;<span class="op" id="4060146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4060150">certName</span>&nbsp;<span class="op" id="4060159">:=</span>&nbsp;<span class="ident" id="4060162">e</span><span class="op" id="4060163">.</span><span class="ident" id="4060164">hintCert</span><span class="op" id="4060172">.</span><span class="ident" id="4060173">Subject</span><span class="op" id="4060180">.</span><span class="ident" id="4060181">CommonName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4060194">if</span>&nbsp;<span class="builtinfunc" id="4060197">len</span><span class="op" id="4060200">(</span><span class="ident" id="4060201">certName</span><span class="op" id="4060209">)</span>&nbsp;<span class="op" id="4060211">==</span>&nbsp;<span class="num" id="4060214">0</span>&nbsp;<span class="op" id="4060216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4060221">if</span>&nbsp;<span class="builtinfunc" id="4060224">len</span><span class="op" id="4060227">(</span><span class="ident" id="4060228">e</span><span class="op" id="4060229">.</span><span class="ident" id="4060230">hintCert</span><span class="op" id="4060238">.</span><span class="ident" id="4060239">Subject</span><span class="op" id="4060246">.</span><span class="ident" id="4060247">Organization</span><span class="op" id="4060259">)</span>&nbsp;<span class="op" id="4060261">&gt;</span>&nbsp;<span class="num" id="4060263">0</span>&nbsp;<span class="op" id="4060265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4060271">certName</span>&nbsp;<span class="op" id="4060280">=</span>&nbsp;<span class="ident" id="4060282">e</span><span class="op" id="4060283">.</span><span class="ident" id="4060284">hintCert</span><span class="op" id="4060292">.</span><span class="ident" id="4060293">Subject</span><span class="op" id="4060300">.</span><span class="ident" id="4060301">Organization</span><span class="op" id="4060313">[</span><span class="num" id="4060314">0</span><span class="op" id="4060315">]</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4060320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4060325">certName</span>&nbsp;<span class="op" id="4060334">=</span>&nbsp;<span class="string" id="4060336">&#34;serial:&#34;</span>&nbsp;<span class="op" id="4060346">+</span>&nbsp;<span class="ident" id="4060348">e</span><span class="op" id="4060349">.</span><span class="ident" id="4060350">hintCert</span><span class="op" id="4060358">.</span><span class="ident" id="4060359">SerialNumber</span><span class="op" id="4060371">.</span><span class="ident" id="4060372">String</span><span class="op" id="4060378">(</span><span class="op" id="4060379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4060383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4060387">s</span>&nbsp;<span class="op" id="4060389">+=</span>&nbsp;<span class="ident" id="4060392">fmt</span><span class="op" id="4060395">.</span><span class="ident" id="4060396">Sprintf</span><span class="op" id="4060403">(</span><span class="string" id="4060404">&#34;&nbsp;(possibly&nbsp;because&nbsp;of&nbsp;%q&nbsp;while&nbsp;trying&nbsp;to&nbsp;verify&nbsp;candidate&nbsp;authority&nbsp;certificate&nbsp;%q)&#34;</span><span class="op" id="4060489">,</span>&nbsp;<span class="ident" id="4060491">e</span><span class="op" id="4060492">.</span><span class="ident" id="4060493">hintErr</span><span class="op" id="4060500">,</span>&nbsp;<span class="ident" id="4060502">certName</span><span class="op" id="4060510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4060513">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4060516">return</span>&nbsp;<span class="ident" id="4060523">s</span><br>
<span class="lineno"></span><span class="op" id="4060525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4060528">//&nbsp;SystemRootsError&nbsp;results&nbsp;when&nbsp;we&nbsp;fail&nbsp;to&nbsp;load&nbsp;the&nbsp;system&nbsp;root&nbsp;certificates.</span><br>
<span class="lineno"></span><span class="keyword" id="4060607">type</span>&nbsp;<span class="ident" id="4060612">SystemRootsError</span>&nbsp;<span class="keyword" id="4060629">struct</span><span class="op" id="4060635">{</span><span class="op" id="4060636">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="4060639">func</span>&nbsp;<span class="op" id="4060644">(</span><span class="ident" id="4060645">SystemRootsError</span><span class="op" id="4060661">)</span>&nbsp;<span class="ident" id="4060663">Error</span><span class="op" id="4060668">(</span><span class="op" id="4060669">)</span>&nbsp;<span class="builtintype" id="4060671">string</span>&nbsp;<span class="op" id="4060678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4060681">return</span>&nbsp;<span class="string" id="4060688">&#34;x509:&nbsp;failed&nbsp;to&nbsp;load&nbsp;system&nbsp;roots&nbsp;and&nbsp;no&nbsp;roots&nbsp;provided&#34;</span><br>
<span class="lineno"></span><span class="op" id="4060746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="4060749">//&nbsp;VerifyOptions&nbsp;contains&nbsp;parameters&nbsp;for&nbsp;Certificate.Verify.&nbsp;It&#39;s&nbsp;a&nbsp;structure</span><br>
<span class="lineno"></span><span class="comment" id="4060827">//&nbsp;because&nbsp;other&nbsp;PKIX&nbsp;verification&nbsp;APIs&nbsp;have&nbsp;ended&nbsp;up&nbsp;needing&nbsp;many&nbsp;options.</span><br>
<span class="lineno"></span><span class="keyword" id="4060903">type</span>&nbsp;<span class="ident" id="4060908">VerifyOptions</span>&nbsp;<span class="keyword" id="4060922">struct</span>&nbsp;<span class="op" id="4060929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4060932">DNSName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4060946">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4060954">Intermediates</span>&nbsp;<span class="op" id="4060968">*</span><span class="ident" id="4060969">CertPool</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4060979">Roots</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4060993">*</span><span class="ident" id="4060994">CertPool</span>&nbsp;<span class="comment" id="4061003">//&nbsp;if&nbsp;nil,&nbsp;the&nbsp;system&nbsp;roots&nbsp;are&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4061041">CurrentTime</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4061055">time</span><span class="op" id="4061059">.</span><span class="ident" id="4061060">Time</span>&nbsp;<span class="comment" id="4061065">//&nbsp;if&nbsp;zero,&nbsp;the&nbsp;current&nbsp;time&nbsp;is&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4061103">//&nbsp;KeyUsage&nbsp;specifies&nbsp;which&nbsp;Extended&nbsp;Key&nbsp;Usage&nbsp;values&nbsp;are&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4061174">//&nbsp;An&nbsp;empty&nbsp;list&nbsp;means&nbsp;ExtKeyUsageServerAuth.&nbsp;Key&nbsp;usage&nbsp;is&nbsp;considered&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4061247">//&nbsp;constraint&nbsp;down&nbsp;the&nbsp;chain&nbsp;which&nbsp;mirrors&nbsp;Windows&nbsp;CryptoAPI&nbsp;behaviour,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4061320">//&nbsp;but&nbsp;not&nbsp;the&nbsp;spec.&nbsp;To&nbsp;accept&nbsp;any&nbsp;key&nbsp;usage,&nbsp;include&nbsp;ExtKeyUsageAny.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4061391">KeyUsages</span>&nbsp;<span class="op" id="4061401">[</span><span class="op" id="4061402">]</span><span class="ident" id="4061403">ExtKeyUsage</span><br>
<span class="lineno"></span><span class="op" id="4061415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4061418">const</span>&nbsp;<span class="op" id="4061424">(</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4061427">leafCertificate</span>&nbsp;<span class="op" id="4061443">=</span>&nbsp;<span class="ident" id="4061445">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4061451">intermediateCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4061476">rootCertificate</span><br>
<span class="lineno"></span><span class="op" id="4061492">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="4061495">//&nbsp;isValid&nbsp;performs&nbsp;validity&nbsp;checks&nbsp;on&nbsp;the&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="4061541">func</span>&nbsp;<span class="op" id="4061546">(</span><span class="ident" id="4061547">c</span>&nbsp;<span class="op" id="4061549">*</span><span class="ident" id="4061550">Certificate</span><span class="op" id="4061561">)</span>&nbsp;<span class="ident" id="4061563">isValid</span><span class="op" id="4061570">(</span><span class="ident" id="4061571">certType</span>&nbsp;<span class="builtintype" id="4061580">int</span><span class="op" id="4061583">,</span>&nbsp;<span class="ident" id="4061585">currentChain</span>&nbsp;<span class="op" id="4061598">[</span><span class="op" id="4061599">]</span><span class="op" id="4061600">*</span><span class="ident" id="4061601">Certificate</span><span class="op" id="4061612">,</span>&nbsp;<span class="ident" id="4061614">opts</span>&nbsp;<span class="op" id="4061619">*</span><span class="ident" id="4061620">VerifyOptions</span><span class="op" id="4061633">)</span>&nbsp;<span class="builtintype" id="4061635">error</span>&nbsp;<span class="op" id="4061641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4061644">now</span>&nbsp;<span class="op" id="4061648">:=</span>&nbsp;<span class="ident" id="4061651">opts</span><span class="op" id="4061655">.</span><span class="ident" id="4061656">CurrentTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4061669">if</span>&nbsp;<span class="ident" id="4061672">now</span><span class="op" id="4061675">.</span><span class="ident" id="4061676">IsZero</span><span class="op" id="4061682">(</span><span class="op" id="4061683">)</span>&nbsp;<span class="op" id="4061685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4061689">now</span>&nbsp;<span class="op" id="4061693">=</span>&nbsp;<span class="ident" id="4061695">time</span><span class="op" id="4061699">.</span><span class="ident" id="4061700">Now</span><span class="op" id="4061703">(</span><span class="op" id="4061704">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4061707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4061710">if</span>&nbsp;<span class="ident" id="4061713">now</span><span class="op" id="4061716">.</span><span class="ident" id="4061717">Before</span><span class="op" id="4061723">(</span><span class="ident" id="4061724">c</span><span class="op" id="4061725">.</span><span class="ident" id="4061726">NotBefore</span><span class="op" id="4061735">)</span>&nbsp;<span class="op" id="4061737">||</span>&nbsp;<span class="ident" id="4061740">now</span><span class="op" id="4061743">.</span><span class="ident" id="4061744">After</span><span class="op" id="4061749">(</span><span class="ident" id="4061750">c</span><span class="op" id="4061751">.</span><span class="ident" id="4061752">NotAfter</span><span class="op" id="4061760">)</span>&nbsp;<span class="op" id="4061762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4061766">return</span>&nbsp;<span class="ident" id="4061773">CertificateInvalidError</span><span class="op" id="4061796">{</span><span class="ident" id="4061797">c</span><span class="op" id="4061798">,</span>&nbsp;<span class="ident" id="4061800">Expired</span><span class="op" id="4061807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4061810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4061814">if</span>&nbsp;<span class="builtinfunc" id="4061817">len</span><span class="op" id="4061820">(</span><span class="ident" id="4061821">c</span><span class="op" id="4061822">.</span><span class="ident" id="4061823">PermittedDNSDomains</span><span class="op" id="4061842">)</span>&nbsp;<span class="op" id="4061844">&gt;</span>&nbsp;<span class="num" id="4061846">0</span>&nbsp;<span class="op" id="4061848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4061852">ok</span>&nbsp;<span class="op" id="4061855">:=</span>&nbsp;<span class="builtintype" id="4061858">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4061866">for</span>&nbsp;<span class="ident" id="4061870">_</span><span class="op" id="4061871">,</span>&nbsp;<span class="ident" id="4061873">domain</span>&nbsp;<span class="op" id="4061880">:=</span>&nbsp;<span class="keyword" id="4061883">range</span>&nbsp;<span class="ident" id="4061889">c</span><span class="op" id="4061890">.</span><span class="ident" id="4061891">PermittedDNSDomains</span>&nbsp;<span class="op" id="4061911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4061916">if</span>&nbsp;<span class="ident" id="4061919">opts</span><span class="op" id="4061923">.</span><span class="ident" id="4061924">DNSName</span>&nbsp;<span class="op" id="4061932">==</span>&nbsp;<span class="ident" id="4061935">domain</span>&nbsp;<span class="op" id="4061942">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4061949">(</span><span class="ident" id="4061950">strings</span><span class="op" id="4061957">.</span><span class="ident" id="4061958">HasSuffix</span><span class="op" id="4061967">(</span><span class="ident" id="4061968">opts</span><span class="op" id="4061972">.</span><span class="ident" id="4061973">DNSName</span><span class="op" id="4061980">,</span>&nbsp;<span class="ident" id="4061982">domain</span><span class="op" id="4061988">)</span>&nbsp;<span class="op" id="4061990">&amp;&amp;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4061998">len</span><span class="op" id="4062001">(</span><span class="ident" id="4062002">opts</span><span class="op" id="4062006">.</span><span class="ident" id="4062007">DNSName</span><span class="op" id="4062014">)</span>&nbsp;<span class="op" id="4062016">&gt;=</span>&nbsp;<span class="num" id="4062019">1</span><span class="op" id="4062020">+</span><span class="builtinfunc" id="4062021">len</span><span class="op" id="4062024">(</span><span class="ident" id="4062025">domain</span><span class="op" id="4062031">)</span>&nbsp;<span class="op" id="4062033">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4062041">opts</span><span class="op" id="4062045">.</span><span class="ident" id="4062046">DNSName</span><span class="op" id="4062053">[</span><span class="builtinfunc" id="4062054">len</span><span class="op" id="4062057">(</span><span class="ident" id="4062058">opts</span><span class="op" id="4062062">.</span><span class="ident" id="4062063">DNSName</span><span class="op" id="4062070">)</span><span class="op" id="4062071">-</span><span class="builtinfunc" id="4062072">len</span><span class="op" id="4062075">(</span><span class="ident" id="4062076">domain</span><span class="op" id="4062082">)</span><span class="op" id="4062083">-</span><span class="num" id="4062084">1</span><span class="op" id="4062085">]</span>&nbsp;<span class="op" id="4062087">==</span>&nbsp;<span class="string" id="4062090">&#39;.&#39;</span><span class="op" id="4062093">)</span>&nbsp;<span class="op" id="4062095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4062101">ok</span>&nbsp;<span class="op" id="4062104">=</span>&nbsp;<span class="builtintype" id="4062106">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4062115">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4062124">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4062128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4062133">if</span>&nbsp;<span class="op" id="4062136">!</span><span class="ident" id="4062137">ok</span>&nbsp;<span class="op" id="4062140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4062145">return</span>&nbsp;<span class="ident" id="4062152">CertificateInvalidError</span><span class="op" id="4062175">{</span><span class="ident" id="4062176">c</span><span class="op" id="4062177">,</span>&nbsp;<span class="ident" id="4062179">CANotAuthorizedForThisName</span><span class="op" id="4062205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4062209">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4062212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4062216">//&nbsp;KeyUsage&nbsp;status&nbsp;flags&nbsp;are&nbsp;ignored.&nbsp;From&nbsp;Engineering&nbsp;Security,&nbsp;Peter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4062288">//&nbsp;Gutmann:&nbsp;A&nbsp;European&nbsp;government&nbsp;CA&nbsp;marked&nbsp;its&nbsp;signing&nbsp;certificates&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4062361">//&nbsp;being&nbsp;valid&nbsp;for&nbsp;encryption&nbsp;only,&nbsp;but&nbsp;no-one&nbsp;noticed.&nbsp;Another</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4062426">//&nbsp;European&nbsp;CA&nbsp;marked&nbsp;its&nbsp;signature&nbsp;keys&nbsp;as&nbsp;not&nbsp;being&nbsp;valid&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4062491">//&nbsp;signatures.&nbsp;A&nbsp;different&nbsp;CA&nbsp;marked&nbsp;its&nbsp;own&nbsp;trusted&nbsp;root&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4062562">//&nbsp;as&nbsp;being&nbsp;invalid&nbsp;for&nbsp;certificate&nbsp;signing.&nbsp;&nbsp;Another&nbsp;national&nbsp;CA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4062629">//&nbsp;distributed&nbsp;a&nbsp;certificate&nbsp;to&nbsp;be&nbsp;used&nbsp;to&nbsp;encrypt&nbsp;data&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4062694">//&nbsp;country’s&nbsp;tax&nbsp;authority&nbsp;that&nbsp;was&nbsp;marked&nbsp;as&nbsp;only&nbsp;being&nbsp;usable&nbsp;for</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4062765">//&nbsp;digital&nbsp;signatures&nbsp;but&nbsp;not&nbsp;for&nbsp;encryption.&nbsp;Yet&nbsp;another&nbsp;CA&nbsp;reversed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4062836">//&nbsp;the&nbsp;order&nbsp;of&nbsp;the&nbsp;bit&nbsp;flags&nbsp;in&nbsp;the&nbsp;keyUsage&nbsp;due&nbsp;to&nbsp;confusion&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4062905">//&nbsp;encoding&nbsp;endianness,&nbsp;essentially&nbsp;setting&nbsp;a&nbsp;random&nbsp;keyUsage&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4062971">//&nbsp;certificates&nbsp;that&nbsp;it&nbsp;issued.&nbsp;Another&nbsp;CA&nbsp;created&nbsp;a&nbsp;self-invalidating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4063043">//&nbsp;certificate&nbsp;by&nbsp;adding&nbsp;a&nbsp;certificate&nbsp;policy&nbsp;statement&nbsp;stipulating</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4063112">//&nbsp;that&nbsp;the&nbsp;certificate&nbsp;had&nbsp;to&nbsp;be&nbsp;used&nbsp;strictly&nbsp;as&nbsp;specified&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4063181">//&nbsp;keyUsage,&nbsp;and&nbsp;a&nbsp;keyUsage&nbsp;containing&nbsp;a&nbsp;flag&nbsp;indicating&nbsp;that&nbsp;the&nbsp;RSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4063252">//&nbsp;encryption&nbsp;key&nbsp;could&nbsp;only&nbsp;be&nbsp;used&nbsp;for&nbsp;Diffie-Hellman&nbsp;key&nbsp;agreement.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4063325">if</span>&nbsp;<span class="ident" id="4063328">certType</span>&nbsp;<span class="op" id="4063337">==</span>&nbsp;<span class="ident" id="4063340">intermediateCertificate</span>&nbsp;<span class="op" id="4063364">&amp;&amp;</span>&nbsp;<span class="op" id="4063367">(</span><span class="op" id="4063368">!</span><span class="ident" id="4063369">c</span><span class="op" id="4063370">.</span><span class="ident" id="4063371">BasicConstraintsValid</span>&nbsp;<span class="op" id="4063393">||</span>&nbsp;<span class="op" id="4063396">!</span><span class="ident" id="4063397">c</span><span class="op" id="4063398">.</span><span class="ident" id="4063399">IsCA</span><span class="op" id="4063403">)</span>&nbsp;<span class="op" id="4063405">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4063409">return</span>&nbsp;<span class="ident" id="4063416">CertificateInvalidError</span><span class="op" id="4063439">{</span><span class="ident" id="4063440">c</span><span class="op" id="4063441">,</span>&nbsp;<span class="ident" id="4063443">NotAuthorizedToSign</span><span class="op" id="4063462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4063465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4063469">if</span>&nbsp;<span class="ident" id="4063472">c</span><span class="op" id="4063473">.</span><span class="ident" id="4063474">BasicConstraintsValid</span>&nbsp;<span class="op" id="4063496">&amp;&amp;</span>&nbsp;<span class="ident" id="4063499">c</span><span class="op" id="4063500">.</span><span class="ident" id="4063501">MaxPathLen</span>&nbsp;<span class="op" id="4063512">&gt;=</span>&nbsp;<span class="num" id="4063515">0</span>&nbsp;<span class="op" id="4063517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4063521">numIntermediates</span>&nbsp;<span class="op" id="4063538">:=</span>&nbsp;<span class="builtinfunc" id="4063541">len</span><span class="op" id="4063544">(</span><span class="ident" id="4063545">currentChain</span><span class="op" id="4063557">)</span>&nbsp;<span class="op" id="4063559">-</span>&nbsp;<span class="num" id="4063561">1</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4063565">if</span>&nbsp;<span class="ident" id="4063568">numIntermediates</span>&nbsp;<span class="op" id="4063585">&gt;</span>&nbsp;<span class="ident" id="4063587">c</span><span class="op" id="4063588">.</span><span class="ident" id="4063589">MaxPathLen</span>&nbsp;<span class="op" id="4063600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4063605">return</span>&nbsp;<span class="ident" id="4063612">CertificateInvalidError</span><span class="op" id="4063635">{</span><span class="ident" id="4063636">c</span><span class="op" id="4063637">,</span>&nbsp;<span class="ident" id="4063639">TooManyIntermediates</span><span class="op" id="4063659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4063663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4063666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4063670">return</span>&nbsp;<span class="ident" id="4063677">nil</span><br>
<span class="lineno"></span><span class="op" id="4063681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4063684">//&nbsp;Verify&nbsp;attempts&nbsp;to&nbsp;verify&nbsp;c&nbsp;by&nbsp;building&nbsp;one&nbsp;or&nbsp;more&nbsp;chains&nbsp;from&nbsp;c&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4063758">//&nbsp;certificate&nbsp;in&nbsp;opts.Roots,&nbsp;using&nbsp;certificates&nbsp;in&nbsp;opts.Intermediates&nbsp;if</span><br>
<span class="lineno">205</span><span class="comment" id="4063832">//&nbsp;needed.&nbsp;If&nbsp;successful,&nbsp;it&nbsp;returns&nbsp;one&nbsp;or&nbsp;more&nbsp;chains&nbsp;where&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="4063904">//&nbsp;element&nbsp;of&nbsp;the&nbsp;chain&nbsp;is&nbsp;c&nbsp;and&nbsp;the&nbsp;last&nbsp;element&nbsp;is&nbsp;from&nbsp;opts.Roots.</span><br>
<span class="lineno"></span><span class="comment" id="4063974">//</span><br>
<span class="lineno"></span><span class="comment" id="4063977">//&nbsp;If&nbsp;opts.Roots&nbsp;is&nbsp;nil&nbsp;and&nbsp;system&nbsp;roots&nbsp;are&nbsp;unavailable&nbsp;the&nbsp;returned&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4064053">//&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;SystemRootsError.</span><br>
<span class="lineno">210</span><span class="comment" id="4064090">//</span><br>
<span class="lineno"></span><span class="comment" id="4064093">//&nbsp;WARNING:&nbsp;this&nbsp;doesn&#39;t&nbsp;do&nbsp;any&nbsp;revocation&nbsp;checking.</span><br>
<span class="lineno"></span><span class="keyword" id="4064146">func</span>&nbsp;<span class="op" id="4064151">(</span><span class="ident" id="4064152">c</span>&nbsp;<span class="op" id="4064154">*</span><span class="ident" id="4064155">Certificate</span><span class="op" id="4064166">)</span>&nbsp;<span class="ident" id="4064168">Verify</span><span class="op" id="4064174">(</span><span class="ident" id="4064175">opts</span>&nbsp;<span class="ident" id="4064180">VerifyOptions</span><span class="op" id="4064193">)</span>&nbsp;<span class="op" id="4064195">(</span><span class="ident" id="4064196">chains</span>&nbsp;<span class="op" id="4064203">[</span><span class="op" id="4064204">]</span><span class="op" id="4064205">[</span><span class="op" id="4064206">]</span><span class="op" id="4064207">*</span><span class="ident" id="4064208">Certificate</span><span class="op" id="4064219">,</span>&nbsp;<span class="ident" id="4064221">err</span>&nbsp;<span class="builtintype" id="4064225">error</span><span class="op" id="4064230">)</span>&nbsp;<span class="op" id="4064232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4064235">//&nbsp;Use&nbsp;Windows&#39;s&nbsp;own&nbsp;verification&nbsp;and&nbsp;chain&nbsp;building.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4064290">if</span>&nbsp;<span class="ident" id="4064293">opts</span><span class="op" id="4064297">.</span><span class="ident" id="4064298">Roots</span>&nbsp;<span class="op" id="4064304">==</span>&nbsp;<span class="ident" id="4064307">nil</span>&nbsp;<span class="op" id="4064311">&amp;&amp;</span>&nbsp;<span class="ident" id="4064314">runtime</span><span class="op" id="4064321">.</span><span class="ident" id="4064322">GOOS</span>&nbsp;<span class="op" id="4064327">==</span>&nbsp;<span class="string" id="4064330">&#34;windows&#34;</span>&nbsp;<span class="op" id="4064340">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4064344">return</span>&nbsp;<span class="ident" id="4064351">c</span><span class="op" id="4064352">.</span><span class="ident" id="4064353">systemVerify</span><span class="op" id="4064365">(</span><span class="op" id="4064366">&amp;</span><span class="ident" id="4064367">opts</span><span class="op" id="4064371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4064374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4064378">if</span>&nbsp;<span class="ident" id="4064381">opts</span><span class="op" id="4064385">.</span><span class="ident" id="4064386">Roots</span>&nbsp;<span class="op" id="4064392">==</span>&nbsp;<span class="ident" id="4064395">nil</span>&nbsp;<span class="op" id="4064399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4064403">opts</span><span class="op" id="4064407">.</span><span class="ident" id="4064408">Roots</span>&nbsp;<span class="op" id="4064414">=</span>&nbsp;<span class="ident" id="4064416">systemRootsPool</span><span class="op" id="4064431">(</span><span class="op" id="4064432">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4064436">if</span>&nbsp;<span class="ident" id="4064439">opts</span><span class="op" id="4064443">.</span><span class="ident" id="4064444">Roots</span>&nbsp;<span class="op" id="4064450">==</span>&nbsp;<span class="ident" id="4064453">nil</span>&nbsp;<span class="op" id="4064457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4064462">return</span>&nbsp;<span class="ident" id="4064469">nil</span><span class="op" id="4064472">,</span>&nbsp;<span class="ident" id="4064474">SystemRootsError</span><span class="op" id="4064490">{</span><span class="op" id="4064491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4064495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4064498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4064502">err</span>&nbsp;<span class="op" id="4064506">=</span>&nbsp;<span class="ident" id="4064508">c</span><span class="op" id="4064509">.</span><span class="ident" id="4064510">isValid</span><span class="op" id="4064517">(</span><span class="ident" id="4064518">leafCertificate</span><span class="op" id="4064533">,</span>&nbsp;<span class="ident" id="4064535">nil</span><span class="op" id="4064538">,</span>&nbsp;<span class="op" id="4064540">&amp;</span><span class="ident" id="4064541">opts</span><span class="op" id="4064545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4064548">if</span>&nbsp;<span class="ident" id="4064551">err</span>&nbsp;<span class="op" id="4064555">!=</span>&nbsp;<span class="ident" id="4064558">nil</span>&nbsp;<span class="op" id="4064562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4064566">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4064574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4064578">if</span>&nbsp;<span class="builtinfunc" id="4064581">len</span><span class="op" id="4064584">(</span><span class="ident" id="4064585">opts</span><span class="op" id="4064589">.</span><span class="ident" id="4064590">DNSName</span><span class="op" id="4064597">)</span>&nbsp;<span class="op" id="4064599">&gt;</span>&nbsp;<span class="num" id="4064601">0</span>&nbsp;<span class="op" id="4064603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4064607">err</span>&nbsp;<span class="op" id="4064611">=</span>&nbsp;<span class="ident" id="4064613">c</span><span class="op" id="4064614">.</span><span class="ident" id="4064615">VerifyHostname</span><span class="op" id="4064629">(</span><span class="ident" id="4064630">opts</span><span class="op" id="4064634">.</span><span class="ident" id="4064635">DNSName</span><span class="op" id="4064642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4064646">if</span>&nbsp;<span class="ident" id="4064649">err</span>&nbsp;<span class="op" id="4064653">!=</span>&nbsp;<span class="ident" id="4064656">nil</span>&nbsp;<span class="op" id="4064660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4064665">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4064674">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4064677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4064681">candidateChains</span><span class="op" id="4064696">,</span>&nbsp;<span class="ident" id="4064698">err</span>&nbsp;<span class="op" id="4064702">:=</span>&nbsp;<span class="ident" id="4064705">c</span><span class="op" id="4064706">.</span><span class="ident" id="4064707">buildChains</span><span class="op" id="4064718">(</span><span class="builtinfunc" id="4064719">make</span><span class="op" id="4064723">(</span><span class="keyword" id="4064724">map</span><span class="op" id="4064727">[</span><span class="builtintype" id="4064728">int</span><span class="op" id="4064731">]</span><span class="op" id="4064732">[</span><span class="op" id="4064733">]</span><span class="op" id="4064734">[</span><span class="op" id="4064735">]</span><span class="op" id="4064736">*</span><span class="ident" id="4064737">Certificate</span><span class="op" id="4064748">)</span><span class="op" id="4064749">,</span>&nbsp;<span class="op" id="4064751">[</span><span class="op" id="4064752">]</span><span class="op" id="4064753">*</span><span class="ident" id="4064754">Certificate</span><span class="op" id="4064765">{</span><span class="ident" id="4064766">c</span><span class="op" id="4064767">}</span><span class="op" id="4064768">,</span>&nbsp;<span class="op" id="4064770">&amp;</span><span class="ident" id="4064771">opts</span><span class="op" id="4064775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4064778">if</span>&nbsp;<span class="ident" id="4064781">err</span>&nbsp;<span class="op" id="4064785">!=</span>&nbsp;<span class="ident" id="4064788">nil</span>&nbsp;<span class="op" id="4064792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4064796">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4064804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4064808">keyUsages</span>&nbsp;<span class="op" id="4064818">:=</span>&nbsp;<span class="ident" id="4064821">opts</span><span class="op" id="4064825">.</span><span class="ident" id="4064826">KeyUsages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4064837">if</span>&nbsp;<span class="builtinfunc" id="4064840">len</span><span class="op" id="4064843">(</span><span class="ident" id="4064844">keyUsages</span><span class="op" id="4064853">)</span>&nbsp;<span class="op" id="4064855">==</span>&nbsp;<span class="num" id="4064858">0</span>&nbsp;<span class="op" id="4064860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4064864">keyUsages</span>&nbsp;<span class="op" id="4064874">=</span>&nbsp;<span class="op" id="4064876">[</span><span class="op" id="4064877">]</span><span class="ident" id="4064878">ExtKeyUsage</span><span class="op" id="4064889">{</span><span class="ident" id="4064890">ExtKeyUsageServerAuth</span><span class="op" id="4064911">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4064914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4064918">//&nbsp;If&nbsp;any&nbsp;key&nbsp;usage&nbsp;is&nbsp;acceptable&nbsp;then&nbsp;we&#39;re&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4064970">for</span>&nbsp;<span class="ident" id="4064974">_</span><span class="op" id="4064975">,</span>&nbsp;<span class="ident" id="4064977">usage</span>&nbsp;<span class="op" id="4064983">:=</span>&nbsp;<span class="keyword" id="4064986">range</span>&nbsp;<span class="ident" id="4064992">keyUsages</span>&nbsp;<span class="op" id="4065002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4065006">if</span>&nbsp;<span class="ident" id="4065009">usage</span>&nbsp;<span class="op" id="4065015">==</span>&nbsp;<span class="ident" id="4065018">ExtKeyUsageAny</span>&nbsp;<span class="op" id="4065033">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4065038">chains</span>&nbsp;<span class="op" id="4065045">=</span>&nbsp;<span class="ident" id="4065047">candidateChains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4065066">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4065075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4065078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4065082">for</span>&nbsp;<span class="ident" id="4065086">_</span><span class="op" id="4065087">,</span>&nbsp;<span class="ident" id="4065089">candidate</span>&nbsp;<span class="op" id="4065099">:=</span>&nbsp;<span class="keyword" id="4065102">range</span>&nbsp;<span class="ident" id="4065108">candidateChains</span>&nbsp;<span class="op" id="4065124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4065128">if</span>&nbsp;<span class="ident" id="4065131">checkChainForKeyUsage</span><span class="op" id="4065152">(</span><span class="ident" id="4065153">candidate</span><span class="op" id="4065162">,</span>&nbsp;<span class="ident" id="4065164">keyUsages</span><span class="op" id="4065173">)</span>&nbsp;<span class="op" id="4065175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4065180">chains</span>&nbsp;<span class="op" id="4065187">=</span>&nbsp;<span class="builtinfunc" id="4065189">append</span><span class="op" id="4065195">(</span><span class="ident" id="4065196">chains</span><span class="op" id="4065202">,</span>&nbsp;<span class="ident" id="4065204">candidate</span><span class="op" id="4065213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4065217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4065220">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4065224">if</span>&nbsp;<span class="builtinfunc" id="4065227">len</span><span class="op" id="4065230">(</span><span class="ident" id="4065231">chains</span><span class="op" id="4065237">)</span>&nbsp;<span class="op" id="4065239">==</span>&nbsp;<span class="num" id="4065242">0</span>&nbsp;<span class="op" id="4065244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4065248">err</span>&nbsp;<span class="op" id="4065252">=</span>&nbsp;<span class="ident" id="4065254">CertificateInvalidError</span><span class="op" id="4065277">{</span><span class="ident" id="4065278">c</span><span class="op" id="4065279">,</span>&nbsp;<span class="ident" id="4065281">IncompatibleUsage</span><span class="op" id="4065298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4065301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4065305">return</span><br>
<span class="lineno"></span><span class="op" id="4065312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4065315">func</span>&nbsp;<span class="ident" id="4065320">appendToFreshChain</span><span class="op" id="4065338">(</span><span class="ident" id="4065339">chain</span>&nbsp;<span class="op" id="4065345">[</span><span class="op" id="4065346">]</span><span class="op" id="4065347">*</span><span class="ident" id="4065348">Certificate</span><span class="op" id="4065359">,</span>&nbsp;<span class="ident" id="4065361">cert</span>&nbsp;<span class="op" id="4065366">*</span><span class="ident" id="4065367">Certificate</span><span class="op" id="4065378">)</span>&nbsp;<span class="op" id="4065380">[</span><span class="op" id="4065381">]</span><span class="op" id="4065382">*</span><span class="ident" id="4065383">Certificate</span>&nbsp;<span class="op" id="4065395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4065398">n</span>&nbsp;<span class="op" id="4065400">:=</span>&nbsp;<span class="builtinfunc" id="4065403">make</span><span class="op" id="4065407">(</span><span class="op" id="4065408">[</span><span class="op" id="4065409">]</span><span class="op" id="4065410">*</span><span class="ident" id="4065411">Certificate</span><span class="op" id="4065422">,</span>&nbsp;<span class="builtinfunc" id="4065424">len</span><span class="op" id="4065427">(</span><span class="ident" id="4065428">chain</span><span class="op" id="4065433">)</span><span class="op" id="4065434">+</span><span class="num" id="4065435">1</span><span class="op" id="4065436">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4065439">copy</span><span class="op" id="4065443">(</span><span class="ident" id="4065444">n</span><span class="op" id="4065445">,</span>&nbsp;<span class="ident" id="4065447">chain</span><span class="op" id="4065452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4065455">n</span><span class="op" id="4065456">[</span><span class="builtinfunc" id="4065457">len</span><span class="op" id="4065460">(</span><span class="ident" id="4065461">chain</span><span class="op" id="4065466">)</span><span class="op" id="4065467">]</span>&nbsp;<span class="op" id="4065469">=</span>&nbsp;<span class="ident" id="4065471">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4065477">return</span>&nbsp;<span class="ident" id="4065484">n</span><br>
<span class="lineno"></span><span class="op" id="4065486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="4065489">func</span>&nbsp;<span class="op" id="4065494">(</span><span class="ident" id="4065495">c</span>&nbsp;<span class="op" id="4065497">*</span><span class="ident" id="4065498">Certificate</span><span class="op" id="4065509">)</span>&nbsp;<span class="ident" id="4065511">buildChains</span><span class="op" id="4065522">(</span><span class="ident" id="4065523">cache</span>&nbsp;<span class="keyword" id="4065529">map</span><span class="op" id="4065532">[</span><span class="builtintype" id="4065533">int</span><span class="op" id="4065536">]</span><span class="op" id="4065537">[</span><span class="op" id="4065538">]</span><span class="op" id="4065539">[</span><span class="op" id="4065540">]</span><span class="op" id="4065541">*</span><span class="ident" id="4065542">Certificate</span><span class="op" id="4065553">,</span>&nbsp;<span class="ident" id="4065555">currentChain</span>&nbsp;<span class="op" id="4065568">[</span><span class="op" id="4065569">]</span><span class="op" id="4065570">*</span><span class="ident" id="4065571">Certificate</span><span class="op" id="4065582">,</span>&nbsp;<span class="ident" id="4065584">opts</span>&nbsp;<span class="op" id="4065589">*</span><span class="ident" id="4065590">VerifyOptions</span><span class="op" id="4065603">)</span>&nbsp;<span class="op" id="4065605">(</span><span class="ident" id="4065606">chains</span>&nbsp;<span class="op" id="4065613">[</span><span class="op" id="4065614">]</span><span class="op" id="4065615">[</span><span class="op" id="4065616">]</span><span class="op" id="4065617">*</span><span class="ident" id="4065618">Certificate</span><span class="op" id="4065629">,</span>&nbsp;<span class="ident" id="4065631">err</span>&nbsp;<span class="builtintype" id="4065635">error</span><span class="op" id="4065640">)</span>&nbsp;<span class="op" id="4065642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4065645">possibleRoots</span><span class="op" id="4065658">,</span>&nbsp;<span class="ident" id="4065660">failedRoot</span><span class="op" id="4065670">,</span>&nbsp;<span class="ident" id="4065672">rootErr</span>&nbsp;<span class="op" id="4065680">:=</span>&nbsp;<span class="ident" id="4065683">opts</span><span class="op" id="4065687">.</span><span class="ident" id="4065688">Roots</span><span class="op" id="4065693">.</span><span class="ident" id="4065694">findVerifiedParents</span><span class="op" id="4065713">(</span><span class="ident" id="4065714">c</span><span class="op" id="4065715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4065718">for</span>&nbsp;<span class="ident" id="4065722">_</span><span class="op" id="4065723">,</span>&nbsp;<span class="ident" id="4065725">rootNum</span>&nbsp;<span class="op" id="4065733">:=</span>&nbsp;<span class="keyword" id="4065736">range</span>&nbsp;<span class="ident" id="4065742">possibleRoots</span>&nbsp;<span class="op" id="4065756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4065760">root</span>&nbsp;<span class="op" id="4065765">:=</span>&nbsp;<span class="ident" id="4065768">opts</span><span class="op" id="4065772">.</span><span class="ident" id="4065773">Roots</span><span class="op" id="4065778">.</span><span class="ident" id="4065779">certs</span><span class="op" id="4065784">[</span><span class="ident" id="4065785">rootNum</span><span class="op" id="4065792">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4065796">err</span>&nbsp;<span class="op" id="4065800">=</span>&nbsp;<span class="ident" id="4065802">root</span><span class="op" id="4065806">.</span><span class="ident" id="4065807">isValid</span><span class="op" id="4065814">(</span><span class="ident" id="4065815">rootCertificate</span><span class="op" id="4065830">,</span>&nbsp;<span class="ident" id="4065832">currentChain</span><span class="op" id="4065844">,</span>&nbsp;<span class="ident" id="4065846">opts</span><span class="op" id="4065850">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4065854">if</span>&nbsp;<span class="ident" id="4065857">err</span>&nbsp;<span class="op" id="4065861">!=</span>&nbsp;<span class="ident" id="4065864">nil</span>&nbsp;<span class="op" id="4065868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4065873">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4065884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4065888">chains</span>&nbsp;<span class="op" id="4065895">=</span>&nbsp;<span class="builtinfunc" id="4065897">append</span><span class="op" id="4065903">(</span><span class="ident" id="4065904">chains</span><span class="op" id="4065910">,</span>&nbsp;<span class="ident" id="4065912">appendToFreshChain</span><span class="op" id="4065930">(</span><span class="ident" id="4065931">currentChain</span><span class="op" id="4065943">,</span>&nbsp;<span class="ident" id="4065945">root</span><span class="op" id="4065949">)</span><span class="op" id="4065950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4065953">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4065957">possibleIntermediates</span><span class="op" id="4065978">,</span>&nbsp;<span class="ident" id="4065980">failedIntermediate</span><span class="op" id="4065998">,</span>&nbsp;<span class="ident" id="4066000">intermediateErr</span>&nbsp;<span class="op" id="4066016">:=</span>&nbsp;<span class="ident" id="4066019">opts</span><span class="op" id="4066023">.</span><span class="ident" id="4066024">Intermediates</span><span class="op" id="4066037">.</span><span class="ident" id="4066038">findVerifiedParents</span><span class="op" id="4066057">(</span><span class="ident" id="4066058">c</span><span class="op" id="4066059">)</span><br>
<span class="lineno"></span><span class="ident" id="4066061">nextIntermediate</span><span class="op" id="4066077">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4066080">for</span>&nbsp;<span class="ident" id="4066084">_</span><span class="op" id="4066085">,</span>&nbsp;<span class="ident" id="4066087">intermediateNum</span>&nbsp;<span class="op" id="4066103">:=</span>&nbsp;<span class="keyword" id="4066106">range</span>&nbsp;<span class="ident" id="4066112">possibleIntermediates</span>&nbsp;<span class="op" id="4066134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4066138">intermediate</span>&nbsp;<span class="op" id="4066151">:=</span>&nbsp;<span class="ident" id="4066154">opts</span><span class="op" id="4066158">.</span><span class="ident" id="4066159">Intermediates</span><span class="op" id="4066172">.</span><span class="ident" id="4066173">certs</span><span class="op" id="4066178">[</span><span class="ident" id="4066179">intermediateNum</span><span class="op" id="4066194">]</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4066198">for</span>&nbsp;<span class="ident" id="4066202">_</span><span class="op" id="4066203">,</span>&nbsp;<span class="ident" id="4066205">cert</span>&nbsp;<span class="op" id="4066210">:=</span>&nbsp;<span class="keyword" id="4066213">range</span>&nbsp;<span class="ident" id="4066219">currentChain</span>&nbsp;<span class="op" id="4066232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4066237">if</span>&nbsp;<span class="ident" id="4066240">cert</span>&nbsp;<span class="op" id="4066245">==</span>&nbsp;<span class="ident" id="4066248">intermediate</span>&nbsp;<span class="op" id="4066261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4066267">continue</span>&nbsp;<span class="ident" id="4066276">nextIntermediate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4066296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4066300">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4066304">err</span>&nbsp;<span class="op" id="4066308">=</span>&nbsp;<span class="ident" id="4066310">intermediate</span><span class="op" id="4066322">.</span><span class="ident" id="4066323">isValid</span><span class="op" id="4066330">(</span><span class="ident" id="4066331">intermediateCertificate</span><span class="op" id="4066354">,</span>&nbsp;<span class="ident" id="4066356">currentChain</span><span class="op" id="4066368">,</span>&nbsp;<span class="ident" id="4066370">opts</span><span class="op" id="4066374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4066378">if</span>&nbsp;<span class="ident" id="4066381">err</span>&nbsp;<span class="op" id="4066385">!=</span>&nbsp;<span class="ident" id="4066388">nil</span>&nbsp;<span class="op" id="4066392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4066397">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4066408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4066412">var</span>&nbsp;<span class="ident" id="4066416">childChains</span>&nbsp;<span class="op" id="4066428">[</span><span class="op" id="4066429">]</span><span class="op" id="4066430">[</span><span class="op" id="4066431">]</span><span class="op" id="4066432">*</span><span class="ident" id="4066433">Certificate</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4066447">childChains</span><span class="op" id="4066458">,</span>&nbsp;<span class="ident" id="4066460">ok</span>&nbsp;<span class="op" id="4066463">:=</span>&nbsp;<span class="ident" id="4066466">cache</span><span class="op" id="4066471">[</span><span class="ident" id="4066472">intermediateNum</span><span class="op" id="4066487">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4066491">if</span>&nbsp;<span class="op" id="4066494">!</span><span class="ident" id="4066495">ok</span>&nbsp;<span class="op" id="4066498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4066503">childChains</span><span class="op" id="4066514">,</span>&nbsp;<span class="ident" id="4066516">err</span>&nbsp;<span class="op" id="4066520">=</span>&nbsp;<span class="ident" id="4066522">intermediate</span><span class="op" id="4066534">.</span><span class="ident" id="4066535">buildChains</span><span class="op" id="4066546">(</span><span class="ident" id="4066547">cache</span><span class="op" id="4066552">,</span>&nbsp;<span class="ident" id="4066554">appendToFreshChain</span><span class="op" id="4066572">(</span><span class="ident" id="4066573">currentChain</span><span class="op" id="4066585">,</span>&nbsp;<span class="ident" id="4066587">intermediate</span><span class="op" id="4066599">)</span><span class="op" id="4066600">,</span>&nbsp;<span class="ident" id="4066602">opts</span><span class="op" id="4066606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4066611">cache</span><span class="op" id="4066616">[</span><span class="ident" id="4066617">intermediateNum</span><span class="op" id="4066632">]</span>&nbsp;<span class="op" id="4066634">=</span>&nbsp;<span class="ident" id="4066636">childChains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4066650">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4066654">chains</span>&nbsp;<span class="op" id="4066661">=</span>&nbsp;<span class="builtinfunc" id="4066663">append</span><span class="op" id="4066669">(</span><span class="ident" id="4066670">chains</span><span class="op" id="4066676">,</span>&nbsp;<span class="ident" id="4066678">childChains</span><span class="op" id="4066689">...</span><span class="op" id="4066692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4066695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4066699">if</span>&nbsp;<span class="builtinfunc" id="4066702">len</span><span class="op" id="4066705">(</span><span class="ident" id="4066706">chains</span><span class="op" id="4066712">)</span>&nbsp;<span class="op" id="4066714">&gt;</span>&nbsp;<span class="num" id="4066716">0</span>&nbsp;<span class="op" id="4066718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4066722">err</span>&nbsp;<span class="op" id="4066726">=</span>&nbsp;<span class="ident" id="4066728">nil</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4066733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4066737">if</span>&nbsp;<span class="builtinfunc" id="4066740">len</span><span class="op" id="4066743">(</span><span class="ident" id="4066744">chains</span><span class="op" id="4066750">)</span>&nbsp;<span class="op" id="4066752">==</span>&nbsp;<span class="num" id="4066755">0</span>&nbsp;<span class="op" id="4066757">&amp;&amp;</span>&nbsp;<span class="ident" id="4066760">err</span>&nbsp;<span class="op" id="4066764">==</span>&nbsp;<span class="ident" id="4066767">nil</span>&nbsp;<span class="op" id="4066771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4066775">hintErr</span>&nbsp;<span class="op" id="4066783">:=</span>&nbsp;<span class="ident" id="4066786">rootErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4066796">hintCert</span>&nbsp;<span class="op" id="4066805">:=</span>&nbsp;<span class="ident" id="4066808">failedRoot</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4066821">if</span>&nbsp;<span class="ident" id="4066824">hintErr</span>&nbsp;<span class="op" id="4066832">==</span>&nbsp;<span class="ident" id="4066835">nil</span>&nbsp;<span class="op" id="4066839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4066844">hintErr</span>&nbsp;<span class="op" id="4066852">=</span>&nbsp;<span class="ident" id="4066854">intermediateErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4066873">hintCert</span>&nbsp;<span class="op" id="4066882">=</span>&nbsp;<span class="ident" id="4066884">failedIntermediate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4066905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4066909">err</span>&nbsp;<span class="op" id="4066913">=</span>&nbsp;<span class="ident" id="4066915">UnknownAuthorityError</span><span class="op" id="4066936">{</span><span class="ident" id="4066937">c</span><span class="op" id="4066938">,</span>&nbsp;<span class="ident" id="4066940">hintErr</span><span class="op" id="4066947">,</span>&nbsp;<span class="ident" id="4066949">hintCert</span><span class="op" id="4066957">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4066960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4066964">return</span><br>
<span class="lineno"></span><span class="op" id="4066971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="4066974">func</span>&nbsp;<span class="ident" id="4066979">matchHostnames</span><span class="op" id="4066993">(</span><span class="ident" id="4066994">pattern</span><span class="op" id="4067001">,</span>&nbsp;<span class="ident" id="4067003">host</span>&nbsp;<span class="builtintype" id="4067008">string</span><span class="op" id="4067014">)</span>&nbsp;<span class="builtintype" id="4067016">bool</span>&nbsp;<span class="op" id="4067021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4067024">if</span>&nbsp;<span class="builtinfunc" id="4067027">len</span><span class="op" id="4067030">(</span><span class="ident" id="4067031">pattern</span><span class="op" id="4067038">)</span>&nbsp;<span class="op" id="4067040">==</span>&nbsp;<span class="num" id="4067043">0</span>&nbsp;<span class="op" id="4067045">||</span>&nbsp;<span class="builtinfunc" id="4067048">len</span><span class="op" id="4067051">(</span><span class="ident" id="4067052">host</span><span class="op" id="4067056">)</span>&nbsp;<span class="op" id="4067058">==</span>&nbsp;<span class="num" id="4067061">0</span>&nbsp;<span class="op" id="4067063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4067067">return</span>&nbsp;<span class="builtintype" id="4067074">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4067081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4067085">patternParts</span>&nbsp;<span class="op" id="4067098">:=</span>&nbsp;<span class="ident" id="4067101">strings</span><span class="op" id="4067108">.</span><span class="ident" id="4067109">Split</span><span class="op" id="4067114">(</span><span class="ident" id="4067115">pattern</span><span class="op" id="4067122">,</span>&nbsp;<span class="string" id="4067124">&#34;.&#34;</span><span class="op" id="4067127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4067130">hostParts</span>&nbsp;<span class="op" id="4067140">:=</span>&nbsp;<span class="ident" id="4067143">strings</span><span class="op" id="4067150">.</span><span class="ident" id="4067151">Split</span><span class="op" id="4067156">(</span><span class="ident" id="4067157">host</span><span class="op" id="4067161">,</span>&nbsp;<span class="string" id="4067163">&#34;.&#34;</span><span class="op" id="4067166">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4067170">if</span>&nbsp;<span class="builtinfunc" id="4067173">len</span><span class="op" id="4067176">(</span><span class="ident" id="4067177">patternParts</span><span class="op" id="4067189">)</span>&nbsp;<span class="op" id="4067191">!=</span>&nbsp;<span class="builtinfunc" id="4067194">len</span><span class="op" id="4067197">(</span><span class="ident" id="4067198">hostParts</span><span class="op" id="4067207">)</span>&nbsp;<span class="op" id="4067209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4067213">return</span>&nbsp;<span class="builtintype" id="4067220">false</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4067227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4067231">for</span>&nbsp;<span class="ident" id="4067235">i</span><span class="op" id="4067236">,</span>&nbsp;<span class="ident" id="4067238">patternPart</span>&nbsp;<span class="op" id="4067250">:=</span>&nbsp;<span class="keyword" id="4067253">range</span>&nbsp;<span class="ident" id="4067259">patternParts</span>&nbsp;<span class="op" id="4067272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4067276">if</span>&nbsp;<span class="ident" id="4067279">patternPart</span>&nbsp;<span class="op" id="4067291">==</span>&nbsp;<span class="string" id="4067294">&#34;*&#34;</span>&nbsp;<span class="op" id="4067298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4067303">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4067314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4067318">if</span>&nbsp;<span class="ident" id="4067321">patternPart</span>&nbsp;<span class="op" id="4067333">!=</span>&nbsp;<span class="ident" id="4067336">hostParts</span><span class="op" id="4067345">[</span><span class="ident" id="4067346">i</span><span class="op" id="4067347">]</span>&nbsp;<span class="op" id="4067349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4067354">return</span>&nbsp;<span class="builtintype" id="4067361">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4067369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4067372">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4067376">return</span>&nbsp;<span class="builtintype" id="4067383">true</span><br>
<span class="lineno"></span><span class="op" id="4067388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4067391">//&nbsp;toLowerCaseASCII&nbsp;returns&nbsp;a&nbsp;lower-case&nbsp;version&nbsp;of&nbsp;in.&nbsp;See&nbsp;RFC&nbsp;6125&nbsp;6.4.1.&nbsp;We&nbsp;use</span><br>
<span class="lineno">350</span><span class="comment" id="4067474">//&nbsp;an&nbsp;explicitly&nbsp;ASCII&nbsp;function&nbsp;to&nbsp;avoid&nbsp;any&nbsp;sharp&nbsp;corners&nbsp;resulting&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4067548">//&nbsp;performing&nbsp;Unicode&nbsp;operations&nbsp;on&nbsp;DNS&nbsp;labels.</span><br>
<span class="lineno"></span><span class="keyword" id="4067596">func</span>&nbsp;<span class="ident" id="4067601">toLowerCaseASCII</span><span class="op" id="4067617">(</span><span class="ident" id="4067618">in</span>&nbsp;<span class="builtintype" id="4067621">string</span><span class="op" id="4067627">)</span>&nbsp;<span class="builtintype" id="4067629">string</span>&nbsp;<span class="op" id="4067636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4067639">//&nbsp;If&nbsp;the&nbsp;string&nbsp;is&nbsp;already&nbsp;lower-case&nbsp;then&nbsp;there&#39;s&nbsp;nothing&nbsp;to&nbsp;do.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4067707">isAlreadyLowerCase</span>&nbsp;<span class="op" id="4067726">:=</span>&nbsp;<span class="builtintype" id="4067729">true</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4067735">for</span>&nbsp;<span class="ident" id="4067739">_</span><span class="op" id="4067740">,</span>&nbsp;<span class="ident" id="4067742">c</span>&nbsp;<span class="op" id="4067744">:=</span>&nbsp;<span class="keyword" id="4067747">range</span>&nbsp;<span class="ident" id="4067753">in</span>&nbsp;<span class="op" id="4067756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4067760">if</span>&nbsp;<span class="ident" id="4067763">c</span>&nbsp;<span class="op" id="4067765">==</span>&nbsp;<span class="ident" id="4067768">utf8</span><span class="op" id="4067772">.</span><span class="ident" id="4067773">RuneError</span>&nbsp;<span class="op" id="4067783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4067788">//&nbsp;If&nbsp;we&nbsp;get&nbsp;a&nbsp;UTF-8&nbsp;error&nbsp;then&nbsp;there&nbsp;might&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4067838">//&nbsp;upper-case&nbsp;ASCII&nbsp;bytes&nbsp;in&nbsp;the&nbsp;invalid&nbsp;sequence.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4067892">isAlreadyLowerCase</span>&nbsp;<span class="op" id="4067911">=</span>&nbsp;<span class="builtintype" id="4067913">false</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4067922">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4067930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4067934">if</span>&nbsp;<span class="string" id="4067937">&#39;A&#39;</span>&nbsp;<span class="op" id="4067941">&lt;=</span>&nbsp;<span class="ident" id="4067944">c</span>&nbsp;<span class="op" id="4067946">&amp;&amp;</span>&nbsp;<span class="ident" id="4067949">c</span>&nbsp;<span class="op" id="4067951">&lt;=</span>&nbsp;<span class="string" id="4067954">&#39;Z&#39;</span>&nbsp;<span class="op" id="4067958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4067963">isAlreadyLowerCase</span>&nbsp;<span class="op" id="4067982">=</span>&nbsp;<span class="builtintype" id="4067984">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4067993">break</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4068001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4068004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4068008">if</span>&nbsp;<span class="ident" id="4068011">isAlreadyLowerCase</span>&nbsp;<span class="op" id="4068030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4068034">return</span>&nbsp;<span class="ident" id="4068041">in</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4068045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4068049">out</span>&nbsp;<span class="op" id="4068053">:=</span>&nbsp;<span class="op" id="4068056">[</span><span class="op" id="4068057">]</span><span class="builtintype" id="4068058">byte</span><span class="op" id="4068062">(</span><span class="ident" id="4068063">in</span><span class="op" id="4068065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4068068">for</span>&nbsp;<span class="ident" id="4068072">i</span><span class="op" id="4068073">,</span>&nbsp;<span class="ident" id="4068075">c</span>&nbsp;<span class="op" id="4068077">:=</span>&nbsp;<span class="keyword" id="4068080">range</span>&nbsp;<span class="ident" id="4068086">out</span>&nbsp;<span class="op" id="4068090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4068094">if</span>&nbsp;<span class="string" id="4068097">&#39;A&#39;</span>&nbsp;<span class="op" id="4068101">&lt;=</span>&nbsp;<span class="ident" id="4068104">c</span>&nbsp;<span class="op" id="4068106">&amp;&amp;</span>&nbsp;<span class="ident" id="4068109">c</span>&nbsp;<span class="op" id="4068111">&lt;=</span>&nbsp;<span class="string" id="4068114">&#39;Z&#39;</span>&nbsp;<span class="op" id="4068118">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4068123">out</span><span class="op" id="4068126">[</span><span class="ident" id="4068127">i</span><span class="op" id="4068128">]</span>&nbsp;<span class="op" id="4068130">+=</span>&nbsp;<span class="string" id="4068133">&#39;a&#39;</span>&nbsp;<span class="op" id="4068137">-</span>&nbsp;<span class="string" id="4068139">&#39;A&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4068145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4068148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4068151">return</span>&nbsp;<span class="builtintype" id="4068158">string</span><span class="op" id="4068164">(</span><span class="ident" id="4068165">out</span><span class="op" id="4068168">)</span><br>
<span class="lineno"></span><span class="op" id="4068170">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="comment" id="4068173">//&nbsp;VerifyHostname&nbsp;returns&nbsp;nil&nbsp;if&nbsp;c&nbsp;is&nbsp;a&nbsp;valid&nbsp;certificate&nbsp;for&nbsp;the&nbsp;named&nbsp;host.</span><br>
<span class="lineno"></span><span class="comment" id="4068251">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error&nbsp;describing&nbsp;the&nbsp;mismatch.</span><br>
<span class="lineno"></span><span class="keyword" id="4068309">func</span>&nbsp;<span class="op" id="4068314">(</span><span class="ident" id="4068315">c</span>&nbsp;<span class="op" id="4068317">*</span><span class="ident" id="4068318">Certificate</span><span class="op" id="4068329">)</span>&nbsp;<span class="ident" id="4068331">VerifyHostname</span><span class="op" id="4068345">(</span><span class="ident" id="4068346">h</span>&nbsp;<span class="builtintype" id="4068348">string</span><span class="op" id="4068354">)</span>&nbsp;<span class="builtintype" id="4068356">error</span>&nbsp;<span class="op" id="4068362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4068365">//&nbsp;IP&nbsp;addresses&nbsp;may&nbsp;be&nbsp;written&nbsp;in&nbsp;[&nbsp;].</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4068405">candidateIP</span>&nbsp;<span class="op" id="4068417">:=</span>&nbsp;<span class="ident" id="4068420">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4068423">if</span>&nbsp;<span class="builtinfunc" id="4068426">len</span><span class="op" id="4068429">(</span><span class="ident" id="4068430">h</span><span class="op" id="4068431">)</span>&nbsp;<span class="op" id="4068433">&gt;=</span>&nbsp;<span class="num" id="4068436">3</span>&nbsp;<span class="op" id="4068438">&amp;&amp;</span>&nbsp;<span class="ident" id="4068441">h</span><span class="op" id="4068442">[</span><span class="num" id="4068443">0</span><span class="op" id="4068444">]</span>&nbsp;<span class="op" id="4068446">==</span>&nbsp;<span class="string" id="4068449">&#39;[&#39;</span>&nbsp;<span class="op" id="4068453">&amp;&amp;</span>&nbsp;<span class="ident" id="4068456">h</span><span class="op" id="4068457">[</span><span class="builtinfunc" id="4068458">len</span><span class="op" id="4068461">(</span><span class="ident" id="4068462">h</span><span class="op" id="4068463">)</span><span class="op" id="4068464">-</span><span class="num" id="4068465">1</span><span class="op" id="4068466">]</span>&nbsp;<span class="op" id="4068468">==</span>&nbsp;<span class="string" id="4068471">&#39;]&#39;</span>&nbsp;<span class="op" id="4068475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4068479">candidateIP</span>&nbsp;<span class="op" id="4068491">=</span>&nbsp;<span class="ident" id="4068493">h</span><span class="op" id="4068494">[</span><span class="num" id="4068495">1</span>&nbsp;<span class="op" id="4068497">:</span>&nbsp;<span class="builtinfunc" id="4068499">len</span><span class="op" id="4068502">(</span><span class="ident" id="4068503">h</span><span class="op" id="4068504">)</span><span class="op" id="4068505">-</span><span class="num" id="4068506">1</span><span class="op" id="4068507">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4068510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4068513">if</span>&nbsp;<span class="ident" id="4068516">ip</span>&nbsp;<span class="op" id="4068519">:=</span>&nbsp;<span class="ident" id="4068522">net</span><span class="op" id="4068525">.</span><span class="ident" id="4068526">ParseIP</span><span class="op" id="4068533">(</span><span class="ident" id="4068534">candidateIP</span><span class="op" id="4068545">)</span><span class="op" id="4068546">;</span>&nbsp;<span class="ident" id="4068548">ip</span>&nbsp;<span class="op" id="4068551">!=</span>&nbsp;<span class="ident" id="4068554">nil</span>&nbsp;<span class="op" id="4068558">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4068562">//&nbsp;We&nbsp;only&nbsp;match&nbsp;IP&nbsp;addresses&nbsp;against&nbsp;IP&nbsp;SANs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4068611">//&nbsp;https://tools.ietf.org/html/rfc6125#appendix-B.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4068665">for</span>&nbsp;<span class="ident" id="4068669">_</span><span class="op" id="4068670">,</span>&nbsp;<span class="ident" id="4068672">candidate</span>&nbsp;<span class="op" id="4068682">:=</span>&nbsp;<span class="keyword" id="4068685">range</span>&nbsp;<span class="ident" id="4068691">c</span><span class="op" id="4068692">.</span><span class="ident" id="4068693">IPAddresses</span>&nbsp;<span class="op" id="4068705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4068710">if</span>&nbsp;<span class="ident" id="4068713">ip</span><span class="op" id="4068715">.</span><span class="ident" id="4068716">Equal</span><span class="op" id="4068721">(</span><span class="ident" id="4068722">candidate</span><span class="op" id="4068731">)</span>&nbsp;<span class="op" id="4068733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4068739">return</span>&nbsp;<span class="ident" id="4068746">nil</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4068753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4068757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4068761">return</span>&nbsp;<span class="ident" id="4068768">HostnameError</span><span class="op" id="4068781">{</span><span class="ident" id="4068782">c</span><span class="op" id="4068783">,</span>&nbsp;<span class="ident" id="4068785">candidateIP</span><span class="op" id="4068796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4068799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4068803">lowered</span>&nbsp;<span class="op" id="4068811">:=</span>&nbsp;<span class="ident" id="4068814">toLowerCaseASCII</span><span class="op" id="4068830">(</span><span class="ident" id="4068831">h</span><span class="op" id="4068832">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4068836">if</span>&nbsp;<span class="builtinfunc" id="4068839">len</span><span class="op" id="4068842">(</span><span class="ident" id="4068843">c</span><span class="op" id="4068844">.</span><span class="ident" id="4068845">DNSNames</span><span class="op" id="4068853">)</span>&nbsp;<span class="op" id="4068855">&gt;</span>&nbsp;<span class="num" id="4068857">0</span>&nbsp;<span class="op" id="4068859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4068863">for</span>&nbsp;<span class="ident" id="4068867">_</span><span class="op" id="4068868">,</span>&nbsp;<span class="ident" id="4068870">match</span>&nbsp;<span class="op" id="4068876">:=</span>&nbsp;<span class="keyword" id="4068879">range</span>&nbsp;<span class="ident" id="4068885">c</span><span class="op" id="4068886">.</span><span class="ident" id="4068887">DNSNames</span>&nbsp;<span class="op" id="4068896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4068901">if</span>&nbsp;<span class="ident" id="4068904">matchHostnames</span><span class="op" id="4068918">(</span><span class="ident" id="4068919">toLowerCaseASCII</span><span class="op" id="4068935">(</span><span class="ident" id="4068936">match</span><span class="op" id="4068941">)</span><span class="op" id="4068942">,</span>&nbsp;<span class="ident" id="4068944">lowered</span><span class="op" id="4068951">)</span>&nbsp;<span class="op" id="4068953">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4068959">return</span>&nbsp;<span class="ident" id="4068966">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4068973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4068977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4068981">//&nbsp;If&nbsp;Subject&nbsp;Alt&nbsp;Name&nbsp;is&nbsp;given,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;common&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4069042">}</span>&nbsp;<span class="keyword" id="4069044">else</span>&nbsp;<span class="keyword" id="4069049">if</span>&nbsp;<span class="ident" id="4069052">matchHostnames</span><span class="op" id="4069066">(</span><span class="ident" id="4069067">toLowerCaseASCII</span><span class="op" id="4069083">(</span><span class="ident" id="4069084">c</span><span class="op" id="4069085">.</span><span class="ident" id="4069086">Subject</span><span class="op" id="4069093">.</span><span class="ident" id="4069094">CommonName</span><span class="op" id="4069104">)</span><span class="op" id="4069105">,</span>&nbsp;<span class="ident" id="4069107">lowered</span><span class="op" id="4069114">)</span>&nbsp;<span class="op" id="4069116">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4069120">return</span>&nbsp;<span class="ident" id="4069127">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4069132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4069136">return</span>&nbsp;<span class="ident" id="4069143">HostnameError</span><span class="op" id="4069156">{</span><span class="ident" id="4069157">c</span><span class="op" id="4069158">,</span>&nbsp;<span class="ident" id="4069160">h</span><span class="op" id="4069161">}</span><br>
<span class="lineno"></span><span class="op" id="4069163">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="keyword" id="4069166">func</span>&nbsp;<span class="ident" id="4069171">checkChainForKeyUsage</span><span class="op" id="4069192">(</span><span class="ident" id="4069193">chain</span>&nbsp;<span class="op" id="4069199">[</span><span class="op" id="4069200">]</span><span class="op" id="4069201">*</span><span class="ident" id="4069202">Certificate</span><span class="op" id="4069213">,</span>&nbsp;<span class="ident" id="4069215">keyUsages</span>&nbsp;<span class="op" id="4069225">[</span><span class="op" id="4069226">]</span><span class="ident" id="4069227">ExtKeyUsage</span><span class="op" id="4069238">)</span>&nbsp;<span class="builtintype" id="4069240">bool</span>&nbsp;<span class="op" id="4069245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4069248">usages</span>&nbsp;<span class="op" id="4069255">:=</span>&nbsp;<span class="builtinfunc" id="4069258">make</span><span class="op" id="4069262">(</span><span class="op" id="4069263">[</span><span class="op" id="4069264">]</span><span class="ident" id="4069265">ExtKeyUsage</span><span class="op" id="4069276">,</span>&nbsp;<span class="builtinfunc" id="4069278">len</span><span class="op" id="4069281">(</span><span class="ident" id="4069282">keyUsages</span><span class="op" id="4069291">)</span><span class="op" id="4069292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4069295">copy</span><span class="op" id="4069299">(</span><span class="ident" id="4069300">usages</span><span class="op" id="4069306">,</span>&nbsp;<span class="ident" id="4069308">keyUsages</span><span class="op" id="4069317">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4069321">if</span>&nbsp;<span class="builtinfunc" id="4069324">len</span><span class="op" id="4069327">(</span><span class="ident" id="4069328">chain</span><span class="op" id="4069333">)</span>&nbsp;<span class="op" id="4069335">==</span>&nbsp;<span class="num" id="4069338">0</span>&nbsp;<span class="op" id="4069340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4069344">return</span>&nbsp;<span class="builtintype" id="4069351">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4069358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4069362">usagesRemaining</span>&nbsp;<span class="op" id="4069378">:=</span>&nbsp;<span class="builtinfunc" id="4069381">len</span><span class="op" id="4069384">(</span><span class="ident" id="4069385">usages</span><span class="op" id="4069391">)</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4069395">//&nbsp;We&nbsp;walk&nbsp;down&nbsp;the&nbsp;list&nbsp;and&nbsp;cross&nbsp;out&nbsp;any&nbsp;usages&nbsp;that&nbsp;aren&#39;t&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4069468">//&nbsp;by&nbsp;each&nbsp;certificate.&nbsp;If&nbsp;we&nbsp;cross&nbsp;out&nbsp;all&nbsp;the&nbsp;usages,&nbsp;then&nbsp;the&nbsp;chain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4069540">//&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="ident" id="4069561">NextCert</span><span class="op" id="4069569">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4069572">for</span>&nbsp;<span class="ident" id="4069576">i</span>&nbsp;<span class="op" id="4069578">:=</span>&nbsp;<span class="builtinfunc" id="4069581">len</span><span class="op" id="4069584">(</span><span class="ident" id="4069585">chain</span><span class="op" id="4069590">)</span>&nbsp;<span class="op" id="4069592">-</span>&nbsp;<span class="num" id="4069594">1</span><span class="op" id="4069595">;</span>&nbsp;<span class="ident" id="4069597">i</span>&nbsp;<span class="op" id="4069599">&gt;=</span>&nbsp;<span class="num" id="4069602">0</span><span class="op" id="4069603">;</span>&nbsp;<span class="ident" id="4069605">i</span><span class="op" id="4069606">--</span>&nbsp;<span class="op" id="4069609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4069613">cert</span>&nbsp;<span class="op" id="4069618">:=</span>&nbsp;<span class="ident" id="4069621">chain</span><span class="op" id="4069626">[</span><span class="ident" id="4069627">i</span><span class="op" id="4069628">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4069632">if</span>&nbsp;<span class="builtinfunc" id="4069635">len</span><span class="op" id="4069638">(</span><span class="ident" id="4069639">cert</span><span class="op" id="4069643">.</span><span class="ident" id="4069644">ExtKeyUsage</span><span class="op" id="4069655">)</span>&nbsp;<span class="op" id="4069657">==</span>&nbsp;<span class="num" id="4069660">0</span>&nbsp;<span class="op" id="4069662">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4069665">len</span><span class="op" id="4069668">(</span><span class="ident" id="4069669">cert</span><span class="op" id="4069673">.</span><span class="ident" id="4069674">UnknownExtKeyUsage</span><span class="op" id="4069692">)</span>&nbsp;<span class="op" id="4069694">==</span>&nbsp;<span class="num" id="4069697">0</span>&nbsp;<span class="op" id="4069699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4069704">//&nbsp;The&nbsp;certificate&nbsp;doesn&#39;t&nbsp;have&nbsp;any&nbsp;extended&nbsp;key&nbsp;usage&nbsp;specified.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4069773">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4069784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4069789">for</span>&nbsp;<span class="ident" id="4069793">_</span><span class="op" id="4069794">,</span>&nbsp;<span class="ident" id="4069796">usage</span>&nbsp;<span class="op" id="4069802">:=</span>&nbsp;<span class="keyword" id="4069805">range</span>&nbsp;<span class="ident" id="4069811">cert</span><span class="op" id="4069815">.</span><span class="ident" id="4069816">ExtKeyUsage</span>&nbsp;<span class="op" id="4069828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4069833">if</span>&nbsp;<span class="ident" id="4069836">usage</span>&nbsp;<span class="op" id="4069842">==</span>&nbsp;<span class="ident" id="4069845">ExtKeyUsageAny</span>&nbsp;<span class="op" id="4069860">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4069866">//&nbsp;The&nbsp;certificate&nbsp;is&nbsp;explicitly&nbsp;good&nbsp;for&nbsp;any&nbsp;usage.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4069923">continue</span>&nbsp;<span class="ident" id="4069932">NextCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4069944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4069948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4069953">const</span>&nbsp;<span class="ident" id="4069959">invalidUsage</span>&nbsp;<span class="ident" id="4069972">ExtKeyUsage</span>&nbsp;<span class="op" id="4069984">=</span>&nbsp;<span class="op" id="4069986">-</span><span class="num" id="4069987">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4069991">NextRequestedUsage</span><span class="op" id="4070009">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4070013">for</span>&nbsp;<span class="ident" id="4070017">i</span><span class="op" id="4070018">,</span>&nbsp;<span class="ident" id="4070020">requestedUsage</span>&nbsp;<span class="op" id="4070035">:=</span>&nbsp;<span class="keyword" id="4070038">range</span>&nbsp;<span class="ident" id="4070044">usages</span>&nbsp;<span class="op" id="4070051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4070056">if</span>&nbsp;<span class="ident" id="4070059">requestedUsage</span>&nbsp;<span class="op" id="4070074">==</span>&nbsp;<span class="ident" id="4070077">invalidUsage</span>&nbsp;<span class="op" id="4070090">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4070096">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4070108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4070114">for</span>&nbsp;<span class="ident" id="4070118">_</span><span class="op" id="4070119">,</span>&nbsp;<span class="ident" id="4070121">usage</span>&nbsp;<span class="op" id="4070127">:=</span>&nbsp;<span class="keyword" id="4070130">range</span>&nbsp;<span class="ident" id="4070136">cert</span><span class="op" id="4070140">.</span><span class="ident" id="4070141">ExtKeyUsage</span>&nbsp;<span class="op" id="4070153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4070159">if</span>&nbsp;<span class="ident" id="4070162">requestedUsage</span>&nbsp;<span class="op" id="4070177">==</span>&nbsp;<span class="ident" id="4070180">usage</span>&nbsp;<span class="op" id="4070186">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4070193">continue</span>&nbsp;<span class="ident" id="4070202">NextRequestedUsage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4070225">}</span>&nbsp;<span class="keyword" id="4070227">else</span>&nbsp;<span class="keyword" id="4070232">if</span>&nbsp;<span class="ident" id="4070235">requestedUsage</span>&nbsp;<span class="op" id="4070250">==</span>&nbsp;<span class="ident" id="4070253">ExtKeyUsageServerAuth</span>&nbsp;<span class="op" id="4070275">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4070283">(</span><span class="ident" id="4070284">usage</span>&nbsp;<span class="op" id="4070290">==</span>&nbsp;<span class="ident" id="4070293">ExtKeyUsageNetscapeServerGatedCrypto</span>&nbsp;<span class="op" id="4070330">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4070339">usage</span>&nbsp;<span class="op" id="4070345">==</span>&nbsp;<span class="ident" id="4070348">ExtKeyUsageMicrosoftServerGatedCrypto</span><span class="op" id="4070385">)</span>&nbsp;<span class="op" id="4070387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4070394">//&nbsp;In&nbsp;order&nbsp;to&nbsp;support&nbsp;COMODO</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4070429">//&nbsp;certificate&nbsp;chains,&nbsp;we&nbsp;have&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4070468">//&nbsp;accept&nbsp;Netscape&nbsp;or&nbsp;Microsoft&nbsp;SGC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4070509">//&nbsp;usages&nbsp;as&nbsp;equal&nbsp;to&nbsp;ServerAuth.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4070548">continue</span>&nbsp;<span class="ident" id="4070557">NextRequestedUsage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4070580">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4070585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4070591">usages</span><span class="op" id="4070597">[</span><span class="ident" id="4070598">i</span><span class="op" id="4070599">]</span>&nbsp;<span class="op" id="4070601">=</span>&nbsp;<span class="ident" id="4070603">invalidUsage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4070619">usagesRemaining</span><span class="op" id="4070634">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4070640">if</span>&nbsp;<span class="ident" id="4070643">usagesRemaining</span>&nbsp;<span class="op" id="4070659">==</span>&nbsp;<span class="num" id="4070662">0</span>&nbsp;<span class="op" id="4070664">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4070670">return</span>&nbsp;<span class="builtintype" id="4070677">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4070686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4070690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4070693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4070697">return</span>&nbsp;<span class="builtintype" id="4070704">true</span><br>
<span class="lineno"></span><span class="op" id="4070709">}</span>
</div>
</body>
</html>
