<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2146879">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2146934">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2146988">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2147039">//&nbsp;Binary&nbsp;to&nbsp;decimal&nbsp;floating&nbsp;point&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="comment" id="2147087">//&nbsp;Algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2147101">//&nbsp;&nbsp;&nbsp;1)&nbsp;store&nbsp;mantissa&nbsp;in&nbsp;multiprecision&nbsp;decimal</span><br>
<span class="lineno"></span><span class="comment" id="2147150">//&nbsp;&nbsp;&nbsp;2)&nbsp;shift&nbsp;decimal&nbsp;by&nbsp;exponent</span><br>
<span class="lineno"></span><span class="comment" id="2147184">//&nbsp;&nbsp;&nbsp;3)&nbsp;read&nbsp;digits&nbsp;out&nbsp;&amp;&nbsp;format</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2147218">package</span>&nbsp;<span class="ident" id="2147226">strconv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2147235">import</span>&nbsp;<span class="string" id="2147242">&#34;math&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2147250">//&nbsp;TODO:&nbsp;move&nbsp;elsewhere?</span><br>
<span class="lineno"></span><span class="keyword" id="2147275">type</span>&nbsp;<span class="ident" id="2147280">floatInfo</span>&nbsp;<span class="keyword" id="2147290">struct</span>&nbsp;<span class="op" id="2147297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2147300">mantbits</span>&nbsp;<span class="builtintype" id="2147309">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2147315">expbits</span>&nbsp;&nbsp;<span class="builtintype" id="2147324">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2147330">bias</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2147339">int</span><br>
<span class="lineno">20</span><span class="op" id="2147343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2147346">var</span>&nbsp;<span class="ident" id="2147350">float32info</span>&nbsp;<span class="op" id="2147362">=</span>&nbsp;<span class="ident" id="2147364">floatInfo</span><span class="op" id="2147373">{</span><span class="num" id="2147374">23</span><span class="op" id="2147376">,</span>&nbsp;<span class="num" id="2147378">8</span><span class="op" id="2147379">,</span>&nbsp;<span class="op" id="2147381">-</span><span class="num" id="2147382">127</span><span class="op" id="2147385">}</span><br>
<span class="lineno"></span><span class="keyword" id="2147387">var</span>&nbsp;<span class="ident" id="2147391">float64info</span>&nbsp;<span class="op" id="2147403">=</span>&nbsp;<span class="ident" id="2147405">floatInfo</span><span class="op" id="2147414">{</span><span class="num" id="2147415">52</span><span class="op" id="2147417">,</span>&nbsp;<span class="num" id="2147419">11</span><span class="op" id="2147421">,</span>&nbsp;<span class="op" id="2147423">-</span><span class="num" id="2147424">1023</span><span class="op" id="2147428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="2147431">//&nbsp;FormatFloat&nbsp;converts&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f&nbsp;to&nbsp;a&nbsp;string,</span><br>
<span class="lineno"></span><span class="comment" id="2147496">//&nbsp;according&nbsp;to&nbsp;the&nbsp;format&nbsp;fmt&nbsp;and&nbsp;precision&nbsp;prec.&nbsp;&nbsp;It&nbsp;rounds&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2147562">//&nbsp;result&nbsp;assuming&nbsp;that&nbsp;the&nbsp;original&nbsp;was&nbsp;obtained&nbsp;from&nbsp;a&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="2147634">//&nbsp;value&nbsp;of&nbsp;bitSize&nbsp;bits&nbsp;(32&nbsp;for&nbsp;float32,&nbsp;64&nbsp;for&nbsp;float64).</span><br>
<span class="lineno"></span><span class="comment" id="2147693">//</span><br>
<span class="lineno">30</span><span class="comment" id="2147696">//&nbsp;The&nbsp;format&nbsp;fmt&nbsp;is&nbsp;one&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2147724">//&nbsp;&#39;b&#39;&nbsp;(-ddddp±ddd,&nbsp;a&nbsp;binary&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2147765">//&nbsp;&#39;e&#39;&nbsp;(-d.dddde±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2147808">//&nbsp;&#39;E&#39;&nbsp;(-d.ddddE±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2147851">//&nbsp;&#39;f&#39;&nbsp;(-ddd.dddd,&nbsp;no&nbsp;exponent),</span><br>
<span class="lineno">35</span><span class="comment" id="2147884">//&nbsp;&#39;g&#39;&nbsp;(&#39;e&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise),&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2147936">//&nbsp;&#39;G&#39;&nbsp;(&#39;E&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise).</span><br>
<span class="lineno"></span><span class="comment" id="2147985">//</span><br>
<span class="lineno"></span><span class="comment" id="2147988">//&nbsp;The&nbsp;precision&nbsp;prec&nbsp;controls&nbsp;the&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2148040">//&nbsp;(excluding&nbsp;the&nbsp;exponent)&nbsp;printed&nbsp;by&nbsp;the&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;g&#39;,&nbsp;and&nbsp;&#39;G&#39;&nbsp;formats.</span><br>
<span class="lineno">40</span><span class="comment" id="2148120">//&nbsp;For&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;and&nbsp;&#39;f&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span><span class="comment" id="2148197">//&nbsp;For&nbsp;&#39;g&#39;&nbsp;and&nbsp;&#39;G&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="2148250">//&nbsp;The&nbsp;special&nbsp;precision&nbsp;-1&nbsp;uses&nbsp;the&nbsp;smallest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2148313">//&nbsp;necessary&nbsp;such&nbsp;that&nbsp;ParseFloat&nbsp;will&nbsp;return&nbsp;f&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="keyword" id="2148370">func</span>&nbsp;<span class="ident" id="2148375">FormatFloat</span><span class="op" id="2148386">(</span><span class="ident" id="2148387">f</span>&nbsp;<span class="builtintype" id="2148389">float64</span><span class="op" id="2148396">,</span>&nbsp;<span class="ident" id="2148398">fmt</span>&nbsp;<span class="builtintype" id="2148402">byte</span><span class="op" id="2148406">,</span>&nbsp;<span class="ident" id="2148408">prec</span><span class="op" id="2148412">,</span>&nbsp;<span class="ident" id="2148414">bitSize</span>&nbsp;<span class="builtintype" id="2148422">int</span><span class="op" id="2148425">)</span>&nbsp;<span class="builtintype" id="2148427">string</span>&nbsp;<span class="op" id="2148434">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2148437">return</span>&nbsp;<span class="builtintype" id="2148444">string</span><span class="op" id="2148450">(</span><span class="ident" id="2148451">genericFtoa</span><span class="op" id="2148462">(</span><span class="builtinfunc" id="2148463">make</span><span class="op" id="2148467">(</span><span class="op" id="2148468">[</span><span class="op" id="2148469">]</span><span class="builtintype" id="2148470">byte</span><span class="op" id="2148474">,</span>&nbsp;<span class="num" id="2148476">0</span><span class="op" id="2148477">,</span>&nbsp;<span class="ident" id="2148479">max</span><span class="op" id="2148482">(</span><span class="ident" id="2148483">prec</span><span class="op" id="2148487">+</span><span class="num" id="2148488">4</span><span class="op" id="2148489">,</span>&nbsp;<span class="num" id="2148491">24</span><span class="op" id="2148493">)</span><span class="op" id="2148494">)</span><span class="op" id="2148495">,</span>&nbsp;<span class="ident" id="2148497">f</span><span class="op" id="2148498">,</span>&nbsp;<span class="ident" id="2148500">fmt</span><span class="op" id="2148503">,</span>&nbsp;<span class="ident" id="2148505">prec</span><span class="op" id="2148509">,</span>&nbsp;<span class="ident" id="2148511">bitSize</span><span class="op" id="2148518">)</span><span class="op" id="2148519">)</span><br>
<span class="lineno"></span><span class="op" id="2148521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2148524">//&nbsp;AppendFloat&nbsp;appends&nbsp;the&nbsp;string&nbsp;form&nbsp;of&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f,</span><br>
<span class="lineno"></span><span class="comment" id="2148595">//&nbsp;as&nbsp;generated&nbsp;by&nbsp;FormatFloat,&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;extended&nbsp;buffer.</span><br>
<span class="lineno">50</span><span class="keyword" id="2148667">func</span>&nbsp;<span class="ident" id="2148672">AppendFloat</span><span class="op" id="2148683">(</span><span class="ident" id="2148684">dst</span>&nbsp;<span class="op" id="2148688">[</span><span class="op" id="2148689">]</span><span class="builtintype" id="2148690">byte</span><span class="op" id="2148694">,</span>&nbsp;<span class="ident" id="2148696">f</span>&nbsp;<span class="builtintype" id="2148698">float64</span><span class="op" id="2148705">,</span>&nbsp;<span class="ident" id="2148707">fmt</span>&nbsp;<span class="builtintype" id="2148711">byte</span><span class="op" id="2148715">,</span>&nbsp;<span class="ident" id="2148717">prec</span>&nbsp;<span class="builtintype" id="2148722">int</span><span class="op" id="2148725">,</span>&nbsp;<span class="ident" id="2148727">bitSize</span>&nbsp;<span class="builtintype" id="2148735">int</span><span class="op" id="2148738">)</span>&nbsp;<span class="op" id="2148740">[</span><span class="op" id="2148741">]</span><span class="builtintype" id="2148742">byte</span>&nbsp;<span class="op" id="2148747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2148750">return</span>&nbsp;<span class="ident" id="2148757">genericFtoa</span><span class="op" id="2148768">(</span><span class="ident" id="2148769">dst</span><span class="op" id="2148772">,</span>&nbsp;<span class="ident" id="2148774">f</span><span class="op" id="2148775">,</span>&nbsp;<span class="ident" id="2148777">fmt</span><span class="op" id="2148780">,</span>&nbsp;<span class="ident" id="2148782">prec</span><span class="op" id="2148786">,</span>&nbsp;<span class="ident" id="2148788">bitSize</span><span class="op" id="2148795">)</span><br>
<span class="lineno"></span><span class="op" id="2148797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2148800">func</span>&nbsp;<span class="ident" id="2148805">genericFtoa</span><span class="op" id="2148816">(</span><span class="ident" id="2148817">dst</span>&nbsp;<span class="op" id="2148821">[</span><span class="op" id="2148822">]</span><span class="builtintype" id="2148823">byte</span><span class="op" id="2148827">,</span>&nbsp;<span class="ident" id="2148829">val</span>&nbsp;<span class="builtintype" id="2148833">float64</span><span class="op" id="2148840">,</span>&nbsp;<span class="ident" id="2148842">fmt</span>&nbsp;<span class="builtintype" id="2148846">byte</span><span class="op" id="2148850">,</span>&nbsp;<span class="ident" id="2148852">prec</span><span class="op" id="2148856">,</span>&nbsp;<span class="ident" id="2148858">bitSize</span>&nbsp;<span class="builtintype" id="2148866">int</span><span class="op" id="2148869">)</span>&nbsp;<span class="op" id="2148871">[</span><span class="op" id="2148872">]</span><span class="builtintype" id="2148873">byte</span>&nbsp;<span class="op" id="2148878">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2148881">var</span>&nbsp;<span class="ident" id="2148885">bits</span>&nbsp;<span class="ident" id="2148890">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2148898">var</span>&nbsp;<span class="ident" id="2148902">flt</span>&nbsp;<span class="op" id="2148906">*</span><span class="ident" id="2148907">floatInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2148918">switch</span>&nbsp;<span class="ident" id="2148925">bitSize</span>&nbsp;<span class="op" id="2148933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2148936">case</span>&nbsp;<span class="num" id="2148941">32</span><span class="op" id="2148943">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2148947">bits</span>&nbsp;<span class="op" id="2148952">=</span>&nbsp;<span class="ident" id="2148954">uint64</span><span class="op" id="2148960">(</span><span class="ident" id="2148961">math</span><span class="op" id="2148965">.</span><span class="ident" id="2148966">Float32bits</span><span class="op" id="2148977">(</span><span class="builtintype" id="2148978">float32</span><span class="op" id="2148985">(</span><span class="ident" id="2148986">val</span><span class="op" id="2148989">)</span><span class="op" id="2148990">)</span><span class="op" id="2148991">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2148995">flt</span>&nbsp;<span class="op" id="2148999">=</span>&nbsp;<span class="op" id="2149001">&amp;</span><span class="ident" id="2149002">float32info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2149015">case</span>&nbsp;<span class="num" id="2149020">64</span><span class="op" id="2149022">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2149026">bits</span>&nbsp;<span class="op" id="2149031">=</span>&nbsp;<span class="ident" id="2149033">math</span><span class="op" id="2149037">.</span><span class="ident" id="2149038">Float64bits</span><span class="op" id="2149049">(</span><span class="ident" id="2149050">val</span><span class="op" id="2149053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2149057">flt</span>&nbsp;<span class="op" id="2149061">=</span>&nbsp;<span class="op" id="2149063">&amp;</span><span class="ident" id="2149064">float64info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2149077">default</span><span class="op" id="2149084">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2149088">panic</span><span class="op" id="2149093">(</span><span class="string" id="2149094">&#34;strconv:&nbsp;illegal&nbsp;AppendFloat/FormatFloat&nbsp;bitSize&#34;</span><span class="op" id="2149144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2149147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2149151">neg</span>&nbsp;<span class="op" id="2149155">:=</span>&nbsp;<span class="ident" id="2149158">bits</span><span class="op" id="2149162">&gt;&gt;</span><span class="op" id="2149164">(</span><span class="ident" id="2149165">flt</span><span class="op" id="2149168">.</span><span class="ident" id="2149169">expbits</span><span class="op" id="2149176">+</span><span class="ident" id="2149177">flt</span><span class="op" id="2149180">.</span><span class="ident" id="2149181">mantbits</span><span class="op" id="2149189">)</span>&nbsp;<span class="op" id="2149191">!=</span>&nbsp;<span class="num" id="2149194">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2149197">exp</span>&nbsp;<span class="op" id="2149201">:=</span>&nbsp;<span class="builtintype" id="2149204">int</span><span class="op" id="2149207">(</span><span class="ident" id="2149208">bits</span><span class="op" id="2149212">&gt;&gt;</span><span class="ident" id="2149214">flt</span><span class="op" id="2149217">.</span><span class="ident" id="2149218">mantbits</span><span class="op" id="2149226">)</span>&nbsp;<span class="op" id="2149228">&amp;</span>&nbsp;<span class="op" id="2149230">(</span><span class="num" id="2149231">1</span><span class="op" id="2149232">&lt;&lt;</span><span class="ident" id="2149234">flt</span><span class="op" id="2149237">.</span><span class="ident" id="2149238">expbits</span>&nbsp;<span class="op" id="2149246">-</span>&nbsp;<span class="num" id="2149248">1</span><span class="op" id="2149249">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2149252">mant</span>&nbsp;<span class="op" id="2149257">:=</span>&nbsp;<span class="ident" id="2149260">bits</span>&nbsp;<span class="op" id="2149265">&amp;</span>&nbsp;<span class="op" id="2149267">(</span><span class="ident" id="2149268">uint64</span><span class="op" id="2149274">(</span><span class="num" id="2149275">1</span><span class="op" id="2149276">)</span><span class="op" id="2149277">&lt;&lt;</span><span class="ident" id="2149279">flt</span><span class="op" id="2149282">.</span><span class="ident" id="2149283">mantbits</span>&nbsp;<span class="op" id="2149292">-</span>&nbsp;<span class="num" id="2149294">1</span><span class="op" id="2149295">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2149299">switch</span>&nbsp;<span class="ident" id="2149306">exp</span>&nbsp;<span class="op" id="2149310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2149313">case</span>&nbsp;<span class="num" id="2149318">1</span><span class="op" id="2149319">&lt;&lt;</span><span class="ident" id="2149321">flt</span><span class="op" id="2149324">.</span><span class="ident" id="2149325">expbits</span>&nbsp;<span class="op" id="2149333">-</span>&nbsp;<span class="num" id="2149335">1</span><span class="op" id="2149336">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2149340">//&nbsp;Inf,&nbsp;NaN</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2149354">var</span>&nbsp;<span class="ident" id="2149358">s</span>&nbsp;<span class="builtintype" id="2149360">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2149369">switch</span>&nbsp;<span class="op" id="2149376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2149380">case</span>&nbsp;<span class="ident" id="2149385">mant</span>&nbsp;<span class="op" id="2149390">!=</span>&nbsp;<span class="num" id="2149393">0</span><span class="op" id="2149394">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2149399">s</span>&nbsp;<span class="op" id="2149401">=</span>&nbsp;<span class="string" id="2149403">&#34;NaN&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2149411">case</span>&nbsp;<span class="ident" id="2149416">neg</span><span class="op" id="2149419">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2149424">s</span>&nbsp;<span class="op" id="2149426">=</span>&nbsp;<span class="string" id="2149428">&#34;-Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2149437">default</span><span class="op" id="2149444">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2149449">s</span>&nbsp;<span class="op" id="2149451">=</span>&nbsp;<span class="string" id="2149453">&#34;+Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2149462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2149466">return</span>&nbsp;<span class="builtinfunc" id="2149473">append</span><span class="op" id="2149479">(</span><span class="ident" id="2149480">dst</span><span class="op" id="2149483">,</span>&nbsp;<span class="ident" id="2149485">s</span><span class="op" id="2149486">...</span><span class="op" id="2149489">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2149493">case</span>&nbsp;<span class="num" id="2149498">0</span><span class="op" id="2149499">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2149503">//&nbsp;denormalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2149521">exp</span><span class="op" id="2149524">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2149529">default</span><span class="op" id="2149536">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2149540">//&nbsp;add&nbsp;implicit&nbsp;top&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2149566">mant</span>&nbsp;<span class="op" id="2149571">|=</span>&nbsp;<span class="ident" id="2149574">uint64</span><span class="op" id="2149580">(</span><span class="num" id="2149581">1</span><span class="op" id="2149582">)</span>&nbsp;<span class="op" id="2149584">&lt;&lt;</span>&nbsp;<span class="ident" id="2149587">flt</span><span class="op" id="2149590">.</span><span class="ident" id="2149591">mantbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2149601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2149604">exp</span>&nbsp;<span class="op" id="2149608">+=</span>&nbsp;<span class="ident" id="2149611">flt</span><span class="op" id="2149614">.</span><span class="ident" id="2149615">bias</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2149622">//&nbsp;Pick&nbsp;off&nbsp;easy&nbsp;binary&nbsp;format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2149655">if</span>&nbsp;<span class="ident" id="2149658">fmt</span>&nbsp;<span class="op" id="2149662">==</span>&nbsp;<span class="string" id="2149665">&#39;b&#39;</span>&nbsp;<span class="op" id="2149669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2149673">return</span>&nbsp;<span class="ident" id="2149680">fmtB</span><span class="op" id="2149684">(</span><span class="ident" id="2149685">dst</span><span class="op" id="2149688">,</span>&nbsp;<span class="ident" id="2149690">neg</span><span class="op" id="2149693">,</span>&nbsp;<span class="ident" id="2149695">mant</span><span class="op" id="2149699">,</span>&nbsp;<span class="ident" id="2149701">exp</span><span class="op" id="2149704">,</span>&nbsp;<span class="ident" id="2149706">flt</span><span class="op" id="2149709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2149712">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2149716">if</span>&nbsp;<span class="op" id="2149719">!</span><span class="ident" id="2149720">optimize</span>&nbsp;<span class="op" id="2149729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2149733">return</span>&nbsp;<span class="ident" id="2149740">bigFtoa</span><span class="op" id="2149747">(</span><span class="ident" id="2149748">dst</span><span class="op" id="2149751">,</span>&nbsp;<span class="ident" id="2149753">prec</span><span class="op" id="2149757">,</span>&nbsp;<span class="ident" id="2149759">fmt</span><span class="op" id="2149762">,</span>&nbsp;<span class="ident" id="2149764">neg</span><span class="op" id="2149767">,</span>&nbsp;<span class="ident" id="2149769">mant</span><span class="op" id="2149773">,</span>&nbsp;<span class="ident" id="2149775">exp</span><span class="op" id="2149778">,</span>&nbsp;<span class="ident" id="2149780">flt</span><span class="op" id="2149783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2149786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2149790">var</span>&nbsp;<span class="ident" id="2149794">digs</span>&nbsp;<span class="ident" id="2149799">decimalSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2149813">ok</span>&nbsp;<span class="op" id="2149816">:=</span>&nbsp;<span class="ident" id="2149819">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2149826">//&nbsp;Negative&nbsp;precision&nbsp;means&nbsp;&#34;only&nbsp;as&nbsp;much&nbsp;as&nbsp;needed&nbsp;to&nbsp;be&nbsp;exact.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2149893">shortest</span>&nbsp;<span class="op" id="2149902">:=</span>&nbsp;<span class="ident" id="2149905">prec</span>&nbsp;<span class="op" id="2149910">&lt;</span>&nbsp;<span class="num" id="2149912">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2149915">if</span>&nbsp;<span class="ident" id="2149918">shortest</span>&nbsp;<span class="op" id="2149927">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2149931">//&nbsp;Try&nbsp;Grisu3&nbsp;algorithm.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2149958">f</span>&nbsp;<span class="op" id="2149960">:=</span>&nbsp;<span class="builtinfunc" id="2149963">new</span><span class="op" id="2149966">(</span><span class="ident" id="2149967">extFloat</span><span class="op" id="2149975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2149979">lower</span><span class="op" id="2149984">,</span>&nbsp;<span class="ident" id="2149986">upper</span>&nbsp;<span class="op" id="2149992">:=</span>&nbsp;<span class="ident" id="2149995">f</span><span class="op" id="2149996">.</span><span class="ident" id="2149997">AssignComputeBounds</span><span class="op" id="2150016">(</span><span class="ident" id="2150017">mant</span><span class="op" id="2150021">,</span>&nbsp;<span class="ident" id="2150023">exp</span><span class="op" id="2150026">,</span>&nbsp;<span class="ident" id="2150028">neg</span><span class="op" id="2150031">,</span>&nbsp;<span class="ident" id="2150033">flt</span><span class="op" id="2150036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2150040">var</span>&nbsp;<span class="ident" id="2150044">buf</span>&nbsp;<span class="op" id="2150048">[</span><span class="num" id="2150049">32</span><span class="op" id="2150051">]</span><span class="builtintype" id="2150052">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2150059">digs</span><span class="op" id="2150063">.</span><span class="ident" id="2150064">d</span>&nbsp;<span class="op" id="2150066">=</span>&nbsp;<span class="ident" id="2150068">buf</span><span class="op" id="2150071">[</span><span class="op" id="2150072">:</span><span class="op" id="2150073">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2150077">ok</span>&nbsp;<span class="op" id="2150080">=</span>&nbsp;<span class="ident" id="2150082">f</span><span class="op" id="2150083">.</span><span class="ident" id="2150084">ShortestDecimal</span><span class="op" id="2150099">(</span><span class="op" id="2150100">&amp;</span><span class="ident" id="2150101">digs</span><span class="op" id="2150105">,</span>&nbsp;<span class="op" id="2150107">&amp;</span><span class="ident" id="2150108">lower</span><span class="op" id="2150113">,</span>&nbsp;<span class="op" id="2150115">&amp;</span><span class="ident" id="2150116">upper</span><span class="op" id="2150121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2150125">if</span>&nbsp;<span class="op" id="2150128">!</span><span class="ident" id="2150129">ok</span>&nbsp;<span class="op" id="2150132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2150137">return</span>&nbsp;<span class="ident" id="2150144">bigFtoa</span><span class="op" id="2150151">(</span><span class="ident" id="2150152">dst</span><span class="op" id="2150155">,</span>&nbsp;<span class="ident" id="2150157">prec</span><span class="op" id="2150161">,</span>&nbsp;<span class="ident" id="2150163">fmt</span><span class="op" id="2150166">,</span>&nbsp;<span class="ident" id="2150168">neg</span><span class="op" id="2150171">,</span>&nbsp;<span class="ident" id="2150173">mant</span><span class="op" id="2150177">,</span>&nbsp;<span class="ident" id="2150179">exp</span><span class="op" id="2150182">,</span>&nbsp;<span class="ident" id="2150184">flt</span><span class="op" id="2150187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2150191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2150195">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2150244">switch</span>&nbsp;<span class="ident" id="2150251">fmt</span>&nbsp;<span class="op" id="2150255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2150259">case</span>&nbsp;<span class="string" id="2150264">&#39;e&#39;</span><span class="op" id="2150267">,</span>&nbsp;<span class="string" id="2150269">&#39;E&#39;</span><span class="op" id="2150272">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2150277">prec</span>&nbsp;<span class="op" id="2150282">=</span>&nbsp;<span class="ident" id="2150284">digs</span><span class="op" id="2150288">.</span><span class="ident" id="2150289">nd</span>&nbsp;<span class="op" id="2150292">-</span>&nbsp;<span class="num" id="2150294">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2150298">case</span>&nbsp;<span class="string" id="2150303">&#39;f&#39;</span><span class="op" id="2150306">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2150311">prec</span>&nbsp;<span class="op" id="2150316">=</span>&nbsp;<span class="ident" id="2150318">max</span><span class="op" id="2150321">(</span><span class="ident" id="2150322">digs</span><span class="op" id="2150326">.</span><span class="ident" id="2150327">nd</span><span class="op" id="2150329">-</span><span class="ident" id="2150330">digs</span><span class="op" id="2150334">.</span><span class="ident" id="2150335">dp</span><span class="op" id="2150337">,</span>&nbsp;<span class="num" id="2150339">0</span><span class="op" id="2150340">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2150344">case</span>&nbsp;<span class="string" id="2150349">&#39;g&#39;</span><span class="op" id="2150352">,</span>&nbsp;<span class="string" id="2150354">&#39;G&#39;</span><span class="op" id="2150357">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2150362">prec</span>&nbsp;<span class="op" id="2150367">=</span>&nbsp;<span class="ident" id="2150369">digs</span><span class="op" id="2150373">.</span><span class="ident" id="2150374">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2150379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2150382">}</span>&nbsp;<span class="keyword" id="2150384">else</span>&nbsp;<span class="keyword" id="2150389">if</span>&nbsp;<span class="ident" id="2150392">fmt</span>&nbsp;<span class="op" id="2150396">!=</span>&nbsp;<span class="string" id="2150399">&#39;f&#39;</span>&nbsp;<span class="op" id="2150403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2150407">//&nbsp;Fixed&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2150436">digits</span>&nbsp;<span class="op" id="2150443">:=</span>&nbsp;<span class="ident" id="2150446">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2150453">switch</span>&nbsp;<span class="ident" id="2150460">fmt</span>&nbsp;<span class="op" id="2150464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2150468">case</span>&nbsp;<span class="string" id="2150473">&#39;e&#39;</span><span class="op" id="2150476">,</span>&nbsp;<span class="string" id="2150478">&#39;E&#39;</span><span class="op" id="2150481">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2150486">digits</span><span class="op" id="2150492">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2150497">case</span>&nbsp;<span class="string" id="2150502">&#39;g&#39;</span><span class="op" id="2150505">,</span>&nbsp;<span class="string" id="2150507">&#39;G&#39;</span><span class="op" id="2150510">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2150515">if</span>&nbsp;<span class="ident" id="2150518">prec</span>&nbsp;<span class="op" id="2150523">==</span>&nbsp;<span class="num" id="2150526">0</span>&nbsp;<span class="op" id="2150528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2150534">prec</span>&nbsp;<span class="op" id="2150539">=</span>&nbsp;<span class="num" id="2150541">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2150546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2150551">digits</span>&nbsp;<span class="op" id="2150558">=</span>&nbsp;<span class="ident" id="2150560">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2150567">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2150571">if</span>&nbsp;<span class="ident" id="2150574">digits</span>&nbsp;<span class="op" id="2150581">&lt;=</span>&nbsp;<span class="num" id="2150584">15</span>&nbsp;<span class="op" id="2150587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2150592">//&nbsp;try&nbsp;fast&nbsp;algorithm&nbsp;when&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;is&nbsp;reasonable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2150658">var</span>&nbsp;<span class="ident" id="2150662">buf</span>&nbsp;<span class="op" id="2150666">[</span><span class="num" id="2150667">24</span><span class="op" id="2150669">]</span><span class="builtintype" id="2150670">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2150678">digs</span><span class="op" id="2150682">.</span><span class="ident" id="2150683">d</span>&nbsp;<span class="op" id="2150685">=</span>&nbsp;<span class="ident" id="2150687">buf</span><span class="op" id="2150690">[</span><span class="op" id="2150691">:</span><span class="op" id="2150692">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2150697">f</span>&nbsp;<span class="op" id="2150699">:=</span>&nbsp;<span class="ident" id="2150702">extFloat</span><span class="op" id="2150710">{</span><span class="ident" id="2150711">mant</span><span class="op" id="2150715">,</span>&nbsp;<span class="ident" id="2150717">exp</span>&nbsp;<span class="op" id="2150721">-</span>&nbsp;<span class="builtintype" id="2150723">int</span><span class="op" id="2150726">(</span><span class="ident" id="2150727">flt</span><span class="op" id="2150730">.</span><span class="ident" id="2150731">mantbits</span><span class="op" id="2150739">)</span><span class="op" id="2150740">,</span>&nbsp;<span class="ident" id="2150742">neg</span><span class="op" id="2150745">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2150750">ok</span>&nbsp;<span class="op" id="2150753">=</span>&nbsp;<span class="ident" id="2150755">f</span><span class="op" id="2150756">.</span><span class="ident" id="2150757">FixedDecimal</span><span class="op" id="2150769">(</span><span class="op" id="2150770">&amp;</span><span class="ident" id="2150771">digs</span><span class="op" id="2150775">,</span>&nbsp;<span class="ident" id="2150777">digits</span><span class="op" id="2150783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2150787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2150790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2150793">if</span>&nbsp;<span class="op" id="2150796">!</span><span class="ident" id="2150797">ok</span>&nbsp;<span class="op" id="2150800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2150804">return</span>&nbsp;<span class="ident" id="2150811">bigFtoa</span><span class="op" id="2150818">(</span><span class="ident" id="2150819">dst</span><span class="op" id="2150822">,</span>&nbsp;<span class="ident" id="2150824">prec</span><span class="op" id="2150828">,</span>&nbsp;<span class="ident" id="2150830">fmt</span><span class="op" id="2150833">,</span>&nbsp;<span class="ident" id="2150835">neg</span><span class="op" id="2150838">,</span>&nbsp;<span class="ident" id="2150840">mant</span><span class="op" id="2150844">,</span>&nbsp;<span class="ident" id="2150846">exp</span><span class="op" id="2150849">,</span>&nbsp;<span class="ident" id="2150851">flt</span><span class="op" id="2150854">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2150857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2150860">return</span>&nbsp;<span class="ident" id="2150867">formatDigits</span><span class="op" id="2150879">(</span><span class="ident" id="2150880">dst</span><span class="op" id="2150883">,</span>&nbsp;<span class="ident" id="2150885">shortest</span><span class="op" id="2150893">,</span>&nbsp;<span class="ident" id="2150895">neg</span><span class="op" id="2150898">,</span>&nbsp;<span class="ident" id="2150900">digs</span><span class="op" id="2150904">,</span>&nbsp;<span class="ident" id="2150906">prec</span><span class="op" id="2150910">,</span>&nbsp;<span class="ident" id="2150912">fmt</span><span class="op" id="2150915">)</span><br>
<span class="lineno"></span><span class="op" id="2150917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2150920">//&nbsp;bigFtoa&nbsp;uses&nbsp;multiprecision&nbsp;computations&nbsp;to&nbsp;format&nbsp;a&nbsp;float.</span><br>
<span class="lineno">155</span><span class="keyword" id="2150983">func</span>&nbsp;<span class="ident" id="2150988">bigFtoa</span><span class="op" id="2150995">(</span><span class="ident" id="2150996">dst</span>&nbsp;<span class="op" id="2151000">[</span><span class="op" id="2151001">]</span><span class="builtintype" id="2151002">byte</span><span class="op" id="2151006">,</span>&nbsp;<span class="ident" id="2151008">prec</span>&nbsp;<span class="builtintype" id="2151013">int</span><span class="op" id="2151016">,</span>&nbsp;<span class="ident" id="2151018">fmt</span>&nbsp;<span class="builtintype" id="2151022">byte</span><span class="op" id="2151026">,</span>&nbsp;<span class="ident" id="2151028">neg</span>&nbsp;<span class="builtintype" id="2151032">bool</span><span class="op" id="2151036">,</span>&nbsp;<span class="ident" id="2151038">mant</span>&nbsp;<span class="ident" id="2151043">uint64</span><span class="op" id="2151049">,</span>&nbsp;<span class="ident" id="2151051">exp</span>&nbsp;<span class="builtintype" id="2151055">int</span><span class="op" id="2151058">,</span>&nbsp;<span class="ident" id="2151060">flt</span>&nbsp;<span class="op" id="2151064">*</span><span class="ident" id="2151065">floatInfo</span><span class="op" id="2151074">)</span>&nbsp;<span class="op" id="2151076">[</span><span class="op" id="2151077">]</span><span class="builtintype" id="2151078">byte</span>&nbsp;<span class="op" id="2151083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2151086">d</span>&nbsp;<span class="op" id="2151088">:=</span>&nbsp;<span class="builtinfunc" id="2151091">new</span><span class="op" id="2151094">(</span><span class="ident" id="2151095">decimal</span><span class="op" id="2151102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2151105">d</span><span class="op" id="2151106">.</span><span class="ident" id="2151107">Assign</span><span class="op" id="2151113">(</span><span class="ident" id="2151114">mant</span><span class="op" id="2151118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2151121">d</span><span class="op" id="2151122">.</span><span class="ident" id="2151123">Shift</span><span class="op" id="2151128">(</span><span class="ident" id="2151129">exp</span>&nbsp;<span class="op" id="2151133">-</span>&nbsp;<span class="builtintype" id="2151135">int</span><span class="op" id="2151138">(</span><span class="ident" id="2151139">flt</span><span class="op" id="2151142">.</span><span class="ident" id="2151143">mantbits</span><span class="op" id="2151151">)</span><span class="op" id="2151152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2151155">var</span>&nbsp;<span class="ident" id="2151159">digs</span>&nbsp;<span class="ident" id="2151164">decimalSlice</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2151178">shortest</span>&nbsp;<span class="op" id="2151187">:=</span>&nbsp;<span class="ident" id="2151190">prec</span>&nbsp;<span class="op" id="2151195">&lt;</span>&nbsp;<span class="num" id="2151197">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2151200">if</span>&nbsp;<span class="ident" id="2151203">shortest</span>&nbsp;<span class="op" id="2151212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2151216">roundShortest</span><span class="op" id="2151229">(</span><span class="ident" id="2151230">d</span><span class="op" id="2151231">,</span>&nbsp;<span class="ident" id="2151233">mant</span><span class="op" id="2151237">,</span>&nbsp;<span class="ident" id="2151239">exp</span><span class="op" id="2151242">,</span>&nbsp;<span class="ident" id="2151244">flt</span><span class="op" id="2151247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2151251">digs</span>&nbsp;<span class="op" id="2151256">=</span>&nbsp;<span class="ident" id="2151258">decimalSlice</span><span class="op" id="2151270">{</span><span class="ident" id="2151271">d</span><span class="op" id="2151272">:</span>&nbsp;<span class="ident" id="2151274">d</span><span class="op" id="2151275">.</span><span class="ident" id="2151276">d</span><span class="op" id="2151277">[</span><span class="op" id="2151278">:</span><span class="op" id="2151279">]</span><span class="op" id="2151280">,</span>&nbsp;<span class="ident" id="2151282">nd</span><span class="op" id="2151284">:</span>&nbsp;<span class="ident" id="2151286">d</span><span class="op" id="2151287">.</span><span class="ident" id="2151288">nd</span><span class="op" id="2151290">,</span>&nbsp;<span class="ident" id="2151292">dp</span><span class="op" id="2151294">:</span>&nbsp;<span class="ident" id="2151296">d</span><span class="op" id="2151297">.</span><span class="ident" id="2151298">dp</span><span class="op" id="2151300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2151304">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2151353">switch</span>&nbsp;<span class="ident" id="2151360">fmt</span>&nbsp;<span class="op" id="2151364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2151368">case</span>&nbsp;<span class="string" id="2151373">&#39;e&#39;</span><span class="op" id="2151376">,</span>&nbsp;<span class="string" id="2151378">&#39;E&#39;</span><span class="op" id="2151381">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2151386">prec</span>&nbsp;<span class="op" id="2151391">=</span>&nbsp;<span class="ident" id="2151393">digs</span><span class="op" id="2151397">.</span><span class="ident" id="2151398">nd</span>&nbsp;<span class="op" id="2151401">-</span>&nbsp;<span class="num" id="2151403">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2151407">case</span>&nbsp;<span class="string" id="2151412">&#39;f&#39;</span><span class="op" id="2151415">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2151420">prec</span>&nbsp;<span class="op" id="2151425">=</span>&nbsp;<span class="ident" id="2151427">max</span><span class="op" id="2151430">(</span><span class="ident" id="2151431">digs</span><span class="op" id="2151435">.</span><span class="ident" id="2151436">nd</span><span class="op" id="2151438">-</span><span class="ident" id="2151439">digs</span><span class="op" id="2151443">.</span><span class="ident" id="2151444">dp</span><span class="op" id="2151446">,</span>&nbsp;<span class="num" id="2151448">0</span><span class="op" id="2151449">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2151453">case</span>&nbsp;<span class="string" id="2151458">&#39;g&#39;</span><span class="op" id="2151461">,</span>&nbsp;<span class="string" id="2151463">&#39;G&#39;</span><span class="op" id="2151466">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2151471">prec</span>&nbsp;<span class="op" id="2151476">=</span>&nbsp;<span class="ident" id="2151478">digs</span><span class="op" id="2151482">.</span><span class="ident" id="2151483">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2151488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2151491">}</span>&nbsp;<span class="keyword" id="2151493">else</span>&nbsp;<span class="op" id="2151498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2151502">//&nbsp;Round&nbsp;appropriately.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2151528">switch</span>&nbsp;<span class="ident" id="2151535">fmt</span>&nbsp;<span class="op" id="2151539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2151543">case</span>&nbsp;<span class="string" id="2151548">&#39;e&#39;</span><span class="op" id="2151551">,</span>&nbsp;<span class="string" id="2151553">&#39;E&#39;</span><span class="op" id="2151556">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2151561">d</span><span class="op" id="2151562">.</span><span class="ident" id="2151563">Round</span><span class="op" id="2151568">(</span><span class="ident" id="2151569">prec</span>&nbsp;<span class="op" id="2151574">+</span>&nbsp;<span class="num" id="2151576">1</span><span class="op" id="2151577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2151581">case</span>&nbsp;<span class="string" id="2151586">&#39;f&#39;</span><span class="op" id="2151589">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2151594">d</span><span class="op" id="2151595">.</span><span class="ident" id="2151596">Round</span><span class="op" id="2151601">(</span><span class="ident" id="2151602">d</span><span class="op" id="2151603">.</span><span class="ident" id="2151604">dp</span>&nbsp;<span class="op" id="2151607">+</span>&nbsp;<span class="ident" id="2151609">prec</span><span class="op" id="2151613">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2151617">case</span>&nbsp;<span class="string" id="2151622">&#39;g&#39;</span><span class="op" id="2151625">,</span>&nbsp;<span class="string" id="2151627">&#39;G&#39;</span><span class="op" id="2151630">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2151635">if</span>&nbsp;<span class="ident" id="2151638">prec</span>&nbsp;<span class="op" id="2151643">==</span>&nbsp;<span class="num" id="2151646">0</span>&nbsp;<span class="op" id="2151648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2151654">prec</span>&nbsp;<span class="op" id="2151659">=</span>&nbsp;<span class="num" id="2151661">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2151666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2151671">d</span><span class="op" id="2151672">.</span><span class="ident" id="2151673">Round</span><span class="op" id="2151678">(</span><span class="ident" id="2151679">prec</span><span class="op" id="2151683">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2151687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2151691">digs</span>&nbsp;<span class="op" id="2151696">=</span>&nbsp;<span class="ident" id="2151698">decimalSlice</span><span class="op" id="2151710">{</span><span class="ident" id="2151711">d</span><span class="op" id="2151712">:</span>&nbsp;<span class="ident" id="2151714">d</span><span class="op" id="2151715">.</span><span class="ident" id="2151716">d</span><span class="op" id="2151717">[</span><span class="op" id="2151718">:</span><span class="op" id="2151719">]</span><span class="op" id="2151720">,</span>&nbsp;<span class="ident" id="2151722">nd</span><span class="op" id="2151724">:</span>&nbsp;<span class="ident" id="2151726">d</span><span class="op" id="2151727">.</span><span class="ident" id="2151728">nd</span><span class="op" id="2151730">,</span>&nbsp;<span class="ident" id="2151732">dp</span><span class="op" id="2151734">:</span>&nbsp;<span class="ident" id="2151736">d</span><span class="op" id="2151737">.</span><span class="ident" id="2151738">dp</span><span class="op" id="2151740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2151743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2151746">return</span>&nbsp;<span class="ident" id="2151753">formatDigits</span><span class="op" id="2151765">(</span><span class="ident" id="2151766">dst</span><span class="op" id="2151769">,</span>&nbsp;<span class="ident" id="2151771">shortest</span><span class="op" id="2151779">,</span>&nbsp;<span class="ident" id="2151781">neg</span><span class="op" id="2151784">,</span>&nbsp;<span class="ident" id="2151786">digs</span><span class="op" id="2151790">,</span>&nbsp;<span class="ident" id="2151792">prec</span><span class="op" id="2151796">,</span>&nbsp;<span class="ident" id="2151798">fmt</span><span class="op" id="2151801">)</span><br>
<span class="lineno"></span><span class="op" id="2151803">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="2151806">func</span>&nbsp;<span class="ident" id="2151811">formatDigits</span><span class="op" id="2151823">(</span><span class="ident" id="2151824">dst</span>&nbsp;<span class="op" id="2151828">[</span><span class="op" id="2151829">]</span><span class="builtintype" id="2151830">byte</span><span class="op" id="2151834">,</span>&nbsp;<span class="ident" id="2151836">shortest</span>&nbsp;<span class="builtintype" id="2151845">bool</span><span class="op" id="2151849">,</span>&nbsp;<span class="ident" id="2151851">neg</span>&nbsp;<span class="builtintype" id="2151855">bool</span><span class="op" id="2151859">,</span>&nbsp;<span class="ident" id="2151861">digs</span>&nbsp;<span class="ident" id="2151866">decimalSlice</span><span class="op" id="2151878">,</span>&nbsp;<span class="ident" id="2151880">prec</span>&nbsp;<span class="builtintype" id="2151885">int</span><span class="op" id="2151888">,</span>&nbsp;<span class="ident" id="2151890">fmt</span>&nbsp;<span class="builtintype" id="2151894">byte</span><span class="op" id="2151898">)</span>&nbsp;<span class="op" id="2151900">[</span><span class="op" id="2151901">]</span><span class="builtintype" id="2151902">byte</span>&nbsp;<span class="op" id="2151907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2151910">switch</span>&nbsp;<span class="ident" id="2151917">fmt</span>&nbsp;<span class="op" id="2151921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2151924">case</span>&nbsp;<span class="string" id="2151929">&#39;e&#39;</span><span class="op" id="2151932">,</span>&nbsp;<span class="string" id="2151934">&#39;E&#39;</span><span class="op" id="2151937">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2151941">return</span>&nbsp;<span class="ident" id="2151948">fmtE</span><span class="op" id="2151952">(</span><span class="ident" id="2151953">dst</span><span class="op" id="2151956">,</span>&nbsp;<span class="ident" id="2151958">neg</span><span class="op" id="2151961">,</span>&nbsp;<span class="ident" id="2151963">digs</span><span class="op" id="2151967">,</span>&nbsp;<span class="ident" id="2151969">prec</span><span class="op" id="2151973">,</span>&nbsp;<span class="ident" id="2151975">fmt</span><span class="op" id="2151978">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2151981">case</span>&nbsp;<span class="string" id="2151986">&#39;f&#39;</span><span class="op" id="2151989">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2151993">return</span>&nbsp;<span class="ident" id="2152000">fmtF</span><span class="op" id="2152004">(</span><span class="ident" id="2152005">dst</span><span class="op" id="2152008">,</span>&nbsp;<span class="ident" id="2152010">neg</span><span class="op" id="2152013">,</span>&nbsp;<span class="ident" id="2152015">digs</span><span class="op" id="2152019">,</span>&nbsp;<span class="ident" id="2152021">prec</span><span class="op" id="2152025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2152028">case</span>&nbsp;<span class="string" id="2152033">&#39;g&#39;</span><span class="op" id="2152036">,</span>&nbsp;<span class="string" id="2152038">&#39;G&#39;</span><span class="op" id="2152041">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2152045">//&nbsp;trailing&nbsp;fractional&nbsp;zeros&nbsp;in&nbsp;&#39;e&#39;&nbsp;form&nbsp;will&nbsp;be&nbsp;trimmed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2152105">eprec</span>&nbsp;<span class="op" id="2152111">:=</span>&nbsp;<span class="ident" id="2152114">prec</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2152121">if</span>&nbsp;<span class="ident" id="2152124">eprec</span>&nbsp;<span class="op" id="2152130">&gt;</span>&nbsp;<span class="ident" id="2152132">digs</span><span class="op" id="2152136">.</span><span class="ident" id="2152137">nd</span>&nbsp;<span class="op" id="2152140">&amp;&amp;</span>&nbsp;<span class="ident" id="2152143">digs</span><span class="op" id="2152147">.</span><span class="ident" id="2152148">nd</span>&nbsp;<span class="op" id="2152151">&gt;=</span>&nbsp;<span class="ident" id="2152154">digs</span><span class="op" id="2152158">.</span><span class="ident" id="2152159">dp</span>&nbsp;<span class="op" id="2152162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2152167">eprec</span>&nbsp;<span class="op" id="2152173">=</span>&nbsp;<span class="ident" id="2152175">digs</span><span class="op" id="2152179">.</span><span class="ident" id="2152180">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2152185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2152189">//&nbsp;%e&nbsp;is&nbsp;used&nbsp;if&nbsp;the&nbsp;exponent&nbsp;from&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2152241">//&nbsp;is&nbsp;less&nbsp;than&nbsp;-4&nbsp;or&nbsp;greater&nbsp;than&nbsp;or&nbsp;equal&nbsp;to&nbsp;the&nbsp;precision.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2152305">//&nbsp;if&nbsp;precision&nbsp;was&nbsp;the&nbsp;shortest&nbsp;possible,&nbsp;use&nbsp;precision&nbsp;6&nbsp;for&nbsp;this&nbsp;decision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2152385">if</span>&nbsp;<span class="ident" id="2152388">shortest</span>&nbsp;<span class="op" id="2152397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2152402">eprec</span>&nbsp;<span class="op" id="2152408">=</span>&nbsp;<span class="num" id="2152410">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2152414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2152418">exp</span>&nbsp;<span class="op" id="2152422">:=</span>&nbsp;<span class="ident" id="2152425">digs</span><span class="op" id="2152429">.</span><span class="ident" id="2152430">dp</span>&nbsp;<span class="op" id="2152433">-</span>&nbsp;<span class="num" id="2152435">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2152439">if</span>&nbsp;<span class="ident" id="2152442">exp</span>&nbsp;<span class="op" id="2152446">&lt;</span>&nbsp;<span class="op" id="2152448">-</span><span class="num" id="2152449">4</span>&nbsp;<span class="op" id="2152451">||</span>&nbsp;<span class="ident" id="2152454">exp</span>&nbsp;<span class="op" id="2152458">&gt;=</span>&nbsp;<span class="ident" id="2152461">eprec</span>&nbsp;<span class="op" id="2152467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2152472">if</span>&nbsp;<span class="ident" id="2152475">prec</span>&nbsp;<span class="op" id="2152480">&gt;</span>&nbsp;<span class="ident" id="2152482">digs</span><span class="op" id="2152486">.</span><span class="ident" id="2152487">nd</span>&nbsp;<span class="op" id="2152490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2152496">prec</span>&nbsp;<span class="op" id="2152501">=</span>&nbsp;<span class="ident" id="2152503">digs</span><span class="op" id="2152507">.</span><span class="ident" id="2152508">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2152514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2152519">return</span>&nbsp;<span class="ident" id="2152526">fmtE</span><span class="op" id="2152530">(</span><span class="ident" id="2152531">dst</span><span class="op" id="2152534">,</span>&nbsp;<span class="ident" id="2152536">neg</span><span class="op" id="2152539">,</span>&nbsp;<span class="ident" id="2152541">digs</span><span class="op" id="2152545">,</span>&nbsp;<span class="ident" id="2152547">prec</span><span class="op" id="2152551">-</span><span class="num" id="2152552">1</span><span class="op" id="2152553">,</span>&nbsp;<span class="ident" id="2152555">fmt</span><span class="op" id="2152558">+</span><span class="string" id="2152559">&#39;e&#39;</span><span class="op" id="2152562">-</span><span class="string" id="2152563">&#39;g&#39;</span><span class="op" id="2152566">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2152570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2152574">if</span>&nbsp;<span class="ident" id="2152577">prec</span>&nbsp;<span class="op" id="2152582">&gt;</span>&nbsp;<span class="ident" id="2152584">digs</span><span class="op" id="2152588">.</span><span class="ident" id="2152589">dp</span>&nbsp;<span class="op" id="2152592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2152597">prec</span>&nbsp;<span class="op" id="2152602">=</span>&nbsp;<span class="ident" id="2152604">digs</span><span class="op" id="2152608">.</span><span class="ident" id="2152609">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2152614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2152618">return</span>&nbsp;<span class="ident" id="2152625">fmtF</span><span class="op" id="2152629">(</span><span class="ident" id="2152630">dst</span><span class="op" id="2152633">,</span>&nbsp;<span class="ident" id="2152635">neg</span><span class="op" id="2152638">,</span>&nbsp;<span class="ident" id="2152640">digs</span><span class="op" id="2152644">,</span>&nbsp;<span class="ident" id="2152646">max</span><span class="op" id="2152649">(</span><span class="ident" id="2152650">prec</span><span class="op" id="2152654">-</span><span class="ident" id="2152655">digs</span><span class="op" id="2152659">.</span><span class="ident" id="2152660">dp</span><span class="op" id="2152662">,</span>&nbsp;<span class="num" id="2152664">0</span><span class="op" id="2152665">)</span><span class="op" id="2152666">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2152669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2152673">//&nbsp;unknown&nbsp;format</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2152692">return</span>&nbsp;<span class="builtinfunc" id="2152699">append</span><span class="op" id="2152705">(</span><span class="ident" id="2152706">dst</span><span class="op" id="2152709">,</span>&nbsp;<span class="string" id="2152711">&#39;%&#39;</span><span class="op" id="2152714">,</span>&nbsp;<span class="ident" id="2152716">fmt</span><span class="op" id="2152719">)</span><br>
<span class="lineno"></span><span class="op" id="2152721">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="2152724">//&nbsp;Round&nbsp;d&nbsp;(=&nbsp;mant&nbsp;*&nbsp;2^exp)&nbsp;to&nbsp;the&nbsp;shortest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2152785">//&nbsp;that&nbsp;will&nbsp;let&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;value&nbsp;be&nbsp;precisely</span><br>
<span class="lineno"></span><span class="comment" id="2152849">//&nbsp;reconstructed.&nbsp;&nbsp;Size&nbsp;is&nbsp;original&nbsp;floating&nbsp;point&nbsp;size&nbsp;(64&nbsp;or&nbsp;32).</span><br>
<span class="lineno"></span><span class="keyword" id="2152917">func</span>&nbsp;<span class="ident" id="2152922">roundShortest</span><span class="op" id="2152935">(</span><span class="ident" id="2152936">d</span>&nbsp;<span class="op" id="2152938">*</span><span class="ident" id="2152939">decimal</span><span class="op" id="2152946">,</span>&nbsp;<span class="ident" id="2152948">mant</span>&nbsp;<span class="ident" id="2152953">uint64</span><span class="op" id="2152959">,</span>&nbsp;<span class="ident" id="2152961">exp</span>&nbsp;<span class="builtintype" id="2152965">int</span><span class="op" id="2152968">,</span>&nbsp;<span class="ident" id="2152970">flt</span>&nbsp;<span class="op" id="2152974">*</span><span class="ident" id="2152975">floatInfo</span><span class="op" id="2152984">)</span>&nbsp;<span class="op" id="2152986">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2152989">//&nbsp;If&nbsp;mantissa&nbsp;is&nbsp;zero,&nbsp;the&nbsp;number&nbsp;is&nbsp;zero;&nbsp;stop&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2153044">if</span>&nbsp;<span class="ident" id="2153047">mant</span>&nbsp;<span class="op" id="2153052">==</span>&nbsp;<span class="num" id="2153055">0</span>&nbsp;<span class="op" id="2153057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2153061">d</span><span class="op" id="2153062">.</span><span class="ident" id="2153063">nd</span>&nbsp;<span class="op" id="2153066">=</span>&nbsp;<span class="num" id="2153068">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2153072">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2153080">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153084">//&nbsp;Compute&nbsp;upper&nbsp;and&nbsp;lower&nbsp;such&nbsp;that&nbsp;any&nbsp;decimal&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153141">//&nbsp;between&nbsp;upper&nbsp;and&nbsp;lower&nbsp;(possibly&nbsp;inclusive)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153190">//&nbsp;will&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;number.</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153245">//&nbsp;We&nbsp;may&nbsp;see&nbsp;at&nbsp;once&nbsp;that&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153305">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153309">//&nbsp;Suppose&nbsp;d&nbsp;is&nbsp;not&nbsp;denormal,&nbsp;so&nbsp;that&nbsp;2^exp&nbsp;&lt;=&nbsp;d&nbsp;&lt;&nbsp;10^dp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153368">//&nbsp;The&nbsp;closest&nbsp;shorter&nbsp;number&nbsp;is&nbsp;at&nbsp;least&nbsp;10^(dp-nd)&nbsp;away.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153428">//&nbsp;The&nbsp;lower/upper&nbsp;bounds&nbsp;computed&nbsp;below&nbsp;are&nbsp;at&nbsp;distance</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153486">//&nbsp;at&nbsp;most&nbsp;2^(exp-mantbits).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153516">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153520">//&nbsp;So&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest&nbsp;if&nbsp;10^(dp-nd)&nbsp;&gt;&nbsp;2^(exp-mantbits),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153592">//&nbsp;or&nbsp;equivalently&nbsp;log2(10)*(dp-nd)&nbsp;&gt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153645">//&nbsp;It&nbsp;is&nbsp;true&nbsp;if&nbsp;332/100*(dp-nd)&nbsp;&gt;=&nbsp;exp-mantbits&nbsp;(log2(10)&nbsp;&gt;&nbsp;3.32).</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2153714">minexp</span>&nbsp;<span class="op" id="2153721">:=</span>&nbsp;<span class="ident" id="2153724">flt</span><span class="op" id="2153727">.</span><span class="ident" id="2153728">bias</span>&nbsp;<span class="op" id="2153733">+</span>&nbsp;<span class="num" id="2153735">1</span>&nbsp;<span class="comment" id="2153737">//&nbsp;minimum&nbsp;possible&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2153767">if</span>&nbsp;<span class="ident" id="2153770">exp</span>&nbsp;<span class="op" id="2153774">&gt;</span>&nbsp;<span class="ident" id="2153776">minexp</span>&nbsp;<span class="op" id="2153783">&amp;&amp;</span>&nbsp;<span class="num" id="2153786">332</span><span class="op" id="2153789">*</span><span class="op" id="2153790">(</span><span class="ident" id="2153791">d</span><span class="op" id="2153792">.</span><span class="ident" id="2153793">dp</span><span class="op" id="2153795">-</span><span class="ident" id="2153796">d</span><span class="op" id="2153797">.</span><span class="ident" id="2153798">nd</span><span class="op" id="2153800">)</span>&nbsp;<span class="op" id="2153802">&gt;=</span>&nbsp;<span class="num" id="2153805">100</span><span class="op" id="2153808">*</span><span class="op" id="2153809">(</span><span class="ident" id="2153810">exp</span><span class="op" id="2153813">-</span><span class="builtintype" id="2153814">int</span><span class="op" id="2153817">(</span><span class="ident" id="2153818">flt</span><span class="op" id="2153821">.</span><span class="ident" id="2153822">mantbits</span><span class="op" id="2153830">)</span><span class="op" id="2153831">)</span>&nbsp;<span class="op" id="2153833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153837">//&nbsp;The&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2153874">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2153882">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153886">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153919">//&nbsp;Next&nbsp;highest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant+1&nbsp;&lt;&lt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153985">//&nbsp;Our&nbsp;upper&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mant*2+1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154053">upper</span>&nbsp;<span class="op" id="2154059">:=</span>&nbsp;<span class="builtinfunc" id="2154062">new</span><span class="op" id="2154065">(</span><span class="ident" id="2154066">decimal</span><span class="op" id="2154073">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154076">upper</span><span class="op" id="2154081">.</span><span class="ident" id="2154082">Assign</span><span class="op" id="2154088">(</span><span class="ident" id="2154089">mant</span><span class="op" id="2154093">*</span><span class="num" id="2154094">2</span>&nbsp;<span class="op" id="2154096">+</span>&nbsp;<span class="num" id="2154098">1</span><span class="op" id="2154099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154102">upper</span><span class="op" id="2154107">.</span><span class="ident" id="2154108">Shift</span><span class="op" id="2154113">(</span><span class="ident" id="2154114">exp</span>&nbsp;<span class="op" id="2154118">-</span>&nbsp;<span class="builtintype" id="2154120">int</span><span class="op" id="2154123">(</span><span class="ident" id="2154124">flt</span><span class="op" id="2154127">.</span><span class="ident" id="2154128">mantbits</span><span class="op" id="2154136">)</span>&nbsp;<span class="op" id="2154138">-</span>&nbsp;<span class="num" id="2154140">1</span><span class="op" id="2154141">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2154145">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2154178">//&nbsp;Next&nbsp;lowest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant-1&nbsp;&lt;&lt;&nbsp;exp-mantbits,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2154243">//&nbsp;unless&nbsp;mant-1&nbsp;drops&nbsp;the&nbsp;significant&nbsp;bit&nbsp;and&nbsp;exp&nbsp;is&nbsp;not&nbsp;the&nbsp;minimum&nbsp;exp,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2154319">//&nbsp;in&nbsp;which&nbsp;case&nbsp;the&nbsp;next&nbsp;lowest&nbsp;is&nbsp;mant*2-1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2154384">//&nbsp;Either&nbsp;way,&nbsp;call&nbsp;it&nbsp;mantlo&nbsp;&lt;&lt;&nbsp;explo-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2154434">//&nbsp;Our&nbsp;lower&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mantlo*2+1&nbsp;&lt;&lt;&nbsp;explo-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2154506">var</span>&nbsp;<span class="ident" id="2154510">mantlo</span>&nbsp;<span class="ident" id="2154517">uint64</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2154525">var</span>&nbsp;<span class="ident" id="2154529">explo</span>&nbsp;<span class="builtintype" id="2154535">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2154540">if</span>&nbsp;<span class="ident" id="2154543">mant</span>&nbsp;<span class="op" id="2154548">&gt;</span>&nbsp;<span class="num" id="2154550">1</span><span class="op" id="2154551">&lt;&lt;</span><span class="ident" id="2154553">flt</span><span class="op" id="2154556">.</span><span class="ident" id="2154557">mantbits</span>&nbsp;<span class="op" id="2154566">||</span>&nbsp;<span class="ident" id="2154569">exp</span>&nbsp;<span class="op" id="2154573">==</span>&nbsp;<span class="ident" id="2154576">minexp</span>&nbsp;<span class="op" id="2154583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154587">mantlo</span>&nbsp;<span class="op" id="2154594">=</span>&nbsp;<span class="ident" id="2154596">mant</span>&nbsp;<span class="op" id="2154601">-</span>&nbsp;<span class="num" id="2154603">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154607">explo</span>&nbsp;<span class="op" id="2154613">=</span>&nbsp;<span class="ident" id="2154615">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2154620">}</span>&nbsp;<span class="keyword" id="2154622">else</span>&nbsp;<span class="op" id="2154627">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154631">mantlo</span>&nbsp;<span class="op" id="2154638">=</span>&nbsp;<span class="ident" id="2154640">mant</span><span class="op" id="2154644">*</span><span class="num" id="2154645">2</span>&nbsp;<span class="op" id="2154647">-</span>&nbsp;<span class="num" id="2154649">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154653">explo</span>&nbsp;<span class="op" id="2154659">=</span>&nbsp;<span class="ident" id="2154661">exp</span>&nbsp;<span class="op" id="2154665">-</span>&nbsp;<span class="num" id="2154667">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2154670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154673">lower</span>&nbsp;<span class="op" id="2154679">:=</span>&nbsp;<span class="builtinfunc" id="2154682">new</span><span class="op" id="2154685">(</span><span class="ident" id="2154686">decimal</span><span class="op" id="2154693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154696">lower</span><span class="op" id="2154701">.</span><span class="ident" id="2154702">Assign</span><span class="op" id="2154708">(</span><span class="ident" id="2154709">mantlo</span><span class="op" id="2154715">*</span><span class="num" id="2154716">2</span>&nbsp;<span class="op" id="2154718">+</span>&nbsp;<span class="num" id="2154720">1</span><span class="op" id="2154721">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154724">lower</span><span class="op" id="2154729">.</span><span class="ident" id="2154730">Shift</span><span class="op" id="2154735">(</span><span class="ident" id="2154736">explo</span>&nbsp;<span class="op" id="2154742">-</span>&nbsp;<span class="builtintype" id="2154744">int</span><span class="op" id="2154747">(</span><span class="ident" id="2154748">flt</span><span class="op" id="2154751">.</span><span class="ident" id="2154752">mantbits</span><span class="op" id="2154760">)</span>&nbsp;<span class="op" id="2154762">-</span>&nbsp;<span class="num" id="2154764">1</span><span class="op" id="2154765">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2154769">//&nbsp;The&nbsp;upper&nbsp;and&nbsp;lower&nbsp;bounds&nbsp;are&nbsp;possible&nbsp;outputs&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2154829">//&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;is&nbsp;even,&nbsp;so&nbsp;that&nbsp;IEEE&nbsp;round-to-even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2154891">//&nbsp;would&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;and&nbsp;not&nbsp;the&nbsp;neighbors.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154955">inclusive</span>&nbsp;<span class="op" id="2154965">:=</span>&nbsp;<span class="ident" id="2154968">mant</span><span class="op" id="2154972">%</span><span class="num" id="2154973">2</span>&nbsp;<span class="op" id="2154975">==</span>&nbsp;<span class="num" id="2154978">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2154982">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;figure&nbsp;out&nbsp;the&nbsp;minimum&nbsp;number&nbsp;of&nbsp;digits&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2155047">//&nbsp;Walk&nbsp;along&nbsp;until&nbsp;d&nbsp;has&nbsp;distinguished&nbsp;itself&nbsp;from&nbsp;upper&nbsp;and&nbsp;lower.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155117">for</span>&nbsp;<span class="ident" id="2155121">i</span>&nbsp;<span class="op" id="2155123">:=</span>&nbsp;<span class="num" id="2155126">0</span><span class="op" id="2155127">;</span>&nbsp;<span class="ident" id="2155129">i</span>&nbsp;<span class="op" id="2155131">&lt;</span>&nbsp;<span class="ident" id="2155133">d</span><span class="op" id="2155134">.</span><span class="ident" id="2155135">nd</span><span class="op" id="2155137">;</span>&nbsp;<span class="ident" id="2155139">i</span><span class="op" id="2155140">++</span>&nbsp;<span class="op" id="2155143">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155147">var</span>&nbsp;<span class="ident" id="2155151">l</span><span class="op" id="2155152">,</span>&nbsp;<span class="ident" id="2155154">m</span><span class="op" id="2155155">,</span>&nbsp;<span class="ident" id="2155157">u</span>&nbsp;<span class="builtintype" id="2155159">byte</span>&nbsp;<span class="comment" id="2155164">//&nbsp;lower,&nbsp;middle,&nbsp;upper&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155197">if</span>&nbsp;<span class="ident" id="2155200">i</span>&nbsp;<span class="op" id="2155202">&lt;</span>&nbsp;<span class="ident" id="2155204">lower</span><span class="op" id="2155209">.</span><span class="ident" id="2155210">nd</span>&nbsp;<span class="op" id="2155213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155218">l</span>&nbsp;<span class="op" id="2155220">=</span>&nbsp;<span class="ident" id="2155222">lower</span><span class="op" id="2155227">.</span><span class="ident" id="2155228">d</span><span class="op" id="2155229">[</span><span class="ident" id="2155230">i</span><span class="op" id="2155231">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2155235">}</span>&nbsp;<span class="keyword" id="2155237">else</span>&nbsp;<span class="op" id="2155242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155247">l</span>&nbsp;<span class="op" id="2155249">=</span>&nbsp;<span class="string" id="2155251">&#39;0&#39;</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2155257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155261">m</span>&nbsp;<span class="op" id="2155263">=</span>&nbsp;<span class="ident" id="2155265">d</span><span class="op" id="2155266">.</span><span class="ident" id="2155267">d</span><span class="op" id="2155268">[</span><span class="ident" id="2155269">i</span><span class="op" id="2155270">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155274">if</span>&nbsp;<span class="ident" id="2155277">i</span>&nbsp;<span class="op" id="2155279">&lt;</span>&nbsp;<span class="ident" id="2155281">upper</span><span class="op" id="2155286">.</span><span class="ident" id="2155287">nd</span>&nbsp;<span class="op" id="2155290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155295">u</span>&nbsp;<span class="op" id="2155297">=</span>&nbsp;<span class="ident" id="2155299">upper</span><span class="op" id="2155304">.</span><span class="ident" id="2155305">d</span><span class="op" id="2155306">[</span><span class="ident" id="2155307">i</span><span class="op" id="2155308">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2155312">}</span>&nbsp;<span class="keyword" id="2155314">else</span>&nbsp;<span class="op" id="2155319">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155324">u</span>&nbsp;<span class="op" id="2155326">=</span>&nbsp;<span class="string" id="2155328">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2155334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2155339">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;down&nbsp;(truncate)&nbsp;if&nbsp;lower&nbsp;has&nbsp;a&nbsp;different&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2155405">//&nbsp;or&nbsp;if&nbsp;lower&nbsp;is&nbsp;inclusive&nbsp;and&nbsp;is&nbsp;exactly&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;down.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155479">okdown</span>&nbsp;<span class="op" id="2155486">:=</span>&nbsp;<span class="ident" id="2155489">l</span>&nbsp;<span class="op" id="2155491">!=</span>&nbsp;<span class="ident" id="2155494">m</span>&nbsp;<span class="op" id="2155496">||</span>&nbsp;<span class="op" id="2155499">(</span><span class="ident" id="2155500">inclusive</span>&nbsp;<span class="op" id="2155510">&amp;&amp;</span>&nbsp;<span class="ident" id="2155513">l</span>&nbsp;<span class="op" id="2155515">==</span>&nbsp;<span class="ident" id="2155518">m</span>&nbsp;<span class="op" id="2155520">&amp;&amp;</span>&nbsp;<span class="ident" id="2155523">i</span><span class="op" id="2155524">+</span><span class="num" id="2155525">1</span>&nbsp;<span class="op" id="2155527">==</span>&nbsp;<span class="ident" id="2155530">lower</span><span class="op" id="2155535">.</span><span class="ident" id="2155536">nd</span><span class="op" id="2155538">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2155543">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;up&nbsp;if&nbsp;upper&nbsp;has&nbsp;a&nbsp;different&nbsp;digit&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2155600">//&nbsp;either&nbsp;upper&nbsp;is&nbsp;inclusive&nbsp;or&nbsp;upper&nbsp;is&nbsp;bigger&nbsp;than&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155682">okup</span>&nbsp;<span class="op" id="2155687">:=</span>&nbsp;<span class="ident" id="2155690">m</span>&nbsp;<span class="op" id="2155692">!=</span>&nbsp;<span class="ident" id="2155695">u</span>&nbsp;<span class="op" id="2155697">&amp;&amp;</span>&nbsp;<span class="op" id="2155700">(</span><span class="ident" id="2155701">inclusive</span>&nbsp;<span class="op" id="2155711">||</span>&nbsp;<span class="ident" id="2155714">m</span><span class="op" id="2155715">+</span><span class="num" id="2155716">1</span>&nbsp;<span class="op" id="2155718">&lt;</span>&nbsp;<span class="ident" id="2155720">u</span>&nbsp;<span class="op" id="2155722">||</span>&nbsp;<span class="ident" id="2155725">i</span><span class="op" id="2155726">+</span><span class="num" id="2155727">1</span>&nbsp;<span class="op" id="2155729">&lt;</span>&nbsp;<span class="ident" id="2155731">upper</span><span class="op" id="2155736">.</span><span class="ident" id="2155737">nd</span><span class="op" id="2155739">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2155744">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;either,&nbsp;then&nbsp;round&nbsp;to&nbsp;the&nbsp;nearest&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2155807">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;only&nbsp;one,&nbsp;do&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155848">switch</span>&nbsp;<span class="op" id="2155855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155859">case</span>&nbsp;<span class="ident" id="2155864">okdown</span>&nbsp;<span class="op" id="2155871">&amp;&amp;</span>&nbsp;<span class="ident" id="2155874">okup</span><span class="op" id="2155878">:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155883">d</span><span class="op" id="2155884">.</span><span class="ident" id="2155885">Round</span><span class="op" id="2155890">(</span><span class="ident" id="2155891">i</span>&nbsp;<span class="op" id="2155893">+</span>&nbsp;<span class="num" id="2155895">1</span><span class="op" id="2155896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155901">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155910">case</span>&nbsp;<span class="ident" id="2155915">okdown</span><span class="op" id="2155921">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155926">d</span><span class="op" id="2155927">.</span><span class="ident" id="2155928">RoundDown</span><span class="op" id="2155937">(</span><span class="ident" id="2155938">i</span>&nbsp;<span class="op" id="2155940">+</span>&nbsp;<span class="num" id="2155942">1</span><span class="op" id="2155943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155948">return</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155957">case</span>&nbsp;<span class="ident" id="2155962">okup</span><span class="op" id="2155966">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155971">d</span><span class="op" id="2155972">.</span><span class="ident" id="2155973">RoundUp</span><span class="op" id="2155980">(</span><span class="ident" id="2155981">i</span>&nbsp;<span class="op" id="2155983">+</span>&nbsp;<span class="num" id="2155985">1</span><span class="op" id="2155986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155991">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2156000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2156003">}</span><br>
<span class="lineno">325</span><span class="op" id="2156005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2156008">type</span>&nbsp;<span class="ident" id="2156013">decimalSlice</span>&nbsp;<span class="keyword" id="2156026">struct</span>&nbsp;<span class="op" id="2156033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156036">d</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2156043">[</span><span class="op" id="2156044">]</span><span class="builtintype" id="2156045">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156051">nd</span><span class="op" id="2156053">,</span>&nbsp;<span class="ident" id="2156055">dp</span>&nbsp;<span class="builtintype" id="2156058">int</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156063">neg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2156070">bool</span><br>
<span class="lineno"></span><span class="op" id="2156075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2156078">//&nbsp;%e:&nbsp;-d.ddddde±dd</span><br>
<span class="lineno"></span><span class="keyword" id="2156099">func</span>&nbsp;<span class="ident" id="2156104">fmtE</span><span class="op" id="2156108">(</span><span class="ident" id="2156109">dst</span>&nbsp;<span class="op" id="2156113">[</span><span class="op" id="2156114">]</span><span class="builtintype" id="2156115">byte</span><span class="op" id="2156119">,</span>&nbsp;<span class="ident" id="2156121">neg</span>&nbsp;<span class="builtintype" id="2156125">bool</span><span class="op" id="2156129">,</span>&nbsp;<span class="ident" id="2156131">d</span>&nbsp;<span class="ident" id="2156133">decimalSlice</span><span class="op" id="2156145">,</span>&nbsp;<span class="ident" id="2156147">prec</span>&nbsp;<span class="builtintype" id="2156152">int</span><span class="op" id="2156155">,</span>&nbsp;<span class="ident" id="2156157">fmt</span>&nbsp;<span class="builtintype" id="2156161">byte</span><span class="op" id="2156165">)</span>&nbsp;<span class="op" id="2156167">[</span><span class="op" id="2156168">]</span><span class="builtintype" id="2156169">byte</span>&nbsp;<span class="op" id="2156174">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2156177">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2156186">if</span>&nbsp;<span class="ident" id="2156189">neg</span>&nbsp;<span class="op" id="2156193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156197">dst</span>&nbsp;<span class="op" id="2156201">=</span>&nbsp;<span class="builtinfunc" id="2156203">append</span><span class="op" id="2156209">(</span><span class="ident" id="2156210">dst</span><span class="op" id="2156213">,</span>&nbsp;<span class="string" id="2156215">&#39;-&#39;</span><span class="op" id="2156218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2156221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2156225">//&nbsp;first&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156241">ch</span>&nbsp;<span class="op" id="2156244">:=</span>&nbsp;<span class="builtintype" id="2156247">byte</span><span class="op" id="2156251">(</span><span class="string" id="2156252">&#39;0&#39;</span><span class="op" id="2156255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2156258">if</span>&nbsp;<span class="ident" id="2156261">d</span><span class="op" id="2156262">.</span><span class="ident" id="2156263">nd</span>&nbsp;<span class="op" id="2156266">!=</span>&nbsp;<span class="num" id="2156269">0</span>&nbsp;<span class="op" id="2156271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156275">ch</span>&nbsp;<span class="op" id="2156278">=</span>&nbsp;<span class="ident" id="2156280">d</span><span class="op" id="2156281">.</span><span class="ident" id="2156282">d</span><span class="op" id="2156283">[</span><span class="num" id="2156284">0</span><span class="op" id="2156285">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2156288">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156291">dst</span>&nbsp;<span class="op" id="2156295">=</span>&nbsp;<span class="builtinfunc" id="2156297">append</span><span class="op" id="2156303">(</span><span class="ident" id="2156304">dst</span><span class="op" id="2156307">,</span>&nbsp;<span class="ident" id="2156309">ch</span><span class="op" id="2156311">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2156315">//&nbsp;.moredigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2156331">if</span>&nbsp;<span class="ident" id="2156334">prec</span>&nbsp;<span class="op" id="2156339">&gt;</span>&nbsp;<span class="num" id="2156341">0</span>&nbsp;<span class="op" id="2156343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156347">dst</span>&nbsp;<span class="op" id="2156351">=</span>&nbsp;<span class="builtinfunc" id="2156353">append</span><span class="op" id="2156359">(</span><span class="ident" id="2156360">dst</span><span class="op" id="2156363">,</span>&nbsp;<span class="string" id="2156365">&#39;.&#39;</span><span class="op" id="2156368">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156372">i</span>&nbsp;<span class="op" id="2156374">:=</span>&nbsp;<span class="num" id="2156377">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156381">m</span>&nbsp;<span class="op" id="2156383">:=</span>&nbsp;<span class="ident" id="2156386">d</span><span class="op" id="2156387">.</span><span class="ident" id="2156388">nd</span>&nbsp;<span class="op" id="2156391">+</span>&nbsp;<span class="ident" id="2156393">prec</span>&nbsp;<span class="op" id="2156398">+</span>&nbsp;<span class="num" id="2156400">1</span>&nbsp;<span class="op" id="2156402">-</span>&nbsp;<span class="ident" id="2156404">max</span><span class="op" id="2156407">(</span><span class="ident" id="2156408">d</span><span class="op" id="2156409">.</span><span class="ident" id="2156410">nd</span><span class="op" id="2156412">,</span>&nbsp;<span class="ident" id="2156414">prec</span><span class="op" id="2156418">+</span><span class="num" id="2156419">1</span><span class="op" id="2156420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2156424">for</span>&nbsp;<span class="ident" id="2156428">i</span>&nbsp;<span class="op" id="2156430">&lt;</span>&nbsp;<span class="ident" id="2156432">m</span>&nbsp;<span class="op" id="2156434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156439">dst</span>&nbsp;<span class="op" id="2156443">=</span>&nbsp;<span class="builtinfunc" id="2156445">append</span><span class="op" id="2156451">(</span><span class="ident" id="2156452">dst</span><span class="op" id="2156455">,</span>&nbsp;<span class="ident" id="2156457">d</span><span class="op" id="2156458">.</span><span class="ident" id="2156459">d</span><span class="op" id="2156460">[</span><span class="ident" id="2156461">i</span><span class="op" id="2156462">]</span><span class="op" id="2156463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156468">i</span><span class="op" id="2156469">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2156474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2156478">for</span>&nbsp;<span class="ident" id="2156482">i</span>&nbsp;<span class="op" id="2156484">&lt;=</span>&nbsp;<span class="ident" id="2156487">prec</span>&nbsp;<span class="op" id="2156492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156497">dst</span>&nbsp;<span class="op" id="2156501">=</span>&nbsp;<span class="builtinfunc" id="2156503">append</span><span class="op" id="2156509">(</span><span class="ident" id="2156510">dst</span><span class="op" id="2156513">,</span>&nbsp;<span class="string" id="2156515">&#39;0&#39;</span><span class="op" id="2156518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156523">i</span><span class="op" id="2156524">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2156529">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2156532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2156536">//&nbsp;e±</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156544">dst</span>&nbsp;<span class="op" id="2156548">=</span>&nbsp;<span class="builtinfunc" id="2156550">append</span><span class="op" id="2156556">(</span><span class="ident" id="2156557">dst</span><span class="op" id="2156560">,</span>&nbsp;<span class="ident" id="2156562">fmt</span><span class="op" id="2156565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156568">exp</span>&nbsp;<span class="op" id="2156572">:=</span>&nbsp;<span class="ident" id="2156575">d</span><span class="op" id="2156576">.</span><span class="ident" id="2156577">dp</span>&nbsp;<span class="op" id="2156580">-</span>&nbsp;<span class="num" id="2156582">1</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2156585">if</span>&nbsp;<span class="ident" id="2156588">d</span><span class="op" id="2156589">.</span><span class="ident" id="2156590">nd</span>&nbsp;<span class="op" id="2156593">==</span>&nbsp;<span class="num" id="2156596">0</span>&nbsp;<span class="op" id="2156598">{</span>&nbsp;<span class="comment" id="2156600">//&nbsp;special&nbsp;case:&nbsp;0&nbsp;has&nbsp;exponent&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156636">exp</span>&nbsp;<span class="op" id="2156640">=</span>&nbsp;<span class="num" id="2156642">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2156645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2156648">if</span>&nbsp;<span class="ident" id="2156651">exp</span>&nbsp;<span class="op" id="2156655">&lt;</span>&nbsp;<span class="num" id="2156657">0</span>&nbsp;<span class="op" id="2156659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156663">ch</span>&nbsp;<span class="op" id="2156666">=</span>&nbsp;<span class="string" id="2156668">&#39;-&#39;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156674">exp</span>&nbsp;<span class="op" id="2156678">=</span>&nbsp;<span class="op" id="2156680">-</span><span class="ident" id="2156681">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2156686">}</span>&nbsp;<span class="keyword" id="2156688">else</span>&nbsp;<span class="op" id="2156693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156697">ch</span>&nbsp;<span class="op" id="2156700">=</span>&nbsp;<span class="string" id="2156702">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2156707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156710">dst</span>&nbsp;<span class="op" id="2156714">=</span>&nbsp;<span class="builtinfunc" id="2156716">append</span><span class="op" id="2156722">(</span><span class="ident" id="2156723">dst</span><span class="op" id="2156726">,</span>&nbsp;<span class="ident" id="2156728">ch</span><span class="op" id="2156730">)</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2156734">//&nbsp;dddd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2156743">var</span>&nbsp;<span class="ident" id="2156747">buf</span>&nbsp;<span class="op" id="2156751">[</span><span class="num" id="2156752">3</span><span class="op" id="2156753">]</span><span class="builtintype" id="2156754">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156760">i</span>&nbsp;<span class="op" id="2156762">:=</span>&nbsp;<span class="builtinfunc" id="2156765">len</span><span class="op" id="2156768">(</span><span class="ident" id="2156769">buf</span><span class="op" id="2156772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2156775">for</span>&nbsp;<span class="ident" id="2156779">exp</span>&nbsp;<span class="op" id="2156783">&gt;=</span>&nbsp;<span class="num" id="2156786">10</span>&nbsp;<span class="op" id="2156789">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156793">i</span><span class="op" id="2156794">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156799">buf</span><span class="op" id="2156802">[</span><span class="ident" id="2156803">i</span><span class="op" id="2156804">]</span>&nbsp;<span class="op" id="2156806">=</span>&nbsp;<span class="builtintype" id="2156808">byte</span><span class="op" id="2156812">(</span><span class="ident" id="2156813">exp</span><span class="op" id="2156816">%</span><span class="num" id="2156817">10</span>&nbsp;<span class="op" id="2156820">+</span>&nbsp;<span class="string" id="2156822">&#39;0&#39;</span><span class="op" id="2156825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156829">exp</span>&nbsp;<span class="op" id="2156833">/=</span>&nbsp;<span class="num" id="2156836">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2156840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2156843">//&nbsp;exp&nbsp;&lt;&nbsp;10</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156856">i</span><span class="op" id="2156857">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156861">buf</span><span class="op" id="2156864">[</span><span class="ident" id="2156865">i</span><span class="op" id="2156866">]</span>&nbsp;<span class="op" id="2156868">=</span>&nbsp;<span class="builtintype" id="2156870">byte</span><span class="op" id="2156874">(</span><span class="ident" id="2156875">exp</span>&nbsp;<span class="op" id="2156879">+</span>&nbsp;<span class="string" id="2156881">&#39;0&#39;</span><span class="op" id="2156884">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2156888">switch</span>&nbsp;<span class="ident" id="2156895">i</span>&nbsp;<span class="op" id="2156897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2156900">case</span>&nbsp;<span class="num" id="2156905">0</span><span class="op" id="2156906">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156910">dst</span>&nbsp;<span class="op" id="2156914">=</span>&nbsp;<span class="builtinfunc" id="2156916">append</span><span class="op" id="2156922">(</span><span class="ident" id="2156923">dst</span><span class="op" id="2156926">,</span>&nbsp;<span class="ident" id="2156928">buf</span><span class="op" id="2156931">[</span><span class="num" id="2156932">0</span><span class="op" id="2156933">]</span><span class="op" id="2156934">,</span>&nbsp;<span class="ident" id="2156936">buf</span><span class="op" id="2156939">[</span><span class="num" id="2156940">1</span><span class="op" id="2156941">]</span><span class="op" id="2156942">,</span>&nbsp;<span class="ident" id="2156944">buf</span><span class="op" id="2156947">[</span><span class="num" id="2156948">2</span><span class="op" id="2156949">]</span><span class="op" id="2156950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2156953">case</span>&nbsp;<span class="num" id="2156958">1</span><span class="op" id="2156959">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156963">dst</span>&nbsp;<span class="op" id="2156967">=</span>&nbsp;<span class="builtinfunc" id="2156969">append</span><span class="op" id="2156975">(</span><span class="ident" id="2156976">dst</span><span class="op" id="2156979">,</span>&nbsp;<span class="ident" id="2156981">buf</span><span class="op" id="2156984">[</span><span class="num" id="2156985">1</span><span class="op" id="2156986">]</span><span class="op" id="2156987">,</span>&nbsp;<span class="ident" id="2156989">buf</span><span class="op" id="2156992">[</span><span class="num" id="2156993">2</span><span class="op" id="2156994">]</span><span class="op" id="2156995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2156998">case</span>&nbsp;<span class="num" id="2157003">2</span><span class="op" id="2157004">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2157008">//&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157028">dst</span>&nbsp;<span class="op" id="2157032">=</span>&nbsp;<span class="builtinfunc" id="2157034">append</span><span class="op" id="2157040">(</span><span class="ident" id="2157041">dst</span><span class="op" id="2157044">,</span>&nbsp;<span class="string" id="2157046">&#39;0&#39;</span><span class="op" id="2157049">,</span>&nbsp;<span class="ident" id="2157051">buf</span><span class="op" id="2157054">[</span><span class="num" id="2157055">2</span><span class="op" id="2157056">]</span><span class="op" id="2157057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2157060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2157063">return</span>&nbsp;<span class="ident" id="2157070">dst</span><br>
<span class="lineno"></span><span class="op" id="2157074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="2157077">//&nbsp;%f:&nbsp;-ddddddd.ddddd</span><br>
<span class="lineno"></span><span class="keyword" id="2157099">func</span>&nbsp;<span class="ident" id="2157104">fmtF</span><span class="op" id="2157108">(</span><span class="ident" id="2157109">dst</span>&nbsp;<span class="op" id="2157113">[</span><span class="op" id="2157114">]</span><span class="builtintype" id="2157115">byte</span><span class="op" id="2157119">,</span>&nbsp;<span class="ident" id="2157121">neg</span>&nbsp;<span class="builtintype" id="2157125">bool</span><span class="op" id="2157129">,</span>&nbsp;<span class="ident" id="2157131">d</span>&nbsp;<span class="ident" id="2157133">decimalSlice</span><span class="op" id="2157145">,</span>&nbsp;<span class="ident" id="2157147">prec</span>&nbsp;<span class="builtintype" id="2157152">int</span><span class="op" id="2157155">)</span>&nbsp;<span class="op" id="2157157">[</span><span class="op" id="2157158">]</span><span class="builtintype" id="2157159">byte</span>&nbsp;<span class="op" id="2157164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2157167">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2157176">if</span>&nbsp;<span class="ident" id="2157179">neg</span>&nbsp;<span class="op" id="2157183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157187">dst</span>&nbsp;<span class="op" id="2157191">=</span>&nbsp;<span class="builtinfunc" id="2157193">append</span><span class="op" id="2157199">(</span><span class="ident" id="2157200">dst</span><span class="op" id="2157203">,</span>&nbsp;<span class="string" id="2157205">&#39;-&#39;</span><span class="op" id="2157208">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2157211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2157215">//&nbsp;integer,&nbsp;padded&nbsp;with&nbsp;zeros&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2157257">if</span>&nbsp;<span class="ident" id="2157260">d</span><span class="op" id="2157261">.</span><span class="ident" id="2157262">dp</span>&nbsp;<span class="op" id="2157265">&gt;</span>&nbsp;<span class="num" id="2157267">0</span>&nbsp;<span class="op" id="2157269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2157273">var</span>&nbsp;<span class="ident" id="2157277">i</span>&nbsp;<span class="builtintype" id="2157279">int</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2157285">for</span>&nbsp;<span class="ident" id="2157289">i</span>&nbsp;<span class="op" id="2157291">=</span>&nbsp;<span class="num" id="2157293">0</span><span class="op" id="2157294">;</span>&nbsp;<span class="ident" id="2157296">i</span>&nbsp;<span class="op" id="2157298">&lt;</span>&nbsp;<span class="ident" id="2157300">d</span><span class="op" id="2157301">.</span><span class="ident" id="2157302">dp</span>&nbsp;<span class="op" id="2157305">&amp;&amp;</span>&nbsp;<span class="ident" id="2157308">i</span>&nbsp;<span class="op" id="2157310">&lt;</span>&nbsp;<span class="ident" id="2157312">d</span><span class="op" id="2157313">.</span><span class="ident" id="2157314">nd</span><span class="op" id="2157316">;</span>&nbsp;<span class="ident" id="2157318">i</span><span class="op" id="2157319">++</span>&nbsp;<span class="op" id="2157322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157327">dst</span>&nbsp;<span class="op" id="2157331">=</span>&nbsp;<span class="builtinfunc" id="2157333">append</span><span class="op" id="2157339">(</span><span class="ident" id="2157340">dst</span><span class="op" id="2157343">,</span>&nbsp;<span class="ident" id="2157345">d</span><span class="op" id="2157346">.</span><span class="ident" id="2157347">d</span><span class="op" id="2157348">[</span><span class="ident" id="2157349">i</span><span class="op" id="2157350">]</span><span class="op" id="2157351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2157355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2157359">for</span>&nbsp;<span class="op" id="2157363">;</span>&nbsp;<span class="ident" id="2157365">i</span>&nbsp;<span class="op" id="2157367">&lt;</span>&nbsp;<span class="ident" id="2157369">d</span><span class="op" id="2157370">.</span><span class="ident" id="2157371">dp</span><span class="op" id="2157373">;</span>&nbsp;<span class="ident" id="2157375">i</span><span class="op" id="2157376">++</span>&nbsp;<span class="op" id="2157379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157384">dst</span>&nbsp;<span class="op" id="2157388">=</span>&nbsp;<span class="builtinfunc" id="2157390">append</span><span class="op" id="2157396">(</span><span class="ident" id="2157397">dst</span><span class="op" id="2157400">,</span>&nbsp;<span class="string" id="2157402">&#39;0&#39;</span><span class="op" id="2157405">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2157409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2157412">}</span>&nbsp;<span class="keyword" id="2157414">else</span>&nbsp;<span class="op" id="2157419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157423">dst</span>&nbsp;<span class="op" id="2157427">=</span>&nbsp;<span class="builtinfunc" id="2157429">append</span><span class="op" id="2157435">(</span><span class="ident" id="2157436">dst</span><span class="op" id="2157439">,</span>&nbsp;<span class="string" id="2157441">&#39;0&#39;</span><span class="op" id="2157444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2157447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2157451">//&nbsp;fraction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2157464">if</span>&nbsp;<span class="ident" id="2157467">prec</span>&nbsp;<span class="op" id="2157472">&gt;</span>&nbsp;<span class="num" id="2157474">0</span>&nbsp;<span class="op" id="2157476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157480">dst</span>&nbsp;<span class="op" id="2157484">=</span>&nbsp;<span class="builtinfunc" id="2157486">append</span><span class="op" id="2157492">(</span><span class="ident" id="2157493">dst</span><span class="op" id="2157496">,</span>&nbsp;<span class="string" id="2157498">&#39;.&#39;</span><span class="op" id="2157501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2157505">for</span>&nbsp;<span class="ident" id="2157509">i</span>&nbsp;<span class="op" id="2157511">:=</span>&nbsp;<span class="num" id="2157514">0</span><span class="op" id="2157515">;</span>&nbsp;<span class="ident" id="2157517">i</span>&nbsp;<span class="op" id="2157519">&lt;</span>&nbsp;<span class="ident" id="2157521">prec</span><span class="op" id="2157525">;</span>&nbsp;<span class="ident" id="2157527">i</span><span class="op" id="2157528">++</span>&nbsp;<span class="op" id="2157531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157536">ch</span>&nbsp;<span class="op" id="2157539">:=</span>&nbsp;<span class="builtintype" id="2157542">byte</span><span class="op" id="2157546">(</span><span class="string" id="2157547">&#39;0&#39;</span><span class="op" id="2157550">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2157555">if</span>&nbsp;<span class="ident" id="2157558">j</span>&nbsp;<span class="op" id="2157560">:=</span>&nbsp;<span class="ident" id="2157563">d</span><span class="op" id="2157564">.</span><span class="ident" id="2157565">dp</span>&nbsp;<span class="op" id="2157568">+</span>&nbsp;<span class="ident" id="2157570">i</span><span class="op" id="2157571">;</span>&nbsp;<span class="num" id="2157573">0</span>&nbsp;<span class="op" id="2157575">&lt;=</span>&nbsp;<span class="ident" id="2157578">j</span>&nbsp;<span class="op" id="2157580">&amp;&amp;</span>&nbsp;<span class="ident" id="2157583">j</span>&nbsp;<span class="op" id="2157585">&lt;</span>&nbsp;<span class="ident" id="2157587">d</span><span class="op" id="2157588">.</span><span class="ident" id="2157589">nd</span>&nbsp;<span class="op" id="2157592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157598">ch</span>&nbsp;<span class="op" id="2157601">=</span>&nbsp;<span class="ident" id="2157603">d</span><span class="op" id="2157604">.</span><span class="ident" id="2157605">d</span><span class="op" id="2157606">[</span><span class="ident" id="2157607">j</span><span class="op" id="2157608">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2157613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157618">dst</span>&nbsp;<span class="op" id="2157622">=</span>&nbsp;<span class="builtinfunc" id="2157624">append</span><span class="op" id="2157630">(</span><span class="ident" id="2157631">dst</span><span class="op" id="2157634">,</span>&nbsp;<span class="ident" id="2157636">ch</span><span class="op" id="2157638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2157642">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2157645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2157649">return</span>&nbsp;<span class="ident" id="2157656">dst</span><br>
<span class="lineno"></span><span class="op" id="2157660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="comment" id="2157663">//&nbsp;%b:&nbsp;-ddddddddp+ddd</span><br>
<span class="lineno"></span><span class="keyword" id="2157685">func</span>&nbsp;<span class="ident" id="2157690">fmtB</span><span class="op" id="2157694">(</span><span class="ident" id="2157695">dst</span>&nbsp;<span class="op" id="2157699">[</span><span class="op" id="2157700">]</span><span class="builtintype" id="2157701">byte</span><span class="op" id="2157705">,</span>&nbsp;<span class="ident" id="2157707">neg</span>&nbsp;<span class="builtintype" id="2157711">bool</span><span class="op" id="2157715">,</span>&nbsp;<span class="ident" id="2157717">mant</span>&nbsp;<span class="ident" id="2157722">uint64</span><span class="op" id="2157728">,</span>&nbsp;<span class="ident" id="2157730">exp</span>&nbsp;<span class="builtintype" id="2157734">int</span><span class="op" id="2157737">,</span>&nbsp;<span class="ident" id="2157739">flt</span>&nbsp;<span class="op" id="2157743">*</span><span class="ident" id="2157744">floatInfo</span><span class="op" id="2157753">)</span>&nbsp;<span class="op" id="2157755">[</span><span class="op" id="2157756">]</span><span class="builtintype" id="2157757">byte</span>&nbsp;<span class="op" id="2157762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2157765">var</span>&nbsp;<span class="ident" id="2157769">buf</span>&nbsp;<span class="op" id="2157773">[</span><span class="num" id="2157774">50</span><span class="op" id="2157776">]</span><span class="builtintype" id="2157777">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157783">w</span>&nbsp;<span class="op" id="2157785">:=</span>&nbsp;<span class="builtinfunc" id="2157788">len</span><span class="op" id="2157791">(</span><span class="ident" id="2157792">buf</span><span class="op" id="2157795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157798">exp</span>&nbsp;<span class="op" id="2157802">-=</span>&nbsp;<span class="builtintype" id="2157805">int</span><span class="op" id="2157808">(</span><span class="ident" id="2157809">flt</span><span class="op" id="2157812">.</span><span class="ident" id="2157813">mantbits</span><span class="op" id="2157821">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157824">esign</span>&nbsp;<span class="op" id="2157830">:=</span>&nbsp;<span class="builtintype" id="2157833">byte</span><span class="op" id="2157837">(</span><span class="string" id="2157838">&#39;+&#39;</span><span class="op" id="2157841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2157844">if</span>&nbsp;<span class="ident" id="2157847">exp</span>&nbsp;<span class="op" id="2157851">&lt;</span>&nbsp;<span class="num" id="2157853">0</span>&nbsp;<span class="op" id="2157855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157859">esign</span>&nbsp;<span class="op" id="2157865">=</span>&nbsp;<span class="string" id="2157867">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157873">exp</span>&nbsp;<span class="op" id="2157877">=</span>&nbsp;<span class="op" id="2157879">-</span><span class="ident" id="2157880">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2157885">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157888">n</span>&nbsp;<span class="op" id="2157890">:=</span>&nbsp;<span class="num" id="2157893">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2157896">for</span>&nbsp;<span class="ident" id="2157900">exp</span>&nbsp;<span class="op" id="2157904">&gt;</span>&nbsp;<span class="num" id="2157906">0</span>&nbsp;<span class="op" id="2157908">||</span>&nbsp;<span class="ident" id="2157911">n</span>&nbsp;<span class="op" id="2157913">&lt;</span>&nbsp;<span class="num" id="2157915">1</span>&nbsp;<span class="op" id="2157917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157921">n</span><span class="op" id="2157922">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157927">w</span><span class="op" id="2157928">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157933">buf</span><span class="op" id="2157936">[</span><span class="ident" id="2157937">w</span><span class="op" id="2157938">]</span>&nbsp;<span class="op" id="2157940">=</span>&nbsp;<span class="builtintype" id="2157942">byte</span><span class="op" id="2157946">(</span><span class="ident" id="2157947">exp</span><span class="op" id="2157950">%</span><span class="num" id="2157951">10</span>&nbsp;<span class="op" id="2157954">+</span>&nbsp;<span class="string" id="2157956">&#39;0&#39;</span><span class="op" id="2157959">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157963">exp</span>&nbsp;<span class="op" id="2157967">/=</span>&nbsp;<span class="num" id="2157970">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2157974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157977">w</span><span class="op" id="2157978">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157982">buf</span><span class="op" id="2157985">[</span><span class="ident" id="2157986">w</span><span class="op" id="2157987">]</span>&nbsp;<span class="op" id="2157989">=</span>&nbsp;<span class="ident" id="2157991">esign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2157998">w</span><span class="op" id="2157999">--</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2158003">buf</span><span class="op" id="2158006">[</span><span class="ident" id="2158007">w</span><span class="op" id="2158008">]</span>&nbsp;<span class="op" id="2158010">=</span>&nbsp;<span class="string" id="2158012">&#39;p&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2158017">n</span>&nbsp;<span class="op" id="2158019">=</span>&nbsp;<span class="num" id="2158021">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2158024">for</span>&nbsp;<span class="ident" id="2158028">mant</span>&nbsp;<span class="op" id="2158033">&gt;</span>&nbsp;<span class="num" id="2158035">0</span>&nbsp;<span class="op" id="2158037">||</span>&nbsp;<span class="ident" id="2158040">n</span>&nbsp;<span class="op" id="2158042">&lt;</span>&nbsp;<span class="num" id="2158044">1</span>&nbsp;<span class="op" id="2158046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2158050">n</span><span class="op" id="2158051">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2158056">w</span><span class="op" id="2158057">--</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2158062">buf</span><span class="op" id="2158065">[</span><span class="ident" id="2158066">w</span><span class="op" id="2158067">]</span>&nbsp;<span class="op" id="2158069">=</span>&nbsp;<span class="builtintype" id="2158071">byte</span><span class="op" id="2158075">(</span><span class="ident" id="2158076">mant</span><span class="op" id="2158080">%</span><span class="num" id="2158081">10</span>&nbsp;<span class="op" id="2158084">+</span>&nbsp;<span class="string" id="2158086">&#39;0&#39;</span><span class="op" id="2158089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2158093">mant</span>&nbsp;<span class="op" id="2158098">/=</span>&nbsp;<span class="num" id="2158101">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2158105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2158108">if</span>&nbsp;<span class="ident" id="2158111">neg</span>&nbsp;<span class="op" id="2158115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2158119">w</span><span class="op" id="2158120">--</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2158125">buf</span><span class="op" id="2158128">[</span><span class="ident" id="2158129">w</span><span class="op" id="2158130">]</span>&nbsp;<span class="op" id="2158132">=</span>&nbsp;<span class="string" id="2158134">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2158139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2158142">return</span>&nbsp;<span class="builtinfunc" id="2158149">append</span><span class="op" id="2158155">(</span><span class="ident" id="2158156">dst</span><span class="op" id="2158159">,</span>&nbsp;<span class="ident" id="2158161">buf</span><span class="op" id="2158164">[</span><span class="ident" id="2158165">w</span><span class="op" id="2158166">:</span><span class="op" id="2158167">]</span><span class="op" id="2158168">...</span><span class="op" id="2158171">)</span><br>
<span class="lineno"></span><span class="op" id="2158173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="keyword" id="2158176">func</span>&nbsp;<span class="ident" id="2158181">max</span><span class="op" id="2158184">(</span><span class="ident" id="2158185">a</span><span class="op" id="2158186">,</span>&nbsp;<span class="ident" id="2158188">b</span>&nbsp;<span class="builtintype" id="2158190">int</span><span class="op" id="2158193">)</span>&nbsp;<span class="builtintype" id="2158195">int</span>&nbsp;<span class="op" id="2158199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2158202">if</span>&nbsp;<span class="ident" id="2158205">a</span>&nbsp;<span class="op" id="2158207">&gt;</span>&nbsp;<span class="ident" id="2158209">b</span>&nbsp;<span class="op" id="2158211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2158215">return</span>&nbsp;<span class="ident" id="2158222">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2158225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2158228">return</span>&nbsp;<span class="ident" id="2158235">b</span><br>
<span class="lineno">475</span><span class="op" id="2158237">}</span>
</div>
</body>
</html>
