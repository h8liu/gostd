<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html" class="current">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5100491">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5100546">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5100600">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5100651">//&nbsp;Package&nbsp;suffixarray&nbsp;implements&nbsp;substring&nbsp;search&nbsp;in&nbsp;logarithmic&nbsp;time&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="5100728">//&nbsp;an&nbsp;in-memory&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="5100758">//</span><br>
<span class="lineno"></span><span class="comment" id="5100761">//&nbsp;Example&nbsp;use:</span><br>
<span class="lineno"></span><span class="comment" id="5100777">//</span><br>
<span class="lineno">10</span><span class="comment" id="5100780">//&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;create&nbsp;index&nbsp;for&nbsp;some&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5100813">//&nbsp;&nbsp;&nbsp;&nbspindex&nbsp;:=&nbsp;suffixarray.New(data)</span><br>
<span class="lineno"></span><span class="comment" id="5100847">//</span><br>
<span class="lineno"></span><span class="comment" id="5100850">//&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;lookup&nbsp;byte&nbsp;slice&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5100876">//&nbsp;&nbsp;&nbsp;&nbspoffsets1&nbsp;:=&nbsp;index.Lookup(s,&nbsp;-1)&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;all&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno">15</span><span class="comment" id="5100961">//&nbsp;&nbsp;&nbsp;&nbspoffsets2&nbsp;:=&nbsp;index.Lookup(s,&nbsp;3)&nbsp;&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;3&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5101052">//</span><br>
<span class="lineno"></span><span class="keyword" id="5101055">package</span>&nbsp;<span class="ident" id="5101063">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5101076">import</span>&nbsp;<span class="op" id="5101083">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101086">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101095">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101114">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101120">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5101130">&#34;sort&#34;</span><br>
<span class="lineno">25</span><span class="op" id="5101137">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5101140">//&nbsp;Index&nbsp;implements&nbsp;a&nbsp;suffix&nbsp;array&nbsp;for&nbsp;fast&nbsp;substring&nbsp;search.</span><br>
<span class="lineno"></span><span class="keyword" id="5101202">type</span>&nbsp;<span class="ident" id="5101207">Index</span>&nbsp;<span class="keyword" id="5101213">struct</span>&nbsp;<span class="op" id="5101220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101223">data</span>&nbsp;<span class="op" id="5101228">[</span><span class="op" id="5101229">]</span><span class="builtintype" id="5101230">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101236">sa</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5101241">[</span><span class="op" id="5101242">]</span><span class="builtintype" id="5101243">int</span>&nbsp;<span class="comment" id="5101247">//&nbsp;suffix&nbsp;array&nbsp;for&nbsp;data;&nbsp;len(sa)&nbsp;==&nbsp;len(data)</span><br>
<span class="lineno"></span><span class="op" id="5101294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5101297">//&nbsp;New&nbsp;creates&nbsp;a&nbsp;new&nbsp;Index&nbsp;for&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5101334">//&nbsp;Index&nbsp;creation&nbsp;time&nbsp;is&nbsp;O(N*log(N))&nbsp;for&nbsp;N&nbsp;=&nbsp;len(data).</span><br>
<span class="lineno">35</span><span class="keyword" id="5101391">func</span>&nbsp;<span class="ident" id="5101396">New</span><span class="op" id="5101399">(</span><span class="ident" id="5101400">data</span>&nbsp;<span class="op" id="5101405">[</span><span class="op" id="5101406">]</span><span class="builtintype" id="5101407">byte</span><span class="op" id="5101411">)</span>&nbsp;<span class="op" id="5101413">*</span><span class="ident" id="5101414">Index</span>&nbsp;<span class="op" id="5101420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5101423">return</span>&nbsp;<span class="op" id="5101430">&amp;</span><span class="ident" id="5101431">Index</span><span class="op" id="5101436">{</span><span class="ident" id="5101437">data</span><span class="op" id="5101441">,</span>&nbsp;<span class="ident" id="5101443">qsufsort</span><span class="op" id="5101451">(</span><span class="ident" id="5101452">data</span><span class="op" id="5101456">)</span><span class="op" id="5101457">}</span><br>
<span class="lineno"></span><span class="op" id="5101459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5101462">//&nbsp;writeInt&nbsp;writes&nbsp;an&nbsp;int&nbsp;x&nbsp;to&nbsp;w&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">40</span><span class="keyword" id="5101526">func</span>&nbsp;<span class="ident" id="5101531">writeInt</span><span class="op" id="5101539">(</span><span class="ident" id="5101540">w</span>&nbsp;<span class="ident" id="5101542">io</span><span class="op" id="5101544">.</span><span class="ident" id="5101545">Writer</span><span class="op" id="5101551">,</span>&nbsp;<span class="ident" id="5101553">buf</span>&nbsp;<span class="op" id="5101557">[</span><span class="op" id="5101558">]</span><span class="builtintype" id="5101559">byte</span><span class="op" id="5101563">,</span>&nbsp;<span class="ident" id="5101565">x</span>&nbsp;<span class="builtintype" id="5101567">int</span><span class="op" id="5101570">)</span>&nbsp;<span class="builtintype" id="5101572">error</span>&nbsp;<span class="op" id="5101578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101581">binary</span><span class="op" id="5101587">.</span><span class="ident" id="5101588">PutVarint</span><span class="op" id="5101597">(</span><span class="ident" id="5101598">buf</span><span class="op" id="5101601">,</span>&nbsp;<span class="ident" id="5101603">int64</span><span class="op" id="5101608">(</span><span class="ident" id="5101609">x</span><span class="op" id="5101610">)</span><span class="op" id="5101611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101614">_</span><span class="op" id="5101615">,</span>&nbsp;<span class="ident" id="5101617">err</span>&nbsp;<span class="op" id="5101621">:=</span>&nbsp;<span class="ident" id="5101624">w</span><span class="op" id="5101625">.</span><span class="ident" id="5101626">Write</span><span class="op" id="5101631">(</span><span class="ident" id="5101632">buf</span><span class="op" id="5101635">[</span><span class="num" id="5101636">0</span><span class="op" id="5101637">:</span><span class="ident" id="5101638">binary</span><span class="op" id="5101644">.</span><span class="ident" id="5101645">MaxVarintLen64</span><span class="op" id="5101659">]</span><span class="op" id="5101660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5101663">return</span>&nbsp;<span class="ident" id="5101670">err</span><br>
<span class="lineno"></span><span class="op" id="5101674">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5101677">//&nbsp;readInt&nbsp;reads&nbsp;an&nbsp;int&nbsp;x&nbsp;from&nbsp;r&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read&nbsp;and&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="5101754">func</span>&nbsp;<span class="ident" id="5101759">readInt</span><span class="op" id="5101766">(</span><span class="ident" id="5101767">r</span>&nbsp;<span class="ident" id="5101769">io</span><span class="op" id="5101771">.</span><span class="ident" id="5101772">Reader</span><span class="op" id="5101778">,</span>&nbsp;<span class="ident" id="5101780">buf</span>&nbsp;<span class="op" id="5101784">[</span><span class="op" id="5101785">]</span><span class="builtintype" id="5101786">byte</span><span class="op" id="5101790">)</span>&nbsp;<span class="op" id="5101792">(</span><span class="builtintype" id="5101793">int</span><span class="op" id="5101796">,</span>&nbsp;<span class="builtintype" id="5101798">error</span><span class="op" id="5101803">)</span>&nbsp;<span class="op" id="5101805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101808">_</span><span class="op" id="5101809">,</span>&nbsp;<span class="ident" id="5101811">err</span>&nbsp;<span class="op" id="5101815">:=</span>&nbsp;<span class="ident" id="5101818">io</span><span class="op" id="5101820">.</span><span class="ident" id="5101821">ReadFull</span><span class="op" id="5101829">(</span><span class="ident" id="5101830">r</span><span class="op" id="5101831">,</span>&nbsp;<span class="ident" id="5101833">buf</span><span class="op" id="5101836">[</span><span class="num" id="5101837">0</span><span class="op" id="5101838">:</span><span class="ident" id="5101839">binary</span><span class="op" id="5101845">.</span><span class="ident" id="5101846">MaxVarintLen64</span><span class="op" id="5101860">]</span><span class="op" id="5101861">)</span>&nbsp;<span class="comment" id="5101863">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;with&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101893">x</span><span class="op" id="5101894">,</span>&nbsp;<span class="ident" id="5101896">_</span>&nbsp;<span class="op" id="5101898">:=</span>&nbsp;<span class="ident" id="5101901">binary</span><span class="op" id="5101907">.</span><span class="ident" id="5101908">Varint</span><span class="op" id="5101914">(</span><span class="ident" id="5101915">buf</span><span class="op" id="5101918">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5101921">return</span>&nbsp;<span class="builtintype" id="5101928">int</span><span class="op" id="5101931">(</span><span class="ident" id="5101932">x</span><span class="op" id="5101933">)</span><span class="op" id="5101934">,</span>&nbsp;<span class="ident" id="5101936">err</span><br>
<span class="lineno"></span><span class="op" id="5101940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5101943">//&nbsp;writeSlice&nbsp;writes&nbsp;data[:n]&nbsp;to&nbsp;w&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="5101993">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">55</span><span class="keyword" id="5102029">func</span>&nbsp;<span class="ident" id="5102034">writeSlice</span><span class="op" id="5102044">(</span><span class="ident" id="5102045">w</span>&nbsp;<span class="ident" id="5102047">io</span><span class="op" id="5102049">.</span><span class="ident" id="5102050">Writer</span><span class="op" id="5102056">,</span>&nbsp;<span class="ident" id="5102058">buf</span>&nbsp;<span class="op" id="5102062">[</span><span class="op" id="5102063">]</span><span class="builtintype" id="5102064">byte</span><span class="op" id="5102068">,</span>&nbsp;<span class="ident" id="5102070">data</span>&nbsp;<span class="op" id="5102075">[</span><span class="op" id="5102076">]</span><span class="builtintype" id="5102077">int</span><span class="op" id="5102080">)</span>&nbsp;<span class="op" id="5102082">(</span><span class="ident" id="5102083">n</span>&nbsp;<span class="builtintype" id="5102085">int</span><span class="op" id="5102088">,</span>&nbsp;<span class="ident" id="5102090">err</span>&nbsp;<span class="builtintype" id="5102094">error</span><span class="op" id="5102099">)</span>&nbsp;<span class="op" id="5102101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5102104">//&nbsp;encode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;fit&nbsp;into&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102148">p</span>&nbsp;<span class="op" id="5102150">:=</span>&nbsp;<span class="ident" id="5102153">binary</span><span class="op" id="5102159">.</span><span class="ident" id="5102160">MaxVarintLen64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102176">for</span>&nbsp;<span class="op" id="5102180">;</span>&nbsp;<span class="ident" id="5102182">n</span>&nbsp;<span class="op" id="5102184">&lt;</span>&nbsp;<span class="builtinfunc" id="5102186">len</span><span class="op" id="5102189">(</span><span class="ident" id="5102190">data</span><span class="op" id="5102194">)</span>&nbsp;<span class="op" id="5102196">&amp;&amp;</span>&nbsp;<span class="ident" id="5102199">p</span><span class="op" id="5102200">+</span><span class="ident" id="5102201">binary</span><span class="op" id="5102207">.</span><span class="ident" id="5102208">MaxVarintLen64</span>&nbsp;<span class="op" id="5102223">&lt;=</span>&nbsp;<span class="builtinfunc" id="5102226">len</span><span class="op" id="5102229">(</span><span class="ident" id="5102230">buf</span><span class="op" id="5102233">)</span><span class="op" id="5102234">;</span>&nbsp;<span class="ident" id="5102236">n</span><span class="op" id="5102237">++</span>&nbsp;<span class="op" id="5102240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102244">p</span>&nbsp;<span class="op" id="5102246">+=</span>&nbsp;<span class="ident" id="5102249">binary</span><span class="op" id="5102255">.</span><span class="ident" id="5102256">PutUvarint</span><span class="op" id="5102266">(</span><span class="ident" id="5102267">buf</span><span class="op" id="5102270">[</span><span class="ident" id="5102271">p</span><span class="op" id="5102272">:</span><span class="op" id="5102273">]</span><span class="op" id="5102274">,</span>&nbsp;<span class="ident" id="5102276">uint64</span><span class="op" id="5102282">(</span><span class="ident" id="5102283">data</span><span class="op" id="5102287">[</span><span class="ident" id="5102288">n</span><span class="op" id="5102289">]</span><span class="op" id="5102290">)</span><span class="op" id="5102291">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5102294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5102298">//&nbsp;update&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102321">binary</span><span class="op" id="5102327">.</span><span class="ident" id="5102328">PutVarint</span><span class="op" id="5102337">(</span><span class="ident" id="5102338">buf</span><span class="op" id="5102341">,</span>&nbsp;<span class="ident" id="5102343">int64</span><span class="op" id="5102348">(</span><span class="ident" id="5102349">p</span><span class="op" id="5102350">)</span><span class="op" id="5102351">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5102355">//&nbsp;write&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102372">_</span><span class="op" id="5102373">,</span>&nbsp;<span class="ident" id="5102375">err</span>&nbsp;<span class="op" id="5102379">=</span>&nbsp;<span class="ident" id="5102381">w</span><span class="op" id="5102382">.</span><span class="ident" id="5102383">Write</span><span class="op" id="5102388">(</span><span class="ident" id="5102389">buf</span><span class="op" id="5102392">[</span><span class="num" id="5102393">0</span><span class="op" id="5102394">:</span><span class="ident" id="5102395">p</span><span class="op" id="5102396">]</span><span class="op" id="5102397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102400">return</span><br>
<span class="lineno"></span><span class="op" id="5102407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="5102410">//&nbsp;readSlice&nbsp;reads&nbsp;data[:n]&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="5102460">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="5102495">func</span>&nbsp;<span class="ident" id="5102500">readSlice</span><span class="op" id="5102509">(</span><span class="ident" id="5102510">r</span>&nbsp;<span class="ident" id="5102512">io</span><span class="op" id="5102514">.</span><span class="ident" id="5102515">Reader</span><span class="op" id="5102521">,</span>&nbsp;<span class="ident" id="5102523">buf</span>&nbsp;<span class="op" id="5102527">[</span><span class="op" id="5102528">]</span><span class="builtintype" id="5102529">byte</span><span class="op" id="5102533">,</span>&nbsp;<span class="ident" id="5102535">data</span>&nbsp;<span class="op" id="5102540">[</span><span class="op" id="5102541">]</span><span class="builtintype" id="5102542">int</span><span class="op" id="5102545">)</span>&nbsp;<span class="op" id="5102547">(</span><span class="ident" id="5102548">n</span>&nbsp;<span class="builtintype" id="5102550">int</span><span class="op" id="5102553">,</span>&nbsp;<span class="ident" id="5102555">err</span>&nbsp;<span class="builtintype" id="5102559">error</span><span class="op" id="5102564">)</span>&nbsp;<span class="op" id="5102566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5102569">//&nbsp;read&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102590">var</span>&nbsp;<span class="ident" id="5102594">size</span>&nbsp;<span class="builtintype" id="5102599">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102604">size</span><span class="op" id="5102608">,</span>&nbsp;<span class="ident" id="5102610">err</span>&nbsp;<span class="op" id="5102614">=</span>&nbsp;<span class="ident" id="5102616">readInt</span><span class="op" id="5102623">(</span><span class="ident" id="5102624">r</span><span class="op" id="5102625">,</span>&nbsp;<span class="ident" id="5102627">buf</span><span class="op" id="5102630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102633">if</span>&nbsp;<span class="ident" id="5102636">err</span>&nbsp;<span class="op" id="5102640">!=</span>&nbsp;<span class="ident" id="5102643">nil</span>&nbsp;<span class="op" id="5102647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102651">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5102659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5102663">//&nbsp;read&nbsp;buffer&nbsp;w/o&nbsp;the&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102692">if</span>&nbsp;<span class="ident" id="5102695">_</span><span class="op" id="5102696">,</span>&nbsp;<span class="ident" id="5102698">err</span>&nbsp;<span class="op" id="5102702">=</span>&nbsp;<span class="ident" id="5102704">io</span><span class="op" id="5102706">.</span><span class="ident" id="5102707">ReadFull</span><span class="op" id="5102715">(</span><span class="ident" id="5102716">r</span><span class="op" id="5102717">,</span>&nbsp;<span class="ident" id="5102719">buf</span><span class="op" id="5102722">[</span><span class="ident" id="5102723">binary</span><span class="op" id="5102729">.</span><span class="ident" id="5102730">MaxVarintLen64</span><span class="op" id="5102744">:</span><span class="ident" id="5102745">size</span><span class="op" id="5102749">]</span><span class="op" id="5102750">)</span><span class="op" id="5102751">;</span>&nbsp;<span class="ident" id="5102753">err</span>&nbsp;<span class="op" id="5102757">!=</span>&nbsp;<span class="ident" id="5102760">nil</span>&nbsp;<span class="op" id="5102764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102768">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5102776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5102780">//&nbsp;decode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;present&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102826">for</span>&nbsp;<span class="ident" id="5102830">p</span>&nbsp;<span class="op" id="5102832">:=</span>&nbsp;<span class="ident" id="5102835">binary</span><span class="op" id="5102841">.</span><span class="ident" id="5102842">MaxVarintLen64</span><span class="op" id="5102856">;</span>&nbsp;<span class="ident" id="5102858">p</span>&nbsp;<span class="op" id="5102860">&lt;</span>&nbsp;<span class="ident" id="5102862">size</span><span class="op" id="5102866">;</span>&nbsp;<span class="ident" id="5102868">n</span><span class="op" id="5102869">++</span>&nbsp;<span class="op" id="5102872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102876">x</span><span class="op" id="5102877">,</span>&nbsp;<span class="ident" id="5102879">w</span>&nbsp;<span class="op" id="5102881">:=</span>&nbsp;<span class="ident" id="5102884">binary</span><span class="op" id="5102890">.</span><span class="ident" id="5102891">Uvarint</span><span class="op" id="5102898">(</span><span class="ident" id="5102899">buf</span><span class="op" id="5102902">[</span><span class="ident" id="5102903">p</span><span class="op" id="5102904">:</span><span class="op" id="5102905">]</span><span class="op" id="5102906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102910">data</span><span class="op" id="5102914">[</span><span class="ident" id="5102915">n</span><span class="op" id="5102916">]</span>&nbsp;<span class="op" id="5102918">=</span>&nbsp;<span class="builtintype" id="5102920">int</span><span class="op" id="5102923">(</span><span class="ident" id="5102924">x</span><span class="op" id="5102925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102929">p</span>&nbsp;<span class="op" id="5102931">+=</span>&nbsp;<span class="ident" id="5102934">w</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5102937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102941">return</span><br>
<span class="lineno"></span><span class="op" id="5102948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5102951">const</span>&nbsp;<span class="ident" id="5102957">bufSize</span>&nbsp;<span class="op" id="5102965">=</span>&nbsp;<span class="num" id="5102967">16</span>&nbsp;<span class="op" id="5102970">&lt;&lt;</span>&nbsp;<span class="num" id="5102973">10</span>&nbsp;<span class="comment" id="5102976">//&nbsp;reasonable&nbsp;for&nbsp;BenchmarkSaveRestore</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5103016">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;index&nbsp;from&nbsp;r&nbsp;into&nbsp;x;&nbsp;x&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5103074">func</span>&nbsp;<span class="op" id="5103079">(</span><span class="ident" id="5103080">x</span>&nbsp;<span class="op" id="5103082">*</span><span class="ident" id="5103083">Index</span><span class="op" id="5103088">)</span>&nbsp;<span class="ident" id="5103090">Read</span><span class="op" id="5103094">(</span><span class="ident" id="5103095">r</span>&nbsp;<span class="ident" id="5103097">io</span><span class="op" id="5103099">.</span><span class="ident" id="5103100">Reader</span><span class="op" id="5103106">)</span>&nbsp;<span class="builtintype" id="5103108">error</span>&nbsp;<span class="op" id="5103114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103117">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;reads</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5103142">buf</span>&nbsp;<span class="op" id="5103146">:=</span>&nbsp;<span class="builtinfunc" id="5103149">make</span><span class="op" id="5103153">(</span><span class="op" id="5103154">[</span><span class="op" id="5103155">]</span><span class="builtintype" id="5103156">byte</span><span class="op" id="5103160">,</span>&nbsp;<span class="ident" id="5103162">bufSize</span><span class="op" id="5103169">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103173">//&nbsp;read&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5103189">n</span><span class="op" id="5103190">,</span>&nbsp;<span class="ident" id="5103192">err</span>&nbsp;<span class="op" id="5103196">:=</span>&nbsp;<span class="ident" id="5103199">readInt</span><span class="op" id="5103206">(</span><span class="ident" id="5103207">r</span><span class="op" id="5103208">,</span>&nbsp;<span class="ident" id="5103210">buf</span><span class="op" id="5103213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103216">if</span>&nbsp;<span class="ident" id="5103219">err</span>&nbsp;<span class="op" id="5103223">!=</span>&nbsp;<span class="ident" id="5103226">nil</span>&nbsp;<span class="op" id="5103230">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103234">return</span>&nbsp;<span class="ident" id="5103241">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5103246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103250">//&nbsp;allocate&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103269">if</span>&nbsp;<span class="num" id="5103272">2</span><span class="op" id="5103273">*</span><span class="ident" id="5103274">n</span>&nbsp;<span class="op" id="5103276">&lt;</span>&nbsp;<span class="builtinfunc" id="5103278">cap</span><span class="op" id="5103281">(</span><span class="ident" id="5103282">x</span><span class="op" id="5103283">.</span><span class="ident" id="5103284">data</span><span class="op" id="5103288">)</span>&nbsp;<span class="op" id="5103290">||</span>&nbsp;<span class="builtinfunc" id="5103293">cap</span><span class="op" id="5103296">(</span><span class="ident" id="5103297">x</span><span class="op" id="5103298">.</span><span class="ident" id="5103299">data</span><span class="op" id="5103303">)</span>&nbsp;<span class="op" id="5103305">&lt;</span>&nbsp;<span class="ident" id="5103307">n</span>&nbsp;<span class="op" id="5103309">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103313">//&nbsp;new&nbsp;data&nbsp;is&nbsp;significantly&nbsp;smaller&nbsp;or&nbsp;larger&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103367">//&nbsp;existing&nbsp;buffers&nbsp;-&nbsp;allocate&nbsp;new&nbsp;ones</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5103409">x</span><span class="op" id="5103410">.</span><span class="ident" id="5103411">data</span>&nbsp;<span class="op" id="5103416">=</span>&nbsp;<span class="builtinfunc" id="5103418">make</span><span class="op" id="5103422">(</span><span class="op" id="5103423">[</span><span class="op" id="5103424">]</span><span class="builtintype" id="5103425">byte</span><span class="op" id="5103429">,</span>&nbsp;<span class="ident" id="5103431">n</span><span class="op" id="5103432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5103436">x</span><span class="op" id="5103437">.</span><span class="ident" id="5103438">sa</span>&nbsp;<span class="op" id="5103441">=</span>&nbsp;<span class="builtinfunc" id="5103443">make</span><span class="op" id="5103447">(</span><span class="op" id="5103448">[</span><span class="op" id="5103449">]</span><span class="builtintype" id="5103450">int</span><span class="op" id="5103453">,</span>&nbsp;<span class="ident" id="5103455">n</span><span class="op" id="5103456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5103459">}</span>&nbsp;<span class="keyword" id="5103461">else</span>&nbsp;<span class="op" id="5103466">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103470">//&nbsp;re-use&nbsp;existing&nbsp;buffers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5103499">x</span><span class="op" id="5103500">.</span><span class="ident" id="5103501">data</span>&nbsp;<span class="op" id="5103506">=</span>&nbsp;<span class="ident" id="5103508">x</span><span class="op" id="5103509">.</span><span class="ident" id="5103510">data</span><span class="op" id="5103514">[</span><span class="num" id="5103515">0</span><span class="op" id="5103516">:</span><span class="ident" id="5103517">n</span><span class="op" id="5103518">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5103522">x</span><span class="op" id="5103523">.</span><span class="ident" id="5103524">sa</span>&nbsp;<span class="op" id="5103527">=</span>&nbsp;<span class="ident" id="5103529">x</span><span class="op" id="5103530">.</span><span class="ident" id="5103531">sa</span><span class="op" id="5103533">[</span><span class="num" id="5103534">0</span><span class="op" id="5103535">:</span><span class="ident" id="5103536">n</span><span class="op" id="5103537">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5103540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103544">//&nbsp;read&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103558">if</span>&nbsp;<span class="ident" id="5103561">_</span><span class="op" id="5103562">,</span>&nbsp;<span class="ident" id="5103564">err</span>&nbsp;<span class="op" id="5103568">:=</span>&nbsp;<span class="ident" id="5103571">io</span><span class="op" id="5103573">.</span><span class="ident" id="5103574">ReadFull</span><span class="op" id="5103582">(</span><span class="ident" id="5103583">r</span><span class="op" id="5103584">,</span>&nbsp;<span class="ident" id="5103586">x</span><span class="op" id="5103587">.</span><span class="ident" id="5103588">data</span><span class="op" id="5103592">)</span><span class="op" id="5103593">;</span>&nbsp;<span class="ident" id="5103595">err</span>&nbsp;<span class="op" id="5103599">!=</span>&nbsp;<span class="ident" id="5103602">nil</span>&nbsp;<span class="op" id="5103606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103610">return</span>&nbsp;<span class="ident" id="5103617">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5103622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103626">//&nbsp;read&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103641">for</span>&nbsp;<span class="ident" id="5103645">sa</span>&nbsp;<span class="op" id="5103648">:=</span>&nbsp;<span class="ident" id="5103651">x</span><span class="op" id="5103652">.</span><span class="ident" id="5103653">sa</span><span class="op" id="5103655">;</span>&nbsp;<span class="builtinfunc" id="5103657">len</span><span class="op" id="5103660">(</span><span class="ident" id="5103661">sa</span><span class="op" id="5103663">)</span>&nbsp;<span class="op" id="5103665">&gt;</span>&nbsp;<span class="num" id="5103667">0</span><span class="op" id="5103668">;</span>&nbsp;<span class="op" id="5103670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5103674">n</span><span class="op" id="5103675">,</span>&nbsp;<span class="ident" id="5103677">err</span>&nbsp;<span class="op" id="5103681">:=</span>&nbsp;<span class="ident" id="5103684">readSlice</span><span class="op" id="5103693">(</span><span class="ident" id="5103694">r</span><span class="op" id="5103695">,</span>&nbsp;<span class="ident" id="5103697">buf</span><span class="op" id="5103700">,</span>&nbsp;<span class="ident" id="5103702">sa</span><span class="op" id="5103704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103708">if</span>&nbsp;<span class="ident" id="5103711">err</span>&nbsp;<span class="op" id="5103715">!=</span>&nbsp;<span class="ident" id="5103718">nil</span>&nbsp;<span class="op" id="5103722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103727">return</span>&nbsp;<span class="ident" id="5103734">err</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5103740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5103744">sa</span>&nbsp;<span class="op" id="5103747">=</span>&nbsp;<span class="ident" id="5103749">sa</span><span class="op" id="5103751">[</span><span class="ident" id="5103752">n</span><span class="op" id="5103753">:</span><span class="op" id="5103754">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5103757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103760">return</span>&nbsp;<span class="ident" id="5103767">nil</span><br>
<span class="lineno"></span><span class="op" id="5103771">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="5103774">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;index&nbsp;x&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5103808">func</span>&nbsp;<span class="op" id="5103813">(</span><span class="ident" id="5103814">x</span>&nbsp;<span class="op" id="5103816">*</span><span class="ident" id="5103817">Index</span><span class="op" id="5103822">)</span>&nbsp;<span class="ident" id="5103824">Write</span><span class="op" id="5103829">(</span><span class="ident" id="5103830">w</span>&nbsp;<span class="ident" id="5103832">io</span><span class="op" id="5103834">.</span><span class="ident" id="5103835">Writer</span><span class="op" id="5103841">)</span>&nbsp;<span class="builtintype" id="5103843">error</span>&nbsp;<span class="op" id="5103849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103852">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5103878">buf</span>&nbsp;<span class="op" id="5103882">:=</span>&nbsp;<span class="builtinfunc" id="5103885">make</span><span class="op" id="5103889">(</span><span class="op" id="5103890">[</span><span class="op" id="5103891">]</span><span class="builtintype" id="5103892">byte</span><span class="op" id="5103896">,</span>&nbsp;<span class="ident" id="5103898">bufSize</span><span class="op" id="5103905">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103909">//&nbsp;write&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103926">if</span>&nbsp;<span class="ident" id="5103929">err</span>&nbsp;<span class="op" id="5103933">:=</span>&nbsp;<span class="ident" id="5103936">writeInt</span><span class="op" id="5103944">(</span><span class="ident" id="5103945">w</span><span class="op" id="5103946">,</span>&nbsp;<span class="ident" id="5103948">buf</span><span class="op" id="5103951">,</span>&nbsp;<span class="builtinfunc" id="5103953">len</span><span class="op" id="5103956">(</span><span class="ident" id="5103957">x</span><span class="op" id="5103958">.</span><span class="ident" id="5103959">data</span><span class="op" id="5103963">)</span><span class="op" id="5103964">)</span><span class="op" id="5103965">;</span>&nbsp;<span class="ident" id="5103967">err</span>&nbsp;<span class="op" id="5103971">!=</span>&nbsp;<span class="ident" id="5103974">nil</span>&nbsp;<span class="op" id="5103978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103982">return</span>&nbsp;<span class="ident" id="5103989">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5103994">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103998">//&nbsp;write&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104013">if</span>&nbsp;<span class="ident" id="5104016">_</span><span class="op" id="5104017">,</span>&nbsp;<span class="ident" id="5104019">err</span>&nbsp;<span class="op" id="5104023">:=</span>&nbsp;<span class="ident" id="5104026">w</span><span class="op" id="5104027">.</span><span class="ident" id="5104028">Write</span><span class="op" id="5104033">(</span><span class="ident" id="5104034">x</span><span class="op" id="5104035">.</span><span class="ident" id="5104036">data</span><span class="op" id="5104040">)</span><span class="op" id="5104041">;</span>&nbsp;<span class="ident" id="5104043">err</span>&nbsp;<span class="op" id="5104047">!=</span>&nbsp;<span class="ident" id="5104050">nil</span>&nbsp;<span class="op" id="5104054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104058">return</span>&nbsp;<span class="ident" id="5104065">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5104070">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5104074">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104090">for</span>&nbsp;<span class="ident" id="5104094">sa</span>&nbsp;<span class="op" id="5104097">:=</span>&nbsp;<span class="ident" id="5104100">x</span><span class="op" id="5104101">.</span><span class="ident" id="5104102">sa</span><span class="op" id="5104104">;</span>&nbsp;<span class="builtinfunc" id="5104106">len</span><span class="op" id="5104109">(</span><span class="ident" id="5104110">sa</span><span class="op" id="5104112">)</span>&nbsp;<span class="op" id="5104114">&gt;</span>&nbsp;<span class="num" id="5104116">0</span><span class="op" id="5104117">;</span>&nbsp;<span class="op" id="5104119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104123">n</span><span class="op" id="5104124">,</span>&nbsp;<span class="ident" id="5104126">err</span>&nbsp;<span class="op" id="5104130">:=</span>&nbsp;<span class="ident" id="5104133">writeSlice</span><span class="op" id="5104143">(</span><span class="ident" id="5104144">w</span><span class="op" id="5104145">,</span>&nbsp;<span class="ident" id="5104147">buf</span><span class="op" id="5104150">,</span>&nbsp;<span class="ident" id="5104152">sa</span><span class="op" id="5104154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104158">if</span>&nbsp;<span class="ident" id="5104161">err</span>&nbsp;<span class="op" id="5104165">!=</span>&nbsp;<span class="ident" id="5104168">nil</span>&nbsp;<span class="op" id="5104172">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104177">return</span>&nbsp;<span class="ident" id="5104184">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5104190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104194">sa</span>&nbsp;<span class="op" id="5104197">=</span>&nbsp;<span class="ident" id="5104199">sa</span><span class="op" id="5104201">[</span><span class="ident" id="5104202">n</span><span class="op" id="5104203">:</span><span class="op" id="5104204">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5104207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104210">return</span>&nbsp;<span class="ident" id="5104217">nil</span><br>
<span class="lineno">160</span><span class="op" id="5104221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5104224">//&nbsp;Bytes&nbsp;returns&nbsp;the&nbsp;data&nbsp;over&nbsp;which&nbsp;the&nbsp;index&nbsp;was&nbsp;created.</span><br>
<span class="lineno"></span><span class="comment" id="5104284">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="comment" id="5104312">//</span><br>
<span class="lineno">165</span><span class="keyword" id="5104315">func</span>&nbsp;<span class="op" id="5104320">(</span><span class="ident" id="5104321">x</span>&nbsp;<span class="op" id="5104323">*</span><span class="ident" id="5104324">Index</span><span class="op" id="5104329">)</span>&nbsp;<span class="ident" id="5104331">Bytes</span><span class="op" id="5104336">(</span><span class="op" id="5104337">)</span>&nbsp;<span class="op" id="5104339">[</span><span class="op" id="5104340">]</span><span class="builtintype" id="5104341">byte</span>&nbsp;<span class="op" id="5104346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104349">return</span>&nbsp;<span class="ident" id="5104356">x</span><span class="op" id="5104357">.</span><span class="ident" id="5104358">data</span><br>
<span class="lineno"></span><span class="op" id="5104363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5104366">func</span>&nbsp;<span class="op" id="5104371">(</span><span class="ident" id="5104372">x</span>&nbsp;<span class="op" id="5104374">*</span><span class="ident" id="5104375">Index</span><span class="op" id="5104380">)</span>&nbsp;<span class="ident" id="5104382">at</span><span class="op" id="5104384">(</span><span class="ident" id="5104385">i</span>&nbsp;<span class="builtintype" id="5104387">int</span><span class="op" id="5104390">)</span>&nbsp;<span class="op" id="5104392">[</span><span class="op" id="5104393">]</span><span class="builtintype" id="5104394">byte</span>&nbsp;<span class="op" id="5104399">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104402">return</span>&nbsp;<span class="ident" id="5104409">x</span><span class="op" id="5104410">.</span><span class="ident" id="5104411">data</span><span class="op" id="5104415">[</span><span class="ident" id="5104416">x</span><span class="op" id="5104417">.</span><span class="ident" id="5104418">sa</span><span class="op" id="5104420">[</span><span class="ident" id="5104421">i</span><span class="op" id="5104422">]</span><span class="op" id="5104423">:</span><span class="op" id="5104424">]</span><br>
<span class="lineno"></span><span class="op" id="5104426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5104429">//&nbsp;lookupAll&nbsp;returns&nbsp;a&nbsp;slice&nbsp;into&nbsp;the&nbsp;matching&nbsp;region&nbsp;of&nbsp;the&nbsp;index.</span><br>
<span class="lineno"></span><span class="comment" id="5104497">//&nbsp;The&nbsp;runtime&nbsp;is&nbsp;O(log(N)*len(s)).</span><br>
<span class="lineno">175</span><span class="keyword" id="5104533">func</span>&nbsp;<span class="op" id="5104538">(</span><span class="ident" id="5104539">x</span>&nbsp;<span class="op" id="5104541">*</span><span class="ident" id="5104542">Index</span><span class="op" id="5104547">)</span>&nbsp;<span class="ident" id="5104549">lookupAll</span><span class="op" id="5104558">(</span><span class="ident" id="5104559">s</span>&nbsp;<span class="op" id="5104561">[</span><span class="op" id="5104562">]</span><span class="builtintype" id="5104563">byte</span><span class="op" id="5104567">)</span>&nbsp;<span class="op" id="5104569">[</span><span class="op" id="5104570">]</span><span class="builtintype" id="5104571">int</span>&nbsp;<span class="op" id="5104575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5104578">//&nbsp;find&nbsp;matching&nbsp;suffix&nbsp;index&nbsp;range&nbsp;[i:j]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5104621">//&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;where&nbsp;s&nbsp;would&nbsp;be&nbsp;the&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104674">i</span>&nbsp;<span class="op" id="5104676">:=</span>&nbsp;<span class="ident" id="5104679">sort</span><span class="op" id="5104683">.</span><span class="ident" id="5104684">Search</span><span class="op" id="5104690">(</span><span class="builtinfunc" id="5104691">len</span><span class="op" id="5104694">(</span><span class="ident" id="5104695">x</span><span class="op" id="5104696">.</span><span class="ident" id="5104697">sa</span><span class="op" id="5104699">)</span><span class="op" id="5104700">,</span>&nbsp;<span class="keyword" id="5104702">func</span><span class="op" id="5104706">(</span><span class="ident" id="5104707">i</span>&nbsp;<span class="builtintype" id="5104709">int</span><span class="op" id="5104712">)</span>&nbsp;<span class="builtintype" id="5104714">bool</span>&nbsp;<span class="op" id="5104719">{</span>&nbsp;<span class="keyword" id="5104721">return</span>&nbsp;<span class="ident" id="5104728">bytes</span><span class="op" id="5104733">.</span><span class="ident" id="5104734">Compare</span><span class="op" id="5104741">(</span><span class="ident" id="5104742">x</span><span class="op" id="5104743">.</span><span class="ident" id="5104744">at</span><span class="op" id="5104746">(</span><span class="ident" id="5104747">i</span><span class="op" id="5104748">)</span><span class="op" id="5104749">,</span>&nbsp;<span class="ident" id="5104751">s</span><span class="op" id="5104752">)</span>&nbsp;<span class="op" id="5104754">&gt;=</span>&nbsp;<span class="num" id="5104757">0</span>&nbsp;<span class="op" id="5104759">}</span><span class="op" id="5104760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5104763">//&nbsp;starting&nbsp;at&nbsp;i,&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;at&nbsp;which&nbsp;s&nbsp;is&nbsp;not&nbsp;a&nbsp;prefix</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104830">j</span>&nbsp;<span class="op" id="5104832">:=</span>&nbsp;<span class="ident" id="5104835">i</span>&nbsp;<span class="op" id="5104837">+</span>&nbsp;<span class="ident" id="5104839">sort</span><span class="op" id="5104843">.</span><span class="ident" id="5104844">Search</span><span class="op" id="5104850">(</span><span class="builtinfunc" id="5104851">len</span><span class="op" id="5104854">(</span><span class="ident" id="5104855">x</span><span class="op" id="5104856">.</span><span class="ident" id="5104857">sa</span><span class="op" id="5104859">)</span><span class="op" id="5104860">-</span><span class="ident" id="5104861">i</span><span class="op" id="5104862">,</span>&nbsp;<span class="keyword" id="5104864">func</span><span class="op" id="5104868">(</span><span class="ident" id="5104869">j</span>&nbsp;<span class="builtintype" id="5104871">int</span><span class="op" id="5104874">)</span>&nbsp;<span class="builtintype" id="5104876">bool</span>&nbsp;<span class="op" id="5104881">{</span>&nbsp;<span class="keyword" id="5104883">return</span>&nbsp;<span class="op" id="5104890">!</span><span class="ident" id="5104891">bytes</span><span class="op" id="5104896">.</span><span class="ident" id="5104897">HasPrefix</span><span class="op" id="5104906">(</span><span class="ident" id="5104907">x</span><span class="op" id="5104908">.</span><span class="ident" id="5104909">at</span><span class="op" id="5104911">(</span><span class="ident" id="5104912">j</span><span class="op" id="5104913">+</span><span class="ident" id="5104914">i</span><span class="op" id="5104915">)</span><span class="op" id="5104916">,</span>&nbsp;<span class="ident" id="5104918">s</span><span class="op" id="5104919">)</span>&nbsp;<span class="op" id="5104921">}</span><span class="op" id="5104922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104925">return</span>&nbsp;<span class="ident" id="5104932">x</span><span class="op" id="5104933">.</span><span class="ident" id="5104934">sa</span><span class="op" id="5104936">[</span><span class="ident" id="5104937">i</span><span class="op" id="5104938">:</span><span class="ident" id="5104939">j</span><span class="op" id="5104940">]</span><br>
<span class="lineno"></span><span class="op" id="5104942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5104945">//&nbsp;Lookup&nbsp;returns&nbsp;an&nbsp;unsorted&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;n&nbsp;indices&nbsp;where&nbsp;the&nbsp;byte&nbsp;string&nbsp;s</span><br>
<span class="lineno">185</span><span class="comment" id="5105025">//&nbsp;occurs&nbsp;in&nbsp;the&nbsp;indexed&nbsp;data.&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;occurrences&nbsp;are&nbsp;returned.</span><br>
<span class="lineno"></span><span class="comment" id="5105096">//&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;s&nbsp;is&nbsp;empty,&nbsp;s&nbsp;is&nbsp;not&nbsp;found,&nbsp;or&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="5105159">//&nbsp;Lookup&nbsp;time&nbsp;is&nbsp;O(log(N)*len(s)&nbsp;+&nbsp;len(result))&nbsp;where&nbsp;N&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5105223">//&nbsp;size&nbsp;of&nbsp;the&nbsp;indexed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5105252">//</span><br>
<span class="lineno">190</span><span class="keyword" id="5105255">func</span>&nbsp;<span class="op" id="5105260">(</span><span class="ident" id="5105261">x</span>&nbsp;<span class="op" id="5105263">*</span><span class="ident" id="5105264">Index</span><span class="op" id="5105269">)</span>&nbsp;<span class="ident" id="5105271">Lookup</span><span class="op" id="5105277">(</span><span class="ident" id="5105278">s</span>&nbsp;<span class="op" id="5105280">[</span><span class="op" id="5105281">]</span><span class="builtintype" id="5105282">byte</span><span class="op" id="5105286">,</span>&nbsp;<span class="ident" id="5105288">n</span>&nbsp;<span class="builtintype" id="5105290">int</span><span class="op" id="5105293">)</span>&nbsp;<span class="op" id="5105295">(</span><span class="ident" id="5105296">result</span>&nbsp;<span class="op" id="5105303">[</span><span class="op" id="5105304">]</span><span class="builtintype" id="5105305">int</span><span class="op" id="5105308">)</span>&nbsp;<span class="op" id="5105310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5105313">if</span>&nbsp;<span class="builtinfunc" id="5105316">len</span><span class="op" id="5105319">(</span><span class="ident" id="5105320">s</span><span class="op" id="5105321">)</span>&nbsp;<span class="op" id="5105323">&gt;</span>&nbsp;<span class="num" id="5105325">0</span>&nbsp;<span class="op" id="5105327">&amp;&amp;</span>&nbsp;<span class="ident" id="5105330">n</span>&nbsp;<span class="op" id="5105332">!=</span>&nbsp;<span class="num" id="5105335">0</span>&nbsp;<span class="op" id="5105337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105341">matches</span>&nbsp;<span class="op" id="5105349">:=</span>&nbsp;<span class="ident" id="5105352">x</span><span class="op" id="5105353">.</span><span class="ident" id="5105354">lookupAll</span><span class="op" id="5105363">(</span><span class="ident" id="5105364">s</span><span class="op" id="5105365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5105369">if</span>&nbsp;<span class="ident" id="5105372">n</span>&nbsp;<span class="op" id="5105374">&lt;</span>&nbsp;<span class="num" id="5105376">0</span>&nbsp;<span class="op" id="5105378">||</span>&nbsp;<span class="builtinfunc" id="5105381">len</span><span class="op" id="5105384">(</span><span class="ident" id="5105385">matches</span><span class="op" id="5105392">)</span>&nbsp;<span class="op" id="5105394">&lt;</span>&nbsp;<span class="ident" id="5105396">n</span>&nbsp;<span class="op" id="5105398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105403">n</span>&nbsp;<span class="op" id="5105405">=</span>&nbsp;<span class="builtinfunc" id="5105407">len</span><span class="op" id="5105410">(</span><span class="ident" id="5105411">matches</span><span class="op" id="5105418">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5105422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5105426">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(matches)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5105454">if</span>&nbsp;<span class="ident" id="5105457">n</span>&nbsp;<span class="op" id="5105459">&gt;</span>&nbsp;<span class="num" id="5105461">0</span>&nbsp;<span class="op" id="5105463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105468">result</span>&nbsp;<span class="op" id="5105475">=</span>&nbsp;<span class="builtinfunc" id="5105477">make</span><span class="op" id="5105481">(</span><span class="op" id="5105482">[</span><span class="op" id="5105483">]</span><span class="builtintype" id="5105484">int</span><span class="op" id="5105487">,</span>&nbsp;<span class="ident" id="5105489">n</span><span class="op" id="5105490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5105495">copy</span><span class="op" id="5105499">(</span><span class="ident" id="5105500">result</span><span class="op" id="5105506">,</span>&nbsp;<span class="ident" id="5105508">matches</span><span class="op" id="5105515">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5105519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5105522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5105525">return</span><br>
<span class="lineno"></span><span class="op" id="5105532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5105535">//&nbsp;FindAllIndex&nbsp;returns&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;non-overlapping&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5105607">//&nbsp;regular&nbsp;expression&nbsp;r,&nbsp;where&nbsp;a&nbsp;match&nbsp;is&nbsp;a&nbsp;pair&nbsp;of&nbsp;indices&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="5105678">//&nbsp;the&nbsp;matched&nbsp;slice&nbsp;of&nbsp;x.Bytes().&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;matches&nbsp;are&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="5105748">//&nbsp;in&nbsp;successive&nbsp;order.&nbsp;Otherwise,&nbsp;at&nbsp;most&nbsp;n&nbsp;matches&nbsp;are&nbsp;returned&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5105818">//&nbsp;they&nbsp;may&nbsp;not&nbsp;be&nbsp;successive.&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;matches,</span><br>
<span class="lineno">210</span><span class="comment" id="5105892">//&nbsp;or&nbsp;if&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="5105909">//</span><br>
<span class="lineno"></span><span class="keyword" id="5105912">func</span>&nbsp;<span class="op" id="5105917">(</span><span class="ident" id="5105918">x</span>&nbsp;<span class="op" id="5105920">*</span><span class="ident" id="5105921">Index</span><span class="op" id="5105926">)</span>&nbsp;<span class="ident" id="5105928">FindAllIndex</span><span class="op" id="5105940">(</span><span class="ident" id="5105941">r</span>&nbsp;<span class="op" id="5105943">*</span><span class="ident" id="5105944">regexp</span><span class="op" id="5105950">.</span><span class="ident" id="5105951">Regexp</span><span class="op" id="5105957">,</span>&nbsp;<span class="ident" id="5105959">n</span>&nbsp;<span class="builtintype" id="5105961">int</span><span class="op" id="5105964">)</span>&nbsp;<span class="op" id="5105966">(</span><span class="ident" id="5105967">result</span>&nbsp;<span class="op" id="5105974">[</span><span class="op" id="5105975">]</span><span class="op" id="5105976">[</span><span class="op" id="5105977">]</span><span class="builtintype" id="5105978">int</span><span class="op" id="5105981">)</span>&nbsp;<span class="op" id="5105983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5105986">//&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix&nbsp;is&nbsp;used&nbsp;to&nbsp;determine&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5106047">//&nbsp;match&nbsp;start&nbsp;indices&nbsp;with&nbsp;Lookup</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106083">prefix</span><span class="op" id="5106089">,</span>&nbsp;<span class="ident" id="5106091">complete</span>&nbsp;<span class="op" id="5106100">:=</span>&nbsp;<span class="ident" id="5106103">r</span><span class="op" id="5106104">.</span><span class="ident" id="5106105">LiteralPrefix</span><span class="op" id="5106118">(</span><span class="op" id="5106119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106122">lit</span>&nbsp;<span class="op" id="5106126">:=</span>&nbsp;<span class="op" id="5106129">[</span><span class="op" id="5106130">]</span><span class="builtintype" id="5106131">byte</span><span class="op" id="5106135">(</span><span class="ident" id="5106136">prefix</span><span class="op" id="5106142">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5106146">//&nbsp;worst-case&nbsp;scenario:&nbsp;no&nbsp;literal&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106189">if</span>&nbsp;<span class="ident" id="5106192">prefix</span>&nbsp;<span class="op" id="5106199">==</span>&nbsp;<span class="string" id="5106202">&#34;&#34;</span>&nbsp;<span class="op" id="5106205">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106209">return</span>&nbsp;<span class="ident" id="5106216">r</span><span class="op" id="5106217">.</span><span class="ident" id="5106218">FindAllIndex</span><span class="op" id="5106230">(</span><span class="ident" id="5106231">x</span><span class="op" id="5106232">.</span><span class="ident" id="5106233">data</span><span class="op" id="5106237">,</span>&nbsp;<span class="ident" id="5106239">n</span><span class="op" id="5106240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5106243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5106247">//&nbsp;if&nbsp;regexp&nbsp;is&nbsp;a&nbsp;literal&nbsp;just&nbsp;use&nbsp;Lookup&nbsp;and&nbsp;convert&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5106306">//&nbsp;result&nbsp;into&nbsp;match&nbsp;pairs</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106334">if</span>&nbsp;<span class="ident" id="5106337">complete</span>&nbsp;<span class="op" id="5106346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5106350">//&nbsp;Lookup&nbsp;returns&nbsp;indices&nbsp;that&nbsp;may&nbsp;belong&nbsp;to&nbsp;overlapping&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5106418">//&nbsp;After&nbsp;eliminating&nbsp;them,&nbsp;we&nbsp;may&nbsp;end&nbsp;up&nbsp;with&nbsp;fewer&nbsp;than&nbsp;n&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5106488">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;enough&nbsp;at&nbsp;the&nbsp;end,&nbsp;redo&nbsp;the&nbsp;search&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5106553">//&nbsp;increased&nbsp;value&nbsp;n1,&nbsp;but&nbsp;only&nbsp;if&nbsp;Lookup&nbsp;returned&nbsp;all&nbsp;the&nbsp;requested</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5106624">//&nbsp;indices&nbsp;in&nbsp;the&nbsp;first&nbsp;place&nbsp;(if&nbsp;it&nbsp;returned&nbsp;fewer&nbsp;than&nbsp;that&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5106693">//&nbsp;there&nbsp;cannot&nbsp;be&nbsp;more).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106721">for</span>&nbsp;<span class="ident" id="5106725">n1</span>&nbsp;<span class="op" id="5106728">:=</span>&nbsp;<span class="ident" id="5106731">n</span><span class="op" id="5106732">;</span>&nbsp;<span class="op" id="5106734">;</span>&nbsp;<span class="ident" id="5106736">n1</span>&nbsp;<span class="op" id="5106739">+=</span>&nbsp;<span class="num" id="5106742">2</span>&nbsp;<span class="op" id="5106744">*</span>&nbsp;<span class="op" id="5106746">(</span><span class="ident" id="5106747">n</span>&nbsp;<span class="op" id="5106749">-</span>&nbsp;<span class="builtinfunc" id="5106751">len</span><span class="op" id="5106754">(</span><span class="ident" id="5106755">result</span><span class="op" id="5106761">)</span><span class="op" id="5106762">)</span>&nbsp;<span class="comment" id="5106764">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="5106782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106787">indices</span>&nbsp;<span class="op" id="5106795">:=</span>&nbsp;<span class="ident" id="5106798">x</span><span class="op" id="5106799">.</span><span class="ident" id="5106800">Lookup</span><span class="op" id="5106806">(</span><span class="ident" id="5106807">lit</span><span class="op" id="5106810">,</span>&nbsp;<span class="ident" id="5106812">n1</span><span class="op" id="5106814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106819">if</span>&nbsp;<span class="builtinfunc" id="5106822">len</span><span class="op" id="5106825">(</span><span class="ident" id="5106826">indices</span><span class="op" id="5106833">)</span>&nbsp;<span class="op" id="5106835">==</span>&nbsp;<span class="num" id="5106838">0</span>&nbsp;<span class="op" id="5106840">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106846">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5106856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106861">sort</span><span class="op" id="5106865">.</span><span class="ident" id="5106866">Ints</span><span class="op" id="5106870">(</span><span class="ident" id="5106871">indices</span><span class="op" id="5106878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106883">pairs</span>&nbsp;<span class="op" id="5106889">:=</span>&nbsp;<span class="builtinfunc" id="5106892">make</span><span class="op" id="5106896">(</span><span class="op" id="5106897">[</span><span class="op" id="5106898">]</span><span class="builtintype" id="5106899">int</span><span class="op" id="5106902">,</span>&nbsp;<span class="num" id="5106904">2</span><span class="op" id="5106905">*</span><span class="builtinfunc" id="5106906">len</span><span class="op" id="5106909">(</span><span class="ident" id="5106910">indices</span><span class="op" id="5106917">)</span><span class="op" id="5106918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106923">result</span>&nbsp;<span class="op" id="5106930">=</span>&nbsp;<span class="builtinfunc" id="5106932">make</span><span class="op" id="5106936">(</span><span class="op" id="5106937">[</span><span class="op" id="5106938">]</span><span class="op" id="5106939">[</span><span class="op" id="5106940">]</span><span class="builtintype" id="5106941">int</span><span class="op" id="5106944">,</span>&nbsp;<span class="builtinfunc" id="5106946">len</span><span class="op" id="5106949">(</span><span class="ident" id="5106950">indices</span><span class="op" id="5106957">)</span><span class="op" id="5106958">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106963">count</span>&nbsp;<span class="op" id="5106969">:=</span>&nbsp;<span class="num" id="5106972">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106977">prev</span>&nbsp;<span class="op" id="5106982">:=</span>&nbsp;<span class="num" id="5106985">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106990">for</span>&nbsp;<span class="ident" id="5106994">_</span><span class="op" id="5106995">,</span>&nbsp;<span class="ident" id="5106997">i</span>&nbsp;<span class="op" id="5106999">:=</span>&nbsp;<span class="keyword" id="5107002">range</span>&nbsp;<span class="ident" id="5107008">indices</span>&nbsp;<span class="op" id="5107016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107022">if</span>&nbsp;<span class="ident" id="5107025">count</span>&nbsp;<span class="op" id="5107031">==</span>&nbsp;<span class="ident" id="5107034">n</span>&nbsp;<span class="op" id="5107036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107043">break</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5107059">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107112">if</span>&nbsp;<span class="ident" id="5107115">prev</span>&nbsp;<span class="op" id="5107120">&lt;=</span>&nbsp;<span class="ident" id="5107123">i</span>&nbsp;<span class="op" id="5107125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107132">j</span>&nbsp;<span class="op" id="5107134">:=</span>&nbsp;<span class="num" id="5107137">2</span>&nbsp;<span class="op" id="5107139">*</span>&nbsp;<span class="ident" id="5107141">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107152">pairs</span><span class="op" id="5107157">[</span><span class="ident" id="5107158">j</span><span class="op" id="5107159">+</span><span class="num" id="5107160">0</span><span class="op" id="5107161">]</span>&nbsp;<span class="op" id="5107163">=</span>&nbsp;<span class="ident" id="5107165">i</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107172">pairs</span><span class="op" id="5107177">[</span><span class="ident" id="5107178">j</span><span class="op" id="5107179">+</span><span class="num" id="5107180">1</span><span class="op" id="5107181">]</span>&nbsp;<span class="op" id="5107183">=</span>&nbsp;<span class="ident" id="5107185">i</span>&nbsp;<span class="op" id="5107187">+</span>&nbsp;<span class="builtinfunc" id="5107189">len</span><span class="op" id="5107192">(</span><span class="ident" id="5107193">lit</span><span class="op" id="5107196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107203">result</span><span class="op" id="5107209">[</span><span class="ident" id="5107210">count</span><span class="op" id="5107215">]</span>&nbsp;<span class="op" id="5107217">=</span>&nbsp;<span class="ident" id="5107219">pairs</span><span class="op" id="5107224">[</span><span class="ident" id="5107225">j</span>&nbsp;<span class="op" id="5107227">:</span>&nbsp;<span class="ident" id="5107229">j</span><span class="op" id="5107230">+</span><span class="num" id="5107231">2</span><span class="op" id="5107232">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107239">count</span><span class="op" id="5107244">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107252">prev</span>&nbsp;<span class="op" id="5107257">=</span>&nbsp;<span class="ident" id="5107259">i</span>&nbsp;<span class="op" id="5107261">+</span>&nbsp;<span class="builtinfunc" id="5107263">len</span><span class="op" id="5107266">(</span><span class="ident" id="5107267">lit</span><span class="op" id="5107270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107276">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107286">result</span>&nbsp;<span class="op" id="5107293">=</span>&nbsp;<span class="ident" id="5107295">result</span><span class="op" id="5107301">[</span><span class="num" id="5107302">0</span><span class="op" id="5107303">:</span><span class="ident" id="5107304">count</span><span class="op" id="5107309">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107314">if</span>&nbsp;<span class="builtinfunc" id="5107317">len</span><span class="op" id="5107320">(</span><span class="ident" id="5107321">result</span><span class="op" id="5107327">)</span>&nbsp;<span class="op" id="5107329">&gt;=</span>&nbsp;<span class="ident" id="5107332">n</span>&nbsp;<span class="op" id="5107334">||</span>&nbsp;<span class="builtinfunc" id="5107337">len</span><span class="op" id="5107340">(</span><span class="ident" id="5107341">indices</span><span class="op" id="5107348">)</span>&nbsp;<span class="op" id="5107350">!=</span>&nbsp;<span class="ident" id="5107353">n1</span>&nbsp;<span class="op" id="5107356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5107362">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5107421">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107455">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107472">if</span>&nbsp;<span class="builtinfunc" id="5107475">len</span><span class="op" id="5107478">(</span><span class="ident" id="5107479">result</span><span class="op" id="5107485">)</span>&nbsp;<span class="op" id="5107487">==</span>&nbsp;<span class="num" id="5107490">0</span>&nbsp;<span class="op" id="5107492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107497">result</span>&nbsp;<span class="op" id="5107504">=</span>&nbsp;<span class="ident" id="5107506">nil</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107516">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5107528">//&nbsp;regexp&nbsp;has&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix;&nbsp;Lookup(lit)&nbsp;computes</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5107592">//&nbsp;the&nbsp;indices&nbsp;of&nbsp;possible&nbsp;complete&nbsp;matches;&nbsp;use&nbsp;these&nbsp;as&nbsp;starting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5107660">//&nbsp;points&nbsp;for&nbsp;anchored&nbsp;searches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5107693">//&nbsp;(regexp&nbsp;&#34;^&#34;&nbsp;matches&nbsp;beginning&nbsp;of&nbsp;input,&nbsp;not&nbsp;beginning&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107760">r</span>&nbsp;<span class="op" id="5107762">=</span>&nbsp;<span class="ident" id="5107764">regexp</span><span class="op" id="5107770">.</span><span class="ident" id="5107771">MustCompile</span><span class="op" id="5107782">(</span><span class="string" id="5107783">&#34;^&#34;</span>&nbsp;<span class="op" id="5107787">+</span>&nbsp;<span class="ident" id="5107789">r</span><span class="op" id="5107790">.</span><span class="ident" id="5107791">String</span><span class="op" id="5107797">(</span><span class="op" id="5107798">)</span><span class="op" id="5107799">)</span>&nbsp;<span class="comment" id="5107801">//&nbsp;compiles&nbsp;because&nbsp;r&nbsp;compiled</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5107834">//&nbsp;same&nbsp;comment&nbsp;about&nbsp;Lookup&nbsp;applies&nbsp;here&nbsp;as&nbsp;in&nbsp;the&nbsp;loop&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107898">for</span>&nbsp;<span class="ident" id="5107902">n1</span>&nbsp;<span class="op" id="5107905">:=</span>&nbsp;<span class="ident" id="5107908">n</span><span class="op" id="5107909">;</span>&nbsp;<span class="op" id="5107911">;</span>&nbsp;<span class="ident" id="5107913">n1</span>&nbsp;<span class="op" id="5107916">+=</span>&nbsp;<span class="num" id="5107919">2</span>&nbsp;<span class="op" id="5107921">*</span>&nbsp;<span class="op" id="5107923">(</span><span class="ident" id="5107924">n</span>&nbsp;<span class="op" id="5107926">-</span>&nbsp;<span class="builtinfunc" id="5107928">len</span><span class="op" id="5107931">(</span><span class="ident" id="5107932">result</span><span class="op" id="5107938">)</span><span class="op" id="5107939">)</span>&nbsp;<span class="comment" id="5107941">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="5107959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107963">indices</span>&nbsp;<span class="op" id="5107971">:=</span>&nbsp;<span class="ident" id="5107974">x</span><span class="op" id="5107975">.</span><span class="ident" id="5107976">Lookup</span><span class="op" id="5107982">(</span><span class="ident" id="5107983">lit</span><span class="op" id="5107986">,</span>&nbsp;<span class="ident" id="5107988">n1</span><span class="op" id="5107990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107994">if</span>&nbsp;<span class="builtinfunc" id="5107997">len</span><span class="op" id="5108000">(</span><span class="ident" id="5108001">indices</span><span class="op" id="5108008">)</span>&nbsp;<span class="op" id="5108010">==</span>&nbsp;<span class="num" id="5108013">0</span>&nbsp;<span class="op" id="5108015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108020">return</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5108029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108033">sort</span><span class="op" id="5108037">.</span><span class="ident" id="5108038">Ints</span><span class="op" id="5108042">(</span><span class="ident" id="5108043">indices</span><span class="op" id="5108050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108054">result</span>&nbsp;<span class="op" id="5108061">=</span>&nbsp;<span class="ident" id="5108063">result</span><span class="op" id="5108069">[</span><span class="num" id="5108070">0</span><span class="op" id="5108071">:</span><span class="num" id="5108072">0</span><span class="op" id="5108073">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108077">prev</span>&nbsp;<span class="op" id="5108082">:=</span>&nbsp;<span class="num" id="5108085">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108089">for</span>&nbsp;<span class="ident" id="5108093">_</span><span class="op" id="5108094">,</span>&nbsp;<span class="ident" id="5108096">i</span>&nbsp;<span class="op" id="5108098">:=</span>&nbsp;<span class="keyword" id="5108101">range</span>&nbsp;<span class="ident" id="5108107">indices</span>&nbsp;<span class="op" id="5108115">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108120">if</span>&nbsp;<span class="builtinfunc" id="5108123">len</span><span class="op" id="5108126">(</span><span class="ident" id="5108127">result</span><span class="op" id="5108133">)</span>&nbsp;<span class="op" id="5108135">==</span>&nbsp;<span class="ident" id="5108138">n</span>&nbsp;<span class="op" id="5108140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108146">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5108155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108160">m</span>&nbsp;<span class="op" id="5108162">:=</span>&nbsp;<span class="ident" id="5108165">r</span><span class="op" id="5108166">.</span><span class="ident" id="5108167">FindIndex</span><span class="op" id="5108176">(</span><span class="ident" id="5108177">x</span><span class="op" id="5108178">.</span><span class="ident" id="5108179">data</span><span class="op" id="5108183">[</span><span class="ident" id="5108184">i</span><span class="op" id="5108185">:</span><span class="op" id="5108186">]</span><span class="op" id="5108187">)</span>&nbsp;<span class="comment" id="5108189">//&nbsp;anchored&nbsp;search&nbsp;-&nbsp;will&nbsp;not&nbsp;run&nbsp;off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5108230">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108282">if</span>&nbsp;<span class="ident" id="5108285">m</span>&nbsp;<span class="op" id="5108287">!=</span>&nbsp;<span class="ident" id="5108290">nil</span>&nbsp;<span class="op" id="5108294">&amp;&amp;</span>&nbsp;<span class="ident" id="5108297">prev</span>&nbsp;<span class="op" id="5108302">&lt;=</span>&nbsp;<span class="ident" id="5108305">i</span>&nbsp;<span class="op" id="5108307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108313">m</span><span class="op" id="5108314">[</span><span class="num" id="5108315">0</span><span class="op" id="5108316">]</span>&nbsp;<span class="op" id="5108318">=</span>&nbsp;<span class="ident" id="5108320">i</span>&nbsp;<span class="comment" id="5108322">//&nbsp;correct&nbsp;m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108339">m</span><span class="op" id="5108340">[</span><span class="num" id="5108341">1</span><span class="op" id="5108342">]</span>&nbsp;<span class="op" id="5108344">+=</span>&nbsp;<span class="ident" id="5108347">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108353">result</span>&nbsp;<span class="op" id="5108360">=</span>&nbsp;<span class="builtinfunc" id="5108362">append</span><span class="op" id="5108368">(</span><span class="ident" id="5108369">result</span><span class="op" id="5108375">,</span>&nbsp;<span class="ident" id="5108377">m</span><span class="op" id="5108378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108384">prev</span>&nbsp;<span class="op" id="5108389">=</span>&nbsp;<span class="ident" id="5108391">m</span><span class="op" id="5108392">[</span><span class="num" id="5108393">1</span><span class="op" id="5108394">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5108399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5108403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108407">if</span>&nbsp;<span class="builtinfunc" id="5108410">len</span><span class="op" id="5108413">(</span><span class="ident" id="5108414">result</span><span class="op" id="5108420">)</span>&nbsp;<span class="op" id="5108422">&gt;=</span>&nbsp;<span class="ident" id="5108425">n</span>&nbsp;<span class="op" id="5108427">||</span>&nbsp;<span class="builtinfunc" id="5108430">len</span><span class="op" id="5108433">(</span><span class="ident" id="5108434">indices</span><span class="op" id="5108441">)</span>&nbsp;<span class="op" id="5108443">!=</span>&nbsp;<span class="ident" id="5108446">n1</span>&nbsp;<span class="op" id="5108449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5108454">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5108512">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108545">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5108553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5108556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108559">if</span>&nbsp;<span class="builtinfunc" id="5108562">len</span><span class="op" id="5108565">(</span><span class="ident" id="5108566">result</span><span class="op" id="5108572">)</span>&nbsp;<span class="op" id="5108574">==</span>&nbsp;<span class="num" id="5108577">0</span>&nbsp;<span class="op" id="5108579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108583">result</span>&nbsp;<span class="op" id="5108590">=</span>&nbsp;<span class="ident" id="5108592">nil</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5108597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108600">return</span><br>
<span class="lineno"></span><span class="op" id="5108607">}</span>
</div>
</body>
</html>
