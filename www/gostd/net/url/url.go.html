<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/url</h2>
<ul>
<li><a href="/gostd/net/url/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/url/url.go.html">url.go</a></li>
<li><a href="/gostd/net/url/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3511635">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3511690">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3511744">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3511795">//&nbsp;Package&nbsp;url&nbsp;parses&nbsp;URLs&nbsp;and&nbsp;implements&nbsp;query&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="comment" id="3511853">//&nbsp;See&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3511870">package</span>&nbsp;<span class="ident" id="3511878">url</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3511883">import</span>&nbsp;<span class="op" id="3511890">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3511893">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3511902">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3511912">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3511920">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3511931">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3511941">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3511944">//&nbsp;Error&nbsp;reports&nbsp;an&nbsp;error&nbsp;and&nbsp;the&nbsp;operation&nbsp;and&nbsp;URL&nbsp;that&nbsp;caused&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3512012">type</span>&nbsp;<span class="ident" id="3512017">Error</span>&nbsp;<span class="keyword" id="3512023">struct</span>&nbsp;<span class="op" id="3512030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512033">Op</span>&nbsp;&nbsp;<span class="builtintype" id="3512037">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512045">URL</span>&nbsp;<span class="builtintype" id="3512049">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512057">Err</span>&nbsp;<span class="builtintype" id="3512061">error</span><br>
<span class="lineno"></span><span class="op" id="3512067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3512070">func</span>&nbsp;<span class="op" id="3512075">(</span><span class="ident" id="3512076">e</span>&nbsp;<span class="op" id="3512078">*</span><span class="ident" id="3512079">Error</span><span class="op" id="3512084">)</span>&nbsp;<span class="ident" id="3512086">Error</span><span class="op" id="3512091">(</span><span class="op" id="3512092">)</span>&nbsp;<span class="builtintype" id="3512094">string</span>&nbsp;<span class="op" id="3512101">{</span>&nbsp;<span class="keyword" id="3512103">return</span>&nbsp;<span class="ident" id="3512110">e</span><span class="op" id="3512111">.</span><span class="ident" id="3512112">Op</span>&nbsp;<span class="op" id="3512115">+</span>&nbsp;<span class="string" id="3512117">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3512121">+</span>&nbsp;<span class="ident" id="3512123">e</span><span class="op" id="3512124">.</span><span class="ident" id="3512125">URL</span>&nbsp;<span class="op" id="3512129">+</span>&nbsp;<span class="string" id="3512131">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3512136">+</span>&nbsp;<span class="ident" id="3512138">e</span><span class="op" id="3512139">.</span><span class="ident" id="3512140">Err</span><span class="op" id="3512143">.</span><span class="ident" id="3512144">Error</span><span class="op" id="3512149">(</span><span class="op" id="3512150">)</span>&nbsp;<span class="op" id="3512152">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3512155">func</span>&nbsp;<span class="ident" id="3512160">ishex</span><span class="op" id="3512165">(</span><span class="ident" id="3512166">c</span>&nbsp;<span class="builtintype" id="3512168">byte</span><span class="op" id="3512172">)</span>&nbsp;<span class="builtintype" id="3512174">bool</span>&nbsp;<span class="op" id="3512179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512182">switch</span>&nbsp;<span class="op" id="3512189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512192">case</span>&nbsp;<span class="string" id="3512197">&#39;0&#39;</span>&nbsp;<span class="op" id="3512201">&lt;=</span>&nbsp;<span class="ident" id="3512204">c</span>&nbsp;<span class="op" id="3512206">&amp;&amp;</span>&nbsp;<span class="ident" id="3512209">c</span>&nbsp;<span class="op" id="3512211">&lt;=</span>&nbsp;<span class="string" id="3512214">&#39;9&#39;</span><span class="op" id="3512217">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512221">return</span>&nbsp;<span class="builtintype" id="3512228">true</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512234">case</span>&nbsp;<span class="string" id="3512239">&#39;a&#39;</span>&nbsp;<span class="op" id="3512243">&lt;=</span>&nbsp;<span class="ident" id="3512246">c</span>&nbsp;<span class="op" id="3512248">&amp;&amp;</span>&nbsp;<span class="ident" id="3512251">c</span>&nbsp;<span class="op" id="3512253">&lt;=</span>&nbsp;<span class="string" id="3512256">&#39;f&#39;</span><span class="op" id="3512259">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512263">return</span>&nbsp;<span class="builtintype" id="3512270">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512276">case</span>&nbsp;<span class="string" id="3512281">&#39;A&#39;</span>&nbsp;<span class="op" id="3512285">&lt;=</span>&nbsp;<span class="ident" id="3512288">c</span>&nbsp;<span class="op" id="3512290">&amp;&amp;</span>&nbsp;<span class="ident" id="3512293">c</span>&nbsp;<span class="op" id="3512295">&lt;=</span>&nbsp;<span class="string" id="3512298">&#39;F&#39;</span><span class="op" id="3512301">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512305">return</span>&nbsp;<span class="builtintype" id="3512312">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3512318">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512321">return</span>&nbsp;<span class="builtintype" id="3512328">false</span><br>
<span class="lineno"></span><span class="op" id="3512334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3512337">func</span>&nbsp;<span class="ident" id="3512342">unhex</span><span class="op" id="3512347">(</span><span class="ident" id="3512348">c</span>&nbsp;<span class="builtintype" id="3512350">byte</span><span class="op" id="3512354">)</span>&nbsp;<span class="builtintype" id="3512356">byte</span>&nbsp;<span class="op" id="3512361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512364">switch</span>&nbsp;<span class="op" id="3512371">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512374">case</span>&nbsp;<span class="string" id="3512379">&#39;0&#39;</span>&nbsp;<span class="op" id="3512383">&lt;=</span>&nbsp;<span class="ident" id="3512386">c</span>&nbsp;<span class="op" id="3512388">&amp;&amp;</span>&nbsp;<span class="ident" id="3512391">c</span>&nbsp;<span class="op" id="3512393">&lt;=</span>&nbsp;<span class="string" id="3512396">&#39;9&#39;</span><span class="op" id="3512399">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512403">return</span>&nbsp;<span class="ident" id="3512410">c</span>&nbsp;<span class="op" id="3512412">-</span>&nbsp;<span class="string" id="3512414">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512419">case</span>&nbsp;<span class="string" id="3512424">&#39;a&#39;</span>&nbsp;<span class="op" id="3512428">&lt;=</span>&nbsp;<span class="ident" id="3512431">c</span>&nbsp;<span class="op" id="3512433">&amp;&amp;</span>&nbsp;<span class="ident" id="3512436">c</span>&nbsp;<span class="op" id="3512438">&lt;=</span>&nbsp;<span class="string" id="3512441">&#39;f&#39;</span><span class="op" id="3512444">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512448">return</span>&nbsp;<span class="ident" id="3512455">c</span>&nbsp;<span class="op" id="3512457">-</span>&nbsp;<span class="string" id="3512459">&#39;a&#39;</span>&nbsp;<span class="op" id="3512463">+</span>&nbsp;<span class="num" id="3512465">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512469">case</span>&nbsp;<span class="string" id="3512474">&#39;A&#39;</span>&nbsp;<span class="op" id="3512478">&lt;=</span>&nbsp;<span class="ident" id="3512481">c</span>&nbsp;<span class="op" id="3512483">&amp;&amp;</span>&nbsp;<span class="ident" id="3512486">c</span>&nbsp;<span class="op" id="3512488">&lt;=</span>&nbsp;<span class="string" id="3512491">&#39;F&#39;</span><span class="op" id="3512494">:</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512498">return</span>&nbsp;<span class="ident" id="3512505">c</span>&nbsp;<span class="op" id="3512507">-</span>&nbsp;<span class="string" id="3512509">&#39;A&#39;</span>&nbsp;<span class="op" id="3512513">+</span>&nbsp;<span class="num" id="3512515">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3512519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512522">return</span>&nbsp;<span class="num" id="3512529">0</span><br>
<span class="lineno"></span><span class="op" id="3512531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="3512534">type</span>&nbsp;<span class="ident" id="3512539">encoding</span>&nbsp;<span class="builtintype" id="3512548">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3512553">const</span>&nbsp;<span class="op" id="3512559">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512562">encodePath</span>&nbsp;<span class="ident" id="3512573">encoding</span>&nbsp;<span class="op" id="3512582">=</span>&nbsp;<span class="num" id="3512584">1</span>&nbsp;<span class="op" id="3512586">+</span>&nbsp;<span class="ident" id="3512588">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512594">encodeUserPassword</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512614">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512636">encodeFragment</span><br>
<span class="lineno"></span><span class="op" id="3512651">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3512654">type</span>&nbsp;<span class="ident" id="3512659">EscapeError</span>&nbsp;<span class="builtintype" id="3512671">string</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3512679">func</span>&nbsp;<span class="op" id="3512684">(</span><span class="ident" id="3512685">e</span>&nbsp;<span class="ident" id="3512687">EscapeError</span><span class="op" id="3512698">)</span>&nbsp;<span class="ident" id="3512700">Error</span><span class="op" id="3512705">(</span><span class="op" id="3512706">)</span>&nbsp;<span class="builtintype" id="3512708">string</span>&nbsp;<span class="op" id="3512715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512718">return</span>&nbsp;<span class="string" id="3512725">&#34;invalid&nbsp;URL&nbsp;escape&nbsp;&#34;</span>&nbsp;<span class="op" id="3512747">+</span>&nbsp;<span class="ident" id="3512749">strconv</span><span class="op" id="3512756">.</span><span class="ident" id="3512757">Quote</span><span class="op" id="3512762">(</span><span class="builtintype" id="3512763">string</span><span class="op" id="3512769">(</span><span class="ident" id="3512770">e</span><span class="op" id="3512771">)</span><span class="op" id="3512772">)</span><br>
<span class="lineno"></span><span class="op" id="3512774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3512777">//&nbsp;Return&nbsp;true&nbsp;if&nbsp;the&nbsp;specified&nbsp;character&nbsp;should&nbsp;be&nbsp;escaped&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="3512842">//&nbsp;appearing&nbsp;in&nbsp;a&nbsp;URL&nbsp;string,&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3512895">func</span>&nbsp;<span class="ident" id="3512900">shouldEscape</span><span class="op" id="3512912">(</span><span class="ident" id="3512913">c</span>&nbsp;<span class="builtintype" id="3512915">byte</span><span class="op" id="3512919">,</span>&nbsp;<span class="ident" id="3512921">mode</span>&nbsp;<span class="ident" id="3512926">encoding</span><span class="op" id="3512934">)</span>&nbsp;<span class="builtintype" id="3512936">bool</span>&nbsp;<span class="op" id="3512941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3512944">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(alphanum)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512987">if</span>&nbsp;<span class="string" id="3512990">&#39;A&#39;</span>&nbsp;<span class="op" id="3512994">&lt;=</span>&nbsp;<span class="ident" id="3512997">c</span>&nbsp;<span class="op" id="3512999">&amp;&amp;</span>&nbsp;<span class="ident" id="3513002">c</span>&nbsp;<span class="op" id="3513004">&lt;=</span>&nbsp;<span class="string" id="3513007">&#39;Z&#39;</span>&nbsp;<span class="op" id="3513011">||</span>&nbsp;<span class="string" id="3513014">&#39;a&#39;</span>&nbsp;<span class="op" id="3513018">&lt;=</span>&nbsp;<span class="ident" id="3513021">c</span>&nbsp;<span class="op" id="3513023">&amp;&amp;</span>&nbsp;<span class="ident" id="3513026">c</span>&nbsp;<span class="op" id="3513028">&lt;=</span>&nbsp;<span class="string" id="3513031">&#39;z&#39;</span>&nbsp;<span class="op" id="3513035">||</span>&nbsp;<span class="string" id="3513038">&#39;0&#39;</span>&nbsp;<span class="op" id="3513042">&lt;=</span>&nbsp;<span class="ident" id="3513045">c</span>&nbsp;<span class="op" id="3513047">&amp;&amp;</span>&nbsp;<span class="ident" id="3513050">c</span>&nbsp;<span class="op" id="3513052">&lt;=</span>&nbsp;<span class="string" id="3513055">&#39;9&#39;</span>&nbsp;<span class="op" id="3513059">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3513063">return</span>&nbsp;<span class="builtintype" id="3513070">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3513077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3513081">switch</span>&nbsp;<span class="ident" id="3513088">c</span>&nbsp;<span class="op" id="3513090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3513093">case</span>&nbsp;<span class="string" id="3513098">&#39;-&#39;</span><span class="op" id="3513101">,</span>&nbsp;<span class="string" id="3513103">&#39;_&#39;</span><span class="op" id="3513106">,</span>&nbsp;<span class="string" id="3513108">&#39;.&#39;</span><span class="op" id="3513111">,</span>&nbsp;<span class="string" id="3513113">&#39;~&#39;</span><span class="op" id="3513116">:</span>&nbsp;<span class="comment" id="3513118">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(mark)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3513158">return</span>&nbsp;<span class="builtintype" id="3513165">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3513173">case</span>&nbsp;<span class="string" id="3513178">&#39;$&#39;</span><span class="op" id="3513181">,</span>&nbsp;<span class="string" id="3513183">&#39;&amp;&#39;</span><span class="op" id="3513186">,</span>&nbsp;<span class="string" id="3513188">&#39;+&#39;</span><span class="op" id="3513191">,</span>&nbsp;<span class="string" id="3513193">&#39;,&#39;</span><span class="op" id="3513196">,</span>&nbsp;<span class="string" id="3513198">&#39;/&#39;</span><span class="op" id="3513201">,</span>&nbsp;<span class="string" id="3513203">&#39;:&#39;</span><span class="op" id="3513206">,</span>&nbsp;<span class="string" id="3513208">&#39;;&#39;</span><span class="op" id="3513211">,</span>&nbsp;<span class="string" id="3513213">&#39;=&#39;</span><span class="op" id="3513216">,</span>&nbsp;<span class="string" id="3513218">&#39;?&#39;</span><span class="op" id="3513221">,</span>&nbsp;<span class="string" id="3513223">&#39;@&#39;</span><span class="op" id="3513226">:</span>&nbsp;<span class="comment" id="3513228">//&nbsp;§2.2&nbsp;Reserved&nbsp;characters&nbsp;(reserved)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3513270">//&nbsp;Different&nbsp;sections&nbsp;of&nbsp;the&nbsp;URL&nbsp;allow&nbsp;a&nbsp;few&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3513320">//&nbsp;the&nbsp;reserved&nbsp;characters&nbsp;to&nbsp;appear&nbsp;unescaped.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3513370">switch</span>&nbsp;<span class="ident" id="3513377">mode</span>&nbsp;<span class="op" id="3513382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3513386">case</span>&nbsp;<span class="ident" id="3513391">encodePath</span><span class="op" id="3513401">:</span>&nbsp;<span class="comment" id="3513403">//&nbsp;§3.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3513415">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;:&nbsp;@&nbsp;&amp;&nbsp;=&nbsp;+&nbsp;$&nbsp;but&nbsp;saves&nbsp;/&nbsp;;&nbsp;,&nbsp;for&nbsp;assigning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3513478">//&nbsp;meaning&nbsp;to&nbsp;individual&nbsp;path&nbsp;segments.&nbsp;This&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3513534">//&nbsp;only&nbsp;manipulates&nbsp;the&nbsp;path&nbsp;as&nbsp;a&nbsp;whole,&nbsp;so&nbsp;we&nbsp;allow&nbsp;those</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3513596">//&nbsp;last&nbsp;two&nbsp;as&nbsp;well.&nbsp;That&nbsp;leaves&nbsp;only&nbsp;?&nbsp;to&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3513650">return</span>&nbsp;<span class="ident" id="3513657">c</span>&nbsp;<span class="op" id="3513659">==</span>&nbsp;<span class="string" id="3513662">&#39;?&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3513669">case</span>&nbsp;<span class="ident" id="3513674">encodeUserPassword</span><span class="op" id="3513692">:</span>&nbsp;<span class="comment" id="3513694">//&nbsp;§3.2.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3513708">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;&#39;;&#39;,&nbsp;&#39;:&#39;,&nbsp;&#39;&amp;&#39;,&nbsp;&#39;=&#39;,&nbsp;&#39;+&#39;,&nbsp;&#39;$&#39;,&nbsp;and&nbsp;&#39;,&#39;&nbsp;in</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3513770">//&nbsp;userinfo,&nbsp;so&nbsp;we&nbsp;must&nbsp;escape&nbsp;only&nbsp;&#39;@&#39;,&nbsp;&#39;/&#39;,&nbsp;and&nbsp;&#39;?&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3513828">//&nbsp;The&nbsp;parsing&nbsp;of&nbsp;userinfo&nbsp;treats&nbsp;&#39;:&#39;&nbsp;as&nbsp;special&nbsp;so&nbsp;we&nbsp;must&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3513898">//&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3513914">return</span>&nbsp;<span class="ident" id="3513921">c</span>&nbsp;<span class="op" id="3513923">==</span>&nbsp;<span class="string" id="3513926">&#39;@&#39;</span>&nbsp;<span class="op" id="3513930">||</span>&nbsp;<span class="ident" id="3513933">c</span>&nbsp;<span class="op" id="3513935">==</span>&nbsp;<span class="string" id="3513938">&#39;/&#39;</span>&nbsp;<span class="op" id="3513942">||</span>&nbsp;<span class="ident" id="3513945">c</span>&nbsp;<span class="op" id="3513947">==</span>&nbsp;<span class="string" id="3513950">&#39;?&#39;</span>&nbsp;<span class="op" id="3513954">||</span>&nbsp;<span class="ident" id="3513957">c</span>&nbsp;<span class="op" id="3513959">==</span>&nbsp;<span class="string" id="3513962">&#39;:&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3513969">case</span>&nbsp;<span class="ident" id="3513974">encodeQueryComponent</span><span class="op" id="3513994">:</span>&nbsp;<span class="comment" id="3513996">//&nbsp;§3.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3514008">//&nbsp;The&nbsp;RFC&nbsp;reserves&nbsp;(so&nbsp;we&nbsp;must&nbsp;escape)&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3514063">return</span>&nbsp;<span class="builtintype" id="3514070">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3514078">case</span>&nbsp;<span class="ident" id="3514083">encodeFragment</span><span class="op" id="3514097">:</span>&nbsp;<span class="comment" id="3514099">//&nbsp;§4.1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3514111">//&nbsp;The&nbsp;RFC&nbsp;text&nbsp;is&nbsp;silent&nbsp;but&nbsp;the&nbsp;grammar&nbsp;allows</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3514163">//&nbsp;everything,&nbsp;so&nbsp;escape&nbsp;nothing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3514200">return</span>&nbsp;<span class="builtintype" id="3514207">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3514215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3514218">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3514222">//&nbsp;Everything&nbsp;else&nbsp;must&nbsp;be&nbsp;escaped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3514259">return</span>&nbsp;<span class="builtintype" id="3514266">true</span><br>
<span class="lineno"></span><span class="op" id="3514271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="3514274">//&nbsp;QueryUnescape&nbsp;does&nbsp;the&nbsp;inverse&nbsp;transformation&nbsp;of&nbsp;QueryEscape,&nbsp;converting</span><br>
<span class="lineno"></span><span class="comment" id="3514350">//&nbsp;%AB&nbsp;into&nbsp;the&nbsp;byte&nbsp;0xAB&nbsp;and&nbsp;&#39;+&#39;&nbsp;into&nbsp;&#39;&nbsp;&#39;&nbsp;(space).&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3514425">//&nbsp;any&nbsp;%&nbsp;is&nbsp;not&nbsp;followed&nbsp;by&nbsp;two&nbsp;hexadecimal&nbsp;digits.</span><br>
<span class="lineno"></span><span class="keyword" id="3514477">func</span>&nbsp;<span class="ident" id="3514482">QueryUnescape</span><span class="op" id="3514495">(</span><span class="ident" id="3514496">s</span>&nbsp;<span class="builtintype" id="3514498">string</span><span class="op" id="3514504">)</span>&nbsp;<span class="op" id="3514506">(</span><span class="builtintype" id="3514507">string</span><span class="op" id="3514513">,</span>&nbsp;<span class="builtintype" id="3514515">error</span><span class="op" id="3514520">)</span>&nbsp;<span class="op" id="3514522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3514525">return</span>&nbsp;<span class="ident" id="3514532">unescape</span><span class="op" id="3514540">(</span><span class="ident" id="3514541">s</span><span class="op" id="3514542">,</span>&nbsp;<span class="ident" id="3514544">encodeQueryComponent</span><span class="op" id="3514564">)</span><br>
<span class="lineno">115</span><span class="op" id="3514566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3514569">//&nbsp;unescape&nbsp;unescapes&nbsp;a&nbsp;string;&nbsp;the&nbsp;mode&nbsp;specifies</span><br>
<span class="lineno"></span><span class="comment" id="3514620">//&nbsp;which&nbsp;section&nbsp;of&nbsp;the&nbsp;URL&nbsp;string&nbsp;is&nbsp;being&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="3514675">func</span>&nbsp;<span class="ident" id="3514680">unescape</span><span class="op" id="3514688">(</span><span class="ident" id="3514689">s</span>&nbsp;<span class="builtintype" id="3514691">string</span><span class="op" id="3514697">,</span>&nbsp;<span class="ident" id="3514699">mode</span>&nbsp;<span class="ident" id="3514704">encoding</span><span class="op" id="3514712">)</span>&nbsp;<span class="op" id="3514714">(</span><span class="builtintype" id="3514715">string</span><span class="op" id="3514721">,</span>&nbsp;<span class="builtintype" id="3514723">error</span><span class="op" id="3514728">)</span>&nbsp;<span class="op" id="3514730">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3514733">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514778">n</span>&nbsp;<span class="op" id="3514780">:=</span>&nbsp;<span class="num" id="3514783">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514786">hasPlus</span>&nbsp;<span class="op" id="3514794">:=</span>&nbsp;<span class="builtintype" id="3514797">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3514804">for</span>&nbsp;<span class="ident" id="3514808">i</span>&nbsp;<span class="op" id="3514810">:=</span>&nbsp;<span class="num" id="3514813">0</span><span class="op" id="3514814">;</span>&nbsp;<span class="ident" id="3514816">i</span>&nbsp;<span class="op" id="3514818">&lt;</span>&nbsp;<span class="builtinfunc" id="3514820">len</span><span class="op" id="3514823">(</span><span class="ident" id="3514824">s</span><span class="op" id="3514825">)</span><span class="op" id="3514826">;</span>&nbsp;<span class="op" id="3514828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3514832">switch</span>&nbsp;<span class="ident" id="3514839">s</span><span class="op" id="3514840">[</span><span class="ident" id="3514841">i</span><span class="op" id="3514842">]</span>&nbsp;<span class="op" id="3514844">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3514848">case</span>&nbsp;<span class="string" id="3514853">&#39;%&#39;</span><span class="op" id="3514856">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514861">n</span><span class="op" id="3514862">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3514868">if</span>&nbsp;<span class="ident" id="3514871">i</span><span class="op" id="3514872">+</span><span class="num" id="3514873">2</span>&nbsp;<span class="op" id="3514875">&gt;=</span>&nbsp;<span class="builtinfunc" id="3514878">len</span><span class="op" id="3514881">(</span><span class="ident" id="3514882">s</span><span class="op" id="3514883">)</span>&nbsp;<span class="op" id="3514885">||</span>&nbsp;<span class="op" id="3514888">!</span><span class="ident" id="3514889">ishex</span><span class="op" id="3514894">(</span><span class="ident" id="3514895">s</span><span class="op" id="3514896">[</span><span class="ident" id="3514897">i</span><span class="op" id="3514898">+</span><span class="num" id="3514899">1</span><span class="op" id="3514900">]</span><span class="op" id="3514901">)</span>&nbsp;<span class="op" id="3514903">||</span>&nbsp;<span class="op" id="3514906">!</span><span class="ident" id="3514907">ishex</span><span class="op" id="3514912">(</span><span class="ident" id="3514913">s</span><span class="op" id="3514914">[</span><span class="ident" id="3514915">i</span><span class="op" id="3514916">+</span><span class="num" id="3514917">2</span><span class="op" id="3514918">]</span><span class="op" id="3514919">)</span>&nbsp;<span class="op" id="3514921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514927">s</span>&nbsp;<span class="op" id="3514929">=</span>&nbsp;<span class="ident" id="3514931">s</span><span class="op" id="3514932">[</span><span class="ident" id="3514933">i</span><span class="op" id="3514934">:</span><span class="op" id="3514935">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3514941">if</span>&nbsp;<span class="builtinfunc" id="3514944">len</span><span class="op" id="3514947">(</span><span class="ident" id="3514948">s</span><span class="op" id="3514949">)</span>&nbsp;<span class="op" id="3514951">&gt;</span>&nbsp;<span class="num" id="3514953">3</span>&nbsp;<span class="op" id="3514955">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3514962">s</span>&nbsp;<span class="op" id="3514964">=</span>&nbsp;<span class="ident" id="3514966">s</span><span class="op" id="3514967">[</span><span class="num" id="3514968">0</span><span class="op" id="3514969">:</span><span class="num" id="3514970">3</span><span class="op" id="3514971">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3514977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3514983">return</span>&nbsp;<span class="string" id="3514990">&#34;&#34;</span><span class="op" id="3514992">,</span>&nbsp;<span class="ident" id="3514994">EscapeError</span><span class="op" id="3515005">(</span><span class="ident" id="3515006">s</span><span class="op" id="3515007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515017">i</span>&nbsp;<span class="op" id="3515019">+=</span>&nbsp;<span class="num" id="3515022">3</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515026">case</span>&nbsp;<span class="string" id="3515031">&#39;+&#39;</span><span class="op" id="3515034">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515039">hasPlus</span>&nbsp;<span class="op" id="3515047">=</span>&nbsp;<span class="ident" id="3515049">mode</span>&nbsp;<span class="op" id="3515054">==</span>&nbsp;<span class="ident" id="3515057">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515081">i</span><span class="op" id="3515082">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515087">default</span><span class="op" id="3515094">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515099">i</span><span class="op" id="3515100">++</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515112">if</span>&nbsp;<span class="ident" id="3515115">n</span>&nbsp;<span class="op" id="3515117">==</span>&nbsp;<span class="num" id="3515120">0</span>&nbsp;<span class="op" id="3515122">&amp;&amp;</span>&nbsp;<span class="op" id="3515125">!</span><span class="ident" id="3515126">hasPlus</span>&nbsp;<span class="op" id="3515134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515138">return</span>&nbsp;<span class="ident" id="3515145">s</span><span class="op" id="3515146">,</span>&nbsp;<span class="ident" id="3515148">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515157">t</span>&nbsp;<span class="op" id="3515159">:=</span>&nbsp;<span class="builtinfunc" id="3515162">make</span><span class="op" id="3515166">(</span><span class="op" id="3515167">[</span><span class="op" id="3515168">]</span><span class="builtintype" id="3515169">byte</span><span class="op" id="3515173">,</span>&nbsp;<span class="builtinfunc" id="3515175">len</span><span class="op" id="3515178">(</span><span class="ident" id="3515179">s</span><span class="op" id="3515180">)</span><span class="op" id="3515181">-</span><span class="num" id="3515182">2</span><span class="op" id="3515183">*</span><span class="ident" id="3515184">n</span><span class="op" id="3515185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515188">j</span>&nbsp;<span class="op" id="3515190">:=</span>&nbsp;<span class="num" id="3515193">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515196">for</span>&nbsp;<span class="ident" id="3515200">i</span>&nbsp;<span class="op" id="3515202">:=</span>&nbsp;<span class="num" id="3515205">0</span><span class="op" id="3515206">;</span>&nbsp;<span class="ident" id="3515208">i</span>&nbsp;<span class="op" id="3515210">&lt;</span>&nbsp;<span class="builtinfunc" id="3515212">len</span><span class="op" id="3515215">(</span><span class="ident" id="3515216">s</span><span class="op" id="3515217">)</span><span class="op" id="3515218">;</span>&nbsp;<span class="op" id="3515220">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515224">switch</span>&nbsp;<span class="ident" id="3515231">s</span><span class="op" id="3515232">[</span><span class="ident" id="3515233">i</span><span class="op" id="3515234">]</span>&nbsp;<span class="op" id="3515236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515240">case</span>&nbsp;<span class="string" id="3515245">&#39;%&#39;</span><span class="op" id="3515248">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515253">t</span><span class="op" id="3515254">[</span><span class="ident" id="3515255">j</span><span class="op" id="3515256">]</span>&nbsp;<span class="op" id="3515258">=</span>&nbsp;<span class="ident" id="3515260">unhex</span><span class="op" id="3515265">(</span><span class="ident" id="3515266">s</span><span class="op" id="3515267">[</span><span class="ident" id="3515268">i</span><span class="op" id="3515269">+</span><span class="num" id="3515270">1</span><span class="op" id="3515271">]</span><span class="op" id="3515272">)</span><span class="op" id="3515273">&lt;&lt;</span><span class="num" id="3515275">4</span>&nbsp;<span class="op" id="3515277">|</span>&nbsp;<span class="ident" id="3515279">unhex</span><span class="op" id="3515284">(</span><span class="ident" id="3515285">s</span><span class="op" id="3515286">[</span><span class="ident" id="3515287">i</span><span class="op" id="3515288">+</span><span class="num" id="3515289">2</span><span class="op" id="3515290">]</span><span class="op" id="3515291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515296">j</span><span class="op" id="3515297">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515303">i</span>&nbsp;<span class="op" id="3515305">+=</span>&nbsp;<span class="num" id="3515308">3</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515312">case</span>&nbsp;<span class="string" id="3515317">&#39;+&#39;</span><span class="op" id="3515320">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515325">if</span>&nbsp;<span class="ident" id="3515328">mode</span>&nbsp;<span class="op" id="3515333">==</span>&nbsp;<span class="ident" id="3515336">encodeQueryComponent</span>&nbsp;<span class="op" id="3515357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515363">t</span><span class="op" id="3515364">[</span><span class="ident" id="3515365">j</span><span class="op" id="3515366">]</span>&nbsp;<span class="op" id="3515368">=</span>&nbsp;<span class="string" id="3515370">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515377">}</span>&nbsp;<span class="keyword" id="3515379">else</span>&nbsp;<span class="op" id="3515384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515390">t</span><span class="op" id="3515391">[</span><span class="ident" id="3515392">j</span><span class="op" id="3515393">]</span>&nbsp;<span class="op" id="3515395">=</span>&nbsp;<span class="string" id="3515397">&#39;+&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515409">j</span><span class="op" id="3515410">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515416">i</span><span class="op" id="3515417">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515422">default</span><span class="op" id="3515429">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515434">t</span><span class="op" id="3515435">[</span><span class="ident" id="3515436">j</span><span class="op" id="3515437">]</span>&nbsp;<span class="op" id="3515439">=</span>&nbsp;<span class="ident" id="3515441">s</span><span class="op" id="3515442">[</span><span class="ident" id="3515443">i</span><span class="op" id="3515444">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515449">j</span><span class="op" id="3515450">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515456">i</span><span class="op" id="3515457">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515468">return</span>&nbsp;<span class="builtintype" id="3515475">string</span><span class="op" id="3515481">(</span><span class="ident" id="3515482">t</span><span class="op" id="3515483">)</span><span class="op" id="3515484">,</span>&nbsp;<span class="ident" id="3515486">nil</span><br>
<span class="lineno">170</span><span class="op" id="3515490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3515493">//&nbsp;QueryEscape&nbsp;escapes&nbsp;the&nbsp;string&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;safely&nbsp;placed</span><br>
<span class="lineno"></span><span class="comment" id="3515554">//&nbsp;inside&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno"></span><span class="keyword" id="3515577">func</span>&nbsp;<span class="ident" id="3515582">QueryEscape</span><span class="op" id="3515593">(</span><span class="ident" id="3515594">s</span>&nbsp;<span class="builtintype" id="3515596">string</span><span class="op" id="3515602">)</span>&nbsp;<span class="builtintype" id="3515604">string</span>&nbsp;<span class="op" id="3515611">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515614">return</span>&nbsp;<span class="ident" id="3515621">escape</span><span class="op" id="3515627">(</span><span class="ident" id="3515628">s</span><span class="op" id="3515629">,</span>&nbsp;<span class="ident" id="3515631">encodeQueryComponent</span><span class="op" id="3515651">)</span><br>
<span class="lineno"></span><span class="op" id="3515653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3515656">func</span>&nbsp;<span class="ident" id="3515661">escape</span><span class="op" id="3515667">(</span><span class="ident" id="3515668">s</span>&nbsp;<span class="builtintype" id="3515670">string</span><span class="op" id="3515676">,</span>&nbsp;<span class="ident" id="3515678">mode</span>&nbsp;<span class="ident" id="3515683">encoding</span><span class="op" id="3515691">)</span>&nbsp;<span class="builtintype" id="3515693">string</span>&nbsp;<span class="op" id="3515700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515703">spaceCount</span><span class="op" id="3515713">,</span>&nbsp;<span class="ident" id="3515715">hexCount</span>&nbsp;<span class="op" id="3515724">:=</span>&nbsp;<span class="num" id="3515727">0</span><span class="op" id="3515728">,</span>&nbsp;<span class="num" id="3515730">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515733">for</span>&nbsp;<span class="ident" id="3515737">i</span>&nbsp;<span class="op" id="3515739">:=</span>&nbsp;<span class="num" id="3515742">0</span><span class="op" id="3515743">;</span>&nbsp;<span class="ident" id="3515745">i</span>&nbsp;<span class="op" id="3515747">&lt;</span>&nbsp;<span class="builtinfunc" id="3515749">len</span><span class="op" id="3515752">(</span><span class="ident" id="3515753">s</span><span class="op" id="3515754">)</span><span class="op" id="3515755">;</span>&nbsp;<span class="ident" id="3515757">i</span><span class="op" id="3515758">++</span>&nbsp;<span class="op" id="3515761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515765">c</span>&nbsp;<span class="op" id="3515767">:=</span>&nbsp;<span class="ident" id="3515770">s</span><span class="op" id="3515771">[</span><span class="ident" id="3515772">i</span><span class="op" id="3515773">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515777">if</span>&nbsp;<span class="ident" id="3515780">shouldEscape</span><span class="op" id="3515792">(</span><span class="ident" id="3515793">c</span><span class="op" id="3515794">,</span>&nbsp;<span class="ident" id="3515796">mode</span><span class="op" id="3515800">)</span>&nbsp;<span class="op" id="3515802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515807">if</span>&nbsp;<span class="ident" id="3515810">c</span>&nbsp;<span class="op" id="3515812">==</span>&nbsp;<span class="string" id="3515815">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3515819">&amp;&amp;</span>&nbsp;<span class="ident" id="3515822">mode</span>&nbsp;<span class="op" id="3515827">==</span>&nbsp;<span class="ident" id="3515830">encodeQueryComponent</span>&nbsp;<span class="op" id="3515851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515857">spaceCount</span><span class="op" id="3515867">++</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515873">}</span>&nbsp;<span class="keyword" id="3515875">else</span>&nbsp;<span class="op" id="3515880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515886">hexCount</span><span class="op" id="3515894">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515907">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515911">if</span>&nbsp;<span class="ident" id="3515914">spaceCount</span>&nbsp;<span class="op" id="3515925">==</span>&nbsp;<span class="num" id="3515928">0</span>&nbsp;<span class="op" id="3515930">&amp;&amp;</span>&nbsp;<span class="ident" id="3515933">hexCount</span>&nbsp;<span class="op" id="3515942">==</span>&nbsp;<span class="num" id="3515945">0</span>&nbsp;<span class="op" id="3515947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3515951">return</span>&nbsp;<span class="ident" id="3515958">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3515961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3515965">t</span>&nbsp;<span class="op" id="3515967">:=</span>&nbsp;<span class="builtinfunc" id="3515970">make</span><span class="op" id="3515974">(</span><span class="op" id="3515975">[</span><span class="op" id="3515976">]</span><span class="builtintype" id="3515977">byte</span><span class="op" id="3515981">,</span>&nbsp;<span class="builtinfunc" id="3515983">len</span><span class="op" id="3515986">(</span><span class="ident" id="3515987">s</span><span class="op" id="3515988">)</span><span class="op" id="3515989">+</span><span class="num" id="3515990">2</span><span class="op" id="3515991">*</span><span class="ident" id="3515992">hexCount</span><span class="op" id="3516000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3516003">j</span>&nbsp;<span class="op" id="3516005">:=</span>&nbsp;<span class="num" id="3516008">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3516011">for</span>&nbsp;<span class="ident" id="3516015">i</span>&nbsp;<span class="op" id="3516017">:=</span>&nbsp;<span class="num" id="3516020">0</span><span class="op" id="3516021">;</span>&nbsp;<span class="ident" id="3516023">i</span>&nbsp;<span class="op" id="3516025">&lt;</span>&nbsp;<span class="builtinfunc" id="3516027">len</span><span class="op" id="3516030">(</span><span class="ident" id="3516031">s</span><span class="op" id="3516032">)</span><span class="op" id="3516033">;</span>&nbsp;<span class="ident" id="3516035">i</span><span class="op" id="3516036">++</span>&nbsp;<span class="op" id="3516039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3516043">switch</span>&nbsp;<span class="ident" id="3516050">c</span>&nbsp;<span class="op" id="3516052">:=</span>&nbsp;<span class="ident" id="3516055">s</span><span class="op" id="3516056">[</span><span class="ident" id="3516057">i</span><span class="op" id="3516058">]</span><span class="op" id="3516059">;</span>&nbsp;<span class="op" id="3516061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3516065">case</span>&nbsp;<span class="ident" id="3516070">c</span>&nbsp;<span class="op" id="3516072">==</span>&nbsp;<span class="string" id="3516075">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3516079">&amp;&amp;</span>&nbsp;<span class="ident" id="3516082">mode</span>&nbsp;<span class="op" id="3516087">==</span>&nbsp;<span class="ident" id="3516090">encodeQueryComponent</span><span class="op" id="3516110">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3516115">t</span><span class="op" id="3516116">[</span><span class="ident" id="3516117">j</span><span class="op" id="3516118">]</span>&nbsp;<span class="op" id="3516120">=</span>&nbsp;<span class="string" id="3516122">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3516129">j</span><span class="op" id="3516130">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3516135">case</span>&nbsp;<span class="ident" id="3516140">shouldEscape</span><span class="op" id="3516152">(</span><span class="ident" id="3516153">c</span><span class="op" id="3516154">,</span>&nbsp;<span class="ident" id="3516156">mode</span><span class="op" id="3516160">)</span><span class="op" id="3516161">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3516166">t</span><span class="op" id="3516167">[</span><span class="ident" id="3516168">j</span><span class="op" id="3516169">]</span>&nbsp;<span class="op" id="3516171">=</span>&nbsp;<span class="string" id="3516173">&#39;%&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3516180">t</span><span class="op" id="3516181">[</span><span class="ident" id="3516182">j</span><span class="op" id="3516183">+</span><span class="num" id="3516184">1</span><span class="op" id="3516185">]</span>&nbsp;<span class="op" id="3516187">=</span>&nbsp;<span class="string" id="3516189">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3516207">[</span><span class="ident" id="3516208">c</span><span class="op" id="3516209">&gt;&gt;</span><span class="num" id="3516211">4</span><span class="op" id="3516212">]</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3516217">t</span><span class="op" id="3516218">[</span><span class="ident" id="3516219">j</span><span class="op" id="3516220">+</span><span class="num" id="3516221">2</span><span class="op" id="3516222">]</span>&nbsp;<span class="op" id="3516224">=</span>&nbsp;<span class="string" id="3516226">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3516244">[</span><span class="ident" id="3516245">c</span><span class="op" id="3516246">&amp;</span><span class="num" id="3516247">15</span><span class="op" id="3516249">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3516254">j</span>&nbsp;<span class="op" id="3516256">+=</span>&nbsp;<span class="num" id="3516259">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3516263">default</span><span class="op" id="3516270">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3516275">t</span><span class="op" id="3516276">[</span><span class="ident" id="3516277">j</span><span class="op" id="3516278">]</span>&nbsp;<span class="op" id="3516280">=</span>&nbsp;<span class="ident" id="3516282">s</span><span class="op" id="3516283">[</span><span class="ident" id="3516284">i</span><span class="op" id="3516285">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3516290">j</span><span class="op" id="3516291">++</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3516296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3516299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3516302">return</span>&nbsp;<span class="builtintype" id="3516309">string</span><span class="op" id="3516315">(</span><span class="ident" id="3516316">t</span><span class="op" id="3516317">)</span><br>
<span class="lineno"></span><span class="op" id="3516319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="3516322">//&nbsp;A&nbsp;URL&nbsp;represents&nbsp;a&nbsp;parsed&nbsp;URL&nbsp;(technically,&nbsp;a&nbsp;URI&nbsp;reference).</span><br>
<span class="lineno"></span><span class="comment" id="3516387">//&nbsp;The&nbsp;general&nbsp;form&nbsp;represented&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3516423">//</span><br>
<span class="lineno"></span><span class="comment" id="3516426">//&nbsp;&nbsp;&nbsp;&nbspscheme://[userinfo@]host/path[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3516478">//</span><br>
<span class="lineno">220</span><span class="comment" id="3516481">//&nbsp;URLs&nbsp;that&nbsp;do&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;slash&nbsp;after&nbsp;the&nbsp;scheme&nbsp;are&nbsp;interpreted&nbsp;as:</span><br>
<span class="lineno"></span><span class="comment" id="3516557">//</span><br>
<span class="lineno"></span><span class="comment" id="3516560">//&nbsp;&nbsp;&nbsp;&nbspscheme:opaque[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3516596">//</span><br>
<span class="lineno"></span><span class="comment" id="3516599">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;Path&nbsp;field&nbsp;is&nbsp;stored&nbsp;in&nbsp;decoded&nbsp;form:&nbsp;/%47%6f%2f&nbsp;becomes&nbsp;/Go/.</span><br>
<span class="lineno">225</span><span class="comment" id="3516679">//&nbsp;A&nbsp;consequence&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;impossible&nbsp;to&nbsp;tell&nbsp;which&nbsp;slashes&nbsp;in&nbsp;the&nbsp;Path&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="3516760">//&nbsp;slashes&nbsp;in&nbsp;the&nbsp;raw&nbsp;URL&nbsp;and&nbsp;which&nbsp;were&nbsp;%2f.&nbsp;This&nbsp;distinction&nbsp;is&nbsp;rarely&nbsp;important,</span><br>
<span class="lineno"></span><span class="comment" id="3516844">//&nbsp;but&nbsp;when&nbsp;it&nbsp;is&nbsp;a&nbsp;client&nbsp;must&nbsp;use&nbsp;other&nbsp;routines&nbsp;to&nbsp;parse&nbsp;the&nbsp;raw&nbsp;URL&nbsp;or&nbsp;construct</span><br>
<span class="lineno"></span><span class="comment" id="3516929">//&nbsp;the&nbsp;parsed&nbsp;URL.&nbsp;For&nbsp;example,&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;consult&nbsp;req.RequestURI,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3517008">//&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;can&nbsp;use&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Opaque:&nbsp;&#34;//example.com/Go%2f&#34;}</span><br>
<span class="lineno">230</span><span class="comment" id="3517090">//&nbsp;instead&nbsp;of&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Path:&nbsp;&#34;/Go/&#34;}.</span><br>
<span class="lineno"></span><span class="keyword" id="3517144">type</span>&nbsp;<span class="ident" id="3517149">URL</span>&nbsp;<span class="keyword" id="3517153">struct</span>&nbsp;<span class="op" id="3517160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3517163">Scheme</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3517172">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3517180">Opaque</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3517189">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517199">//&nbsp;encoded&nbsp;opaque&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3517223">User</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3517232">*</span><span class="ident" id="3517233">Userinfo</span>&nbsp;<span class="comment" id="3517242">//&nbsp;username&nbsp;and&nbsp;password&nbsp;information</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3517280">Host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3517289">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517299">//&nbsp;host&nbsp;or&nbsp;host:port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3517321">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3517330">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3517338">RawQuery</span>&nbsp;<span class="builtintype" id="3517347">string</span>&nbsp;<span class="comment" id="3517354">//&nbsp;encoded&nbsp;query&nbsp;values,&nbsp;without&nbsp;&#39;?&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3517392">Fragment</span>&nbsp;<span class="builtintype" id="3517401">string</span>&nbsp;<span class="comment" id="3517408">//&nbsp;fragment&nbsp;for&nbsp;references,&nbsp;without&nbsp;&#39;#&#39;</span><br>
<span class="lineno"></span><span class="op" id="3517448">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="3517451">//&nbsp;User&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3517511">//&nbsp;and&nbsp;no&nbsp;password&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3517535">func</span>&nbsp;<span class="ident" id="3517540">User</span><span class="op" id="3517544">(</span><span class="ident" id="3517545">username</span>&nbsp;<span class="builtintype" id="3517554">string</span><span class="op" id="3517560">)</span>&nbsp;<span class="op" id="3517562">*</span><span class="ident" id="3517563">Userinfo</span>&nbsp;<span class="op" id="3517572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3517575">return</span>&nbsp;<span class="op" id="3517582">&amp;</span><span class="ident" id="3517583">Userinfo</span><span class="op" id="3517591">{</span><span class="ident" id="3517592">username</span><span class="op" id="3517600">,</span>&nbsp;<span class="string" id="3517602">&#34;&#34;</span><span class="op" id="3517604">,</span>&nbsp;<span class="builtintype" id="3517606">false</span><span class="op" id="3517611">}</span><br>
<span class="lineno">245</span><span class="op" id="3517613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3517616">//&nbsp;UserPassword&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3517684">//&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="3517701">//&nbsp;This&nbsp;functionality&nbsp;should&nbsp;only&nbsp;be&nbsp;used&nbsp;with&nbsp;legacy&nbsp;web&nbsp;sites.</span><br>
<span class="lineno">250</span><span class="comment" id="3517766">//&nbsp;RFC&nbsp;2396&nbsp;warns&nbsp;that&nbsp;interpreting&nbsp;Userinfo&nbsp;this&nbsp;way</span><br>
<span class="lineno"></span><span class="comment" id="3517820">//&nbsp;``is&nbsp;NOT&nbsp;RECOMMENDED,&nbsp;because&nbsp;the&nbsp;passing&nbsp;of&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="3517883">//&nbsp;information&nbsp;in&nbsp;clear&nbsp;text&nbsp;(such&nbsp;as&nbsp;URI)&nbsp;has&nbsp;proven&nbsp;to&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3517945">//&nbsp;security&nbsp;risk&nbsp;in&nbsp;almost&nbsp;every&nbsp;case&nbsp;where&nbsp;it&nbsp;has&nbsp;been&nbsp;used.&#39;&#39;</span><br>
<span class="lineno"></span><span class="keyword" id="3518009">func</span>&nbsp;<span class="ident" id="3518014">UserPassword</span><span class="op" id="3518026">(</span><span class="ident" id="3518027">username</span><span class="op" id="3518035">,</span>&nbsp;<span class="ident" id="3518037">password</span>&nbsp;<span class="builtintype" id="3518046">string</span><span class="op" id="3518052">)</span>&nbsp;<span class="op" id="3518054">*</span><span class="ident" id="3518055">Userinfo</span>&nbsp;<span class="op" id="3518064">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3518067">return</span>&nbsp;<span class="op" id="3518074">&amp;</span><span class="ident" id="3518075">Userinfo</span><span class="op" id="3518083">{</span><span class="ident" id="3518084">username</span><span class="op" id="3518092">,</span>&nbsp;<span class="ident" id="3518094">password</span><span class="op" id="3518102">,</span>&nbsp;<span class="builtintype" id="3518104">true</span><span class="op" id="3518108">}</span><br>
<span class="lineno"></span><span class="op" id="3518110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3518113">//&nbsp;The&nbsp;Userinfo&nbsp;type&nbsp;is&nbsp;an&nbsp;immutable&nbsp;encapsulation&nbsp;of&nbsp;username&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3518180">//&nbsp;password&nbsp;details&nbsp;for&nbsp;a&nbsp;URL.&nbsp;An&nbsp;existing&nbsp;Userinfo&nbsp;value&nbsp;is&nbsp;guaranteed</span><br>
<span class="lineno">260</span><span class="comment" id="3518252">//&nbsp;to&nbsp;have&nbsp;a&nbsp;username&nbsp;set&nbsp;(potentially&nbsp;empty,&nbsp;as&nbsp;allowed&nbsp;by&nbsp;RFC&nbsp;2396),</span><br>
<span class="lineno"></span><span class="comment" id="3518323">//&nbsp;and&nbsp;optionally&nbsp;a&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="3518353">type</span>&nbsp;<span class="ident" id="3518358">Userinfo</span>&nbsp;<span class="keyword" id="3518367">struct</span>&nbsp;<span class="op" id="3518374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3518377">username</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3518389">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3518397">password</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3518409">string</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3518417">passwordSet</span>&nbsp;<span class="builtintype" id="3518429">bool</span><br>
<span class="lineno"></span><span class="op" id="3518434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3518437">//&nbsp;Username&nbsp;returns&nbsp;the&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="3518471">func</span>&nbsp;<span class="op" id="3518476">(</span><span class="ident" id="3518477">u</span>&nbsp;<span class="op" id="3518479">*</span><span class="ident" id="3518480">Userinfo</span><span class="op" id="3518488">)</span>&nbsp;<span class="ident" id="3518490">Username</span><span class="op" id="3518498">(</span><span class="op" id="3518499">)</span>&nbsp;<span class="builtintype" id="3518501">string</span>&nbsp;<span class="op" id="3518508">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3518511">return</span>&nbsp;<span class="ident" id="3518518">u</span><span class="op" id="3518519">.</span><span class="ident" id="3518520">username</span><br>
<span class="lineno"></span><span class="op" id="3518529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3518532">//&nbsp;Password&nbsp;returns&nbsp;the&nbsp;password&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;set,&nbsp;and&nbsp;whether&nbsp;it&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3518607">func</span>&nbsp;<span class="op" id="3518612">(</span><span class="ident" id="3518613">u</span>&nbsp;<span class="op" id="3518615">*</span><span class="ident" id="3518616">Userinfo</span><span class="op" id="3518624">)</span>&nbsp;<span class="ident" id="3518626">Password</span><span class="op" id="3518634">(</span><span class="op" id="3518635">)</span>&nbsp;<span class="op" id="3518637">(</span><span class="builtintype" id="3518638">string</span><span class="op" id="3518644">,</span>&nbsp;<span class="builtintype" id="3518646">bool</span><span class="op" id="3518650">)</span>&nbsp;<span class="op" id="3518652">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3518655">if</span>&nbsp;<span class="ident" id="3518658">u</span><span class="op" id="3518659">.</span><span class="ident" id="3518660">passwordSet</span>&nbsp;<span class="op" id="3518672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3518676">return</span>&nbsp;<span class="ident" id="3518683">u</span><span class="op" id="3518684">.</span><span class="ident" id="3518685">password</span><span class="op" id="3518693">,</span>&nbsp;<span class="builtintype" id="3518695">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3518701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3518704">return</span>&nbsp;<span class="string" id="3518711">&#34;&#34;</span><span class="op" id="3518713">,</span>&nbsp;<span class="builtintype" id="3518715">false</span><br>
<span class="lineno"></span><span class="op" id="3518721">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3518724">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;userinfo&nbsp;information&nbsp;in&nbsp;the&nbsp;standard&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3518796">//&nbsp;of&nbsp;&#34;username[:password]&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3518825">func</span>&nbsp;<span class="op" id="3518830">(</span><span class="ident" id="3518831">u</span>&nbsp;<span class="op" id="3518833">*</span><span class="ident" id="3518834">Userinfo</span><span class="op" id="3518842">)</span>&nbsp;<span class="ident" id="3518844">String</span><span class="op" id="3518850">(</span><span class="op" id="3518851">)</span>&nbsp;<span class="builtintype" id="3518853">string</span>&nbsp;<span class="op" id="3518860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3518863">s</span>&nbsp;<span class="op" id="3518865">:=</span>&nbsp;<span class="ident" id="3518868">escape</span><span class="op" id="3518874">(</span><span class="ident" id="3518875">u</span><span class="op" id="3518876">.</span><span class="ident" id="3518877">username</span><span class="op" id="3518885">,</span>&nbsp;<span class="ident" id="3518887">encodeUserPassword</span><span class="op" id="3518905">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3518908">if</span>&nbsp;<span class="ident" id="3518911">u</span><span class="op" id="3518912">.</span><span class="ident" id="3518913">passwordSet</span>&nbsp;<span class="op" id="3518925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3518929">s</span>&nbsp;<span class="op" id="3518931">+=</span>&nbsp;<span class="string" id="3518934">&#34;:&#34;</span>&nbsp;<span class="op" id="3518938">+</span>&nbsp;<span class="ident" id="3518940">escape</span><span class="op" id="3518946">(</span><span class="ident" id="3518947">u</span><span class="op" id="3518948">.</span><span class="ident" id="3518949">password</span><span class="op" id="3518957">,</span>&nbsp;<span class="ident" id="3518959">encodeUserPassword</span><span class="op" id="3518977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3518980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3518983">return</span>&nbsp;<span class="ident" id="3518990">s</span><br>
<span class="lineno"></span><span class="op" id="3518992">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span><span class="comment" id="3518995">//&nbsp;Maybe&nbsp;rawurl&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;scheme:path.</span><br>
<span class="lineno"></span><span class="comment" id="3519039">//&nbsp;(Scheme&nbsp;must&nbsp;be&nbsp;[a-zA-Z][a-zA-Z0-9+-.]*)</span><br>
<span class="lineno"></span><span class="comment" id="3519083">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;scheme,&nbsp;path;&nbsp;else&nbsp;return&nbsp;&#34;&#34;,&nbsp;rawurl.</span><br>
<span class="lineno"></span><span class="keyword" id="3519138">func</span>&nbsp;<span class="ident" id="3519143">getscheme</span><span class="op" id="3519152">(</span><span class="ident" id="3519153">rawurl</span>&nbsp;<span class="builtintype" id="3519160">string</span><span class="op" id="3519166">)</span>&nbsp;<span class="op" id="3519168">(</span><span class="ident" id="3519169">scheme</span><span class="op" id="3519175">,</span>&nbsp;<span class="ident" id="3519177">path</span>&nbsp;<span class="builtintype" id="3519182">string</span><span class="op" id="3519188">,</span>&nbsp;<span class="ident" id="3519190">err</span>&nbsp;<span class="builtintype" id="3519194">error</span><span class="op" id="3519199">)</span>&nbsp;<span class="op" id="3519201">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519204">for</span>&nbsp;<span class="ident" id="3519208">i</span>&nbsp;<span class="op" id="3519210">:=</span>&nbsp;<span class="num" id="3519213">0</span><span class="op" id="3519214">;</span>&nbsp;<span class="ident" id="3519216">i</span>&nbsp;<span class="op" id="3519218">&lt;</span>&nbsp;<span class="builtinfunc" id="3519220">len</span><span class="op" id="3519223">(</span><span class="ident" id="3519224">rawurl</span><span class="op" id="3519230">)</span><span class="op" id="3519231">;</span>&nbsp;<span class="ident" id="3519233">i</span><span class="op" id="3519234">++</span>&nbsp;<span class="op" id="3519237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3519241">c</span>&nbsp;<span class="op" id="3519243">:=</span>&nbsp;<span class="ident" id="3519246">rawurl</span><span class="op" id="3519252">[</span><span class="ident" id="3519253">i</span><span class="op" id="3519254">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519258">switch</span>&nbsp;<span class="op" id="3519265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519269">case</span>&nbsp;<span class="string" id="3519274">&#39;a&#39;</span>&nbsp;<span class="op" id="3519278">&lt;=</span>&nbsp;<span class="ident" id="3519281">c</span>&nbsp;<span class="op" id="3519283">&amp;&amp;</span>&nbsp;<span class="ident" id="3519286">c</span>&nbsp;<span class="op" id="3519288">&lt;=</span>&nbsp;<span class="string" id="3519291">&#39;z&#39;</span>&nbsp;<span class="op" id="3519295">||</span>&nbsp;<span class="string" id="3519298">&#39;A&#39;</span>&nbsp;<span class="op" id="3519302">&lt;=</span>&nbsp;<span class="ident" id="3519305">c</span>&nbsp;<span class="op" id="3519307">&amp;&amp;</span>&nbsp;<span class="ident" id="3519310">c</span>&nbsp;<span class="op" id="3519312">&lt;=</span>&nbsp;<span class="string" id="3519315">&#39;Z&#39;</span><span class="op" id="3519318">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519322">//&nbsp;do&nbsp;nothing</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519338">case</span>&nbsp;<span class="string" id="3519343">&#39;0&#39;</span>&nbsp;<span class="op" id="3519347">&lt;=</span>&nbsp;<span class="ident" id="3519350">c</span>&nbsp;<span class="op" id="3519352">&amp;&amp;</span>&nbsp;<span class="ident" id="3519355">c</span>&nbsp;<span class="op" id="3519357">&lt;=</span>&nbsp;<span class="string" id="3519360">&#39;9&#39;</span>&nbsp;<span class="op" id="3519364">||</span>&nbsp;<span class="ident" id="3519367">c</span>&nbsp;<span class="op" id="3519369">==</span>&nbsp;<span class="string" id="3519372">&#39;+&#39;</span>&nbsp;<span class="op" id="3519376">||</span>&nbsp;<span class="ident" id="3519379">c</span>&nbsp;<span class="op" id="3519381">==</span>&nbsp;<span class="string" id="3519384">&#39;-&#39;</span>&nbsp;<span class="op" id="3519388">||</span>&nbsp;<span class="ident" id="3519391">c</span>&nbsp;<span class="op" id="3519393">==</span>&nbsp;<span class="string" id="3519396">&#39;.&#39;</span><span class="op" id="3519399">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519404">if</span>&nbsp;<span class="ident" id="3519407">i</span>&nbsp;<span class="op" id="3519409">==</span>&nbsp;<span class="num" id="3519412">0</span>&nbsp;<span class="op" id="3519414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519420">return</span>&nbsp;<span class="string" id="3519427">&#34;&#34;</span><span class="op" id="3519429">,</span>&nbsp;<span class="ident" id="3519431">rawurl</span><span class="op" id="3519437">,</span>&nbsp;<span class="ident" id="3519439">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3519446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519450">case</span>&nbsp;<span class="ident" id="3519455">c</span>&nbsp;<span class="op" id="3519457">==</span>&nbsp;<span class="string" id="3519460">&#39;:&#39;</span><span class="op" id="3519463">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519468">if</span>&nbsp;<span class="ident" id="3519471">i</span>&nbsp;<span class="op" id="3519473">==</span>&nbsp;<span class="num" id="3519476">0</span>&nbsp;<span class="op" id="3519478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519484">return</span>&nbsp;<span class="string" id="3519491">&#34;&#34;</span><span class="op" id="3519493">,</span>&nbsp;<span class="string" id="3519495">&#34;&#34;</span><span class="op" id="3519497">,</span>&nbsp;<span class="ident" id="3519499">errors</span><span class="op" id="3519505">.</span><span class="ident" id="3519506">New</span><span class="op" id="3519509">(</span><span class="string" id="3519510">&#34;missing&nbsp;protocol&nbsp;scheme&#34;</span><span class="op" id="3519535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3519540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519545">return</span>&nbsp;<span class="ident" id="3519552">rawurl</span><span class="op" id="3519558">[</span><span class="num" id="3519559">0</span><span class="op" id="3519560">:</span><span class="ident" id="3519561">i</span><span class="op" id="3519562">]</span><span class="op" id="3519563">,</span>&nbsp;<span class="ident" id="3519565">rawurl</span><span class="op" id="3519571">[</span><span class="ident" id="3519572">i</span><span class="op" id="3519573">+</span><span class="num" id="3519574">1</span><span class="op" id="3519575">:</span><span class="op" id="3519576">]</span><span class="op" id="3519577">,</span>&nbsp;<span class="ident" id="3519579">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519585">default</span><span class="op" id="3519592">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519597">//&nbsp;we&nbsp;have&nbsp;encountered&nbsp;an&nbsp;invalid&nbsp;character,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519645">//&nbsp;so&nbsp;there&nbsp;is&nbsp;no&nbsp;valid&nbsp;scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519679">return</span>&nbsp;<span class="string" id="3519686">&#34;&#34;</span><span class="op" id="3519688">,</span>&nbsp;<span class="ident" id="3519690">rawurl</span><span class="op" id="3519696">,</span>&nbsp;<span class="ident" id="3519698">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3519704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3519707">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519710">return</span>&nbsp;<span class="string" id="3519717">&#34;&#34;</span><span class="op" id="3519719">,</span>&nbsp;<span class="ident" id="3519721">rawurl</span><span class="op" id="3519727">,</span>&nbsp;<span class="ident" id="3519729">nil</span><br>
<span class="lineno"></span><span class="op" id="3519733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3519736">//&nbsp;Maybe&nbsp;s&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;t&nbsp;c&nbsp;u.</span><br>
<span class="lineno"></span><span class="comment" id="3519769">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;t,&nbsp;c&nbsp;u&nbsp;(or&nbsp;t,&nbsp;u&nbsp;if&nbsp;cutc&nbsp;==&nbsp;true).</span><br>
<span class="lineno">320</span><span class="comment" id="3519820">//&nbsp;If&nbsp;not,&nbsp;return&nbsp;s,&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3519845">func</span>&nbsp;<span class="ident" id="3519850">split</span><span class="op" id="3519855">(</span><span class="ident" id="3519856">s</span>&nbsp;<span class="builtintype" id="3519858">string</span><span class="op" id="3519864">,</span>&nbsp;<span class="ident" id="3519866">c</span>&nbsp;<span class="builtintype" id="3519868">string</span><span class="op" id="3519874">,</span>&nbsp;<span class="ident" id="3519876">cutc</span>&nbsp;<span class="builtintype" id="3519881">bool</span><span class="op" id="3519885">)</span>&nbsp;<span class="op" id="3519887">(</span><span class="builtintype" id="3519888">string</span><span class="op" id="3519894">,</span>&nbsp;<span class="builtintype" id="3519896">string</span><span class="op" id="3519902">)</span>&nbsp;<span class="op" id="3519904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3519907">i</span>&nbsp;<span class="op" id="3519909">:=</span>&nbsp;<span class="ident" id="3519912">strings</span><span class="op" id="3519919">.</span><span class="ident" id="3519920">Index</span><span class="op" id="3519925">(</span><span class="ident" id="3519926">s</span><span class="op" id="3519927">,</span>&nbsp;<span class="ident" id="3519929">c</span><span class="op" id="3519930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519933">if</span>&nbsp;<span class="ident" id="3519936">i</span>&nbsp;<span class="op" id="3519938">&lt;</span>&nbsp;<span class="num" id="3519940">0</span>&nbsp;<span class="op" id="3519942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519946">return</span>&nbsp;<span class="ident" id="3519953">s</span><span class="op" id="3519954">,</span>&nbsp;<span class="string" id="3519956">&#34;&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3519960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519963">if</span>&nbsp;<span class="ident" id="3519966">cutc</span>&nbsp;<span class="op" id="3519971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3519975">return</span>&nbsp;<span class="ident" id="3519982">s</span><span class="op" id="3519983">[</span><span class="num" id="3519984">0</span><span class="op" id="3519985">:</span><span class="ident" id="3519986">i</span><span class="op" id="3519987">]</span><span class="op" id="3519988">,</span>&nbsp;<span class="ident" id="3519990">s</span><span class="op" id="3519991">[</span><span class="ident" id="3519992">i</span><span class="op" id="3519993">+</span><span class="builtinfunc" id="3519994">len</span><span class="op" id="3519997">(</span><span class="ident" id="3519998">c</span><span class="op" id="3519999">)</span><span class="op" id="3520000">:</span><span class="op" id="3520001">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3520004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3520007">return</span>&nbsp;<span class="ident" id="3520014">s</span><span class="op" id="3520015">[</span><span class="num" id="3520016">0</span><span class="op" id="3520017">:</span><span class="ident" id="3520018">i</span><span class="op" id="3520019">]</span><span class="op" id="3520020">,</span>&nbsp;<span class="ident" id="3520022">s</span><span class="op" id="3520023">[</span><span class="ident" id="3520024">i</span><span class="op" id="3520025">:</span><span class="op" id="3520026">]</span><br>
<span class="lineno">330</span><span class="op" id="3520028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3520031">//&nbsp;Parse&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="3520076">//&nbsp;The&nbsp;rawurl&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3520119">func</span>&nbsp;<span class="ident" id="3520124">Parse</span><span class="op" id="3520129">(</span><span class="ident" id="3520130">rawurl</span>&nbsp;<span class="builtintype" id="3520137">string</span><span class="op" id="3520143">)</span>&nbsp;<span class="op" id="3520145">(</span><span class="ident" id="3520146">url</span>&nbsp;<span class="op" id="3520150">*</span><span class="ident" id="3520151">URL</span><span class="op" id="3520154">,</span>&nbsp;<span class="ident" id="3520156">err</span>&nbsp;<span class="builtintype" id="3520160">error</span><span class="op" id="3520165">)</span>&nbsp;<span class="op" id="3520167">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3520170">//&nbsp;Cut&nbsp;off&nbsp;#frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3520188">u</span><span class="op" id="3520189">,</span>&nbsp;<span class="ident" id="3520191">frag</span>&nbsp;<span class="op" id="3520196">:=</span>&nbsp;<span class="ident" id="3520199">split</span><span class="op" id="3520204">(</span><span class="ident" id="3520205">rawurl</span><span class="op" id="3520211">,</span>&nbsp;<span class="string" id="3520213">&#34;#&#34;</span><span class="op" id="3520216">,</span>&nbsp;<span class="builtintype" id="3520218">true</span><span class="op" id="3520222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3520225">if</span>&nbsp;<span class="ident" id="3520228">url</span><span class="op" id="3520231">,</span>&nbsp;<span class="ident" id="3520233">err</span>&nbsp;<span class="op" id="3520237">=</span>&nbsp;<span class="ident" id="3520239">parse</span><span class="op" id="3520244">(</span><span class="ident" id="3520245">u</span><span class="op" id="3520246">,</span>&nbsp;<span class="builtintype" id="3520248">false</span><span class="op" id="3520253">)</span><span class="op" id="3520254">;</span>&nbsp;<span class="ident" id="3520256">err</span>&nbsp;<span class="op" id="3520260">!=</span>&nbsp;<span class="ident" id="3520263">nil</span>&nbsp;<span class="op" id="3520267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3520271">return</span>&nbsp;<span class="ident" id="3520278">nil</span><span class="op" id="3520281">,</span>&nbsp;<span class="ident" id="3520283">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3520288">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3520291">if</span>&nbsp;<span class="ident" id="3520294">frag</span>&nbsp;<span class="op" id="3520299">==</span>&nbsp;<span class="string" id="3520302">&#34;&#34;</span>&nbsp;<span class="op" id="3520305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3520309">return</span>&nbsp;<span class="ident" id="3520316">url</span><span class="op" id="3520319">,</span>&nbsp;<span class="ident" id="3520321">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3520326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3520329">if</span>&nbsp;<span class="ident" id="3520332">url</span><span class="op" id="3520335">.</span><span class="ident" id="3520336">Fragment</span><span class="op" id="3520344">,</span>&nbsp;<span class="ident" id="3520346">err</span>&nbsp;<span class="op" id="3520350">=</span>&nbsp;<span class="ident" id="3520352">unescape</span><span class="op" id="3520360">(</span><span class="ident" id="3520361">frag</span><span class="op" id="3520365">,</span>&nbsp;<span class="ident" id="3520367">encodeFragment</span><span class="op" id="3520381">)</span><span class="op" id="3520382">;</span>&nbsp;<span class="ident" id="3520384">err</span>&nbsp;<span class="op" id="3520388">!=</span>&nbsp;<span class="ident" id="3520391">nil</span>&nbsp;<span class="op" id="3520395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3520399">return</span>&nbsp;<span class="ident" id="3520406">nil</span><span class="op" id="3520409">,</span>&nbsp;<span class="op" id="3520411">&amp;</span><span class="ident" id="3520412">Error</span><span class="op" id="3520417">{</span><span class="string" id="3520418">&#34;parse&#34;</span><span class="op" id="3520425">,</span>&nbsp;<span class="ident" id="3520427">rawurl</span><span class="op" id="3520433">,</span>&nbsp;<span class="ident" id="3520435">err</span><span class="op" id="3520438">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3520441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3520444">return</span>&nbsp;<span class="ident" id="3520451">url</span><span class="op" id="3520454">,</span>&nbsp;<span class="ident" id="3520456">nil</span><br>
<span class="lineno"></span><span class="op" id="3520460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3520463">//&nbsp;ParseRequestURI&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.&nbsp;&nbsp;It&nbsp;assumes&nbsp;that</span><br>
<span class="lineno">350</span><span class="comment" id="3520535">//&nbsp;rawurl&nbsp;was&nbsp;received&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request,&nbsp;so&nbsp;the&nbsp;rawurl&nbsp;is&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="3520607">//&nbsp;only&nbsp;as&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;or&nbsp;an&nbsp;absolute&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3520655">//&nbsp;The&nbsp;string&nbsp;rawurl&nbsp;is&nbsp;assumed&nbsp;not&nbsp;to&nbsp;have&nbsp;a&nbsp;#fragment&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="comment" id="3520719">//&nbsp;(Web&nbsp;browsers&nbsp;strip&nbsp;#fragment&nbsp;before&nbsp;sending&nbsp;the&nbsp;URL&nbsp;to&nbsp;a&nbsp;web&nbsp;server.)</span><br>
<span class="lineno"></span><span class="keyword" id="3520793">func</span>&nbsp;<span class="ident" id="3520798">ParseRequestURI</span><span class="op" id="3520813">(</span><span class="ident" id="3520814">rawurl</span>&nbsp;<span class="builtintype" id="3520821">string</span><span class="op" id="3520827">)</span>&nbsp;<span class="op" id="3520829">(</span><span class="ident" id="3520830">url</span>&nbsp;<span class="op" id="3520834">*</span><span class="ident" id="3520835">URL</span><span class="op" id="3520838">,</span>&nbsp;<span class="ident" id="3520840">err</span>&nbsp;<span class="builtintype" id="3520844">error</span><span class="op" id="3520849">)</span>&nbsp;<span class="op" id="3520851">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3520854">return</span>&nbsp;<span class="ident" id="3520861">parse</span><span class="op" id="3520866">(</span><span class="ident" id="3520867">rawurl</span><span class="op" id="3520873">,</span>&nbsp;<span class="builtintype" id="3520875">true</span><span class="op" id="3520879">)</span><br>
<span class="lineno"></span><span class="op" id="3520881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3520884">//&nbsp;parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;from&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;two&nbsp;contexts.&nbsp;&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3520948">//&nbsp;viaRequest&nbsp;is&nbsp;true,&nbsp;the&nbsp;URL&nbsp;is&nbsp;assumed&nbsp;to&nbsp;have&nbsp;arrived&nbsp;via&nbsp;an&nbsp;HTTP&nbsp;request,</span><br>
<span class="lineno">360</span><span class="comment" id="3521027">//&nbsp;in&nbsp;which&nbsp;case&nbsp;only&nbsp;absolute&nbsp;URLs&nbsp;or&nbsp;path-absolute&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="3521107">//&nbsp;If&nbsp;viaRequest&nbsp;is&nbsp;false,&nbsp;all&nbsp;forms&nbsp;of&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="keyword" id="3521174">func</span>&nbsp;<span class="ident" id="3521179">parse</span><span class="op" id="3521184">(</span><span class="ident" id="3521185">rawurl</span>&nbsp;<span class="builtintype" id="3521192">string</span><span class="op" id="3521198">,</span>&nbsp;<span class="ident" id="3521200">viaRequest</span>&nbsp;<span class="builtintype" id="3521211">bool</span><span class="op" id="3521215">)</span>&nbsp;<span class="op" id="3521217">(</span><span class="ident" id="3521218">url</span>&nbsp;<span class="op" id="3521222">*</span><span class="ident" id="3521223">URL</span><span class="op" id="3521226">,</span>&nbsp;<span class="ident" id="3521228">err</span>&nbsp;<span class="builtintype" id="3521232">error</span><span class="op" id="3521237">)</span>&nbsp;<span class="op" id="3521239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521242">var</span>&nbsp;<span class="ident" id="3521246">rest</span>&nbsp;<span class="builtintype" id="3521251">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521260">if</span>&nbsp;<span class="ident" id="3521263">rawurl</span>&nbsp;<span class="op" id="3521270">==</span>&nbsp;<span class="string" id="3521273">&#34;&#34;</span>&nbsp;<span class="op" id="3521276">&amp;&amp;</span>&nbsp;<span class="ident" id="3521279">viaRequest</span>&nbsp;<span class="op" id="3521290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521294">err</span>&nbsp;<span class="op" id="3521298">=</span>&nbsp;<span class="ident" id="3521300">errors</span><span class="op" id="3521306">.</span><span class="ident" id="3521307">New</span><span class="op" id="3521310">(</span><span class="string" id="3521311">&#34;empty&nbsp;url&#34;</span><span class="op" id="3521322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521326">goto</span>&nbsp;<span class="ident" id="3521331">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3521338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521341">url</span>&nbsp;<span class="op" id="3521345">=</span>&nbsp;<span class="builtinfunc" id="3521347">new</span><span class="op" id="3521350">(</span><span class="ident" id="3521351">URL</span><span class="op" id="3521354">)</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521358">if</span>&nbsp;<span class="ident" id="3521361">rawurl</span>&nbsp;<span class="op" id="3521368">==</span>&nbsp;<span class="string" id="3521371">&#34;*&#34;</span>&nbsp;<span class="op" id="3521375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521379">url</span><span class="op" id="3521382">.</span><span class="ident" id="3521383">Path</span>&nbsp;<span class="op" id="3521388">=</span>&nbsp;<span class="string" id="3521390">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521396">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3521404">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3521408">//&nbsp;Split&nbsp;off&nbsp;possible&nbsp;leading&nbsp;&#34;http:&#34;,&nbsp;&#34;mailto:&#34;,&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3521464">//&nbsp;Cannot&nbsp;contain&nbsp;escaped&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521503">if</span>&nbsp;<span class="ident" id="3521506">url</span><span class="op" id="3521509">.</span><span class="ident" id="3521510">Scheme</span><span class="op" id="3521516">,</span>&nbsp;<span class="ident" id="3521518">rest</span><span class="op" id="3521522">,</span>&nbsp;<span class="ident" id="3521524">err</span>&nbsp;<span class="op" id="3521528">=</span>&nbsp;<span class="ident" id="3521530">getscheme</span><span class="op" id="3521539">(</span><span class="ident" id="3521540">rawurl</span><span class="op" id="3521546">)</span><span class="op" id="3521547">;</span>&nbsp;<span class="ident" id="3521549">err</span>&nbsp;<span class="op" id="3521553">!=</span>&nbsp;<span class="ident" id="3521556">nil</span>&nbsp;<span class="op" id="3521560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521564">goto</span>&nbsp;<span class="ident" id="3521569">Error</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3521576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521579">url</span><span class="op" id="3521582">.</span><span class="ident" id="3521583">Scheme</span>&nbsp;<span class="op" id="3521590">=</span>&nbsp;<span class="ident" id="3521592">strings</span><span class="op" id="3521599">.</span><span class="ident" id="3521600">ToLower</span><span class="op" id="3521607">(</span><span class="ident" id="3521608">url</span><span class="op" id="3521611">.</span><span class="ident" id="3521612">Scheme</span><span class="op" id="3521618">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521622">rest</span><span class="op" id="3521626">,</span>&nbsp;<span class="ident" id="3521628">url</span><span class="op" id="3521631">.</span><span class="ident" id="3521632">RawQuery</span>&nbsp;<span class="op" id="3521641">=</span>&nbsp;<span class="ident" id="3521643">split</span><span class="op" id="3521648">(</span><span class="ident" id="3521649">rest</span><span class="op" id="3521653">,</span>&nbsp;<span class="string" id="3521655">&#34;?&#34;</span><span class="op" id="3521658">,</span>&nbsp;<span class="builtintype" id="3521660">true</span><span class="op" id="3521664">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521668">if</span>&nbsp;<span class="op" id="3521671">!</span><span class="ident" id="3521672">strings</span><span class="op" id="3521679">.</span><span class="ident" id="3521680">HasPrefix</span><span class="op" id="3521689">(</span><span class="ident" id="3521690">rest</span><span class="op" id="3521694">,</span>&nbsp;<span class="string" id="3521696">&#34;/&#34;</span><span class="op" id="3521699">)</span>&nbsp;<span class="op" id="3521701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521705">if</span>&nbsp;<span class="ident" id="3521708">url</span><span class="op" id="3521711">.</span><span class="ident" id="3521712">Scheme</span>&nbsp;<span class="op" id="3521719">!=</span>&nbsp;<span class="string" id="3521722">&#34;&#34;</span>&nbsp;<span class="op" id="3521725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3521730">//&nbsp;We&nbsp;consider&nbsp;rootless&nbsp;paths&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;as&nbsp;opaque.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521787">url</span><span class="op" id="3521790">.</span><span class="ident" id="3521791">Opaque</span>&nbsp;<span class="op" id="3521798">=</span>&nbsp;<span class="ident" id="3521800">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521808">return</span>&nbsp;<span class="ident" id="3521815">url</span><span class="op" id="3521818">,</span>&nbsp;<span class="ident" id="3521820">nil</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3521826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521830">if</span>&nbsp;<span class="ident" id="3521833">viaRequest</span>&nbsp;<span class="op" id="3521844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521849">err</span>&nbsp;<span class="op" id="3521853">=</span>&nbsp;<span class="ident" id="3521855">errors</span><span class="op" id="3521861">.</span><span class="ident" id="3521862">New</span><span class="op" id="3521865">(</span><span class="string" id="3521866">&#34;invalid&nbsp;URI&nbsp;for&nbsp;request&#34;</span><span class="op" id="3521891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521896">goto</span>&nbsp;<span class="ident" id="3521901">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3521909">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3521912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521916">if</span>&nbsp;<span class="op" id="3521919">(</span><span class="ident" id="3521920">url</span><span class="op" id="3521923">.</span><span class="ident" id="3521924">Scheme</span>&nbsp;<span class="op" id="3521931">!=</span>&nbsp;<span class="string" id="3521934">&#34;&#34;</span>&nbsp;<span class="op" id="3521937">||</span>&nbsp;<span class="op" id="3521940">!</span><span class="ident" id="3521941">viaRequest</span>&nbsp;<span class="op" id="3521952">&amp;&amp;</span>&nbsp;<span class="op" id="3521955">!</span><span class="ident" id="3521956">strings</span><span class="op" id="3521963">.</span><span class="ident" id="3521964">HasPrefix</span><span class="op" id="3521973">(</span><span class="ident" id="3521974">rest</span><span class="op" id="3521978">,</span>&nbsp;<span class="string" id="3521980">&#34;///&#34;</span><span class="op" id="3521985">)</span><span class="op" id="3521986">)</span>&nbsp;<span class="op" id="3521988">&amp;&amp;</span>&nbsp;<span class="ident" id="3521991">strings</span><span class="op" id="3521998">.</span><span class="ident" id="3521999">HasPrefix</span><span class="op" id="3522008">(</span><span class="ident" id="3522009">rest</span><span class="op" id="3522013">,</span>&nbsp;<span class="string" id="3522015">&#34;//&#34;</span><span class="op" id="3522019">)</span>&nbsp;<span class="op" id="3522021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522025">var</span>&nbsp;<span class="ident" id="3522029">authority</span>&nbsp;<span class="builtintype" id="3522039">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522048">authority</span><span class="op" id="3522057">,</span>&nbsp;<span class="ident" id="3522059">rest</span>&nbsp;<span class="op" id="3522064">=</span>&nbsp;<span class="ident" id="3522066">split</span><span class="op" id="3522071">(</span><span class="ident" id="3522072">rest</span><span class="op" id="3522076">[</span><span class="num" id="3522077">2</span><span class="op" id="3522078">:</span><span class="op" id="3522079">]</span><span class="op" id="3522080">,</span>&nbsp;<span class="string" id="3522082">&#34;/&#34;</span><span class="op" id="3522085">,</span>&nbsp;<span class="builtintype" id="3522087">false</span><span class="op" id="3522092">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522096">url</span><span class="op" id="3522099">.</span><span class="ident" id="3522100">User</span><span class="op" id="3522104">,</span>&nbsp;<span class="ident" id="3522106">url</span><span class="op" id="3522109">.</span><span class="ident" id="3522110">Host</span><span class="op" id="3522114">,</span>&nbsp;<span class="ident" id="3522116">err</span>&nbsp;<span class="op" id="3522120">=</span>&nbsp;<span class="ident" id="3522122">parseAuthority</span><span class="op" id="3522136">(</span><span class="ident" id="3522137">authority</span><span class="op" id="3522146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522150">if</span>&nbsp;<span class="ident" id="3522153">err</span>&nbsp;<span class="op" id="3522157">!=</span>&nbsp;<span class="ident" id="3522160">nil</span>&nbsp;<span class="op" id="3522164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522169">goto</span>&nbsp;<span class="ident" id="3522174">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522186">if</span>&nbsp;<span class="ident" id="3522189">strings</span><span class="op" id="3522196">.</span><span class="ident" id="3522197">Contains</span><span class="op" id="3522205">(</span><span class="ident" id="3522206">url</span><span class="op" id="3522209">.</span><span class="ident" id="3522210">Host</span><span class="op" id="3522214">,</span>&nbsp;<span class="string" id="3522216">&#34;%&#34;</span><span class="op" id="3522219">)</span>&nbsp;<span class="op" id="3522221">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522226">err</span>&nbsp;<span class="op" id="3522230">=</span>&nbsp;<span class="ident" id="3522232">errors</span><span class="op" id="3522238">.</span><span class="ident" id="3522239">New</span><span class="op" id="3522242">(</span><span class="string" id="3522243">&#34;hexadecimal&nbsp;escape&nbsp;in&nbsp;host&#34;</span><span class="op" id="3522271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522276">goto</span>&nbsp;<span class="ident" id="3522281">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522295">if</span>&nbsp;<span class="ident" id="3522298">url</span><span class="op" id="3522301">.</span><span class="ident" id="3522302">Path</span><span class="op" id="3522306">,</span>&nbsp;<span class="ident" id="3522308">err</span>&nbsp;<span class="op" id="3522312">=</span>&nbsp;<span class="ident" id="3522314">unescape</span><span class="op" id="3522322">(</span><span class="ident" id="3522323">rest</span><span class="op" id="3522327">,</span>&nbsp;<span class="ident" id="3522329">encodePath</span><span class="op" id="3522339">)</span><span class="op" id="3522340">;</span>&nbsp;<span class="ident" id="3522342">err</span>&nbsp;<span class="op" id="3522346">!=</span>&nbsp;<span class="ident" id="3522349">nil</span>&nbsp;<span class="op" id="3522353">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522357">goto</span>&nbsp;<span class="ident" id="3522362">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522372">return</span>&nbsp;<span class="ident" id="3522379">url</span><span class="op" id="3522382">,</span>&nbsp;<span class="ident" id="3522384">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3522389">Error</span><span class="op" id="3522394">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522397">return</span>&nbsp;<span class="ident" id="3522404">nil</span><span class="op" id="3522407">,</span>&nbsp;<span class="op" id="3522409">&amp;</span><span class="ident" id="3522410">Error</span><span class="op" id="3522415">{</span><span class="string" id="3522416">&#34;parse&#34;</span><span class="op" id="3522423">,</span>&nbsp;<span class="ident" id="3522425">rawurl</span><span class="op" id="3522431">,</span>&nbsp;<span class="ident" id="3522433">err</span><span class="op" id="3522436">}</span><br>
<span class="lineno"></span><span class="op" id="3522438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3522441">func</span>&nbsp;<span class="ident" id="3522446">parseAuthority</span><span class="op" id="3522460">(</span><span class="ident" id="3522461">authority</span>&nbsp;<span class="builtintype" id="3522471">string</span><span class="op" id="3522477">)</span>&nbsp;<span class="op" id="3522479">(</span><span class="ident" id="3522480">user</span>&nbsp;<span class="op" id="3522485">*</span><span class="ident" id="3522486">Userinfo</span><span class="op" id="3522494">,</span>&nbsp;<span class="ident" id="3522496">host</span>&nbsp;<span class="builtintype" id="3522501">string</span><span class="op" id="3522507">,</span>&nbsp;<span class="ident" id="3522509">err</span>&nbsp;<span class="builtintype" id="3522513">error</span><span class="op" id="3522518">)</span>&nbsp;<span class="op" id="3522520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522523">i</span>&nbsp;<span class="op" id="3522525">:=</span>&nbsp;<span class="ident" id="3522528">strings</span><span class="op" id="3522535">.</span><span class="ident" id="3522536">LastIndex</span><span class="op" id="3522545">(</span><span class="ident" id="3522546">authority</span><span class="op" id="3522555">,</span>&nbsp;<span class="string" id="3522557">&#34;@&#34;</span><span class="op" id="3522560">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522563">if</span>&nbsp;<span class="ident" id="3522566">i</span>&nbsp;<span class="op" id="3522568">&lt;</span>&nbsp;<span class="num" id="3522570">0</span>&nbsp;<span class="op" id="3522572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522576">host</span>&nbsp;<span class="op" id="3522581">=</span>&nbsp;<span class="ident" id="3522583">authority</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522595">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522606">userinfo</span><span class="op" id="3522614">,</span>&nbsp;<span class="ident" id="3522616">host</span>&nbsp;<span class="op" id="3522621">:=</span>&nbsp;<span class="ident" id="3522624">authority</span><span class="op" id="3522633">[</span><span class="op" id="3522634">:</span><span class="ident" id="3522635">i</span><span class="op" id="3522636">]</span><span class="op" id="3522637">,</span>&nbsp;<span class="ident" id="3522639">authority</span><span class="op" id="3522648">[</span><span class="ident" id="3522649">i</span><span class="op" id="3522650">+</span><span class="num" id="3522651">1</span><span class="op" id="3522652">:</span><span class="op" id="3522653">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522656">if</span>&nbsp;<span class="ident" id="3522659">strings</span><span class="op" id="3522666">.</span><span class="ident" id="3522667">Index</span><span class="op" id="3522672">(</span><span class="ident" id="3522673">userinfo</span><span class="op" id="3522681">,</span>&nbsp;<span class="string" id="3522683">&#34;:&#34;</span><span class="op" id="3522686">)</span>&nbsp;<span class="op" id="3522688">&lt;</span>&nbsp;<span class="num" id="3522690">0</span>&nbsp;<span class="op" id="3522692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522696">if</span>&nbsp;<span class="ident" id="3522699">userinfo</span><span class="op" id="3522707">,</span>&nbsp;<span class="ident" id="3522709">err</span>&nbsp;<span class="op" id="3522713">=</span>&nbsp;<span class="ident" id="3522715">unescape</span><span class="op" id="3522723">(</span><span class="ident" id="3522724">userinfo</span><span class="op" id="3522732">,</span>&nbsp;<span class="ident" id="3522734">encodeUserPassword</span><span class="op" id="3522752">)</span><span class="op" id="3522753">;</span>&nbsp;<span class="ident" id="3522755">err</span>&nbsp;<span class="op" id="3522759">!=</span>&nbsp;<span class="ident" id="3522762">nil</span>&nbsp;<span class="op" id="3522766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522771">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522784">user</span>&nbsp;<span class="op" id="3522789">=</span>&nbsp;<span class="ident" id="3522791">User</span><span class="op" id="3522795">(</span><span class="ident" id="3522796">userinfo</span><span class="op" id="3522804">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522807">}</span>&nbsp;<span class="keyword" id="3522809">else</span>&nbsp;<span class="op" id="3522814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522818">username</span><span class="op" id="3522826">,</span>&nbsp;<span class="ident" id="3522828">password</span>&nbsp;<span class="op" id="3522837">:=</span>&nbsp;<span class="ident" id="3522840">split</span><span class="op" id="3522845">(</span><span class="ident" id="3522846">userinfo</span><span class="op" id="3522854">,</span>&nbsp;<span class="string" id="3522856">&#34;:&#34;</span><span class="op" id="3522859">,</span>&nbsp;<span class="builtintype" id="3522861">true</span><span class="op" id="3522865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522869">if</span>&nbsp;<span class="ident" id="3522872">username</span><span class="op" id="3522880">,</span>&nbsp;<span class="ident" id="3522882">err</span>&nbsp;<span class="op" id="3522886">=</span>&nbsp;<span class="ident" id="3522888">unescape</span><span class="op" id="3522896">(</span><span class="ident" id="3522897">username</span><span class="op" id="3522905">,</span>&nbsp;<span class="ident" id="3522907">encodeUserPassword</span><span class="op" id="3522925">)</span><span class="op" id="3522926">;</span>&nbsp;<span class="ident" id="3522928">err</span>&nbsp;<span class="op" id="3522932">!=</span>&nbsp;<span class="ident" id="3522935">nil</span>&nbsp;<span class="op" id="3522939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522944">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522953">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522957">if</span>&nbsp;<span class="ident" id="3522960">password</span><span class="op" id="3522968">,</span>&nbsp;<span class="ident" id="3522970">err</span>&nbsp;<span class="op" id="3522974">=</span>&nbsp;<span class="ident" id="3522976">unescape</span><span class="op" id="3522984">(</span><span class="ident" id="3522985">password</span><span class="op" id="3522993">,</span>&nbsp;<span class="ident" id="3522995">encodeUserPassword</span><span class="op" id="3523013">)</span><span class="op" id="3523014">;</span>&nbsp;<span class="ident" id="3523016">err</span>&nbsp;<span class="op" id="3523020">!=</span>&nbsp;<span class="ident" id="3523023">nil</span>&nbsp;<span class="op" id="3523027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523032">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3523041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3523045">user</span>&nbsp;<span class="op" id="3523050">=</span>&nbsp;<span class="ident" id="3523052">UserPassword</span><span class="op" id="3523064">(</span><span class="ident" id="3523065">username</span><span class="op" id="3523073">,</span>&nbsp;<span class="ident" id="3523075">password</span><span class="op" id="3523083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3523086">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523089">return</span><br>
<span class="lineno"></span><span class="op" id="3523096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3523099">//&nbsp;String&nbsp;reassembles&nbsp;the&nbsp;URL&nbsp;into&nbsp;a&nbsp;valid&nbsp;URL&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3523154">//&nbsp;The&nbsp;general&nbsp;form&nbsp;of&nbsp;the&nbsp;result&nbsp;is&nbsp;one&nbsp;of:</span><br>
<span class="lineno">445</span><span class="comment" id="3523199">//</span><br>
<span class="lineno"></span><span class="comment" id="3523202">//&nbsp;&nbsp;&nbsp;&nbspscheme:opaque</span><br>
<span class="lineno"></span><span class="comment" id="3523219">//&nbsp;&nbsp;&nbsp;&nbspscheme://userinfo@host/path?query#fragment</span><br>
<span class="lineno"></span><span class="comment" id="3523265">//</span><br>
<span class="lineno"></span><span class="comment" id="3523268">//&nbsp;If&nbsp;u.Opaque&nbsp;is&nbsp;non-empty,&nbsp;String&nbsp;uses&nbsp;the&nbsp;first&nbsp;form;</span><br>
<span class="lineno">450</span><span class="comment" id="3523325">//&nbsp;otherwise&nbsp;it&nbsp;uses&nbsp;the&nbsp;second&nbsp;form.</span><br>
<span class="lineno"></span><span class="comment" id="3523363">//</span><br>
<span class="lineno"></span><span class="comment" id="3523366">//&nbsp;In&nbsp;the&nbsp;second&nbsp;form,&nbsp;the&nbsp;following&nbsp;rules&nbsp;apply:</span><br>
<span class="lineno"></span><span class="comment" id="3523416">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Scheme&nbsp;is&nbsp;empty,&nbsp;scheme:&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3523463">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.User&nbsp;is&nbsp;nil,&nbsp;userinfo@&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno">455</span><span class="comment" id="3523508">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;empty,&nbsp;host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3523551">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Scheme&nbsp;and&nbsp;u.Host&nbsp;are&nbsp;empty&nbsp;and&nbsp;u.User&nbsp;is&nbsp;nil,</span><br>
<span class="lineno"></span><span class="comment" id="3523608">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;the&nbsp;entire&nbsp;scheme://userinfo@host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3523661">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;non-empty&nbsp;and&nbsp;u.Path&nbsp;begins&nbsp;with&nbsp;a&nbsp;/,</span><br>
<span class="lineno"></span><span class="comment" id="3523717">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;the&nbsp;form&nbsp;host/path&nbsp;does&nbsp;not&nbsp;add&nbsp;its&nbsp;own&nbsp;/.</span><br>
<span class="lineno">460</span><span class="comment" id="3523766">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.RawQuery&nbsp;is&nbsp;empty,&nbsp;?query&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3523814">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Fragment&nbsp;is&nbsp;empty,&nbsp;#fragment&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="keyword" id="3523865">func</span>&nbsp;<span class="op" id="3523870">(</span><span class="ident" id="3523871">u</span>&nbsp;<span class="op" id="3523873">*</span><span class="ident" id="3523874">URL</span><span class="op" id="3523877">)</span>&nbsp;<span class="ident" id="3523879">String</span><span class="op" id="3523885">(</span><span class="op" id="3523886">)</span>&nbsp;<span class="builtintype" id="3523888">string</span>&nbsp;<span class="op" id="3523895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523898">var</span>&nbsp;<span class="ident" id="3523902">buf</span>&nbsp;<span class="ident" id="3523906">bytes</span><span class="op" id="3523911">.</span><span class="ident" id="3523912">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523920">if</span>&nbsp;<span class="ident" id="3523923">u</span><span class="op" id="3523924">.</span><span class="ident" id="3523925">Scheme</span>&nbsp;<span class="op" id="3523932">!=</span>&nbsp;<span class="string" id="3523935">&#34;&#34;</span>&nbsp;<span class="op" id="3523938">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3523942">buf</span><span class="op" id="3523945">.</span><span class="ident" id="3523946">WriteString</span><span class="op" id="3523957">(</span><span class="ident" id="3523958">u</span><span class="op" id="3523959">.</span><span class="ident" id="3523960">Scheme</span><span class="op" id="3523966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3523970">buf</span><span class="op" id="3523973">.</span><span class="ident" id="3523974">WriteByte</span><span class="op" id="3523983">(</span><span class="string" id="3523984">&#39;:&#39;</span><span class="op" id="3523987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3523990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523993">if</span>&nbsp;<span class="ident" id="3523996">u</span><span class="op" id="3523997">.</span><span class="ident" id="3523998">Opaque</span>&nbsp;<span class="op" id="3524005">!=</span>&nbsp;<span class="string" id="3524008">&#34;&#34;</span>&nbsp;<span class="op" id="3524011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524015">buf</span><span class="op" id="3524018">.</span><span class="ident" id="3524019">WriteString</span><span class="op" id="3524030">(</span><span class="ident" id="3524031">u</span><span class="op" id="3524032">.</span><span class="ident" id="3524033">Opaque</span><span class="op" id="3524039">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3524042">}</span>&nbsp;<span class="keyword" id="3524044">else</span>&nbsp;<span class="op" id="3524049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524053">if</span>&nbsp;<span class="ident" id="3524056">u</span><span class="op" id="3524057">.</span><span class="ident" id="3524058">Scheme</span>&nbsp;<span class="op" id="3524065">!=</span>&nbsp;<span class="string" id="3524068">&#34;&#34;</span>&nbsp;<span class="op" id="3524071">||</span>&nbsp;<span class="ident" id="3524074">u</span><span class="op" id="3524075">.</span><span class="ident" id="3524076">Host</span>&nbsp;<span class="op" id="3524081">!=</span>&nbsp;<span class="string" id="3524084">&#34;&#34;</span>&nbsp;<span class="op" id="3524087">||</span>&nbsp;<span class="ident" id="3524090">u</span><span class="op" id="3524091">.</span><span class="ident" id="3524092">User</span>&nbsp;<span class="op" id="3524097">!=</span>&nbsp;<span class="ident" id="3524100">nil</span>&nbsp;<span class="op" id="3524104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524109">buf</span><span class="op" id="3524112">.</span><span class="ident" id="3524113">WriteString</span><span class="op" id="3524124">(</span><span class="string" id="3524125">&#34;//&#34;</span><span class="op" id="3524129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524134">if</span>&nbsp;<span class="ident" id="3524137">ui</span>&nbsp;<span class="op" id="3524140">:=</span>&nbsp;<span class="ident" id="3524143">u</span><span class="op" id="3524144">.</span><span class="ident" id="3524145">User</span><span class="op" id="3524149">;</span>&nbsp;<span class="ident" id="3524151">ui</span>&nbsp;<span class="op" id="3524154">!=</span>&nbsp;<span class="ident" id="3524157">nil</span>&nbsp;<span class="op" id="3524161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524167">buf</span><span class="op" id="3524170">.</span><span class="ident" id="3524171">WriteString</span><span class="op" id="3524182">(</span><span class="ident" id="3524183">ui</span><span class="op" id="3524185">.</span><span class="ident" id="3524186">String</span><span class="op" id="3524192">(</span><span class="op" id="3524193">)</span><span class="op" id="3524194">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524200">buf</span><span class="op" id="3524203">.</span><span class="ident" id="3524204">WriteByte</span><span class="op" id="3524213">(</span><span class="string" id="3524214">&#39;@&#39;</span><span class="op" id="3524217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3524222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524227">if</span>&nbsp;<span class="ident" id="3524230">h</span>&nbsp;<span class="op" id="3524232">:=</span>&nbsp;<span class="ident" id="3524235">u</span><span class="op" id="3524236">.</span><span class="ident" id="3524237">Host</span><span class="op" id="3524241">;</span>&nbsp;<span class="ident" id="3524243">h</span>&nbsp;<span class="op" id="3524245">!=</span>&nbsp;<span class="string" id="3524248">&#34;&#34;</span>&nbsp;<span class="op" id="3524251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524257">buf</span><span class="op" id="3524260">.</span><span class="ident" id="3524261">WriteString</span><span class="op" id="3524272">(</span><span class="ident" id="3524273">h</span><span class="op" id="3524274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3524279">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3524283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524287">if</span>&nbsp;<span class="ident" id="3524290">u</span><span class="op" id="3524291">.</span><span class="ident" id="3524292">Path</span>&nbsp;<span class="op" id="3524297">!=</span>&nbsp;<span class="string" id="3524300">&#34;&#34;</span>&nbsp;<span class="op" id="3524303">&amp;&amp;</span>&nbsp;<span class="ident" id="3524306">u</span><span class="op" id="3524307">.</span><span class="ident" id="3524308">Path</span><span class="op" id="3524312">[</span><span class="num" id="3524313">0</span><span class="op" id="3524314">]</span>&nbsp;<span class="op" id="3524316">!=</span>&nbsp;<span class="string" id="3524319">&#39;/&#39;</span>&nbsp;<span class="op" id="3524323">&amp;&amp;</span>&nbsp;<span class="ident" id="3524326">u</span><span class="op" id="3524327">.</span><span class="ident" id="3524328">Host</span>&nbsp;<span class="op" id="3524333">!=</span>&nbsp;<span class="string" id="3524336">&#34;&#34;</span>&nbsp;<span class="op" id="3524339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524344">buf</span><span class="op" id="3524347">.</span><span class="ident" id="3524348">WriteByte</span><span class="op" id="3524357">(</span><span class="string" id="3524358">&#39;/&#39;</span><span class="op" id="3524361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3524365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524369">buf</span><span class="op" id="3524372">.</span><span class="ident" id="3524373">WriteString</span><span class="op" id="3524384">(</span><span class="ident" id="3524385">escape</span><span class="op" id="3524391">(</span><span class="ident" id="3524392">u</span><span class="op" id="3524393">.</span><span class="ident" id="3524394">Path</span><span class="op" id="3524398">,</span>&nbsp;<span class="ident" id="3524400">encodePath</span><span class="op" id="3524410">)</span><span class="op" id="3524411">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3524414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524417">if</span>&nbsp;<span class="ident" id="3524420">u</span><span class="op" id="3524421">.</span><span class="ident" id="3524422">RawQuery</span>&nbsp;<span class="op" id="3524431">!=</span>&nbsp;<span class="string" id="3524434">&#34;&#34;</span>&nbsp;<span class="op" id="3524437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524441">buf</span><span class="op" id="3524444">.</span><span class="ident" id="3524445">WriteByte</span><span class="op" id="3524454">(</span><span class="string" id="3524455">&#39;?&#39;</span><span class="op" id="3524458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524462">buf</span><span class="op" id="3524465">.</span><span class="ident" id="3524466">WriteString</span><span class="op" id="3524477">(</span><span class="ident" id="3524478">u</span><span class="op" id="3524479">.</span><span class="ident" id="3524480">RawQuery</span><span class="op" id="3524488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3524491">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524494">if</span>&nbsp;<span class="ident" id="3524497">u</span><span class="op" id="3524498">.</span><span class="ident" id="3524499">Fragment</span>&nbsp;<span class="op" id="3524508">!=</span>&nbsp;<span class="string" id="3524511">&#34;&#34;</span>&nbsp;<span class="op" id="3524514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524518">buf</span><span class="op" id="3524521">.</span><span class="ident" id="3524522">WriteByte</span><span class="op" id="3524531">(</span><span class="string" id="3524532">&#39;#&#39;</span><span class="op" id="3524535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524539">buf</span><span class="op" id="3524542">.</span><span class="ident" id="3524543">WriteString</span><span class="op" id="3524554">(</span><span class="ident" id="3524555">escape</span><span class="op" id="3524561">(</span><span class="ident" id="3524562">u</span><span class="op" id="3524563">.</span><span class="ident" id="3524564">Fragment</span><span class="op" id="3524572">,</span>&nbsp;<span class="ident" id="3524574">encodeFragment</span><span class="op" id="3524588">)</span><span class="op" id="3524589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3524592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524595">return</span>&nbsp;<span class="ident" id="3524602">buf</span><span class="op" id="3524605">.</span><span class="ident" id="3524606">String</span><span class="op" id="3524612">(</span><span class="op" id="3524613">)</span><br>
<span class="lineno">495</span><span class="op" id="3524615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3524618">//&nbsp;Values&nbsp;maps&nbsp;a&nbsp;string&nbsp;key&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3524667">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;for&nbsp;query&nbsp;parameters&nbsp;and&nbsp;form&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3524729">//&nbsp;Unlike&nbsp;in&nbsp;the&nbsp;http.Header&nbsp;map,&nbsp;the&nbsp;keys&nbsp;in&nbsp;a&nbsp;Values&nbsp;map</span><br>
<span class="lineno">500</span><span class="comment" id="3524788">//&nbsp;are&nbsp;case-sensitive.</span><br>
<span class="lineno"></span><span class="keyword" id="3524811">type</span>&nbsp;<span class="ident" id="3524816">Values</span>&nbsp;<span class="keyword" id="3524823">map</span><span class="op" id="3524826">[</span><span class="builtintype" id="3524827">string</span><span class="op" id="3524833">]</span><span class="op" id="3524834">[</span><span class="op" id="3524835">]</span><span class="builtintype" id="3524836">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3524844">//&nbsp;Get&nbsp;gets&nbsp;the&nbsp;first&nbsp;value&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3524903">//&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;values&nbsp;associated&nbsp;with&nbsp;the&nbsp;key,&nbsp;Get&nbsp;returns</span><br>
<span class="lineno">505</span><span class="comment" id="3524966">//&nbsp;the&nbsp;empty&nbsp;string.&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values,&nbsp;use&nbsp;the&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="3525026">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3525039">func</span>&nbsp;<span class="op" id="3525044">(</span><span class="ident" id="3525045">v</span>&nbsp;<span class="ident" id="3525047">Values</span><span class="op" id="3525053">)</span>&nbsp;<span class="ident" id="3525055">Get</span><span class="op" id="3525058">(</span><span class="ident" id="3525059">key</span>&nbsp;<span class="builtintype" id="3525063">string</span><span class="op" id="3525069">)</span>&nbsp;<span class="builtintype" id="3525071">string</span>&nbsp;<span class="op" id="3525078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3525081">if</span>&nbsp;<span class="ident" id="3525084">v</span>&nbsp;<span class="op" id="3525086">==</span>&nbsp;<span class="ident" id="3525089">nil</span>&nbsp;<span class="op" id="3525093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3525097">return</span>&nbsp;<span class="string" id="3525104">&#34;&#34;</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3525108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525111">vs</span><span class="op" id="3525113">,</span>&nbsp;<span class="ident" id="3525115">ok</span>&nbsp;<span class="op" id="3525118">:=</span>&nbsp;<span class="ident" id="3525121">v</span><span class="op" id="3525122">[</span><span class="ident" id="3525123">key</span><span class="op" id="3525126">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3525129">if</span>&nbsp;<span class="op" id="3525132">!</span><span class="ident" id="3525133">ok</span>&nbsp;<span class="op" id="3525136">||</span>&nbsp;<span class="builtinfunc" id="3525139">len</span><span class="op" id="3525142">(</span><span class="ident" id="3525143">vs</span><span class="op" id="3525145">)</span>&nbsp;<span class="op" id="3525147">==</span>&nbsp;<span class="num" id="3525150">0</span>&nbsp;<span class="op" id="3525152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3525156">return</span>&nbsp;<span class="string" id="3525163">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3525167">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3525170">return</span>&nbsp;<span class="ident" id="3525177">vs</span><span class="op" id="3525179">[</span><span class="num" id="3525180">0</span><span class="op" id="3525181">]</span><br>
<span class="lineno"></span><span class="op" id="3525183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3525186">//&nbsp;Set&nbsp;sets&nbsp;the&nbsp;key&nbsp;to&nbsp;value.&nbsp;It&nbsp;replaces&nbsp;any&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="3525241">//&nbsp;values.</span><br>
<span class="lineno">520</span><span class="keyword" id="3525252">func</span>&nbsp;<span class="op" id="3525257">(</span><span class="ident" id="3525258">v</span>&nbsp;<span class="ident" id="3525260">Values</span><span class="op" id="3525266">)</span>&nbsp;<span class="ident" id="3525268">Set</span><span class="op" id="3525271">(</span><span class="ident" id="3525272">key</span><span class="op" id="3525275">,</span>&nbsp;<span class="ident" id="3525277">value</span>&nbsp;<span class="builtintype" id="3525283">string</span><span class="op" id="3525289">)</span>&nbsp;<span class="op" id="3525291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525294">v</span><span class="op" id="3525295">[</span><span class="ident" id="3525296">key</span><span class="op" id="3525299">]</span>&nbsp;<span class="op" id="3525301">=</span>&nbsp;<span class="op" id="3525303">[</span><span class="op" id="3525304">]</span><span class="builtintype" id="3525305">string</span><span class="op" id="3525311">{</span><span class="ident" id="3525312">value</span><span class="op" id="3525317">}</span><br>
<span class="lineno"></span><span class="op" id="3525319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3525322">//&nbsp;Add&nbsp;adds&nbsp;the&nbsp;value&nbsp;to&nbsp;key.&nbsp;It&nbsp;appends&nbsp;to&nbsp;any&nbsp;existing</span><br>
<span class="lineno">525</span><span class="comment" id="3525379">//&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3525410">func</span>&nbsp;<span class="op" id="3525415">(</span><span class="ident" id="3525416">v</span>&nbsp;<span class="ident" id="3525418">Values</span><span class="op" id="3525424">)</span>&nbsp;<span class="ident" id="3525426">Add</span><span class="op" id="3525429">(</span><span class="ident" id="3525430">key</span><span class="op" id="3525433">,</span>&nbsp;<span class="ident" id="3525435">value</span>&nbsp;<span class="builtintype" id="3525441">string</span><span class="op" id="3525447">)</span>&nbsp;<span class="op" id="3525449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525452">v</span><span class="op" id="3525453">[</span><span class="ident" id="3525454">key</span><span class="op" id="3525457">]</span>&nbsp;<span class="op" id="3525459">=</span>&nbsp;<span class="builtinfunc" id="3525461">append</span><span class="op" id="3525467">(</span><span class="ident" id="3525468">v</span><span class="op" id="3525469">[</span><span class="ident" id="3525470">key</span><span class="op" id="3525473">]</span><span class="op" id="3525474">,</span>&nbsp;<span class="ident" id="3525476">value</span><span class="op" id="3525481">)</span><br>
<span class="lineno"></span><span class="op" id="3525483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="3525486">//&nbsp;Del&nbsp;deletes&nbsp;the&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3525533">func</span>&nbsp;<span class="op" id="3525538">(</span><span class="ident" id="3525539">v</span>&nbsp;<span class="ident" id="3525541">Values</span><span class="op" id="3525547">)</span>&nbsp;<span class="ident" id="3525549">Del</span><span class="op" id="3525552">(</span><span class="ident" id="3525553">key</span>&nbsp;<span class="builtintype" id="3525557">string</span><span class="op" id="3525563">)</span>&nbsp;<span class="op" id="3525565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3525568">delete</span><span class="op" id="3525574">(</span><span class="ident" id="3525575">v</span><span class="op" id="3525576">,</span>&nbsp;<span class="ident" id="3525578">key</span><span class="op" id="3525581">)</span><br>
<span class="lineno"></span><span class="op" id="3525583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3525586">//&nbsp;ParseQuery&nbsp;parses&nbsp;the&nbsp;URL-encoded&nbsp;query&nbsp;string&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3525648">//&nbsp;a&nbsp;map&nbsp;listing&nbsp;the&nbsp;values&nbsp;specified&nbsp;for&nbsp;each&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3525700">//&nbsp;ParseQuery&nbsp;always&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;map&nbsp;containing&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3525762">//&nbsp;valid&nbsp;query&nbsp;parameters&nbsp;found;&nbsp;err&nbsp;describes&nbsp;the&nbsp;first&nbsp;decoding&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="3525834">//&nbsp;encountered,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">540</span><span class="keyword" id="3525858">func</span>&nbsp;<span class="ident" id="3525863">ParseQuery</span><span class="op" id="3525873">(</span><span class="ident" id="3525874">query</span>&nbsp;<span class="builtintype" id="3525880">string</span><span class="op" id="3525886">)</span>&nbsp;<span class="op" id="3525888">(</span><span class="ident" id="3525889">m</span>&nbsp;<span class="ident" id="3525891">Values</span><span class="op" id="3525897">,</span>&nbsp;<span class="ident" id="3525899">err</span>&nbsp;<span class="builtintype" id="3525903">error</span><span class="op" id="3525908">)</span>&nbsp;<span class="op" id="3525910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525913">m</span>&nbsp;<span class="op" id="3525915">=</span>&nbsp;<span class="builtinfunc" id="3525917">make</span><span class="op" id="3525921">(</span><span class="ident" id="3525922">Values</span><span class="op" id="3525928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525931">err</span>&nbsp;<span class="op" id="3525935">=</span>&nbsp;<span class="ident" id="3525937">parseQuery</span><span class="op" id="3525947">(</span><span class="ident" id="3525948">m</span><span class="op" id="3525949">,</span>&nbsp;<span class="ident" id="3525951">query</span><span class="op" id="3525956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3525959">return</span><br>
<span class="lineno"></span><span class="op" id="3525966">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="keyword" id="3525969">func</span>&nbsp;<span class="ident" id="3525974">parseQuery</span><span class="op" id="3525984">(</span><span class="ident" id="3525985">m</span>&nbsp;<span class="ident" id="3525987">Values</span><span class="op" id="3525993">,</span>&nbsp;<span class="ident" id="3525995">query</span>&nbsp;<span class="builtintype" id="3526001">string</span><span class="op" id="3526007">)</span>&nbsp;<span class="op" id="3526009">(</span><span class="ident" id="3526010">err</span>&nbsp;<span class="builtintype" id="3526014">error</span><span class="op" id="3526019">)</span>&nbsp;<span class="op" id="3526021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526024">for</span>&nbsp;<span class="ident" id="3526028">query</span>&nbsp;<span class="op" id="3526034">!=</span>&nbsp;<span class="string" id="3526037">&#34;&#34;</span>&nbsp;<span class="op" id="3526040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3526044">key</span>&nbsp;<span class="op" id="3526048">:=</span>&nbsp;<span class="ident" id="3526051">query</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526059">if</span>&nbsp;<span class="ident" id="3526062">i</span>&nbsp;<span class="op" id="3526064">:=</span>&nbsp;<span class="ident" id="3526067">strings</span><span class="op" id="3526074">.</span><span class="ident" id="3526075">IndexAny</span><span class="op" id="3526083">(</span><span class="ident" id="3526084">key</span><span class="op" id="3526087">,</span>&nbsp;<span class="string" id="3526089">&#34;&amp;;&#34;</span><span class="op" id="3526093">)</span><span class="op" id="3526094">;</span>&nbsp;<span class="ident" id="3526096">i</span>&nbsp;<span class="op" id="3526098">&gt;=</span>&nbsp;<span class="num" id="3526101">0</span>&nbsp;<span class="op" id="3526103">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3526108">key</span><span class="op" id="3526111">,</span>&nbsp;<span class="ident" id="3526113">query</span>&nbsp;<span class="op" id="3526119">=</span>&nbsp;<span class="ident" id="3526121">key</span><span class="op" id="3526124">[</span><span class="op" id="3526125">:</span><span class="ident" id="3526126">i</span><span class="op" id="3526127">]</span><span class="op" id="3526128">,</span>&nbsp;<span class="ident" id="3526130">key</span><span class="op" id="3526133">[</span><span class="ident" id="3526134">i</span><span class="op" id="3526135">+</span><span class="num" id="3526136">1</span><span class="op" id="3526137">:</span><span class="op" id="3526138">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3526142">}</span>&nbsp;<span class="keyword" id="3526144">else</span>&nbsp;<span class="op" id="3526149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3526154">query</span>&nbsp;<span class="op" id="3526160">=</span>&nbsp;<span class="string" id="3526162">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3526167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526171">if</span>&nbsp;<span class="ident" id="3526174">key</span>&nbsp;<span class="op" id="3526178">==</span>&nbsp;<span class="string" id="3526181">&#34;&#34;</span>&nbsp;<span class="op" id="3526184">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526189">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3526200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3526204">value</span>&nbsp;<span class="op" id="3526210">:=</span>&nbsp;<span class="string" id="3526213">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526218">if</span>&nbsp;<span class="ident" id="3526221">i</span>&nbsp;<span class="op" id="3526223">:=</span>&nbsp;<span class="ident" id="3526226">strings</span><span class="op" id="3526233">.</span><span class="ident" id="3526234">Index</span><span class="op" id="3526239">(</span><span class="ident" id="3526240">key</span><span class="op" id="3526243">,</span>&nbsp;<span class="string" id="3526245">&#34;=&#34;</span><span class="op" id="3526248">)</span><span class="op" id="3526249">;</span>&nbsp;<span class="ident" id="3526251">i</span>&nbsp;<span class="op" id="3526253">&gt;=</span>&nbsp;<span class="num" id="3526256">0</span>&nbsp;<span class="op" id="3526258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3526263">key</span><span class="op" id="3526266">,</span>&nbsp;<span class="ident" id="3526268">value</span>&nbsp;<span class="op" id="3526274">=</span>&nbsp;<span class="ident" id="3526276">key</span><span class="op" id="3526279">[</span><span class="op" id="3526280">:</span><span class="ident" id="3526281">i</span><span class="op" id="3526282">]</span><span class="op" id="3526283">,</span>&nbsp;<span class="ident" id="3526285">key</span><span class="op" id="3526288">[</span><span class="ident" id="3526289">i</span><span class="op" id="3526290">+</span><span class="num" id="3526291">1</span><span class="op" id="3526292">:</span><span class="op" id="3526293">]</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3526297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3526301">key</span><span class="op" id="3526304">,</span>&nbsp;<span class="ident" id="3526306">err1</span>&nbsp;<span class="op" id="3526311">:=</span>&nbsp;<span class="ident" id="3526314">QueryUnescape</span><span class="op" id="3526327">(</span><span class="ident" id="3526328">key</span><span class="op" id="3526331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526335">if</span>&nbsp;<span class="ident" id="3526338">err1</span>&nbsp;<span class="op" id="3526343">!=</span>&nbsp;<span class="ident" id="3526346">nil</span>&nbsp;<span class="op" id="3526350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526355">if</span>&nbsp;<span class="ident" id="3526358">err</span>&nbsp;<span class="op" id="3526362">==</span>&nbsp;<span class="ident" id="3526365">nil</span>&nbsp;<span class="op" id="3526369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3526375">err</span>&nbsp;<span class="op" id="3526379">=</span>&nbsp;<span class="ident" id="3526381">err1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3526389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526394">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3526405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3526409">value</span><span class="op" id="3526414">,</span>&nbsp;<span class="ident" id="3526416">err1</span>&nbsp;<span class="op" id="3526421">=</span>&nbsp;<span class="ident" id="3526423">QueryUnescape</span><span class="op" id="3526436">(</span><span class="ident" id="3526437">value</span><span class="op" id="3526442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526446">if</span>&nbsp;<span class="ident" id="3526449">err1</span>&nbsp;<span class="op" id="3526454">!=</span>&nbsp;<span class="ident" id="3526457">nil</span>&nbsp;<span class="op" id="3526461">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526466">if</span>&nbsp;<span class="ident" id="3526469">err</span>&nbsp;<span class="op" id="3526473">==</span>&nbsp;<span class="ident" id="3526476">nil</span>&nbsp;<span class="op" id="3526480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3526486">err</span>&nbsp;<span class="op" id="3526490">=</span>&nbsp;<span class="ident" id="3526492">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3526500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526505">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3526516">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3526520">m</span><span class="op" id="3526521">[</span><span class="ident" id="3526522">key</span><span class="op" id="3526525">]</span>&nbsp;<span class="op" id="3526527">=</span>&nbsp;<span class="builtinfunc" id="3526529">append</span><span class="op" id="3526535">(</span><span class="ident" id="3526536">m</span><span class="op" id="3526537">[</span><span class="ident" id="3526538">key</span><span class="op" id="3526541">]</span><span class="op" id="3526542">,</span>&nbsp;<span class="ident" id="3526544">value</span><span class="op" id="3526549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3526552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526555">return</span>&nbsp;<span class="ident" id="3526562">err</span><br>
<span class="lineno"></span><span class="op" id="3526566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span><span class="comment" id="3526569">//&nbsp;Encode&nbsp;encodes&nbsp;the&nbsp;values&nbsp;into&nbsp;``URL&nbsp;encoded&#39;&#39;&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3526624">//&nbsp;(&#34;bar=baz&amp;foo=quux&#34;)&nbsp;sorted&nbsp;by&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3526663">func</span>&nbsp;<span class="op" id="3526668">(</span><span class="ident" id="3526669">v</span>&nbsp;<span class="ident" id="3526671">Values</span><span class="op" id="3526677">)</span>&nbsp;<span class="ident" id="3526679">Encode</span><span class="op" id="3526685">(</span><span class="op" id="3526686">)</span>&nbsp;<span class="builtintype" id="3526688">string</span>&nbsp;<span class="op" id="3526695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526698">if</span>&nbsp;<span class="ident" id="3526701">v</span>&nbsp;<span class="op" id="3526703">==</span>&nbsp;<span class="ident" id="3526706">nil</span>&nbsp;<span class="op" id="3526710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526714">return</span>&nbsp;<span class="string" id="3526721">&#34;&#34;</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3526725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526728">var</span>&nbsp;<span class="ident" id="3526732">buf</span>&nbsp;<span class="ident" id="3526736">bytes</span><span class="op" id="3526741">.</span><span class="ident" id="3526742">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3526750">keys</span>&nbsp;<span class="op" id="3526755">:=</span>&nbsp;<span class="builtinfunc" id="3526758">make</span><span class="op" id="3526762">(</span><span class="op" id="3526763">[</span><span class="op" id="3526764">]</span><span class="builtintype" id="3526765">string</span><span class="op" id="3526771">,</span>&nbsp;<span class="num" id="3526773">0</span><span class="op" id="3526774">,</span>&nbsp;<span class="builtinfunc" id="3526776">len</span><span class="op" id="3526779">(</span><span class="ident" id="3526780">v</span><span class="op" id="3526781">)</span><span class="op" id="3526782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526785">for</span>&nbsp;<span class="ident" id="3526789">k</span>&nbsp;<span class="op" id="3526791">:=</span>&nbsp;<span class="keyword" id="3526794">range</span>&nbsp;<span class="ident" id="3526800">v</span>&nbsp;<span class="op" id="3526802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3526806">keys</span>&nbsp;<span class="op" id="3526811">=</span>&nbsp;<span class="builtinfunc" id="3526813">append</span><span class="op" id="3526819">(</span><span class="ident" id="3526820">keys</span><span class="op" id="3526824">,</span>&nbsp;<span class="ident" id="3526826">k</span><span class="op" id="3526827">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3526830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3526833">sort</span><span class="op" id="3526837">.</span><span class="ident" id="3526838">Strings</span><span class="op" id="3526845">(</span><span class="ident" id="3526846">keys</span><span class="op" id="3526850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526853">for</span>&nbsp;<span class="ident" id="3526857">_</span><span class="op" id="3526858">,</span>&nbsp;<span class="ident" id="3526860">k</span>&nbsp;<span class="op" id="3526862">:=</span>&nbsp;<span class="keyword" id="3526865">range</span>&nbsp;<span class="ident" id="3526871">keys</span>&nbsp;<span class="op" id="3526876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3526880">vs</span>&nbsp;<span class="op" id="3526883">:=</span>&nbsp;<span class="ident" id="3526886">v</span><span class="op" id="3526887">[</span><span class="ident" id="3526888">k</span><span class="op" id="3526889">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3526893">prefix</span>&nbsp;<span class="op" id="3526900">:=</span>&nbsp;<span class="ident" id="3526903">QueryEscape</span><span class="op" id="3526914">(</span><span class="ident" id="3526915">k</span><span class="op" id="3526916">)</span>&nbsp;<span class="op" id="3526918">+</span>&nbsp;<span class="string" id="3526920">&#34;=&#34;</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526926">for</span>&nbsp;<span class="ident" id="3526930">_</span><span class="op" id="3526931">,</span>&nbsp;<span class="ident" id="3526933">v</span>&nbsp;<span class="op" id="3526935">:=</span>&nbsp;<span class="keyword" id="3526938">range</span>&nbsp;<span class="ident" id="3526944">vs</span>&nbsp;<span class="op" id="3526947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526952">if</span>&nbsp;<span class="ident" id="3526955">buf</span><span class="op" id="3526958">.</span><span class="ident" id="3526959">Len</span><span class="op" id="3526962">(</span><span class="op" id="3526963">)</span>&nbsp;<span class="op" id="3526965">&gt;</span>&nbsp;<span class="num" id="3526967">0</span>&nbsp;<span class="op" id="3526969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3526975">buf</span><span class="op" id="3526978">.</span><span class="ident" id="3526979">WriteByte</span><span class="op" id="3526988">(</span><span class="string" id="3526989">&#39;&amp;&#39;</span><span class="op" id="3526992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3526997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3527002">buf</span><span class="op" id="3527005">.</span><span class="ident" id="3527006">WriteString</span><span class="op" id="3527017">(</span><span class="ident" id="3527018">prefix</span><span class="op" id="3527024">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3527029">buf</span><span class="op" id="3527032">.</span><span class="ident" id="3527033">WriteString</span><span class="op" id="3527044">(</span><span class="ident" id="3527045">QueryEscape</span><span class="op" id="3527056">(</span><span class="ident" id="3527057">v</span><span class="op" id="3527058">)</span><span class="op" id="3527059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3527063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3527066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527069">return</span>&nbsp;<span class="ident" id="3527076">buf</span><span class="op" id="3527079">.</span><span class="ident" id="3527080">String</span><span class="op" id="3527086">(</span><span class="op" id="3527087">)</span><br>
<span class="lineno"></span><span class="op" id="3527089">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="comment" id="3527092">//&nbsp;resolvePath&nbsp;applies&nbsp;special&nbsp;path&nbsp;segments&nbsp;from&nbsp;refs&nbsp;and&nbsp;applies</span><br>
<span class="lineno"></span><span class="comment" id="3527159">//&nbsp;them&nbsp;to&nbsp;base,&nbsp;per&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3527190">func</span>&nbsp;<span class="ident" id="3527195">resolvePath</span><span class="op" id="3527206">(</span><span class="ident" id="3527207">base</span><span class="op" id="3527211">,</span>&nbsp;<span class="ident" id="3527213">ref</span>&nbsp;<span class="builtintype" id="3527217">string</span><span class="op" id="3527223">)</span>&nbsp;<span class="builtintype" id="3527225">string</span>&nbsp;<span class="op" id="3527232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527235">var</span>&nbsp;<span class="ident" id="3527239">full</span>&nbsp;<span class="builtintype" id="3527244">string</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527252">if</span>&nbsp;<span class="ident" id="3527255">ref</span>&nbsp;<span class="op" id="3527259">==</span>&nbsp;<span class="string" id="3527262">&#34;&#34;</span>&nbsp;<span class="op" id="3527265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3527269">full</span>&nbsp;<span class="op" id="3527274">=</span>&nbsp;<span class="ident" id="3527276">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3527282">}</span>&nbsp;<span class="keyword" id="3527284">else</span>&nbsp;<span class="keyword" id="3527289">if</span>&nbsp;<span class="ident" id="3527292">ref</span><span class="op" id="3527295">[</span><span class="num" id="3527296">0</span><span class="op" id="3527297">]</span>&nbsp;<span class="op" id="3527299">!=</span>&nbsp;<span class="string" id="3527302">&#39;/&#39;</span>&nbsp;<span class="op" id="3527306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3527310">i</span>&nbsp;<span class="op" id="3527312">:=</span>&nbsp;<span class="ident" id="3527315">strings</span><span class="op" id="3527322">.</span><span class="ident" id="3527323">LastIndex</span><span class="op" id="3527332">(</span><span class="ident" id="3527333">base</span><span class="op" id="3527337">,</span>&nbsp;<span class="string" id="3527339">&#34;/&#34;</span><span class="op" id="3527342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3527346">full</span>&nbsp;<span class="op" id="3527351">=</span>&nbsp;<span class="ident" id="3527353">base</span><span class="op" id="3527357">[</span><span class="op" id="3527358">:</span><span class="ident" id="3527359">i</span><span class="op" id="3527360">+</span><span class="num" id="3527361">1</span><span class="op" id="3527362">]</span>&nbsp;<span class="op" id="3527364">+</span>&nbsp;<span class="ident" id="3527366">ref</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3527371">}</span>&nbsp;<span class="keyword" id="3527373">else</span>&nbsp;<span class="op" id="3527378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3527382">full</span>&nbsp;<span class="op" id="3527387">=</span>&nbsp;<span class="ident" id="3527389">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3527394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527397">if</span>&nbsp;<span class="ident" id="3527400">full</span>&nbsp;<span class="op" id="3527405">==</span>&nbsp;<span class="string" id="3527408">&#34;&#34;</span>&nbsp;<span class="op" id="3527411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527415">return</span>&nbsp;<span class="string" id="3527422">&#34;&#34;</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3527426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527429">var</span>&nbsp;<span class="ident" id="3527433">dst</span>&nbsp;<span class="op" id="3527437">[</span><span class="op" id="3527438">]</span><span class="builtintype" id="3527439">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3527447">src</span>&nbsp;<span class="op" id="3527451">:=</span>&nbsp;<span class="ident" id="3527454">strings</span><span class="op" id="3527461">.</span><span class="ident" id="3527462">Split</span><span class="op" id="3527467">(</span><span class="ident" id="3527468">full</span><span class="op" id="3527472">,</span>&nbsp;<span class="string" id="3527474">&#34;/&#34;</span><span class="op" id="3527477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527480">for</span>&nbsp;<span class="ident" id="3527484">_</span><span class="op" id="3527485">,</span>&nbsp;<span class="ident" id="3527487">elem</span>&nbsp;<span class="op" id="3527492">:=</span>&nbsp;<span class="keyword" id="3527495">range</span>&nbsp;<span class="ident" id="3527501">src</span>&nbsp;<span class="op" id="3527505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527509">switch</span>&nbsp;<span class="ident" id="3527516">elem</span>&nbsp;<span class="op" id="3527521">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527525">case</span>&nbsp;<span class="string" id="3527530">&#34;.&#34;</span><span class="op" id="3527533">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3527538">//&nbsp;drop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527548">case</span>&nbsp;<span class="string" id="3527553">&#34;..&#34;</span><span class="op" id="3527557">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527562">if</span>&nbsp;<span class="builtinfunc" id="3527565">len</span><span class="op" id="3527568">(</span><span class="ident" id="3527569">dst</span><span class="op" id="3527572">)</span>&nbsp;<span class="op" id="3527574">&gt;</span>&nbsp;<span class="num" id="3527576">0</span>&nbsp;<span class="op" id="3527578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3527584">dst</span>&nbsp;<span class="op" id="3527588">=</span>&nbsp;<span class="ident" id="3527590">dst</span><span class="op" id="3527593">[</span><span class="op" id="3527594">:</span><span class="builtinfunc" id="3527595">len</span><span class="op" id="3527598">(</span><span class="ident" id="3527599">dst</span><span class="op" id="3527602">)</span><span class="op" id="3527603">-</span><span class="num" id="3527604">1</span><span class="op" id="3527605">]</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3527610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527614">default</span><span class="op" id="3527621">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3527626">dst</span>&nbsp;<span class="op" id="3527630">=</span>&nbsp;<span class="builtinfunc" id="3527632">append</span><span class="op" id="3527638">(</span><span class="ident" id="3527639">dst</span><span class="op" id="3527642">,</span>&nbsp;<span class="ident" id="3527644">elem</span><span class="op" id="3527648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3527652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3527655">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527658">if</span>&nbsp;<span class="ident" id="3527661">last</span>&nbsp;<span class="op" id="3527666">:=</span>&nbsp;<span class="ident" id="3527669">src</span><span class="op" id="3527672">[</span><span class="builtinfunc" id="3527673">len</span><span class="op" id="3527676">(</span><span class="ident" id="3527677">src</span><span class="op" id="3527680">)</span><span class="op" id="3527681">-</span><span class="num" id="3527682">1</span><span class="op" id="3527683">]</span><span class="op" id="3527684">;</span>&nbsp;<span class="ident" id="3527686">last</span>&nbsp;<span class="op" id="3527691">==</span>&nbsp;<span class="string" id="3527694">&#34;.&#34;</span>&nbsp;<span class="op" id="3527698">||</span>&nbsp;<span class="ident" id="3527701">last</span>&nbsp;<span class="op" id="3527706">==</span>&nbsp;<span class="string" id="3527709">&#34;..&#34;</span>&nbsp;<span class="op" id="3527714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3527718">//&nbsp;Add&nbsp;final&nbsp;slash&nbsp;to&nbsp;the&nbsp;joined&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3527759">dst</span>&nbsp;<span class="op" id="3527763">=</span>&nbsp;<span class="builtinfunc" id="3527765">append</span><span class="op" id="3527771">(</span><span class="ident" id="3527772">dst</span><span class="op" id="3527775">,</span>&nbsp;<span class="string" id="3527777">&#34;&#34;</span><span class="op" id="3527779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3527782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527785">return</span>&nbsp;<span class="string" id="3527792">&#34;/&#34;</span>&nbsp;<span class="op" id="3527796">+</span>&nbsp;<span class="ident" id="3527798">strings</span><span class="op" id="3527805">.</span><span class="ident" id="3527806">TrimLeft</span><span class="op" id="3527814">(</span><span class="ident" id="3527815">strings</span><span class="op" id="3527822">.</span><span class="ident" id="3527823">Join</span><span class="op" id="3527827">(</span><span class="ident" id="3527828">dst</span><span class="op" id="3527831">,</span>&nbsp;<span class="string" id="3527833">&#34;/&#34;</span><span class="op" id="3527836">)</span><span class="op" id="3527837">,</span>&nbsp;<span class="string" id="3527839">&#34;/&#34;</span><span class="op" id="3527842">)</span><br>
<span class="lineno">640</span><span class="op" id="3527844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3527847">//&nbsp;IsAbs&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;URL&nbsp;is&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3527893">func</span>&nbsp;<span class="op" id="3527898">(</span><span class="ident" id="3527899">u</span>&nbsp;<span class="op" id="3527901">*</span><span class="ident" id="3527902">URL</span><span class="op" id="3527905">)</span>&nbsp;<span class="ident" id="3527907">IsAbs</span><span class="op" id="3527912">(</span><span class="op" id="3527913">)</span>&nbsp;<span class="builtintype" id="3527915">bool</span>&nbsp;<span class="op" id="3527920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527923">return</span>&nbsp;<span class="ident" id="3527930">u</span><span class="op" id="3527931">.</span><span class="ident" id="3527932">Scheme</span>&nbsp;<span class="op" id="3527939">!=</span>&nbsp;<span class="string" id="3527942">&#34;&#34;</span><br>
<span class="lineno">645</span><span class="op" id="3527945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3527948">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;in&nbsp;the&nbsp;context&nbsp;of&nbsp;the&nbsp;receiver.&nbsp;&nbsp;The&nbsp;provided&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="3528020">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;Parse&nbsp;returns&nbsp;nil,&nbsp;err&nbsp;on&nbsp;parse</span><br>
<span class="lineno"></span><span class="comment" id="3528085">//&nbsp;failure,&nbsp;otherwise&nbsp;its&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;ResolveReference.</span><br>
<span class="lineno">650</span><span class="keyword" id="3528157">func</span>&nbsp;<span class="op" id="3528162">(</span><span class="ident" id="3528163">u</span>&nbsp;<span class="op" id="3528165">*</span><span class="ident" id="3528166">URL</span><span class="op" id="3528169">)</span>&nbsp;<span class="ident" id="3528171">Parse</span><span class="op" id="3528176">(</span><span class="ident" id="3528177">ref</span>&nbsp;<span class="builtintype" id="3528181">string</span><span class="op" id="3528187">)</span>&nbsp;<span class="op" id="3528189">(</span><span class="op" id="3528190">*</span><span class="ident" id="3528191">URL</span><span class="op" id="3528194">,</span>&nbsp;<span class="builtintype" id="3528196">error</span><span class="op" id="3528201">)</span>&nbsp;<span class="op" id="3528203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3528206">refurl</span><span class="op" id="3528212">,</span>&nbsp;<span class="ident" id="3528214">err</span>&nbsp;<span class="op" id="3528218">:=</span>&nbsp;<span class="ident" id="3528221">Parse</span><span class="op" id="3528226">(</span><span class="ident" id="3528227">ref</span><span class="op" id="3528230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528233">if</span>&nbsp;<span class="ident" id="3528236">err</span>&nbsp;<span class="op" id="3528240">!=</span>&nbsp;<span class="ident" id="3528243">nil</span>&nbsp;<span class="op" id="3528247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528251">return</span>&nbsp;<span class="ident" id="3528258">nil</span><span class="op" id="3528261">,</span>&nbsp;<span class="ident" id="3528263">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3528268">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528271">return</span>&nbsp;<span class="ident" id="3528278">u</span><span class="op" id="3528279">.</span><span class="ident" id="3528280">ResolveReference</span><span class="op" id="3528296">(</span><span class="ident" id="3528297">refurl</span><span class="op" id="3528303">)</span><span class="op" id="3528304">,</span>&nbsp;<span class="ident" id="3528306">nil</span><br>
<span class="lineno"></span><span class="op" id="3528310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3528313">//&nbsp;ResolveReference&nbsp;resolves&nbsp;a&nbsp;URI&nbsp;reference&nbsp;to&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3528382">//&nbsp;an&nbsp;absolute&nbsp;base&nbsp;URI,&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;Section&nbsp;5.2.&nbsp;&nbsp;The&nbsp;URI&nbsp;reference</span><br>
<span class="lineno">660</span><span class="comment" id="3528452">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;ResolveReference&nbsp;always&nbsp;returns&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3528523">//&nbsp;URL&nbsp;instance,&nbsp;even&nbsp;if&nbsp;the&nbsp;returned&nbsp;URL&nbsp;is&nbsp;identical&nbsp;to&nbsp;either&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3528592">//&nbsp;base&nbsp;or&nbsp;reference.&nbsp;If&nbsp;ref&nbsp;is&nbsp;an&nbsp;absolute&nbsp;URL,&nbsp;then&nbsp;ResolveReference</span><br>
<span class="lineno"></span><span class="comment" id="3528663">//&nbsp;ignores&nbsp;base&nbsp;and&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;ref.</span><br>
<span class="lineno"></span><span class="keyword" id="3528706">func</span>&nbsp;<span class="op" id="3528711">(</span><span class="ident" id="3528712">u</span>&nbsp;<span class="op" id="3528714">*</span><span class="ident" id="3528715">URL</span><span class="op" id="3528718">)</span>&nbsp;<span class="ident" id="3528720">ResolveReference</span><span class="op" id="3528736">(</span><span class="ident" id="3528737">ref</span>&nbsp;<span class="op" id="3528741">*</span><span class="ident" id="3528742">URL</span><span class="op" id="3528745">)</span>&nbsp;<span class="op" id="3528747">*</span><span class="ident" id="3528748">URL</span>&nbsp;<span class="op" id="3528752">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3528755">url</span>&nbsp;<span class="op" id="3528759">:=</span>&nbsp;<span class="op" id="3528762">*</span><span class="ident" id="3528763">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528768">if</span>&nbsp;<span class="ident" id="3528771">ref</span><span class="op" id="3528774">.</span><span class="ident" id="3528775">Scheme</span>&nbsp;<span class="op" id="3528782">==</span>&nbsp;<span class="string" id="3528785">&#34;&#34;</span>&nbsp;<span class="op" id="3528788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3528792">url</span><span class="op" id="3528795">.</span><span class="ident" id="3528796">Scheme</span>&nbsp;<span class="op" id="3528803">=</span>&nbsp;<span class="ident" id="3528805">u</span><span class="op" id="3528806">.</span><span class="ident" id="3528807">Scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3528815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528818">if</span>&nbsp;<span class="ident" id="3528821">ref</span><span class="op" id="3528824">.</span><span class="ident" id="3528825">Scheme</span>&nbsp;<span class="op" id="3528832">!=</span>&nbsp;<span class="string" id="3528835">&#34;&#34;</span>&nbsp;<span class="op" id="3528838">||</span>&nbsp;<span class="ident" id="3528841">ref</span><span class="op" id="3528844">.</span><span class="ident" id="3528845">Host</span>&nbsp;<span class="op" id="3528850">!=</span>&nbsp;<span class="string" id="3528853">&#34;&#34;</span>&nbsp;<span class="op" id="3528856">||</span>&nbsp;<span class="ident" id="3528859">ref</span><span class="op" id="3528862">.</span><span class="ident" id="3528863">User</span>&nbsp;<span class="op" id="3528868">!=</span>&nbsp;<span class="ident" id="3528871">nil</span>&nbsp;<span class="op" id="3528875">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3528879">//&nbsp;The&nbsp;&#34;absoluteURI&#34;&nbsp;or&nbsp;&#34;net_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3528923">url</span><span class="op" id="3528926">.</span><span class="ident" id="3528927">Path</span>&nbsp;<span class="op" id="3528932">=</span>&nbsp;<span class="ident" id="3528934">resolvePath</span><span class="op" id="3528945">(</span><span class="ident" id="3528946">ref</span><span class="op" id="3528949">.</span><span class="ident" id="3528950">Path</span><span class="op" id="3528954">,</span>&nbsp;<span class="string" id="3528956">&#34;&#34;</span><span class="op" id="3528958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528962">return</span>&nbsp;<span class="op" id="3528969">&amp;</span><span class="ident" id="3528970">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3528975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528978">if</span>&nbsp;<span class="ident" id="3528981">ref</span><span class="op" id="3528984">.</span><span class="ident" id="3528985">Opaque</span>&nbsp;<span class="op" id="3528992">!=</span>&nbsp;<span class="string" id="3528995">&#34;&#34;</span>&nbsp;<span class="op" id="3528998">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529002">url</span><span class="op" id="3529005">.</span><span class="ident" id="3529006">User</span>&nbsp;<span class="op" id="3529011">=</span>&nbsp;<span class="ident" id="3529013">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529019">url</span><span class="op" id="3529022">.</span><span class="ident" id="3529023">Host</span>&nbsp;<span class="op" id="3529028">=</span>&nbsp;<span class="string" id="3529030">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529035">url</span><span class="op" id="3529038">.</span><span class="ident" id="3529039">Path</span>&nbsp;<span class="op" id="3529044">=</span>&nbsp;<span class="string" id="3529046">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529051">return</span>&nbsp;<span class="op" id="3529058">&amp;</span><span class="ident" id="3529059">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3529064">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529067">if</span>&nbsp;<span class="ident" id="3529070">ref</span><span class="op" id="3529073">.</span><span class="ident" id="3529074">Path</span>&nbsp;<span class="op" id="3529079">==</span>&nbsp;<span class="string" id="3529082">&#34;&#34;</span>&nbsp;<span class="op" id="3529085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529089">if</span>&nbsp;<span class="ident" id="3529092">ref</span><span class="op" id="3529095">.</span><span class="ident" id="3529096">RawQuery</span>&nbsp;<span class="op" id="3529105">==</span>&nbsp;<span class="string" id="3529108">&#34;&#34;</span>&nbsp;<span class="op" id="3529111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529116">url</span><span class="op" id="3529119">.</span><span class="ident" id="3529120">RawQuery</span>&nbsp;<span class="op" id="3529129">=</span>&nbsp;<span class="ident" id="3529131">u</span><span class="op" id="3529132">.</span><span class="ident" id="3529133">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529145">if</span>&nbsp;<span class="ident" id="3529148">ref</span><span class="op" id="3529151">.</span><span class="ident" id="3529152">Fragment</span>&nbsp;<span class="op" id="3529161">==</span>&nbsp;<span class="string" id="3529164">&#34;&#34;</span>&nbsp;<span class="op" id="3529167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529173">url</span><span class="op" id="3529176">.</span><span class="ident" id="3529177">Fragment</span>&nbsp;<span class="op" id="3529186">=</span>&nbsp;<span class="ident" id="3529188">u</span><span class="op" id="3529189">.</span><span class="ident" id="3529190">Fragment</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3529202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3529206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3529209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3529212">//&nbsp;The&nbsp;&#34;abs_path&#34;&nbsp;or&nbsp;&#34;rel_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529252">url</span><span class="op" id="3529255">.</span><span class="ident" id="3529256">Host</span>&nbsp;<span class="op" id="3529261">=</span>&nbsp;<span class="ident" id="3529263">u</span><span class="op" id="3529264">.</span><span class="ident" id="3529265">Host</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529271">url</span><span class="op" id="3529274">.</span><span class="ident" id="3529275">User</span>&nbsp;<span class="op" id="3529280">=</span>&nbsp;<span class="ident" id="3529282">u</span><span class="op" id="3529283">.</span><span class="ident" id="3529284">User</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529290">url</span><span class="op" id="3529293">.</span><span class="ident" id="3529294">Path</span>&nbsp;<span class="op" id="3529299">=</span>&nbsp;<span class="ident" id="3529301">resolvePath</span><span class="op" id="3529312">(</span><span class="ident" id="3529313">u</span><span class="op" id="3529314">.</span><span class="ident" id="3529315">Path</span><span class="op" id="3529319">,</span>&nbsp;<span class="ident" id="3529321">ref</span><span class="op" id="3529324">.</span><span class="ident" id="3529325">Path</span><span class="op" id="3529329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529332">return</span>&nbsp;<span class="op" id="3529339">&amp;</span><span class="ident" id="3529340">url</span><br>
<span class="lineno"></span><span class="op" id="3529344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="3529347">//&nbsp;Query&nbsp;parses&nbsp;RawQuery&nbsp;and&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3529410">func</span>&nbsp;<span class="op" id="3529415">(</span><span class="ident" id="3529416">u</span>&nbsp;<span class="op" id="3529418">*</span><span class="ident" id="3529419">URL</span><span class="op" id="3529422">)</span>&nbsp;<span class="ident" id="3529424">Query</span><span class="op" id="3529429">(</span><span class="op" id="3529430">)</span>&nbsp;<span class="ident" id="3529432">Values</span>&nbsp;<span class="op" id="3529439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529442">v</span><span class="op" id="3529443">,</span>&nbsp;<span class="ident" id="3529445">_</span>&nbsp;<span class="op" id="3529447">:=</span>&nbsp;<span class="ident" id="3529450">ParseQuery</span><span class="op" id="3529460">(</span><span class="ident" id="3529461">u</span><span class="op" id="3529462">.</span><span class="ident" id="3529463">RawQuery</span><span class="op" id="3529471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529474">return</span>&nbsp;<span class="ident" id="3529481">v</span><br>
<span class="lineno"></span><span class="op" id="3529483">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="comment" id="3529486">//&nbsp;RequestURI&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;path?query&nbsp;or&nbsp;opaque?query</span><br>
<span class="lineno"></span><span class="comment" id="3529547">//&nbsp;string&nbsp;that&nbsp;would&nbsp;be&nbsp;used&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;for&nbsp;u.</span><br>
<span class="lineno"></span><span class="keyword" id="3529602">func</span>&nbsp;<span class="op" id="3529607">(</span><span class="ident" id="3529608">u</span>&nbsp;<span class="op" id="3529610">*</span><span class="ident" id="3529611">URL</span><span class="op" id="3529614">)</span>&nbsp;<span class="ident" id="3529616">RequestURI</span><span class="op" id="3529626">(</span><span class="op" id="3529627">)</span>&nbsp;<span class="builtintype" id="3529629">string</span>&nbsp;<span class="op" id="3529636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529639">result</span>&nbsp;<span class="op" id="3529646">:=</span>&nbsp;<span class="ident" id="3529649">u</span><span class="op" id="3529650">.</span><span class="ident" id="3529651">Opaque</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529659">if</span>&nbsp;<span class="ident" id="3529662">result</span>&nbsp;<span class="op" id="3529669">==</span>&nbsp;<span class="string" id="3529672">&#34;&#34;</span>&nbsp;<span class="op" id="3529675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529679">result</span>&nbsp;<span class="op" id="3529686">=</span>&nbsp;<span class="ident" id="3529688">escape</span><span class="op" id="3529694">(</span><span class="ident" id="3529695">u</span><span class="op" id="3529696">.</span><span class="ident" id="3529697">Path</span><span class="op" id="3529701">,</span>&nbsp;<span class="ident" id="3529703">encodePath</span><span class="op" id="3529713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529717">if</span>&nbsp;<span class="ident" id="3529720">result</span>&nbsp;<span class="op" id="3529727">==</span>&nbsp;<span class="string" id="3529730">&#34;&#34;</span>&nbsp;<span class="op" id="3529733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529738">result</span>&nbsp;<span class="op" id="3529745">=</span>&nbsp;<span class="string" id="3529747">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3529753">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3529756">}</span>&nbsp;<span class="keyword" id="3529758">else</span>&nbsp;<span class="op" id="3529763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529767">if</span>&nbsp;<span class="ident" id="3529770">strings</span><span class="op" id="3529777">.</span><span class="ident" id="3529778">HasPrefix</span><span class="op" id="3529787">(</span><span class="ident" id="3529788">result</span><span class="op" id="3529794">,</span>&nbsp;<span class="string" id="3529796">&#34;//&#34;</span><span class="op" id="3529800">)</span>&nbsp;<span class="op" id="3529802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529807">result</span>&nbsp;<span class="op" id="3529814">=</span>&nbsp;<span class="ident" id="3529816">u</span><span class="op" id="3529817">.</span><span class="ident" id="3529818">Scheme</span>&nbsp;<span class="op" id="3529825">+</span>&nbsp;<span class="string" id="3529827">&#34;:&#34;</span>&nbsp;<span class="op" id="3529831">+</span>&nbsp;<span class="ident" id="3529833">result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3529842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3529845">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529848">if</span>&nbsp;<span class="ident" id="3529851">u</span><span class="op" id="3529852">.</span><span class="ident" id="3529853">RawQuery</span>&nbsp;<span class="op" id="3529862">!=</span>&nbsp;<span class="string" id="3529865">&#34;&#34;</span>&nbsp;<span class="op" id="3529868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529872">result</span>&nbsp;<span class="op" id="3529879">+=</span>&nbsp;<span class="string" id="3529882">&#34;?&#34;</span>&nbsp;<span class="op" id="3529886">+</span>&nbsp;<span class="ident" id="3529888">u</span><span class="op" id="3529889">.</span><span class="ident" id="3529890">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3529900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529903">return</span>&nbsp;<span class="ident" id="3529910">result</span><br>
<span class="lineno"></span><span class="op" id="3529917">}</span>
</div>
</body>
</html>
