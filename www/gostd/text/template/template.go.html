<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>text/template</h2>
<ul>
<li><a href="/gostd/text/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/text/template/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/text/template/examplefiles_test.go.html">examplefiles_test.go</a></li>
<li><a href="/gostd/text/template/examplefunc_test.go.html">examplefunc_test.go</a></li>
<li><a href="/gostd/text/template/exec.go.html">exec.go</a></li>
<li><a href="/gostd/text/template/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/text/template/funcs.go.html">funcs.go</a></li>
<li><a href="/gostd/text/template/helper.go.html">helper.go</a></li>
<li><a href="/gostd/text/template/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/text/template/template.go.html" class="current">template.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3255458">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3255513">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3255567">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3255618">package</span>&nbsp;<span class="ident" id="3255626">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3255636">import</span>&nbsp;<span class="op" id="3255643">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3255646">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3255653">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3255664">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="3255686">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3255689">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;information&nbsp;shared&nbsp;by&nbsp;related&nbsp;templates.</span><br>
<span class="lineno"></span><span class="keyword" id="3255750">type</span>&nbsp;<span class="ident" id="3255755">common</span>&nbsp;<span class="keyword" id="3255762">struct</span>&nbsp;<span class="op" id="3255769">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3255772">tmpl</span>&nbsp;<span class="keyword" id="3255777">map</span><span class="op" id="3255780">[</span><span class="builtintype" id="3255781">string</span><span class="op" id="3255787">]</span><span class="op" id="3255788">*</span><span class="ident" id="3255789">Template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3255799">//&nbsp;We&nbsp;use&nbsp;two&nbsp;maps,&nbsp;one&nbsp;for&nbsp;parsing&nbsp;and&nbsp;one&nbsp;for&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3255859">//&nbsp;This&nbsp;separation&nbsp;makes&nbsp;the&nbsp;API&nbsp;cleaner&nbsp;since&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3255918">//&nbsp;expose&nbsp;reflection&nbsp;to&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3255955">parseFuncs</span>&nbsp;<span class="ident" id="3255966">FuncMap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3255975">execFuncs</span>&nbsp;&nbsp;<span class="keyword" id="3255986">map</span><span class="op" id="3255989">[</span><span class="builtintype" id="3255990">string</span><span class="op" id="3255996">]</span><span class="ident" id="3255997">reflect</span><span class="op" id="3256004">.</span><span class="ident" id="3256005">Value</span><br>
<span class="lineno"></span><span class="op" id="3256011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3256014">//&nbsp;Template&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;parsed&nbsp;template.&nbsp;The&nbsp;*parse.Tree</span><br>
<span class="lineno"></span><span class="comment" id="3256086">//&nbsp;field&nbsp;is&nbsp;exported&nbsp;only&nbsp;for&nbsp;use&nbsp;by&nbsp;html/template&nbsp;and&nbsp;should&nbsp;be&nbsp;treated</span><br>
<span class="lineno">25</span><span class="comment" id="3256159">//&nbsp;as&nbsp;unexported&nbsp;by&nbsp;all&nbsp;other&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="3256198">type</span>&nbsp;<span class="ident" id="3256203">Template</span>&nbsp;<span class="keyword" id="3256212">struct</span>&nbsp;<span class="op" id="3256219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3256222">name</span>&nbsp;<span class="builtintype" id="3256227">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3256235">*</span><span class="ident" id="3256236">parse</span><span class="op" id="3256241">.</span><span class="ident" id="3256242">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3256248">*</span><span class="ident" id="3256249">common</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3256257">leftDelim</span>&nbsp;&nbsp;<span class="builtintype" id="3256268">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3256276">rightDelim</span>&nbsp;<span class="builtintype" id="3256287">string</span><br>
<span class="lineno"></span><span class="op" id="3256294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3256297">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno">35</span><span class="keyword" id="3256350">func</span>&nbsp;<span class="ident" id="3256355">New</span><span class="op" id="3256358">(</span><span class="ident" id="3256359">name</span>&nbsp;<span class="builtintype" id="3256364">string</span><span class="op" id="3256370">)</span>&nbsp;<span class="op" id="3256372">*</span><span class="ident" id="3256373">Template</span>&nbsp;<span class="op" id="3256382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3256385">return</span>&nbsp;<span class="op" id="3256392">&amp;</span><span class="ident" id="3256393">Template</span><span class="op" id="3256401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3256405">name</span><span class="op" id="3256409">:</span>&nbsp;<span class="ident" id="3256411">name</span><span class="op" id="3256415">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3256418">}</span><br>
<span class="lineno"></span><span class="op" id="3256420">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="3256423">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;template.</span><br>
<span class="lineno"></span><span class="keyword" id="3256465">func</span>&nbsp;<span class="op" id="3256470">(</span><span class="ident" id="3256471">t</span>&nbsp;<span class="op" id="3256473">*</span><span class="ident" id="3256474">Template</span><span class="op" id="3256482">)</span>&nbsp;<span class="ident" id="3256484">Name</span><span class="op" id="3256488">(</span><span class="op" id="3256489">)</span>&nbsp;<span class="builtintype" id="3256491">string</span>&nbsp;<span class="op" id="3256498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3256501">return</span>&nbsp;<span class="ident" id="3256508">t</span><span class="op" id="3256509">.</span><span class="ident" id="3256510">name</span><br>
<span class="lineno"></span><span class="op" id="3256515">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3256518">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;one&nbsp;and&nbsp;with&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3256598">//&nbsp;delimiters.&nbsp;The&nbsp;association,&nbsp;which&nbsp;is&nbsp;transitive,&nbsp;allows&nbsp;one&nbsp;template&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3256674">//&nbsp;invoke&nbsp;another&nbsp;with&nbsp;a&nbsp;{{template}}&nbsp;action.</span><br>
<span class="lineno"></span><span class="keyword" id="3256720">func</span>&nbsp;<span class="op" id="3256725">(</span><span class="ident" id="3256726">t</span>&nbsp;<span class="op" id="3256728">*</span><span class="ident" id="3256729">Template</span><span class="op" id="3256737">)</span>&nbsp;<span class="ident" id="3256739">New</span><span class="op" id="3256742">(</span><span class="ident" id="3256743">name</span>&nbsp;<span class="builtintype" id="3256748">string</span><span class="op" id="3256754">)</span>&nbsp;<span class="op" id="3256756">*</span><span class="ident" id="3256757">Template</span>&nbsp;<span class="op" id="3256766">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3256769">t</span><span class="op" id="3256770">.</span><span class="ident" id="3256771">init</span><span class="op" id="3256775">(</span><span class="op" id="3256776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3256779">return</span>&nbsp;<span class="op" id="3256786">&amp;</span><span class="ident" id="3256787">Template</span><span class="op" id="3256795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3256799">name</span><span class="op" id="3256803">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3256811">name</span><span class="op" id="3256815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3256819">common</span><span class="op" id="3256825">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3256831">t</span><span class="op" id="3256832">.</span><span class="ident" id="3256833">common</span><span class="op" id="3256839">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3256843">leftDelim</span><span class="op" id="3256852">:</span>&nbsp;&nbsp;<span class="ident" id="3256855">t</span><span class="op" id="3256856">.</span><span class="ident" id="3256857">leftDelim</span><span class="op" id="3256866">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3256870">rightDelim</span><span class="op" id="3256880">:</span>&nbsp;<span class="ident" id="3256882">t</span><span class="op" id="3256883">.</span><span class="ident" id="3256884">rightDelim</span><span class="op" id="3256894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3256897">}</span><br>
<span class="lineno"></span><span class="op" id="3256899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3256902">func</span>&nbsp;<span class="op" id="3256907">(</span><span class="ident" id="3256908">t</span>&nbsp;<span class="op" id="3256910">*</span><span class="ident" id="3256911">Template</span><span class="op" id="3256919">)</span>&nbsp;<span class="ident" id="3256921">init</span><span class="op" id="3256925">(</span><span class="op" id="3256926">)</span>&nbsp;<span class="op" id="3256928">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3256931">if</span>&nbsp;<span class="ident" id="3256934">t</span><span class="op" id="3256935">.</span><span class="ident" id="3256936">common</span>&nbsp;<span class="op" id="3256943">==</span>&nbsp;<span class="ident" id="3256946">nil</span>&nbsp;<span class="op" id="3256950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3256954">t</span><span class="op" id="3256955">.</span><span class="ident" id="3256956">common</span>&nbsp;<span class="op" id="3256963">=</span>&nbsp;<span class="builtinfunc" id="3256965">new</span><span class="op" id="3256968">(</span><span class="ident" id="3256969">common</span><span class="op" id="3256975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3256979">t</span><span class="op" id="3256980">.</span><span class="ident" id="3256981">tmpl</span>&nbsp;<span class="op" id="3256986">=</span>&nbsp;<span class="builtinfunc" id="3256988">make</span><span class="op" id="3256992">(</span><span class="keyword" id="3256993">map</span><span class="op" id="3256996">[</span><span class="builtintype" id="3256997">string</span><span class="op" id="3257003">]</span><span class="op" id="3257004">*</span><span class="ident" id="3257005">Template</span><span class="op" id="3257013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257017">t</span><span class="op" id="3257018">.</span><span class="ident" id="3257019">parseFuncs</span>&nbsp;<span class="op" id="3257030">=</span>&nbsp;<span class="builtinfunc" id="3257032">make</span><span class="op" id="3257036">(</span><span class="ident" id="3257037">FuncMap</span><span class="op" id="3257044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257048">t</span><span class="op" id="3257049">.</span><span class="ident" id="3257050">execFuncs</span>&nbsp;<span class="op" id="3257060">=</span>&nbsp;<span class="builtinfunc" id="3257062">make</span><span class="op" id="3257066">(</span><span class="keyword" id="3257067">map</span><span class="op" id="3257070">[</span><span class="builtintype" id="3257071">string</span><span class="op" id="3257077">]</span><span class="ident" id="3257078">reflect</span><span class="op" id="3257085">.</span><span class="ident" id="3257086">Value</span><span class="op" id="3257091">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3257094">}</span><br>
<span class="lineno"></span><span class="op" id="3257096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3257099">//&nbsp;Clone&nbsp;returns&nbsp;a&nbsp;duplicate&nbsp;of&nbsp;the&nbsp;template,&nbsp;including&nbsp;all&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="3257170">//&nbsp;templates.&nbsp;The&nbsp;actual&nbsp;representation&nbsp;is&nbsp;not&nbsp;copied,&nbsp;but&nbsp;the&nbsp;name&nbsp;space&nbsp;of</span><br>
<span class="lineno">70</span><span class="comment" id="3257247">//&nbsp;associated&nbsp;templates&nbsp;is,&nbsp;so&nbsp;further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add</span><br>
<span class="lineno"></span><span class="comment" id="3257322">//&nbsp;templates&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&nbsp;Clone&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;prepare</span><br>
<span class="lineno"></span><span class="comment" id="3257401">//&nbsp;common&nbsp;templates&nbsp;and&nbsp;use&nbsp;them&nbsp;with&nbsp;variant&nbsp;definitions&nbsp;for&nbsp;other&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="3257479">//&nbsp;by&nbsp;adding&nbsp;the&nbsp;variants&nbsp;after&nbsp;the&nbsp;clone&nbsp;is&nbsp;made.</span><br>
<span class="lineno"></span><span class="keyword" id="3257530">func</span>&nbsp;<span class="op" id="3257535">(</span><span class="ident" id="3257536">t</span>&nbsp;<span class="op" id="3257538">*</span><span class="ident" id="3257539">Template</span><span class="op" id="3257547">)</span>&nbsp;<span class="ident" id="3257549">Clone</span><span class="op" id="3257554">(</span><span class="op" id="3257555">)</span>&nbsp;<span class="op" id="3257557">(</span><span class="op" id="3257558">*</span><span class="ident" id="3257559">Template</span><span class="op" id="3257567">,</span>&nbsp;<span class="builtintype" id="3257569">error</span><span class="op" id="3257574">)</span>&nbsp;<span class="op" id="3257576">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257579">nt</span>&nbsp;<span class="op" id="3257582">:=</span>&nbsp;<span class="ident" id="3257585">t</span><span class="op" id="3257586">.</span><span class="builtinfunc" id="3257587">copy</span><span class="op" id="3257591">(</span><span class="ident" id="3257592">nil</span><span class="op" id="3257595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257598">nt</span><span class="op" id="3257600">.</span><span class="ident" id="3257601">init</span><span class="op" id="3257605">(</span><span class="op" id="3257606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257609">nt</span><span class="op" id="3257611">.</span><span class="ident" id="3257612">tmpl</span><span class="op" id="3257616">[</span><span class="ident" id="3257617">t</span><span class="op" id="3257618">.</span><span class="ident" id="3257619">name</span><span class="op" id="3257623">]</span>&nbsp;<span class="op" id="3257625">=</span>&nbsp;<span class="ident" id="3257627">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257631">for</span>&nbsp;<span class="ident" id="3257635">k</span><span class="op" id="3257636">,</span>&nbsp;<span class="ident" id="3257638">v</span>&nbsp;<span class="op" id="3257640">:=</span>&nbsp;<span class="keyword" id="3257643">range</span>&nbsp;<span class="ident" id="3257649">t</span><span class="op" id="3257650">.</span><span class="ident" id="3257651">tmpl</span>&nbsp;<span class="op" id="3257656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257660">if</span>&nbsp;<span class="ident" id="3257663">k</span>&nbsp;<span class="op" id="3257665">==</span>&nbsp;<span class="ident" id="3257668">t</span><span class="op" id="3257669">.</span><span class="ident" id="3257670">name</span>&nbsp;<span class="op" id="3257675">{</span>&nbsp;<span class="comment" id="3257677">//&nbsp;Already&nbsp;installed.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257702">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3257713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3257717">//&nbsp;The&nbsp;associated&nbsp;templates&nbsp;share&nbsp;nt&#39;s&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257776">tmpl</span>&nbsp;<span class="op" id="3257781">:=</span>&nbsp;<span class="ident" id="3257784">v</span><span class="op" id="3257785">.</span><span class="builtinfunc" id="3257786">copy</span><span class="op" id="3257790">(</span><span class="ident" id="3257791">nt</span><span class="op" id="3257793">.</span><span class="ident" id="3257794">common</span><span class="op" id="3257800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257804">nt</span><span class="op" id="3257806">.</span><span class="ident" id="3257807">tmpl</span><span class="op" id="3257811">[</span><span class="ident" id="3257812">k</span><span class="op" id="3257813">]</span>&nbsp;<span class="op" id="3257815">=</span>&nbsp;<span class="ident" id="3257817">tmpl</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3257823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257826">for</span>&nbsp;<span class="ident" id="3257830">k</span><span class="op" id="3257831">,</span>&nbsp;<span class="ident" id="3257833">v</span>&nbsp;<span class="op" id="3257835">:=</span>&nbsp;<span class="keyword" id="3257838">range</span>&nbsp;<span class="ident" id="3257844">t</span><span class="op" id="3257845">.</span><span class="ident" id="3257846">parseFuncs</span>&nbsp;<span class="op" id="3257857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257861">nt</span><span class="op" id="3257863">.</span><span class="ident" id="3257864">parseFuncs</span><span class="op" id="3257874">[</span><span class="ident" id="3257875">k</span><span class="op" id="3257876">]</span>&nbsp;<span class="op" id="3257878">=</span>&nbsp;<span class="ident" id="3257880">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3257883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257886">for</span>&nbsp;<span class="ident" id="3257890">k</span><span class="op" id="3257891">,</span>&nbsp;<span class="ident" id="3257893">v</span>&nbsp;<span class="op" id="3257895">:=</span>&nbsp;<span class="keyword" id="3257898">range</span>&nbsp;<span class="ident" id="3257904">t</span><span class="op" id="3257905">.</span><span class="ident" id="3257906">execFuncs</span>&nbsp;<span class="op" id="3257916">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3257920">nt</span><span class="op" id="3257922">.</span><span class="ident" id="3257923">execFuncs</span><span class="op" id="3257932">[</span><span class="ident" id="3257933">k</span><span class="op" id="3257934">]</span>&nbsp;<span class="op" id="3257936">=</span>&nbsp;<span class="ident" id="3257938">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3257941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3257944">return</span>&nbsp;<span class="ident" id="3257951">nt</span><span class="op" id="3257953">,</span>&nbsp;<span class="ident" id="3257955">nil</span><br>
<span class="lineno"></span><span class="op" id="3257959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3257962">//&nbsp;copy&nbsp;returns&nbsp;a&nbsp;shallow&nbsp;copy&nbsp;of&nbsp;t,&nbsp;with&nbsp;common&nbsp;set&nbsp;to&nbsp;the&nbsp;argument.</span><br>
<span class="lineno"></span><span class="keyword" id="3258032">func</span>&nbsp;<span class="op" id="3258037">(</span><span class="ident" id="3258038">t</span>&nbsp;<span class="op" id="3258040">*</span><span class="ident" id="3258041">Template</span><span class="op" id="3258049">)</span>&nbsp;<span class="builtinfunc" id="3258051">copy</span><span class="op" id="3258055">(</span><span class="ident" id="3258056">c</span>&nbsp;<span class="op" id="3258058">*</span><span class="ident" id="3258059">common</span><span class="op" id="3258065">)</span>&nbsp;<span class="op" id="3258067">*</span><span class="ident" id="3258068">Template</span>&nbsp;<span class="op" id="3258077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3258080">nt</span>&nbsp;<span class="op" id="3258083">:=</span>&nbsp;<span class="ident" id="3258086">New</span><span class="op" id="3258089">(</span><span class="ident" id="3258090">t</span><span class="op" id="3258091">.</span><span class="ident" id="3258092">name</span><span class="op" id="3258096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3258099">nt</span><span class="op" id="3258101">.</span><span class="ident" id="3258102">Tree</span>&nbsp;<span class="op" id="3258107">=</span>&nbsp;<span class="ident" id="3258109">t</span><span class="op" id="3258110">.</span><span class="ident" id="3258111">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3258117">nt</span><span class="op" id="3258119">.</span><span class="ident" id="3258120">common</span>&nbsp;<span class="op" id="3258127">=</span>&nbsp;<span class="ident" id="3258129">c</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3258132">nt</span><span class="op" id="3258134">.</span><span class="ident" id="3258135">leftDelim</span>&nbsp;<span class="op" id="3258145">=</span>&nbsp;<span class="ident" id="3258147">t</span><span class="op" id="3258148">.</span><span class="ident" id="3258149">leftDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3258160">nt</span><span class="op" id="3258162">.</span><span class="ident" id="3258163">rightDelim</span>&nbsp;<span class="op" id="3258174">=</span>&nbsp;<span class="ident" id="3258176">t</span><span class="op" id="3258177">.</span><span class="ident" id="3258178">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258190">return</span>&nbsp;<span class="ident" id="3258197">nt</span><br>
<span class="lineno"></span><span class="op" id="3258200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3258203">//&nbsp;AddParseTree&nbsp;creates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;name&nbsp;and&nbsp;parse&nbsp;tree</span><br>
<span class="lineno"></span><span class="comment" id="3258271">//&nbsp;and&nbsp;associates&nbsp;it&nbsp;with&nbsp;t.</span><br>
<span class="lineno"></span><span class="keyword" id="3258300">func</span>&nbsp;<span class="op" id="3258305">(</span><span class="ident" id="3258306">t</span>&nbsp;<span class="op" id="3258308">*</span><span class="ident" id="3258309">Template</span><span class="op" id="3258317">)</span>&nbsp;<span class="ident" id="3258319">AddParseTree</span><span class="op" id="3258331">(</span><span class="ident" id="3258332">name</span>&nbsp;<span class="builtintype" id="3258337">string</span><span class="op" id="3258343">,</span>&nbsp;<span class="ident" id="3258345">tree</span>&nbsp;<span class="op" id="3258350">*</span><span class="ident" id="3258351">parse</span><span class="op" id="3258356">.</span><span class="ident" id="3258357">Tree</span><span class="op" id="3258361">)</span>&nbsp;<span class="op" id="3258363">(</span><span class="op" id="3258364">*</span><span class="ident" id="3258365">Template</span><span class="op" id="3258373">,</span>&nbsp;<span class="builtintype" id="3258375">error</span><span class="op" id="3258380">)</span>&nbsp;<span class="op" id="3258382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258385">if</span>&nbsp;<span class="ident" id="3258388">t</span><span class="op" id="3258389">.</span><span class="ident" id="3258390">common</span>&nbsp;<span class="op" id="3258397">!=</span>&nbsp;<span class="ident" id="3258400">nil</span>&nbsp;<span class="op" id="3258404">&amp;&amp;</span>&nbsp;<span class="ident" id="3258407">t</span><span class="op" id="3258408">.</span><span class="ident" id="3258409">tmpl</span><span class="op" id="3258413">[</span><span class="ident" id="3258414">name</span><span class="op" id="3258418">]</span>&nbsp;<span class="op" id="3258420">!=</span>&nbsp;<span class="ident" id="3258423">nil</span>&nbsp;<span class="op" id="3258427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258431">return</span>&nbsp;<span class="ident" id="3258438">nil</span><span class="op" id="3258441">,</span>&nbsp;<span class="ident" id="3258443">fmt</span><span class="op" id="3258446">.</span><span class="ident" id="3258447">Errorf</span><span class="op" id="3258453">(</span><span class="string" id="3258454">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="3258493">,</span>&nbsp;<span class="ident" id="3258495">name</span><span class="op" id="3258499">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3258502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3258505">nt</span>&nbsp;<span class="op" id="3258508">:=</span>&nbsp;<span class="ident" id="3258511">t</span><span class="op" id="3258512">.</span><span class="ident" id="3258513">New</span><span class="op" id="3258516">(</span><span class="ident" id="3258517">name</span><span class="op" id="3258521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3258524">nt</span><span class="op" id="3258526">.</span><span class="ident" id="3258527">Tree</span>&nbsp;<span class="op" id="3258532">=</span>&nbsp;<span class="ident" id="3258534">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3258540">t</span><span class="op" id="3258541">.</span><span class="ident" id="3258542">tmpl</span><span class="op" id="3258546">[</span><span class="ident" id="3258547">name</span><span class="op" id="3258551">]</span>&nbsp;<span class="op" id="3258553">=</span>&nbsp;<span class="ident" id="3258555">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258559">return</span>&nbsp;<span class="ident" id="3258566">nt</span><span class="op" id="3258568">,</span>&nbsp;<span class="ident" id="3258570">nil</span><br>
<span class="lineno">115</span><span class="op" id="3258574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3258577">//&nbsp;Templates&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;templates&nbsp;associated&nbsp;with&nbsp;t,&nbsp;including&nbsp;t</span><br>
<span class="lineno"></span><span class="comment" id="3258654">//&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="3258665">func</span>&nbsp;<span class="op" id="3258670">(</span><span class="ident" id="3258671">t</span>&nbsp;<span class="op" id="3258673">*</span><span class="ident" id="3258674">Template</span><span class="op" id="3258682">)</span>&nbsp;<span class="ident" id="3258684">Templates</span><span class="op" id="3258693">(</span><span class="op" id="3258694">)</span>&nbsp;<span class="op" id="3258696">[</span><span class="op" id="3258697">]</span><span class="op" id="3258698">*</span><span class="ident" id="3258699">Template</span>&nbsp;<span class="op" id="3258708">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258711">if</span>&nbsp;<span class="ident" id="3258714">t</span><span class="op" id="3258715">.</span><span class="ident" id="3258716">common</span>&nbsp;<span class="op" id="3258723">==</span>&nbsp;<span class="ident" id="3258726">nil</span>&nbsp;<span class="op" id="3258730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258734">return</span>&nbsp;<span class="ident" id="3258741">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3258746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3258749">//&nbsp;Return&nbsp;a&nbsp;slice&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;expose&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3258796">m</span>&nbsp;<span class="op" id="3258798">:=</span>&nbsp;<span class="builtinfunc" id="3258801">make</span><span class="op" id="3258805">(</span><span class="op" id="3258806">[</span><span class="op" id="3258807">]</span><span class="op" id="3258808">*</span><span class="ident" id="3258809">Template</span><span class="op" id="3258817">,</span>&nbsp;<span class="num" id="3258819">0</span><span class="op" id="3258820">,</span>&nbsp;<span class="builtinfunc" id="3258822">len</span><span class="op" id="3258825">(</span><span class="ident" id="3258826">t</span><span class="op" id="3258827">.</span><span class="ident" id="3258828">tmpl</span><span class="op" id="3258832">)</span><span class="op" id="3258833">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258836">for</span>&nbsp;<span class="ident" id="3258840">_</span><span class="op" id="3258841">,</span>&nbsp;<span class="ident" id="3258843">v</span>&nbsp;<span class="op" id="3258845">:=</span>&nbsp;<span class="keyword" id="3258848">range</span>&nbsp;<span class="ident" id="3258854">t</span><span class="op" id="3258855">.</span><span class="ident" id="3258856">tmpl</span>&nbsp;<span class="op" id="3258861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3258865">m</span>&nbsp;<span class="op" id="3258867">=</span>&nbsp;<span class="builtinfunc" id="3258869">append</span><span class="op" id="3258875">(</span><span class="ident" id="3258876">m</span><span class="op" id="3258877">,</span>&nbsp;<span class="ident" id="3258879">v</span><span class="op" id="3258880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3258883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3258886">return</span>&nbsp;<span class="ident" id="3258893">m</span><br>
<span class="lineno"></span><span class="op" id="3258895">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="3258898">//&nbsp;Delims&nbsp;sets&nbsp;the&nbsp;action&nbsp;delimiters&nbsp;to&nbsp;the&nbsp;specified&nbsp;strings,&nbsp;to&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3258975">//&nbsp;subsequent&nbsp;calls&nbsp;to&nbsp;Parse,&nbsp;ParseFiles,&nbsp;or&nbsp;ParseGlob.&nbsp;Nested&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="3259047">//&nbsp;definitions&nbsp;will&nbsp;inherit&nbsp;the&nbsp;settings.&nbsp;An&nbsp;empty&nbsp;delimiter&nbsp;stands&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3259123">//&nbsp;corresponding&nbsp;default:&nbsp;{{&nbsp;or&nbsp;}}.</span><br>
<span class="lineno">135</span><span class="comment" id="3259159">//&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="3259221">func</span>&nbsp;<span class="op" id="3259226">(</span><span class="ident" id="3259227">t</span>&nbsp;<span class="op" id="3259229">*</span><span class="ident" id="3259230">Template</span><span class="op" id="3259238">)</span>&nbsp;<span class="ident" id="3259240">Delims</span><span class="op" id="3259246">(</span><span class="ident" id="3259247">left</span><span class="op" id="3259251">,</span>&nbsp;<span class="ident" id="3259253">right</span>&nbsp;<span class="builtintype" id="3259259">string</span><span class="op" id="3259265">)</span>&nbsp;<span class="op" id="3259267">*</span><span class="ident" id="3259268">Template</span>&nbsp;<span class="op" id="3259277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3259280">t</span><span class="op" id="3259281">.</span><span class="ident" id="3259282">leftDelim</span>&nbsp;<span class="op" id="3259292">=</span>&nbsp;<span class="ident" id="3259294">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3259300">t</span><span class="op" id="3259301">.</span><span class="ident" id="3259302">rightDelim</span>&nbsp;<span class="op" id="3259313">=</span>&nbsp;<span class="ident" id="3259315">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3259322">return</span>&nbsp;<span class="ident" id="3259329">t</span><br>
<span class="lineno">140</span><span class="op" id="3259331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3259334">//&nbsp;Funcs&nbsp;adds&nbsp;the&nbsp;elements&nbsp;of&nbsp;the&nbsp;argument&nbsp;map&nbsp;to&nbsp;the&nbsp;template&#39;s&nbsp;function&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="3259413">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;a&nbsp;value&nbsp;in&nbsp;the&nbsp;map&nbsp;is&nbsp;not&nbsp;a&nbsp;function&nbsp;with&nbsp;appropriate&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="3259490">//&nbsp;type.&nbsp;However,&nbsp;it&nbsp;is&nbsp;legal&nbsp;to&nbsp;overwrite&nbsp;elements&nbsp;of&nbsp;the&nbsp;map.&nbsp;The&nbsp;return</span><br>
<span class="lineno">145</span><span class="comment" id="3259565">//&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="3259616">func</span>&nbsp;<span class="op" id="3259621">(</span><span class="ident" id="3259622">t</span>&nbsp;<span class="op" id="3259624">*</span><span class="ident" id="3259625">Template</span><span class="op" id="3259633">)</span>&nbsp;<span class="ident" id="3259635">Funcs</span><span class="op" id="3259640">(</span><span class="ident" id="3259641">funcMap</span>&nbsp;<span class="ident" id="3259649">FuncMap</span><span class="op" id="3259656">)</span>&nbsp;<span class="op" id="3259658">*</span><span class="ident" id="3259659">Template</span>&nbsp;<span class="op" id="3259668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3259671">t</span><span class="op" id="3259672">.</span><span class="ident" id="3259673">init</span><span class="op" id="3259677">(</span><span class="op" id="3259678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3259681">addValueFuncs</span><span class="op" id="3259694">(</span><span class="ident" id="3259695">t</span><span class="op" id="3259696">.</span><span class="ident" id="3259697">execFuncs</span><span class="op" id="3259706">,</span>&nbsp;<span class="ident" id="3259708">funcMap</span><span class="op" id="3259715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3259718">addFuncs</span><span class="op" id="3259726">(</span><span class="ident" id="3259727">t</span><span class="op" id="3259728">.</span><span class="ident" id="3259729">parseFuncs</span><span class="op" id="3259739">,</span>&nbsp;<span class="ident" id="3259741">funcMap</span><span class="op" id="3259748">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3259751">return</span>&nbsp;<span class="ident" id="3259758">t</span><br>
<span class="lineno"></span><span class="op" id="3259760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3259763">//&nbsp;Lookup&nbsp;returns&nbsp;the&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name&nbsp;that&nbsp;is&nbsp;associated&nbsp;with&nbsp;t,</span><br>
<span class="lineno"></span><span class="comment" id="3259841">//&nbsp;or&nbsp;nil&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;such&nbsp;template.</span><br>
<span class="lineno">155</span><span class="keyword" id="3259881">func</span>&nbsp;<span class="op" id="3259886">(</span><span class="ident" id="3259887">t</span>&nbsp;<span class="op" id="3259889">*</span><span class="ident" id="3259890">Template</span><span class="op" id="3259898">)</span>&nbsp;<span class="ident" id="3259900">Lookup</span><span class="op" id="3259906">(</span><span class="ident" id="3259907">name</span>&nbsp;<span class="builtintype" id="3259912">string</span><span class="op" id="3259918">)</span>&nbsp;<span class="op" id="3259920">*</span><span class="ident" id="3259921">Template</span>&nbsp;<span class="op" id="3259930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3259933">if</span>&nbsp;<span class="ident" id="3259936">t</span><span class="op" id="3259937">.</span><span class="ident" id="3259938">common</span>&nbsp;<span class="op" id="3259945">==</span>&nbsp;<span class="ident" id="3259948">nil</span>&nbsp;<span class="op" id="3259952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3259956">return</span>&nbsp;<span class="ident" id="3259963">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3259968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3259971">return</span>&nbsp;<span class="ident" id="3259978">t</span><span class="op" id="3259979">.</span><span class="ident" id="3259980">tmpl</span><span class="op" id="3259984">[</span><span class="ident" id="3259985">name</span><span class="op" id="3259989">]</span><br>
<span class="lineno">160</span><span class="op" id="3259991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3259994">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;string&nbsp;into&nbsp;a&nbsp;template.&nbsp;Nested&nbsp;template&nbsp;definitions&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3260072">//&nbsp;associated&nbsp;with&nbsp;the&nbsp;top-level&nbsp;template&nbsp;t.&nbsp;Parse&nbsp;may&nbsp;be&nbsp;called&nbsp;multiple&nbsp;times</span><br>
<span class="lineno"></span><span class="comment" id="3260152">//&nbsp;to&nbsp;parse&nbsp;definitions&nbsp;of&nbsp;templates&nbsp;to&nbsp;associate&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;if&nbsp;a</span><br>
<span class="lineno">165</span><span class="comment" id="3260230">//&nbsp;resulting&nbsp;template&nbsp;is&nbsp;non-empty&nbsp;(contains&nbsp;content&nbsp;other&nbsp;than&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="3260303">//&nbsp;definitions)&nbsp;and&nbsp;would&nbsp;replace&nbsp;a&nbsp;non-empty&nbsp;template&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="3260378">//&nbsp;(In&nbsp;multiple&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;with&nbsp;the&nbsp;same&nbsp;receiver&nbsp;template,&nbsp;only&nbsp;one&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3260456">//&nbsp;can&nbsp;contain&nbsp;text&nbsp;other&nbsp;than&nbsp;space,&nbsp;comments,&nbsp;and&nbsp;template&nbsp;definitions.)</span><br>
<span class="lineno"></span><span class="keyword" id="3260531">func</span>&nbsp;<span class="op" id="3260536">(</span><span class="ident" id="3260537">t</span>&nbsp;<span class="op" id="3260539">*</span><span class="ident" id="3260540">Template</span><span class="op" id="3260548">)</span>&nbsp;<span class="ident" id="3260550">Parse</span><span class="op" id="3260555">(</span><span class="ident" id="3260556">text</span>&nbsp;<span class="builtintype" id="3260561">string</span><span class="op" id="3260567">)</span>&nbsp;<span class="op" id="3260569">(</span><span class="op" id="3260570">*</span><span class="ident" id="3260571">Template</span><span class="op" id="3260579">,</span>&nbsp;<span class="builtintype" id="3260581">error</span><span class="op" id="3260586">)</span>&nbsp;<span class="op" id="3260588">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3260591">t</span><span class="op" id="3260592">.</span><span class="ident" id="3260593">init</span><span class="op" id="3260597">(</span><span class="op" id="3260598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3260601">trees</span><span class="op" id="3260606">,</span>&nbsp;<span class="ident" id="3260608">err</span>&nbsp;<span class="op" id="3260612">:=</span>&nbsp;<span class="ident" id="3260615">parse</span><span class="op" id="3260620">.</span><span class="ident" id="3260621">Parse</span><span class="op" id="3260626">(</span><span class="ident" id="3260627">t</span><span class="op" id="3260628">.</span><span class="ident" id="3260629">name</span><span class="op" id="3260633">,</span>&nbsp;<span class="ident" id="3260635">text</span><span class="op" id="3260639">,</span>&nbsp;<span class="ident" id="3260641">t</span><span class="op" id="3260642">.</span><span class="ident" id="3260643">leftDelim</span><span class="op" id="3260652">,</span>&nbsp;<span class="ident" id="3260654">t</span><span class="op" id="3260655">.</span><span class="ident" id="3260656">rightDelim</span><span class="op" id="3260666">,</span>&nbsp;<span class="ident" id="3260668">t</span><span class="op" id="3260669">.</span><span class="ident" id="3260670">parseFuncs</span><span class="op" id="3260680">,</span>&nbsp;<span class="ident" id="3260682">builtins</span><span class="op" id="3260690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3260693">if</span>&nbsp;<span class="ident" id="3260696">err</span>&nbsp;<span class="op" id="3260700">!=</span>&nbsp;<span class="ident" id="3260703">nil</span>&nbsp;<span class="op" id="3260707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3260711">return</span>&nbsp;<span class="ident" id="3260718">nil</span><span class="op" id="3260721">,</span>&nbsp;<span class="ident" id="3260723">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3260728">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3260731">//&nbsp;Add&nbsp;the&nbsp;newly&nbsp;parsed&nbsp;trees,&nbsp;including&nbsp;the&nbsp;one&nbsp;for&nbsp;t,&nbsp;into&nbsp;our&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3260815">for</span>&nbsp;<span class="ident" id="3260819">name</span><span class="op" id="3260823">,</span>&nbsp;<span class="ident" id="3260825">tree</span>&nbsp;<span class="op" id="3260830">:=</span>&nbsp;<span class="keyword" id="3260833">range</span>&nbsp;<span class="ident" id="3260839">trees</span>&nbsp;<span class="op" id="3260845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3260849">//&nbsp;If&nbsp;the&nbsp;name&nbsp;we&nbsp;parsed&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;this&nbsp;template,&nbsp;overwrite&nbsp;this&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3260931">//&nbsp;The&nbsp;associate&nbsp;method&nbsp;checks&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;redefinition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3260989">tmpl</span>&nbsp;<span class="op" id="3260994">:=</span>&nbsp;<span class="ident" id="3260997">t</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261001">if</span>&nbsp;<span class="ident" id="3261004">name</span>&nbsp;<span class="op" id="3261009">!=</span>&nbsp;<span class="ident" id="3261012">t</span><span class="op" id="3261013">.</span><span class="ident" id="3261014">name</span>&nbsp;<span class="op" id="3261019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3261024">tmpl</span>&nbsp;<span class="op" id="3261029">=</span>&nbsp;<span class="ident" id="3261031">t</span><span class="op" id="3261032">.</span><span class="ident" id="3261033">New</span><span class="op" id="3261036">(</span><span class="ident" id="3261037">name</span><span class="op" id="3261041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3261045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3261049">//&nbsp;Even&nbsp;if&nbsp;t&nbsp;==&nbsp;tmpl,&nbsp;we&nbsp;need&nbsp;to&nbsp;install&nbsp;it&nbsp;in&nbsp;the&nbsp;common.tmpl&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261119">if</span>&nbsp;<span class="ident" id="3261122">replace</span><span class="op" id="3261129">,</span>&nbsp;<span class="ident" id="3261131">err</span>&nbsp;<span class="op" id="3261135">:=</span>&nbsp;<span class="ident" id="3261138">t</span><span class="op" id="3261139">.</span><span class="ident" id="3261140">associate</span><span class="op" id="3261149">(</span><span class="ident" id="3261150">tmpl</span><span class="op" id="3261154">,</span>&nbsp;<span class="ident" id="3261156">tree</span><span class="op" id="3261160">)</span><span class="op" id="3261161">;</span>&nbsp;<span class="ident" id="3261163">err</span>&nbsp;<span class="op" id="3261167">!=</span>&nbsp;<span class="ident" id="3261170">nil</span>&nbsp;<span class="op" id="3261174">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261179">return</span>&nbsp;<span class="ident" id="3261186">nil</span><span class="op" id="3261189">,</span>&nbsp;<span class="ident" id="3261191">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3261197">}</span>&nbsp;<span class="keyword" id="3261199">else</span>&nbsp;<span class="keyword" id="3261204">if</span>&nbsp;<span class="ident" id="3261207">replace</span>&nbsp;<span class="op" id="3261215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3261220">tmpl</span><span class="op" id="3261224">.</span><span class="ident" id="3261225">Tree</span>&nbsp;<span class="op" id="3261230">=</span>&nbsp;<span class="ident" id="3261232">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3261239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3261243">tmpl</span><span class="op" id="3261247">.</span><span class="ident" id="3261248">leftDelim</span>&nbsp;<span class="op" id="3261258">=</span>&nbsp;<span class="ident" id="3261260">t</span><span class="op" id="3261261">.</span><span class="ident" id="3261262">leftDelim</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3261274">tmpl</span><span class="op" id="3261278">.</span><span class="ident" id="3261279">rightDelim</span>&nbsp;<span class="op" id="3261290">=</span>&nbsp;<span class="ident" id="3261292">t</span><span class="op" id="3261293">.</span><span class="ident" id="3261294">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3261306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261309">return</span>&nbsp;<span class="ident" id="3261316">t</span><span class="op" id="3261317">,</span>&nbsp;<span class="ident" id="3261319">nil</span><br>
<span class="lineno"></span><span class="op" id="3261323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="3261326">//&nbsp;associate&nbsp;installs&nbsp;the&nbsp;new&nbsp;template&nbsp;into&nbsp;the&nbsp;group&nbsp;of&nbsp;templates&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="3261404">//&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;reuse&nbsp;a&nbsp;name&nbsp;except&nbsp;to&nbsp;overwrite&nbsp;an&nbsp;empty</span><br>
<span class="lineno"></span><span class="comment" id="3261475">//&nbsp;template.&nbsp;The&nbsp;two&nbsp;are&nbsp;already&nbsp;known&nbsp;to&nbsp;share&nbsp;the&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="3261545">//&nbsp;The&nbsp;boolean&nbsp;return&nbsp;value&nbsp;reports&nbsp;wither&nbsp;to&nbsp;store&nbsp;this&nbsp;tree&nbsp;as&nbsp;t.Tree.</span><br>
<span class="lineno"></span><span class="keyword" id="3261618">func</span>&nbsp;<span class="op" id="3261623">(</span><span class="ident" id="3261624">t</span>&nbsp;<span class="op" id="3261626">*</span><span class="ident" id="3261627">Template</span><span class="op" id="3261635">)</span>&nbsp;<span class="ident" id="3261637">associate</span><span class="op" id="3261646">(</span><span class="builtinfunc" id="3261647">new</span>&nbsp;<span class="op" id="3261651">*</span><span class="ident" id="3261652">Template</span><span class="op" id="3261660">,</span>&nbsp;<span class="ident" id="3261662">tree</span>&nbsp;<span class="op" id="3261667">*</span><span class="ident" id="3261668">parse</span><span class="op" id="3261673">.</span><span class="ident" id="3261674">Tree</span><span class="op" id="3261678">)</span>&nbsp;<span class="op" id="3261680">(</span><span class="builtintype" id="3261681">bool</span><span class="op" id="3261685">,</span>&nbsp;<span class="builtintype" id="3261687">error</span><span class="op" id="3261692">)</span>&nbsp;<span class="op" id="3261694">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261697">if</span>&nbsp;<span class="builtinfunc" id="3261700">new</span><span class="op" id="3261703">.</span><span class="ident" id="3261704">common</span>&nbsp;<span class="op" id="3261711">!=</span>&nbsp;<span class="ident" id="3261714">t</span><span class="op" id="3261715">.</span><span class="ident" id="3261716">common</span>&nbsp;<span class="op" id="3261723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3261727">panic</span><span class="op" id="3261732">(</span><span class="string" id="3261733">&#34;internal&nbsp;error:&nbsp;associate&nbsp;not&nbsp;common&#34;</span><span class="op" id="3261771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3261774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3261777">name</span>&nbsp;<span class="op" id="3261782">:=</span>&nbsp;<span class="builtinfunc" id="3261785">new</span><span class="op" id="3261788">.</span><span class="ident" id="3261789">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261795">if</span>&nbsp;<span class="ident" id="3261798">old</span>&nbsp;<span class="op" id="3261802">:=</span>&nbsp;<span class="ident" id="3261805">t</span><span class="op" id="3261806">.</span><span class="ident" id="3261807">tmpl</span><span class="op" id="3261811">[</span><span class="ident" id="3261812">name</span><span class="op" id="3261816">]</span><span class="op" id="3261817">;</span>&nbsp;<span class="ident" id="3261819">old</span>&nbsp;<span class="op" id="3261823">!=</span>&nbsp;<span class="ident" id="3261826">nil</span>&nbsp;<span class="op" id="3261830">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3261834">oldIsEmpty</span>&nbsp;<span class="op" id="3261845">:=</span>&nbsp;<span class="ident" id="3261848">parse</span><span class="op" id="3261853">.</span><span class="ident" id="3261854">IsEmptyTree</span><span class="op" id="3261865">(</span><span class="ident" id="3261866">old</span><span class="op" id="3261869">.</span><span class="ident" id="3261870">Root</span><span class="op" id="3261874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3261878">newIsEmpty</span>&nbsp;<span class="op" id="3261889">:=</span>&nbsp;<span class="ident" id="3261892">parse</span><span class="op" id="3261897">.</span><span class="ident" id="3261898">IsEmptyTree</span><span class="op" id="3261909">(</span><span class="ident" id="3261910">tree</span><span class="op" id="3261914">.</span><span class="ident" id="3261915">Root</span><span class="op" id="3261919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3261923">if</span>&nbsp;<span class="ident" id="3261926">newIsEmpty</span>&nbsp;<span class="op" id="3261937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3261942">//&nbsp;Whether&nbsp;old&nbsp;is&nbsp;empty&nbsp;or&nbsp;not,&nbsp;new&nbsp;is&nbsp;empty;&nbsp;no&nbsp;reason&nbsp;to&nbsp;replace&nbsp;old.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3262017">return</span>&nbsp;<span class="builtintype" id="3262024">false</span><span class="op" id="3262029">,</span>&nbsp;<span class="ident" id="3262031">nil</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3262037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3262041">if</span>&nbsp;<span class="op" id="3262044">!</span><span class="ident" id="3262045">oldIsEmpty</span>&nbsp;<span class="op" id="3262056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3262061">return</span>&nbsp;<span class="builtintype" id="3262068">false</span><span class="op" id="3262073">,</span>&nbsp;<span class="ident" id="3262075">fmt</span><span class="op" id="3262078">.</span><span class="ident" id="3262079">Errorf</span><span class="op" id="3262085">(</span><span class="string" id="3262086">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="3262125">,</span>&nbsp;<span class="ident" id="3262127">name</span><span class="op" id="3262131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3262135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3262138">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3262141">t</span><span class="op" id="3262142">.</span><span class="ident" id="3262143">tmpl</span><span class="op" id="3262147">[</span><span class="ident" id="3262148">name</span><span class="op" id="3262152">]</span>&nbsp;<span class="op" id="3262154">=</span>&nbsp;<span class="builtinfunc" id="3262156">new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3262161">return</span>&nbsp;<span class="builtintype" id="3262168">true</span><span class="op" id="3262172">,</span>&nbsp;<span class="ident" id="3262174">nil</span><br>
<span class="lineno"></span><span class="op" id="3262178">}</span>
</div>
</body>
</html>
