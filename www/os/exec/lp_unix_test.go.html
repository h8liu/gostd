<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7134247">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7134303">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7134357">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7134408">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7134473">package</span>&nbsp;<span class="ident" id="7134481">exec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7134487">import</span>&nbsp;<span class="op" id="7134494">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7134497">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7134510">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7134516">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7134526">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7134529">func</span>&nbsp;<span class="ident" id="7134534">TestLookPathUnixEmptyPath</span><span class="op" id="7134559">(</span><span class="ident" id="7134560">t</span>&nbsp;<span class="op" id="7134562">*</span><span class="ident" id="7134563">testing</span><span class="op" id="7134570">.</span><span class="ident" id="7134571">T</span><span class="op" id="7134572">)</span>&nbsp;<span class="op" id="7134574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134577">tmp</span><span class="op" id="7134580">,</span>&nbsp;<span class="ident" id="7134582">err</span>&nbsp;<span class="op" id="7134586">:=</span>&nbsp;<span class="ident" id="7134589">ioutil</span><span class="op" id="7134595">.</span><span class="ident" id="7134596">TempDir</span><span class="op" id="7134603">(</span><span class="string" id="7134604">&#34;&#34;</span><span class="op" id="7134606">,</span>&nbsp;<span class="string" id="7134608">&#34;TestLookPathUnixEmptyPath&#34;</span><span class="op" id="7134635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7134638">if</span>&nbsp;<span class="ident" id="7134641">err</span>&nbsp;<span class="op" id="7134645">!=</span>&nbsp;<span class="ident" id="7134648">nil</span>&nbsp;<span class="op" id="7134652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134656">t</span><span class="op" id="7134657">.</span><span class="ident" id="7134658">Fatal</span><span class="op" id="7134663">(</span><span class="string" id="7134664">&#34;TempDir&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7134682">,</span>&nbsp;<span class="ident" id="7134684">err</span><span class="op" id="7134687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7134690">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7134693">defer</span>&nbsp;<span class="ident" id="7134699">os</span><span class="op" id="7134701">.</span><span class="ident" id="7134702">RemoveAll</span><span class="op" id="7134711">(</span><span class="ident" id="7134712">tmp</span><span class="op" id="7134715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134718">wd</span><span class="op" id="7134720">,</span>&nbsp;<span class="ident" id="7134722">err</span>&nbsp;<span class="op" id="7134726">:=</span>&nbsp;<span class="ident" id="7134729">os</span><span class="op" id="7134731">.</span><span class="ident" id="7134732">Getwd</span><span class="op" id="7134737">(</span><span class="op" id="7134738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7134741">if</span>&nbsp;<span class="ident" id="7134744">err</span>&nbsp;<span class="op" id="7134748">!=</span>&nbsp;<span class="ident" id="7134751">nil</span>&nbsp;<span class="op" id="7134755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134759">t</span><span class="op" id="7134760">.</span><span class="ident" id="7134761">Fatal</span><span class="op" id="7134766">(</span><span class="string" id="7134767">&#34;Getwd&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7134783">,</span>&nbsp;<span class="ident" id="7134785">err</span><span class="op" id="7134788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7134791">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134794">err</span>&nbsp;<span class="op" id="7134798">=</span>&nbsp;<span class="ident" id="7134800">os</span><span class="op" id="7134802">.</span><span class="ident" id="7134803">Chdir</span><span class="op" id="7134808">(</span><span class="ident" id="7134809">tmp</span><span class="op" id="7134812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7134815">if</span>&nbsp;<span class="ident" id="7134818">err</span>&nbsp;<span class="op" id="7134822">!=</span>&nbsp;<span class="ident" id="7134825">nil</span>&nbsp;<span class="op" id="7134829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134833">t</span><span class="op" id="7134834">.</span><span class="ident" id="7134835">Fatal</span><span class="op" id="7134840">(</span><span class="string" id="7134841">&#34;Chdir&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7134857">,</span>&nbsp;<span class="ident" id="7134859">err</span><span class="op" id="7134862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7134865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7134868">defer</span>&nbsp;<span class="ident" id="7134874">os</span><span class="op" id="7134876">.</span><span class="ident" id="7134877">Chdir</span><span class="op" id="7134882">(</span><span class="ident" id="7134883">wd</span><span class="op" id="7134885">)</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134889">f</span><span class="op" id="7134890">,</span>&nbsp;<span class="ident" id="7134892">err</span>&nbsp;<span class="op" id="7134896">:=</span>&nbsp;<span class="ident" id="7134899">os</span><span class="op" id="7134901">.</span><span class="ident" id="7134902">OpenFile</span><span class="op" id="7134910">(</span><span class="string" id="7134911">&#34;exec_me&#34;</span><span class="op" id="7134920">,</span>&nbsp;<span class="ident" id="7134922">os</span><span class="op" id="7134924">.</span><span class="ident" id="7134925">O_CREATE</span><span class="op" id="7134933">|</span><span class="ident" id="7134934">os</span><span class="op" id="7134936">.</span><span class="ident" id="7134937">O_EXCL</span><span class="op" id="7134943">,</span>&nbsp;<span class="num" id="7134945">0700</span><span class="op" id="7134949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7134952">if</span>&nbsp;<span class="ident" id="7134955">err</span>&nbsp;<span class="op" id="7134959">!=</span>&nbsp;<span class="ident" id="7134962">nil</span>&nbsp;<span class="op" id="7134966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134970">t</span><span class="op" id="7134971">.</span><span class="ident" id="7134972">Fatal</span><span class="op" id="7134977">(</span><span class="string" id="7134978">&#34;OpenFile&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7134997">,</span>&nbsp;<span class="ident" id="7134999">err</span><span class="op" id="7135002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135005">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135008">err</span>&nbsp;<span class="op" id="7135012">=</span>&nbsp;<span class="ident" id="7135014">f</span><span class="op" id="7135015">.</span><span class="ident" id="7135016">Close</span><span class="op" id="7135021">(</span><span class="op" id="7135022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7135025">if</span>&nbsp;<span class="ident" id="7135028">err</span>&nbsp;<span class="op" id="7135032">!=</span>&nbsp;<span class="ident" id="7135035">nil</span>&nbsp;<span class="op" id="7135039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135043">t</span><span class="op" id="7135044">.</span><span class="ident" id="7135045">Fatal</span><span class="op" id="7135050">(</span><span class="string" id="7135051">&#34;Close&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7135067">,</span>&nbsp;<span class="ident" id="7135069">err</span><span class="op" id="7135072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135079">pathenv</span>&nbsp;<span class="op" id="7135087">:=</span>&nbsp;<span class="ident" id="7135090">os</span><span class="op" id="7135092">.</span><span class="ident" id="7135093">Getenv</span><span class="op" id="7135099">(</span><span class="string" id="7135100">&#34;PATH&#34;</span><span class="op" id="7135106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7135109">defer</span>&nbsp;<span class="ident" id="7135115">os</span><span class="op" id="7135117">.</span><span class="ident" id="7135118">Setenv</span><span class="op" id="7135124">(</span><span class="string" id="7135125">&#34;PATH&#34;</span><span class="op" id="7135131">,</span>&nbsp;<span class="ident" id="7135133">pathenv</span><span class="op" id="7135140">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135144">err</span>&nbsp;<span class="op" id="7135148">=</span>&nbsp;<span class="ident" id="7135150">os</span><span class="op" id="7135152">.</span><span class="ident" id="7135153">Setenv</span><span class="op" id="7135159">(</span><span class="string" id="7135160">&#34;PATH&#34;</span><span class="op" id="7135166">,</span>&nbsp;<span class="string" id="7135168">&#34;&#34;</span><span class="op" id="7135170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7135173">if</span>&nbsp;<span class="ident" id="7135176">err</span>&nbsp;<span class="op" id="7135180">!=</span>&nbsp;<span class="ident" id="7135183">nil</span>&nbsp;<span class="op" id="7135187">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135191">t</span><span class="op" id="7135192">.</span><span class="ident" id="7135193">Fatal</span><span class="op" id="7135198">(</span><span class="string" id="7135199">&#34;Setenv&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7135216">,</span>&nbsp;<span class="ident" id="7135218">err</span><span class="op" id="7135221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135228">path</span><span class="op" id="7135232">,</span>&nbsp;<span class="ident" id="7135234">err</span>&nbsp;<span class="op" id="7135238">:=</span>&nbsp;<span class="ident" id="7135241">LookPath</span><span class="op" id="7135249">(</span><span class="string" id="7135250">&#34;exec_me&#34;</span><span class="op" id="7135259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7135262">if</span>&nbsp;<span class="ident" id="7135265">err</span>&nbsp;<span class="op" id="7135269">==</span>&nbsp;<span class="ident" id="7135272">nil</span>&nbsp;<span class="op" id="7135276">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135280">t</span><span class="op" id="7135281">.</span><span class="ident" id="7135282">Fatal</span><span class="op" id="7135287">(</span><span class="string" id="7135288">&#34;LookPath&nbsp;found&nbsp;exec_me&nbsp;in&nbsp;empty&nbsp;$PATH&#34;</span><span class="op" id="7135327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7135333">if</span>&nbsp;<span class="ident" id="7135336">path</span>&nbsp;<span class="op" id="7135341">!=</span>&nbsp;<span class="string" id="7135344">&#34;&#34;</span>&nbsp;<span class="op" id="7135347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135351">t</span><span class="op" id="7135352">.</span><span class="ident" id="7135353">Fatalf</span><span class="op" id="7135359">(</span><span class="string" id="7135360">&#34;LookPath&nbsp;path&nbsp;==&nbsp;%q&nbsp;when&nbsp;err&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="7135397">,</span>&nbsp;<span class="ident" id="7135399">path</span><span class="op" id="7135403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135406">}</span><br>
<span class="lineno">55</span><span class="op" id="7135408">}</span>
</div>
</body>
</html>
