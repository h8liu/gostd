<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1734984">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1735039">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1735093">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1735144">//&nbsp;Package&nbsp;jpeg&nbsp;implements&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="1735205">//</span><br>
<span class="lineno"></span><span class="comment" id="1735208">//&nbsp;JPEG&nbsp;is&nbsp;defined&nbsp;in&nbsp;ITU-T&nbsp;T.81:&nbsp;http://www.w3.org/Graphics/JPEG/itu-t81.pdf.</span><br>
<span class="lineno"></span><span class="keyword" id="1735287">package</span>&nbsp;<span class="ident" id="1735295">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="1735301">import</span>&nbsp;<span class="op" id="1735308">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1735311">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1735320">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1735335">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="1735340">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="1735343">//&nbsp;TODO(nigeltao):&nbsp;fix&nbsp;up&nbsp;the&nbsp;doc&nbsp;comment&nbsp;style&nbsp;so&nbsp;that&nbsp;sentences&nbsp;start&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="1735420">//&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;or&nbsp;function&nbsp;that&nbsp;they&nbsp;annotate.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1735477">//&nbsp;A&nbsp;FormatError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;JPEG.</span><br>
<span class="lineno">20</span><span class="keyword" id="1735538">type</span>&nbsp;<span class="ident" id="1735543">FormatError</span>&nbsp;<span class="builtintype" id="1735555">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1735563">func</span>&nbsp;<span class="op" id="1735568">(</span><span class="ident" id="1735569">e</span>&nbsp;<span class="ident" id="1735571">FormatError</span><span class="op" id="1735582">)</span>&nbsp;<span class="ident" id="1735584">Error</span><span class="op" id="1735589">(</span><span class="op" id="1735590">)</span>&nbsp;<span class="builtintype" id="1735592">string</span>&nbsp;<span class="op" id="1735599">{</span>&nbsp;<span class="keyword" id="1735601">return</span>&nbsp;<span class="string" id="1735608">&#34;invalid&nbsp;JPEG&nbsp;format:&nbsp;&#34;</span>&nbsp;<span class="op" id="1735632">+</span>&nbsp;<span class="builtintype" id="1735634">string</span><span class="op" id="1735640">(</span><span class="ident" id="1735641">e</span><span class="op" id="1735642">)</span>&nbsp;<span class="op" id="1735644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1735647">//&nbsp;An&nbsp;UnsupportedError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;uses&nbsp;a&nbsp;valid&nbsp;but&nbsp;unimplemented&nbsp;JPEG&nbsp;feature.</span><br>
<span class="lineno">25</span><span class="keyword" id="1735738">type</span>&nbsp;<span class="ident" id="1735743">UnsupportedError</span>&nbsp;<span class="builtintype" id="1735760">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1735768">func</span>&nbsp;<span class="op" id="1735773">(</span><span class="ident" id="1735774">e</span>&nbsp;<span class="ident" id="1735776">UnsupportedError</span><span class="op" id="1735792">)</span>&nbsp;<span class="ident" id="1735794">Error</span><span class="op" id="1735799">(</span><span class="op" id="1735800">)</span>&nbsp;<span class="builtintype" id="1735802">string</span>&nbsp;<span class="op" id="1735809">{</span>&nbsp;<span class="keyword" id="1735811">return</span>&nbsp;<span class="string" id="1735818">&#34;unsupported&nbsp;JPEG&nbsp;feature:&nbsp;&#34;</span>&nbsp;<span class="op" id="1735847">+</span>&nbsp;<span class="builtintype" id="1735849">string</span><span class="op" id="1735855">(</span><span class="ident" id="1735856">e</span><span class="op" id="1735857">)</span>&nbsp;<span class="op" id="1735859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1735862">//&nbsp;Component&nbsp;specification,&nbsp;specified&nbsp;in&nbsp;section&nbsp;B.2.2.</span><br>
<span class="lineno">30</span><span class="keyword" id="1735918">type</span>&nbsp;<span class="ident" id="1735923">component</span>&nbsp;<span class="keyword" id="1735933">struct</span>&nbsp;<span class="op" id="1735940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1735943">h</span>&nbsp;&nbsp;<span class="builtintype" id="1735946">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1735952">//&nbsp;Horizontal&nbsp;sampling&nbsp;factor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1735984">v</span>&nbsp;&nbsp;<span class="builtintype" id="1735987">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1735993">//&nbsp;Vertical&nbsp;sampling&nbsp;factor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736023">c</span>&nbsp;&nbsp;<span class="builtintype" id="1736026">uint8</span>&nbsp;<span class="comment" id="1736032">//&nbsp;Component&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736058">tq</span>&nbsp;<span class="builtintype" id="1736061">uint8</span>&nbsp;<span class="comment" id="1736067">//&nbsp;Quantization&nbsp;table&nbsp;destination&nbsp;selector.</span><br>
<span class="lineno">35</span><span class="op" id="1736111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1736114">const</span>&nbsp;<span class="op" id="1736120">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736123">dcTable</span>&nbsp;<span class="op" id="1736131">=</span>&nbsp;<span class="num" id="1736133">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736136">acTable</span>&nbsp;<span class="op" id="1736144">=</span>&nbsp;<span class="num" id="1736146">1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736149">maxTc</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1736157">=</span>&nbsp;<span class="num" id="1736159">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736162">maxTh</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1736170">=</span>&nbsp;<span class="num" id="1736172">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736175">maxTq</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1736183">=</span>&nbsp;<span class="num" id="1736185">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1736189">//&nbsp;A&nbsp;grayscale&nbsp;JPEG&nbsp;image&nbsp;has&nbsp;only&nbsp;a&nbsp;Y&nbsp;component.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736240">nGrayComponent</span>&nbsp;<span class="op" id="1736255">=</span>&nbsp;<span class="num" id="1736257">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1736260">//&nbsp;A&nbsp;color&nbsp;JPEG&nbsp;image&nbsp;has&nbsp;Y,&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736312">nColorComponent</span>&nbsp;<span class="op" id="1736328">=</span>&nbsp;<span class="num" id="1736330">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1736334">//&nbsp;We&nbsp;only&nbsp;support&nbsp;4:4:4,&nbsp;4:4:0,&nbsp;4:2:2&nbsp;and&nbsp;4:2:0&nbsp;downsampling,&nbsp;and&nbsp;therefore&nbsp;the</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1736416">//&nbsp;number&nbsp;of&nbsp;luma&nbsp;samples&nbsp;per&nbsp;chroma&nbsp;sample&nbsp;is&nbsp;at&nbsp;most&nbsp;2&nbsp;in&nbsp;the&nbsp;horizontal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1736492">//&nbsp;and&nbsp;2&nbsp;in&nbsp;the&nbsp;vertical&nbsp;direction.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736529">maxH</span>&nbsp;<span class="op" id="1736534">=</span>&nbsp;<span class="num" id="1736536">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736539">maxV</span>&nbsp;<span class="op" id="1736544">=</span>&nbsp;<span class="num" id="1736546">2</span><br>
<span class="lineno"></span><span class="op" id="1736548">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="1736551">const</span>&nbsp;<span class="op" id="1736557">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736560">soiMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1736572">=</span>&nbsp;<span class="num" id="1736574">0xd8</span>&nbsp;<span class="comment" id="1736579">//&nbsp;Start&nbsp;Of&nbsp;Image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736599">eoiMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1736611">=</span>&nbsp;<span class="num" id="1736613">0xd9</span>&nbsp;<span class="comment" id="1736618">//&nbsp;End&nbsp;Of&nbsp;Image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736636">sof0Marker</span>&nbsp;&nbsp;<span class="op" id="1736648">=</span>&nbsp;<span class="num" id="1736650">0xc0</span>&nbsp;<span class="comment" id="1736655">//&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline).</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736686">sof2Marker</span>&nbsp;&nbsp;<span class="op" id="1736698">=</span>&nbsp;<span class="num" id="1736700">0xc2</span>&nbsp;<span class="comment" id="1736705">//&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Progressive).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736739">dhtMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1736751">=</span>&nbsp;<span class="num" id="1736753">0xc4</span>&nbsp;<span class="comment" id="1736758">//&nbsp;Define&nbsp;Huffman&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736784">dqtMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1736796">=</span>&nbsp;<span class="num" id="1736798">0xdb</span>&nbsp;<span class="comment" id="1736803">//&nbsp;Define&nbsp;Quantization&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736834">sosMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1736846">=</span>&nbsp;<span class="num" id="1736848">0xda</span>&nbsp;<span class="comment" id="1736853">//&nbsp;Start&nbsp;Of&nbsp;Scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736872">driMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1736884">=</span>&nbsp;<span class="num" id="1736886">0xdd</span>&nbsp;<span class="comment" id="1736891">//&nbsp;Define&nbsp;Restart&nbsp;Interval.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736920">rst0Marker</span>&nbsp;&nbsp;<span class="op" id="1736932">=</span>&nbsp;<span class="num" id="1736934">0xd0</span>&nbsp;<span class="comment" id="1736939">//&nbsp;ReSTart&nbsp;(0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736956">rst7Marker</span>&nbsp;&nbsp;<span class="op" id="1736968">=</span>&nbsp;<span class="num" id="1736970">0xd7</span>&nbsp;<span class="comment" id="1736975">//&nbsp;ReSTart&nbsp;(7).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736992">app0Marker</span>&nbsp;&nbsp;<span class="op" id="1737004">=</span>&nbsp;<span class="num" id="1737006">0xe0</span>&nbsp;<span class="comment" id="1737011">//&nbsp;APPlication&nbsp;specific&nbsp;(0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1737041">app15Marker</span>&nbsp;<span class="op" id="1737053">=</span>&nbsp;<span class="num" id="1737055">0xef</span>&nbsp;<span class="comment" id="1737060">//&nbsp;APPlication&nbsp;specific&nbsp;(15).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1737091">comMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1737103">=</span>&nbsp;<span class="num" id="1737105">0xfe</span>&nbsp;<span class="comment" id="1737110">//&nbsp;COMment.</span><br>
<span class="lineno">70</span><span class="op" id="1737122">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1737125">//&nbsp;unzig&nbsp;maps&nbsp;from&nbsp;the&nbsp;zig-zag&nbsp;ordering&nbsp;to&nbsp;the&nbsp;natural&nbsp;ordering.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span><span class="comment" id="1737203">//&nbsp;unzig[3]&nbsp;is&nbsp;the&nbsp;column&nbsp;and&nbsp;row&nbsp;of&nbsp;the&nbsp;fourth&nbsp;element&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="1737281">//&nbsp;value&nbsp;is&nbsp;16,&nbsp;which&nbsp;means&nbsp;first&nbsp;column&nbsp;(16%8&nbsp;==&nbsp;0)&nbsp;and&nbsp;third&nbsp;row&nbsp;(16/8&nbsp;==&nbsp;2).</span><br>
<span class="lineno">75</span><span class="keyword" id="1737361">var</span>&nbsp;<span class="ident" id="1737365">unzig</span>&nbsp;<span class="op" id="1737371">=</span>&nbsp;<span class="op" id="1737373">[</span><span class="ident" id="1737374">blockSize</span><span class="op" id="1737383">]</span><span class="builtintype" id="1737384">int</span><span class="op" id="1737387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1737390">0</span><span class="op" id="1737391">,</span>&nbsp;<span class="num" id="1737393">1</span><span class="op" id="1737394">,</span>&nbsp;<span class="num" id="1737396">8</span><span class="op" id="1737397">,</span>&nbsp;<span class="num" id="1737399">16</span><span class="op" id="1737401">,</span>&nbsp;<span class="num" id="1737403">9</span><span class="op" id="1737404">,</span>&nbsp;<span class="num" id="1737406">2</span><span class="op" id="1737407">,</span>&nbsp;<span class="num" id="1737409">3</span><span class="op" id="1737410">,</span>&nbsp;<span class="num" id="1737412">10</span><span class="op" id="1737414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1737417">17</span><span class="op" id="1737419">,</span>&nbsp;<span class="num" id="1737421">24</span><span class="op" id="1737423">,</span>&nbsp;<span class="num" id="1737425">32</span><span class="op" id="1737427">,</span>&nbsp;<span class="num" id="1737429">25</span><span class="op" id="1737431">,</span>&nbsp;<span class="num" id="1737433">18</span><span class="op" id="1737435">,</span>&nbsp;<span class="num" id="1737437">11</span><span class="op" id="1737439">,</span>&nbsp;<span class="num" id="1737441">4</span><span class="op" id="1737442">,</span>&nbsp;<span class="num" id="1737444">5</span><span class="op" id="1737445">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1737448">12</span><span class="op" id="1737450">,</span>&nbsp;<span class="num" id="1737452">19</span><span class="op" id="1737454">,</span>&nbsp;<span class="num" id="1737456">26</span><span class="op" id="1737458">,</span>&nbsp;<span class="num" id="1737460">33</span><span class="op" id="1737462">,</span>&nbsp;<span class="num" id="1737464">40</span><span class="op" id="1737466">,</span>&nbsp;<span class="num" id="1737468">48</span><span class="op" id="1737470">,</span>&nbsp;<span class="num" id="1737472">41</span><span class="op" id="1737474">,</span>&nbsp;<span class="num" id="1737476">34</span><span class="op" id="1737478">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1737481">27</span><span class="op" id="1737483">,</span>&nbsp;<span class="num" id="1737485">20</span><span class="op" id="1737487">,</span>&nbsp;<span class="num" id="1737489">13</span><span class="op" id="1737491">,</span>&nbsp;<span class="num" id="1737493">6</span><span class="op" id="1737494">,</span>&nbsp;<span class="num" id="1737496">7</span><span class="op" id="1737497">,</span>&nbsp;<span class="num" id="1737499">14</span><span class="op" id="1737501">,</span>&nbsp;<span class="num" id="1737503">21</span><span class="op" id="1737505">,</span>&nbsp;<span class="num" id="1737507">28</span><span class="op" id="1737509">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1737512">35</span><span class="op" id="1737514">,</span>&nbsp;<span class="num" id="1737516">42</span><span class="op" id="1737518">,</span>&nbsp;<span class="num" id="1737520">49</span><span class="op" id="1737522">,</span>&nbsp;<span class="num" id="1737524">56</span><span class="op" id="1737526">,</span>&nbsp;<span class="num" id="1737528">57</span><span class="op" id="1737530">,</span>&nbsp;<span class="num" id="1737532">50</span><span class="op" id="1737534">,</span>&nbsp;<span class="num" id="1737536">43</span><span class="op" id="1737538">,</span>&nbsp;<span class="num" id="1737540">36</span><span class="op" id="1737542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1737545">29</span><span class="op" id="1737547">,</span>&nbsp;<span class="num" id="1737549">22</span><span class="op" id="1737551">,</span>&nbsp;<span class="num" id="1737553">15</span><span class="op" id="1737555">,</span>&nbsp;<span class="num" id="1737557">23</span><span class="op" id="1737559">,</span>&nbsp;<span class="num" id="1737561">30</span><span class="op" id="1737563">,</span>&nbsp;<span class="num" id="1737565">37</span><span class="op" id="1737567">,</span>&nbsp;<span class="num" id="1737569">44</span><span class="op" id="1737571">,</span>&nbsp;<span class="num" id="1737573">51</span><span class="op" id="1737575">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1737578">58</span><span class="op" id="1737580">,</span>&nbsp;<span class="num" id="1737582">59</span><span class="op" id="1737584">,</span>&nbsp;<span class="num" id="1737586">52</span><span class="op" id="1737588">,</span>&nbsp;<span class="num" id="1737590">45</span><span class="op" id="1737592">,</span>&nbsp;<span class="num" id="1737594">38</span><span class="op" id="1737596">,</span>&nbsp;<span class="num" id="1737598">31</span><span class="op" id="1737600">,</span>&nbsp;<span class="num" id="1737602">39</span><span class="op" id="1737604">,</span>&nbsp;<span class="num" id="1737606">46</span><span class="op" id="1737608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1737611">53</span><span class="op" id="1737613">,</span>&nbsp;<span class="num" id="1737615">60</span><span class="op" id="1737617">,</span>&nbsp;<span class="num" id="1737619">61</span><span class="op" id="1737621">,</span>&nbsp;<span class="num" id="1737623">54</span><span class="op" id="1737625">,</span>&nbsp;<span class="num" id="1737627">47</span><span class="op" id="1737629">,</span>&nbsp;<span class="num" id="1737631">55</span><span class="op" id="1737633">,</span>&nbsp;<span class="num" id="1737635">62</span><span class="op" id="1737637">,</span>&nbsp;<span class="num" id="1737639">63</span><span class="op" id="1737641">,</span><br>
<span class="lineno"></span><span class="op" id="1737643">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="1737646">//&nbsp;Reader&nbsp;is&nbsp;deprecated.</span><br>
<span class="lineno"></span><span class="keyword" id="1737671">type</span>&nbsp;<span class="ident" id="1737676">Reader</span>&nbsp;<span class="keyword" id="1737683">interface</span>&nbsp;<span class="op" id="1737693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1737696">io</span><span class="op" id="1737698">.</span><span class="ident" id="1737699">ByteReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1737711">io</span><span class="op" id="1737713">.</span><span class="ident" id="1737714">Reader</span><br>
<span class="lineno">90</span><span class="op" id="1737721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1737724">//&nbsp;bits&nbsp;holds&nbsp;the&nbsp;unprocessed&nbsp;bits&nbsp;that&nbsp;have&nbsp;been&nbsp;taken&nbsp;from&nbsp;the&nbsp;byte-stream.</span><br>
<span class="lineno"></span><span class="comment" id="1737802">//&nbsp;The&nbsp;n&nbsp;least&nbsp;significant&nbsp;bits&nbsp;of&nbsp;a&nbsp;form&nbsp;the&nbsp;unread&nbsp;bits,&nbsp;to&nbsp;be&nbsp;read&nbsp;in&nbsp;MSB&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1737882">//&nbsp;LSB&nbsp;order.</span><br>
<span class="lineno">95</span><span class="keyword" id="1737896">type</span>&nbsp;<span class="ident" id="1737901">bits</span>&nbsp;<span class="keyword" id="1737906">struct</span>&nbsp;<span class="op" id="1737913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1737916">a</span>&nbsp;<span class="builtintype" id="1737918">uint32</span>&nbsp;<span class="comment" id="1737925">//&nbsp;accumulator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1737942">m</span>&nbsp;<span class="builtintype" id="1737944">uint32</span>&nbsp;<span class="comment" id="1737951">//&nbsp;mask.&nbsp;m==1&lt;&lt;(n-1)&nbsp;when&nbsp;n&gt;0,&nbsp;with&nbsp;m==0&nbsp;when&nbsp;n==0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738004">n</span>&nbsp;<span class="builtintype" id="1738006">int32</span>&nbsp;&nbsp;<span class="comment" id="1738013">//&nbsp;the&nbsp;number&nbsp;of&nbsp;unread&nbsp;bits&nbsp;in&nbsp;a.</span><br>
<span class="lineno"></span><span class="op" id="1738048">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="1738051">type</span>&nbsp;<span class="ident" id="1738056">decoder</span>&nbsp;<span class="keyword" id="1738064">struct</span>&nbsp;<span class="op" id="1738071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738074">r</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738079">io</span><span class="op" id="1738081">.</span><span class="ident" id="1738082">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738090">bits</span>&nbsp;<span class="ident" id="1738095">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1738101">//&nbsp;bytes&nbsp;is&nbsp;a&nbsp;byte&nbsp;buffer,&nbsp;similar&nbsp;to&nbsp;a&nbsp;bufio.Reader,&nbsp;except&nbsp;that&nbsp;it</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1738171">//&nbsp;has&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;unread&nbsp;more&nbsp;than&nbsp;1&nbsp;byte,&nbsp;due&nbsp;to&nbsp;byte&nbsp;stuffing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1738240">//&nbsp;Byte&nbsp;stuffing&nbsp;is&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.1.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738291">bytes</span>&nbsp;<span class="keyword" id="1738297">struct</span>&nbsp;<span class="op" id="1738304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1738308">//&nbsp;buf[i:j]&nbsp;are&nbsp;the&nbsp;buffered&nbsp;bytes&nbsp;read&nbsp;from&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1738370">//&nbsp;io.Reader&nbsp;that&nbsp;haven&#39;t&nbsp;yet&nbsp;been&nbsp;passed&nbsp;further&nbsp;on.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738426">buf</span>&nbsp;&nbsp;<span class="op" id="1738431">[</span><span class="num" id="1738432">4096</span><span class="op" id="1738436">]</span><span class="builtintype" id="1738437">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738444">i</span><span class="op" id="1738445">,</span>&nbsp;<span class="ident" id="1738447">j</span>&nbsp;<span class="builtintype" id="1738449">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1738455">//&nbsp;nUnreadable&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;back&nbsp;up&nbsp;i&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1738514">//&nbsp;overshooting.&nbsp;It&nbsp;can&nbsp;be&nbsp;0,&nbsp;1&nbsp;or&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738554">nUnreadable</span>&nbsp;<span class="builtintype" id="1738566">int</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1738571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738574">width</span><span class="op" id="1738579">,</span>&nbsp;<span class="ident" id="1738581">height</span>&nbsp;<span class="builtintype" id="1738588">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738593">img1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1738607">*</span><span class="ident" id="1738608">image</span><span class="op" id="1738613">.</span><span class="ident" id="1738614">Gray</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738620">img3</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1738634">*</span><span class="ident" id="1738635">image</span><span class="op" id="1738640">.</span><span class="ident" id="1738641">YCbCr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738648">ri</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1738662">int</span>&nbsp;<span class="comment" id="1738666">//&nbsp;Restart&nbsp;Interval.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738688">nComp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1738702">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738707">progressive</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1738721">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738727">eobRun</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1738741">uint16</span>&nbsp;<span class="comment" id="1738748">//&nbsp;End-of-Band&nbsp;run,&nbsp;specified&nbsp;in&nbsp;section&nbsp;G.1.2.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738799">comp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1738813">[</span><span class="ident" id="1738814">nColorComponent</span><span class="op" id="1738829">]</span><span class="ident" id="1738830">component</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738841">progCoeffs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1738855">[</span><span class="ident" id="1738856">nColorComponent</span><span class="op" id="1738871">]</span><span class="op" id="1738872">[</span><span class="op" id="1738873">]</span><span class="ident" id="1738874">block</span>&nbsp;<span class="comment" id="1738880">//&nbsp;Saved&nbsp;state&nbsp;between&nbsp;progressive-mode&nbsp;scans.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738928">huff</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1738942">[</span><span class="ident" id="1738943">maxTc</span>&nbsp;<span class="op" id="1738949">+</span>&nbsp;<span class="num" id="1738951">1</span><span class="op" id="1738952">]</span><span class="op" id="1738953">[</span><span class="ident" id="1738954">maxTh</span>&nbsp;<span class="op" id="1738960">+</span>&nbsp;<span class="num" id="1738962">1</span><span class="op" id="1738963">]</span><span class="ident" id="1738964">huffman</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738973">quant</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1738987">[</span><span class="ident" id="1738988">maxTq</span>&nbsp;<span class="op" id="1738994">+</span>&nbsp;<span class="num" id="1738996">1</span><span class="op" id="1738997">]</span><span class="ident" id="1738998">block</span>&nbsp;<span class="comment" id="1739004">//&nbsp;Quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739047">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1739061">[</span><span class="ident" id="1739062">blockSize</span>&nbsp;<span class="op" id="1739072">+</span>&nbsp;<span class="num" id="1739074">1</span><span class="op" id="1739075">]</span><span class="builtintype" id="1739076">byte</span><br>
<span class="lineno"></span><span class="op" id="1739081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="1739084">//&nbsp;fill&nbsp;fills&nbsp;up&nbsp;the&nbsp;d.bytes.buf&nbsp;buffer&nbsp;from&nbsp;the&nbsp;underlying&nbsp;io.Reader.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="1739158">//&nbsp;should&nbsp;only&nbsp;be&nbsp;called&nbsp;when&nbsp;there&nbsp;are&nbsp;no&nbsp;unread&nbsp;bytes&nbsp;in&nbsp;d.bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="1739226">func</span>&nbsp;<span class="op" id="1739231">(</span><span class="ident" id="1739232">d</span>&nbsp;<span class="op" id="1739234">*</span><span class="ident" id="1739235">decoder</span><span class="op" id="1739242">)</span>&nbsp;<span class="ident" id="1739244">fill</span><span class="op" id="1739248">(</span><span class="op" id="1739249">)</span>&nbsp;<span class="builtintype" id="1739251">error</span>&nbsp;<span class="op" id="1739257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1739260">if</span>&nbsp;<span class="ident" id="1739263">d</span><span class="op" id="1739264">.</span><span class="ident" id="1739265">bytes</span><span class="op" id="1739270">.</span><span class="ident" id="1739271">i</span>&nbsp;<span class="op" id="1739273">!=</span>&nbsp;<span class="ident" id="1739276">d</span><span class="op" id="1739277">.</span><span class="ident" id="1739278">bytes</span><span class="op" id="1739283">.</span><span class="ident" id="1739284">j</span>&nbsp;<span class="op" id="1739286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1739290">panic</span><span class="op" id="1739295">(</span><span class="string" id="1739296">&#34;jpeg:&nbsp;fill&nbsp;called&nbsp;when&nbsp;unread&nbsp;bytes&nbsp;exist&#34;</span><span class="op" id="1739339">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1739342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1739345">//&nbsp;Move&nbsp;the&nbsp;last&nbsp;2&nbsp;bytes&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;buffer,&nbsp;in&nbsp;case&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1739415">//&nbsp;to&nbsp;call&nbsp;unreadByteStuffedByte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1739450">if</span>&nbsp;<span class="ident" id="1739453">d</span><span class="op" id="1739454">.</span><span class="ident" id="1739455">bytes</span><span class="op" id="1739460">.</span><span class="ident" id="1739461">j</span>&nbsp;<span class="op" id="1739463">&gt;</span>&nbsp;<span class="num" id="1739465">2</span>&nbsp;<span class="op" id="1739467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739471">d</span><span class="op" id="1739472">.</span><span class="ident" id="1739473">bytes</span><span class="op" id="1739478">.</span><span class="ident" id="1739479">buf</span><span class="op" id="1739482">[</span><span class="num" id="1739483">0</span><span class="op" id="1739484">]</span>&nbsp;<span class="op" id="1739486">=</span>&nbsp;<span class="ident" id="1739488">d</span><span class="op" id="1739489">.</span><span class="ident" id="1739490">bytes</span><span class="op" id="1739495">.</span><span class="ident" id="1739496">buf</span><span class="op" id="1739499">[</span><span class="ident" id="1739500">d</span><span class="op" id="1739501">.</span><span class="ident" id="1739502">bytes</span><span class="op" id="1739507">.</span><span class="ident" id="1739508">j</span><span class="op" id="1739509">-</span><span class="num" id="1739510">2</span><span class="op" id="1739511">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739515">d</span><span class="op" id="1739516">.</span><span class="ident" id="1739517">bytes</span><span class="op" id="1739522">.</span><span class="ident" id="1739523">buf</span><span class="op" id="1739526">[</span><span class="num" id="1739527">1</span><span class="op" id="1739528">]</span>&nbsp;<span class="op" id="1739530">=</span>&nbsp;<span class="ident" id="1739532">d</span><span class="op" id="1739533">.</span><span class="ident" id="1739534">bytes</span><span class="op" id="1739539">.</span><span class="ident" id="1739540">buf</span><span class="op" id="1739543">[</span><span class="ident" id="1739544">d</span><span class="op" id="1739545">.</span><span class="ident" id="1739546">bytes</span><span class="op" id="1739551">.</span><span class="ident" id="1739552">j</span><span class="op" id="1739553">-</span><span class="num" id="1739554">1</span><span class="op" id="1739555">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739559">d</span><span class="op" id="1739560">.</span><span class="ident" id="1739561">bytes</span><span class="op" id="1739566">.</span><span class="ident" id="1739567">i</span><span class="op" id="1739568">,</span>&nbsp;<span class="ident" id="1739570">d</span><span class="op" id="1739571">.</span><span class="ident" id="1739572">bytes</span><span class="op" id="1739577">.</span><span class="ident" id="1739578">j</span>&nbsp;<span class="op" id="1739580">=</span>&nbsp;<span class="num" id="1739582">2</span><span class="op" id="1739583">,</span>&nbsp;<span class="num" id="1739585">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1739588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1739591">//&nbsp;Fill&nbsp;in&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739627">n</span><span class="op" id="1739628">,</span>&nbsp;<span class="ident" id="1739630">err</span>&nbsp;<span class="op" id="1739634">:=</span>&nbsp;<span class="ident" id="1739637">d</span><span class="op" id="1739638">.</span><span class="ident" id="1739639">r</span><span class="op" id="1739640">.</span><span class="ident" id="1739641">Read</span><span class="op" id="1739645">(</span><span class="ident" id="1739646">d</span><span class="op" id="1739647">.</span><span class="ident" id="1739648">bytes</span><span class="op" id="1739653">.</span><span class="ident" id="1739654">buf</span><span class="op" id="1739657">[</span><span class="ident" id="1739658">d</span><span class="op" id="1739659">.</span><span class="ident" id="1739660">bytes</span><span class="op" id="1739665">.</span><span class="ident" id="1739666">j</span><span class="op" id="1739667">:</span><span class="op" id="1739668">]</span><span class="op" id="1739669">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739672">d</span><span class="op" id="1739673">.</span><span class="ident" id="1739674">bytes</span><span class="op" id="1739679">.</span><span class="ident" id="1739680">j</span>&nbsp;<span class="op" id="1739682">+=</span>&nbsp;<span class="ident" id="1739685">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1739688">if</span>&nbsp;<span class="ident" id="1739691">n</span>&nbsp;<span class="op" id="1739693">&gt;</span>&nbsp;<span class="num" id="1739695">0</span>&nbsp;<span class="op" id="1739697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739701">err</span>&nbsp;<span class="op" id="1739705">=</span>&nbsp;<span class="builtintype" id="1739707">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1739712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1739715">return</span>&nbsp;<span class="ident" id="1739722">err</span><br>
<span class="lineno">150</span><span class="op" id="1739726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1739729">//&nbsp;unreadByteStuffedByte&nbsp;undoes&nbsp;the&nbsp;most&nbsp;recent&nbsp;readByteStuffedByte&nbsp;call,</span><br>
<span class="lineno"></span><span class="comment" id="1739803">//&nbsp;giving&nbsp;a&nbsp;byte&nbsp;of&nbsp;data&nbsp;back&nbsp;from&nbsp;d.bits&nbsp;to&nbsp;d.bytes.&nbsp;The&nbsp;Huffman&nbsp;look-up&nbsp;table</span><br>
<span class="lineno"></span><span class="comment" id="1739883">//&nbsp;requires&nbsp;at&nbsp;least&nbsp;8&nbsp;bits&nbsp;for&nbsp;look-up,&nbsp;which&nbsp;means&nbsp;that&nbsp;Huffman&nbsp;decoding&nbsp;can</span><br>
<span class="lineno">155</span><span class="comment" id="1739962">//&nbsp;sometimes&nbsp;overshoot&nbsp;and&nbsp;read&nbsp;one&nbsp;or&nbsp;two&nbsp;too&nbsp;many&nbsp;bytes.&nbsp;Two-byte&nbsp;overshoot</span><br>
<span class="lineno"></span><span class="comment" id="1740040">//&nbsp;can&nbsp;happen&nbsp;when&nbsp;expecting&nbsp;to&nbsp;read&nbsp;a&nbsp;0xff&nbsp;0x00&nbsp;byte-stuffed&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="1740108">func</span>&nbsp;<span class="op" id="1740113">(</span><span class="ident" id="1740114">d</span>&nbsp;<span class="op" id="1740116">*</span><span class="ident" id="1740117">decoder</span><span class="op" id="1740124">)</span>&nbsp;<span class="ident" id="1740126">unreadByteStuffedByte</span><span class="op" id="1740147">(</span><span class="op" id="1740148">)</span>&nbsp;<span class="op" id="1740150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1740153">if</span>&nbsp;<span class="ident" id="1740156">d</span><span class="op" id="1740157">.</span><span class="ident" id="1740158">bytes</span><span class="op" id="1740163">.</span><span class="ident" id="1740164">nUnreadable</span>&nbsp;<span class="op" id="1740176">==</span>&nbsp;<span class="num" id="1740179">0</span>&nbsp;<span class="op" id="1740181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1740185">panic</span><span class="op" id="1740190">(</span><span class="string" id="1740191">&#34;jpeg:&nbsp;unreadByteStuffedByte&nbsp;call&nbsp;cannot&nbsp;be&nbsp;fulfilled&#34;</span><span class="op" id="1740245">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1740248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1740251">d</span><span class="op" id="1740252">.</span><span class="ident" id="1740253">bytes</span><span class="op" id="1740258">.</span><span class="ident" id="1740259">i</span>&nbsp;<span class="op" id="1740261">-=</span>&nbsp;<span class="ident" id="1740264">d</span><span class="op" id="1740265">.</span><span class="ident" id="1740266">bytes</span><span class="op" id="1740271">.</span><span class="ident" id="1740272">nUnreadable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1740285">d</span><span class="op" id="1740286">.</span><span class="ident" id="1740287">bytes</span><span class="op" id="1740292">.</span><span class="ident" id="1740293">nUnreadable</span>&nbsp;<span class="op" id="1740305">=</span>&nbsp;<span class="num" id="1740307">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1740310">if</span>&nbsp;<span class="ident" id="1740313">d</span><span class="op" id="1740314">.</span><span class="ident" id="1740315">bits</span><span class="op" id="1740319">.</span><span class="ident" id="1740320">n</span>&nbsp;<span class="op" id="1740322">&gt;=</span>&nbsp;<span class="num" id="1740325">8</span>&nbsp;<span class="op" id="1740327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1740331">d</span><span class="op" id="1740332">.</span><span class="ident" id="1740333">bits</span><span class="op" id="1740337">.</span><span class="ident" id="1740338">a</span>&nbsp;<span class="op" id="1740340">&gt;&gt;=</span>&nbsp;<span class="num" id="1740344">8</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1740348">d</span><span class="op" id="1740349">.</span><span class="ident" id="1740350">bits</span><span class="op" id="1740354">.</span><span class="ident" id="1740355">n</span>&nbsp;<span class="op" id="1740357">-=</span>&nbsp;<span class="num" id="1740360">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1740364">d</span><span class="op" id="1740365">.</span><span class="ident" id="1740366">bits</span><span class="op" id="1740370">.</span><span class="ident" id="1740371">m</span>&nbsp;<span class="op" id="1740373">&gt;&gt;=</span>&nbsp;<span class="num" id="1740377">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1740380">}</span><br>
<span class="lineno"></span><span class="op" id="1740382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="1740385">//&nbsp;readByte&nbsp;returns&nbsp;the&nbsp;next&nbsp;byte,&nbsp;whether&nbsp;buffered&nbsp;or&nbsp;not&nbsp;buffered.&nbsp;It&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="1740462">//&nbsp;not&nbsp;care&nbsp;about&nbsp;byte&nbsp;stuffing.</span><br>
<span class="lineno"></span><span class="keyword" id="1740495">func</span>&nbsp;<span class="op" id="1740500">(</span><span class="ident" id="1740501">d</span>&nbsp;<span class="op" id="1740503">*</span><span class="ident" id="1740504">decoder</span><span class="op" id="1740511">)</span>&nbsp;<span class="ident" id="1740513">readByte</span><span class="op" id="1740521">(</span><span class="op" id="1740522">)</span>&nbsp;<span class="op" id="1740524">(</span><span class="ident" id="1740525">x</span>&nbsp;<span class="builtintype" id="1740527">byte</span><span class="op" id="1740531">,</span>&nbsp;<span class="ident" id="1740533">err</span>&nbsp;<span class="builtintype" id="1740537">error</span><span class="op" id="1740542">)</span>&nbsp;<span class="op" id="1740544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1740547">for</span>&nbsp;<span class="ident" id="1740551">d</span><span class="op" id="1740552">.</span><span class="ident" id="1740553">bytes</span><span class="op" id="1740558">.</span><span class="ident" id="1740559">i</span>&nbsp;<span class="op" id="1740561">==</span>&nbsp;<span class="ident" id="1740564">d</span><span class="op" id="1740565">.</span><span class="ident" id="1740566">bytes</span><span class="op" id="1740571">.</span><span class="ident" id="1740572">j</span>&nbsp;<span class="op" id="1740574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1740578">if</span>&nbsp;<span class="ident" id="1740581">err</span>&nbsp;<span class="op" id="1740585">=</span>&nbsp;<span class="ident" id="1740587">d</span><span class="op" id="1740588">.</span><span class="ident" id="1740589">fill</span><span class="op" id="1740593">(</span><span class="op" id="1740594">)</span><span class="op" id="1740595">;</span>&nbsp;<span class="ident" id="1740597">err</span>&nbsp;<span class="op" id="1740601">!=</span>&nbsp;<span class="builtintype" id="1740604">nil</span>&nbsp;<span class="op" id="1740608">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1740613">return</span>&nbsp;<span class="num" id="1740620">0</span><span class="op" id="1740621">,</span>&nbsp;<span class="ident" id="1740623">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1740629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1740632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1740635">x</span>&nbsp;<span class="op" id="1740637">=</span>&nbsp;<span class="ident" id="1740639">d</span><span class="op" id="1740640">.</span><span class="ident" id="1740641">bytes</span><span class="op" id="1740646">.</span><span class="ident" id="1740647">buf</span><span class="op" id="1740650">[</span><span class="ident" id="1740651">d</span><span class="op" id="1740652">.</span><span class="ident" id="1740653">bytes</span><span class="op" id="1740658">.</span><span class="ident" id="1740659">i</span><span class="op" id="1740660">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1740663">d</span><span class="op" id="1740664">.</span><span class="ident" id="1740665">bytes</span><span class="op" id="1740670">.</span><span class="ident" id="1740671">i</span><span class="op" id="1740672">++</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1740676">d</span><span class="op" id="1740677">.</span><span class="ident" id="1740678">bytes</span><span class="op" id="1740683">.</span><span class="ident" id="1740684">nUnreadable</span>&nbsp;<span class="op" id="1740696">=</span>&nbsp;<span class="num" id="1740698">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1740701">return</span>&nbsp;<span class="ident" id="1740708">x</span><span class="op" id="1740709">,</span>&nbsp;<span class="builtintype" id="1740711">nil</span><br>
<span class="lineno"></span><span class="op" id="1740715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1740718">//&nbsp;errMissingFF00&nbsp;means&nbsp;that&nbsp;readByteStuffedByte&nbsp;encountered&nbsp;an&nbsp;0xff&nbsp;byte&nbsp;(a</span><br>
<span class="lineno">185</span><span class="comment" id="1740795">//&nbsp;marker&nbsp;byte)&nbsp;that&nbsp;wasn&#39;t&nbsp;the&nbsp;expected&nbsp;byte-stuffed&nbsp;sequence&nbsp;0xff,&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="1740870">var</span>&nbsp;<span class="ident" id="1740874">errMissingFF00</span>&nbsp;<span class="op" id="1740889">=</span>&nbsp;<span class="ident" id="1740891">FormatError</span><span class="op" id="1740902">(</span><span class="string" id="1740903">&#34;missing&nbsp;0xff00&nbsp;sequence&#34;</span><span class="op" id="1740928">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1740931">//&nbsp;readByteStuffedByte&nbsp;is&nbsp;like&nbsp;readByte&nbsp;but&nbsp;is&nbsp;for&nbsp;byte-stuffed&nbsp;Huffman&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="1741009">func</span>&nbsp;<span class="op" id="1741014">(</span><span class="ident" id="1741015">d</span>&nbsp;<span class="op" id="1741017">*</span><span class="ident" id="1741018">decoder</span><span class="op" id="1741025">)</span>&nbsp;<span class="ident" id="1741027">readByteStuffedByte</span><span class="op" id="1741046">(</span><span class="op" id="1741047">)</span>&nbsp;<span class="op" id="1741049">(</span><span class="ident" id="1741050">x</span>&nbsp;<span class="builtintype" id="1741052">byte</span><span class="op" id="1741056">,</span>&nbsp;<span class="ident" id="1741058">err</span>&nbsp;<span class="builtintype" id="1741062">error</span><span class="op" id="1741067">)</span>&nbsp;<span class="op" id="1741069">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741072">//&nbsp;Take&nbsp;the&nbsp;fast&nbsp;path&nbsp;if&nbsp;d.bytes.buf&nbsp;contains&nbsp;at&nbsp;least&nbsp;two&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1741139">if</span>&nbsp;<span class="ident" id="1741142">d</span><span class="op" id="1741143">.</span><span class="ident" id="1741144">bytes</span><span class="op" id="1741149">.</span><span class="ident" id="1741150">i</span><span class="op" id="1741151">+</span><span class="num" id="1741152">2</span>&nbsp;<span class="op" id="1741154">&lt;=</span>&nbsp;<span class="ident" id="1741157">d</span><span class="op" id="1741158">.</span><span class="ident" id="1741159">bytes</span><span class="op" id="1741164">.</span><span class="ident" id="1741165">j</span>&nbsp;<span class="op" id="1741167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1741171">x</span>&nbsp;<span class="op" id="1741173">=</span>&nbsp;<span class="ident" id="1741175">d</span><span class="op" id="1741176">.</span><span class="ident" id="1741177">bytes</span><span class="op" id="1741182">.</span><span class="ident" id="1741183">buf</span><span class="op" id="1741186">[</span><span class="ident" id="1741187">d</span><span class="op" id="1741188">.</span><span class="ident" id="1741189">bytes</span><span class="op" id="1741194">.</span><span class="ident" id="1741195">i</span><span class="op" id="1741196">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1741200">d</span><span class="op" id="1741201">.</span><span class="ident" id="1741202">bytes</span><span class="op" id="1741207">.</span><span class="ident" id="1741208">i</span><span class="op" id="1741209">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1741214">d</span><span class="op" id="1741215">.</span><span class="ident" id="1741216">bytes</span><span class="op" id="1741221">.</span><span class="ident" id="1741222">nUnreadable</span>&nbsp;<span class="op" id="1741234">=</span>&nbsp;<span class="num" id="1741236">1</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1741240">if</span>&nbsp;<span class="ident" id="1741243">x</span>&nbsp;<span class="op" id="1741245">!=</span>&nbsp;<span class="num" id="1741248">0xff</span>&nbsp;<span class="op" id="1741253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1741258">return</span>&nbsp;<span class="ident" id="1741265">x</span><span class="op" id="1741266">,</span>&nbsp;<span class="ident" id="1741268">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1741274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1741278">if</span>&nbsp;<span class="ident" id="1741281">d</span><span class="op" id="1741282">.</span><span class="ident" id="1741283">bytes</span><span class="op" id="1741288">.</span><span class="ident" id="1741289">buf</span><span class="op" id="1741292">[</span><span class="ident" id="1741293">d</span><span class="op" id="1741294">.</span><span class="ident" id="1741295">bytes</span><span class="op" id="1741300">.</span><span class="ident" id="1741301">i</span><span class="op" id="1741302">]</span>&nbsp;<span class="op" id="1741304">!=</span>&nbsp;<span class="num" id="1741307">0x00</span>&nbsp;<span class="op" id="1741312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1741317">return</span>&nbsp;<span class="num" id="1741324">0</span><span class="op" id="1741325">,</span>&nbsp;<span class="ident" id="1741327">errMissingFF00</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1741344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1741348">d</span><span class="op" id="1741349">.</span><span class="ident" id="1741350">bytes</span><span class="op" id="1741355">.</span><span class="ident" id="1741356">i</span><span class="op" id="1741357">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1741362">d</span><span class="op" id="1741363">.</span><span class="ident" id="1741364">bytes</span><span class="op" id="1741369">.</span><span class="ident" id="1741370">nUnreadable</span>&nbsp;<span class="op" id="1741382">=</span>&nbsp;<span class="num" id="1741384">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1741388">return</span>&nbsp;<span class="num" id="1741395">0xff</span><span class="op" id="1741399">,</span>&nbsp;<span class="builtintype" id="1741401">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1741406">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1741410">x</span><span class="op" id="1741411">,</span>&nbsp;<span class="ident" id="1741413">err</span>&nbsp;<span class="op" id="1741417">=</span>&nbsp;<span class="ident" id="1741419">d</span><span class="op" id="1741420">.</span><span class="ident" id="1741421">readByte</span><span class="op" id="1741429">(</span><span class="op" id="1741430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1741433">if</span>&nbsp;<span class="ident" id="1741436">err</span>&nbsp;<span class="op" id="1741440">!=</span>&nbsp;<span class="builtintype" id="1741443">nil</span>&nbsp;<span class="op" id="1741447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1741451">return</span>&nbsp;<span class="num" id="1741458">0</span><span class="op" id="1741459">,</span>&nbsp;<span class="ident" id="1741461">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1741466">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1741469">if</span>&nbsp;<span class="ident" id="1741472">x</span>&nbsp;<span class="op" id="1741474">!=</span>&nbsp;<span class="num" id="1741477">0xff</span>&nbsp;<span class="op" id="1741482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1741486">d</span><span class="op" id="1741487">.</span><span class="ident" id="1741488">bytes</span><span class="op" id="1741493">.</span><span class="ident" id="1741494">nUnreadable</span>&nbsp;<span class="op" id="1741506">=</span>&nbsp;<span class="num" id="1741508">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1741512">return</span>&nbsp;<span class="ident" id="1741519">x</span><span class="op" id="1741520">,</span>&nbsp;<span class="builtintype" id="1741522">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1741527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1741531">x</span><span class="op" id="1741532">,</span>&nbsp;<span class="ident" id="1741534">err</span>&nbsp;<span class="op" id="1741538">=</span>&nbsp;<span class="ident" id="1741540">d</span><span class="op" id="1741541">.</span><span class="ident" id="1741542">readByte</span><span class="op" id="1741550">(</span><span class="op" id="1741551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1741554">if</span>&nbsp;<span class="ident" id="1741557">err</span>&nbsp;<span class="op" id="1741561">!=</span>&nbsp;<span class="builtintype" id="1741564">nil</span>&nbsp;<span class="op" id="1741568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1741572">d</span><span class="op" id="1741573">.</span><span class="ident" id="1741574">bytes</span><span class="op" id="1741579">.</span><span class="ident" id="1741580">nUnreadable</span>&nbsp;<span class="op" id="1741592">=</span>&nbsp;<span class="num" id="1741594">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1741598">return</span>&nbsp;<span class="num" id="1741605">0</span><span class="op" id="1741606">,</span>&nbsp;<span class="ident" id="1741608">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1741613">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1741616">d</span><span class="op" id="1741617">.</span><span class="ident" id="1741618">bytes</span><span class="op" id="1741623">.</span><span class="ident" id="1741624">nUnreadable</span>&nbsp;<span class="op" id="1741636">=</span>&nbsp;<span class="num" id="1741638">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1741641">if</span>&nbsp;<span class="ident" id="1741644">x</span>&nbsp;<span class="op" id="1741646">!=</span>&nbsp;<span class="num" id="1741649">0x00</span>&nbsp;<span class="op" id="1741654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1741658">return</span>&nbsp;<span class="num" id="1741665">0</span><span class="op" id="1741666">,</span>&nbsp;<span class="ident" id="1741668">errMissingFF00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1741684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1741687">return</span>&nbsp;<span class="num" id="1741694">0xff</span><span class="op" id="1741698">,</span>&nbsp;<span class="builtintype" id="1741700">nil</span><br>
<span class="lineno">225</span><span class="op" id="1741704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1741707">//&nbsp;readFull&nbsp;reads&nbsp;exactly&nbsp;len(p)&nbsp;bytes&nbsp;into&nbsp;p.&nbsp;It&nbsp;does&nbsp;not&nbsp;care&nbsp;about&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="1741782">//&nbsp;stuffing.</span><br>
<span class="lineno"></span><span class="keyword" id="1741795">func</span>&nbsp;<span class="op" id="1741800">(</span><span class="ident" id="1741801">d</span>&nbsp;<span class="op" id="1741803">*</span><span class="ident" id="1741804">decoder</span><span class="op" id="1741811">)</span>&nbsp;<span class="ident" id="1741813">readFull</span><span class="op" id="1741821">(</span><span class="ident" id="1741822">p</span>&nbsp;<span class="op" id="1741824">[</span><span class="op" id="1741825">]</span><span class="builtintype" id="1741826">byte</span><span class="op" id="1741830">)</span>&nbsp;<span class="builtintype" id="1741832">error</span>&nbsp;<span class="op" id="1741838">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741841">//&nbsp;Unread&nbsp;the&nbsp;overshot&nbsp;bytes,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1741880">if</span>&nbsp;<span class="ident" id="1741883">d</span><span class="op" id="1741884">.</span><span class="ident" id="1741885">bytes</span><span class="op" id="1741890">.</span><span class="ident" id="1741891">nUnreadable</span>&nbsp;<span class="op" id="1741903">!=</span>&nbsp;<span class="num" id="1741906">0</span>&nbsp;<span class="op" id="1741908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1741912">if</span>&nbsp;<span class="ident" id="1741915">d</span><span class="op" id="1741916">.</span><span class="ident" id="1741917">bits</span><span class="op" id="1741921">.</span><span class="ident" id="1741922">n</span>&nbsp;<span class="op" id="1741924">&gt;=</span>&nbsp;<span class="num" id="1741927">8</span>&nbsp;<span class="op" id="1741929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1741934">d</span><span class="op" id="1741935">.</span><span class="ident" id="1741936">unreadByteStuffedByte</span><span class="op" id="1741957">(</span><span class="op" id="1741958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1741962">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1741966">d</span><span class="op" id="1741967">.</span><span class="ident" id="1741968">bytes</span><span class="op" id="1741973">.</span><span class="ident" id="1741974">nUnreadable</span>&nbsp;<span class="op" id="1741986">=</span>&nbsp;<span class="num" id="1741988">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1741991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1741995">for</span>&nbsp;<span class="op" id="1741999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1742003">n</span>&nbsp;<span class="op" id="1742005">:=</span>&nbsp;<span class="builtinfunc" id="1742008">copy</span><span class="op" id="1742012">(</span><span class="ident" id="1742013">p</span><span class="op" id="1742014">,</span>&nbsp;<span class="ident" id="1742016">d</span><span class="op" id="1742017">.</span><span class="ident" id="1742018">bytes</span><span class="op" id="1742023">.</span><span class="ident" id="1742024">buf</span><span class="op" id="1742027">[</span><span class="ident" id="1742028">d</span><span class="op" id="1742029">.</span><span class="ident" id="1742030">bytes</span><span class="op" id="1742035">.</span><span class="ident" id="1742036">i</span><span class="op" id="1742037">:</span><span class="ident" id="1742038">d</span><span class="op" id="1742039">.</span><span class="ident" id="1742040">bytes</span><span class="op" id="1742045">.</span><span class="ident" id="1742046">j</span><span class="op" id="1742047">]</span><span class="op" id="1742048">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1742052">p</span>&nbsp;<span class="op" id="1742054">=</span>&nbsp;<span class="ident" id="1742056">p</span><span class="op" id="1742057">[</span><span class="ident" id="1742058">n</span><span class="op" id="1742059">:</span><span class="op" id="1742060">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1742064">d</span><span class="op" id="1742065">.</span><span class="ident" id="1742066">bytes</span><span class="op" id="1742071">.</span><span class="ident" id="1742072">i</span>&nbsp;<span class="op" id="1742074">+=</span>&nbsp;<span class="ident" id="1742077">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742081">if</span>&nbsp;<span class="builtinfunc" id="1742084">len</span><span class="op" id="1742087">(</span><span class="ident" id="1742088">p</span><span class="op" id="1742089">)</span>&nbsp;<span class="op" id="1742091">==</span>&nbsp;<span class="num" id="1742094">0</span>&nbsp;<span class="op" id="1742096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742101">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1742109">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742113">if</span>&nbsp;<span class="ident" id="1742116">err</span>&nbsp;<span class="op" id="1742120">:=</span>&nbsp;<span class="ident" id="1742123">d</span><span class="op" id="1742124">.</span><span class="ident" id="1742125">fill</span><span class="op" id="1742129">(</span><span class="op" id="1742130">)</span><span class="op" id="1742131">;</span>&nbsp;<span class="ident" id="1742133">err</span>&nbsp;<span class="op" id="1742137">!=</span>&nbsp;<span class="builtintype" id="1742140">nil</span>&nbsp;<span class="op" id="1742144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742149">if</span>&nbsp;<span class="ident" id="1742152">err</span>&nbsp;<span class="op" id="1742156">==</span>&nbsp;<span class="ident" id="1742159">io</span><span class="op" id="1742161">.</span><span class="ident" id="1742162">EOF</span>&nbsp;<span class="op" id="1742166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1742172">err</span>&nbsp;<span class="op" id="1742176">=</span>&nbsp;<span class="ident" id="1742178">io</span><span class="op" id="1742180">.</span><span class="ident" id="1742181">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1742201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742206">return</span>&nbsp;<span class="ident" id="1742213">err</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1742219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1742222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742225">return</span>&nbsp;<span class="builtintype" id="1742232">nil</span><br>
<span class="lineno"></span><span class="op" id="1742236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="1742239">//&nbsp;ignore&nbsp;ignores&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="1742275">func</span>&nbsp;<span class="op" id="1742280">(</span><span class="ident" id="1742281">d</span>&nbsp;<span class="op" id="1742283">*</span><span class="ident" id="1742284">decoder</span><span class="op" id="1742291">)</span>&nbsp;<span class="ident" id="1742293">ignore</span><span class="op" id="1742299">(</span><span class="ident" id="1742300">n</span>&nbsp;<span class="builtintype" id="1742302">int</span><span class="op" id="1742305">)</span>&nbsp;<span class="builtintype" id="1742307">error</span>&nbsp;<span class="op" id="1742313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1742316">//&nbsp;Unread&nbsp;the&nbsp;overshot&nbsp;bytes,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742355">if</span>&nbsp;<span class="ident" id="1742358">d</span><span class="op" id="1742359">.</span><span class="ident" id="1742360">bytes</span><span class="op" id="1742365">.</span><span class="ident" id="1742366">nUnreadable</span>&nbsp;<span class="op" id="1742378">!=</span>&nbsp;<span class="num" id="1742381">0</span>&nbsp;<span class="op" id="1742383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742387">if</span>&nbsp;<span class="ident" id="1742390">d</span><span class="op" id="1742391">.</span><span class="ident" id="1742392">bits</span><span class="op" id="1742396">.</span><span class="ident" id="1742397">n</span>&nbsp;<span class="op" id="1742399">&gt;=</span>&nbsp;<span class="num" id="1742402">8</span>&nbsp;<span class="op" id="1742404">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1742409">d</span><span class="op" id="1742410">.</span><span class="ident" id="1742411">unreadByteStuffedByte</span><span class="op" id="1742432">(</span><span class="op" id="1742433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1742437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1742441">d</span><span class="op" id="1742442">.</span><span class="ident" id="1742443">bytes</span><span class="op" id="1742448">.</span><span class="ident" id="1742449">nUnreadable</span>&nbsp;<span class="op" id="1742461">=</span>&nbsp;<span class="num" id="1742463">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1742466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742470">for</span>&nbsp;<span class="op" id="1742474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1742478">m</span>&nbsp;<span class="op" id="1742480">:=</span>&nbsp;<span class="ident" id="1742483">d</span><span class="op" id="1742484">.</span><span class="ident" id="1742485">bytes</span><span class="op" id="1742490">.</span><span class="ident" id="1742491">j</span>&nbsp;<span class="op" id="1742493">-</span>&nbsp;<span class="ident" id="1742495">d</span><span class="op" id="1742496">.</span><span class="ident" id="1742497">bytes</span><span class="op" id="1742502">.</span><span class="ident" id="1742503">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742507">if</span>&nbsp;<span class="ident" id="1742510">m</span>&nbsp;<span class="op" id="1742512">&gt;</span>&nbsp;<span class="ident" id="1742514">n</span>&nbsp;<span class="op" id="1742516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1742521">m</span>&nbsp;<span class="op" id="1742523">=</span>&nbsp;<span class="ident" id="1742525">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1742529">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1742533">d</span><span class="op" id="1742534">.</span><span class="ident" id="1742535">bytes</span><span class="op" id="1742540">.</span><span class="ident" id="1742541">i</span>&nbsp;<span class="op" id="1742543">+=</span>&nbsp;<span class="ident" id="1742546">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1742550">n</span>&nbsp;<span class="op" id="1742552">-=</span>&nbsp;<span class="ident" id="1742555">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742559">if</span>&nbsp;<span class="ident" id="1742562">n</span>&nbsp;<span class="op" id="1742564">==</span>&nbsp;<span class="num" id="1742567">0</span>&nbsp;<span class="op" id="1742569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742574">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1742582">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742586">if</span>&nbsp;<span class="ident" id="1742589">err</span>&nbsp;<span class="op" id="1742593">:=</span>&nbsp;<span class="ident" id="1742596">d</span><span class="op" id="1742597">.</span><span class="ident" id="1742598">fill</span><span class="op" id="1742602">(</span><span class="op" id="1742603">)</span><span class="op" id="1742604">;</span>&nbsp;<span class="ident" id="1742606">err</span>&nbsp;<span class="op" id="1742610">!=</span>&nbsp;<span class="builtintype" id="1742613">nil</span>&nbsp;<span class="op" id="1742617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742622">if</span>&nbsp;<span class="ident" id="1742625">err</span>&nbsp;<span class="op" id="1742629">==</span>&nbsp;<span class="ident" id="1742632">io</span><span class="op" id="1742634">.</span><span class="ident" id="1742635">EOF</span>&nbsp;<span class="op" id="1742639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1742645">err</span>&nbsp;<span class="op" id="1742649">=</span>&nbsp;<span class="ident" id="1742651">io</span><span class="op" id="1742653">.</span><span class="ident" id="1742654">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1742674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742679">return</span>&nbsp;<span class="ident" id="1742686">err</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1742692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1742695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742698">return</span>&nbsp;<span class="builtintype" id="1742705">nil</span><br>
<span class="lineno"></span><span class="op" id="1742709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="1742712">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.2.</span><br>
<span class="lineno"></span><span class="keyword" id="1742743">func</span>&nbsp;<span class="op" id="1742748">(</span><span class="ident" id="1742749">d</span>&nbsp;<span class="op" id="1742751">*</span><span class="ident" id="1742752">decoder</span><span class="op" id="1742759">)</span>&nbsp;<span class="ident" id="1742761">processSOF</span><span class="op" id="1742771">(</span><span class="ident" id="1742772">n</span>&nbsp;<span class="builtintype" id="1742774">int</span><span class="op" id="1742777">)</span>&nbsp;<span class="builtintype" id="1742779">error</span>&nbsp;<span class="op" id="1742785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742788">switch</span>&nbsp;<span class="ident" id="1742795">n</span>&nbsp;<span class="op" id="1742797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742800">case</span>&nbsp;<span class="num" id="1742805">6</span>&nbsp;<span class="op" id="1742807">+</span>&nbsp;<span class="num" id="1742809">3</span><span class="op" id="1742810">*</span><span class="ident" id="1742811">nGrayComponent</span><span class="op" id="1742825">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1742829">d</span><span class="op" id="1742830">.</span><span class="ident" id="1742831">nComp</span>&nbsp;<span class="op" id="1742837">=</span>&nbsp;<span class="ident" id="1742839">nGrayComponent</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742855">case</span>&nbsp;<span class="num" id="1742860">6</span>&nbsp;<span class="op" id="1742862">+</span>&nbsp;<span class="num" id="1742864">3</span><span class="op" id="1742865">*</span><span class="ident" id="1742866">nColorComponent</span><span class="op" id="1742881">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1742885">d</span><span class="op" id="1742886">.</span><span class="ident" id="1742887">nComp</span>&nbsp;<span class="op" id="1742893">=</span>&nbsp;<span class="ident" id="1742895">nColorComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742912">default</span><span class="op" id="1742919">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742923">return</span>&nbsp;<span class="ident" id="1742930">UnsupportedError</span><span class="op" id="1742946">(</span><span class="string" id="1742947">&#34;SOF&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="1742969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1742972">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742975">if</span>&nbsp;<span class="ident" id="1742978">err</span>&nbsp;<span class="op" id="1742982">:=</span>&nbsp;<span class="ident" id="1742985">d</span><span class="op" id="1742986">.</span><span class="ident" id="1742987">readFull</span><span class="op" id="1742995">(</span><span class="ident" id="1742996">d</span><span class="op" id="1742997">.</span><span class="ident" id="1742998">tmp</span><span class="op" id="1743001">[</span><span class="op" id="1743002">:</span><span class="ident" id="1743003">n</span><span class="op" id="1743004">]</span><span class="op" id="1743005">)</span><span class="op" id="1743006">;</span>&nbsp;<span class="ident" id="1743008">err</span>&nbsp;<span class="op" id="1743012">!=</span>&nbsp;<span class="builtintype" id="1743015">nil</span>&nbsp;<span class="op" id="1743019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1743023">return</span>&nbsp;<span class="ident" id="1743030">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1743035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1743038">//&nbsp;We&nbsp;only&nbsp;support&nbsp;8-bit&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1743075">if</span>&nbsp;<span class="ident" id="1743078">d</span><span class="op" id="1743079">.</span><span class="ident" id="1743080">tmp</span><span class="op" id="1743083">[</span><span class="num" id="1743084">0</span><span class="op" id="1743085">]</span>&nbsp;<span class="op" id="1743087">!=</span>&nbsp;<span class="num" id="1743090">8</span>&nbsp;<span class="op" id="1743092">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1743096">return</span>&nbsp;<span class="ident" id="1743103">UnsupportedError</span><span class="op" id="1743119">(</span><span class="string" id="1743120">&#34;precision&#34;</span><span class="op" id="1743131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1743134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1743137">d</span><span class="op" id="1743138">.</span><span class="ident" id="1743139">height</span>&nbsp;<span class="op" id="1743146">=</span>&nbsp;<span class="builtintype" id="1743148">int</span><span class="op" id="1743151">(</span><span class="ident" id="1743152">d</span><span class="op" id="1743153">.</span><span class="ident" id="1743154">tmp</span><span class="op" id="1743157">[</span><span class="num" id="1743158">1</span><span class="op" id="1743159">]</span><span class="op" id="1743160">)</span><span class="op" id="1743161">&lt;&lt;</span><span class="num" id="1743163">8</span>&nbsp;<span class="op" id="1743165">+</span>&nbsp;<span class="builtintype" id="1743167">int</span><span class="op" id="1743170">(</span><span class="ident" id="1743171">d</span><span class="op" id="1743172">.</span><span class="ident" id="1743173">tmp</span><span class="op" id="1743176">[</span><span class="num" id="1743177">2</span><span class="op" id="1743178">]</span><span class="op" id="1743179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1743182">d</span><span class="op" id="1743183">.</span><span class="ident" id="1743184">width</span>&nbsp;<span class="op" id="1743190">=</span>&nbsp;<span class="builtintype" id="1743192">int</span><span class="op" id="1743195">(</span><span class="ident" id="1743196">d</span><span class="op" id="1743197">.</span><span class="ident" id="1743198">tmp</span><span class="op" id="1743201">[</span><span class="num" id="1743202">3</span><span class="op" id="1743203">]</span><span class="op" id="1743204">)</span><span class="op" id="1743205">&lt;&lt;</span><span class="num" id="1743207">8</span>&nbsp;<span class="op" id="1743209">+</span>&nbsp;<span class="builtintype" id="1743211">int</span><span class="op" id="1743214">(</span><span class="ident" id="1743215">d</span><span class="op" id="1743216">.</span><span class="ident" id="1743217">tmp</span><span class="op" id="1743220">[</span><span class="num" id="1743221">4</span><span class="op" id="1743222">]</span><span class="op" id="1743223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1743226">if</span>&nbsp;<span class="builtintype" id="1743229">int</span><span class="op" id="1743232">(</span><span class="ident" id="1743233">d</span><span class="op" id="1743234">.</span><span class="ident" id="1743235">tmp</span><span class="op" id="1743238">[</span><span class="num" id="1743239">5</span><span class="op" id="1743240">]</span><span class="op" id="1743241">)</span>&nbsp;<span class="op" id="1743243">!=</span>&nbsp;<span class="ident" id="1743246">d</span><span class="op" id="1743247">.</span><span class="ident" id="1743248">nComp</span>&nbsp;<span class="op" id="1743254">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1743258">return</span>&nbsp;<span class="ident" id="1743265">UnsupportedError</span><span class="op" id="1743281">(</span><span class="string" id="1743282">&#34;SOF&nbsp;has&nbsp;wrong&nbsp;number&nbsp;of&nbsp;image&nbsp;components&#34;</span><span class="op" id="1743324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1743327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1743330">for</span>&nbsp;<span class="ident" id="1743334">i</span>&nbsp;<span class="op" id="1743336">:=</span>&nbsp;<span class="num" id="1743339">0</span><span class="op" id="1743340">;</span>&nbsp;<span class="ident" id="1743342">i</span>&nbsp;<span class="op" id="1743344">&lt;</span>&nbsp;<span class="ident" id="1743346">d</span><span class="op" id="1743347">.</span><span class="ident" id="1743348">nComp</span><span class="op" id="1743353">;</span>&nbsp;<span class="ident" id="1743355">i</span><span class="op" id="1743356">++</span>&nbsp;<span class="op" id="1743359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1743363">d</span><span class="op" id="1743364">.</span><span class="ident" id="1743365">comp</span><span class="op" id="1743369">[</span><span class="ident" id="1743370">i</span><span class="op" id="1743371">]</span><span class="op" id="1743372">.</span><span class="ident" id="1743373">c</span>&nbsp;<span class="op" id="1743375">=</span>&nbsp;<span class="ident" id="1743377">d</span><span class="op" id="1743378">.</span><span class="ident" id="1743379">tmp</span><span class="op" id="1743382">[</span><span class="num" id="1743383">6</span><span class="op" id="1743384">+</span><span class="num" id="1743385">3</span><span class="op" id="1743386">*</span><span class="ident" id="1743387">i</span><span class="op" id="1743388">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1743392">d</span><span class="op" id="1743393">.</span><span class="ident" id="1743394">comp</span><span class="op" id="1743398">[</span><span class="ident" id="1743399">i</span><span class="op" id="1743400">]</span><span class="op" id="1743401">.</span><span class="ident" id="1743402">tq</span>&nbsp;<span class="op" id="1743405">=</span>&nbsp;<span class="ident" id="1743407">d</span><span class="op" id="1743408">.</span><span class="ident" id="1743409">tmp</span><span class="op" id="1743412">[</span><span class="num" id="1743413">8</span><span class="op" id="1743414">+</span><span class="num" id="1743415">3</span><span class="op" id="1743416">*</span><span class="ident" id="1743417">i</span><span class="op" id="1743418">]</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1743422">if</span>&nbsp;<span class="ident" id="1743425">d</span><span class="op" id="1743426">.</span><span class="ident" id="1743427">nComp</span>&nbsp;<span class="op" id="1743433">==</span>&nbsp;<span class="ident" id="1743436">nGrayComponent</span>&nbsp;<span class="op" id="1743451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1743456">//&nbsp;If&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;has&nbsp;only&nbsp;one&nbsp;component,&nbsp;section&nbsp;A.2&nbsp;says&nbsp;&#34;this&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1743530">//&nbsp;is&nbsp;non-interleaved&nbsp;by&nbsp;definition&#34;&nbsp;and&nbsp;section&nbsp;A.2.2&nbsp;says&nbsp;&#34;[in&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1743603">//&nbsp;case...]&nbsp;the&nbsp;order&nbsp;of&nbsp;data&nbsp;units&nbsp;within&nbsp;a&nbsp;scan&nbsp;shall&nbsp;be&nbsp;left-to-right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1743679">//&nbsp;and&nbsp;top-to-bottom...&nbsp;regardless&nbsp;of&nbsp;the&nbsp;values&nbsp;of&nbsp;H_1&nbsp;and&nbsp;V_1&#34;.&nbsp;Section</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1743756">//&nbsp;4.8.2&nbsp;also&nbsp;says&nbsp;&#34;[for&nbsp;non-interleaved&nbsp;data],&nbsp;the&nbsp;MCU&nbsp;is&nbsp;defined&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1743832">//&nbsp;one&nbsp;data&nbsp;unit&#34;.&nbsp;Similarly,&nbsp;section&nbsp;A.1.1&nbsp;explains&nbsp;that&nbsp;it&nbsp;is&nbsp;the&nbsp;ratio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1743909">//&nbsp;of&nbsp;H_i&nbsp;to&nbsp;max_j(H_j)&nbsp;that&nbsp;matters,&nbsp;and&nbsp;similarly&nbsp;for&nbsp;V.&nbsp;For&nbsp;grayscale</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1743985">//&nbsp;images,&nbsp;H_1&nbsp;is&nbsp;the&nbsp;maximum&nbsp;H_j&nbsp;for&nbsp;all&nbsp;components&nbsp;j,&nbsp;so&nbsp;that&nbsp;ratio&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1744061">//&nbsp;always&nbsp;1.&nbsp;The&nbsp;component&#39;s&nbsp;(h,&nbsp;v)&nbsp;is&nbsp;effectively&nbsp;always&nbsp;(1,&nbsp;1):&nbsp;even&nbsp;if</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1744138">//&nbsp;the&nbsp;nominal&nbsp;(h,&nbsp;v)&nbsp;is&nbsp;(2,&nbsp;1),&nbsp;a&nbsp;20x5&nbsp;image&nbsp;is&nbsp;encoded&nbsp;in&nbsp;three&nbsp;8x8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1744211">//&nbsp;MCUs,&nbsp;not&nbsp;two&nbsp;16x8&nbsp;MCUs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1744242">d</span><span class="op" id="1744243">.</span><span class="ident" id="1744244">comp</span><span class="op" id="1744248">[</span><span class="ident" id="1744249">i</span><span class="op" id="1744250">]</span><span class="op" id="1744251">.</span><span class="ident" id="1744252">h</span>&nbsp;<span class="op" id="1744254">=</span>&nbsp;<span class="num" id="1744256">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1744261">d</span><span class="op" id="1744262">.</span><span class="ident" id="1744263">comp</span><span class="op" id="1744267">[</span><span class="ident" id="1744268">i</span><span class="op" id="1744269">]</span><span class="op" id="1744270">.</span><span class="ident" id="1744271">v</span>&nbsp;<span class="op" id="1744273">=</span>&nbsp;<span class="num" id="1744275">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1744280">continue</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1744291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1744295">hv</span>&nbsp;<span class="op" id="1744298">:=</span>&nbsp;<span class="ident" id="1744301">d</span><span class="op" id="1744302">.</span><span class="ident" id="1744303">tmp</span><span class="op" id="1744306">[</span><span class="num" id="1744307">7</span><span class="op" id="1744308">+</span><span class="num" id="1744309">3</span><span class="op" id="1744310">*</span><span class="ident" id="1744311">i</span><span class="op" id="1744312">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1744316">d</span><span class="op" id="1744317">.</span><span class="ident" id="1744318">comp</span><span class="op" id="1744322">[</span><span class="ident" id="1744323">i</span><span class="op" id="1744324">]</span><span class="op" id="1744325">.</span><span class="ident" id="1744326">h</span>&nbsp;<span class="op" id="1744328">=</span>&nbsp;<span class="builtintype" id="1744330">int</span><span class="op" id="1744333">(</span><span class="ident" id="1744334">hv</span>&nbsp;<span class="op" id="1744337">&gt;&gt;</span>&nbsp;<span class="num" id="1744340">4</span><span class="op" id="1744341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1744345">d</span><span class="op" id="1744346">.</span><span class="ident" id="1744347">comp</span><span class="op" id="1744351">[</span><span class="ident" id="1744352">i</span><span class="op" id="1744353">]</span><span class="op" id="1744354">.</span><span class="ident" id="1744355">v</span>&nbsp;<span class="op" id="1744357">=</span>&nbsp;<span class="builtintype" id="1744359">int</span><span class="op" id="1744362">(</span><span class="ident" id="1744363">hv</span>&nbsp;<span class="op" id="1744366">&amp;</span>&nbsp;<span class="num" id="1744368">0x0f</span><span class="op" id="1744372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1744376">//&nbsp;For&nbsp;color&nbsp;images,&nbsp;we&nbsp;only&nbsp;support&nbsp;4:4:4,&nbsp;4:4:0,&nbsp;4:2:2&nbsp;or&nbsp;4:2:0&nbsp;chroma</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1744451">//&nbsp;downsampling&nbsp;ratios.&nbsp;This&nbsp;implies&nbsp;that&nbsp;the&nbsp;(h,&nbsp;v)&nbsp;values&nbsp;for&nbsp;the&nbsp;Y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1744523">//&nbsp;component&nbsp;are&nbsp;either&nbsp;(1,&nbsp;1),&nbsp;(1,&nbsp;2),&nbsp;(2,&nbsp;1)&nbsp;or&nbsp;(2,&nbsp;2),&nbsp;and&nbsp;the&nbsp;(h,&nbsp;v)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1744598">//&nbsp;values&nbsp;for&nbsp;the&nbsp;Cr&nbsp;and&nbsp;Cb&nbsp;components&nbsp;must&nbsp;be&nbsp;(1,&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1744655">if</span>&nbsp;<span class="ident" id="1744658">i</span>&nbsp;<span class="op" id="1744660">==</span>&nbsp;<span class="num" id="1744663">0</span>&nbsp;<span class="op" id="1744665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1744670">if</span>&nbsp;<span class="ident" id="1744673">hv</span>&nbsp;<span class="op" id="1744676">!=</span>&nbsp;<span class="num" id="1744679">0x11</span>&nbsp;<span class="op" id="1744684">&amp;&amp;</span>&nbsp;<span class="ident" id="1744687">hv</span>&nbsp;<span class="op" id="1744690">!=</span>&nbsp;<span class="num" id="1744693">0x21</span>&nbsp;<span class="op" id="1744698">&amp;&amp;</span>&nbsp;<span class="ident" id="1744701">hv</span>&nbsp;<span class="op" id="1744704">!=</span>&nbsp;<span class="num" id="1744707">0x22</span>&nbsp;<span class="op" id="1744712">&amp;&amp;</span>&nbsp;<span class="ident" id="1744715">hv</span>&nbsp;<span class="op" id="1744718">!=</span>&nbsp;<span class="num" id="1744721">0x12</span>&nbsp;<span class="op" id="1744726">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1744732">return</span>&nbsp;<span class="ident" id="1744739">UnsupportedError</span><span class="op" id="1744755">(</span><span class="string" id="1744756">&#34;luma/chroma&nbsp;downsample&nbsp;ratio&#34;</span><span class="op" id="1744786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1744791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1744795">}</span>&nbsp;<span class="keyword" id="1744797">else</span>&nbsp;<span class="keyword" id="1744802">if</span>&nbsp;<span class="ident" id="1744805">hv</span>&nbsp;<span class="op" id="1744808">!=</span>&nbsp;<span class="num" id="1744811">0x11</span>&nbsp;<span class="op" id="1744816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1744821">return</span>&nbsp;<span class="ident" id="1744828">UnsupportedError</span><span class="op" id="1744844">(</span><span class="string" id="1744845">&#34;luma/chroma&nbsp;downsample&nbsp;ratio&#34;</span><span class="op" id="1744875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1744879">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1744882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1744885">return</span>&nbsp;<span class="builtintype" id="1744892">nil</span><br>
<span class="lineno"></span><span class="op" id="1744896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1744899">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.4.1.</span><br>
<span class="lineno">345</span><span class="keyword" id="1744932">func</span>&nbsp;<span class="op" id="1744937">(</span><span class="ident" id="1744938">d</span>&nbsp;<span class="op" id="1744940">*</span><span class="ident" id="1744941">decoder</span><span class="op" id="1744948">)</span>&nbsp;<span class="ident" id="1744950">processDQT</span><span class="op" id="1744960">(</span><span class="ident" id="1744961">n</span>&nbsp;<span class="builtintype" id="1744963">int</span><span class="op" id="1744966">)</span>&nbsp;<span class="builtintype" id="1744968">error</span>&nbsp;<span class="op" id="1744974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1744977">const</span>&nbsp;<span class="ident" id="1744983">qtLength</span>&nbsp;<span class="op" id="1744992">=</span>&nbsp;<span class="num" id="1744994">1</span>&nbsp;<span class="op" id="1744996">+</span>&nbsp;<span class="ident" id="1744998">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745009">for</span>&nbsp;<span class="op" id="1745013">;</span>&nbsp;<span class="ident" id="1745015">n</span>&nbsp;<span class="op" id="1745017">&gt;=</span>&nbsp;<span class="ident" id="1745020">qtLength</span><span class="op" id="1745028">;</span>&nbsp;<span class="ident" id="1745030">n</span>&nbsp;<span class="op" id="1745032">-=</span>&nbsp;<span class="ident" id="1745035">qtLength</span>&nbsp;<span class="op" id="1745044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745048">if</span>&nbsp;<span class="ident" id="1745051">err</span>&nbsp;<span class="op" id="1745055">:=</span>&nbsp;<span class="ident" id="1745058">d</span><span class="op" id="1745059">.</span><span class="ident" id="1745060">readFull</span><span class="op" id="1745068">(</span><span class="ident" id="1745069">d</span><span class="op" id="1745070">.</span><span class="ident" id="1745071">tmp</span><span class="op" id="1745074">[</span><span class="op" id="1745075">:</span><span class="ident" id="1745076">qtLength</span><span class="op" id="1745084">]</span><span class="op" id="1745085">)</span><span class="op" id="1745086">;</span>&nbsp;<span class="ident" id="1745088">err</span>&nbsp;<span class="op" id="1745092">!=</span>&nbsp;<span class="builtintype" id="1745095">nil</span>&nbsp;<span class="op" id="1745099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745104">return</span>&nbsp;<span class="ident" id="1745111">err</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1745117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1745121">pq</span>&nbsp;<span class="op" id="1745124">:=</span>&nbsp;<span class="ident" id="1745127">d</span><span class="op" id="1745128">.</span><span class="ident" id="1745129">tmp</span><span class="op" id="1745132">[</span><span class="num" id="1745133">0</span><span class="op" id="1745134">]</span>&nbsp;<span class="op" id="1745136">&gt;&gt;</span>&nbsp;<span class="num" id="1745139">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745143">if</span>&nbsp;<span class="ident" id="1745146">pq</span>&nbsp;<span class="op" id="1745149">!=</span>&nbsp;<span class="num" id="1745152">0</span>&nbsp;<span class="op" id="1745154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745159">return</span>&nbsp;<span class="ident" id="1745166">UnsupportedError</span><span class="op" id="1745182">(</span><span class="string" id="1745183">&#34;bad&nbsp;Pq&nbsp;value&#34;</span><span class="op" id="1745197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1745201">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1745205">tq</span>&nbsp;<span class="op" id="1745208">:=</span>&nbsp;<span class="ident" id="1745211">d</span><span class="op" id="1745212">.</span><span class="ident" id="1745213">tmp</span><span class="op" id="1745216">[</span><span class="num" id="1745217">0</span><span class="op" id="1745218">]</span>&nbsp;<span class="op" id="1745220">&amp;</span>&nbsp;<span class="num" id="1745222">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745229">if</span>&nbsp;<span class="ident" id="1745232">tq</span>&nbsp;<span class="op" id="1745235">&gt;</span>&nbsp;<span class="ident" id="1745237">maxTq</span>&nbsp;<span class="op" id="1745243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745248">return</span>&nbsp;<span class="ident" id="1745255">FormatError</span><span class="op" id="1745266">(</span><span class="string" id="1745267">&#34;bad&nbsp;Tq&nbsp;value&#34;</span><span class="op" id="1745281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1745285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745289">for</span>&nbsp;<span class="ident" id="1745293">i</span>&nbsp;<span class="op" id="1745295">:=</span>&nbsp;<span class="keyword" id="1745298">range</span>&nbsp;<span class="ident" id="1745304">d</span><span class="op" id="1745305">.</span><span class="ident" id="1745306">quant</span><span class="op" id="1745311">[</span><span class="ident" id="1745312">tq</span><span class="op" id="1745314">]</span>&nbsp;<span class="op" id="1745316">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1745321">d</span><span class="op" id="1745322">.</span><span class="ident" id="1745323">quant</span><span class="op" id="1745328">[</span><span class="ident" id="1745329">tq</span><span class="op" id="1745331">]</span><span class="op" id="1745332">[</span><span class="ident" id="1745333">i</span><span class="op" id="1745334">]</span>&nbsp;<span class="op" id="1745336">=</span>&nbsp;<span class="builtintype" id="1745338">int32</span><span class="op" id="1745343">(</span><span class="ident" id="1745344">d</span><span class="op" id="1745345">.</span><span class="ident" id="1745346">tmp</span><span class="op" id="1745349">[</span><span class="ident" id="1745350">i</span><span class="op" id="1745351">+</span><span class="num" id="1745352">1</span><span class="op" id="1745353">]</span><span class="op" id="1745354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1745358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1745361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745364">if</span>&nbsp;<span class="ident" id="1745367">n</span>&nbsp;<span class="op" id="1745369">!=</span>&nbsp;<span class="num" id="1745372">0</span>&nbsp;<span class="op" id="1745374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745378">return</span>&nbsp;<span class="ident" id="1745385">FormatError</span><span class="op" id="1745396">(</span><span class="string" id="1745397">&#34;DQT&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="1745419">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1745422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745425">return</span>&nbsp;<span class="builtintype" id="1745432">nil</span><br>
<span class="lineno"></span><span class="op" id="1745436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1745439">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.4.4.</span><br>
<span class="lineno">370</span><span class="keyword" id="1745472">func</span>&nbsp;<span class="op" id="1745477">(</span><span class="ident" id="1745478">d</span>&nbsp;<span class="op" id="1745480">*</span><span class="ident" id="1745481">decoder</span><span class="op" id="1745488">)</span>&nbsp;<span class="ident" id="1745490">processDRI</span><span class="op" id="1745500">(</span><span class="ident" id="1745501">n</span>&nbsp;<span class="builtintype" id="1745503">int</span><span class="op" id="1745506">)</span>&nbsp;<span class="builtintype" id="1745508">error</span>&nbsp;<span class="op" id="1745514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745517">if</span>&nbsp;<span class="ident" id="1745520">n</span>&nbsp;<span class="op" id="1745522">!=</span>&nbsp;<span class="num" id="1745525">2</span>&nbsp;<span class="op" id="1745527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745531">return</span>&nbsp;<span class="ident" id="1745538">FormatError</span><span class="op" id="1745549">(</span><span class="string" id="1745550">&#34;DRI&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="1745572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1745575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745578">if</span>&nbsp;<span class="ident" id="1745581">err</span>&nbsp;<span class="op" id="1745585">:=</span>&nbsp;<span class="ident" id="1745588">d</span><span class="op" id="1745589">.</span><span class="ident" id="1745590">readFull</span><span class="op" id="1745598">(</span><span class="ident" id="1745599">d</span><span class="op" id="1745600">.</span><span class="ident" id="1745601">tmp</span><span class="op" id="1745604">[</span><span class="op" id="1745605">:</span><span class="num" id="1745606">2</span><span class="op" id="1745607">]</span><span class="op" id="1745608">)</span><span class="op" id="1745609">;</span>&nbsp;<span class="ident" id="1745611">err</span>&nbsp;<span class="op" id="1745615">!=</span>&nbsp;<span class="builtintype" id="1745618">nil</span>&nbsp;<span class="op" id="1745622">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745626">return</span>&nbsp;<span class="ident" id="1745633">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1745638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1745641">d</span><span class="op" id="1745642">.</span><span class="ident" id="1745643">ri</span>&nbsp;<span class="op" id="1745646">=</span>&nbsp;<span class="builtintype" id="1745648">int</span><span class="op" id="1745651">(</span><span class="ident" id="1745652">d</span><span class="op" id="1745653">.</span><span class="ident" id="1745654">tmp</span><span class="op" id="1745657">[</span><span class="num" id="1745658">0</span><span class="op" id="1745659">]</span><span class="op" id="1745660">)</span><span class="op" id="1745661">&lt;&lt;</span><span class="num" id="1745663">8</span>&nbsp;<span class="op" id="1745665">+</span>&nbsp;<span class="builtintype" id="1745667">int</span><span class="op" id="1745670">(</span><span class="ident" id="1745671">d</span><span class="op" id="1745672">.</span><span class="ident" id="1745673">tmp</span><span class="op" id="1745676">[</span><span class="num" id="1745677">1</span><span class="op" id="1745678">]</span><span class="op" id="1745679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745682">return</span>&nbsp;<span class="builtintype" id="1745689">nil</span><br>
<span class="lineno"></span><span class="op" id="1745693">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="comment" id="1745696">//&nbsp;decode&nbsp;reads&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="1745766">func</span>&nbsp;<span class="op" id="1745771">(</span><span class="ident" id="1745772">d</span>&nbsp;<span class="op" id="1745774">*</span><span class="ident" id="1745775">decoder</span><span class="op" id="1745782">)</span>&nbsp;<span class="ident" id="1745784">decode</span><span class="op" id="1745790">(</span><span class="ident" id="1745791">r</span>&nbsp;<span class="ident" id="1745793">io</span><span class="op" id="1745795">.</span><span class="ident" id="1745796">Reader</span><span class="op" id="1745802">,</span>&nbsp;<span class="ident" id="1745804">configOnly</span>&nbsp;<span class="builtintype" id="1745815">bool</span><span class="op" id="1745819">)</span>&nbsp;<span class="op" id="1745821">(</span><span class="ident" id="1745822">image</span><span class="op" id="1745827">.</span><span class="ident" id="1745828">Image</span><span class="op" id="1745833">,</span>&nbsp;<span class="builtintype" id="1745835">error</span><span class="op" id="1745840">)</span>&nbsp;<span class="op" id="1745842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1745845">d</span><span class="op" id="1745846">.</span><span class="ident" id="1745847">r</span>&nbsp;<span class="op" id="1745849">=</span>&nbsp;<span class="ident" id="1745851">r</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1745855">//&nbsp;Check&nbsp;for&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745896">if</span>&nbsp;<span class="ident" id="1745899">err</span>&nbsp;<span class="op" id="1745903">:=</span>&nbsp;<span class="ident" id="1745906">d</span><span class="op" id="1745907">.</span><span class="ident" id="1745908">readFull</span><span class="op" id="1745916">(</span><span class="ident" id="1745917">d</span><span class="op" id="1745918">.</span><span class="ident" id="1745919">tmp</span><span class="op" id="1745922">[</span><span class="op" id="1745923">:</span><span class="num" id="1745924">2</span><span class="op" id="1745925">]</span><span class="op" id="1745926">)</span><span class="op" id="1745927">;</span>&nbsp;<span class="ident" id="1745929">err</span>&nbsp;<span class="op" id="1745933">!=</span>&nbsp;<span class="builtintype" id="1745936">nil</span>&nbsp;<span class="op" id="1745940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745944">return</span>&nbsp;<span class="builtintype" id="1745951">nil</span><span class="op" id="1745954">,</span>&nbsp;<span class="ident" id="1745956">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1745961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745964">if</span>&nbsp;<span class="ident" id="1745967">d</span><span class="op" id="1745968">.</span><span class="ident" id="1745969">tmp</span><span class="op" id="1745972">[</span><span class="num" id="1745973">0</span><span class="op" id="1745974">]</span>&nbsp;<span class="op" id="1745976">!=</span>&nbsp;<span class="num" id="1745979">0xff</span>&nbsp;<span class="op" id="1745984">||</span>&nbsp;<span class="ident" id="1745987">d</span><span class="op" id="1745988">.</span><span class="ident" id="1745989">tmp</span><span class="op" id="1745992">[</span><span class="num" id="1745993">1</span><span class="op" id="1745994">]</span>&nbsp;<span class="op" id="1745996">!=</span>&nbsp;<span class="ident" id="1745999">soiMarker</span>&nbsp;<span class="op" id="1746009">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1746013">return</span>&nbsp;<span class="builtintype" id="1746020">nil</span><span class="op" id="1746023">,</span>&nbsp;<span class="ident" id="1746025">FormatError</span><span class="op" id="1746036">(</span><span class="string" id="1746037">&#34;missing&nbsp;SOI&nbsp;marker&#34;</span><span class="op" id="1746057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1746060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1746064">//&nbsp;Process&nbsp;the&nbsp;remaining&nbsp;segments&nbsp;until&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1746130">for</span>&nbsp;<span class="op" id="1746134">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1746138">err</span>&nbsp;<span class="op" id="1746142">:=</span>&nbsp;<span class="ident" id="1746145">d</span><span class="op" id="1746146">.</span><span class="ident" id="1746147">readFull</span><span class="op" id="1746155">(</span><span class="ident" id="1746156">d</span><span class="op" id="1746157">.</span><span class="ident" id="1746158">tmp</span><span class="op" id="1746161">[</span><span class="op" id="1746162">:</span><span class="num" id="1746163">2</span><span class="op" id="1746164">]</span><span class="op" id="1746165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1746169">if</span>&nbsp;<span class="ident" id="1746172">err</span>&nbsp;<span class="op" id="1746176">!=</span>&nbsp;<span class="builtintype" id="1746179">nil</span>&nbsp;<span class="op" id="1746183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1746188">return</span>&nbsp;<span class="builtintype" id="1746195">nil</span><span class="op" id="1746198">,</span>&nbsp;<span class="ident" id="1746200">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1746206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1746210">for</span>&nbsp;<span class="ident" id="1746214">d</span><span class="op" id="1746215">.</span><span class="ident" id="1746216">tmp</span><span class="op" id="1746219">[</span><span class="num" id="1746220">0</span><span class="op" id="1746221">]</span>&nbsp;<span class="op" id="1746223">!=</span>&nbsp;<span class="num" id="1746226">0xff</span>&nbsp;<span class="op" id="1746231">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1746236">//&nbsp;Strictly&nbsp;speaking,&nbsp;this&nbsp;is&nbsp;a&nbsp;format&nbsp;error.&nbsp;However,&nbsp;libjpeg&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1746305">//&nbsp;liberal&nbsp;in&nbsp;what&nbsp;it&nbsp;accepts.&nbsp;As&nbsp;of&nbsp;version&nbsp;9,&nbsp;next_marker&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1746371">//&nbsp;jdmarker.c&nbsp;treats&nbsp;this&nbsp;as&nbsp;a&nbsp;warning&nbsp;(JWRN_EXTRANEOUS_DATA)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1746440">//&nbsp;continues&nbsp;to&nbsp;decode&nbsp;the&nbsp;stream.&nbsp;Even&nbsp;before&nbsp;next_marker&nbsp;sees</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1746507">//&nbsp;extraneous&nbsp;data,&nbsp;jpeg_fill_bit_buffer&nbsp;in&nbsp;jdhuff.c&nbsp;reads&nbsp;as&nbsp;many</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1746577">//&nbsp;bytes&nbsp;as&nbsp;it&nbsp;can,&nbsp;possibly&nbsp;past&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;scan&#39;s&nbsp;data.&nbsp;It</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1746643">//&nbsp;effectively&nbsp;puts&nbsp;back&nbsp;any&nbsp;markers&nbsp;that&nbsp;it&nbsp;overscanned&nbsp;(e.g.&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1746712">//&nbsp;&#34;\xff\xd9&#34;&nbsp;EOI&nbsp;marker),&nbsp;but&nbsp;it&nbsp;does&nbsp;not&nbsp;put&nbsp;back&nbsp;non-marker&nbsp;data,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1746784">//&nbsp;and&nbsp;thus&nbsp;it&nbsp;can&nbsp;silently&nbsp;ignore&nbsp;a&nbsp;small&nbsp;number&nbsp;of&nbsp;extraneous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1746851">//&nbsp;non-marker&nbsp;bytes&nbsp;before&nbsp;next_marker&nbsp;has&nbsp;a&nbsp;chance&nbsp;to&nbsp;see&nbsp;them&nbsp;(and</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1746923">//&nbsp;print&nbsp;a&nbsp;warning).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1746947">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1746953">//&nbsp;We&nbsp;are&nbsp;therefore&nbsp;also&nbsp;liberal&nbsp;in&nbsp;what&nbsp;we&nbsp;accept.&nbsp;Extraneous&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1747024">//&nbsp;is&nbsp;silently&nbsp;ignored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1747051">//</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1747057">//&nbsp;This&nbsp;is&nbsp;similar&nbsp;to,&nbsp;but&nbsp;not&nbsp;exactly&nbsp;the&nbsp;same&nbsp;as,&nbsp;the&nbsp;restart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1747124">//&nbsp;mechanism&nbsp;within&nbsp;a&nbsp;scan&nbsp;(the&nbsp;RST[0-7]&nbsp;markers).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1747178">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1747184">//&nbsp;Note&nbsp;that&nbsp;extraneous&nbsp;0xff&nbsp;bytes&nbsp;in&nbsp;e.g.&nbsp;SOS&nbsp;data&nbsp;are&nbsp;escaped&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1747254">//&nbsp;&#34;\xff\x00&#34;,&nbsp;and&nbsp;so&nbsp;are&nbsp;detected&nbsp;a&nbsp;little&nbsp;further&nbsp;down&nbsp;below.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747321">d</span><span class="op" id="1747322">.</span><span class="ident" id="1747323">tmp</span><span class="op" id="1747326">[</span><span class="num" id="1747327">0</span><span class="op" id="1747328">]</span>&nbsp;<span class="op" id="1747330">=</span>&nbsp;<span class="ident" id="1747332">d</span><span class="op" id="1747333">.</span><span class="ident" id="1747334">tmp</span><span class="op" id="1747337">[</span><span class="num" id="1747338">1</span><span class="op" id="1747339">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747344">d</span><span class="op" id="1747345">.</span><span class="ident" id="1747346">tmp</span><span class="op" id="1747349">[</span><span class="num" id="1747350">1</span><span class="op" id="1747351">]</span><span class="op" id="1747352">,</span>&nbsp;<span class="ident" id="1747354">err</span>&nbsp;<span class="op" id="1747358">=</span>&nbsp;<span class="ident" id="1747360">d</span><span class="op" id="1747361">.</span><span class="ident" id="1747362">readByte</span><span class="op" id="1747370">(</span><span class="op" id="1747371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1747376">if</span>&nbsp;<span class="ident" id="1747379">err</span>&nbsp;<span class="op" id="1747383">!=</span>&nbsp;<span class="builtintype" id="1747386">nil</span>&nbsp;<span class="op" id="1747390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1747396">return</span>&nbsp;<span class="builtintype" id="1747403">nil</span><span class="op" id="1747406">,</span>&nbsp;<span class="ident" id="1747408">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1747415">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1747419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747423">marker</span>&nbsp;<span class="op" id="1747430">:=</span>&nbsp;<span class="ident" id="1747433">d</span><span class="op" id="1747434">.</span><span class="ident" id="1747435">tmp</span><span class="op" id="1747438">[</span><span class="num" id="1747439">1</span><span class="op" id="1747440">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1747444">if</span>&nbsp;<span class="ident" id="1747447">marker</span>&nbsp;<span class="op" id="1747454">==</span>&nbsp;<span class="num" id="1747457">0</span>&nbsp;<span class="op" id="1747459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1747464">//&nbsp;Treat&nbsp;&#34;\xff\x00&#34;&nbsp;as&nbsp;extraneous&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1747507">continue</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1747518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1747522">for</span>&nbsp;<span class="ident" id="1747526">marker</span>&nbsp;<span class="op" id="1747533">==</span>&nbsp;<span class="num" id="1747536">0xff</span>&nbsp;<span class="op" id="1747541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1747546">//&nbsp;Section&nbsp;B.1.1.2&nbsp;says,&nbsp;&#34;Any&nbsp;marker&nbsp;may&nbsp;optionally&nbsp;be&nbsp;preceded&nbsp;by&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1747620">//&nbsp;number&nbsp;of&nbsp;fill&nbsp;bytes,&nbsp;which&nbsp;are&nbsp;bytes&nbsp;assigned&nbsp;code&nbsp;X&#39;FF&#39;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747686">marker</span><span class="op" id="1747692">,</span>&nbsp;<span class="ident" id="1747694">err</span>&nbsp;<span class="op" id="1747698">=</span>&nbsp;<span class="ident" id="1747700">d</span><span class="op" id="1747701">.</span><span class="ident" id="1747702">readByte</span><span class="op" id="1747710">(</span><span class="op" id="1747711">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1747716">if</span>&nbsp;<span class="ident" id="1747719">err</span>&nbsp;<span class="op" id="1747723">!=</span>&nbsp;<span class="builtintype" id="1747726">nil</span>&nbsp;<span class="op" id="1747730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1747736">return</span>&nbsp;<span class="builtintype" id="1747743">nil</span><span class="op" id="1747746">,</span>&nbsp;<span class="ident" id="1747748">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1747755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1747759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1747763">if</span>&nbsp;<span class="ident" id="1747766">marker</span>&nbsp;<span class="op" id="1747773">==</span>&nbsp;<span class="ident" id="1747776">eoiMarker</span>&nbsp;<span class="op" id="1747786">{</span>&nbsp;<span class="comment" id="1747788">//&nbsp;End&nbsp;Of&nbsp;Image.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1747808">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1747816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1747820">if</span>&nbsp;<span class="ident" id="1747823">rst0Marker</span>&nbsp;<span class="op" id="1747834">&lt;=</span>&nbsp;<span class="ident" id="1747837">marker</span>&nbsp;<span class="op" id="1747844">&amp;&amp;</span>&nbsp;<span class="ident" id="1747847">marker</span>&nbsp;<span class="op" id="1747854">&lt;=</span>&nbsp;<span class="ident" id="1747857">rst7Marker</span>&nbsp;<span class="op" id="1747868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1747873">//&nbsp;Figures&nbsp;B.2&nbsp;and&nbsp;B.16&nbsp;of&nbsp;the&nbsp;specification&nbsp;suggest&nbsp;that&nbsp;restart&nbsp;markers&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1747957">//&nbsp;only&nbsp;occur&nbsp;between&nbsp;Entropy&nbsp;Coded&nbsp;Segments&nbsp;and&nbsp;not&nbsp;after&nbsp;the&nbsp;final&nbsp;ECS.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1748034">//&nbsp;However,&nbsp;some&nbsp;encoders&nbsp;may&nbsp;generate&nbsp;incorrect&nbsp;JPEGs&nbsp;with&nbsp;a&nbsp;final&nbsp;restart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1748113">//&nbsp;marker.&nbsp;That&nbsp;restart&nbsp;marker&nbsp;will&nbsp;be&nbsp;seen&nbsp;here&nbsp;instead&nbsp;of&nbsp;inside&nbsp;the&nbsp;processSOS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1748198">//&nbsp;method,&nbsp;and&nbsp;is&nbsp;ignored&nbsp;as&nbsp;a&nbsp;harmless&nbsp;error.&nbsp;Restart&nbsp;markers&nbsp;have&nbsp;no&nbsp;extra&nbsp;data,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1748284">//&nbsp;so&nbsp;we&nbsp;check&nbsp;for&nbsp;this&nbsp;before&nbsp;we&nbsp;read&nbsp;the&nbsp;16-bit&nbsp;length&nbsp;of&nbsp;the&nbsp;segment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1748360">continue</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1748371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1748376">//&nbsp;Read&nbsp;the&nbsp;16-bit&nbsp;length&nbsp;of&nbsp;the&nbsp;segment.&nbsp;The&nbsp;value&nbsp;includes&nbsp;the&nbsp;2&nbsp;bytes&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1748459">//&nbsp;length&nbsp;itself,&nbsp;so&nbsp;we&nbsp;subtract&nbsp;2&nbsp;to&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;remaining&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1748534">if</span>&nbsp;<span class="ident" id="1748537">err</span>&nbsp;<span class="op" id="1748541">=</span>&nbsp;<span class="ident" id="1748543">d</span><span class="op" id="1748544">.</span><span class="ident" id="1748545">readFull</span><span class="op" id="1748553">(</span><span class="ident" id="1748554">d</span><span class="op" id="1748555">.</span><span class="ident" id="1748556">tmp</span><span class="op" id="1748559">[</span><span class="op" id="1748560">:</span><span class="num" id="1748561">2</span><span class="op" id="1748562">]</span><span class="op" id="1748563">)</span><span class="op" id="1748564">;</span>&nbsp;<span class="ident" id="1748566">err</span>&nbsp;<span class="op" id="1748570">!=</span>&nbsp;<span class="builtintype" id="1748573">nil</span>&nbsp;<span class="op" id="1748577">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1748582">return</span>&nbsp;<span class="builtintype" id="1748589">nil</span><span class="op" id="1748592">,</span>&nbsp;<span class="ident" id="1748594">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1748600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1748604">n</span>&nbsp;<span class="op" id="1748606">:=</span>&nbsp;<span class="builtintype" id="1748609">int</span><span class="op" id="1748612">(</span><span class="ident" id="1748613">d</span><span class="op" id="1748614">.</span><span class="ident" id="1748615">tmp</span><span class="op" id="1748618">[</span><span class="num" id="1748619">0</span><span class="op" id="1748620">]</span><span class="op" id="1748621">)</span><span class="op" id="1748622">&lt;&lt;</span><span class="num" id="1748624">8</span>&nbsp;<span class="op" id="1748626">+</span>&nbsp;<span class="builtintype" id="1748628">int</span><span class="op" id="1748631">(</span><span class="ident" id="1748632">d</span><span class="op" id="1748633">.</span><span class="ident" id="1748634">tmp</span><span class="op" id="1748637">[</span><span class="num" id="1748638">1</span><span class="op" id="1748639">]</span><span class="op" id="1748640">)</span>&nbsp;<span class="op" id="1748642">-</span>&nbsp;<span class="num" id="1748644">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1748648">if</span>&nbsp;<span class="ident" id="1748651">n</span>&nbsp;<span class="op" id="1748653">&lt;</span>&nbsp;<span class="num" id="1748655">0</span>&nbsp;<span class="op" id="1748657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1748662">return</span>&nbsp;<span class="builtintype" id="1748669">nil</span><span class="op" id="1748672">,</span>&nbsp;<span class="ident" id="1748674">FormatError</span><span class="op" id="1748685">(</span><span class="string" id="1748686">&#34;short&nbsp;segment&nbsp;length&#34;</span><span class="op" id="1748708">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1748712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1748717">switch</span>&nbsp;<span class="op" id="1748724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1748728">case</span>&nbsp;<span class="ident" id="1748733">marker</span>&nbsp;<span class="op" id="1748740">==</span>&nbsp;<span class="ident" id="1748743">sof0Marker</span>&nbsp;<span class="op" id="1748754">||</span>&nbsp;<span class="ident" id="1748757">marker</span>&nbsp;<span class="op" id="1748764">==</span>&nbsp;<span class="ident" id="1748767">sof2Marker</span><span class="op" id="1748777">:</span>&nbsp;<span class="comment" id="1748779">//&nbsp;Start&nbsp;Of&nbsp;Frame.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1748801">d</span><span class="op" id="1748802">.</span><span class="ident" id="1748803">progressive</span>&nbsp;<span class="op" id="1748815">=</span>&nbsp;<span class="ident" id="1748817">marker</span>&nbsp;<span class="op" id="1748824">==</span>&nbsp;<span class="ident" id="1748827">sof2Marker</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1748841">err</span>&nbsp;<span class="op" id="1748845">=</span>&nbsp;<span class="ident" id="1748847">d</span><span class="op" id="1748848">.</span><span class="ident" id="1748849">processSOF</span><span class="op" id="1748859">(</span><span class="ident" id="1748860">n</span><span class="op" id="1748861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1748866">if</span>&nbsp;<span class="ident" id="1748869">configOnly</span>&nbsp;<span class="op" id="1748880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1748886">return</span>&nbsp;<span class="builtintype" id="1748893">nil</span><span class="op" id="1748896">,</span>&nbsp;<span class="ident" id="1748898">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1748905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1748909">case</span>&nbsp;<span class="ident" id="1748914">marker</span>&nbsp;<span class="op" id="1748921">==</span>&nbsp;<span class="ident" id="1748924">dhtMarker</span><span class="op" id="1748933">:</span>&nbsp;<span class="comment" id="1748935">//&nbsp;Define&nbsp;Huffman&nbsp;Table.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1748963">err</span>&nbsp;<span class="op" id="1748967">=</span>&nbsp;<span class="ident" id="1748969">d</span><span class="op" id="1748970">.</span><span class="ident" id="1748971">processDHT</span><span class="op" id="1748981">(</span><span class="ident" id="1748982">n</span><span class="op" id="1748983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1748987">case</span>&nbsp;<span class="ident" id="1748992">marker</span>&nbsp;<span class="op" id="1748999">==</span>&nbsp;<span class="ident" id="1749002">dqtMarker</span><span class="op" id="1749011">:</span>&nbsp;<span class="comment" id="1749013">//&nbsp;Define&nbsp;Quantization&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1749046">err</span>&nbsp;<span class="op" id="1749050">=</span>&nbsp;<span class="ident" id="1749052">d</span><span class="op" id="1749053">.</span><span class="ident" id="1749054">processDQT</span><span class="op" id="1749064">(</span><span class="ident" id="1749065">n</span><span class="op" id="1749066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1749070">case</span>&nbsp;<span class="ident" id="1749075">marker</span>&nbsp;<span class="op" id="1749082">==</span>&nbsp;<span class="ident" id="1749085">sosMarker</span><span class="op" id="1749094">:</span>&nbsp;<span class="comment" id="1749096">//&nbsp;Start&nbsp;Of&nbsp;Scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1749117">err</span>&nbsp;<span class="op" id="1749121">=</span>&nbsp;<span class="ident" id="1749123">d</span><span class="op" id="1749124">.</span><span class="ident" id="1749125">processSOS</span><span class="op" id="1749135">(</span><span class="ident" id="1749136">n</span><span class="op" id="1749137">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1749141">case</span>&nbsp;<span class="ident" id="1749146">marker</span>&nbsp;<span class="op" id="1749153">==</span>&nbsp;<span class="ident" id="1749156">driMarker</span><span class="op" id="1749165">:</span>&nbsp;<span class="comment" id="1749167">//&nbsp;Define&nbsp;Restart&nbsp;Interval.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1749198">err</span>&nbsp;<span class="op" id="1749202">=</span>&nbsp;<span class="ident" id="1749204">d</span><span class="op" id="1749205">.</span><span class="ident" id="1749206">processDRI</span><span class="op" id="1749216">(</span><span class="ident" id="1749217">n</span><span class="op" id="1749218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1749222">case</span>&nbsp;<span class="ident" id="1749227">app0Marker</span>&nbsp;<span class="op" id="1749238">&lt;=</span>&nbsp;<span class="ident" id="1749241">marker</span>&nbsp;<span class="op" id="1749248">&amp;&amp;</span>&nbsp;<span class="ident" id="1749251">marker</span>&nbsp;<span class="op" id="1749258">&lt;=</span>&nbsp;<span class="ident" id="1749261">app15Marker</span>&nbsp;<span class="op" id="1749273">||</span>&nbsp;<span class="ident" id="1749276">marker</span>&nbsp;<span class="op" id="1749283">==</span>&nbsp;<span class="ident" id="1749286">comMarker</span><span class="op" id="1749295">:</span>&nbsp;<span class="comment" id="1749297">//&nbsp;APPlication&nbsp;specific,&nbsp;or&nbsp;COMment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1749337">err</span>&nbsp;<span class="op" id="1749341">=</span>&nbsp;<span class="ident" id="1749343">d</span><span class="op" id="1749344">.</span><span class="ident" id="1749345">ignore</span><span class="op" id="1749351">(</span><span class="ident" id="1749352">n</span><span class="op" id="1749353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1749357">default</span><span class="op" id="1749364">:</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1749369">err</span>&nbsp;<span class="op" id="1749373">=</span>&nbsp;<span class="ident" id="1749375">UnsupportedError</span><span class="op" id="1749391">(</span><span class="string" id="1749392">&#34;unknown&nbsp;marker&#34;</span><span class="op" id="1749408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1749412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1749416">if</span>&nbsp;<span class="ident" id="1749419">err</span>&nbsp;<span class="op" id="1749423">!=</span>&nbsp;<span class="builtintype" id="1749426">nil</span>&nbsp;<span class="op" id="1749430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1749435">return</span>&nbsp;<span class="builtintype" id="1749442">nil</span><span class="op" id="1749445">,</span>&nbsp;<span class="ident" id="1749447">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1749453">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1749456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1749459">if</span>&nbsp;<span class="ident" id="1749462">d</span><span class="op" id="1749463">.</span><span class="ident" id="1749464">img1</span>&nbsp;<span class="op" id="1749469">!=</span>&nbsp;<span class="builtintype" id="1749472">nil</span>&nbsp;<span class="op" id="1749476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1749480">return</span>&nbsp;<span class="ident" id="1749487">d</span><span class="op" id="1749488">.</span><span class="ident" id="1749489">img1</span><span class="op" id="1749493">,</span>&nbsp;<span class="builtintype" id="1749495">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1749500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1749503">if</span>&nbsp;<span class="ident" id="1749506">d</span><span class="op" id="1749507">.</span><span class="ident" id="1749508">img3</span>&nbsp;<span class="op" id="1749513">!=</span>&nbsp;<span class="builtintype" id="1749516">nil</span>&nbsp;<span class="op" id="1749520">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1749524">return</span>&nbsp;<span class="ident" id="1749531">d</span><span class="op" id="1749532">.</span><span class="ident" id="1749533">img3</span><span class="op" id="1749537">,</span>&nbsp;<span class="builtintype" id="1749539">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1749544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1749547">return</span>&nbsp;<span class="builtintype" id="1749554">nil</span><span class="op" id="1749557">,</span>&nbsp;<span class="ident" id="1749559">FormatError</span><span class="op" id="1749570">(</span><span class="string" id="1749571">&#34;missing&nbsp;SOS&nbsp;marker&#34;</span><span class="op" id="1749591">)</span><br>
<span class="lineno"></span><span class="op" id="1749593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="1749596">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="1749666">func</span>&nbsp;<span class="ident" id="1749671">Decode</span><span class="op" id="1749677">(</span><span class="ident" id="1749678">r</span>&nbsp;<span class="ident" id="1749680">io</span><span class="op" id="1749682">.</span><span class="ident" id="1749683">Reader</span><span class="op" id="1749689">)</span>&nbsp;<span class="op" id="1749691">(</span><span class="ident" id="1749692">image</span><span class="op" id="1749697">.</span><span class="ident" id="1749698">Image</span><span class="op" id="1749703">,</span>&nbsp;<span class="builtintype" id="1749705">error</span><span class="op" id="1749710">)</span>&nbsp;<span class="op" id="1749712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1749715">var</span>&nbsp;<span class="ident" id="1749719">d</span>&nbsp;<span class="ident" id="1749721">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1749730">return</span>&nbsp;<span class="ident" id="1749737">d</span><span class="op" id="1749738">.</span><span class="ident" id="1749739">decode</span><span class="op" id="1749745">(</span><span class="ident" id="1749746">r</span><span class="op" id="1749747">,</span>&nbsp;<span class="builtintype" id="1749749">false</span><span class="op" id="1749754">)</span><br>
<span class="lineno"></span><span class="op" id="1749756">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="1749759">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="1749838">//&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="1749868">func</span>&nbsp;<span class="ident" id="1749873">DecodeConfig</span><span class="op" id="1749885">(</span><span class="ident" id="1749886">r</span>&nbsp;<span class="ident" id="1749888">io</span><span class="op" id="1749890">.</span><span class="ident" id="1749891">Reader</span><span class="op" id="1749897">)</span>&nbsp;<span class="op" id="1749899">(</span><span class="ident" id="1749900">image</span><span class="op" id="1749905">.</span><span class="ident" id="1749906">Config</span><span class="op" id="1749912">,</span>&nbsp;<span class="builtintype" id="1749914">error</span><span class="op" id="1749919">)</span>&nbsp;<span class="op" id="1749921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1749924">var</span>&nbsp;<span class="ident" id="1749928">d</span>&nbsp;<span class="ident" id="1749930">decoder</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1749939">if</span>&nbsp;<span class="ident" id="1749942">_</span><span class="op" id="1749943">,</span>&nbsp;<span class="ident" id="1749945">err</span>&nbsp;<span class="op" id="1749949">:=</span>&nbsp;<span class="ident" id="1749952">d</span><span class="op" id="1749953">.</span><span class="ident" id="1749954">decode</span><span class="op" id="1749960">(</span><span class="ident" id="1749961">r</span><span class="op" id="1749962">,</span>&nbsp;<span class="builtintype" id="1749964">true</span><span class="op" id="1749968">)</span><span class="op" id="1749969">;</span>&nbsp;<span class="ident" id="1749971">err</span>&nbsp;<span class="op" id="1749975">!=</span>&nbsp;<span class="builtintype" id="1749978">nil</span>&nbsp;<span class="op" id="1749982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1749986">return</span>&nbsp;<span class="ident" id="1749993">image</span><span class="op" id="1749998">.</span><span class="ident" id="1749999">Config</span><span class="op" id="1750005">{</span><span class="op" id="1750006">}</span><span class="op" id="1750007">,</span>&nbsp;<span class="ident" id="1750009">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1750014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1750017">switch</span>&nbsp;<span class="ident" id="1750024">d</span><span class="op" id="1750025">.</span><span class="ident" id="1750026">nComp</span>&nbsp;<span class="op" id="1750032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1750035">case</span>&nbsp;<span class="ident" id="1750040">nGrayComponent</span><span class="op" id="1750054">:</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1750058">return</span>&nbsp;<span class="ident" id="1750065">image</span><span class="op" id="1750070">.</span><span class="ident" id="1750071">Config</span><span class="op" id="1750077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1750082">ColorModel</span><span class="op" id="1750092">:</span>&nbsp;<span class="ident" id="1750094">color</span><span class="op" id="1750099">.</span><span class="ident" id="1750100">GrayModel</span><span class="op" id="1750109">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1750114">Width</span><span class="op" id="1750119">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1750126">d</span><span class="op" id="1750127">.</span><span class="ident" id="1750128">width</span><span class="op" id="1750133">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1750138">Height</span><span class="op" id="1750144">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1750150">d</span><span class="op" id="1750151">.</span><span class="ident" id="1750152">height</span><span class="op" id="1750158">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1750162">}</span><span class="op" id="1750163">,</span>&nbsp;<span class="builtintype" id="1750165">nil</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1750170">case</span>&nbsp;<span class="ident" id="1750175">nColorComponent</span><span class="op" id="1750190">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1750194">return</span>&nbsp;<span class="ident" id="1750201">image</span><span class="op" id="1750206">.</span><span class="ident" id="1750207">Config</span><span class="op" id="1750213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1750218">ColorModel</span><span class="op" id="1750228">:</span>&nbsp;<span class="ident" id="1750230">color</span><span class="op" id="1750235">.</span><span class="ident" id="1750236">YCbCrModel</span><span class="op" id="1750246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1750251">Width</span><span class="op" id="1750256">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1750263">d</span><span class="op" id="1750264">.</span><span class="ident" id="1750265">width</span><span class="op" id="1750270">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1750275">Height</span><span class="op" id="1750281">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1750287">d</span><span class="op" id="1750288">.</span><span class="ident" id="1750289">height</span><span class="op" id="1750295">,</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1750299">}</span><span class="op" id="1750300">,</span>&nbsp;<span class="builtintype" id="1750302">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1750307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1750310">return</span>&nbsp;<span class="ident" id="1750317">image</span><span class="op" id="1750322">.</span><span class="ident" id="1750323">Config</span><span class="op" id="1750329">{</span><span class="op" id="1750330">}</span><span class="op" id="1750331">,</span>&nbsp;<span class="ident" id="1750333">FormatError</span><span class="op" id="1750344">(</span><span class="string" id="1750345">&#34;missing&nbsp;SOF&nbsp;marker&#34;</span><span class="op" id="1750365">)</span><br>
<span class="lineno"></span><span class="op" id="1750367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="keyword" id="1750370">func</span>&nbsp;<span class="ident" id="1750375">init</span><span class="op" id="1750379">(</span><span class="op" id="1750380">)</span>&nbsp;<span class="op" id="1750382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1750385">image</span><span class="op" id="1750390">.</span><span class="ident" id="1750391">RegisterFormat</span><span class="op" id="1750405">(</span><span class="string" id="1750406">&#34;jpeg&#34;</span><span class="op" id="1750412">,</span>&nbsp;<span class="string" id="1750414">&#34;\xff\xd8&#34;</span><span class="op" id="1750424">,</span>&nbsp;<span class="ident" id="1750426">Decode</span><span class="op" id="1750432">,</span>&nbsp;<span class="ident" id="1750434">DecodeConfig</span><span class="op" id="1750446">)</span><br>
<span class="lineno"></span><span class="op" id="1750448">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
