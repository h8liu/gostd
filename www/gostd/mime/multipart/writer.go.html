<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5249528">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5249583">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5249637">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5249688">package</span>&nbsp;<span class="ident" id="5249696">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5249707">import</span>&nbsp;<span class="op" id="5249714">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5249717">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5249726">&#34;crypto/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5249741">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5249751">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5249758">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5249764">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5249781">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="5249791">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5249794">//&nbsp;A&nbsp;Writer&nbsp;generates&nbsp;multipart&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="5249836">type</span>&nbsp;<span class="ident" id="5249841">Writer</span>&nbsp;<span class="keyword" id="5249848">struct</span>&nbsp;<span class="op" id="5249855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249858">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5249867">io</span><span class="op" id="5249869">.</span><span class="ident" id="5249870">Writer</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249878">boundary</span>&nbsp;<span class="builtintype" id="5249887">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249895">lastpart</span>&nbsp;<span class="op" id="5249904">*</span><span class="ident" id="5249905">part</span><br>
<span class="lineno"></span><span class="op" id="5249910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5249913">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;multipart&nbsp;Writer&nbsp;with&nbsp;a&nbsp;random&nbsp;boundary,</span><br>
<span class="lineno">25</span><span class="comment" id="5249981">//&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5249998">func</span>&nbsp;<span class="ident" id="5250003">NewWriter</span><span class="op" id="5250012">(</span><span class="ident" id="5250013">w</span>&nbsp;<span class="ident" id="5250015">io</span><span class="op" id="5250017">.</span><span class="ident" id="5250018">Writer</span><span class="op" id="5250024">)</span>&nbsp;<span class="op" id="5250026">*</span><span class="ident" id="5250027">Writer</span>&nbsp;<span class="op" id="5250034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250037">return</span>&nbsp;<span class="op" id="5250044">&amp;</span><span class="ident" id="5250045">Writer</span><span class="op" id="5250051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5250055">w</span><span class="op" id="5250056">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5250065">w</span><span class="op" id="5250066">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5250070">boundary</span><span class="op" id="5250078">:</span>&nbsp;<span class="ident" id="5250080">randomBoundary</span><span class="op" id="5250094">(</span><span class="op" id="5250095">)</span><span class="op" id="5250096">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5250099">}</span><br>
<span class="lineno"></span><span class="op" id="5250101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5250104">//&nbsp;Boundary&nbsp;returns&nbsp;the&nbsp;Writer&#39;s&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="5250147">func</span>&nbsp;<span class="op" id="5250152">(</span><span class="ident" id="5250153">w</span>&nbsp;<span class="op" id="5250155">*</span><span class="ident" id="5250156">Writer</span><span class="op" id="5250162">)</span>&nbsp;<span class="ident" id="5250164">Boundary</span><span class="op" id="5250172">(</span><span class="op" id="5250173">)</span>&nbsp;<span class="builtintype" id="5250175">string</span>&nbsp;<span class="op" id="5250182">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250185">return</span>&nbsp;<span class="ident" id="5250192">w</span><span class="op" id="5250193">.</span><span class="ident" id="5250194">boundary</span><br>
<span class="lineno"></span><span class="op" id="5250203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5250206">//&nbsp;SetBoundary&nbsp;overrides&nbsp;the&nbsp;Writer&#39;s&nbsp;default&nbsp;randomly-generated</span><br>
<span class="lineno"></span><span class="comment" id="5250271">//&nbsp;boundary&nbsp;separator&nbsp;with&nbsp;an&nbsp;explicit&nbsp;value.</span><br>
<span class="lineno">40</span><span class="comment" id="5250317">//</span><br>
<span class="lineno"></span><span class="comment" id="5250320">//&nbsp;SetBoundary&nbsp;must&nbsp;be&nbsp;called&nbsp;before&nbsp;any&nbsp;parts&nbsp;are&nbsp;created,&nbsp;may&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="5250389">//&nbsp;contain&nbsp;certain&nbsp;ASCII&nbsp;characters,&nbsp;and&nbsp;must&nbsp;be&nbsp;1-69&nbsp;bytes&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="5250455">func</span>&nbsp;<span class="op" id="5250460">(</span><span class="ident" id="5250461">w</span>&nbsp;<span class="op" id="5250463">*</span><span class="ident" id="5250464">Writer</span><span class="op" id="5250470">)</span>&nbsp;<span class="ident" id="5250472">SetBoundary</span><span class="op" id="5250483">(</span><span class="ident" id="5250484">boundary</span>&nbsp;<span class="builtintype" id="5250493">string</span><span class="op" id="5250499">)</span>&nbsp;<span class="builtintype" id="5250501">error</span>&nbsp;<span class="op" id="5250507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250510">if</span>&nbsp;<span class="ident" id="5250513">w</span><span class="op" id="5250514">.</span><span class="ident" id="5250515">lastpart</span>&nbsp;<span class="op" id="5250524">!=</span>&nbsp;<span class="ident" id="5250527">nil</span>&nbsp;<span class="op" id="5250531">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250535">return</span>&nbsp;<span class="ident" id="5250542">errors</span><span class="op" id="5250548">.</span><span class="ident" id="5250549">New</span><span class="op" id="5250552">(</span><span class="string" id="5250553">&#34;mime:&nbsp;SetBoundary&nbsp;called&nbsp;after&nbsp;write&#34;</span><span class="op" id="5250591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5250594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5250597">//&nbsp;rfc2046#section-5.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250623">if</span>&nbsp;<span class="builtinfunc" id="5250626">len</span><span class="op" id="5250629">(</span><span class="ident" id="5250630">boundary</span><span class="op" id="5250638">)</span>&nbsp;<span class="op" id="5250640">&lt;</span>&nbsp;<span class="num" id="5250642">1</span>&nbsp;<span class="op" id="5250644">||</span>&nbsp;<span class="builtinfunc" id="5250647">len</span><span class="op" id="5250650">(</span><span class="ident" id="5250651">boundary</span><span class="op" id="5250659">)</span>&nbsp;<span class="op" id="5250661">&gt;</span>&nbsp;<span class="num" id="5250663">69</span>&nbsp;<span class="op" id="5250666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250670">return</span>&nbsp;<span class="ident" id="5250677">errors</span><span class="op" id="5250683">.</span><span class="ident" id="5250684">New</span><span class="op" id="5250687">(</span><span class="string" id="5250688">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;length&#34;</span><span class="op" id="5250719">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5250722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250725">for</span>&nbsp;<span class="ident" id="5250729">_</span><span class="op" id="5250730">,</span>&nbsp;<span class="ident" id="5250732">b</span>&nbsp;<span class="op" id="5250734">:=</span>&nbsp;<span class="keyword" id="5250737">range</span>&nbsp;<span class="ident" id="5250743">boundary</span>&nbsp;<span class="op" id="5250752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250756">if</span>&nbsp;<span class="string" id="5250759">&#39;A&#39;</span>&nbsp;<span class="op" id="5250763">&lt;=</span>&nbsp;<span class="ident" id="5250766">b</span>&nbsp;<span class="op" id="5250768">&amp;&amp;</span>&nbsp;<span class="ident" id="5250771">b</span>&nbsp;<span class="op" id="5250773">&lt;=</span>&nbsp;<span class="string" id="5250776">&#39;Z&#39;</span>&nbsp;<span class="op" id="5250780">||</span>&nbsp;<span class="string" id="5250783">&#39;a&#39;</span>&nbsp;<span class="op" id="5250787">&lt;=</span>&nbsp;<span class="ident" id="5250790">b</span>&nbsp;<span class="op" id="5250792">&amp;&amp;</span>&nbsp;<span class="ident" id="5250795">b</span>&nbsp;<span class="op" id="5250797">&lt;=</span>&nbsp;<span class="string" id="5250800">&#39;z&#39;</span>&nbsp;<span class="op" id="5250804">||</span>&nbsp;<span class="string" id="5250807">&#39;0&#39;</span>&nbsp;<span class="op" id="5250811">&lt;=</span>&nbsp;<span class="ident" id="5250814">b</span>&nbsp;<span class="op" id="5250816">&amp;&amp;</span>&nbsp;<span class="ident" id="5250819">b</span>&nbsp;<span class="op" id="5250821">&lt;=</span>&nbsp;<span class="string" id="5250824">&#39;9&#39;</span>&nbsp;<span class="op" id="5250828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250833">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5250844">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250848">switch</span>&nbsp;<span class="ident" id="5250855">b</span>&nbsp;<span class="op" id="5250857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250861">case</span>&nbsp;<span class="string" id="5250866">&#39;\&#39;&#39;</span><span class="op" id="5250870">,</span>&nbsp;<span class="string" id="5250872">&#39;(&#39;</span><span class="op" id="5250875">,</span>&nbsp;<span class="string" id="5250877">&#39;)&#39;</span><span class="op" id="5250880">,</span>&nbsp;<span class="string" id="5250882">&#39;+&#39;</span><span class="op" id="5250885">,</span>&nbsp;<span class="string" id="5250887">&#39;_&#39;</span><span class="op" id="5250890">,</span>&nbsp;<span class="string" id="5250892">&#39;,&#39;</span><span class="op" id="5250895">,</span>&nbsp;<span class="string" id="5250897">&#39;-&#39;</span><span class="op" id="5250900">,</span>&nbsp;<span class="string" id="5250902">&#39;.&#39;</span><span class="op" id="5250905">,</span>&nbsp;<span class="string" id="5250907">&#39;/&#39;</span><span class="op" id="5250910">,</span>&nbsp;<span class="string" id="5250912">&#39;:&#39;</span><span class="op" id="5250915">,</span>&nbsp;<span class="string" id="5250917">&#39;=&#39;</span><span class="op" id="5250920">,</span>&nbsp;<span class="string" id="5250922">&#39;?&#39;</span><span class="op" id="5250925">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250930">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5250941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5250945">return</span>&nbsp;<span class="ident" id="5250952">errors</span><span class="op" id="5250958">.</span><span class="ident" id="5250959">New</span><span class="op" id="5250962">(</span><span class="string" id="5250963">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;character&#34;</span><span class="op" id="5250997">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5251000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5251003">w</span><span class="op" id="5251004">.</span><span class="ident" id="5251005">boundary</span>&nbsp;<span class="op" id="5251014">=</span>&nbsp;<span class="ident" id="5251016">boundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5251026">return</span>&nbsp;<span class="ident" id="5251033">nil</span><br>
<span class="lineno"></span><span class="op" id="5251037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="5251040">//&nbsp;FormDataContentType&nbsp;returns&nbsp;the&nbsp;Content-Type&nbsp;for&nbsp;an&nbsp;HTTP</span><br>
<span class="lineno"></span><span class="comment" id="5251100">//&nbsp;multipart/form-data&nbsp;with&nbsp;this&nbsp;Writer&#39;s&nbsp;Boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="5251152">func</span>&nbsp;<span class="op" id="5251157">(</span><span class="ident" id="5251158">w</span>&nbsp;<span class="op" id="5251160">*</span><span class="ident" id="5251161">Writer</span><span class="op" id="5251167">)</span>&nbsp;<span class="ident" id="5251169">FormDataContentType</span><span class="op" id="5251188">(</span><span class="op" id="5251189">)</span>&nbsp;<span class="builtintype" id="5251191">string</span>&nbsp;<span class="op" id="5251198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5251201">return</span>&nbsp;<span class="string" id="5251208">&#34;multipart/form-data;&nbsp;boundary=&#34;</span>&nbsp;<span class="op" id="5251241">+</span>&nbsp;<span class="ident" id="5251243">w</span><span class="op" id="5251244">.</span><span class="ident" id="5251245">boundary</span><br>
<span class="lineno"></span><span class="op" id="5251254">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="5251257">func</span>&nbsp;<span class="ident" id="5251262">randomBoundary</span><span class="op" id="5251276">(</span><span class="op" id="5251277">)</span>&nbsp;<span class="builtintype" id="5251279">string</span>&nbsp;<span class="op" id="5251286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5251289">var</span>&nbsp;<span class="ident" id="5251293">buf</span>&nbsp;<span class="op" id="5251297">[</span><span class="num" id="5251298">30</span><span class="op" id="5251300">]</span><span class="builtintype" id="5251301">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5251307">_</span><span class="op" id="5251308">,</span>&nbsp;<span class="ident" id="5251310">err</span>&nbsp;<span class="op" id="5251314">:=</span>&nbsp;<span class="ident" id="5251317">io</span><span class="op" id="5251319">.</span><span class="ident" id="5251320">ReadFull</span><span class="op" id="5251328">(</span><span class="ident" id="5251329">rand</span><span class="op" id="5251333">.</span><span class="ident" id="5251334">Reader</span><span class="op" id="5251340">,</span>&nbsp;<span class="ident" id="5251342">buf</span><span class="op" id="5251345">[</span><span class="op" id="5251346">:</span><span class="op" id="5251347">]</span><span class="op" id="5251348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5251351">if</span>&nbsp;<span class="ident" id="5251354">err</span>&nbsp;<span class="op" id="5251358">!=</span>&nbsp;<span class="ident" id="5251361">nil</span>&nbsp;<span class="op" id="5251365">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5251369">panic</span><span class="op" id="5251374">(</span><span class="ident" id="5251375">err</span><span class="op" id="5251378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5251381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5251384">return</span>&nbsp;<span class="ident" id="5251391">fmt</span><span class="op" id="5251394">.</span><span class="ident" id="5251395">Sprintf</span><span class="op" id="5251402">(</span><span class="string" id="5251403">&#34;%x&#34;</span><span class="op" id="5251407">,</span>&nbsp;<span class="ident" id="5251409">buf</span><span class="op" id="5251412">[</span><span class="op" id="5251413">:</span><span class="op" id="5251414">]</span><span class="op" id="5251415">)</span><br>
<span class="lineno"></span><span class="op" id="5251417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="5251420">//&nbsp;CreatePart&nbsp;creates&nbsp;a&nbsp;new&nbsp;multipart&nbsp;section&nbsp;with&nbsp;the&nbsp;provided</span><br>
<span class="lineno"></span><span class="comment" id="5251484">//&nbsp;header.&nbsp;The&nbsp;body&nbsp;of&nbsp;the&nbsp;part&nbsp;should&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="5251550">//&nbsp;Writer.&nbsp;After&nbsp;calling&nbsp;CreatePart,&nbsp;any&nbsp;previous&nbsp;part&nbsp;may&nbsp;no&nbsp;longer</span><br>
<span class="lineno"></span><span class="comment" id="5251619">//&nbsp;be&nbsp;written&nbsp;to.</span><br>
<span class="lineno"></span><span class="keyword" id="5251637">func</span>&nbsp;<span class="op" id="5251642">(</span><span class="ident" id="5251643">w</span>&nbsp;<span class="op" id="5251645">*</span><span class="ident" id="5251646">Writer</span><span class="op" id="5251652">)</span>&nbsp;<span class="ident" id="5251654">CreatePart</span><span class="op" id="5251664">(</span><span class="ident" id="5251665">header</span>&nbsp;<span class="ident" id="5251672">textproto</span><span class="op" id="5251681">.</span><span class="ident" id="5251682">MIMEHeader</span><span class="op" id="5251692">)</span>&nbsp;<span class="op" id="5251694">(</span><span class="ident" id="5251695">io</span><span class="op" id="5251697">.</span><span class="ident" id="5251698">Writer</span><span class="op" id="5251704">,</span>&nbsp;<span class="builtintype" id="5251706">error</span><span class="op" id="5251711">)</span>&nbsp;<span class="op" id="5251713">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5251716">if</span>&nbsp;<span class="ident" id="5251719">w</span><span class="op" id="5251720">.</span><span class="ident" id="5251721">lastpart</span>&nbsp;<span class="op" id="5251730">!=</span>&nbsp;<span class="ident" id="5251733">nil</span>&nbsp;<span class="op" id="5251737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5251741">if</span>&nbsp;<span class="ident" id="5251744">err</span>&nbsp;<span class="op" id="5251748">:=</span>&nbsp;<span class="ident" id="5251751">w</span><span class="op" id="5251752">.</span><span class="ident" id="5251753">lastpart</span><span class="op" id="5251761">.</span><span class="builtinfunc" id="5251762">close</span><span class="op" id="5251767">(</span><span class="op" id="5251768">)</span><span class="op" id="5251769">;</span>&nbsp;<span class="ident" id="5251771">err</span>&nbsp;<span class="op" id="5251775">!=</span>&nbsp;<span class="ident" id="5251778">nil</span>&nbsp;<span class="op" id="5251782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5251787">return</span>&nbsp;<span class="ident" id="5251794">nil</span><span class="op" id="5251797">,</span>&nbsp;<span class="ident" id="5251799">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5251805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5251808">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5251811">var</span>&nbsp;<span class="ident" id="5251815">b</span>&nbsp;<span class="ident" id="5251817">bytes</span><span class="op" id="5251822">.</span><span class="ident" id="5251823">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5251831">if</span>&nbsp;<span class="ident" id="5251834">w</span><span class="op" id="5251835">.</span><span class="ident" id="5251836">lastpart</span>&nbsp;<span class="op" id="5251845">!=</span>&nbsp;<span class="ident" id="5251848">nil</span>&nbsp;<span class="op" id="5251852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5251856">fmt</span><span class="op" id="5251859">.</span><span class="ident" id="5251860">Fprintf</span><span class="op" id="5251867">(</span><span class="op" id="5251868">&amp;</span><span class="ident" id="5251869">b</span><span class="op" id="5251870">,</span>&nbsp;<span class="string" id="5251872">&#34;\r\n--%s\r\n&#34;</span><span class="op" id="5251886">,</span>&nbsp;<span class="ident" id="5251888">w</span><span class="op" id="5251889">.</span><span class="ident" id="5251890">boundary</span><span class="op" id="5251898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5251901">}</span>&nbsp;<span class="keyword" id="5251903">else</span>&nbsp;<span class="op" id="5251908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5251912">fmt</span><span class="op" id="5251915">.</span><span class="ident" id="5251916">Fprintf</span><span class="op" id="5251923">(</span><span class="op" id="5251924">&amp;</span><span class="ident" id="5251925">b</span><span class="op" id="5251926">,</span>&nbsp;<span class="string" id="5251928">&#34;--%s\r\n&#34;</span><span class="op" id="5251938">,</span>&nbsp;<span class="ident" id="5251940">w</span><span class="op" id="5251941">.</span><span class="ident" id="5251942">boundary</span><span class="op" id="5251950">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5251953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5251956">//&nbsp;TODO(bradfitz):&nbsp;move&nbsp;this&nbsp;to&nbsp;textproto.MimeHeader.Write(w),&nbsp;have&nbsp;it&nbsp;sort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5252033">//&nbsp;and&nbsp;clean,&nbsp;like&nbsp;http.Header.Write(w)&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5252080">for</span>&nbsp;<span class="ident" id="5252084">k</span><span class="op" id="5252085">,</span>&nbsp;<span class="ident" id="5252087">vv</span>&nbsp;<span class="op" id="5252090">:=</span>&nbsp;<span class="keyword" id="5252093">range</span>&nbsp;<span class="ident" id="5252099">header</span>&nbsp;<span class="op" id="5252106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5252110">for</span>&nbsp;<span class="ident" id="5252114">_</span><span class="op" id="5252115">,</span>&nbsp;<span class="ident" id="5252117">v</span>&nbsp;<span class="op" id="5252119">:=</span>&nbsp;<span class="keyword" id="5252122">range</span>&nbsp;<span class="ident" id="5252128">vv</span>&nbsp;<span class="op" id="5252131">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252136">fmt</span><span class="op" id="5252139">.</span><span class="ident" id="5252140">Fprintf</span><span class="op" id="5252147">(</span><span class="op" id="5252148">&amp;</span><span class="ident" id="5252149">b</span><span class="op" id="5252150">,</span>&nbsp;<span class="string" id="5252152">&#34;%s:&nbsp;%s\r\n&#34;</span><span class="op" id="5252164">,</span>&nbsp;<span class="ident" id="5252166">k</span><span class="op" id="5252167">,</span>&nbsp;<span class="ident" id="5252169">v</span><span class="op" id="5252170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5252174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5252177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252180">fmt</span><span class="op" id="5252183">.</span><span class="ident" id="5252184">Fprintf</span><span class="op" id="5252191">(</span><span class="op" id="5252192">&amp;</span><span class="ident" id="5252193">b</span><span class="op" id="5252194">,</span>&nbsp;<span class="string" id="5252196">&#34;\r\n&#34;</span><span class="op" id="5252202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252205">_</span><span class="op" id="5252206">,</span>&nbsp;<span class="ident" id="5252208">err</span>&nbsp;<span class="op" id="5252212">:=</span>&nbsp;<span class="ident" id="5252215">io</span><span class="op" id="5252217">.</span><span class="ident" id="5252218">Copy</span><span class="op" id="5252222">(</span><span class="ident" id="5252223">w</span><span class="op" id="5252224">.</span><span class="ident" id="5252225">w</span><span class="op" id="5252226">,</span>&nbsp;<span class="op" id="5252228">&amp;</span><span class="ident" id="5252229">b</span><span class="op" id="5252230">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5252233">if</span>&nbsp;<span class="ident" id="5252236">err</span>&nbsp;<span class="op" id="5252240">!=</span>&nbsp;<span class="ident" id="5252243">nil</span>&nbsp;<span class="op" id="5252247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5252251">return</span>&nbsp;<span class="ident" id="5252258">nil</span><span class="op" id="5252261">,</span>&nbsp;<span class="ident" id="5252263">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5252268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252271">p</span>&nbsp;<span class="op" id="5252273">:=</span>&nbsp;<span class="op" id="5252276">&amp;</span><span class="ident" id="5252277">part</span><span class="op" id="5252281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252285">mw</span><span class="op" id="5252287">:</span>&nbsp;<span class="ident" id="5252289">w</span><span class="op" id="5252290">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5252293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252296">w</span><span class="op" id="5252297">.</span><span class="ident" id="5252298">lastpart</span>&nbsp;<span class="op" id="5252307">=</span>&nbsp;<span class="ident" id="5252309">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5252312">return</span>&nbsp;<span class="ident" id="5252319">p</span><span class="op" id="5252320">,</span>&nbsp;<span class="ident" id="5252322">nil</span><br>
<span class="lineno"></span><span class="op" id="5252326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="5252329">var</span>&nbsp;<span class="ident" id="5252333">quoteEscaper</span>&nbsp;<span class="op" id="5252346">=</span>&nbsp;<span class="ident" id="5252348">strings</span><span class="op" id="5252355">.</span><span class="ident" id="5252356">NewReplacer</span><span class="op" id="5252367">(</span><span class="string" id="5252368">&#34;\\&#34;</span><span class="op" id="5252372">,</span>&nbsp;<span class="string" id="5252374">&#34;\\\\&#34;</span><span class="op" id="5252380">,</span>&nbsp;<span class="string" id="5252382">`&#34;`</span><span class="op" id="5252385">,</span>&nbsp;<span class="string" id="5252387">&#34;\\\&#34;&#34;</span><span class="op" id="5252393">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5252396">func</span>&nbsp;<span class="ident" id="5252401">escapeQuotes</span><span class="op" id="5252413">(</span><span class="ident" id="5252414">s</span>&nbsp;<span class="builtintype" id="5252416">string</span><span class="op" id="5252422">)</span>&nbsp;<span class="builtintype" id="5252424">string</span>&nbsp;<span class="op" id="5252431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5252434">return</span>&nbsp;<span class="ident" id="5252441">quoteEscaper</span><span class="op" id="5252453">.</span><span class="ident" id="5252454">Replace</span><span class="op" id="5252461">(</span><span class="ident" id="5252462">s</span><span class="op" id="5252463">)</span><br>
<span class="lineno"></span><span class="op" id="5252465">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="5252468">//&nbsp;CreateFormFile&nbsp;is&nbsp;a&nbsp;convenience&nbsp;wrapper&nbsp;around&nbsp;CreatePart.&nbsp;It&nbsp;creates</span><br>
<span class="lineno"></span><span class="comment" id="5252541">//&nbsp;a&nbsp;new&nbsp;form-data&nbsp;header&nbsp;with&nbsp;the&nbsp;provided&nbsp;field&nbsp;name&nbsp;and&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="5252611">func</span>&nbsp;<span class="op" id="5252616">(</span><span class="ident" id="5252617">w</span>&nbsp;<span class="op" id="5252619">*</span><span class="ident" id="5252620">Writer</span><span class="op" id="5252626">)</span>&nbsp;<span class="ident" id="5252628">CreateFormFile</span><span class="op" id="5252642">(</span><span class="ident" id="5252643">fieldname</span><span class="op" id="5252652">,</span>&nbsp;<span class="ident" id="5252654">filename</span>&nbsp;<span class="builtintype" id="5252663">string</span><span class="op" id="5252669">)</span>&nbsp;<span class="op" id="5252671">(</span><span class="ident" id="5252672">io</span><span class="op" id="5252674">.</span><span class="ident" id="5252675">Writer</span><span class="op" id="5252681">,</span>&nbsp;<span class="builtintype" id="5252683">error</span><span class="op" id="5252688">)</span>&nbsp;<span class="op" id="5252690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252693">h</span>&nbsp;<span class="op" id="5252695">:=</span>&nbsp;<span class="builtinfunc" id="5252698">make</span><span class="op" id="5252702">(</span><span class="ident" id="5252703">textproto</span><span class="op" id="5252712">.</span><span class="ident" id="5252713">MIMEHeader</span><span class="op" id="5252723">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252726">h</span><span class="op" id="5252727">.</span><span class="ident" id="5252728">Set</span><span class="op" id="5252731">(</span><span class="string" id="5252732">&#34;Content-Disposition&#34;</span><span class="op" id="5252753">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252757">fmt</span><span class="op" id="5252760">.</span><span class="ident" id="5252761">Sprintf</span><span class="op" id="5252768">(</span><span class="string" id="5252769">`form-data;&nbsp;name=&#34;%s&#34;;&nbsp;filename=&#34;%s&#34;`</span><span class="op" id="5252806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252811">escapeQuotes</span><span class="op" id="5252823">(</span><span class="ident" id="5252824">fieldname</span><span class="op" id="5252833">)</span><span class="op" id="5252834">,</span>&nbsp;<span class="ident" id="5252836">escapeQuotes</span><span class="op" id="5252848">(</span><span class="ident" id="5252849">filename</span><span class="op" id="5252857">)</span><span class="op" id="5252858">)</span><span class="op" id="5252859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252862">h</span><span class="op" id="5252863">.</span><span class="ident" id="5252864">Set</span><span class="op" id="5252867">(</span><span class="string" id="5252868">&#34;Content-Type&#34;</span><span class="op" id="5252882">,</span>&nbsp;<span class="string" id="5252884">&#34;application/octet-stream&#34;</span><span class="op" id="5252910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5252913">return</span>&nbsp;<span class="ident" id="5252920">w</span><span class="op" id="5252921">.</span><span class="ident" id="5252922">CreatePart</span><span class="op" id="5252932">(</span><span class="ident" id="5252933">h</span><span class="op" id="5252934">)</span><br>
<span class="lineno">130</span><span class="op" id="5252936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5252939">//&nbsp;CreateFormField&nbsp;calls&nbsp;CreatePart&nbsp;with&nbsp;a&nbsp;header&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5252999">//&nbsp;given&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="5253020">func</span>&nbsp;<span class="op" id="5253025">(</span><span class="ident" id="5253026">w</span>&nbsp;<span class="op" id="5253028">*</span><span class="ident" id="5253029">Writer</span><span class="op" id="5253035">)</span>&nbsp;<span class="ident" id="5253037">CreateFormField</span><span class="op" id="5253052">(</span><span class="ident" id="5253053">fieldname</span>&nbsp;<span class="builtintype" id="5253063">string</span><span class="op" id="5253069">)</span>&nbsp;<span class="op" id="5253071">(</span><span class="ident" id="5253072">io</span><span class="op" id="5253074">.</span><span class="ident" id="5253075">Writer</span><span class="op" id="5253081">,</span>&nbsp;<span class="builtintype" id="5253083">error</span><span class="op" id="5253088">)</span>&nbsp;<span class="op" id="5253090">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253093">h</span>&nbsp;<span class="op" id="5253095">:=</span>&nbsp;<span class="builtinfunc" id="5253098">make</span><span class="op" id="5253102">(</span><span class="ident" id="5253103">textproto</span><span class="op" id="5253112">.</span><span class="ident" id="5253113">MIMEHeader</span><span class="op" id="5253123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253126">h</span><span class="op" id="5253127">.</span><span class="ident" id="5253128">Set</span><span class="op" id="5253131">(</span><span class="string" id="5253132">&#34;Content-Disposition&#34;</span><span class="op" id="5253153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253157">fmt</span><span class="op" id="5253160">.</span><span class="ident" id="5253161">Sprintf</span><span class="op" id="5253168">(</span><span class="string" id="5253169">`form-data;&nbsp;name=&#34;%s&#34;`</span><span class="op" id="5253191">,</span>&nbsp;<span class="ident" id="5253193">escapeQuotes</span><span class="op" id="5253205">(</span><span class="ident" id="5253206">fieldname</span><span class="op" id="5253215">)</span><span class="op" id="5253216">)</span><span class="op" id="5253217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253220">return</span>&nbsp;<span class="ident" id="5253227">w</span><span class="op" id="5253228">.</span><span class="ident" id="5253229">CreatePart</span><span class="op" id="5253239">(</span><span class="ident" id="5253240">h</span><span class="op" id="5253241">)</span><br>
<span class="lineno"></span><span class="op" id="5253243">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="5253246">//&nbsp;WriteField&nbsp;calls&nbsp;CreateFormField&nbsp;and&nbsp;then&nbsp;writes&nbsp;the&nbsp;given&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5253315">func</span>&nbsp;<span class="op" id="5253320">(</span><span class="ident" id="5253321">w</span>&nbsp;<span class="op" id="5253323">*</span><span class="ident" id="5253324">Writer</span><span class="op" id="5253330">)</span>&nbsp;<span class="ident" id="5253332">WriteField</span><span class="op" id="5253342">(</span><span class="ident" id="5253343">fieldname</span><span class="op" id="5253352">,</span>&nbsp;<span class="ident" id="5253354">value</span>&nbsp;<span class="builtintype" id="5253360">string</span><span class="op" id="5253366">)</span>&nbsp;<span class="builtintype" id="5253368">error</span>&nbsp;<span class="op" id="5253374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253377">p</span><span class="op" id="5253378">,</span>&nbsp;<span class="ident" id="5253380">err</span>&nbsp;<span class="op" id="5253384">:=</span>&nbsp;<span class="ident" id="5253387">w</span><span class="op" id="5253388">.</span><span class="ident" id="5253389">CreateFormField</span><span class="op" id="5253404">(</span><span class="ident" id="5253405">fieldname</span><span class="op" id="5253414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253417">if</span>&nbsp;<span class="ident" id="5253420">err</span>&nbsp;<span class="op" id="5253424">!=</span>&nbsp;<span class="ident" id="5253427">nil</span>&nbsp;<span class="op" id="5253431">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253435">return</span>&nbsp;<span class="ident" id="5253442">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5253447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253450">_</span><span class="op" id="5253451">,</span>&nbsp;<span class="ident" id="5253453">err</span>&nbsp;<span class="op" id="5253457">=</span>&nbsp;<span class="ident" id="5253459">p</span><span class="op" id="5253460">.</span><span class="ident" id="5253461">Write</span><span class="op" id="5253466">(</span><span class="op" id="5253467">[</span><span class="op" id="5253468">]</span><span class="builtintype" id="5253469">byte</span><span class="op" id="5253473">(</span><span class="ident" id="5253474">value</span><span class="op" id="5253479">)</span><span class="op" id="5253480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253483">return</span>&nbsp;<span class="ident" id="5253490">err</span><br>
<span class="lineno"></span><span class="op" id="5253494">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="5253497">//&nbsp;Close&nbsp;finishes&nbsp;the&nbsp;multipart&nbsp;message&nbsp;and&nbsp;writes&nbsp;the&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="5253561">//&nbsp;boundary&nbsp;end&nbsp;line&nbsp;to&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="5253597">func</span>&nbsp;<span class="op" id="5253602">(</span><span class="ident" id="5253603">w</span>&nbsp;<span class="op" id="5253605">*</span><span class="ident" id="5253606">Writer</span><span class="op" id="5253612">)</span>&nbsp;<span class="ident" id="5253614">Close</span><span class="op" id="5253619">(</span><span class="op" id="5253620">)</span>&nbsp;<span class="builtintype" id="5253622">error</span>&nbsp;<span class="op" id="5253628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253631">if</span>&nbsp;<span class="ident" id="5253634">w</span><span class="op" id="5253635">.</span><span class="ident" id="5253636">lastpart</span>&nbsp;<span class="op" id="5253645">!=</span>&nbsp;<span class="ident" id="5253648">nil</span>&nbsp;<span class="op" id="5253652">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253656">if</span>&nbsp;<span class="ident" id="5253659">err</span>&nbsp;<span class="op" id="5253663">:=</span>&nbsp;<span class="ident" id="5253666">w</span><span class="op" id="5253667">.</span><span class="ident" id="5253668">lastpart</span><span class="op" id="5253676">.</span><span class="builtinfunc" id="5253677">close</span><span class="op" id="5253682">(</span><span class="op" id="5253683">)</span><span class="op" id="5253684">;</span>&nbsp;<span class="ident" id="5253686">err</span>&nbsp;<span class="op" id="5253690">!=</span>&nbsp;<span class="ident" id="5253693">nil</span>&nbsp;<span class="op" id="5253697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253702">return</span>&nbsp;<span class="ident" id="5253709">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5253715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253719">w</span><span class="op" id="5253720">.</span><span class="ident" id="5253721">lastpart</span>&nbsp;<span class="op" id="5253730">=</span>&nbsp;<span class="ident" id="5253732">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5253737">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253740">_</span><span class="op" id="5253741">,</span>&nbsp;<span class="ident" id="5253743">err</span>&nbsp;<span class="op" id="5253747">:=</span>&nbsp;<span class="ident" id="5253750">fmt</span><span class="op" id="5253753">.</span><span class="ident" id="5253754">Fprintf</span><span class="op" id="5253761">(</span><span class="ident" id="5253762">w</span><span class="op" id="5253763">.</span><span class="ident" id="5253764">w</span><span class="op" id="5253765">,</span>&nbsp;<span class="string" id="5253767">&#34;\r\n--%s--\r\n&#34;</span><span class="op" id="5253783">,</span>&nbsp;<span class="ident" id="5253785">w</span><span class="op" id="5253786">.</span><span class="ident" id="5253787">boundary</span><span class="op" id="5253795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253798">return</span>&nbsp;<span class="ident" id="5253805">err</span><br>
<span class="lineno"></span><span class="op" id="5253809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5253812">type</span>&nbsp;<span class="ident" id="5253817">part</span>&nbsp;<span class="keyword" id="5253822">struct</span>&nbsp;<span class="op" id="5253829">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253832">mw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5253839">*</span><span class="ident" id="5253840">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253848">closed</span>&nbsp;<span class="builtintype" id="5253855">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253861">we</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5253868">error</span>&nbsp;<span class="comment" id="5253874">//&nbsp;last&nbsp;error&nbsp;that&nbsp;occurred&nbsp;writing</span><br>
<span class="lineno"></span><span class="op" id="5253910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="5253913">func</span>&nbsp;<span class="op" id="5253918">(</span><span class="ident" id="5253919">p</span>&nbsp;<span class="op" id="5253921">*</span><span class="ident" id="5253922">part</span><span class="op" id="5253926">)</span>&nbsp;<span class="builtinfunc" id="5253928">close</span><span class="op" id="5253933">(</span><span class="op" id="5253934">)</span>&nbsp;<span class="builtintype" id="5253936">error</span>&nbsp;<span class="op" id="5253942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253945">p</span><span class="op" id="5253946">.</span><span class="ident" id="5253947">closed</span>&nbsp;<span class="op" id="5253954">=</span>&nbsp;<span class="builtintype" id="5253956">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253962">return</span>&nbsp;<span class="ident" id="5253969">p</span><span class="op" id="5253970">.</span><span class="ident" id="5253971">we</span><br>
<span class="lineno"></span><span class="op" id="5253974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="5253977">func</span>&nbsp;<span class="op" id="5253982">(</span><span class="ident" id="5253983">p</span>&nbsp;<span class="op" id="5253985">*</span><span class="ident" id="5253986">part</span><span class="op" id="5253990">)</span>&nbsp;<span class="ident" id="5253992">Write</span><span class="op" id="5253997">(</span><span class="ident" id="5253998">d</span>&nbsp;<span class="op" id="5254000">[</span><span class="op" id="5254001">]</span><span class="builtintype" id="5254002">byte</span><span class="op" id="5254006">)</span>&nbsp;<span class="op" id="5254008">(</span><span class="ident" id="5254009">n</span>&nbsp;<span class="builtintype" id="5254011">int</span><span class="op" id="5254014">,</span>&nbsp;<span class="ident" id="5254016">err</span>&nbsp;<span class="builtintype" id="5254020">error</span><span class="op" id="5254025">)</span>&nbsp;<span class="op" id="5254027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254030">if</span>&nbsp;<span class="ident" id="5254033">p</span><span class="op" id="5254034">.</span><span class="ident" id="5254035">closed</span>&nbsp;<span class="op" id="5254042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254046">return</span>&nbsp;<span class="num" id="5254053">0</span><span class="op" id="5254054">,</span>&nbsp;<span class="ident" id="5254056">errors</span><span class="op" id="5254062">.</span><span class="ident" id="5254063">New</span><span class="op" id="5254066">(</span><span class="string" id="5254067">&#34;multipart:&nbsp;can&#39;t&nbsp;write&nbsp;to&nbsp;finished&nbsp;part&#34;</span><span class="op" id="5254108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5254111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254114">n</span><span class="op" id="5254115">,</span>&nbsp;<span class="ident" id="5254117">err</span>&nbsp;<span class="op" id="5254121">=</span>&nbsp;<span class="ident" id="5254123">p</span><span class="op" id="5254124">.</span><span class="ident" id="5254125">mw</span><span class="op" id="5254127">.</span><span class="ident" id="5254128">w</span><span class="op" id="5254129">.</span><span class="ident" id="5254130">Write</span><span class="op" id="5254135">(</span><span class="ident" id="5254136">d</span><span class="op" id="5254137">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254140">if</span>&nbsp;<span class="ident" id="5254143">err</span>&nbsp;<span class="op" id="5254147">!=</span>&nbsp;<span class="ident" id="5254150">nil</span>&nbsp;<span class="op" id="5254154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254158">p</span><span class="op" id="5254159">.</span><span class="ident" id="5254160">we</span>&nbsp;<span class="op" id="5254163">=</span>&nbsp;<span class="ident" id="5254165">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5254170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254173">return</span><br>
<span class="lineno"></span><span class="op" id="5254180">}</span>
</div>
</body>
</html>
