<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/build</h2>
<ul>
<li><a href="/gostd/go/build/build.go.html">build.go</a></li>
<li><a href="/gostd/go/build/build_test.go.html" class="current">build_test.go</a></li>
<li><a href="/gostd/go/build/deps_test.go.html">deps_test.go</a></li>
<li><a href="/gostd/go/build/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/build/read.go.html">read.go</a></li>
<li><a href="/gostd/go/build/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/go/build/syslist.go.html">syslist.go</a></li>
<li><a href="/gostd/go/build/syslist_test.go.html">syslist_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6910150">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6910206">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6910260">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6910311">package</span>&nbsp;<span class="ident" id="6910319">build</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6910326">import</span>&nbsp;<span class="op" id="6910333">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6910336">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6910342">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6910348">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6910365">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6910376">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6910387">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6910398">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6910408">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6910411">func</span>&nbsp;<span class="ident" id="6910416">TestMatch</span><span class="op" id="6910425">(</span><span class="ident" id="6910426">t</span>&nbsp;<span class="op" id="6910428">*</span><span class="ident" id="6910429">testing</span><span class="op" id="6910436">.</span><span class="ident" id="6910437">T</span><span class="op" id="6910438">)</span>&nbsp;<span class="op" id="6910440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6910443">ctxt</span>&nbsp;<span class="op" id="6910448">:=</span>&nbsp;<span class="ident" id="6910451">Default</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6910460">what</span>&nbsp;<span class="op" id="6910465">:=</span>&nbsp;<span class="string" id="6910468">&#34;default&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6910479">match</span>&nbsp;<span class="op" id="6910485">:=</span>&nbsp;<span class="keyword" id="6910488">func</span><span class="op" id="6910492">(</span><span class="ident" id="6910493">tag</span>&nbsp;<span class="builtintype" id="6910497">string</span><span class="op" id="6910503">,</span>&nbsp;<span class="ident" id="6910505">want</span>&nbsp;<span class="keyword" id="6910510">map</span><span class="op" id="6910513">[</span><span class="builtintype" id="6910514">string</span><span class="op" id="6910520">]</span><span class="builtintype" id="6910521">bool</span><span class="op" id="6910525">)</span>&nbsp;<span class="op" id="6910527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6910531">m</span>&nbsp;<span class="op" id="6910533">:=</span>&nbsp;<span class="builtinfunc" id="6910536">make</span><span class="op" id="6910540">(</span><span class="keyword" id="6910541">map</span><span class="op" id="6910544">[</span><span class="builtintype" id="6910545">string</span><span class="op" id="6910551">]</span><span class="builtintype" id="6910552">bool</span><span class="op" id="6910556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6910560">if</span>&nbsp;<span class="op" id="6910563">!</span><span class="ident" id="6910564">ctxt</span><span class="op" id="6910568">.</span><span class="ident" id="6910569">match</span><span class="op" id="6910574">(</span><span class="ident" id="6910575">tag</span><span class="op" id="6910578">,</span>&nbsp;<span class="ident" id="6910580">m</span><span class="op" id="6910581">)</span>&nbsp;<span class="op" id="6910583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6910588">t</span><span class="op" id="6910589">.</span><span class="ident" id="6910590">Errorf</span><span class="op" id="6910596">(</span><span class="string" id="6910597">&#34;%s&nbsp;context&nbsp;should&nbsp;match&nbsp;%s,&nbsp;does&nbsp;not&#34;</span><span class="op" id="6910635">,</span>&nbsp;<span class="ident" id="6910637">what</span><span class="op" id="6910641">,</span>&nbsp;<span class="ident" id="6910643">tag</span><span class="op" id="6910646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6910650">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6910654">if</span>&nbsp;<span class="op" id="6910657">!</span><span class="ident" id="6910658">reflect</span><span class="op" id="6910665">.</span><span class="ident" id="6910666">DeepEqual</span><span class="op" id="6910675">(</span><span class="ident" id="6910676">m</span><span class="op" id="6910677">,</span>&nbsp;<span class="ident" id="6910679">want</span><span class="op" id="6910683">)</span>&nbsp;<span class="op" id="6910685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6910690">t</span><span class="op" id="6910691">.</span><span class="ident" id="6910692">Errorf</span><span class="op" id="6910698">(</span><span class="string" id="6910699">&#34;%s&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6910722">,</span>&nbsp;<span class="ident" id="6910724">tag</span><span class="op" id="6910727">,</span>&nbsp;<span class="ident" id="6910729">m</span><span class="op" id="6910730">,</span>&nbsp;<span class="ident" id="6910732">want</span><span class="op" id="6910736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6910740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6910743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6910746">nomatch</span>&nbsp;<span class="op" id="6910754">:=</span>&nbsp;<span class="keyword" id="6910757">func</span><span class="op" id="6910761">(</span><span class="ident" id="6910762">tag</span>&nbsp;<span class="builtintype" id="6910766">string</span><span class="op" id="6910772">,</span>&nbsp;<span class="ident" id="6910774">want</span>&nbsp;<span class="keyword" id="6910779">map</span><span class="op" id="6910782">[</span><span class="builtintype" id="6910783">string</span><span class="op" id="6910789">]</span><span class="builtintype" id="6910790">bool</span><span class="op" id="6910794">)</span>&nbsp;<span class="op" id="6910796">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6910800">m</span>&nbsp;<span class="op" id="6910802">:=</span>&nbsp;<span class="builtinfunc" id="6910805">make</span><span class="op" id="6910809">(</span><span class="keyword" id="6910810">map</span><span class="op" id="6910813">[</span><span class="builtintype" id="6910814">string</span><span class="op" id="6910820">]</span><span class="builtintype" id="6910821">bool</span><span class="op" id="6910825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6910829">if</span>&nbsp;<span class="ident" id="6910832">ctxt</span><span class="op" id="6910836">.</span><span class="ident" id="6910837">match</span><span class="op" id="6910842">(</span><span class="ident" id="6910843">tag</span><span class="op" id="6910846">,</span>&nbsp;<span class="ident" id="6910848">m</span><span class="op" id="6910849">)</span>&nbsp;<span class="op" id="6910851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6910856">t</span><span class="op" id="6910857">.</span><span class="ident" id="6910858">Errorf</span><span class="op" id="6910864">(</span><span class="string" id="6910865">&#34;%s&nbsp;context&nbsp;should&nbsp;NOT&nbsp;match&nbsp;%s,&nbsp;does&#34;</span><span class="op" id="6910903">,</span>&nbsp;<span class="ident" id="6910905">what</span><span class="op" id="6910909">,</span>&nbsp;<span class="ident" id="6910911">tag</span><span class="op" id="6910914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6910918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6910922">if</span>&nbsp;<span class="op" id="6910925">!</span><span class="ident" id="6910926">reflect</span><span class="op" id="6910933">.</span><span class="ident" id="6910934">DeepEqual</span><span class="op" id="6910943">(</span><span class="ident" id="6910944">m</span><span class="op" id="6910945">,</span>&nbsp;<span class="ident" id="6910947">want</span><span class="op" id="6910951">)</span>&nbsp;<span class="op" id="6910953">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6910958">t</span><span class="op" id="6910959">.</span><span class="ident" id="6910960">Errorf</span><span class="op" id="6910966">(</span><span class="string" id="6910967">&#34;%s&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6910990">,</span>&nbsp;<span class="ident" id="6910992">tag</span><span class="op" id="6910995">,</span>&nbsp;<span class="ident" id="6910997">m</span><span class="op" id="6910998">,</span>&nbsp;<span class="ident" id="6911000">want</span><span class="op" id="6911004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6911008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6911011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6911015">match</span><span class="op" id="6911020">(</span><span class="ident" id="6911021">runtime</span><span class="op" id="6911028">.</span><span class="ident" id="6911029">GOOS</span><span class="op" id="6911033">+</span><span class="string" id="6911034">&#34;,&#34;</span><span class="op" id="6911037">+</span><span class="ident" id="6911038">runtime</span><span class="op" id="6911045">.</span><span class="ident" id="6911046">GOARCH</span><span class="op" id="6911052">,</span>&nbsp;<span class="keyword" id="6911054">map</span><span class="op" id="6911057">[</span><span class="builtintype" id="6911058">string</span><span class="op" id="6911064">]</span><span class="builtintype" id="6911065">bool</span><span class="op" id="6911069">{</span><span class="ident" id="6911070">runtime</span><span class="op" id="6911077">.</span><span class="ident" id="6911078">GOOS</span><span class="op" id="6911082">:</span>&nbsp;<span class="builtintype" id="6911084">true</span><span class="op" id="6911088">,</span>&nbsp;<span class="ident" id="6911090">runtime</span><span class="op" id="6911097">.</span><span class="ident" id="6911098">GOARCH</span><span class="op" id="6911104">:</span>&nbsp;<span class="builtintype" id="6911106">true</span><span class="op" id="6911110">}</span><span class="op" id="6911111">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6911114">match</span><span class="op" id="6911119">(</span><span class="ident" id="6911120">runtime</span><span class="op" id="6911127">.</span><span class="ident" id="6911128">GOOS</span><span class="op" id="6911132">+</span><span class="string" id="6911133">&#34;,&#34;</span><span class="op" id="6911136">+</span><span class="ident" id="6911137">runtime</span><span class="op" id="6911144">.</span><span class="ident" id="6911145">GOARCH</span><span class="op" id="6911151">+</span><span class="string" id="6911152">&#34;,!foo&#34;</span><span class="op" id="6911159">,</span>&nbsp;<span class="keyword" id="6911161">map</span><span class="op" id="6911164">[</span><span class="builtintype" id="6911165">string</span><span class="op" id="6911171">]</span><span class="builtintype" id="6911172">bool</span><span class="op" id="6911176">{</span><span class="ident" id="6911177">runtime</span><span class="op" id="6911184">.</span><span class="ident" id="6911185">GOOS</span><span class="op" id="6911189">:</span>&nbsp;<span class="builtintype" id="6911191">true</span><span class="op" id="6911195">,</span>&nbsp;<span class="ident" id="6911197">runtime</span><span class="op" id="6911204">.</span><span class="ident" id="6911205">GOARCH</span><span class="op" id="6911211">:</span>&nbsp;<span class="builtintype" id="6911213">true</span><span class="op" id="6911217">,</span>&nbsp;<span class="string" id="6911219">&#34;foo&#34;</span><span class="op" id="6911224">:</span>&nbsp;<span class="builtintype" id="6911226">true</span><span class="op" id="6911230">}</span><span class="op" id="6911231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6911234">nomatch</span><span class="op" id="6911241">(</span><span class="ident" id="6911242">runtime</span><span class="op" id="6911249">.</span><span class="ident" id="6911250">GOOS</span><span class="op" id="6911254">+</span><span class="string" id="6911255">&#34;,&#34;</span><span class="op" id="6911258">+</span><span class="ident" id="6911259">runtime</span><span class="op" id="6911266">.</span><span class="ident" id="6911267">GOARCH</span><span class="op" id="6911273">+</span><span class="string" id="6911274">&#34;,foo&#34;</span><span class="op" id="6911280">,</span>&nbsp;<span class="keyword" id="6911282">map</span><span class="op" id="6911285">[</span><span class="builtintype" id="6911286">string</span><span class="op" id="6911292">]</span><span class="builtintype" id="6911293">bool</span><span class="op" id="6911297">{</span><span class="ident" id="6911298">runtime</span><span class="op" id="6911305">.</span><span class="ident" id="6911306">GOOS</span><span class="op" id="6911310">:</span>&nbsp;<span class="builtintype" id="6911312">true</span><span class="op" id="6911316">,</span>&nbsp;<span class="ident" id="6911318">runtime</span><span class="op" id="6911325">.</span><span class="ident" id="6911326">GOARCH</span><span class="op" id="6911332">:</span>&nbsp;<span class="builtintype" id="6911334">true</span><span class="op" id="6911338">,</span>&nbsp;<span class="string" id="6911340">&#34;foo&#34;</span><span class="op" id="6911345">:</span>&nbsp;<span class="builtintype" id="6911347">true</span><span class="op" id="6911351">}</span><span class="op" id="6911352">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6911356">what</span>&nbsp;<span class="op" id="6911361">=</span>&nbsp;<span class="string" id="6911363">&#34;modified&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6911375">ctxt</span><span class="op" id="6911379">.</span><span class="ident" id="6911380">BuildTags</span>&nbsp;<span class="op" id="6911390">=</span>&nbsp;<span class="op" id="6911392">[</span><span class="op" id="6911393">]</span><span class="builtintype" id="6911394">string</span><span class="op" id="6911400">{</span><span class="string" id="6911401">&#34;foo&#34;</span><span class="op" id="6911406">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6911409">match</span><span class="op" id="6911414">(</span><span class="ident" id="6911415">runtime</span><span class="op" id="6911422">.</span><span class="ident" id="6911423">GOOS</span><span class="op" id="6911427">+</span><span class="string" id="6911428">&#34;,&#34;</span><span class="op" id="6911431">+</span><span class="ident" id="6911432">runtime</span><span class="op" id="6911439">.</span><span class="ident" id="6911440">GOARCH</span><span class="op" id="6911446">,</span>&nbsp;<span class="keyword" id="6911448">map</span><span class="op" id="6911451">[</span><span class="builtintype" id="6911452">string</span><span class="op" id="6911458">]</span><span class="builtintype" id="6911459">bool</span><span class="op" id="6911463">{</span><span class="ident" id="6911464">runtime</span><span class="op" id="6911471">.</span><span class="ident" id="6911472">GOOS</span><span class="op" id="6911476">:</span>&nbsp;<span class="builtintype" id="6911478">true</span><span class="op" id="6911482">,</span>&nbsp;<span class="ident" id="6911484">runtime</span><span class="op" id="6911491">.</span><span class="ident" id="6911492">GOARCH</span><span class="op" id="6911498">:</span>&nbsp;<span class="builtintype" id="6911500">true</span><span class="op" id="6911504">}</span><span class="op" id="6911505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6911508">match</span><span class="op" id="6911513">(</span><span class="ident" id="6911514">runtime</span><span class="op" id="6911521">.</span><span class="ident" id="6911522">GOOS</span><span class="op" id="6911526">+</span><span class="string" id="6911527">&#34;,&#34;</span><span class="op" id="6911530">+</span><span class="ident" id="6911531">runtime</span><span class="op" id="6911538">.</span><span class="ident" id="6911539">GOARCH</span><span class="op" id="6911545">+</span><span class="string" id="6911546">&#34;,foo&#34;</span><span class="op" id="6911552">,</span>&nbsp;<span class="keyword" id="6911554">map</span><span class="op" id="6911557">[</span><span class="builtintype" id="6911558">string</span><span class="op" id="6911564">]</span><span class="builtintype" id="6911565">bool</span><span class="op" id="6911569">{</span><span class="ident" id="6911570">runtime</span><span class="op" id="6911577">.</span><span class="ident" id="6911578">GOOS</span><span class="op" id="6911582">:</span>&nbsp;<span class="builtintype" id="6911584">true</span><span class="op" id="6911588">,</span>&nbsp;<span class="ident" id="6911590">runtime</span><span class="op" id="6911597">.</span><span class="ident" id="6911598">GOARCH</span><span class="op" id="6911604">:</span>&nbsp;<span class="builtintype" id="6911606">true</span><span class="op" id="6911610">,</span>&nbsp;<span class="string" id="6911612">&#34;foo&#34;</span><span class="op" id="6911617">:</span>&nbsp;<span class="builtintype" id="6911619">true</span><span class="op" id="6911623">}</span><span class="op" id="6911624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6911627">nomatch</span><span class="op" id="6911634">(</span><span class="ident" id="6911635">runtime</span><span class="op" id="6911642">.</span><span class="ident" id="6911643">GOOS</span><span class="op" id="6911647">+</span><span class="string" id="6911648">&#34;,&#34;</span><span class="op" id="6911651">+</span><span class="ident" id="6911652">runtime</span><span class="op" id="6911659">.</span><span class="ident" id="6911660">GOARCH</span><span class="op" id="6911666">+</span><span class="string" id="6911667">&#34;,!foo&#34;</span><span class="op" id="6911674">,</span>&nbsp;<span class="keyword" id="6911676">map</span><span class="op" id="6911679">[</span><span class="builtintype" id="6911680">string</span><span class="op" id="6911686">]</span><span class="builtintype" id="6911687">bool</span><span class="op" id="6911691">{</span><span class="ident" id="6911692">runtime</span><span class="op" id="6911699">.</span><span class="ident" id="6911700">GOOS</span><span class="op" id="6911704">:</span>&nbsp;<span class="builtintype" id="6911706">true</span><span class="op" id="6911710">,</span>&nbsp;<span class="ident" id="6911712">runtime</span><span class="op" id="6911719">.</span><span class="ident" id="6911720">GOARCH</span><span class="op" id="6911726">:</span>&nbsp;<span class="builtintype" id="6911728">true</span><span class="op" id="6911732">,</span>&nbsp;<span class="string" id="6911734">&#34;foo&#34;</span><span class="op" id="6911739">:</span>&nbsp;<span class="builtintype" id="6911741">true</span><span class="op" id="6911745">}</span><span class="op" id="6911746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6911749">match</span><span class="op" id="6911754">(</span><span class="ident" id="6911755">runtime</span><span class="op" id="6911762">.</span><span class="ident" id="6911763">GOOS</span><span class="op" id="6911767">+</span><span class="string" id="6911768">&#34;,&#34;</span><span class="op" id="6911771">+</span><span class="ident" id="6911772">runtime</span><span class="op" id="6911779">.</span><span class="ident" id="6911780">GOARCH</span><span class="op" id="6911786">+</span><span class="string" id="6911787">&#34;,!bar&#34;</span><span class="op" id="6911794">,</span>&nbsp;<span class="keyword" id="6911796">map</span><span class="op" id="6911799">[</span><span class="builtintype" id="6911800">string</span><span class="op" id="6911806">]</span><span class="builtintype" id="6911807">bool</span><span class="op" id="6911811">{</span><span class="ident" id="6911812">runtime</span><span class="op" id="6911819">.</span><span class="ident" id="6911820">GOOS</span><span class="op" id="6911824">:</span>&nbsp;<span class="builtintype" id="6911826">true</span><span class="op" id="6911830">,</span>&nbsp;<span class="ident" id="6911832">runtime</span><span class="op" id="6911839">.</span><span class="ident" id="6911840">GOARCH</span><span class="op" id="6911846">:</span>&nbsp;<span class="builtintype" id="6911848">true</span><span class="op" id="6911852">,</span>&nbsp;<span class="string" id="6911854">&#34;bar&#34;</span><span class="op" id="6911859">:</span>&nbsp;<span class="builtintype" id="6911861">true</span><span class="op" id="6911865">}</span><span class="op" id="6911866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6911869">nomatch</span><span class="op" id="6911876">(</span><span class="ident" id="6911877">runtime</span><span class="op" id="6911884">.</span><span class="ident" id="6911885">GOOS</span><span class="op" id="6911889">+</span><span class="string" id="6911890">&#34;,&#34;</span><span class="op" id="6911893">+</span><span class="ident" id="6911894">runtime</span><span class="op" id="6911901">.</span><span class="ident" id="6911902">GOARCH</span><span class="op" id="6911908">+</span><span class="string" id="6911909">&#34;,bar&#34;</span><span class="op" id="6911915">,</span>&nbsp;<span class="keyword" id="6911917">map</span><span class="op" id="6911920">[</span><span class="builtintype" id="6911921">string</span><span class="op" id="6911927">]</span><span class="builtintype" id="6911928">bool</span><span class="op" id="6911932">{</span><span class="ident" id="6911933">runtime</span><span class="op" id="6911940">.</span><span class="ident" id="6911941">GOOS</span><span class="op" id="6911945">:</span>&nbsp;<span class="builtintype" id="6911947">true</span><span class="op" id="6911951">,</span>&nbsp;<span class="ident" id="6911953">runtime</span><span class="op" id="6911960">.</span><span class="ident" id="6911961">GOARCH</span><span class="op" id="6911967">:</span>&nbsp;<span class="builtintype" id="6911969">true</span><span class="op" id="6911973">,</span>&nbsp;<span class="string" id="6911975">&#34;bar&#34;</span><span class="op" id="6911980">:</span>&nbsp;<span class="builtintype" id="6911982">true</span><span class="op" id="6911986">}</span><span class="op" id="6911987">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6911990">nomatch</span><span class="op" id="6911997">(</span><span class="string" id="6911998">&#34;!&#34;</span><span class="op" id="6912001">,</span>&nbsp;<span class="keyword" id="6912003">map</span><span class="op" id="6912006">[</span><span class="builtintype" id="6912007">string</span><span class="op" id="6912013">]</span><span class="builtintype" id="6912014">bool</span><span class="op" id="6912018">{</span><span class="op" id="6912019">}</span><span class="op" id="6912020">)</span><br>
<span class="lineno"></span><span class="op" id="6912022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6912025">func</span>&nbsp;<span class="ident" id="6912030">TestDotSlashImport</span><span class="op" id="6912048">(</span><span class="ident" id="6912049">t</span>&nbsp;<span class="op" id="6912051">*</span><span class="ident" id="6912052">testing</span><span class="op" id="6912059">.</span><span class="ident" id="6912060">T</span><span class="op" id="6912061">)</span>&nbsp;<span class="op" id="6912063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6912066">p</span><span class="op" id="6912067">,</span>&nbsp;<span class="ident" id="6912069">err</span>&nbsp;<span class="op" id="6912073">:=</span>&nbsp;<span class="ident" id="6912076">ImportDir</span><span class="op" id="6912085">(</span><span class="string" id="6912086">&#34;testdata/other&#34;</span><span class="op" id="6912102">,</span>&nbsp;<span class="num" id="6912104">0</span><span class="op" id="6912105">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6912108">if</span>&nbsp;<span class="ident" id="6912111">err</span>&nbsp;<span class="op" id="6912115">!=</span>&nbsp;<span class="ident" id="6912118">nil</span>&nbsp;<span class="op" id="6912122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6912126">t</span><span class="op" id="6912127">.</span><span class="ident" id="6912128">Fatal</span><span class="op" id="6912133">(</span><span class="ident" id="6912134">err</span><span class="op" id="6912137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6912140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6912143">if</span>&nbsp;<span class="builtinfunc" id="6912146">len</span><span class="op" id="6912149">(</span><span class="ident" id="6912150">p</span><span class="op" id="6912151">.</span><span class="ident" id="6912152">Imports</span><span class="op" id="6912159">)</span>&nbsp;<span class="op" id="6912161">!=</span>&nbsp;<span class="num" id="6912164">1</span>&nbsp;<span class="op" id="6912166">||</span>&nbsp;<span class="ident" id="6912169">p</span><span class="op" id="6912170">.</span><span class="ident" id="6912171">Imports</span><span class="op" id="6912178">[</span><span class="num" id="6912179">0</span><span class="op" id="6912180">]</span>&nbsp;<span class="op" id="6912182">!=</span>&nbsp;<span class="string" id="6912185">&#34;./file&#34;</span>&nbsp;<span class="op" id="6912194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6912198">t</span><span class="op" id="6912199">.</span><span class="ident" id="6912200">Fatalf</span><span class="op" id="6912206">(</span><span class="string" id="6912207">&#34;testdata/other:&nbsp;Imports=%v,&nbsp;want&nbsp;[./file]&#34;</span><span class="op" id="6912250">,</span>&nbsp;<span class="ident" id="6912252">p</span><span class="op" id="6912253">.</span><span class="ident" id="6912254">Imports</span><span class="op" id="6912261">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6912264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6912268">p1</span><span class="op" id="6912270">,</span>&nbsp;<span class="ident" id="6912272">err</span>&nbsp;<span class="op" id="6912276">:=</span>&nbsp;<span class="ident" id="6912279">Import</span><span class="op" id="6912285">(</span><span class="string" id="6912286">&#34;./file&#34;</span><span class="op" id="6912294">,</span>&nbsp;<span class="string" id="6912296">&#34;testdata/other&#34;</span><span class="op" id="6912312">,</span>&nbsp;<span class="num" id="6912314">0</span><span class="op" id="6912315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6912318">if</span>&nbsp;<span class="ident" id="6912321">err</span>&nbsp;<span class="op" id="6912325">!=</span>&nbsp;<span class="ident" id="6912328">nil</span>&nbsp;<span class="op" id="6912332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6912336">t</span><span class="op" id="6912337">.</span><span class="ident" id="6912338">Fatal</span><span class="op" id="6912343">(</span><span class="ident" id="6912344">err</span><span class="op" id="6912347">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6912350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6912353">if</span>&nbsp;<span class="ident" id="6912356">p1</span><span class="op" id="6912358">.</span><span class="ident" id="6912359">Name</span>&nbsp;<span class="op" id="6912364">!=</span>&nbsp;<span class="string" id="6912367">&#34;file&#34;</span>&nbsp;<span class="op" id="6912374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6912378">t</span><span class="op" id="6912379">.</span><span class="ident" id="6912380">Fatalf</span><span class="op" id="6912386">(</span><span class="string" id="6912387">&#34;./file:&nbsp;Name=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6912413">,</span>&nbsp;<span class="ident" id="6912415">p1</span><span class="op" id="6912417">.</span><span class="ident" id="6912418">Name</span><span class="op" id="6912422">,</span>&nbsp;<span class="string" id="6912424">&#34;file&#34;</span><span class="op" id="6912430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6912433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6912436">dir</span>&nbsp;<span class="op" id="6912440">:=</span>&nbsp;<span class="ident" id="6912443">filepath</span><span class="op" id="6912451">.</span><span class="ident" id="6912452">Clean</span><span class="op" id="6912457">(</span><span class="string" id="6912458">&#34;testdata/other/file&#34;</span><span class="op" id="6912479">)</span>&nbsp;<span class="comment" id="6912481">//&nbsp;Clean&nbsp;to&nbsp;use&nbsp;\&nbsp;on&nbsp;Windows</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6912511">if</span>&nbsp;<span class="ident" id="6912514">p1</span><span class="op" id="6912516">.</span><span class="ident" id="6912517">Dir</span>&nbsp;<span class="op" id="6912521">!=</span>&nbsp;<span class="ident" id="6912524">dir</span>&nbsp;<span class="op" id="6912528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6912532">t</span><span class="op" id="6912533">.</span><span class="ident" id="6912534">Fatalf</span><span class="op" id="6912540">(</span><span class="string" id="6912541">&#34;./file:&nbsp;Dir=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6912566">,</span>&nbsp;<span class="ident" id="6912568">p1</span><span class="op" id="6912570">.</span><span class="ident" id="6912571">Name</span><span class="op" id="6912575">,</span>&nbsp;<span class="ident" id="6912577">dir</span><span class="op" id="6912580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6912583">}</span><br>
<span class="lineno"></span><span class="op" id="6912585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6912588">func</span>&nbsp;<span class="ident" id="6912593">TestEmptyImport</span><span class="op" id="6912608">(</span><span class="ident" id="6912609">t</span>&nbsp;<span class="op" id="6912611">*</span><span class="ident" id="6912612">testing</span><span class="op" id="6912619">.</span><span class="ident" id="6912620">T</span><span class="op" id="6912621">)</span>&nbsp;<span class="op" id="6912623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6912626">p</span><span class="op" id="6912627">,</span>&nbsp;<span class="ident" id="6912629">err</span>&nbsp;<span class="op" id="6912633">:=</span>&nbsp;<span class="ident" id="6912636">Import</span><span class="op" id="6912642">(</span><span class="string" id="6912643">&#34;&#34;</span><span class="op" id="6912645">,</span>&nbsp;<span class="ident" id="6912647">Default</span><span class="op" id="6912654">.</span><span class="ident" id="6912655">GOROOT</span><span class="op" id="6912661">,</span>&nbsp;<span class="ident" id="6912663">FindOnly</span><span class="op" id="6912671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6912674">if</span>&nbsp;<span class="ident" id="6912677">err</span>&nbsp;<span class="op" id="6912681">==</span>&nbsp;<span class="ident" id="6912684">nil</span>&nbsp;<span class="op" id="6912688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6912692">t</span><span class="op" id="6912693">.</span><span class="ident" id="6912694">Fatal</span><span class="op" id="6912699">(</span><span class="string" id="6912700">`Import(&#34;&#34;)&nbsp;returned&nbsp;nil&nbsp;error.`</span><span class="op" id="6912732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6912735">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6912738">if</span>&nbsp;<span class="ident" id="6912741">p</span>&nbsp;<span class="op" id="6912743">==</span>&nbsp;<span class="ident" id="6912746">nil</span>&nbsp;<span class="op" id="6912750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6912754">t</span><span class="op" id="6912755">.</span><span class="ident" id="6912756">Fatal</span><span class="op" id="6912761">(</span><span class="string" id="6912762">`Import(&#34;&#34;)&nbsp;returned&nbsp;nil&nbsp;package.`</span><span class="op" id="6912796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6912799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6912802">if</span>&nbsp;<span class="ident" id="6912805">p</span><span class="op" id="6912806">.</span><span class="ident" id="6912807">ImportPath</span>&nbsp;<span class="op" id="6912818">!=</span>&nbsp;<span class="string" id="6912821">&#34;&#34;</span>&nbsp;<span class="op" id="6912824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6912828">t</span><span class="op" id="6912829">.</span><span class="ident" id="6912830">Fatalf</span><span class="op" id="6912836">(</span><span class="string" id="6912837">&#34;ImportPath=%q,&nbsp;want&nbsp;%q.&#34;</span><span class="op" id="6912862">,</span>&nbsp;<span class="ident" id="6912864">p</span><span class="op" id="6912865">.</span><span class="ident" id="6912866">ImportPath</span><span class="op" id="6912876">,</span>&nbsp;<span class="string" id="6912878">&#34;&#34;</span><span class="op" id="6912880">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6912883">}</span><br>
<span class="lineno"></span><span class="op" id="6912885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6912888">func</span>&nbsp;<span class="ident" id="6912893">TestEmptyFolderImport</span><span class="op" id="6912914">(</span><span class="ident" id="6912915">t</span>&nbsp;<span class="op" id="6912917">*</span><span class="ident" id="6912918">testing</span><span class="op" id="6912925">.</span><span class="ident" id="6912926">T</span><span class="op" id="6912927">)</span>&nbsp;<span class="op" id="6912929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6912932">_</span><span class="op" id="6912933">,</span>&nbsp;<span class="ident" id="6912935">err</span>&nbsp;<span class="op" id="6912939">:=</span>&nbsp;<span class="ident" id="6912942">Import</span><span class="op" id="6912948">(</span><span class="string" id="6912949">&#34;.&#34;</span><span class="op" id="6912952">,</span>&nbsp;<span class="string" id="6912954">&#34;testdata/empty&#34;</span><span class="op" id="6912970">,</span>&nbsp;<span class="num" id="6912972">0</span><span class="op" id="6912973">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6912976">if</span>&nbsp;<span class="ident" id="6912979">_</span><span class="op" id="6912980">,</span>&nbsp;<span class="ident" id="6912982">ok</span>&nbsp;<span class="op" id="6912985">:=</span>&nbsp;<span class="ident" id="6912988">err</span><span class="op" id="6912991">.</span><span class="op" id="6912992">(</span><span class="op" id="6912993">*</span><span class="ident" id="6912994">NoGoError</span><span class="op" id="6913003">)</span><span class="op" id="6913004">;</span>&nbsp;<span class="op" id="6913006">!</span><span class="ident" id="6913007">ok</span>&nbsp;<span class="op" id="6913010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6913014">t</span><span class="op" id="6913015">.</span><span class="ident" id="6913016">Fatal</span><span class="op" id="6913021">(</span><span class="string" id="6913022">`Import(&#34;testdata/empty&#34;)&nbsp;did&nbsp;not&nbsp;return&nbsp;NoGoError.`</span><span class="op" id="6913074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6913077">}</span><br>
<span class="lineno"></span><span class="op" id="6913079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6913082">func</span>&nbsp;<span class="ident" id="6913087">TestMultiplePackageImport</span><span class="op" id="6913112">(</span><span class="ident" id="6913113">t</span>&nbsp;<span class="op" id="6913115">*</span><span class="ident" id="6913116">testing</span><span class="op" id="6913123">.</span><span class="ident" id="6913124">T</span><span class="op" id="6913125">)</span>&nbsp;<span class="op" id="6913127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6913130">_</span><span class="op" id="6913131">,</span>&nbsp;<span class="ident" id="6913133">err</span>&nbsp;<span class="op" id="6913137">:=</span>&nbsp;<span class="ident" id="6913140">Import</span><span class="op" id="6913146">(</span><span class="string" id="6913147">&#34;.&#34;</span><span class="op" id="6913150">,</span>&nbsp;<span class="string" id="6913152">&#34;testdata/multi&#34;</span><span class="op" id="6913168">,</span>&nbsp;<span class="num" id="6913170">0</span><span class="op" id="6913171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6913174">if</span>&nbsp;<span class="ident" id="6913177">_</span><span class="op" id="6913178">,</span>&nbsp;<span class="ident" id="6913180">ok</span>&nbsp;<span class="op" id="6913183">:=</span>&nbsp;<span class="ident" id="6913186">err</span><span class="op" id="6913189">.</span><span class="op" id="6913190">(</span><span class="op" id="6913191">*</span><span class="ident" id="6913192">MultiplePackageError</span><span class="op" id="6913212">)</span><span class="op" id="6913213">;</span>&nbsp;<span class="op" id="6913215">!</span><span class="ident" id="6913216">ok</span>&nbsp;<span class="op" id="6913219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6913223">t</span><span class="op" id="6913224">.</span><span class="ident" id="6913225">Fatal</span><span class="op" id="6913230">(</span><span class="string" id="6913231">`Import(&#34;testdata/multi&#34;)&nbsp;did&nbsp;not&nbsp;return&nbsp;MultiplePackageError.`</span><span class="op" id="6913294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6913297">}</span><br>
<span class="lineno">100</span><span class="op" id="6913299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6913302">func</span>&nbsp;<span class="ident" id="6913307">TestLocalDirectory</span><span class="op" id="6913325">(</span><span class="ident" id="6913326">t</span>&nbsp;<span class="op" id="6913328">*</span><span class="ident" id="6913329">testing</span><span class="op" id="6913336">.</span><span class="ident" id="6913337">T</span><span class="op" id="6913338">)</span>&nbsp;<span class="op" id="6913340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6913343">cwd</span><span class="op" id="6913346">,</span>&nbsp;<span class="ident" id="6913348">err</span>&nbsp;<span class="op" id="6913352">:=</span>&nbsp;<span class="ident" id="6913355">os</span><span class="op" id="6913357">.</span><span class="ident" id="6913358">Getwd</span><span class="op" id="6913363">(</span><span class="op" id="6913364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6913367">if</span>&nbsp;<span class="ident" id="6913370">err</span>&nbsp;<span class="op" id="6913374">!=</span>&nbsp;<span class="ident" id="6913377">nil</span>&nbsp;<span class="op" id="6913381">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6913385">t</span><span class="op" id="6913386">.</span><span class="ident" id="6913387">Fatal</span><span class="op" id="6913392">(</span><span class="ident" id="6913393">err</span><span class="op" id="6913396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6913399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6913403">p</span><span class="op" id="6913404">,</span>&nbsp;<span class="ident" id="6913406">err</span>&nbsp;<span class="op" id="6913410">:=</span>&nbsp;<span class="ident" id="6913413">ImportDir</span><span class="op" id="6913422">(</span><span class="ident" id="6913423">cwd</span><span class="op" id="6913426">,</span>&nbsp;<span class="num" id="6913428">0</span><span class="op" id="6913429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6913432">if</span>&nbsp;<span class="ident" id="6913435">err</span>&nbsp;<span class="op" id="6913439">!=</span>&nbsp;<span class="ident" id="6913442">nil</span>&nbsp;<span class="op" id="6913446">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6913450">t</span><span class="op" id="6913451">.</span><span class="ident" id="6913452">Fatal</span><span class="op" id="6913457">(</span><span class="ident" id="6913458">err</span><span class="op" id="6913461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6913464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6913467">if</span>&nbsp;<span class="ident" id="6913470">p</span><span class="op" id="6913471">.</span><span class="ident" id="6913472">ImportPath</span>&nbsp;<span class="op" id="6913483">!=</span>&nbsp;<span class="string" id="6913486">&#34;go/build&#34;</span>&nbsp;<span class="op" id="6913497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6913501">t</span><span class="op" id="6913502">.</span><span class="ident" id="6913503">Fatalf</span><span class="op" id="6913509">(</span><span class="string" id="6913510">&#34;ImportPath=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6913534">,</span>&nbsp;<span class="ident" id="6913536">p</span><span class="op" id="6913537">.</span><span class="ident" id="6913538">ImportPath</span><span class="op" id="6913548">,</span>&nbsp;<span class="string" id="6913550">&#34;go/build&#34;</span><span class="op" id="6913560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6913563">}</span><br>
<span class="lineno">115</span><span class="op" id="6913565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6913568">func</span>&nbsp;<span class="ident" id="6913573">TestShouldBuild</span><span class="op" id="6913588">(</span><span class="ident" id="6913589">t</span>&nbsp;<span class="op" id="6913591">*</span><span class="ident" id="6913592">testing</span><span class="op" id="6913599">.</span><span class="ident" id="6913600">T</span><span class="op" id="6913601">)</span>&nbsp;<span class="op" id="6913603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6913606">const</span>&nbsp;<span class="ident" id="6913612">file1</span>&nbsp;<span class="op" id="6913618">=</span>&nbsp;<span class="string" id="6913620">&#34;//&nbsp;+build&nbsp;tag1\n\n&#34;</span>&nbsp;<span class="op" id="6913641">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6913645">&#34;package&nbsp;main\n&#34;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6913663">want1</span>&nbsp;<span class="op" id="6913669">:=</span>&nbsp;<span class="keyword" id="6913672">map</span><span class="op" id="6913675">[</span><span class="builtintype" id="6913676">string</span><span class="op" id="6913682">]</span><span class="builtintype" id="6913683">bool</span><span class="op" id="6913687">{</span><span class="string" id="6913688">&#34;tag1&#34;</span><span class="op" id="6913694">:</span>&nbsp;<span class="builtintype" id="6913696">true</span><span class="op" id="6913700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6913704">const</span>&nbsp;<span class="ident" id="6913710">file2</span>&nbsp;<span class="op" id="6913716">=</span>&nbsp;<span class="string" id="6913718">&#34;//&nbsp;+build&nbsp;cgo\n\n&#34;</span>&nbsp;<span class="op" id="6913738">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6913742">&#34;//&nbsp;This&nbsp;package&nbsp;implements&nbsp;parsing&nbsp;of&nbsp;tags&nbsp;like\n&#34;</span>&nbsp;<span class="op" id="6913794">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6913798">&#34;//&nbsp;+build&nbsp;tag1\n&#34;</span>&nbsp;<span class="op" id="6913817">+</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6913821">&#34;package&nbsp;build&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6913838">want2</span>&nbsp;<span class="op" id="6913844">:=</span>&nbsp;<span class="keyword" id="6913847">map</span><span class="op" id="6913850">[</span><span class="builtintype" id="6913851">string</span><span class="op" id="6913857">]</span><span class="builtintype" id="6913858">bool</span><span class="op" id="6913862">{</span><span class="string" id="6913863">&#34;cgo&#34;</span><span class="op" id="6913868">:</span>&nbsp;<span class="builtintype" id="6913870">true</span><span class="op" id="6913874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6913878">const</span>&nbsp;<span class="ident" id="6913884">file3</span>&nbsp;<span class="op" id="6913890">=</span>&nbsp;<span class="string" id="6913892">&#34;//&nbsp;Copyright&nbsp;The&nbsp;Go&nbsp;Authors.\n\n&#34;</span>&nbsp;<span class="op" id="6913927">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6913931">&#34;package&nbsp;build\n\n&#34;</span>&nbsp;<span class="op" id="6913951">+</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6913955">&#34;//&nbsp;shouldBuild&nbsp;checks&nbsp;tags&nbsp;given&nbsp;by&nbsp;lines&nbsp;of&nbsp;the&nbsp;form\n&#34;</span>&nbsp;<span class="op" id="6914013">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6914017">&#34;//&nbsp;+build&nbsp;tag\n&#34;</span>&nbsp;<span class="op" id="6914035">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6914039">&#34;func&nbsp;shouldBuild(content&nbsp;[]byte)\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6914077">want3</span>&nbsp;<span class="op" id="6914083">:=</span>&nbsp;<span class="keyword" id="6914086">map</span><span class="op" id="6914089">[</span><span class="builtintype" id="6914090">string</span><span class="op" id="6914096">]</span><span class="builtintype" id="6914097">bool</span><span class="op" id="6914101">{</span><span class="op" id="6914102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6914106">ctx</span>&nbsp;<span class="op" id="6914110">:=</span>&nbsp;<span class="op" id="6914113">&amp;</span><span class="ident" id="6914114">Context</span><span class="op" id="6914121">{</span><span class="ident" id="6914122">BuildTags</span><span class="op" id="6914131">:</span>&nbsp;<span class="op" id="6914133">[</span><span class="op" id="6914134">]</span><span class="builtintype" id="6914135">string</span><span class="op" id="6914141">{</span><span class="string" id="6914142">&#34;tag1&#34;</span><span class="op" id="6914148">}</span><span class="op" id="6914149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6914152">m</span>&nbsp;<span class="op" id="6914154">:=</span>&nbsp;<span class="keyword" id="6914157">map</span><span class="op" id="6914160">[</span><span class="builtintype" id="6914161">string</span><span class="op" id="6914167">]</span><span class="builtintype" id="6914168">bool</span><span class="op" id="6914172">{</span><span class="op" id="6914173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6914176">if</span>&nbsp;<span class="op" id="6914179">!</span><span class="ident" id="6914180">ctx</span><span class="op" id="6914183">.</span><span class="ident" id="6914184">shouldBuild</span><span class="op" id="6914195">(</span><span class="op" id="6914196">[</span><span class="op" id="6914197">]</span><span class="builtintype" id="6914198">byte</span><span class="op" id="6914202">(</span><span class="ident" id="6914203">file1</span><span class="op" id="6914208">)</span><span class="op" id="6914209">,</span>&nbsp;<span class="ident" id="6914211">m</span><span class="op" id="6914212">)</span>&nbsp;<span class="op" id="6914214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6914218">t</span><span class="op" id="6914219">.</span><span class="ident" id="6914220">Errorf</span><span class="op" id="6914226">(</span><span class="string" id="6914227">&#34;shouldBuild(file1)&nbsp;=&nbsp;false,&nbsp;want&nbsp;true&#34;</span><span class="op" id="6914266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6914269">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6914272">if</span>&nbsp;<span class="op" id="6914275">!</span><span class="ident" id="6914276">reflect</span><span class="op" id="6914283">.</span><span class="ident" id="6914284">DeepEqual</span><span class="op" id="6914293">(</span><span class="ident" id="6914294">m</span><span class="op" id="6914295">,</span>&nbsp;<span class="ident" id="6914297">want1</span><span class="op" id="6914302">)</span>&nbsp;<span class="op" id="6914304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6914308">t</span><span class="op" id="6914309">.</span><span class="ident" id="6914310">Errorf</span><span class="op" id="6914316">(</span><span class="string" id="6914317">&#34;shoudBuild(file1)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6914355">,</span>&nbsp;<span class="ident" id="6914357">m</span><span class="op" id="6914358">,</span>&nbsp;<span class="ident" id="6914360">want1</span><span class="op" id="6914365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6914368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6914372">m</span>&nbsp;<span class="op" id="6914374">=</span>&nbsp;<span class="keyword" id="6914376">map</span><span class="op" id="6914379">[</span><span class="builtintype" id="6914380">string</span><span class="op" id="6914386">]</span><span class="builtintype" id="6914387">bool</span><span class="op" id="6914391">{</span><span class="op" id="6914392">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6914395">if</span>&nbsp;<span class="ident" id="6914398">ctx</span><span class="op" id="6914401">.</span><span class="ident" id="6914402">shouldBuild</span><span class="op" id="6914413">(</span><span class="op" id="6914414">[</span><span class="op" id="6914415">]</span><span class="builtintype" id="6914416">byte</span><span class="op" id="6914420">(</span><span class="ident" id="6914421">file2</span><span class="op" id="6914426">)</span><span class="op" id="6914427">,</span>&nbsp;<span class="ident" id="6914429">m</span><span class="op" id="6914430">)</span>&nbsp;<span class="op" id="6914432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6914436">t</span><span class="op" id="6914437">.</span><span class="ident" id="6914438">Errorf</span><span class="op" id="6914444">(</span><span class="string" id="6914445">&#34;shouldBuild(file2)&nbsp;=&nbsp;true,&nbsp;want&nbsp;fakse&#34;</span><span class="op" id="6914484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6914487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6914490">if</span>&nbsp;<span class="op" id="6914493">!</span><span class="ident" id="6914494">reflect</span><span class="op" id="6914501">.</span><span class="ident" id="6914502">DeepEqual</span><span class="op" id="6914511">(</span><span class="ident" id="6914512">m</span><span class="op" id="6914513">,</span>&nbsp;<span class="ident" id="6914515">want2</span><span class="op" id="6914520">)</span>&nbsp;<span class="op" id="6914522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6914526">t</span><span class="op" id="6914527">.</span><span class="ident" id="6914528">Errorf</span><span class="op" id="6914534">(</span><span class="string" id="6914535">&#34;shoudBuild(file2)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6914573">,</span>&nbsp;<span class="ident" id="6914575">m</span><span class="op" id="6914576">,</span>&nbsp;<span class="ident" id="6914578">want2</span><span class="op" id="6914583">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6914586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6914590">m</span>&nbsp;<span class="op" id="6914592">=</span>&nbsp;<span class="keyword" id="6914594">map</span><span class="op" id="6914597">[</span><span class="builtintype" id="6914598">string</span><span class="op" id="6914604">]</span><span class="builtintype" id="6914605">bool</span><span class="op" id="6914609">{</span><span class="op" id="6914610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6914613">ctx</span>&nbsp;<span class="op" id="6914617">=</span>&nbsp;<span class="op" id="6914619">&amp;</span><span class="ident" id="6914620">Context</span><span class="op" id="6914627">{</span><span class="ident" id="6914628">BuildTags</span><span class="op" id="6914637">:</span>&nbsp;<span class="ident" id="6914639">nil</span><span class="op" id="6914642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6914645">if</span>&nbsp;<span class="op" id="6914648">!</span><span class="ident" id="6914649">ctx</span><span class="op" id="6914652">.</span><span class="ident" id="6914653">shouldBuild</span><span class="op" id="6914664">(</span><span class="op" id="6914665">[</span><span class="op" id="6914666">]</span><span class="builtintype" id="6914667">byte</span><span class="op" id="6914671">(</span><span class="ident" id="6914672">file3</span><span class="op" id="6914677">)</span><span class="op" id="6914678">,</span>&nbsp;<span class="ident" id="6914680">m</span><span class="op" id="6914681">)</span>&nbsp;<span class="op" id="6914683">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6914687">t</span><span class="op" id="6914688">.</span><span class="ident" id="6914689">Errorf</span><span class="op" id="6914695">(</span><span class="string" id="6914696">&#34;shouldBuild(file3)&nbsp;=&nbsp;false,&nbsp;want&nbsp;true&#34;</span><span class="op" id="6914735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6914738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6914741">if</span>&nbsp;<span class="op" id="6914744">!</span><span class="ident" id="6914745">reflect</span><span class="op" id="6914752">.</span><span class="ident" id="6914753">DeepEqual</span><span class="op" id="6914762">(</span><span class="ident" id="6914763">m</span><span class="op" id="6914764">,</span>&nbsp;<span class="ident" id="6914766">want3</span><span class="op" id="6914771">)</span>&nbsp;<span class="op" id="6914773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6914777">t</span><span class="op" id="6914778">.</span><span class="ident" id="6914779">Errorf</span><span class="op" id="6914785">(</span><span class="string" id="6914786">&#34;shoudBuild(file3)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6914824">,</span>&nbsp;<span class="ident" id="6914826">m</span><span class="op" id="6914827">,</span>&nbsp;<span class="ident" id="6914829">want3</span><span class="op" id="6914834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6914837">}</span><br>
<span class="lineno">160</span><span class="op" id="6914839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6914842">type</span>&nbsp;<span class="ident" id="6914847">readNopCloser</span>&nbsp;<span class="keyword" id="6914861">struct</span>&nbsp;<span class="op" id="6914868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6914871">io</span><span class="op" id="6914873">.</span><span class="ident" id="6914874">Reader</span><br>
<span class="lineno"></span><span class="op" id="6914881">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="6914884">func</span>&nbsp;<span class="op" id="6914889">(</span><span class="ident" id="6914890">r</span>&nbsp;<span class="ident" id="6914892">readNopCloser</span><span class="op" id="6914905">)</span>&nbsp;<span class="ident" id="6914907">Close</span><span class="op" id="6914912">(</span><span class="op" id="6914913">)</span>&nbsp;<span class="builtintype" id="6914915">error</span>&nbsp;<span class="op" id="6914921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6914924">return</span>&nbsp;<span class="ident" id="6914931">nil</span><br>
<span class="lineno"></span><span class="op" id="6914935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="6914938">var</span>&nbsp;<span class="op" id="6914942">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6914945">ctxtP9</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6914957">=</span>&nbsp;<span class="ident" id="6914959">Context</span><span class="op" id="6914966">{</span><span class="ident" id="6914967">GOARCH</span><span class="op" id="6914973">:</span>&nbsp;<span class="string" id="6914975">&#34;arm&#34;</span><span class="op" id="6914980">,</span>&nbsp;<span class="ident" id="6914982">GOOS</span><span class="op" id="6914986">:</span>&nbsp;<span class="string" id="6914988">&#34;plan9&#34;</span><span class="op" id="6914995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6914998">ctxtAndroid</span>&nbsp;<span class="op" id="6915010">=</span>&nbsp;<span class="ident" id="6915012">Context</span><span class="op" id="6915019">{</span><span class="ident" id="6915020">GOARCH</span><span class="op" id="6915026">:</span>&nbsp;<span class="string" id="6915028">&#34;arm&#34;</span><span class="op" id="6915033">,</span>&nbsp;<span class="ident" id="6915035">GOOS</span><span class="op" id="6915039">:</span>&nbsp;<span class="string" id="6915041">&#34;android&#34;</span><span class="op" id="6915050">}</span><br>
<span class="lineno"></span><span class="op" id="6915052">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="6915055">var</span>&nbsp;<span class="ident" id="6915059">matchFileTests</span>&nbsp;<span class="op" id="6915074">=</span>&nbsp;<span class="op" id="6915076">[</span><span class="op" id="6915077">]</span><span class="keyword" id="6915078">struct</span>&nbsp;<span class="op" id="6915085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6915088">ctxt</span>&nbsp;&nbsp;<span class="ident" id="6915094">Context</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6915103">name</span>&nbsp;&nbsp;<span class="builtintype" id="6915109">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6915117">data</span>&nbsp;&nbsp;<span class="builtintype" id="6915123">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6915131">match</span>&nbsp;<span class="builtintype" id="6915137">bool</span><br>
<span class="lineno">180</span><span class="op" id="6915142">}</span><span class="op" id="6915143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6915146">{</span><span class="ident" id="6915147">ctxtP9</span><span class="op" id="6915153">,</span>&nbsp;<span class="string" id="6915155">&#34;foo_arm.go&#34;</span><span class="op" id="6915167">,</span>&nbsp;<span class="string" id="6915169">&#34;&#34;</span><span class="op" id="6915171">,</span>&nbsp;<span class="builtintype" id="6915173">true</span><span class="op" id="6915177">}</span><span class="op" id="6915178">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6915181">{</span><span class="ident" id="6915182">ctxtP9</span><span class="op" id="6915188">,</span>&nbsp;<span class="string" id="6915190">&#34;foo1_arm.go&#34;</span><span class="op" id="6915203">,</span>&nbsp;<span class="string" id="6915205">&#34;//&nbsp;+build&nbsp;linux\n\npackage&nbsp;main\n&#34;</span><span class="op" id="6915240">,</span>&nbsp;<span class="builtintype" id="6915242">false</span><span class="op" id="6915247">}</span><span class="op" id="6915248">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6915251">{</span><span class="ident" id="6915252">ctxtP9</span><span class="op" id="6915258">,</span>&nbsp;<span class="string" id="6915260">&#34;foo_darwin.go&#34;</span><span class="op" id="6915275">,</span>&nbsp;<span class="string" id="6915277">&#34;&#34;</span><span class="op" id="6915279">,</span>&nbsp;<span class="builtintype" id="6915281">false</span><span class="op" id="6915286">}</span><span class="op" id="6915287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6915290">{</span><span class="ident" id="6915291">ctxtP9</span><span class="op" id="6915297">,</span>&nbsp;<span class="string" id="6915299">&#34;foo.go&#34;</span><span class="op" id="6915307">,</span>&nbsp;<span class="string" id="6915309">&#34;&#34;</span><span class="op" id="6915311">,</span>&nbsp;<span class="builtintype" id="6915313">true</span><span class="op" id="6915317">}</span><span class="op" id="6915318">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6915321">{</span><span class="ident" id="6915322">ctxtP9</span><span class="op" id="6915328">,</span>&nbsp;<span class="string" id="6915330">&#34;foo1.go&#34;</span><span class="op" id="6915339">,</span>&nbsp;<span class="string" id="6915341">&#34;//&nbsp;+build&nbsp;linux\n\npackage&nbsp;main\n&#34;</span><span class="op" id="6915376">,</span>&nbsp;<span class="builtintype" id="6915378">false</span><span class="op" id="6915383">}</span><span class="op" id="6915384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6915387">{</span><span class="ident" id="6915388">ctxtP9</span><span class="op" id="6915394">,</span>&nbsp;<span class="string" id="6915396">&#34;foo.badsuffix&#34;</span><span class="op" id="6915411">,</span>&nbsp;<span class="string" id="6915413">&#34;&#34;</span><span class="op" id="6915415">,</span>&nbsp;<span class="builtintype" id="6915417">false</span><span class="op" id="6915422">}</span><span class="op" id="6915423">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6915426">{</span><span class="ident" id="6915427">ctxtAndroid</span><span class="op" id="6915438">,</span>&nbsp;<span class="string" id="6915440">&#34;foo_linux.go&#34;</span><span class="op" id="6915454">,</span>&nbsp;<span class="string" id="6915456">&#34;&#34;</span><span class="op" id="6915458">,</span>&nbsp;<span class="builtintype" id="6915460">true</span><span class="op" id="6915464">}</span><span class="op" id="6915465">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6915468">{</span><span class="ident" id="6915469">ctxtAndroid</span><span class="op" id="6915480">,</span>&nbsp;<span class="string" id="6915482">&#34;foo_android.go&#34;</span><span class="op" id="6915498">,</span>&nbsp;<span class="string" id="6915500">&#34;&#34;</span><span class="op" id="6915502">,</span>&nbsp;<span class="builtintype" id="6915504">true</span><span class="op" id="6915508">}</span><span class="op" id="6915509">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6915512">{</span><span class="ident" id="6915513">ctxtAndroid</span><span class="op" id="6915524">,</span>&nbsp;<span class="string" id="6915526">&#34;foo_plan9.go&#34;</span><span class="op" id="6915540">,</span>&nbsp;<span class="string" id="6915542">&#34;&#34;</span><span class="op" id="6915544">,</span>&nbsp;<span class="builtintype" id="6915546">false</span><span class="op" id="6915551">}</span><span class="op" id="6915552">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6915555">{</span><span class="ident" id="6915556">ctxtAndroid</span><span class="op" id="6915567">,</span>&nbsp;<span class="string" id="6915569">&#34;android.go&#34;</span><span class="op" id="6915581">,</span>&nbsp;<span class="string" id="6915583">&#34;&#34;</span><span class="op" id="6915585">,</span>&nbsp;<span class="builtintype" id="6915587">true</span><span class="op" id="6915591">}</span><span class="op" id="6915592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6915595">{</span><span class="ident" id="6915596">ctxtAndroid</span><span class="op" id="6915607">,</span>&nbsp;<span class="string" id="6915609">&#34;plan9.go&#34;</span><span class="op" id="6915619">,</span>&nbsp;<span class="string" id="6915621">&#34;&#34;</span><span class="op" id="6915623">,</span>&nbsp;<span class="builtintype" id="6915625">true</span><span class="op" id="6915629">}</span><span class="op" id="6915630">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6915633">{</span><span class="ident" id="6915634">ctxtAndroid</span><span class="op" id="6915645">,</span>&nbsp;<span class="string" id="6915647">&#34;plan9_test.go&#34;</span><span class="op" id="6915662">,</span>&nbsp;<span class="string" id="6915664">&#34;&#34;</span><span class="op" id="6915666">,</span>&nbsp;<span class="builtintype" id="6915668">true</span><span class="op" id="6915672">}</span><span class="op" id="6915673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6915676">{</span><span class="ident" id="6915677">ctxtAndroid</span><span class="op" id="6915688">,</span>&nbsp;<span class="string" id="6915690">&#34;arm.s&#34;</span><span class="op" id="6915697">,</span>&nbsp;<span class="string" id="6915699">&#34;&#34;</span><span class="op" id="6915701">,</span>&nbsp;<span class="builtintype" id="6915703">true</span><span class="op" id="6915707">}</span><span class="op" id="6915708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6915711">{</span><span class="ident" id="6915712">ctxtAndroid</span><span class="op" id="6915723">,</span>&nbsp;<span class="string" id="6915725">&#34;amd64.s&#34;</span><span class="op" id="6915734">,</span>&nbsp;<span class="string" id="6915736">&#34;&#34;</span><span class="op" id="6915738">,</span>&nbsp;<span class="builtintype" id="6915740">true</span><span class="op" id="6915744">}</span><span class="op" id="6915745">,</span><br>
<span class="lineno">195</span><span class="op" id="6915747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6915750">func</span>&nbsp;<span class="ident" id="6915755">TestMatchFile</span><span class="op" id="6915768">(</span><span class="ident" id="6915769">t</span>&nbsp;<span class="op" id="6915771">*</span><span class="ident" id="6915772">testing</span><span class="op" id="6915779">.</span><span class="ident" id="6915780">T</span><span class="op" id="6915781">)</span>&nbsp;<span class="op" id="6915783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6915786">for</span>&nbsp;<span class="ident" id="6915790">_</span><span class="op" id="6915791">,</span>&nbsp;<span class="ident" id="6915793">tt</span>&nbsp;<span class="op" id="6915796">:=</span>&nbsp;<span class="keyword" id="6915799">range</span>&nbsp;<span class="ident" id="6915805">matchFileTests</span>&nbsp;<span class="op" id="6915820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6915824">ctxt</span>&nbsp;<span class="op" id="6915829">:=</span>&nbsp;<span class="ident" id="6915832">tt</span><span class="op" id="6915834">.</span><span class="ident" id="6915835">ctxt</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6915842">ctxt</span><span class="op" id="6915846">.</span><span class="ident" id="6915847">OpenFile</span>&nbsp;<span class="op" id="6915856">=</span>&nbsp;<span class="keyword" id="6915858">func</span><span class="op" id="6915862">(</span><span class="ident" id="6915863">path</span>&nbsp;<span class="builtintype" id="6915868">string</span><span class="op" id="6915874">)</span>&nbsp;<span class="op" id="6915876">(</span><span class="ident" id="6915877">r</span>&nbsp;<span class="ident" id="6915879">io</span><span class="op" id="6915881">.</span><span class="ident" id="6915882">ReadCloser</span><span class="op" id="6915892">,</span>&nbsp;<span class="ident" id="6915894">err</span>&nbsp;<span class="builtintype" id="6915898">error</span><span class="op" id="6915903">)</span>&nbsp;<span class="op" id="6915905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6915910">if</span>&nbsp;<span class="ident" id="6915913">path</span>&nbsp;<span class="op" id="6915918">!=</span>&nbsp;<span class="string" id="6915921">&#34;x+&#34;</span><span class="op" id="6915925">+</span><span class="ident" id="6915926">tt</span><span class="op" id="6915928">.</span><span class="ident" id="6915929">name</span>&nbsp;<span class="op" id="6915934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6915940">t</span><span class="op" id="6915941">.</span><span class="ident" id="6915942">Fatalf</span><span class="op" id="6915948">(</span><span class="string" id="6915949">&#34;OpenFile&nbsp;asked&nbsp;for&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="6915985">,</span>&nbsp;<span class="ident" id="6915987">path</span><span class="op" id="6915991">,</span>&nbsp;<span class="string" id="6915993">&#34;x+&#34;</span><span class="op" id="6915997">+</span><span class="ident" id="6915998">tt</span><span class="op" id="6916000">.</span><span class="ident" id="6916001">name</span><span class="op" id="6916005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6916010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6916015">return</span>&nbsp;<span class="op" id="6916022">&amp;</span><span class="ident" id="6916023">readNopCloser</span><span class="op" id="6916036">{</span><span class="ident" id="6916037">strings</span><span class="op" id="6916044">.</span><span class="ident" id="6916045">NewReader</span><span class="op" id="6916054">(</span><span class="ident" id="6916055">tt</span><span class="op" id="6916057">.</span><span class="ident" id="6916058">data</span><span class="op" id="6916062">)</span><span class="op" id="6916063">}</span><span class="op" id="6916064">,</span>&nbsp;<span class="ident" id="6916066">nil</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6916072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6916076">ctxt</span><span class="op" id="6916080">.</span><span class="ident" id="6916081">JoinPath</span>&nbsp;<span class="op" id="6916090">=</span>&nbsp;<span class="keyword" id="6916092">func</span><span class="op" id="6916096">(</span><span class="ident" id="6916097">elem</span>&nbsp;<span class="op" id="6916102">...</span><span class="builtintype" id="6916105">string</span><span class="op" id="6916111">)</span>&nbsp;<span class="builtintype" id="6916113">string</span>&nbsp;<span class="op" id="6916120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6916125">return</span>&nbsp;<span class="ident" id="6916132">strings</span><span class="op" id="6916139">.</span><span class="ident" id="6916140">Join</span><span class="op" id="6916144">(</span><span class="ident" id="6916145">elem</span><span class="op" id="6916149">,</span>&nbsp;<span class="string" id="6916151">&#34;+&#34;</span><span class="op" id="6916154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6916158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6916162">match</span><span class="op" id="6916167">,</span>&nbsp;<span class="ident" id="6916169">err</span>&nbsp;<span class="op" id="6916173">:=</span>&nbsp;<span class="ident" id="6916176">ctxt</span><span class="op" id="6916180">.</span><span class="ident" id="6916181">MatchFile</span><span class="op" id="6916190">(</span><span class="string" id="6916191">&#34;x&#34;</span><span class="op" id="6916194">,</span>&nbsp;<span class="ident" id="6916196">tt</span><span class="op" id="6916198">.</span><span class="ident" id="6916199">name</span><span class="op" id="6916203">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6916207">if</span>&nbsp;<span class="ident" id="6916210">match</span>&nbsp;<span class="op" id="6916216">!=</span>&nbsp;<span class="ident" id="6916219">tt</span><span class="op" id="6916221">.</span><span class="ident" id="6916222">match</span>&nbsp;<span class="op" id="6916228">||</span>&nbsp;<span class="ident" id="6916231">err</span>&nbsp;<span class="op" id="6916235">!=</span>&nbsp;<span class="ident" id="6916238">nil</span>&nbsp;<span class="op" id="6916242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6916247">t</span><span class="op" id="6916248">.</span><span class="ident" id="6916249">Fatalf</span><span class="op" id="6916255">(</span><span class="string" id="6916256">&#34;MatchFile(%q)&nbsp;=&nbsp;%v,&nbsp;%v,&nbsp;want&nbsp;%v,&nbsp;nil&#34;</span><span class="op" id="6916294">,</span>&nbsp;<span class="ident" id="6916296">tt</span><span class="op" id="6916298">.</span><span class="ident" id="6916299">name</span><span class="op" id="6916303">,</span>&nbsp;<span class="ident" id="6916305">match</span><span class="op" id="6916310">,</span>&nbsp;<span class="ident" id="6916312">err</span><span class="op" id="6916315">,</span>&nbsp;<span class="ident" id="6916317">tt</span><span class="op" id="6916319">.</span><span class="ident" id="6916320">match</span><span class="op" id="6916325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6916329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6916332">}</span><br>
<span class="lineno"></span><span class="op" id="6916334">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="6916337">func</span>&nbsp;<span class="ident" id="6916342">TestImportCmd</span><span class="op" id="6916355">(</span><span class="ident" id="6916356">t</span>&nbsp;<span class="op" id="6916358">*</span><span class="ident" id="6916359">testing</span><span class="op" id="6916366">.</span><span class="ident" id="6916367">T</span><span class="op" id="6916368">)</span>&nbsp;<span class="op" id="6916370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6916373">p</span><span class="op" id="6916374">,</span>&nbsp;<span class="ident" id="6916376">err</span>&nbsp;<span class="op" id="6916380">:=</span>&nbsp;<span class="ident" id="6916383">Import</span><span class="op" id="6916389">(</span><span class="string" id="6916390">&#34;cmd/internal/objfile&#34;</span><span class="op" id="6916412">,</span>&nbsp;<span class="string" id="6916414">&#34;&#34;</span><span class="op" id="6916416">,</span>&nbsp;<span class="num" id="6916418">0</span><span class="op" id="6916419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6916422">if</span>&nbsp;<span class="ident" id="6916425">err</span>&nbsp;<span class="op" id="6916429">!=</span>&nbsp;<span class="ident" id="6916432">nil</span>&nbsp;<span class="op" id="6916436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6916440">t</span><span class="op" id="6916441">.</span><span class="ident" id="6916442">Fatal</span><span class="op" id="6916447">(</span><span class="ident" id="6916448">err</span><span class="op" id="6916451">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6916454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6916457">if</span>&nbsp;<span class="op" id="6916460">!</span><span class="ident" id="6916461">strings</span><span class="op" id="6916468">.</span><span class="ident" id="6916469">HasSuffix</span><span class="op" id="6916478">(</span><span class="ident" id="6916479">filepath</span><span class="op" id="6916487">.</span><span class="ident" id="6916488">ToSlash</span><span class="op" id="6916495">(</span><span class="ident" id="6916496">p</span><span class="op" id="6916497">.</span><span class="ident" id="6916498">Dir</span><span class="op" id="6916501">)</span><span class="op" id="6916502">,</span>&nbsp;<span class="string" id="6916504">&#34;src/cmd/internal/objfile&#34;</span><span class="op" id="6916530">)</span>&nbsp;<span class="op" id="6916532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6916536">t</span><span class="op" id="6916537">.</span><span class="ident" id="6916538">Fatalf</span><span class="op" id="6916544">(</span><span class="string" id="6916545">&#34;Import&nbsp;cmd/internal/objfile&nbsp;returned&nbsp;Dir=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6916599">,</span>&nbsp;<span class="ident" id="6916601">filepath</span><span class="op" id="6916609">.</span><span class="ident" id="6916610">ToSlash</span><span class="op" id="6916617">(</span><span class="ident" id="6916618">p</span><span class="op" id="6916619">.</span><span class="ident" id="6916620">Dir</span><span class="op" id="6916623">)</span><span class="op" id="6916624">,</span>&nbsp;<span class="string" id="6916626">&#34;.../src/cmd/internal/objfile&#34;</span><span class="op" id="6916656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6916659">}</span><br>
<span class="lineno"></span><span class="op" id="6916661">}</span>
</div>
</body>
</html>
