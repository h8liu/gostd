<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4695407">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4695462">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4695516">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4695567">package</span>&nbsp;<span class="ident" id="4695575">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4695580">import</span>&nbsp;<span class="op" id="4695587">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4695590">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4695602">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4695609">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4695612">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4695692">//&nbsp;Export&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4695713">//&nbsp;exportFilter&nbsp;is&nbsp;a&nbsp;special&nbsp;filter&nbsp;function&nbsp;to&nbsp;extract&nbsp;exported&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="4695785">func</span>&nbsp;<span class="ident" id="4695790">exportFilter</span><span class="op" id="4695802">(</span><span class="ident" id="4695803">name</span>&nbsp;<span class="builtintype" id="4695808">string</span><span class="op" id="4695814">)</span>&nbsp;<span class="builtintype" id="4695816">bool</span>&nbsp;<span class="op" id="4695821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4695824">return</span>&nbsp;<span class="ident" id="4695831">IsExported</span><span class="op" id="4695841">(</span><span class="ident" id="4695842">name</span><span class="op" id="4695846">)</span><br>
<span class="lineno"></span><span class="op" id="4695848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4695851">//&nbsp;FileExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4695920">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain:&nbsp;all&nbsp;top-level&nbsp;identifiers&nbsp;which&nbsp;are&nbsp;not&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="4696000">//&nbsp;and&nbsp;their&nbsp;associated&nbsp;information&nbsp;(such&nbsp;as&nbsp;type,&nbsp;initial&nbsp;value,&nbsp;or&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="4696078">//&nbsp;body)&nbsp;are&nbsp;removed.&nbsp;Non-exported&nbsp;fields&nbsp;and&nbsp;methods&nbsp;of&nbsp;exported&nbsp;types&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4696154">//&nbsp;stripped.&nbsp;The&nbsp;File.Comments&nbsp;list&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno">25</span><span class="comment" id="4696206">//</span><br>
<span class="lineno"></span><span class="comment" id="4696209">//&nbsp;FileExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="4696273">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="4696304">//</span><br>
<span class="lineno"></span><span class="keyword" id="4696307">func</span>&nbsp;<span class="ident" id="4696312">FileExports</span><span class="op" id="4696323">(</span><span class="ident" id="4696324">src</span>&nbsp;<span class="op" id="4696328">*</span><span class="ident" id="4696329">File</span><span class="op" id="4696333">)</span>&nbsp;<span class="builtintype" id="4696335">bool</span>&nbsp;<span class="op" id="4696340">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4696343">return</span>&nbsp;<span class="ident" id="4696350">filterFile</span><span class="op" id="4696360">(</span><span class="ident" id="4696361">src</span><span class="op" id="4696364">,</span>&nbsp;<span class="ident" id="4696366">exportFilter</span><span class="op" id="4696378">,</span>&nbsp;<span class="builtintype" id="4696380">true</span><span class="op" id="4696384">)</span><br>
<span class="lineno"></span><span class="op" id="4696386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4696389">//&nbsp;PackageExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4696457">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not&nbsp;changed,&nbsp;so&nbsp;that</span><br>
<span class="lineno">35</span><span class="comment" id="4696531">//&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="4696592">//</span><br>
<span class="lineno"></span><span class="comment" id="4696595">//&nbsp;PackageExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="4696662">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="4696693">//</span><br>
<span class="lineno">40</span><span class="keyword" id="4696696">func</span>&nbsp;<span class="ident" id="4696701">PackageExports</span><span class="op" id="4696715">(</span><span class="ident" id="4696716">pkg</span>&nbsp;<span class="op" id="4696720">*</span><span class="ident" id="4696721">Package</span><span class="op" id="4696728">)</span>&nbsp;<span class="builtintype" id="4696730">bool</span>&nbsp;<span class="op" id="4696735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4696738">return</span>&nbsp;<span class="ident" id="4696745">filterPackage</span><span class="op" id="4696758">(</span><span class="ident" id="4696759">pkg</span><span class="op" id="4696762">,</span>&nbsp;<span class="ident" id="4696764">exportFilter</span><span class="op" id="4696776">,</span>&nbsp;<span class="builtintype" id="4696778">true</span><span class="op" id="4696782">)</span><br>
<span class="lineno"></span><span class="op" id="4696784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4696787">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">45</span><span class="comment" id="4696867">//&nbsp;General&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4696889">type</span>&nbsp;<span class="ident" id="4696894">Filter</span>&nbsp;<span class="keyword" id="4696901">func</span><span class="op" id="4696905">(</span><span class="builtintype" id="4696906">string</span><span class="op" id="4696912">)</span>&nbsp;<span class="builtintype" id="4696914">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4696920">func</span>&nbsp;<span class="ident" id="4696925">filterIdentList</span><span class="op" id="4696940">(</span><span class="ident" id="4696941">list</span>&nbsp;<span class="op" id="4696946">[</span><span class="op" id="4696947">]</span><span class="op" id="4696948">*</span><span class="ident" id="4696949">Ident</span><span class="op" id="4696954">,</span>&nbsp;<span class="ident" id="4696956">f</span>&nbsp;<span class="ident" id="4696958">Filter</span><span class="op" id="4696964">)</span>&nbsp;<span class="op" id="4696966">[</span><span class="op" id="4696967">]</span><span class="op" id="4696968">*</span><span class="ident" id="4696969">Ident</span>&nbsp;<span class="op" id="4696975">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4696978">j</span>&nbsp;<span class="op" id="4696980">:=</span>&nbsp;<span class="num" id="4696983">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4696986">for</span>&nbsp;<span class="ident" id="4696990">_</span><span class="op" id="4696991">,</span>&nbsp;<span class="ident" id="4696993">x</span>&nbsp;<span class="op" id="4696995">:=</span>&nbsp;<span class="keyword" id="4696998">range</span>&nbsp;<span class="ident" id="4697004">list</span>&nbsp;<span class="op" id="4697009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697013">if</span>&nbsp;<span class="ident" id="4697016">f</span><span class="op" id="4697017">(</span><span class="ident" id="4697018">x</span><span class="op" id="4697019">.</span><span class="ident" id="4697020">Name</span><span class="op" id="4697024">)</span>&nbsp;<span class="op" id="4697026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697031">list</span><span class="op" id="4697035">[</span><span class="ident" id="4697036">j</span><span class="op" id="4697037">]</span>&nbsp;<span class="op" id="4697039">=</span>&nbsp;<span class="ident" id="4697041">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697046">j</span><span class="op" id="4697047">++</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4697052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4697055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697058">return</span>&nbsp;<span class="ident" id="4697065">list</span><span class="op" id="4697069">[</span><span class="num" id="4697070">0</span><span class="op" id="4697071">:</span><span class="ident" id="4697072">j</span><span class="op" id="4697073">]</span><br>
<span class="lineno"></span><span class="op" id="4697075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="4697078">//&nbsp;fieldName&nbsp;assumes&nbsp;that&nbsp;x&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;an&nbsp;anonymous&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4697144">//&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;field&nbsp;name.&nbsp;If&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;acceptable</span><br>
<span class="lineno"></span><span class="comment" id="4697211">//&nbsp;anonymous&nbsp;field,&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="4697250">//</span><br>
<span class="lineno"></span><span class="keyword" id="4697253">func</span>&nbsp;<span class="ident" id="4697258">fieldName</span><span class="op" id="4697267">(</span><span class="ident" id="4697268">x</span>&nbsp;<span class="ident" id="4697270">Expr</span><span class="op" id="4697274">)</span>&nbsp;<span class="op" id="4697276">*</span><span class="ident" id="4697277">Ident</span>&nbsp;<span class="op" id="4697283">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697286">switch</span>&nbsp;<span class="ident" id="4697293">t</span>&nbsp;<span class="op" id="4697295">:=</span>&nbsp;<span class="ident" id="4697298">x</span><span class="op" id="4697299">.</span><span class="op" id="4697300">(</span><span class="keyword" id="4697301">type</span><span class="op" id="4697305">)</span>&nbsp;<span class="op" id="4697307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697310">case</span>&nbsp;<span class="op" id="4697315">*</span><span class="ident" id="4697316">Ident</span><span class="op" id="4697321">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697325">return</span>&nbsp;<span class="ident" id="4697332">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697335">case</span>&nbsp;<span class="op" id="4697340">*</span><span class="ident" id="4697341">SelectorExpr</span><span class="op" id="4697353">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697357">if</span>&nbsp;<span class="ident" id="4697360">_</span><span class="op" id="4697361">,</span>&nbsp;<span class="ident" id="4697363">ok</span>&nbsp;<span class="op" id="4697366">:=</span>&nbsp;<span class="ident" id="4697369">t</span><span class="op" id="4697370">.</span><span class="ident" id="4697371">X</span><span class="op" id="4697372">.</span><span class="op" id="4697373">(</span><span class="op" id="4697374">*</span><span class="ident" id="4697375">Ident</span><span class="op" id="4697380">)</span><span class="op" id="4697381">;</span>&nbsp;<span class="ident" id="4697383">ok</span>&nbsp;<span class="op" id="4697386">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697391">return</span>&nbsp;<span class="ident" id="4697398">t</span><span class="op" id="4697399">.</span><span class="ident" id="4697400">Sel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4697406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697409">case</span>&nbsp;<span class="op" id="4697414">*</span><span class="ident" id="4697415">StarExpr</span><span class="op" id="4697423">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697427">return</span>&nbsp;<span class="ident" id="4697434">fieldName</span><span class="op" id="4697443">(</span><span class="ident" id="4697444">t</span><span class="op" id="4697445">.</span><span class="ident" id="4697446">X</span><span class="op" id="4697447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4697450">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697453">return</span>&nbsp;<span class="ident" id="4697460">nil</span><br>
<span class="lineno"></span><span class="op" id="4697464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4697467">func</span>&nbsp;<span class="ident" id="4697472">filterFieldList</span><span class="op" id="4697487">(</span><span class="ident" id="4697488">fields</span>&nbsp;<span class="op" id="4697495">*</span><span class="ident" id="4697496">FieldList</span><span class="op" id="4697505">,</span>&nbsp;<span class="ident" id="4697507">filter</span>&nbsp;<span class="ident" id="4697514">Filter</span><span class="op" id="4697520">,</span>&nbsp;<span class="ident" id="4697522">export</span>&nbsp;<span class="builtintype" id="4697529">bool</span><span class="op" id="4697533">)</span>&nbsp;<span class="op" id="4697535">(</span><span class="ident" id="4697536">removedFields</span>&nbsp;<span class="builtintype" id="4697550">bool</span><span class="op" id="4697554">)</span>&nbsp;<span class="op" id="4697556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697559">if</span>&nbsp;<span class="ident" id="4697562">fields</span>&nbsp;<span class="op" id="4697569">==</span>&nbsp;<span class="ident" id="4697572">nil</span>&nbsp;<span class="op" id="4697576">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697580">return</span>&nbsp;<span class="builtintype" id="4697587">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4697594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697597">list</span>&nbsp;<span class="op" id="4697602">:=</span>&nbsp;<span class="ident" id="4697605">fields</span><span class="op" id="4697611">.</span><span class="ident" id="4697612">List</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697618">j</span>&nbsp;<span class="op" id="4697620">:=</span>&nbsp;<span class="num" id="4697623">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697626">for</span>&nbsp;<span class="ident" id="4697630">_</span><span class="op" id="4697631">,</span>&nbsp;<span class="ident" id="4697633">f</span>&nbsp;<span class="op" id="4697635">:=</span>&nbsp;<span class="keyword" id="4697638">range</span>&nbsp;<span class="ident" id="4697644">list</span>&nbsp;<span class="op" id="4697649">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697653">keepField</span>&nbsp;<span class="op" id="4697663">:=</span>&nbsp;<span class="builtintype" id="4697666">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697674">if</span>&nbsp;<span class="builtinfunc" id="4697677">len</span><span class="op" id="4697680">(</span><span class="ident" id="4697681">f</span><span class="op" id="4697682">.</span><span class="ident" id="4697683">Names</span><span class="op" id="4697688">)</span>&nbsp;<span class="op" id="4697690">==</span>&nbsp;<span class="num" id="4697693">0</span>&nbsp;<span class="op" id="4697695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4697700">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697722">name</span>&nbsp;<span class="op" id="4697727">:=</span>&nbsp;<span class="ident" id="4697730">fieldName</span><span class="op" id="4697739">(</span><span class="ident" id="4697740">f</span><span class="op" id="4697741">.</span><span class="ident" id="4697742">Type</span><span class="op" id="4697746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697751">keepField</span>&nbsp;<span class="op" id="4697761">=</span>&nbsp;<span class="ident" id="4697763">name</span>&nbsp;<span class="op" id="4697768">!=</span>&nbsp;<span class="ident" id="4697771">nil</span>&nbsp;<span class="op" id="4697775">&amp;&amp;</span>&nbsp;<span class="ident" id="4697778">filter</span><span class="op" id="4697784">(</span><span class="ident" id="4697785">name</span><span class="op" id="4697789">.</span><span class="ident" id="4697790">Name</span><span class="op" id="4697794">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4697798">}</span>&nbsp;<span class="keyword" id="4697800">else</span>&nbsp;<span class="op" id="4697805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697810">n</span>&nbsp;<span class="op" id="4697812">:=</span>&nbsp;<span class="builtinfunc" id="4697815">len</span><span class="op" id="4697818">(</span><span class="ident" id="4697819">f</span><span class="op" id="4697820">.</span><span class="ident" id="4697821">Names</span><span class="op" id="4697826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697831">f</span><span class="op" id="4697832">.</span><span class="ident" id="4697833">Names</span>&nbsp;<span class="op" id="4697839">=</span>&nbsp;<span class="ident" id="4697841">filterIdentList</span><span class="op" id="4697856">(</span><span class="ident" id="4697857">f</span><span class="op" id="4697858">.</span><span class="ident" id="4697859">Names</span><span class="op" id="4697864">,</span>&nbsp;<span class="ident" id="4697866">filter</span><span class="op" id="4697872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697877">if</span>&nbsp;<span class="builtinfunc" id="4697880">len</span><span class="op" id="4697883">(</span><span class="ident" id="4697884">f</span><span class="op" id="4697885">.</span><span class="ident" id="4697886">Names</span><span class="op" id="4697891">)</span>&nbsp;<span class="op" id="4697893">&lt;</span>&nbsp;<span class="ident" id="4697895">n</span>&nbsp;<span class="op" id="4697897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697903">removedFields</span>&nbsp;<span class="op" id="4697917">=</span>&nbsp;<span class="builtintype" id="4697919">true</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4697927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697932">keepField</span>&nbsp;<span class="op" id="4697942">=</span>&nbsp;<span class="builtinfunc" id="4697944">len</span><span class="op" id="4697947">(</span><span class="ident" id="4697948">f</span><span class="op" id="4697949">.</span><span class="ident" id="4697950">Names</span><span class="op" id="4697955">)</span>&nbsp;<span class="op" id="4697957">&gt;</span>&nbsp;<span class="num" id="4697959">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4697963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697967">if</span>&nbsp;<span class="ident" id="4697970">keepField</span>&nbsp;<span class="op" id="4697980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697985">if</span>&nbsp;<span class="ident" id="4697988">export</span>&nbsp;<span class="op" id="4697995">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698001">filterType</span><span class="op" id="4698011">(</span><span class="ident" id="4698012">f</span><span class="op" id="4698013">.</span><span class="ident" id="4698014">Type</span><span class="op" id="4698018">,</span>&nbsp;<span class="ident" id="4698020">filter</span><span class="op" id="4698026">,</span>&nbsp;<span class="ident" id="4698028">export</span><span class="op" id="4698034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4698039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698044">list</span><span class="op" id="4698048">[</span><span class="ident" id="4698049">j</span><span class="op" id="4698050">]</span>&nbsp;<span class="op" id="4698052">=</span>&nbsp;<span class="ident" id="4698054">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698059">j</span><span class="op" id="4698060">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4698065">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4698068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698071">if</span>&nbsp;<span class="ident" id="4698074">j</span>&nbsp;<span class="op" id="4698076">&lt;</span>&nbsp;<span class="builtinfunc" id="4698078">len</span><span class="op" id="4698081">(</span><span class="ident" id="4698082">list</span><span class="op" id="4698086">)</span>&nbsp;<span class="op" id="4698088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698092">removedFields</span>&nbsp;<span class="op" id="4698106">=</span>&nbsp;<span class="builtintype" id="4698108">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4698114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698117">fields</span><span class="op" id="4698123">.</span><span class="ident" id="4698124">List</span>&nbsp;<span class="op" id="4698129">=</span>&nbsp;<span class="ident" id="4698131">list</span><span class="op" id="4698135">[</span><span class="num" id="4698136">0</span><span class="op" id="4698137">:</span><span class="ident" id="4698138">j</span><span class="op" id="4698139">]</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698142">return</span><br>
<span class="lineno"></span><span class="op" id="4698149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4698152">func</span>&nbsp;<span class="ident" id="4698157">filterParamList</span><span class="op" id="4698172">(</span><span class="ident" id="4698173">fields</span>&nbsp;<span class="op" id="4698180">*</span><span class="ident" id="4698181">FieldList</span><span class="op" id="4698190">,</span>&nbsp;<span class="ident" id="4698192">filter</span>&nbsp;<span class="ident" id="4698199">Filter</span><span class="op" id="4698205">,</span>&nbsp;<span class="ident" id="4698207">export</span>&nbsp;<span class="builtintype" id="4698214">bool</span><span class="op" id="4698218">)</span>&nbsp;<span class="builtintype" id="4698220">bool</span>&nbsp;<span class="op" id="4698225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698228">if</span>&nbsp;<span class="ident" id="4698231">fields</span>&nbsp;<span class="op" id="4698238">==</span>&nbsp;<span class="ident" id="4698241">nil</span>&nbsp;<span class="op" id="4698245">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698249">return</span>&nbsp;<span class="builtintype" id="4698256">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4698263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698266">var</span>&nbsp;<span class="ident" id="4698270">b</span>&nbsp;<span class="builtintype" id="4698272">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698278">for</span>&nbsp;<span class="ident" id="4698282">_</span><span class="op" id="4698283">,</span>&nbsp;<span class="ident" id="4698285">f</span>&nbsp;<span class="op" id="4698287">:=</span>&nbsp;<span class="keyword" id="4698290">range</span>&nbsp;<span class="ident" id="4698296">fields</span><span class="op" id="4698302">.</span><span class="ident" id="4698303">List</span>&nbsp;<span class="op" id="4698308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698312">if</span>&nbsp;<span class="ident" id="4698315">filterType</span><span class="op" id="4698325">(</span><span class="ident" id="4698326">f</span><span class="op" id="4698327">.</span><span class="ident" id="4698328">Type</span><span class="op" id="4698332">,</span>&nbsp;<span class="ident" id="4698334">filter</span><span class="op" id="4698340">,</span>&nbsp;<span class="ident" id="4698342">export</span><span class="op" id="4698348">)</span>&nbsp;<span class="op" id="4698350">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698355">b</span>&nbsp;<span class="op" id="4698357">=</span>&nbsp;<span class="builtintype" id="4698359">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4698366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4698369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698372">return</span>&nbsp;<span class="ident" id="4698379">b</span><br>
<span class="lineno"></span><span class="op" id="4698381">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="4698384">func</span>&nbsp;<span class="ident" id="4698389">filterType</span><span class="op" id="4698399">(</span><span class="ident" id="4698400">typ</span>&nbsp;<span class="ident" id="4698404">Expr</span><span class="op" id="4698408">,</span>&nbsp;<span class="ident" id="4698410">f</span>&nbsp;<span class="ident" id="4698412">Filter</span><span class="op" id="4698418">,</span>&nbsp;<span class="ident" id="4698420">export</span>&nbsp;<span class="builtintype" id="4698427">bool</span><span class="op" id="4698431">)</span>&nbsp;<span class="builtintype" id="4698433">bool</span>&nbsp;<span class="op" id="4698438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698441">switch</span>&nbsp;<span class="ident" id="4698448">t</span>&nbsp;<span class="op" id="4698450">:=</span>&nbsp;<span class="ident" id="4698453">typ</span><span class="op" id="4698456">.</span><span class="op" id="4698457">(</span><span class="keyword" id="4698458">type</span><span class="op" id="4698462">)</span>&nbsp;<span class="op" id="4698464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698467">case</span>&nbsp;<span class="op" id="4698472">*</span><span class="ident" id="4698473">Ident</span><span class="op" id="4698478">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698482">return</span>&nbsp;<span class="ident" id="4698489">f</span><span class="op" id="4698490">(</span><span class="ident" id="4698491">t</span><span class="op" id="4698492">.</span><span class="ident" id="4698493">Name</span><span class="op" id="4698497">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698500">case</span>&nbsp;<span class="op" id="4698505">*</span><span class="ident" id="4698506">ParenExpr</span><span class="op" id="4698515">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698519">return</span>&nbsp;<span class="ident" id="4698526">filterType</span><span class="op" id="4698536">(</span><span class="ident" id="4698537">t</span><span class="op" id="4698538">.</span><span class="ident" id="4698539">X</span><span class="op" id="4698540">,</span>&nbsp;<span class="ident" id="4698542">f</span><span class="op" id="4698543">,</span>&nbsp;<span class="ident" id="4698545">export</span><span class="op" id="4698551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698554">case</span>&nbsp;<span class="op" id="4698559">*</span><span class="ident" id="4698560">ArrayType</span><span class="op" id="4698569">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698573">return</span>&nbsp;<span class="ident" id="4698580">filterType</span><span class="op" id="4698590">(</span><span class="ident" id="4698591">t</span><span class="op" id="4698592">.</span><span class="ident" id="4698593">Elt</span><span class="op" id="4698596">,</span>&nbsp;<span class="ident" id="4698598">f</span><span class="op" id="4698599">,</span>&nbsp;<span class="ident" id="4698601">export</span><span class="op" id="4698607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698610">case</span>&nbsp;<span class="op" id="4698615">*</span><span class="ident" id="4698616">StructType</span><span class="op" id="4698626">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698630">if</span>&nbsp;<span class="ident" id="4698633">filterFieldList</span><span class="op" id="4698648">(</span><span class="ident" id="4698649">t</span><span class="op" id="4698650">.</span><span class="ident" id="4698651">Fields</span><span class="op" id="4698657">,</span>&nbsp;<span class="ident" id="4698659">f</span><span class="op" id="4698660">,</span>&nbsp;<span class="ident" id="4698662">export</span><span class="op" id="4698668">)</span>&nbsp;<span class="op" id="4698670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698675">t</span><span class="op" id="4698676">.</span><span class="ident" id="4698677">Incomplete</span>&nbsp;<span class="op" id="4698688">=</span>&nbsp;<span class="builtintype" id="4698690">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4698697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698701">return</span>&nbsp;<span class="builtinfunc" id="4698708">len</span><span class="op" id="4698711">(</span><span class="ident" id="4698712">t</span><span class="op" id="4698713">.</span><span class="ident" id="4698714">Fields</span><span class="op" id="4698720">.</span><span class="ident" id="4698721">List</span><span class="op" id="4698725">)</span>&nbsp;<span class="op" id="4698727">&gt;</span>&nbsp;<span class="num" id="4698729">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698732">case</span>&nbsp;<span class="op" id="4698737">*</span><span class="ident" id="4698738">FuncType</span><span class="op" id="4698746">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698750">b1</span>&nbsp;<span class="op" id="4698753">:=</span>&nbsp;<span class="ident" id="4698756">filterParamList</span><span class="op" id="4698771">(</span><span class="ident" id="4698772">t</span><span class="op" id="4698773">.</span><span class="ident" id="4698774">Params</span><span class="op" id="4698780">,</span>&nbsp;<span class="ident" id="4698782">f</span><span class="op" id="4698783">,</span>&nbsp;<span class="ident" id="4698785">export</span><span class="op" id="4698791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698795">b2</span>&nbsp;<span class="op" id="4698798">:=</span>&nbsp;<span class="ident" id="4698801">filterParamList</span><span class="op" id="4698816">(</span><span class="ident" id="4698817">t</span><span class="op" id="4698818">.</span><span class="ident" id="4698819">Results</span><span class="op" id="4698826">,</span>&nbsp;<span class="ident" id="4698828">f</span><span class="op" id="4698829">,</span>&nbsp;<span class="ident" id="4698831">export</span><span class="op" id="4698837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698841">return</span>&nbsp;<span class="ident" id="4698848">b1</span>&nbsp;<span class="op" id="4698851">||</span>&nbsp;<span class="ident" id="4698854">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698858">case</span>&nbsp;<span class="op" id="4698863">*</span><span class="ident" id="4698864">InterfaceType</span><span class="op" id="4698877">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698881">if</span>&nbsp;<span class="ident" id="4698884">filterFieldList</span><span class="op" id="4698899">(</span><span class="ident" id="4698900">t</span><span class="op" id="4698901">.</span><span class="ident" id="4698902">Methods</span><span class="op" id="4698909">,</span>&nbsp;<span class="ident" id="4698911">f</span><span class="op" id="4698912">,</span>&nbsp;<span class="ident" id="4698914">export</span><span class="op" id="4698920">)</span>&nbsp;<span class="op" id="4698922">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698927">t</span><span class="op" id="4698928">.</span><span class="ident" id="4698929">Incomplete</span>&nbsp;<span class="op" id="4698940">=</span>&nbsp;<span class="builtintype" id="4698942">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4698949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698953">return</span>&nbsp;<span class="builtinfunc" id="4698960">len</span><span class="op" id="4698963">(</span><span class="ident" id="4698964">t</span><span class="op" id="4698965">.</span><span class="ident" id="4698966">Methods</span><span class="op" id="4698973">.</span><span class="ident" id="4698974">List</span><span class="op" id="4698978">)</span>&nbsp;<span class="op" id="4698980">&gt;</span>&nbsp;<span class="num" id="4698982">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698985">case</span>&nbsp;<span class="op" id="4698990">*</span><span class="ident" id="4698991">MapType</span><span class="op" id="4698998">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699002">b1</span>&nbsp;<span class="op" id="4699005">:=</span>&nbsp;<span class="ident" id="4699008">filterType</span><span class="op" id="4699018">(</span><span class="ident" id="4699019">t</span><span class="op" id="4699020">.</span><span class="ident" id="4699021">Key</span><span class="op" id="4699024">,</span>&nbsp;<span class="ident" id="4699026">f</span><span class="op" id="4699027">,</span>&nbsp;<span class="ident" id="4699029">export</span><span class="op" id="4699035">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699039">b2</span>&nbsp;<span class="op" id="4699042">:=</span>&nbsp;<span class="ident" id="4699045">filterType</span><span class="op" id="4699055">(</span><span class="ident" id="4699056">t</span><span class="op" id="4699057">.</span><span class="ident" id="4699058">Value</span><span class="op" id="4699063">,</span>&nbsp;<span class="ident" id="4699065">f</span><span class="op" id="4699066">,</span>&nbsp;<span class="ident" id="4699068">export</span><span class="op" id="4699074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699078">return</span>&nbsp;<span class="ident" id="4699085">b1</span>&nbsp;<span class="op" id="4699088">||</span>&nbsp;<span class="ident" id="4699091">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699095">case</span>&nbsp;<span class="op" id="4699100">*</span><span class="ident" id="4699101">ChanType</span><span class="op" id="4699109">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699113">return</span>&nbsp;<span class="ident" id="4699120">filterType</span><span class="op" id="4699130">(</span><span class="ident" id="4699131">t</span><span class="op" id="4699132">.</span><span class="ident" id="4699133">Value</span><span class="op" id="4699138">,</span>&nbsp;<span class="ident" id="4699140">f</span><span class="op" id="4699141">,</span>&nbsp;<span class="ident" id="4699143">export</span><span class="op" id="4699149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699152">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699155">return</span>&nbsp;<span class="builtintype" id="4699162">false</span><br>
<span class="lineno"></span><span class="op" id="4699168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4699171">func</span>&nbsp;<span class="ident" id="4699176">filterSpec</span><span class="op" id="4699186">(</span><span class="ident" id="4699187">spec</span>&nbsp;<span class="ident" id="4699192">Spec</span><span class="op" id="4699196">,</span>&nbsp;<span class="ident" id="4699198">f</span>&nbsp;<span class="ident" id="4699200">Filter</span><span class="op" id="4699206">,</span>&nbsp;<span class="ident" id="4699208">export</span>&nbsp;<span class="builtintype" id="4699215">bool</span><span class="op" id="4699219">)</span>&nbsp;<span class="builtintype" id="4699221">bool</span>&nbsp;<span class="op" id="4699226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699229">switch</span>&nbsp;<span class="ident" id="4699236">s</span>&nbsp;<span class="op" id="4699238">:=</span>&nbsp;<span class="ident" id="4699241">spec</span><span class="op" id="4699245">.</span><span class="op" id="4699246">(</span><span class="keyword" id="4699247">type</span><span class="op" id="4699251">)</span>&nbsp;<span class="op" id="4699253">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699256">case</span>&nbsp;<span class="op" id="4699261">*</span><span class="ident" id="4699262">ValueSpec</span><span class="op" id="4699271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699275">s</span><span class="op" id="4699276">.</span><span class="ident" id="4699277">Names</span>&nbsp;<span class="op" id="4699283">=</span>&nbsp;<span class="ident" id="4699285">filterIdentList</span><span class="op" id="4699300">(</span><span class="ident" id="4699301">s</span><span class="op" id="4699302">.</span><span class="ident" id="4699303">Names</span><span class="op" id="4699308">,</span>&nbsp;<span class="ident" id="4699310">f</span><span class="op" id="4699311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699315">if</span>&nbsp;<span class="builtinfunc" id="4699318">len</span><span class="op" id="4699321">(</span><span class="ident" id="4699322">s</span><span class="op" id="4699323">.</span><span class="ident" id="4699324">Names</span><span class="op" id="4699329">)</span>&nbsp;<span class="op" id="4699331">&gt;</span>&nbsp;<span class="num" id="4699333">0</span>&nbsp;<span class="op" id="4699335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699340">if</span>&nbsp;<span class="ident" id="4699343">export</span>&nbsp;<span class="op" id="4699350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699356">filterType</span><span class="op" id="4699366">(</span><span class="ident" id="4699367">s</span><span class="op" id="4699368">.</span><span class="ident" id="4699369">Type</span><span class="op" id="4699373">,</span>&nbsp;<span class="ident" id="4699375">f</span><span class="op" id="4699376">,</span>&nbsp;<span class="ident" id="4699378">export</span><span class="op" id="4699384">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699394">return</span>&nbsp;<span class="builtintype" id="4699401">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699411">case</span>&nbsp;<span class="op" id="4699416">*</span><span class="ident" id="4699417">TypeSpec</span><span class="op" id="4699425">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699429">if</span>&nbsp;<span class="ident" id="4699432">f</span><span class="op" id="4699433">(</span><span class="ident" id="4699434">s</span><span class="op" id="4699435">.</span><span class="ident" id="4699436">Name</span><span class="op" id="4699440">.</span><span class="ident" id="4699441">Name</span><span class="op" id="4699445">)</span>&nbsp;<span class="op" id="4699447">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699452">if</span>&nbsp;<span class="ident" id="4699455">export</span>&nbsp;<span class="op" id="4699462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699468">filterType</span><span class="op" id="4699478">(</span><span class="ident" id="4699479">s</span><span class="op" id="4699480">.</span><span class="ident" id="4699481">Type</span><span class="op" id="4699485">,</span>&nbsp;<span class="ident" id="4699487">f</span><span class="op" id="4699488">,</span>&nbsp;<span class="ident" id="4699490">export</span><span class="op" id="4699496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699506">return</span>&nbsp;<span class="builtintype" id="4699513">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699520">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699524">if</span>&nbsp;<span class="op" id="4699527">!</span><span class="ident" id="4699528">export</span>&nbsp;<span class="op" id="4699535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4699540">//&nbsp;For&nbsp;general&nbsp;filtering&nbsp;(not&nbsp;just&nbsp;exports),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4699588">//&nbsp;filter&nbsp;type&nbsp;even&nbsp;if&nbsp;name&nbsp;is&nbsp;not&nbsp;filtered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4699635">//&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4699646">//&nbsp;If&nbsp;the&nbsp;type&nbsp;contains&nbsp;filtered&nbsp;elements,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4699692">//&nbsp;keep&nbsp;the&nbsp;declaration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699720">return</span>&nbsp;<span class="ident" id="4699727">filterType</span><span class="op" id="4699737">(</span><span class="ident" id="4699738">s</span><span class="op" id="4699739">.</span><span class="ident" id="4699740">Type</span><span class="op" id="4699744">,</span>&nbsp;<span class="ident" id="4699746">f</span><span class="op" id="4699747">,</span>&nbsp;<span class="ident" id="4699749">export</span><span class="op" id="4699755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699765">return</span>&nbsp;<span class="builtintype" id="4699772">false</span><br>
<span class="lineno">185</span><span class="op" id="4699778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4699781">func</span>&nbsp;<span class="ident" id="4699786">filterSpecList</span><span class="op" id="4699800">(</span><span class="ident" id="4699801">list</span>&nbsp;<span class="op" id="4699806">[</span><span class="op" id="4699807">]</span><span class="ident" id="4699808">Spec</span><span class="op" id="4699812">,</span>&nbsp;<span class="ident" id="4699814">f</span>&nbsp;<span class="ident" id="4699816">Filter</span><span class="op" id="4699822">,</span>&nbsp;<span class="ident" id="4699824">export</span>&nbsp;<span class="builtintype" id="4699831">bool</span><span class="op" id="4699835">)</span>&nbsp;<span class="op" id="4699837">[</span><span class="op" id="4699838">]</span><span class="ident" id="4699839">Spec</span>&nbsp;<span class="op" id="4699844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699847">j</span>&nbsp;<span class="op" id="4699849">:=</span>&nbsp;<span class="num" id="4699852">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699855">for</span>&nbsp;<span class="ident" id="4699859">_</span><span class="op" id="4699860">,</span>&nbsp;<span class="ident" id="4699862">s</span>&nbsp;<span class="op" id="4699864">:=</span>&nbsp;<span class="keyword" id="4699867">range</span>&nbsp;<span class="ident" id="4699873">list</span>&nbsp;<span class="op" id="4699878">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699882">if</span>&nbsp;<span class="ident" id="4699885">filterSpec</span><span class="op" id="4699895">(</span><span class="ident" id="4699896">s</span><span class="op" id="4699897">,</span>&nbsp;<span class="ident" id="4699899">f</span><span class="op" id="4699900">,</span>&nbsp;<span class="ident" id="4699902">export</span><span class="op" id="4699908">)</span>&nbsp;<span class="op" id="4699910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699915">list</span><span class="op" id="4699919">[</span><span class="ident" id="4699920">j</span><span class="op" id="4699921">]</span>&nbsp;<span class="op" id="4699923">=</span>&nbsp;<span class="ident" id="4699925">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699930">j</span><span class="op" id="4699931">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699939">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699942">return</span>&nbsp;<span class="ident" id="4699949">list</span><span class="op" id="4699953">[</span><span class="num" id="4699954">0</span><span class="op" id="4699955">:</span><span class="ident" id="4699956">j</span><span class="op" id="4699957">]</span><br>
<span class="lineno"></span><span class="op" id="4699959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4699962">//&nbsp;FilterDecl&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;declaration&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="4700032">//&nbsp;all&nbsp;names&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but</span><br>
<span class="lineno">200</span><span class="comment" id="4700101">//&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="4700168">//</span><br>
<span class="lineno"></span><span class="comment" id="4700171">//&nbsp;FilterDecl&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;declared&nbsp;names&nbsp;left&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="4700241">//&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="4700283">//</span><br>
<span class="lineno">205</span><span class="keyword" id="4700286">func</span>&nbsp;<span class="ident" id="4700291">FilterDecl</span><span class="op" id="4700301">(</span><span class="ident" id="4700302">decl</span>&nbsp;<span class="ident" id="4700307">Decl</span><span class="op" id="4700311">,</span>&nbsp;<span class="ident" id="4700313">f</span>&nbsp;<span class="ident" id="4700315">Filter</span><span class="op" id="4700321">)</span>&nbsp;<span class="builtintype" id="4700323">bool</span>&nbsp;<span class="op" id="4700328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700331">return</span>&nbsp;<span class="ident" id="4700338">filterDecl</span><span class="op" id="4700348">(</span><span class="ident" id="4700349">decl</span><span class="op" id="4700353">,</span>&nbsp;<span class="ident" id="4700355">f</span><span class="op" id="4700356">,</span>&nbsp;<span class="builtintype" id="4700358">false</span><span class="op" id="4700363">)</span><br>
<span class="lineno"></span><span class="op" id="4700365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4700368">func</span>&nbsp;<span class="ident" id="4700373">filterDecl</span><span class="op" id="4700383">(</span><span class="ident" id="4700384">decl</span>&nbsp;<span class="ident" id="4700389">Decl</span><span class="op" id="4700393">,</span>&nbsp;<span class="ident" id="4700395">f</span>&nbsp;<span class="ident" id="4700397">Filter</span><span class="op" id="4700403">,</span>&nbsp;<span class="ident" id="4700405">export</span>&nbsp;<span class="builtintype" id="4700412">bool</span><span class="op" id="4700416">)</span>&nbsp;<span class="builtintype" id="4700418">bool</span>&nbsp;<span class="op" id="4700423">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700426">switch</span>&nbsp;<span class="ident" id="4700433">d</span>&nbsp;<span class="op" id="4700435">:=</span>&nbsp;<span class="ident" id="4700438">decl</span><span class="op" id="4700442">.</span><span class="op" id="4700443">(</span><span class="keyword" id="4700444">type</span><span class="op" id="4700448">)</span>&nbsp;<span class="op" id="4700450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700453">case</span>&nbsp;<span class="op" id="4700458">*</span><span class="ident" id="4700459">GenDecl</span><span class="op" id="4700466">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700470">d</span><span class="op" id="4700471">.</span><span class="ident" id="4700472">Specs</span>&nbsp;<span class="op" id="4700478">=</span>&nbsp;<span class="ident" id="4700480">filterSpecList</span><span class="op" id="4700494">(</span><span class="ident" id="4700495">d</span><span class="op" id="4700496">.</span><span class="ident" id="4700497">Specs</span><span class="op" id="4700502">,</span>&nbsp;<span class="ident" id="4700504">f</span><span class="op" id="4700505">,</span>&nbsp;<span class="ident" id="4700507">export</span><span class="op" id="4700513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700517">return</span>&nbsp;<span class="builtinfunc" id="4700524">len</span><span class="op" id="4700527">(</span><span class="ident" id="4700528">d</span><span class="op" id="4700529">.</span><span class="ident" id="4700530">Specs</span><span class="op" id="4700535">)</span>&nbsp;<span class="op" id="4700537">&gt;</span>&nbsp;<span class="num" id="4700539">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700542">case</span>&nbsp;<span class="op" id="4700547">*</span><span class="ident" id="4700548">FuncDecl</span><span class="op" id="4700556">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700560">return</span>&nbsp;<span class="ident" id="4700567">f</span><span class="op" id="4700568">(</span><span class="ident" id="4700569">d</span><span class="op" id="4700570">.</span><span class="ident" id="4700571">Name</span><span class="op" id="4700575">.</span><span class="ident" id="4700576">Name</span><span class="op" id="4700580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4700583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700586">return</span>&nbsp;<span class="builtintype" id="4700593">false</span><br>
<span class="lineno"></span><span class="op" id="4700599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="4700602">//&nbsp;FilterFile&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;file&nbsp;in&nbsp;place&nbsp;by&nbsp;removing&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="4700669">//&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4700734">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="4700802">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno"></span><span class="comment" id="4700872">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;File.Comments&nbsp;list</span><br>
<span class="lineno">225</span><span class="comment" id="4700939">//&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno"></span><span class="comment" id="4700958">//</span><br>
<span class="lineno"></span><span class="comment" id="4700961">//&nbsp;FilterFile&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno"></span><span class="comment" id="4701028">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="4701081">//</span><br>
<span class="lineno">230</span><span class="keyword" id="4701084">func</span>&nbsp;<span class="ident" id="4701089">FilterFile</span><span class="op" id="4701099">(</span><span class="ident" id="4701100">src</span>&nbsp;<span class="op" id="4701104">*</span><span class="ident" id="4701105">File</span><span class="op" id="4701109">,</span>&nbsp;<span class="ident" id="4701111">f</span>&nbsp;<span class="ident" id="4701113">Filter</span><span class="op" id="4701119">)</span>&nbsp;<span class="builtintype" id="4701121">bool</span>&nbsp;<span class="op" id="4701126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701129">return</span>&nbsp;<span class="ident" id="4701136">filterFile</span><span class="op" id="4701146">(</span><span class="ident" id="4701147">src</span><span class="op" id="4701150">,</span>&nbsp;<span class="ident" id="4701152">f</span><span class="op" id="4701153">,</span>&nbsp;<span class="builtintype" id="4701155">false</span><span class="op" id="4701160">)</span><br>
<span class="lineno"></span><span class="op" id="4701162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4701165">func</span>&nbsp;<span class="ident" id="4701170">filterFile</span><span class="op" id="4701180">(</span><span class="ident" id="4701181">src</span>&nbsp;<span class="op" id="4701185">*</span><span class="ident" id="4701186">File</span><span class="op" id="4701190">,</span>&nbsp;<span class="ident" id="4701192">f</span>&nbsp;<span class="ident" id="4701194">Filter</span><span class="op" id="4701200">,</span>&nbsp;<span class="ident" id="4701202">export</span>&nbsp;<span class="builtintype" id="4701209">bool</span><span class="op" id="4701213">)</span>&nbsp;<span class="builtintype" id="4701215">bool</span>&nbsp;<span class="op" id="4701220">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701223">j</span>&nbsp;<span class="op" id="4701225">:=</span>&nbsp;<span class="num" id="4701228">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701231">for</span>&nbsp;<span class="ident" id="4701235">_</span><span class="op" id="4701236">,</span>&nbsp;<span class="ident" id="4701238">d</span>&nbsp;<span class="op" id="4701240">:=</span>&nbsp;<span class="keyword" id="4701243">range</span>&nbsp;<span class="ident" id="4701249">src</span><span class="op" id="4701252">.</span><span class="ident" id="4701253">Decls</span>&nbsp;<span class="op" id="4701259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701263">if</span>&nbsp;<span class="ident" id="4701266">filterDecl</span><span class="op" id="4701276">(</span><span class="ident" id="4701277">d</span><span class="op" id="4701278">,</span>&nbsp;<span class="ident" id="4701280">f</span><span class="op" id="4701281">,</span>&nbsp;<span class="ident" id="4701283">export</span><span class="op" id="4701289">)</span>&nbsp;<span class="op" id="4701291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701296">src</span><span class="op" id="4701299">.</span><span class="ident" id="4701300">Decls</span><span class="op" id="4701305">[</span><span class="ident" id="4701306">j</span><span class="op" id="4701307">]</span>&nbsp;<span class="op" id="4701309">=</span>&nbsp;<span class="ident" id="4701311">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701316">j</span><span class="op" id="4701317">++</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4701322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4701325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701328">src</span><span class="op" id="4701331">.</span><span class="ident" id="4701332">Decls</span>&nbsp;<span class="op" id="4701338">=</span>&nbsp;<span class="ident" id="4701340">src</span><span class="op" id="4701343">.</span><span class="ident" id="4701344">Decls</span><span class="op" id="4701349">[</span><span class="num" id="4701350">0</span><span class="op" id="4701351">:</span><span class="ident" id="4701352">j</span><span class="op" id="4701353">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701356">return</span>&nbsp;<span class="ident" id="4701363">j</span>&nbsp;<span class="op" id="4701365">&gt;</span>&nbsp;<span class="num" id="4701367">0</span><br>
<span class="lineno"></span><span class="op" id="4701369">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="4701372">//&nbsp;FilterPackage&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="4701441">//&nbsp;all&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4701510">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="4701578">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno">250</span><span class="comment" id="4701648">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4701718">//&nbsp;changed,&nbsp;so&nbsp;that&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get</span><br>
<span class="lineno"></span><span class="comment" id="4701790">//&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="4701799">//</span><br>
<span class="lineno"></span><span class="comment" id="4701802">//&nbsp;FilterPackage&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno">255</span><span class="comment" id="4701872">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="4701925">//</span><br>
<span class="lineno"></span><span class="keyword" id="4701928">func</span>&nbsp;<span class="ident" id="4701933">FilterPackage</span><span class="op" id="4701946">(</span><span class="ident" id="4701947">pkg</span>&nbsp;<span class="op" id="4701951">*</span><span class="ident" id="4701952">Package</span><span class="op" id="4701959">,</span>&nbsp;<span class="ident" id="4701961">f</span>&nbsp;<span class="ident" id="4701963">Filter</span><span class="op" id="4701969">)</span>&nbsp;<span class="builtintype" id="4701971">bool</span>&nbsp;<span class="op" id="4701976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701979">return</span>&nbsp;<span class="ident" id="4701986">filterPackage</span><span class="op" id="4701999">(</span><span class="ident" id="4702000">pkg</span><span class="op" id="4702003">,</span>&nbsp;<span class="ident" id="4702005">f</span><span class="op" id="4702006">,</span>&nbsp;<span class="builtintype" id="4702008">false</span><span class="op" id="4702013">)</span><br>
<span class="lineno"></span><span class="op" id="4702015">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="4702018">func</span>&nbsp;<span class="ident" id="4702023">filterPackage</span><span class="op" id="4702036">(</span><span class="ident" id="4702037">pkg</span>&nbsp;<span class="op" id="4702041">*</span><span class="ident" id="4702042">Package</span><span class="op" id="4702049">,</span>&nbsp;<span class="ident" id="4702051">f</span>&nbsp;<span class="ident" id="4702053">Filter</span><span class="op" id="4702059">,</span>&nbsp;<span class="ident" id="4702061">export</span>&nbsp;<span class="builtintype" id="4702068">bool</span><span class="op" id="4702072">)</span>&nbsp;<span class="builtintype" id="4702074">bool</span>&nbsp;<span class="op" id="4702079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702082">hasDecls</span>&nbsp;<span class="op" id="4702091">:=</span>&nbsp;<span class="builtintype" id="4702094">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702101">for</span>&nbsp;<span class="ident" id="4702105">_</span><span class="op" id="4702106">,</span>&nbsp;<span class="ident" id="4702108">src</span>&nbsp;<span class="op" id="4702112">:=</span>&nbsp;<span class="keyword" id="4702115">range</span>&nbsp;<span class="ident" id="4702121">pkg</span><span class="op" id="4702124">.</span><span class="ident" id="4702125">Files</span>&nbsp;<span class="op" id="4702131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702135">if</span>&nbsp;<span class="ident" id="4702138">filterFile</span><span class="op" id="4702148">(</span><span class="ident" id="4702149">src</span><span class="op" id="4702152">,</span>&nbsp;<span class="ident" id="4702154">f</span><span class="op" id="4702155">,</span>&nbsp;<span class="ident" id="4702157">export</span><span class="op" id="4702163">)</span>&nbsp;<span class="op" id="4702165">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702170">hasDecls</span>&nbsp;<span class="op" id="4702179">=</span>&nbsp;<span class="builtintype" id="4702181">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4702188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4702191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702194">return</span>&nbsp;<span class="ident" id="4702201">hasDecls</span><br>
<span class="lineno"></span><span class="op" id="4702210">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="comment" id="4702213">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4702293">//&nbsp;Merging&nbsp;of&nbsp;package&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4702322">//&nbsp;The&nbsp;MergeMode&nbsp;flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;MergePackageFiles.</span><br>
<span class="lineno">275</span><span class="keyword" id="4702388">type</span>&nbsp;<span class="ident" id="4702393">MergeMode</span>&nbsp;<span class="builtintype" id="4702403">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4702409">const</span>&nbsp;<span class="op" id="4702415">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702418">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;function&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702476">FilterFuncDuplicates</span>&nbsp;<span class="ident" id="4702497">MergeMode</span>&nbsp;<span class="op" id="4702507">=</span>&nbsp;<span class="num" id="4702509">1</span>&nbsp;<span class="op" id="4702511">&lt;&lt;</span>&nbsp;<span class="ident" id="4702514">iota</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702520">//&nbsp;If&nbsp;set,&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;associated&nbsp;with&nbsp;a&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702581">//&nbsp;AST&nbsp;node&nbsp;(as&nbsp;Doc&nbsp;or&nbsp;Comment)&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702628">FilterUnassociatedComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702656">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;import&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702712">FilterImportDuplicates</span><br>
<span class="lineno">285</span><span class="op" id="4702735">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4702738">//&nbsp;nameOf&nbsp;returns&nbsp;the&nbsp;function&nbsp;(foo)&nbsp;or&nbsp;method&nbsp;name&nbsp;(foo.bar)&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4702804">//&nbsp;the&nbsp;given&nbsp;function&nbsp;declaration.&nbsp;If&nbsp;the&nbsp;AST&nbsp;is&nbsp;incorrect&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4702871">//&nbsp;receiver,&nbsp;it&nbsp;assumes&nbsp;a&nbsp;function&nbsp;instead.</span><br>
<span class="lineno">290</span><span class="comment" id="4702915">//</span><br>
<span class="lineno"></span><span class="keyword" id="4702918">func</span>&nbsp;<span class="ident" id="4702923">nameOf</span><span class="op" id="4702929">(</span><span class="ident" id="4702930">f</span>&nbsp;<span class="op" id="4702932">*</span><span class="ident" id="4702933">FuncDecl</span><span class="op" id="4702941">)</span>&nbsp;<span class="builtintype" id="4702943">string</span>&nbsp;<span class="op" id="4702950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702953">if</span>&nbsp;<span class="ident" id="4702956">r</span>&nbsp;<span class="op" id="4702958">:=</span>&nbsp;<span class="ident" id="4702961">f</span><span class="op" id="4702962">.</span><span class="ident" id="4702963">Recv</span><span class="op" id="4702967">;</span>&nbsp;<span class="ident" id="4702969">r</span>&nbsp;<span class="op" id="4702971">!=</span>&nbsp;<span class="ident" id="4702974">nil</span>&nbsp;<span class="op" id="4702978">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4702981">len</span><span class="op" id="4702984">(</span><span class="ident" id="4702985">r</span><span class="op" id="4702986">.</span><span class="ident" id="4702987">List</span><span class="op" id="4702991">)</span>&nbsp;<span class="op" id="4702993">==</span>&nbsp;<span class="num" id="4702996">1</span>&nbsp;<span class="op" id="4702998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4703002">//&nbsp;looks&nbsp;like&nbsp;a&nbsp;correct&nbsp;receiver&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703049">t</span>&nbsp;<span class="op" id="4703051">:=</span>&nbsp;<span class="ident" id="4703054">r</span><span class="op" id="4703055">.</span><span class="ident" id="4703056">List</span><span class="op" id="4703060">[</span><span class="num" id="4703061">0</span><span class="op" id="4703062">]</span><span class="op" id="4703063">.</span><span class="ident" id="4703064">Type</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4703071">//&nbsp;dereference&nbsp;pointer&nbsp;receiver&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703111">if</span>&nbsp;<span class="ident" id="4703114">p</span><span class="op" id="4703115">,</span>&nbsp;<span class="ident" id="4703117">_</span>&nbsp;<span class="op" id="4703119">:=</span>&nbsp;<span class="ident" id="4703122">t</span><span class="op" id="4703123">.</span><span class="op" id="4703124">(</span><span class="op" id="4703125">*</span><span class="ident" id="4703126">StarExpr</span><span class="op" id="4703134">)</span><span class="op" id="4703135">;</span>&nbsp;<span class="ident" id="4703137">p</span>&nbsp;<span class="op" id="4703139">!=</span>&nbsp;<span class="ident" id="4703142">nil</span>&nbsp;<span class="op" id="4703146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703151">t</span>&nbsp;<span class="op" id="4703153">=</span>&nbsp;<span class="ident" id="4703155">p</span><span class="op" id="4703156">.</span><span class="ident" id="4703157">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4703165">//&nbsp;the&nbsp;receiver&nbsp;type&nbsp;must&nbsp;be&nbsp;a&nbsp;type&nbsp;name</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703208">if</span>&nbsp;<span class="ident" id="4703211">p</span><span class="op" id="4703212">,</span>&nbsp;<span class="ident" id="4703214">_</span>&nbsp;<span class="op" id="4703216">:=</span>&nbsp;<span class="ident" id="4703219">t</span><span class="op" id="4703220">.</span><span class="op" id="4703221">(</span><span class="op" id="4703222">*</span><span class="ident" id="4703223">Ident</span><span class="op" id="4703228">)</span><span class="op" id="4703229">;</span>&nbsp;<span class="ident" id="4703231">p</span>&nbsp;<span class="op" id="4703233">!=</span>&nbsp;<span class="ident" id="4703236">nil</span>&nbsp;<span class="op" id="4703240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703245">return</span>&nbsp;<span class="ident" id="4703252">p</span><span class="op" id="4703253">.</span><span class="ident" id="4703254">Name</span>&nbsp;<span class="op" id="4703259">+</span>&nbsp;<span class="string" id="4703261">&#34;.&#34;</span>&nbsp;<span class="op" id="4703265">+</span>&nbsp;<span class="ident" id="4703267">f</span><span class="op" id="4703268">.</span><span class="ident" id="4703269">Name</span><span class="op" id="4703273">.</span><span class="ident" id="4703274">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4703285">//&nbsp;otherwise&nbsp;assume&nbsp;a&nbsp;function&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703325">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703328">return</span>&nbsp;<span class="ident" id="4703335">f</span><span class="op" id="4703336">.</span><span class="ident" id="4703337">Name</span><span class="op" id="4703341">.</span><span class="ident" id="4703342">Name</span><br>
<span class="lineno"></span><span class="op" id="4703347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4703350">//&nbsp;separator&nbsp;is&nbsp;an&nbsp;empty&nbsp;//-style&nbsp;comment&nbsp;that&nbsp;is&nbsp;interspersed&nbsp;between</span><br>
<span class="lineno"></span><span class="comment" id="4703421">//&nbsp;different&nbsp;comment&nbsp;groups&nbsp;when&nbsp;they&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single&nbsp;group</span><br>
<span class="lineno">310</span><span class="comment" id="4703496">//</span><br>
<span class="lineno"></span><span class="keyword" id="4703499">var</span>&nbsp;<span class="ident" id="4703503">separator</span>&nbsp;<span class="op" id="4703513">=</span>&nbsp;<span class="op" id="4703515">&amp;</span><span class="ident" id="4703516">Comment</span><span class="op" id="4703523">{</span><span class="ident" id="4703524">token</span><span class="op" id="4703529">.</span><span class="ident" id="4703530">NoPos</span><span class="op" id="4703535">,</span>&nbsp;<span class="string" id="4703537">&#34;//&#34;</span><span class="op" id="4703541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4703544">//&nbsp;MergePackageFiles&nbsp;creates&nbsp;a&nbsp;file&nbsp;AST&nbsp;by&nbsp;merging&nbsp;the&nbsp;ASTs&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4703611">//&nbsp;files&nbsp;belonging&nbsp;to&nbsp;a&nbsp;package.&nbsp;The&nbsp;mode&nbsp;flags&nbsp;control&nbsp;merging&nbsp;behavior.</span><br>
<span class="lineno">315</span><span class="comment" id="4703685">//</span><br>
<span class="lineno"></span><span class="keyword" id="4703688">func</span>&nbsp;<span class="ident" id="4703693">MergePackageFiles</span><span class="op" id="4703710">(</span><span class="ident" id="4703711">pkg</span>&nbsp;<span class="op" id="4703715">*</span><span class="ident" id="4703716">Package</span><span class="op" id="4703723">,</span>&nbsp;<span class="ident" id="4703725">mode</span>&nbsp;<span class="ident" id="4703730">MergeMode</span><span class="op" id="4703739">)</span>&nbsp;<span class="op" id="4703741">*</span><span class="ident" id="4703742">File</span>&nbsp;<span class="op" id="4703747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4703750">//&nbsp;Count&nbsp;the&nbsp;number&nbsp;of&nbsp;package&nbsp;docs,&nbsp;comments&nbsp;and&nbsp;declarations&nbsp;across</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4703821">//&nbsp;all&nbsp;package&nbsp;files.&nbsp;Also,&nbsp;compute&nbsp;sorted&nbsp;list&nbsp;of&nbsp;filenames,&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4703892">//&nbsp;subsequent&nbsp;iterations&nbsp;can&nbsp;always&nbsp;iterate&nbsp;in&nbsp;the&nbsp;same&nbsp;order.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703956">ndocs</span>&nbsp;<span class="op" id="4703962">:=</span>&nbsp;<span class="num" id="4703965">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703968">ncomments</span>&nbsp;<span class="op" id="4703978">:=</span>&nbsp;<span class="num" id="4703981">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703984">ndecls</span>&nbsp;<span class="op" id="4703991">:=</span>&nbsp;<span class="num" id="4703994">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703997">filenames</span>&nbsp;<span class="op" id="4704007">:=</span>&nbsp;<span class="builtinfunc" id="4704010">make</span><span class="op" id="4704014">(</span><span class="op" id="4704015">[</span><span class="op" id="4704016">]</span><span class="builtintype" id="4704017">string</span><span class="op" id="4704023">,</span>&nbsp;<span class="builtinfunc" id="4704025">len</span><span class="op" id="4704028">(</span><span class="ident" id="4704029">pkg</span><span class="op" id="4704032">.</span><span class="ident" id="4704033">Files</span><span class="op" id="4704038">)</span><span class="op" id="4704039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704042">i</span>&nbsp;<span class="op" id="4704044">:=</span>&nbsp;<span class="num" id="4704047">0</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704050">for</span>&nbsp;<span class="ident" id="4704054">filename</span><span class="op" id="4704062">,</span>&nbsp;<span class="ident" id="4704064">f</span>&nbsp;<span class="op" id="4704066">:=</span>&nbsp;<span class="keyword" id="4704069">range</span>&nbsp;<span class="ident" id="4704075">pkg</span><span class="op" id="4704078">.</span><span class="ident" id="4704079">Files</span>&nbsp;<span class="op" id="4704085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704089">filenames</span><span class="op" id="4704098">[</span><span class="ident" id="4704099">i</span><span class="op" id="4704100">]</span>&nbsp;<span class="op" id="4704102">=</span>&nbsp;<span class="ident" id="4704104">filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704115">i</span><span class="op" id="4704116">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704121">if</span>&nbsp;<span class="ident" id="4704124">f</span><span class="op" id="4704125">.</span><span class="ident" id="4704126">Doc</span>&nbsp;<span class="op" id="4704130">!=</span>&nbsp;<span class="ident" id="4704133">nil</span>&nbsp;<span class="op" id="4704137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704142">ndocs</span>&nbsp;<span class="op" id="4704148">+=</span>&nbsp;<span class="builtinfunc" id="4704151">len</span><span class="op" id="4704154">(</span><span class="ident" id="4704155">f</span><span class="op" id="4704156">.</span><span class="ident" id="4704157">Doc</span><span class="op" id="4704160">.</span><span class="ident" id="4704161">List</span><span class="op" id="4704165">)</span>&nbsp;<span class="op" id="4704167">+</span>&nbsp;<span class="num" id="4704169">1</span>&nbsp;<span class="comment" id="4704171">//&nbsp;+1&nbsp;for&nbsp;separator</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704197">ncomments</span>&nbsp;<span class="op" id="4704207">+=</span>&nbsp;<span class="builtinfunc" id="4704210">len</span><span class="op" id="4704213">(</span><span class="ident" id="4704214">f</span><span class="op" id="4704215">.</span><span class="ident" id="4704216">Comments</span><span class="op" id="4704224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704228">ndecls</span>&nbsp;<span class="op" id="4704235">+=</span>&nbsp;<span class="builtinfunc" id="4704238">len</span><span class="op" id="4704241">(</span><span class="ident" id="4704242">f</span><span class="op" id="4704243">.</span><span class="ident" id="4704244">Decls</span><span class="op" id="4704249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704255">sort</span><span class="op" id="4704259">.</span><span class="ident" id="4704260">Strings</span><span class="op" id="4704267">(</span><span class="ident" id="4704268">filenames</span><span class="op" id="4704277">)</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4704281">//&nbsp;Collect&nbsp;package&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4704347">//&nbsp;CommentGroup&nbsp;-&nbsp;the&nbsp;collected&nbsp;package&nbsp;documentation.&nbsp;In&nbsp;general</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4704414">//&nbsp;there&nbsp;should&nbsp;be&nbsp;only&nbsp;one&nbsp;file&nbsp;with&nbsp;a&nbsp;package&nbsp;comment;&nbsp;but&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4704481">//&nbsp;better&nbsp;to&nbsp;collect&nbsp;extra&nbsp;comments&nbsp;than&nbsp;drop&nbsp;them&nbsp;on&nbsp;the&nbsp;floor.</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704547">var</span>&nbsp;<span class="ident" id="4704551">doc</span>&nbsp;<span class="op" id="4704555">*</span><span class="ident" id="4704556">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704570">var</span>&nbsp;<span class="ident" id="4704574">pos</span>&nbsp;<span class="ident" id="4704578">token</span><span class="op" id="4704583">.</span><span class="ident" id="4704584">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704589">if</span>&nbsp;<span class="ident" id="4704592">ndocs</span>&nbsp;<span class="op" id="4704598">&gt;</span>&nbsp;<span class="num" id="4704600">0</span>&nbsp;<span class="op" id="4704602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704606">list</span>&nbsp;<span class="op" id="4704611">:=</span>&nbsp;<span class="builtinfunc" id="4704614">make</span><span class="op" id="4704618">(</span><span class="op" id="4704619">[</span><span class="op" id="4704620">]</span><span class="op" id="4704621">*</span><span class="ident" id="4704622">Comment</span><span class="op" id="4704629">,</span>&nbsp;<span class="ident" id="4704631">ndocs</span><span class="op" id="4704636">-</span><span class="num" id="4704637">1</span><span class="op" id="4704638">)</span>&nbsp;<span class="comment" id="4704640">//&nbsp;-1:&nbsp;no&nbsp;separator&nbsp;before&nbsp;first&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704681">i</span>&nbsp;<span class="op" id="4704683">:=</span>&nbsp;<span class="num" id="4704686">0</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704690">for</span>&nbsp;<span class="ident" id="4704694">_</span><span class="op" id="4704695">,</span>&nbsp;<span class="ident" id="4704697">filename</span>&nbsp;<span class="op" id="4704706">:=</span>&nbsp;<span class="keyword" id="4704709">range</span>&nbsp;<span class="ident" id="4704715">filenames</span>&nbsp;<span class="op" id="4704725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704730">f</span>&nbsp;<span class="op" id="4704732">:=</span>&nbsp;<span class="ident" id="4704735">pkg</span><span class="op" id="4704738">.</span><span class="ident" id="4704739">Files</span><span class="op" id="4704744">[</span><span class="ident" id="4704745">filename</span><span class="op" id="4704753">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704758">if</span>&nbsp;<span class="ident" id="4704761">f</span><span class="op" id="4704762">.</span><span class="ident" id="4704763">Doc</span>&nbsp;<span class="op" id="4704767">!=</span>&nbsp;<span class="ident" id="4704770">nil</span>&nbsp;<span class="op" id="4704774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704780">if</span>&nbsp;<span class="ident" id="4704783">i</span>&nbsp;<span class="op" id="4704785">&gt;</span>&nbsp;<span class="num" id="4704787">0</span>&nbsp;<span class="op" id="4704789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4704796">//&nbsp;not&nbsp;the&nbsp;first&nbsp;group&nbsp;-&nbsp;add&nbsp;separator</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704840">list</span><span class="op" id="4704844">[</span><span class="ident" id="4704845">i</span><span class="op" id="4704846">]</span>&nbsp;<span class="op" id="4704848">=</span>&nbsp;<span class="ident" id="4704850">separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704865">i</span><span class="op" id="4704866">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704879">for</span>&nbsp;<span class="ident" id="4704883">_</span><span class="op" id="4704884">,</span>&nbsp;<span class="ident" id="4704886">c</span>&nbsp;<span class="op" id="4704888">:=</span>&nbsp;<span class="keyword" id="4704891">range</span>&nbsp;<span class="ident" id="4704897">f</span><span class="op" id="4704898">.</span><span class="ident" id="4704899">Doc</span><span class="op" id="4704902">.</span><span class="ident" id="4704903">List</span>&nbsp;<span class="op" id="4704908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704915">list</span><span class="op" id="4704919">[</span><span class="ident" id="4704920">i</span><span class="op" id="4704921">]</span>&nbsp;<span class="op" id="4704923">=</span>&nbsp;<span class="ident" id="4704925">c</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704932">i</span><span class="op" id="4704933">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704946">if</span>&nbsp;<span class="ident" id="4704949">f</span><span class="op" id="4704950">.</span><span class="ident" id="4704951">Package</span>&nbsp;<span class="op" id="4704959">&gt;</span>&nbsp;<span class="ident" id="4704961">pos</span>&nbsp;<span class="op" id="4704965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4704972">//&nbsp;Keep&nbsp;the&nbsp;maximum&nbsp;package&nbsp;clause&nbsp;position&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4705024">//&nbsp;position&nbsp;for&nbsp;the&nbsp;package&nbsp;clause&nbsp;of&nbsp;the&nbsp;merged</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4705078">//&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705093">pos</span>&nbsp;<span class="op" id="4705097">=</span>&nbsp;<span class="ident" id="4705099">f</span><span class="op" id="4705100">.</span><span class="ident" id="4705101">Package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4705113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4705118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4705122">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705126">doc</span>&nbsp;<span class="op" id="4705130">=</span>&nbsp;<span class="op" id="4705132">&amp;</span><span class="ident" id="4705133">CommentGroup</span><span class="op" id="4705145">{</span><span class="ident" id="4705146">list</span><span class="op" id="4705150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4705153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4705157">//&nbsp;Collect&nbsp;declarations&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705206">var</span>&nbsp;<span class="ident" id="4705210">decls</span>&nbsp;<span class="op" id="4705216">[</span><span class="op" id="4705217">]</span><span class="ident" id="4705218">Decl</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705224">if</span>&nbsp;<span class="ident" id="4705227">ndecls</span>&nbsp;<span class="op" id="4705234">&gt;</span>&nbsp;<span class="num" id="4705236">0</span>&nbsp;<span class="op" id="4705238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705242">decls</span>&nbsp;<span class="op" id="4705248">=</span>&nbsp;<span class="builtinfunc" id="4705250">make</span><span class="op" id="4705254">(</span><span class="op" id="4705255">[</span><span class="op" id="4705256">]</span><span class="ident" id="4705257">Decl</span><span class="op" id="4705261">,</span>&nbsp;<span class="ident" id="4705263">ndecls</span><span class="op" id="4705269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705273">funcs</span>&nbsp;<span class="op" id="4705279">:=</span>&nbsp;<span class="builtinfunc" id="4705282">make</span><span class="op" id="4705286">(</span><span class="keyword" id="4705287">map</span><span class="op" id="4705290">[</span><span class="builtintype" id="4705291">string</span><span class="op" id="4705297">]</span><span class="builtintype" id="4705298">int</span><span class="op" id="4705301">)</span>&nbsp;<span class="comment" id="4705303">//&nbsp;map&nbsp;of&nbsp;func&nbsp;name&nbsp;-&gt;&nbsp;decls&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705340">i</span>&nbsp;<span class="op" id="4705342">:=</span>&nbsp;<span class="num" id="4705345">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4705370">//&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705389">n</span>&nbsp;<span class="op" id="4705391">:=</span>&nbsp;<span class="num" id="4705394">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4705419">//&nbsp;number&nbsp;of&nbsp;filtered&nbsp;entries</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705451">for</span>&nbsp;<span class="ident" id="4705455">_</span><span class="op" id="4705456">,</span>&nbsp;<span class="ident" id="4705458">filename</span>&nbsp;<span class="op" id="4705467">:=</span>&nbsp;<span class="keyword" id="4705470">range</span>&nbsp;<span class="ident" id="4705476">filenames</span>&nbsp;<span class="op" id="4705486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705491">f</span>&nbsp;<span class="op" id="4705493">:=</span>&nbsp;<span class="ident" id="4705496">pkg</span><span class="op" id="4705499">.</span><span class="ident" id="4705500">Files</span><span class="op" id="4705505">[</span><span class="ident" id="4705506">filename</span><span class="op" id="4705514">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705519">for</span>&nbsp;<span class="ident" id="4705523">_</span><span class="op" id="4705524">,</span>&nbsp;<span class="ident" id="4705526">d</span>&nbsp;<span class="op" id="4705528">:=</span>&nbsp;<span class="keyword" id="4705531">range</span>&nbsp;<span class="ident" id="4705537">f</span><span class="op" id="4705538">.</span><span class="ident" id="4705539">Decls</span>&nbsp;<span class="op" id="4705545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705551">if</span>&nbsp;<span class="ident" id="4705554">mode</span><span class="op" id="4705558">&amp;</span><span class="ident" id="4705559">FilterFuncDuplicates</span>&nbsp;<span class="op" id="4705580">!=</span>&nbsp;<span class="num" id="4705583">0</span>&nbsp;<span class="op" id="4705585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4705592">//&nbsp;A&nbsp;language&nbsp;entity&nbsp;may&nbsp;be&nbsp;declared&nbsp;multiple</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4705643">//&nbsp;times&nbsp;in&nbsp;different&nbsp;package&nbsp;files;&nbsp;only&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4705693">//&nbsp;build&nbsp;time&nbsp;declarations&nbsp;must&nbsp;be&nbsp;unique.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4705741">//&nbsp;For&nbsp;now,&nbsp;exclude&nbsp;multiple&nbsp;declarations&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4705791">//&nbsp;functions&nbsp;-&nbsp;keep&nbsp;the&nbsp;one&nbsp;with&nbsp;documentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4705844">//</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4705852">//&nbsp;TODO(gri):&nbsp;Expand&nbsp;this&nbsp;filtering&nbsp;to&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4705902">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entities&nbsp;(const,&nbsp;type,&nbsp;vars)&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4705953">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple&nbsp;declarations&nbsp;are&nbsp;common.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706006">if</span>&nbsp;<span class="ident" id="4706009">f</span><span class="op" id="4706010">,</span>&nbsp;<span class="ident" id="4706012">isFun</span>&nbsp;<span class="op" id="4706018">:=</span>&nbsp;<span class="ident" id="4706021">d</span><span class="op" id="4706022">.</span><span class="op" id="4706023">(</span><span class="op" id="4706024">*</span><span class="ident" id="4706025">FuncDecl</span><span class="op" id="4706033">)</span><span class="op" id="4706034">;</span>&nbsp;<span class="ident" id="4706036">isFun</span>&nbsp;<span class="op" id="4706042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706050">name</span>&nbsp;<span class="op" id="4706055">:=</span>&nbsp;<span class="ident" id="4706058">nameOf</span><span class="op" id="4706064">(</span><span class="ident" id="4706065">f</span><span class="op" id="4706066">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706074">if</span>&nbsp;<span class="ident" id="4706077">j</span><span class="op" id="4706078">,</span>&nbsp;<span class="ident" id="4706080">exists</span>&nbsp;<span class="op" id="4706087">:=</span>&nbsp;<span class="ident" id="4706090">funcs</span><span class="op" id="4706095">[</span><span class="ident" id="4706096">name</span><span class="op" id="4706100">]</span><span class="op" id="4706101">;</span>&nbsp;<span class="ident" id="4706103">exists</span>&nbsp;<span class="op" id="4706110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4706119">//&nbsp;function&nbsp;declared&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706155">if</span>&nbsp;<span class="ident" id="4706158">decls</span><span class="op" id="4706163">[</span><span class="ident" id="4706164">j</span><span class="op" id="4706165">]</span>&nbsp;<span class="op" id="4706167">!=</span>&nbsp;<span class="ident" id="4706170">nil</span>&nbsp;<span class="op" id="4706174">&amp;&amp;</span>&nbsp;<span class="ident" id="4706177">decls</span><span class="op" id="4706182">[</span><span class="ident" id="4706183">j</span><span class="op" id="4706184">]</span><span class="op" id="4706185">.</span><span class="op" id="4706186">(</span><span class="op" id="4706187">*</span><span class="ident" id="4706188">FuncDecl</span><span class="op" id="4706196">)</span><span class="op" id="4706197">.</span><span class="ident" id="4706198">Doc</span>&nbsp;<span class="op" id="4706202">==</span>&nbsp;<span class="ident" id="4706205">nil</span>&nbsp;<span class="op" id="4706209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4706219">//&nbsp;existing&nbsp;declaration&nbsp;has&nbsp;no&nbsp;documentation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4706273">//&nbsp;ignore&nbsp;the&nbsp;existing&nbsp;declaration</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706316">decls</span><span class="op" id="4706321">[</span><span class="ident" id="4706322">j</span><span class="op" id="4706323">]</span>&nbsp;<span class="op" id="4706325">=</span>&nbsp;<span class="ident" id="4706327">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706338">}</span>&nbsp;<span class="keyword" id="4706340">else</span>&nbsp;<span class="op" id="4706345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4706355">//&nbsp;ignore&nbsp;the&nbsp;new&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706393">d</span>&nbsp;<span class="op" id="4706395">=</span>&nbsp;<span class="ident" id="4706397">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706408">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706417">n</span><span class="op" id="4706418">++</span>&nbsp;<span class="comment" id="4706421">//&nbsp;filtered&nbsp;an&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706448">}</span>&nbsp;<span class="keyword" id="4706450">else</span>&nbsp;<span class="op" id="4706455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706464">funcs</span><span class="op" id="4706469">[</span><span class="ident" id="4706470">name</span><span class="op" id="4706474">]</span>&nbsp;<span class="op" id="4706476">=</span>&nbsp;<span class="ident" id="4706478">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706493">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706505">decls</span><span class="op" id="4706510">[</span><span class="ident" id="4706511">i</span><span class="op" id="4706512">]</span>&nbsp;<span class="op" id="4706514">=</span>&nbsp;<span class="ident" id="4706516">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706522">i</span><span class="op" id="4706523">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706533">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4706538">//&nbsp;Eliminate&nbsp;nil&nbsp;entries&nbsp;from&nbsp;the&nbsp;decls&nbsp;list&nbsp;if&nbsp;entries&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4706601">//&nbsp;filtered.&nbsp;We&nbsp;do&nbsp;this&nbsp;using&nbsp;a&nbsp;2nd&nbsp;pass&nbsp;in&nbsp;order&nbsp;to&nbsp;not&nbsp;disturb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4706668">//&nbsp;the&nbsp;original&nbsp;declaration&nbsp;order&nbsp;in&nbsp;the&nbsp;source&nbsp;(otherwise,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4706735">//&nbsp;would&nbsp;also&nbsp;invalidate&nbsp;the&nbsp;monotonically&nbsp;increasing&nbsp;position</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4706800">//&nbsp;info&nbsp;within&nbsp;a&nbsp;single&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706833">if</span>&nbsp;<span class="ident" id="4706836">n</span>&nbsp;<span class="op" id="4706838">&gt;</span>&nbsp;<span class="num" id="4706840">0</span>&nbsp;<span class="op" id="4706842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706847">i</span>&nbsp;<span class="op" id="4706849">=</span>&nbsp;<span class="num" id="4706851">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706856">for</span>&nbsp;<span class="ident" id="4706860">_</span><span class="op" id="4706861">,</span>&nbsp;<span class="ident" id="4706863">d</span>&nbsp;<span class="op" id="4706865">:=</span>&nbsp;<span class="keyword" id="4706868">range</span>&nbsp;<span class="ident" id="4706874">decls</span>&nbsp;<span class="op" id="4706880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706886">if</span>&nbsp;<span class="ident" id="4706889">d</span>&nbsp;<span class="op" id="4706891">!=</span>&nbsp;<span class="ident" id="4706894">nil</span>&nbsp;<span class="op" id="4706898">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706905">decls</span><span class="op" id="4706910">[</span><span class="ident" id="4706911">i</span><span class="op" id="4706912">]</span>&nbsp;<span class="op" id="4706914">=</span>&nbsp;<span class="ident" id="4706916">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706923">i</span><span class="op" id="4706924">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706941">decls</span>&nbsp;<span class="op" id="4706947">=</span>&nbsp;<span class="ident" id="4706949">decls</span><span class="op" id="4706954">[</span><span class="num" id="4706955">0</span><span class="op" id="4706956">:</span><span class="ident" id="4706957">i</span><span class="op" id="4706958">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4706969">//&nbsp;Collect&nbsp;import&nbsp;specs&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707018">var</span>&nbsp;<span class="ident" id="4707022">imports</span>&nbsp;<span class="op" id="4707030">[</span><span class="op" id="4707031">]</span><span class="op" id="4707032">*</span><span class="ident" id="4707033">ImportSpec</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707045">if</span>&nbsp;<span class="ident" id="4707048">mode</span><span class="op" id="4707052">&amp;</span><span class="ident" id="4707053">FilterImportDuplicates</span>&nbsp;<span class="op" id="4707076">!=</span>&nbsp;<span class="num" id="4707079">0</span>&nbsp;<span class="op" id="4707081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4707085">seen</span>&nbsp;<span class="op" id="4707090">:=</span>&nbsp;<span class="builtinfunc" id="4707093">make</span><span class="op" id="4707097">(</span><span class="keyword" id="4707098">map</span><span class="op" id="4707101">[</span><span class="builtintype" id="4707102">string</span><span class="op" id="4707108">]</span><span class="builtintype" id="4707109">bool</span><span class="op" id="4707113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707117">for</span>&nbsp;<span class="ident" id="4707121">_</span><span class="op" id="4707122">,</span>&nbsp;<span class="ident" id="4707124">filename</span>&nbsp;<span class="op" id="4707133">:=</span>&nbsp;<span class="keyword" id="4707136">range</span>&nbsp;<span class="ident" id="4707142">filenames</span>&nbsp;<span class="op" id="4707152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4707157">f</span>&nbsp;<span class="op" id="4707159">:=</span>&nbsp;<span class="ident" id="4707162">pkg</span><span class="op" id="4707165">.</span><span class="ident" id="4707166">Files</span><span class="op" id="4707171">[</span><span class="ident" id="4707172">filename</span><span class="op" id="4707180">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707185">for</span>&nbsp;<span class="ident" id="4707189">_</span><span class="op" id="4707190">,</span>&nbsp;<span class="ident" id="4707192">imp</span>&nbsp;<span class="op" id="4707196">:=</span>&nbsp;<span class="keyword" id="4707199">range</span>&nbsp;<span class="ident" id="4707205">f</span><span class="op" id="4707206">.</span><span class="ident" id="4707207">Imports</span>&nbsp;<span class="op" id="4707215">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707221">if</span>&nbsp;<span class="ident" id="4707224">path</span>&nbsp;<span class="op" id="4707229">:=</span>&nbsp;<span class="ident" id="4707232">imp</span><span class="op" id="4707235">.</span><span class="ident" id="4707236">Path</span><span class="op" id="4707240">.</span><span class="ident" id="4707241">Value</span><span class="op" id="4707246">;</span>&nbsp;<span class="op" id="4707248">!</span><span class="ident" id="4707249">seen</span><span class="op" id="4707253">[</span><span class="ident" id="4707254">path</span><span class="op" id="4707258">]</span>&nbsp;<span class="op" id="4707260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4707267">//&nbsp;TODO:&nbsp;consider&nbsp;handling&nbsp;cases&nbsp;where:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4707312">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;with&nbsp;the&nbsp;same&nbsp;import&nbsp;path&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4707368">//&nbsp;&nbsp;&nbsp;have&nbsp;different&nbsp;local&nbsp;names&nbsp;(one&nbsp;should&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4707426">//&nbsp;&nbsp;&nbsp;keep&nbsp;both&nbsp;of&nbsp;them)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4707455">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;but&nbsp;only&nbsp;one&nbsp;has&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4707508">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;and&nbsp;they&nbsp;both&nbsp;have&nbsp;(possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4707563">//&nbsp;&nbsp;&nbsp;different)&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4707593">imports</span>&nbsp;<span class="op" id="4707601">=</span>&nbsp;<span class="builtinfunc" id="4707603">append</span><span class="op" id="4707609">(</span><span class="ident" id="4707610">imports</span><span class="op" id="4707617">,</span>&nbsp;<span class="ident" id="4707619">imp</span><span class="op" id="4707622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4707629">seen</span><span class="op" id="4707633">[</span><span class="ident" id="4707634">path</span><span class="op" id="4707638">]</span>&nbsp;<span class="op" id="4707640">=</span>&nbsp;<span class="builtintype" id="4707642">true</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4707651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4707656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4707660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4707663">}</span>&nbsp;<span class="keyword" id="4707665">else</span>&nbsp;<span class="op" id="4707670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707674">for</span>&nbsp;<span class="ident" id="4707678">_</span><span class="op" id="4707679">,</span>&nbsp;<span class="ident" id="4707681">f</span>&nbsp;<span class="op" id="4707683">:=</span>&nbsp;<span class="keyword" id="4707686">range</span>&nbsp;<span class="ident" id="4707692">pkg</span><span class="op" id="4707695">.</span><span class="ident" id="4707696">Files</span>&nbsp;<span class="op" id="4707702">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4707707">imports</span>&nbsp;<span class="op" id="4707715">=</span>&nbsp;<span class="builtinfunc" id="4707717">append</span><span class="op" id="4707723">(</span><span class="ident" id="4707724">imports</span><span class="op" id="4707731">,</span>&nbsp;<span class="ident" id="4707733">f</span><span class="op" id="4707734">.</span><span class="ident" id="4707735">Imports</span><span class="op" id="4707742">...</span><span class="op" id="4707745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4707749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4707752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4707756">//&nbsp;Collect&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707801">var</span>&nbsp;<span class="ident" id="4707805">comments</span>&nbsp;<span class="op" id="4707814">[</span><span class="op" id="4707815">]</span><span class="op" id="4707816">*</span><span class="ident" id="4707817">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707831">if</span>&nbsp;<span class="ident" id="4707834">mode</span><span class="op" id="4707838">&amp;</span><span class="ident" id="4707839">FilterUnassociatedComments</span>&nbsp;<span class="op" id="4707866">==</span>&nbsp;<span class="num" id="4707869">0</span>&nbsp;<span class="op" id="4707871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4707875">comments</span>&nbsp;<span class="op" id="4707884">=</span>&nbsp;<span class="builtinfunc" id="4707886">make</span><span class="op" id="4707890">(</span><span class="op" id="4707891">[</span><span class="op" id="4707892">]</span><span class="op" id="4707893">*</span><span class="ident" id="4707894">CommentGroup</span><span class="op" id="4707906">,</span>&nbsp;<span class="ident" id="4707908">ncomments</span><span class="op" id="4707917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4707921">i</span>&nbsp;<span class="op" id="4707923">:=</span>&nbsp;<span class="num" id="4707926">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707930">for</span>&nbsp;<span class="ident" id="4707934">_</span><span class="op" id="4707935">,</span>&nbsp;<span class="ident" id="4707937">f</span>&nbsp;<span class="op" id="4707939">:=</span>&nbsp;<span class="keyword" id="4707942">range</span>&nbsp;<span class="ident" id="4707948">pkg</span><span class="op" id="4707951">.</span><span class="ident" id="4707952">Files</span>&nbsp;<span class="op" id="4707958">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4707963">i</span>&nbsp;<span class="op" id="4707965">+=</span>&nbsp;<span class="builtinfunc" id="4707968">copy</span><span class="op" id="4707972">(</span><span class="ident" id="4707973">comments</span><span class="op" id="4707981">[</span><span class="ident" id="4707982">i</span><span class="op" id="4707983">:</span><span class="op" id="4707984">]</span><span class="op" id="4707985">,</span>&nbsp;<span class="ident" id="4707987">f</span><span class="op" id="4707988">.</span><span class="ident" id="4707989">Comments</span><span class="op" id="4707997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4708001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4708004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4708008">//&nbsp;TODO(gri)&nbsp;need&nbsp;to&nbsp;compute&nbsp;unresolved&nbsp;identifiers!</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708062">return</span>&nbsp;<span class="op" id="4708069">&amp;</span><span class="ident" id="4708070">File</span><span class="op" id="4708074">{</span><span class="ident" id="4708075">doc</span><span class="op" id="4708078">,</span>&nbsp;<span class="ident" id="4708080">pos</span><span class="op" id="4708083">,</span>&nbsp;<span class="ident" id="4708085">NewIdent</span><span class="op" id="4708093">(</span><span class="ident" id="4708094">pkg</span><span class="op" id="4708097">.</span><span class="ident" id="4708098">Name</span><span class="op" id="4708102">)</span><span class="op" id="4708103">,</span>&nbsp;<span class="ident" id="4708105">decls</span><span class="op" id="4708110">,</span>&nbsp;<span class="ident" id="4708112">pkg</span><span class="op" id="4708115">.</span><span class="ident" id="4708116">Scope</span><span class="op" id="4708121">,</span>&nbsp;<span class="ident" id="4708123">imports</span><span class="op" id="4708130">,</span>&nbsp;<span class="ident" id="4708132">nil</span><span class="op" id="4708135">,</span>&nbsp;<span class="ident" id="4708137">comments</span><span class="op" id="4708145">}</span><br>
<span class="lineno"></span><span class="op" id="4708147">}</span>
</div>
</body>
</html>
