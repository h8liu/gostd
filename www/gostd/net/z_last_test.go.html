<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8545905">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8545960">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8546014">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8546065">package</span>&nbsp;<span class="ident" id="8546073">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8546078">import</span>&nbsp;<span class="op" id="8546085">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8546088">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8546096">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8546103">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8546114">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8546121">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8546124">var</span>&nbsp;<span class="ident" id="8546128">testDNSFlood</span>&nbsp;<span class="op" id="8546141">=</span>&nbsp;<span class="ident" id="8546143">flag</span><span class="op" id="8546147">.</span><span class="ident" id="8546148">Bool</span><span class="op" id="8546152">(</span><span class="string" id="8546153">&#34;dnsflood&#34;</span><span class="op" id="8546163">,</span>&nbsp;<span class="builtintype" id="8546165">false</span><span class="op" id="8546170">,</span>&nbsp;<span class="string" id="8546172">&#34;whether&nbsp;to&nbsp;test&nbsp;dns&nbsp;query&nbsp;flooding&#34;</span><span class="op" id="8546208">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8546211">func</span>&nbsp;<span class="ident" id="8546216">TestDNSThreadLimit</span><span class="op" id="8546234">(</span><span class="ident" id="8546235">t</span>&nbsp;<span class="op" id="8546237">*</span><span class="ident" id="8546238">testing</span><span class="op" id="8546245">.</span><span class="ident" id="8546246">T</span><span class="op" id="8546247">)</span>&nbsp;<span class="op" id="8546249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8546252">if</span>&nbsp;<span class="op" id="8546255">!</span><span class="op" id="8546256">*</span><span class="ident" id="8546257">testDNSFlood</span>&nbsp;<span class="op" id="8546270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8546274">t</span><span class="op" id="8546275">.</span><span class="ident" id="8546276">Skip</span><span class="op" id="8546280">(</span><span class="string" id="8546281">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-dnsflood&nbsp;to&nbsp;enable&#34;</span><span class="op" id="8546321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8546324">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8546328">const</span>&nbsp;<span class="ident" id="8546334">N</span>&nbsp;<span class="op" id="8546336">=</span>&nbsp;<span class="num" id="8546338">10000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8546345">c</span>&nbsp;<span class="op" id="8546347">:=</span>&nbsp;<span class="builtinfunc" id="8546350">make</span><span class="op" id="8546354">(</span><span class="keyword" id="8546355">chan</span>&nbsp;<span class="builtintype" id="8546360">int</span><span class="op" id="8546363">,</span>&nbsp;<span class="ident" id="8546365">N</span><span class="op" id="8546366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8546369">for</span>&nbsp;<span class="ident" id="8546373">i</span>&nbsp;<span class="op" id="8546375">:=</span>&nbsp;<span class="num" id="8546378">0</span><span class="op" id="8546379">;</span>&nbsp;<span class="ident" id="8546381">i</span>&nbsp;<span class="op" id="8546383">&lt;</span>&nbsp;<span class="ident" id="8546385">N</span><span class="op" id="8546386">;</span>&nbsp;<span class="ident" id="8546388">i</span><span class="op" id="8546389">++</span>&nbsp;<span class="op" id="8546392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8546396">go</span>&nbsp;<span class="keyword" id="8546399">func</span><span class="op" id="8546403">(</span><span class="ident" id="8546404">i</span>&nbsp;<span class="builtintype" id="8546406">int</span><span class="op" id="8546409">)</span>&nbsp;<span class="op" id="8546411">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8546416">LookupIP</span><span class="op" id="8546424">(</span><span class="ident" id="8546425">fmt</span><span class="op" id="8546428">.</span><span class="ident" id="8546429">Sprintf</span><span class="op" id="8546436">(</span><span class="string" id="8546437">&#34;%d.net-test.golang.org&#34;</span><span class="op" id="8546461">,</span>&nbsp;<span class="ident" id="8546463">i</span><span class="op" id="8546464">)</span><span class="op" id="8546465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8546470">c</span>&nbsp;<span class="op" id="8546472">&lt;-</span>&nbsp;<span class="num" id="8546475">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8546479">}</span><span class="op" id="8546480">(</span><span class="ident" id="8546481">i</span><span class="op" id="8546482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8546485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8546488">//&nbsp;Don&#39;t&nbsp;bother&nbsp;waiting&nbsp;for&nbsp;the&nbsp;stragglers;&nbsp;stop&nbsp;at&nbsp;0.9&nbsp;N.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8546548">for</span>&nbsp;<span class="ident" id="8546552">i</span>&nbsp;<span class="op" id="8546554">:=</span>&nbsp;<span class="num" id="8546557">0</span><span class="op" id="8546558">;</span>&nbsp;<span class="ident" id="8546560">i</span>&nbsp;<span class="op" id="8546562">&lt;</span>&nbsp;<span class="ident" id="8546564">N</span><span class="op" id="8546565">*</span><span class="num" id="8546566">9</span><span class="op" id="8546567">/</span><span class="num" id="8546568">10</span><span class="op" id="8546570">;</span>&nbsp;<span class="ident" id="8546572">i</span><span class="op" id="8546573">++</span>&nbsp;<span class="op" id="8546576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8546580">if</span>&nbsp;<span class="ident" id="8546583">i</span><span class="op" id="8546584">%</span><span class="num" id="8546585">100</span>&nbsp;<span class="op" id="8546589">==</span>&nbsp;<span class="num" id="8546592">0</span>&nbsp;<span class="op" id="8546594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8546599">//println(&#34;TestDNSThreadLimit:&#34;,&nbsp;i)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8546637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8546641">&lt;-</span><span class="ident" id="8546643">c</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8546646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8546650">//&nbsp;If&nbsp;we&#39;re&nbsp;still&nbsp;here,&nbsp;it&nbsp;worked.</span><br>
<span class="lineno"></span><span class="op" id="8546685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="8546688">func</span>&nbsp;<span class="ident" id="8546693">TestLookupIPDeadline</span><span class="op" id="8546713">(</span><span class="ident" id="8546714">t</span>&nbsp;<span class="op" id="8546716">*</span><span class="ident" id="8546717">testing</span><span class="op" id="8546724">.</span><span class="ident" id="8546725">T</span><span class="op" id="8546726">)</span>&nbsp;<span class="op" id="8546728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8546731">if</span>&nbsp;<span class="op" id="8546734">!</span><span class="op" id="8546735">*</span><span class="ident" id="8546736">testDNSFlood</span>&nbsp;<span class="op" id="8546749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8546753">t</span><span class="op" id="8546754">.</span><span class="ident" id="8546755">Skip</span><span class="op" id="8546759">(</span><span class="string" id="8546760">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-dnsflood&nbsp;to&nbsp;enable&#34;</span><span class="op" id="8546800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8546803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8546807">const</span>&nbsp;<span class="ident" id="8546813">N</span>&nbsp;<span class="op" id="8546815">=</span>&nbsp;<span class="num" id="8546817">5000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8546823">const</span>&nbsp;<span class="ident" id="8546829">timeout</span>&nbsp;<span class="op" id="8546837">=</span>&nbsp;<span class="num" id="8546839">3</span>&nbsp;<span class="op" id="8546841">*</span>&nbsp;<span class="ident" id="8546843">time</span><span class="op" id="8546847">.</span><span class="ident" id="8546848">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8546856">c</span>&nbsp;<span class="op" id="8546858">:=</span>&nbsp;<span class="builtinfunc" id="8546861">make</span><span class="op" id="8546865">(</span><span class="keyword" id="8546866">chan</span>&nbsp;<span class="builtintype" id="8546871">error</span><span class="op" id="8546876">,</span>&nbsp;<span class="num" id="8546878">2</span><span class="op" id="8546879">*</span><span class="ident" id="8546880">N</span><span class="op" id="8546881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8546884">for</span>&nbsp;<span class="ident" id="8546888">i</span>&nbsp;<span class="op" id="8546890">:=</span>&nbsp;<span class="num" id="8546893">0</span><span class="op" id="8546894">;</span>&nbsp;<span class="ident" id="8546896">i</span>&nbsp;<span class="op" id="8546898">&lt;</span>&nbsp;<span class="ident" id="8546900">N</span><span class="op" id="8546901">;</span>&nbsp;<span class="ident" id="8546903">i</span><span class="op" id="8546904">++</span>&nbsp;<span class="op" id="8546907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8546911">name</span>&nbsp;<span class="op" id="8546916">:=</span>&nbsp;<span class="ident" id="8546919">fmt</span><span class="op" id="8546922">.</span><span class="ident" id="8546923">Sprintf</span><span class="op" id="8546930">(</span><span class="string" id="8546931">&#34;%d.net-test.golang.org&#34;</span><span class="op" id="8546955">,</span>&nbsp;<span class="ident" id="8546957">i</span><span class="op" id="8546958">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8546962">go</span>&nbsp;<span class="keyword" id="8546965">func</span><span class="op" id="8546969">(</span><span class="op" id="8546970">)</span>&nbsp;<span class="op" id="8546972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8546977">_</span><span class="op" id="8546978">,</span>&nbsp;<span class="ident" id="8546980">err</span>&nbsp;<span class="op" id="8546984">:=</span>&nbsp;<span class="ident" id="8546987">lookupIPDeadline</span><span class="op" id="8547003">(</span><span class="ident" id="8547004">name</span><span class="op" id="8547008">,</span>&nbsp;<span class="ident" id="8547010">time</span><span class="op" id="8547014">.</span><span class="ident" id="8547015">Now</span><span class="op" id="8547018">(</span><span class="op" id="8547019">)</span><span class="op" id="8547020">.</span><span class="ident" id="8547021">Add</span><span class="op" id="8547024">(</span><span class="ident" id="8547025">timeout</span><span class="op" id="8547032">/</span><span class="num" id="8547033">2</span><span class="op" id="8547034">)</span><span class="op" id="8547035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8547040">c</span>&nbsp;<span class="op" id="8547042">&lt;-</span>&nbsp;<span class="ident" id="8547045">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8547051">}</span><span class="op" id="8547052">(</span><span class="op" id="8547053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8547057">go</span>&nbsp;<span class="keyword" id="8547060">func</span><span class="op" id="8547064">(</span><span class="op" id="8547065">)</span>&nbsp;<span class="op" id="8547067">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8547072">_</span><span class="op" id="8547073">,</span>&nbsp;<span class="ident" id="8547075">err</span>&nbsp;<span class="op" id="8547079">:=</span>&nbsp;<span class="ident" id="8547082">lookupIPDeadline</span><span class="op" id="8547098">(</span><span class="ident" id="8547099">name</span><span class="op" id="8547103">,</span>&nbsp;<span class="ident" id="8547105">time</span><span class="op" id="8547109">.</span><span class="ident" id="8547110">Now</span><span class="op" id="8547113">(</span><span class="op" id="8547114">)</span><span class="op" id="8547115">.</span><span class="ident" id="8547116">Add</span><span class="op" id="8547119">(</span><span class="ident" id="8547120">timeout</span><span class="op" id="8547127">)</span><span class="op" id="8547128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8547133">c</span>&nbsp;<span class="op" id="8547135">&lt;-</span>&nbsp;<span class="ident" id="8547138">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8547144">}</span><span class="op" id="8547145">(</span><span class="op" id="8547146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8547149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8547152">qstats</span>&nbsp;<span class="op" id="8547159">:=</span>&nbsp;<span class="keyword" id="8547162">struct</span>&nbsp;<span class="op" id="8547169">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8547173">succeeded</span><span class="op" id="8547182">,</span>&nbsp;<span class="ident" id="8547184">failed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8547199">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8547205">timeout</span><span class="op" id="8547212">,</span>&nbsp;<span class="ident" id="8547214">temporary</span><span class="op" id="8547223">,</span>&nbsp;<span class="ident" id="8547225">other</span>&nbsp;<span class="builtintype" id="8547231">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8547237">unknown</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8547263">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8547268">}</span><span class="op" id="8547269">{</span><span class="op" id="8547270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8547273">deadline</span>&nbsp;<span class="op" id="8547282">:=</span>&nbsp;<span class="ident" id="8547285">time</span><span class="op" id="8547289">.</span><span class="ident" id="8547290">After</span><span class="op" id="8547295">(</span><span class="ident" id="8547296">timeout</span>&nbsp;<span class="op" id="8547304">+</span>&nbsp;<span class="ident" id="8547306">time</span><span class="op" id="8547310">.</span><span class="ident" id="8547311">Second</span><span class="op" id="8547317">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8547320">for</span>&nbsp;<span class="ident" id="8547324">i</span>&nbsp;<span class="op" id="8547326">:=</span>&nbsp;<span class="num" id="8547329">0</span><span class="op" id="8547330">;</span>&nbsp;<span class="ident" id="8547332">i</span>&nbsp;<span class="op" id="8547334">&lt;</span>&nbsp;<span class="num" id="8547336">2</span><span class="op" id="8547337">*</span><span class="ident" id="8547338">N</span><span class="op" id="8547339">;</span>&nbsp;<span class="ident" id="8547341">i</span><span class="op" id="8547342">++</span>&nbsp;<span class="op" id="8547345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8547349">select</span>&nbsp;<span class="op" id="8547356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8547360">case</span>&nbsp;<span class="op" id="8547365">&lt;-</span><span class="ident" id="8547367">deadline</span><span class="op" id="8547375">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8547380">t</span><span class="op" id="8547381">.</span><span class="ident" id="8547382">Fatal</span><span class="op" id="8547387">(</span><span class="string" id="8547388">&#34;deadline&nbsp;exceeded&#34;</span><span class="op" id="8547407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8547411">case</span>&nbsp;<span class="ident" id="8547416">err</span>&nbsp;<span class="op" id="8547420">:=</span>&nbsp;<span class="op" id="8547423">&lt;-</span><span class="ident" id="8547425">c</span><span class="op" id="8547426">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8547431">switch</span>&nbsp;<span class="ident" id="8547438">err</span>&nbsp;<span class="op" id="8547442">:=</span>&nbsp;<span class="ident" id="8547445">err</span><span class="op" id="8547448">.</span><span class="op" id="8547449">(</span><span class="keyword" id="8547450">type</span><span class="op" id="8547454">)</span>&nbsp;<span class="op" id="8547456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8547461">case</span>&nbsp;<span class="ident" id="8547466">nil</span><span class="op" id="8547469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8547475">qstats</span><span class="op" id="8547481">.</span><span class="ident" id="8547482">succeeded</span><span class="op" id="8547491">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8547497">case</span>&nbsp;<span class="ident" id="8547502">Error</span><span class="op" id="8547507">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8547513">qstats</span><span class="op" id="8547519">.</span><span class="ident" id="8547520">failed</span><span class="op" id="8547526">++</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8547533">if</span>&nbsp;<span class="ident" id="8547536">err</span><span class="op" id="8547539">.</span><span class="ident" id="8547540">Timeout</span><span class="op" id="8547547">(</span><span class="op" id="8547548">)</span>&nbsp;<span class="op" id="8547550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8547557">qstats</span><span class="op" id="8547563">.</span><span class="ident" id="8547564">timeout</span><span class="op" id="8547571">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8547578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8547584">if</span>&nbsp;<span class="ident" id="8547587">err</span><span class="op" id="8547590">.</span><span class="ident" id="8547591">Temporary</span><span class="op" id="8547600">(</span><span class="op" id="8547601">)</span>&nbsp;<span class="op" id="8547603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8547610">qstats</span><span class="op" id="8547616">.</span><span class="ident" id="8547617">temporary</span><span class="op" id="8547626">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8547633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8547639">if</span>&nbsp;<span class="op" id="8547642">!</span><span class="ident" id="8547643">err</span><span class="op" id="8547646">.</span><span class="ident" id="8547647">Timeout</span><span class="op" id="8547654">(</span><span class="op" id="8547655">)</span>&nbsp;<span class="op" id="8547657">&amp;&amp;</span>&nbsp;<span class="op" id="8547660">!</span><span class="ident" id="8547661">err</span><span class="op" id="8547664">.</span><span class="ident" id="8547665">Temporary</span><span class="op" id="8547674">(</span><span class="op" id="8547675">)</span>&nbsp;<span class="op" id="8547677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8547684">qstats</span><span class="op" id="8547690">.</span><span class="ident" id="8547691">other</span><span class="op" id="8547696">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8547703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8547708">default</span><span class="op" id="8547715">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8547721">qstats</span><span class="op" id="8547727">.</span><span class="ident" id="8547728">failed</span><span class="op" id="8547734">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8547741">qstats</span><span class="op" id="8547747">.</span><span class="ident" id="8547748">unknown</span><span class="op" id="8547755">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8547761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8547765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8547768">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8547772">//&nbsp;A&nbsp;high&nbsp;volume&nbsp;of&nbsp;DNS&nbsp;queries&nbsp;for&nbsp;sub-domain&nbsp;of&nbsp;golang.org</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8547834">//&nbsp;would&nbsp;be&nbsp;coordinated&nbsp;by&nbsp;authoritative&nbsp;or&nbsp;recursive&nbsp;server,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8547897">//&nbsp;or&nbsp;stub&nbsp;resolver&nbsp;which&nbsp;implements&nbsp;query-response&nbsp;rate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8547955">//&nbsp;limitation,&nbsp;so&nbsp;we&nbsp;can&nbsp;expect&nbsp;some&nbsp;query&nbsp;successes&nbsp;and&nbsp;more</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8548018">//&nbsp;failures&nbsp;including&nbsp;timeout,&nbsp;temporary&nbsp;and&nbsp;other&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8548076">//&nbsp;As&nbsp;a&nbsp;rule,&nbsp;unknown&nbsp;must&nbsp;not&nbsp;be&nbsp;shown&nbsp;but&nbsp;it&nbsp;might&nbsp;possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8548139">//&nbsp;happen&nbsp;due&nbsp;to&nbsp;issue&nbsp;4856&nbsp;for&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8548177">t</span><span class="op" id="8548178">.</span><span class="ident" id="8548179">Logf</span><span class="op" id="8548183">(</span><span class="string" id="8548184">&#34;%v&nbsp;succeeded,&nbsp;%v&nbsp;failed&nbsp;(%v&nbsp;timeout,&nbsp;%v&nbsp;temporary,&nbsp;%v&nbsp;other,&nbsp;%v&nbsp;unknown)&#34;</span><span class="op" id="8548258">,</span>&nbsp;<span class="ident" id="8548260">qstats</span><span class="op" id="8548266">.</span><span class="ident" id="8548267">succeeded</span><span class="op" id="8548276">,</span>&nbsp;<span class="ident" id="8548278">qstats</span><span class="op" id="8548284">.</span><span class="ident" id="8548285">failed</span><span class="op" id="8548291">,</span>&nbsp;<span class="ident" id="8548293">qstats</span><span class="op" id="8548299">.</span><span class="ident" id="8548300">timeout</span><span class="op" id="8548307">,</span>&nbsp;<span class="ident" id="8548309">qstats</span><span class="op" id="8548315">.</span><span class="ident" id="8548316">temporary</span><span class="op" id="8548325">,</span>&nbsp;<span class="ident" id="8548327">qstats</span><span class="op" id="8548333">.</span><span class="ident" id="8548334">other</span><span class="op" id="8548339">,</span>&nbsp;<span class="ident" id="8548341">qstats</span><span class="op" id="8548347">.</span><span class="ident" id="8548348">unknown</span><span class="op" id="8548355">)</span><br>
<span class="lineno"></span><span class="op" id="8548357">}</span>
</div>
</body>
</html>
