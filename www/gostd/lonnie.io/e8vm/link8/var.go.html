<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/link8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/link8/func.go.html">func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/layout.go.html">layout.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/link.go.html">link.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/linker.go.html">linker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/package.go.html">package.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/pkg_sym.go.html">pkg_sym.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/symbol.go.html">symbol.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/trace_used.go.html">trace_used.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/var.go.html">var.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="4820806">package</span>&nbsp;<span class="ident" id="4820814">link8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4820821">import</span>&nbsp;<span class="op" id="4820828">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4820831">&#34;bytes&#34;</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4820840">&#34;math&#34;</span><br>
<span class="lineno"></span><span class="op" id="4820847">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4820850">//&nbsp;Var&nbsp;reprsents&nbsp;a&nbsp;variable&nbsp;object</span><br>
<span class="lineno"></span><span class="keyword" id="4820885">type</span>&nbsp;<span class="ident" id="4820890">Var</span>&nbsp;<span class="keyword" id="4820894">struct</span>&nbsp;<span class="op" id="4820901">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820904">align</span>&nbsp;<span class="builtintype" id="4820910">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820918">buf</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4820924">*</span><span class="ident" id="4820925">bytes</span><span class="op" id="4820930">.</span><span class="ident" id="4820931">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820940">addr</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4820947">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820955">prePad</span>&nbsp;<span class="builtintype" id="4820962">uint32</span><br>
<span class="lineno">15</span><span class="op" id="4820969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4820972">//&nbsp;NewVar&nbsp;creates&nbsp;a&nbsp;new&nbsp;relocatable&nbsp;data&nbsp;section.</span><br>
<span class="lineno"></span><span class="keyword" id="4821022">func</span>&nbsp;<span class="ident" id="4821027">NewVar</span><span class="op" id="4821033">(</span><span class="ident" id="4821034">align</span>&nbsp;<span class="builtintype" id="4821040">uint32</span><span class="op" id="4821046">)</span>&nbsp;<span class="op" id="4821048">*</span><span class="ident" id="4821049">Var</span>&nbsp;<span class="op" id="4821053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821056">ret</span>&nbsp;<span class="op" id="4821060">:=</span>&nbsp;<span class="builtinfunc" id="4821063">new</span><span class="op" id="4821066">(</span><span class="ident" id="4821067">Var</span><span class="op" id="4821070">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821074">if</span>&nbsp;<span class="ident" id="4821077">align</span>&nbsp;<span class="op" id="4821083">==</span>&nbsp;<span class="num" id="4821086">0</span>&nbsp;<span class="op" id="4821088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821092">align</span>&nbsp;<span class="op" id="4821098">=</span>&nbsp;<span class="num" id="4821100">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4821103">}</span>&nbsp;<span class="keyword" id="4821105">else</span>&nbsp;<span class="keyword" id="4821110">if</span>&nbsp;<span class="ident" id="4821113">align</span>&nbsp;<span class="op" id="4821119">!=</span>&nbsp;<span class="num" id="4821122">1</span>&nbsp;<span class="op" id="4821124">&amp;&amp;</span>&nbsp;<span class="ident" id="4821127">align</span>&nbsp;<span class="op" id="4821133">!=</span>&nbsp;<span class="num" id="4821136">4</span>&nbsp;<span class="op" id="4821138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4821142">panic</span><span class="op" id="4821147">(</span><span class="string" id="4821148">&#34;invalid&nbsp;align&#34;</span><span class="op" id="4821163">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4821166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821170">ret</span><span class="op" id="4821173">.</span><span class="ident" id="4821174">align</span>&nbsp;<span class="op" id="4821180">=</span>&nbsp;<span class="ident" id="4821182">align</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821189">ret</span><span class="op" id="4821192">.</span><span class="ident" id="4821193">buf</span>&nbsp;<span class="op" id="4821197">=</span>&nbsp;<span class="builtinfunc" id="4821199">new</span><span class="op" id="4821202">(</span><span class="ident" id="4821203">bytes</span><span class="op" id="4821208">.</span><span class="ident" id="4821209">Buffer</span><span class="op" id="4821215">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821219">return</span>&nbsp;<span class="ident" id="4821226">ret</span><br>
<span class="lineno"></span><span class="op" id="4821230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4821233">//&nbsp;Write&nbsp;appends&nbsp;bytes&nbsp;to&nbsp;this&nbsp;data&nbsp;section.</span><br>
<span class="lineno"></span><span class="keyword" id="4821278">func</span>&nbsp;<span class="op" id="4821283">(</span><span class="ident" id="4821284">v</span>&nbsp;<span class="op" id="4821286">*</span><span class="ident" id="4821287">Var</span><span class="op" id="4821290">)</span>&nbsp;<span class="ident" id="4821292">Write</span><span class="op" id="4821297">(</span><span class="ident" id="4821298">buf</span>&nbsp;<span class="op" id="4821302">[</span><span class="op" id="4821303">]</span><span class="builtintype" id="4821304">byte</span><span class="op" id="4821308">)</span>&nbsp;<span class="op" id="4821310">(</span><span class="builtintype" id="4821311">int</span><span class="op" id="4821314">,</span>&nbsp;<span class="builtintype" id="4821316">error</span><span class="op" id="4821321">)</span>&nbsp;<span class="op" id="4821323">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821326">return</span>&nbsp;<span class="ident" id="4821333">v</span><span class="op" id="4821334">.</span><span class="ident" id="4821335">buf</span><span class="op" id="4821338">.</span><span class="ident" id="4821339">Write</span><span class="op" id="4821344">(</span><span class="ident" id="4821345">buf</span><span class="op" id="4821348">)</span><br>
<span class="lineno"></span><span class="op" id="4821350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4821353">//&nbsp;Pad&nbsp;pads&nbsp;n&nbsp;bytes&nbsp;into&nbsp;this&nbsp;data&nbsp;section</span><br>
<span class="lineno"></span><span class="keyword" id="4821396">func</span>&nbsp;<span class="op" id="4821401">(</span><span class="ident" id="4821402">v</span>&nbsp;<span class="op" id="4821404">*</span><span class="ident" id="4821405">Var</span><span class="op" id="4821408">)</span>&nbsp;<span class="ident" id="4821410">Pad</span><span class="op" id="4821413">(</span><span class="ident" id="4821414">n</span>&nbsp;<span class="builtintype" id="4821416">uint32</span><span class="op" id="4821422">)</span>&nbsp;<span class="op" id="4821424">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821427">v</span><span class="op" id="4821428">.</span><span class="ident" id="4821429">buf</span><span class="op" id="4821432">.</span><span class="ident" id="4821433">Write</span><span class="op" id="4821438">(</span><span class="builtinfunc" id="4821439">make</span><span class="op" id="4821443">(</span><span class="op" id="4821444">[</span><span class="op" id="4821445">]</span><span class="builtintype" id="4821446">byte</span><span class="op" id="4821450">,</span>&nbsp;<span class="ident" id="4821452">n</span><span class="op" id="4821453">)</span><span class="op" id="4821454">)</span><br>
<span class="lineno"></span><span class="op" id="4821456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4821459">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;current&nbsp;size&nbsp;of&nbsp;the&nbsp;section</span><br>
<span class="lineno"></span><span class="keyword" id="4821507">func</span>&nbsp;<span class="op" id="4821512">(</span><span class="ident" id="4821513">v</span>&nbsp;<span class="op" id="4821515">*</span><span class="ident" id="4821516">Var</span><span class="op" id="4821519">)</span>&nbsp;<span class="ident" id="4821521">Size</span><span class="op" id="4821525">(</span><span class="op" id="4821526">)</span>&nbsp;<span class="builtintype" id="4821528">uint32</span>&nbsp;<span class="op" id="4821535">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821538">return</span>&nbsp;<span class="builtintype" id="4821545">uint32</span><span class="op" id="4821551">(</span><span class="ident" id="4821552">v</span><span class="op" id="4821553">.</span><span class="ident" id="4821554">buf</span><span class="op" id="4821557">.</span><span class="ident" id="4821558">Len</span><span class="op" id="4821561">(</span><span class="op" id="4821562">)</span><span class="op" id="4821563">)</span><br>
<span class="lineno"></span><span class="op" id="4821565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4821568">//&nbsp;TooLarge&nbsp;checks&nbsp;if&nbsp;the&nbsp;size&nbsp;is&nbsp;larger&nbsp;than&nbsp;2GB</span><br>
<span class="lineno"></span><span class="keyword" id="4821618">func</span>&nbsp;<span class="op" id="4821623">(</span><span class="ident" id="4821624">v</span>&nbsp;<span class="op" id="4821626">*</span><span class="ident" id="4821627">Var</span><span class="op" id="4821630">)</span>&nbsp;<span class="ident" id="4821632">TooLarge</span><span class="op" id="4821640">(</span><span class="op" id="4821641">)</span>&nbsp;<span class="builtintype" id="4821643">bool</span>&nbsp;<span class="op" id="4821648">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821651">return</span>&nbsp;<span class="ident" id="4821658">v</span><span class="op" id="4821659">.</span><span class="ident" id="4821660">buf</span><span class="op" id="4821663">.</span><span class="ident" id="4821664">Len</span><span class="op" id="4821667">(</span><span class="op" id="4821668">)</span>&nbsp;<span class="op" id="4821670">&gt;</span>&nbsp;<span class="ident" id="4821672">math</span><span class="op" id="4821676">.</span><span class="ident" id="4821677">MaxInt32</span><br>
<span class="lineno"></span><span class="op" id="4821686">}</span>
</div>
</body>
</html>
