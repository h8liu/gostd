<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6082563">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6082618">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6082672">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6082723">package</span>&nbsp;<span class="ident" id="6082731">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6082736">import</span>&nbsp;<span class="op" id="6082743">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082746">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082755">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082774">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082784">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082792">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082806">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082812">&#34;os&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6082817">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6082820">var</span>&nbsp;<span class="op" id="6082824">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082827">ErrFormat</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6082840">=</span>&nbsp;<span class="ident" id="6082842">errors</span><span class="op" id="6082848">.</span><span class="ident" id="6082849">New</span><span class="op" id="6082852">(</span><span class="string" id="6082853">&#34;zip:&nbsp;not&nbsp;a&nbsp;valid&nbsp;zip&nbsp;file&#34;</span><span class="op" id="6082880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082883">ErrAlgorithm</span>&nbsp;<span class="op" id="6082896">=</span>&nbsp;<span class="ident" id="6082898">errors</span><span class="op" id="6082904">.</span><span class="ident" id="6082905">New</span><span class="op" id="6082908">(</span><span class="string" id="6082909">&#34;zip:&nbsp;unsupported&nbsp;compression&nbsp;algorithm&#34;</span><span class="op" id="6082949">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082952">ErrChecksum</span>&nbsp;&nbsp;<span class="op" id="6082965">=</span>&nbsp;<span class="ident" id="6082967">errors</span><span class="op" id="6082973">.</span><span class="ident" id="6082974">New</span><span class="op" id="6082977">(</span><span class="string" id="6082978">&#34;zip:&nbsp;checksum&nbsp;error&#34;</span><span class="op" id="6082999">)</span><br>
<span class="lineno"></span><span class="op" id="6083001">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6083004">type</span>&nbsp;<span class="ident" id="6083009">Reader</span>&nbsp;<span class="keyword" id="6083016">struct</span>&nbsp;<span class="op" id="6083023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083026">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083034">io</span><span class="op" id="6083036">.</span><span class="ident" id="6083037">ReaderAt</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083047">File</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083055">[</span><span class="op" id="6083056">]</span><span class="op" id="6083057">*</span><span class="ident" id="6083058">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083064">Comment</span>&nbsp;<span class="builtintype" id="6083072">string</span><br>
<span class="lineno"></span><span class="op" id="6083079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6083082">type</span>&nbsp;<span class="ident" id="6083087">ReadCloser</span>&nbsp;<span class="keyword" id="6083098">struct</span>&nbsp;<span class="op" id="6083105">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083108">f</span>&nbsp;<span class="op" id="6083110">*</span><span class="ident" id="6083111">os</span><span class="op" id="6083113">.</span><span class="ident" id="6083114">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083120">Reader</span><br>
<span class="lineno"></span><span class="op" id="6083127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6083130">type</span>&nbsp;<span class="ident" id="6083135">File</span>&nbsp;<span class="keyword" id="6083140">struct</span>&nbsp;<span class="op" id="6083147">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083150">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083162">zipr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083175">io</span><span class="op" id="6083177">.</span><span class="ident" id="6083178">ReaderAt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083188">zipsize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083201">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083208">headerOffset</span>&nbsp;<span class="ident" id="6083221">int64</span><br>
<span class="lineno"></span><span class="op" id="6083227">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6083230">func</span>&nbsp;<span class="op" id="6083235">(</span><span class="ident" id="6083236">f</span>&nbsp;<span class="op" id="6083238">*</span><span class="ident" id="6083239">File</span><span class="op" id="6083243">)</span>&nbsp;<span class="ident" id="6083245">hasDataDescriptor</span><span class="op" id="6083262">(</span><span class="op" id="6083263">)</span>&nbsp;<span class="builtintype" id="6083265">bool</span>&nbsp;<span class="op" id="6083270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083273">return</span>&nbsp;<span class="ident" id="6083280">f</span><span class="op" id="6083281">.</span><span class="ident" id="6083282">Flags</span><span class="op" id="6083287">&amp;</span><span class="num" id="6083288">0x8</span>&nbsp;<span class="op" id="6083292">!=</span>&nbsp;<span class="num" id="6083295">0</span><br>
<span class="lineno"></span><span class="op" id="6083297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="6083300">//&nbsp;OpenReader&nbsp;will&nbsp;open&nbsp;the&nbsp;Zip&nbsp;file&nbsp;specified&nbsp;by&nbsp;name&nbsp;and&nbsp;return&nbsp;a&nbsp;ReadCloser.</span><br>
<span class="lineno"></span><span class="keyword" id="6083380">func</span>&nbsp;<span class="ident" id="6083385">OpenReader</span><span class="op" id="6083395">(</span><span class="ident" id="6083396">name</span>&nbsp;<span class="builtintype" id="6083401">string</span><span class="op" id="6083407">)</span>&nbsp;<span class="op" id="6083409">(</span><span class="op" id="6083410">*</span><span class="ident" id="6083411">ReadCloser</span><span class="op" id="6083421">,</span>&nbsp;<span class="builtintype" id="6083423">error</span><span class="op" id="6083428">)</span>&nbsp;<span class="op" id="6083430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083433">f</span><span class="op" id="6083434">,</span>&nbsp;<span class="ident" id="6083436">err</span>&nbsp;<span class="op" id="6083440">:=</span>&nbsp;<span class="ident" id="6083443">os</span><span class="op" id="6083445">.</span><span class="ident" id="6083446">Open</span><span class="op" id="6083450">(</span><span class="ident" id="6083451">name</span><span class="op" id="6083455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083458">if</span>&nbsp;<span class="ident" id="6083461">err</span>&nbsp;<span class="op" id="6083465">!=</span>&nbsp;<span class="ident" id="6083468">nil</span>&nbsp;<span class="op" id="6083472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083476">return</span>&nbsp;<span class="ident" id="6083483">nil</span><span class="op" id="6083486">,</span>&nbsp;<span class="ident" id="6083488">err</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083496">fi</span><span class="op" id="6083498">,</span>&nbsp;<span class="ident" id="6083500">err</span>&nbsp;<span class="op" id="6083504">:=</span>&nbsp;<span class="ident" id="6083507">f</span><span class="op" id="6083508">.</span><span class="ident" id="6083509">Stat</span><span class="op" id="6083513">(</span><span class="op" id="6083514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083517">if</span>&nbsp;<span class="ident" id="6083520">err</span>&nbsp;<span class="op" id="6083524">!=</span>&nbsp;<span class="ident" id="6083527">nil</span>&nbsp;<span class="op" id="6083531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083535">f</span><span class="op" id="6083536">.</span><span class="ident" id="6083537">Close</span><span class="op" id="6083542">(</span><span class="op" id="6083543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083547">return</span>&nbsp;<span class="ident" id="6083554">nil</span><span class="op" id="6083557">,</span>&nbsp;<span class="ident" id="6083559">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083567">r</span>&nbsp;<span class="op" id="6083569">:=</span>&nbsp;<span class="builtinfunc" id="6083572">new</span><span class="op" id="6083575">(</span><span class="ident" id="6083576">ReadCloser</span><span class="op" id="6083586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083589">if</span>&nbsp;<span class="ident" id="6083592">err</span>&nbsp;<span class="op" id="6083596">:=</span>&nbsp;<span class="ident" id="6083599">r</span><span class="op" id="6083600">.</span><span class="ident" id="6083601">init</span><span class="op" id="6083605">(</span><span class="ident" id="6083606">f</span><span class="op" id="6083607">,</span>&nbsp;<span class="ident" id="6083609">fi</span><span class="op" id="6083611">.</span><span class="ident" id="6083612">Size</span><span class="op" id="6083616">(</span><span class="op" id="6083617">)</span><span class="op" id="6083618">)</span><span class="op" id="6083619">;</span>&nbsp;<span class="ident" id="6083621">err</span>&nbsp;<span class="op" id="6083625">!=</span>&nbsp;<span class="ident" id="6083628">nil</span>&nbsp;<span class="op" id="6083632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083636">f</span><span class="op" id="6083637">.</span><span class="ident" id="6083638">Close</span><span class="op" id="6083643">(</span><span class="op" id="6083644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083648">return</span>&nbsp;<span class="ident" id="6083655">nil</span><span class="op" id="6083658">,</span>&nbsp;<span class="ident" id="6083660">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083668">r</span><span class="op" id="6083669">.</span><span class="ident" id="6083670">f</span>&nbsp;<span class="op" id="6083672">=</span>&nbsp;<span class="ident" id="6083674">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083677">return</span>&nbsp;<span class="ident" id="6083684">r</span><span class="op" id="6083685">,</span>&nbsp;<span class="ident" id="6083687">nil</span><br>
<span class="lineno"></span><span class="op" id="6083691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="6083694">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r,&nbsp;which&nbsp;is&nbsp;assumed&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6083764">//&nbsp;have&nbsp;the&nbsp;given&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6083797">func</span>&nbsp;<span class="ident" id="6083802">NewReader</span><span class="op" id="6083811">(</span><span class="ident" id="6083812">r</span>&nbsp;<span class="ident" id="6083814">io</span><span class="op" id="6083816">.</span><span class="ident" id="6083817">ReaderAt</span><span class="op" id="6083825">,</span>&nbsp;<span class="ident" id="6083827">size</span>&nbsp;<span class="ident" id="6083832">int64</span><span class="op" id="6083837">)</span>&nbsp;<span class="op" id="6083839">(</span><span class="op" id="6083840">*</span><span class="ident" id="6083841">Reader</span><span class="op" id="6083847">,</span>&nbsp;<span class="builtintype" id="6083849">error</span><span class="op" id="6083854">)</span>&nbsp;<span class="op" id="6083856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083859">zr</span>&nbsp;<span class="op" id="6083862">:=</span>&nbsp;<span class="builtinfunc" id="6083865">new</span><span class="op" id="6083868">(</span><span class="ident" id="6083869">Reader</span><span class="op" id="6083875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083878">if</span>&nbsp;<span class="ident" id="6083881">err</span>&nbsp;<span class="op" id="6083885">:=</span>&nbsp;<span class="ident" id="6083888">zr</span><span class="op" id="6083890">.</span><span class="ident" id="6083891">init</span><span class="op" id="6083895">(</span><span class="ident" id="6083896">r</span><span class="op" id="6083897">,</span>&nbsp;<span class="ident" id="6083899">size</span><span class="op" id="6083903">)</span><span class="op" id="6083904">;</span>&nbsp;<span class="ident" id="6083906">err</span>&nbsp;<span class="op" id="6083910">!=</span>&nbsp;<span class="ident" id="6083913">nil</span>&nbsp;<span class="op" id="6083917">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083921">return</span>&nbsp;<span class="ident" id="6083928">nil</span><span class="op" id="6083931">,</span>&nbsp;<span class="ident" id="6083933">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083941">return</span>&nbsp;<span class="ident" id="6083948">zr</span><span class="op" id="6083950">,</span>&nbsp;<span class="ident" id="6083952">nil</span><br>
<span class="lineno"></span><span class="op" id="6083956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6083959">func</span>&nbsp;<span class="op" id="6083964">(</span><span class="ident" id="6083965">z</span>&nbsp;<span class="op" id="6083967">*</span><span class="ident" id="6083968">Reader</span><span class="op" id="6083974">)</span>&nbsp;<span class="ident" id="6083976">init</span><span class="op" id="6083980">(</span><span class="ident" id="6083981">r</span>&nbsp;<span class="ident" id="6083983">io</span><span class="op" id="6083985">.</span><span class="ident" id="6083986">ReaderAt</span><span class="op" id="6083994">,</span>&nbsp;<span class="ident" id="6083996">size</span>&nbsp;<span class="ident" id="6084001">int64</span><span class="op" id="6084006">)</span>&nbsp;<span class="builtintype" id="6084008">error</span>&nbsp;<span class="op" id="6084014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084017">end</span><span class="op" id="6084020">,</span>&nbsp;<span class="ident" id="6084022">err</span>&nbsp;<span class="op" id="6084026">:=</span>&nbsp;<span class="ident" id="6084029">readDirectoryEnd</span><span class="op" id="6084045">(</span><span class="ident" id="6084046">r</span><span class="op" id="6084047">,</span>&nbsp;<span class="ident" id="6084049">size</span><span class="op" id="6084053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084056">if</span>&nbsp;<span class="ident" id="6084059">err</span>&nbsp;<span class="op" id="6084063">!=</span>&nbsp;<span class="ident" id="6084066">nil</span>&nbsp;<span class="op" id="6084070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084074">return</span>&nbsp;<span class="ident" id="6084081">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6084086">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084089">z</span><span class="op" id="6084090">.</span><span class="ident" id="6084091">r</span>&nbsp;<span class="op" id="6084093">=</span>&nbsp;<span class="ident" id="6084095">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084098">z</span><span class="op" id="6084099">.</span><span class="ident" id="6084100">File</span>&nbsp;<span class="op" id="6084105">=</span>&nbsp;<span class="builtinfunc" id="6084107">make</span><span class="op" id="6084111">(</span><span class="op" id="6084112">[</span><span class="op" id="6084113">]</span><span class="op" id="6084114">*</span><span class="ident" id="6084115">File</span><span class="op" id="6084119">,</span>&nbsp;<span class="num" id="6084121">0</span><span class="op" id="6084122">,</span>&nbsp;<span class="ident" id="6084124">end</span><span class="op" id="6084127">.</span><span class="ident" id="6084128">directoryRecords</span><span class="op" id="6084144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084147">z</span><span class="op" id="6084148">.</span><span class="ident" id="6084149">Comment</span>&nbsp;<span class="op" id="6084157">=</span>&nbsp;<span class="ident" id="6084159">end</span><span class="op" id="6084162">.</span><span class="ident" id="6084163">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084172">rs</span>&nbsp;<span class="op" id="6084175">:=</span>&nbsp;<span class="ident" id="6084178">io</span><span class="op" id="6084180">.</span><span class="ident" id="6084181">NewSectionReader</span><span class="op" id="6084197">(</span><span class="ident" id="6084198">r</span><span class="op" id="6084199">,</span>&nbsp;<span class="num" id="6084201">0</span><span class="op" id="6084202">,</span>&nbsp;<span class="ident" id="6084204">size</span><span class="op" id="6084208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084211">if</span>&nbsp;<span class="ident" id="6084214">_</span><span class="op" id="6084215">,</span>&nbsp;<span class="ident" id="6084217">err</span>&nbsp;<span class="op" id="6084221">=</span>&nbsp;<span class="ident" id="6084223">rs</span><span class="op" id="6084225">.</span><span class="ident" id="6084226">Seek</span><span class="op" id="6084230">(</span><span class="ident" id="6084231">int64</span><span class="op" id="6084236">(</span><span class="ident" id="6084237">end</span><span class="op" id="6084240">.</span><span class="ident" id="6084241">directoryOffset</span><span class="op" id="6084256">)</span><span class="op" id="6084257">,</span>&nbsp;<span class="ident" id="6084259">os</span><span class="op" id="6084261">.</span><span class="ident" id="6084262">SEEK_SET</span><span class="op" id="6084270">)</span><span class="op" id="6084271">;</span>&nbsp;<span class="ident" id="6084273">err</span>&nbsp;<span class="op" id="6084277">!=</span>&nbsp;<span class="ident" id="6084280">nil</span>&nbsp;<span class="op" id="6084284">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084288">return</span>&nbsp;<span class="ident" id="6084295">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6084300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084303">buf</span>&nbsp;<span class="op" id="6084307">:=</span>&nbsp;<span class="ident" id="6084310">bufio</span><span class="op" id="6084315">.</span><span class="ident" id="6084316">NewReader</span><span class="op" id="6084325">(</span><span class="ident" id="6084326">rs</span><span class="op" id="6084328">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6084332">//&nbsp;The&nbsp;count&nbsp;of&nbsp;files&nbsp;inside&nbsp;a&nbsp;zip&nbsp;is&nbsp;truncated&nbsp;to&nbsp;fit&nbsp;in&nbsp;a&nbsp;uint16.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6084401">//&nbsp;Gloss&nbsp;over&nbsp;this&nbsp;by&nbsp;reading&nbsp;headers&nbsp;until&nbsp;we&nbsp;encounter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6084459">//&nbsp;a&nbsp;bad&nbsp;one,&nbsp;and&nbsp;then&nbsp;only&nbsp;report&nbsp;a&nbsp;ErrFormat&nbsp;or&nbsp;UnexpectedEOF&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6084527">//&nbsp;the&nbsp;file&nbsp;count&nbsp;modulo&nbsp;65536&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084573">for</span>&nbsp;<span class="op" id="6084577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084581">f</span>&nbsp;<span class="op" id="6084583">:=</span>&nbsp;<span class="op" id="6084586">&amp;</span><span class="ident" id="6084587">File</span><span class="op" id="6084591">{</span><span class="ident" id="6084592">zipr</span><span class="op" id="6084596">:</span>&nbsp;<span class="ident" id="6084598">r</span><span class="op" id="6084599">,</span>&nbsp;<span class="ident" id="6084601">zipsize</span><span class="op" id="6084608">:</span>&nbsp;<span class="ident" id="6084610">size</span><span class="op" id="6084614">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084618">err</span>&nbsp;<span class="op" id="6084622">=</span>&nbsp;<span class="ident" id="6084624">readDirectoryHeader</span><span class="op" id="6084643">(</span><span class="ident" id="6084644">f</span><span class="op" id="6084645">,</span>&nbsp;<span class="ident" id="6084647">buf</span><span class="op" id="6084650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084654">if</span>&nbsp;<span class="ident" id="6084657">err</span>&nbsp;<span class="op" id="6084661">==</span>&nbsp;<span class="ident" id="6084664">ErrFormat</span>&nbsp;<span class="op" id="6084674">||</span>&nbsp;<span class="ident" id="6084677">err</span>&nbsp;<span class="op" id="6084681">==</span>&nbsp;<span class="ident" id="6084684">io</span><span class="op" id="6084686">.</span><span class="ident" id="6084687">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6084704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084709">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6084717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084721">if</span>&nbsp;<span class="ident" id="6084724">err</span>&nbsp;<span class="op" id="6084728">!=</span>&nbsp;<span class="ident" id="6084731">nil</span>&nbsp;<span class="op" id="6084735">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084740">return</span>&nbsp;<span class="ident" id="6084747">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6084753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084757">z</span><span class="op" id="6084758">.</span><span class="ident" id="6084759">File</span>&nbsp;<span class="op" id="6084764">=</span>&nbsp;<span class="builtinfunc" id="6084766">append</span><span class="op" id="6084772">(</span><span class="ident" id="6084773">z</span><span class="op" id="6084774">.</span><span class="ident" id="6084775">File</span><span class="op" id="6084779">,</span>&nbsp;<span class="ident" id="6084781">f</span><span class="op" id="6084782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6084785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084788">if</span>&nbsp;<span class="builtintype" id="6084791">uint16</span><span class="op" id="6084797">(</span><span class="builtinfunc" id="6084798">len</span><span class="op" id="6084801">(</span><span class="ident" id="6084802">z</span><span class="op" id="6084803">.</span><span class="ident" id="6084804">File</span><span class="op" id="6084808">)</span><span class="op" id="6084809">)</span>&nbsp;<span class="op" id="6084811">!=</span>&nbsp;<span class="builtintype" id="6084814">uint16</span><span class="op" id="6084820">(</span><span class="ident" id="6084821">end</span><span class="op" id="6084824">.</span><span class="ident" id="6084825">directoryRecords</span><span class="op" id="6084841">)</span>&nbsp;<span class="op" id="6084843">{</span>&nbsp;<span class="comment" id="6084845">//&nbsp;only&nbsp;compare&nbsp;16&nbsp;bits&nbsp;here</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6084876">//&nbsp;Return&nbsp;the&nbsp;readDirectoryHeader&nbsp;error&nbsp;if&nbsp;we&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6084929">//&nbsp;the&nbsp;wrong&nbsp;number&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084973">return</span>&nbsp;<span class="ident" id="6084980">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6084985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084988">return</span>&nbsp;<span class="ident" id="6084995">nil</span><br>
<span class="lineno">110</span><span class="op" id="6084999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6085002">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Zip&nbsp;file,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="6085063">func</span>&nbsp;<span class="op" id="6085068">(</span><span class="ident" id="6085069">rc</span>&nbsp;<span class="op" id="6085072">*</span><span class="ident" id="6085073">ReadCloser</span><span class="op" id="6085083">)</span>&nbsp;<span class="ident" id="6085085">Close</span><span class="op" id="6085090">(</span><span class="op" id="6085091">)</span>&nbsp;<span class="builtintype" id="6085093">error</span>&nbsp;<span class="op" id="6085099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085102">return</span>&nbsp;<span class="ident" id="6085109">rc</span><span class="op" id="6085111">.</span><span class="ident" id="6085112">f</span><span class="op" id="6085113">.</span><span class="ident" id="6085114">Close</span><span class="op" id="6085119">(</span><span class="op" id="6085120">)</span><br>
<span class="lineno">115</span><span class="op" id="6085122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6085125">//&nbsp;DataOffset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;file&#39;s&nbsp;possibly-compressed</span><br>
<span class="lineno"></span><span class="comment" id="6085192">//&nbsp;data,&nbsp;relative&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="6085244">//</span><br>
<span class="lineno">120</span><span class="comment" id="6085247">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;instead&nbsp;use&nbsp;Open,&nbsp;which&nbsp;transparently</span><br>
<span class="lineno"></span><span class="comment" id="6085308">//&nbsp;decompresses&nbsp;data&nbsp;and&nbsp;verifies&nbsp;checksums.</span><br>
<span class="lineno"></span><span class="keyword" id="6085353">func</span>&nbsp;<span class="op" id="6085358">(</span><span class="ident" id="6085359">f</span>&nbsp;<span class="op" id="6085361">*</span><span class="ident" id="6085362">File</span><span class="op" id="6085366">)</span>&nbsp;<span class="ident" id="6085368">DataOffset</span><span class="op" id="6085378">(</span><span class="op" id="6085379">)</span>&nbsp;<span class="op" id="6085381">(</span><span class="ident" id="6085382">offset</span>&nbsp;<span class="ident" id="6085389">int64</span><span class="op" id="6085394">,</span>&nbsp;<span class="ident" id="6085396">err</span>&nbsp;<span class="builtintype" id="6085400">error</span><span class="op" id="6085405">)</span>&nbsp;<span class="op" id="6085407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085410">bodyOffset</span><span class="op" id="6085420">,</span>&nbsp;<span class="ident" id="6085422">err</span>&nbsp;<span class="op" id="6085426">:=</span>&nbsp;<span class="ident" id="6085429">f</span><span class="op" id="6085430">.</span><span class="ident" id="6085431">findBodyOffset</span><span class="op" id="6085445">(</span><span class="op" id="6085446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085449">if</span>&nbsp;<span class="ident" id="6085452">err</span>&nbsp;<span class="op" id="6085456">!=</span>&nbsp;<span class="ident" id="6085459">nil</span>&nbsp;<span class="op" id="6085463">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085467">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6085475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085478">return</span>&nbsp;<span class="ident" id="6085485">f</span><span class="op" id="6085486">.</span><span class="ident" id="6085487">headerOffset</span>&nbsp;<span class="op" id="6085500">+</span>&nbsp;<span class="ident" id="6085502">bodyOffset</span><span class="op" id="6085512">,</span>&nbsp;<span class="ident" id="6085514">nil</span><br>
<span class="lineno"></span><span class="op" id="6085518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="6085521">//&nbsp;Open&nbsp;returns&nbsp;a&nbsp;ReadCloser&nbsp;that&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;File&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="6085595">//&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;be&nbsp;read&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="keyword" id="6085639">func</span>&nbsp;<span class="op" id="6085644">(</span><span class="ident" id="6085645">f</span>&nbsp;<span class="op" id="6085647">*</span><span class="ident" id="6085648">File</span><span class="op" id="6085652">)</span>&nbsp;<span class="ident" id="6085654">Open</span><span class="op" id="6085658">(</span><span class="op" id="6085659">)</span>&nbsp;<span class="op" id="6085661">(</span><span class="ident" id="6085662">rc</span>&nbsp;<span class="ident" id="6085665">io</span><span class="op" id="6085667">.</span><span class="ident" id="6085668">ReadCloser</span><span class="op" id="6085678">,</span>&nbsp;<span class="ident" id="6085680">err</span>&nbsp;<span class="builtintype" id="6085684">error</span><span class="op" id="6085689">)</span>&nbsp;<span class="op" id="6085691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085694">bodyOffset</span><span class="op" id="6085704">,</span>&nbsp;<span class="ident" id="6085706">err</span>&nbsp;<span class="op" id="6085710">:=</span>&nbsp;<span class="ident" id="6085713">f</span><span class="op" id="6085714">.</span><span class="ident" id="6085715">findBodyOffset</span><span class="op" id="6085729">(</span><span class="op" id="6085730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085733">if</span>&nbsp;<span class="ident" id="6085736">err</span>&nbsp;<span class="op" id="6085740">!=</span>&nbsp;<span class="ident" id="6085743">nil</span>&nbsp;<span class="op" id="6085747">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085751">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6085759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085762">size</span>&nbsp;<span class="op" id="6085767">:=</span>&nbsp;<span class="ident" id="6085770">int64</span><span class="op" id="6085775">(</span><span class="ident" id="6085776">f</span><span class="op" id="6085777">.</span><span class="ident" id="6085778">CompressedSize64</span><span class="op" id="6085794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085797">r</span>&nbsp;<span class="op" id="6085799">:=</span>&nbsp;<span class="ident" id="6085802">io</span><span class="op" id="6085804">.</span><span class="ident" id="6085805">NewSectionReader</span><span class="op" id="6085821">(</span><span class="ident" id="6085822">f</span><span class="op" id="6085823">.</span><span class="ident" id="6085824">zipr</span><span class="op" id="6085828">,</span>&nbsp;<span class="ident" id="6085830">f</span><span class="op" id="6085831">.</span><span class="ident" id="6085832">headerOffset</span><span class="op" id="6085844">+</span><span class="ident" id="6085845">bodyOffset</span><span class="op" id="6085855">,</span>&nbsp;<span class="ident" id="6085857">size</span><span class="op" id="6085861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085864">dcomp</span>&nbsp;<span class="op" id="6085870">:=</span>&nbsp;<span class="ident" id="6085873">decompressor</span><span class="op" id="6085885">(</span><span class="ident" id="6085886">f</span><span class="op" id="6085887">.</span><span class="ident" id="6085888">Method</span><span class="op" id="6085894">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085897">if</span>&nbsp;<span class="ident" id="6085900">dcomp</span>&nbsp;<span class="op" id="6085906">==</span>&nbsp;<span class="ident" id="6085909">nil</span>&nbsp;<span class="op" id="6085913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085917">err</span>&nbsp;<span class="op" id="6085921">=</span>&nbsp;<span class="ident" id="6085923">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085938">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6085946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085949">rc</span>&nbsp;<span class="op" id="6085952">=</span>&nbsp;<span class="ident" id="6085954">dcomp</span><span class="op" id="6085959">(</span><span class="ident" id="6085960">r</span><span class="op" id="6085961">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085964">var</span>&nbsp;<span class="ident" id="6085968">desr</span>&nbsp;<span class="ident" id="6085973">io</span><span class="op" id="6085975">.</span><span class="ident" id="6085976">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085984">if</span>&nbsp;<span class="ident" id="6085987">f</span><span class="op" id="6085988">.</span><span class="ident" id="6085989">hasDataDescriptor</span><span class="op" id="6086006">(</span><span class="op" id="6086007">)</span>&nbsp;<span class="op" id="6086009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086013">desr</span>&nbsp;<span class="op" id="6086018">=</span>&nbsp;<span class="ident" id="6086020">io</span><span class="op" id="6086022">.</span><span class="ident" id="6086023">NewSectionReader</span><span class="op" id="6086039">(</span><span class="ident" id="6086040">f</span><span class="op" id="6086041">.</span><span class="ident" id="6086042">zipr</span><span class="op" id="6086046">,</span>&nbsp;<span class="ident" id="6086048">f</span><span class="op" id="6086049">.</span><span class="ident" id="6086050">headerOffset</span><span class="op" id="6086062">+</span><span class="ident" id="6086063">bodyOffset</span><span class="op" id="6086073">+</span><span class="ident" id="6086074">size</span><span class="op" id="6086078">,</span>&nbsp;<span class="ident" id="6086080">dataDescriptorLen</span><span class="op" id="6086097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086103">rc</span>&nbsp;<span class="op" id="6086106">=</span>&nbsp;<span class="op" id="6086108">&amp;</span><span class="ident" id="6086109">checksumReader</span><span class="op" id="6086123">{</span><span class="ident" id="6086124">rc</span><span class="op" id="6086126">,</span>&nbsp;<span class="ident" id="6086128">crc32</span><span class="op" id="6086133">.</span><span class="ident" id="6086134">NewIEEE</span><span class="op" id="6086141">(</span><span class="op" id="6086142">)</span><span class="op" id="6086143">,</span>&nbsp;<span class="ident" id="6086145">f</span><span class="op" id="6086146">,</span>&nbsp;<span class="ident" id="6086148">desr</span><span class="op" id="6086152">,</span>&nbsp;<span class="ident" id="6086154">nil</span><span class="op" id="6086157">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086160">return</span><br>
<span class="lineno"></span><span class="op" id="6086167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6086170">type</span>&nbsp;<span class="ident" id="6086175">checksumReader</span>&nbsp;<span class="keyword" id="6086190">struct</span>&nbsp;<span class="op" id="6086197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086200">rc</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6086205">io</span><span class="op" id="6086207">.</span><span class="ident" id="6086208">ReadCloser</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086220">hash</span>&nbsp;<span class="ident" id="6086225">hash</span><span class="op" id="6086229">.</span><span class="ident" id="6086230">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086238">f</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086243">*</span><span class="ident" id="6086244">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086250">desr</span>&nbsp;<span class="ident" id="6086255">io</span><span class="op" id="6086257">.</span><span class="ident" id="6086258">Reader</span>&nbsp;<span class="comment" id="6086265">//&nbsp;if&nbsp;non-nil,&nbsp;where&nbsp;to&nbsp;read&nbsp;the&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086315">err</span>&nbsp;&nbsp;<span class="builtintype" id="6086320">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6086330">//&nbsp;sticky&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="6086346">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="6086349">func</span>&nbsp;<span class="op" id="6086354">(</span><span class="ident" id="6086355">r</span>&nbsp;<span class="op" id="6086357">*</span><span class="ident" id="6086358">checksumReader</span><span class="op" id="6086372">)</span>&nbsp;<span class="ident" id="6086374">Read</span><span class="op" id="6086378">(</span><span class="ident" id="6086379">b</span>&nbsp;<span class="op" id="6086381">[</span><span class="op" id="6086382">]</span><span class="builtintype" id="6086383">byte</span><span class="op" id="6086387">)</span>&nbsp;<span class="op" id="6086389">(</span><span class="ident" id="6086390">n</span>&nbsp;<span class="builtintype" id="6086392">int</span><span class="op" id="6086395">,</span>&nbsp;<span class="ident" id="6086397">err</span>&nbsp;<span class="builtintype" id="6086401">error</span><span class="op" id="6086406">)</span>&nbsp;<span class="op" id="6086408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086411">if</span>&nbsp;<span class="ident" id="6086414">r</span><span class="op" id="6086415">.</span><span class="ident" id="6086416">err</span>&nbsp;<span class="op" id="6086420">!=</span>&nbsp;<span class="ident" id="6086423">nil</span>&nbsp;<span class="op" id="6086427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086431">return</span>&nbsp;<span class="num" id="6086438">0</span><span class="op" id="6086439">,</span>&nbsp;<span class="ident" id="6086441">r</span><span class="op" id="6086442">.</span><span class="ident" id="6086443">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086448">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086451">n</span><span class="op" id="6086452">,</span>&nbsp;<span class="ident" id="6086454">err</span>&nbsp;<span class="op" id="6086458">=</span>&nbsp;<span class="ident" id="6086460">r</span><span class="op" id="6086461">.</span><span class="ident" id="6086462">rc</span><span class="op" id="6086464">.</span><span class="ident" id="6086465">Read</span><span class="op" id="6086469">(</span><span class="ident" id="6086470">b</span><span class="op" id="6086471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086474">r</span><span class="op" id="6086475">.</span><span class="ident" id="6086476">hash</span><span class="op" id="6086480">.</span><span class="ident" id="6086481">Write</span><span class="op" id="6086486">(</span><span class="ident" id="6086487">b</span><span class="op" id="6086488">[</span><span class="op" id="6086489">:</span><span class="ident" id="6086490">n</span><span class="op" id="6086491">]</span><span class="op" id="6086492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086495">if</span>&nbsp;<span class="ident" id="6086498">err</span>&nbsp;<span class="op" id="6086502">==</span>&nbsp;<span class="ident" id="6086505">nil</span>&nbsp;<span class="op" id="6086509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086513">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086521">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086524">if</span>&nbsp;<span class="ident" id="6086527">err</span>&nbsp;<span class="op" id="6086531">==</span>&nbsp;<span class="ident" id="6086534">io</span><span class="op" id="6086536">.</span><span class="ident" id="6086537">EOF</span>&nbsp;<span class="op" id="6086541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086545">if</span>&nbsp;<span class="ident" id="6086548">r</span><span class="op" id="6086549">.</span><span class="ident" id="6086550">desr</span>&nbsp;<span class="op" id="6086555">!=</span>&nbsp;<span class="ident" id="6086558">nil</span>&nbsp;<span class="op" id="6086562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086567">if</span>&nbsp;<span class="ident" id="6086570">err1</span>&nbsp;<span class="op" id="6086575">:=</span>&nbsp;<span class="ident" id="6086578">readDataDescriptor</span><span class="op" id="6086596">(</span><span class="ident" id="6086597">r</span><span class="op" id="6086598">.</span><span class="ident" id="6086599">desr</span><span class="op" id="6086603">,</span>&nbsp;<span class="ident" id="6086605">r</span><span class="op" id="6086606">.</span><span class="ident" id="6086607">f</span><span class="op" id="6086608">)</span><span class="op" id="6086609">;</span>&nbsp;<span class="ident" id="6086611">err1</span>&nbsp;<span class="op" id="6086616">!=</span>&nbsp;<span class="ident" id="6086619">nil</span>&nbsp;<span class="op" id="6086623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086629">err</span>&nbsp;<span class="op" id="6086633">=</span>&nbsp;<span class="ident" id="6086635">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086643">}</span>&nbsp;<span class="keyword" id="6086645">else</span>&nbsp;<span class="keyword" id="6086650">if</span>&nbsp;<span class="ident" id="6086653">r</span><span class="op" id="6086654">.</span><span class="ident" id="6086655">hash</span><span class="op" id="6086659">.</span><span class="ident" id="6086660">Sum32</span><span class="op" id="6086665">(</span><span class="op" id="6086666">)</span>&nbsp;<span class="op" id="6086668">!=</span>&nbsp;<span class="ident" id="6086671">r</span><span class="op" id="6086672">.</span><span class="ident" id="6086673">f</span><span class="op" id="6086674">.</span><span class="ident" id="6086675">CRC32</span>&nbsp;<span class="op" id="6086681">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086687">err</span>&nbsp;<span class="op" id="6086691">=</span>&nbsp;<span class="ident" id="6086693">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086712">}</span>&nbsp;<span class="keyword" id="6086714">else</span>&nbsp;<span class="op" id="6086719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6086724">//&nbsp;If&nbsp;there&#39;s&nbsp;not&nbsp;a&nbsp;data&nbsp;descriptor,&nbsp;we&nbsp;still&nbsp;compare</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6086781">//&nbsp;the&nbsp;CRC32&nbsp;of&nbsp;what&nbsp;we&#39;ve&nbsp;read&nbsp;against&nbsp;the&nbsp;file&nbsp;header</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6086840">//&nbsp;or&nbsp;TOC&#39;s&nbsp;CRC32,&nbsp;if&nbsp;it&nbsp;seems&nbsp;like&nbsp;it&nbsp;was&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086891">if</span>&nbsp;<span class="ident" id="6086894">r</span><span class="op" id="6086895">.</span><span class="ident" id="6086896">f</span><span class="op" id="6086897">.</span><span class="ident" id="6086898">CRC32</span>&nbsp;<span class="op" id="6086904">!=</span>&nbsp;<span class="num" id="6086907">0</span>&nbsp;<span class="op" id="6086909">&amp;&amp;</span>&nbsp;<span class="ident" id="6086912">r</span><span class="op" id="6086913">.</span><span class="ident" id="6086914">hash</span><span class="op" id="6086918">.</span><span class="ident" id="6086919">Sum32</span><span class="op" id="6086924">(</span><span class="op" id="6086925">)</span>&nbsp;<span class="op" id="6086927">!=</span>&nbsp;<span class="ident" id="6086930">r</span><span class="op" id="6086931">.</span><span class="ident" id="6086932">f</span><span class="op" id="6086933">.</span><span class="ident" id="6086934">CRC32</span>&nbsp;<span class="op" id="6086940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086946">err</span>&nbsp;<span class="op" id="6086950">=</span>&nbsp;<span class="ident" id="6086952">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086971">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086977">r</span><span class="op" id="6086978">.</span><span class="ident" id="6086979">err</span>&nbsp;<span class="op" id="6086983">=</span>&nbsp;<span class="ident" id="6086985">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086990">return</span><br>
<span class="lineno"></span><span class="op" id="6086997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="6087000">func</span>&nbsp;<span class="op" id="6087005">(</span><span class="ident" id="6087006">r</span>&nbsp;<span class="op" id="6087008">*</span><span class="ident" id="6087009">checksumReader</span><span class="op" id="6087023">)</span>&nbsp;<span class="ident" id="6087025">Close</span><span class="op" id="6087030">(</span><span class="op" id="6087031">)</span>&nbsp;<span class="builtintype" id="6087033">error</span>&nbsp;<span class="op" id="6087039">{</span>&nbsp;<span class="keyword" id="6087041">return</span>&nbsp;<span class="ident" id="6087048">r</span><span class="op" id="6087049">.</span><span class="ident" id="6087050">rc</span><span class="op" id="6087052">.</span><span class="ident" id="6087053">Close</span><span class="op" id="6087058">(</span><span class="op" id="6087059">)</span>&nbsp;<span class="op" id="6087061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6087064">//&nbsp;findBodyOffset&nbsp;does&nbsp;the&nbsp;minimum&nbsp;work&nbsp;to&nbsp;verify&nbsp;the&nbsp;file&nbsp;has&nbsp;a&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="6087136">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;file&nbsp;body&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="6087173">func</span>&nbsp;<span class="op" id="6087178">(</span><span class="ident" id="6087179">f</span>&nbsp;<span class="op" id="6087181">*</span><span class="ident" id="6087182">File</span><span class="op" id="6087186">)</span>&nbsp;<span class="ident" id="6087188">findBodyOffset</span><span class="op" id="6087202">(</span><span class="op" id="6087203">)</span>&nbsp;<span class="op" id="6087205">(</span><span class="ident" id="6087206">int64</span><span class="op" id="6087211">,</span>&nbsp;<span class="builtintype" id="6087213">error</span><span class="op" id="6087218">)</span>&nbsp;<span class="op" id="6087220">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087223">var</span>&nbsp;<span class="ident" id="6087227">buf</span>&nbsp;<span class="op" id="6087231">[</span><span class="ident" id="6087232">fileHeaderLen</span><span class="op" id="6087245">]</span><span class="builtintype" id="6087246">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087252">if</span>&nbsp;<span class="ident" id="6087255">_</span><span class="op" id="6087256">,</span>&nbsp;<span class="ident" id="6087258">err</span>&nbsp;<span class="op" id="6087262">:=</span>&nbsp;<span class="ident" id="6087265">f</span><span class="op" id="6087266">.</span><span class="ident" id="6087267">zipr</span><span class="op" id="6087271">.</span><span class="ident" id="6087272">ReadAt</span><span class="op" id="6087278">(</span><span class="ident" id="6087279">buf</span><span class="op" id="6087282">[</span><span class="op" id="6087283">:</span><span class="op" id="6087284">]</span><span class="op" id="6087285">,</span>&nbsp;<span class="ident" id="6087287">f</span><span class="op" id="6087288">.</span><span class="ident" id="6087289">headerOffset</span><span class="op" id="6087301">)</span><span class="op" id="6087302">;</span>&nbsp;<span class="ident" id="6087304">err</span>&nbsp;<span class="op" id="6087308">!=</span>&nbsp;<span class="ident" id="6087311">nil</span>&nbsp;<span class="op" id="6087315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087319">return</span>&nbsp;<span class="num" id="6087326">0</span><span class="op" id="6087327">,</span>&nbsp;<span class="ident" id="6087329">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6087334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087337">b</span>&nbsp;<span class="op" id="6087339">:=</span>&nbsp;<span class="ident" id="6087342">readBuf</span><span class="op" id="6087349">(</span><span class="ident" id="6087350">buf</span><span class="op" id="6087353">[</span><span class="op" id="6087354">:</span><span class="op" id="6087355">]</span><span class="op" id="6087356">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087359">if</span>&nbsp;<span class="ident" id="6087362">sig</span>&nbsp;<span class="op" id="6087366">:=</span>&nbsp;<span class="ident" id="6087369">b</span><span class="op" id="6087370">.</span><span class="builtintype" id="6087371">uint32</span><span class="op" id="6087377">(</span><span class="op" id="6087378">)</span><span class="op" id="6087379">;</span>&nbsp;<span class="ident" id="6087381">sig</span>&nbsp;<span class="op" id="6087385">!=</span>&nbsp;<span class="ident" id="6087388">fileHeaderSignature</span>&nbsp;<span class="op" id="6087408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087412">return</span>&nbsp;<span class="num" id="6087419">0</span><span class="op" id="6087420">,</span>&nbsp;<span class="ident" id="6087422">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6087433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087436">b</span>&nbsp;<span class="op" id="6087438">=</span>&nbsp;<span class="ident" id="6087440">b</span><span class="op" id="6087441">[</span><span class="num" id="6087442">22</span><span class="op" id="6087444">:</span><span class="op" id="6087445">]</span>&nbsp;<span class="comment" id="6087447">//&nbsp;skip&nbsp;over&nbsp;most&nbsp;of&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087480">filenameLen</span>&nbsp;<span class="op" id="6087492">:=</span>&nbsp;<span class="builtintype" id="6087495">int</span><span class="op" id="6087498">(</span><span class="ident" id="6087499">b</span><span class="op" id="6087500">.</span><span class="builtintype" id="6087501">uint16</span><span class="op" id="6087507">(</span><span class="op" id="6087508">)</span><span class="op" id="6087509">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087512">extraLen</span>&nbsp;<span class="op" id="6087521">:=</span>&nbsp;<span class="builtintype" id="6087524">int</span><span class="op" id="6087527">(</span><span class="ident" id="6087528">b</span><span class="op" id="6087529">.</span><span class="builtintype" id="6087530">uint16</span><span class="op" id="6087536">(</span><span class="op" id="6087537">)</span><span class="op" id="6087538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087541">return</span>&nbsp;<span class="ident" id="6087548">int64</span><span class="op" id="6087553">(</span><span class="ident" id="6087554">fileHeaderLen</span>&nbsp;<span class="op" id="6087568">+</span>&nbsp;<span class="ident" id="6087570">filenameLen</span>&nbsp;<span class="op" id="6087582">+</span>&nbsp;<span class="ident" id="6087584">extraLen</span><span class="op" id="6087592">)</span><span class="op" id="6087593">,</span>&nbsp;<span class="ident" id="6087595">nil</span><br>
<span class="lineno"></span><span class="op" id="6087599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6087602">//&nbsp;readDirectoryHeader&nbsp;attempts&nbsp;to&nbsp;read&nbsp;a&nbsp;directory&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno">210</span><span class="comment" id="6087669">//&nbsp;It&nbsp;returns&nbsp;io.ErrUnexpectedEOF&nbsp;if&nbsp;it&nbsp;cannot&nbsp;read&nbsp;a&nbsp;complete&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="6087740">//&nbsp;and&nbsp;ErrFormat&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;find&nbsp;a&nbsp;valid&nbsp;header&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="6087802">func</span>&nbsp;<span class="ident" id="6087807">readDirectoryHeader</span><span class="op" id="6087826">(</span><span class="ident" id="6087827">f</span>&nbsp;<span class="op" id="6087829">*</span><span class="ident" id="6087830">File</span><span class="op" id="6087834">,</span>&nbsp;<span class="ident" id="6087836">r</span>&nbsp;<span class="ident" id="6087838">io</span><span class="op" id="6087840">.</span><span class="ident" id="6087841">Reader</span><span class="op" id="6087847">)</span>&nbsp;<span class="builtintype" id="6087849">error</span>&nbsp;<span class="op" id="6087855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087858">var</span>&nbsp;<span class="ident" id="6087862">buf</span>&nbsp;<span class="op" id="6087866">[</span><span class="ident" id="6087867">directoryHeaderLen</span><span class="op" id="6087885">]</span><span class="builtintype" id="6087886">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087892">if</span>&nbsp;<span class="ident" id="6087895">_</span><span class="op" id="6087896">,</span>&nbsp;<span class="ident" id="6087898">err</span>&nbsp;<span class="op" id="6087902">:=</span>&nbsp;<span class="ident" id="6087905">io</span><span class="op" id="6087907">.</span><span class="ident" id="6087908">ReadFull</span><span class="op" id="6087916">(</span><span class="ident" id="6087917">r</span><span class="op" id="6087918">,</span>&nbsp;<span class="ident" id="6087920">buf</span><span class="op" id="6087923">[</span><span class="op" id="6087924">:</span><span class="op" id="6087925">]</span><span class="op" id="6087926">)</span><span class="op" id="6087927">;</span>&nbsp;<span class="ident" id="6087929">err</span>&nbsp;<span class="op" id="6087933">!=</span>&nbsp;<span class="ident" id="6087936">nil</span>&nbsp;<span class="op" id="6087940">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087944">return</span>&nbsp;<span class="ident" id="6087951">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6087956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087959">b</span>&nbsp;<span class="op" id="6087961">:=</span>&nbsp;<span class="ident" id="6087964">readBuf</span><span class="op" id="6087971">(</span><span class="ident" id="6087972">buf</span><span class="op" id="6087975">[</span><span class="op" id="6087976">:</span><span class="op" id="6087977">]</span><span class="op" id="6087978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087981">if</span>&nbsp;<span class="ident" id="6087984">sig</span>&nbsp;<span class="op" id="6087988">:=</span>&nbsp;<span class="ident" id="6087991">b</span><span class="op" id="6087992">.</span><span class="builtintype" id="6087993">uint32</span><span class="op" id="6087999">(</span><span class="op" id="6088000">)</span><span class="op" id="6088001">;</span>&nbsp;<span class="ident" id="6088003">sig</span>&nbsp;<span class="op" id="6088007">!=</span>&nbsp;<span class="ident" id="6088010">directoryHeaderSignature</span>&nbsp;<span class="op" id="6088035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088039">return</span>&nbsp;<span class="ident" id="6088046">ErrFormat</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088060">f</span><span class="op" id="6088061">.</span><span class="ident" id="6088062">CreatorVersion</span>&nbsp;<span class="op" id="6088077">=</span>&nbsp;<span class="ident" id="6088079">b</span><span class="op" id="6088080">.</span><span class="builtintype" id="6088081">uint16</span><span class="op" id="6088087">(</span><span class="op" id="6088088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088091">f</span><span class="op" id="6088092">.</span><span class="ident" id="6088093">ReaderVersion</span>&nbsp;<span class="op" id="6088107">=</span>&nbsp;<span class="ident" id="6088109">b</span><span class="op" id="6088110">.</span><span class="builtintype" id="6088111">uint16</span><span class="op" id="6088117">(</span><span class="op" id="6088118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088121">f</span><span class="op" id="6088122">.</span><span class="ident" id="6088123">Flags</span>&nbsp;<span class="op" id="6088129">=</span>&nbsp;<span class="ident" id="6088131">b</span><span class="op" id="6088132">.</span><span class="builtintype" id="6088133">uint16</span><span class="op" id="6088139">(</span><span class="op" id="6088140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088143">f</span><span class="op" id="6088144">.</span><span class="ident" id="6088145">Method</span>&nbsp;<span class="op" id="6088152">=</span>&nbsp;<span class="ident" id="6088154">b</span><span class="op" id="6088155">.</span><span class="builtintype" id="6088156">uint16</span><span class="op" id="6088162">(</span><span class="op" id="6088163">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088166">f</span><span class="op" id="6088167">.</span><span class="ident" id="6088168">ModifiedTime</span>&nbsp;<span class="op" id="6088181">=</span>&nbsp;<span class="ident" id="6088183">b</span><span class="op" id="6088184">.</span><span class="builtintype" id="6088185">uint16</span><span class="op" id="6088191">(</span><span class="op" id="6088192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088195">f</span><span class="op" id="6088196">.</span><span class="ident" id="6088197">ModifiedDate</span>&nbsp;<span class="op" id="6088210">=</span>&nbsp;<span class="ident" id="6088212">b</span><span class="op" id="6088213">.</span><span class="builtintype" id="6088214">uint16</span><span class="op" id="6088220">(</span><span class="op" id="6088221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088224">f</span><span class="op" id="6088225">.</span><span class="ident" id="6088226">CRC32</span>&nbsp;<span class="op" id="6088232">=</span>&nbsp;<span class="ident" id="6088234">b</span><span class="op" id="6088235">.</span><span class="builtintype" id="6088236">uint32</span><span class="op" id="6088242">(</span><span class="op" id="6088243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088246">f</span><span class="op" id="6088247">.</span><span class="ident" id="6088248">CompressedSize</span>&nbsp;<span class="op" id="6088263">=</span>&nbsp;<span class="ident" id="6088265">b</span><span class="op" id="6088266">.</span><span class="builtintype" id="6088267">uint32</span><span class="op" id="6088273">(</span><span class="op" id="6088274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088277">f</span><span class="op" id="6088278">.</span><span class="ident" id="6088279">UncompressedSize</span>&nbsp;<span class="op" id="6088296">=</span>&nbsp;<span class="ident" id="6088298">b</span><span class="op" id="6088299">.</span><span class="builtintype" id="6088300">uint32</span><span class="op" id="6088306">(</span><span class="op" id="6088307">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088310">f</span><span class="op" id="6088311">.</span><span class="ident" id="6088312">CompressedSize64</span>&nbsp;<span class="op" id="6088329">=</span>&nbsp;<span class="ident" id="6088331">uint64</span><span class="op" id="6088337">(</span><span class="ident" id="6088338">f</span><span class="op" id="6088339">.</span><span class="ident" id="6088340">CompressedSize</span><span class="op" id="6088354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088357">f</span><span class="op" id="6088358">.</span><span class="ident" id="6088359">UncompressedSize64</span>&nbsp;<span class="op" id="6088378">=</span>&nbsp;<span class="ident" id="6088380">uint64</span><span class="op" id="6088386">(</span><span class="ident" id="6088387">f</span><span class="op" id="6088388">.</span><span class="ident" id="6088389">UncompressedSize</span><span class="op" id="6088405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088408">filenameLen</span>&nbsp;<span class="op" id="6088420">:=</span>&nbsp;<span class="builtintype" id="6088423">int</span><span class="op" id="6088426">(</span><span class="ident" id="6088427">b</span><span class="op" id="6088428">.</span><span class="builtintype" id="6088429">uint16</span><span class="op" id="6088435">(</span><span class="op" id="6088436">)</span><span class="op" id="6088437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088440">extraLen</span>&nbsp;<span class="op" id="6088449">:=</span>&nbsp;<span class="builtintype" id="6088452">int</span><span class="op" id="6088455">(</span><span class="ident" id="6088456">b</span><span class="op" id="6088457">.</span><span class="builtintype" id="6088458">uint16</span><span class="op" id="6088464">(</span><span class="op" id="6088465">)</span><span class="op" id="6088466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088469">commentLen</span>&nbsp;<span class="op" id="6088480">:=</span>&nbsp;<span class="builtintype" id="6088483">int</span><span class="op" id="6088486">(</span><span class="ident" id="6088487">b</span><span class="op" id="6088488">.</span><span class="builtintype" id="6088489">uint16</span><span class="op" id="6088495">(</span><span class="op" id="6088496">)</span><span class="op" id="6088497">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088500">b</span>&nbsp;<span class="op" id="6088502">=</span>&nbsp;<span class="ident" id="6088504">b</span><span class="op" id="6088505">[</span><span class="num" id="6088506">4</span><span class="op" id="6088507">:</span><span class="op" id="6088508">]</span>&nbsp;<span class="comment" id="6088510">//&nbsp;skipped&nbsp;start&nbsp;disk&nbsp;number&nbsp;and&nbsp;internal&nbsp;attributes&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088576">f</span><span class="op" id="6088577">.</span><span class="ident" id="6088578">ExternalAttrs</span>&nbsp;<span class="op" id="6088592">=</span>&nbsp;<span class="ident" id="6088594">b</span><span class="op" id="6088595">.</span><span class="builtintype" id="6088596">uint32</span><span class="op" id="6088602">(</span><span class="op" id="6088603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088606">f</span><span class="op" id="6088607">.</span><span class="ident" id="6088608">headerOffset</span>&nbsp;<span class="op" id="6088621">=</span>&nbsp;<span class="ident" id="6088623">int64</span><span class="op" id="6088628">(</span><span class="ident" id="6088629">b</span><span class="op" id="6088630">.</span><span class="builtintype" id="6088631">uint32</span><span class="op" id="6088637">(</span><span class="op" id="6088638">)</span><span class="op" id="6088639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088642">d</span>&nbsp;<span class="op" id="6088644">:=</span>&nbsp;<span class="builtinfunc" id="6088647">make</span><span class="op" id="6088651">(</span><span class="op" id="6088652">[</span><span class="op" id="6088653">]</span><span class="builtintype" id="6088654">byte</span><span class="op" id="6088658">,</span>&nbsp;<span class="ident" id="6088660">filenameLen</span><span class="op" id="6088671">+</span><span class="ident" id="6088672">extraLen</span><span class="op" id="6088680">+</span><span class="ident" id="6088681">commentLen</span><span class="op" id="6088691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088694">if</span>&nbsp;<span class="ident" id="6088697">_</span><span class="op" id="6088698">,</span>&nbsp;<span class="ident" id="6088700">err</span>&nbsp;<span class="op" id="6088704">:=</span>&nbsp;<span class="ident" id="6088707">io</span><span class="op" id="6088709">.</span><span class="ident" id="6088710">ReadFull</span><span class="op" id="6088718">(</span><span class="ident" id="6088719">r</span><span class="op" id="6088720">,</span>&nbsp;<span class="ident" id="6088722">d</span><span class="op" id="6088723">)</span><span class="op" id="6088724">;</span>&nbsp;<span class="ident" id="6088726">err</span>&nbsp;<span class="op" id="6088730">!=</span>&nbsp;<span class="ident" id="6088733">nil</span>&nbsp;<span class="op" id="6088737">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088741">return</span>&nbsp;<span class="ident" id="6088748">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088756">f</span><span class="op" id="6088757">.</span><span class="ident" id="6088758">Name</span>&nbsp;<span class="op" id="6088763">=</span>&nbsp;<span class="builtintype" id="6088765">string</span><span class="op" id="6088771">(</span><span class="ident" id="6088772">d</span><span class="op" id="6088773">[</span><span class="op" id="6088774">:</span><span class="ident" id="6088775">filenameLen</span><span class="op" id="6088786">]</span><span class="op" id="6088787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088790">f</span><span class="op" id="6088791">.</span><span class="ident" id="6088792">Extra</span>&nbsp;<span class="op" id="6088798">=</span>&nbsp;<span class="ident" id="6088800">d</span><span class="op" id="6088801">[</span><span class="ident" id="6088802">filenameLen</span>&nbsp;<span class="op" id="6088814">:</span>&nbsp;<span class="ident" id="6088816">filenameLen</span><span class="op" id="6088827">+</span><span class="ident" id="6088828">extraLen</span><span class="op" id="6088836">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088839">f</span><span class="op" id="6088840">.</span><span class="ident" id="6088841">Comment</span>&nbsp;<span class="op" id="6088849">=</span>&nbsp;<span class="builtintype" id="6088851">string</span><span class="op" id="6088857">(</span><span class="ident" id="6088858">d</span><span class="op" id="6088859">[</span><span class="ident" id="6088860">filenameLen</span><span class="op" id="6088871">+</span><span class="ident" id="6088872">extraLen</span><span class="op" id="6088880">:</span><span class="op" id="6088881">]</span><span class="op" id="6088882">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088886">if</span>&nbsp;<span class="builtinfunc" id="6088889">len</span><span class="op" id="6088892">(</span><span class="ident" id="6088893">f</span><span class="op" id="6088894">.</span><span class="ident" id="6088895">Extra</span><span class="op" id="6088900">)</span>&nbsp;<span class="op" id="6088902">&gt;</span>&nbsp;<span class="num" id="6088904">0</span>&nbsp;<span class="op" id="6088906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088910">b</span>&nbsp;<span class="op" id="6088912">:=</span>&nbsp;<span class="ident" id="6088915">readBuf</span><span class="op" id="6088922">(</span><span class="ident" id="6088923">f</span><span class="op" id="6088924">.</span><span class="ident" id="6088925">Extra</span><span class="op" id="6088930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088934">for</span>&nbsp;<span class="builtinfunc" id="6088938">len</span><span class="op" id="6088941">(</span><span class="ident" id="6088942">b</span><span class="op" id="6088943">)</span>&nbsp;<span class="op" id="6088945">&gt;=</span>&nbsp;<span class="num" id="6088948">4</span>&nbsp;<span class="op" id="6088950">{</span>&nbsp;<span class="comment" id="6088952">//&nbsp;need&nbsp;at&nbsp;least&nbsp;tag&nbsp;and&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088985">tag</span>&nbsp;<span class="op" id="6088989">:=</span>&nbsp;<span class="ident" id="6088992">b</span><span class="op" id="6088993">.</span><span class="builtintype" id="6088994">uint16</span><span class="op" id="6089000">(</span><span class="op" id="6089001">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089006">size</span>&nbsp;<span class="op" id="6089011">:=</span>&nbsp;<span class="ident" id="6089014">b</span><span class="op" id="6089015">.</span><span class="builtintype" id="6089016">uint16</span><span class="op" id="6089022">(</span><span class="op" id="6089023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089028">if</span>&nbsp;<span class="builtintype" id="6089031">int</span><span class="op" id="6089034">(</span><span class="ident" id="6089035">size</span><span class="op" id="6089039">)</span>&nbsp;<span class="op" id="6089041">&gt;</span>&nbsp;<span class="builtinfunc" id="6089043">len</span><span class="op" id="6089046">(</span><span class="ident" id="6089047">b</span><span class="op" id="6089048">)</span>&nbsp;<span class="op" id="6089050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089056">return</span>&nbsp;<span class="ident" id="6089063">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6089076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089081">if</span>&nbsp;<span class="ident" id="6089084">tag</span>&nbsp;<span class="op" id="6089088">==</span>&nbsp;<span class="ident" id="6089091">zip64ExtraId</span>&nbsp;<span class="op" id="6089104">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089110">//&nbsp;update&nbsp;directory&nbsp;values&nbsp;from&nbsp;the&nbsp;zip64&nbsp;extra&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089168">eb</span>&nbsp;<span class="op" id="6089171">:=</span>&nbsp;<span class="ident" id="6089174">readBuf</span><span class="op" id="6089181">(</span><span class="ident" id="6089182">b</span><span class="op" id="6089183">[</span><span class="op" id="6089184">:</span><span class="ident" id="6089185">size</span><span class="op" id="6089189">]</span><span class="op" id="6089190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089196">if</span>&nbsp;<span class="builtinfunc" id="6089199">len</span><span class="op" id="6089202">(</span><span class="ident" id="6089203">eb</span><span class="op" id="6089205">)</span>&nbsp;<span class="op" id="6089207">&gt;=</span>&nbsp;<span class="num" id="6089210">8</span>&nbsp;<span class="op" id="6089212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089219">f</span><span class="op" id="6089220">.</span><span class="ident" id="6089221">UncompressedSize64</span>&nbsp;<span class="op" id="6089240">=</span>&nbsp;<span class="ident" id="6089242">eb</span><span class="op" id="6089244">.</span><span class="ident" id="6089245">uint64</span><span class="op" id="6089251">(</span><span class="op" id="6089252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6089258">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089264">if</span>&nbsp;<span class="builtinfunc" id="6089267">len</span><span class="op" id="6089270">(</span><span class="ident" id="6089271">eb</span><span class="op" id="6089273">)</span>&nbsp;<span class="op" id="6089275">&gt;=</span>&nbsp;<span class="num" id="6089278">8</span>&nbsp;<span class="op" id="6089280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089287">f</span><span class="op" id="6089288">.</span><span class="ident" id="6089289">CompressedSize64</span>&nbsp;<span class="op" id="6089306">=</span>&nbsp;<span class="ident" id="6089308">eb</span><span class="op" id="6089310">.</span><span class="ident" id="6089311">uint64</span><span class="op" id="6089317">(</span><span class="op" id="6089318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6089324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089330">if</span>&nbsp;<span class="builtinfunc" id="6089333">len</span><span class="op" id="6089336">(</span><span class="ident" id="6089337">eb</span><span class="op" id="6089339">)</span>&nbsp;<span class="op" id="6089341">&gt;=</span>&nbsp;<span class="num" id="6089344">8</span>&nbsp;<span class="op" id="6089346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089353">f</span><span class="op" id="6089354">.</span><span class="ident" id="6089355">headerOffset</span>&nbsp;<span class="op" id="6089368">=</span>&nbsp;<span class="ident" id="6089370">int64</span><span class="op" id="6089375">(</span><span class="ident" id="6089376">eb</span><span class="op" id="6089378">.</span><span class="ident" id="6089379">uint64</span><span class="op" id="6089385">(</span><span class="op" id="6089386">)</span><span class="op" id="6089387">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6089393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6089398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089403">b</span>&nbsp;<span class="op" id="6089405">=</span>&nbsp;<span class="ident" id="6089407">b</span><span class="op" id="6089408">[</span><span class="ident" id="6089409">size</span><span class="op" id="6089413">:</span><span class="op" id="6089414">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6089418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089422">//&nbsp;Should&nbsp;have&nbsp;consumed&nbsp;the&nbsp;whole&nbsp;header.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089466">//&nbsp;But&nbsp;popular&nbsp;zip&nbsp;&amp;&nbsp;JAR&nbsp;creation&nbsp;tools&nbsp;are&nbsp;broken&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089523">//&nbsp;may&nbsp;pad&nbsp;extra&nbsp;zeros&nbsp;at&nbsp;the&nbsp;end,&nbsp;so&nbsp;accept&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089576">//&nbsp;too.&nbsp;See&nbsp;golang.org/issue/8186.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089613">for</span>&nbsp;<span class="ident" id="6089617">_</span><span class="op" id="6089618">,</span>&nbsp;<span class="ident" id="6089620">v</span>&nbsp;<span class="op" id="6089622">:=</span>&nbsp;<span class="keyword" id="6089625">range</span>&nbsp;<span class="ident" id="6089631">b</span>&nbsp;<span class="op" id="6089633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089638">if</span>&nbsp;<span class="ident" id="6089641">v</span>&nbsp;<span class="op" id="6089643">!=</span>&nbsp;<span class="num" id="6089646">0</span>&nbsp;<span class="op" id="6089648">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089654">return</span>&nbsp;<span class="ident" id="6089661">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6089674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6089678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6089681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089684">return</span>&nbsp;<span class="ident" id="6089691">nil</span><br>
<span class="lineno">280</span><span class="op" id="6089695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6089698">func</span>&nbsp;<span class="ident" id="6089703">readDataDescriptor</span><span class="op" id="6089721">(</span><span class="ident" id="6089722">r</span>&nbsp;<span class="ident" id="6089724">io</span><span class="op" id="6089726">.</span><span class="ident" id="6089727">Reader</span><span class="op" id="6089733">,</span>&nbsp;<span class="ident" id="6089735">f</span>&nbsp;<span class="op" id="6089737">*</span><span class="ident" id="6089738">File</span><span class="op" id="6089742">)</span>&nbsp;<span class="builtintype" id="6089744">error</span>&nbsp;<span class="op" id="6089750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089753">var</span>&nbsp;<span class="ident" id="6089757">buf</span>&nbsp;<span class="op" id="6089761">[</span><span class="ident" id="6089762">dataDescriptorLen</span><span class="op" id="6089779">]</span><span class="builtintype" id="6089780">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089787">//&nbsp;The&nbsp;spec&nbsp;says:&nbsp;&#34;Although&nbsp;not&nbsp;originally&nbsp;assigned&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089842">//&nbsp;signature,&nbsp;the&nbsp;value&nbsp;0x08074b50&nbsp;has&nbsp;commonly&nbsp;been&nbsp;adopted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089904">//&nbsp;as&nbsp;a&nbsp;signature&nbsp;value&nbsp;for&nbsp;the&nbsp;data&nbsp;descriptor&nbsp;record.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089961">//&nbsp;Implementers&nbsp;should&nbsp;be&nbsp;aware&nbsp;that&nbsp;ZIP&nbsp;files&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090016">//&nbsp;encountered&nbsp;with&nbsp;or&nbsp;without&nbsp;this&nbsp;signature&nbsp;marking&nbsp;data</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090076">//&nbsp;descriptors&nbsp;and&nbsp;should&nbsp;account&nbsp;for&nbsp;either&nbsp;case&nbsp;when&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090140">//&nbsp;ZIP&nbsp;files&nbsp;to&nbsp;ensure&nbsp;compatibility.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090180">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090184">//&nbsp;dataDescriptorLen&nbsp;includes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;signature&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090245">//&nbsp;first&nbsp;read&nbsp;just&nbsp;those&nbsp;4&nbsp;bytes&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;exists.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090300">if</span>&nbsp;<span class="ident" id="6090303">_</span><span class="op" id="6090304">,</span>&nbsp;<span class="ident" id="6090306">err</span>&nbsp;<span class="op" id="6090310">:=</span>&nbsp;<span class="ident" id="6090313">io</span><span class="op" id="6090315">.</span><span class="ident" id="6090316">ReadFull</span><span class="op" id="6090324">(</span><span class="ident" id="6090325">r</span><span class="op" id="6090326">,</span>&nbsp;<span class="ident" id="6090328">buf</span><span class="op" id="6090331">[</span><span class="op" id="6090332">:</span><span class="num" id="6090333">4</span><span class="op" id="6090334">]</span><span class="op" id="6090335">)</span><span class="op" id="6090336">;</span>&nbsp;<span class="ident" id="6090338">err</span>&nbsp;<span class="op" id="6090342">!=</span>&nbsp;<span class="ident" id="6090345">nil</span>&nbsp;<span class="op" id="6090349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090353">return</span>&nbsp;<span class="ident" id="6090360">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6090365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090368">off</span>&nbsp;<span class="op" id="6090372">:=</span>&nbsp;<span class="num" id="6090375">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090378">maybeSig</span>&nbsp;<span class="op" id="6090387">:=</span>&nbsp;<span class="ident" id="6090390">readBuf</span><span class="op" id="6090397">(</span><span class="ident" id="6090398">buf</span><span class="op" id="6090401">[</span><span class="op" id="6090402">:</span><span class="num" id="6090403">4</span><span class="op" id="6090404">]</span><span class="op" id="6090405">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090408">if</span>&nbsp;<span class="ident" id="6090411">maybeSig</span><span class="op" id="6090419">.</span><span class="builtintype" id="6090420">uint32</span><span class="op" id="6090426">(</span><span class="op" id="6090427">)</span>&nbsp;<span class="op" id="6090429">!=</span>&nbsp;<span class="ident" id="6090432">dataDescriptorSignature</span>&nbsp;<span class="op" id="6090456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090460">//&nbsp;No&nbsp;data&nbsp;descriptor&nbsp;signature.&nbsp;Keep&nbsp;these&nbsp;four</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090511">//&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090523">off</span>&nbsp;<span class="op" id="6090527">+=</span>&nbsp;<span class="num" id="6090530">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6090533">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090536">if</span>&nbsp;<span class="ident" id="6090539">_</span><span class="op" id="6090540">,</span>&nbsp;<span class="ident" id="6090542">err</span>&nbsp;<span class="op" id="6090546">:=</span>&nbsp;<span class="ident" id="6090549">io</span><span class="op" id="6090551">.</span><span class="ident" id="6090552">ReadFull</span><span class="op" id="6090560">(</span><span class="ident" id="6090561">r</span><span class="op" id="6090562">,</span>&nbsp;<span class="ident" id="6090564">buf</span><span class="op" id="6090567">[</span><span class="ident" id="6090568">off</span><span class="op" id="6090571">:</span><span class="num" id="6090572">12</span><span class="op" id="6090574">]</span><span class="op" id="6090575">)</span><span class="op" id="6090576">;</span>&nbsp;<span class="ident" id="6090578">err</span>&nbsp;<span class="op" id="6090582">!=</span>&nbsp;<span class="ident" id="6090585">nil</span>&nbsp;<span class="op" id="6090589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090593">return</span>&nbsp;<span class="ident" id="6090600">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6090605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090608">b</span>&nbsp;<span class="op" id="6090610">:=</span>&nbsp;<span class="ident" id="6090613">readBuf</span><span class="op" id="6090620">(</span><span class="ident" id="6090621">buf</span><span class="op" id="6090624">[</span><span class="op" id="6090625">:</span><span class="num" id="6090626">12</span><span class="op" id="6090628">]</span><span class="op" id="6090629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090632">if</span>&nbsp;<span class="ident" id="6090635">b</span><span class="op" id="6090636">.</span><span class="builtintype" id="6090637">uint32</span><span class="op" id="6090643">(</span><span class="op" id="6090644">)</span>&nbsp;<span class="op" id="6090646">!=</span>&nbsp;<span class="ident" id="6090649">f</span><span class="op" id="6090650">.</span><span class="ident" id="6090651">CRC32</span>&nbsp;<span class="op" id="6090657">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090661">return</span>&nbsp;<span class="ident" id="6090668">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6090681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090685">//&nbsp;The&nbsp;two&nbsp;sizes&nbsp;that&nbsp;follow&nbsp;here&nbsp;can&nbsp;be&nbsp;either&nbsp;32&nbsp;bits&nbsp;or&nbsp;64&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090753">//&nbsp;but&nbsp;the&nbsp;spec&nbsp;is&nbsp;not&nbsp;very&nbsp;clear&nbsp;on&nbsp;this&nbsp;and&nbsp;different</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090810">//&nbsp;interpretations&nbsp;has&nbsp;been&nbsp;made&nbsp;causing&nbsp;incompatibilities.&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090874">//&nbsp;already&nbsp;have&nbsp;the&nbsp;sizes&nbsp;from&nbsp;the&nbsp;central&nbsp;directory&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090938">//&nbsp;just&nbsp;ignore&nbsp;these.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090962">return</span>&nbsp;<span class="ident" id="6090969">nil</span><br>
<span class="lineno">320</span><span class="op" id="6090973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6090976">func</span>&nbsp;<span class="ident" id="6090981">readDirectoryEnd</span><span class="op" id="6090997">(</span><span class="ident" id="6090998">r</span>&nbsp;<span class="ident" id="6091000">io</span><span class="op" id="6091002">.</span><span class="ident" id="6091003">ReaderAt</span><span class="op" id="6091011">,</span>&nbsp;<span class="ident" id="6091013">size</span>&nbsp;<span class="ident" id="6091018">int64</span><span class="op" id="6091023">)</span>&nbsp;<span class="op" id="6091025">(</span><span class="ident" id="6091026">dir</span>&nbsp;<span class="op" id="6091030">*</span><span class="ident" id="6091031">directoryEnd</span><span class="op" id="6091043">,</span>&nbsp;<span class="ident" id="6091045">err</span>&nbsp;<span class="builtintype" id="6091049">error</span><span class="op" id="6091054">)</span>&nbsp;<span class="op" id="6091056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6091059">//&nbsp;look&nbsp;for&nbsp;directoryEndSignature&nbsp;in&nbsp;the&nbsp;last&nbsp;1k,&nbsp;then&nbsp;in&nbsp;the&nbsp;last&nbsp;65k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091131">var</span>&nbsp;<span class="ident" id="6091135">buf</span>&nbsp;<span class="op" id="6091139">[</span><span class="op" id="6091140">]</span><span class="builtintype" id="6091141">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091147">var</span>&nbsp;<span class="ident" id="6091151">directoryEndOffset</span>&nbsp;<span class="ident" id="6091170">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091177">for</span>&nbsp;<span class="ident" id="6091181">i</span><span class="op" id="6091182">,</span>&nbsp;<span class="ident" id="6091184">bLen</span>&nbsp;<span class="op" id="6091189">:=</span>&nbsp;<span class="keyword" id="6091192">range</span>&nbsp;<span class="op" id="6091198">[</span><span class="op" id="6091199">]</span><span class="ident" id="6091200">int64</span><span class="op" id="6091205">{</span><span class="num" id="6091206">1024</span><span class="op" id="6091210">,</span>&nbsp;<span class="num" id="6091212">65</span>&nbsp;<span class="op" id="6091215">*</span>&nbsp;<span class="num" id="6091217">1024</span><span class="op" id="6091221">}</span>&nbsp;<span class="op" id="6091223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091227">if</span>&nbsp;<span class="ident" id="6091230">bLen</span>&nbsp;<span class="op" id="6091235">&gt;</span>&nbsp;<span class="ident" id="6091237">size</span>&nbsp;<span class="op" id="6091242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091247">bLen</span>&nbsp;<span class="op" id="6091252">=</span>&nbsp;<span class="ident" id="6091254">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6091261">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091265">buf</span>&nbsp;<span class="op" id="6091269">=</span>&nbsp;<span class="builtinfunc" id="6091271">make</span><span class="op" id="6091275">(</span><span class="op" id="6091276">[</span><span class="op" id="6091277">]</span><span class="builtintype" id="6091278">byte</span><span class="op" id="6091282">,</span>&nbsp;<span class="builtintype" id="6091284">int</span><span class="op" id="6091287">(</span><span class="ident" id="6091288">bLen</span><span class="op" id="6091292">)</span><span class="op" id="6091293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091297">if</span>&nbsp;<span class="ident" id="6091300">_</span><span class="op" id="6091301">,</span>&nbsp;<span class="ident" id="6091303">err</span>&nbsp;<span class="op" id="6091307">:=</span>&nbsp;<span class="ident" id="6091310">r</span><span class="op" id="6091311">.</span><span class="ident" id="6091312">ReadAt</span><span class="op" id="6091318">(</span><span class="ident" id="6091319">buf</span><span class="op" id="6091322">,</span>&nbsp;<span class="ident" id="6091324">size</span><span class="op" id="6091328">-</span><span class="ident" id="6091329">bLen</span><span class="op" id="6091333">)</span><span class="op" id="6091334">;</span>&nbsp;<span class="ident" id="6091336">err</span>&nbsp;<span class="op" id="6091340">!=</span>&nbsp;<span class="ident" id="6091343">nil</span>&nbsp;<span class="op" id="6091347">&amp;&amp;</span>&nbsp;<span class="ident" id="6091350">err</span>&nbsp;<span class="op" id="6091354">!=</span>&nbsp;<span class="ident" id="6091357">io</span><span class="op" id="6091359">.</span><span class="ident" id="6091360">EOF</span>&nbsp;<span class="op" id="6091364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091369">return</span>&nbsp;<span class="ident" id="6091376">nil</span><span class="op" id="6091379">,</span>&nbsp;<span class="ident" id="6091381">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6091387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091391">if</span>&nbsp;<span class="ident" id="6091394">p</span>&nbsp;<span class="op" id="6091396">:=</span>&nbsp;<span class="ident" id="6091399">findSignatureInBlock</span><span class="op" id="6091419">(</span><span class="ident" id="6091420">buf</span><span class="op" id="6091423">)</span><span class="op" id="6091424">;</span>&nbsp;<span class="ident" id="6091426">p</span>&nbsp;<span class="op" id="6091428">&gt;=</span>&nbsp;<span class="num" id="6091431">0</span>&nbsp;<span class="op" id="6091433">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091438">buf</span>&nbsp;<span class="op" id="6091442">=</span>&nbsp;<span class="ident" id="6091444">buf</span><span class="op" id="6091447">[</span><span class="ident" id="6091448">p</span><span class="op" id="6091449">:</span><span class="op" id="6091450">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091455">directoryEndOffset</span>&nbsp;<span class="op" id="6091474">=</span>&nbsp;<span class="ident" id="6091476">size</span>&nbsp;<span class="op" id="6091481">-</span>&nbsp;<span class="ident" id="6091483">bLen</span>&nbsp;<span class="op" id="6091488">+</span>&nbsp;<span class="ident" id="6091490">int64</span><span class="op" id="6091495">(</span><span class="ident" id="6091496">p</span><span class="op" id="6091497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091502">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6091510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091514">if</span>&nbsp;<span class="ident" id="6091517">i</span>&nbsp;<span class="op" id="6091519">==</span>&nbsp;<span class="num" id="6091522">1</span>&nbsp;<span class="op" id="6091524">||</span>&nbsp;<span class="ident" id="6091527">bLen</span>&nbsp;<span class="op" id="6091532">==</span>&nbsp;<span class="ident" id="6091535">size</span>&nbsp;<span class="op" id="6091540">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091545">return</span>&nbsp;<span class="ident" id="6091552">nil</span><span class="op" id="6091555">,</span>&nbsp;<span class="ident" id="6091557">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6091569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6091572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6091576">//&nbsp;read&nbsp;header&nbsp;into&nbsp;struct</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091604">b</span>&nbsp;<span class="op" id="6091606">:=</span>&nbsp;<span class="ident" id="6091609">readBuf</span><span class="op" id="6091616">(</span><span class="ident" id="6091617">buf</span><span class="op" id="6091620">[</span><span class="num" id="6091621">4</span><span class="op" id="6091622">:</span><span class="op" id="6091623">]</span><span class="op" id="6091624">)</span>&nbsp;<span class="comment" id="6091626">//&nbsp;skip&nbsp;signature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091645">d</span>&nbsp;<span class="op" id="6091647">:=</span>&nbsp;<span class="op" id="6091650">&amp;</span><span class="ident" id="6091651">directoryEnd</span><span class="op" id="6091663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091667">diskNbr</span><span class="op" id="6091674">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6091687">uint32</span><span class="op" id="6091693">(</span><span class="ident" id="6091694">b</span><span class="op" id="6091695">.</span><span class="builtintype" id="6091696">uint16</span><span class="op" id="6091702">(</span><span class="op" id="6091703">)</span><span class="op" id="6091704">)</span><span class="op" id="6091705">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091709">dirDiskNbr</span><span class="op" id="6091719">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6091729">uint32</span><span class="op" id="6091735">(</span><span class="ident" id="6091736">b</span><span class="op" id="6091737">.</span><span class="builtintype" id="6091738">uint16</span><span class="op" id="6091744">(</span><span class="op" id="6091745">)</span><span class="op" id="6091746">)</span><span class="op" id="6091747">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091751">dirRecordsThisDisk</span><span class="op" id="6091769">:</span>&nbsp;<span class="ident" id="6091771">uint64</span><span class="op" id="6091777">(</span><span class="ident" id="6091778">b</span><span class="op" id="6091779">.</span><span class="builtintype" id="6091780">uint16</span><span class="op" id="6091786">(</span><span class="op" id="6091787">)</span><span class="op" id="6091788">)</span><span class="op" id="6091789">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091793">directoryRecords</span><span class="op" id="6091809">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6091813">uint64</span><span class="op" id="6091819">(</span><span class="ident" id="6091820">b</span><span class="op" id="6091821">.</span><span class="builtintype" id="6091822">uint16</span><span class="op" id="6091828">(</span><span class="op" id="6091829">)</span><span class="op" id="6091830">)</span><span class="op" id="6091831">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091835">directorySize</span><span class="op" id="6091848">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091855">uint64</span><span class="op" id="6091861">(</span><span class="ident" id="6091862">b</span><span class="op" id="6091863">.</span><span class="builtintype" id="6091864">uint32</span><span class="op" id="6091870">(</span><span class="op" id="6091871">)</span><span class="op" id="6091872">)</span><span class="op" id="6091873">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091877">directoryOffset</span><span class="op" id="6091892">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091897">uint64</span><span class="op" id="6091903">(</span><span class="ident" id="6091904">b</span><span class="op" id="6091905">.</span><span class="builtintype" id="6091906">uint32</span><span class="op" id="6091912">(</span><span class="op" id="6091913">)</span><span class="op" id="6091914">)</span><span class="op" id="6091915">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091919">commentLen</span><span class="op" id="6091929">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091939">b</span><span class="op" id="6091940">.</span><span class="builtintype" id="6091941">uint16</span><span class="op" id="6091947">(</span><span class="op" id="6091948">)</span><span class="op" id="6091949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6091952">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091955">l</span>&nbsp;<span class="op" id="6091957">:=</span>&nbsp;<span class="builtintype" id="6091960">int</span><span class="op" id="6091963">(</span><span class="ident" id="6091964">d</span><span class="op" id="6091965">.</span><span class="ident" id="6091966">commentLen</span><span class="op" id="6091976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091979">if</span>&nbsp;<span class="ident" id="6091982">l</span>&nbsp;<span class="op" id="6091984">&gt;</span>&nbsp;<span class="builtinfunc" id="6091986">len</span><span class="op" id="6091989">(</span><span class="ident" id="6091990">b</span><span class="op" id="6091991">)</span>&nbsp;<span class="op" id="6091993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091997">return</span>&nbsp;<span class="ident" id="6092004">nil</span><span class="op" id="6092007">,</span>&nbsp;<span class="ident" id="6092009">errors</span><span class="op" id="6092015">.</span><span class="ident" id="6092016">New</span><span class="op" id="6092019">(</span><span class="string" id="6092020">&#34;zip:&nbsp;invalid&nbsp;comment&nbsp;length&#34;</span><span class="op" id="6092049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6092052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092055">d</span><span class="op" id="6092056">.</span><span class="ident" id="6092057">comment</span>&nbsp;<span class="op" id="6092065">=</span>&nbsp;<span class="builtintype" id="6092067">string</span><span class="op" id="6092073">(</span><span class="ident" id="6092074">b</span><span class="op" id="6092075">[</span><span class="op" id="6092076">:</span><span class="ident" id="6092077">l</span><span class="op" id="6092078">]</span><span class="op" id="6092079">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092083">p</span><span class="op" id="6092084">,</span>&nbsp;<span class="ident" id="6092086">err</span>&nbsp;<span class="op" id="6092090">:=</span>&nbsp;<span class="ident" id="6092093">findDirectory64End</span><span class="op" id="6092111">(</span><span class="ident" id="6092112">r</span><span class="op" id="6092113">,</span>&nbsp;<span class="ident" id="6092115">directoryEndOffset</span><span class="op" id="6092133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092136">if</span>&nbsp;<span class="ident" id="6092139">err</span>&nbsp;<span class="op" id="6092143">==</span>&nbsp;<span class="ident" id="6092146">nil</span>&nbsp;<span class="op" id="6092150">&amp;&amp;</span>&nbsp;<span class="ident" id="6092153">p</span>&nbsp;<span class="op" id="6092155">&gt;=</span>&nbsp;<span class="num" id="6092158">0</span>&nbsp;<span class="op" id="6092160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092164">err</span>&nbsp;<span class="op" id="6092168">=</span>&nbsp;<span class="ident" id="6092170">readDirectory64End</span><span class="op" id="6092188">(</span><span class="ident" id="6092189">r</span><span class="op" id="6092190">,</span>&nbsp;<span class="ident" id="6092192">p</span><span class="op" id="6092193">,</span>&nbsp;<span class="ident" id="6092195">d</span><span class="op" id="6092196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6092199">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092202">if</span>&nbsp;<span class="ident" id="6092205">err</span>&nbsp;<span class="op" id="6092209">!=</span>&nbsp;<span class="ident" id="6092212">nil</span>&nbsp;<span class="op" id="6092216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092220">return</span>&nbsp;<span class="ident" id="6092227">nil</span><span class="op" id="6092230">,</span>&nbsp;<span class="ident" id="6092232">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6092237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6092241">//&nbsp;Make&nbsp;sure&nbsp;directoryOffset&nbsp;points&nbsp;to&nbsp;somewhere&nbsp;in&nbsp;our&nbsp;file.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092304">if</span>&nbsp;<span class="ident" id="6092307">o</span>&nbsp;<span class="op" id="6092309">:=</span>&nbsp;<span class="ident" id="6092312">int64</span><span class="op" id="6092317">(</span><span class="ident" id="6092318">d</span><span class="op" id="6092319">.</span><span class="ident" id="6092320">directoryOffset</span><span class="op" id="6092335">)</span><span class="op" id="6092336">;</span>&nbsp;<span class="ident" id="6092338">o</span>&nbsp;<span class="op" id="6092340">&lt;</span>&nbsp;<span class="num" id="6092342">0</span>&nbsp;<span class="op" id="6092344">||</span>&nbsp;<span class="ident" id="6092347">o</span>&nbsp;<span class="op" id="6092349">&gt;=</span>&nbsp;<span class="ident" id="6092352">size</span>&nbsp;<span class="op" id="6092357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092361">return</span>&nbsp;<span class="ident" id="6092368">nil</span><span class="op" id="6092371">,</span>&nbsp;<span class="ident" id="6092373">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6092384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092387">return</span>&nbsp;<span class="ident" id="6092394">d</span><span class="op" id="6092395">,</span>&nbsp;<span class="ident" id="6092397">nil</span><br>
<span class="lineno"></span><span class="op" id="6092401">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="6092404">//&nbsp;findDirectory64End&nbsp;tries&nbsp;to&nbsp;read&nbsp;the&nbsp;zip64&nbsp;locator&nbsp;just&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6092474">//&nbsp;directory&nbsp;end&nbsp;and&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6092544">//&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="6092554">func</span>&nbsp;<span class="ident" id="6092559">findDirectory64End</span><span class="op" id="6092577">(</span><span class="ident" id="6092578">r</span>&nbsp;<span class="ident" id="6092580">io</span><span class="op" id="6092582">.</span><span class="ident" id="6092583">ReaderAt</span><span class="op" id="6092591">,</span>&nbsp;<span class="ident" id="6092593">directoryEndOffset</span>&nbsp;<span class="ident" id="6092612">int64</span><span class="op" id="6092617">)</span>&nbsp;<span class="op" id="6092619">(</span><span class="ident" id="6092620">int64</span><span class="op" id="6092625">,</span>&nbsp;<span class="builtintype" id="6092627">error</span><span class="op" id="6092632">)</span>&nbsp;<span class="op" id="6092634">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092637">locOffset</span>&nbsp;<span class="op" id="6092647">:=</span>&nbsp;<span class="ident" id="6092650">directoryEndOffset</span>&nbsp;<span class="op" id="6092669">-</span>&nbsp;<span class="ident" id="6092671">directory64LocLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092690">if</span>&nbsp;<span class="ident" id="6092693">locOffset</span>&nbsp;<span class="op" id="6092703">&lt;</span>&nbsp;<span class="num" id="6092705">0</span>&nbsp;<span class="op" id="6092707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092711">return</span>&nbsp;<span class="op" id="6092718">-</span><span class="num" id="6092719">1</span><span class="op" id="6092720">,</span>&nbsp;<span class="ident" id="6092722">nil</span>&nbsp;<span class="comment" id="6092726">//&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;a&nbsp;header&nbsp;outside&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6092776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092779">buf</span>&nbsp;<span class="op" id="6092783">:=</span>&nbsp;<span class="builtinfunc" id="6092786">make</span><span class="op" id="6092790">(</span><span class="op" id="6092791">[</span><span class="op" id="6092792">]</span><span class="builtintype" id="6092793">byte</span><span class="op" id="6092797">,</span>&nbsp;<span class="ident" id="6092799">directory64LocLen</span><span class="op" id="6092816">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092819">if</span>&nbsp;<span class="ident" id="6092822">_</span><span class="op" id="6092823">,</span>&nbsp;<span class="ident" id="6092825">err</span>&nbsp;<span class="op" id="6092829">:=</span>&nbsp;<span class="ident" id="6092832">r</span><span class="op" id="6092833">.</span><span class="ident" id="6092834">ReadAt</span><span class="op" id="6092840">(</span><span class="ident" id="6092841">buf</span><span class="op" id="6092844">,</span>&nbsp;<span class="ident" id="6092846">locOffset</span><span class="op" id="6092855">)</span><span class="op" id="6092856">;</span>&nbsp;<span class="ident" id="6092858">err</span>&nbsp;<span class="op" id="6092862">!=</span>&nbsp;<span class="ident" id="6092865">nil</span>&nbsp;<span class="op" id="6092869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092873">return</span>&nbsp;<span class="op" id="6092880">-</span><span class="num" id="6092881">1</span><span class="op" id="6092882">,</span>&nbsp;<span class="ident" id="6092884">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6092889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092892">b</span>&nbsp;<span class="op" id="6092894">:=</span>&nbsp;<span class="ident" id="6092897">readBuf</span><span class="op" id="6092904">(</span><span class="ident" id="6092905">buf</span><span class="op" id="6092908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092911">if</span>&nbsp;<span class="ident" id="6092914">sig</span>&nbsp;<span class="op" id="6092918">:=</span>&nbsp;<span class="ident" id="6092921">b</span><span class="op" id="6092922">.</span><span class="builtintype" id="6092923">uint32</span><span class="op" id="6092929">(</span><span class="op" id="6092930">)</span><span class="op" id="6092931">;</span>&nbsp;<span class="ident" id="6092933">sig</span>&nbsp;<span class="op" id="6092937">!=</span>&nbsp;<span class="ident" id="6092940">directory64LocSignature</span>&nbsp;<span class="op" id="6092964">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092968">return</span>&nbsp;<span class="op" id="6092975">-</span><span class="num" id="6092976">1</span><span class="op" id="6092977">,</span>&nbsp;<span class="ident" id="6092979">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6092984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092987">b</span>&nbsp;<span class="op" id="6092989">=</span>&nbsp;<span class="ident" id="6092991">b</span><span class="op" id="6092992">[</span><span class="num" id="6092993">4</span><span class="op" id="6092994">:</span><span class="op" id="6092995">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6093003">//&nbsp;skip&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093084">p</span>&nbsp;<span class="op" id="6093086">:=</span>&nbsp;<span class="ident" id="6093089">b</span><span class="op" id="6093090">.</span><span class="ident" id="6093091">uint64</span><span class="op" id="6093097">(</span><span class="op" id="6093098">)</span>&nbsp;<span class="comment" id="6093100">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093165">return</span>&nbsp;<span class="ident" id="6093172">int64</span><span class="op" id="6093177">(</span><span class="ident" id="6093178">p</span><span class="op" id="6093179">)</span><span class="op" id="6093180">,</span>&nbsp;<span class="ident" id="6093182">nil</span><br>
<span class="lineno">395</span><span class="op" id="6093186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6093189">//&nbsp;readDirectory64End&nbsp;reads&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;and&nbsp;updates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6093257">//&nbsp;directory&nbsp;end&nbsp;with&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="6093311">func</span>&nbsp;<span class="ident" id="6093316">readDirectory64End</span><span class="op" id="6093334">(</span><span class="ident" id="6093335">r</span>&nbsp;<span class="ident" id="6093337">io</span><span class="op" id="6093339">.</span><span class="ident" id="6093340">ReaderAt</span><span class="op" id="6093348">,</span>&nbsp;<span class="ident" id="6093350">offset</span>&nbsp;<span class="ident" id="6093357">int64</span><span class="op" id="6093362">,</span>&nbsp;<span class="ident" id="6093364">d</span>&nbsp;<span class="op" id="6093366">*</span><span class="ident" id="6093367">directoryEnd</span><span class="op" id="6093379">)</span>&nbsp;<span class="op" id="6093381">(</span><span class="ident" id="6093382">err</span>&nbsp;<span class="builtintype" id="6093386">error</span><span class="op" id="6093391">)</span>&nbsp;<span class="op" id="6093393">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093396">buf</span>&nbsp;<span class="op" id="6093400">:=</span>&nbsp;<span class="builtinfunc" id="6093403">make</span><span class="op" id="6093407">(</span><span class="op" id="6093408">[</span><span class="op" id="6093409">]</span><span class="builtintype" id="6093410">byte</span><span class="op" id="6093414">,</span>&nbsp;<span class="ident" id="6093416">directory64EndLen</span><span class="op" id="6093433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093436">if</span>&nbsp;<span class="ident" id="6093439">_</span><span class="op" id="6093440">,</span>&nbsp;<span class="ident" id="6093442">err</span>&nbsp;<span class="op" id="6093446">:=</span>&nbsp;<span class="ident" id="6093449">r</span><span class="op" id="6093450">.</span><span class="ident" id="6093451">ReadAt</span><span class="op" id="6093457">(</span><span class="ident" id="6093458">buf</span><span class="op" id="6093461">,</span>&nbsp;<span class="ident" id="6093463">offset</span><span class="op" id="6093469">)</span><span class="op" id="6093470">;</span>&nbsp;<span class="ident" id="6093472">err</span>&nbsp;<span class="op" id="6093476">!=</span>&nbsp;<span class="ident" id="6093479">nil</span>&nbsp;<span class="op" id="6093483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093487">return</span>&nbsp;<span class="ident" id="6093494">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6093499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093503">b</span>&nbsp;<span class="op" id="6093505">:=</span>&nbsp;<span class="ident" id="6093508">readBuf</span><span class="op" id="6093515">(</span><span class="ident" id="6093516">buf</span><span class="op" id="6093519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093522">if</span>&nbsp;<span class="ident" id="6093525">sig</span>&nbsp;<span class="op" id="6093529">:=</span>&nbsp;<span class="ident" id="6093532">b</span><span class="op" id="6093533">.</span><span class="builtintype" id="6093534">uint32</span><span class="op" id="6093540">(</span><span class="op" id="6093541">)</span><span class="op" id="6093542">;</span>&nbsp;<span class="ident" id="6093544">sig</span>&nbsp;<span class="op" id="6093548">!=</span>&nbsp;<span class="ident" id="6093551">directory64EndSignature</span>&nbsp;<span class="op" id="6093575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093579">return</span>&nbsp;<span class="ident" id="6093586">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6093597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093601">b</span>&nbsp;<span class="op" id="6093603">=</span>&nbsp;<span class="ident" id="6093605">b</span><span class="op" id="6093606">[</span><span class="num" id="6093607">12</span><span class="op" id="6093609">:</span><span class="op" id="6093610">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6093635">//&nbsp;skip&nbsp;dir&nbsp;size,&nbsp;version&nbsp;and&nbsp;version&nbsp;needed&nbsp;(uint64&nbsp;+&nbsp;2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093702">d</span><span class="op" id="6093703">.</span><span class="ident" id="6093704">diskNbr</span>&nbsp;<span class="op" id="6093712">=</span>&nbsp;<span class="ident" id="6093714">b</span><span class="op" id="6093715">.</span><span class="builtintype" id="6093716">uint32</span><span class="op" id="6093722">(</span><span class="op" id="6093723">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6093736">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093760">d</span><span class="op" id="6093761">.</span><span class="ident" id="6093762">dirDiskNbr</span>&nbsp;<span class="op" id="6093773">=</span>&nbsp;<span class="ident" id="6093775">b</span><span class="op" id="6093776">.</span><span class="builtintype" id="6093777">uint32</span><span class="op" id="6093783">(</span><span class="op" id="6093784">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6093794">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093857">d</span><span class="op" id="6093858">.</span><span class="ident" id="6093859">dirRecordsThisDisk</span>&nbsp;<span class="op" id="6093878">=</span>&nbsp;<span class="ident" id="6093880">b</span><span class="op" id="6093881">.</span><span class="ident" id="6093882">uint64</span><span class="op" id="6093888">(</span><span class="op" id="6093889">)</span>&nbsp;<span class="comment" id="6093891">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093957">d</span><span class="op" id="6093958">.</span><span class="ident" id="6093959">directoryRecords</span>&nbsp;<span class="op" id="6093976">=</span>&nbsp;<span class="ident" id="6093978">b</span><span class="op" id="6093979">.</span><span class="ident" id="6093980">uint64</span><span class="op" id="6093986">(</span><span class="op" id="6093987">)</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6093991">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094044">d</span><span class="op" id="6094045">.</span><span class="ident" id="6094046">directorySize</span>&nbsp;<span class="op" id="6094060">=</span>&nbsp;<span class="ident" id="6094062">b</span><span class="op" id="6094063">.</span><span class="ident" id="6094064">uint64</span><span class="op" id="6094070">(</span><span class="op" id="6094071">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6094078">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094112">d</span><span class="op" id="6094113">.</span><span class="ident" id="6094114">directoryOffset</span>&nbsp;<span class="op" id="6094130">=</span>&nbsp;<span class="ident" id="6094132">b</span><span class="op" id="6094133">.</span><span class="ident" id="6094134">uint64</span><span class="op" id="6094140">(</span><span class="op" id="6094141">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6094146">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6094229">return</span>&nbsp;<span class="ident" id="6094236">nil</span><br>
<span class="lineno"></span><span class="op" id="6094240">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span><span class="keyword" id="6094243">func</span>&nbsp;<span class="ident" id="6094248">findSignatureInBlock</span><span class="op" id="6094268">(</span><span class="ident" id="6094269">b</span>&nbsp;<span class="op" id="6094271">[</span><span class="op" id="6094272">]</span><span class="builtintype" id="6094273">byte</span><span class="op" id="6094277">)</span>&nbsp;<span class="builtintype" id="6094279">int</span>&nbsp;<span class="op" id="6094283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6094286">for</span>&nbsp;<span class="ident" id="6094290">i</span>&nbsp;<span class="op" id="6094292">:=</span>&nbsp;<span class="builtinfunc" id="6094295">len</span><span class="op" id="6094298">(</span><span class="ident" id="6094299">b</span><span class="op" id="6094300">)</span>&nbsp;<span class="op" id="6094302">-</span>&nbsp;<span class="ident" id="6094304">directoryEndLen</span><span class="op" id="6094319">;</span>&nbsp;<span class="ident" id="6094321">i</span>&nbsp;<span class="op" id="6094323">&gt;=</span>&nbsp;<span class="num" id="6094326">0</span><span class="op" id="6094327">;</span>&nbsp;<span class="ident" id="6094329">i</span><span class="op" id="6094330">--</span>&nbsp;<span class="op" id="6094333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6094337">//&nbsp;defined&nbsp;from&nbsp;directoryEndSignature&nbsp;in&nbsp;struct.go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6094390">if</span>&nbsp;<span class="ident" id="6094393">b</span><span class="op" id="6094394">[</span><span class="ident" id="6094395">i</span><span class="op" id="6094396">]</span>&nbsp;<span class="op" id="6094398">==</span>&nbsp;<span class="string" id="6094401">&#39;P&#39;</span>&nbsp;<span class="op" id="6094405">&amp;&amp;</span>&nbsp;<span class="ident" id="6094408">b</span><span class="op" id="6094409">[</span><span class="ident" id="6094410">i</span><span class="op" id="6094411">+</span><span class="num" id="6094412">1</span><span class="op" id="6094413">]</span>&nbsp;<span class="op" id="6094415">==</span>&nbsp;<span class="string" id="6094418">&#39;K&#39;</span>&nbsp;<span class="op" id="6094422">&amp;&amp;</span>&nbsp;<span class="ident" id="6094425">b</span><span class="op" id="6094426">[</span><span class="ident" id="6094427">i</span><span class="op" id="6094428">+</span><span class="num" id="6094429">2</span><span class="op" id="6094430">]</span>&nbsp;<span class="op" id="6094432">==</span>&nbsp;<span class="num" id="6094435">0x05</span>&nbsp;<span class="op" id="6094440">&amp;&amp;</span>&nbsp;<span class="ident" id="6094443">b</span><span class="op" id="6094444">[</span><span class="ident" id="6094445">i</span><span class="op" id="6094446">+</span><span class="num" id="6094447">3</span><span class="op" id="6094448">]</span>&nbsp;<span class="op" id="6094450">==</span>&nbsp;<span class="num" id="6094453">0x06</span>&nbsp;<span class="op" id="6094458">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6094463">//&nbsp;n&nbsp;is&nbsp;length&nbsp;of&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094492">n</span>&nbsp;<span class="op" id="6094494">:=</span>&nbsp;<span class="builtintype" id="6094497">int</span><span class="op" id="6094500">(</span><span class="ident" id="6094501">b</span><span class="op" id="6094502">[</span><span class="ident" id="6094503">i</span><span class="op" id="6094504">+</span><span class="ident" id="6094505">directoryEndLen</span><span class="op" id="6094520">-</span><span class="num" id="6094521">2</span><span class="op" id="6094522">]</span><span class="op" id="6094523">)</span>&nbsp;<span class="op" id="6094525">|</span>&nbsp;<span class="builtintype" id="6094527">int</span><span class="op" id="6094530">(</span><span class="ident" id="6094531">b</span><span class="op" id="6094532">[</span><span class="ident" id="6094533">i</span><span class="op" id="6094534">+</span><span class="ident" id="6094535">directoryEndLen</span><span class="op" id="6094550">-</span><span class="num" id="6094551">1</span><span class="op" id="6094552">]</span><span class="op" id="6094553">)</span><span class="op" id="6094554">&lt;&lt;</span><span class="num" id="6094556">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6094561">if</span>&nbsp;<span class="ident" id="6094564">n</span><span class="op" id="6094565">+</span><span class="ident" id="6094566">directoryEndLen</span><span class="op" id="6094581">+</span><span class="ident" id="6094582">i</span>&nbsp;<span class="op" id="6094584">&lt;=</span>&nbsp;<span class="builtinfunc" id="6094587">len</span><span class="op" id="6094590">(</span><span class="ident" id="6094591">b</span><span class="op" id="6094592">)</span>&nbsp;<span class="op" id="6094594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6094600">return</span>&nbsp;<span class="ident" id="6094607">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6094612">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6094616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6094619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6094622">return</span>&nbsp;<span class="op" id="6094629">-</span><span class="num" id="6094630">1</span><br>
<span class="lineno"></span><span class="op" id="6094632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="6094635">type</span>&nbsp;<span class="ident" id="6094640">readBuf</span>&nbsp;<span class="op" id="6094648">[</span><span class="op" id="6094649">]</span><span class="builtintype" id="6094650">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6094656">func</span>&nbsp;<span class="op" id="6094661">(</span><span class="ident" id="6094662">b</span>&nbsp;<span class="op" id="6094664">*</span><span class="ident" id="6094665">readBuf</span><span class="op" id="6094672">)</span>&nbsp;<span class="builtintype" id="6094674">uint16</span><span class="op" id="6094680">(</span><span class="op" id="6094681">)</span>&nbsp;<span class="builtintype" id="6094683">uint16</span>&nbsp;<span class="op" id="6094690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094693">v</span>&nbsp;<span class="op" id="6094695">:=</span>&nbsp;<span class="ident" id="6094698">binary</span><span class="op" id="6094704">.</span><span class="ident" id="6094705">LittleEndian</span><span class="op" id="6094717">.</span><span class="ident" id="6094718">Uint16</span><span class="op" id="6094724">(</span><span class="op" id="6094725">*</span><span class="ident" id="6094726">b</span><span class="op" id="6094727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6094730">*</span><span class="ident" id="6094731">b</span>&nbsp;<span class="op" id="6094733">=</span>&nbsp;<span class="op" id="6094735">(</span><span class="op" id="6094736">*</span><span class="ident" id="6094737">b</span><span class="op" id="6094738">)</span><span class="op" id="6094739">[</span><span class="num" id="6094740">2</span><span class="op" id="6094741">:</span><span class="op" id="6094742">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6094745">return</span>&nbsp;<span class="ident" id="6094752">v</span><br>
<span class="lineno"></span><span class="op" id="6094754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6094757">func</span>&nbsp;<span class="op" id="6094762">(</span><span class="ident" id="6094763">b</span>&nbsp;<span class="op" id="6094765">*</span><span class="ident" id="6094766">readBuf</span><span class="op" id="6094773">)</span>&nbsp;<span class="builtintype" id="6094775">uint32</span><span class="op" id="6094781">(</span><span class="op" id="6094782">)</span>&nbsp;<span class="builtintype" id="6094784">uint32</span>&nbsp;<span class="op" id="6094791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094794">v</span>&nbsp;<span class="op" id="6094796">:=</span>&nbsp;<span class="ident" id="6094799">binary</span><span class="op" id="6094805">.</span><span class="ident" id="6094806">LittleEndian</span><span class="op" id="6094818">.</span><span class="ident" id="6094819">Uint32</span><span class="op" id="6094825">(</span><span class="op" id="6094826">*</span><span class="ident" id="6094827">b</span><span class="op" id="6094828">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6094831">*</span><span class="ident" id="6094832">b</span>&nbsp;<span class="op" id="6094834">=</span>&nbsp;<span class="op" id="6094836">(</span><span class="op" id="6094837">*</span><span class="ident" id="6094838">b</span><span class="op" id="6094839">)</span><span class="op" id="6094840">[</span><span class="num" id="6094841">4</span><span class="op" id="6094842">:</span><span class="op" id="6094843">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6094846">return</span>&nbsp;<span class="ident" id="6094853">v</span><br>
<span class="lineno"></span><span class="op" id="6094855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6094858">func</span>&nbsp;<span class="op" id="6094863">(</span><span class="ident" id="6094864">b</span>&nbsp;<span class="op" id="6094866">*</span><span class="ident" id="6094867">readBuf</span><span class="op" id="6094874">)</span>&nbsp;<span class="ident" id="6094876">uint64</span><span class="op" id="6094882">(</span><span class="op" id="6094883">)</span>&nbsp;<span class="ident" id="6094885">uint64</span>&nbsp;<span class="op" id="6094892">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094895">v</span>&nbsp;<span class="op" id="6094897">:=</span>&nbsp;<span class="ident" id="6094900">binary</span><span class="op" id="6094906">.</span><span class="ident" id="6094907">LittleEndian</span><span class="op" id="6094919">.</span><span class="ident" id="6094920">Uint64</span><span class="op" id="6094926">(</span><span class="op" id="6094927">*</span><span class="ident" id="6094928">b</span><span class="op" id="6094929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6094932">*</span><span class="ident" id="6094933">b</span>&nbsp;<span class="op" id="6094935">=</span>&nbsp;<span class="op" id="6094937">(</span><span class="op" id="6094938">*</span><span class="ident" id="6094939">b</span><span class="op" id="6094940">)</span><span class="op" id="6094941">[</span><span class="num" id="6094942">8</span><span class="op" id="6094943">:</span><span class="op" id="6094944">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6094947">return</span>&nbsp;<span class="ident" id="6094954">v</span><br>
<span class="lineno"></span><span class="op" id="6094956">}</span>
</div>
</body>
</html>
