<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3284457">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3284512">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3284566">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3284617">package</span>&nbsp;<span class="ident" id="3284625">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3284630">import</span>&nbsp;<span class="op" id="3284637">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3284640">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3284653">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3284660">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3284663">//&nbsp;DNSError&nbsp;represents&nbsp;a&nbsp;DNS&nbsp;lookup&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="3284706">type</span>&nbsp;<span class="ident" id="3284711">DNSError</span>&nbsp;<span class="keyword" id="3284720">struct</span>&nbsp;<span class="op" id="3284727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284730">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3284740">string</span>&nbsp;<span class="comment" id="3284747">//&nbsp;description&nbsp;of&nbsp;the&nbsp;error</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284776">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3284786">string</span>&nbsp;<span class="comment" id="3284793">//&nbsp;name&nbsp;looked&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284813">Server</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3284823">string</span>&nbsp;<span class="comment" id="3284830">//&nbsp;server&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284846">IsTimeout</span>&nbsp;<span class="builtintype" id="3284856">bool</span><br>
<span class="lineno"></span><span class="op" id="3284861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3284864">func</span>&nbsp;<span class="op" id="3284869">(</span><span class="ident" id="3284870">e</span>&nbsp;<span class="op" id="3284872">*</span><span class="ident" id="3284873">DNSError</span><span class="op" id="3284881">)</span>&nbsp;<span class="ident" id="3284883">Error</span><span class="op" id="3284888">(</span><span class="op" id="3284889">)</span>&nbsp;<span class="builtintype" id="3284891">string</span>&nbsp;<span class="op" id="3284898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284901">if</span>&nbsp;<span class="ident" id="3284904">e</span>&nbsp;<span class="op" id="3284906">==</span>&nbsp;<span class="ident" id="3284909">nil</span>&nbsp;<span class="op" id="3284913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284917">return</span>&nbsp;<span class="string" id="3284924">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3284933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284936">s</span>&nbsp;<span class="op" id="3284938">:=</span>&nbsp;<span class="string" id="3284941">&#34;lookup&nbsp;&#34;</span>&nbsp;<span class="op" id="3284951">+</span>&nbsp;<span class="ident" id="3284953">e</span><span class="op" id="3284954">.</span><span class="ident" id="3284955">Name</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284961">if</span>&nbsp;<span class="ident" id="3284964">e</span><span class="op" id="3284965">.</span><span class="ident" id="3284966">Server</span>&nbsp;<span class="op" id="3284973">!=</span>&nbsp;<span class="string" id="3284976">&#34;&#34;</span>&nbsp;<span class="op" id="3284979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284983">s</span>&nbsp;<span class="op" id="3284985">+=</span>&nbsp;<span class="string" id="3284988">&#34;&nbsp;on&nbsp;&#34;</span>&nbsp;<span class="op" id="3284995">+</span>&nbsp;<span class="ident" id="3284997">e</span><span class="op" id="3284998">.</span><span class="ident" id="3284999">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3285010">s</span>&nbsp;<span class="op" id="3285012">+=</span>&nbsp;<span class="string" id="3285015">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3285020">+</span>&nbsp;<span class="ident" id="3285022">e</span><span class="op" id="3285023">.</span><span class="ident" id="3285024">Err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285029">return</span>&nbsp;<span class="ident" id="3285036">s</span><br>
<span class="lineno">30</span><span class="op" id="3285038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3285041">func</span>&nbsp;<span class="op" id="3285046">(</span><span class="ident" id="3285047">e</span>&nbsp;<span class="op" id="3285049">*</span><span class="ident" id="3285050">DNSError</span><span class="op" id="3285058">)</span>&nbsp;<span class="ident" id="3285060">Timeout</span><span class="op" id="3285067">(</span><span class="op" id="3285068">)</span>&nbsp;<span class="builtintype" id="3285070">bool</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3285077">{</span>&nbsp;<span class="keyword" id="3285079">return</span>&nbsp;<span class="ident" id="3285086">e</span><span class="op" id="3285087">.</span><span class="ident" id="3285088">IsTimeout</span>&nbsp;<span class="op" id="3285098">}</span><br>
<span class="lineno"></span><span class="keyword" id="3285100">func</span>&nbsp;<span class="op" id="3285105">(</span><span class="ident" id="3285106">e</span>&nbsp;<span class="op" id="3285108">*</span><span class="ident" id="3285109">DNSError</span><span class="op" id="3285117">)</span>&nbsp;<span class="ident" id="3285119">Temporary</span><span class="op" id="3285128">(</span><span class="op" id="3285129">)</span>&nbsp;<span class="builtintype" id="3285131">bool</span>&nbsp;<span class="op" id="3285136">{</span>&nbsp;<span class="keyword" id="3285138">return</span>&nbsp;<span class="ident" id="3285145">e</span><span class="op" id="3285146">.</span><span class="ident" id="3285147">IsTimeout</span>&nbsp;<span class="op" id="3285157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="3285160">const</span>&nbsp;<span class="ident" id="3285166">noSuchHost</span>&nbsp;<span class="op" id="3285177">=</span>&nbsp;<span class="string" id="3285179">&#34;no&nbsp;such&nbsp;host&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3285195">//&nbsp;reverseaddr&nbsp;returns&nbsp;the&nbsp;in-addr.arpa.&nbsp;or&nbsp;ip6.arpa.&nbsp;hostname&nbsp;of&nbsp;the&nbsp;IP</span><br>
<span class="lineno"></span><span class="comment" id="3285268">//&nbsp;address&nbsp;addr&nbsp;suitable&nbsp;for&nbsp;rDNS&nbsp;(PTR)&nbsp;record&nbsp;lookup&nbsp;or&nbsp;an&nbsp;error&nbsp;if&nbsp;it&nbsp;fails</span><br>
<span class="lineno"></span><span class="comment" id="3285346">//&nbsp;to&nbsp;parse&nbsp;the&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">40</span><span class="keyword" id="3285374">func</span>&nbsp;<span class="ident" id="3285379">reverseaddr</span><span class="op" id="3285390">(</span><span class="ident" id="3285391">addr</span>&nbsp;<span class="builtintype" id="3285396">string</span><span class="op" id="3285402">)</span>&nbsp;<span class="op" id="3285404">(</span><span class="ident" id="3285405">arpa</span>&nbsp;<span class="builtintype" id="3285410">string</span><span class="op" id="3285416">,</span>&nbsp;<span class="ident" id="3285418">err</span>&nbsp;<span class="builtintype" id="3285422">error</span><span class="op" id="3285427">)</span>&nbsp;<span class="op" id="3285429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3285432">ip</span>&nbsp;<span class="op" id="3285435">:=</span>&nbsp;<span class="ident" id="3285438">ParseIP</span><span class="op" id="3285445">(</span><span class="ident" id="3285446">addr</span><span class="op" id="3285450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285453">if</span>&nbsp;<span class="ident" id="3285456">ip</span>&nbsp;<span class="op" id="3285459">==</span>&nbsp;<span class="ident" id="3285462">nil</span>&nbsp;<span class="op" id="3285466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285470">return</span>&nbsp;<span class="string" id="3285477">&#34;&#34;</span><span class="op" id="3285479">,</span>&nbsp;<span class="op" id="3285481">&amp;</span><span class="ident" id="3285482">DNSError</span><span class="op" id="3285490">{</span><span class="ident" id="3285491">Err</span><span class="op" id="3285494">:</span>&nbsp;<span class="string" id="3285496">&#34;unrecognized&nbsp;address&#34;</span><span class="op" id="3285518">,</span>&nbsp;<span class="ident" id="3285520">Name</span><span class="op" id="3285524">:</span>&nbsp;<span class="ident" id="3285526">addr</span><span class="op" id="3285530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285533">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285536">if</span>&nbsp;<span class="ident" id="3285539">ip</span><span class="op" id="3285541">.</span><span class="ident" id="3285542">To4</span><span class="op" id="3285545">(</span><span class="op" id="3285546">)</span>&nbsp;<span class="op" id="3285548">!=</span>&nbsp;<span class="ident" id="3285551">nil</span>&nbsp;<span class="op" id="3285555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285559">return</span>&nbsp;<span class="ident" id="3285566">itoa</span><span class="op" id="3285570">(</span><span class="builtintype" id="3285571">int</span><span class="op" id="3285574">(</span><span class="ident" id="3285575">ip</span><span class="op" id="3285577">[</span><span class="num" id="3285578">15</span><span class="op" id="3285580">]</span><span class="op" id="3285581">)</span><span class="op" id="3285582">)</span>&nbsp;<span class="op" id="3285584">+</span>&nbsp;<span class="string" id="3285586">&#34;.&#34;</span>&nbsp;<span class="op" id="3285590">+</span>&nbsp;<span class="ident" id="3285592">itoa</span><span class="op" id="3285596">(</span><span class="builtintype" id="3285597">int</span><span class="op" id="3285600">(</span><span class="ident" id="3285601">ip</span><span class="op" id="3285603">[</span><span class="num" id="3285604">14</span><span class="op" id="3285606">]</span><span class="op" id="3285607">)</span><span class="op" id="3285608">)</span>&nbsp;<span class="op" id="3285610">+</span>&nbsp;<span class="string" id="3285612">&#34;.&#34;</span>&nbsp;<span class="op" id="3285616">+</span>&nbsp;<span class="ident" id="3285618">itoa</span><span class="op" id="3285622">(</span><span class="builtintype" id="3285623">int</span><span class="op" id="3285626">(</span><span class="ident" id="3285627">ip</span><span class="op" id="3285629">[</span><span class="num" id="3285630">13</span><span class="op" id="3285632">]</span><span class="op" id="3285633">)</span><span class="op" id="3285634">)</span>&nbsp;<span class="op" id="3285636">+</span>&nbsp;<span class="string" id="3285638">&#34;.&#34;</span>&nbsp;<span class="op" id="3285642">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3285647">itoa</span><span class="op" id="3285651">(</span><span class="builtintype" id="3285652">int</span><span class="op" id="3285655">(</span><span class="ident" id="3285656">ip</span><span class="op" id="3285658">[</span><span class="num" id="3285659">12</span><span class="op" id="3285661">]</span><span class="op" id="3285662">)</span><span class="op" id="3285663">)</span>&nbsp;<span class="op" id="3285665">+</span>&nbsp;<span class="string" id="3285667">&#34;.in-addr.arpa.&#34;</span><span class="op" id="3285683">,</span>&nbsp;<span class="ident" id="3285685">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3285693">//&nbsp;Must&nbsp;be&nbsp;IPv6</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3285710">buf</span>&nbsp;<span class="op" id="3285714">:=</span>&nbsp;<span class="builtinfunc" id="3285717">make</span><span class="op" id="3285721">(</span><span class="op" id="3285722">[</span><span class="op" id="3285723">]</span><span class="builtintype" id="3285724">byte</span><span class="op" id="3285728">,</span>&nbsp;<span class="num" id="3285730">0</span><span class="op" id="3285731">,</span>&nbsp;<span class="builtinfunc" id="3285733">len</span><span class="op" id="3285736">(</span><span class="ident" id="3285737">ip</span><span class="op" id="3285739">)</span><span class="op" id="3285740">*</span><span class="num" id="3285741">4</span><span class="op" id="3285742">+</span><span class="builtinfunc" id="3285743">len</span><span class="op" id="3285746">(</span><span class="string" id="3285747">&#34;ip6.arpa.&#34;</span><span class="op" id="3285758">)</span><span class="op" id="3285759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3285762">//&nbsp;Add&nbsp;it,&nbsp;in&nbsp;reverse,&nbsp;to&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285800">for</span>&nbsp;<span class="ident" id="3285804">i</span>&nbsp;<span class="op" id="3285806">:=</span>&nbsp;<span class="builtinfunc" id="3285809">len</span><span class="op" id="3285812">(</span><span class="ident" id="3285813">ip</span><span class="op" id="3285815">)</span>&nbsp;<span class="op" id="3285817">-</span>&nbsp;<span class="num" id="3285819">1</span><span class="op" id="3285820">;</span>&nbsp;<span class="ident" id="3285822">i</span>&nbsp;<span class="op" id="3285824">&gt;=</span>&nbsp;<span class="num" id="3285827">0</span><span class="op" id="3285828">;</span>&nbsp;<span class="ident" id="3285830">i</span><span class="op" id="3285831">--</span>&nbsp;<span class="op" id="3285834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3285838">v</span>&nbsp;<span class="op" id="3285840">:=</span>&nbsp;<span class="ident" id="3285843">ip</span><span class="op" id="3285845">[</span><span class="ident" id="3285846">i</span><span class="op" id="3285847">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3285851">buf</span>&nbsp;<span class="op" id="3285855">=</span>&nbsp;<span class="builtinfunc" id="3285857">append</span><span class="op" id="3285863">(</span><span class="ident" id="3285864">buf</span><span class="op" id="3285867">,</span>&nbsp;<span class="ident" id="3285869">hexDigit</span><span class="op" id="3285877">[</span><span class="ident" id="3285878">v</span><span class="op" id="3285879">&amp;</span><span class="num" id="3285880">0xF</span><span class="op" id="3285883">]</span><span class="op" id="3285884">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3285888">buf</span>&nbsp;<span class="op" id="3285892">=</span>&nbsp;<span class="builtinfunc" id="3285894">append</span><span class="op" id="3285900">(</span><span class="ident" id="3285901">buf</span><span class="op" id="3285904">,</span>&nbsp;<span class="string" id="3285906">&#39;.&#39;</span><span class="op" id="3285909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3285913">buf</span>&nbsp;<span class="op" id="3285917">=</span>&nbsp;<span class="builtinfunc" id="3285919">append</span><span class="op" id="3285925">(</span><span class="ident" id="3285926">buf</span><span class="op" id="3285929">,</span>&nbsp;<span class="ident" id="3285931">hexDigit</span><span class="op" id="3285939">[</span><span class="ident" id="3285940">v</span><span class="op" id="3285941">&gt;&gt;</span><span class="num" id="3285943">4</span><span class="op" id="3285944">]</span><span class="op" id="3285945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3285949">buf</span>&nbsp;<span class="op" id="3285953">=</span>&nbsp;<span class="builtinfunc" id="3285955">append</span><span class="op" id="3285961">(</span><span class="ident" id="3285962">buf</span><span class="op" id="3285965">,</span>&nbsp;<span class="string" id="3285967">&#39;.&#39;</span><span class="op" id="3285970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3285976">//&nbsp;Append&nbsp;&#34;ip6.arpa.&#34;&nbsp;and&nbsp;return&nbsp;(buf&nbsp;already&nbsp;has&nbsp;the&nbsp;final&nbsp;.)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3286040">buf</span>&nbsp;<span class="op" id="3286044">=</span>&nbsp;<span class="builtinfunc" id="3286046">append</span><span class="op" id="3286052">(</span><span class="ident" id="3286053">buf</span><span class="op" id="3286056">,</span>&nbsp;<span class="string" id="3286058">&#34;ip6.arpa.&#34;</span><span class="op" id="3286069">...</span><span class="op" id="3286072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286075">return</span>&nbsp;<span class="builtintype" id="3286082">string</span><span class="op" id="3286088">(</span><span class="ident" id="3286089">buf</span><span class="op" id="3286092">)</span><span class="op" id="3286093">,</span>&nbsp;<span class="ident" id="3286095">nil</span><br>
<span class="lineno"></span><span class="op" id="3286099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3286102">//&nbsp;Find&nbsp;answer&nbsp;for&nbsp;name&nbsp;in&nbsp;dns&nbsp;message.</span><br>
<span class="lineno">65</span><span class="comment" id="3286142">//&nbsp;On&nbsp;return,&nbsp;if&nbsp;err&nbsp;==&nbsp;nil,&nbsp;addrs&nbsp;!=&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3286185">func</span>&nbsp;<span class="ident" id="3286190">answer</span><span class="op" id="3286196">(</span><span class="ident" id="3286197">name</span><span class="op" id="3286201">,</span>&nbsp;<span class="ident" id="3286203">server</span>&nbsp;<span class="builtintype" id="3286210">string</span><span class="op" id="3286216">,</span>&nbsp;<span class="ident" id="3286218">dns</span>&nbsp;<span class="op" id="3286222">*</span><span class="ident" id="3286223">dnsMsg</span><span class="op" id="3286229">,</span>&nbsp;<span class="ident" id="3286231">qtype</span>&nbsp;<span class="builtintype" id="3286237">uint16</span><span class="op" id="3286243">)</span>&nbsp;<span class="op" id="3286245">(</span><span class="ident" id="3286246">cname</span>&nbsp;<span class="builtintype" id="3286252">string</span><span class="op" id="3286258">,</span>&nbsp;<span class="ident" id="3286260">addrs</span>&nbsp;<span class="op" id="3286266">[</span><span class="op" id="3286267">]</span><span class="ident" id="3286268">dnsRR</span><span class="op" id="3286273">,</span>&nbsp;<span class="ident" id="3286275">err</span>&nbsp;<span class="builtintype" id="3286279">error</span><span class="op" id="3286284">)</span>&nbsp;<span class="op" id="3286286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3286289">addrs</span>&nbsp;<span class="op" id="3286295">=</span>&nbsp;<span class="builtinfunc" id="3286297">make</span><span class="op" id="3286301">(</span><span class="op" id="3286302">[</span><span class="op" id="3286303">]</span><span class="ident" id="3286304">dnsRR</span><span class="op" id="3286309">,</span>&nbsp;<span class="num" id="3286311">0</span><span class="op" id="3286312">,</span>&nbsp;<span class="builtinfunc" id="3286314">len</span><span class="op" id="3286317">(</span><span class="ident" id="3286318">dns</span><span class="op" id="3286321">.</span><span class="ident" id="3286322">answer</span><span class="op" id="3286328">)</span><span class="op" id="3286329">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286333">if</span>&nbsp;<span class="ident" id="3286336">dns</span><span class="op" id="3286339">.</span><span class="ident" id="3286340">rcode</span>&nbsp;<span class="op" id="3286346">==</span>&nbsp;<span class="ident" id="3286349">dnsRcodeNameError</span>&nbsp;<span class="op" id="3286367">&amp;&amp;</span>&nbsp;<span class="ident" id="3286370">dns</span><span class="op" id="3286373">.</span><span class="ident" id="3286374">recursion_available</span>&nbsp;<span class="op" id="3286394">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286398">return</span>&nbsp;<span class="string" id="3286405">&#34;&#34;</span><span class="op" id="3286407">,</span>&nbsp;<span class="ident" id="3286409">nil</span><span class="op" id="3286412">,</span>&nbsp;<span class="op" id="3286414">&amp;</span><span class="ident" id="3286415">DNSError</span><span class="op" id="3286423">{</span><span class="ident" id="3286424">Err</span><span class="op" id="3286427">:</span>&nbsp;<span class="ident" id="3286429">noSuchHost</span><span class="op" id="3286439">,</span>&nbsp;<span class="ident" id="3286441">Name</span><span class="op" id="3286445">:</span>&nbsp;<span class="ident" id="3286447">name</span><span class="op" id="3286451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3286454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286457">if</span>&nbsp;<span class="ident" id="3286460">dns</span><span class="op" id="3286463">.</span><span class="ident" id="3286464">rcode</span>&nbsp;<span class="op" id="3286470">!=</span>&nbsp;<span class="ident" id="3286473">dnsRcodeSuccess</span>&nbsp;<span class="op" id="3286489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3286493">//&nbsp;None&nbsp;of&nbsp;the&nbsp;error&nbsp;codes&nbsp;make&nbsp;sense</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3286533">//&nbsp;for&nbsp;the&nbsp;query&nbsp;we&nbsp;sent.&nbsp;&nbsp;If&nbsp;we&nbsp;didn&#39;t&nbsp;get</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3286579">//&nbsp;a&nbsp;name&nbsp;error&nbsp;and&nbsp;we&nbsp;didn&#39;t&nbsp;get&nbsp;success,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3286624">//&nbsp;the&nbsp;server&nbsp;is&nbsp;behaving&nbsp;incorrectly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286665">return</span>&nbsp;<span class="string" id="3286672">&#34;&#34;</span><span class="op" id="3286674">,</span>&nbsp;<span class="ident" id="3286676">nil</span><span class="op" id="3286679">,</span>&nbsp;<span class="op" id="3286681">&amp;</span><span class="ident" id="3286682">DNSError</span><span class="op" id="3286690">{</span><span class="ident" id="3286691">Err</span><span class="op" id="3286694">:</span>&nbsp;<span class="string" id="3286696">&#34;server&nbsp;misbehaving&#34;</span><span class="op" id="3286716">,</span>&nbsp;<span class="ident" id="3286718">Name</span><span class="op" id="3286722">:</span>&nbsp;<span class="ident" id="3286724">name</span><span class="op" id="3286728">,</span>&nbsp;<span class="ident" id="3286730">Server</span><span class="op" id="3286736">:</span>&nbsp;<span class="ident" id="3286738">server</span><span class="op" id="3286744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3286747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3286751">//&nbsp;Look&nbsp;for&nbsp;the&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3286774">//&nbsp;Presotto&nbsp;says&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;assume&nbsp;that&nbsp;servers&nbsp;listed&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3286835">//&nbsp;/etc/resolv.conf&nbsp;are&nbsp;recursive&nbsp;resolvers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3286881">//&nbsp;We&nbsp;asked&nbsp;for&nbsp;recursion,&nbsp;so&nbsp;it&nbsp;should&nbsp;have&nbsp;included</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3286936">//&nbsp;all&nbsp;the&nbsp;answers&nbsp;we&nbsp;need&nbsp;in&nbsp;this&nbsp;one&nbsp;packet.</span><br>
<span class="lineno">85</span><span class="ident" id="3286983">Cname</span><span class="op" id="3286988">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286991">for</span>&nbsp;<span class="ident" id="3286995">cnameloop</span>&nbsp;<span class="op" id="3287005">:=</span>&nbsp;<span class="num" id="3287008">0</span><span class="op" id="3287009">;</span>&nbsp;<span class="ident" id="3287011">cnameloop</span>&nbsp;<span class="op" id="3287021">&lt;</span>&nbsp;<span class="num" id="3287023">10</span><span class="op" id="3287025">;</span>&nbsp;<span class="ident" id="3287027">cnameloop</span><span class="op" id="3287036">++</span>&nbsp;<span class="op" id="3287039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3287043">addrs</span>&nbsp;<span class="op" id="3287049">=</span>&nbsp;<span class="ident" id="3287051">addrs</span><span class="op" id="3287056">[</span><span class="num" id="3287057">0</span><span class="op" id="3287058">:</span><span class="num" id="3287059">0</span><span class="op" id="3287060">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287064">for</span>&nbsp;<span class="ident" id="3287068">_</span><span class="op" id="3287069">,</span>&nbsp;<span class="ident" id="3287071">rr</span>&nbsp;<span class="op" id="3287074">:=</span>&nbsp;<span class="keyword" id="3287077">range</span>&nbsp;<span class="ident" id="3287083">dns</span><span class="op" id="3287086">.</span><span class="ident" id="3287087">answer</span>&nbsp;<span class="op" id="3287094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287099">if</span>&nbsp;<span class="ident" id="3287102">_</span><span class="op" id="3287103">,</span>&nbsp;<span class="ident" id="3287105">justHeader</span>&nbsp;<span class="op" id="3287116">:=</span>&nbsp;<span class="ident" id="3287119">rr</span><span class="op" id="3287121">.</span><span class="op" id="3287122">(</span><span class="op" id="3287123">*</span><span class="ident" id="3287124">dnsRR_Header</span><span class="op" id="3287136">)</span><span class="op" id="3287137">;</span>&nbsp;<span class="ident" id="3287139">justHeader</span>&nbsp;<span class="op" id="3287150">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3287156">//&nbsp;Corrupt&nbsp;record:&nbsp;we&nbsp;only&nbsp;have&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3287194">//&nbsp;header.&nbsp;That&nbsp;header&nbsp;might&nbsp;say&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3287236">//&nbsp;of&nbsp;type&nbsp;qtype,&nbsp;but&nbsp;we&nbsp;don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3287271">//&nbsp;actually&nbsp;have&nbsp;it.&nbsp;Skip.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287302">continue</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3287314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3287319">h</span>&nbsp;<span class="op" id="3287321">:=</span>&nbsp;<span class="ident" id="3287324">rr</span><span class="op" id="3287326">.</span><span class="ident" id="3287327">Header</span><span class="op" id="3287333">(</span><span class="op" id="3287334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287339">if</span>&nbsp;<span class="ident" id="3287342">h</span><span class="op" id="3287343">.</span><span class="ident" id="3287344">Class</span>&nbsp;<span class="op" id="3287350">==</span>&nbsp;<span class="ident" id="3287353">dnsClassINET</span>&nbsp;<span class="op" id="3287366">&amp;&amp;</span>&nbsp;<span class="ident" id="3287369">h</span><span class="op" id="3287370">.</span><span class="ident" id="3287371">Name</span>&nbsp;<span class="op" id="3287376">==</span>&nbsp;<span class="ident" id="3287379">name</span>&nbsp;<span class="op" id="3287384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287390">switch</span>&nbsp;<span class="ident" id="3287397">h</span><span class="op" id="3287398">.</span><span class="ident" id="3287399">Rrtype</span>&nbsp;<span class="op" id="3287406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287412">case</span>&nbsp;<span class="ident" id="3287417">qtype</span><span class="op" id="3287422">:</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3287429">addrs</span>&nbsp;<span class="op" id="3287435">=</span>&nbsp;<span class="builtinfunc" id="3287437">append</span><span class="op" id="3287443">(</span><span class="ident" id="3287444">addrs</span><span class="op" id="3287449">,</span>&nbsp;<span class="ident" id="3287451">rr</span><span class="op" id="3287453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287459">case</span>&nbsp;<span class="ident" id="3287464">dnsTypeCNAME</span><span class="op" id="3287476">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3287483">//&nbsp;redirect&nbsp;to&nbsp;cname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3287509">name</span>&nbsp;<span class="op" id="3287514">=</span>&nbsp;<span class="ident" id="3287516">rr</span><span class="op" id="3287518">.</span><span class="op" id="3287519">(</span><span class="op" id="3287520">*</span><span class="ident" id="3287521">dnsRR_CNAME</span><span class="op" id="3287532">)</span><span class="op" id="3287533">.</span><span class="ident" id="3287534">Cname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287545">continue</span>&nbsp;<span class="ident" id="3287554">Cname</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3287564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3287569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3287573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287577">if</span>&nbsp;<span class="builtinfunc" id="3287580">len</span><span class="op" id="3287583">(</span><span class="ident" id="3287584">addrs</span><span class="op" id="3287589">)</span>&nbsp;<span class="op" id="3287591">==</span>&nbsp;<span class="num" id="3287594">0</span>&nbsp;<span class="op" id="3287596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287601">return</span>&nbsp;<span class="string" id="3287608">&#34;&#34;</span><span class="op" id="3287610">,</span>&nbsp;<span class="ident" id="3287612">nil</span><span class="op" id="3287615">,</span>&nbsp;<span class="op" id="3287617">&amp;</span><span class="ident" id="3287618">DNSError</span><span class="op" id="3287626">{</span><span class="ident" id="3287627">Err</span><span class="op" id="3287630">:</span>&nbsp;<span class="ident" id="3287632">noSuchHost</span><span class="op" id="3287642">,</span>&nbsp;<span class="ident" id="3287644">Name</span><span class="op" id="3287648">:</span>&nbsp;<span class="ident" id="3287650">name</span><span class="op" id="3287654">,</span>&nbsp;<span class="ident" id="3287656">Server</span><span class="op" id="3287662">:</span>&nbsp;<span class="ident" id="3287664">server</span><span class="op" id="3287670">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3287674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287678">return</span>&nbsp;<span class="ident" id="3287685">name</span><span class="op" id="3287689">,</span>&nbsp;<span class="ident" id="3287691">addrs</span><span class="op" id="3287696">,</span>&nbsp;<span class="ident" id="3287698">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3287703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287707">return</span>&nbsp;<span class="string" id="3287714">&#34;&#34;</span><span class="op" id="3287716">,</span>&nbsp;<span class="ident" id="3287718">nil</span><span class="op" id="3287721">,</span>&nbsp;<span class="op" id="3287723">&amp;</span><span class="ident" id="3287724">DNSError</span><span class="op" id="3287732">{</span><span class="ident" id="3287733">Err</span><span class="op" id="3287736">:</span>&nbsp;<span class="string" id="3287738">&#34;too&nbsp;many&nbsp;redirects&#34;</span><span class="op" id="3287758">,</span>&nbsp;<span class="ident" id="3287760">Name</span><span class="op" id="3287764">:</span>&nbsp;<span class="ident" id="3287766">name</span><span class="op" id="3287770">,</span>&nbsp;<span class="ident" id="3287772">Server</span><span class="op" id="3287778">:</span>&nbsp;<span class="ident" id="3287780">server</span><span class="op" id="3287786">}</span><br>
<span class="lineno">115</span><span class="op" id="3287788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3287791">func</span>&nbsp;<span class="ident" id="3287796">isDomainName</span><span class="op" id="3287808">(</span><span class="ident" id="3287809">s</span>&nbsp;<span class="builtintype" id="3287811">string</span><span class="op" id="3287817">)</span>&nbsp;<span class="builtintype" id="3287819">bool</span>&nbsp;<span class="op" id="3287824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3287827">//&nbsp;See&nbsp;RFC&nbsp;1035,&nbsp;RFC&nbsp;3696.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287855">if</span>&nbsp;<span class="builtinfunc" id="3287858">len</span><span class="op" id="3287861">(</span><span class="ident" id="3287862">s</span><span class="op" id="3287863">)</span>&nbsp;<span class="op" id="3287865">==</span>&nbsp;<span class="num" id="3287868">0</span>&nbsp;<span class="op" id="3287870">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287874">return</span>&nbsp;<span class="ident" id="3287881">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3287888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287891">if</span>&nbsp;<span class="builtinfunc" id="3287894">len</span><span class="op" id="3287897">(</span><span class="ident" id="3287898">s</span><span class="op" id="3287899">)</span>&nbsp;<span class="op" id="3287901">&gt;</span>&nbsp;<span class="num" id="3287903">255</span>&nbsp;<span class="op" id="3287907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287911">return</span>&nbsp;<span class="ident" id="3287918">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3287925">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3287929">last</span>&nbsp;<span class="op" id="3287934">:=</span>&nbsp;<span class="builtintype" id="3287937">byte</span><span class="op" id="3287941">(</span><span class="string" id="3287942">&#39;.&#39;</span><span class="op" id="3287945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3287948">ok</span>&nbsp;<span class="op" id="3287951">:=</span>&nbsp;<span class="ident" id="3287954">false</span>&nbsp;<span class="comment" id="3287960">//&nbsp;Ok&nbsp;once&nbsp;we&#39;ve&nbsp;seen&nbsp;a&nbsp;letter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3287993">partlen</span>&nbsp;<span class="op" id="3288001">:=</span>&nbsp;<span class="num" id="3288004">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288007">for</span>&nbsp;<span class="ident" id="3288011">i</span>&nbsp;<span class="op" id="3288013">:=</span>&nbsp;<span class="num" id="3288016">0</span><span class="op" id="3288017">;</span>&nbsp;<span class="ident" id="3288019">i</span>&nbsp;<span class="op" id="3288021">&lt;</span>&nbsp;<span class="builtinfunc" id="3288023">len</span><span class="op" id="3288026">(</span><span class="ident" id="3288027">s</span><span class="op" id="3288028">)</span><span class="op" id="3288029">;</span>&nbsp;<span class="ident" id="3288031">i</span><span class="op" id="3288032">++</span>&nbsp;<span class="op" id="3288035">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3288039">c</span>&nbsp;<span class="op" id="3288041">:=</span>&nbsp;<span class="ident" id="3288044">s</span><span class="op" id="3288045">[</span><span class="ident" id="3288046">i</span><span class="op" id="3288047">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288051">switch</span>&nbsp;<span class="op" id="3288058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288062">default</span><span class="op" id="3288069">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288074">return</span>&nbsp;<span class="ident" id="3288081">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288089">case</span>&nbsp;<span class="string" id="3288094">&#39;a&#39;</span>&nbsp;<span class="op" id="3288098">&lt;=</span>&nbsp;<span class="ident" id="3288101">c</span>&nbsp;<span class="op" id="3288103">&amp;&amp;</span>&nbsp;<span class="ident" id="3288106">c</span>&nbsp;<span class="op" id="3288108">&lt;=</span>&nbsp;<span class="string" id="3288111">&#39;z&#39;</span>&nbsp;<span class="op" id="3288115">||</span>&nbsp;<span class="string" id="3288118">&#39;A&#39;</span>&nbsp;<span class="op" id="3288122">&lt;=</span>&nbsp;<span class="ident" id="3288125">c</span>&nbsp;<span class="op" id="3288127">&amp;&amp;</span>&nbsp;<span class="ident" id="3288130">c</span>&nbsp;<span class="op" id="3288132">&lt;=</span>&nbsp;<span class="string" id="3288135">&#39;Z&#39;</span>&nbsp;<span class="op" id="3288139">||</span>&nbsp;<span class="ident" id="3288142">c</span>&nbsp;<span class="op" id="3288144">==</span>&nbsp;<span class="string" id="3288147">&#39;_&#39;</span><span class="op" id="3288150">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3288155">ok</span>&nbsp;<span class="op" id="3288158">=</span>&nbsp;<span class="ident" id="3288160">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3288168">partlen</span><span class="op" id="3288175">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288180">case</span>&nbsp;<span class="string" id="3288185">&#39;0&#39;</span>&nbsp;<span class="op" id="3288189">&lt;=</span>&nbsp;<span class="ident" id="3288192">c</span>&nbsp;<span class="op" id="3288194">&amp;&amp;</span>&nbsp;<span class="ident" id="3288197">c</span>&nbsp;<span class="op" id="3288199">&lt;=</span>&nbsp;<span class="string" id="3288202">&#39;9&#39;</span><span class="op" id="3288205">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3288210">//&nbsp;fine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3288221">partlen</span><span class="op" id="3288228">++</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288233">case</span>&nbsp;<span class="ident" id="3288238">c</span>&nbsp;<span class="op" id="3288240">==</span>&nbsp;<span class="string" id="3288243">&#39;-&#39;</span><span class="op" id="3288246">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3288251">//&nbsp;Byte&nbsp;before&nbsp;dash&nbsp;cannot&nbsp;be&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288289">if</span>&nbsp;<span class="ident" id="3288292">last</span>&nbsp;<span class="op" id="3288297">==</span>&nbsp;<span class="string" id="3288300">&#39;.&#39;</span>&nbsp;<span class="op" id="3288304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288310">return</span>&nbsp;<span class="ident" id="3288317">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3288326">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3288331">partlen</span><span class="op" id="3288338">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288343">case</span>&nbsp;<span class="ident" id="3288348">c</span>&nbsp;<span class="op" id="3288350">==</span>&nbsp;<span class="string" id="3288353">&#39;.&#39;</span><span class="op" id="3288356">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3288361">//&nbsp;Byte&nbsp;before&nbsp;dot&nbsp;cannot&nbsp;be&nbsp;dot,&nbsp;dash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288404">if</span>&nbsp;<span class="ident" id="3288407">last</span>&nbsp;<span class="op" id="3288412">==</span>&nbsp;<span class="string" id="3288415">&#39;.&#39;</span>&nbsp;<span class="op" id="3288419">||</span>&nbsp;<span class="ident" id="3288422">last</span>&nbsp;<span class="op" id="3288427">==</span>&nbsp;<span class="string" id="3288430">&#39;-&#39;</span>&nbsp;<span class="op" id="3288434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288440">return</span>&nbsp;<span class="ident" id="3288447">false</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3288456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288461">if</span>&nbsp;<span class="ident" id="3288464">partlen</span>&nbsp;<span class="op" id="3288472">&gt;</span>&nbsp;<span class="num" id="3288474">63</span>&nbsp;<span class="op" id="3288477">||</span>&nbsp;<span class="ident" id="3288480">partlen</span>&nbsp;<span class="op" id="3288488">==</span>&nbsp;<span class="num" id="3288491">0</span>&nbsp;<span class="op" id="3288493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288499">return</span>&nbsp;<span class="ident" id="3288506">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3288515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3288520">partlen</span>&nbsp;<span class="op" id="3288528">=</span>&nbsp;<span class="num" id="3288530">0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3288534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3288538">last</span>&nbsp;<span class="op" id="3288543">=</span>&nbsp;<span class="ident" id="3288545">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3288548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288551">if</span>&nbsp;<span class="ident" id="3288554">last</span>&nbsp;<span class="op" id="3288559">==</span>&nbsp;<span class="string" id="3288562">&#39;-&#39;</span>&nbsp;<span class="op" id="3288566">||</span>&nbsp;<span class="ident" id="3288569">partlen</span>&nbsp;<span class="op" id="3288577">&gt;</span>&nbsp;<span class="num" id="3288579">63</span>&nbsp;<span class="op" id="3288582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288586">return</span>&nbsp;<span class="ident" id="3288593">false</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3288600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288604">return</span>&nbsp;<span class="ident" id="3288611">ok</span><br>
<span class="lineno"></span><span class="op" id="3288614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3288617">//&nbsp;An&nbsp;SRV&nbsp;represents&nbsp;a&nbsp;single&nbsp;DNS&nbsp;SRV&nbsp;record.</span><br>
<span class="lineno"></span><span class="keyword" id="3288663">type</span>&nbsp;<span class="ident" id="3288668">SRV</span>&nbsp;<span class="keyword" id="3288672">struct</span>&nbsp;<span class="op" id="3288679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3288682">Target</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3288691">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3288699">Port</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3288708">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3288716">Priority</span>&nbsp;<span class="builtintype" id="3288725">uint16</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3288733">Weight</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3288742">uint16</span><br>
<span class="lineno"></span><span class="op" id="3288749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3288752">//&nbsp;byPriorityWeight&nbsp;sorts&nbsp;SRV&nbsp;records&nbsp;by&nbsp;ascending&nbsp;priority&nbsp;and&nbsp;weight.</span><br>
<span class="lineno"></span><span class="keyword" id="3288824">type</span>&nbsp;<span class="ident" id="3288829">byPriorityWeight</span>&nbsp;<span class="op" id="3288846">[</span><span class="op" id="3288847">]</span><span class="op" id="3288848">*</span><span class="ident" id="3288849">SRV</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="keyword" id="3288854">func</span>&nbsp;<span class="op" id="3288859">(</span><span class="ident" id="3288860">s</span>&nbsp;<span class="ident" id="3288862">byPriorityWeight</span><span class="op" id="3288878">)</span>&nbsp;<span class="ident" id="3288880">Len</span><span class="op" id="3288883">(</span><span class="op" id="3288884">)</span>&nbsp;<span class="builtintype" id="3288886">int</span>&nbsp;<span class="op" id="3288890">{</span>&nbsp;<span class="keyword" id="3288892">return</span>&nbsp;<span class="builtinfunc" id="3288899">len</span><span class="op" id="3288902">(</span><span class="ident" id="3288903">s</span><span class="op" id="3288904">)</span>&nbsp;<span class="op" id="3288906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3288909">func</span>&nbsp;<span class="op" id="3288914">(</span><span class="ident" id="3288915">s</span>&nbsp;<span class="ident" id="3288917">byPriorityWeight</span><span class="op" id="3288933">)</span>&nbsp;<span class="ident" id="3288935">Swap</span><span class="op" id="3288939">(</span><span class="ident" id="3288940">i</span><span class="op" id="3288941">,</span>&nbsp;<span class="ident" id="3288943">j</span>&nbsp;<span class="builtintype" id="3288945">int</span><span class="op" id="3288948">)</span>&nbsp;<span class="op" id="3288950">{</span>&nbsp;<span class="ident" id="3288952">s</span><span class="op" id="3288953">[</span><span class="ident" id="3288954">i</span><span class="op" id="3288955">]</span><span class="op" id="3288956">,</span>&nbsp;<span class="ident" id="3288958">s</span><span class="op" id="3288959">[</span><span class="ident" id="3288960">j</span><span class="op" id="3288961">]</span>&nbsp;<span class="op" id="3288963">=</span>&nbsp;<span class="ident" id="3288965">s</span><span class="op" id="3288966">[</span><span class="ident" id="3288967">j</span><span class="op" id="3288968">]</span><span class="op" id="3288969">,</span>&nbsp;<span class="ident" id="3288971">s</span><span class="op" id="3288972">[</span><span class="ident" id="3288973">i</span><span class="op" id="3288974">]</span>&nbsp;<span class="op" id="3288976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="3288979">func</span>&nbsp;<span class="op" id="3288984">(</span><span class="ident" id="3288985">s</span>&nbsp;<span class="ident" id="3288987">byPriorityWeight</span><span class="op" id="3289003">)</span>&nbsp;<span class="ident" id="3289005">Less</span><span class="op" id="3289009">(</span><span class="ident" id="3289010">i</span><span class="op" id="3289011">,</span>&nbsp;<span class="ident" id="3289013">j</span>&nbsp;<span class="builtintype" id="3289015">int</span><span class="op" id="3289018">)</span>&nbsp;<span class="builtintype" id="3289020">bool</span>&nbsp;<span class="op" id="3289025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289028">return</span>&nbsp;<span class="ident" id="3289035">s</span><span class="op" id="3289036">[</span><span class="ident" id="3289037">i</span><span class="op" id="3289038">]</span><span class="op" id="3289039">.</span><span class="ident" id="3289040">Priority</span>&nbsp;<span class="op" id="3289049">&lt;</span>&nbsp;<span class="ident" id="3289051">s</span><span class="op" id="3289052">[</span><span class="ident" id="3289053">j</span><span class="op" id="3289054">]</span><span class="op" id="3289055">.</span><span class="ident" id="3289056">Priority</span>&nbsp;<span class="op" id="3289065">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3289070">(</span><span class="ident" id="3289071">s</span><span class="op" id="3289072">[</span><span class="ident" id="3289073">i</span><span class="op" id="3289074">]</span><span class="op" id="3289075">.</span><span class="ident" id="3289076">Priority</span>&nbsp;<span class="op" id="3289085">==</span>&nbsp;<span class="ident" id="3289088">s</span><span class="op" id="3289089">[</span><span class="ident" id="3289090">j</span><span class="op" id="3289091">]</span><span class="op" id="3289092">.</span><span class="ident" id="3289093">Priority</span>&nbsp;<span class="op" id="3289102">&amp;&amp;</span>&nbsp;<span class="ident" id="3289105">s</span><span class="op" id="3289106">[</span><span class="ident" id="3289107">i</span><span class="op" id="3289108">]</span><span class="op" id="3289109">.</span><span class="ident" id="3289110">Weight</span>&nbsp;<span class="op" id="3289117">&lt;</span>&nbsp;<span class="ident" id="3289119">s</span><span class="op" id="3289120">[</span><span class="ident" id="3289121">j</span><span class="op" id="3289122">]</span><span class="op" id="3289123">.</span><span class="ident" id="3289124">Weight</span><span class="op" id="3289130">)</span><br>
<span class="lineno"></span><span class="op" id="3289132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="3289135">//&nbsp;shuffleByWeight&nbsp;shuffles&nbsp;SRV&nbsp;records&nbsp;by&nbsp;weight&nbsp;using&nbsp;the&nbsp;algorithm</span><br>
<span class="lineno"></span><span class="comment" id="3289205">//&nbsp;described&nbsp;in&nbsp;RFC&nbsp;2782.</span><br>
<span class="lineno"></span><span class="keyword" id="3289231">func</span>&nbsp;<span class="op" id="3289236">(</span><span class="ident" id="3289237">addrs</span>&nbsp;<span class="ident" id="3289243">byPriorityWeight</span><span class="op" id="3289259">)</span>&nbsp;<span class="ident" id="3289261">shuffleByWeight</span><span class="op" id="3289276">(</span><span class="op" id="3289277">)</span>&nbsp;<span class="op" id="3289279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289282">sum</span>&nbsp;<span class="op" id="3289286">:=</span>&nbsp;<span class="num" id="3289289">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289292">for</span>&nbsp;<span class="ident" id="3289296">_</span><span class="op" id="3289297">,</span>&nbsp;<span class="ident" id="3289299">addr</span>&nbsp;<span class="op" id="3289304">:=</span>&nbsp;<span class="keyword" id="3289307">range</span>&nbsp;<span class="ident" id="3289313">addrs</span>&nbsp;<span class="op" id="3289319">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289323">sum</span>&nbsp;<span class="op" id="3289327">+=</span>&nbsp;<span class="builtintype" id="3289330">int</span><span class="op" id="3289333">(</span><span class="ident" id="3289334">addr</span><span class="op" id="3289338">.</span><span class="ident" id="3289339">Weight</span><span class="op" id="3289345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3289348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289351">for</span>&nbsp;<span class="ident" id="3289355">sum</span>&nbsp;<span class="op" id="3289359">&gt;</span>&nbsp;<span class="num" id="3289361">0</span>&nbsp;<span class="op" id="3289363">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3289366">len</span><span class="op" id="3289369">(</span><span class="ident" id="3289370">addrs</span><span class="op" id="3289375">)</span>&nbsp;<span class="op" id="3289377">&gt;</span>&nbsp;<span class="num" id="3289379">1</span>&nbsp;<span class="op" id="3289381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289385">s</span>&nbsp;<span class="op" id="3289387">:=</span>&nbsp;<span class="num" id="3289390">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289394">n</span>&nbsp;<span class="op" id="3289396">:=</span>&nbsp;<span class="ident" id="3289399">rand</span><span class="op" id="3289403">.</span><span class="ident" id="3289404">Intn</span><span class="op" id="3289408">(</span><span class="ident" id="3289409">sum</span><span class="op" id="3289412">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289416">for</span>&nbsp;<span class="ident" id="3289420">i</span>&nbsp;<span class="op" id="3289422">:=</span>&nbsp;<span class="keyword" id="3289425">range</span>&nbsp;<span class="ident" id="3289431">addrs</span>&nbsp;<span class="op" id="3289437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289442">s</span>&nbsp;<span class="op" id="3289444">+=</span>&nbsp;<span class="builtintype" id="3289447">int</span><span class="op" id="3289450">(</span><span class="ident" id="3289451">addrs</span><span class="op" id="3289456">[</span><span class="ident" id="3289457">i</span><span class="op" id="3289458">]</span><span class="op" id="3289459">.</span><span class="ident" id="3289460">Weight</span><span class="op" id="3289466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289471">if</span>&nbsp;<span class="ident" id="3289474">s</span>&nbsp;<span class="op" id="3289476">&gt;</span>&nbsp;<span class="ident" id="3289478">n</span>&nbsp;<span class="op" id="3289480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289486">if</span>&nbsp;<span class="ident" id="3289489">i</span>&nbsp;<span class="op" id="3289491">&gt;</span>&nbsp;<span class="num" id="3289493">0</span>&nbsp;<span class="op" id="3289495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289502">addrs</span><span class="op" id="3289507">[</span><span class="num" id="3289508">0</span><span class="op" id="3289509">]</span><span class="op" id="3289510">,</span>&nbsp;<span class="ident" id="3289512">addrs</span><span class="op" id="3289517">[</span><span class="ident" id="3289518">i</span><span class="op" id="3289519">]</span>&nbsp;<span class="op" id="3289521">=</span>&nbsp;<span class="ident" id="3289523">addrs</span><span class="op" id="3289528">[</span><span class="ident" id="3289529">i</span><span class="op" id="3289530">]</span><span class="op" id="3289531">,</span>&nbsp;<span class="ident" id="3289533">addrs</span><span class="op" id="3289538">[</span><span class="num" id="3289539">0</span><span class="op" id="3289540">]</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3289546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289552">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3289561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3289565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289569">sum</span>&nbsp;<span class="op" id="3289573">-=</span>&nbsp;<span class="builtintype" id="3289576">int</span><span class="op" id="3289579">(</span><span class="ident" id="3289580">addrs</span><span class="op" id="3289585">[</span><span class="num" id="3289586">0</span><span class="op" id="3289587">]</span><span class="op" id="3289588">.</span><span class="ident" id="3289589">Weight</span><span class="op" id="3289595">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289599">addrs</span>&nbsp;<span class="op" id="3289605">=</span>&nbsp;<span class="ident" id="3289607">addrs</span><span class="op" id="3289612">[</span><span class="num" id="3289613">1</span><span class="op" id="3289614">:</span><span class="op" id="3289615">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3289618">}</span><br>
<span class="lineno"></span><span class="op" id="3289620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3289623">//&nbsp;sort&nbsp;reorders&nbsp;SRV&nbsp;records&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;2782.</span><br>
<span class="lineno">210</span><span class="keyword" id="3289678">func</span>&nbsp;<span class="op" id="3289683">(</span><span class="ident" id="3289684">addrs</span>&nbsp;<span class="ident" id="3289690">byPriorityWeight</span><span class="op" id="3289706">)</span>&nbsp;<span class="ident" id="3289708">sort</span><span class="op" id="3289712">(</span><span class="op" id="3289713">)</span>&nbsp;<span class="op" id="3289715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289718">sort</span><span class="op" id="3289722">.</span><span class="ident" id="3289723">Sort</span><span class="op" id="3289727">(</span><span class="ident" id="3289728">addrs</span><span class="op" id="3289733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289736">i</span>&nbsp;<span class="op" id="3289738">:=</span>&nbsp;<span class="num" id="3289741">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289744">for</span>&nbsp;<span class="ident" id="3289748">j</span>&nbsp;<span class="op" id="3289750">:=</span>&nbsp;<span class="num" id="3289753">1</span><span class="op" id="3289754">;</span>&nbsp;<span class="ident" id="3289756">j</span>&nbsp;<span class="op" id="3289758">&lt;</span>&nbsp;<span class="builtinfunc" id="3289760">len</span><span class="op" id="3289763">(</span><span class="ident" id="3289764">addrs</span><span class="op" id="3289769">)</span><span class="op" id="3289770">;</span>&nbsp;<span class="ident" id="3289772">j</span><span class="op" id="3289773">++</span>&nbsp;<span class="op" id="3289776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289780">if</span>&nbsp;<span class="ident" id="3289783">addrs</span><span class="op" id="3289788">[</span><span class="ident" id="3289789">i</span><span class="op" id="3289790">]</span><span class="op" id="3289791">.</span><span class="ident" id="3289792">Priority</span>&nbsp;<span class="op" id="3289801">!=</span>&nbsp;<span class="ident" id="3289804">addrs</span><span class="op" id="3289809">[</span><span class="ident" id="3289810">j</span><span class="op" id="3289811">]</span><span class="op" id="3289812">.</span><span class="ident" id="3289813">Priority</span>&nbsp;<span class="op" id="3289822">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289827">addrs</span><span class="op" id="3289832">[</span><span class="ident" id="3289833">i</span><span class="op" id="3289834">:</span><span class="ident" id="3289835">j</span><span class="op" id="3289836">]</span><span class="op" id="3289837">.</span><span class="ident" id="3289838">shuffleByWeight</span><span class="op" id="3289853">(</span><span class="op" id="3289854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289859">i</span>&nbsp;<span class="op" id="3289861">=</span>&nbsp;<span class="ident" id="3289863">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3289867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3289870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289873">addrs</span><span class="op" id="3289878">[</span><span class="ident" id="3289879">i</span><span class="op" id="3289880">:</span><span class="op" id="3289881">]</span><span class="op" id="3289882">.</span><span class="ident" id="3289883">shuffleByWeight</span><span class="op" id="3289898">(</span><span class="op" id="3289899">)</span><br>
<span class="lineno">220</span><span class="op" id="3289901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3289904">//&nbsp;An&nbsp;MX&nbsp;represents&nbsp;a&nbsp;single&nbsp;DNS&nbsp;MX&nbsp;record.</span><br>
<span class="lineno"></span><span class="keyword" id="3289948">type</span>&nbsp;<span class="ident" id="3289953">MX</span>&nbsp;<span class="keyword" id="3289956">struct</span>&nbsp;<span class="op" id="3289963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289966">Host</span>&nbsp;<span class="builtintype" id="3289971">string</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289979">Pref</span>&nbsp;<span class="builtintype" id="3289984">uint16</span><br>
<span class="lineno"></span><span class="op" id="3289991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3289994">//&nbsp;byPref&nbsp;implements&nbsp;sort.Interface&nbsp;to&nbsp;sort&nbsp;MX&nbsp;records&nbsp;by&nbsp;preference</span><br>
<span class="lineno"></span><span class="keyword" id="3290063">type</span>&nbsp;<span class="ident" id="3290068">byPref</span>&nbsp;<span class="op" id="3290075">[</span><span class="op" id="3290076">]</span><span class="op" id="3290077">*</span><span class="ident" id="3290078">MX</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="3290082">func</span>&nbsp;<span class="op" id="3290087">(</span><span class="ident" id="3290088">s</span>&nbsp;<span class="ident" id="3290090">byPref</span><span class="op" id="3290096">)</span>&nbsp;<span class="ident" id="3290098">Len</span><span class="op" id="3290101">(</span><span class="op" id="3290102">)</span>&nbsp;<span class="builtintype" id="3290104">int</span>&nbsp;<span class="op" id="3290108">{</span>&nbsp;<span class="keyword" id="3290110">return</span>&nbsp;<span class="builtinfunc" id="3290117">len</span><span class="op" id="3290120">(</span><span class="ident" id="3290121">s</span><span class="op" id="3290122">)</span>&nbsp;<span class="op" id="3290124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3290127">func</span>&nbsp;<span class="op" id="3290132">(</span><span class="ident" id="3290133">s</span>&nbsp;<span class="ident" id="3290135">byPref</span><span class="op" id="3290141">)</span>&nbsp;<span class="ident" id="3290143">Less</span><span class="op" id="3290147">(</span><span class="ident" id="3290148">i</span><span class="op" id="3290149">,</span>&nbsp;<span class="ident" id="3290151">j</span>&nbsp;<span class="builtintype" id="3290153">int</span><span class="op" id="3290156">)</span>&nbsp;<span class="builtintype" id="3290158">bool</span>&nbsp;<span class="op" id="3290163">{</span>&nbsp;<span class="keyword" id="3290165">return</span>&nbsp;<span class="ident" id="3290172">s</span><span class="op" id="3290173">[</span><span class="ident" id="3290174">i</span><span class="op" id="3290175">]</span><span class="op" id="3290176">.</span><span class="ident" id="3290177">Pref</span>&nbsp;<span class="op" id="3290182">&lt;</span>&nbsp;<span class="ident" id="3290184">s</span><span class="op" id="3290185">[</span><span class="ident" id="3290186">j</span><span class="op" id="3290187">]</span><span class="op" id="3290188">.</span><span class="ident" id="3290189">Pref</span>&nbsp;<span class="op" id="3290194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="3290197">func</span>&nbsp;<span class="op" id="3290202">(</span><span class="ident" id="3290203">s</span>&nbsp;<span class="ident" id="3290205">byPref</span><span class="op" id="3290211">)</span>&nbsp;<span class="ident" id="3290213">Swap</span><span class="op" id="3290217">(</span><span class="ident" id="3290218">i</span><span class="op" id="3290219">,</span>&nbsp;<span class="ident" id="3290221">j</span>&nbsp;<span class="builtintype" id="3290223">int</span><span class="op" id="3290226">)</span>&nbsp;<span class="op" id="3290228">{</span>&nbsp;<span class="ident" id="3290230">s</span><span class="op" id="3290231">[</span><span class="ident" id="3290232">i</span><span class="op" id="3290233">]</span><span class="op" id="3290234">,</span>&nbsp;<span class="ident" id="3290236">s</span><span class="op" id="3290237">[</span><span class="ident" id="3290238">j</span><span class="op" id="3290239">]</span>&nbsp;<span class="op" id="3290241">=</span>&nbsp;<span class="ident" id="3290243">s</span><span class="op" id="3290244">[</span><span class="ident" id="3290245">j</span><span class="op" id="3290246">]</span><span class="op" id="3290247">,</span>&nbsp;<span class="ident" id="3290249">s</span><span class="op" id="3290250">[</span><span class="ident" id="3290251">i</span><span class="op" id="3290252">]</span>&nbsp;<span class="op" id="3290254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3290257">//&nbsp;sort&nbsp;reorders&nbsp;MX&nbsp;records&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;5321.</span><br>
<span class="lineno"></span><span class="keyword" id="3290311">func</span>&nbsp;<span class="op" id="3290316">(</span><span class="ident" id="3290317">s</span>&nbsp;<span class="ident" id="3290319">byPref</span><span class="op" id="3290325">)</span>&nbsp;<span class="ident" id="3290327">sort</span><span class="op" id="3290331">(</span><span class="op" id="3290332">)</span>&nbsp;<span class="op" id="3290334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3290337">for</span>&nbsp;<span class="ident" id="3290341">i</span>&nbsp;<span class="op" id="3290343">:=</span>&nbsp;<span class="keyword" id="3290346">range</span>&nbsp;<span class="ident" id="3290352">s</span>&nbsp;<span class="op" id="3290354">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3290358">j</span>&nbsp;<span class="op" id="3290360">:=</span>&nbsp;<span class="ident" id="3290363">rand</span><span class="op" id="3290367">.</span><span class="ident" id="3290368">Intn</span><span class="op" id="3290372">(</span><span class="ident" id="3290373">i</span>&nbsp;<span class="op" id="3290375">+</span>&nbsp;<span class="num" id="3290377">1</span><span class="op" id="3290378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3290382">s</span><span class="op" id="3290383">[</span><span class="ident" id="3290384">i</span><span class="op" id="3290385">]</span><span class="op" id="3290386">,</span>&nbsp;<span class="ident" id="3290388">s</span><span class="op" id="3290389">[</span><span class="ident" id="3290390">j</span><span class="op" id="3290391">]</span>&nbsp;<span class="op" id="3290393">=</span>&nbsp;<span class="ident" id="3290395">s</span><span class="op" id="3290396">[</span><span class="ident" id="3290397">j</span><span class="op" id="3290398">]</span><span class="op" id="3290399">,</span>&nbsp;<span class="ident" id="3290401">s</span><span class="op" id="3290402">[</span><span class="ident" id="3290403">i</span><span class="op" id="3290404">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3290407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3290410">sort</span><span class="op" id="3290414">.</span><span class="ident" id="3290415">Sort</span><span class="op" id="3290419">(</span><span class="ident" id="3290420">s</span><span class="op" id="3290421">)</span><br>
<span class="lineno"></span><span class="op" id="3290423">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="3290426">//&nbsp;An&nbsp;NS&nbsp;represents&nbsp;a&nbsp;single&nbsp;DNS&nbsp;NS&nbsp;record.</span><br>
<span class="lineno"></span><span class="keyword" id="3290470">type</span>&nbsp;<span class="ident" id="3290475">NS</span>&nbsp;<span class="keyword" id="3290478">struct</span>&nbsp;<span class="op" id="3290485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3290488">Host</span>&nbsp;<span class="builtintype" id="3290493">string</span><br>
<span class="lineno"></span><span class="op" id="3290500">}</span>
</div>
</body>
</html>
