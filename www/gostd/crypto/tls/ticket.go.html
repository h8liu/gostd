<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html" class="current">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4309076">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4309131">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4309185">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4309236">package</span>&nbsp;<span class="ident" id="4309244">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4309249">import</span>&nbsp;<span class="op" id="4309256">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4309259">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4309268">&#34;crypto/aes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4309282">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4309299">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4309314">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4309331">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4309348">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4309358">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4309363">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4309366">//&nbsp;sessionState&nbsp;contains&nbsp;the&nbsp;information&nbsp;that&nbsp;is&nbsp;serialized&nbsp;into&nbsp;a&nbsp;session</span><br>
<span class="lineno"></span><span class="comment" id="4309441">//&nbsp;ticket&nbsp;in&nbsp;order&nbsp;to&nbsp;later&nbsp;resume&nbsp;a&nbsp;connection.</span><br>
<span class="lineno">20</span><span class="keyword" id="4309490">type</span>&nbsp;<span class="ident" id="4309495">sessionState</span>&nbsp;<span class="keyword" id="4309508">struct</span>&nbsp;<span class="op" id="4309515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4309518">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4309531">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4309539">cipherSuite</span>&nbsp;&nbsp;<span class="builtintype" id="4309552">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4309560">masterSecret</span>&nbsp;<span class="op" id="4309573">[</span><span class="op" id="4309574">]</span><span class="builtintype" id="4309575">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4309581">certificates</span>&nbsp;<span class="op" id="4309594">[</span><span class="op" id="4309595">]</span><span class="op" id="4309596">[</span><span class="op" id="4309597">]</span><span class="builtintype" id="4309598">byte</span><br>
<span class="lineno">25</span><span class="op" id="4309603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4309606">func</span>&nbsp;<span class="op" id="4309611">(</span><span class="ident" id="4309612">s</span>&nbsp;<span class="op" id="4309614">*</span><span class="ident" id="4309615">sessionState</span><span class="op" id="4309627">)</span>&nbsp;<span class="ident" id="4309629">equal</span><span class="op" id="4309634">(</span><span class="ident" id="4309635">i</span>&nbsp;<span class="keyword" id="4309637">interface</span><span class="op" id="4309646">{</span><span class="op" id="4309647">}</span><span class="op" id="4309648">)</span>&nbsp;<span class="builtintype" id="4309650">bool</span>&nbsp;<span class="op" id="4309655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4309658">s1</span><span class="op" id="4309660">,</span>&nbsp;<span class="ident" id="4309662">ok</span>&nbsp;<span class="op" id="4309665">:=</span>&nbsp;<span class="ident" id="4309668">i</span><span class="op" id="4309669">.</span><span class="op" id="4309670">(</span><span class="op" id="4309671">*</span><span class="ident" id="4309672">sessionState</span><span class="op" id="4309684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4309687">if</span>&nbsp;<span class="op" id="4309690">!</span><span class="ident" id="4309691">ok</span>&nbsp;<span class="op" id="4309694">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4309698">return</span>&nbsp;<span class="builtintype" id="4309705">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4309712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4309716">if</span>&nbsp;<span class="ident" id="4309719">s</span><span class="op" id="4309720">.</span><span class="ident" id="4309721">vers</span>&nbsp;<span class="op" id="4309726">!=</span>&nbsp;<span class="ident" id="4309729">s1</span><span class="op" id="4309731">.</span><span class="ident" id="4309732">vers</span>&nbsp;<span class="op" id="4309737">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4309742">s</span><span class="op" id="4309743">.</span><span class="ident" id="4309744">cipherSuite</span>&nbsp;<span class="op" id="4309756">!=</span>&nbsp;<span class="ident" id="4309759">s1</span><span class="op" id="4309761">.</span><span class="ident" id="4309762">cipherSuite</span>&nbsp;<span class="op" id="4309774">||</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4309779">!</span><span class="ident" id="4309780">bytes</span><span class="op" id="4309785">.</span><span class="ident" id="4309786">Equal</span><span class="op" id="4309791">(</span><span class="ident" id="4309792">s</span><span class="op" id="4309793">.</span><span class="ident" id="4309794">masterSecret</span><span class="op" id="4309806">,</span>&nbsp;<span class="ident" id="4309808">s1</span><span class="op" id="4309810">.</span><span class="ident" id="4309811">masterSecret</span><span class="op" id="4309823">)</span>&nbsp;<span class="op" id="4309825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4309829">return</span>&nbsp;<span class="builtintype" id="4309836">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4309843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4309847">if</span>&nbsp;<span class="builtinfunc" id="4309850">len</span><span class="op" id="4309853">(</span><span class="ident" id="4309854">s</span><span class="op" id="4309855">.</span><span class="ident" id="4309856">certificates</span><span class="op" id="4309868">)</span>&nbsp;<span class="op" id="4309870">!=</span>&nbsp;<span class="builtinfunc" id="4309873">len</span><span class="op" id="4309876">(</span><span class="ident" id="4309877">s1</span><span class="op" id="4309879">.</span><span class="ident" id="4309880">certificates</span><span class="op" id="4309892">)</span>&nbsp;<span class="op" id="4309894">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4309898">return</span>&nbsp;<span class="builtintype" id="4309905">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4309912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4309916">for</span>&nbsp;<span class="ident" id="4309920">i</span>&nbsp;<span class="op" id="4309922">:=</span>&nbsp;<span class="keyword" id="4309925">range</span>&nbsp;<span class="ident" id="4309931">s</span><span class="op" id="4309932">.</span><span class="ident" id="4309933">certificates</span>&nbsp;<span class="op" id="4309946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4309950">if</span>&nbsp;<span class="op" id="4309953">!</span><span class="ident" id="4309954">bytes</span><span class="op" id="4309959">.</span><span class="ident" id="4309960">Equal</span><span class="op" id="4309965">(</span><span class="ident" id="4309966">s</span><span class="op" id="4309967">.</span><span class="ident" id="4309968">certificates</span><span class="op" id="4309980">[</span><span class="ident" id="4309981">i</span><span class="op" id="4309982">]</span><span class="op" id="4309983">,</span>&nbsp;<span class="ident" id="4309985">s1</span><span class="op" id="4309987">.</span><span class="ident" id="4309988">certificates</span><span class="op" id="4310000">[</span><span class="ident" id="4310001">i</span><span class="op" id="4310002">]</span><span class="op" id="4310003">)</span>&nbsp;<span class="op" id="4310005">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4310010">return</span>&nbsp;<span class="builtintype" id="4310017">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4310032">return</span>&nbsp;<span class="builtintype" id="4310039">true</span><br>
<span class="lineno">50</span><span class="op" id="4310044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4310047">func</span>&nbsp;<span class="op" id="4310052">(</span><span class="ident" id="4310053">s</span>&nbsp;<span class="op" id="4310055">*</span><span class="ident" id="4310056">sessionState</span><span class="op" id="4310068">)</span>&nbsp;<span class="ident" id="4310070">marshal</span><span class="op" id="4310077">(</span><span class="op" id="4310078">)</span>&nbsp;<span class="op" id="4310080">[</span><span class="op" id="4310081">]</span><span class="builtintype" id="4310082">byte</span>&nbsp;<span class="op" id="4310087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310090">length</span>&nbsp;<span class="op" id="4310097">:=</span>&nbsp;<span class="num" id="4310100">2</span>&nbsp;<span class="op" id="4310102">+</span>&nbsp;<span class="num" id="4310104">2</span>&nbsp;<span class="op" id="4310106">+</span>&nbsp;<span class="num" id="4310108">2</span>&nbsp;<span class="op" id="4310110">+</span>&nbsp;<span class="builtinfunc" id="4310112">len</span><span class="op" id="4310115">(</span><span class="ident" id="4310116">s</span><span class="op" id="4310117">.</span><span class="ident" id="4310118">masterSecret</span><span class="op" id="4310130">)</span>&nbsp;<span class="op" id="4310132">+</span>&nbsp;<span class="num" id="4310134">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4310137">for</span>&nbsp;<span class="ident" id="4310141">_</span><span class="op" id="4310142">,</span>&nbsp;<span class="ident" id="4310144">cert</span>&nbsp;<span class="op" id="4310149">:=</span>&nbsp;<span class="keyword" id="4310152">range</span>&nbsp;<span class="ident" id="4310158">s</span><span class="op" id="4310159">.</span><span class="ident" id="4310160">certificates</span>&nbsp;<span class="op" id="4310173">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310177">length</span>&nbsp;<span class="op" id="4310184">+=</span>&nbsp;<span class="num" id="4310187">4</span>&nbsp;<span class="op" id="4310189">+</span>&nbsp;<span class="builtinfunc" id="4310191">len</span><span class="op" id="4310194">(</span><span class="ident" id="4310195">cert</span><span class="op" id="4310199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310206">ret</span>&nbsp;<span class="op" id="4310210">:=</span>&nbsp;<span class="builtinfunc" id="4310213">make</span><span class="op" id="4310217">(</span><span class="op" id="4310218">[</span><span class="op" id="4310219">]</span><span class="builtintype" id="4310220">byte</span><span class="op" id="4310224">,</span>&nbsp;<span class="ident" id="4310226">length</span><span class="op" id="4310232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310235">x</span>&nbsp;<span class="op" id="4310237">:=</span>&nbsp;<span class="ident" id="4310240">ret</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310245">x</span><span class="op" id="4310246">[</span><span class="num" id="4310247">0</span><span class="op" id="4310248">]</span>&nbsp;<span class="op" id="4310250">=</span>&nbsp;<span class="builtintype" id="4310252">byte</span><span class="op" id="4310256">(</span><span class="ident" id="4310257">s</span><span class="op" id="4310258">.</span><span class="ident" id="4310259">vers</span>&nbsp;<span class="op" id="4310264">&gt;&gt;</span>&nbsp;<span class="num" id="4310267">8</span><span class="op" id="4310268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310271">x</span><span class="op" id="4310272">[</span><span class="num" id="4310273">1</span><span class="op" id="4310274">]</span>&nbsp;<span class="op" id="4310276">=</span>&nbsp;<span class="builtintype" id="4310278">byte</span><span class="op" id="4310282">(</span><span class="ident" id="4310283">s</span><span class="op" id="4310284">.</span><span class="ident" id="4310285">vers</span><span class="op" id="4310289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310292">x</span><span class="op" id="4310293">[</span><span class="num" id="4310294">2</span><span class="op" id="4310295">]</span>&nbsp;<span class="op" id="4310297">=</span>&nbsp;<span class="builtintype" id="4310299">byte</span><span class="op" id="4310303">(</span><span class="ident" id="4310304">s</span><span class="op" id="4310305">.</span><span class="ident" id="4310306">cipherSuite</span>&nbsp;<span class="op" id="4310318">&gt;&gt;</span>&nbsp;<span class="num" id="4310321">8</span><span class="op" id="4310322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310325">x</span><span class="op" id="4310326">[</span><span class="num" id="4310327">3</span><span class="op" id="4310328">]</span>&nbsp;<span class="op" id="4310330">=</span>&nbsp;<span class="builtintype" id="4310332">byte</span><span class="op" id="4310336">(</span><span class="ident" id="4310337">s</span><span class="op" id="4310338">.</span><span class="ident" id="4310339">cipherSuite</span><span class="op" id="4310350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310353">x</span><span class="op" id="4310354">[</span><span class="num" id="4310355">4</span><span class="op" id="4310356">]</span>&nbsp;<span class="op" id="4310358">=</span>&nbsp;<span class="builtintype" id="4310360">byte</span><span class="op" id="4310364">(</span><span class="builtinfunc" id="4310365">len</span><span class="op" id="4310368">(</span><span class="ident" id="4310369">s</span><span class="op" id="4310370">.</span><span class="ident" id="4310371">masterSecret</span><span class="op" id="4310383">)</span>&nbsp;<span class="op" id="4310385">&gt;&gt;</span>&nbsp;<span class="num" id="4310388">8</span><span class="op" id="4310389">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310392">x</span><span class="op" id="4310393">[</span><span class="num" id="4310394">5</span><span class="op" id="4310395">]</span>&nbsp;<span class="op" id="4310397">=</span>&nbsp;<span class="builtintype" id="4310399">byte</span><span class="op" id="4310403">(</span><span class="builtinfunc" id="4310404">len</span><span class="op" id="4310407">(</span><span class="ident" id="4310408">s</span><span class="op" id="4310409">.</span><span class="ident" id="4310410">masterSecret</span><span class="op" id="4310422">)</span><span class="op" id="4310423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310426">x</span>&nbsp;<span class="op" id="4310428">=</span>&nbsp;<span class="ident" id="4310430">x</span><span class="op" id="4310431">[</span><span class="num" id="4310432">6</span><span class="op" id="4310433">:</span><span class="op" id="4310434">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4310437">copy</span><span class="op" id="4310441">(</span><span class="ident" id="4310442">x</span><span class="op" id="4310443">,</span>&nbsp;<span class="ident" id="4310445">s</span><span class="op" id="4310446">.</span><span class="ident" id="4310447">masterSecret</span><span class="op" id="4310459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310462">x</span>&nbsp;<span class="op" id="4310464">=</span>&nbsp;<span class="ident" id="4310466">x</span><span class="op" id="4310467">[</span><span class="builtinfunc" id="4310468">len</span><span class="op" id="4310471">(</span><span class="ident" id="4310472">s</span><span class="op" id="4310473">.</span><span class="ident" id="4310474">masterSecret</span><span class="op" id="4310486">)</span><span class="op" id="4310487">:</span><span class="op" id="4310488">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310492">x</span><span class="op" id="4310493">[</span><span class="num" id="4310494">0</span><span class="op" id="4310495">]</span>&nbsp;<span class="op" id="4310497">=</span>&nbsp;<span class="builtintype" id="4310499">byte</span><span class="op" id="4310503">(</span><span class="builtinfunc" id="4310504">len</span><span class="op" id="4310507">(</span><span class="ident" id="4310508">s</span><span class="op" id="4310509">.</span><span class="ident" id="4310510">certificates</span><span class="op" id="4310522">)</span>&nbsp;<span class="op" id="4310524">&gt;&gt;</span>&nbsp;<span class="num" id="4310527">8</span><span class="op" id="4310528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310531">x</span><span class="op" id="4310532">[</span><span class="num" id="4310533">1</span><span class="op" id="4310534">]</span>&nbsp;<span class="op" id="4310536">=</span>&nbsp;<span class="builtintype" id="4310538">byte</span><span class="op" id="4310542">(</span><span class="builtinfunc" id="4310543">len</span><span class="op" id="4310546">(</span><span class="ident" id="4310547">s</span><span class="op" id="4310548">.</span><span class="ident" id="4310549">certificates</span><span class="op" id="4310561">)</span><span class="op" id="4310562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310565">x</span>&nbsp;<span class="op" id="4310567">=</span>&nbsp;<span class="ident" id="4310569">x</span><span class="op" id="4310570">[</span><span class="num" id="4310571">2</span><span class="op" id="4310572">:</span><span class="op" id="4310573">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4310577">for</span>&nbsp;<span class="ident" id="4310581">_</span><span class="op" id="4310582">,</span>&nbsp;<span class="ident" id="4310584">cert</span>&nbsp;<span class="op" id="4310589">:=</span>&nbsp;<span class="keyword" id="4310592">range</span>&nbsp;<span class="ident" id="4310598">s</span><span class="op" id="4310599">.</span><span class="ident" id="4310600">certificates</span>&nbsp;<span class="op" id="4310613">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310617">x</span><span class="op" id="4310618">[</span><span class="num" id="4310619">0</span><span class="op" id="4310620">]</span>&nbsp;<span class="op" id="4310622">=</span>&nbsp;<span class="builtintype" id="4310624">byte</span><span class="op" id="4310628">(</span><span class="builtinfunc" id="4310629">len</span><span class="op" id="4310632">(</span><span class="ident" id="4310633">cert</span><span class="op" id="4310637">)</span>&nbsp;<span class="op" id="4310639">&gt;&gt;</span>&nbsp;<span class="num" id="4310642">24</span><span class="op" id="4310644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310648">x</span><span class="op" id="4310649">[</span><span class="num" id="4310650">1</span><span class="op" id="4310651">]</span>&nbsp;<span class="op" id="4310653">=</span>&nbsp;<span class="builtintype" id="4310655">byte</span><span class="op" id="4310659">(</span><span class="builtinfunc" id="4310660">len</span><span class="op" id="4310663">(</span><span class="ident" id="4310664">cert</span><span class="op" id="4310668">)</span>&nbsp;<span class="op" id="4310670">&gt;&gt;</span>&nbsp;<span class="num" id="4310673">16</span><span class="op" id="4310675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310679">x</span><span class="op" id="4310680">[</span><span class="num" id="4310681">2</span><span class="op" id="4310682">]</span>&nbsp;<span class="op" id="4310684">=</span>&nbsp;<span class="builtintype" id="4310686">byte</span><span class="op" id="4310690">(</span><span class="builtinfunc" id="4310691">len</span><span class="op" id="4310694">(</span><span class="ident" id="4310695">cert</span><span class="op" id="4310699">)</span>&nbsp;<span class="op" id="4310701">&gt;&gt;</span>&nbsp;<span class="num" id="4310704">8</span><span class="op" id="4310705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310709">x</span><span class="op" id="4310710">[</span><span class="num" id="4310711">3</span><span class="op" id="4310712">]</span>&nbsp;<span class="op" id="4310714">=</span>&nbsp;<span class="builtintype" id="4310716">byte</span><span class="op" id="4310720">(</span><span class="builtinfunc" id="4310721">len</span><span class="op" id="4310724">(</span><span class="ident" id="4310725">cert</span><span class="op" id="4310729">)</span><span class="op" id="4310730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4310734">copy</span><span class="op" id="4310738">(</span><span class="ident" id="4310739">x</span><span class="op" id="4310740">[</span><span class="num" id="4310741">4</span><span class="op" id="4310742">:</span><span class="op" id="4310743">]</span><span class="op" id="4310744">,</span>&nbsp;<span class="ident" id="4310746">cert</span><span class="op" id="4310750">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310754">x</span>&nbsp;<span class="op" id="4310756">=</span>&nbsp;<span class="ident" id="4310758">x</span><span class="op" id="4310759">[</span><span class="num" id="4310760">4</span><span class="op" id="4310761">+</span><span class="builtinfunc" id="4310762">len</span><span class="op" id="4310765">(</span><span class="ident" id="4310766">cert</span><span class="op" id="4310770">)</span><span class="op" id="4310771">:</span><span class="op" id="4310772">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4310779">return</span>&nbsp;<span class="ident" id="4310786">ret</span><br>
<span class="lineno"></span><span class="op" id="4310790">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="4310793">func</span>&nbsp;<span class="op" id="4310798">(</span><span class="ident" id="4310799">s</span>&nbsp;<span class="op" id="4310801">*</span><span class="ident" id="4310802">sessionState</span><span class="op" id="4310814">)</span>&nbsp;<span class="ident" id="4310816">unmarshal</span><span class="op" id="4310825">(</span><span class="ident" id="4310826">data</span>&nbsp;<span class="op" id="4310831">[</span><span class="op" id="4310832">]</span><span class="builtintype" id="4310833">byte</span><span class="op" id="4310837">)</span>&nbsp;<span class="builtintype" id="4310839">bool</span>&nbsp;<span class="op" id="4310844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4310847">if</span>&nbsp;<span class="builtinfunc" id="4310850">len</span><span class="op" id="4310853">(</span><span class="ident" id="4310854">data</span><span class="op" id="4310858">)</span>&nbsp;<span class="op" id="4310860">&lt;</span>&nbsp;<span class="num" id="4310862">8</span>&nbsp;<span class="op" id="4310864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4310868">return</span>&nbsp;<span class="builtintype" id="4310875">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310882">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310886">s</span><span class="op" id="4310887">.</span><span class="ident" id="4310888">vers</span>&nbsp;<span class="op" id="4310893">=</span>&nbsp;<span class="builtintype" id="4310895">uint16</span><span class="op" id="4310901">(</span><span class="ident" id="4310902">data</span><span class="op" id="4310906">[</span><span class="num" id="4310907">0</span><span class="op" id="4310908">]</span><span class="op" id="4310909">)</span><span class="op" id="4310910">&lt;&lt;</span><span class="num" id="4310912">8</span>&nbsp;<span class="op" id="4310914">|</span>&nbsp;<span class="builtintype" id="4310916">uint16</span><span class="op" id="4310922">(</span><span class="ident" id="4310923">data</span><span class="op" id="4310927">[</span><span class="num" id="4310928">1</span><span class="op" id="4310929">]</span><span class="op" id="4310930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310933">s</span><span class="op" id="4310934">.</span><span class="ident" id="4310935">cipherSuite</span>&nbsp;<span class="op" id="4310947">=</span>&nbsp;<span class="builtintype" id="4310949">uint16</span><span class="op" id="4310955">(</span><span class="ident" id="4310956">data</span><span class="op" id="4310960">[</span><span class="num" id="4310961">2</span><span class="op" id="4310962">]</span><span class="op" id="4310963">)</span><span class="op" id="4310964">&lt;&lt;</span><span class="num" id="4310966">8</span>&nbsp;<span class="op" id="4310968">|</span>&nbsp;<span class="builtintype" id="4310970">uint16</span><span class="op" id="4310976">(</span><span class="ident" id="4310977">data</span><span class="op" id="4310981">[</span><span class="num" id="4310982">3</span><span class="op" id="4310983">]</span><span class="op" id="4310984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4310987">masterSecretLen</span>&nbsp;<span class="op" id="4311003">:=</span>&nbsp;<span class="builtintype" id="4311006">int</span><span class="op" id="4311009">(</span><span class="ident" id="4311010">data</span><span class="op" id="4311014">[</span><span class="num" id="4311015">4</span><span class="op" id="4311016">]</span><span class="op" id="4311017">)</span><span class="op" id="4311018">&lt;&lt;</span><span class="num" id="4311020">8</span>&nbsp;<span class="op" id="4311022">|</span>&nbsp;<span class="builtintype" id="4311024">int</span><span class="op" id="4311027">(</span><span class="ident" id="4311028">data</span><span class="op" id="4311032">[</span><span class="num" id="4311033">5</span><span class="op" id="4311034">]</span><span class="op" id="4311035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4311038">data</span>&nbsp;<span class="op" id="4311043">=</span>&nbsp;<span class="ident" id="4311045">data</span><span class="op" id="4311049">[</span><span class="num" id="4311050">6</span><span class="op" id="4311051">:</span><span class="op" id="4311052">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4311055">if</span>&nbsp;<span class="builtinfunc" id="4311058">len</span><span class="op" id="4311061">(</span><span class="ident" id="4311062">data</span><span class="op" id="4311066">)</span>&nbsp;<span class="op" id="4311068">&lt;</span>&nbsp;<span class="ident" id="4311070">masterSecretLen</span>&nbsp;<span class="op" id="4311086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4311090">return</span>&nbsp;<span class="builtintype" id="4311097">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4311104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4311108">s</span><span class="op" id="4311109">.</span><span class="ident" id="4311110">masterSecret</span>&nbsp;<span class="op" id="4311123">=</span>&nbsp;<span class="ident" id="4311125">data</span><span class="op" id="4311129">[</span><span class="op" id="4311130">:</span><span class="ident" id="4311131">masterSecretLen</span><span class="op" id="4311146">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4311149">data</span>&nbsp;<span class="op" id="4311154">=</span>&nbsp;<span class="ident" id="4311156">data</span><span class="op" id="4311160">[</span><span class="ident" id="4311161">masterSecretLen</span><span class="op" id="4311176">:</span><span class="op" id="4311177">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4311181">if</span>&nbsp;<span class="builtinfunc" id="4311184">len</span><span class="op" id="4311187">(</span><span class="ident" id="4311188">data</span><span class="op" id="4311192">)</span>&nbsp;<span class="op" id="4311194">&lt;</span>&nbsp;<span class="num" id="4311196">2</span>&nbsp;<span class="op" id="4311198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4311202">return</span>&nbsp;<span class="builtintype" id="4311209">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4311216">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4311220">numCerts</span>&nbsp;<span class="op" id="4311229">:=</span>&nbsp;<span class="builtintype" id="4311232">int</span><span class="op" id="4311235">(</span><span class="ident" id="4311236">data</span><span class="op" id="4311240">[</span><span class="num" id="4311241">0</span><span class="op" id="4311242">]</span><span class="op" id="4311243">)</span><span class="op" id="4311244">&lt;&lt;</span><span class="num" id="4311246">8</span>&nbsp;<span class="op" id="4311248">|</span>&nbsp;<span class="builtintype" id="4311250">int</span><span class="op" id="4311253">(</span><span class="ident" id="4311254">data</span><span class="op" id="4311258">[</span><span class="num" id="4311259">1</span><span class="op" id="4311260">]</span><span class="op" id="4311261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4311264">data</span>&nbsp;<span class="op" id="4311269">=</span>&nbsp;<span class="ident" id="4311271">data</span><span class="op" id="4311275">[</span><span class="num" id="4311276">2</span><span class="op" id="4311277">:</span><span class="op" id="4311278">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4311282">s</span><span class="op" id="4311283">.</span><span class="ident" id="4311284">certificates</span>&nbsp;<span class="op" id="4311297">=</span>&nbsp;<span class="builtinfunc" id="4311299">make</span><span class="op" id="4311303">(</span><span class="op" id="4311304">[</span><span class="op" id="4311305">]</span><span class="op" id="4311306">[</span><span class="op" id="4311307">]</span><span class="builtintype" id="4311308">byte</span><span class="op" id="4311312">,</span>&nbsp;<span class="ident" id="4311314">numCerts</span><span class="op" id="4311322">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4311325">for</span>&nbsp;<span class="ident" id="4311329">i</span>&nbsp;<span class="op" id="4311331">:=</span>&nbsp;<span class="keyword" id="4311334">range</span>&nbsp;<span class="ident" id="4311340">s</span><span class="op" id="4311341">.</span><span class="ident" id="4311342">certificates</span>&nbsp;<span class="op" id="4311355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4311359">if</span>&nbsp;<span class="builtinfunc" id="4311362">len</span><span class="op" id="4311365">(</span><span class="ident" id="4311366">data</span><span class="op" id="4311370">)</span>&nbsp;<span class="op" id="4311372">&lt;</span>&nbsp;<span class="num" id="4311374">4</span>&nbsp;<span class="op" id="4311376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4311381">return</span>&nbsp;<span class="builtintype" id="4311388">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4311396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4311400">certLen</span>&nbsp;<span class="op" id="4311408">:=</span>&nbsp;<span class="builtintype" id="4311411">int</span><span class="op" id="4311414">(</span><span class="ident" id="4311415">data</span><span class="op" id="4311419">[</span><span class="num" id="4311420">0</span><span class="op" id="4311421">]</span><span class="op" id="4311422">)</span><span class="op" id="4311423">&lt;&lt;</span><span class="num" id="4311425">24</span>&nbsp;<span class="op" id="4311428">|</span>&nbsp;<span class="builtintype" id="4311430">int</span><span class="op" id="4311433">(</span><span class="ident" id="4311434">data</span><span class="op" id="4311438">[</span><span class="num" id="4311439">1</span><span class="op" id="4311440">]</span><span class="op" id="4311441">)</span><span class="op" id="4311442">&lt;&lt;</span><span class="num" id="4311444">16</span>&nbsp;<span class="op" id="4311447">|</span>&nbsp;<span class="builtintype" id="4311449">int</span><span class="op" id="4311452">(</span><span class="ident" id="4311453">data</span><span class="op" id="4311457">[</span><span class="num" id="4311458">2</span><span class="op" id="4311459">]</span><span class="op" id="4311460">)</span><span class="op" id="4311461">&lt;&lt;</span><span class="num" id="4311463">8</span>&nbsp;<span class="op" id="4311465">|</span>&nbsp;<span class="builtintype" id="4311467">int</span><span class="op" id="4311470">(</span><span class="ident" id="4311471">data</span><span class="op" id="4311475">[</span><span class="num" id="4311476">3</span><span class="op" id="4311477">]</span><span class="op" id="4311478">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4311482">data</span>&nbsp;<span class="op" id="4311487">=</span>&nbsp;<span class="ident" id="4311489">data</span><span class="op" id="4311493">[</span><span class="num" id="4311494">4</span><span class="op" id="4311495">:</span><span class="op" id="4311496">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4311500">if</span>&nbsp;<span class="ident" id="4311503">certLen</span>&nbsp;<span class="op" id="4311511">&lt;</span>&nbsp;<span class="num" id="4311513">0</span>&nbsp;<span class="op" id="4311515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4311520">return</span>&nbsp;<span class="builtintype" id="4311527">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4311535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4311539">if</span>&nbsp;<span class="builtinfunc" id="4311542">len</span><span class="op" id="4311545">(</span><span class="ident" id="4311546">data</span><span class="op" id="4311550">)</span>&nbsp;<span class="op" id="4311552">&lt;</span>&nbsp;<span class="ident" id="4311554">certLen</span>&nbsp;<span class="op" id="4311562">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4311567">return</span>&nbsp;<span class="builtintype" id="4311574">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4311582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4311586">s</span><span class="op" id="4311587">.</span><span class="ident" id="4311588">certificates</span><span class="op" id="4311600">[</span><span class="ident" id="4311601">i</span><span class="op" id="4311602">]</span>&nbsp;<span class="op" id="4311604">=</span>&nbsp;<span class="ident" id="4311606">data</span><span class="op" id="4311610">[</span><span class="op" id="4311611">:</span><span class="ident" id="4311612">certLen</span><span class="op" id="4311619">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4311623">data</span>&nbsp;<span class="op" id="4311628">=</span>&nbsp;<span class="ident" id="4311630">data</span><span class="op" id="4311634">[</span><span class="ident" id="4311635">certLen</span><span class="op" id="4311642">:</span><span class="op" id="4311643">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4311646">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4311650">if</span>&nbsp;<span class="builtinfunc" id="4311653">len</span><span class="op" id="4311656">(</span><span class="ident" id="4311657">data</span><span class="op" id="4311661">)</span>&nbsp;<span class="op" id="4311663">&gt;</span>&nbsp;<span class="num" id="4311665">0</span>&nbsp;<span class="op" id="4311667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4311671">return</span>&nbsp;<span class="builtintype" id="4311678">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4311685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4311689">return</span>&nbsp;<span class="builtintype" id="4311696">true</span><br>
<span class="lineno"></span><span class="op" id="4311701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4311704">func</span>&nbsp;<span class="op" id="4311709">(</span><span class="ident" id="4311710">c</span>&nbsp;<span class="op" id="4311712">*</span><span class="ident" id="4311713">Conn</span><span class="op" id="4311717">)</span>&nbsp;<span class="ident" id="4311719">encryptTicket</span><span class="op" id="4311732">(</span><span class="ident" id="4311733">state</span>&nbsp;<span class="op" id="4311739">*</span><span class="ident" id="4311740">sessionState</span><span class="op" id="4311752">)</span>&nbsp;<span class="op" id="4311754">(</span><span class="op" id="4311755">[</span><span class="op" id="4311756">]</span><span class="builtintype" id="4311757">byte</span><span class="op" id="4311761">,</span>&nbsp;<span class="builtintype" id="4311763">error</span><span class="op" id="4311768">)</span>&nbsp;<span class="op" id="4311770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4311773">serialized</span>&nbsp;<span class="op" id="4311784">:=</span>&nbsp;<span class="ident" id="4311787">state</span><span class="op" id="4311792">.</span><span class="ident" id="4311793">marshal</span><span class="op" id="4311800">(</span><span class="op" id="4311801">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4311804">encrypted</span>&nbsp;<span class="op" id="4311814">:=</span>&nbsp;<span class="builtinfunc" id="4311817">make</span><span class="op" id="4311821">(</span><span class="op" id="4311822">[</span><span class="op" id="4311823">]</span><span class="builtintype" id="4311824">byte</span><span class="op" id="4311828">,</span>&nbsp;<span class="ident" id="4311830">aes</span><span class="op" id="4311833">.</span><span class="ident" id="4311834">BlockSize</span><span class="op" id="4311843">+</span><span class="builtinfunc" id="4311844">len</span><span class="op" id="4311847">(</span><span class="ident" id="4311848">serialized</span><span class="op" id="4311858">)</span><span class="op" id="4311859">+</span><span class="ident" id="4311860">sha256</span><span class="op" id="4311866">.</span><span class="ident" id="4311867">Size</span><span class="op" id="4311871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4311874">iv</span>&nbsp;<span class="op" id="4311877">:=</span>&nbsp;<span class="ident" id="4311880">encrypted</span><span class="op" id="4311889">[</span><span class="op" id="4311890">:</span><span class="ident" id="4311891">aes</span><span class="op" id="4311894">.</span><span class="ident" id="4311895">BlockSize</span><span class="op" id="4311904">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4311907">macBytes</span>&nbsp;<span class="op" id="4311916">:=</span>&nbsp;<span class="ident" id="4311919">encrypted</span><span class="op" id="4311928">[</span><span class="builtinfunc" id="4311929">len</span><span class="op" id="4311932">(</span><span class="ident" id="4311933">encrypted</span><span class="op" id="4311942">)</span><span class="op" id="4311943">-</span><span class="ident" id="4311944">sha256</span><span class="op" id="4311950">.</span><span class="ident" id="4311951">Size</span><span class="op" id="4311955">:</span><span class="op" id="4311956">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4311960">if</span>&nbsp;<span class="ident" id="4311963">_</span><span class="op" id="4311964">,</span>&nbsp;<span class="ident" id="4311966">err</span>&nbsp;<span class="op" id="4311970">:=</span>&nbsp;<span class="ident" id="4311973">io</span><span class="op" id="4311975">.</span><span class="ident" id="4311976">ReadFull</span><span class="op" id="4311984">(</span><span class="ident" id="4311985">c</span><span class="op" id="4311986">.</span><span class="ident" id="4311987">config</span><span class="op" id="4311993">.</span><span class="ident" id="4311994">rand</span><span class="op" id="4311998">(</span><span class="op" id="4311999">)</span><span class="op" id="4312000">,</span>&nbsp;<span class="ident" id="4312002">iv</span><span class="op" id="4312004">)</span><span class="op" id="4312005">;</span>&nbsp;<span class="ident" id="4312007">err</span>&nbsp;<span class="op" id="4312011">!=</span>&nbsp;<span class="builtintype" id="4312014">nil</span>&nbsp;<span class="op" id="4312018">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4312022">return</span>&nbsp;<span class="builtintype" id="4312029">nil</span><span class="op" id="4312032">,</span>&nbsp;<span class="ident" id="4312034">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4312039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312042">block</span><span class="op" id="4312047">,</span>&nbsp;<span class="ident" id="4312049">err</span>&nbsp;<span class="op" id="4312053">:=</span>&nbsp;<span class="ident" id="4312056">aes</span><span class="op" id="4312059">.</span><span class="ident" id="4312060">NewCipher</span><span class="op" id="4312069">(</span><span class="ident" id="4312070">c</span><span class="op" id="4312071">.</span><span class="ident" id="4312072">config</span><span class="op" id="4312078">.</span><span class="ident" id="4312079">SessionTicketKey</span><span class="op" id="4312095">[</span><span class="op" id="4312096">:</span><span class="num" id="4312097">16</span><span class="op" id="4312099">]</span><span class="op" id="4312100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4312103">if</span>&nbsp;<span class="ident" id="4312106">err</span>&nbsp;<span class="op" id="4312110">!=</span>&nbsp;<span class="builtintype" id="4312113">nil</span>&nbsp;<span class="op" id="4312117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4312121">return</span>&nbsp;<span class="builtintype" id="4312128">nil</span><span class="op" id="4312131">,</span>&nbsp;<span class="ident" id="4312133">errors</span><span class="op" id="4312139">.</span><span class="ident" id="4312140">New</span><span class="op" id="4312143">(</span><span class="string" id="4312144">&#34;tls:&nbsp;failed&nbsp;to&nbsp;create&nbsp;cipher&nbsp;while&nbsp;encrypting&nbsp;ticket:&nbsp;&#34;</span>&nbsp;<span class="op" id="4312201">+</span>&nbsp;<span class="ident" id="4312203">err</span><span class="op" id="4312206">.</span><span class="ident" id="4312207">Error</span><span class="op" id="4312212">(</span><span class="op" id="4312213">)</span><span class="op" id="4312214">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4312217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312220">cipher</span><span class="op" id="4312226">.</span><span class="ident" id="4312227">NewCTR</span><span class="op" id="4312233">(</span><span class="ident" id="4312234">block</span><span class="op" id="4312239">,</span>&nbsp;<span class="ident" id="4312241">iv</span><span class="op" id="4312243">)</span><span class="op" id="4312244">.</span><span class="ident" id="4312245">XORKeyStream</span><span class="op" id="4312257">(</span><span class="ident" id="4312258">encrypted</span><span class="op" id="4312267">[</span><span class="ident" id="4312268">aes</span><span class="op" id="4312271">.</span><span class="ident" id="4312272">BlockSize</span><span class="op" id="4312281">:</span><span class="op" id="4312282">]</span><span class="op" id="4312283">,</span>&nbsp;<span class="ident" id="4312285">serialized</span><span class="op" id="4312295">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312299">mac</span>&nbsp;<span class="op" id="4312303">:=</span>&nbsp;<span class="ident" id="4312306">hmac</span><span class="op" id="4312310">.</span><span class="ident" id="4312311">New</span><span class="op" id="4312314">(</span><span class="ident" id="4312315">sha256</span><span class="op" id="4312321">.</span><span class="ident" id="4312322">New</span><span class="op" id="4312325">,</span>&nbsp;<span class="ident" id="4312327">c</span><span class="op" id="4312328">.</span><span class="ident" id="4312329">config</span><span class="op" id="4312335">.</span><span class="ident" id="4312336">SessionTicketKey</span><span class="op" id="4312352">[</span><span class="num" id="4312353">16</span><span class="op" id="4312355">:</span><span class="num" id="4312356">32</span><span class="op" id="4312358">]</span><span class="op" id="4312359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312362">mac</span><span class="op" id="4312365">.</span><span class="ident" id="4312366">Write</span><span class="op" id="4312371">(</span><span class="ident" id="4312372">encrypted</span><span class="op" id="4312381">[</span><span class="op" id="4312382">:</span><span class="builtinfunc" id="4312383">len</span><span class="op" id="4312386">(</span><span class="ident" id="4312387">encrypted</span><span class="op" id="4312396">)</span><span class="op" id="4312397">-</span><span class="ident" id="4312398">sha256</span><span class="op" id="4312404">.</span><span class="ident" id="4312405">Size</span><span class="op" id="4312409">]</span><span class="op" id="4312410">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312413">mac</span><span class="op" id="4312416">.</span><span class="ident" id="4312417">Sum</span><span class="op" id="4312420">(</span><span class="ident" id="4312421">macBytes</span><span class="op" id="4312429">[</span><span class="op" id="4312430">:</span><span class="num" id="4312431">0</span><span class="op" id="4312432">]</span><span class="op" id="4312433">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4312437">return</span>&nbsp;<span class="ident" id="4312444">encrypted</span><span class="op" id="4312453">,</span>&nbsp;<span class="builtintype" id="4312455">nil</span><br>
<span class="lineno"></span><span class="op" id="4312459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="4312462">func</span>&nbsp;<span class="op" id="4312467">(</span><span class="ident" id="4312468">c</span>&nbsp;<span class="op" id="4312470">*</span><span class="ident" id="4312471">Conn</span><span class="op" id="4312475">)</span>&nbsp;<span class="ident" id="4312477">decryptTicket</span><span class="op" id="4312490">(</span><span class="ident" id="4312491">encrypted</span>&nbsp;<span class="op" id="4312501">[</span><span class="op" id="4312502">]</span><span class="builtintype" id="4312503">byte</span><span class="op" id="4312507">)</span>&nbsp;<span class="op" id="4312509">(</span><span class="op" id="4312510">*</span><span class="ident" id="4312511">sessionState</span><span class="op" id="4312523">,</span>&nbsp;<span class="builtintype" id="4312525">bool</span><span class="op" id="4312529">)</span>&nbsp;<span class="op" id="4312531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4312534">if</span>&nbsp;<span class="ident" id="4312537">c</span><span class="op" id="4312538">.</span><span class="ident" id="4312539">config</span><span class="op" id="4312545">.</span><span class="ident" id="4312546">SessionTicketsDisabled</span>&nbsp;<span class="op" id="4312569">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4312574">len</span><span class="op" id="4312577">(</span><span class="ident" id="4312578">encrypted</span><span class="op" id="4312587">)</span>&nbsp;<span class="op" id="4312589">&lt;</span>&nbsp;<span class="ident" id="4312591">aes</span><span class="op" id="4312594">.</span><span class="ident" id="4312595">BlockSize</span><span class="op" id="4312604">+</span><span class="ident" id="4312605">sha256</span><span class="op" id="4312611">.</span><span class="ident" id="4312612">Size</span>&nbsp;<span class="op" id="4312617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4312621">return</span>&nbsp;<span class="builtintype" id="4312628">nil</span><span class="op" id="4312631">,</span>&nbsp;<span class="builtintype" id="4312633">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4312640">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312644">iv</span>&nbsp;<span class="op" id="4312647">:=</span>&nbsp;<span class="ident" id="4312650">encrypted</span><span class="op" id="4312659">[</span><span class="op" id="4312660">:</span><span class="ident" id="4312661">aes</span><span class="op" id="4312664">.</span><span class="ident" id="4312665">BlockSize</span><span class="op" id="4312674">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312677">macBytes</span>&nbsp;<span class="op" id="4312686">:=</span>&nbsp;<span class="ident" id="4312689">encrypted</span><span class="op" id="4312698">[</span><span class="builtinfunc" id="4312699">len</span><span class="op" id="4312702">(</span><span class="ident" id="4312703">encrypted</span><span class="op" id="4312712">)</span><span class="op" id="4312713">-</span><span class="ident" id="4312714">sha256</span><span class="op" id="4312720">.</span><span class="ident" id="4312721">Size</span><span class="op" id="4312725">:</span><span class="op" id="4312726">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312730">mac</span>&nbsp;<span class="op" id="4312734">:=</span>&nbsp;<span class="ident" id="4312737">hmac</span><span class="op" id="4312741">.</span><span class="ident" id="4312742">New</span><span class="op" id="4312745">(</span><span class="ident" id="4312746">sha256</span><span class="op" id="4312752">.</span><span class="ident" id="4312753">New</span><span class="op" id="4312756">,</span>&nbsp;<span class="ident" id="4312758">c</span><span class="op" id="4312759">.</span><span class="ident" id="4312760">config</span><span class="op" id="4312766">.</span><span class="ident" id="4312767">SessionTicketKey</span><span class="op" id="4312783">[</span><span class="num" id="4312784">16</span><span class="op" id="4312786">:</span><span class="num" id="4312787">32</span><span class="op" id="4312789">]</span><span class="op" id="4312790">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312793">mac</span><span class="op" id="4312796">.</span><span class="ident" id="4312797">Write</span><span class="op" id="4312802">(</span><span class="ident" id="4312803">encrypted</span><span class="op" id="4312812">[</span><span class="op" id="4312813">:</span><span class="builtinfunc" id="4312814">len</span><span class="op" id="4312817">(</span><span class="ident" id="4312818">encrypted</span><span class="op" id="4312827">)</span><span class="op" id="4312828">-</span><span class="ident" id="4312829">sha256</span><span class="op" id="4312835">.</span><span class="ident" id="4312836">Size</span><span class="op" id="4312840">]</span><span class="op" id="4312841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312844">expected</span>&nbsp;<span class="op" id="4312853">:=</span>&nbsp;<span class="ident" id="4312856">mac</span><span class="op" id="4312859">.</span><span class="ident" id="4312860">Sum</span><span class="op" id="4312863">(</span><span class="builtintype" id="4312864">nil</span><span class="op" id="4312867">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4312871">if</span>&nbsp;<span class="ident" id="4312874">subtle</span><span class="op" id="4312880">.</span><span class="ident" id="4312881">ConstantTimeCompare</span><span class="op" id="4312900">(</span><span class="ident" id="4312901">macBytes</span><span class="op" id="4312909">,</span>&nbsp;<span class="ident" id="4312911">expected</span><span class="op" id="4312919">)</span>&nbsp;<span class="op" id="4312921">!=</span>&nbsp;<span class="num" id="4312924">1</span>&nbsp;<span class="op" id="4312926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4312930">return</span>&nbsp;<span class="builtintype" id="4312937">nil</span><span class="op" id="4312940">,</span>&nbsp;<span class="builtintype" id="4312942">false</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4312949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312953">block</span><span class="op" id="4312958">,</span>&nbsp;<span class="ident" id="4312960">err</span>&nbsp;<span class="op" id="4312964">:=</span>&nbsp;<span class="ident" id="4312967">aes</span><span class="op" id="4312970">.</span><span class="ident" id="4312971">NewCipher</span><span class="op" id="4312980">(</span><span class="ident" id="4312981">c</span><span class="op" id="4312982">.</span><span class="ident" id="4312983">config</span><span class="op" id="4312989">.</span><span class="ident" id="4312990">SessionTicketKey</span><span class="op" id="4313006">[</span><span class="op" id="4313007">:</span><span class="num" id="4313008">16</span><span class="op" id="4313010">]</span><span class="op" id="4313011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4313014">if</span>&nbsp;<span class="ident" id="4313017">err</span>&nbsp;<span class="op" id="4313021">!=</span>&nbsp;<span class="builtintype" id="4313024">nil</span>&nbsp;<span class="op" id="4313028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4313032">return</span>&nbsp;<span class="builtintype" id="4313039">nil</span><span class="op" id="4313042">,</span>&nbsp;<span class="builtintype" id="4313044">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4313051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313054">ciphertext</span>&nbsp;<span class="op" id="4313065">:=</span>&nbsp;<span class="ident" id="4313068">encrypted</span><span class="op" id="4313077">[</span><span class="ident" id="4313078">aes</span><span class="op" id="4313081">.</span><span class="ident" id="4313082">BlockSize</span>&nbsp;<span class="op" id="4313092">:</span>&nbsp;<span class="builtinfunc" id="4313094">len</span><span class="op" id="4313097">(</span><span class="ident" id="4313098">encrypted</span><span class="op" id="4313107">)</span><span class="op" id="4313108">-</span><span class="ident" id="4313109">sha256</span><span class="op" id="4313115">.</span><span class="ident" id="4313116">Size</span><span class="op" id="4313120">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313123">plaintext</span>&nbsp;<span class="op" id="4313133">:=</span>&nbsp;<span class="ident" id="4313136">ciphertext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313148">cipher</span><span class="op" id="4313154">.</span><span class="ident" id="4313155">NewCTR</span><span class="op" id="4313161">(</span><span class="ident" id="4313162">block</span><span class="op" id="4313167">,</span>&nbsp;<span class="ident" id="4313169">iv</span><span class="op" id="4313171">)</span><span class="op" id="4313172">.</span><span class="ident" id="4313173">XORKeyStream</span><span class="op" id="4313185">(</span><span class="ident" id="4313186">plaintext</span><span class="op" id="4313195">,</span>&nbsp;<span class="ident" id="4313197">ciphertext</span><span class="op" id="4313207">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313211">state</span>&nbsp;<span class="op" id="4313217">:=</span>&nbsp;<span class="builtinfunc" id="4313220">new</span><span class="op" id="4313223">(</span><span class="ident" id="4313224">sessionState</span><span class="op" id="4313236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313239">ok</span>&nbsp;<span class="op" id="4313242">:=</span>&nbsp;<span class="ident" id="4313245">state</span><span class="op" id="4313250">.</span><span class="ident" id="4313251">unmarshal</span><span class="op" id="4313260">(</span><span class="ident" id="4313261">plaintext</span><span class="op" id="4313270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4313273">return</span>&nbsp;<span class="ident" id="4313280">state</span><span class="op" id="4313285">,</span>&nbsp;<span class="ident" id="4313287">ok</span><br>
<span class="lineno"></span><span class="op" id="4313290">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
