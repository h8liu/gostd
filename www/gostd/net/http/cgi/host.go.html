<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html" class="current">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5526365">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5526420">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5526474">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5526525">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;host&nbsp;side&nbsp;of&nbsp;CGI&nbsp;(being&nbsp;the&nbsp;webserver</span><br>
<span class="lineno"></span><span class="comment" id="5526591">//&nbsp;parent&nbsp;process).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5526612">//&nbsp;Package&nbsp;cgi&nbsp;implements&nbsp;CGI&nbsp;(Common&nbsp;Gateway&nbsp;Interface)&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="5526682">//&nbsp;in&nbsp;RFC&nbsp;3875.</span><br>
<span class="lineno">10</span><span class="comment" id="5526698">//</span><br>
<span class="lineno"></span><span class="comment" id="5526701">//&nbsp;Note&nbsp;that&nbsp;using&nbsp;CGI&nbsp;means&nbsp;starting&nbsp;a&nbsp;new&nbsp;process&nbsp;to&nbsp;handle&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="5526768">//&nbsp;request,&nbsp;which&nbsp;is&nbsp;typically&nbsp;less&nbsp;efficient&nbsp;than&nbsp;using&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5526827">//&nbsp;long-running&nbsp;server.&nbsp;&nbsp;This&nbsp;package&nbsp;is&nbsp;intended&nbsp;primarily&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5526891">//&nbsp;compatibility&nbsp;with&nbsp;existing&nbsp;systems.</span><br>
<span class="lineno">15</span><span class="keyword" id="5526931">package</span>&nbsp;<span class="ident" id="5526939">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5526944">import</span>&nbsp;<span class="op" id="5526951">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5526954">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5526963">&#34;fmt&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5526970">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5526976">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5526983">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5526995">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5527001">&#34;os/exec&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5527012">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5527029">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5527039">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5527050">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5527061">&#34;strings&#34;</span><br>
<span class="lineno">30</span><span class="op" id="5527071">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5527074">var</span>&nbsp;<span class="ident" id="5527078">trailingPort</span>&nbsp;<span class="op" id="5527091">=</span>&nbsp;<span class="ident" id="5527093">regexp</span><span class="op" id="5527099">.</span><span class="ident" id="5527100">MustCompile</span><span class="op" id="5527111">(</span><span class="string" id="5527112">`:([0-9]+)$`</span><span class="op" id="5527124">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5527127">var</span>&nbsp;<span class="ident" id="5527131">osDefaultInheritEnv</span>&nbsp;<span class="op" id="5527151">=</span>&nbsp;<span class="keyword" id="5527153">map</span><span class="op" id="5527156">[</span><span class="builtintype" id="5527157">string</span><span class="op" id="5527163">]</span><span class="op" id="5527164">[</span><span class="op" id="5527165">]</span><span class="builtintype" id="5527166">string</span><span class="op" id="5527172">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5527175">&#34;darwin&#34;</span><span class="op" id="5527183">:</span>&nbsp;&nbsp;<span class="op" id="5527186">{</span><span class="string" id="5527187">&#34;DYLD_LIBRARY_PATH&#34;</span><span class="op" id="5527206">}</span><span class="op" id="5527207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5527210">&#34;freebsd&#34;</span><span class="op" id="5527219">:</span>&nbsp;<span class="op" id="5527221">{</span><span class="string" id="5527222">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5527239">}</span><span class="op" id="5527240">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5527243">&#34;hpux&#34;</span><span class="op" id="5527249">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5527254">{</span><span class="string" id="5527255">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5527272">,</span>&nbsp;<span class="string" id="5527274">&#34;SHLIB_PATH&#34;</span><span class="op" id="5527286">}</span><span class="op" id="5527287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5527290">&#34;irix&#34;</span><span class="op" id="5527296">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5527301">{</span><span class="string" id="5527302">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5527319">,</span>&nbsp;<span class="string" id="5527321">&#34;LD_LIBRARYN32_PATH&#34;</span><span class="op" id="5527341">,</span>&nbsp;<span class="string" id="5527343">&#34;LD_LIBRARY64_PATH&#34;</span><span class="op" id="5527362">}</span><span class="op" id="5527363">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5527366">&#34;linux&#34;</span><span class="op" id="5527373">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5527377">{</span><span class="string" id="5527378">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5527395">}</span><span class="op" id="5527396">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5527399">&#34;openbsd&#34;</span><span class="op" id="5527408">:</span>&nbsp;<span class="op" id="5527410">{</span><span class="string" id="5527411">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5527428">}</span><span class="op" id="5527429">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5527432">&#34;solaris&#34;</span><span class="op" id="5527441">:</span>&nbsp;<span class="op" id="5527443">{</span><span class="string" id="5527444">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5527461">,</span>&nbsp;<span class="string" id="5527463">&#34;LD_LIBRARY_PATH_32&#34;</span><span class="op" id="5527483">,</span>&nbsp;<span class="string" id="5527485">&#34;LD_LIBRARY_PATH_64&#34;</span><span class="op" id="5527505">}</span><span class="op" id="5527506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5527509">&#34;windows&#34;</span><span class="op" id="5527518">:</span>&nbsp;<span class="op" id="5527520">{</span><span class="string" id="5527521">&#34;SystemRoot&#34;</span><span class="op" id="5527533">,</span>&nbsp;<span class="string" id="5527535">&#34;COMSPEC&#34;</span><span class="op" id="5527544">,</span>&nbsp;<span class="string" id="5527546">&#34;PATHEXT&#34;</span><span class="op" id="5527555">,</span>&nbsp;<span class="string" id="5527557">&#34;WINDIR&#34;</span><span class="op" id="5527565">}</span><span class="op" id="5527566">,</span><br>
<span class="lineno"></span><span class="op" id="5527568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5527571">//&nbsp;Handler&nbsp;runs&nbsp;an&nbsp;executable&nbsp;in&nbsp;a&nbsp;subprocess&nbsp;with&nbsp;a&nbsp;CGI&nbsp;environment.</span><br>
<span class="lineno"></span><span class="keyword" id="5527641">type</span>&nbsp;<span class="ident" id="5527646">Handler</span>&nbsp;<span class="keyword" id="5527654">struct</span>&nbsp;<span class="op" id="5527661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5527664">Path</span>&nbsp;<span class="builtintype" id="5527669">string</span>&nbsp;<span class="comment" id="5527676">//&nbsp;path&nbsp;to&nbsp;the&nbsp;CGI&nbsp;executable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5527707">Root</span>&nbsp;<span class="builtintype" id="5527712">string</span>&nbsp;<span class="comment" id="5527719">//&nbsp;root&nbsp;URI&nbsp;prefix&nbsp;of&nbsp;handler&nbsp;or&nbsp;empty&nbsp;for&nbsp;&#34;/&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5527768">//&nbsp;Dir&nbsp;specifies&nbsp;the&nbsp;CGI&nbsp;executable&#39;s&nbsp;working&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5527826">//&nbsp;If&nbsp;Dir&nbsp;is&nbsp;empty,&nbsp;the&nbsp;base&nbsp;directory&nbsp;of&nbsp;Path&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5527883">//&nbsp;If&nbsp;Path&nbsp;has&nbsp;no&nbsp;base&nbsp;directory,&nbsp;the&nbsp;current&nbsp;working</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5527938">//&nbsp;directory&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5527961">Dir</span>&nbsp;<span class="builtintype" id="5527965">string</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5527974">Env</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5527985">[</span><span class="op" id="5527986">]</span><span class="builtintype" id="5527987">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5527997">//&nbsp;extra&nbsp;environment&nbsp;variables&nbsp;to&nbsp;set,&nbsp;if&nbsp;any,&nbsp;as&nbsp;&#34;key=value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5528060">InheritEnv</span>&nbsp;<span class="op" id="5528071">[</span><span class="op" id="5528072">]</span><span class="builtintype" id="5528073">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5528083">//&nbsp;environment&nbsp;variables&nbsp;to&nbsp;inherit&nbsp;from&nbsp;host,&nbsp;as&nbsp;&#34;key&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5528140">Logger</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5528151">*</span><span class="ident" id="5528152">log</span><span class="op" id="5528155">.</span><span class="ident" id="5528156">Logger</span>&nbsp;<span class="comment" id="5528163">//&nbsp;optional&nbsp;log&nbsp;for&nbsp;errors&nbsp;or&nbsp;nil&nbsp;to&nbsp;use&nbsp;log.Print</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5528215">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5528226">[</span><span class="op" id="5528227">]</span><span class="builtintype" id="5528228">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5528238">//&nbsp;optional&nbsp;arguments&nbsp;to&nbsp;pass&nbsp;to&nbsp;child&nbsp;process</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5528287">//&nbsp;PathLocationHandler&nbsp;specifies&nbsp;the&nbsp;root&nbsp;http&nbsp;Handler&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5528348">//&nbsp;should&nbsp;handle&nbsp;internal&nbsp;redirects&nbsp;when&nbsp;the&nbsp;CGI&nbsp;process</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5528406">//&nbsp;returns&nbsp;a&nbsp;Location&nbsp;header&nbsp;value&nbsp;starting&nbsp;with&nbsp;a&nbsp;&#34;/&#34;,&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5528466">//&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;3875&nbsp;ยง&nbsp;6.3.2.&nbsp;This&nbsp;will&nbsp;likely&nbsp;be</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5528522">//&nbsp;http.DefaultServeMux.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5528548">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5528552">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;CGI&nbsp;response&nbsp;with&nbsp;a&nbsp;local&nbsp;URI&nbsp;path&nbsp;is&nbsp;instead&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5528617">//&nbsp;back&nbsp;to&nbsp;the&nbsp;client&nbsp;and&nbsp;not&nbsp;redirected&nbsp;internally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5528671">PathLocationHandler</span>&nbsp;<span class="ident" id="5528691">http</span><span class="op" id="5528695">.</span><span class="ident" id="5528696">Handler</span><br>
<span class="lineno">70</span><span class="op" id="5528704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5528707">//&nbsp;removeLeadingDuplicates&nbsp;remove&nbsp;leading&nbsp;duplicate&nbsp;in&nbsp;environments.</span><br>
<span class="lineno"></span><span class="comment" id="5528776">//&nbsp;It&#39;s&nbsp;possible&nbsp;to&nbsp;override&nbsp;environment&nbsp;like&nbsp;following.</span><br>
<span class="lineno"></span><span class="comment" id="5528833">//&nbsp;&nbsp;&nbsp;&nbsp;cgi.Handler{</span><br>
<span class="lineno">75</span><span class="comment" id="5528852">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="5528864">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Env:&nbsp;[]string{&#34;SCRIPT_FILENAME=foo.php&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="5528914">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="keyword" id="5528922">func</span>&nbsp;<span class="ident" id="5528927">removeLeadingDuplicates</span><span class="op" id="5528950">(</span><span class="ident" id="5528951">env</span>&nbsp;<span class="op" id="5528955">[</span><span class="op" id="5528956">]</span><span class="builtintype" id="5528957">string</span><span class="op" id="5528963">)</span>&nbsp;<span class="op" id="5528965">(</span><span class="ident" id="5528966">ret</span>&nbsp;<span class="op" id="5528970">[</span><span class="op" id="5528971">]</span><span class="builtintype" id="5528972">string</span><span class="op" id="5528978">)</span>&nbsp;<span class="op" id="5528980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5528983">n</span>&nbsp;<span class="op" id="5528985">:=</span>&nbsp;<span class="builtinfunc" id="5528988">len</span><span class="op" id="5528991">(</span><span class="ident" id="5528992">env</span><span class="op" id="5528995">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5528998">for</span>&nbsp;<span class="ident" id="5529002">i</span>&nbsp;<span class="op" id="5529004">:=</span>&nbsp;<span class="num" id="5529007">0</span><span class="op" id="5529008">;</span>&nbsp;<span class="ident" id="5529010">i</span>&nbsp;<span class="op" id="5529012">&lt;</span>&nbsp;<span class="ident" id="5529014">n</span><span class="op" id="5529015">;</span>&nbsp;<span class="ident" id="5529017">i</span><span class="op" id="5529018">++</span>&nbsp;<span class="op" id="5529021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529025">e</span>&nbsp;<span class="op" id="5529027">:=</span>&nbsp;<span class="ident" id="5529030">env</span><span class="op" id="5529033">[</span><span class="ident" id="5529034">i</span><span class="op" id="5529035">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529039">s</span>&nbsp;<span class="op" id="5529041">:=</span>&nbsp;<span class="ident" id="5529044">strings</span><span class="op" id="5529051">.</span><span class="ident" id="5529052">SplitN</span><span class="op" id="5529058">(</span><span class="ident" id="5529059">e</span><span class="op" id="5529060">,</span>&nbsp;<span class="string" id="5529062">&#34;=&#34;</span><span class="op" id="5529065">,</span>&nbsp;<span class="num" id="5529067">2</span><span class="op" id="5529068">)</span><span class="op" id="5529069">[</span><span class="num" id="5529070">0</span><span class="op" id="5529071">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529075">found</span>&nbsp;<span class="op" id="5529081">:=</span>&nbsp;<span class="builtintype" id="5529084">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5529092">for</span>&nbsp;<span class="ident" id="5529096">j</span>&nbsp;<span class="op" id="5529098">:=</span>&nbsp;<span class="ident" id="5529101">i</span>&nbsp;<span class="op" id="5529103">+</span>&nbsp;<span class="num" id="5529105">1</span><span class="op" id="5529106">;</span>&nbsp;<span class="ident" id="5529108">j</span>&nbsp;<span class="op" id="5529110">&lt;</span>&nbsp;<span class="ident" id="5529112">n</span><span class="op" id="5529113">;</span>&nbsp;<span class="ident" id="5529115">j</span><span class="op" id="5529116">++</span>&nbsp;<span class="op" id="5529119">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5529124">if</span>&nbsp;<span class="ident" id="5529127">s</span>&nbsp;<span class="op" id="5529129">==</span>&nbsp;<span class="ident" id="5529132">strings</span><span class="op" id="5529139">.</span><span class="ident" id="5529140">SplitN</span><span class="op" id="5529146">(</span><span class="ident" id="5529147">env</span><span class="op" id="5529150">[</span><span class="ident" id="5529151">j</span><span class="op" id="5529152">]</span><span class="op" id="5529153">,</span>&nbsp;<span class="string" id="5529155">&#34;=&#34;</span><span class="op" id="5529158">,</span>&nbsp;<span class="num" id="5529160">2</span><span class="op" id="5529161">)</span><span class="op" id="5529162">[</span><span class="num" id="5529163">0</span><span class="op" id="5529164">]</span>&nbsp;<span class="op" id="5529166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529172">found</span>&nbsp;<span class="op" id="5529178">=</span>&nbsp;<span class="builtintype" id="5529180">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5529189">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5529198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5529202">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5529206">if</span>&nbsp;<span class="op" id="5529209">!</span><span class="ident" id="5529210">found</span>&nbsp;<span class="op" id="5529216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529221">ret</span>&nbsp;<span class="op" id="5529225">=</span>&nbsp;<span class="builtinfunc" id="5529227">append</span><span class="op" id="5529233">(</span><span class="ident" id="5529234">ret</span><span class="op" id="5529237">,</span>&nbsp;<span class="ident" id="5529239">e</span><span class="op" id="5529240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5529244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5529247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5529250">return</span><br>
<span class="lineno">95</span><span class="op" id="5529257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5529260">func</span>&nbsp;<span class="op" id="5529265">(</span><span class="ident" id="5529266">h</span>&nbsp;<span class="op" id="5529268">*</span><span class="ident" id="5529269">Handler</span><span class="op" id="5529276">)</span>&nbsp;<span class="ident" id="5529278">ServeHTTP</span><span class="op" id="5529287">(</span><span class="ident" id="5529288">rw</span>&nbsp;<span class="ident" id="5529291">http</span><span class="op" id="5529295">.</span><span class="ident" id="5529296">ResponseWriter</span><span class="op" id="5529310">,</span>&nbsp;<span class="ident" id="5529312">req</span>&nbsp;<span class="op" id="5529316">*</span><span class="ident" id="5529317">http</span><span class="op" id="5529321">.</span><span class="ident" id="5529322">Request</span><span class="op" id="5529329">)</span>&nbsp;<span class="op" id="5529331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529334">root</span>&nbsp;<span class="op" id="5529339">:=</span>&nbsp;<span class="ident" id="5529342">h</span><span class="op" id="5529343">.</span><span class="ident" id="5529344">Root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5529350">if</span>&nbsp;<span class="ident" id="5529353">root</span>&nbsp;<span class="op" id="5529358">==</span>&nbsp;<span class="string" id="5529361">&#34;&#34;</span>&nbsp;<span class="op" id="5529364">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529368">root</span>&nbsp;<span class="op" id="5529373">=</span>&nbsp;<span class="string" id="5529375">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5529380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5529384">if</span>&nbsp;<span class="builtinfunc" id="5529387">len</span><span class="op" id="5529390">(</span><span class="ident" id="5529391">req</span><span class="op" id="5529394">.</span><span class="ident" id="5529395">TransferEncoding</span><span class="op" id="5529411">)</span>&nbsp;<span class="op" id="5529413">&gt;</span>&nbsp;<span class="num" id="5529415">0</span>&nbsp;<span class="op" id="5529417">&amp;&amp;</span>&nbsp;<span class="ident" id="5529420">req</span><span class="op" id="5529423">.</span><span class="ident" id="5529424">TransferEncoding</span><span class="op" id="5529440">[</span><span class="num" id="5529441">0</span><span class="op" id="5529442">]</span>&nbsp;<span class="op" id="5529444">==</span>&nbsp;<span class="string" id="5529447">&#34;chunked&#34;</span>&nbsp;<span class="op" id="5529457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529461">rw</span><span class="op" id="5529463">.</span><span class="ident" id="5529464">WriteHeader</span><span class="op" id="5529475">(</span><span class="ident" id="5529476">http</span><span class="op" id="5529480">.</span><span class="ident" id="5529481">StatusBadRequest</span><span class="op" id="5529497">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529501">rw</span><span class="op" id="5529503">.</span><span class="ident" id="5529504">Write</span><span class="op" id="5529509">(</span><span class="op" id="5529510">[</span><span class="op" id="5529511">]</span><span class="builtintype" id="5529512">byte</span><span class="op" id="5529516">(</span><span class="string" id="5529517">&#34;Chunked&nbsp;request&nbsp;bodies&nbsp;are&nbsp;not&nbsp;supported&nbsp;by&nbsp;CGI.&#34;</span><span class="op" id="5529567">)</span><span class="op" id="5529568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5529572">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5529580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529584">pathInfo</span>&nbsp;<span class="op" id="5529593">:=</span>&nbsp;<span class="ident" id="5529596">req</span><span class="op" id="5529599">.</span><span class="ident" id="5529600">URL</span><span class="op" id="5529603">.</span><span class="ident" id="5529604">Path</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5529610">if</span>&nbsp;<span class="ident" id="5529613">root</span>&nbsp;<span class="op" id="5529618">!=</span>&nbsp;<span class="string" id="5529621">&#34;/&#34;</span>&nbsp;<span class="op" id="5529625">&amp;&amp;</span>&nbsp;<span class="ident" id="5529628">strings</span><span class="op" id="5529635">.</span><span class="ident" id="5529636">HasPrefix</span><span class="op" id="5529645">(</span><span class="ident" id="5529646">pathInfo</span><span class="op" id="5529654">,</span>&nbsp;<span class="ident" id="5529656">root</span><span class="op" id="5529660">)</span>&nbsp;<span class="op" id="5529662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529666">pathInfo</span>&nbsp;<span class="op" id="5529675">=</span>&nbsp;<span class="ident" id="5529677">pathInfo</span><span class="op" id="5529685">[</span><span class="builtinfunc" id="5529686">len</span><span class="op" id="5529689">(</span><span class="ident" id="5529690">root</span><span class="op" id="5529694">)</span><span class="op" id="5529695">:</span><span class="op" id="5529696">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5529699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529703">port</span>&nbsp;<span class="op" id="5529708">:=</span>&nbsp;<span class="string" id="5529711">&#34;80&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5529717">if</span>&nbsp;<span class="ident" id="5529720">matches</span>&nbsp;<span class="op" id="5529728">:=</span>&nbsp;<span class="ident" id="5529731">trailingPort</span><span class="op" id="5529743">.</span><span class="ident" id="5529744">FindStringSubmatch</span><span class="op" id="5529762">(</span><span class="ident" id="5529763">req</span><span class="op" id="5529766">.</span><span class="ident" id="5529767">Host</span><span class="op" id="5529771">)</span><span class="op" id="5529772">;</span>&nbsp;<span class="builtinfunc" id="5529774">len</span><span class="op" id="5529777">(</span><span class="ident" id="5529778">matches</span><span class="op" id="5529785">)</span>&nbsp;<span class="op" id="5529787">!=</span>&nbsp;<span class="num" id="5529790">0</span>&nbsp;<span class="op" id="5529792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529796">port</span>&nbsp;<span class="op" id="5529801">=</span>&nbsp;<span class="ident" id="5529803">matches</span><span class="op" id="5529810">[</span><span class="num" id="5529811">1</span><span class="op" id="5529812">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5529815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529819">env</span>&nbsp;<span class="op" id="5529823">:=</span>&nbsp;<span class="op" id="5529826">[</span><span class="op" id="5529827">]</span><span class="builtintype" id="5529828">string</span><span class="op" id="5529834">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5529838">&#34;SERVER_SOFTWARE=go&#34;</span><span class="op" id="5529858">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5529862">&#34;SERVER_NAME=&#34;</span>&nbsp;<span class="op" id="5529877">+</span>&nbsp;<span class="ident" id="5529879">req</span><span class="op" id="5529882">.</span><span class="ident" id="5529883">Host</span><span class="op" id="5529887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5529891">&#34;SERVER_PROTOCOL=HTTP/1.1&#34;</span><span class="op" id="5529917">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5529921">&#34;HTTP_HOST=&#34;</span>&nbsp;<span class="op" id="5529934">+</span>&nbsp;<span class="ident" id="5529936">req</span><span class="op" id="5529939">.</span><span class="ident" id="5529940">Host</span><span class="op" id="5529944">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5529948">&#34;GATEWAY_INTERFACE=CGI/1.1&#34;</span><span class="op" id="5529975">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5529979">&#34;REQUEST_METHOD=&#34;</span>&nbsp;<span class="op" id="5529997">+</span>&nbsp;<span class="ident" id="5529999">req</span><span class="op" id="5530002">.</span><span class="ident" id="5530003">Method</span><span class="op" id="5530009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5530013">&#34;QUERY_STRING=&#34;</span>&nbsp;<span class="op" id="5530029">+</span>&nbsp;<span class="ident" id="5530031">req</span><span class="op" id="5530034">.</span><span class="ident" id="5530035">URL</span><span class="op" id="5530038">.</span><span class="ident" id="5530039">RawQuery</span><span class="op" id="5530047">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5530051">&#34;REQUEST_URI=&#34;</span>&nbsp;<span class="op" id="5530066">+</span>&nbsp;<span class="ident" id="5530068">req</span><span class="op" id="5530071">.</span><span class="ident" id="5530072">URL</span><span class="op" id="5530075">.</span><span class="ident" id="5530076">RequestURI</span><span class="op" id="5530086">(</span><span class="op" id="5530087">)</span><span class="op" id="5530088">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5530092">&#34;PATH_INFO=&#34;</span>&nbsp;<span class="op" id="5530105">+</span>&nbsp;<span class="ident" id="5530107">pathInfo</span><span class="op" id="5530115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5530119">&#34;SCRIPT_NAME=&#34;</span>&nbsp;<span class="op" id="5530134">+</span>&nbsp;<span class="ident" id="5530136">root</span><span class="op" id="5530140">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5530144">&#34;SCRIPT_FILENAME=&#34;</span>&nbsp;<span class="op" id="5530163">+</span>&nbsp;<span class="ident" id="5530165">h</span><span class="op" id="5530166">.</span><span class="ident" id="5530167">Path</span><span class="op" id="5530171">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5530175">&#34;REMOTE_ADDR=&#34;</span>&nbsp;<span class="op" id="5530190">+</span>&nbsp;<span class="ident" id="5530192">req</span><span class="op" id="5530195">.</span><span class="ident" id="5530196">RemoteAddr</span><span class="op" id="5530206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5530210">&#34;REMOTE_HOST=&#34;</span>&nbsp;<span class="op" id="5530225">+</span>&nbsp;<span class="ident" id="5530227">req</span><span class="op" id="5530230">.</span><span class="ident" id="5530231">RemoteAddr</span><span class="op" id="5530241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5530245">&#34;SERVER_PORT=&#34;</span>&nbsp;<span class="op" id="5530260">+</span>&nbsp;<span class="ident" id="5530262">port</span><span class="op" id="5530266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5530269">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5530273">if</span>&nbsp;<span class="ident" id="5530276">req</span><span class="op" id="5530279">.</span><span class="ident" id="5530280">TLS</span>&nbsp;<span class="op" id="5530284">!=</span>&nbsp;<span class="ident" id="5530287">nil</span>&nbsp;<span class="op" id="5530291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5530295">env</span>&nbsp;<span class="op" id="5530299">=</span>&nbsp;<span class="builtinfunc" id="5530301">append</span><span class="op" id="5530307">(</span><span class="ident" id="5530308">env</span><span class="op" id="5530311">,</span>&nbsp;<span class="string" id="5530313">&#34;HTTPS=on&#34;</span><span class="op" id="5530323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5530326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5530330">for</span>&nbsp;<span class="ident" id="5530334">k</span><span class="op" id="5530335">,</span>&nbsp;<span class="ident" id="5530337">v</span>&nbsp;<span class="op" id="5530339">:=</span>&nbsp;<span class="keyword" id="5530342">range</span>&nbsp;<span class="ident" id="5530348">req</span><span class="op" id="5530351">.</span><span class="ident" id="5530352">Header</span>&nbsp;<span class="op" id="5530359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5530363">k</span>&nbsp;<span class="op" id="5530365">=</span>&nbsp;<span class="ident" id="5530367">strings</span><span class="op" id="5530374">.</span><span class="ident" id="5530375">Map</span><span class="op" id="5530378">(</span><span class="ident" id="5530379">upperCaseAndUnderscore</span><span class="op" id="5530401">,</span>&nbsp;<span class="ident" id="5530403">k</span><span class="op" id="5530404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5530408">joinStr</span>&nbsp;<span class="op" id="5530416">:=</span>&nbsp;<span class="string" id="5530419">&#34;,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5530426">if</span>&nbsp;<span class="ident" id="5530429">k</span>&nbsp;<span class="op" id="5530431">==</span>&nbsp;<span class="string" id="5530434">&#34;COOKIE&#34;</span>&nbsp;<span class="op" id="5530443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5530448">joinStr</span>&nbsp;<span class="op" id="5530456">=</span>&nbsp;<span class="string" id="5530458">&#34;;&nbsp;&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5530465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5530469">env</span>&nbsp;<span class="op" id="5530473">=</span>&nbsp;<span class="builtinfunc" id="5530475">append</span><span class="op" id="5530481">(</span><span class="ident" id="5530482">env</span><span class="op" id="5530485">,</span>&nbsp;<span class="string" id="5530487">&#34;HTTP_&#34;</span><span class="op" id="5530494">+</span><span class="ident" id="5530495">k</span><span class="op" id="5530496">+</span><span class="string" id="5530497">&#34;=&#34;</span><span class="op" id="5530500">+</span><span class="ident" id="5530501">strings</span><span class="op" id="5530508">.</span><span class="ident" id="5530509">Join</span><span class="op" id="5530513">(</span><span class="ident" id="5530514">v</span><span class="op" id="5530515">,</span>&nbsp;<span class="ident" id="5530517">joinStr</span><span class="op" id="5530524">)</span><span class="op" id="5530525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5530528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5530532">if</span>&nbsp;<span class="ident" id="5530535">req</span><span class="op" id="5530538">.</span><span class="ident" id="5530539">ContentLength</span>&nbsp;<span class="op" id="5530553">&gt;</span>&nbsp;<span class="num" id="5530555">0</span>&nbsp;<span class="op" id="5530557">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5530561">env</span>&nbsp;<span class="op" id="5530565">=</span>&nbsp;<span class="builtinfunc" id="5530567">append</span><span class="op" id="5530573">(</span><span class="ident" id="5530574">env</span><span class="op" id="5530577">,</span>&nbsp;<span class="ident" id="5530579">fmt</span><span class="op" id="5530582">.</span><span class="ident" id="5530583">Sprintf</span><span class="op" id="5530590">(</span><span class="string" id="5530591">&#34;CONTENT_LENGTH=%d&#34;</span><span class="op" id="5530610">,</span>&nbsp;<span class="ident" id="5530612">req</span><span class="op" id="5530615">.</span><span class="ident" id="5530616">ContentLength</span><span class="op" id="5530629">)</span><span class="op" id="5530630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5530633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5530636">if</span>&nbsp;<span class="ident" id="5530639">ctype</span>&nbsp;<span class="op" id="5530645">:=</span>&nbsp;<span class="ident" id="5530648">req</span><span class="op" id="5530651">.</span><span class="ident" id="5530652">Header</span><span class="op" id="5530658">.</span><span class="ident" id="5530659">Get</span><span class="op" id="5530662">(</span><span class="string" id="5530663">&#34;Content-Type&#34;</span><span class="op" id="5530677">)</span><span class="op" id="5530678">;</span>&nbsp;<span class="ident" id="5530680">ctype</span>&nbsp;<span class="op" id="5530686">!=</span>&nbsp;<span class="string" id="5530689">&#34;&#34;</span>&nbsp;<span class="op" id="5530692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5530696">env</span>&nbsp;<span class="op" id="5530700">=</span>&nbsp;<span class="builtinfunc" id="5530702">append</span><span class="op" id="5530708">(</span><span class="ident" id="5530709">env</span><span class="op" id="5530712">,</span>&nbsp;<span class="string" id="5530714">&#34;CONTENT_TYPE=&#34;</span><span class="op" id="5530729">+</span><span class="ident" id="5530730">ctype</span><span class="op" id="5530735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5530738">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5530742">if</span>&nbsp;<span class="ident" id="5530745">h</span><span class="op" id="5530746">.</span><span class="ident" id="5530747">Env</span>&nbsp;<span class="op" id="5530751">!=</span>&nbsp;<span class="ident" id="5530754">nil</span>&nbsp;<span class="op" id="5530758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5530762">env</span>&nbsp;<span class="op" id="5530766">=</span>&nbsp;<span class="builtinfunc" id="5530768">append</span><span class="op" id="5530774">(</span><span class="ident" id="5530775">env</span><span class="op" id="5530778">,</span>&nbsp;<span class="ident" id="5530780">h</span><span class="op" id="5530781">.</span><span class="ident" id="5530782">Env</span><span class="op" id="5530785">...</span><span class="op" id="5530788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5530791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5530795">envPath</span>&nbsp;<span class="op" id="5530803">:=</span>&nbsp;<span class="ident" id="5530806">os</span><span class="op" id="5530808">.</span><span class="ident" id="5530809">Getenv</span><span class="op" id="5530815">(</span><span class="string" id="5530816">&#34;PATH&#34;</span><span class="op" id="5530822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5530825">if</span>&nbsp;<span class="ident" id="5530828">envPath</span>&nbsp;<span class="op" id="5530836">==</span>&nbsp;<span class="string" id="5530839">&#34;&#34;</span>&nbsp;<span class="op" id="5530842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5530846">envPath</span>&nbsp;<span class="op" id="5530854">=</span>&nbsp;<span class="string" id="5530856">&#34;/bin:/usr/bin:/usr/ucb:/usr/bsd:/usr/local/bin&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5530906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5530909">env</span>&nbsp;<span class="op" id="5530913">=</span>&nbsp;<span class="builtinfunc" id="5530915">append</span><span class="op" id="5530921">(</span><span class="ident" id="5530922">env</span><span class="op" id="5530925">,</span>&nbsp;<span class="string" id="5530927">&#34;PATH=&#34;</span><span class="op" id="5530934">+</span><span class="ident" id="5530935">envPath</span><span class="op" id="5530942">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5530946">for</span>&nbsp;<span class="ident" id="5530950">_</span><span class="op" id="5530951">,</span>&nbsp;<span class="ident" id="5530953">e</span>&nbsp;<span class="op" id="5530955">:=</span>&nbsp;<span class="keyword" id="5530958">range</span>&nbsp;<span class="ident" id="5530964">h</span><span class="op" id="5530965">.</span><span class="ident" id="5530966">InheritEnv</span>&nbsp;<span class="op" id="5530977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5530981">if</span>&nbsp;<span class="ident" id="5530984">v</span>&nbsp;<span class="op" id="5530986">:=</span>&nbsp;<span class="ident" id="5530989">os</span><span class="op" id="5530991">.</span><span class="ident" id="5530992">Getenv</span><span class="op" id="5530998">(</span><span class="ident" id="5530999">e</span><span class="op" id="5531000">)</span><span class="op" id="5531001">;</span>&nbsp;<span class="ident" id="5531003">v</span>&nbsp;<span class="op" id="5531005">!=</span>&nbsp;<span class="string" id="5531008">&#34;&#34;</span>&nbsp;<span class="op" id="5531011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531016">env</span>&nbsp;<span class="op" id="5531020">=</span>&nbsp;<span class="builtinfunc" id="5531022">append</span><span class="op" id="5531028">(</span><span class="ident" id="5531029">env</span><span class="op" id="5531032">,</span>&nbsp;<span class="ident" id="5531034">e</span><span class="op" id="5531035">+</span><span class="string" id="5531036">&#34;=&#34;</span><span class="op" id="5531039">+</span><span class="ident" id="5531040">v</span><span class="op" id="5531041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5531045">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5531048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5531052">for</span>&nbsp;<span class="ident" id="5531056">_</span><span class="op" id="5531057">,</span>&nbsp;<span class="ident" id="5531059">e</span>&nbsp;<span class="op" id="5531061">:=</span>&nbsp;<span class="keyword" id="5531064">range</span>&nbsp;<span class="ident" id="5531070">osDefaultInheritEnv</span><span class="op" id="5531089">[</span><span class="ident" id="5531090">runtime</span><span class="op" id="5531097">.</span><span class="ident" id="5531098">GOOS</span><span class="op" id="5531102">]</span>&nbsp;<span class="op" id="5531104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5531108">if</span>&nbsp;<span class="ident" id="5531111">v</span>&nbsp;<span class="op" id="5531113">:=</span>&nbsp;<span class="ident" id="5531116">os</span><span class="op" id="5531118">.</span><span class="ident" id="5531119">Getenv</span><span class="op" id="5531125">(</span><span class="ident" id="5531126">e</span><span class="op" id="5531127">)</span><span class="op" id="5531128">;</span>&nbsp;<span class="ident" id="5531130">v</span>&nbsp;<span class="op" id="5531132">!=</span>&nbsp;<span class="string" id="5531135">&#34;&#34;</span>&nbsp;<span class="op" id="5531138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531143">env</span>&nbsp;<span class="op" id="5531147">=</span>&nbsp;<span class="builtinfunc" id="5531149">append</span><span class="op" id="5531155">(</span><span class="ident" id="5531156">env</span><span class="op" id="5531159">,</span>&nbsp;<span class="ident" id="5531161">e</span><span class="op" id="5531162">+</span><span class="string" id="5531163">&#34;=&#34;</span><span class="op" id="5531166">+</span><span class="ident" id="5531167">v</span><span class="op" id="5531168">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5531172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5531175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531179">env</span>&nbsp;<span class="op" id="5531183">=</span>&nbsp;<span class="ident" id="5531185">removeLeadingDuplicates</span><span class="op" id="5531208">(</span><span class="ident" id="5531209">env</span><span class="op" id="5531212">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5531216">var</span>&nbsp;<span class="ident" id="5531220">cwd</span><span class="op" id="5531223">,</span>&nbsp;<span class="ident" id="5531225">path</span>&nbsp;<span class="builtintype" id="5531230">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5531238">if</span>&nbsp;<span class="ident" id="5531241">h</span><span class="op" id="5531242">.</span><span class="ident" id="5531243">Dir</span>&nbsp;<span class="op" id="5531247">!=</span>&nbsp;<span class="string" id="5531250">&#34;&#34;</span>&nbsp;<span class="op" id="5531253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531257">path</span>&nbsp;<span class="op" id="5531262">=</span>&nbsp;<span class="ident" id="5531264">h</span><span class="op" id="5531265">.</span><span class="ident" id="5531266">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531273">cwd</span>&nbsp;<span class="op" id="5531277">=</span>&nbsp;<span class="ident" id="5531279">h</span><span class="op" id="5531280">.</span><span class="ident" id="5531281">Dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5531286">}</span>&nbsp;<span class="keyword" id="5531288">else</span>&nbsp;<span class="op" id="5531293">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531297">cwd</span><span class="op" id="5531300">,</span>&nbsp;<span class="ident" id="5531302">path</span>&nbsp;<span class="op" id="5531307">=</span>&nbsp;<span class="ident" id="5531309">filepath</span><span class="op" id="5531317">.</span><span class="ident" id="5531318">Split</span><span class="op" id="5531323">(</span><span class="ident" id="5531324">h</span><span class="op" id="5531325">.</span><span class="ident" id="5531326">Path</span><span class="op" id="5531330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5531333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5531336">if</span>&nbsp;<span class="ident" id="5531339">cwd</span>&nbsp;<span class="op" id="5531343">==</span>&nbsp;<span class="string" id="5531346">&#34;&#34;</span>&nbsp;<span class="op" id="5531349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531353">cwd</span>&nbsp;<span class="op" id="5531357">=</span>&nbsp;<span class="string" id="5531359">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5531364">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531368">internalError</span>&nbsp;<span class="op" id="5531382">:=</span>&nbsp;<span class="keyword" id="5531385">func</span><span class="op" id="5531389">(</span><span class="ident" id="5531390">err</span>&nbsp;<span class="builtintype" id="5531394">error</span><span class="op" id="5531399">)</span>&nbsp;<span class="op" id="5531401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531405">rw</span><span class="op" id="5531407">.</span><span class="ident" id="5531408">WriteHeader</span><span class="op" id="5531419">(</span><span class="ident" id="5531420">http</span><span class="op" id="5531424">.</span><span class="ident" id="5531425">StatusInternalServerError</span><span class="op" id="5531450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531454">h</span><span class="op" id="5531455">.</span><span class="ident" id="5531456">printf</span><span class="op" id="5531462">(</span><span class="string" id="5531463">&#34;CGI&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="5531478">,</span>&nbsp;<span class="ident" id="5531480">err</span><span class="op" id="5531483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5531486">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531490">cmd</span>&nbsp;<span class="op" id="5531494">:=</span>&nbsp;<span class="op" id="5531497">&amp;</span><span class="ident" id="5531498">exec</span><span class="op" id="5531502">.</span><span class="ident" id="5531503">Cmd</span><span class="op" id="5531506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531510">Path</span><span class="op" id="5531514">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5531518">path</span><span class="op" id="5531522">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531526">Args</span><span class="op" id="5531530">:</span>&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5531534">append</span><span class="op" id="5531540">(</span><span class="op" id="5531541">[</span><span class="op" id="5531542">]</span><span class="builtintype" id="5531543">string</span><span class="op" id="5531549">{</span><span class="ident" id="5531550">h</span><span class="op" id="5531551">.</span><span class="ident" id="5531552">Path</span><span class="op" id="5531556">}</span><span class="op" id="5531557">,</span>&nbsp;<span class="ident" id="5531559">h</span><span class="op" id="5531560">.</span><span class="ident" id="5531561">Args</span><span class="op" id="5531565">...</span><span class="op" id="5531568">)</span><span class="op" id="5531569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531573">Dir</span><span class="op" id="5531576">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531581">cwd</span><span class="op" id="5531584">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531588">Env</span><span class="op" id="5531591">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531596">env</span><span class="op" id="5531599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531603">Stderr</span><span class="op" id="5531609">:</span>&nbsp;<span class="ident" id="5531611">os</span><span class="op" id="5531613">.</span><span class="ident" id="5531614">Stderr</span><span class="op" id="5531620">,</span>&nbsp;<span class="comment" id="5531622">//&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5531634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5531637">if</span>&nbsp;<span class="ident" id="5531640">req</span><span class="op" id="5531643">.</span><span class="ident" id="5531644">ContentLength</span>&nbsp;<span class="op" id="5531658">!=</span>&nbsp;<span class="num" id="5531661">0</span>&nbsp;<span class="op" id="5531663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531667">cmd</span><span class="op" id="5531670">.</span><span class="ident" id="5531671">Stdin</span>&nbsp;<span class="op" id="5531677">=</span>&nbsp;<span class="ident" id="5531679">req</span><span class="op" id="5531682">.</span><span class="ident" id="5531683">Body</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5531689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531692">stdoutRead</span><span class="op" id="5531702">,</span>&nbsp;<span class="ident" id="5531704">err</span>&nbsp;<span class="op" id="5531708">:=</span>&nbsp;<span class="ident" id="5531711">cmd</span><span class="op" id="5531714">.</span><span class="ident" id="5531715">StdoutPipe</span><span class="op" id="5531725">(</span><span class="op" id="5531726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5531729">if</span>&nbsp;<span class="ident" id="5531732">err</span>&nbsp;<span class="op" id="5531736">!=</span>&nbsp;<span class="ident" id="5531739">nil</span>&nbsp;<span class="op" id="5531743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531747">internalError</span><span class="op" id="5531760">(</span><span class="ident" id="5531761">err</span><span class="op" id="5531764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5531768">return</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5531776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531780">err</span>&nbsp;<span class="op" id="5531784">=</span>&nbsp;<span class="ident" id="5531786">cmd</span><span class="op" id="5531789">.</span><span class="ident" id="5531790">Start</span><span class="op" id="5531795">(</span><span class="op" id="5531796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5531799">if</span>&nbsp;<span class="ident" id="5531802">err</span>&nbsp;<span class="op" id="5531806">!=</span>&nbsp;<span class="ident" id="5531809">nil</span>&nbsp;<span class="op" id="5531813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531817">internalError</span><span class="op" id="5531830">(</span><span class="ident" id="5531831">err</span><span class="op" id="5531834">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5531838">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5531846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5531849">if</span>&nbsp;<span class="ident" id="5531852">hook</span>&nbsp;<span class="op" id="5531857">:=</span>&nbsp;<span class="ident" id="5531860">testHookStartProcess</span><span class="op" id="5531880">;</span>&nbsp;<span class="ident" id="5531882">hook</span>&nbsp;<span class="op" id="5531887">!=</span>&nbsp;<span class="ident" id="5531890">nil</span>&nbsp;<span class="op" id="5531894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531898">hook</span><span class="op" id="5531902">(</span><span class="ident" id="5531903">cmd</span><span class="op" id="5531906">.</span><span class="ident" id="5531907">Process</span><span class="op" id="5531914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5531917">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5531920">defer</span>&nbsp;<span class="ident" id="5531926">cmd</span><span class="op" id="5531929">.</span><span class="ident" id="5531930">Wait</span><span class="op" id="5531934">(</span><span class="op" id="5531935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5531938">defer</span>&nbsp;<span class="ident" id="5531944">stdoutRead</span><span class="op" id="5531954">.</span><span class="ident" id="5531955">Close</span><span class="op" id="5531960">(</span><span class="op" id="5531961">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5531965">linebody</span>&nbsp;<span class="op" id="5531974">:=</span>&nbsp;<span class="ident" id="5531977">bufio</span><span class="op" id="5531982">.</span><span class="ident" id="5531983">NewReaderSize</span><span class="op" id="5531996">(</span><span class="ident" id="5531997">stdoutRead</span><span class="op" id="5532007">,</span>&nbsp;<span class="num" id="5532009">1024</span><span class="op" id="5532013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532016">headers</span>&nbsp;<span class="op" id="5532024">:=</span>&nbsp;<span class="builtinfunc" id="5532027">make</span><span class="op" id="5532031">(</span><span class="ident" id="5532032">http</span><span class="op" id="5532036">.</span><span class="ident" id="5532037">Header</span><span class="op" id="5532043">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532046">statusCode</span>&nbsp;<span class="op" id="5532057">:=</span>&nbsp;<span class="num" id="5532060">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532063">headerLines</span>&nbsp;<span class="op" id="5532075">:=</span>&nbsp;<span class="num" id="5532078">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532081">sawBlankLine</span>&nbsp;<span class="op" id="5532094">:=</span>&nbsp;<span class="builtintype" id="5532097">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5532104">for</span>&nbsp;<span class="op" id="5532108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532112">line</span><span class="op" id="5532116">,</span>&nbsp;<span class="ident" id="5532118">isPrefix</span><span class="op" id="5532126">,</span>&nbsp;<span class="ident" id="5532128">err</span>&nbsp;<span class="op" id="5532132">:=</span>&nbsp;<span class="ident" id="5532135">linebody</span><span class="op" id="5532143">.</span><span class="ident" id="5532144">ReadLine</span><span class="op" id="5532152">(</span><span class="op" id="5532153">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5532157">if</span>&nbsp;<span class="ident" id="5532160">isPrefix</span>&nbsp;<span class="op" id="5532169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532174">rw</span><span class="op" id="5532176">.</span><span class="ident" id="5532177">WriteHeader</span><span class="op" id="5532188">(</span><span class="ident" id="5532189">http</span><span class="op" id="5532193">.</span><span class="ident" id="5532194">StatusInternalServerError</span><span class="op" id="5532219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532224">h</span><span class="op" id="5532225">.</span><span class="ident" id="5532226">printf</span><span class="op" id="5532232">(</span><span class="string" id="5532233">&#34;cgi:&nbsp;long&nbsp;header&nbsp;line&nbsp;from&nbsp;subprocess.&#34;</span><span class="op" id="5532273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5532278">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5532287">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5532291">if</span>&nbsp;<span class="ident" id="5532294">err</span>&nbsp;<span class="op" id="5532298">==</span>&nbsp;<span class="ident" id="5532301">io</span><span class="op" id="5532303">.</span><span class="ident" id="5532304">EOF</span>&nbsp;<span class="op" id="5532308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5532313">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5532321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5532325">if</span>&nbsp;<span class="ident" id="5532328">err</span>&nbsp;<span class="op" id="5532332">!=</span>&nbsp;<span class="ident" id="5532335">nil</span>&nbsp;<span class="op" id="5532339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532344">rw</span><span class="op" id="5532346">.</span><span class="ident" id="5532347">WriteHeader</span><span class="op" id="5532358">(</span><span class="ident" id="5532359">http</span><span class="op" id="5532363">.</span><span class="ident" id="5532364">StatusInternalServerError</span><span class="op" id="5532389">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532394">h</span><span class="op" id="5532395">.</span><span class="ident" id="5532396">printf</span><span class="op" id="5532402">(</span><span class="string" id="5532403">&#34;cgi:&nbsp;error&nbsp;reading&nbsp;headers:&nbsp;%v&#34;</span><span class="op" id="5532435">,</span>&nbsp;<span class="ident" id="5532437">err</span><span class="op" id="5532440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5532445">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5532454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5532458">if</span>&nbsp;<span class="builtinfunc" id="5532461">len</span><span class="op" id="5532464">(</span><span class="ident" id="5532465">line</span><span class="op" id="5532469">)</span>&nbsp;<span class="op" id="5532471">==</span>&nbsp;<span class="num" id="5532474">0</span>&nbsp;<span class="op" id="5532476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532481">sawBlankLine</span>&nbsp;<span class="op" id="5532494">=</span>&nbsp;<span class="builtintype" id="5532496">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5532504">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5532512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532516">headerLines</span><span class="op" id="5532527">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532532">parts</span>&nbsp;<span class="op" id="5532538">:=</span>&nbsp;<span class="ident" id="5532541">strings</span><span class="op" id="5532548">.</span><span class="ident" id="5532549">SplitN</span><span class="op" id="5532555">(</span><span class="builtintype" id="5532556">string</span><span class="op" id="5532562">(</span><span class="ident" id="5532563">line</span><span class="op" id="5532567">)</span><span class="op" id="5532568">,</span>&nbsp;<span class="string" id="5532570">&#34;:&#34;</span><span class="op" id="5532573">,</span>&nbsp;<span class="num" id="5532575">2</span><span class="op" id="5532576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5532580">if</span>&nbsp;<span class="builtinfunc" id="5532583">len</span><span class="op" id="5532586">(</span><span class="ident" id="5532587">parts</span><span class="op" id="5532592">)</span>&nbsp;<span class="op" id="5532594">&lt;</span>&nbsp;<span class="num" id="5532596">2</span>&nbsp;<span class="op" id="5532598">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532603">h</span><span class="op" id="5532604">.</span><span class="ident" id="5532605">printf</span><span class="op" id="5532611">(</span><span class="string" id="5532612">&#34;cgi:&nbsp;bogus&nbsp;header&nbsp;line:&nbsp;%s&#34;</span><span class="op" id="5532640">,</span>&nbsp;<span class="builtintype" id="5532642">string</span><span class="op" id="5532648">(</span><span class="ident" id="5532649">line</span><span class="op" id="5532653">)</span><span class="op" id="5532654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5532659">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5532670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532674">header</span><span class="op" id="5532680">,</span>&nbsp;<span class="ident" id="5532682">val</span>&nbsp;<span class="op" id="5532686">:=</span>&nbsp;<span class="ident" id="5532689">parts</span><span class="op" id="5532694">[</span><span class="num" id="5532695">0</span><span class="op" id="5532696">]</span><span class="op" id="5532697">,</span>&nbsp;<span class="ident" id="5532699">parts</span><span class="op" id="5532704">[</span><span class="num" id="5532705">1</span><span class="op" id="5532706">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532710">header</span>&nbsp;<span class="op" id="5532717">=</span>&nbsp;<span class="ident" id="5532719">strings</span><span class="op" id="5532726">.</span><span class="ident" id="5532727">TrimSpace</span><span class="op" id="5532736">(</span><span class="ident" id="5532737">header</span><span class="op" id="5532743">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532747">val</span>&nbsp;<span class="op" id="5532751">=</span>&nbsp;<span class="ident" id="5532753">strings</span><span class="op" id="5532760">.</span><span class="ident" id="5532761">TrimSpace</span><span class="op" id="5532770">(</span><span class="ident" id="5532771">val</span><span class="op" id="5532774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5532778">switch</span>&nbsp;<span class="op" id="5532785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5532789">case</span>&nbsp;<span class="ident" id="5532794">header</span>&nbsp;<span class="op" id="5532801">==</span>&nbsp;<span class="string" id="5532804">&#34;Status&#34;</span><span class="op" id="5532812">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5532817">if</span>&nbsp;<span class="builtinfunc" id="5532820">len</span><span class="op" id="5532823">(</span><span class="ident" id="5532824">val</span><span class="op" id="5532827">)</span>&nbsp;<span class="op" id="5532829">&lt;</span>&nbsp;<span class="num" id="5532831">3</span>&nbsp;<span class="op" id="5532833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532839">h</span><span class="op" id="5532840">.</span><span class="ident" id="5532841">printf</span><span class="op" id="5532847">(</span><span class="string" id="5532848">&#34;cgi:&nbsp;bogus&nbsp;status&nbsp;(short):&nbsp;%q&#34;</span><span class="op" id="5532879">,</span>&nbsp;<span class="ident" id="5532881">val</span><span class="op" id="5532884">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5532890">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5532900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532905">code</span><span class="op" id="5532909">,</span>&nbsp;<span class="ident" id="5532911">err</span>&nbsp;<span class="op" id="5532915">:=</span>&nbsp;<span class="ident" id="5532918">strconv</span><span class="op" id="5532925">.</span><span class="ident" id="5532926">Atoi</span><span class="op" id="5532930">(</span><span class="ident" id="5532931">val</span><span class="op" id="5532934">[</span><span class="num" id="5532935">0</span><span class="op" id="5532936">:</span><span class="num" id="5532937">3</span><span class="op" id="5532938">]</span><span class="op" id="5532939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5532944">if</span>&nbsp;<span class="ident" id="5532947">err</span>&nbsp;<span class="op" id="5532951">!=</span>&nbsp;<span class="ident" id="5532954">nil</span>&nbsp;<span class="op" id="5532958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532964">h</span><span class="op" id="5532965">.</span><span class="ident" id="5532966">printf</span><span class="op" id="5532972">(</span><span class="string" id="5532973">&#34;cgi:&nbsp;bogus&nbsp;status:&nbsp;%q&#34;</span><span class="op" id="5532996">,</span>&nbsp;<span class="ident" id="5532998">val</span><span class="op" id="5533001">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5533007">h</span><span class="op" id="5533008">.</span><span class="ident" id="5533009">printf</span><span class="op" id="5533015">(</span><span class="string" id="5533016">&#34;cgi:&nbsp;line&nbsp;was&nbsp;%q&#34;</span><span class="op" id="5533034">,</span>&nbsp;<span class="ident" id="5533036">line</span><span class="op" id="5533040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5533046">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5533056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5533061">statusCode</span>&nbsp;<span class="op" id="5533072">=</span>&nbsp;<span class="ident" id="5533074">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5533081">default</span><span class="op" id="5533088">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5533093">headers</span><span class="op" id="5533100">.</span><span class="ident" id="5533101">Add</span><span class="op" id="5533104">(</span><span class="ident" id="5533105">header</span><span class="op" id="5533111">,</span>&nbsp;<span class="ident" id="5533113">val</span><span class="op" id="5533116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5533120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5533123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5533126">if</span>&nbsp;<span class="ident" id="5533129">headerLines</span>&nbsp;<span class="op" id="5533141">==</span>&nbsp;<span class="num" id="5533144">0</span>&nbsp;<span class="op" id="5533146">||</span>&nbsp;<span class="op" id="5533149">!</span><span class="ident" id="5533150">sawBlankLine</span>&nbsp;<span class="op" id="5533163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5533167">rw</span><span class="op" id="5533169">.</span><span class="ident" id="5533170">WriteHeader</span><span class="op" id="5533181">(</span><span class="ident" id="5533182">http</span><span class="op" id="5533186">.</span><span class="ident" id="5533187">StatusInternalServerError</span><span class="op" id="5533212">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5533216">h</span><span class="op" id="5533217">.</span><span class="ident" id="5533218">printf</span><span class="op" id="5533224">(</span><span class="string" id="5533225">&#34;cgi:&nbsp;no&nbsp;headers&#34;</span><span class="op" id="5533242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5533246">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5533254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5533258">if</span>&nbsp;<span class="ident" id="5533261">loc</span>&nbsp;<span class="op" id="5533265">:=</span>&nbsp;<span class="ident" id="5533268">headers</span><span class="op" id="5533275">.</span><span class="ident" id="5533276">Get</span><span class="op" id="5533279">(</span><span class="string" id="5533280">&#34;Location&#34;</span><span class="op" id="5533290">)</span><span class="op" id="5533291">;</span>&nbsp;<span class="ident" id="5533293">loc</span>&nbsp;<span class="op" id="5533297">!=</span>&nbsp;<span class="string" id="5533300">&#34;&#34;</span>&nbsp;<span class="op" id="5533303">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5533307">if</span>&nbsp;<span class="ident" id="5533310">strings</span><span class="op" id="5533317">.</span><span class="ident" id="5533318">HasPrefix</span><span class="op" id="5533327">(</span><span class="ident" id="5533328">loc</span><span class="op" id="5533331">,</span>&nbsp;<span class="string" id="5533333">&#34;/&#34;</span><span class="op" id="5533336">)</span>&nbsp;<span class="op" id="5533338">&amp;&amp;</span>&nbsp;<span class="ident" id="5533341">h</span><span class="op" id="5533342">.</span><span class="ident" id="5533343">PathLocationHandler</span>&nbsp;<span class="op" id="5533363">!=</span>&nbsp;<span class="ident" id="5533366">nil</span>&nbsp;<span class="op" id="5533370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5533375">h</span><span class="op" id="5533376">.</span><span class="ident" id="5533377">handleInternalRedirect</span><span class="op" id="5533399">(</span><span class="ident" id="5533400">rw</span><span class="op" id="5533402">,</span>&nbsp;<span class="ident" id="5533404">req</span><span class="op" id="5533407">,</span>&nbsp;<span class="ident" id="5533409">loc</span><span class="op" id="5533412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5533417">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5533426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5533430">if</span>&nbsp;<span class="ident" id="5533433">statusCode</span>&nbsp;<span class="op" id="5533444">==</span>&nbsp;<span class="num" id="5533447">0</span>&nbsp;<span class="op" id="5533449">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5533454">statusCode</span>&nbsp;<span class="op" id="5533465">=</span>&nbsp;<span class="ident" id="5533467">http</span><span class="op" id="5533471">.</span><span class="ident" id="5533472">StatusFound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5533486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5533489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5533493">if</span>&nbsp;<span class="ident" id="5533496">statusCode</span>&nbsp;<span class="op" id="5533507">==</span>&nbsp;<span class="num" id="5533510">0</span>&nbsp;<span class="op" id="5533512">&amp;&amp;</span>&nbsp;<span class="ident" id="5533515">headers</span><span class="op" id="5533522">.</span><span class="ident" id="5533523">Get</span><span class="op" id="5533526">(</span><span class="string" id="5533527">&#34;Content-Type&#34;</span><span class="op" id="5533541">)</span>&nbsp;<span class="op" id="5533543">==</span>&nbsp;<span class="string" id="5533546">&#34;&#34;</span>&nbsp;<span class="op" id="5533549">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5533553">rw</span><span class="op" id="5533555">.</span><span class="ident" id="5533556">WriteHeader</span><span class="op" id="5533567">(</span><span class="ident" id="5533568">http</span><span class="op" id="5533572">.</span><span class="ident" id="5533573">StatusInternalServerError</span><span class="op" id="5533598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5533602">h</span><span class="op" id="5533603">.</span><span class="ident" id="5533604">printf</span><span class="op" id="5533610">(</span><span class="string" id="5533611">&#34;cgi:&nbsp;missing&nbsp;required&nbsp;Content-Type&nbsp;in&nbsp;headers&#34;</span><span class="op" id="5533658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5533662">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5533670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5533674">if</span>&nbsp;<span class="ident" id="5533677">statusCode</span>&nbsp;<span class="op" id="5533688">==</span>&nbsp;<span class="num" id="5533691">0</span>&nbsp;<span class="op" id="5533693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5533697">statusCode</span>&nbsp;<span class="op" id="5533708">=</span>&nbsp;<span class="ident" id="5533710">http</span><span class="op" id="5533714">.</span><span class="ident" id="5533715">StatusOK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5533725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5533729">//&nbsp;Copy&nbsp;headers&nbsp;to&nbsp;rw&#39;s&nbsp;headers,&nbsp;after&nbsp;we&#39;ve&nbsp;decided&nbsp;not&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5533790">//&nbsp;go&nbsp;into&nbsp;handleInternalRedirect,&nbsp;which&nbsp;won&#39;t&nbsp;want&nbsp;its&nbsp;rw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5533850">//&nbsp;headers&nbsp;to&nbsp;have&nbsp;been&nbsp;touched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5533884">for</span>&nbsp;<span class="ident" id="5533888">k</span><span class="op" id="5533889">,</span>&nbsp;<span class="ident" id="5533891">vv</span>&nbsp;<span class="op" id="5533894">:=</span>&nbsp;<span class="keyword" id="5533897">range</span>&nbsp;<span class="ident" id="5533903">headers</span>&nbsp;<span class="op" id="5533911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5533915">for</span>&nbsp;<span class="ident" id="5533919">_</span><span class="op" id="5533920">,</span>&nbsp;<span class="ident" id="5533922">v</span>&nbsp;<span class="op" id="5533924">:=</span>&nbsp;<span class="keyword" id="5533927">range</span>&nbsp;<span class="ident" id="5533933">vv</span>&nbsp;<span class="op" id="5533936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5533941">rw</span><span class="op" id="5533943">.</span><span class="ident" id="5533944">Header</span><span class="op" id="5533950">(</span><span class="op" id="5533951">)</span><span class="op" id="5533952">.</span><span class="ident" id="5533953">Add</span><span class="op" id="5533956">(</span><span class="ident" id="5533957">k</span><span class="op" id="5533958">,</span>&nbsp;<span class="ident" id="5533960">v</span><span class="op" id="5533961">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5533965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5533968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5533972">rw</span><span class="op" id="5533974">.</span><span class="ident" id="5533975">WriteHeader</span><span class="op" id="5533986">(</span><span class="ident" id="5533987">statusCode</span><span class="op" id="5533997">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534001">_</span><span class="op" id="5534002">,</span>&nbsp;<span class="ident" id="5534004">err</span>&nbsp;<span class="op" id="5534008">=</span>&nbsp;<span class="ident" id="5534010">io</span><span class="op" id="5534012">.</span><span class="ident" id="5534013">Copy</span><span class="op" id="5534017">(</span><span class="ident" id="5534018">rw</span><span class="op" id="5534020">,</span>&nbsp;<span class="ident" id="5534022">linebody</span><span class="op" id="5534030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5534033">if</span>&nbsp;<span class="ident" id="5534036">err</span>&nbsp;<span class="op" id="5534040">!=</span>&nbsp;<span class="ident" id="5534043">nil</span>&nbsp;<span class="op" id="5534047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534051">h</span><span class="op" id="5534052">.</span><span class="ident" id="5534053">printf</span><span class="op" id="5534059">(</span><span class="string" id="5534060">&#34;cgi:&nbsp;copy&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="5534081">,</span>&nbsp;<span class="ident" id="5534083">err</span><span class="op" id="5534086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5534090">//&nbsp;And&nbsp;kill&nbsp;the&nbsp;child&nbsp;CGI&nbsp;process&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;hang&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5534146">//&nbsp;the&nbsp;deferred&nbsp;cmd.Wait&nbsp;above&nbsp;if&nbsp;the&nbsp;error&nbsp;was&nbsp;just</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5534201">//&nbsp;the&nbsp;client&nbsp;(rw)&nbsp;going&nbsp;away.&nbsp;If&nbsp;it&nbsp;was&nbsp;a&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5534257">//&nbsp;(because&nbsp;the&nbsp;child&nbsp;died&nbsp;itself),&nbsp;then&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5534310">//&nbsp;kill&nbsp;of&nbsp;an&nbsp;already-dead&nbsp;process&nbsp;is&nbsp;harmless&nbsp;(the&nbsp;PID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5534368">//&nbsp;won&#39;t&nbsp;be&nbsp;reused&nbsp;until&nbsp;the&nbsp;Wait&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534412">cmd</span><span class="op" id="5534415">.</span><span class="ident" id="5534416">Process</span><span class="op" id="5534423">.</span><span class="ident" id="5534424">Kill</span><span class="op" id="5534428">(</span><span class="op" id="5534429">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5534432">}</span><br>
<span class="lineno"></span><span class="op" id="5534434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5534437">func</span>&nbsp;<span class="op" id="5534442">(</span><span class="ident" id="5534443">h</span>&nbsp;<span class="op" id="5534445">*</span><span class="ident" id="5534446">Handler</span><span class="op" id="5534453">)</span>&nbsp;<span class="ident" id="5534455">printf</span><span class="op" id="5534461">(</span><span class="ident" id="5534462">format</span>&nbsp;<span class="builtintype" id="5534469">string</span><span class="op" id="5534475">,</span>&nbsp;<span class="ident" id="5534477">v</span>&nbsp;<span class="op" id="5534479">...</span><span class="keyword" id="5534482">interface</span><span class="op" id="5534491">{</span><span class="op" id="5534492">}</span><span class="op" id="5534493">)</span>&nbsp;<span class="op" id="5534495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5534498">if</span>&nbsp;<span class="ident" id="5534501">h</span><span class="op" id="5534502">.</span><span class="ident" id="5534503">Logger</span>&nbsp;<span class="op" id="5534510">!=</span>&nbsp;<span class="ident" id="5534513">nil</span>&nbsp;<span class="op" id="5534517">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534521">h</span><span class="op" id="5534522">.</span><span class="ident" id="5534523">Logger</span><span class="op" id="5534529">.</span><span class="ident" id="5534530">Printf</span><span class="op" id="5534536">(</span><span class="ident" id="5534537">format</span><span class="op" id="5534543">,</span>&nbsp;<span class="ident" id="5534545">v</span><span class="op" id="5534546">...</span><span class="op" id="5534549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5534552">}</span>&nbsp;<span class="keyword" id="5534554">else</span>&nbsp;<span class="op" id="5534559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534563">log</span><span class="op" id="5534566">.</span><span class="ident" id="5534567">Printf</span><span class="op" id="5534573">(</span><span class="ident" id="5534574">format</span><span class="op" id="5534580">,</span>&nbsp;<span class="ident" id="5534582">v</span><span class="op" id="5534583">...</span><span class="op" id="5534586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5534589">}</span><br>
<span class="lineno"></span><span class="op" id="5534591">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="5534594">func</span>&nbsp;<span class="op" id="5534599">(</span><span class="ident" id="5534600">h</span>&nbsp;<span class="op" id="5534602">*</span><span class="ident" id="5534603">Handler</span><span class="op" id="5534610">)</span>&nbsp;<span class="ident" id="5534612">handleInternalRedirect</span><span class="op" id="5534634">(</span><span class="ident" id="5534635">rw</span>&nbsp;<span class="ident" id="5534638">http</span><span class="op" id="5534642">.</span><span class="ident" id="5534643">ResponseWriter</span><span class="op" id="5534657">,</span>&nbsp;<span class="ident" id="5534659">req</span>&nbsp;<span class="op" id="5534663">*</span><span class="ident" id="5534664">http</span><span class="op" id="5534668">.</span><span class="ident" id="5534669">Request</span><span class="op" id="5534676">,</span>&nbsp;<span class="ident" id="5534678">path</span>&nbsp;<span class="builtintype" id="5534683">string</span><span class="op" id="5534689">)</span>&nbsp;<span class="op" id="5534691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534694">url</span><span class="op" id="5534697">,</span>&nbsp;<span class="ident" id="5534699">err</span>&nbsp;<span class="op" id="5534703">:=</span>&nbsp;<span class="ident" id="5534706">req</span><span class="op" id="5534709">.</span><span class="ident" id="5534710">URL</span><span class="op" id="5534713">.</span><span class="ident" id="5534714">Parse</span><span class="op" id="5534719">(</span><span class="ident" id="5534720">path</span><span class="op" id="5534724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5534727">if</span>&nbsp;<span class="ident" id="5534730">err</span>&nbsp;<span class="op" id="5534734">!=</span>&nbsp;<span class="ident" id="5534737">nil</span>&nbsp;<span class="op" id="5534741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534745">rw</span><span class="op" id="5534747">.</span><span class="ident" id="5534748">WriteHeader</span><span class="op" id="5534759">(</span><span class="ident" id="5534760">http</span><span class="op" id="5534764">.</span><span class="ident" id="5534765">StatusInternalServerError</span><span class="op" id="5534790">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534794">h</span><span class="op" id="5534795">.</span><span class="ident" id="5534796">printf</span><span class="op" id="5534802">(</span><span class="string" id="5534803">&#34;cgi:&nbsp;error&nbsp;resolving&nbsp;local&nbsp;URI&nbsp;path&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="5534847">,</span>&nbsp;<span class="ident" id="5534849">path</span><span class="op" id="5534853">,</span>&nbsp;<span class="ident" id="5534855">err</span><span class="op" id="5534858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5534862">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5534870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5534873">//&nbsp;TODO:&nbsp;RFC&nbsp;3875&nbsp;isn&#39;t&nbsp;clear&nbsp;if&nbsp;only&nbsp;GET&nbsp;is&nbsp;supported,&nbsp;but&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5534937">//&nbsp;suggests&nbsp;so:&nbsp;&#34;Note&nbsp;that&nbsp;any&nbsp;message-body&nbsp;attached&nbsp;to&nbsp;the</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5534998">//&nbsp;request&nbsp;(such&nbsp;as&nbsp;for&nbsp;a&nbsp;POST&nbsp;request)&nbsp;may&nbsp;not&nbsp;be&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5535060">//&nbsp;to&nbsp;the&nbsp;resource&nbsp;that&nbsp;is&nbsp;the&nbsp;target&nbsp;of&nbsp;the&nbsp;redirect.&#34;&nbsp;&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5535121">//&nbsp;should&nbsp;do&nbsp;some&nbsp;tests&nbsp;against&nbsp;Apache&nbsp;to&nbsp;see&nbsp;how&nbsp;it&nbsp;handles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5535183">//&nbsp;POST,&nbsp;HEAD,&nbsp;etc.&nbsp;Does&nbsp;the&nbsp;internal&nbsp;redirect&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5535244">//&nbsp;method&nbsp;or&nbsp;just&nbsp;GET?&nbsp;What&nbsp;about&nbsp;incoming&nbsp;headers?</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5535297">//&nbsp;(e.g.&nbsp;Cookies)&nbsp;Which&nbsp;headers,&nbsp;if&nbsp;any,&nbsp;are&nbsp;copied&nbsp;into&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5535359">//&nbsp;second&nbsp;request?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535379">newReq</span>&nbsp;<span class="op" id="5535386">:=</span>&nbsp;<span class="op" id="5535389">&amp;</span><span class="ident" id="5535390">http</span><span class="op" id="5535394">.</span><span class="ident" id="5535395">Request</span><span class="op" id="5535402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535406">Method</span><span class="op" id="5535412">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5535418">&#34;GET&#34;</span><span class="op" id="5535423">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535427">URL</span><span class="op" id="5535430">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535439">url</span><span class="op" id="5535442">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535446">Proto</span><span class="op" id="5535451">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5535458">&#34;HTTP/1.1&#34;</span><span class="op" id="5535468">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535472">ProtoMajor</span><span class="op" id="5535482">:</span>&nbsp;<span class="num" id="5535484">1</span><span class="op" id="5535485">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535489">ProtoMinor</span><span class="op" id="5535499">:</span>&nbsp;<span class="num" id="5535501">1</span><span class="op" id="5535502">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535506">Header</span><span class="op" id="5535512">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5535518">make</span><span class="op" id="5535522">(</span><span class="ident" id="5535523">http</span><span class="op" id="5535527">.</span><span class="ident" id="5535528">Header</span><span class="op" id="5535534">)</span><span class="op" id="5535535">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535539">Host</span><span class="op" id="5535543">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535551">url</span><span class="op" id="5535554">.</span><span class="ident" id="5535555">Host</span><span class="op" id="5535559">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535563">RemoteAddr</span><span class="op" id="5535573">:</span>&nbsp;<span class="ident" id="5535575">req</span><span class="op" id="5535578">.</span><span class="ident" id="5535579">RemoteAddr</span><span class="op" id="5535589">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535593">TLS</span><span class="op" id="5535596">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535605">req</span><span class="op" id="5535608">.</span><span class="ident" id="5535609">TLS</span><span class="op" id="5535612">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5535615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5535618">h</span><span class="op" id="5535619">.</span><span class="ident" id="5535620">PathLocationHandler</span><span class="op" id="5535639">.</span><span class="ident" id="5535640">ServeHTTP</span><span class="op" id="5535649">(</span><span class="ident" id="5535650">rw</span><span class="op" id="5535652">,</span>&nbsp;<span class="ident" id="5535654">newReq</span><span class="op" id="5535660">)</span><br>
<span class="lineno"></span><span class="op" id="5535662">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="5535665">func</span>&nbsp;<span class="ident" id="5535670">upperCaseAndUnderscore</span><span class="op" id="5535692">(</span><span class="ident" id="5535693">r</span>&nbsp;<span class="builtintype" id="5535695">rune</span><span class="op" id="5535699">)</span>&nbsp;<span class="builtintype" id="5535701">rune</span>&nbsp;<span class="op" id="5535706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535709">switch</span>&nbsp;<span class="op" id="5535716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535719">case</span>&nbsp;<span class="ident" id="5535724">r</span>&nbsp;<span class="op" id="5535726">&gt;=</span>&nbsp;<span class="string" id="5535729">&#39;a&#39;</span>&nbsp;<span class="op" id="5535733">&amp;&amp;</span>&nbsp;<span class="ident" id="5535736">r</span>&nbsp;<span class="op" id="5535738">&lt;=</span>&nbsp;<span class="string" id="5535741">&#39;z&#39;</span><span class="op" id="5535744">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535748">return</span>&nbsp;<span class="ident" id="5535755">r</span>&nbsp;<span class="op" id="5535757">-</span>&nbsp;<span class="op" id="5535759">(</span><span class="string" id="5535760">&#39;a&#39;</span>&nbsp;<span class="op" id="5535764">-</span>&nbsp;<span class="string" id="5535766">&#39;A&#39;</span><span class="op" id="5535769">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535772">case</span>&nbsp;<span class="ident" id="5535777">r</span>&nbsp;<span class="op" id="5535779">==</span>&nbsp;<span class="string" id="5535782">&#39;-&#39;</span><span class="op" id="5535785">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535789">return</span>&nbsp;<span class="string" id="5535796">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535801">case</span>&nbsp;<span class="ident" id="5535806">r</span>&nbsp;<span class="op" id="5535808">==</span>&nbsp;<span class="string" id="5535811">&#39;=&#39;</span><span class="op" id="5535814">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5535818">//&nbsp;Maybe&nbsp;not&nbsp;part&nbsp;of&nbsp;the&nbsp;CGI&nbsp;&#39;spec&#39;&nbsp;but&nbsp;would&nbsp;mess&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5535874">//&nbsp;the&nbsp;environment&nbsp;in&nbsp;any&nbsp;case,&nbsp;as&nbsp;Go&nbsp;represents&nbsp;the</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5535929">//&nbsp;environment&nbsp;as&nbsp;a&nbsp;slice&nbsp;of&nbsp;&#34;key=value&#34;&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5535981">return</span>&nbsp;<span class="string" id="5535988">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5535993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5535996">//&nbsp;TODO:&nbsp;other&nbsp;transformations&nbsp;in&nbsp;spec&nbsp;or&nbsp;practice?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5536049">return</span>&nbsp;<span class="ident" id="5536056">r</span><br>
<span class="lineno">375</span><span class="op" id="5536058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5536061">var</span>&nbsp;<span class="ident" id="5536065">testHookStartProcess</span>&nbsp;<span class="keyword" id="5536086">func</span><span class="op" id="5536090">(</span><span class="op" id="5536091">*</span><span class="ident" id="5536092">os</span><span class="op" id="5536094">.</span><span class="ident" id="5536095">Process</span><span class="op" id="5536102">)</span>&nbsp;<span class="comment" id="5536104">//&nbsp;nil&nbsp;except&nbsp;for&nbsp;some&nbsp;tests</span>
</div>
</body>
</html>
