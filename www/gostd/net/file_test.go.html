<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8226903">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8226958">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8227012">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8227063">package</span>&nbsp;<span class="ident" id="8227071">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8227076">import</span>&nbsp;<span class="op" id="8227083">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8227086">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8227092">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8227103">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8227114">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8227124">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8227127">type</span>&nbsp;<span class="ident" id="8227132">listenerFile</span>&nbsp;<span class="keyword" id="8227145">interface</span>&nbsp;<span class="op" id="8227155">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227158">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227168">File</span><span class="op" id="8227172">(</span><span class="op" id="8227173">)</span>&nbsp;<span class="op" id="8227175">(</span><span class="ident" id="8227176">f</span>&nbsp;<span class="op" id="8227178">*</span><span class="ident" id="8227179">os</span><span class="op" id="8227181">.</span><span class="ident" id="8227182">File</span><span class="op" id="8227186">,</span>&nbsp;<span class="ident" id="8227188">err</span>&nbsp;<span class="builtintype" id="8227192">error</span><span class="op" id="8227197">)</span><br>
<span class="lineno"></span><span class="op" id="8227199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8227202">type</span>&nbsp;<span class="ident" id="8227207">packetConnFile</span>&nbsp;<span class="keyword" id="8227222">interface</span>&nbsp;<span class="op" id="8227232">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227235">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227247">File</span><span class="op" id="8227251">(</span><span class="op" id="8227252">)</span>&nbsp;<span class="op" id="8227254">(</span><span class="ident" id="8227255">f</span>&nbsp;<span class="op" id="8227257">*</span><span class="ident" id="8227258">os</span><span class="op" id="8227260">.</span><span class="ident" id="8227261">File</span><span class="op" id="8227265">,</span>&nbsp;<span class="ident" id="8227267">err</span>&nbsp;<span class="builtintype" id="8227271">error</span><span class="op" id="8227276">)</span><br>
<span class="lineno"></span><span class="op" id="8227278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8227281">type</span>&nbsp;<span class="ident" id="8227286">connFile</span>&nbsp;<span class="keyword" id="8227295">interface</span>&nbsp;<span class="op" id="8227305">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227308">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227314">File</span><span class="op" id="8227318">(</span><span class="op" id="8227319">)</span>&nbsp;<span class="op" id="8227321">(</span><span class="ident" id="8227322">f</span>&nbsp;<span class="op" id="8227324">*</span><span class="ident" id="8227325">os</span><span class="op" id="8227327">.</span><span class="ident" id="8227328">File</span><span class="op" id="8227332">,</span>&nbsp;<span class="ident" id="8227334">err</span>&nbsp;<span class="builtintype" id="8227338">error</span><span class="op" id="8227343">)</span><br>
<span class="lineno"></span><span class="op" id="8227345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8227348">func</span>&nbsp;<span class="ident" id="8227353">testFileListener</span><span class="op" id="8227369">(</span><span class="ident" id="8227370">t</span>&nbsp;<span class="op" id="8227372">*</span><span class="ident" id="8227373">testing</span><span class="op" id="8227380">.</span><span class="ident" id="8227381">T</span><span class="op" id="8227382">,</span>&nbsp;<span class="ident" id="8227384">net</span><span class="op" id="8227387">,</span>&nbsp;<span class="ident" id="8227389">laddr</span>&nbsp;<span class="builtintype" id="8227395">string</span><span class="op" id="8227401">)</span>&nbsp;<span class="op" id="8227403">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227406">switch</span>&nbsp;<span class="ident" id="8227413">net</span>&nbsp;<span class="op" id="8227417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227420">case</span>&nbsp;<span class="string" id="8227425">&#34;tcp&#34;</span><span class="op" id="8227430">,</span>&nbsp;<span class="string" id="8227432">&#34;tcp4&#34;</span><span class="op" id="8227438">,</span>&nbsp;<span class="string" id="8227440">&#34;tcp6&#34;</span><span class="op" id="8227446">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227450">laddr</span>&nbsp;<span class="op" id="8227456">+=</span>&nbsp;<span class="string" id="8227459">&#34;:0&#34;</span>&nbsp;<span class="comment" id="8227464">//&nbsp;any&nbsp;available&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8227487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227490">l</span><span class="op" id="8227491">,</span>&nbsp;<span class="ident" id="8227493">err</span>&nbsp;<span class="op" id="8227497">:=</span>&nbsp;<span class="ident" id="8227500">Listen</span><span class="op" id="8227506">(</span><span class="ident" id="8227507">net</span><span class="op" id="8227510">,</span>&nbsp;<span class="ident" id="8227512">laddr</span><span class="op" id="8227517">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227520">if</span>&nbsp;<span class="ident" id="8227523">err</span>&nbsp;<span class="op" id="8227527">!=</span>&nbsp;<span class="ident" id="8227530">nil</span>&nbsp;<span class="op" id="8227534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227538">t</span><span class="op" id="8227539">.</span><span class="ident" id="8227540">Fatalf</span><span class="op" id="8227546">(</span><span class="string" id="8227547">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8227566">,</span>&nbsp;<span class="ident" id="8227568">err</span><span class="op" id="8227571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8227574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227577">defer</span>&nbsp;<span class="ident" id="8227583">l</span><span class="op" id="8227584">.</span><span class="ident" id="8227585">Close</span><span class="op" id="8227590">(</span><span class="op" id="8227591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227594">lf</span>&nbsp;<span class="op" id="8227597">:=</span>&nbsp;<span class="ident" id="8227600">l</span><span class="op" id="8227601">.</span><span class="op" id="8227602">(</span><span class="ident" id="8227603">listenerFile</span><span class="op" id="8227615">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227618">f</span><span class="op" id="8227619">,</span>&nbsp;<span class="ident" id="8227621">err</span>&nbsp;<span class="op" id="8227625">:=</span>&nbsp;<span class="ident" id="8227628">lf</span><span class="op" id="8227630">.</span><span class="ident" id="8227631">File</span><span class="op" id="8227635">(</span><span class="op" id="8227636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227639">if</span>&nbsp;<span class="ident" id="8227642">err</span>&nbsp;<span class="op" id="8227646">!=</span>&nbsp;<span class="ident" id="8227649">nil</span>&nbsp;<span class="op" id="8227653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227657">t</span><span class="op" id="8227658">.</span><span class="ident" id="8227659">Fatalf</span><span class="op" id="8227665">(</span><span class="string" id="8227666">&#34;File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8227683">,</span>&nbsp;<span class="ident" id="8227685">err</span><span class="op" id="8227688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8227691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227694">c</span><span class="op" id="8227695">,</span>&nbsp;<span class="ident" id="8227697">err</span>&nbsp;<span class="op" id="8227701">:=</span>&nbsp;<span class="ident" id="8227704">FileListener</span><span class="op" id="8227716">(</span><span class="ident" id="8227717">f</span><span class="op" id="8227718">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227721">if</span>&nbsp;<span class="ident" id="8227724">err</span>&nbsp;<span class="op" id="8227728">!=</span>&nbsp;<span class="ident" id="8227731">nil</span>&nbsp;<span class="op" id="8227735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227739">t</span><span class="op" id="8227740">.</span><span class="ident" id="8227741">Fatalf</span><span class="op" id="8227747">(</span><span class="string" id="8227748">&#34;FileListener&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8227773">,</span>&nbsp;<span class="ident" id="8227775">err</span><span class="op" id="8227778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8227781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227784">if</span>&nbsp;<span class="op" id="8227787">!</span><span class="ident" id="8227788">reflect</span><span class="op" id="8227795">.</span><span class="ident" id="8227796">DeepEqual</span><span class="op" id="8227805">(</span><span class="ident" id="8227806">l</span><span class="op" id="8227807">.</span><span class="ident" id="8227808">Addr</span><span class="op" id="8227812">(</span><span class="op" id="8227813">)</span><span class="op" id="8227814">,</span>&nbsp;<span class="ident" id="8227816">c</span><span class="op" id="8227817">.</span><span class="ident" id="8227818">Addr</span><span class="op" id="8227822">(</span><span class="op" id="8227823">)</span><span class="op" id="8227824">)</span>&nbsp;<span class="op" id="8227826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227830">t</span><span class="op" id="8227831">.</span><span class="ident" id="8227832">Fatalf</span><span class="op" id="8227838">(</span><span class="string" id="8227839">&#34;Addrs&nbsp;not&nbsp;equal:&nbsp;%#v&nbsp;!=&nbsp;%#v&#34;</span><span class="op" id="8227868">,</span>&nbsp;<span class="ident" id="8227870">l</span><span class="op" id="8227871">.</span><span class="ident" id="8227872">Addr</span><span class="op" id="8227876">(</span><span class="op" id="8227877">)</span><span class="op" id="8227878">,</span>&nbsp;<span class="ident" id="8227880">c</span><span class="op" id="8227881">.</span><span class="ident" id="8227882">Addr</span><span class="op" id="8227886">(</span><span class="op" id="8227887">)</span><span class="op" id="8227888">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8227891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227894">if</span>&nbsp;<span class="ident" id="8227897">err</span>&nbsp;<span class="op" id="8227901">:=</span>&nbsp;<span class="ident" id="8227904">c</span><span class="op" id="8227905">.</span><span class="ident" id="8227906">Close</span><span class="op" id="8227911">(</span><span class="op" id="8227912">)</span><span class="op" id="8227913">;</span>&nbsp;<span class="ident" id="8227915">err</span>&nbsp;<span class="op" id="8227919">!=</span>&nbsp;<span class="ident" id="8227922">nil</span>&nbsp;<span class="op" id="8227926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227930">t</span><span class="op" id="8227931">.</span><span class="ident" id="8227932">Fatalf</span><span class="op" id="8227938">(</span><span class="string" id="8227939">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8227957">,</span>&nbsp;<span class="ident" id="8227959">err</span><span class="op" id="8227962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8227965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227968">if</span>&nbsp;<span class="ident" id="8227971">err</span>&nbsp;<span class="op" id="8227975">:=</span>&nbsp;<span class="ident" id="8227978">f</span><span class="op" id="8227979">.</span><span class="ident" id="8227980">Close</span><span class="op" id="8227985">(</span><span class="op" id="8227986">)</span><span class="op" id="8227987">;</span>&nbsp;<span class="ident" id="8227989">err</span>&nbsp;<span class="op" id="8227993">!=</span>&nbsp;<span class="ident" id="8227996">nil</span>&nbsp;<span class="op" id="8228000">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8228004">t</span><span class="op" id="8228005">.</span><span class="ident" id="8228006">Fatalf</span><span class="op" id="8228012">(</span><span class="string" id="8228013">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8228031">,</span>&nbsp;<span class="ident" id="8228033">err</span><span class="op" id="8228036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228039">}</span><br>
<span class="lineno"></span><span class="op" id="8228041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8228044">var</span>&nbsp;<span class="ident" id="8228048">fileListenerTests</span>&nbsp;<span class="op" id="8228066">=</span>&nbsp;<span class="op" id="8228068">[</span><span class="op" id="8228069">]</span><span class="keyword" id="8228070">struct</span>&nbsp;<span class="op" id="8228077">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8228080">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8228086">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8228094">laddr</span>&nbsp;<span class="builtintype" id="8228100">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8228108">ipv6</span>&nbsp;&nbsp;<span class="builtintype" id="8228114">bool</span>&nbsp;<span class="comment" id="8228119">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8228160">linux</span>&nbsp;<span class="builtintype" id="8228166">bool</span>&nbsp;<span class="comment" id="8228171">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="8228225">}</span><span class="op" id="8228226">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228229">{</span><span class="ident" id="8228230">net</span><span class="op" id="8228233">:</span>&nbsp;<span class="string" id="8228235">&#34;tcp&#34;</span><span class="op" id="8228240">,</span>&nbsp;<span class="ident" id="8228242">laddr</span><span class="op" id="8228247">:</span>&nbsp;<span class="string" id="8228249">&#34;&#34;</span><span class="op" id="8228251">}</span><span class="op" id="8228252">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228255">{</span><span class="ident" id="8228256">net</span><span class="op" id="8228259">:</span>&nbsp;<span class="string" id="8228261">&#34;tcp&#34;</span><span class="op" id="8228266">,</span>&nbsp;<span class="ident" id="8228268">laddr</span><span class="op" id="8228273">:</span>&nbsp;<span class="string" id="8228275">&#34;0.0.0.0&#34;</span><span class="op" id="8228284">}</span><span class="op" id="8228285">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228288">{</span><span class="ident" id="8228289">net</span><span class="op" id="8228292">:</span>&nbsp;<span class="string" id="8228294">&#34;tcp&#34;</span><span class="op" id="8228299">,</span>&nbsp;<span class="ident" id="8228301">laddr</span><span class="op" id="8228306">:</span>&nbsp;<span class="string" id="8228308">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8228326">}</span><span class="op" id="8228327">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228330">{</span><span class="ident" id="8228331">net</span><span class="op" id="8228334">:</span>&nbsp;<span class="string" id="8228336">&#34;tcp&#34;</span><span class="op" id="8228341">,</span>&nbsp;<span class="ident" id="8228343">laddr</span><span class="op" id="8228348">:</span>&nbsp;<span class="string" id="8228350">&#34;[::]&#34;</span><span class="op" id="8228356">,</span>&nbsp;<span class="ident" id="8228358">ipv6</span><span class="op" id="8228362">:</span>&nbsp;<span class="builtintype" id="8228364">true</span><span class="op" id="8228368">}</span><span class="op" id="8228369">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228373">{</span><span class="ident" id="8228374">net</span><span class="op" id="8228377">:</span>&nbsp;<span class="string" id="8228379">&#34;tcp&#34;</span><span class="op" id="8228384">,</span>&nbsp;<span class="ident" id="8228386">laddr</span><span class="op" id="8228391">:</span>&nbsp;<span class="string" id="8228393">&#34;127.0.0.1&#34;</span><span class="op" id="8228404">}</span><span class="op" id="8228405">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228408">{</span><span class="ident" id="8228409">net</span><span class="op" id="8228412">:</span>&nbsp;<span class="string" id="8228414">&#34;tcp&#34;</span><span class="op" id="8228419">,</span>&nbsp;<span class="ident" id="8228421">laddr</span><span class="op" id="8228426">:</span>&nbsp;<span class="string" id="8228428">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8228448">}</span><span class="op" id="8228449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228452">{</span><span class="ident" id="8228453">net</span><span class="op" id="8228456">:</span>&nbsp;<span class="string" id="8228458">&#34;tcp&#34;</span><span class="op" id="8228463">,</span>&nbsp;<span class="ident" id="8228465">laddr</span><span class="op" id="8228470">:</span>&nbsp;<span class="string" id="8228472">&#34;[::1]&#34;</span><span class="op" id="8228479">,</span>&nbsp;<span class="ident" id="8228481">ipv6</span><span class="op" id="8228485">:</span>&nbsp;<span class="builtintype" id="8228487">true</span><span class="op" id="8228491">}</span><span class="op" id="8228492">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228496">{</span><span class="ident" id="8228497">net</span><span class="op" id="8228500">:</span>&nbsp;<span class="string" id="8228502">&#34;tcp4&#34;</span><span class="op" id="8228508">,</span>&nbsp;<span class="ident" id="8228510">laddr</span><span class="op" id="8228515">:</span>&nbsp;<span class="string" id="8228517">&#34;&#34;</span><span class="op" id="8228519">}</span><span class="op" id="8228520">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228523">{</span><span class="ident" id="8228524">net</span><span class="op" id="8228527">:</span>&nbsp;<span class="string" id="8228529">&#34;tcp4&#34;</span><span class="op" id="8228535">,</span>&nbsp;<span class="ident" id="8228537">laddr</span><span class="op" id="8228542">:</span>&nbsp;<span class="string" id="8228544">&#34;0.0.0.0&#34;</span><span class="op" id="8228553">}</span><span class="op" id="8228554">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228557">{</span><span class="ident" id="8228558">net</span><span class="op" id="8228561">:</span>&nbsp;<span class="string" id="8228563">&#34;tcp4&#34;</span><span class="op" id="8228569">,</span>&nbsp;<span class="ident" id="8228571">laddr</span><span class="op" id="8228576">:</span>&nbsp;<span class="string" id="8228578">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8228596">}</span><span class="op" id="8228597">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228601">{</span><span class="ident" id="8228602">net</span><span class="op" id="8228605">:</span>&nbsp;<span class="string" id="8228607">&#34;tcp4&#34;</span><span class="op" id="8228613">,</span>&nbsp;<span class="ident" id="8228615">laddr</span><span class="op" id="8228620">:</span>&nbsp;<span class="string" id="8228622">&#34;127.0.0.1&#34;</span><span class="op" id="8228633">}</span><span class="op" id="8228634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228637">{</span><span class="ident" id="8228638">net</span><span class="op" id="8228641">:</span>&nbsp;<span class="string" id="8228643">&#34;tcp4&#34;</span><span class="op" id="8228649">,</span>&nbsp;<span class="ident" id="8228651">laddr</span><span class="op" id="8228656">:</span>&nbsp;<span class="string" id="8228658">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8228678">}</span><span class="op" id="8228679">,</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228683">{</span><span class="ident" id="8228684">net</span><span class="op" id="8228687">:</span>&nbsp;<span class="string" id="8228689">&#34;tcp6&#34;</span><span class="op" id="8228695">,</span>&nbsp;<span class="ident" id="8228697">laddr</span><span class="op" id="8228702">:</span>&nbsp;<span class="string" id="8228704">&#34;&#34;</span><span class="op" id="8228706">,</span>&nbsp;<span class="ident" id="8228708">ipv6</span><span class="op" id="8228712">:</span>&nbsp;<span class="builtintype" id="8228714">true</span><span class="op" id="8228718">}</span><span class="op" id="8228719">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228722">{</span><span class="ident" id="8228723">net</span><span class="op" id="8228726">:</span>&nbsp;<span class="string" id="8228728">&#34;tcp6&#34;</span><span class="op" id="8228734">,</span>&nbsp;<span class="ident" id="8228736">laddr</span><span class="op" id="8228741">:</span>&nbsp;<span class="string" id="8228743">&#34;[::]&#34;</span><span class="op" id="8228749">,</span>&nbsp;<span class="ident" id="8228751">ipv6</span><span class="op" id="8228755">:</span>&nbsp;<span class="builtintype" id="8228757">true</span><span class="op" id="8228761">}</span><span class="op" id="8228762">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228766">{</span><span class="ident" id="8228767">net</span><span class="op" id="8228770">:</span>&nbsp;<span class="string" id="8228772">&#34;tcp6&#34;</span><span class="op" id="8228778">,</span>&nbsp;<span class="ident" id="8228780">laddr</span><span class="op" id="8228785">:</span>&nbsp;<span class="string" id="8228787">&#34;[::1]&#34;</span><span class="op" id="8228794">,</span>&nbsp;<span class="ident" id="8228796">ipv6</span><span class="op" id="8228800">:</span>&nbsp;<span class="builtintype" id="8228802">true</span><span class="op" id="8228806">}</span><span class="op" id="8228807">,</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228811">{</span><span class="ident" id="8228812">net</span><span class="op" id="8228815">:</span>&nbsp;<span class="string" id="8228817">&#34;unix&#34;</span><span class="op" id="8228823">,</span>&nbsp;<span class="ident" id="8228825">laddr</span><span class="op" id="8228830">:</span>&nbsp;<span class="string" id="8228832">&#34;@gotest/net&#34;</span><span class="op" id="8228845">,</span>&nbsp;<span class="ident" id="8228847">linux</span><span class="op" id="8228852">:</span>&nbsp;<span class="builtintype" id="8228854">true</span><span class="op" id="8228858">}</span><span class="op" id="8228859">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228862">{</span><span class="ident" id="8228863">net</span><span class="op" id="8228866">:</span>&nbsp;<span class="string" id="8228868">&#34;unixpacket&#34;</span><span class="op" id="8228880">,</span>&nbsp;<span class="ident" id="8228882">laddr</span><span class="op" id="8228887">:</span>&nbsp;<span class="string" id="8228889">&#34;@gotest/net&#34;</span><span class="op" id="8228902">,</span>&nbsp;<span class="ident" id="8228904">linux</span><span class="op" id="8228909">:</span>&nbsp;<span class="builtintype" id="8228911">true</span><span class="op" id="8228915">}</span><span class="op" id="8228916">,</span><br>
<span class="lineno"></span><span class="op" id="8228918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="8228921">func</span>&nbsp;<span class="ident" id="8228926">TestFileListener</span><span class="op" id="8228942">(</span><span class="ident" id="8228943">t</span>&nbsp;<span class="op" id="8228945">*</span><span class="ident" id="8228946">testing</span><span class="op" id="8228953">.</span><span class="ident" id="8228954">T</span><span class="op" id="8228955">)</span>&nbsp;<span class="op" id="8228957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8228960">switch</span>&nbsp;<span class="ident" id="8228967">runtime</span><span class="op" id="8228974">.</span><span class="ident" id="8228975">GOOS</span>&nbsp;<span class="op" id="8228980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8228983">case</span>&nbsp;<span class="string" id="8228988">&#34;nacl&#34;</span><span class="op" id="8228994">,</span>&nbsp;<span class="string" id="8228996">&#34;windows&#34;</span><span class="op" id="8229005">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8229009">t</span><span class="op" id="8229010">.</span><span class="ident" id="8229011">Skipf</span><span class="op" id="8229016">(</span><span class="string" id="8229017">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8229038">,</span>&nbsp;<span class="ident" id="8229040">runtime</span><span class="op" id="8229047">.</span><span class="ident" id="8229048">GOOS</span><span class="op" id="8229052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8229055">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8229059">for</span>&nbsp;<span class="ident" id="8229063">_</span><span class="op" id="8229064">,</span>&nbsp;<span class="ident" id="8229066">tt</span>&nbsp;<span class="op" id="8229069">:=</span>&nbsp;<span class="keyword" id="8229072">range</span>&nbsp;<span class="ident" id="8229078">fileListenerTests</span>&nbsp;<span class="op" id="8229096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8229100">if</span>&nbsp;<span class="ident" id="8229103">skipServerTest</span><span class="op" id="8229117">(</span><span class="ident" id="8229118">tt</span><span class="op" id="8229120">.</span><span class="ident" id="8229121">net</span><span class="op" id="8229124">,</span>&nbsp;<span class="string" id="8229126">&#34;unix&#34;</span><span class="op" id="8229132">,</span>&nbsp;<span class="ident" id="8229134">tt</span><span class="op" id="8229136">.</span><span class="ident" id="8229137">laddr</span><span class="op" id="8229142">,</span>&nbsp;<span class="ident" id="8229144">tt</span><span class="op" id="8229146">.</span><span class="ident" id="8229147">ipv6</span><span class="op" id="8229151">,</span>&nbsp;<span class="builtintype" id="8229153">false</span><span class="op" id="8229158">,</span>&nbsp;<span class="ident" id="8229160">tt</span><span class="op" id="8229162">.</span><span class="ident" id="8229163">linux</span><span class="op" id="8229168">)</span>&nbsp;<span class="op" id="8229170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8229175">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8229186">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8229190">if</span>&nbsp;<span class="ident" id="8229193">skipServerTest</span><span class="op" id="8229207">(</span><span class="ident" id="8229208">tt</span><span class="op" id="8229210">.</span><span class="ident" id="8229211">net</span><span class="op" id="8229214">,</span>&nbsp;<span class="string" id="8229216">&#34;unixpacket&#34;</span><span class="op" id="8229228">,</span>&nbsp;<span class="ident" id="8229230">tt</span><span class="op" id="8229232">.</span><span class="ident" id="8229233">laddr</span><span class="op" id="8229238">,</span>&nbsp;<span class="ident" id="8229240">tt</span><span class="op" id="8229242">.</span><span class="ident" id="8229243">ipv6</span><span class="op" id="8229247">,</span>&nbsp;<span class="builtintype" id="8229249">false</span><span class="op" id="8229254">,</span>&nbsp;<span class="ident" id="8229256">tt</span><span class="op" id="8229258">.</span><span class="ident" id="8229259">linux</span><span class="op" id="8229264">)</span>&nbsp;<span class="op" id="8229266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8229271">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8229282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8229286">testFileListener</span><span class="op" id="8229302">(</span><span class="ident" id="8229303">t</span><span class="op" id="8229304">,</span>&nbsp;<span class="ident" id="8229306">tt</span><span class="op" id="8229308">.</span><span class="ident" id="8229309">net</span><span class="op" id="8229312">,</span>&nbsp;<span class="ident" id="8229314">tt</span><span class="op" id="8229316">.</span><span class="ident" id="8229317">laddr</span><span class="op" id="8229322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8229325">}</span><br>
<span class="lineno">105</span><span class="op" id="8229327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8229330">func</span>&nbsp;<span class="ident" id="8229335">testFilePacketConn</span><span class="op" id="8229353">(</span><span class="ident" id="8229354">t</span>&nbsp;<span class="op" id="8229356">*</span><span class="ident" id="8229357">testing</span><span class="op" id="8229364">.</span><span class="ident" id="8229365">T</span><span class="op" id="8229366">,</span>&nbsp;<span class="ident" id="8229368">pcf</span>&nbsp;<span class="ident" id="8229372">packetConnFile</span><span class="op" id="8229386">,</span>&nbsp;<span class="ident" id="8229388">listen</span>&nbsp;<span class="builtintype" id="8229395">bool</span><span class="op" id="8229399">)</span>&nbsp;<span class="op" id="8229401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8229404">f</span><span class="op" id="8229405">,</span>&nbsp;<span class="ident" id="8229407">err</span>&nbsp;<span class="op" id="8229411">:=</span>&nbsp;<span class="ident" id="8229414">pcf</span><span class="op" id="8229417">.</span><span class="ident" id="8229418">File</span><span class="op" id="8229422">(</span><span class="op" id="8229423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8229426">if</span>&nbsp;<span class="ident" id="8229429">err</span>&nbsp;<span class="op" id="8229433">!=</span>&nbsp;<span class="ident" id="8229436">nil</span>&nbsp;<span class="op" id="8229440">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8229444">t</span><span class="op" id="8229445">.</span><span class="ident" id="8229446">Fatalf</span><span class="op" id="8229452">(</span><span class="string" id="8229453">&#34;File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8229470">,</span>&nbsp;<span class="ident" id="8229472">err</span><span class="op" id="8229475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8229478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8229481">c</span><span class="op" id="8229482">,</span>&nbsp;<span class="ident" id="8229484">err</span>&nbsp;<span class="op" id="8229488">:=</span>&nbsp;<span class="ident" id="8229491">FilePacketConn</span><span class="op" id="8229505">(</span><span class="ident" id="8229506">f</span><span class="op" id="8229507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8229510">if</span>&nbsp;<span class="ident" id="8229513">err</span>&nbsp;<span class="op" id="8229517">!=</span>&nbsp;<span class="ident" id="8229520">nil</span>&nbsp;<span class="op" id="8229524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8229528">t</span><span class="op" id="8229529">.</span><span class="ident" id="8229530">Fatalf</span><span class="op" id="8229536">(</span><span class="string" id="8229537">&#34;FilePacketConn&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8229564">,</span>&nbsp;<span class="ident" id="8229566">err</span><span class="op" id="8229569">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8229572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8229575">if</span>&nbsp;<span class="op" id="8229578">!</span><span class="ident" id="8229579">reflect</span><span class="op" id="8229586">.</span><span class="ident" id="8229587">DeepEqual</span><span class="op" id="8229596">(</span><span class="ident" id="8229597">pcf</span><span class="op" id="8229600">.</span><span class="ident" id="8229601">LocalAddr</span><span class="op" id="8229610">(</span><span class="op" id="8229611">)</span><span class="op" id="8229612">,</span>&nbsp;<span class="ident" id="8229614">c</span><span class="op" id="8229615">.</span><span class="ident" id="8229616">LocalAddr</span><span class="op" id="8229625">(</span><span class="op" id="8229626">)</span><span class="op" id="8229627">)</span>&nbsp;<span class="op" id="8229629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8229633">t</span><span class="op" id="8229634">.</span><span class="ident" id="8229635">Fatalf</span><span class="op" id="8229641">(</span><span class="string" id="8229642">&#34;LocalAddrs&nbsp;not&nbsp;equal:&nbsp;%#v&nbsp;!=&nbsp;%#v&#34;</span><span class="op" id="8229676">,</span>&nbsp;<span class="ident" id="8229678">pcf</span><span class="op" id="8229681">.</span><span class="ident" id="8229682">LocalAddr</span><span class="op" id="8229691">(</span><span class="op" id="8229692">)</span><span class="op" id="8229693">,</span>&nbsp;<span class="ident" id="8229695">c</span><span class="op" id="8229696">.</span><span class="ident" id="8229697">LocalAddr</span><span class="op" id="8229706">(</span><span class="op" id="8229707">)</span><span class="op" id="8229708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8229711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8229714">if</span>&nbsp;<span class="ident" id="8229717">listen</span>&nbsp;<span class="op" id="8229724">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8229728">if</span>&nbsp;<span class="ident" id="8229731">_</span><span class="op" id="8229732">,</span>&nbsp;<span class="ident" id="8229734">err</span>&nbsp;<span class="op" id="8229738">:=</span>&nbsp;<span class="ident" id="8229741">c</span><span class="op" id="8229742">.</span><span class="ident" id="8229743">WriteTo</span><span class="op" id="8229750">(</span><span class="op" id="8229751">[</span><span class="op" id="8229752">]</span><span class="builtintype" id="8229753">byte</span><span class="op" id="8229757">{</span><span class="op" id="8229758">}</span><span class="op" id="8229759">,</span>&nbsp;<span class="ident" id="8229761">c</span><span class="op" id="8229762">.</span><span class="ident" id="8229763">LocalAddr</span><span class="op" id="8229772">(</span><span class="op" id="8229773">)</span><span class="op" id="8229774">)</span><span class="op" id="8229775">;</span>&nbsp;<span class="ident" id="8229777">err</span>&nbsp;<span class="op" id="8229781">!=</span>&nbsp;<span class="ident" id="8229784">nil</span>&nbsp;<span class="op" id="8229788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8229793">t</span><span class="op" id="8229794">.</span><span class="ident" id="8229795">Fatalf</span><span class="op" id="8229801">(</span><span class="string" id="8229802">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8229822">,</span>&nbsp;<span class="ident" id="8229824">err</span><span class="op" id="8229827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8229831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8229834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8229837">if</span>&nbsp;<span class="ident" id="8229840">err</span>&nbsp;<span class="op" id="8229844">:=</span>&nbsp;<span class="ident" id="8229847">c</span><span class="op" id="8229848">.</span><span class="ident" id="8229849">Close</span><span class="op" id="8229854">(</span><span class="op" id="8229855">)</span><span class="op" id="8229856">;</span>&nbsp;<span class="ident" id="8229858">err</span>&nbsp;<span class="op" id="8229862">!=</span>&nbsp;<span class="ident" id="8229865">nil</span>&nbsp;<span class="op" id="8229869">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8229873">t</span><span class="op" id="8229874">.</span><span class="ident" id="8229875">Fatalf</span><span class="op" id="8229881">(</span><span class="string" id="8229882">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8229900">,</span>&nbsp;<span class="ident" id="8229902">err</span><span class="op" id="8229905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8229908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8229911">if</span>&nbsp;<span class="ident" id="8229914">err</span>&nbsp;<span class="op" id="8229918">:=</span>&nbsp;<span class="ident" id="8229921">f</span><span class="op" id="8229922">.</span><span class="ident" id="8229923">Close</span><span class="op" id="8229928">(</span><span class="op" id="8229929">)</span><span class="op" id="8229930">;</span>&nbsp;<span class="ident" id="8229932">err</span>&nbsp;<span class="op" id="8229936">!=</span>&nbsp;<span class="ident" id="8229939">nil</span>&nbsp;<span class="op" id="8229943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8229947">t</span><span class="op" id="8229948">.</span><span class="ident" id="8229949">Fatalf</span><span class="op" id="8229955">(</span><span class="string" id="8229956">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8229974">,</span>&nbsp;<span class="ident" id="8229976">err</span><span class="op" id="8229979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8229982">}</span><br>
<span class="lineno">130</span><span class="op" id="8229984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8229987">func</span>&nbsp;<span class="ident" id="8229992">testFilePacketConnListen</span><span class="op" id="8230016">(</span><span class="ident" id="8230017">t</span>&nbsp;<span class="op" id="8230019">*</span><span class="ident" id="8230020">testing</span><span class="op" id="8230027">.</span><span class="ident" id="8230028">T</span><span class="op" id="8230029">,</span>&nbsp;<span class="ident" id="8230031">net</span><span class="op" id="8230034">,</span>&nbsp;<span class="ident" id="8230036">laddr</span>&nbsp;<span class="builtintype" id="8230042">string</span><span class="op" id="8230048">)</span>&nbsp;<span class="op" id="8230050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8230053">switch</span>&nbsp;<span class="ident" id="8230060">net</span>&nbsp;<span class="op" id="8230064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8230067">case</span>&nbsp;<span class="string" id="8230072">&#34;udp&#34;</span><span class="op" id="8230077">,</span>&nbsp;<span class="string" id="8230079">&#34;udp4&#34;</span><span class="op" id="8230085">,</span>&nbsp;<span class="string" id="8230087">&#34;udp6&#34;</span><span class="op" id="8230093">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8230097">laddr</span>&nbsp;<span class="op" id="8230103">+=</span>&nbsp;<span class="string" id="8230106">&#34;:0&#34;</span>&nbsp;<span class="comment" id="8230111">//&nbsp;any&nbsp;available&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8230134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8230137">l</span><span class="op" id="8230138">,</span>&nbsp;<span class="ident" id="8230140">err</span>&nbsp;<span class="op" id="8230144">:=</span>&nbsp;<span class="ident" id="8230147">ListenPacket</span><span class="op" id="8230159">(</span><span class="ident" id="8230160">net</span><span class="op" id="8230163">,</span>&nbsp;<span class="ident" id="8230165">laddr</span><span class="op" id="8230170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8230173">if</span>&nbsp;<span class="ident" id="8230176">err</span>&nbsp;<span class="op" id="8230180">!=</span>&nbsp;<span class="ident" id="8230183">nil</span>&nbsp;<span class="op" id="8230187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8230191">t</span><span class="op" id="8230192">.</span><span class="ident" id="8230193">Fatalf</span><span class="op" id="8230199">(</span><span class="string" id="8230200">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8230225">,</span>&nbsp;<span class="ident" id="8230227">err</span><span class="op" id="8230230">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8230233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8230236">testFilePacketConn</span><span class="op" id="8230254">(</span><span class="ident" id="8230255">t</span><span class="op" id="8230256">,</span>&nbsp;<span class="ident" id="8230258">l</span><span class="op" id="8230259">.</span><span class="op" id="8230260">(</span><span class="ident" id="8230261">packetConnFile</span><span class="op" id="8230275">)</span><span class="op" id="8230276">,</span>&nbsp;<span class="builtintype" id="8230278">true</span><span class="op" id="8230282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8230285">if</span>&nbsp;<span class="ident" id="8230288">err</span>&nbsp;<span class="op" id="8230292">:=</span>&nbsp;<span class="ident" id="8230295">l</span><span class="op" id="8230296">.</span><span class="ident" id="8230297">Close</span><span class="op" id="8230302">(</span><span class="op" id="8230303">)</span><span class="op" id="8230304">;</span>&nbsp;<span class="ident" id="8230306">err</span>&nbsp;<span class="op" id="8230310">!=</span>&nbsp;<span class="ident" id="8230313">nil</span>&nbsp;<span class="op" id="8230317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8230321">t</span><span class="op" id="8230322">.</span><span class="ident" id="8230323">Fatalf</span><span class="op" id="8230329">(</span><span class="string" id="8230330">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8230348">,</span>&nbsp;<span class="ident" id="8230350">err</span><span class="op" id="8230353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8230356">}</span><br>
<span class="lineno">145</span><span class="op" id="8230358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8230361">func</span>&nbsp;<span class="ident" id="8230366">testFilePacketConnDial</span><span class="op" id="8230388">(</span><span class="ident" id="8230389">t</span>&nbsp;<span class="op" id="8230391">*</span><span class="ident" id="8230392">testing</span><span class="op" id="8230399">.</span><span class="ident" id="8230400">T</span><span class="op" id="8230401">,</span>&nbsp;<span class="ident" id="8230403">net</span><span class="op" id="8230406">,</span>&nbsp;<span class="ident" id="8230408">raddr</span>&nbsp;<span class="builtintype" id="8230414">string</span><span class="op" id="8230420">)</span>&nbsp;<span class="op" id="8230422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8230425">switch</span>&nbsp;<span class="ident" id="8230432">net</span>&nbsp;<span class="op" id="8230436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8230439">case</span>&nbsp;<span class="string" id="8230444">&#34;udp&#34;</span><span class="op" id="8230449">,</span>&nbsp;<span class="string" id="8230451">&#34;udp4&#34;</span><span class="op" id="8230457">,</span>&nbsp;<span class="string" id="8230459">&#34;udp6&#34;</span><span class="op" id="8230465">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8230469">raddr</span>&nbsp;<span class="op" id="8230475">+=</span>&nbsp;<span class="string" id="8230478">&#34;:12345&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8230488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8230491">c</span><span class="op" id="8230492">,</span>&nbsp;<span class="ident" id="8230494">err</span>&nbsp;<span class="op" id="8230498">:=</span>&nbsp;<span class="ident" id="8230501">Dial</span><span class="op" id="8230505">(</span><span class="ident" id="8230506">net</span><span class="op" id="8230509">,</span>&nbsp;<span class="ident" id="8230511">raddr</span><span class="op" id="8230516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8230519">if</span>&nbsp;<span class="ident" id="8230522">err</span>&nbsp;<span class="op" id="8230526">!=</span>&nbsp;<span class="ident" id="8230529">nil</span>&nbsp;<span class="op" id="8230533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8230537">t</span><span class="op" id="8230538">.</span><span class="ident" id="8230539">Fatalf</span><span class="op" id="8230545">(</span><span class="string" id="8230546">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8230563">,</span>&nbsp;<span class="ident" id="8230565">err</span><span class="op" id="8230568">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8230571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8230574">testFilePacketConn</span><span class="op" id="8230592">(</span><span class="ident" id="8230593">t</span><span class="op" id="8230594">,</span>&nbsp;<span class="ident" id="8230596">c</span><span class="op" id="8230597">.</span><span class="op" id="8230598">(</span><span class="ident" id="8230599">packetConnFile</span><span class="op" id="8230613">)</span><span class="op" id="8230614">,</span>&nbsp;<span class="builtintype" id="8230616">false</span><span class="op" id="8230621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8230624">if</span>&nbsp;<span class="ident" id="8230627">err</span>&nbsp;<span class="op" id="8230631">:=</span>&nbsp;<span class="ident" id="8230634">c</span><span class="op" id="8230635">.</span><span class="ident" id="8230636">Close</span><span class="op" id="8230641">(</span><span class="op" id="8230642">)</span><span class="op" id="8230643">;</span>&nbsp;<span class="ident" id="8230645">err</span>&nbsp;<span class="op" id="8230649">!=</span>&nbsp;<span class="ident" id="8230652">nil</span>&nbsp;<span class="op" id="8230656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8230660">t</span><span class="op" id="8230661">.</span><span class="ident" id="8230662">Fatalf</span><span class="op" id="8230668">(</span><span class="string" id="8230669">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8230687">,</span>&nbsp;<span class="ident" id="8230689">err</span><span class="op" id="8230692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8230695">}</span><br>
<span class="lineno">160</span><span class="op" id="8230697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8230700">var</span>&nbsp;<span class="ident" id="8230704">filePacketConnTests</span>&nbsp;<span class="op" id="8230724">=</span>&nbsp;<span class="op" id="8230726">[</span><span class="op" id="8230727">]</span><span class="keyword" id="8230728">struct</span>&nbsp;<span class="op" id="8230735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8230738">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8230744">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8230752">addr</span>&nbsp;&nbsp;<span class="builtintype" id="8230758">string</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8230766">ipv6</span>&nbsp;&nbsp;<span class="builtintype" id="8230772">bool</span>&nbsp;<span class="comment" id="8230777">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8230818">linux</span>&nbsp;<span class="builtintype" id="8230824">bool</span>&nbsp;<span class="comment" id="8230829">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="8230883">}</span><span class="op" id="8230884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8230887">{</span><span class="ident" id="8230888">net</span><span class="op" id="8230891">:</span>&nbsp;<span class="string" id="8230893">&#34;udp&#34;</span><span class="op" id="8230898">,</span>&nbsp;<span class="ident" id="8230900">addr</span><span class="op" id="8230904">:</span>&nbsp;<span class="string" id="8230906">&#34;127.0.0.1&#34;</span><span class="op" id="8230917">}</span><span class="op" id="8230918">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8230921">{</span><span class="ident" id="8230922">net</span><span class="op" id="8230925">:</span>&nbsp;<span class="string" id="8230927">&#34;udp&#34;</span><span class="op" id="8230932">,</span>&nbsp;<span class="ident" id="8230934">addr</span><span class="op" id="8230938">:</span>&nbsp;<span class="string" id="8230940">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8230960">}</span><span class="op" id="8230961">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8230964">{</span><span class="ident" id="8230965">net</span><span class="op" id="8230968">:</span>&nbsp;<span class="string" id="8230970">&#34;udp&#34;</span><span class="op" id="8230975">,</span>&nbsp;<span class="ident" id="8230977">addr</span><span class="op" id="8230981">:</span>&nbsp;<span class="string" id="8230983">&#34;[::1]&#34;</span><span class="op" id="8230990">,</span>&nbsp;<span class="ident" id="8230992">ipv6</span><span class="op" id="8230996">:</span>&nbsp;<span class="builtintype" id="8230998">true</span><span class="op" id="8231002">}</span><span class="op" id="8231003">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8231007">{</span><span class="ident" id="8231008">net</span><span class="op" id="8231011">:</span>&nbsp;<span class="string" id="8231013">&#34;udp4&#34;</span><span class="op" id="8231019">,</span>&nbsp;<span class="ident" id="8231021">addr</span><span class="op" id="8231025">:</span>&nbsp;<span class="string" id="8231027">&#34;127.0.0.1&#34;</span><span class="op" id="8231038">}</span><span class="op" id="8231039">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8231042">{</span><span class="ident" id="8231043">net</span><span class="op" id="8231046">:</span>&nbsp;<span class="string" id="8231048">&#34;udp4&#34;</span><span class="op" id="8231054">,</span>&nbsp;<span class="ident" id="8231056">addr</span><span class="op" id="8231060">:</span>&nbsp;<span class="string" id="8231062">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8231082">}</span><span class="op" id="8231083">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8231087">{</span><span class="ident" id="8231088">net</span><span class="op" id="8231091">:</span>&nbsp;<span class="string" id="8231093">&#34;udp6&#34;</span><span class="op" id="8231099">,</span>&nbsp;<span class="ident" id="8231101">addr</span><span class="op" id="8231105">:</span>&nbsp;<span class="string" id="8231107">&#34;[::1]&#34;</span><span class="op" id="8231114">,</span>&nbsp;<span class="ident" id="8231116">ipv6</span><span class="op" id="8231120">:</span>&nbsp;<span class="builtintype" id="8231122">true</span><span class="op" id="8231126">}</span><span class="op" id="8231127">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8231131">{</span><span class="ident" id="8231132">net</span><span class="op" id="8231135">:</span>&nbsp;<span class="string" id="8231137">&#34;ip4:icmp&#34;</span><span class="op" id="8231147">,</span>&nbsp;<span class="ident" id="8231149">addr</span><span class="op" id="8231153">:</span>&nbsp;<span class="string" id="8231155">&#34;127.0.0.1&#34;</span><span class="op" id="8231166">}</span><span class="op" id="8231167">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8231171">{</span><span class="ident" id="8231172">net</span><span class="op" id="8231175">:</span>&nbsp;<span class="string" id="8231177">&#34;unixgram&#34;</span><span class="op" id="8231187">,</span>&nbsp;<span class="ident" id="8231189">addr</span><span class="op" id="8231193">:</span>&nbsp;<span class="string" id="8231195">&#34;@gotest3/net&#34;</span><span class="op" id="8231209">,</span>&nbsp;<span class="ident" id="8231211">linux</span><span class="op" id="8231216">:</span>&nbsp;<span class="builtintype" id="8231218">true</span><span class="op" id="8231222">}</span><span class="op" id="8231223">,</span><br>
<span class="lineno">180</span><span class="op" id="8231225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8231228">func</span>&nbsp;<span class="ident" id="8231233">TestFilePacketConn</span><span class="op" id="8231251">(</span><span class="ident" id="8231252">t</span>&nbsp;<span class="op" id="8231254">*</span><span class="ident" id="8231255">testing</span><span class="op" id="8231262">.</span><span class="ident" id="8231263">T</span><span class="op" id="8231264">)</span>&nbsp;<span class="op" id="8231266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8231269">switch</span>&nbsp;<span class="ident" id="8231276">runtime</span><span class="op" id="8231283">.</span><span class="ident" id="8231284">GOOS</span>&nbsp;<span class="op" id="8231289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8231292">case</span>&nbsp;<span class="string" id="8231297">&#34;nacl&#34;</span><span class="op" id="8231303">,</span>&nbsp;<span class="string" id="8231305">&#34;plan9&#34;</span><span class="op" id="8231312">,</span>&nbsp;<span class="string" id="8231314">&#34;windows&#34;</span><span class="op" id="8231323">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8231327">t</span><span class="op" id="8231328">.</span><span class="ident" id="8231329">Skipf</span><span class="op" id="8231334">(</span><span class="string" id="8231335">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8231356">,</span>&nbsp;<span class="ident" id="8231358">runtime</span><span class="op" id="8231365">.</span><span class="ident" id="8231366">GOOS</span><span class="op" id="8231370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8231373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8231377">for</span>&nbsp;<span class="ident" id="8231381">_</span><span class="op" id="8231382">,</span>&nbsp;<span class="ident" id="8231384">tt</span>&nbsp;<span class="op" id="8231387">:=</span>&nbsp;<span class="keyword" id="8231390">range</span>&nbsp;<span class="ident" id="8231396">filePacketConnTests</span>&nbsp;<span class="op" id="8231416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8231420">if</span>&nbsp;<span class="ident" id="8231423">skipServerTest</span><span class="op" id="8231437">(</span><span class="ident" id="8231438">tt</span><span class="op" id="8231440">.</span><span class="ident" id="8231441">net</span><span class="op" id="8231444">,</span>&nbsp;<span class="string" id="8231446">&#34;unixgram&#34;</span><span class="op" id="8231456">,</span>&nbsp;<span class="ident" id="8231458">tt</span><span class="op" id="8231460">.</span><span class="ident" id="8231461">addr</span><span class="op" id="8231465">,</span>&nbsp;<span class="ident" id="8231467">tt</span><span class="op" id="8231469">.</span><span class="ident" id="8231470">ipv6</span><span class="op" id="8231474">,</span>&nbsp;<span class="builtintype" id="8231476">false</span><span class="op" id="8231481">,</span>&nbsp;<span class="ident" id="8231483">tt</span><span class="op" id="8231485">.</span><span class="ident" id="8231486">linux</span><span class="op" id="8231491">)</span>&nbsp;<span class="op" id="8231493">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8231498">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8231509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8231513">if</span>&nbsp;<span class="ident" id="8231516">os</span><span class="op" id="8231518">.</span><span class="ident" id="8231519">Getuid</span><span class="op" id="8231525">(</span><span class="op" id="8231526">)</span>&nbsp;<span class="op" id="8231528">!=</span>&nbsp;<span class="num" id="8231531">0</span>&nbsp;<span class="op" id="8231533">&amp;&amp;</span>&nbsp;<span class="ident" id="8231536">tt</span><span class="op" id="8231538">.</span><span class="ident" id="8231539">net</span>&nbsp;<span class="op" id="8231543">==</span>&nbsp;<span class="string" id="8231546">&#34;ip4:icmp&#34;</span>&nbsp;<span class="op" id="8231557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8231562">t</span><span class="op" id="8231563">.</span><span class="ident" id="8231564">Log</span><span class="op" id="8231567">(</span><span class="string" id="8231568">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="8231597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8231602">continue</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8231613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8231617">testFilePacketConnListen</span><span class="op" id="8231641">(</span><span class="ident" id="8231642">t</span><span class="op" id="8231643">,</span>&nbsp;<span class="ident" id="8231645">tt</span><span class="op" id="8231647">.</span><span class="ident" id="8231648">net</span><span class="op" id="8231651">,</span>&nbsp;<span class="ident" id="8231653">tt</span><span class="op" id="8231655">.</span><span class="ident" id="8231656">addr</span><span class="op" id="8231660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8231664">switch</span>&nbsp;<span class="ident" id="8231671">tt</span><span class="op" id="8231673">.</span><span class="ident" id="8231674">addr</span>&nbsp;<span class="op" id="8231679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8231683">case</span>&nbsp;<span class="string" id="8231688">&#34;&#34;</span><span class="op" id="8231690">,</span>&nbsp;<span class="string" id="8231692">&#34;0.0.0.0&#34;</span><span class="op" id="8231701">,</span>&nbsp;<span class="string" id="8231703">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8231721">,</span>&nbsp;<span class="string" id="8231723">&#34;[::]&#34;</span><span class="op" id="8231729">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8231733">default</span><span class="op" id="8231740">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8231745">if</span>&nbsp;<span class="ident" id="8231748">tt</span><span class="op" id="8231750">.</span><span class="ident" id="8231751">net</span>&nbsp;<span class="op" id="8231755">!=</span>&nbsp;<span class="string" id="8231758">&#34;unixgram&#34;</span>&nbsp;<span class="op" id="8231769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8231775">testFilePacketConnDial</span><span class="op" id="8231797">(</span><span class="ident" id="8231798">t</span><span class="op" id="8231799">,</span>&nbsp;<span class="ident" id="8231801">tt</span><span class="op" id="8231803">.</span><span class="ident" id="8231804">net</span><span class="op" id="8231807">,</span>&nbsp;<span class="ident" id="8231809">tt</span><span class="op" id="8231811">.</span><span class="ident" id="8231812">addr</span><span class="op" id="8231816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8231821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8231825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8231828">}</span><br>
<span class="lineno">205</span><span class="op" id="8231830">}</span>
</div>
</body>
</html>
