<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync/atomic</h2>
<ul>
<li><a href="/gostd/sync/atomic/atomic_test.go.html">atomic_test.go</a></li>
<li><a href="/gostd/sync/atomic/doc.go.html">doc.go</a></li>
<li><a href="/gostd/sync/atomic/value.go.html">value.go</a></li>
<li><a href="/gostd/sync/atomic/value_test.go.html">value_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1633316">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1633372">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1633426">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1633477">//&nbsp;Package&nbsp;atomic&nbsp;provides&nbsp;low-level&nbsp;atomic&nbsp;memory&nbsp;primitives</span><br>
<span class="lineno"></span><span class="comment" id="1633539">//&nbsp;useful&nbsp;for&nbsp;implementing&nbsp;synchronization&nbsp;algorithms.</span><br>
<span class="lineno"></span><span class="comment" id="1633594">//</span><br>
<span class="lineno"></span><span class="comment" id="1633597">//&nbsp;These&nbsp;functions&nbsp;require&nbsp;great&nbsp;care&nbsp;to&nbsp;be&nbsp;used&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="comment" id="1633657">//&nbsp;Except&nbsp;for&nbsp;special,&nbsp;low-level&nbsp;applications,&nbsp;synchronization&nbsp;is&nbsp;better</span><br>
<span class="lineno">10</span><span class="comment" id="1633730">//&nbsp;done&nbsp;with&nbsp;channels&nbsp;or&nbsp;the&nbsp;facilities&nbsp;of&nbsp;the&nbsp;sync&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="1633791">//&nbsp;Share&nbsp;memory&nbsp;by&nbsp;communicating;</span><br>
<span class="lineno"></span><span class="comment" id="1633825">//&nbsp;don&#39;t&nbsp;communicate&nbsp;by&nbsp;sharing&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="1633865">//</span><br>
<span class="lineno"></span><span class="comment" id="1633868">//&nbsp;The&nbsp;swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;SwapT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno">15</span><span class="comment" id="1633941">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1633959">//</span><br>
<span class="lineno"></span><span class="comment" id="1633962">//&nbsp;&nbsp;&nbsp;&nbspold&nbsp;=&nbsp;*addr</span><br>
<span class="lineno"></span><span class="comment" id="1633977">//&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1633992">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;old</span><br>
<span class="lineno">20</span><span class="comment" id="1634006">//</span><br>
<span class="lineno"></span><span class="comment" id="1634009">//&nbsp;The&nbsp;compare-and-swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;CompareAndSwapT</span><br>
<span class="lineno"></span><span class="comment" id="1634079">//&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1634122">//</span><br>
<span class="lineno"></span><span class="comment" id="1634125">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;*addr&nbsp;==&nbsp;old&nbsp;{</span><br>
<span class="lineno">25</span><span class="comment" id="1634146">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1634162">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;true</span><br>
<span class="lineno"></span><span class="comment" id="1634178">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="1634183">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;false</span><br>
<span class="lineno"></span><span class="comment" id="1634199">//</span><br>
<span class="lineno">30</span><span class="comment" id="1634202">//&nbsp;The&nbsp;add&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;AddT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno"></span><span class="comment" id="1634273">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1634291">//</span><br>
<span class="lineno"></span><span class="comment" id="1634294">//&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;+=&nbsp;delta</span><br>
<span class="lineno"></span><span class="comment" id="1634312">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;*addr</span><br>
<span class="lineno">35</span><span class="comment" id="1634328">//</span><br>
<span class="lineno"></span><span class="comment" id="1634331">//&nbsp;The&nbsp;load&nbsp;and&nbsp;store&nbsp;operations,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;LoadT&nbsp;and&nbsp;StoreT</span><br>
<span class="lineno"></span><span class="comment" id="1634401">//&nbsp;functions,&nbsp;are&nbsp;the&nbsp;atomic&nbsp;equivalents&nbsp;of&nbsp;&#34;return&nbsp;*addr&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1634464">//&nbsp;&#34;*addr&nbsp;=&nbsp;val&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1634482">//</span><br>
<span class="lineno">40</span><span class="keyword" id="1634485">package</span>&nbsp;<span class="ident" id="1634493">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1634501">import</span>&nbsp;<span class="op" id="1634508">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1634511">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1634520">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="1634523">//&nbsp;BUG(rsc):&nbsp;On&nbsp;x86-32,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;Pentium&nbsp;MMX.</span><br>
<span class="lineno"></span><span class="comment" id="1634621">//</span><br>
<span class="lineno"></span><span class="comment" id="1634624">//&nbsp;On&nbsp;non-Linux&nbsp;ARM,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;ARMv6k&nbsp;core.</span><br>
<span class="lineno"></span><span class="comment" id="1634719">//</span><br>
<span class="lineno">50</span><span class="comment" id="1634722">//&nbsp;On&nbsp;both&nbsp;ARM&nbsp;and&nbsp;x86-32,&nbsp;it&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;arrange&nbsp;for&nbsp;64-bit</span><br>
<span class="lineno"></span><span class="comment" id="1634805">//&nbsp;alignment&nbsp;of&nbsp;64-bit&nbsp;words&nbsp;accessed&nbsp;atomically.&nbsp;The&nbsp;first&nbsp;word&nbsp;in&nbsp;a&nbsp;global</span><br>
<span class="lineno"></span><span class="comment" id="1634882">//&nbsp;variable&nbsp;or&nbsp;in&nbsp;an&nbsp;allocated&nbsp;struct&nbsp;or&nbsp;slice&nbsp;can&nbsp;be&nbsp;relied&nbsp;upon&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1634954">//&nbsp;64-bit&nbsp;aligned.</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1634974">//&nbsp;SwapInt32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1635058">func</span>&nbsp;<span class="ident" id="1635063">SwapInt32</span><span class="op" id="1635072">(</span><span class="ident" id="1635073">addr</span>&nbsp;<span class="op" id="1635078">*</span><span class="builtintype" id="1635079">int32</span><span class="op" id="1635084">,</span>&nbsp;<span class="builtinfunc" id="1635086">new</span>&nbsp;<span class="builtintype" id="1635090">int32</span><span class="op" id="1635095">)</span>&nbsp;<span class="op" id="1635097">(</span><span class="ident" id="1635098">old</span>&nbsp;<span class="builtintype" id="1635102">int32</span><span class="op" id="1635107">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1635110">//&nbsp;SwapInt64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1635194">func</span>&nbsp;<span class="ident" id="1635199">SwapInt64</span><span class="op" id="1635208">(</span><span class="ident" id="1635209">addr</span>&nbsp;<span class="op" id="1635214">*</span><span class="ident" id="1635215">int64</span><span class="op" id="1635220">,</span>&nbsp;<span class="builtinfunc" id="1635222">new</span>&nbsp;<span class="ident" id="1635226">int64</span><span class="op" id="1635231">)</span>&nbsp;<span class="op" id="1635233">(</span><span class="ident" id="1635234">old</span>&nbsp;<span class="ident" id="1635238">int64</span><span class="op" id="1635243">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="1635246">//&nbsp;SwapUint32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1635331">func</span>&nbsp;<span class="ident" id="1635336">SwapUint32</span><span class="op" id="1635346">(</span><span class="ident" id="1635347">addr</span>&nbsp;<span class="op" id="1635352">*</span><span class="builtintype" id="1635353">uint32</span><span class="op" id="1635359">,</span>&nbsp;<span class="builtinfunc" id="1635361">new</span>&nbsp;<span class="builtintype" id="1635365">uint32</span><span class="op" id="1635371">)</span>&nbsp;<span class="op" id="1635373">(</span><span class="ident" id="1635374">old</span>&nbsp;<span class="builtintype" id="1635378">uint32</span><span class="op" id="1635384">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1635387">//&nbsp;SwapUint64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno">65</span><span class="keyword" id="1635472">func</span>&nbsp;<span class="ident" id="1635477">SwapUint64</span><span class="op" id="1635487">(</span><span class="ident" id="1635488">addr</span>&nbsp;<span class="op" id="1635493">*</span><span class="ident" id="1635494">uint64</span><span class="op" id="1635500">,</span>&nbsp;<span class="builtinfunc" id="1635502">new</span>&nbsp;<span class="ident" id="1635506">uint64</span><span class="op" id="1635512">)</span>&nbsp;<span class="op" id="1635514">(</span><span class="ident" id="1635515">old</span>&nbsp;<span class="ident" id="1635519">uint64</span><span class="op" id="1635525">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1635528">//&nbsp;SwapUintptr&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1635614">func</span>&nbsp;<span class="ident" id="1635619">SwapUintptr</span><span class="op" id="1635630">(</span><span class="ident" id="1635631">addr</span>&nbsp;<span class="op" id="1635636">*</span><span class="builtintype" id="1635637">uintptr</span><span class="op" id="1635644">,</span>&nbsp;<span class="builtinfunc" id="1635646">new</span>&nbsp;<span class="builtintype" id="1635650">uintptr</span><span class="op" id="1635657">)</span>&nbsp;<span class="op" id="1635659">(</span><span class="ident" id="1635660">old</span>&nbsp;<span class="builtintype" id="1635664">uintptr</span><span class="op" id="1635671">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="1635674">//&nbsp;SwapPointer&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1635760">func</span>&nbsp;<span class="ident" id="1635765">SwapPointer</span><span class="op" id="1635776">(</span><span class="ident" id="1635777">addr</span>&nbsp;<span class="op" id="1635782">*</span><span class="ident" id="1635783">unsafe</span><span class="op" id="1635789">.</span><span class="ident" id="1635790">Pointer</span><span class="op" id="1635797">,</span>&nbsp;<span class="builtinfunc" id="1635799">new</span>&nbsp;<span class="ident" id="1635803">unsafe</span><span class="op" id="1635809">.</span><span class="ident" id="1635810">Pointer</span><span class="op" id="1635817">)</span>&nbsp;<span class="op" id="1635819">(</span><span class="ident" id="1635820">old</span>&nbsp;<span class="ident" id="1635824">unsafe</span><span class="op" id="1635830">.</span><span class="ident" id="1635831">Pointer</span><span class="op" id="1635838">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1635841">//&nbsp;CompareAndSwapInt32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int32&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1635924">func</span>&nbsp;<span class="ident" id="1635929">CompareAndSwapInt32</span><span class="op" id="1635948">(</span><span class="ident" id="1635949">addr</span>&nbsp;<span class="op" id="1635954">*</span><span class="builtintype" id="1635955">int32</span><span class="op" id="1635960">,</span>&nbsp;<span class="ident" id="1635962">old</span><span class="op" id="1635965">,</span>&nbsp;<span class="builtinfunc" id="1635967">new</span>&nbsp;<span class="builtintype" id="1635971">int32</span><span class="op" id="1635976">)</span>&nbsp;<span class="op" id="1635978">(</span><span class="ident" id="1635979">swapped</span>&nbsp;<span class="builtintype" id="1635987">bool</span><span class="op" id="1635991">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="1635994">//&nbsp;CompareAndSwapInt64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1636077">func</span>&nbsp;<span class="ident" id="1636082">CompareAndSwapInt64</span><span class="op" id="1636101">(</span><span class="ident" id="1636102">addr</span>&nbsp;<span class="op" id="1636107">*</span><span class="ident" id="1636108">int64</span><span class="op" id="1636113">,</span>&nbsp;<span class="ident" id="1636115">old</span><span class="op" id="1636118">,</span>&nbsp;<span class="builtinfunc" id="1636120">new</span>&nbsp;<span class="ident" id="1636124">int64</span><span class="op" id="1636129">)</span>&nbsp;<span class="op" id="1636131">(</span><span class="ident" id="1636132">swapped</span>&nbsp;<span class="builtintype" id="1636140">bool</span><span class="op" id="1636144">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1636147">//&nbsp;CompareAndSwapUint32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint32&nbsp;value.</span><br>
<span class="lineno">80</span><span class="keyword" id="1636231">func</span>&nbsp;<span class="ident" id="1636236">CompareAndSwapUint32</span><span class="op" id="1636256">(</span><span class="ident" id="1636257">addr</span>&nbsp;<span class="op" id="1636262">*</span><span class="builtintype" id="1636263">uint32</span><span class="op" id="1636269">,</span>&nbsp;<span class="ident" id="1636271">old</span><span class="op" id="1636274">,</span>&nbsp;<span class="builtinfunc" id="1636276">new</span>&nbsp;<span class="builtintype" id="1636280">uint32</span><span class="op" id="1636286">)</span>&nbsp;<span class="op" id="1636288">(</span><span class="ident" id="1636289">swapped</span>&nbsp;<span class="builtintype" id="1636297">bool</span><span class="op" id="1636301">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1636304">//&nbsp;CompareAndSwapUint64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1636388">func</span>&nbsp;<span class="ident" id="1636393">CompareAndSwapUint64</span><span class="op" id="1636413">(</span><span class="ident" id="1636414">addr</span>&nbsp;<span class="op" id="1636419">*</span><span class="ident" id="1636420">uint64</span><span class="op" id="1636426">,</span>&nbsp;<span class="ident" id="1636428">old</span><span class="op" id="1636431">,</span>&nbsp;<span class="builtinfunc" id="1636433">new</span>&nbsp;<span class="ident" id="1636437">uint64</span><span class="op" id="1636443">)</span>&nbsp;<span class="op" id="1636445">(</span><span class="ident" id="1636446">swapped</span>&nbsp;<span class="builtintype" id="1636454">bool</span><span class="op" id="1636458">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1636461">//&nbsp;CompareAndSwapUintptr&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uintptr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1636547">func</span>&nbsp;<span class="ident" id="1636552">CompareAndSwapUintptr</span><span class="op" id="1636573">(</span><span class="ident" id="1636574">addr</span>&nbsp;<span class="op" id="1636579">*</span><span class="builtintype" id="1636580">uintptr</span><span class="op" id="1636587">,</span>&nbsp;<span class="ident" id="1636589">old</span><span class="op" id="1636592">,</span>&nbsp;<span class="builtinfunc" id="1636594">new</span>&nbsp;<span class="builtintype" id="1636598">uintptr</span><span class="op" id="1636605">)</span>&nbsp;<span class="op" id="1636607">(</span><span class="ident" id="1636608">swapped</span>&nbsp;<span class="builtintype" id="1636616">bool</span><span class="op" id="1636620">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1636623">//&nbsp;CompareAndSwapPointer&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;unsafe.Pointer&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1636716">func</span>&nbsp;<span class="ident" id="1636721">CompareAndSwapPointer</span><span class="op" id="1636742">(</span><span class="ident" id="1636743">addr</span>&nbsp;<span class="op" id="1636748">*</span><span class="ident" id="1636749">unsafe</span><span class="op" id="1636755">.</span><span class="ident" id="1636756">Pointer</span><span class="op" id="1636763">,</span>&nbsp;<span class="ident" id="1636765">old</span><span class="op" id="1636768">,</span>&nbsp;<span class="builtinfunc" id="1636770">new</span>&nbsp;<span class="ident" id="1636774">unsafe</span><span class="op" id="1636780">.</span><span class="ident" id="1636781">Pointer</span><span class="op" id="1636788">)</span>&nbsp;<span class="op" id="1636790">(</span><span class="ident" id="1636791">swapped</span>&nbsp;<span class="builtintype" id="1636799">bool</span><span class="op" id="1636803">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="1636806">//&nbsp;AddInt32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1636876">func</span>&nbsp;<span class="ident" id="1636881">AddInt32</span><span class="op" id="1636889">(</span><span class="ident" id="1636890">addr</span>&nbsp;<span class="op" id="1636895">*</span><span class="builtintype" id="1636896">int32</span><span class="op" id="1636901">,</span>&nbsp;<span class="ident" id="1636903">delta</span>&nbsp;<span class="builtintype" id="1636909">int32</span><span class="op" id="1636914">)</span>&nbsp;<span class="op" id="1636916">(</span><span class="builtinfunc" id="1636917">new</span>&nbsp;<span class="builtintype" id="1636921">int32</span><span class="op" id="1636926">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1636929">//&nbsp;AddUint32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">95</span><span class="comment" id="1637000">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1637090">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(0)).</span><br>
<span class="lineno"></span><span class="keyword" id="1637154">func</span>&nbsp;<span class="ident" id="1637159">AddUint32</span><span class="op" id="1637168">(</span><span class="ident" id="1637169">addr</span>&nbsp;<span class="op" id="1637174">*</span><span class="builtintype" id="1637175">uint32</span><span class="op" id="1637181">,</span>&nbsp;<span class="ident" id="1637183">delta</span>&nbsp;<span class="builtintype" id="1637189">uint32</span><span class="op" id="1637195">)</span>&nbsp;<span class="op" id="1637197">(</span><span class="builtinfunc" id="1637198">new</span>&nbsp;<span class="builtintype" id="1637202">uint32</span><span class="op" id="1637208">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1637211">//&nbsp;AddInt64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">100</span><span class="keyword" id="1637281">func</span>&nbsp;<span class="ident" id="1637286">AddInt64</span><span class="op" id="1637294">(</span><span class="ident" id="1637295">addr</span>&nbsp;<span class="op" id="1637300">*</span><span class="ident" id="1637301">int64</span><span class="op" id="1637306">,</span>&nbsp;<span class="ident" id="1637308">delta</span>&nbsp;<span class="ident" id="1637314">int64</span><span class="op" id="1637319">)</span>&nbsp;<span class="op" id="1637321">(</span><span class="builtinfunc" id="1637322">new</span>&nbsp;<span class="ident" id="1637326">int64</span><span class="op" id="1637331">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1637334">//&nbsp;AddUint64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1637405">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1637495">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(0)).</span><br>
<span class="lineno">105</span><span class="keyword" id="1637559">func</span>&nbsp;<span class="ident" id="1637564">AddUint64</span><span class="op" id="1637573">(</span><span class="ident" id="1637574">addr</span>&nbsp;<span class="op" id="1637579">*</span><span class="ident" id="1637580">uint64</span><span class="op" id="1637586">,</span>&nbsp;<span class="ident" id="1637588">delta</span>&nbsp;<span class="ident" id="1637594">uint64</span><span class="op" id="1637600">)</span>&nbsp;<span class="op" id="1637602">(</span><span class="builtinfunc" id="1637603">new</span>&nbsp;<span class="ident" id="1637607">uint64</span><span class="op" id="1637613">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1637616">//&nbsp;AddUintptr&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1637688">func</span>&nbsp;<span class="ident" id="1637693">AddUintptr</span><span class="op" id="1637703">(</span><span class="ident" id="1637704">addr</span>&nbsp;<span class="op" id="1637709">*</span><span class="builtintype" id="1637710">uintptr</span><span class="op" id="1637717">,</span>&nbsp;<span class="ident" id="1637719">delta</span>&nbsp;<span class="builtintype" id="1637725">uintptr</span><span class="op" id="1637732">)</span>&nbsp;<span class="op" id="1637734">(</span><span class="builtinfunc" id="1637735">new</span>&nbsp;<span class="builtintype" id="1637739">uintptr</span><span class="op" id="1637746">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1637749">//&nbsp;LoadInt32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1637786">func</span>&nbsp;<span class="ident" id="1637791">LoadInt32</span><span class="op" id="1637800">(</span><span class="ident" id="1637801">addr</span>&nbsp;<span class="op" id="1637806">*</span><span class="builtintype" id="1637807">int32</span><span class="op" id="1637812">)</span>&nbsp;<span class="op" id="1637814">(</span><span class="ident" id="1637815">val</span>&nbsp;<span class="builtintype" id="1637819">int32</span><span class="op" id="1637824">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1637827">//&nbsp;LoadInt64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1637864">func</span>&nbsp;<span class="ident" id="1637869">LoadInt64</span><span class="op" id="1637878">(</span><span class="ident" id="1637879">addr</span>&nbsp;<span class="op" id="1637884">*</span><span class="ident" id="1637885">int64</span><span class="op" id="1637890">)</span>&nbsp;<span class="op" id="1637892">(</span><span class="ident" id="1637893">val</span>&nbsp;<span class="ident" id="1637897">int64</span><span class="op" id="1637902">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1637905">//&nbsp;LoadUint32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1637943">func</span>&nbsp;<span class="ident" id="1637948">LoadUint32</span><span class="op" id="1637958">(</span><span class="ident" id="1637959">addr</span>&nbsp;<span class="op" id="1637964">*</span><span class="builtintype" id="1637965">uint32</span><span class="op" id="1637971">)</span>&nbsp;<span class="op" id="1637973">(</span><span class="ident" id="1637974">val</span>&nbsp;<span class="builtintype" id="1637978">uint32</span><span class="op" id="1637984">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1637987">//&nbsp;LoadUint64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno">120</span><span class="keyword" id="1638025">func</span>&nbsp;<span class="ident" id="1638030">LoadUint64</span><span class="op" id="1638040">(</span><span class="ident" id="1638041">addr</span>&nbsp;<span class="op" id="1638046">*</span><span class="ident" id="1638047">uint64</span><span class="op" id="1638053">)</span>&nbsp;<span class="op" id="1638055">(</span><span class="ident" id="1638056">val</span>&nbsp;<span class="ident" id="1638060">uint64</span><span class="op" id="1638066">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1638069">//&nbsp;LoadUintptr&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1638108">func</span>&nbsp;<span class="ident" id="1638113">LoadUintptr</span><span class="op" id="1638124">(</span><span class="ident" id="1638125">addr</span>&nbsp;<span class="op" id="1638130">*</span><span class="builtintype" id="1638131">uintptr</span><span class="op" id="1638138">)</span>&nbsp;<span class="op" id="1638140">(</span><span class="ident" id="1638141">val</span>&nbsp;<span class="builtintype" id="1638145">uintptr</span><span class="op" id="1638152">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="1638155">//&nbsp;LoadPointer&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1638194">func</span>&nbsp;<span class="ident" id="1638199">LoadPointer</span><span class="op" id="1638210">(</span><span class="ident" id="1638211">addr</span>&nbsp;<span class="op" id="1638216">*</span><span class="ident" id="1638217">unsafe</span><span class="op" id="1638223">.</span><span class="ident" id="1638224">Pointer</span><span class="op" id="1638231">)</span>&nbsp;<span class="op" id="1638233">(</span><span class="ident" id="1638234">val</span>&nbsp;<span class="ident" id="1638238">unsafe</span><span class="op" id="1638244">.</span><span class="ident" id="1638245">Pointer</span><span class="op" id="1638252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1638255">//&nbsp;StoreInt32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1638303">func</span>&nbsp;<span class="ident" id="1638308">StoreInt32</span><span class="op" id="1638318">(</span><span class="ident" id="1638319">addr</span>&nbsp;<span class="op" id="1638324">*</span><span class="builtintype" id="1638325">int32</span><span class="op" id="1638330">,</span>&nbsp;<span class="ident" id="1638332">val</span>&nbsp;<span class="builtintype" id="1638336">int32</span><span class="op" id="1638341">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1638344">//&nbsp;StoreInt64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1638392">func</span>&nbsp;<span class="ident" id="1638397">StoreInt64</span><span class="op" id="1638407">(</span><span class="ident" id="1638408">addr</span>&nbsp;<span class="op" id="1638413">*</span><span class="ident" id="1638414">int64</span><span class="op" id="1638419">,</span>&nbsp;<span class="ident" id="1638421">val</span>&nbsp;<span class="ident" id="1638425">int64</span><span class="op" id="1638430">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1638433">//&nbsp;StoreUint32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno">135</span><span class="keyword" id="1638482">func</span>&nbsp;<span class="ident" id="1638487">StoreUint32</span><span class="op" id="1638498">(</span><span class="ident" id="1638499">addr</span>&nbsp;<span class="op" id="1638504">*</span><span class="builtintype" id="1638505">uint32</span><span class="op" id="1638511">,</span>&nbsp;<span class="ident" id="1638513">val</span>&nbsp;<span class="builtintype" id="1638517">uint32</span><span class="op" id="1638523">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1638526">//&nbsp;StoreUint64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1638575">func</span>&nbsp;<span class="ident" id="1638580">StoreUint64</span><span class="op" id="1638591">(</span><span class="ident" id="1638592">addr</span>&nbsp;<span class="op" id="1638597">*</span><span class="ident" id="1638598">uint64</span><span class="op" id="1638604">,</span>&nbsp;<span class="ident" id="1638606">val</span>&nbsp;<span class="ident" id="1638610">uint64</span><span class="op" id="1638616">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1638619">//&nbsp;StoreUintptr&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1638669">func</span>&nbsp;<span class="ident" id="1638674">StoreUintptr</span><span class="op" id="1638686">(</span><span class="ident" id="1638687">addr</span>&nbsp;<span class="op" id="1638692">*</span><span class="builtintype" id="1638693">uintptr</span><span class="op" id="1638700">,</span>&nbsp;<span class="ident" id="1638702">val</span>&nbsp;<span class="builtintype" id="1638706">uintptr</span><span class="op" id="1638713">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1638716">//&nbsp;StorePointer&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1638766">func</span>&nbsp;<span class="ident" id="1638771">StorePointer</span><span class="op" id="1638783">(</span><span class="ident" id="1638784">addr</span>&nbsp;<span class="op" id="1638789">*</span><span class="ident" id="1638790">unsafe</span><span class="op" id="1638796">.</span><span class="ident" id="1638797">Pointer</span><span class="op" id="1638804">,</span>&nbsp;<span class="ident" id="1638806">val</span>&nbsp;<span class="ident" id="1638810">unsafe</span><span class="op" id="1638816">.</span><span class="ident" id="1638817">Pointer</span><span class="op" id="1638824">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1638827">//&nbsp;Helper&nbsp;for&nbsp;ARM.&nbsp;&nbsp;Linker&nbsp;will&nbsp;discard&nbsp;on&nbsp;other&nbsp;systems</span><br>
<span class="lineno"></span><span class="keyword" id="1638884">func</span>&nbsp;<span class="ident" id="1638889">panic64</span><span class="op" id="1638896">(</span><span class="op" id="1638897">)</span>&nbsp;<span class="op" id="1638899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1638902">panic</span><span class="op" id="1638907">(</span><span class="string" id="1638908">&#34;sync/atomic:&nbsp;broken&nbsp;64-bit&nbsp;atomic&nbsp;operations&nbsp;(buggy&nbsp;QEMU)&#34;</span><span class="op" id="1638967">)</span><br>
<span class="lineno"></span><span class="op" id="1638969">}</span>
</div>
</body>
</html>
