<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/hmac</h2>
<ul>
<li><a href="/gostd/crypto/hmac/hmac.go.html" class="current">hmac.go</a></li>
<li><a href="/gostd/crypto/hmac/hmac_test.go.html">hmac_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4486069">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4486124">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4486178">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4486229">/*<br>
<span class="lineno"></span>Package&nbsp;hmac&nbsp;implements&nbsp;the&nbsp;Keyed-Hash&nbsp;Message&nbsp;Authentication&nbsp;Code&nbsp;(HMAC)&nbsp;as<br>
<span class="lineno"></span>defined&nbsp;in&nbsp;U.S.&nbsp;Federal&nbsp;Information&nbsp;Processing&nbsp;Standards&nbsp;Publication&nbsp;198.<br>
<span class="lineno"></span>An&nbsp;HMAC&nbsp;is&nbsp;a&nbsp;cryptographic&nbsp;hash&nbsp;that&nbsp;uses&nbsp;a&nbsp;key&nbsp;to&nbsp;sign&nbsp;a&nbsp;message.<br>
<span class="lineno"></span>The&nbsp;receiver&nbsp;verifies&nbsp;the&nbsp;hash&nbsp;by&nbsp;recomputing&nbsp;it&nbsp;using&nbsp;the&nbsp;same&nbsp;key.<br>
<span class="lineno">10</span><br>
<span class="lineno"></span>Receivers&nbsp;should&nbsp;be&nbsp;careful&nbsp;to&nbsp;use&nbsp;Equal&nbsp;to&nbsp;compare&nbsp;MACs&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid<br>
<span class="lineno"></span>timing&nbsp;side-channels:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;CheckMAC&nbsp;returns&nbsp;true&nbsp;if&nbsp;messageMAC&nbsp;is&nbsp;a&nbsp;valid&nbsp;HMAC&nbsp;tag&nbsp;for&nbsp;message.<br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;CheckMAC(message,&nbsp;messageMAC,&nbsp;key&nbsp;[]byte)&nbsp;bool&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mac&nbsp;:=&nbsp;hmac.New(sha256.New,&nbsp;key)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mac.Write(message)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expectedMAC&nbsp;:=&nbsp;mac.Sum(nil)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;hmac.Equal(messageMAC,&nbsp;expectedMAC)<br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="4486883">package</span>&nbsp;<span class="ident" id="4486891">hmac</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4486897">import</span>&nbsp;<span class="op" id="4486904">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4486907">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4486924">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4486931">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4486934">//&nbsp;FIPS&nbsp;198:</span><br>
<span class="lineno">30</span><span class="comment" id="4486947">//&nbsp;http://csrc.nist.gov/publications/fips/fips198/fips-198a.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4487012">//&nbsp;key&nbsp;is&nbsp;zero&nbsp;padded&nbsp;to&nbsp;the&nbsp;block&nbsp;size&nbsp;of&nbsp;the&nbsp;hash&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="4487073">//&nbsp;ipad&nbsp;=&nbsp;0x36&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno"></span><span class="comment" id="4487117">//&nbsp;opad&nbsp;=&nbsp;0x5c&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno">35</span><span class="comment" id="4487161">//&nbsp;hmac&nbsp;=&nbsp;H([key&nbsp;^&nbsp;opad]&nbsp;H([key&nbsp;^&nbsp;ipad]&nbsp;text))</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4487209">type</span>&nbsp;<span class="ident" id="4487214">hmac</span>&nbsp;<span class="keyword" id="4487219">struct</span>&nbsp;<span class="op" id="4487226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487229">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4487242">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487247">blocksize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4487260">int</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487265">key</span><span class="op" id="4487268">,</span>&nbsp;<span class="ident" id="4487270">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4487278">[</span><span class="op" id="4487279">]</span><span class="builtintype" id="4487280">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487286">outer</span><span class="op" id="4487291">,</span>&nbsp;<span class="ident" id="4487293">inner</span>&nbsp;<span class="ident" id="4487299">hash</span><span class="op" id="4487303">.</span><span class="ident" id="4487304">Hash</span><br>
<span class="lineno"></span><span class="op" id="4487309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4487312">func</span>&nbsp;<span class="op" id="4487317">(</span><span class="ident" id="4487318">h</span>&nbsp;<span class="op" id="4487320">*</span><span class="ident" id="4487321">hmac</span><span class="op" id="4487325">)</span>&nbsp;<span class="ident" id="4487327">tmpPad</span><span class="op" id="4487333">(</span><span class="ident" id="4487334">xor</span>&nbsp;<span class="builtintype" id="4487338">byte</span><span class="op" id="4487342">)</span>&nbsp;<span class="op" id="4487344">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4487347">for</span>&nbsp;<span class="ident" id="4487351">i</span><span class="op" id="4487352">,</span>&nbsp;<span class="ident" id="4487354">k</span>&nbsp;<span class="op" id="4487356">:=</span>&nbsp;<span class="keyword" id="4487359">range</span>&nbsp;<span class="ident" id="4487365">h</span><span class="op" id="4487366">.</span><span class="ident" id="4487367">key</span>&nbsp;<span class="op" id="4487371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487375">h</span><span class="op" id="4487376">.</span><span class="ident" id="4487377">tmp</span><span class="op" id="4487380">[</span><span class="ident" id="4487381">i</span><span class="op" id="4487382">]</span>&nbsp;<span class="op" id="4487384">=</span>&nbsp;<span class="ident" id="4487386">xor</span>&nbsp;<span class="op" id="4487390">^</span>&nbsp;<span class="ident" id="4487392">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4487395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4487398">for</span>&nbsp;<span class="ident" id="4487402">i</span>&nbsp;<span class="op" id="4487404">:=</span>&nbsp;<span class="builtinfunc" id="4487407">len</span><span class="op" id="4487410">(</span><span class="ident" id="4487411">h</span><span class="op" id="4487412">.</span><span class="ident" id="4487413">key</span><span class="op" id="4487416">)</span><span class="op" id="4487417">;</span>&nbsp;<span class="ident" id="4487419">i</span>&nbsp;<span class="op" id="4487421">&lt;</span>&nbsp;<span class="ident" id="4487423">h</span><span class="op" id="4487424">.</span><span class="ident" id="4487425">blocksize</span><span class="op" id="4487434">;</span>&nbsp;<span class="ident" id="4487436">i</span><span class="op" id="4487437">++</span>&nbsp;<span class="op" id="4487440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487444">h</span><span class="op" id="4487445">.</span><span class="ident" id="4487446">tmp</span><span class="op" id="4487449">[</span><span class="ident" id="4487450">i</span><span class="op" id="4487451">]</span>&nbsp;<span class="op" id="4487453">=</span>&nbsp;<span class="ident" id="4487455">xor</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4487460">}</span><br>
<span class="lineno"></span><span class="op" id="4487462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4487465">func</span>&nbsp;<span class="op" id="4487470">(</span><span class="ident" id="4487471">h</span>&nbsp;<span class="op" id="4487473">*</span><span class="ident" id="4487474">hmac</span><span class="op" id="4487478">)</span>&nbsp;<span class="ident" id="4487480">Sum</span><span class="op" id="4487483">(</span><span class="ident" id="4487484">in</span>&nbsp;<span class="op" id="4487487">[</span><span class="op" id="4487488">]</span><span class="builtintype" id="4487489">byte</span><span class="op" id="4487493">)</span>&nbsp;<span class="op" id="4487495">[</span><span class="op" id="4487496">]</span><span class="builtintype" id="4487497">byte</span>&nbsp;<span class="op" id="4487502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487505">origLen</span>&nbsp;<span class="op" id="4487513">:=</span>&nbsp;<span class="builtinfunc" id="4487516">len</span><span class="op" id="4487519">(</span><span class="ident" id="4487520">in</span><span class="op" id="4487522">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487525">in</span>&nbsp;<span class="op" id="4487528">=</span>&nbsp;<span class="ident" id="4487530">h</span><span class="op" id="4487531">.</span><span class="ident" id="4487532">inner</span><span class="op" id="4487537">.</span><span class="ident" id="4487538">Sum</span><span class="op" id="4487541">(</span><span class="ident" id="4487542">in</span><span class="op" id="4487544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487547">h</span><span class="op" id="4487548">.</span><span class="ident" id="4487549">tmpPad</span><span class="op" id="4487555">(</span><span class="num" id="4487556">0x5c</span><span class="op" id="4487560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4487563">copy</span><span class="op" id="4487567">(</span><span class="ident" id="4487568">h</span><span class="op" id="4487569">.</span><span class="ident" id="4487570">tmp</span><span class="op" id="4487573">[</span><span class="ident" id="4487574">h</span><span class="op" id="4487575">.</span><span class="ident" id="4487576">blocksize</span><span class="op" id="4487585">:</span><span class="op" id="4487586">]</span><span class="op" id="4487587">,</span>&nbsp;<span class="ident" id="4487589">in</span><span class="op" id="4487591">[</span><span class="ident" id="4487592">origLen</span><span class="op" id="4487599">:</span><span class="op" id="4487600">]</span><span class="op" id="4487601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487604">h</span><span class="op" id="4487605">.</span><span class="ident" id="4487606">outer</span><span class="op" id="4487611">.</span><span class="ident" id="4487612">Reset</span><span class="op" id="4487617">(</span><span class="op" id="4487618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487621">h</span><span class="op" id="4487622">.</span><span class="ident" id="4487623">outer</span><span class="op" id="4487628">.</span><span class="ident" id="4487629">Write</span><span class="op" id="4487634">(</span><span class="ident" id="4487635">h</span><span class="op" id="4487636">.</span><span class="ident" id="4487637">tmp</span><span class="op" id="4487640">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4487643">return</span>&nbsp;<span class="ident" id="4487650">h</span><span class="op" id="4487651">.</span><span class="ident" id="4487652">outer</span><span class="op" id="4487657">.</span><span class="ident" id="4487658">Sum</span><span class="op" id="4487661">(</span><span class="ident" id="4487662">in</span><span class="op" id="4487664">[</span><span class="op" id="4487665">:</span><span class="ident" id="4487666">origLen</span><span class="op" id="4487673">]</span><span class="op" id="4487674">)</span><br>
<span class="lineno"></span><span class="op" id="4487676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4487679">func</span>&nbsp;<span class="op" id="4487684">(</span><span class="ident" id="4487685">h</span>&nbsp;<span class="op" id="4487687">*</span><span class="ident" id="4487688">hmac</span><span class="op" id="4487692">)</span>&nbsp;<span class="ident" id="4487694">Write</span><span class="op" id="4487699">(</span><span class="ident" id="4487700">p</span>&nbsp;<span class="op" id="4487702">[</span><span class="op" id="4487703">]</span><span class="builtintype" id="4487704">byte</span><span class="op" id="4487708">)</span>&nbsp;<span class="op" id="4487710">(</span><span class="ident" id="4487711">n</span>&nbsp;<span class="builtintype" id="4487713">int</span><span class="op" id="4487716">,</span>&nbsp;<span class="ident" id="4487718">err</span>&nbsp;<span class="builtintype" id="4487722">error</span><span class="op" id="4487727">)</span>&nbsp;<span class="op" id="4487729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4487732">return</span>&nbsp;<span class="ident" id="4487739">h</span><span class="op" id="4487740">.</span><span class="ident" id="4487741">inner</span><span class="op" id="4487746">.</span><span class="ident" id="4487747">Write</span><span class="op" id="4487752">(</span><span class="ident" id="4487753">p</span><span class="op" id="4487754">)</span><br>
<span class="lineno">65</span><span class="op" id="4487756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4487759">func</span>&nbsp;<span class="op" id="4487764">(</span><span class="ident" id="4487765">h</span>&nbsp;<span class="op" id="4487767">*</span><span class="ident" id="4487768">hmac</span><span class="op" id="4487772">)</span>&nbsp;<span class="ident" id="4487774">Size</span><span class="op" id="4487778">(</span><span class="op" id="4487779">)</span>&nbsp;<span class="builtintype" id="4487781">int</span>&nbsp;<span class="op" id="4487785">{</span>&nbsp;<span class="keyword" id="4487787">return</span>&nbsp;<span class="ident" id="4487794">h</span><span class="op" id="4487795">.</span><span class="ident" id="4487796">size</span>&nbsp;<span class="op" id="4487801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4487804">func</span>&nbsp;<span class="op" id="4487809">(</span><span class="ident" id="4487810">h</span>&nbsp;<span class="op" id="4487812">*</span><span class="ident" id="4487813">hmac</span><span class="op" id="4487817">)</span>&nbsp;<span class="ident" id="4487819">BlockSize</span><span class="op" id="4487828">(</span><span class="op" id="4487829">)</span>&nbsp;<span class="builtintype" id="4487831">int</span>&nbsp;<span class="op" id="4487835">{</span>&nbsp;<span class="keyword" id="4487837">return</span>&nbsp;<span class="ident" id="4487844">h</span><span class="op" id="4487845">.</span><span class="ident" id="4487846">blocksize</span>&nbsp;<span class="op" id="4487856">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4487859">func</span>&nbsp;<span class="op" id="4487864">(</span><span class="ident" id="4487865">h</span>&nbsp;<span class="op" id="4487867">*</span><span class="ident" id="4487868">hmac</span><span class="op" id="4487872">)</span>&nbsp;<span class="ident" id="4487874">Reset</span><span class="op" id="4487879">(</span><span class="op" id="4487880">)</span>&nbsp;<span class="op" id="4487882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487885">h</span><span class="op" id="4487886">.</span><span class="ident" id="4487887">inner</span><span class="op" id="4487892">.</span><span class="ident" id="4487893">Reset</span><span class="op" id="4487898">(</span><span class="op" id="4487899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487902">h</span><span class="op" id="4487903">.</span><span class="ident" id="4487904">tmpPad</span><span class="op" id="4487910">(</span><span class="num" id="4487911">0x36</span><span class="op" id="4487915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487918">h</span><span class="op" id="4487919">.</span><span class="ident" id="4487920">inner</span><span class="op" id="4487925">.</span><span class="ident" id="4487926">Write</span><span class="op" id="4487931">(</span><span class="ident" id="4487932">h</span><span class="op" id="4487933">.</span><span class="ident" id="4487934">tmp</span><span class="op" id="4487937">[</span><span class="op" id="4487938">:</span><span class="ident" id="4487939">h</span><span class="op" id="4487940">.</span><span class="ident" id="4487941">blocksize</span><span class="op" id="4487950">]</span><span class="op" id="4487951">)</span><br>
<span class="lineno">75</span><span class="op" id="4487953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4487956">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;HMAC&nbsp;hash&nbsp;using&nbsp;the&nbsp;given&nbsp;hash.Hash&nbsp;type&nbsp;and&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4488027">func</span>&nbsp;<span class="ident" id="4488032">New</span><span class="op" id="4488035">(</span><span class="ident" id="4488036">h</span>&nbsp;<span class="keyword" id="4488038">func</span><span class="op" id="4488042">(</span><span class="op" id="4488043">)</span>&nbsp;<span class="ident" id="4488045">hash</span><span class="op" id="4488049">.</span><span class="ident" id="4488050">Hash</span><span class="op" id="4488054">,</span>&nbsp;<span class="ident" id="4488056">key</span>&nbsp;<span class="op" id="4488060">[</span><span class="op" id="4488061">]</span><span class="builtintype" id="4488062">byte</span><span class="op" id="4488066">)</span>&nbsp;<span class="ident" id="4488068">hash</span><span class="op" id="4488072">.</span><span class="ident" id="4488073">Hash</span>&nbsp;<span class="op" id="4488078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488081">hm</span>&nbsp;<span class="op" id="4488084">:=</span>&nbsp;<span class="builtinfunc" id="4488087">new</span><span class="op" id="4488090">(</span><span class="ident" id="4488091">hmac</span><span class="op" id="4488095">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488098">hm</span><span class="op" id="4488100">.</span><span class="ident" id="4488101">outer</span>&nbsp;<span class="op" id="4488107">=</span>&nbsp;<span class="ident" id="4488109">h</span><span class="op" id="4488110">(</span><span class="op" id="4488111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488114">hm</span><span class="op" id="4488116">.</span><span class="ident" id="4488117">inner</span>&nbsp;<span class="op" id="4488123">=</span>&nbsp;<span class="ident" id="4488125">h</span><span class="op" id="4488126">(</span><span class="op" id="4488127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488130">hm</span><span class="op" id="4488132">.</span><span class="ident" id="4488133">size</span>&nbsp;<span class="op" id="4488138">=</span>&nbsp;<span class="ident" id="4488140">hm</span><span class="op" id="4488142">.</span><span class="ident" id="4488143">inner</span><span class="op" id="4488148">.</span><span class="ident" id="4488149">Size</span><span class="op" id="4488153">(</span><span class="op" id="4488154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488157">hm</span><span class="op" id="4488159">.</span><span class="ident" id="4488160">blocksize</span>&nbsp;<span class="op" id="4488170">=</span>&nbsp;<span class="ident" id="4488172">hm</span><span class="op" id="4488174">.</span><span class="ident" id="4488175">inner</span><span class="op" id="4488180">.</span><span class="ident" id="4488181">BlockSize</span><span class="op" id="4488190">(</span><span class="op" id="4488191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488194">hm</span><span class="op" id="4488196">.</span><span class="ident" id="4488197">tmp</span>&nbsp;<span class="op" id="4488201">=</span>&nbsp;<span class="builtinfunc" id="4488203">make</span><span class="op" id="4488207">(</span><span class="op" id="4488208">[</span><span class="op" id="4488209">]</span><span class="builtintype" id="4488210">byte</span><span class="op" id="4488214">,</span>&nbsp;<span class="ident" id="4488216">hm</span><span class="op" id="4488218">.</span><span class="ident" id="4488219">blocksize</span><span class="op" id="4488228">+</span><span class="ident" id="4488229">hm</span><span class="op" id="4488231">.</span><span class="ident" id="4488232">size</span><span class="op" id="4488236">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488239">if</span>&nbsp;<span class="builtinfunc" id="4488242">len</span><span class="op" id="4488245">(</span><span class="ident" id="4488246">key</span><span class="op" id="4488249">)</span>&nbsp;<span class="op" id="4488251">&gt;</span>&nbsp;<span class="ident" id="4488253">hm</span><span class="op" id="4488255">.</span><span class="ident" id="4488256">blocksize</span>&nbsp;<span class="op" id="4488266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4488270">//&nbsp;If&nbsp;key&nbsp;is&nbsp;too&nbsp;big,&nbsp;hash&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488303">hm</span><span class="op" id="4488305">.</span><span class="ident" id="4488306">outer</span><span class="op" id="4488311">.</span><span class="ident" id="4488312">Write</span><span class="op" id="4488317">(</span><span class="ident" id="4488318">key</span><span class="op" id="4488321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488325">key</span>&nbsp;<span class="op" id="4488329">=</span>&nbsp;<span class="ident" id="4488331">hm</span><span class="op" id="4488333">.</span><span class="ident" id="4488334">outer</span><span class="op" id="4488339">.</span><span class="ident" id="4488340">Sum</span><span class="op" id="4488343">(</span><span class="builtintype" id="4488344">nil</span><span class="op" id="4488347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4488350">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488353">hm</span><span class="op" id="4488355">.</span><span class="ident" id="4488356">key</span>&nbsp;<span class="op" id="4488360">=</span>&nbsp;<span class="builtinfunc" id="4488362">make</span><span class="op" id="4488366">(</span><span class="op" id="4488367">[</span><span class="op" id="4488368">]</span><span class="builtintype" id="4488369">byte</span><span class="op" id="4488373">,</span>&nbsp;<span class="builtinfunc" id="4488375">len</span><span class="op" id="4488378">(</span><span class="ident" id="4488379">key</span><span class="op" id="4488382">)</span><span class="op" id="4488383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4488386">copy</span><span class="op" id="4488390">(</span><span class="ident" id="4488391">hm</span><span class="op" id="4488393">.</span><span class="ident" id="4488394">key</span><span class="op" id="4488397">,</span>&nbsp;<span class="ident" id="4488399">key</span><span class="op" id="4488402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488405">hm</span><span class="op" id="4488407">.</span><span class="ident" id="4488408">Reset</span><span class="op" id="4488413">(</span><span class="op" id="4488414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488417">return</span>&nbsp;<span class="ident" id="4488424">hm</span><br>
<span class="lineno"></span><span class="op" id="4488427">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="4488430">//&nbsp;Equal&nbsp;compares&nbsp;two&nbsp;MACs&nbsp;for&nbsp;equality&nbsp;without&nbsp;leaking&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="4488506">func</span>&nbsp;<span class="ident" id="4488511">Equal</span><span class="op" id="4488516">(</span><span class="ident" id="4488517">mac1</span><span class="op" id="4488521">,</span>&nbsp;<span class="ident" id="4488523">mac2</span>&nbsp;<span class="op" id="4488528">[</span><span class="op" id="4488529">]</span><span class="builtintype" id="4488530">byte</span><span class="op" id="4488534">)</span>&nbsp;<span class="builtintype" id="4488536">bool</span>&nbsp;<span class="op" id="4488541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4488544">//&nbsp;We&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;constant&nbsp;time&nbsp;if&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MACs&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4488613">//&nbsp;different&nbsp;as&nbsp;that&nbsp;suggests&nbsp;that&nbsp;a&nbsp;completely&nbsp;different&nbsp;hash&nbsp;function</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4488686">//&nbsp;was&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488700">return</span>&nbsp;<span class="builtinfunc" id="4488707">len</span><span class="op" id="4488710">(</span><span class="ident" id="4488711">mac1</span><span class="op" id="4488715">)</span>&nbsp;<span class="op" id="4488717">==</span>&nbsp;<span class="builtinfunc" id="4488720">len</span><span class="op" id="4488723">(</span><span class="ident" id="4488724">mac2</span><span class="op" id="4488728">)</span>&nbsp;<span class="op" id="4488730">&amp;&amp;</span>&nbsp;<span class="ident" id="4488733">subtle</span><span class="op" id="4488739">.</span><span class="ident" id="4488740">ConstantTimeCompare</span><span class="op" id="4488759">(</span><span class="ident" id="4488760">mac1</span><span class="op" id="4488764">,</span>&nbsp;<span class="ident" id="4488766">mac2</span><span class="op" id="4488770">)</span>&nbsp;<span class="op" id="4488772">==</span>&nbsp;<span class="num" id="4488775">1</span><br>
<span class="lineno"></span><span class="op" id="4488777">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
