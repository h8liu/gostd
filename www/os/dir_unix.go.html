<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2420388">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2420443">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2420497">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2420548">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2420618">package</span>&nbsp;<span class="ident" id="2420626">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2420630">import</span>&nbsp;<span class="op" id="2420637">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2420640">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2420646">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2420656">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2420659">const</span>&nbsp;<span class="op" id="2420665">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420668">blockSize</span>&nbsp;<span class="op" id="2420678">=</span>&nbsp;<span class="num" id="2420680">4096</span><br>
<span class="lineno"></span><span class="op" id="2420685">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2420688">func</span>&nbsp;<span class="op" id="2420693">(</span><span class="ident" id="2420694">f</span>&nbsp;<span class="op" id="2420696">*</span><span class="ident" id="2420697"><a href="/os/file_unix.go.html#2451241">File</a></span><span class="op" id="2420701">)</span>&nbsp;<span class="ident" id="2420703">readdirnames</span><span class="op" id="2420715">(</span><span class="ident" id="2420716">n</span>&nbsp;<span class="builtintype" id="2420718">int</span><span class="op" id="2420721">)</span>&nbsp;<span class="op" id="2420723">(</span><span class="ident" id="2420724">names</span>&nbsp;<span class="op" id="2420730">[</span><span class="op" id="2420731">]</span><span class="builtintype" id="2420732">string</span><span class="op" id="2420738">,</span>&nbsp;<span class="ident" id="2420740">err</span>&nbsp;<span class="builtintype" id="2420744">error</span><span class="op" id="2420749">)</span>&nbsp;<span class="op" id="2420751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2420754">//&nbsp;If&nbsp;this&nbsp;file&nbsp;has&nbsp;no&nbsp;dirinfo,&nbsp;create&nbsp;one.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2420799">if</span>&nbsp;<span class="ident" id="2420802"><a href="/os/dir_unix.go.html#2420694">f</a></span><span class="op" id="2420803">.</span><span class="ident" id="2420804">dirinfo</span>&nbsp;<span class="op" id="2420812">==</span>&nbsp;<span class="ident" id="2420815">nil</span>&nbsp;<span class="op" id="2420819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420823"><a href="/os/dir_unix.go.html#2420694">f</a></span><span class="op" id="2420824">.</span><span class="ident" id="2420825">dirinfo</span>&nbsp;<span class="op" id="2420833">=</span>&nbsp;<span class="builtinfunc" id="2420835">new</span><span class="op" id="2420838">(</span><span class="ident" id="2420839"><a href="/os/file_unix.go.html#2452218">dirInfo</a></span><span class="op" id="2420846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2420850">//&nbsp;The&nbsp;buffer&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;a&nbsp;block&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420897"><a href="/os/dir_unix.go.html#2420694">f</a></span><span class="op" id="2420898">.</span><span class="ident" id="2420899">dirinfo</span><span class="op" id="2420906">.</span><span class="ident" id="2420907">buf</span>&nbsp;<span class="op" id="2420911">=</span>&nbsp;<span class="builtinfunc" id="2420913">make</span><span class="op" id="2420917">(</span><span class="op" id="2420918">[</span><span class="op" id="2420919">]</span><span class="builtintype" id="2420920">byte</span><span class="op" id="2420924">,</span>&nbsp;<span class="ident" id="2420926"><a href="/os/dir_unix.go.html#2420668">blockSize</a></span><span class="op" id="2420935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2420938">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420941">d</span>&nbsp;<span class="op" id="2420943">:=</span>&nbsp;<span class="ident" id="2420946"><a href="/os/dir_unix.go.html#2420694">f</a></span><span class="op" id="2420947">.</span><span class="ident" id="2420948">dirinfo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420958">size</span>&nbsp;<span class="op" id="2420963">:=</span>&nbsp;<span class="ident" id="2420966"><a href="/os/dir_unix.go.html#2420716">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2420969">if</span>&nbsp;<span class="ident" id="2420972"><a href="/os/dir_unix.go.html#2420958">size</a></span>&nbsp;<span class="op" id="2420977">&lt;=</span>&nbsp;<span class="num" id="2420980">0</span>&nbsp;<span class="op" id="2420982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420986"><a href="/os/dir_unix.go.html#2420958">size</a></span>&nbsp;<span class="op" id="2420991">=</span>&nbsp;<span class="num" id="2420993">100</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420999"><a href="/os/dir_unix.go.html#2420716">n</a></span>&nbsp;<span class="op" id="2421001">=</span>&nbsp;<span class="op" id="2421003">-</span><span class="num" id="2421004">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2421007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421011"><a href="/os/dir_unix.go.html#2420724">names</a></span>&nbsp;<span class="op" id="2421017">=</span>&nbsp;<span class="builtinfunc" id="2421019">make</span><span class="op" id="2421023">(</span><span class="op" id="2421024">[</span><span class="op" id="2421025">]</span><span class="builtintype" id="2421026">string</span><span class="op" id="2421032">,</span>&nbsp;<span class="num" id="2421034">0</span><span class="op" id="2421035">,</span>&nbsp;<span class="ident" id="2421037"><a href="/os/dir_unix.go.html#2420958">size</a></span><span class="op" id="2421041">)</span>&nbsp;<span class="comment" id="2421043">//&nbsp;Empty&nbsp;with&nbsp;room&nbsp;to&nbsp;grow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421072">for</span>&nbsp;<span class="ident" id="2421076"><a href="/os/dir_unix.go.html#2420716">n</a></span>&nbsp;<span class="op" id="2421078">!=</span>&nbsp;<span class="num" id="2421081">0</span>&nbsp;<span class="op" id="2421083">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2421087">//&nbsp;Refill&nbsp;the&nbsp;buffer&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421123">if</span>&nbsp;<span class="ident" id="2421126"><a href="/os/dir_unix.go.html#2420941">d</a></span><span class="op" id="2421127">.</span><span class="ident" id="2421128">bufp</span>&nbsp;<span class="op" id="2421133">&gt;=</span>&nbsp;<span class="ident" id="2421136"><a href="/os/dir_unix.go.html#2420941">d</a></span><span class="op" id="2421137">.</span><span class="ident" id="2421138">nbuf</span>&nbsp;<span class="op" id="2421143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421148"><a href="/os/dir_unix.go.html#2420941">d</a></span><span class="op" id="2421149">.</span><span class="ident" id="2421150">bufp</span>&nbsp;<span class="op" id="2421155">=</span>&nbsp;<span class="num" id="2421157">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421162">var</span>&nbsp;<span class="ident" id="2421166">errno</span>&nbsp;<span class="builtintype" id="2421172">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421181"><a href="/os/dir_unix.go.html#2420941">d</a></span><span class="op" id="2421182">.</span><span class="ident" id="2421183">nbuf</span><span class="op" id="2421187">,</span>&nbsp;<span class="ident" id="2421189"><a href="/os/dir_unix.go.html#2421166">errno</a></span>&nbsp;<span class="op" id="2421195">=</span>&nbsp;<span class="ident" id="2421197"><a href="/os/file.go.html#2446627">fixCount</a></span><span class="op" id="2421205">(</span><span class="ident" id="2421206"><a href="/os/dir_unix.go.html#2420646">syscall</a></span><span class="op" id="2421213">.</span><span class="ident" id="2421214">ReadDirent</span><span class="op" id="2421224">(</span><span class="ident" id="2421225"><a href="/os/dir_unix.go.html#2420694">f</a></span><span class="op" id="2421226">.</span><span class="ident" id="2421227">fd</span><span class="op" id="2421229">,</span>&nbsp;<span class="ident" id="2421231"><a href="/os/dir_unix.go.html#2420941">d</a></span><span class="op" id="2421232">.</span><span class="ident" id="2421233">buf</span><span class="op" id="2421236">)</span><span class="op" id="2421237">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421242">if</span>&nbsp;<span class="ident" id="2421245"><a href="/os/dir_unix.go.html#2421166">errno</a></span>&nbsp;<span class="op" id="2421251">!=</span>&nbsp;<span class="ident" id="2421254">nil</span>&nbsp;<span class="op" id="2421258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421264">return</span>&nbsp;<span class="ident" id="2421271"><a href="/os/dir_unix.go.html#2420724">names</a></span><span class="op" id="2421276">,</span>&nbsp;<span class="ident" id="2421278"><a href="/os/error.go.html#2430425">NewSyscallError</a></span><span class="op" id="2421293">(</span><span class="string" id="2421294">&#34;readdirent&#34;</span><span class="op" id="2421306">,</span>&nbsp;<span class="ident" id="2421308"><a href="/os/dir_unix.go.html#2421166">errno</a></span><span class="op" id="2421313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2421318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421323">if</span>&nbsp;<span class="ident" id="2421326"><a href="/os/dir_unix.go.html#2420941">d</a></span><span class="op" id="2421327">.</span><span class="ident" id="2421328">nbuf</span>&nbsp;<span class="op" id="2421333">&lt;=</span>&nbsp;<span class="num" id="2421336">0</span>&nbsp;<span class="op" id="2421338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421344">break</span>&nbsp;<span class="comment" id="2421350">//&nbsp;EOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2421360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2421364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2421369">//&nbsp;Drain&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421391">var</span>&nbsp;<span class="ident" id="2421395">nb</span><span class="op" id="2421397">,</span>&nbsp;<span class="ident" id="2421399">nc</span>&nbsp;<span class="builtintype" id="2421402">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421408"><a href="/os/dir_unix.go.html#2421395">nb</a></span><span class="op" id="2421410">,</span>&nbsp;<span class="ident" id="2421412"><a href="/os/dir_unix.go.html#2421399">nc</a></span><span class="op" id="2421414">,</span>&nbsp;<span class="ident" id="2421416"><a href="/os/dir_unix.go.html#2420724">names</a></span>&nbsp;<span class="op" id="2421422">=</span>&nbsp;<span class="ident" id="2421424"><a href="/os/dir_unix.go.html#2420646">syscall</a></span><span class="op" id="2421431">.</span><span class="ident" id="2421432">ParseDirent</span><span class="op" id="2421443">(</span><span class="ident" id="2421444"><a href="/os/dir_unix.go.html#2420941">d</a></span><span class="op" id="2421445">.</span><span class="ident" id="2421446">buf</span><span class="op" id="2421449">[</span><span class="ident" id="2421450"><a href="/os/dir_unix.go.html#2420941">d</a></span><span class="op" id="2421451">.</span><span class="ident" id="2421452">bufp</span><span class="op" id="2421456">:</span><span class="ident" id="2421457"><a href="/os/dir_unix.go.html#2420941">d</a></span><span class="op" id="2421458">.</span><span class="ident" id="2421459">nbuf</span><span class="op" id="2421463">]</span><span class="op" id="2421464">,</span>&nbsp;<span class="ident" id="2421466"><a href="/os/dir_unix.go.html#2420716">n</a></span><span class="op" id="2421467">,</span>&nbsp;<span class="ident" id="2421469"><a href="/os/dir_unix.go.html#2420724">names</a></span><span class="op" id="2421474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421478"><a href="/os/dir_unix.go.html#2420941">d</a></span><span class="op" id="2421479">.</span><span class="ident" id="2421480">bufp</span>&nbsp;<span class="op" id="2421485">+=</span>&nbsp;<span class="ident" id="2421488"><a href="/os/dir_unix.go.html#2421395">nb</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421493"><a href="/os/dir_unix.go.html#2420716">n</a></span>&nbsp;<span class="op" id="2421495">-=</span>&nbsp;<span class="ident" id="2421498"><a href="/os/dir_unix.go.html#2421399">nc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2421502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421505">if</span>&nbsp;<span class="ident" id="2421508"><a href="/os/dir_unix.go.html#2420716">n</a></span>&nbsp;<span class="op" id="2421510">&gt;=</span>&nbsp;<span class="num" id="2421513">0</span>&nbsp;<span class="op" id="2421515">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2421518">len</span><span class="op" id="2421521">(</span><span class="ident" id="2421522"><a href="/os/dir_unix.go.html#2420724">names</a></span><span class="op" id="2421527">)</span>&nbsp;<span class="op" id="2421529">==</span>&nbsp;<span class="num" id="2421532">0</span>&nbsp;<span class="op" id="2421534">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421538">return</span>&nbsp;<span class="ident" id="2421545"><a href="/os/dir_unix.go.html#2420724">names</a></span><span class="op" id="2421550">,</span>&nbsp;<span class="ident" id="2421552"><a href="/os/dir_unix.go.html#2420640">io</a></span><span class="op" id="2421554">.</span><span class="ident" id="2421555">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2421560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421563">return</span>&nbsp;<span class="ident" id="2421570"><a href="/os/dir_unix.go.html#2420724">names</a></span><span class="op" id="2421575">,</span>&nbsp;<span class="ident" id="2421577">nil</span><br>
<span class="lineno"></span><span class="op" id="2421581">}</span>
</div>
</body>
</html>
