<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4622275">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4622330">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4622384">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4622435">//&nbsp;+build&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4622498">package</span>&nbsp;<span class="ident" id="4622506">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4622512">import</span>&nbsp;<span class="string" id="4622519">&#34;io/ioutil&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="4622532">//&nbsp;Possible&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;finding&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4622587">var</span>&nbsp;<span class="ident" id="4622591">certFiles</span>&nbsp;<span class="op" id="4622601">=</span>&nbsp;<span class="op" id="4622603">[</span><span class="op" id="4622604">]</span><span class="builtintype" id="4622605">string</span><span class="op" id="4622611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4622614">&#34;/etc/ssl/certs/ca-certificates.crt&#34;</span><span class="op" id="4622650">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4622656">//&nbsp;Debian/Ubuntu/Gentoo&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4622686">&#34;/etc/pki/tls/certs/ca-bundle.crt&#34;</span><span class="op" id="4622720">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4622728">//&nbsp;Fedora/RHEL</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4622744">&#34;/etc/ssl/ca-bundle.pem&#34;</span><span class="op" id="4622768">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4622786">//&nbsp;OpenSUSE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4622799">&#34;/etc/ssl/cert.pem&#34;</span><span class="op" id="4622818">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4622841">//&nbsp;OpenBSD</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4622853">&#34;/usr/local/share/certs/ca-root-nss.crt&#34;</span><span class="op" id="4622893">,</span>&nbsp;<span class="comment" id="4622895">//&nbsp;FreeBSD/DragonFly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4622917">&#34;/etc/pki/tls/cacert.pem&#34;</span><span class="op" id="4622942">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4622959">//&nbsp;OpenELEC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4622972">&#34;/etc/certs/ca-certificates.crt&#34;</span><span class="op" id="4623004">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4623014">//&nbsp;Solaris&nbsp;11.2+</span><br>
<span class="lineno">20</span><span class="op" id="4623031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4623034">//&nbsp;Possible&nbsp;directories&nbsp;with&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;successfully</span><br>
<span class="lineno"></span><span class="comment" id="4623106">//&nbsp;reading&nbsp;at&nbsp;least&nbsp;one&nbsp;file&nbsp;from&nbsp;a&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="4623153">var</span>&nbsp;<span class="ident" id="4623157">certDirectories</span>&nbsp;<span class="op" id="4623173">=</span>&nbsp;<span class="op" id="4623175">[</span><span class="op" id="4623176">]</span><span class="builtintype" id="4623177">string</span><span class="op" id="4623183">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4623186">&#34;/system/etc/security/cacerts&#34;</span><span class="op" id="4623216">,</span>&nbsp;<span class="comment" id="4623218">//&nbsp;Android</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="op" id="4623230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4623233">func</span>&nbsp;<span class="op" id="4623238">(</span><span class="ident" id="4623239">c</span>&nbsp;<span class="op" id="4623241">*</span><span class="ident" id="4623242">Certificate</span><span class="op" id="4623253">)</span>&nbsp;<span class="ident" id="4623255">systemVerify</span><span class="op" id="4623267">(</span><span class="ident" id="4623268">opts</span>&nbsp;<span class="op" id="4623273">*</span><span class="ident" id="4623274">VerifyOptions</span><span class="op" id="4623287">)</span>&nbsp;<span class="op" id="4623289">(</span><span class="ident" id="4623290">chains</span>&nbsp;<span class="op" id="4623297">[</span><span class="op" id="4623298">]</span><span class="op" id="4623299">[</span><span class="op" id="4623300">]</span><span class="op" id="4623301">*</span><span class="ident" id="4623302">Certificate</span><span class="op" id="4623313">,</span>&nbsp;<span class="ident" id="4623315">err</span>&nbsp;<span class="builtintype" id="4623319">error</span><span class="op" id="4623324">)</span>&nbsp;<span class="op" id="4623326">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623329">return</span>&nbsp;<span class="ident" id="4623336">nil</span><span class="op" id="4623339">,</span>&nbsp;<span class="ident" id="4623341">nil</span><br>
<span class="lineno"></span><span class="op" id="4623345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4623348">func</span>&nbsp;<span class="ident" id="4623353">initSystemRoots</span><span class="op" id="4623368">(</span><span class="op" id="4623369">)</span>&nbsp;<span class="op" id="4623371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623374">roots</span>&nbsp;<span class="op" id="4623380">:=</span>&nbsp;<span class="ident" id="4623383">NewCertPool</span><span class="op" id="4623394">(</span><span class="op" id="4623395">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623398">for</span>&nbsp;<span class="ident" id="4623402">_</span><span class="op" id="4623403">,</span>&nbsp;<span class="ident" id="4623405">file</span>&nbsp;<span class="op" id="4623410">:=</span>&nbsp;<span class="keyword" id="4623413">range</span>&nbsp;<span class="ident" id="4623419">certFiles</span>&nbsp;<span class="op" id="4623429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623433">data</span><span class="op" id="4623437">,</span>&nbsp;<span class="ident" id="4623439">err</span>&nbsp;<span class="op" id="4623443">:=</span>&nbsp;<span class="ident" id="4623446">ioutil</span><span class="op" id="4623452">.</span><span class="ident" id="4623453">ReadFile</span><span class="op" id="4623461">(</span><span class="ident" id="4623462">file</span><span class="op" id="4623466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623470">if</span>&nbsp;<span class="ident" id="4623473">err</span>&nbsp;<span class="op" id="4623477">==</span>&nbsp;<span class="ident" id="4623480">nil</span>&nbsp;<span class="op" id="4623484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623489">roots</span><span class="op" id="4623494">.</span><span class="ident" id="4623495">AppendCertsFromPEM</span><span class="op" id="4623513">(</span><span class="ident" id="4623514">data</span><span class="op" id="4623518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623523">systemRoots</span>&nbsp;<span class="op" id="4623535">=</span>&nbsp;<span class="ident" id="4623537">roots</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623546">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4623555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4623558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623562">for</span>&nbsp;<span class="ident" id="4623566">_</span><span class="op" id="4623567">,</span>&nbsp;<span class="ident" id="4623569">directory</span>&nbsp;<span class="op" id="4623579">:=</span>&nbsp;<span class="keyword" id="4623582">range</span>&nbsp;<span class="ident" id="4623588">certDirectories</span>&nbsp;<span class="op" id="4623604">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623608">fis</span><span class="op" id="4623611">,</span>&nbsp;<span class="ident" id="4623613">err</span>&nbsp;<span class="op" id="4623617">:=</span>&nbsp;<span class="ident" id="4623620">ioutil</span><span class="op" id="4623626">.</span><span class="ident" id="4623627">ReadDir</span><span class="op" id="4623634">(</span><span class="ident" id="4623635">directory</span><span class="op" id="4623644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623648">if</span>&nbsp;<span class="ident" id="4623651">err</span>&nbsp;<span class="op" id="4623655">!=</span>&nbsp;<span class="ident" id="4623658">nil</span>&nbsp;<span class="op" id="4623662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623667">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4623678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623682">rootsAdded</span>&nbsp;<span class="op" id="4623693">:=</span>&nbsp;<span class="builtintype" id="4623696">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623704">for</span>&nbsp;<span class="ident" id="4623708">_</span><span class="op" id="4623709">,</span>&nbsp;<span class="ident" id="4623711">fi</span>&nbsp;<span class="op" id="4623714">:=</span>&nbsp;<span class="keyword" id="4623717">range</span>&nbsp;<span class="ident" id="4623723">fis</span>&nbsp;<span class="op" id="4623727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623732">data</span><span class="op" id="4623736">,</span>&nbsp;<span class="ident" id="4623738">err</span>&nbsp;<span class="op" id="4623742">:=</span>&nbsp;<span class="ident" id="4623745">ioutil</span><span class="op" id="4623751">.</span><span class="ident" id="4623752">ReadFile</span><span class="op" id="4623760">(</span><span class="ident" id="4623761">directory</span>&nbsp;<span class="op" id="4623771">+</span>&nbsp;<span class="string" id="4623773">&#34;/&#34;</span>&nbsp;<span class="op" id="4623777">+</span>&nbsp;<span class="ident" id="4623779">fi</span><span class="op" id="4623781">.</span><span class="ident" id="4623782">Name</span><span class="op" id="4623786">(</span><span class="op" id="4623787">)</span><span class="op" id="4623788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623793">if</span>&nbsp;<span class="ident" id="4623796">err</span>&nbsp;<span class="op" id="4623800">==</span>&nbsp;<span class="ident" id="4623803">nil</span>&nbsp;<span class="op" id="4623807">&amp;&amp;</span>&nbsp;<span class="ident" id="4623810">roots</span><span class="op" id="4623815">.</span><span class="ident" id="4623816">AppendCertsFromPEM</span><span class="op" id="4623834">(</span><span class="ident" id="4623835">data</span><span class="op" id="4623839">)</span>&nbsp;<span class="op" id="4623841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623847">rootsAdded</span>&nbsp;<span class="op" id="4623858">=</span>&nbsp;<span class="builtintype" id="4623860">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4623868">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4623872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623876">if</span>&nbsp;<span class="ident" id="4623879">rootsAdded</span>&nbsp;<span class="op" id="4623890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623895">systemRoots</span>&nbsp;<span class="op" id="4623907">=</span>&nbsp;<span class="ident" id="4623909">roots</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623918">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4623927">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4623930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4623934">//&nbsp;All&nbsp;of&nbsp;the&nbsp;files&nbsp;failed&nbsp;to&nbsp;load.&nbsp;systemRoots&nbsp;will&nbsp;be&nbsp;nil&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4624006">//&nbsp;trigger&nbsp;a&nbsp;specific&nbsp;error&nbsp;at&nbsp;verification&nbsp;time.</span><br>
<span class="lineno"></span><span class="op" id="4624056">}</span>
</div>
</body>
</html>
