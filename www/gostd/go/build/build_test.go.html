<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/build</h2>
<ul>
<li><a href="/gostd/go/build/build.go.html">build.go</a></li>
<li><a href="/gostd/go/build/build_test.go.html">build_test.go</a></li>
<li><a href="/gostd/go/build/deps_test.go.html">deps_test.go</a></li>
<li><a href="/gostd/go/build/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/build/read.go.html">read.go</a></li>
<li><a href="/gostd/go/build/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/go/build/syslist.go.html">syslist.go</a></li>
<li><a href="/gostd/go/build/syslist_test.go.html">syslist_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7485102">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7485158">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7485212">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7485263">package</span>&nbsp;<span class="ident" id="7485271">build</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7485278">import</span>&nbsp;<span class="op" id="7485285">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7485288">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7485294">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7485300">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7485317">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7485328">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7485339">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7485350">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7485360">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7485363">func</span>&nbsp;<span class="ident" id="7485368">TestMatch</span><span class="op" id="7485377">(</span><span class="ident" id="7485378">t</span>&nbsp;<span class="op" id="7485380">*</span><span class="ident" id="7485381">testing</span><span class="op" id="7485388">.</span><span class="ident" id="7485389">T</span><span class="op" id="7485390">)</span>&nbsp;<span class="op" id="7485392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485395">ctxt</span>&nbsp;<span class="op" id="7485400">:=</span>&nbsp;<span class="ident" id="7485403">Default</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485412">what</span>&nbsp;<span class="op" id="7485417">:=</span>&nbsp;<span class="string" id="7485420">&#34;default&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485431">match</span>&nbsp;<span class="op" id="7485437">:=</span>&nbsp;<span class="keyword" id="7485440">func</span><span class="op" id="7485444">(</span><span class="ident" id="7485445">tag</span>&nbsp;<span class="builtintype" id="7485449">string</span><span class="op" id="7485455">,</span>&nbsp;<span class="ident" id="7485457">want</span>&nbsp;<span class="keyword" id="7485462">map</span><span class="op" id="7485465">[</span><span class="builtintype" id="7485466">string</span><span class="op" id="7485472">]</span><span class="builtintype" id="7485473">bool</span><span class="op" id="7485477">)</span>&nbsp;<span class="op" id="7485479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485483">m</span>&nbsp;<span class="op" id="7485485">:=</span>&nbsp;<span class="builtinfunc" id="7485488">make</span><span class="op" id="7485492">(</span><span class="keyword" id="7485493">map</span><span class="op" id="7485496">[</span><span class="builtintype" id="7485497">string</span><span class="op" id="7485503">]</span><span class="builtintype" id="7485504">bool</span><span class="op" id="7485508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485512">if</span>&nbsp;<span class="op" id="7485515">!</span><span class="ident" id="7485516">ctxt</span><span class="op" id="7485520">.</span><span class="ident" id="7485521">match</span><span class="op" id="7485526">(</span><span class="ident" id="7485527">tag</span><span class="op" id="7485530">,</span>&nbsp;<span class="ident" id="7485532">m</span><span class="op" id="7485533">)</span>&nbsp;<span class="op" id="7485535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485540">t</span><span class="op" id="7485541">.</span><span class="ident" id="7485542">Errorf</span><span class="op" id="7485548">(</span><span class="string" id="7485549">&#34;%s&nbsp;context&nbsp;should&nbsp;match&nbsp;%s,&nbsp;does&nbsp;not&#34;</span><span class="op" id="7485587">,</span>&nbsp;<span class="ident" id="7485589">what</span><span class="op" id="7485593">,</span>&nbsp;<span class="ident" id="7485595">tag</span><span class="op" id="7485598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7485602">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485606">if</span>&nbsp;<span class="op" id="7485609">!</span><span class="ident" id="7485610">reflect</span><span class="op" id="7485617">.</span><span class="ident" id="7485618">DeepEqual</span><span class="op" id="7485627">(</span><span class="ident" id="7485628">m</span><span class="op" id="7485629">,</span>&nbsp;<span class="ident" id="7485631">want</span><span class="op" id="7485635">)</span>&nbsp;<span class="op" id="7485637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485642">t</span><span class="op" id="7485643">.</span><span class="ident" id="7485644">Errorf</span><span class="op" id="7485650">(</span><span class="string" id="7485651">&#34;%s&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7485674">,</span>&nbsp;<span class="ident" id="7485676">tag</span><span class="op" id="7485679">,</span>&nbsp;<span class="ident" id="7485681">m</span><span class="op" id="7485682">,</span>&nbsp;<span class="ident" id="7485684">want</span><span class="op" id="7485688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7485692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7485695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485698">nomatch</span>&nbsp;<span class="op" id="7485706">:=</span>&nbsp;<span class="keyword" id="7485709">func</span><span class="op" id="7485713">(</span><span class="ident" id="7485714">tag</span>&nbsp;<span class="builtintype" id="7485718">string</span><span class="op" id="7485724">,</span>&nbsp;<span class="ident" id="7485726">want</span>&nbsp;<span class="keyword" id="7485731">map</span><span class="op" id="7485734">[</span><span class="builtintype" id="7485735">string</span><span class="op" id="7485741">]</span><span class="builtintype" id="7485742">bool</span><span class="op" id="7485746">)</span>&nbsp;<span class="op" id="7485748">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485752">m</span>&nbsp;<span class="op" id="7485754">:=</span>&nbsp;<span class="builtinfunc" id="7485757">make</span><span class="op" id="7485761">(</span><span class="keyword" id="7485762">map</span><span class="op" id="7485765">[</span><span class="builtintype" id="7485766">string</span><span class="op" id="7485772">]</span><span class="builtintype" id="7485773">bool</span><span class="op" id="7485777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485781">if</span>&nbsp;<span class="ident" id="7485784">ctxt</span><span class="op" id="7485788">.</span><span class="ident" id="7485789">match</span><span class="op" id="7485794">(</span><span class="ident" id="7485795">tag</span><span class="op" id="7485798">,</span>&nbsp;<span class="ident" id="7485800">m</span><span class="op" id="7485801">)</span>&nbsp;<span class="op" id="7485803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485808">t</span><span class="op" id="7485809">.</span><span class="ident" id="7485810">Errorf</span><span class="op" id="7485816">(</span><span class="string" id="7485817">&#34;%s&nbsp;context&nbsp;should&nbsp;NOT&nbsp;match&nbsp;%s,&nbsp;does&#34;</span><span class="op" id="7485855">,</span>&nbsp;<span class="ident" id="7485857">what</span><span class="op" id="7485861">,</span>&nbsp;<span class="ident" id="7485863">tag</span><span class="op" id="7485866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7485870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7485874">if</span>&nbsp;<span class="op" id="7485877">!</span><span class="ident" id="7485878">reflect</span><span class="op" id="7485885">.</span><span class="ident" id="7485886">DeepEqual</span><span class="op" id="7485895">(</span><span class="ident" id="7485896">m</span><span class="op" id="7485897">,</span>&nbsp;<span class="ident" id="7485899">want</span><span class="op" id="7485903">)</span>&nbsp;<span class="op" id="7485905">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485910">t</span><span class="op" id="7485911">.</span><span class="ident" id="7485912">Errorf</span><span class="op" id="7485918">(</span><span class="string" id="7485919">&#34;%s&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7485942">,</span>&nbsp;<span class="ident" id="7485944">tag</span><span class="op" id="7485947">,</span>&nbsp;<span class="ident" id="7485949">m</span><span class="op" id="7485950">,</span>&nbsp;<span class="ident" id="7485952">want</span><span class="op" id="7485956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7485960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7485963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7485967">match</span><span class="op" id="7485972">(</span><span class="ident" id="7485973">runtime</span><span class="op" id="7485980">.</span><span class="ident" id="7485981">GOOS</span><span class="op" id="7485985">+</span><span class="string" id="7485986">&#34;,&#34;</span><span class="op" id="7485989">+</span><span class="ident" id="7485990">runtime</span><span class="op" id="7485997">.</span><span class="ident" id="7485998">GOARCH</span><span class="op" id="7486004">,</span>&nbsp;<span class="keyword" id="7486006">map</span><span class="op" id="7486009">[</span><span class="builtintype" id="7486010">string</span><span class="op" id="7486016">]</span><span class="builtintype" id="7486017">bool</span><span class="op" id="7486021">{</span><span class="ident" id="7486022">runtime</span><span class="op" id="7486029">.</span><span class="ident" id="7486030">GOOS</span><span class="op" id="7486034">:</span>&nbsp;<span class="builtintype" id="7486036">true</span><span class="op" id="7486040">,</span>&nbsp;<span class="ident" id="7486042">runtime</span><span class="op" id="7486049">.</span><span class="ident" id="7486050">GOARCH</span><span class="op" id="7486056">:</span>&nbsp;<span class="builtintype" id="7486058">true</span><span class="op" id="7486062">}</span><span class="op" id="7486063">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486066">match</span><span class="op" id="7486071">(</span><span class="ident" id="7486072">runtime</span><span class="op" id="7486079">.</span><span class="ident" id="7486080">GOOS</span><span class="op" id="7486084">+</span><span class="string" id="7486085">&#34;,&#34;</span><span class="op" id="7486088">+</span><span class="ident" id="7486089">runtime</span><span class="op" id="7486096">.</span><span class="ident" id="7486097">GOARCH</span><span class="op" id="7486103">+</span><span class="string" id="7486104">&#34;,!foo&#34;</span><span class="op" id="7486111">,</span>&nbsp;<span class="keyword" id="7486113">map</span><span class="op" id="7486116">[</span><span class="builtintype" id="7486117">string</span><span class="op" id="7486123">]</span><span class="builtintype" id="7486124">bool</span><span class="op" id="7486128">{</span><span class="ident" id="7486129">runtime</span><span class="op" id="7486136">.</span><span class="ident" id="7486137">GOOS</span><span class="op" id="7486141">:</span>&nbsp;<span class="builtintype" id="7486143">true</span><span class="op" id="7486147">,</span>&nbsp;<span class="ident" id="7486149">runtime</span><span class="op" id="7486156">.</span><span class="ident" id="7486157">GOARCH</span><span class="op" id="7486163">:</span>&nbsp;<span class="builtintype" id="7486165">true</span><span class="op" id="7486169">,</span>&nbsp;<span class="string" id="7486171">&#34;foo&#34;</span><span class="op" id="7486176">:</span>&nbsp;<span class="builtintype" id="7486178">true</span><span class="op" id="7486182">}</span><span class="op" id="7486183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486186">nomatch</span><span class="op" id="7486193">(</span><span class="ident" id="7486194">runtime</span><span class="op" id="7486201">.</span><span class="ident" id="7486202">GOOS</span><span class="op" id="7486206">+</span><span class="string" id="7486207">&#34;,&#34;</span><span class="op" id="7486210">+</span><span class="ident" id="7486211">runtime</span><span class="op" id="7486218">.</span><span class="ident" id="7486219">GOARCH</span><span class="op" id="7486225">+</span><span class="string" id="7486226">&#34;,foo&#34;</span><span class="op" id="7486232">,</span>&nbsp;<span class="keyword" id="7486234">map</span><span class="op" id="7486237">[</span><span class="builtintype" id="7486238">string</span><span class="op" id="7486244">]</span><span class="builtintype" id="7486245">bool</span><span class="op" id="7486249">{</span><span class="ident" id="7486250">runtime</span><span class="op" id="7486257">.</span><span class="ident" id="7486258">GOOS</span><span class="op" id="7486262">:</span>&nbsp;<span class="builtintype" id="7486264">true</span><span class="op" id="7486268">,</span>&nbsp;<span class="ident" id="7486270">runtime</span><span class="op" id="7486277">.</span><span class="ident" id="7486278">GOARCH</span><span class="op" id="7486284">:</span>&nbsp;<span class="builtintype" id="7486286">true</span><span class="op" id="7486290">,</span>&nbsp;<span class="string" id="7486292">&#34;foo&#34;</span><span class="op" id="7486297">:</span>&nbsp;<span class="builtintype" id="7486299">true</span><span class="op" id="7486303">}</span><span class="op" id="7486304">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486308">what</span>&nbsp;<span class="op" id="7486313">=</span>&nbsp;<span class="string" id="7486315">&#34;modified&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486327">ctxt</span><span class="op" id="7486331">.</span><span class="ident" id="7486332">BuildTags</span>&nbsp;<span class="op" id="7486342">=</span>&nbsp;<span class="op" id="7486344">[</span><span class="op" id="7486345">]</span><span class="builtintype" id="7486346">string</span><span class="op" id="7486352">{</span><span class="string" id="7486353">&#34;foo&#34;</span><span class="op" id="7486358">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486361">match</span><span class="op" id="7486366">(</span><span class="ident" id="7486367">runtime</span><span class="op" id="7486374">.</span><span class="ident" id="7486375">GOOS</span><span class="op" id="7486379">+</span><span class="string" id="7486380">&#34;,&#34;</span><span class="op" id="7486383">+</span><span class="ident" id="7486384">runtime</span><span class="op" id="7486391">.</span><span class="ident" id="7486392">GOARCH</span><span class="op" id="7486398">,</span>&nbsp;<span class="keyword" id="7486400">map</span><span class="op" id="7486403">[</span><span class="builtintype" id="7486404">string</span><span class="op" id="7486410">]</span><span class="builtintype" id="7486411">bool</span><span class="op" id="7486415">{</span><span class="ident" id="7486416">runtime</span><span class="op" id="7486423">.</span><span class="ident" id="7486424">GOOS</span><span class="op" id="7486428">:</span>&nbsp;<span class="builtintype" id="7486430">true</span><span class="op" id="7486434">,</span>&nbsp;<span class="ident" id="7486436">runtime</span><span class="op" id="7486443">.</span><span class="ident" id="7486444">GOARCH</span><span class="op" id="7486450">:</span>&nbsp;<span class="builtintype" id="7486452">true</span><span class="op" id="7486456">}</span><span class="op" id="7486457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486460">match</span><span class="op" id="7486465">(</span><span class="ident" id="7486466">runtime</span><span class="op" id="7486473">.</span><span class="ident" id="7486474">GOOS</span><span class="op" id="7486478">+</span><span class="string" id="7486479">&#34;,&#34;</span><span class="op" id="7486482">+</span><span class="ident" id="7486483">runtime</span><span class="op" id="7486490">.</span><span class="ident" id="7486491">GOARCH</span><span class="op" id="7486497">+</span><span class="string" id="7486498">&#34;,foo&#34;</span><span class="op" id="7486504">,</span>&nbsp;<span class="keyword" id="7486506">map</span><span class="op" id="7486509">[</span><span class="builtintype" id="7486510">string</span><span class="op" id="7486516">]</span><span class="builtintype" id="7486517">bool</span><span class="op" id="7486521">{</span><span class="ident" id="7486522">runtime</span><span class="op" id="7486529">.</span><span class="ident" id="7486530">GOOS</span><span class="op" id="7486534">:</span>&nbsp;<span class="builtintype" id="7486536">true</span><span class="op" id="7486540">,</span>&nbsp;<span class="ident" id="7486542">runtime</span><span class="op" id="7486549">.</span><span class="ident" id="7486550">GOARCH</span><span class="op" id="7486556">:</span>&nbsp;<span class="builtintype" id="7486558">true</span><span class="op" id="7486562">,</span>&nbsp;<span class="string" id="7486564">&#34;foo&#34;</span><span class="op" id="7486569">:</span>&nbsp;<span class="builtintype" id="7486571">true</span><span class="op" id="7486575">}</span><span class="op" id="7486576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486579">nomatch</span><span class="op" id="7486586">(</span><span class="ident" id="7486587">runtime</span><span class="op" id="7486594">.</span><span class="ident" id="7486595">GOOS</span><span class="op" id="7486599">+</span><span class="string" id="7486600">&#34;,&#34;</span><span class="op" id="7486603">+</span><span class="ident" id="7486604">runtime</span><span class="op" id="7486611">.</span><span class="ident" id="7486612">GOARCH</span><span class="op" id="7486618">+</span><span class="string" id="7486619">&#34;,!foo&#34;</span><span class="op" id="7486626">,</span>&nbsp;<span class="keyword" id="7486628">map</span><span class="op" id="7486631">[</span><span class="builtintype" id="7486632">string</span><span class="op" id="7486638">]</span><span class="builtintype" id="7486639">bool</span><span class="op" id="7486643">{</span><span class="ident" id="7486644">runtime</span><span class="op" id="7486651">.</span><span class="ident" id="7486652">GOOS</span><span class="op" id="7486656">:</span>&nbsp;<span class="builtintype" id="7486658">true</span><span class="op" id="7486662">,</span>&nbsp;<span class="ident" id="7486664">runtime</span><span class="op" id="7486671">.</span><span class="ident" id="7486672">GOARCH</span><span class="op" id="7486678">:</span>&nbsp;<span class="builtintype" id="7486680">true</span><span class="op" id="7486684">,</span>&nbsp;<span class="string" id="7486686">&#34;foo&#34;</span><span class="op" id="7486691">:</span>&nbsp;<span class="builtintype" id="7486693">true</span><span class="op" id="7486697">}</span><span class="op" id="7486698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486701">match</span><span class="op" id="7486706">(</span><span class="ident" id="7486707">runtime</span><span class="op" id="7486714">.</span><span class="ident" id="7486715">GOOS</span><span class="op" id="7486719">+</span><span class="string" id="7486720">&#34;,&#34;</span><span class="op" id="7486723">+</span><span class="ident" id="7486724">runtime</span><span class="op" id="7486731">.</span><span class="ident" id="7486732">GOARCH</span><span class="op" id="7486738">+</span><span class="string" id="7486739">&#34;,!bar&#34;</span><span class="op" id="7486746">,</span>&nbsp;<span class="keyword" id="7486748">map</span><span class="op" id="7486751">[</span><span class="builtintype" id="7486752">string</span><span class="op" id="7486758">]</span><span class="builtintype" id="7486759">bool</span><span class="op" id="7486763">{</span><span class="ident" id="7486764">runtime</span><span class="op" id="7486771">.</span><span class="ident" id="7486772">GOOS</span><span class="op" id="7486776">:</span>&nbsp;<span class="builtintype" id="7486778">true</span><span class="op" id="7486782">,</span>&nbsp;<span class="ident" id="7486784">runtime</span><span class="op" id="7486791">.</span><span class="ident" id="7486792">GOARCH</span><span class="op" id="7486798">:</span>&nbsp;<span class="builtintype" id="7486800">true</span><span class="op" id="7486804">,</span>&nbsp;<span class="string" id="7486806">&#34;bar&#34;</span><span class="op" id="7486811">:</span>&nbsp;<span class="builtintype" id="7486813">true</span><span class="op" id="7486817">}</span><span class="op" id="7486818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486821">nomatch</span><span class="op" id="7486828">(</span><span class="ident" id="7486829">runtime</span><span class="op" id="7486836">.</span><span class="ident" id="7486837">GOOS</span><span class="op" id="7486841">+</span><span class="string" id="7486842">&#34;,&#34;</span><span class="op" id="7486845">+</span><span class="ident" id="7486846">runtime</span><span class="op" id="7486853">.</span><span class="ident" id="7486854">GOARCH</span><span class="op" id="7486860">+</span><span class="string" id="7486861">&#34;,bar&#34;</span><span class="op" id="7486867">,</span>&nbsp;<span class="keyword" id="7486869">map</span><span class="op" id="7486872">[</span><span class="builtintype" id="7486873">string</span><span class="op" id="7486879">]</span><span class="builtintype" id="7486880">bool</span><span class="op" id="7486884">{</span><span class="ident" id="7486885">runtime</span><span class="op" id="7486892">.</span><span class="ident" id="7486893">GOOS</span><span class="op" id="7486897">:</span>&nbsp;<span class="builtintype" id="7486899">true</span><span class="op" id="7486903">,</span>&nbsp;<span class="ident" id="7486905">runtime</span><span class="op" id="7486912">.</span><span class="ident" id="7486913">GOARCH</span><span class="op" id="7486919">:</span>&nbsp;<span class="builtintype" id="7486921">true</span><span class="op" id="7486925">,</span>&nbsp;<span class="string" id="7486927">&#34;bar&#34;</span><span class="op" id="7486932">:</span>&nbsp;<span class="builtintype" id="7486934">true</span><span class="op" id="7486938">}</span><span class="op" id="7486939">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486942">nomatch</span><span class="op" id="7486949">(</span><span class="string" id="7486950">&#34;!&#34;</span><span class="op" id="7486953">,</span>&nbsp;<span class="keyword" id="7486955">map</span><span class="op" id="7486958">[</span><span class="builtintype" id="7486959">string</span><span class="op" id="7486965">]</span><span class="builtintype" id="7486966">bool</span><span class="op" id="7486970">{</span><span class="op" id="7486971">}</span><span class="op" id="7486972">)</span><br>
<span class="lineno"></span><span class="op" id="7486974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7486977">func</span>&nbsp;<span class="ident" id="7486982">TestDotSlashImport</span><span class="op" id="7487000">(</span><span class="ident" id="7487001">t</span>&nbsp;<span class="op" id="7487003">*</span><span class="ident" id="7487004">testing</span><span class="op" id="7487011">.</span><span class="ident" id="7487012">T</span><span class="op" id="7487013">)</span>&nbsp;<span class="op" id="7487015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487018">p</span><span class="op" id="7487019">,</span>&nbsp;<span class="ident" id="7487021">err</span>&nbsp;<span class="op" id="7487025">:=</span>&nbsp;<span class="ident" id="7487028">ImportDir</span><span class="op" id="7487037">(</span><span class="string" id="7487038">&#34;testdata/other&#34;</span><span class="op" id="7487054">,</span>&nbsp;<span class="num" id="7487056">0</span><span class="op" id="7487057">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487060">if</span>&nbsp;<span class="ident" id="7487063">err</span>&nbsp;<span class="op" id="7487067">!=</span>&nbsp;<span class="ident" id="7487070">nil</span>&nbsp;<span class="op" id="7487074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487078">t</span><span class="op" id="7487079">.</span><span class="ident" id="7487080">Fatal</span><span class="op" id="7487085">(</span><span class="ident" id="7487086">err</span><span class="op" id="7487089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487095">if</span>&nbsp;<span class="builtinfunc" id="7487098">len</span><span class="op" id="7487101">(</span><span class="ident" id="7487102">p</span><span class="op" id="7487103">.</span><span class="ident" id="7487104">Imports</span><span class="op" id="7487111">)</span>&nbsp;<span class="op" id="7487113">!=</span>&nbsp;<span class="num" id="7487116">1</span>&nbsp;<span class="op" id="7487118">||</span>&nbsp;<span class="ident" id="7487121">p</span><span class="op" id="7487122">.</span><span class="ident" id="7487123">Imports</span><span class="op" id="7487130">[</span><span class="num" id="7487131">0</span><span class="op" id="7487132">]</span>&nbsp;<span class="op" id="7487134">!=</span>&nbsp;<span class="string" id="7487137">&#34;./file&#34;</span>&nbsp;<span class="op" id="7487146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487150">t</span><span class="op" id="7487151">.</span><span class="ident" id="7487152">Fatalf</span><span class="op" id="7487158">(</span><span class="string" id="7487159">&#34;testdata/other:&nbsp;Imports=%v,&nbsp;want&nbsp;[./file]&#34;</span><span class="op" id="7487202">,</span>&nbsp;<span class="ident" id="7487204">p</span><span class="op" id="7487205">.</span><span class="ident" id="7487206">Imports</span><span class="op" id="7487213">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487220">p1</span><span class="op" id="7487222">,</span>&nbsp;<span class="ident" id="7487224">err</span>&nbsp;<span class="op" id="7487228">:=</span>&nbsp;<span class="ident" id="7487231">Import</span><span class="op" id="7487237">(</span><span class="string" id="7487238">&#34;./file&#34;</span><span class="op" id="7487246">,</span>&nbsp;<span class="string" id="7487248">&#34;testdata/other&#34;</span><span class="op" id="7487264">,</span>&nbsp;<span class="num" id="7487266">0</span><span class="op" id="7487267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487270">if</span>&nbsp;<span class="ident" id="7487273">err</span>&nbsp;<span class="op" id="7487277">!=</span>&nbsp;<span class="ident" id="7487280">nil</span>&nbsp;<span class="op" id="7487284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487288">t</span><span class="op" id="7487289">.</span><span class="ident" id="7487290">Fatal</span><span class="op" id="7487295">(</span><span class="ident" id="7487296">err</span><span class="op" id="7487299">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487305">if</span>&nbsp;<span class="ident" id="7487308">p1</span><span class="op" id="7487310">.</span><span class="ident" id="7487311">Name</span>&nbsp;<span class="op" id="7487316">!=</span>&nbsp;<span class="string" id="7487319">&#34;file&#34;</span>&nbsp;<span class="op" id="7487326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487330">t</span><span class="op" id="7487331">.</span><span class="ident" id="7487332">Fatalf</span><span class="op" id="7487338">(</span><span class="string" id="7487339">&#34;./file:&nbsp;Name=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7487365">,</span>&nbsp;<span class="ident" id="7487367">p1</span><span class="op" id="7487369">.</span><span class="ident" id="7487370">Name</span><span class="op" id="7487374">,</span>&nbsp;<span class="string" id="7487376">&#34;file&#34;</span><span class="op" id="7487382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487388">dir</span>&nbsp;<span class="op" id="7487392">:=</span>&nbsp;<span class="ident" id="7487395">filepath</span><span class="op" id="7487403">.</span><span class="ident" id="7487404">Clean</span><span class="op" id="7487409">(</span><span class="string" id="7487410">&#34;testdata/other/file&#34;</span><span class="op" id="7487431">)</span>&nbsp;<span class="comment" id="7487433">//&nbsp;Clean&nbsp;to&nbsp;use&nbsp;\&nbsp;on&nbsp;Windows</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487463">if</span>&nbsp;<span class="ident" id="7487466">p1</span><span class="op" id="7487468">.</span><span class="ident" id="7487469">Dir</span>&nbsp;<span class="op" id="7487473">!=</span>&nbsp;<span class="ident" id="7487476">dir</span>&nbsp;<span class="op" id="7487480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487484">t</span><span class="op" id="7487485">.</span><span class="ident" id="7487486">Fatalf</span><span class="op" id="7487492">(</span><span class="string" id="7487493">&#34;./file:&nbsp;Dir=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7487518">,</span>&nbsp;<span class="ident" id="7487520">p1</span><span class="op" id="7487522">.</span><span class="ident" id="7487523">Name</span><span class="op" id="7487527">,</span>&nbsp;<span class="ident" id="7487529">dir</span><span class="op" id="7487532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487535">}</span><br>
<span class="lineno"></span><span class="op" id="7487537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="7487540">func</span>&nbsp;<span class="ident" id="7487545">TestEmptyImport</span><span class="op" id="7487560">(</span><span class="ident" id="7487561">t</span>&nbsp;<span class="op" id="7487563">*</span><span class="ident" id="7487564">testing</span><span class="op" id="7487571">.</span><span class="ident" id="7487572">T</span><span class="op" id="7487573">)</span>&nbsp;<span class="op" id="7487575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487578">p</span><span class="op" id="7487579">,</span>&nbsp;<span class="ident" id="7487581">err</span>&nbsp;<span class="op" id="7487585">:=</span>&nbsp;<span class="ident" id="7487588">Import</span><span class="op" id="7487594">(</span><span class="string" id="7487595">&#34;&#34;</span><span class="op" id="7487597">,</span>&nbsp;<span class="ident" id="7487599">Default</span><span class="op" id="7487606">.</span><span class="ident" id="7487607">GOROOT</span><span class="op" id="7487613">,</span>&nbsp;<span class="ident" id="7487615">FindOnly</span><span class="op" id="7487623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487626">if</span>&nbsp;<span class="ident" id="7487629">err</span>&nbsp;<span class="op" id="7487633">==</span>&nbsp;<span class="ident" id="7487636">nil</span>&nbsp;<span class="op" id="7487640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487644">t</span><span class="op" id="7487645">.</span><span class="ident" id="7487646">Fatal</span><span class="op" id="7487651">(</span><span class="string" id="7487652">`Import(&#34;&#34;)&nbsp;returned&nbsp;nil&nbsp;error.`</span><span class="op" id="7487684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487687">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487690">if</span>&nbsp;<span class="ident" id="7487693">p</span>&nbsp;<span class="op" id="7487695">==</span>&nbsp;<span class="ident" id="7487698">nil</span>&nbsp;<span class="op" id="7487702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487706">t</span><span class="op" id="7487707">.</span><span class="ident" id="7487708">Fatal</span><span class="op" id="7487713">(</span><span class="string" id="7487714">`Import(&#34;&#34;)&nbsp;returned&nbsp;nil&nbsp;package.`</span><span class="op" id="7487748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487754">if</span>&nbsp;<span class="ident" id="7487757">p</span><span class="op" id="7487758">.</span><span class="ident" id="7487759">ImportPath</span>&nbsp;<span class="op" id="7487770">!=</span>&nbsp;<span class="string" id="7487773">&#34;&#34;</span>&nbsp;<span class="op" id="7487776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487780">t</span><span class="op" id="7487781">.</span><span class="ident" id="7487782">Fatalf</span><span class="op" id="7487788">(</span><span class="string" id="7487789">&#34;ImportPath=%q,&nbsp;want&nbsp;%q.&#34;</span><span class="op" id="7487814">,</span>&nbsp;<span class="ident" id="7487816">p</span><span class="op" id="7487817">.</span><span class="ident" id="7487818">ImportPath</span><span class="op" id="7487828">,</span>&nbsp;<span class="string" id="7487830">&#34;&#34;</span><span class="op" id="7487832">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487835">}</span><br>
<span class="lineno"></span><span class="op" id="7487837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7487840">func</span>&nbsp;<span class="ident" id="7487845">TestEmptyFolderImport</span><span class="op" id="7487866">(</span><span class="ident" id="7487867">t</span>&nbsp;<span class="op" id="7487869">*</span><span class="ident" id="7487870">testing</span><span class="op" id="7487877">.</span><span class="ident" id="7487878">T</span><span class="op" id="7487879">)</span>&nbsp;<span class="op" id="7487881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487884">_</span><span class="op" id="7487885">,</span>&nbsp;<span class="ident" id="7487887">err</span>&nbsp;<span class="op" id="7487891">:=</span>&nbsp;<span class="ident" id="7487894">Import</span><span class="op" id="7487900">(</span><span class="string" id="7487901">&#34;.&#34;</span><span class="op" id="7487904">,</span>&nbsp;<span class="string" id="7487906">&#34;testdata/empty&#34;</span><span class="op" id="7487922">,</span>&nbsp;<span class="num" id="7487924">0</span><span class="op" id="7487925">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487928">if</span>&nbsp;<span class="ident" id="7487931">_</span><span class="op" id="7487932">,</span>&nbsp;<span class="ident" id="7487934">ok</span>&nbsp;<span class="op" id="7487937">:=</span>&nbsp;<span class="ident" id="7487940">err</span><span class="op" id="7487943">.</span><span class="op" id="7487944">(</span><span class="op" id="7487945">*</span><span class="ident" id="7487946">NoGoError</span><span class="op" id="7487955">)</span><span class="op" id="7487956">;</span>&nbsp;<span class="op" id="7487958">!</span><span class="ident" id="7487959">ok</span>&nbsp;<span class="op" id="7487962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487966">t</span><span class="op" id="7487967">.</span><span class="ident" id="7487968">Fatal</span><span class="op" id="7487973">(</span><span class="string" id="7487974">`Import(&#34;testdata/empty&#34;)&nbsp;did&nbsp;not&nbsp;return&nbsp;NoGoError.`</span><span class="op" id="7488026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488029">}</span><br>
<span class="lineno"></span><span class="op" id="7488031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7488034">func</span>&nbsp;<span class="ident" id="7488039">TestMultiplePackageImport</span><span class="op" id="7488064">(</span><span class="ident" id="7488065">t</span>&nbsp;<span class="op" id="7488067">*</span><span class="ident" id="7488068">testing</span><span class="op" id="7488075">.</span><span class="ident" id="7488076">T</span><span class="op" id="7488077">)</span>&nbsp;<span class="op" id="7488079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488082">_</span><span class="op" id="7488083">,</span>&nbsp;<span class="ident" id="7488085">err</span>&nbsp;<span class="op" id="7488089">:=</span>&nbsp;<span class="ident" id="7488092">Import</span><span class="op" id="7488098">(</span><span class="string" id="7488099">&#34;.&#34;</span><span class="op" id="7488102">,</span>&nbsp;<span class="string" id="7488104">&#34;testdata/multi&#34;</span><span class="op" id="7488120">,</span>&nbsp;<span class="num" id="7488122">0</span><span class="op" id="7488123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488126">if</span>&nbsp;<span class="ident" id="7488129">_</span><span class="op" id="7488130">,</span>&nbsp;<span class="ident" id="7488132">ok</span>&nbsp;<span class="op" id="7488135">:=</span>&nbsp;<span class="ident" id="7488138">err</span><span class="op" id="7488141">.</span><span class="op" id="7488142">(</span><span class="op" id="7488143">*</span><span class="ident" id="7488144">MultiplePackageError</span><span class="op" id="7488164">)</span><span class="op" id="7488165">;</span>&nbsp;<span class="op" id="7488167">!</span><span class="ident" id="7488168">ok</span>&nbsp;<span class="op" id="7488171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488175">t</span><span class="op" id="7488176">.</span><span class="ident" id="7488177">Fatal</span><span class="op" id="7488182">(</span><span class="string" id="7488183">`Import(&#34;testdata/multi&#34;)&nbsp;did&nbsp;not&nbsp;return&nbsp;MultiplePackageError.`</span><span class="op" id="7488246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488249">}</span><br>
<span class="lineno">100</span><span class="op" id="7488251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7488254">func</span>&nbsp;<span class="ident" id="7488259">TestLocalDirectory</span><span class="op" id="7488277">(</span><span class="ident" id="7488278">t</span>&nbsp;<span class="op" id="7488280">*</span><span class="ident" id="7488281">testing</span><span class="op" id="7488288">.</span><span class="ident" id="7488289">T</span><span class="op" id="7488290">)</span>&nbsp;<span class="op" id="7488292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488295">cwd</span><span class="op" id="7488298">,</span>&nbsp;<span class="ident" id="7488300">err</span>&nbsp;<span class="op" id="7488304">:=</span>&nbsp;<span class="ident" id="7488307">os</span><span class="op" id="7488309">.</span><span class="ident" id="7488310">Getwd</span><span class="op" id="7488315">(</span><span class="op" id="7488316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488319">if</span>&nbsp;<span class="ident" id="7488322">err</span>&nbsp;<span class="op" id="7488326">!=</span>&nbsp;<span class="ident" id="7488329">nil</span>&nbsp;<span class="op" id="7488333">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488337">t</span><span class="op" id="7488338">.</span><span class="ident" id="7488339">Fatal</span><span class="op" id="7488344">(</span><span class="ident" id="7488345">err</span><span class="op" id="7488348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488355">p</span><span class="op" id="7488356">,</span>&nbsp;<span class="ident" id="7488358">err</span>&nbsp;<span class="op" id="7488362">:=</span>&nbsp;<span class="ident" id="7488365">ImportDir</span><span class="op" id="7488374">(</span><span class="ident" id="7488375">cwd</span><span class="op" id="7488378">,</span>&nbsp;<span class="num" id="7488380">0</span><span class="op" id="7488381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488384">if</span>&nbsp;<span class="ident" id="7488387">err</span>&nbsp;<span class="op" id="7488391">!=</span>&nbsp;<span class="ident" id="7488394">nil</span>&nbsp;<span class="op" id="7488398">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488402">t</span><span class="op" id="7488403">.</span><span class="ident" id="7488404">Fatal</span><span class="op" id="7488409">(</span><span class="ident" id="7488410">err</span><span class="op" id="7488413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488419">if</span>&nbsp;<span class="ident" id="7488422">p</span><span class="op" id="7488423">.</span><span class="ident" id="7488424">ImportPath</span>&nbsp;<span class="op" id="7488435">!=</span>&nbsp;<span class="string" id="7488438">&#34;go/build&#34;</span>&nbsp;<span class="op" id="7488449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488453">t</span><span class="op" id="7488454">.</span><span class="ident" id="7488455">Fatalf</span><span class="op" id="7488461">(</span><span class="string" id="7488462">&#34;ImportPath=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7488486">,</span>&nbsp;<span class="ident" id="7488488">p</span><span class="op" id="7488489">.</span><span class="ident" id="7488490">ImportPath</span><span class="op" id="7488500">,</span>&nbsp;<span class="string" id="7488502">&#34;go/build&#34;</span><span class="op" id="7488512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488515">}</span><br>
<span class="lineno">115</span><span class="op" id="7488517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7488520">func</span>&nbsp;<span class="ident" id="7488525">TestShouldBuild</span><span class="op" id="7488540">(</span><span class="ident" id="7488541">t</span>&nbsp;<span class="op" id="7488543">*</span><span class="ident" id="7488544">testing</span><span class="op" id="7488551">.</span><span class="ident" id="7488552">T</span><span class="op" id="7488553">)</span>&nbsp;<span class="op" id="7488555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488558">const</span>&nbsp;<span class="ident" id="7488564">file1</span>&nbsp;<span class="op" id="7488570">=</span>&nbsp;<span class="string" id="7488572">&#34;//&nbsp;+build&nbsp;tag1\n\n&#34;</span>&nbsp;<span class="op" id="7488593">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7488597">&#34;package&nbsp;main\n&#34;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488615">want1</span>&nbsp;<span class="op" id="7488621">:=</span>&nbsp;<span class="keyword" id="7488624">map</span><span class="op" id="7488627">[</span><span class="builtintype" id="7488628">string</span><span class="op" id="7488634">]</span><span class="builtintype" id="7488635">bool</span><span class="op" id="7488639">{</span><span class="string" id="7488640">&#34;tag1&#34;</span><span class="op" id="7488646">:</span>&nbsp;<span class="builtintype" id="7488648">true</span><span class="op" id="7488652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488656">const</span>&nbsp;<span class="ident" id="7488662">file2</span>&nbsp;<span class="op" id="7488668">=</span>&nbsp;<span class="string" id="7488670">&#34;//&nbsp;+build&nbsp;cgo\n\n&#34;</span>&nbsp;<span class="op" id="7488690">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7488694">&#34;//&nbsp;This&nbsp;package&nbsp;implements&nbsp;parsing&nbsp;of&nbsp;tags&nbsp;like\n&#34;</span>&nbsp;<span class="op" id="7488746">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7488750">&#34;//&nbsp;+build&nbsp;tag1\n&#34;</span>&nbsp;<span class="op" id="7488769">+</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7488773">&#34;package&nbsp;build&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488790">want2</span>&nbsp;<span class="op" id="7488796">:=</span>&nbsp;<span class="keyword" id="7488799">map</span><span class="op" id="7488802">[</span><span class="builtintype" id="7488803">string</span><span class="op" id="7488809">]</span><span class="builtintype" id="7488810">bool</span><span class="op" id="7488814">{</span><span class="string" id="7488815">&#34;cgo&#34;</span><span class="op" id="7488820">:</span>&nbsp;<span class="builtintype" id="7488822">true</span><span class="op" id="7488826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488830">const</span>&nbsp;<span class="ident" id="7488836">file3</span>&nbsp;<span class="op" id="7488842">=</span>&nbsp;<span class="string" id="7488844">&#34;//&nbsp;Copyright&nbsp;The&nbsp;Go&nbsp;Authors.\n\n&#34;</span>&nbsp;<span class="op" id="7488879">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7488883">&#34;package&nbsp;build\n\n&#34;</span>&nbsp;<span class="op" id="7488903">+</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7488907">&#34;//&nbsp;shouldBuild&nbsp;checks&nbsp;tags&nbsp;given&nbsp;by&nbsp;lines&nbsp;of&nbsp;the&nbsp;form\n&#34;</span>&nbsp;<span class="op" id="7488965">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7488969">&#34;//&nbsp;+build&nbsp;tag\n&#34;</span>&nbsp;<span class="op" id="7488987">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7488991">&#34;func&nbsp;shouldBuild(content&nbsp;[]byte)\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489029">want3</span>&nbsp;<span class="op" id="7489035">:=</span>&nbsp;<span class="keyword" id="7489038">map</span><span class="op" id="7489041">[</span><span class="builtintype" id="7489042">string</span><span class="op" id="7489048">]</span><span class="builtintype" id="7489049">bool</span><span class="op" id="7489053">{</span><span class="op" id="7489054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489058">ctx</span>&nbsp;<span class="op" id="7489062">:=</span>&nbsp;<span class="op" id="7489065">&amp;</span><span class="ident" id="7489066">Context</span><span class="op" id="7489073">{</span><span class="ident" id="7489074">BuildTags</span><span class="op" id="7489083">:</span>&nbsp;<span class="op" id="7489085">[</span><span class="op" id="7489086">]</span><span class="builtintype" id="7489087">string</span><span class="op" id="7489093">{</span><span class="string" id="7489094">&#34;tag1&#34;</span><span class="op" id="7489100">}</span><span class="op" id="7489101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489104">m</span>&nbsp;<span class="op" id="7489106">:=</span>&nbsp;<span class="keyword" id="7489109">map</span><span class="op" id="7489112">[</span><span class="builtintype" id="7489113">string</span><span class="op" id="7489119">]</span><span class="builtintype" id="7489120">bool</span><span class="op" id="7489124">{</span><span class="op" id="7489125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7489128">if</span>&nbsp;<span class="op" id="7489131">!</span><span class="ident" id="7489132">ctx</span><span class="op" id="7489135">.</span><span class="ident" id="7489136">shouldBuild</span><span class="op" id="7489147">(</span><span class="op" id="7489148">[</span><span class="op" id="7489149">]</span><span class="builtintype" id="7489150">byte</span><span class="op" id="7489154">(</span><span class="ident" id="7489155">file1</span><span class="op" id="7489160">)</span><span class="op" id="7489161">,</span>&nbsp;<span class="ident" id="7489163">m</span><span class="op" id="7489164">)</span>&nbsp;<span class="op" id="7489166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489170">t</span><span class="op" id="7489171">.</span><span class="ident" id="7489172">Errorf</span><span class="op" id="7489178">(</span><span class="string" id="7489179">&#34;shouldBuild(file1)&nbsp;=&nbsp;false,&nbsp;want&nbsp;true&#34;</span><span class="op" id="7489218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7489221">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7489224">if</span>&nbsp;<span class="op" id="7489227">!</span><span class="ident" id="7489228">reflect</span><span class="op" id="7489235">.</span><span class="ident" id="7489236">DeepEqual</span><span class="op" id="7489245">(</span><span class="ident" id="7489246">m</span><span class="op" id="7489247">,</span>&nbsp;<span class="ident" id="7489249">want1</span><span class="op" id="7489254">)</span>&nbsp;<span class="op" id="7489256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489260">t</span><span class="op" id="7489261">.</span><span class="ident" id="7489262">Errorf</span><span class="op" id="7489268">(</span><span class="string" id="7489269">&#34;shoudBuild(file1)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7489307">,</span>&nbsp;<span class="ident" id="7489309">m</span><span class="op" id="7489310">,</span>&nbsp;<span class="ident" id="7489312">want1</span><span class="op" id="7489317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7489320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489324">m</span>&nbsp;<span class="op" id="7489326">=</span>&nbsp;<span class="keyword" id="7489328">map</span><span class="op" id="7489331">[</span><span class="builtintype" id="7489332">string</span><span class="op" id="7489338">]</span><span class="builtintype" id="7489339">bool</span><span class="op" id="7489343">{</span><span class="op" id="7489344">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7489347">if</span>&nbsp;<span class="ident" id="7489350">ctx</span><span class="op" id="7489353">.</span><span class="ident" id="7489354">shouldBuild</span><span class="op" id="7489365">(</span><span class="op" id="7489366">[</span><span class="op" id="7489367">]</span><span class="builtintype" id="7489368">byte</span><span class="op" id="7489372">(</span><span class="ident" id="7489373">file2</span><span class="op" id="7489378">)</span><span class="op" id="7489379">,</span>&nbsp;<span class="ident" id="7489381">m</span><span class="op" id="7489382">)</span>&nbsp;<span class="op" id="7489384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489388">t</span><span class="op" id="7489389">.</span><span class="ident" id="7489390">Errorf</span><span class="op" id="7489396">(</span><span class="string" id="7489397">&#34;shouldBuild(file2)&nbsp;=&nbsp;true,&nbsp;want&nbsp;fakse&#34;</span><span class="op" id="7489436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7489439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7489442">if</span>&nbsp;<span class="op" id="7489445">!</span><span class="ident" id="7489446">reflect</span><span class="op" id="7489453">.</span><span class="ident" id="7489454">DeepEqual</span><span class="op" id="7489463">(</span><span class="ident" id="7489464">m</span><span class="op" id="7489465">,</span>&nbsp;<span class="ident" id="7489467">want2</span><span class="op" id="7489472">)</span>&nbsp;<span class="op" id="7489474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489478">t</span><span class="op" id="7489479">.</span><span class="ident" id="7489480">Errorf</span><span class="op" id="7489486">(</span><span class="string" id="7489487">&#34;shoudBuild(file2)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7489525">,</span>&nbsp;<span class="ident" id="7489527">m</span><span class="op" id="7489528">,</span>&nbsp;<span class="ident" id="7489530">want2</span><span class="op" id="7489535">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7489538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489542">m</span>&nbsp;<span class="op" id="7489544">=</span>&nbsp;<span class="keyword" id="7489546">map</span><span class="op" id="7489549">[</span><span class="builtintype" id="7489550">string</span><span class="op" id="7489556">]</span><span class="builtintype" id="7489557">bool</span><span class="op" id="7489561">{</span><span class="op" id="7489562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489565">ctx</span>&nbsp;<span class="op" id="7489569">=</span>&nbsp;<span class="op" id="7489571">&amp;</span><span class="ident" id="7489572">Context</span><span class="op" id="7489579">{</span><span class="ident" id="7489580">BuildTags</span><span class="op" id="7489589">:</span>&nbsp;<span class="ident" id="7489591">nil</span><span class="op" id="7489594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7489597">if</span>&nbsp;<span class="op" id="7489600">!</span><span class="ident" id="7489601">ctx</span><span class="op" id="7489604">.</span><span class="ident" id="7489605">shouldBuild</span><span class="op" id="7489616">(</span><span class="op" id="7489617">[</span><span class="op" id="7489618">]</span><span class="builtintype" id="7489619">byte</span><span class="op" id="7489623">(</span><span class="ident" id="7489624">file3</span><span class="op" id="7489629">)</span><span class="op" id="7489630">,</span>&nbsp;<span class="ident" id="7489632">m</span><span class="op" id="7489633">)</span>&nbsp;<span class="op" id="7489635">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489639">t</span><span class="op" id="7489640">.</span><span class="ident" id="7489641">Errorf</span><span class="op" id="7489647">(</span><span class="string" id="7489648">&#34;shouldBuild(file3)&nbsp;=&nbsp;false,&nbsp;want&nbsp;true&#34;</span><span class="op" id="7489687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7489690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7489693">if</span>&nbsp;<span class="op" id="7489696">!</span><span class="ident" id="7489697">reflect</span><span class="op" id="7489704">.</span><span class="ident" id="7489705">DeepEqual</span><span class="op" id="7489714">(</span><span class="ident" id="7489715">m</span><span class="op" id="7489716">,</span>&nbsp;<span class="ident" id="7489718">want3</span><span class="op" id="7489723">)</span>&nbsp;<span class="op" id="7489725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489729">t</span><span class="op" id="7489730">.</span><span class="ident" id="7489731">Errorf</span><span class="op" id="7489737">(</span><span class="string" id="7489738">&#34;shoudBuild(file3)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7489776">,</span>&nbsp;<span class="ident" id="7489778">m</span><span class="op" id="7489779">,</span>&nbsp;<span class="ident" id="7489781">want3</span><span class="op" id="7489786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7489789">}</span><br>
<span class="lineno">160</span><span class="op" id="7489791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7489794">type</span>&nbsp;<span class="ident" id="7489799">readNopCloser</span>&nbsp;<span class="keyword" id="7489813">struct</span>&nbsp;<span class="op" id="7489820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489823">io</span><span class="op" id="7489825">.</span><span class="ident" id="7489826">Reader</span><br>
<span class="lineno"></span><span class="op" id="7489833">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="7489836">func</span>&nbsp;<span class="op" id="7489841">(</span><span class="ident" id="7489842">r</span>&nbsp;<span class="ident" id="7489844">readNopCloser</span><span class="op" id="7489857">)</span>&nbsp;<span class="ident" id="7489859">Close</span><span class="op" id="7489864">(</span><span class="op" id="7489865">)</span>&nbsp;<span class="builtintype" id="7489867">error</span>&nbsp;<span class="op" id="7489873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7489876">return</span>&nbsp;<span class="ident" id="7489883">nil</span><br>
<span class="lineno"></span><span class="op" id="7489887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="7489890">var</span>&nbsp;<span class="op" id="7489894">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489897">ctxtP9</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7489909">=</span>&nbsp;<span class="ident" id="7489911">Context</span><span class="op" id="7489918">{</span><span class="ident" id="7489919">GOARCH</span><span class="op" id="7489925">:</span>&nbsp;<span class="string" id="7489927">&#34;arm&#34;</span><span class="op" id="7489932">,</span>&nbsp;<span class="ident" id="7489934">GOOS</span><span class="op" id="7489938">:</span>&nbsp;<span class="string" id="7489940">&#34;plan9&#34;</span><span class="op" id="7489947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489950">ctxtAndroid</span>&nbsp;<span class="op" id="7489962">=</span>&nbsp;<span class="ident" id="7489964">Context</span><span class="op" id="7489971">{</span><span class="ident" id="7489972">GOARCH</span><span class="op" id="7489978">:</span>&nbsp;<span class="string" id="7489980">&#34;arm&#34;</span><span class="op" id="7489985">,</span>&nbsp;<span class="ident" id="7489987">GOOS</span><span class="op" id="7489991">:</span>&nbsp;<span class="string" id="7489993">&#34;android&#34;</span><span class="op" id="7490002">}</span><br>
<span class="lineno"></span><span class="op" id="7490004">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="7490007">var</span>&nbsp;<span class="ident" id="7490011">matchFileTests</span>&nbsp;<span class="op" id="7490026">=</span>&nbsp;<span class="op" id="7490028">[</span><span class="op" id="7490029">]</span><span class="keyword" id="7490030">struct</span>&nbsp;<span class="op" id="7490037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490040">ctxt</span>&nbsp;&nbsp;<span class="ident" id="7490046">Context</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490055">name</span>&nbsp;&nbsp;<span class="builtintype" id="7490061">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490069">data</span>&nbsp;&nbsp;<span class="builtintype" id="7490075">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490083">match</span>&nbsp;<span class="builtintype" id="7490089">bool</span><br>
<span class="lineno">180</span><span class="op" id="7490094">}</span><span class="op" id="7490095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490098">{</span><span class="ident" id="7490099">ctxtP9</span><span class="op" id="7490105">,</span>&nbsp;<span class="string" id="7490107">&#34;foo_arm.go&#34;</span><span class="op" id="7490119">,</span>&nbsp;<span class="string" id="7490121">&#34;&#34;</span><span class="op" id="7490123">,</span>&nbsp;<span class="builtintype" id="7490125">true</span><span class="op" id="7490129">}</span><span class="op" id="7490130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490133">{</span><span class="ident" id="7490134">ctxtP9</span><span class="op" id="7490140">,</span>&nbsp;<span class="string" id="7490142">&#34;foo1_arm.go&#34;</span><span class="op" id="7490155">,</span>&nbsp;<span class="string" id="7490157">&#34;//&nbsp;+build&nbsp;linux\n\npackage&nbsp;main\n&#34;</span><span class="op" id="7490192">,</span>&nbsp;<span class="builtintype" id="7490194">false</span><span class="op" id="7490199">}</span><span class="op" id="7490200">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490203">{</span><span class="ident" id="7490204">ctxtP9</span><span class="op" id="7490210">,</span>&nbsp;<span class="string" id="7490212">&#34;foo_darwin.go&#34;</span><span class="op" id="7490227">,</span>&nbsp;<span class="string" id="7490229">&#34;&#34;</span><span class="op" id="7490231">,</span>&nbsp;<span class="builtintype" id="7490233">false</span><span class="op" id="7490238">}</span><span class="op" id="7490239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490242">{</span><span class="ident" id="7490243">ctxtP9</span><span class="op" id="7490249">,</span>&nbsp;<span class="string" id="7490251">&#34;foo.go&#34;</span><span class="op" id="7490259">,</span>&nbsp;<span class="string" id="7490261">&#34;&#34;</span><span class="op" id="7490263">,</span>&nbsp;<span class="builtintype" id="7490265">true</span><span class="op" id="7490269">}</span><span class="op" id="7490270">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490273">{</span><span class="ident" id="7490274">ctxtP9</span><span class="op" id="7490280">,</span>&nbsp;<span class="string" id="7490282">&#34;foo1.go&#34;</span><span class="op" id="7490291">,</span>&nbsp;<span class="string" id="7490293">&#34;//&nbsp;+build&nbsp;linux\n\npackage&nbsp;main\n&#34;</span><span class="op" id="7490328">,</span>&nbsp;<span class="builtintype" id="7490330">false</span><span class="op" id="7490335">}</span><span class="op" id="7490336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490339">{</span><span class="ident" id="7490340">ctxtP9</span><span class="op" id="7490346">,</span>&nbsp;<span class="string" id="7490348">&#34;foo.badsuffix&#34;</span><span class="op" id="7490363">,</span>&nbsp;<span class="string" id="7490365">&#34;&#34;</span><span class="op" id="7490367">,</span>&nbsp;<span class="builtintype" id="7490369">false</span><span class="op" id="7490374">}</span><span class="op" id="7490375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490378">{</span><span class="ident" id="7490379">ctxtAndroid</span><span class="op" id="7490390">,</span>&nbsp;<span class="string" id="7490392">&#34;foo_linux.go&#34;</span><span class="op" id="7490406">,</span>&nbsp;<span class="string" id="7490408">&#34;&#34;</span><span class="op" id="7490410">,</span>&nbsp;<span class="builtintype" id="7490412">true</span><span class="op" id="7490416">}</span><span class="op" id="7490417">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490420">{</span><span class="ident" id="7490421">ctxtAndroid</span><span class="op" id="7490432">,</span>&nbsp;<span class="string" id="7490434">&#34;foo_android.go&#34;</span><span class="op" id="7490450">,</span>&nbsp;<span class="string" id="7490452">&#34;&#34;</span><span class="op" id="7490454">,</span>&nbsp;<span class="builtintype" id="7490456">true</span><span class="op" id="7490460">}</span><span class="op" id="7490461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490464">{</span><span class="ident" id="7490465">ctxtAndroid</span><span class="op" id="7490476">,</span>&nbsp;<span class="string" id="7490478">&#34;foo_plan9.go&#34;</span><span class="op" id="7490492">,</span>&nbsp;<span class="string" id="7490494">&#34;&#34;</span><span class="op" id="7490496">,</span>&nbsp;<span class="builtintype" id="7490498">false</span><span class="op" id="7490503">}</span><span class="op" id="7490504">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490507">{</span><span class="ident" id="7490508">ctxtAndroid</span><span class="op" id="7490519">,</span>&nbsp;<span class="string" id="7490521">&#34;android.go&#34;</span><span class="op" id="7490533">,</span>&nbsp;<span class="string" id="7490535">&#34;&#34;</span><span class="op" id="7490537">,</span>&nbsp;<span class="builtintype" id="7490539">true</span><span class="op" id="7490543">}</span><span class="op" id="7490544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490547">{</span><span class="ident" id="7490548">ctxtAndroid</span><span class="op" id="7490559">,</span>&nbsp;<span class="string" id="7490561">&#34;plan9.go&#34;</span><span class="op" id="7490571">,</span>&nbsp;<span class="string" id="7490573">&#34;&#34;</span><span class="op" id="7490575">,</span>&nbsp;<span class="builtintype" id="7490577">true</span><span class="op" id="7490581">}</span><span class="op" id="7490582">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490585">{</span><span class="ident" id="7490586">ctxtAndroid</span><span class="op" id="7490597">,</span>&nbsp;<span class="string" id="7490599">&#34;plan9_test.go&#34;</span><span class="op" id="7490614">,</span>&nbsp;<span class="string" id="7490616">&#34;&#34;</span><span class="op" id="7490618">,</span>&nbsp;<span class="builtintype" id="7490620">true</span><span class="op" id="7490624">}</span><span class="op" id="7490625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490628">{</span><span class="ident" id="7490629">ctxtAndroid</span><span class="op" id="7490640">,</span>&nbsp;<span class="string" id="7490642">&#34;arm.s&#34;</span><span class="op" id="7490649">,</span>&nbsp;<span class="string" id="7490651">&#34;&#34;</span><span class="op" id="7490653">,</span>&nbsp;<span class="builtintype" id="7490655">true</span><span class="op" id="7490659">}</span><span class="op" id="7490660">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490663">{</span><span class="ident" id="7490664">ctxtAndroid</span><span class="op" id="7490675">,</span>&nbsp;<span class="string" id="7490677">&#34;amd64.s&#34;</span><span class="op" id="7490686">,</span>&nbsp;<span class="string" id="7490688">&#34;&#34;</span><span class="op" id="7490690">,</span>&nbsp;<span class="builtintype" id="7490692">true</span><span class="op" id="7490696">}</span><span class="op" id="7490697">,</span><br>
<span class="lineno">195</span><span class="op" id="7490699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7490702">func</span>&nbsp;<span class="ident" id="7490707">TestMatchFile</span><span class="op" id="7490720">(</span><span class="ident" id="7490721">t</span>&nbsp;<span class="op" id="7490723">*</span><span class="ident" id="7490724">testing</span><span class="op" id="7490731">.</span><span class="ident" id="7490732">T</span><span class="op" id="7490733">)</span>&nbsp;<span class="op" id="7490735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7490738">for</span>&nbsp;<span class="ident" id="7490742">_</span><span class="op" id="7490743">,</span>&nbsp;<span class="ident" id="7490745">tt</span>&nbsp;<span class="op" id="7490748">:=</span>&nbsp;<span class="keyword" id="7490751">range</span>&nbsp;<span class="ident" id="7490757">matchFileTests</span>&nbsp;<span class="op" id="7490772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490776">ctxt</span>&nbsp;<span class="op" id="7490781">:=</span>&nbsp;<span class="ident" id="7490784">tt</span><span class="op" id="7490786">.</span><span class="ident" id="7490787">ctxt</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490794">ctxt</span><span class="op" id="7490798">.</span><span class="ident" id="7490799">OpenFile</span>&nbsp;<span class="op" id="7490808">=</span>&nbsp;<span class="keyword" id="7490810">func</span><span class="op" id="7490814">(</span><span class="ident" id="7490815">path</span>&nbsp;<span class="builtintype" id="7490820">string</span><span class="op" id="7490826">)</span>&nbsp;<span class="op" id="7490828">(</span><span class="ident" id="7490829">r</span>&nbsp;<span class="ident" id="7490831">io</span><span class="op" id="7490833">.</span><span class="ident" id="7490834">ReadCloser</span><span class="op" id="7490844">,</span>&nbsp;<span class="ident" id="7490846">err</span>&nbsp;<span class="builtintype" id="7490850">error</span><span class="op" id="7490855">)</span>&nbsp;<span class="op" id="7490857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7490862">if</span>&nbsp;<span class="ident" id="7490865">path</span>&nbsp;<span class="op" id="7490870">!=</span>&nbsp;<span class="string" id="7490873">&#34;x+&#34;</span><span class="op" id="7490877">+</span><span class="ident" id="7490878">tt</span><span class="op" id="7490880">.</span><span class="ident" id="7490881">name</span>&nbsp;<span class="op" id="7490886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7490892">t</span><span class="op" id="7490893">.</span><span class="ident" id="7490894">Fatalf</span><span class="op" id="7490900">(</span><span class="string" id="7490901">&#34;OpenFile&nbsp;asked&nbsp;for&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7490937">,</span>&nbsp;<span class="ident" id="7490939">path</span><span class="op" id="7490943">,</span>&nbsp;<span class="string" id="7490945">&#34;x+&#34;</span><span class="op" id="7490949">+</span><span class="ident" id="7490950">tt</span><span class="op" id="7490952">.</span><span class="ident" id="7490953">name</span><span class="op" id="7490957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7490962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7490967">return</span>&nbsp;<span class="op" id="7490974">&amp;</span><span class="ident" id="7490975">readNopCloser</span><span class="op" id="7490988">{</span><span class="ident" id="7490989">strings</span><span class="op" id="7490996">.</span><span class="ident" id="7490997">NewReader</span><span class="op" id="7491006">(</span><span class="ident" id="7491007">tt</span><span class="op" id="7491009">.</span><span class="ident" id="7491010">data</span><span class="op" id="7491014">)</span><span class="op" id="7491015">}</span><span class="op" id="7491016">,</span>&nbsp;<span class="ident" id="7491018">nil</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7491024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7491028">ctxt</span><span class="op" id="7491032">.</span><span class="ident" id="7491033">JoinPath</span>&nbsp;<span class="op" id="7491042">=</span>&nbsp;<span class="keyword" id="7491044">func</span><span class="op" id="7491048">(</span><span class="ident" id="7491049">elem</span>&nbsp;<span class="op" id="7491054">...</span><span class="builtintype" id="7491057">string</span><span class="op" id="7491063">)</span>&nbsp;<span class="builtintype" id="7491065">string</span>&nbsp;<span class="op" id="7491072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7491077">return</span>&nbsp;<span class="ident" id="7491084">strings</span><span class="op" id="7491091">.</span><span class="ident" id="7491092">Join</span><span class="op" id="7491096">(</span><span class="ident" id="7491097">elem</span><span class="op" id="7491101">,</span>&nbsp;<span class="string" id="7491103">&#34;+&#34;</span><span class="op" id="7491106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7491110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7491114">match</span><span class="op" id="7491119">,</span>&nbsp;<span class="ident" id="7491121">err</span>&nbsp;<span class="op" id="7491125">:=</span>&nbsp;<span class="ident" id="7491128">ctxt</span><span class="op" id="7491132">.</span><span class="ident" id="7491133">MatchFile</span><span class="op" id="7491142">(</span><span class="string" id="7491143">&#34;x&#34;</span><span class="op" id="7491146">,</span>&nbsp;<span class="ident" id="7491148">tt</span><span class="op" id="7491150">.</span><span class="ident" id="7491151">name</span><span class="op" id="7491155">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7491159">if</span>&nbsp;<span class="ident" id="7491162">match</span>&nbsp;<span class="op" id="7491168">!=</span>&nbsp;<span class="ident" id="7491171">tt</span><span class="op" id="7491173">.</span><span class="ident" id="7491174">match</span>&nbsp;<span class="op" id="7491180">||</span>&nbsp;<span class="ident" id="7491183">err</span>&nbsp;<span class="op" id="7491187">!=</span>&nbsp;<span class="ident" id="7491190">nil</span>&nbsp;<span class="op" id="7491194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7491199">t</span><span class="op" id="7491200">.</span><span class="ident" id="7491201">Fatalf</span><span class="op" id="7491207">(</span><span class="string" id="7491208">&#34;MatchFile(%q)&nbsp;=&nbsp;%v,&nbsp;%v,&nbsp;want&nbsp;%v,&nbsp;nil&#34;</span><span class="op" id="7491246">,</span>&nbsp;<span class="ident" id="7491248">tt</span><span class="op" id="7491250">.</span><span class="ident" id="7491251">name</span><span class="op" id="7491255">,</span>&nbsp;<span class="ident" id="7491257">match</span><span class="op" id="7491262">,</span>&nbsp;<span class="ident" id="7491264">err</span><span class="op" id="7491267">,</span>&nbsp;<span class="ident" id="7491269">tt</span><span class="op" id="7491271">.</span><span class="ident" id="7491272">match</span><span class="op" id="7491277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7491281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7491284">}</span><br>
<span class="lineno"></span><span class="op" id="7491286">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="7491289">func</span>&nbsp;<span class="ident" id="7491294">TestImportCmd</span><span class="op" id="7491307">(</span><span class="ident" id="7491308">t</span>&nbsp;<span class="op" id="7491310">*</span><span class="ident" id="7491311">testing</span><span class="op" id="7491318">.</span><span class="ident" id="7491319">T</span><span class="op" id="7491320">)</span>&nbsp;<span class="op" id="7491322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7491325">p</span><span class="op" id="7491326">,</span>&nbsp;<span class="ident" id="7491328">err</span>&nbsp;<span class="op" id="7491332">:=</span>&nbsp;<span class="ident" id="7491335">Import</span><span class="op" id="7491341">(</span><span class="string" id="7491342">&#34;cmd/internal/objfile&#34;</span><span class="op" id="7491364">,</span>&nbsp;<span class="string" id="7491366">&#34;&#34;</span><span class="op" id="7491368">,</span>&nbsp;<span class="num" id="7491370">0</span><span class="op" id="7491371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7491374">if</span>&nbsp;<span class="ident" id="7491377">err</span>&nbsp;<span class="op" id="7491381">!=</span>&nbsp;<span class="ident" id="7491384">nil</span>&nbsp;<span class="op" id="7491388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7491392">t</span><span class="op" id="7491393">.</span><span class="ident" id="7491394">Fatal</span><span class="op" id="7491399">(</span><span class="ident" id="7491400">err</span><span class="op" id="7491403">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7491406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7491409">if</span>&nbsp;<span class="op" id="7491412">!</span><span class="ident" id="7491413">strings</span><span class="op" id="7491420">.</span><span class="ident" id="7491421">HasSuffix</span><span class="op" id="7491430">(</span><span class="ident" id="7491431">filepath</span><span class="op" id="7491439">.</span><span class="ident" id="7491440">ToSlash</span><span class="op" id="7491447">(</span><span class="ident" id="7491448">p</span><span class="op" id="7491449">.</span><span class="ident" id="7491450">Dir</span><span class="op" id="7491453">)</span><span class="op" id="7491454">,</span>&nbsp;<span class="string" id="7491456">&#34;src/cmd/internal/objfile&#34;</span><span class="op" id="7491482">)</span>&nbsp;<span class="op" id="7491484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7491488">t</span><span class="op" id="7491489">.</span><span class="ident" id="7491490">Fatalf</span><span class="op" id="7491496">(</span><span class="string" id="7491497">&#34;Import&nbsp;cmd/internal/objfile&nbsp;returned&nbsp;Dir=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7491551">,</span>&nbsp;<span class="ident" id="7491553">filepath</span><span class="op" id="7491561">.</span><span class="ident" id="7491562">ToSlash</span><span class="op" id="7491569">(</span><span class="ident" id="7491570">p</span><span class="op" id="7491571">.</span><span class="ident" id="7491572">Dir</span><span class="op" id="7491575">)</span><span class="op" id="7491576">,</span>&nbsp;<span class="string" id="7491578">&#34;.../src/cmd/internal/objfile&#34;</span><span class="op" id="7491608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7491611">}</span><br>
<span class="lineno"></span><span class="op" id="7491613">}</span>
</div>
</body>
</html>
