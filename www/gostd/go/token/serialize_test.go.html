<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7011328">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7011383">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7011437">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7011488">package</span>&nbsp;<span class="ident" id="7011496">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7011503">import</span>&nbsp;<span class="op" id="7011510">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7011513">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7011522">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7011538">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7011545">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7011555">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7011558">//&nbsp;equal&nbsp;returns&nbsp;nil&nbsp;if&nbsp;p&nbsp;and&nbsp;q&nbsp;describe&nbsp;the&nbsp;same&nbsp;file&nbsp;set;</span><br>
<span class="lineno">15</span><span class="comment" id="7011618">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error&nbsp;describing&nbsp;the&nbsp;discrepancy.</span><br>
<span class="lineno"></span><span class="keyword" id="7011679">func</span>&nbsp;<span class="ident" id="7011684">equal</span><span class="op" id="7011689">(</span><span class="ident" id="7011690">p</span><span class="op" id="7011691">,</span>&nbsp;<span class="ident" id="7011693">q</span>&nbsp;<span class="op" id="7011695">*</span><span class="ident" id="7011696">FileSet</span><span class="op" id="7011703">)</span>&nbsp;<span class="builtintype" id="7011705">error</span>&nbsp;<span class="op" id="7011711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7011714">if</span>&nbsp;<span class="ident" id="7011717">p</span>&nbsp;<span class="op" id="7011719">==</span>&nbsp;<span class="ident" id="7011722">q</span>&nbsp;<span class="op" id="7011724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7011728">//&nbsp;avoid&nbsp;deadlock&nbsp;if&nbsp;p&nbsp;==&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7011758">return</span>&nbsp;<span class="ident" id="7011765">nil</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7011770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7011774">//&nbsp;not&nbsp;strictly&nbsp;needed&nbsp;for&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7011811">p</span><span class="op" id="7011812">.</span><span class="ident" id="7011813">mutex</span><span class="op" id="7011818">.</span><span class="ident" id="7011819">Lock</span><span class="op" id="7011823">(</span><span class="op" id="7011824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7011827">q</span><span class="op" id="7011828">.</span><span class="ident" id="7011829">mutex</span><span class="op" id="7011834">.</span><span class="ident" id="7011835">Lock</span><span class="op" id="7011839">(</span><span class="op" id="7011840">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7011843">defer</span>&nbsp;<span class="ident" id="7011849">q</span><span class="op" id="7011850">.</span><span class="ident" id="7011851">mutex</span><span class="op" id="7011856">.</span><span class="ident" id="7011857">Unlock</span><span class="op" id="7011863">(</span><span class="op" id="7011864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7011867">defer</span>&nbsp;<span class="ident" id="7011873">p</span><span class="op" id="7011874">.</span><span class="ident" id="7011875">mutex</span><span class="op" id="7011880">.</span><span class="ident" id="7011881">Unlock</span><span class="op" id="7011887">(</span><span class="op" id="7011888">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7011892">if</span>&nbsp;<span class="ident" id="7011895">p</span><span class="op" id="7011896">.</span><span class="ident" id="7011897">base</span>&nbsp;<span class="op" id="7011902">!=</span>&nbsp;<span class="ident" id="7011905">q</span><span class="op" id="7011906">.</span><span class="ident" id="7011907">base</span>&nbsp;<span class="op" id="7011912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7011916">return</span>&nbsp;<span class="ident" id="7011923">fmt</span><span class="op" id="7011926">.</span><span class="ident" id="7011927">Errorf</span><span class="op" id="7011933">(</span><span class="string" id="7011934">&#34;different&nbsp;bases:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7011961">,</span>&nbsp;<span class="ident" id="7011963">p</span><span class="op" id="7011964">.</span><span class="ident" id="7011965">base</span><span class="op" id="7011969">,</span>&nbsp;<span class="ident" id="7011971">q</span><span class="op" id="7011972">.</span><span class="ident" id="7011973">base</span><span class="op" id="7011977">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7011980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7011984">if</span>&nbsp;<span class="builtinfunc" id="7011987">len</span><span class="op" id="7011990">(</span><span class="ident" id="7011991">p</span><span class="op" id="7011992">.</span><span class="ident" id="7011993">files</span><span class="op" id="7011998">)</span>&nbsp;<span class="op" id="7012000">!=</span>&nbsp;<span class="builtinfunc" id="7012003">len</span><span class="op" id="7012006">(</span><span class="ident" id="7012007">q</span><span class="op" id="7012008">.</span><span class="ident" id="7012009">files</span><span class="op" id="7012014">)</span>&nbsp;<span class="op" id="7012016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7012020">return</span>&nbsp;<span class="ident" id="7012027">fmt</span><span class="op" id="7012030">.</span><span class="ident" id="7012031">Errorf</span><span class="op" id="7012037">(</span><span class="string" id="7012038">&#34;different&nbsp;number&nbsp;of&nbsp;files:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7012075">,</span>&nbsp;<span class="builtinfunc" id="7012077">len</span><span class="op" id="7012080">(</span><span class="ident" id="7012081">p</span><span class="op" id="7012082">.</span><span class="ident" id="7012083">files</span><span class="op" id="7012088">)</span><span class="op" id="7012089">,</span>&nbsp;<span class="builtinfunc" id="7012091">len</span><span class="op" id="7012094">(</span><span class="ident" id="7012095">q</span><span class="op" id="7012096">.</span><span class="ident" id="7012097">files</span><span class="op" id="7012102">)</span><span class="op" id="7012103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7012106">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7012110">for</span>&nbsp;<span class="ident" id="7012114">i</span><span class="op" id="7012115">,</span>&nbsp;<span class="ident" id="7012117">f</span>&nbsp;<span class="op" id="7012119">:=</span>&nbsp;<span class="keyword" id="7012122">range</span>&nbsp;<span class="ident" id="7012128">p</span><span class="op" id="7012129">.</span><span class="ident" id="7012130">files</span>&nbsp;<span class="op" id="7012136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7012140">g</span>&nbsp;<span class="op" id="7012142">:=</span>&nbsp;<span class="ident" id="7012145">q</span><span class="op" id="7012146">.</span><span class="ident" id="7012147">files</span><span class="op" id="7012152">[</span><span class="ident" id="7012153">i</span><span class="op" id="7012154">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7012158">if</span>&nbsp;<span class="ident" id="7012161">f</span><span class="op" id="7012162">.</span><span class="ident" id="7012163">set</span>&nbsp;<span class="op" id="7012167">!=</span>&nbsp;<span class="ident" id="7012170">p</span>&nbsp;<span class="op" id="7012172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7012177">return</span>&nbsp;<span class="ident" id="7012184">fmt</span><span class="op" id="7012187">.</span><span class="ident" id="7012188">Errorf</span><span class="op" id="7012194">(</span><span class="string" id="7012195">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7012217">,</span>&nbsp;<span class="ident" id="7012219">f</span><span class="op" id="7012220">.</span><span class="ident" id="7012221">name</span><span class="op" id="7012225">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7012229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7012233">if</span>&nbsp;<span class="ident" id="7012236">g</span><span class="op" id="7012237">.</span><span class="ident" id="7012238">set</span>&nbsp;<span class="op" id="7012242">!=</span>&nbsp;<span class="ident" id="7012245">q</span>&nbsp;<span class="op" id="7012247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7012252">return</span>&nbsp;<span class="ident" id="7012259">fmt</span><span class="op" id="7012262">.</span><span class="ident" id="7012263">Errorf</span><span class="op" id="7012269">(</span><span class="string" id="7012270">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7012292">,</span>&nbsp;<span class="ident" id="7012294">g</span><span class="op" id="7012295">.</span><span class="ident" id="7012296">name</span><span class="op" id="7012300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7012304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7012308">if</span>&nbsp;<span class="ident" id="7012311">f</span><span class="op" id="7012312">.</span><span class="ident" id="7012313">name</span>&nbsp;<span class="op" id="7012318">!=</span>&nbsp;<span class="ident" id="7012321">g</span><span class="op" id="7012322">.</span><span class="ident" id="7012323">name</span>&nbsp;<span class="op" id="7012328">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7012333">return</span>&nbsp;<span class="ident" id="7012340">fmt</span><span class="op" id="7012343">.</span><span class="ident" id="7012344">Errorf</span><span class="op" id="7012350">(</span><span class="string" id="7012351">&#34;different&nbsp;filenames:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="7012382">,</span>&nbsp;<span class="ident" id="7012384">f</span><span class="op" id="7012385">.</span><span class="ident" id="7012386">name</span><span class="op" id="7012390">,</span>&nbsp;<span class="ident" id="7012392">g</span><span class="op" id="7012393">.</span><span class="ident" id="7012394">name</span><span class="op" id="7012398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7012402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7012406">if</span>&nbsp;<span class="ident" id="7012409">f</span><span class="op" id="7012410">.</span><span class="ident" id="7012411">base</span>&nbsp;<span class="op" id="7012416">!=</span>&nbsp;<span class="ident" id="7012419">g</span><span class="op" id="7012420">.</span><span class="ident" id="7012421">base</span>&nbsp;<span class="op" id="7012426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7012431">return</span>&nbsp;<span class="ident" id="7012438">fmt</span><span class="op" id="7012441">.</span><span class="ident" id="7012442">Errorf</span><span class="op" id="7012448">(</span><span class="string" id="7012449">&#34;different&nbsp;base&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7012482">,</span>&nbsp;<span class="ident" id="7012484">f</span><span class="op" id="7012485">.</span><span class="ident" id="7012486">name</span><span class="op" id="7012490">,</span>&nbsp;<span class="ident" id="7012492">f</span><span class="op" id="7012493">.</span><span class="ident" id="7012494">base</span><span class="op" id="7012498">,</span>&nbsp;<span class="ident" id="7012500">g</span><span class="op" id="7012501">.</span><span class="ident" id="7012502">base</span><span class="op" id="7012506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7012510">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7012514">if</span>&nbsp;<span class="ident" id="7012517">f</span><span class="op" id="7012518">.</span><span class="ident" id="7012519">size</span>&nbsp;<span class="op" id="7012524">!=</span>&nbsp;<span class="ident" id="7012527">g</span><span class="op" id="7012528">.</span><span class="ident" id="7012529">size</span>&nbsp;<span class="op" id="7012534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7012539">return</span>&nbsp;<span class="ident" id="7012546">fmt</span><span class="op" id="7012549">.</span><span class="ident" id="7012550">Errorf</span><span class="op" id="7012556">(</span><span class="string" id="7012557">&#34;different&nbsp;size&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7012590">,</span>&nbsp;<span class="ident" id="7012592">f</span><span class="op" id="7012593">.</span><span class="ident" id="7012594">name</span><span class="op" id="7012598">,</span>&nbsp;<span class="ident" id="7012600">f</span><span class="op" id="7012601">.</span><span class="ident" id="7012602">size</span><span class="op" id="7012606">,</span>&nbsp;<span class="ident" id="7012608">g</span><span class="op" id="7012609">.</span><span class="ident" id="7012610">size</span><span class="op" id="7012614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7012618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7012622">for</span>&nbsp;<span class="ident" id="7012626">j</span><span class="op" id="7012627">,</span>&nbsp;<span class="ident" id="7012629">l</span>&nbsp;<span class="op" id="7012631">:=</span>&nbsp;<span class="keyword" id="7012634">range</span>&nbsp;<span class="ident" id="7012640">f</span><span class="op" id="7012641">.</span><span class="ident" id="7012642">lines</span>&nbsp;<span class="op" id="7012648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7012653">m</span>&nbsp;<span class="op" id="7012655">:=</span>&nbsp;<span class="ident" id="7012658">g</span><span class="op" id="7012659">.</span><span class="ident" id="7012660">lines</span><span class="op" id="7012665">[</span><span class="ident" id="7012666">j</span><span class="op" id="7012667">]</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7012672">if</span>&nbsp;<span class="ident" id="7012675">l</span>&nbsp;<span class="op" id="7012677">!=</span>&nbsp;<span class="ident" id="7012680">m</span>&nbsp;<span class="op" id="7012682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7012688">return</span>&nbsp;<span class="ident" id="7012695">fmt</span><span class="op" id="7012698">.</span><span class="ident" id="7012699">Errorf</span><span class="op" id="7012705">(</span><span class="string" id="7012706">&#34;different&nbsp;offsets&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7012732">,</span>&nbsp;<span class="ident" id="7012734">f</span><span class="op" id="7012735">.</span><span class="ident" id="7012736">name</span><span class="op" id="7012740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7012745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7012749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7012753">for</span>&nbsp;<span class="ident" id="7012757">j</span><span class="op" id="7012758">,</span>&nbsp;<span class="ident" id="7012760">l</span>&nbsp;<span class="op" id="7012762">:=</span>&nbsp;<span class="keyword" id="7012765">range</span>&nbsp;<span class="ident" id="7012771">f</span><span class="op" id="7012772">.</span><span class="ident" id="7012773">infos</span>&nbsp;<span class="op" id="7012779">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7012784">m</span>&nbsp;<span class="op" id="7012786">:=</span>&nbsp;<span class="ident" id="7012789">g</span><span class="op" id="7012790">.</span><span class="ident" id="7012791">infos</span><span class="op" id="7012796">[</span><span class="ident" id="7012797">j</span><span class="op" id="7012798">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7012803">if</span>&nbsp;<span class="ident" id="7012806">l</span><span class="op" id="7012807">.</span><span class="ident" id="7012808">Offset</span>&nbsp;<span class="op" id="7012815">!=</span>&nbsp;<span class="ident" id="7012818">m</span><span class="op" id="7012819">.</span><span class="ident" id="7012820">Offset</span>&nbsp;<span class="op" id="7012827">||</span>&nbsp;<span class="ident" id="7012830">l</span><span class="op" id="7012831">.</span><span class="ident" id="7012832">Filename</span>&nbsp;<span class="op" id="7012841">!=</span>&nbsp;<span class="ident" id="7012844">m</span><span class="op" id="7012845">.</span><span class="ident" id="7012846">Filename</span>&nbsp;<span class="op" id="7012855">||</span>&nbsp;<span class="ident" id="7012858">l</span><span class="op" id="7012859">.</span><span class="ident" id="7012860">Line</span>&nbsp;<span class="op" id="7012865">!=</span>&nbsp;<span class="ident" id="7012868">m</span><span class="op" id="7012869">.</span><span class="ident" id="7012870">Line</span>&nbsp;<span class="op" id="7012875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7012881">return</span>&nbsp;<span class="ident" id="7012888">fmt</span><span class="op" id="7012891">.</span><span class="ident" id="7012892">Errorf</span><span class="op" id="7012898">(</span><span class="string" id="7012899">&#34;different&nbsp;infos&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7012923">,</span>&nbsp;<span class="ident" id="7012925">f</span><span class="op" id="7012926">.</span><span class="ident" id="7012927">name</span><span class="op" id="7012931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7012936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7012940">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7012943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7012947">//&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;about&nbsp;.last&nbsp;-&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7012997">return</span>&nbsp;<span class="ident" id="7013004">nil</span><br>
<span class="lineno"></span><span class="op" id="7013008">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7013011">func</span>&nbsp;<span class="ident" id="7013016">checkSerialize</span><span class="op" id="7013030">(</span><span class="ident" id="7013031">t</span>&nbsp;<span class="op" id="7013033">*</span><span class="ident" id="7013034">testing</span><span class="op" id="7013041">.</span><span class="ident" id="7013042">T</span><span class="op" id="7013043">,</span>&nbsp;<span class="ident" id="7013045">p</span>&nbsp;<span class="op" id="7013047">*</span><span class="ident" id="7013048">FileSet</span><span class="op" id="7013055">)</span>&nbsp;<span class="op" id="7013057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7013060">var</span>&nbsp;<span class="ident" id="7013064">buf</span>&nbsp;<span class="ident" id="7013068">bytes</span><span class="op" id="7013073">.</span><span class="ident" id="7013074">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7013082">encode</span>&nbsp;<span class="op" id="7013089">:=</span>&nbsp;<span class="keyword" id="7013092">func</span><span class="op" id="7013096">(</span><span class="ident" id="7013097">x</span>&nbsp;<span class="keyword" id="7013099">interface</span><span class="op" id="7013108">{</span><span class="op" id="7013109">}</span><span class="op" id="7013110">)</span>&nbsp;<span class="builtintype" id="7013112">error</span>&nbsp;<span class="op" id="7013118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7013122">return</span>&nbsp;<span class="ident" id="7013129">gob</span><span class="op" id="7013132">.</span><span class="ident" id="7013133">NewEncoder</span><span class="op" id="7013143">(</span><span class="op" id="7013144">&amp;</span><span class="ident" id="7013145">buf</span><span class="op" id="7013148">)</span><span class="op" id="7013149">.</span><span class="ident" id="7013150">Encode</span><span class="op" id="7013156">(</span><span class="ident" id="7013157">x</span><span class="op" id="7013158">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7013161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7013164">if</span>&nbsp;<span class="ident" id="7013167">err</span>&nbsp;<span class="op" id="7013171">:=</span>&nbsp;<span class="ident" id="7013174">p</span><span class="op" id="7013175">.</span><span class="ident" id="7013176">Write</span><span class="op" id="7013181">(</span><span class="ident" id="7013182">encode</span><span class="op" id="7013188">)</span><span class="op" id="7013189">;</span>&nbsp;<span class="ident" id="7013191">err</span>&nbsp;<span class="op" id="7013195">!=</span>&nbsp;<span class="ident" id="7013198">nil</span>&nbsp;<span class="op" id="7013202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7013206">t</span><span class="op" id="7013207">.</span><span class="ident" id="7013208">Errorf</span><span class="op" id="7013214">(</span><span class="string" id="7013215">&#34;writing&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7013243">,</span>&nbsp;<span class="ident" id="7013245">err</span><span class="op" id="7013248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7013252">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7013260">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7013263">q</span>&nbsp;<span class="op" id="7013265">:=</span>&nbsp;<span class="ident" id="7013268">NewFileSet</span><span class="op" id="7013278">(</span><span class="op" id="7013279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7013282">decode</span>&nbsp;<span class="op" id="7013289">:=</span>&nbsp;<span class="keyword" id="7013292">func</span><span class="op" id="7013296">(</span><span class="ident" id="7013297">x</span>&nbsp;<span class="keyword" id="7013299">interface</span><span class="op" id="7013308">{</span><span class="op" id="7013309">}</span><span class="op" id="7013310">)</span>&nbsp;<span class="builtintype" id="7013312">error</span>&nbsp;<span class="op" id="7013318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7013322">return</span>&nbsp;<span class="ident" id="7013329">gob</span><span class="op" id="7013332">.</span><span class="ident" id="7013333">NewDecoder</span><span class="op" id="7013343">(</span><span class="op" id="7013344">&amp;</span><span class="ident" id="7013345">buf</span><span class="op" id="7013348">)</span><span class="op" id="7013349">.</span><span class="ident" id="7013350">Decode</span><span class="op" id="7013356">(</span><span class="ident" id="7013357">x</span><span class="op" id="7013358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7013361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7013364">if</span>&nbsp;<span class="ident" id="7013367">err</span>&nbsp;<span class="op" id="7013371">:=</span>&nbsp;<span class="ident" id="7013374">q</span><span class="op" id="7013375">.</span><span class="ident" id="7013376">Read</span><span class="op" id="7013380">(</span><span class="ident" id="7013381">decode</span><span class="op" id="7013387">)</span><span class="op" id="7013388">;</span>&nbsp;<span class="ident" id="7013390">err</span>&nbsp;<span class="op" id="7013394">!=</span>&nbsp;<span class="ident" id="7013397">nil</span>&nbsp;<span class="op" id="7013401">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7013405">t</span><span class="op" id="7013406">.</span><span class="ident" id="7013407">Errorf</span><span class="op" id="7013413">(</span><span class="string" id="7013414">&#34;reading&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7013442">,</span>&nbsp;<span class="ident" id="7013444">err</span><span class="op" id="7013447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7013451">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7013459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7013462">if</span>&nbsp;<span class="ident" id="7013465">err</span>&nbsp;<span class="op" id="7013469">:=</span>&nbsp;<span class="ident" id="7013472">equal</span><span class="op" id="7013477">(</span><span class="ident" id="7013478">p</span><span class="op" id="7013479">,</span>&nbsp;<span class="ident" id="7013481">q</span><span class="op" id="7013482">)</span><span class="op" id="7013483">;</span>&nbsp;<span class="ident" id="7013485">err</span>&nbsp;<span class="op" id="7013489">!=</span>&nbsp;<span class="ident" id="7013492">nil</span>&nbsp;<span class="op" id="7013496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7013500">t</span><span class="op" id="7013501">.</span><span class="ident" id="7013502">Errorf</span><span class="op" id="7013508">(</span><span class="string" id="7013509">&#34;filesets&nbsp;not&nbsp;identical:&nbsp;%s&#34;</span><span class="op" id="7013537">,</span>&nbsp;<span class="ident" id="7013539">err</span><span class="op" id="7013542">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7013545">}</span><br>
<span class="lineno"></span><span class="op" id="7013547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7013550">func</span>&nbsp;<span class="ident" id="7013555">TestSerialization</span><span class="op" id="7013572">(</span><span class="ident" id="7013573">t</span>&nbsp;<span class="op" id="7013575">*</span><span class="ident" id="7013576">testing</span><span class="op" id="7013583">.</span><span class="ident" id="7013584">T</span><span class="op" id="7013585">)</span>&nbsp;<span class="op" id="7013587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7013590">p</span>&nbsp;<span class="op" id="7013592">:=</span>&nbsp;<span class="ident" id="7013595">NewFileSet</span><span class="op" id="7013605">(</span><span class="op" id="7013606">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7013609">checkSerialize</span><span class="op" id="7013623">(</span><span class="ident" id="7013624">t</span><span class="op" id="7013625">,</span>&nbsp;<span class="ident" id="7013627">p</span><span class="op" id="7013628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7013631">//&nbsp;add&nbsp;some&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7013650">for</span>&nbsp;<span class="ident" id="7013654">i</span>&nbsp;<span class="op" id="7013656">:=</span>&nbsp;<span class="num" id="7013659">0</span><span class="op" id="7013660">;</span>&nbsp;<span class="ident" id="7013662">i</span>&nbsp;<span class="op" id="7013664">&lt;</span>&nbsp;<span class="num" id="7013666">10</span><span class="op" id="7013668">;</span>&nbsp;<span class="ident" id="7013670">i</span><span class="op" id="7013671">++</span>&nbsp;<span class="op" id="7013674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7013678">f</span>&nbsp;<span class="op" id="7013680">:=</span>&nbsp;<span class="ident" id="7013683">p</span><span class="op" id="7013684">.</span><span class="ident" id="7013685">AddFile</span><span class="op" id="7013692">(</span><span class="ident" id="7013693">fmt</span><span class="op" id="7013696">.</span><span class="ident" id="7013697">Sprintf</span><span class="op" id="7013704">(</span><span class="string" id="7013705">&#34;file%d&#34;</span><span class="op" id="7013713">,</span>&nbsp;<span class="ident" id="7013715">i</span><span class="op" id="7013716">)</span><span class="op" id="7013717">,</span>&nbsp;<span class="ident" id="7013719">p</span><span class="op" id="7013720">.</span><span class="ident" id="7013721">Base</span><span class="op" id="7013725">(</span><span class="op" id="7013726">)</span><span class="op" id="7013727">+</span><span class="ident" id="7013728">i</span><span class="op" id="7013729">,</span>&nbsp;<span class="ident" id="7013731">i</span><span class="op" id="7013732">*</span><span class="num" id="7013733">100</span><span class="op" id="7013736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7013740">checkSerialize</span><span class="op" id="7013754">(</span><span class="ident" id="7013755">t</span><span class="op" id="7013756">,</span>&nbsp;<span class="ident" id="7013758">p</span><span class="op" id="7013759">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7013763">//&nbsp;add&nbsp;some&nbsp;lines&nbsp;and&nbsp;alternative&nbsp;file&nbsp;infos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7013810">line</span>&nbsp;<span class="op" id="7013815">:=</span>&nbsp;<span class="num" id="7013818">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7013825">for</span>&nbsp;<span class="ident" id="7013829">offs</span>&nbsp;<span class="op" id="7013834">:=</span>&nbsp;<span class="num" id="7013837">0</span><span class="op" id="7013838">;</span>&nbsp;<span class="ident" id="7013840">offs</span>&nbsp;<span class="op" id="7013845">&lt;</span>&nbsp;<span class="ident" id="7013847">f</span><span class="op" id="7013848">.</span><span class="ident" id="7013849">Size</span><span class="op" id="7013853">(</span><span class="op" id="7013854">)</span><span class="op" id="7013855">;</span>&nbsp;<span class="ident" id="7013857">offs</span>&nbsp;<span class="op" id="7013862">+=</span>&nbsp;<span class="num" id="7013865">40</span>&nbsp;<span class="op" id="7013868">+</span>&nbsp;<span class="ident" id="7013870">i</span>&nbsp;<span class="op" id="7013872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7013877">f</span><span class="op" id="7013878">.</span><span class="ident" id="7013879">AddLine</span><span class="op" id="7013886">(</span><span class="ident" id="7013887">offs</span><span class="op" id="7013891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7013896">if</span>&nbsp;<span class="ident" id="7013899">offs</span><span class="op" id="7013903">%</span><span class="num" id="7013904">7</span>&nbsp;<span class="op" id="7013906">==</span>&nbsp;<span class="num" id="7013909">0</span>&nbsp;<span class="op" id="7013911">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7013917">f</span><span class="op" id="7013918">.</span><span class="ident" id="7013919">AddLineInfo</span><span class="op" id="7013930">(</span><span class="ident" id="7013931">offs</span><span class="op" id="7013935">,</span>&nbsp;<span class="ident" id="7013937">fmt</span><span class="op" id="7013940">.</span><span class="ident" id="7013941">Sprintf</span><span class="op" id="7013948">(</span><span class="string" id="7013949">&#34;file%d&#34;</span><span class="op" id="7013957">,</span>&nbsp;<span class="ident" id="7013959">offs</span><span class="op" id="7013963">)</span><span class="op" id="7013964">,</span>&nbsp;<span class="ident" id="7013966">line</span><span class="op" id="7013970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7013976">line</span>&nbsp;<span class="op" id="7013981">+=</span>&nbsp;<span class="num" id="7013984">33</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7013990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7013994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7013998">checkSerialize</span><span class="op" id="7014012">(</span><span class="ident" id="7014013">t</span><span class="op" id="7014014">,</span>&nbsp;<span class="ident" id="7014016">p</span><span class="op" id="7014017">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7014020">}</span><br>
<span class="lineno"></span><span class="op" id="7014022">}</span>
</div>
</body>
</html>
